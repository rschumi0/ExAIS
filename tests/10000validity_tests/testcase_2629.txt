import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Per41599 = tf.keras.layers.Input(shape=([4, 3]))
in0Add59875 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Add59875 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Dot39403 = tf.keras.layers.Input(shape=([3]))
in1Dot39403 = tf.keras.layers.Input(shape=([3]))
in0Ave46451 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Ave46451 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))

Per41599 = keras.layers.Permute((2,1), name = 'Per41599',)(in0Per41599)
Res96654 = keras.layers.Reshape((3, 4, 1), name = 'Res96654', )(Per41599)
Glo50271 = keras.layers.GlobalMaxPool2D(name = 'Glo50271', )(Res96654)
Res11180 = keras.layers.Reshape((1, 1), name = 'Res11180', )(Glo50271)
LST32729 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST32729', )(Res11180)
Res85460 = keras.layers.Reshape((2, 1), name = 'Res85460', )(LST32729)
Res19516 = keras.layers.Reshape((2, 1, 1), name = 'Res19516', )(Res85460)
Add59875 = keras.layers.Add(name = 'Add59875', )([in0Add59875,in1Add59875])
Zer66460 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer66460', )(Add59875)
Add37423 = keras.layers.Add(name = 'Add37423', )([Res19516,Zer66460])
Res69291 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res69291', )(Add37423)
Dot39403 = keras.layers.Dot(axes=(1, 1), name = 'Dot39403', )([in0Dot39403,in1Dot39403])
Res29285 = keras.layers.Reshape((1, 1), name = 'Res29285', )(Dot39403)
Res72469 = keras.layers.Reshape((1, 1, 1), name = 'Res72469', )(Res29285)
Res37042 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res37042', )(Res72469)
Ave46451 = keras.layers.Average(name = 'Ave46451', )([in0Ave46451,in1Ave46451])
Min2927 = keras.layers.Minimum(name = 'Min2927', )([Res37042,Ave46451])
Zer64880 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (0, 0)), name = 'Zer64880', )(Min2927)
Min29423 = keras.layers.Minimum(name = 'Min29423', )([Res69291,Zer64880])
model = tf.keras.models.Model(inputs=[in0Per41599,in0Add59875,in1Add59875,in0Dot39403,in1Dot39403,in0Ave46451,in1Ave46451], outputs=Min29423)
w = model.get_layer('LST32729').get_weights() 
w[0] = np.array([[5, 10, 3, 4, 4, 6, 1, 4]])
w[1] = np.array([[5, 2, 3, 7, 4, 5, 4, 8], [1, 4, 10, 9, 8, 6, 8, 7]])
w[2] = np.array([2, 1, 4, 3, 1, 9, 8, 10])
model.get_layer('LST32729').set_weights(w) 
in0Per41599 = tf.constant([[[1.2111, 1.2107, 1.2419], [1.781, 1.73, 1.1689], [1.8283, 1.7176, 1.1064], [1.0056, 1.7317, 1.7717]]])
in0Add59875 = tf.constant([[[[0.6999]]]])
in1Add59875 = tf.constant([[[[0.8819]]]])
in0Dot39403 = tf.constant([[0.455, 0.2234, 0.0029]])
in1Dot39403 = tf.constant([[0.2601, 0.9414, 0.4049]])
in0Ave46451 = tf.constant([[[[[0.4252]]]]])
in1Ave46451 = tf.constant([[[[[0.9971]]]]])
print (np.array2string(model.predict([in0Per41599,in0Add59875,in1Add59875,in0Dot39403,in1Dot39403,in0Ave46451,in1Ave46451],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min29423.png')

LPer41599 = permute_layer([[[1.2111, 1.2107, 1.2419], [1.781, 1.73, 1.1689], [1.8283, 1.7176, 1.1064], [1.0056, 1.7317, 1.7717]]], 2,1, Per41599), 
LRes96654 = reshape_layer(Per41599, [3, 4, 1], Res96654), 
LGlo50271 = global_max_pool2D_layer(Res96654, Glo50271), 
LRes11180 = reshape_layer(Glo50271, [1, 1], Res11180), 
LLST32729 = lstm_layer(Res11180,[[5, 10, 3, 4, 4, 6, 1, 4]],[[5, 2, 3, 7, 4, 5, 4, 8], [1, 4, 10, 9, 8, 6, 8, 7]],[2, 1, 4, 3, 1, 9, 8, 10], LST32729), 
LRes85460 = reshape_layer(LST32729, [2, 1], Res85460), 
LRes19516 = reshape_layer(Res85460, [2, 1, 1], Res19516), 
LAdd59875 = add_layer([[[[[0.6999]]]], [[[[0.8819]]]]], Add59875), 
LZer66460 = zero_padding2D_layer(Add59875, 1, 0, 0, 0, Zer66460), 
LAdd37423 = add_layer([Res19516,Zer66460], Add37423), 
LRes69291 = reshape_layer(Add37423, [2, 1, 1, 1], Res69291), 
LDot39403 = dot_layer([[0.455, 0.2234, 0.0029]], [[0.2601, 0.9414, 0.4049]], 1, 1, Dot39403), 
LRes29285 = reshape_layer(Dot39403, [1, 1], Res29285), 
LRes72469 = reshape_layer(Res29285, [1, 1, 1], Res72469), 
LRes37042 = reshape_layer(Res72469, [1, 1, 1, 1], Res37042), 
LAve46451 = average_layer([[[[[[0.4252]]]]], [[[[[0.9971]]]]]], Ave46451), 
LMin2927 = minimum_layer([Res37042,Ave46451], Min2927), 
LZer64880 = zero_padding3D_layer(Min2927, 1, 0, 0, 0, 0, 0, Zer64880), 
LMin29423 = minimum_layer([Res69291,Zer64880], Min29423), 
exec_layers([LPer41599,LRes96654,LGlo50271,LRes11180,LLST32729,LRes85460,LRes19516,LAdd59875,LZer66460,LAdd37423,LRes69291,LDot39403,LRes29285,LRes72469,LRes37042,LAve46451,LMin2927,LZer64880,LMin29423],["Per41599","Res96654","Glo50271","Res11180","LST32729","Res85460","Res19516","Add59875","Zer66460","Add37423","Res69291","Dot39403","Res29285","Res72469","Res37042","Ave46451","Min2927","Zer64880","Min29423"],Min29423,"Min29423")

Actual (Unparsed): [[[[[0.0000000]]], [[[0.3298285]]]]]

Expected (Unparsed): [[[[[0]]],[[[0.32982847]]]]]

Actual:   [[[[[0]]], [[[0.3299]]]]]

Expected: [[[[[0]]], [[[0.3299]]]]]