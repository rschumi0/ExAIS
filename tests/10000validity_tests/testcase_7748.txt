import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc75083 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con32708 = tf.keras.layers.Input(shape=([3, 4, 2]))
in0Bat77350 = tf.keras.layers.Input(shape=([3, 4, 4]))

Loc75083 = keras.layers.LocallyConnected2D(2, (1, 2),strides=(1, 1), name = 'Loc75083', )(in0Loc75083)
Zer59493 = keras.layers.ZeroPadding2D(padding=((1, 0), (3, 0)), name = 'Zer59493', )(Loc75083)
Con32708 = keras.layers.Concatenate(axis=3, name = 'Con32708', )([Zer59493,in0Con32708])
Bat77350 = keras.layers.BatchNormalization(axis=3, epsilon=0.917775404754544,  name = 'Bat77350', )(in0Bat77350)
Mul10297 = keras.layers.Multiply(name = 'Mul10297', )([Con32708,Bat77350])
Res4073 = keras.layers.Reshape((3, 4, 4, 1), name = 'Res4073', )(Mul10297)
Con70224 = keras.layers.Conv3D(4, (3, 3, 4),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con70224', )(Res4073)
model = tf.keras.models.Model(inputs=[in0Loc75083,in0Con32708,in0Bat77350], outputs=Con70224)
w = model.get_layer('Loc75083').get_weights() 
w[0] = np.array([[[0.1564, 0.0119], [0.8187, 0.5169], [0.3233, 0.662], [0.1436, 0.5857]], [[0.9114, 0.9336], [0.6989, 0.4498], [0.6668, 0.2473], [0.26, 0.2333]]])
w[1] = np.array([[[0, 0]], [[0, 0]]])
model.get_layer('Loc75083').set_weights(w) 
w = model.get_layer('Bat77350').get_weights() 
w[0] = np.array([0.128, 0.3788, 0.6754, 0.9469])
w[1] = np.array([0.9861, 0.1254, 0.7164, 0.1724])
w[2] = np.array([0.4957, 0.062, 0.6747, 0.5805])
w[3] = np.array([0.4502, 0.9259, 0.9744, 0.8512])
model.get_layer('Bat77350').set_weights(w) 
w = model.get_layer('Con70224').get_weights() 
w[0] = np.array([[[[[0.1201, 0.5132, 0.2335, 0.5288]], [[0.8917, 0.2703, 0.5039, 0.7839]], [[0.9182, 0.4641, 0.9894, 0.1568]], [[0.3514, 0.1596, 0.7908, 0.9808]]], [[[0.9716, 0.5406, 0.6245, 0.0316]], [[0.0825, 0.6914, 0.4867, 0.5941]], [[0.5219, 0.3226, 0.9654, 0.1255]], [[0.1106, 0.2619, 0.5723, 0.5617]]], [[[0.5909, 0.4267, 0.5847, 0.2199]], [[0.8657, 0.1648, 0.5337, 0.9395]], [[0.1367, 0.3047, 0.6605, 0.573]], [[0.3653, 0.9933, 0.3711, 0.1885]]]], [[[[0.328, 0.4136, 0.9629, 0.3812]], [[0.4255, 0.7743, 0.6742, 0.8979]], [[0.3172, 0.5419, 0.4093, 0.3827]], [[0.4019, 0.7455, 0.3309, 0.4178]]], [[[0.1387, 0.3276, 0.8807, 0.1998]], [[0.2161, 0.9352, 0.6853, 0.1236]], [[0.6133, 0.2521, 0.239, 0.2688]], [[0.6702, 0.9549, 0.2131, 0.2853]]], [[[0.387, 0.6468, 0.7382, 0.4538]], [[0.3042, 0.6654, 0.028, 0.7637]], [[0.4831, 0.496, 0.269, 0.6935]], [[0.2997, 0.6257, 0.7884, 0.0062]]]], [[[[0.9955, 0.0721, 0.1304, 0.2775]], [[0.1839, 0.4858, 0.819, 0.0659]], [[0.8047, 0.688, 0.2685, 0.6004]], [[0.3381, 0.7324, 0.5136, 0.6152]]], [[[0.4423, 0.1021, 0.1732, 0.491]], [[0.5642, 0.4491, 0.3376, 0.1775]], [[0.4851, 0.3605, 0.8761, 0.4648]], [[0.2131, 0.0002, 0.9935, 0.0494]]], [[[0.1068, 0.1122, 0.7395, 0.4962]], [[0.6294, 0.7981, 0.5681, 0.636]], [[0.6664, 0.6821, 0.9782, 0.1602]], [[0.9161, 0.5657, 0.7277, 0.172]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con70224').set_weights(w) 
in0Loc75083 = tf.constant([[[[0.3675, 0.682], [0.9607, 0.0153]], [[0.1005, 0.7195], [0.9754, 0.7172]]]])
in0Con32708 = tf.constant([[[[0.2584, 0.459], [0.1, 0.7494], [0.5593, 0.4986], [0.1436, 0.6148]], [[0.9898, 0.5145], [0.1773, 0.1476], [0.322, 0.5094], [0.2624, 0.3894]], [[0.3037, 0.1019], [0.1552, 0.7854], [0.4598, 0.7468], [0.8244, 0.6962]]]])
in0Bat77350 = tf.constant([[[[1.0665, 1.4355, 1.6094, 1.5548], [1.6587, 1.2818, 1.3756, 1.4818], [1.0668, 1.5914, 1.1946, 1.4143], [1.1045, 1.2227, 1.1394, 1.6908]], [[1.457, 1.1459, 1.5852, 1.1279], [1.1499, 1.8791, 1.415, 1.8842], [1.1794, 1.0548, 1.0836, 1.3582], [1.6687, 1.2934, 1.2843, 1.3841]], [[1.6175, 1.992, 1.6823, 1.0609], [1.3005, 1.5992, 1.6772, 1.6523], [1.6319, 1.4395, 1.4427, 1.1305], [1.3663, 1.175, 1.552, 1.0991]]]])
print (np.array2string(model.predict([in0Loc75083,in0Con32708,in0Bat77350],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con70224.png')

LLoc75083 = locally_connected2D_layer([[[[0.3675, 0.682], [0.9607, 0.0153]], [[0.1005, 0.7195], [0.9754, 0.7172]]]], 1, 2,[[[0.1564, 0.0119], [0.8187, 0.5169], [0.3233, 0.662], [0.1436, 0.5857]], [[0.9114, 0.9336], [0.6989, 0.4498], [0.6668, 0.2473], [0.26, 0.2333]]],[[[0, 0]], [[0, 0]]], 1, 1, Loc75083), 
LZer59493 = zero_padding2D_layer(Loc75083, 1, 0, 3, 0, Zer59493), 
LCon32708 = concatenate_layer([Zer59493,[[[[0.2584, 0.459], [0.1, 0.7494], [0.5593, 0.4986], [0.1436, 0.6148]], [[0.9898, 0.5145], [0.1773, 0.1476], [0.322, 0.5094], [0.2624, 0.3894]], [[0.3037, 0.1019], [0.1552, 0.7854], [0.4598, 0.7468], [0.8244, 0.6962]]]]], 3, Con32708), 
LBat77350 = batch_normalization_layer([[[[1.0665, 1.4355, 1.6094, 1.5548], [1.6587, 1.2818, 1.3756, 1.4818], [1.0668, 1.5914, 1.1946, 1.4143], [1.1045, 1.2227, 1.1394, 1.6908]], [[1.457, 1.1459, 1.5852, 1.1279], [1.1499, 1.8791, 1.415, 1.8842], [1.1794, 1.0548, 1.0836, 1.3582], [1.6687, 1.2934, 1.2843, 1.3841]], [[1.6175, 1.992, 1.6823, 1.0609], [1.3005, 1.5992, 1.6772, 1.6523], [1.6319, 1.4395, 1.4427, 1.1305], [1.3663, 1.175, 1.552, 1.0991]]]], 3, 0.917775404754544, [0.128, 0.3788, 0.6754, 0.9469], [0.9861, 0.1254, 0.7164, 0.1724], [0.4957, 0.062, 0.6747, 0.5805], [0.4502, 0.9259, 0.9744, 0.8512], Bat77350), 
LMul10297 = multiply_layer([Con32708,Bat77350], Mul10297), 
LRes4073 = reshape_layer(Mul10297, [3, 4, 4, 1], Res4073), 
LCon70224 = conv3D_layer(Res4073, 3, 3, 4,[[[[[0.1201, 0.5132, 0.2335, 0.5288]], [[0.8917, 0.2703, 0.5039, 0.7839]], [[0.9182, 0.4641, 0.9894, 0.1568]], [[0.3514, 0.1596, 0.7908, 0.9808]]], [[[0.9716, 0.5406, 0.6245, 0.0316]], [[0.0825, 0.6914, 0.4867, 0.5941]], [[0.5219, 0.3226, 0.9654, 0.1255]], [[0.1106, 0.2619, 0.5723, 0.5617]]], [[[0.5909, 0.4267, 0.5847, 0.2199]], [[0.8657, 0.1648, 0.5337, 0.9395]], [[0.1367, 0.3047, 0.6605, 0.573]], [[0.3653, 0.9933, 0.3711, 0.1885]]]], [[[[0.328, 0.4136, 0.9629, 0.3812]], [[0.4255, 0.7743, 0.6742, 0.8979]], [[0.3172, 0.5419, 0.4093, 0.3827]], [[0.4019, 0.7455, 0.3309, 0.4178]]], [[[0.1387, 0.3276, 0.8807, 0.1998]], [[0.2161, 0.9352, 0.6853, 0.1236]], [[0.6133, 0.2521, 0.239, 0.2688]], [[0.6702, 0.9549, 0.2131, 0.2853]]], [[[0.387, 0.6468, 0.7382, 0.4538]], [[0.3042, 0.6654, 0.028, 0.7637]], [[0.4831, 0.496, 0.269, 0.6935]], [[0.2997, 0.6257, 0.7884, 0.0062]]]], [[[[0.9955, 0.0721, 0.1304, 0.2775]], [[0.1839, 0.4858, 0.819, 0.0659]], [[0.8047, 0.688, 0.2685, 0.6004]], [[0.3381, 0.7324, 0.5136, 0.6152]]], [[[0.4423, 0.1021, 0.1732, 0.491]], [[0.5642, 0.4491, 0.3376, 0.1775]], [[0.4851, 0.3605, 0.8761, 0.4648]], [[0.2131, 0.0002, 0.9935, 0.0494]]], [[[0.1068, 0.1122, 0.7395, 0.4962]], [[0.6294, 0.7981, 0.5681, 0.636]], [[0.6664, 0.6821, 0.9782, 0.1602]], [[0.9161, 0.5657, 0.7277, 0.172]]]]],[0, 0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con70224), 
exec_layers([LLoc75083,LZer59493,LCon32708,LBat77350,LMul10297,LRes4073,LCon70224],["Loc75083","Zer59493","Con32708","Bat77350","Mul10297","Res4073","Con70224"],Con70224,"Con70224")

Actual (Unparsed): [[[[[0.6561320, 0.4649092, 1.4317630, 0.1771253], [1.5834182, 1.5281668, 2.2685331, 0.8805351], [1.6551895, 1.6424470, 1.3800360, 1.1350885], [1.1498594, 1.3443701, 1.1662243, 1.4389286]], [[1.0567138, 1.6782525, 1.5481418, 0.9292266], [2.7946117, 3.0625817, 2.2034094, 1.9414020], [2.0659057, 2.6455555, 2.4612353, 1.8879288], [2.3820619, 2.2886822, 2.3873406, 1.9508394]], [[1.7837808, 2.1203575, 1.8910299, 1.1118900], [2.3915357, 2.6457645, 3.2246854, 1.9235658], [1.8406574, 2.3350235, 2.3545359, 1.7961993], [1.4555642, 2.0833496, 2.0663085, 1.8487630]], [[1.2777686, 1.3851655, 1.3861839, 0.8626660], [2.0823881, 2.0655626, 1.6360249, 1.7074943], [1.5954973, 1.5739661, 1.5236813, 1.4642794], [1.1309748, 1.4769368, 1.7913943, 0.9390233]]], [[[1.1517303, 1.5105207, 1.1114520, 0.5707521], [2.4687685, 2.2796448, 2.4260344, 1.2929823], [1.8112978, 2.7343664, 2.8938394, 1.4851280], [1.9391319, 2.1329850, 2.7665260, 2.0692689]], [[1.6215630, 2.3960400, 1.8983895, 1.3195049], [2.9986739, 3.3047169, 4.4037803, 2.5728941], [3.6460761, 3.6434246, 4.6217354, 3.6812049], [3.1773980, 3.1829153, 3.9506258, 3.3352010]], [[3.2945167, 3.9605182, 3.4525548, 3.0619022], [4.2870938, 5.1672349, 6.8340581, 4.4606223], [3.9225013, 4.2708080, 4.7342504, 3.5830454], [3.2732100, 2.9635096, 4.0340250, 3.1614708]], [[2.4345147, 2.8765703, 3.5192012, 1.8609536], [3.5884688, 3.3852803, 4.8557156, 3.3391479], [3.0060925, 2.6456830, 3.5422712, 2.0581529], [2.1493354, 2.1384817, 2.3609095, 2.1750709]]], [[[0.5000378, 0.9603813, 0.9563751, 0.7890395], [1.2900396, 1.3624666, 2.1927823, 0.6957681], [0.9575333, 1.8169857, 1.5166406, 1.7057398], [1.7549393, 1.7106956, 1.5774727, 1.1291153]], [[0.9579541, 1.2952093, 1.6879270, 1.5030001], [2.5666920, 2.6424596, 2.8148036, 1.5924311], [2.7199036, 2.0089515, 2.2193012, 2.8186644], [1.7407554, 2.6186719, 2.4244918, 2.2160359]], [[2.4980254, 3.1065185, 2.3369777, 3.3048466], [3.8123152, 4.3191336, 4.1883058, 3.5800899], [2.3742504, 2.9523207, 2.6325252, 2.6893451], [1.9093574, 2.7866961, 2.9176436, 2.3894805]], [[1.8550101, 3.8001985, 2.8579783, 1.8811371], [3.0705498, 3.2709986, 4.1442900, 2.0010917], [2.0657964, 2.4982354, 2.7844244, 1.4018917], [1.2049243, 1.7925814, 2.4222588, 1.4321553]]]]]

Expected (Unparsed): [[[[[0.6561320576689328,0.46490923697165076,1.4317630320769372,0.17712531395635026],[1.5834182659360612,1.5281667808533446,2.2685331179457346,0.8805351286039695],[1.6551895136851071,1.6424470511881222,1.3800359979661523,1.1350885326899558],[1.14985938200108,1.3443700806893113,1.166224330864373,1.4389286207477994]],[[1.0567138141444579,1.6782525279388316,1.5481418570371177,0.9292266285341025],[2.794611701423895,3.0625817112278706,2.2034093890926134,1.94140199695487],[2.0659057258027422,2.645555535411471,2.461235313010809,1.8879288101772618],[2.3820619996466843,2.2886822114035046,2.3873406286893375,1.9508394433491596]],[[1.7837807816661126,2.1203575586349817,1.891029864307468,1.1118900109918717],[2.3915356832218744,2.6457645196985866,3.224685423652957,1.9235657887815],[1.840657452379435,2.335023563733388,2.354535968094643,1.7961992942783267],[1.45556421876344,2.0833496553166544,2.066308484015758,1.8487630868681655]],[[1.2777685954082962,1.3851655287934788,1.386183950853678,0.8626660487501868],[2.082388098107147,2.0655626942783734,1.6360249363935941,1.707494372637698],[1.5954973396567094,1.5739661323191878,1.5236813254857116,1.4642794331413558],[1.1309747825389427,1.4769368356983066,1.7913943561718553,0.9390233381033339]]],[[[1.1517303713018439,1.5105207265991694,1.1114520041050056,0.5707521419277357],[2.4687685600946283,2.2796448320529152,2.4260344815001336,1.292982291435664],[1.81129786360011,2.7343664819585944,2.893839450104621,1.485128023533421],[1.9391319473574868,2.1329850150471006,2.7665260101059275,2.069268895876557]],[[1.6215629845674022,2.3960400384528224,1.8983894734352305,1.319504931311676],[2.9986739656416628,3.304716948246735,4.4037804028636085,2.572894144159291],[3.646076146190079,3.643424692457581,4.621735497860994,3.6812049352729495],[3.177398063921396,3.182915358145977,3.9506259011378475,3.3352010045888836]],[[3.294516671185281,3.9605181906572984,3.4525547457605956,3.0619022256532697],[4.287093803490167,5.167234994817058,6.83405819460054,4.460622392442494],[3.9225013023408755,4.270807965396883,4.734250484268395,3.5830454792717235],[3.273210006975318,2.963509598202637,4.034025018055957,3.1614708330891306]],[[2.4345147376348986,2.876570292434092,3.519201228303199,1.8609535642741855],[3.5884687776763164,3.385280366252798,4.855715658420966,3.3391479615220283],[3.0060925733341106,2.6456829828487907,3.5422711947663443,2.058152892505915],[2.14933538809864,2.1384817653343675,2.360909579315334,2.175070912661474]]],[[[0.5000377892043038,0.9603813329163182,0.9563751499987327,0.789039522934842],[1.290039606949406,1.362466627033108,2.1927823128736854,0.6957680520961785],[0.9575333542422877,1.8169857364731588,1.5166406302096256,1.705739813835022],[1.7549393461382536,1.710695624308694,1.577472710152454,1.1291153286697813]],[[0.9579541605775234,1.2952093033639978,1.6879269846096117,1.5030001106454236],[2.5666920257073227,2.6424596819699255,2.8148037010787434,1.592431136479313],[2.7199036734848527,2.00895148627784,2.219301259086665,2.818664415296766],[1.7407554154225613,2.6186719405450143,2.4244918056619764,2.216035916682162]],[[2.498025456293708,3.1065185401532904,2.336977678803707,3.3048466019012683],[3.812315223323886,4.319133695782793,4.188305805555187,3.580089958654662],[2.3742503958959063,2.9523207444062045,2.6325252680057383,2.689345133963609],[1.9093573662149375,2.7866960864261885,2.917643626340159,2.389480546645872]],[[1.8550100918800905,3.8001985292056233,2.857978350725908,1.881137139320791],[3.07054984085692,3.2709985916499438,4.144290075267834,2.001091696454142],[2.065796450719783,2.498235393354721,2.784424421226232,1.4018917128971973],[1.204924264654598,1.7925814332683245,2.422258759846443,1.4321553530223476]]]]]

Actual:   [[[[[0.6562, 0.465, 1.4318, 0.1772], [1.5835, 1.5282, 2.2686, 0.8806], [1.6552, 1.6425, 1.3801, 1.1351], [1.1499, 1.3444, 1.1663, 1.439]], [[1.0568, 1.6783, 1.5482, 0.9293], [2.7947, 3.0626, 2.2035, 1.9415], [2.066, 2.6456, 2.4613, 1.888], [2.3821, 2.2887, 2.3874, 1.9509]], [[1.7838, 2.1204, 1.8911, 1.1119], [2.3916, 2.6458, 3.2247, 1.9236], [1.8407, 2.3351, 2.3546, 1.7962], [1.4556, 2.0834, 2.0664, 1.8488]], [[1.2778, 1.3852, 1.3862, 0.8627], [2.0824, 2.0656, 1.6361, 1.7075], [1.5955, 1.574, 1.5237, 1.4643], [1.131, 1.477, 1.7914, 0.9391]]], [[[1.1518, 1.5106, 1.1115, 0.5708], [2.4688, 2.2797, 2.4261, 1.293], [1.8113, 2.7344, 2.8939, 1.4852], [1.9392, 2.133, 2.7666, 2.0693]], [[1.6216, 2.3961, 1.8984, 1.3196], [2.9987, 3.3048, 4.4038, 2.5729], [3.6461, 3.6435, 4.6218, 3.6813], [3.1774, 3.183, 3.9507, 3.3353]], [[3.2946, 3.9606, 3.4526, 3.062], [4.2871, 5.1673, 6.8341, 4.4607], [3.9226, 4.2709, 4.7343, 3.5831], [3.2733, 2.9636, 4.0341, 3.1615]], [[2.4346, 2.8766, 3.5193, 1.861], [3.5885, 3.3853, 4.8558, 3.3392], [3.0061, 2.6457, 3.5423, 2.0582], [2.1494, 2.1385, 2.361, 2.1751]]], [[[0.5001, 0.9604, 0.9564, 0.7891], [1.2901, 1.3625, 2.1928, 0.6958], [0.9576, 1.817, 1.5167, 1.7058], [1.755, 1.7107, 1.5775, 1.1292]], [[0.958, 1.2953, 1.688, 1.5031], [2.5667, 2.6425, 2.8149, 1.5925], [2.72, 2.009, 2.2194, 2.8187], [1.7408, 2.6187, 2.4245, 2.2161]], [[2.4981, 3.1066, 2.337, 3.3049], [3.8124, 4.3192, 4.1884, 3.5801], [2.3743, 2.9524, 2.6326, 2.6894], [1.9094, 2.7867, 2.9177, 2.3895]], [[1.8551, 3.8002, 2.858, 1.8812], [3.0706, 3.271, 4.1443, 2.0011], [2.0658, 2.4983, 2.7845, 1.4019], [1.205, 1.7926, 2.4223, 1.4322]]]]]

Expected: [[[[[0.6562, 0.465, 1.4318, 0.1772], [1.5835, 1.5282, 2.2686, 0.8806], [1.6552, 1.6425, 1.3801, 1.1351], [1.1499, 1.3444, 1.1663, 1.439]], [[1.0568, 1.6783, 1.5482, 0.9293], [2.7947, 3.0626, 2.2035, 1.9415], [2.066, 2.6456, 2.4613, 1.888], [2.3821, 2.2887, 2.3874, 1.9509]], [[1.7838, 2.1204, 1.8911, 1.1119], [2.3916, 2.6458, 3.2247, 1.9236], [1.8407, 2.3351, 2.3546, 1.7962], [1.4556, 2.0834, 2.0664, 1.8488]], [[1.2778, 1.3852, 1.3862, 0.8627], [2.0824, 2.0656, 1.6361, 1.7075], [1.5955, 1.574, 1.5237, 1.4643], [1.131, 1.477, 1.7914, 0.9391]]], [[[1.1518, 1.5106, 1.1115, 0.5708], [2.4688, 2.2797, 2.4261, 1.293], [1.8113, 2.7344, 2.8939, 1.4852], [1.9392, 2.133, 2.7666, 2.0693]], [[1.6216, 2.3961, 1.8984, 1.3196], [2.9987, 3.3048, 4.4038, 2.5729], [3.6461, 3.6435, 4.6218, 3.6813], [3.1774, 3.183, 3.9507, 3.3353]], [[3.2946, 3.9606, 3.4526, 3.062], [4.2871, 5.1673, 6.8341, 4.4607], [3.9226, 4.2709, 4.7343, 3.5831], [3.2733, 2.9636, 4.0341, 3.1615]], [[2.4346, 2.8766, 3.5193, 1.861], [3.5885, 3.3853, 4.8558, 3.3392], [3.0061, 2.6457, 3.5423, 2.0582], [2.1494, 2.1385, 2.361, 2.1751]]], [[[0.5001, 0.9604, 0.9564, 0.7891], [1.2901, 1.3625, 2.1928, 0.6958], [0.9576, 1.817, 1.5167, 1.7058], [1.755, 1.7107, 1.5775, 1.1292]], [[0.958, 1.2953, 1.688, 1.5031], [2.5667, 2.6425, 2.8149, 1.5925], [2.72, 2.009, 2.2194, 2.8187], [1.7408, 2.6187, 2.4245, 2.2161]], [[2.4981, 3.1066, 2.337, 3.3049], [3.8124, 4.3192, 4.1884, 3.5801], [2.3743, 2.9524, 2.6326, 2.6894], [1.9094, 2.7867, 2.9177, 2.3895]], [[1.8551, 3.8002, 2.858, 1.8812], [3.0706, 3.271, 4.1443, 2.0011], [2.0658, 2.4983, 2.7845, 1.4019], [1.205, 1.7926, 2.4223, 1.4322]]]]]