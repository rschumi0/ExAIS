import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max32087 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Max32087 = tf.keras.layers.Input(shape=([1, 1, 1]))

Max32087 = keras.layers.Maximum(name = 'Max32087', )([in0Max32087,in1Max32087])
Sep60736 = keras.layers.SeparableConv2D(4, (1, 1),strides=(1, 1), padding='same', name = 'Sep60736', )(Max32087)
Res20019 = keras.layers.Reshape((1, 1, 4, 1), name = 'Res20019', )(Sep60736)
Con39354 = keras.layers.Conv3D(4, (1, 1, 2),strides=(12, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con39354', )(Res20019)
Res24959 = keras.layers.Reshape((1, 1, 16), name = 'Res24959', )(Con39354)
Res37800 = keras.layers.Reshape((1, 16), name = 'Res37800', )(Res24959)
Max63801 = keras.layers.MaxPool1D(pool_size=(1), strides=(2), padding='same', name = 'Max63801', )(Res37800)
model = tf.keras.models.Model(inputs=[in0Max32087,in1Max32087], outputs=Max63801)
w = model.get_layer('Sep60736').get_weights() 
w[0] = np.array([[[[0.2999]]]])
w[1] = np.array([[[[0.3554, 0.254, 0.6071, 0.8386]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep60736').set_weights(w) 
w = model.get_layer('Con39354').get_weights() 
w[0] = np.array([[[[[0.9064, 0.7215, 0.5766, 0.7963]], [[0.202, 0.4189, 0.2409, 0.465]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con39354').set_weights(w) 
in0Max32087 = tf.constant([[[[0.088]]]])
in1Max32087 = tf.constant([[[[0.2137]]]])
print (np.array2string(model.predict([in0Max32087,in1Max32087],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max63801.png')

LMax32087 = maximum_layer([[[[[0.088]]]], [[[[0.2137]]]]], Max32087), 
LSep60736 = separable_conv2D_layer(Max32087, 1, 1,[[[[[0.2999]]]],[[[[0.3554, 0.254, 0.6071, 0.8386]]]]],[0, 0, 0, 0], 1, 1, true, Sep60736), 
LRes20019 = reshape_layer(Sep60736, [1, 1, 4, 1], Res20019), 
LCon39354 = conv3D_layer(Res20019, 1, 1, 2,[[[[[0.9064, 0.7215, 0.5766, 0.7963]], [[0.202, 0.4189, 0.2409, 0.465]]]]],[0, 0, 0, 0], 12, 1, 1, true, 1, 1, 1, Con39354), 
LRes24959 = reshape_layer(Con39354, [1, 1, 16], Res24959), 
LRes37800 = reshape_layer(Res24959, [1, 16], Res37800), 
LMax63801 = max_pool1D_layer(Res37800, 1, 2, true, Max63801), 
exec_layers([LMax32087,LSep60736,LRes20019,LCon39354,LRes24959,LRes37800,LMax63801],["Max32087","Sep60736","Res20019","Con39354","Res24959","Res37800","Max63801"],Max63801,"Max63801")

Actual (Unparsed): [[[0.0239334, 0.0232527, 0.0170548, 0.0257069, 0.0226143, 0.0280436, 0.0187592, 0.0310549, 0.0461228, 0.0505859, 0.0353816, 0.0559739, 0.0487142, 0.0387768, 0.0309892, 0.0427969]]]

Expected (Unparsed): [[[0.0239334220540928,0.023252745687271,0.0170547688878312,0.025706912104222598,0.022614301164074,0.028043594449089698,0.0187591771627977,0.031054895503471,0.046122833546083195,0.0505859368993997,0.035381576594538,0.0559739026313599,0.0487142188469552,0.038776819172637,0.0309892085030388,0.0427969246114634]]]

Actual:   [[[0.024, 0.0233, 0.0171, 0.0258, 0.0227, 0.0281, 0.0188, 0.0311, 0.0462, 0.0506, 0.0354, 0.056, 0.0488, 0.0388, 0.031, 0.0428]]]

Expected: [[[0.024, 0.0233, 0.0171, 0.0258, 0.0227, 0.0281, 0.0188, 0.0311, 0.0462, 0.0506, 0.0354, 0.056, 0.0488, 0.0388, 0.031, 0.0428]]]