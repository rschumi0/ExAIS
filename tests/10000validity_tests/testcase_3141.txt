import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul6229 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Mul6229 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Max35443 = tf.keras.layers.Input(shape=([2, 2, 1]))

Mul6229 = keras.layers.Multiply(name = 'Mul6229', )([in0Mul6229,in1Mul6229])
Max35443 = keras.layers.MaxPool2D(pool_size=(2, 2), strides=(2, 4), padding='valid', name = 'Max35443', )(in0Max35443)
Zer87743 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer87743', )(Max35443)
Min50150 = keras.layers.Minimum(name = 'Min50150', )([Mul6229,Zer87743])
Mas12516 = keras.layers.Masking(mask_value=2, name = 'Mas12516', )(Min50150)
Res81113 = keras.layers.Reshape((1, 2), name = 'Res81113', )(Mas12516)
LST35402 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST35402', )(Res81113)
model = tf.keras.models.Model(inputs=[in0Mul6229,in1Mul6229,in0Max35443], outputs=LST35402)
w = model.get_layer('LST35402').get_weights() 
w[0] = np.array([[1, 2, 8, 6, 1, 3, 8, 9, 8, 9, 3, 8], [4, 1, 7, 1, 8, 2, 5, 8, 8, 7, 1, 3]])
w[1] = np.array([[10, 1, 3, 7, 1, 6, 8, 7, 5, 1, 1, 6], [8, 7, 2, 5, 9, 1, 6, 3, 5, 7, 1, 3], [7, 5, 2, 8, 4, 10, 2, 5, 5, 9, 7, 4]])
w[2] = np.array([7, 4, 5, 8, 8, 10, 4, 3, 5, 3, 6, 8])
model.get_layer('LST35402').set_weights(w) 
in0Mul6229 = tf.constant([[[[0.3907], [0.4622]]]])
in1Mul6229 = tf.constant([[[[0.2382], [0.7019]]]])
in0Max35443 = tf.constant([[[[1.6915], [1.0806]], [[1.9111], [1.3682]]]])
print (np.array2string(model.predict([in0Mul6229,in1Mul6229,in0Max35443],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST35402.png')

LMul6229 = multiply_layer([[[[[0.3907], [0.4622]]]], [[[[0.2382], [0.7019]]]]], Mul6229), 
LMax35443 = max_pool2D_layer([[[[1.6915], [1.0806]], [[1.9111], [1.3682]]]], 2, 2, 2, 4, false, Max35443), 
LZer87743 = zero_padding2D_layer(Max35443, 0, 0, 1, 0, Zer87743), 
LMin50150 = minimum_layer([Mul6229,Zer87743], Min50150), 
LMas12516 = masking_layer(Min50150, 2, Mas12516), 
LRes81113 = reshape_layer(Mas12516, [1, 2], Res81113), 
LLST35402 = lstm_layer(Res81113,[[1, 2, 8, 6, 1, 3, 8, 9, 8, 9, 3, 8], [4, 1, 7, 1, 8, 2, 5, 8, 8, 7, 1, 3]],[[10, 1, 3, 7, 1, 6, 8, 7, 5, 1, 1, 6], [8, 7, 2, 5, 9, 1, 6, 3, 5, 7, 1, 3], [7, 5, 2, 8, 4, 10, 2, 5, 5, 9, 7, 4]],[7, 4, 5, 8, 8, 10, 4, 3, 5, 3, 6, 8], LST35402), 
exec_layers([LMul6229,LMax35443,LZer87743,LMin50150,LMas12516,LRes81113,LLST35402],["Mul6229","Max35443","Zer87743","Min50150","Mas12516","Res81113","LST35402"],LST35402,"LST35402")

Actual (Unparsed): [[0.7575854, 0.7546869, 0.7612054]]

Expected (Unparsed): [[0.7575854446747138,0.7546869120406212,0.7612054272059331]]

Actual:   [[0.7576, 0.7547, 0.7613]]

Expected: [[0.7576, 0.7547, 0.7613]]