import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul91102 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Mul91102 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Glo1676 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Con11751 = tf.keras.layers.Input(shape=([7]))
in0Con21493 = tf.keras.layers.Input(shape=([1]))
in0Mas93869 = tf.keras.layers.Input(shape=([3, 2, 1]))
in0Con62040 = tf.keras.layers.Input(shape=([3, 1]))
in0Sub85694 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub85694 = tf.keras.layers.Input(shape=([2, 3]))
in0Glo16572 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con48766 = tf.keras.layers.Input(shape=([1]))
in0LST20911 = tf.keras.layers.Input(shape=([1, 3]))
in0Con11922 = tf.keras.layers.Input(shape=([7]))

Mul91102 = keras.layers.Multiply(name = 'Mul91102', )([in0Mul91102,in1Mul91102])
Res63088 = keras.layers.Reshape((2, 2, 2), name = 'Res63088', )(Mul91102)
Res86664 = keras.layers.Reshape((2, 4), name = 'Res86664', )(Res63088)
Fla28565 = keras.layers.Flatten(name = 'Fla28565', )(Res86664)
Glo1676 = keras.layers.GlobalAveragePooling3D(name = 'Glo1676', )(in0Glo1676)
ELU41545 = keras.layers.ELU(alpha=3.2070071817870662, name = 'ELU41545', )(Glo1676)
Con11751 = keras.layers.Concatenate(axis=1, name = 'Con11751', )([ELU41545,in0Con11751])
Mul58470 = keras.layers.Multiply(name = 'Mul58470', )([Fla28565,Con11751])
Con21493 = keras.layers.Concatenate(axis=1, name = 'Con21493', )([Mul58470,in0Con21493])
Mas93869 = keras.layers.Masking(mask_value=2, name = 'Mas93869', )(in0Mas93869)
Res27655 = keras.layers.Reshape((3, 2), name = 'Res27655', )(Mas93869)
Con62040 = keras.layers.Concatenate(axis=2, name = 'Con62040', )([Res27655,in0Con62040])
Sub85694 = keras.layers.Subtract(name = 'Sub85694', )([in0Sub85694,in1Sub85694])
Zer47549 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer47549', )(Sub85694)
Add45916 = keras.layers.Add(name = 'Add45916', )([Con62040,Zer47549])
Fla83007 = keras.layers.Flatten(name = 'Fla83007', )(Add45916)
Glo16572 = keras.layers.GlobalAveragePooling2D(name = 'Glo16572', )(in0Glo16572)
Res54378 = keras.layers.Reshape((1, 1), name = 'Res54378', )(Glo16572)
Per26215 = keras.layers.Permute((1,2), name = 'Per26215',)(Res54378)
Res90863 = keras.layers.Reshape((1, 1, 1), name = 'Res90863', )(Per26215)
Res83356 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res83356', )(Res90863)
Cro54727 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro54727', )(Res83356)
Res58715 = keras.layers.Reshape((1, 1, 1), name = 'Res58715', )(Cro54727)
Res51596 = keras.layers.Reshape((1, 1), name = 'Res51596', )(Res58715)
Fla58678 = keras.layers.Flatten(name = 'Fla58678', )(Res51596)
Con48766 = keras.layers.Concatenate(axis=1, name = 'Con48766', )([Fla58678,in0Con48766])
LST20911 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST20911', )(in0LST20911)
Add33657 = keras.layers.Add(name = 'Add33657', )([Con48766,LST20911])
Con11922 = keras.layers.Concatenate(axis=1, name = 'Con11922', )([Add33657,in0Con11922])
Max30951 = keras.layers.Maximum(name = 'Max30951', )([Fla83007,Con11922])
Sub70127 = keras.layers.Subtract(name = 'Sub70127', )([Con21493,Max30951])
model = tf.keras.models.Model(inputs=[in0Mul91102,in1Mul91102,in0Glo1676,in0Con11751,in0Con21493,in0Mas93869,in0Con62040,in0Sub85694,in1Sub85694,in0Glo16572,in0Con48766,in0LST20911,in0Con11922], outputs=Sub70127)
w = model.get_layer('LST20911').get_weights() 
w[0] = np.array([[7, 7, 2, 1, 7, 8, 1, 2], [10, 4, 5, 10, 9, 1, 7, 5], [1, 8, 1, 9, 9, 3, 7, 2]])
w[1] = np.array([[8, 10, 7, 1, 4, 9, 7, 1], [3, 8, 1, 4, 6, 7, 5, 8]])
w[2] = np.array([2, 5, 9, 10, 4, 2, 7, 7])
model.get_layer('LST20911').set_weights(w) 
in0Mul91102 = tf.constant([[[[[0.6195], [0.7223]], [[0.1859], [0.4098]]], [[[0.9795], [0.2276]], [[0.2388], [0.532]]]]])
in1Mul91102 = tf.constant([[[[[0.1997], [0.5491]], [[0.4366], [0.6543]]], [[[0.5714], [0.645]], [[0.4587], [0.6433]]]]])
in0Glo1676 = tf.constant([[[[[1.1442], [1.1694]], [[1.9392], [1.2792]]], [[[1.9336], [1.7379]], [[1.6982], [1.2831]]]]])
in0Con11751 = tf.constant([[0.3837, 0.555, 0.2759, 0.9295, 0.5569, 0.9384, 0.1663]])
in0Con21493 = tf.constant([[0.0571]])
in0Mas93869 = tf.constant([[[[1.9198], [1.6644]], [[1.3108], [1.3947]], [[1.4881], [1.8402]]]])
in0Con62040 = tf.constant([[[0.3273], [0.4721], [0.3072]]])
in0Sub85694 = tf.constant([[[0.1928, 0.2606, 0.4082], [0.7905, 0.726, 0.761]]])
in1Sub85694 = tf.constant([[[0.9271, 0.5836, 0.8083], [0.0681, 0.0594, 0.1908]]])
in0Glo16572 = tf.constant([[[[1.6172]], [[1.1607]]]])
in0Con48766 = tf.constant([[0.8828]])
in0LST20911 = tf.constant([[[9, 8, 3]]])
in0Con11922 = tf.constant([[0.0671, 0.3461, 0.1987, 0.9127, 0.4996, 0.8995, 0.5173]])
print (np.array2string(model.predict([in0Mul91102,in1Mul91102,in0Glo1676,in0Con11751,in0Con21493,in0Mas93869,in0Con62040,in0Sub85694,in1Sub85694,in0Glo16572,in0Con48766,in0LST20911,in0Con11922],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub70127.png')

LMul91102 = multiply_layer([[[[[[0.6195], [0.7223]], [[0.1859], [0.4098]]], [[[0.9795], [0.2276]], [[0.2388], [0.532]]]]], [[[[[0.1997], [0.5491]], [[0.4366], [0.6543]]], [[[0.5714], [0.645]], [[0.4587], [0.6433]]]]]], Mul91102), 
LRes63088 = reshape_layer(Mul91102, [2, 2, 2], Res63088), 
LRes86664 = reshape_layer(Res63088, [2, 4], Res86664), 
LFla28565 = flatten_layer(Res86664, Fla28565), 
LGlo1676 = global_average_pooling3D_layer([[[[[1.1442], [1.1694]], [[1.9392], [1.2792]]], [[[1.9336], [1.7379]], [[1.6982], [1.2831]]]]], Glo1676), 
LELU41545 = elu_layer(Glo1676, 3.2070071817870662, ELU41545), 
LCon11751 = concatenate_layer([ELU41545,[[0.3837, 0.555, 0.2759, 0.9295, 0.5569, 0.9384, 0.1663]]], 1, Con11751), 
LMul58470 = multiply_layer([Fla28565,Con11751], Mul58470), 
LCon21493 = concatenate_layer([Mul58470,[[0.0571]]], 1, Con21493), 
LMas93869 = masking_layer([[[[1.9198], [1.6644]], [[1.3108], [1.3947]], [[1.4881], [1.8402]]]], 2, Mas93869), 
LRes27655 = reshape_layer(Mas93869, [3, 2], Res27655), 
LCon62040 = concatenate_layer([Res27655,[[[0.3273], [0.4721], [0.3072]]]], 2, Con62040), 
LSub85694 = subtract_layer([[[0.1928, 0.2606, 0.4082], [0.7905, 0.726, 0.761]]], [[[0.9271, 0.5836, 0.8083], [0.0681, 0.0594, 0.1908]]], Sub85694), 
LZer47549 = zero_padding1D_layer(Sub85694, 1, 0, Zer47549), 
LAdd45916 = add_layer([Con62040,Zer47549], Add45916), 
LFla83007 = flatten_layer(Add45916, Fla83007), 
LGlo16572 = global_average_pooling2D_layer([[[[1.6172]], [[1.1607]]]], Glo16572), 
LRes54378 = reshape_layer(Glo16572, [1, 1], Res54378), 
LPer26215 = permute_layer(Res54378, 1,2, Per26215), 
LRes90863 = reshape_layer(Per26215, [1, 1, 1], Res90863), 
LRes83356 = reshape_layer(Res90863, [1, 1, 1, 1], Res83356), 
LCro54727 = cropping3D_layer(Res83356, 0, 0, 0, 0, 0, 0, Cro54727), 
LRes58715 = reshape_layer(Cro54727, [1, 1, 1], Res58715), 
LRes51596 = reshape_layer(Res58715, [1, 1], Res51596), 
LFla58678 = flatten_layer(Res51596, Fla58678), 
LCon48766 = concatenate_layer([Fla58678,[[0.8828]]], 1, Con48766), 
LLST20911 = lstm_layer([[[9, 8, 3]]],[[7, 7, 2, 1, 7, 8, 1, 2], [10, 4, 5, 10, 9, 1, 7, 5], [1, 8, 1, 9, 9, 3, 7, 2]],[[8, 10, 7, 1, 4, 9, 7, 1], [3, 8, 1, 4, 6, 7, 5, 8]],[2, 5, 9, 10, 4, 2, 7, 7], LST20911), 
LAdd33657 = add_layer([Con48766,LST20911], Add33657), 
LCon11922 = concatenate_layer([Add33657,[[0.0671, 0.3461, 0.1987, 0.9127, 0.4996, 0.8995, 0.5173]]], 1, Con11922), 
LMax30951 = maximum_layer([Fla83007,Con11922], Max30951), 
LSub70127 = subtract_layer(Con21493,Max30951, Sub70127), 
exec_layers([LMul91102,LRes63088,LRes86664,LFla28565,LGlo1676,LELU41545,LCon11751,LMul58470,LCon21493,LMas93869,LRes27655,LCon62040,LSub85694,LZer47549,LAdd45916,LFla83007,LGlo16572,LRes54378,LPer26215,LRes90863,LRes83356,LCro54727,LRes58715,LRes51596,LFla58678,LCon48766,LLST20911,LAdd33657,LCon11922,LMax30951,LSub70127],["Mul91102","Res63088","Res86664","Fla28565","Glo1676","ELU41545","Con11751","Mul58470","Con21493","Mas93869","Res27655","Con62040","Sub85694","Zer47549","Add45916","Fla83007","Glo16572","Res54378","Per26215","Res90863","Res83356","Cro54727","Res58715","Res51596","Fla58678","Con48766","LST20911","Add33657","Con11922","Max30951","Sub70127"],Sub70127,"Sub70127")

Actual (Unparsed): [[-1.9621151, -1.5122188, -0.2822540, -0.5025223, -0.5514717, -0.8309460, -2.1077100, -2.4498862, -0.8203000]]

Expected (Unparsed): [[-1.9621151340907648,-1.512218851359,-0.2822540133,-0.5025223425739999,-0.55147158415,-0.8309459661999999,-2.107709953696,-2.44988621972,-0.8202999999999999]]

Actual:   [[-1.9621, -1.5122, -0.2822, -0.5025, -0.5514, -0.8309, -2.1077, -2.4498, -0.8203]]

Expected: [[-1.9621, -1.5122, -0.2822, -0.5025, -0.5514, -0.8309, -2.1077, -2.4498, -0.8202]]