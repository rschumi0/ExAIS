import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0GRU92477 = tf.keras.layers.Input(shape=([3, 2]))
in0Con34281 = tf.keras.layers.Input(shape=([2, 1, 5]))
in0Sub86549 = tf.keras.layers.Input(shape=([2]))
in1Sub86549 = tf.keras.layers.Input(shape=([2]))
in0Con83199 = tf.keras.layers.Input(shape=([2, 1, 3, 1]))
in0PRe44468 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))

GRU92477 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU92477', )(in0GRU92477)
Res5017 = keras.layers.Reshape((2, 1), name = 'Res5017', )(GRU92477)
Res14261 = keras.layers.Reshape((2, 1, 1), name = 'Res14261', )(Res5017)
Glo13408 = keras.layers.GlobalMaxPool2D(name = 'Glo13408', )(Res14261)
Res71706 = keras.layers.Reshape((1, 1), name = 'Res71706', )(Glo13408)
Res95183 = keras.layers.Reshape((1, 1, 1), name = 'Res95183', )(Res71706)
Zer17656 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer17656', )(Res95183)
Con34281 = keras.layers.Concatenate(axis=3, name = 'Con34281', )([Zer17656,in0Con34281])
Sub86549 = keras.layers.Subtract(name = 'Sub86549', )([in0Sub86549,in1Sub86549])
Res16937 = keras.layers.Reshape((2, 1), name = 'Res16937', )(Sub86549)
Res5837 = keras.layers.Reshape((2, 1, 1), name = 'Res5837', )(Res16937)
Con79482 = keras.layers.Conv2D(2, (2, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con79482', )(Res5837)
Res65484 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res65484', )(Con79482)
Zer17657 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (1, 0)), name = 'Zer17657', )(Res65484)
Con83199 = keras.layers.Concatenate(axis=4, name = 'Con83199', )([Zer17657,in0Con83199])
PRe44468 = keras.layers.PReLU(name = 'PRe44468', input_shape=(2, 1, 1, 2))(in0PRe44468)
Zer70298 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer70298', )(PRe44468)
Min1799 = keras.layers.Minimum(name = 'Min1799', )([Con83199,Zer70298])
Res88089 = keras.layers.Reshape((2, 1, 6), name = 'Res88089', )(Min1799)
Ave29783 = keras.layers.AveragePooling2D(pool_size=(1, 1), name = 'Ave29783', )(Res88089)
Ave93917 = keras.layers.Average(name = 'Ave93917', )([Con34281,Ave29783])
model = tf.keras.models.Model(inputs=[in0GRU92477,in0Con34281,in0Sub86549,in1Sub86549,in0Con83199,in0PRe44468], outputs=Ave93917)
w = model.get_layer('GRU92477').get_weights() 
w[0] = np.array([[6, 10, 6, 2, 10, 7], [8, 6, 7, 10, 3, 10]])
w[1] = np.array([[4, 10, 4, 10, 9, 4], [1, 7, 8, 5, 9, 4]])
w[2] = np.array([[5, 10, 6, 4, 1, 1], [7, 4, 9, 7, 6, 3]])
model.get_layer('GRU92477').set_weights(w) 
w = model.get_layer('Con79482').get_weights() 
w[0] = np.array([[[[0.5041, 0.0234]]], [[[0.7869, 0.3877]]]])
w[1] = np.array([0, 0])
model.get_layer('Con79482').set_weights(w) 
w = model.get_layer('PRe44468').get_weights() 
w[0] = np.array([[[[0.2195, 0.2733]]], [[[0.3823, 0.9425]]]])
model.get_layer('PRe44468').set_weights(w) 
in0GRU92477 = tf.constant([[[7, 8], [10, 4], [6, 9]]])
in0Con34281 = tf.constant([[[[0.6921, 0.1344, 0.6038, 0.4652, 0.414]], [[0.2031, 0.7046, 0.6061, 0.5953, 0.266]]]])
in0Sub86549 = tf.constant([[0.0146, 0.769]])
in1Sub86549 = tf.constant([[0.1765, 0.2654]])
in0Con83199 = tf.constant([[[[[0.3934], [0.4393], [0.0626]]], [[[0.365], [0.3426], [0.7131]]]]])
in0PRe44468 = tf.constant([[[[[0.767, 0.6843]]], [[[0.3398, 0.7703]]]]])
print (np.array2string(model.predict([in0GRU92477,in0Con34281,in0Sub86549,in1Sub86549,in0Con83199,in0PRe44468],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave93917.png')

LGRU92477 = gru_layer([[[7, 8], [10, 4], [6, 9]]],[[6, 10, 6, 2, 10, 7], [8, 6, 7, 10, 3, 10]],[[4, 10, 4, 10, 9, 4], [1, 7, 8, 5, 9, 4]],[[5, 10, 6, 4, 1, 1], [7, 4, 9, 7, 6, 3]], true, GRU92477), 
LRes5017 = reshape_layer(GRU92477, [2, 1], Res5017), 
LRes14261 = reshape_layer(Res5017, [2, 1, 1], Res14261), 
LGlo13408 = global_max_pool2D_layer(Res14261, Glo13408), 
LRes71706 = reshape_layer(Glo13408, [1, 1], Res71706), 
LRes95183 = reshape_layer(Res71706, [1, 1, 1], Res95183), 
LZer17656 = zero_padding2D_layer(Res95183, 1, 0, 0, 0, Zer17656), 
LCon34281 = concatenate_layer([Zer17656,[[[[0.6921, 0.1344, 0.6038, 0.4652, 0.414]], [[0.2031, 0.7046, 0.6061, 0.5953, 0.266]]]]], 3, Con34281), 
LSub86549 = subtract_layer([[0.0146, 0.769]], [[0.1765, 0.2654]], Sub86549), 
LRes16937 = reshape_layer(Sub86549, [2, 1], Res16937), 
LRes5837 = reshape_layer(Res16937, [2, 1, 1], Res5837), 
LCon79482 = conv2D_layer(Res5837, 2, 1,[[[[0.5041, 0.0234]]], [[[0.7869, 0.3877]]]],[0, 0], 1, 1, false, 1, 1, Con79482), 
LRes65484 = reshape_layer(Con79482, [1, 1, 2, 1], Res65484), 
LZer17657 = zero_padding3D_layer(Res65484, 1, 0, 0, 0, 1, 0, Zer17657), 
LCon83199 = concatenate_layer([Zer17657,[[[[[0.3934], [0.4393], [0.0626]]], [[[0.365], [0.3426], [0.7131]]]]]], 4, Con83199), 
LPRe44468 = prelu_layer([[[[[0.767, 0.6843]]], [[[0.3398, 0.7703]]]]], [[[[0.2195, 0.2733]]], [[[0.3823, 0.9425]]]], PRe44468), 
LZer70298 = zero_padding3D_layer(PRe44468, 0, 0, 0, 0, 2, 0, Zer70298), 
LMin1799 = minimum_layer([Con83199,Zer70298], Min1799), 
LRes88089 = reshape_layer(Min1799, [2, 1, 6], Res88089), 
LAve29783 = average_pooling2D_layer(Res88089, 1, 1, Ave29783), 
LAve93917 = average_layer([Con34281,Ave29783], Ave93917), 
exec_layers([LGRU92477,LRes5017,LRes14261,LGlo13408,LRes71706,LRes95183,LZer17656,LCon34281,LSub86549,LRes16937,LRes5837,LCon79482,LRes65484,LZer17657,LCon83199,LPRe44468,LZer70298,LMin1799,LRes88089,LAve29783,LAve93917],["GRU92477","Res5017","Res14261","Glo13408","Res71706","Res95183","Zer17656","Con34281","Sub86549","Res16937","Res5837","Con79482","Res65484","Zer17657","Con83199","PRe44468","Zer70298","Min1799","Res88089","Ave29783","Ave93917"],Ave93917,"Ave93917")

Actual (Unparsed): [[[[0.0000000, 0.3460500, 0.0672000, 0.3019000, 0.2326000, 0.2383000]], [[0.0000000, 0.1015500, 0.3523000, 0.3030500, 0.3933786, 0.4895500]]]]

Expected (Unparsed): [[[[0,0.34605,0.0672,0.3019,0.2326,0.23829999999999998]],[[0.0,0.10155,0.3523,0.30305,0.39337863000000006,0.48955]]]]

Actual:   [[[[0, 0.3461, 0.0672, 0.3019, 0.2326, 0.2383]], [[0, 0.1016, 0.3523, 0.3031, 0.3934, 0.4896]]]]

Expected: [[[[0, 0.3461, 0.0672, 0.3019, 0.2326, 0.2383]], [[0, 0.1016, 0.3523, 0.3031, 0.3934, 0.4896]]]]