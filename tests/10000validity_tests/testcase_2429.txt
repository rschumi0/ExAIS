import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Cro3404 = tf.keras.layers.Input(shape=([1, 4, 2]))
in0Con12717 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Dot20027 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot20027 = tf.keras.layers.Input(shape=([2, 2]))
in0Max69979 = tf.keras.layers.Input(shape=([2, 2]))
in0Con44362 = tf.keras.layers.Input(shape=([2, 1]))
in0Sub38761 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub38761 = tf.keras.layers.Input(shape=([2, 3]))

Cro3404 = keras.layers.Cropping2D(cropping=((0, 0), (0, 3)), name = 'Cro3404', )(in0Cro3404)
Zer60849 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer60849', )(Cro3404)
Con12717 = keras.layers.Concatenate(axis=3, name = 'Con12717', )([Zer60849,in0Con12717])
Dot20027 = keras.layers.Dot(axes=(2, 1), name = 'Dot20027', )([in0Dot20027,in1Dot20027])
Res54662 = keras.layers.Reshape((2, 2, 1), name = 'Res54662', )(Dot20027)
Con5428 = keras.layers.Conv2D(3, (2, 2),strides=(1, 8), padding='same', dilation_rate=(1, 1), name = 'Con5428', )(Res54662)
Sub62610 = keras.layers.Subtract(name = 'Sub62610', )([Con12717,Con5428])
Res68247 = keras.layers.Reshape((2, 3), name = 'Res68247', )(Sub62610)
Max69979 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max69979', )(in0Max69979)
Con44362 = keras.layers.Concatenate(axis=2, name = 'Con44362', )([Max69979,in0Con44362])
Sub38761 = keras.layers.Subtract(name = 'Sub38761', )([in0Sub38761,in1Sub38761])
Sub44069 = keras.layers.Subtract(name = 'Sub44069', )([Con44362,Sub38761])
Sub69491 = keras.layers.Subtract(name = 'Sub69491', )([Res68247,Sub44069])
model = tf.keras.models.Model(inputs=[in0Cro3404,in0Con12717,in0Dot20027,in1Dot20027,in0Max69979,in0Con44362,in0Sub38761,in1Sub38761], outputs=Sub69491)
w = model.get_layer('Con5428').get_weights() 
w[0] = np.array([[[[0.9528, 0.3743, 0.6566]], [[0.0341, 0.8237, 0.2505]]], [[[0.9053, 0.289, 0.3051]], [[0.4747, 0.9479, 0.9253]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con5428').set_weights(w) 
in0Cro3404 = tf.constant([[[[1.4876, 1.8736], [1.752, 1.5546], [1.4552, 1.4379], [1.8862, 1.1823]]]])
in0Con12717 = tf.constant([[[[0.3563]], [[0.914]]]])
in0Dot20027 = tf.constant([[[0.9403, 0.3817], [0.8925, 0.66]]])
in1Dot20027 = tf.constant([[[0.459, 0.2558], [0.2898, 0.6002]]])
in0Max69979 = tf.constant([[[1.1441, 1.697], [1.6676, 1.057]]])
in0Con44362 = tf.constant([[[0.4161], [0.1611]]])
in0Sub38761 = tf.constant([[[0.3175, 0.5184, 0.6853], [0.8487, 0.428, 0.5983]]])
in1Sub38761 = tf.constant([[[0.6396, 0.144, 0.7306], [0.2793, 0.424, 0.4923]]])
print (np.array2string(model.predict([in0Cro3404,in0Con12717,in0Dot20027,in1Dot20027,in0Max69979,in0Con44362,in0Sub38761,in1Sub38761],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub69491.png')

LCro3404 = cropping2D_layer([[[[1.4876, 1.8736], [1.752, 1.5546], [1.4552, 1.4379], [1.8862, 1.1823]]]], 0, 0, 0, 3, Cro3404), 
LZer60849 = zero_padding2D_layer(Cro3404, 1, 0, 0, 0, Zer60849), 
LCon12717 = concatenate_layer([Zer60849,[[[[0.3563]], [[0.914]]]]], 3, Con12717), 
LDot20027 = dot_layer([[[0.9403, 0.3817], [0.8925, 0.66]]], [[[0.459, 0.2558], [0.2898, 0.6002]]], 2, 1, Dot20027), 
LRes54662 = reshape_layer(Dot20027, [2, 2, 1], Res54662), 
LCon5428 = conv2D_layer(Res54662, 2, 2,[[[[0.9528, 0.3743, 0.6566]], [[0.0341, 0.8237, 0.2505]]], [[[0.9053, 0.289, 0.3051]], [[0.4747, 0.9479, 0.9253]]]],[0, 0, 0], 1, 8, true, 1, 1, Con5428), 
LSub62610 = subtract_layer(Con12717,Con5428, Sub62610), 
LRes68247 = reshape_layer(Sub62610, [2, 3], Res68247), 
LMax69979 = max_pool1D_layer([[[1.1441, 1.697], [1.6676, 1.057]]], 1, Max69979), 
LCon44362 = concatenate_layer([Max69979,[[[0.4161], [0.1611]]]], 2, Con44362), 
LSub38761 = subtract_layer([[[0.3175, 0.5184, 0.6853], [0.8487, 0.428, 0.5983]]], [[[0.6396, 0.144, 0.7306], [0.2793, 0.424, 0.4923]]], Sub38761), 
LSub44069 = subtract_layer(Con44362,Sub38761, Sub44069), 
LSub69491 = subtract_layer(Res68247,Sub44069, Sub69491), 
exec_layers([LCro3404,LZer60849,LCon12717,LDot20027,LRes54662,LCon5428,LSub62610,LRes68247,LMax69979,LCon44362,LSub38761,LSub44069,LSub69491],["Cro3404","Zer60849","Con12717","Dot20027","Res54662","Con5428","Sub62610","Res68247","Max69979","Con44362","Sub38761","Sub44069","Sub69491"],Sub69491,"Sub69491")

Actual (Unparsed): [[[-2.8392724, -2.6779490, -1.3398897], [-0.2044551, 0.0813277, 0.3079117]]]

Expected (Unparsed): [[[-2.8392724950359995,-2.677948997494,-1.3398897189159997],[-0.20445499874999984,0.08132771139999995,0.3079117249500002]]]

Actual:   [[[-2.8392, -2.6779, -1.3398], [-0.2044, 0.0814, 0.308]]]

Expected: [[[-2.8392, -2.6779, -1.3398], [-0.2044, 0.0814, 0.308]]]