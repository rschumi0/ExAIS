import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0ReL9154 = tf.keras.layers.Input(shape=([2, 2]))
in0Con35197 = tf.keras.layers.Input(shape=([2]))
in0Add10870 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Add10870 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con20850 = tf.keras.layers.Input(shape=([2, 1]))
in0Add21481 = tf.keras.layers.Input(shape=([1, 2]))
in1Add21481 = tf.keras.layers.Input(shape=([1, 2]))

ReL9154 = keras.layers.ReLU(max_value=2.7231520354346213, negative_slope=3.1856055466218436, threshold=6.82647821996982, name = 'ReL9154', input_shape=(2, 2))(in0ReL9154)
Res35557 = keras.layers.Reshape((2, 2, 1), name = 'Res35557', )(ReL9154)
Glo13275 = keras.layers.GlobalAveragePooling2D(name = 'Glo13275', )(Res35557)
Con35197 = keras.layers.Concatenate(axis=1, name = 'Con35197', )([Glo13275,in0Con35197])
Add10870 = keras.layers.Add(name = 'Add10870', )([in0Add10870,in1Add10870])
Res43498 = keras.layers.Reshape((2, 2), name = 'Res43498', )(Add10870)
LST74601 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST74601', )(Res43498)
Res85828 = keras.layers.Reshape((2, 1), name = 'Res85828', )(LST74601)
Con20850 = keras.layers.Concatenate(axis=2, name = 'Con20850', )([Res85828,in0Con20850])
Add21481 = keras.layers.Add(name = 'Add21481', )([in0Add21481,in1Add21481])
Zer17267 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer17267', )(Add21481)
Max85897 = keras.layers.Maximum(name = 'Max85897', )([Con20850,Zer17267])
GRU5393 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU5393', )(Max85897)
Ave61327 = keras.layers.Average(name = 'Ave61327', )([Con35197,GRU5393])
model = tf.keras.models.Model(inputs=[in0ReL9154,in0Con35197,in0Add10870,in1Add10870,in0Con20850,in0Add21481,in1Add21481], outputs=Ave61327)
w = model.get_layer('LST74601').get_weights() 
w[0] = np.array([[5, 2, 5, 6, 10, 3, 6, 1], [6, 7, 7, 6, 9, 4, 3, 1]])
w[1] = np.array([[4, 4, 1, 1, 1, 10, 5, 6], [3, 7, 5, 1, 9, 6, 1, 10]])
w[2] = np.array([8, 2, 4, 9, 9, 9, 4, 9])
model.get_layer('LST74601').set_weights(w) 
w = model.get_layer('GRU5393').get_weights() 
w[0] = np.array([[7, 10, 8, 7, 8, 4, 8, 8, 7], [8, 3, 7, 1, 5, 2, 8, 9, 2]])
w[1] = np.array([[10, 6, 10, 5, 8, 8, 7, 2, 1], [10, 2, 9, 3, 3, 3, 6, 9, 10], [2, 6, 1, 5, 1, 10, 5, 7, 8]])
w[2] = np.array([1, 2, 6, 10, 6, 3, 8, 7, 2])
model.get_layer('GRU5393').set_weights(w) 
in0ReL9154 = tf.constant([[[0.8567, 0.9617], [0.4246, 0.9828]]])
in0Con35197 = tf.constant([[0.3462, 0.2056]])
in0Add10870 = tf.constant([[[[0.3471, 0.9504]], [[0.0741, 0.9423]]]])
in1Add10870 = tf.constant([[[[0.2914, 0.2379]], [[0.0659, 0.0696]]]])
in0Con20850 = tf.constant([[[0.9329], [0.5527]]])
in0Add21481 = tf.constant([[[0.3102, 0.3484]]])
in1Add21481 = tf.constant([[[0.2785, 0.994]]])
print (np.array2string(model.predict([in0ReL9154,in0Con35197,in0Add10870,in1Add10870,in0Con20850,in0Add21481,in1Add21481],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave61327.png')

LReL9154 = relu_layer([[[0.8567, 0.9617], [0.4246, 0.9828]]], 2.7231520354346213, 3.1856055466218436, 6.82647821996982, ReL9154), 
LRes35557 = reshape_layer(ReL9154, [2, 2, 1], Res35557), 
LGlo13275 = global_average_pooling2D_layer(Res35557, Glo13275), 
LCon35197 = concatenate_layer([Glo13275,[[0.3462, 0.2056]]], 1, Con35197), 
LAdd10870 = add_layer([[[[[0.3471, 0.9504]], [[0.0741, 0.9423]]]], [[[[0.2914, 0.2379]], [[0.0659, 0.0696]]]]], Add10870), 
LRes43498 = reshape_layer(Add10870, [2, 2], Res43498), 
LLST74601 = lstm_layer(Res43498,[[5, 2, 5, 6, 10, 3, 6, 1], [6, 7, 7, 6, 9, 4, 3, 1]],[[4, 4, 1, 1, 1, 10, 5, 6], [3, 7, 5, 1, 9, 6, 1, 10]],[8, 2, 4, 9, 9, 9, 4, 9], LST74601), 
LRes85828 = reshape_layer(LST74601, [2, 1], Res85828), 
LCon20850 = concatenate_layer([Res85828,[[[0.9329], [0.5527]]]], 2, Con20850), 
LAdd21481 = add_layer([[[[0.3102, 0.3484]]], [[[0.2785, 0.994]]]], Add21481), 
LZer17267 = zero_padding1D_layer(Add21481, 1, 0, Zer17267), 
LMax85897 = maximum_layer([Con20850,Zer17267], Max85897), 
LGRU5393 = gru_layer(Max85897,[[7, 10, 8, 7, 8, 4, 8, 8, 7], [8, 3, 7, 1, 5, 2, 8, 9, 2]],[[10, 6, 10, 5, 8, 8, 7, 2, 1], [10, 2, 9, 3, 3, 3, 6, 9, 10], [2, 6, 1, 5, 1, 10, 5, 7, 8]],[1, 2, 6, 10, 6, 3, 8, 7, 2], false, GRU5393), 
LAve61327 = average_layer([Con35197,GRU5393], Ave61327), 
exec_layers([LReL9154,LRes35557,LGlo13275,LCon35197,LAdd10870,LRes43498,LLST74601,LRes85828,LCon20850,LAdd21481,LZer17267,LMax85897,LGRU5393,LAve61327],["ReL9154","Res35557","Glo13275","Con35197","Add10870","Res43498","LST74601","Res85828","Con20850","Add21481","Zer17267","Max85897","GRU5393","Ave61327"],Ave61327,"Ave61327")

Actual (Unparsed): [[-9.5887175, 0.1731003, 0.1028000]]

Expected (Unparsed): [[-9.588717515690162,0.17310034651631148,0.10280000085467378]]

Actual:   [[-9.5887, 0.1732, 0.1028]]

Expected: [[-9.5887, 0.1732, 0.1029]]