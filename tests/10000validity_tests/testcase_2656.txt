import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Per47180 = tf.keras.layers.Input(shape=([2, 4]))
in0Sub44284 = tf.keras.layers.Input(shape=([3, 3]))
in1Sub44284 = tf.keras.layers.Input(shape=([3, 3]))
in0Con997 = tf.keras.layers.Input(shape=([3, 1]))

Per47180 = keras.layers.Permute((1,2), name = 'Per47180',)(in0Per47180)
Con3375 = keras.layers.Conv1D(4, (1),strides=(7), padding='same', dilation_rate=(1), name = 'Con3375', )(Per47180)
Zer93490 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer93490', )(Con3375)
Sub44284 = keras.layers.Subtract(name = 'Sub44284', )([in0Sub44284,in1Sub44284])
Con997 = keras.layers.Concatenate(axis=2, name = 'Con997', )([Sub44284,in0Con997])
Max9036 = keras.layers.Maximum(name = 'Max9036', )([Zer93490,Con997])
model = tf.keras.models.Model(inputs=[in0Per47180,in0Sub44284,in1Sub44284,in0Con997], outputs=Max9036)
w = model.get_layer('Con3375').get_weights() 
w[0] = np.array([[[0.5752, 0.9679, 0.0898, 0.7443], [0.0745, 0.8966, 0.4235, 0.217], [0.3102, 0.7087, 0.3188, 0.9399], [0.6681, 0.3064, 0.2567, 0.3629]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con3375').set_weights(w) 
in0Per47180 = tf.constant([[[1.4562, 1.0827, 1.8282, 1.6159], [1.164, 1.5903, 1.4168, 1.5622]]])
in0Sub44284 = tf.constant([[[0.055, 0.704, 0.0804], [0.629, 0.7493, 0.8234], [0.3171, 0.7849, 0.9543]]])
in1Sub44284 = tf.constant([[[0.9071, 0.2985, 0.7791], [0.5794, 0.5094, 0.4966], [0.0522, 0.7481, 0.2075]]])
in0Con997 = tf.constant([[[0.3311], [0.0492], [0.7029]]])
print (np.array2string(model.predict([in0Per47180,in0Sub44284,in1Sub44284,in0Con997],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max9036.png')

LPer47180 = permute_layer([[[1.4562, 1.0827, 1.8282, 1.6159], [1.164, 1.5903, 1.4168, 1.5622]]], 1,2, Per47180), 
LCon3375 = conv1D_layer(Per47180, 1,[[[0.5752, 0.9679, 0.0898, 0.7443], [0.0745, 0.8966, 0.4235, 0.217], [0.3102, 0.7087, 0.3188, 0.9399], [0.6681, 0.3064, 0.2567, 0.3629]]],[0, 0, 0, 0], 7, true, 1, Con3375), 
LZer93490 = zero_padding1D_layer(Con3375, 2, 0, Zer93490), 
LSub44284 = subtract_layer([[[0.055, 0.704, 0.0804], [0.629, 0.7493, 0.8234], [0.3171, 0.7849, 0.9543]]], [[[0.9071, 0.2985, 0.7791], [0.5794, 0.5094, 0.4966], [0.0522, 0.7481, 0.2075]]], Sub44284), 
LCon997 = concatenate_layer([Sub44284,[[[0.3311], [0.0492], [0.7029]]]], 2, Con997), 
LMax9036 = maximum_layer([Zer93490,Con997], Max9036), 
exec_layers([LPer47180,LCon3375,LZer93490,LSub44284,LCon997,LMax9036],["Per47180","Con3375","Zer93490","Sub44284","Con997","Max9036"],Max9036,"Max9036")

Actual (Unparsed): [[[0.0000000, 0.4055000, 0.0000000, 0.3311000], [0.0496000, 0.2399000, 0.3268000, 0.0492000], [2.5649578, 4.1709619, 1.5869219, 3.6235309]]]

Expected (Unparsed): [[[0,0.40549999999999997,0,0.3311],[0.04959999999999998,0.2399,0.32680000000000003,0.0492],[2.56495782,4.1709619,1.5869218999999999,3.62353085]]]

Actual:   [[[0, 0.4055, 0, 0.3311], [0.0496, 0.2399, 0.3268, 0.0492], [2.565, 4.171, 1.587, 3.6236]]]

Expected: [[[0, 0.4055, 0, 0.3311], [0.0496, 0.2399, 0.3269, 0.0492], [2.565, 4.171, 1.587, 3.6236]]]