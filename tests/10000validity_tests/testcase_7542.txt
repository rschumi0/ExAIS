import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max23917 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Max23917 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Add45155 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Add45155 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))

Max23917 = keras.layers.Maximum(name = 'Max23917', )([in0Max23917,in1Max23917])
Res72761 = keras.layers.Reshape((1, 2), name = 'Res72761', )(Max23917)
LST96021 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST96021', )(Res72761)
Res82680 = keras.layers.Reshape((1, 1), name = 'Res82680', )(LST96021)
Add45155 = keras.layers.Add(name = 'Add45155', )([in0Add45155,in1Add45155])
Res84049 = keras.layers.Reshape((2, 2, 1), name = 'Res84049', )(Add45155)
Res48779 = keras.layers.Reshape((2, 2), name = 'Res48779', )(Res84049)
Cro56465 = keras.layers.Cropping1D(cropping=((1, 0)), name = 'Cro56465', )(Res48779)
Dot86030 = keras.layers.Dot(axes=(1, 1), name = 'Dot86030', )([Res82680,Cro56465])
model = tf.keras.models.Model(inputs=[in0Max23917,in1Max23917,in0Add45155,in1Add45155], outputs=Dot86030)
w = model.get_layer('LST96021').get_weights() 
w[0] = np.array([[5, 1, 8, 4], [9, 10, 10, 4]])
w[1] = np.array([[7, 10, 8, 6]])
w[2] = np.array([4, 8, 10, 2])
model.get_layer('LST96021').set_weights(w) 
in0Max23917 = tf.constant([[[[0.0427], [0.955]]]])
in1Max23917 = tf.constant([[[[0.5425], [0.6279]]]])
in0Add45155 = tf.constant([[[[[0.6279]], [[0.8063]]], [[[0.1144]], [[0.6188]]]]])
in1Add45155 = tf.constant([[[[[0.2949]], [[0.9058]]], [[[0.1161]], [[0.3955]]]]])
print (np.array2string(model.predict([in0Max23917,in1Max23917,in0Add45155,in1Add45155],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot86030.png')

LMax23917 = maximum_layer([[[[[0.0427], [0.955]]]], [[[[0.5425], [0.6279]]]]], Max23917), 
LRes72761 = reshape_layer(Max23917, [1, 2], Res72761), 
LLST96021 = lstm_layer(Res72761,[[5, 1, 8, 4], [9, 10, 10, 4]],[[7, 10, 8, 6]],[4, 8, 10, 2], LST96021), 
LRes82680 = reshape_layer(LST96021, [1, 1], Res82680), 
LAdd45155 = add_layer([[[[[[0.6279]], [[0.8063]]], [[[0.1144]], [[0.6188]]]]], [[[[[0.2949]], [[0.9058]]], [[[0.1161]], [[0.3955]]]]]], Add45155), 
LRes84049 = reshape_layer(Add45155, [2, 2, 1], Res84049), 
LRes48779 = reshape_layer(Res84049, [2, 2], Res48779), 
LCro56465 = cropping1D_layer(Res48779, 1, 0, Cro56465), 
LDot86030 = dot_layer(Res82680,Cro56465, 1, 1, Dot86030), 
exec_layers([LMax23917,LRes72761,LLST96021,LRes82680,LAdd45155,LRes84049,LRes48779,LCro56465,LDot86030],["Max23917","Res72761","LST96021","Res82680","Add45155","Res84049","Res48779","Cro56465","Dot86030"],Dot86030,"Dot86030")

Actual (Unparsed): [[[0.1754880, 0.7722232]]]

Expected (Unparsed): [[[0.1754879698687598,0.7722232010320307]]]

Actual:   [[[0.1755, 0.7723]]]

Expected: [[[0.1755, 0.7723]]]