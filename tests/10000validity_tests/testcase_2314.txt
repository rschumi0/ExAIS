import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot7132 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot7132 = tf.keras.layers.Input(shape=([3, 3]))
in0Con25530 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Min45393 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Min45393 = tf.keras.layers.Input(shape=([1, 2, 2]))

Dot7132 = keras.layers.Dot(axes=(1, 2), name = 'Dot7132', )([in0Dot7132,in1Dot7132])
Res54052 = keras.layers.Reshape((3, 3, 1), name = 'Res54052', )(Dot7132)
Glo16034 = keras.layers.GlobalAveragePooling2D(name = 'Glo16034', )(Res54052)
Res3986 = keras.layers.Reshape((1, 1), name = 'Res3986', )(Glo16034)
Res4326 = keras.layers.Reshape((1, 1, 1), name = 'Res4326', )(Res3986)
Zer64019 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer64019', )(Res4326)
Con25530 = keras.layers.Concatenate(axis=3, name = 'Con25530', )([Zer64019,in0Con25530])
Min45393 = keras.layers.Minimum(name = 'Min45393', )([in0Min45393,in1Min45393])
Sub60440 = keras.layers.Subtract(name = 'Sub60440', )([Con25530,Min45393])
model = tf.keras.models.Model(inputs=[in0Dot7132,in1Dot7132,in0Con25530,in0Min45393,in1Min45393], outputs=Sub60440)
in0Dot7132 = tf.constant([[[0.5721, 0.7861, 0.8087], [0.535, 0.4242, 0.7686], [0.5812, 0.9454, 0.8201]]])
in1Dot7132 = tf.constant([[[0.0875, 0.0037, 0.0221], [0.7291, 0.3641, 0.0176], [0.8407, 0.2903, 0.8385]]])
in0Con25530 = tf.constant([[[[0.1083], [0.4307]]]])
in0Min45393 = tf.constant([[[[0.7071, 0.6286], [0.0405, 0.579]]]])
in1Min45393 = tf.constant([[[[0.2688, 0.8402], [0.6772, 0.4633]]]])
print (np.array2string(model.predict([in0Dot7132,in1Dot7132,in0Con25530,in0Min45393,in1Min45393],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub60440.png')

LDot7132 = dot_layer([[[0.5721, 0.7861, 0.8087], [0.535, 0.4242, 0.7686], [0.5812, 0.9454, 0.8201]]], [[[0.0875, 0.0037, 0.0221], [0.7291, 0.3641, 0.0176], [0.8407, 0.2903, 0.8385]]], 1, 2, Dot7132), 
LRes54052 = reshape_layer(Dot7132, [3, 3, 1], Res54052), 
LGlo16034 = global_average_pooling2D_layer(Res54052, Glo16034), 
LRes3986 = reshape_layer(Glo16034, [1, 1], Res3986), 
LRes4326 = reshape_layer(Res3986, [1, 1, 1], Res4326), 
LZer64019 = zero_padding2D_layer(Res4326, 0, 0, 1, 0, Zer64019), 
LCon25530 = concatenate_layer([Zer64019,[[[[0.1083], [0.4307]]]]], 3, Con25530), 
LMin45393 = minimum_layer([[[[[0.7071, 0.6286], [0.0405, 0.579]]]], [[[[0.2688, 0.8402], [0.6772, 0.4633]]]]], Min45393), 
LSub60440 = subtract_layer(Con25530,Min45393, Sub60440), 
exec_layers([LDot7132,LRes54052,LGlo16034,LRes3986,LRes4326,LZer64019,LCon25530,LMin45393,LSub60440],["Dot7132","Res54052","Glo16034","Res3986","Res4326","Zer64019","Con25530","Min45393","Sub60440"],Sub60440,"Sub60440")

Actual (Unparsed): [[[[-0.2688000, -0.5203000], [0.7138489, -0.0326000]]]]

Expected (Unparsed): [[[[-0.2688,-0.5203000000000001],[0.7138489433333334,-0.03259999999999996]]]]

Actual:   [[[[-0.2688, -0.5203], [0.7139, -0.0326]]]]

Expected: [[[[-0.2688, -0.5203], [0.7139, -0.0325]]]]