import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Cro38325 = tf.keras.layers.Input(shape=([1, 1]))
in0Con9343 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con52803 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con21307 = tf.keras.layers.Input(shape=([3, 2]))
in0Sub92649 = tf.keras.layers.Input(shape=([3, 3]))
in1Sub92649 = tf.keras.layers.Input(shape=([3, 3]))

Cro38325 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro38325', )(in0Cro38325)
Res46392 = keras.layers.Reshape((1, 1, 1), name = 'Res46392', )(Cro38325)
Con9343 = keras.layers.Concatenate(axis=3, name = 'Con9343', )([Res46392,in0Con9343])
Con52803 = keras.layers.Conv2D(3, (1, 1),strides=(1, 2), padding='valid', dilation_rate=(1, 1), name = 'Con52803', )(in0Con52803)
Add26354 = keras.layers.Add(name = 'Add26354', )([Con9343,Con52803])
Res12928 = keras.layers.Reshape((1, 3), name = 'Res12928', )(Add26354)
Sim4541 = keras.layers.SimpleRNN(1,name = 'Sim4541', )(Res12928)
ELU71152 = keras.layers.ELU(alpha=-6.39249997146673, name = 'ELU71152', )(Sim4541)
Res79395 = keras.layers.Reshape((1, 1), name = 'Res79395', )(ELU71152)
Zer56677 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer56677', )(Res79395)
Con21307 = keras.layers.Concatenate(axis=2, name = 'Con21307', )([Zer56677,in0Con21307])
Sub92649 = keras.layers.Subtract(name = 'Sub92649', )([in0Sub92649,in1Sub92649])
Dot16360 = keras.layers.Dot(axes=(2, 1), name = 'Dot16360', )([Con21307,Sub92649])
model = tf.keras.models.Model(inputs=[in0Cro38325,in0Con9343,in0Con52803,in0Con21307,in0Sub92649,in1Sub92649], outputs=Dot16360)
w = model.get_layer('Con52803').get_weights() 
w[0] = np.array([[[[0.4186, 0.5278, 0.52], [0.4582, 0.8587, 0.1038]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con52803').set_weights(w) 
w = model.get_layer('Sim4541').get_weights() 
w[0] = np.array([[4], [8], [9]])
w[1] = np.array([[1]])
w[2] = np.array([5])
model.get_layer('Sim4541').set_weights(w) 
in0Cro38325 = tf.constant([[[1.263]]])
in0Con9343 = tf.constant([[[[0.1156, 0.0457]]]])
in0Con52803 = tf.constant([[[[0.1824, 0.3907], [0.0115, 0.6294]]]])
in0Con21307 = tf.constant([[[0.859, 0.8487], [0.9438, 0.6124], [0.7185, 0.3727]]])
in0Sub92649 = tf.constant([[[0.1061, 0.7887, 0.4684], [0.6611, 0.455, 0.7767], [0.0912, 0.824, 0.1853]]])
in1Sub92649 = tf.constant([[[0.3629, 0.8678, 0.63], [0.9692, 0.8115, 0.5247], [0.3349, 0.4187, 0.8767]]])
print (np.array2string(model.predict([in0Cro38325,in0Con9343,in0Con52803,in0Con21307,in0Sub92649,in1Sub92649],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot16360.png')

LCro38325 = cropping1D_layer([[[1.263]]], 0, 0, Cro38325), 
LRes46392 = reshape_layer(Cro38325, [1, 1, 1], Res46392), 
LCon9343 = concatenate_layer([Res46392,[[[[0.1156, 0.0457]]]]], 3, Con9343), 
LCon52803 = conv2D_layer([[[[0.1824, 0.3907], [0.0115, 0.6294]]]], 1, 1,[[[[0.4186, 0.5278, 0.52], [0.4582, 0.8587, 0.1038]]]],[0, 0, 0], 1, 2, false, 1, 1, Con52803), 
LAdd26354 = add_layer([Con9343,Con52803], Add26354), 
LRes12928 = reshape_layer(Add26354, [1, 3], Res12928), 
LSim4541 = simple_rnn_layer(Res12928,[[4], [8], [9]],[[1]],[5], Sim4541), 
LELU71152 = elu_layer(Sim4541, -6.39249997146673, ELU71152), 
LRes79395 = reshape_layer(ELU71152, [1, 1], Res79395), 
LZer56677 = zero_padding1D_layer(Res79395, 2, 0, Zer56677), 
LCon21307 = concatenate_layer([Zer56677,[[[0.859, 0.8487], [0.9438, 0.6124], [0.7185, 0.3727]]]], 2, Con21307), 
LSub92649 = subtract_layer([[[0.1061, 0.7887, 0.4684], [0.6611, 0.455, 0.7767], [0.0912, 0.824, 0.1853]]], [[[0.3629, 0.8678, 0.63], [0.9692, 0.8115, 0.5247], [0.3349, 0.4187, 0.8767]]], Sub92649), 
LDot16360 = dot_layer(Con21307,Sub92649, 2, 1, Dot16360), 
exec_layers([LCro38325,LRes46392,LCon9343,LCon52803,LAdd26354,LRes12928,LSim4541,LELU71152,LRes79395,LZer56677,LCon21307,LSub92649,LDot16360],["Cro38325","Res46392","Con9343","Con52803","Add26354","Res12928","Sim4541","ELU71152","Res79395","Zer56677","Con21307","Sub92649","Dot16360"],Dot16360,"Dot16360")

Actual (Unparsed): [[[-0.4714861, 0.0377446, -0.3703231], [-0.4400267, -0.0882590, -0.1855757], [-0.5689969, -0.1841900, -0.2382227]]]

Expected (Unparsed): [[[-0.4714860899999999,0.037744609999999956,-0.3703231800000001],[-0.4400266599999999,-0.08825897999999996,-0.18557576000000017],[-0.5689968399999992,-0.18418993999999986,-0.23822277999999963]]]

Actual:   [[[-0.4714, 0.0378, -0.3703], [-0.44, -0.0882, -0.1855], [-0.5689, -0.1841, -0.2382]]]

Expected: [[[-0.4714, 0.0378, -0.3703], [-0.44, -0.0882, -0.1855], [-0.5689, -0.1841, -0.2382]]]