import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sof1630 = tf.keras.layers.Input(shape=([1, 2]))
in0Con81225 = tf.keras.layers.Input(shape=([6]))
in0Lay15057 = tf.keras.layers.Input(shape=([4, 2]))
in0Dot58734 = tf.keras.layers.Input(shape=([2]))
in1Dot58734 = tf.keras.layers.Input(shape=([2]))
in0Con50446 = tf.keras.layers.Input(shape=([7]))

Sof1630 = keras.layers.Softmax(axis=1, name = 'Sof1630', input_shape=(1, 2))(in0Sof1630)
Res41671 = keras.layers.Reshape((1, 2, 1), name = 'Res41671', )(Sof1630)
PRe33910 = keras.layers.PReLU(name = 'PRe33910', )(Res41671)
Res16978 = keras.layers.Reshape((1, 2), name = 'Res16978', )(PRe33910)
Max37637 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='valid', name = 'Max37637', )(Res16978)
Fla65524 = keras.layers.Flatten(name = 'Fla65524', )(Max37637)
Con81225 = keras.layers.Concatenate(axis=1, name = 'Con81225', )([Fla65524,in0Con81225])
Lay15057 = keras.layers.LayerNormalization(axis=1, epsilon=2.277674805864598, name = 'Lay15057', )(in0Lay15057)
Fla34413 = keras.layers.Flatten(name = 'Fla34413', )(Lay15057)
Dot58734 = keras.layers.Dot(axes=(1, 1), name = 'Dot58734', )([in0Dot58734,in1Dot58734])
Con50446 = keras.layers.Concatenate(axis=1, name = 'Con50446', )([Dot58734,in0Con50446])
Ave78987 = keras.layers.Average(name = 'Ave78987', )([Fla34413,Con50446])
Max31718 = keras.layers.Maximum(name = 'Max31718', )([Con81225,Ave78987])
model = tf.keras.models.Model(inputs=[in0Sof1630,in0Con81225,in0Lay15057,in0Dot58734,in1Dot58734,in0Con50446], outputs=Max31718)
w = model.get_layer('PRe33910').get_weights() 
w[0] = np.array([[[0.1509], [0.8944]]])
model.get_layer('PRe33910').set_weights(w) 
in0Sof1630 = tf.constant([[[0.905, 0.2037]]])
in0Con81225 = tf.constant([[0.5906, 0.4319, 0.1352, 0.1706, 0.779, 0.8415]])
in0Lay15057 = tf.constant([[[1.5235, 1.2798], [1.17, 1.0411], [1.4614, 1.0267], [1.7272, 1.09]]])
in0Dot58734 = tf.constant([[0.1926, 0.8137]])
in1Dot58734 = tf.constant([[0.6458, 0.7699]])
in0Con50446 = tf.constant([[0.4304, 0.0114, 0.1783, 0.6371, 0.1666, 0.2527, 0.8054]])
print (np.array2string(model.predict([in0Sof1630,in0Con81225,in0Lay15057,in0Dot58734,in1Dot58734,in0Con50446],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max31718.png')

LSof1630 = softmax_layer([[[0.905, 0.2037]]], 1, Sof1630), 
LRes41671 = reshape_layer(Sof1630, [1, 2, 1], Res41671), 
LPRe33910 = prelu_layer(Res41671, [[[0.1509], [0.8944]]], PRe33910), 
LRes16978 = reshape_layer(PRe33910, [1, 2], Res16978), 
LMax37637 = max_pool1D_layer(Res16978, 1, 1, false, Max37637), 
LFla65524 = flatten_layer(Max37637, Fla65524), 
LCon81225 = concatenate_layer([Fla65524,[[0.5906, 0.4319, 0.1352, 0.1706, 0.779, 0.8415]]], 1, Con81225), 
LLay15057 = layer_normalization_layer([[[1.5235, 1.2798], [1.17, 1.0411], [1.4614, 1.0267], [1.7272, 1.09]]], 1, 2.277674805864598, Lay15057), 
LFla34413 = flatten_layer(Lay15057, Fla34413), 
LDot58734 = dot_layer([[0.1926, 0.8137]], [[0.6458, 0.7699]], 1, 1, Dot58734), 
LCon50446 = concatenate_layer([Dot58734,[[0.4304, 0.0114, 0.1783, 0.6371, 0.1666, 0.2527, 0.8054]]], 1, Con50446), 
LAve78987 = average_layer([Fla34413,Con50446], Ave78987), 
LMax31718 = maximum_layer([Con81225,Ave78987], Max31718), 
exec_layers([LSof1630,LRes41671,LPRe33910,LRes16978,LMax37637,LFla65524,LCon81225,LLay15057,LFla34413,LDot58734,LCon50446,LAve78987,LMax31718],["Sof1630","Res41671","PRe33910","Res16978","Max37637","Fla65524","Con81225","Lay15057","Fla34413","Dot58734","Con50446","Ave78987","Max31718"],Max31718,"Max31718")

Actual (Unparsed): [[1.0000000, 1.0000000, 0.5906000, 0.4319000, 0.3155529, 0.1706000, 0.7790000, 0.8415000]]

Expected (Unparsed): [[1.0,1.0,0.5906,0.4319,0.31555292221225206,0.1706,0.779,0.8415]]

Actual:   [[1, 1, 0.5906, 0.4319, 0.3156, 0.1706, 0.779, 0.8415]]

Expected: [[1, 1, 0.5906, 0.4319, 0.3156, 0.1706, 0.779, 0.8415]]