import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max67424 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Max67424 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Dot67100 = tf.keras.layers.Input(shape=([2]))
in1Dot67100 = tf.keras.layers.Input(shape=([2]))

Max67424 = keras.layers.Maximum(name = 'Max67424', )([in0Max67424,in1Max67424])
Res39746 = keras.layers.Reshape((1, 1, 2), name = 'Res39746', )(Max67424)
Res5472 = keras.layers.Reshape((1, 2), name = 'Res5472', )(Res39746)
GRU51286 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU51286', )(Res5472)
Dot67100 = keras.layers.Dot(axes=(1, 1), name = 'Dot67100', )([in0Dot67100,in1Dot67100])
Dot15423 = keras.layers.Dot(axes=(1, 1), name = 'Dot15423', )([GRU51286,Dot67100])
Res33616 = keras.layers.Reshape((1, 1), name = 'Res33616', )(Dot15423)
Res23232 = keras.layers.Reshape((1, 1, 1), name = 'Res23232', )(Res33616)
Res27284 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res27284', )(Res23232)
Glo7720 = keras.layers.GlobalAveragePooling3D(name = 'Glo7720', )(Res27284)
model = tf.keras.models.Model(inputs=[in0Max67424,in1Max67424,in0Dot67100,in1Dot67100], outputs=Glo7720)
w = model.get_layer('GRU51286').get_weights() 
w[0] = np.array([[7, 4, 2], [8, 1, 4]])
w[1] = np.array([[3, 6, 4]])
w[2] = np.array([[2, 8, 1], [10, 7, 9]])
model.get_layer('GRU51286').set_weights(w) 
in0Max67424 = tf.constant([[[[[0.4678], [0.8192]]]]])
in1Max67424 = tf.constant([[[[[0.762], [0.2771]]]]])
in0Dot67100 = tf.constant([[0.4608, 0.281]])
in1Dot67100 = tf.constant([[0.8397, 0.15]])
print (np.array2string(model.predict([in0Max67424,in1Max67424,in0Dot67100,in1Dot67100],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo7720.png')

LMax67424 = maximum_layer([[[[[[0.4678], [0.8192]]]]], [[[[[0.762], [0.2771]]]]]], Max67424), 
LRes39746 = reshape_layer(Max67424, [1, 1, 2], Res39746), 
LRes5472 = reshape_layer(Res39746, [1, 2], Res5472), 
LGRU51286 = gru_layer(Res5472,[[7, 4, 2], [8, 1, 4]],[[3, 6, 4]],[[2, 8, 1], [10, 7, 9]], true, GRU51286), 
LDot67100 = dot_layer([[0.4608, 0.281]], [[0.8397, 0.15]], 1, 1, Dot67100), 
LDot15423 = dot_layer(GRU51286,Dot67100, 1, 1, Dot15423), 
LRes33616 = reshape_layer(Dot15423, [1, 1], Res33616), 
LRes23232 = reshape_layer(Res33616, [1, 1, 1], Res23232), 
LRes27284 = reshape_layer(Res23232, [1, 1, 1, 1], Res27284), 
LGlo7720 = global_average_pooling3D_layer(Res27284, Glo7720), 
exec_layers([LMax67424,LRes39746,LRes5472,LGRU51286,LDot67100,LDot15423,LRes33616,LRes23232,LRes27284,LGlo7720],["Max67424","Res39746","Res5472","GRU51286","Dot67100","Dot15423","Res33616","Res23232","Res27284","Glo7720"],Glo7720,"Glo7720")

Actual (Unparsed): [[0.0000000]]

Expected (Unparsed): [[1.8125446181715355e-11]]

Actual:   [[0]]

Expected: [[0]]