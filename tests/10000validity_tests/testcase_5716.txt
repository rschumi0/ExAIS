import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub78602 = tf.keras.layers.Input(shape=([3]))
in1Sub78602 = tf.keras.layers.Input(shape=([3]))
in0Dot14776 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot14776 = tf.keras.layers.Input(shape=([3, 3]))

Sub78602 = keras.layers.Subtract(name = 'Sub78602', )([in0Sub78602,in1Sub78602])
Sof96574 = keras.layers.Softmax(axis=1, name = 'Sof96574', )(Sub78602)
Lay57469 = keras.layers.LayerNormalization(axis=1, epsilon=2.461164964449816, name = 'Lay57469', )(Sof96574)
Res86671 = keras.layers.Reshape((3, 1), name = 'Res86671', )(Lay57469)
Res25774 = keras.layers.Reshape((3, 1, 1), name = 'Res25774', )(Res86671)
Zer48057 = keras.layers.ZeroPadding2D(padding=((0, 0), (3, 0)), name = 'Zer48057', )(Res25774)
Dot14776 = keras.layers.Dot(axes=(1, 1), name = 'Dot14776', )([in0Dot14776,in1Dot14776])
Max55029 = keras.layers.MaxPool1D(pool_size=(1), strides=(12), padding='same', name = 'Max55029', )(Dot14776)
Res37262 = keras.layers.Reshape((1, 3, 1), name = 'Res37262', )(Max55029)
Zer74554 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer74554', )(Res37262)
Max52272 = keras.layers.MaxPool2D(pool_size=(1, 2), strides=(1, 1), padding='valid', name = 'Max52272', )(Zer74554)
Mul80605 = keras.layers.Multiply(name = 'Mul80605', )([Zer48057,Max52272])
model = tf.keras.models.Model(inputs=[in0Sub78602,in1Sub78602,in0Dot14776,in1Dot14776], outputs=Mul80605)
in0Sub78602 = tf.constant([[0.1566, 0.5429, 0.3953]])
in1Sub78602 = tf.constant([[0.1997, 0.5411, 0.8544]])
in0Dot14776 = tf.constant([[[0.4855, 0.6258, 0.3281], [0.7582, 0.7342, 0.6598], [0.2779, 0.5268, 0.2845]]])
in1Dot14776 = tf.constant([[[0.7846, 0.3731, 0.1162], [0.383, 0.545, 0.6036], [0.7372, 0.0466, 0.7758]]])
print (np.array2string(model.predict([in0Sub78602,in1Sub78602,in0Dot14776,in1Dot14776],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul80605.png')

LSub78602 = subtract_layer([[0.1566, 0.5429, 0.3953]], [[0.1997, 0.5411, 0.8544]], Sub78602), 
LSof96574 = softmax_layer(Sub78602, 1, Sof96574), 
LLay57469 = layer_normalization_layer(Sof96574, 1, 2.461164964449816, Lay57469), 
LRes86671 = reshape_layer(Lay57469, [3, 1], Res86671), 
LRes25774 = reshape_layer(Res86671, [3, 1, 1], Res25774), 
LZer48057 = zero_padding2D_layer(Res25774, 0, 0, 3, 0, Zer48057), 
LDot14776 = dot_layer([[[0.4855, 0.6258, 0.3281], [0.7582, 0.7342, 0.6598], [0.2779, 0.5268, 0.2845]]], [[[0.7846, 0.3731, 0.1162], [0.383, 0.545, 0.6036], [0.7372, 0.0466, 0.7758]]], 1, 1, Dot14776), 
LMax55029 = max_pool1D_layer(Dot14776, 1, 12, true, Max55029), 
LRes37262 = reshape_layer(Max55029, [1, 3, 1], Res37262), 
LZer74554 = zero_padding2D_layer(Res37262, 1, 1, 1, 1, Zer74554), 
LMax52272 = max_pool2D_layer(Zer74554, 1, 2, 1, 1, false, Max52272), 
LMul80605 = multiply_layer([Zer48057,Max52272], Mul80605), 
exec_layers([LSub78602,LSof96574,LLay57469,LRes86671,LRes25774,LZer48057,LDot14776,LMax55029,LRes37262,LZer74554,LMax52272,LMul80605],["Sub78602","Sof96574","Lay57469","Res86671","Res25774","Zer48057","Dot14776","Max55029","Res37262","Zer74554","Max52272","Mul80605"],Mul80605,"Mul80605")

Actual (Unparsed): [[[[0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0247433]], [[0.0000000], [0.0000000], [0.0000000], [-0.0000000]]]]

Expected (Unparsed): [[[[0],[0],[0],[0.0]],[[0.0],[0.0],[0.0],[0.02474331397113886]],[[0],[0],[0],[-0.0]]]]

Actual:   [[[[0], [0], [0], [0]], [[0], [0], [0], [0.0248]], [[0], [0], [0], [-0]]]]

Expected: [[[[0], [0], [0], [0]], [[0], [0], [0], [0.0248]], [[0], [0], [0], [-0]]]]