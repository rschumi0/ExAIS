import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub39171 = tf.keras.layers.Input(shape=([2, 3, 3]))
in1Sub39171 = tf.keras.layers.Input(shape=([2, 3, 3]))
in0Con99912 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Ave13137 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Ave13137 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con74772 = tf.keras.layers.Input(shape=([1, 2, 1]))

Sub39171 = keras.layers.Subtract(name = 'Sub39171', )([in0Sub39171,in1Sub39171])
Con99912 = keras.layers.Conv3D(3, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con99912', )(in0Con99912)
Res85359 = keras.layers.Reshape((1, 2, 3), name = 'Res85359', )(Con99912)
Ave13137 = keras.layers.Average(name = 'Ave13137', )([in0Ave13137,in1Ave13137])
Zer18186 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer18186', )(Ave13137)
Con74772 = keras.layers.Concatenate(axis=3, name = 'Con74772', )([Zer18186,in0Con74772])
Sub77247 = keras.layers.Subtract(name = 'Sub77247', )([Res85359,Con74772])
Zer4922 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer4922', )(Sub77247)
Add4509 = keras.layers.Add(name = 'Add4509', )([Sub39171,Zer4922])
model = tf.keras.models.Model(inputs=[in0Sub39171,in1Sub39171,in0Con99912,in0Ave13137,in1Ave13137,in0Con74772], outputs=Add4509)
w = model.get_layer('Con99912').get_weights() 
w[0] = np.array([[[[[0.8851, 0.1072, 0.6142], [0.0784, 0.2981, 0.6475]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con99912').set_weights(w) 
in0Sub39171 = tf.constant([[[[0.1513, 0.603, 0.0436], [0.4375, 0.8195, 0.5438], [0.9901, 0.5782, 0.2581]], [[0.875, 0.7919, 0.8515], [0.112, 0.0339, 0.9884], [0.3197, 0.0295, 0.9693]]]])
in1Sub39171 = tf.constant([[[[0.2913, 0.3632, 0.438], [0.6501, 0.6231, 0.7665], [0.1882, 0.6954, 0.5177]], [[0.3871, 0.4625, 0.1629], [0.8355, 0.193, 0.7474], [0.3824, 0.355, 0.6312]]]])
in0Con99912 = tf.constant([[[[[0.731, 0.474]], [[0.5624, 0.8734]]]]])
in0Ave13137 = tf.constant([[[[0.6995, 0.8549]]]])
in1Ave13137 = tf.constant([[[[0.8812, 0.4741]]]])
in0Con74772 = tf.constant([[[[0.4744], [0.3408]]]])
print (np.array2string(model.predict([in0Sub39171,in1Sub39171,in0Con99912,in0Ave13137,in1Ave13137,in0Con74772],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add4509.png')

LSub39171 = subtract_layer([[[[0.1513, 0.603, 0.0436], [0.4375, 0.8195, 0.5438], [0.9901, 0.5782, 0.2581]], [[0.875, 0.7919, 0.8515], [0.112, 0.0339, 0.9884], [0.3197, 0.0295, 0.9693]]]], [[[[0.2913, 0.3632, 0.438], [0.6501, 0.6231, 0.7665], [0.1882, 0.6954, 0.5177]], [[0.3871, 0.4625, 0.1629], [0.8355, 0.193, 0.7474], [0.3824, 0.355, 0.6312]]]], Sub39171), 
LCon99912 = conv3D_layer([[[[[0.731, 0.474]], [[0.5624, 0.8734]]]]], 1, 1, 1,[[[[[0.8851, 0.1072, 0.6142], [0.0784, 0.2981, 0.6475]]]]],[0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con99912), 
LRes85359 = reshape_layer(Con99912, [1, 2, 3], Res85359), 
LAve13137 = average_layer([[[[[0.6995, 0.8549]]]], [[[[0.8812, 0.4741]]]]], Ave13137), 
LZer18186 = zero_padding2D_layer(Ave13137, 0, 0, 1, 0, Zer18186), 
LCon74772 = concatenate_layer([Zer18186,[[[[0.4744], [0.3408]]]]], 3, Con74772), 
LSub77247 = subtract_layer(Res85359,Con74772, Sub77247), 
LZer4922 = zero_padding2D_layer(Sub77247, 1, 0, 1, 0, Zer4922), 
LAdd4509 = add_layer([Sub39171,Zer4922], Add4509), 
exec_layers([LSub39171,LCon99912,LRes85359,LAve13137,LZer18186,LCon74772,LSub77247,LZer4922,LAdd4509],["Sub39171","Con99912","Res85359","Ave13137","Zer18186","Con74772","Sub77247","Zer4922","Add4509"],Add4509,"Add4509")

Actual (Unparsed): [[[[-0.1400000, 0.2398000, -0.3944000], [-0.2126000, 0.1964000, -0.2227000], [0.8019000, -0.1172000, -0.2596000]], [[0.4879000, 0.3294000, 0.6886000], [-0.0393303, 0.0605626, 0.5224952], [-0.2867952, -0.6693502, 0.9082525]]]]

Expected (Unparsed): [[[[-0.14,0.23979999999999996,-0.3944],[-0.2126,0.19640000000000002,-0.2227],[0.8019,-0.11719999999999997,-0.25960000000000005]],[[0.4879,0.3294,0.6886000000000001],[-0.03933030000000004,0.060562599999999966,0.5224951999999998],[-0.2867952000000001,-0.66935018,0.90825258]]]]

Actual:   [[[[-0.14, 0.2398, -0.3944], [-0.2126, 0.1964, -0.2227], [0.8019, -0.1172, -0.2596]], [[0.4879, 0.3294, 0.6886], [-0.0393, 0.0606, 0.5225], [-0.2867, -0.6693, 0.9083]]]]

Expected: [[[[-0.14, 0.2398, -0.3944], [-0.2126, 0.1965, -0.2227], [0.8019, -0.1171, -0.2596]], [[0.4879, 0.3294, 0.6887], [-0.0393, 0.0606, 0.5225], [-0.2867, -0.6693, 0.9083]]]]