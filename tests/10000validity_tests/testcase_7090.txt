import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min33899 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Min33899 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Glo25561 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in0Con92960 = tf.keras.layers.Input(shape=([2]))
in0GRU81851 = tf.keras.layers.Input(shape=([3, 3]))

Min33899 = keras.layers.Minimum(name = 'Min33899', )([in0Min33899,in1Min33899])
Res17503 = keras.layers.Reshape((2, 1, 2), name = 'Res17503', )(Min33899)
Max77839 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(7, 1), padding='valid', name = 'Max77839', )(Res17503)
Res19702 = keras.layers.Reshape((1, 2), name = 'Res19702', )(Max77839)
Glo25561 = keras.layers.GlobalMaxPool3D(name = 'Glo25561', )(in0Glo25561)
Res86686 = keras.layers.Reshape((1, 2), name = 'Res86686', )(Glo25561)
Min39556 = keras.layers.Minimum(name = 'Min39556', )([Res19702,Res86686])
Fla61139 = keras.layers.Flatten(name = 'Fla61139', )(Min39556)
Con92960 = keras.layers.Concatenate(axis=1, name = 'Con92960', )([Fla61139,in0Con92960])
GRU81851 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU81851', )(in0GRU81851)
Den55094 = keras.layers.Dense(4,name = 'Den55094', )(GRU81851)
Max72141 = keras.layers.Maximum(name = 'Max72141', )([Con92960,Den55094])
model = tf.keras.models.Model(inputs=[in0Min33899,in1Min33899,in0Glo25561,in0Con92960,in0GRU81851], outputs=Max72141)
w = model.get_layer('GRU81851').get_weights() 
w[0] = np.array([[3, 5, 7, 6, 5, 6], [4, 10, 5, 10, 1, 2], [10, 1, 3, 1, 9, 5]])
w[1] = np.array([[8, 8, 1, 3, 7, 6], [3, 9, 1, 8, 4, 1]])
w[2] = np.array([3, 4, 9, 10, 9, 6])
model.get_layer('GRU81851').set_weights(w) 
w = model.get_layer('Den55094').get_weights() 
w[0] = np.array([[0.7523, 0.1708, 0.7851, 0.7814], [0.866, 0.0339, 0.4551, 0.9271]])
w[1] = np.array([0.6596, 0.9237, 0.8278, 0.3346])
model.get_layer('Den55094').set_weights(w) 
in0Min33899 = tf.constant([[[[[0.3444], [0.1003]]], [[[0.1155], [0.413]]]]])
in1Min33899 = tf.constant([[[[[0.227], [0.1977]]], [[[0.2713], [0.3277]]]]])
in0Glo25561 = tf.constant([[[[[1.5752, 1.1605], [1.1824, 1.0915]]]]])
in0Con92960 = tf.constant([[0.6484, 0.0682]])
in0GRU81851 = tf.constant([[[4, 3, 6], [10, 7, 5], [9, 7, 10]]])
print (np.array2string(model.predict([in0Min33899,in1Min33899,in0Glo25561,in0Con92960,in0GRU81851],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max72141.png')

LMin33899 = minimum_layer([[[[[[0.3444], [0.1003]]], [[[0.1155], [0.413]]]]], [[[[[0.227], [0.1977]]], [[[0.2713], [0.3277]]]]]], Min33899), 
LRes17503 = reshape_layer(Min33899, [2, 1, 2], Res17503), 
LMax77839 = max_pool2D_layer(Res17503, 1, 1, 7, 1, false, Max77839), 
LRes19702 = reshape_layer(Max77839, [1, 2], Res19702), 
LGlo25561 = global_max_pool3D_layer([[[[[1.5752, 1.1605], [1.1824, 1.0915]]]]], Glo25561), 
LRes86686 = reshape_layer(Glo25561, [1, 2], Res86686), 
LMin39556 = minimum_layer([Res19702,Res86686], Min39556), 
LFla61139 = flatten_layer(Min39556, Fla61139), 
LCon92960 = concatenate_layer([Fla61139,[[0.6484, 0.0682]]], 1, Con92960), 
LGRU81851 = gru_layer([[[4, 3, 6], [10, 7, 5], [9, 7, 10]]],[[3, 5, 7, 6, 5, 6], [4, 10, 5, 10, 1, 2], [10, 1, 3, 1, 9, 5]],[[8, 8, 1, 3, 7, 6], [3, 9, 1, 8, 4, 1]],[3, 4, 9, 10, 9, 6], false, GRU81851), 
LDen55094 = dense_layer(GRU81851, [[0.7523, 0.1708, 0.7851, 0.7814], [0.866, 0.0339, 0.4551, 0.9271]],[0.6596, 0.9237, 0.8278, 0.3346], Den55094), 
LMax72141 = maximum_layer([Con92960,Den55094], Max72141), 
exec_layers([LMin33899,LRes17503,LMax77839,LRes19702,LGlo25561,LRes86686,LMin39556,LFla61139,LCon92960,LGRU81851,LDen55094,LMax72141],["Min33899","Res17503","Max77839","Res19702","Glo25561","Res86686","Min39556","Fla61139","Con92960","GRU81851","Den55094","Max72141"],Max72141,"Max72141")

Actual (Unparsed): [[0.6596000, 0.9237000, 0.8278000, 0.3346000]]

Expected (Unparsed): [[0.6596,0.9237,0.8278,0.3346]]

Actual:   [[0.6596, 0.9237, 0.8278, 0.3346]]

Expected: [[0.6596, 0.9237, 0.8278, 0.3346]]