import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add50185 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Add50185 = tf.keras.layers.Input(shape=([2, 1, 2]))

Add50185 = keras.layers.Add(name = 'Add50185', )([in0Add50185,in1Add50185])
Res62862 = keras.layers.Reshape((2, 1, 2, 1), name = 'Res62862', )(Add50185)
Zer69634 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer69634', )(Res62862)
Res24319 = keras.layers.Reshape((4, 3, 4), name = 'Res24319', )(Zer69634)
Dep33593 = keras.layers.DepthwiseConv2D((3, 3),strides=(3, 3), padding='valid', name = 'Dep33593', )(Res24319)
Res42579 = keras.layers.Reshape((1, 4), name = 'Res42579', )(Dep33593)
Sim41050 = keras.layers.SimpleRNN(3,name = 'Sim41050', )(Res42579)
model = tf.keras.models.Model(inputs=[in0Add50185,in1Add50185], outputs=Sim41050)
w = model.get_layer('Dep33593').get_weights() 
w[0] = np.array([[[[0.1899], [0.2263], [0.9315], [0.842]], [[0.3392], [0.6927], [0.9072], [0.889]], [[0.0363], [0.4043], [0.2107], [0.1179]]], [[[0.0153], [0.4804], [0.6347], [0.1297]], [[0.2969], [0.498], [0.0381], [0.0178]], [[0.8002], [0.5804], [0.6866], [0.0335]]], [[[0.7284], [0.5013], [0.6241], [0.4323]], [[0.0432], [0.4678], [0.5089], [0.3842]], [[0.9349], [0.6039], [0.2761], [0.6457]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Dep33593').set_weights(w) 
w = model.get_layer('Sim41050').get_weights() 
w[0] = np.array([[10, 4, 7], [10, 4, 3], [2, 7, 2], [5, 6, 4]])
w[1] = np.array([[9, 9, 9], [10, 7, 4], [7, 5, 3]])
w[2] = np.array([6, 2, 8])
model.get_layer('Sim41050').set_weights(w) 
in0Add50185 = tf.constant([[[[0.8905, 0.2044]], [[0.3792, 0.7776]]]])
in1Add50185 = tf.constant([[[[0.8175, 0.4931]], [[0.3838, 0.0238]]]])
print (np.array2string(model.predict([in0Add50185,in1Add50185],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sim41050.png')

LAdd50185 = add_layer([[[[[0.8905, 0.2044]], [[0.3792, 0.7776]]]], [[[[0.8175, 0.4931]], [[0.3838, 0.0238]]]]], Add50185), 
LRes62862 = reshape_layer(Add50185, [2, 1, 2, 1], Res62862), 
LZer69634 = zero_padding3D_layer(Res62862, 1, 1, 1, 1, 1, 1, Zer69634), 
LRes24319 = reshape_layer(Zer69634, [4, 3, 4], Res24319), 
LDep33593 = depthwise_conv2D_layer(Res24319, 3, 3,[[[[0.1899], [0.2263], [0.9315], [0.842]], [[0.3392], [0.6927], [0.9072], [0.889]], [[0.0363], [0.4043], [0.2107], [0.1179]]], [[[0.0153], [0.4804], [0.6347], [0.1297]], [[0.2969], [0.498], [0.0381], [0.0178]], [[0.8002], [0.5804], [0.6866], [0.0335]]], [[[0.7284], [0.5013], [0.6241], [0.4323]], [[0.0432], [0.4678], [0.5089], [0.3842]], [[0.9349], [0.6039], [0.2761], [0.6457]]]],[0, 0, 0, 0], 3, 3, false, Dep33593), 
LRes42579 = reshape_layer(Dep33593, [1, 4], Res42579), 
LSim41050 = simple_rnn_layer(Res42579,[[10, 4, 7], [10, 4, 3], [2, 7, 2], [5, 6, 4]],[[9, 9, 9], [10, 7, 4], [7, 5, 3]],[6, 2, 8], Sim41050), 
exec_layers([LAdd50185,LRes62862,LZer69634,LRes24319,LDep33593,LRes42579,LSim41050],["Add50185","Res62862","Zer69634","Res24319","Dep33593","Res42579","Sim41050"],Sim41050,"Sim41050")

Actual (Unparsed): [[1.0000000, 1.0000000, 1.0000000]]

Expected (Unparsed): [[0.9999999999999999,0.9999999946633993,0.99999999997174]]

Actual:   [[1, 1, 1]]

Expected: [[1, 1, 1]]