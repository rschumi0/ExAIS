import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con33234 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con91072 = tf.keras.layers.Input(shape=([1, 2, 7, 1]))
in0Mul80381 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Mul80381 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Glo59080 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Add63095 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Add63095 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in0Con21172 = tf.keras.layers.Input(shape=([1, 2, 7, 1]))

Con33234 = keras.layers.Conv2D(4, (2, 2),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con33234', )(in0Con33234)
Lea10125 = keras.layers.LeakyReLU(alpha=5.529866489702434, name = 'Lea10125', )(Con33234)
Res29616 = keras.layers.Reshape((1, 1, 4, 1), name = 'Res29616', )(Lea10125)
Zer4112 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (3, 0)), name = 'Zer4112', )(Res29616)
Con91072 = keras.layers.Concatenate(axis=4, name = 'Con91072', )([Zer4112,in0Con91072])
Mul80381 = keras.layers.Multiply(name = 'Mul80381', )([in0Mul80381,in1Mul80381])
Zer40570 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (6, 0)), name = 'Zer40570', )(Mul80381)
Sub87887 = keras.layers.Subtract(name = 'Sub87887', )([Con91072,Zer40570])
Glo59080 = keras.layers.GlobalMaxPool2D(name = 'Glo59080', )(in0Glo59080)
Res60494 = keras.layers.Reshape((1, 1), name = 'Res60494', )(Glo59080)
Res94401 = keras.layers.Reshape((1, 1, 1), name = 'Res94401', )(Res60494)
Res66103 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res66103', )(Res94401)
Cro56842 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro56842', )(Res66103)
Add63095 = keras.layers.Add(name = 'Add63095', )([in0Add63095,in1Add63095])
Mas24276 = keras.layers.Masking(mask_value=1, name = 'Mas24276', )(Add63095)
Max24056 = keras.layers.Maximum(name = 'Max24056', )([Cro56842,Mas24276])
Zer75582 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (6, 0)), name = 'Zer75582', )(Max24056)
Con21172 = keras.layers.Concatenate(axis=4, name = 'Con21172', )([Zer75582,in0Con21172])
Mul574 = keras.layers.Multiply(name = 'Mul574', )([Sub87887,Con21172])
Res59184 = keras.layers.Reshape((1, 2, 14), name = 'Res59184', )(Mul574)
Res84658 = keras.layers.Reshape((1, 28), name = 'Res84658', )(Res59184)
Zer2126 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer2126', )(Res84658)
model = tf.keras.models.Model(inputs=[in0Con33234,in0Con91072,in0Mul80381,in1Mul80381,in0Glo59080,in0Add63095,in1Add63095,in0Con21172], outputs=Zer2126)
w = model.get_layer('Con33234').get_weights() 
w[0] = np.array([[[[0.5371, 0.2706, 0.1311, 0.0978], [0.7691, 0.2634, 0.0616, 0.318]], [[0.0115, 0.8808, 0.0096, 0.4615], [0.9842, 0.7019, 0.5463, 0.5653]]], [[[0.9378, 0.8045, 0.8303, 0.7466], [0.9026, 0.758, 0.2464, 0.261]], [[0.1419, 0.6142, 0.4944, 0.6453], [0.1449, 0.9006, 0.527, 0.4017]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con33234').set_weights(w) 
in0Con33234 = tf.constant([[[[0.1579, 0.6316], [0.1293, 0.8054]], [[0.7092, 0.848], [0.7599, 0.6558]]]])
in0Con91072 = tf.constant([[[[[0.2551], [0.7654], [0.7491], [0.0429], [0.2765], [0.1008], [0.9522]], [[0.9383], [0.0246], [0.8212], [0.5568], [0.4826], [0.0938], [0.3903]]]]])
in0Mul80381 = tf.constant([[[[[0.7591, 0.3593]], [[0.7815, 0.7299]]]]])
in1Mul80381 = tf.constant([[[[[0.8778, 0.6052]], [[0.4084, 0.3153]]]]])
in0Glo59080 = tf.constant([[[[1.7509]], [[1.8382]]]])
in0Add63095 = tf.constant([[[[[0.886]]]]])
in1Add63095 = tf.constant([[[[[0.6785]]]]])
in0Con21172 = tf.constant([[[[[0.5064], [0.3821], [0.626], [0.5029], [0.4391], [0.2544], [0.6463]], [[0.0165], [0.3375], [0.1814], [0.4142], [0.3743], [0.0878], [0.8365]]]]])
print (np.array2string(model.predict([in0Con33234,in0Con91072,in0Mul80381,in1Mul80381,in0Glo59080,in0Add63095,in1Add63095,in0Con21172],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Zer2126.png')

LCon33234 = conv2D_layer([[[[0.1579, 0.6316], [0.1293, 0.8054]], [[0.7092, 0.848], [0.7599, 0.6558]]]], 2, 2,[[[[0.5371, 0.2706, 0.1311, 0.0978], [0.7691, 0.2634, 0.0616, 0.318]], [[0.0115, 0.8808, 0.0096, 0.4615], [0.9842, 0.7019, 0.5463, 0.5653]]], [[[0.9378, 0.8045, 0.8303, 0.7466], [0.9026, 0.758, 0.2464, 0.261]], [[0.1419, 0.6142, 0.4944, 0.6453], [0.1449, 0.9006, 0.527, 0.4017]]]],[0, 0, 0, 0], 1, 1, false, 1, 1, Con33234), 
LLea10125 = leaky_relu_layer(Con33234, 5.529866489702434, Lea10125), 
LRes29616 = reshape_layer(Lea10125, [1, 1, 4, 1], Res29616), 
LZer4112 = zero_padding3D_layer(Res29616, 0, 0, 1, 0, 3, 0, Zer4112), 
LCon91072 = concatenate_layer([Zer4112,[[[[[0.2551], [0.7654], [0.7491], [0.0429], [0.2765], [0.1008], [0.9522]], [[0.9383], [0.0246], [0.8212], [0.5568], [0.4826], [0.0938], [0.3903]]]]]], 4, Con91072), 
LMul80381 = multiply_layer([[[[[[0.7591, 0.3593]], [[0.7815, 0.7299]]]]], [[[[[0.8778, 0.6052]], [[0.4084, 0.3153]]]]]], Mul80381), 
LZer40570 = zero_padding3D_layer(Mul80381, 0, 0, 0, 0, 6, 0, Zer40570), 
LSub87887 = subtract_layer(Con91072,Zer40570, Sub87887), 
LGlo59080 = global_max_pool2D_layer([[[[1.7509]], [[1.8382]]]], Glo59080), 
LRes60494 = reshape_layer(Glo59080, [1, 1], Res60494), 
LRes94401 = reshape_layer(Res60494, [1, 1, 1], Res94401), 
LRes66103 = reshape_layer(Res94401, [1, 1, 1, 1], Res66103), 
LCro56842 = cropping3D_layer(Res66103, 0, 0, 0, 0, 0, 0, Cro56842), 
LAdd63095 = add_layer([[[[[[0.886]]]]], [[[[[0.6785]]]]]], Add63095), 
LMas24276 = masking_layer(Add63095, 1, Mas24276), 
LMax24056 = maximum_layer([Cro56842,Mas24276], Max24056), 
LZer75582 = zero_padding3D_layer(Max24056, 0, 0, 1, 0, 6, 0, Zer75582), 
LCon21172 = concatenate_layer([Zer75582,[[[[[0.5064], [0.3821], [0.626], [0.5029], [0.4391], [0.2544], [0.6463]], [[0.0165], [0.3375], [0.1814], [0.4142], [0.3743], [0.0878], [0.8365]]]]]], 4, Con21172), 
LMul574 = multiply_layer([Sub87887,Con21172], Mul574), 
LRes59184 = reshape_layer(Mul574, [1, 2, 14], Res59184), 
LRes84658 = reshape_layer(Res59184, [1, 28], Res84658), 
LZer2126 = zero_padding1D_layer(Res84658, 1, 1, Zer2126), 
exec_layers([LCon33234,LLea10125,LRes29616,LZer4112,LCon91072,LMul80381,LZer40570,LSub87887,LGlo59080,LRes60494,LRes94401,LRes66103,LCro56842,LAdd63095,LMas24276,LMax24056,LZer75582,LCon21172,LMul574,LRes59184,LRes84658,LZer2126],["Con33234","Lea10125","Res29616","Zer4112","Con91072","Mul80381","Zer40570","Sub87887","Glo59080","Res60494","Res94401","Res66103","Cro56842","Add63095","Mas24276","Max24056","Zer75582","Con21172","Mul574","Res59184","Res84658","Zer2126"],Zer2126,"Zer2126")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.1291826, 0.0000000, 0.2924593, 0.0000000, 0.4689366, 0.0000000, 0.0215744, 0.0000000, 0.1214111, 0.0000000, 0.0256435, -0.0000000, 0.4748700, 0.0000000, 0.0154820, 0.0000000, 0.0083025, 0.0000000, 0.1489657, 0.0000000, 0.2306266, 0.0000000, 0.1806372, 0.0000000, 0.0082356, 3.5232898, 0.1339760], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000]]]

Expected (Unparsed): [[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0.12918264,0,0.29245934,0,0.4689366,0,0.021574410000000002,0,0.12141115000000001,0,0.025643520000000003,-0.0,0.474869984932,0,0.015481950000000001,0,0.0083025,0,0.14896568000000002,0.0,0.23062655999999998,0.0,0.18063718,0.0,0.00823564,3.5232897780080004,0.13397595634499998],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]

Actual:   [[[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0.1292, 0, 0.2925, 0, 0.469, 0, 0.0216, 0, 0.1215, 0, 0.0257, -0, 0.4749, 0, 0.0155, 0, 0.0084, 0, 0.149, 0, 0.2307, 0, 0.1807, 0, 0.0083, 3.5233, 0.134], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]]

Expected: [[[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0.1292, 0, 0.2925, 0, 0.469, 0, 0.0216, 0, 0.1215, 0, 0.0257, -0, 0.4749, 0, 0.0155, 0, 0.0084, 0, 0.149, 0, 0.2307, 0, 0.1807, 0, 0.0083, 3.5233, 0.134], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]]