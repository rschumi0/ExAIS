import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul62602 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Mul62602 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Dot40450 = tf.keras.layers.Input(shape=([3]))
in1Dot40450 = tf.keras.layers.Input(shape=([3]))
in0Con80937 = tf.keras.layers.Input(shape=([7]))

Mul62602 = keras.layers.Multiply(name = 'Mul62602', )([in0Mul62602,in1Mul62602])
Res55842 = keras.layers.Reshape((2, 2, 2), name = 'Res55842', )(Mul62602)
Res30255 = keras.layers.Reshape((2, 4), name = 'Res30255', )(Res55842)
Fla56544 = keras.layers.Flatten(name = 'Fla56544', )(Res30255)
Dot40450 = keras.layers.Dot(axes=(1, 1), name = 'Dot40450', )([in0Dot40450,in1Dot40450])
Con80937 = keras.layers.Concatenate(axis=1, name = 'Con80937', )([Dot40450,in0Con80937])
Ave75159 = keras.layers.Average(name = 'Ave75159', )([Fla56544,Con80937])
model = tf.keras.models.Model(inputs=[in0Mul62602,in1Mul62602,in0Dot40450,in1Dot40450,in0Con80937], outputs=Ave75159)
in0Mul62602 = tf.constant([[[[[0.2131, 0.0819]], [[0.7472, 0.9919]]], [[[0.1091, 0.8458]], [[0.5125, 0.1354]]]]])
in1Mul62602 = tf.constant([[[[[0.1917, 0.5649]], [[0.9649, 0.841]]], [[[0.2832, 0.5035]], [[0.228, 0.9983]]]]])
in0Dot40450 = tf.constant([[0.4509, 0.7203, 0.3067]])
in1Dot40450 = tf.constant([[0.6991, 0.1848, 0.543]])
in0Con80937 = tf.constant([[0.984, 0.8007, 0.893, 0.2099, 0.3283, 0.5945, 0.0996]])
print (np.array2string(model.predict([in0Mul62602,in1Mul62602,in0Dot40450,in1Dot40450,in0Con80937],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave75159.png')

LMul62602 = multiply_layer([[[[[[0.2131, 0.0819]], [[0.7472, 0.9919]]], [[[0.1091, 0.8458]], [[0.5125, 0.1354]]]]], [[[[[0.1917, 0.5649]], [[0.9649, 0.841]]], [[[0.2832, 0.5035]], [[0.228, 0.9983]]]]]], Mul62602), 
LRes55842 = reshape_layer(Mul62602, [2, 2, 2], Res55842), 
LRes30255 = reshape_layer(Res55842, [2, 4], Res30255), 
LFla56544 = flatten_layer(Res30255, Fla56544), 
LDot40450 = dot_layer([[0.4509, 0.7203, 0.3067]], [[0.6991, 0.1848, 0.543]], 1, 1, Dot40450), 
LCon80937 = concatenate_layer([Dot40450,[[0.984, 0.8007, 0.893, 0.2099, 0.3283, 0.5945, 0.0996]]], 1, Con80937), 
LAve75159 = average_layer([Fla56544,Con80937], Ave75159), 
exec_layers([LMul62602,LRes55842,LRes30255,LFla56544,LDot40450,LCon80937,LAve75159],["Mul62602","Res55842","Res30255","Fla56544","Dot40450","Con80937","Ave75159"],Ave75159,"Ave75159")

Actual (Unparsed): [[0.3278625, 0.5151327, 0.7608367, 0.8635940, 0.1203986, 0.3770801, 0.3556750, 0.1173849]]

Expected (Unparsed): [[0.3278625,0.5151326549999999,0.76083664,0.86359395,0.12039856,0.37708014999999995,0.355675,0.11738491]]

Actual:   [[0.3279, 0.5152, 0.7609, 0.8636, 0.1204, 0.3771, 0.3557, 0.1174]]

Expected: [[0.3279, 0.5152, 0.7609, 0.8636, 0.1204, 0.3771, 0.3557, 0.1174]]