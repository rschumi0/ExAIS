import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub70270 = tf.keras.layers.Input(shape=([3, 3, 3, 2]))
in1Sub70270 = tf.keras.layers.Input(shape=([3, 3, 3, 2]))

Sub70270 = keras.layers.Subtract(name = 'Sub70270', )([in0Sub70270,in1Sub70270])
Res30531 = keras.layers.Reshape((3, 3, 6), name = 'Res30531', )(Sub70270)
Res28194 = keras.layers.Reshape((3, 18), name = 'Res28194', )(Res30531)
Ave86875 = keras.layers.AveragePooling1D(pool_size=(3), strides=(3), padding='valid', name = 'Ave86875', )(Res28194)
model = tf.keras.models.Model(inputs=[in0Sub70270,in1Sub70270], outputs=Ave86875)
in0Sub70270 = tf.constant([[[[[0.8313, 0.6058], [0.3139, 0.6025], [0.7744, 0.701]], [[0.3848, 0.6396], [0.113, 0.6828], [0.4678, 0.3432]], [[0.582, 0.9921], [0.7025, 0.7398], [0.7835, 0.1755]]], [[[0.7938, 0.7792], [0.0835, 0.6297], [0.3671, 0.7515]], [[0.6334, 0.4272], [0.2725, 0.6476], [0.5178, 0.7152]], [[0.6463, 0.7462], [0.4027, 0.3353], [0.5483, 0.1362]]], [[[0.9541, 0.2531], [0.0328, 0.5859], [0.7301, 0.1029]], [[0.5818, 0.1556], [0.2105, 0.6553], [0.9334, 0.2199]], [[0.1203, 0.3005], [0.4698, 0.1079], [0.2304, 0.6966]]]]])
in1Sub70270 = tf.constant([[[[[0.4964, 0.4046], [0.3709, 0.585], [0.9377, 0.0645]], [[0.4829, 0.3956], [0.2061, 0.8787], [0.1503, 0.6728]], [[0.2554, 0.5126], [0.2036, 0.5437], [0.123, 0.2826]]], [[[0.6682, 0.4167], [0.5846, 0.0791], [0.542, 0.853]], [[0.8996, 0.3537], [0.6289, 0.082], [0.0073, 0.8945]], [[0.9319, 0.9482], [0.9495, 0.1848], [0.911, 0.1711]]], [[[0.7428, 0.5052], [0.2526, 0.6734], [0.3995, 0.5807]], [[0.6627, 0.3939], [0.3052, 0.4944], [0.5944, 0.437]], [[0.7035, 0.7968], [0.7556, 0.6306], [0.6054, 0.2227]]]]])
print (np.array2string(model.predict([in0Sub70270,in1Sub70270],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave86875.png')

LSub70270 = subtract_layer([[[[[0.8313, 0.6058], [0.3139, 0.6025], [0.7744, 0.701]], [[0.3848, 0.6396], [0.113, 0.6828], [0.4678, 0.3432]], [[0.582, 0.9921], [0.7025, 0.7398], [0.7835, 0.1755]]], [[[0.7938, 0.7792], [0.0835, 0.6297], [0.3671, 0.7515]], [[0.6334, 0.4272], [0.2725, 0.6476], [0.5178, 0.7152]], [[0.6463, 0.7462], [0.4027, 0.3353], [0.5483, 0.1362]]], [[[0.9541, 0.2531], [0.0328, 0.5859], [0.7301, 0.1029]], [[0.5818, 0.1556], [0.2105, 0.6553], [0.9334, 0.2199]], [[0.1203, 0.3005], [0.4698, 0.1079], [0.2304, 0.6966]]]]], [[[[[0.4964, 0.4046], [0.3709, 0.585], [0.9377, 0.0645]], [[0.4829, 0.3956], [0.2061, 0.8787], [0.1503, 0.6728]], [[0.2554, 0.5126], [0.2036, 0.5437], [0.123, 0.2826]]], [[[0.6682, 0.4167], [0.5846, 0.0791], [0.542, 0.853]], [[0.8996, 0.3537], [0.6289, 0.082], [0.0073, 0.8945]], [[0.9319, 0.9482], [0.9495, 0.1848], [0.911, 0.1711]]], [[[0.7428, 0.5052], [0.2526, 0.6734], [0.3995, 0.5807]], [[0.6627, 0.3939], [0.3052, 0.4944], [0.5944, 0.437]], [[0.7035, 0.7968], [0.7556, 0.6306], [0.6054, 0.2227]]]]], Sub70270), 
LRes30531 = reshape_layer(Sub70270, [3, 3, 6], Res30531), 
LRes28194 = reshape_layer(Res30531, [3, 18], Res28194), 
LAve86875 = average_pooling1D_layer(Res28194, 3, 3, false, Ave86875), 
exec_layers([LSub70270,LRes30531,LRes28194,LAve86875],["Sub70270","Res30531","Res28194","Ave86875"],Ave86875,"Ave86875")

Actual (Unparsed): [[[0.2239333, 0.1038667, -0.2593000, 0.1602000, -0.0025333, 0.0190667, -0.1484000, 0.0264000, -0.1814000, 0.1768667, 0.3890000, -0.2420000, -0.1807333, -0.0729333, -0.1112333, -0.0587000, -0.0257333, 0.1106333]]]

Expected (Unparsed): [[[0.22393333333333332,0.10386666666666666,-0.25930000000000003,0.1602,-0.0025333333333333687,0.019066666666666638,-0.1484,0.02639999999999999,-0.1814,0.17686666666666664,0.389,-0.24199999999999997,-0.18073333333333333,-0.07293333333333334,-0.11123333333333334,-0.05870000000000001,-0.02573333333333337,0.11063333333333332]]]

Actual:   [[[0.224, 0.1039, -0.2593, 0.1602, -0.0025, 0.0191, -0.1484, 0.0264, -0.1814, 0.1769, 0.389, -0.242, -0.1807, -0.0729, -0.1112, -0.0587, -0.0257, 0.1107]]]

Expected: [[[0.224, 0.1039, -0.2593, 0.1602, -0.0025, 0.0191, -0.1484, 0.0264, -0.1814, 0.1769, 0.389, -0.2419, -0.1807, -0.0729, -0.1112, -0.0587, -0.0257, 0.1107]]]