import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub48315 = tf.keras.layers.Input(shape=([2]))
in1Sub48315 = tf.keras.layers.Input(shape=([2]))
in0Con77315 = tf.keras.layers.Input(shape=([2, 2, 3, 1]))
in0Sof7416 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con67409 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0PRe21329 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in0GRU59972 = tf.keras.layers.Input(shape=([1, 1]))
in0Con72112 = tf.keras.layers.Input(shape=([4, 3, 4, 1]))

Sub48315 = keras.layers.Subtract(name = 'Sub48315', )([in0Sub48315,in1Sub48315])
Res85826 = keras.layers.Reshape((2, 1), name = 'Res85826', )(Sub48315)
Sep32460 = keras.layers.SeparableConv1D(2, (1),strides=(1), padding='valid', name = 'Sep32460', )(Res85826)
Res12458 = keras.layers.Reshape((2, 2, 1), name = 'Res12458', )(Sep32460)
Res67297 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res67297', )(Res12458)
Zer7197 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer7197', )(Res67297)
Con77315 = keras.layers.Concatenate(axis=4, name = 'Con77315', )([Zer7197,in0Con77315])
Sof7416 = keras.layers.Softmax(axis=1, name = 'Sof7416', input_shape=(2, 1, 2))(in0Sof7416)
Res53379 = keras.layers.Reshape((2, 1, 2, 1), name = 'Res53379', )(Sof7416)
Con67409 = keras.layers.Concatenate(axis=4, name = 'Con67409', )([Res53379,in0Con67409])
PRe21329 = keras.layers.PReLU(name = 'PRe21329', input_shape=(2, 1, 2, 2))(in0PRe21329)
Sub15353 = keras.layers.Subtract(name = 'Sub15353', )([Con67409,PRe21329])
Zer47050 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (1, 0)), name = 'Zer47050', )(Sub15353)
Ave76655 = keras.layers.Average(name = 'Ave76655', )([Con77315,Zer47050])
Zer52344 = keras.layers.ZeroPadding3D(padding=((2, 0), (1, 0), (1, 0)), name = 'Zer52344', )(Ave76655)
GRU59972 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU59972', )(in0GRU59972)
Res920 = keras.layers.Reshape((2, 1), name = 'Res920', )(GRU59972)
Res59288 = keras.layers.Reshape((2, 1, 1), name = 'Res59288', )(Res920)
Zer89177 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer89177', )(Res59288)
Res47145 = keras.layers.Reshape((4, 3, 1, 1), name = 'Res47145', )(Zer89177)
Up_61123 = keras.layers.UpSampling3D(size=(1, 1, 2), name = 'Up_61123', )(Res47145)
Zer8678 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer8678', )(Up_61123)
Con72112 = keras.layers.Concatenate(axis=4, name = 'Con72112', )([Zer8678,in0Con72112])
Min78609 = keras.layers.Minimum(name = 'Min78609', )([Zer52344,Con72112])
model = tf.keras.models.Model(inputs=[in0Sub48315,in1Sub48315,in0Con77315,in0Sof7416,in0Con67409,in0PRe21329,in0GRU59972,in0Con72112], outputs=Min78609)
w = model.get_layer('Sep32460').get_weights() 
w[0] = np.array([[[0.715]]])
w[1] = np.array([[[0.1851, 0.4599]]])
w[2] = np.array([0, 0])
model.get_layer('Sep32460').set_weights(w) 
w = model.get_layer('PRe21329').get_weights() 
w[0] = np.array([[[[0.2925, 0.6222], [0.242, 0.5304]]], [[[0.1064, 0.0652], [0.6935, 0.3615]]]])
model.get_layer('PRe21329').set_weights(w) 
w = model.get_layer('GRU59972').get_weights() 
w[0] = np.array([[3, 2, 2, 10, 1, 10]])
w[1] = np.array([[1, 9, 4, 10, 4, 3], [2, 7, 3, 1, 1, 3]])
w[2] = np.array([[2, 8, 4, 6, 6, 7], [7, 7, 9, 1, 5, 9]])
model.get_layer('GRU59972').set_weights(w) 
in0Sub48315 = tf.constant([[0.7427, 0.8084]])
in1Sub48315 = tf.constant([[0.7248, 0.5672]])
in0Con77315 = tf.constant([[[[[0.8365], [0.112], [0.0955]], [[0.3622], [0.2282], [0.597]]], [[[0.0057], [0.3658], [0.4563]], [[0.2935], [0.9298], [0.4385]]]]])
in0Sof7416 = tf.constant([[[[0.6348, 0.6798]], [[0.0583, 0.6888]]]])
in0Con67409 = tf.constant([[[[[0.0194], [0.7899]]], [[[0.0025], [0.3098]]]]])
in0PRe21329 = tf.constant([[[[[0.4468, 0.9732], [0.2365, 0.5576]]], [[[0.4003, 0.6211], [0.4961, 0.8216]]]]])
in0GRU59972 = tf.constant([[[3]]])
in0Con72112 = tf.constant([[[[[0.5517], [0.3121], [0.5082], [0.225]], [[0.9667], [0.2257], [0.3751], [0.7013]], [[0.5621], [0.08], [0.7813], [0.4169]]], [[[0.3164], [0.9384], [0.4961], [0.7167]], [[0.4128], [0.67], [0.3694], [0.2841]], [[0.8149], [0.3582], [0.675], [0.4879]]], [[[0.8004], [0.2296], [0.1633], [0.0174]], [[0.2377], [0.0236], [0.1457], [0.6262]], [[0.9755], [0.8478], [0.6632], [0.7012]]], [[[0.835], [0.4752], [0.548], [0.5442]], [[0.3444], [0.7214], [0.9792], [0.7058]], [[0.5336], [0.017], [0.9543], [0.4515]]]]])
print (np.array2string(model.predict([in0Sub48315,in1Sub48315,in0Con77315,in0Sof7416,in0Con67409,in0PRe21329,in0GRU59972,in0Con72112],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min78609.png')

LSub48315 = subtract_layer([[0.7427, 0.8084]], [[0.7248, 0.5672]], Sub48315), 
LRes85826 = reshape_layer(Sub48315, [2, 1], Res85826), 
LSep32460 = separable_conv1D_layer(Res85826, 1,[[[[0.715]]],[[[0.1851, 0.4599]]]],[0, 0], 1, false, Sep32460), 
LRes12458 = reshape_layer(Sep32460, [2, 2, 1], Res12458), 
LRes67297 = reshape_layer(Res12458, [2, 2, 1, 1], Res67297), 
LZer7197 = zero_padding3D_layer(Res67297, 0, 0, 0, 0, 2, 0, Zer7197), 
LCon77315 = concatenate_layer([Zer7197,[[[[[0.8365], [0.112], [0.0955]], [[0.3622], [0.2282], [0.597]]], [[[0.0057], [0.3658], [0.4563]], [[0.2935], [0.9298], [0.4385]]]]]], 4, Con77315), 
LSof7416 = softmax_layer([[[[0.6348, 0.6798]], [[0.0583, 0.6888]]]], 1, Sof7416), 
LRes53379 = reshape_layer(Sof7416, [2, 1, 2, 1], Res53379), 
LCon67409 = concatenate_layer([Res53379,[[[[[0.0194], [0.7899]]], [[[0.0025], [0.3098]]]]]], 4, Con67409), 
LPRe21329 = prelu_layer([[[[[0.4468, 0.9732], [0.2365, 0.5576]]], [[[0.4003, 0.6211], [0.4961, 0.8216]]]]], [[[[0.2925, 0.6222], [0.242, 0.5304]]], [[[0.1064, 0.0652], [0.6935, 0.3615]]]], PRe21329), 
LSub15353 = subtract_layer(Con67409,PRe21329, Sub15353), 
LZer47050 = zero_padding3D_layer(Sub15353, 0, 0, 1, 0, 1, 0, Zer47050), 
LAve76655 = average_layer([Con77315,Zer47050], Ave76655), 
LZer52344 = zero_padding3D_layer(Ave76655, 2, 0, 1, 0, 1, 0, Zer52344), 
LGRU59972 = gru_layer([[[3]]],[[3, 2, 2, 10, 1, 10]],[[1, 9, 4, 10, 4, 3], [2, 7, 3, 1, 1, 3]],[[2, 8, 4, 6, 6, 7], [7, 7, 9, 1, 5, 9]], true, GRU59972), 
LRes920 = reshape_layer(GRU59972, [2, 1], Res920), 
LRes59288 = reshape_layer(Res920, [2, 1, 1], Res59288), 
LZer89177 = zero_padding2D_layer(Res59288, 1, 1, 1, 1, Zer89177), 
LRes47145 = reshape_layer(Zer89177, [4, 3, 1, 1], Res47145), 
LUp_61123 = up_sampling3D_layer(Res47145, 1, 1, 2, Up_61123), 
LZer8678 = zero_padding3D_layer(Up_61123, 0, 0, 0, 0, 2, 0, Zer8678), 
LCon72112 = concatenate_layer([Zer8678,[[[[[0.5517], [0.3121], [0.5082], [0.225]], [[0.9667], [0.2257], [0.3751], [0.7013]], [[0.5621], [0.08], [0.7813], [0.4169]]], [[[0.3164], [0.9384], [0.4961], [0.7167]], [[0.4128], [0.67], [0.3694], [0.2841]], [[0.8149], [0.3582], [0.675], [0.4879]]], [[[0.8004], [0.2296], [0.1633], [0.0174]], [[0.2377], [0.0236], [0.1457], [0.6262]], [[0.9755], [0.8478], [0.6632], [0.7012]]], [[[0.835], [0.4752], [0.548], [0.5442]], [[0.3444], [0.7214], [0.9792], [0.7058]], [[0.5336], [0.017], [0.9543], [0.4515]]]]]], 4, Con72112), 
LMin78609 = minimum_layer([Zer52344,Con72112], Min78609), 
exec_layers([LSub48315,LRes85826,LSep32460,LRes12458,LRes67297,LZer7197,LCon77315,LSof7416,LRes53379,LCon67409,LPRe21329,LSub15353,LZer47050,LAve76655,LZer52344,LGRU59972,LRes920,LRes59288,LZer89177,LRes47145,LUp_61123,LZer8678,LCon72112,LMin78609],["Sub48315","Res85826","Sep32460","Res12458","Res67297","Zer7197","Con77315","Sof7416","Res53379","Con67409","PRe21329","Sub15353","Zer47050","Ave76655","Zer52344","GRU59972","Res920","Res59288","Zer89177","Res47145","Up_61123","Zer8678","Con72112","Min78609"],Min78609,"Min78609")

Actual (Unparsed): [[[[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0236000], [0.0000000, 0.0560000], [0.0000000, 0.0477500]], [[0.0000000, 0.0000000], [0.0000000, 0.1811000], [0.0000000, -0.3628000], [0.0000000, 0.4146500]]], [[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0028500], [0.0000000, 0.1829000], [0.0000000, 0.2281500]], [[0.0000000, 0.0000000], [0.0000000, 0.0170000], [-0.0202808, 0.1556000], [0.0000000, -0.0366500]]]]]

Expected (Unparsed): [[[[[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0]]],[[[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0]]],[[[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0.0236],[0,0.056],[7.582561245556008e-10,0.04775]],[[0,0],[0,0.1811],[0,-0.3628],[0,0.41465]]],[[[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0.00285],[0,0.1829],[0,0.22815]],[[0,0],[0,0.017],[-0.020280829688544083,0.15559999999999996],[0,-0.036650000000000016]]]]]

Actual:   [[[[[0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0]]], [[[0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0]]], [[[0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0.0236], [0, 0.056], [0, 0.0478]], [[0, 0], [0, 0.1811], [0, -0.3628], [0, 0.4147]]], [[[0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0.0029], [0, 0.1829], [0, 0.2282]], [[0, 0], [0, 0.017], [-0.0202, 0.1556], [0, -0.0366]]]]]

Expected: [[[[[0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0]]], [[[0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0]]], [[[0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0.0236], [0, 0.056], [0, 0.0478]], [[0, 0], [0, 0.1811], [0, -0.3628], [0, 0.4147]]], [[[0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0.0029], [0, 0.1829], [0, 0.2282]], [[0, 0], [0, 0.017], [-0.0202, 0.1556], [0, -0.0366]]]]]