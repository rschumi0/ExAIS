import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave8015 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Ave8015 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con64117 = tf.keras.layers.Input(shape=([2, 1]))
in0Dot59399 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot59399 = tf.keras.layers.Input(shape=([2, 2]))

Ave8015 = keras.layers.Average(name = 'Ave8015', )([in0Ave8015,in1Ave8015])
Res11818 = keras.layers.Reshape((2, 2), name = 'Res11818', )(Ave8015)
Glo72569 = keras.layers.GlobalMaxPool1D(name = 'Glo72569', )(Res11818)
Res22037 = keras.layers.Reshape((2, 1), name = 'Res22037', )(Glo72569)
Con64117 = keras.layers.Concatenate(axis=2, name = 'Con64117', )([Res22037,in0Con64117])
Dot59399 = keras.layers.Dot(axes=(1, 2), name = 'Dot59399', )([in0Dot59399,in1Dot59399])
Mas32892 = keras.layers.Masking(mask_value=1, name = 'Mas32892', )(Dot59399)
Add9346 = keras.layers.Add(name = 'Add9346', )([Con64117,Mas32892])
model = tf.keras.models.Model(inputs=[in0Ave8015,in1Ave8015,in0Con64117,in0Dot59399,in1Dot59399], outputs=Add9346)
in0Ave8015 = tf.constant([[[[0.999, 0.9695]], [[0.6133, 0.3993]]]])
in1Ave8015 = tf.constant([[[[0.1857, 0.0978]], [[0.4841, 0.1147]]]])
in0Con64117 = tf.constant([[[0.9993], [0.3296]]])
in0Dot59399 = tf.constant([[[0.8547, 0.2647], [0.7808, 0.8452]]])
in1Dot59399 = tf.constant([[[0.4559, 0.6538], [0.0473, 0.4282]]])
print (np.array2string(model.predict([in0Ave8015,in1Ave8015,in0Con64117,in0Dot59399,in1Dot59399],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add9346.png')

LAve8015 = average_layer([[[[[0.999, 0.9695]], [[0.6133, 0.3993]]]], [[[[0.1857, 0.0978]], [[0.4841, 0.1147]]]]], Ave8015), 
LRes11818 = reshape_layer(Ave8015, [2, 2], Res11818), 
LGlo72569 = global_max_pool1D_layer(Res11818, Glo72569), 
LRes22037 = reshape_layer(Glo72569, [2, 1], Res22037), 
LCon64117 = concatenate_layer([Res22037,[[[0.9993], [0.3296]]]], 2, Con64117), 
LDot59399 = dot_layer([[[0.8547, 0.2647], [0.7808, 0.8452]]], [[[0.4559, 0.6538], [0.0473, 0.4282]]], 1, 2, Dot59399), 
LMas32892 = masking_layer(Dot59399, 1, Mas32892), 
LAdd9346 = add_layer([Con64117,Mas32892], Add9346), 
exec_layers([LAve8015,LRes11818,LGlo72569,LRes22037,LCon64117,LDot59399,LMas32892,LAdd9346],["Ave8015","Res11818","Glo72569","Res22037","Con64117","Dot59399","Mas32892","Add9346"],Add9346,"Add9346")

Actual (Unparsed): [[[1.4924948, 1.3740659], [1.2069185, 0.7040350]]]

Expected (Unparsed): [[[1.4924947700000002,1.37406587],[1.20691849,0.70403495]]]

Actual:   [[[1.4925, 1.3741], [1.207, 0.7041]]]

Expected: [[[1.4925, 1.3741], [1.207, 0.7041]]]