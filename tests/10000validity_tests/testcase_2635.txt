import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul71203 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Mul71203 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Con44409 = tf.keras.layers.Input(shape=([1, 4]))
in0Con44241 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con71170 = tf.keras.layers.Input(shape=([1, 1]))
in0Ave56390 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Ave56390 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Con83936 = tf.keras.layers.Input(shape=([1, 3, 1]))
in0PRe9774 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Ave93476 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Ave93476 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con57746 = tf.keras.layers.Input(shape=([1, 2, 1]))

Mul71203 = keras.layers.Multiply(name = 'Mul71203', )([in0Mul71203,in1Mul71203])
Res82819 = keras.layers.Reshape((1, 1, 2), name = 'Res82819', )(Mul71203)
Res98707 = keras.layers.Reshape((1, 2), name = 'Res98707', )(Res82819)
Con44409 = keras.layers.Concatenate(axis=2, name = 'Con44409', )([Res98707,in0Con44409])
Con44241 = keras.layers.Conv2D(2, (1, 2),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con44241', )(in0Con44241)
Res15490 = keras.layers.Reshape((1, 2), name = 'Res15490', )(Con44241)
Con71170 = keras.layers.Concatenate(axis=2, name = 'Con71170', )([Res15490,in0Con71170])
Ave56390 = keras.layers.Average(name = 'Ave56390', )([in0Ave56390,in1Ave56390])
Res30960 = keras.layers.Reshape((1, 2, 2), name = 'Res30960', )(Ave56390)
Res74007 = keras.layers.Reshape((1, 4), name = 'Res74007', )(Res30960)
Con75036 = keras.layers.Conv1D(3, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con75036', )(Res74007)
Sub2687 = keras.layers.Subtract(name = 'Sub2687', )([Con71170,Con75036])
Res83108 = keras.layers.Reshape((1, 3, 1), name = 'Res83108', )(Sub2687)
Con83936 = keras.layers.Concatenate(axis=3, name = 'Con83936', )([Res83108,in0Con83936])
PRe9774 = keras.layers.PReLU(name = 'PRe9774', input_shape=(1, 2, 2, 1))(in0PRe9774)
Res89973 = keras.layers.Reshape((1, 2, 2), name = 'Res89973', )(PRe9774)
Ave93476 = keras.layers.Average(name = 'Ave93476', )([in0Ave93476,in1Ave93476])
Con57746 = keras.layers.Concatenate(axis=3, name = 'Con57746', )([Ave93476,in0Con57746])
Sub91285 = keras.layers.Subtract(name = 'Sub91285', )([Res89973,Con57746])
Zer88293 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer88293', )(Sub91285)
Max20934 = keras.layers.Maximum(name = 'Max20934', )([Con83936,Zer88293])
Res63557 = keras.layers.Reshape((1, 6), name = 'Res63557', )(Max20934)
Dot8979 = keras.layers.Dot(axes=(2, 2), name = 'Dot8979', )([Con44409,Res63557])
model = tf.keras.models.Model(inputs=[in0Mul71203,in1Mul71203,in0Con44409,in0Con44241,in0Con71170,in0Ave56390,in1Ave56390,in0Con83936,in0PRe9774,in0Ave93476,in1Ave93476,in0Con57746], outputs=Dot8979)
w = model.get_layer('Con44241').get_weights() 
w[0] = np.array([[[[0.5848, 0.4035], [0.5052, 0.9491]], [[0.0294, 0.7096], [0.1878, 0.2511]]]])
w[1] = np.array([0, 0])
model.get_layer('Con44241').set_weights(w) 
w = model.get_layer('Con75036').get_weights() 
w[0] = np.array([[[0.6134, 0.5617, 0.8268], [0.2292, 0.5575, 0.8924], [0.7201, 0.9672, 0.7508], [0.5192, 0.5491, 0.0449]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con75036').set_weights(w) 
w = model.get_layer('PRe9774').get_weights() 
w[0] = np.array([[[[0.8983], [0.6807]], [[0.8194], [0.9883]]]])
model.get_layer('PRe9774').set_weights(w) 
in0Mul71203 = tf.constant([[[[[0.7079], [0.8763]]]]])
in1Mul71203 = tf.constant([[[[[0.2548], [0.5985]]]]])
in0Con44409 = tf.constant([[[0.0259, 0.6796, 0.1894, 0.4853]]])
in0Con44241 = tf.constant([[[[0.4882, 0.1927], [0.5394, 0.8006]]]])
in0Con71170 = tf.constant([[[0.9504]]])
in0Ave56390 = tf.constant([[[[[0.6652], [0.6689]], [[0.5239], [0.9277]]]]])
in1Ave56390 = tf.constant([[[[[0.5133], [0.1969]], [[0.0685], [0.518]]]]])
in0Con83936 = tf.constant([[[[0.2558], [0.5644], [0.516]]]])
in0PRe9774 = tf.constant([[[[[0.8225], [0.6158]], [[0.1441], [0.0163]]]]])
in0Ave93476 = tf.constant([[[[0.1701], [0.5198]]]])
in1Ave93476 = tf.constant([[[[0.5864], [0.1562]]]])
in0Con57746 = tf.constant([[[[0.7957], [0.1092]]]])
print (np.array2string(model.predict([in0Mul71203,in1Mul71203,in0Con44409,in0Con44241,in0Con71170,in0Ave56390,in1Ave56390,in0Con83936,in0PRe9774,in0Ave93476,in1Ave93476,in0Con57746],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot8979.png')

LMul71203 = multiply_layer([[[[[[0.7079], [0.8763]]]]], [[[[[0.2548], [0.5985]]]]]], Mul71203), 
LRes82819 = reshape_layer(Mul71203, [1, 1, 2], Res82819), 
LRes98707 = reshape_layer(Res82819, [1, 2], Res98707), 
LCon44409 = concatenate_layer([Res98707,[[[0.0259, 0.6796, 0.1894, 0.4853]]]], 2, Con44409), 
LCon44241 = conv2D_layer([[[[0.4882, 0.1927], [0.5394, 0.8006]]]], 1, 2,[[[[0.5848, 0.4035], [0.5052, 0.9491]], [[0.0294, 0.7096], [0.1878, 0.2511]]]],[0, 0], 1, 1, false, 1, 1, Con44241), 
LRes15490 = reshape_layer(Con44241, [1, 2], Res15490), 
LCon71170 = concatenate_layer([Res15490,[[[0.9504]]]], 2, Con71170), 
LAve56390 = average_layer([[[[[[0.6652], [0.6689]], [[0.5239], [0.9277]]]]], [[[[[0.5133], [0.1969]], [[0.0685], [0.518]]]]]], Ave56390), 
LRes30960 = reshape_layer(Ave56390, [1, 2, 2], Res30960), 
LRes74007 = reshape_layer(Res30960, [1, 4], Res74007), 
LCon75036 = conv1D_layer(Res74007, 1,[[[0.6134, 0.5617, 0.8268], [0.2292, 0.5575, 0.8924], [0.7201, 0.9672, 0.7508], [0.5192, 0.5491, 0.0449]]],[0, 0, 0], 1, false, 1, Con75036), 
LSub2687 = subtract_layer(Con71170,Con75036, Sub2687), 
LRes83108 = reshape_layer(Sub2687, [1, 3, 1], Res83108), 
LCon83936 = concatenate_layer([Res83108,[[[[0.2558], [0.5644], [0.516]]]]], 3, Con83936), 
LPRe9774 = prelu_layer([[[[[0.8225], [0.6158]], [[0.1441], [0.0163]]]]], [[[[0.8983], [0.6807]], [[0.8194], [0.9883]]]], PRe9774), 
LRes89973 = reshape_layer(PRe9774, [1, 2, 2], Res89973), 
LAve93476 = average_layer([[[[[0.1701], [0.5198]]]], [[[[0.5864], [0.1562]]]]], Ave93476), 
LCon57746 = concatenate_layer([Ave93476,[[[[0.7957], [0.1092]]]]], 3, Con57746), 
LSub91285 = subtract_layer(Res89973,Con57746, Sub91285), 
LZer88293 = zero_padding2D_layer(Sub91285, 0, 0, 1, 0, Zer88293), 
LMax20934 = maximum_layer([Con83936,Zer88293], Max20934), 
LRes63557 = reshape_layer(Max20934, [1, 6], Res63557), 
LDot8979 = dot_layer(Con44409,Res63557, 2, 2, Dot8979), 
exec_layers([LMul71203,LRes82819,LRes98707,LCon44409,LCon44241,LRes15490,LCon71170,LAve56390,LRes30960,LRes74007,LCon75036,LSub2687,LRes83108,LCon83936,LPRe9774,LRes89973,LAve93476,LCon57746,LSub91285,LZer88293,LMax20934,LRes63557,LDot8979],["Mul71203","Res82819","Res98707","Con44409","Con44241","Res15490","Con71170","Ave56390","Res30960","Res74007","Con75036","Sub2687","Res83108","Con83936","PRe9774","Res89973","Ave93476","Con57746","Sub91285","Zer88293","Max20934","Res63557","Dot8979"],Dot8979,"Dot8979")

Actual (Unparsed): [[[0.7459408]]]

Expected (Unparsed): [[[0.745940766411]]]

Actual:   [[[0.746]]]

Expected: [[[0.746]]]