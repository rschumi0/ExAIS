import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub48001 = tf.keras.layers.Input(shape=([3, 2, 3]))
in1Sub48001 = tf.keras.layers.Input(shape=([3, 2, 3]))
in0Dot46070 = tf.keras.layers.Input(shape=([2]))
in1Dot46070 = tf.keras.layers.Input(shape=([2]))
in0Con24975 = tf.keras.layers.Input(shape=([17]))

Sub48001 = keras.layers.Subtract(name = 'Sub48001', )([in0Sub48001,in1Sub48001])
Res28544 = keras.layers.Reshape((3, 6), name = 'Res28544', )(Sub48001)
Fla50973 = keras.layers.Flatten(name = 'Fla50973', )(Res28544)
Dot46070 = keras.layers.Dot(axes=(1, 1), name = 'Dot46070', )([in0Dot46070,in1Dot46070])
Con24975 = keras.layers.Concatenate(axis=1, name = 'Con24975', )([Dot46070,in0Con24975])
Add28167 = keras.layers.Add(name = 'Add28167', )([Fla50973,Con24975])
Res43721 = keras.layers.Reshape((18, 1), name = 'Res43721', )(Add28167)
Res95430 = keras.layers.Reshape((18, 1, 1), name = 'Res95430', )(Res43721)
Glo64657 = keras.layers.GlobalAveragePooling2D(name = 'Glo64657', )(Res95430)
Bat19114 = keras.layers.BatchNormalization(axis=1, epsilon=0.24824456767725556,  name = 'Bat19114', )(Glo64657)
model = tf.keras.models.Model(inputs=[in0Sub48001,in1Sub48001,in0Dot46070,in1Dot46070,in0Con24975], outputs=Bat19114)
w = model.get_layer('Bat19114').get_weights() 
w[0] = np.array([0.9097])
w[1] = np.array([0.6728])
w[2] = np.array([0.7792])
w[3] = np.array([0.0246])
model.get_layer('Bat19114').set_weights(w) 
in0Sub48001 = tf.constant([[[[0.5924, 0.3861, 0.4162], [0.0263, 0.909, 0.8889]], [[0.6906, 0.1837, 0.4721], [0.7955, 0.9936, 0.51]], [[0.6083, 0.8461, 0.5513], [0.6367, 0.3952, 0.9001]]]])
in1Sub48001 = tf.constant([[[[0.8713, 0.441, 0.6775], [0.6922, 0.4458, 0.6013]], [[0.0271, 0.5783, 0.3059], [0.2443, 0.9814, 0.6759]], [[0.0557, 0.149, 0.0544], [0.8088, 0.4385, 0.8729]]]])
in0Dot46070 = tf.constant([[0.9482, 0.7091]])
in1Dot46070 = tf.constant([[0.1898, 0.5971]])
in0Con24975 = tf.constant([[0.5184, 0.9546, 0.5085, 0.246, 0.8311, 0.1675, 0.0663, 0.4848, 0.103, 0.344, 0.7232, 0.1562, 0.5317, 0.0096, 0.7667, 0.4973, 0.963]])
print (np.array2string(model.predict([in0Sub48001,in1Sub48001,in0Dot46070,in1Dot46070,in0Con24975],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Bat19114.png')

LSub48001 = subtract_layer([[[[0.5924, 0.3861, 0.4162], [0.0263, 0.909, 0.8889]], [[0.6906, 0.1837, 0.4721], [0.7955, 0.9936, 0.51]], [[0.6083, 0.8461, 0.5513], [0.6367, 0.3952, 0.9001]]]], [[[[0.8713, 0.441, 0.6775], [0.6922, 0.4458, 0.6013]], [[0.0271, 0.5783, 0.3059], [0.2443, 0.9814, 0.6759]], [[0.0557, 0.149, 0.0544], [0.8088, 0.4385, 0.8729]]]], Sub48001), 
LRes28544 = reshape_layer(Sub48001, [3, 6], Res28544), 
LFla50973 = flatten_layer(Res28544, Fla50973), 
LDot46070 = dot_layer([[0.9482, 0.7091]], [[0.1898, 0.5971]], 1, 1, Dot46070), 
LCon24975 = concatenate_layer([Dot46070,[[0.5184, 0.9546, 0.5085, 0.246, 0.8311, 0.1675, 0.0663, 0.4848, 0.103, 0.344, 0.7232, 0.1562, 0.5317, 0.0096, 0.7667, 0.4973, 0.963]]], 1, Con24975), 
LAdd28167 = add_layer([Fla50973,Con24975], Add28167), 
LRes43721 = reshape_layer(Add28167, [18, 1], Res43721), 
LRes95430 = reshape_layer(Res43721, [18, 1, 1], Res95430), 
LGlo64657 = global_average_pooling2D_layer(Res95430, Glo64657), 
LBat19114 = batch_normalization_layer(Glo64657, 1, 0.24824456767725556, [0.9097], [0.6728], [0.7792], [0.0246], Bat19114), 
exec_layers([LSub48001,LRes28544,LFla50973,LDot46070,LCon24975,LAdd28167,LRes43721,LRes95430,LGlo64657,LBat19114],["Sub48001","Res28544","Fla50973","Dot46070","Con24975","Add28167","Res43721","Res95430","Glo64657","Bat19114"],Bat19114,"Bat19114")

Actual (Unparsed): [[0.3177592]]

Expected (Unparsed): [[0.31775921645532296]]

Actual:   [[0.3178]]

Expected: [[0.3178]]