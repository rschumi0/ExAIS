import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Zer78475 = tf.keras.layers.Input(shape=([3, 3]))
in0Min10598 = tf.keras.layers.Input(shape=([2, 1]))
in1Min10598 = tf.keras.layers.Input(shape=([2, 1]))
in0Glo3855 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con2223 = tf.keras.layers.Input(shape=([13]))
in0Add90554 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Add90554 = tf.keras.layers.Input(shape=([2, 2, 1]))

Zer78475 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer78475', )(in0Zer78475)
Fla70963 = keras.layers.Flatten(name = 'Fla70963', )(Zer78475)
Min10598 = keras.layers.Minimum(name = 'Min10598', )([in0Min10598,in1Min10598])
Fla88582 = keras.layers.Flatten(name = 'Fla88582', )(Min10598)
Glo3855 = keras.layers.GlobalAveragePooling2D(name = 'Glo3855', )(in0Glo3855)
Sub86943 = keras.layers.Subtract(name = 'Sub86943', )([Fla88582,Glo3855])
Con2223 = keras.layers.Concatenate(axis=1, name = 'Con2223', )([Sub86943,in0Con2223])
Ave55407 = keras.layers.Average(name = 'Ave55407', )([Fla70963,Con2223])
Res90692 = keras.layers.Reshape((15, 1), name = 'Res90692', )(Ave55407)
Res43761 = keras.layers.Reshape((15, 1, 1), name = 'Res43761', )(Res90692)
Zer94775 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer94775', )(Res43761)
Add90554 = keras.layers.Add(name = 'Add90554', )([in0Add90554,in1Add90554])
Zer5737 = keras.layers.ZeroPadding2D(padding=((13, 0), (1, 0)), name = 'Zer5737', )(Add90554)
Min13668 = keras.layers.Minimum(name = 'Min13668', )([Zer94775,Zer5737])
Res52561 = keras.layers.Reshape((15, 3), name = 'Res52561', )(Min13668)
LST34724 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST34724', )(Res52561)
model = tf.keras.models.Model(inputs=[in0Zer78475,in0Min10598,in1Min10598,in0Glo3855,in0Con2223,in0Add90554,in1Add90554], outputs=LST34724)
w = model.get_layer('LST34724').get_weights() 
w[0] = np.array([[7, 5, 8, 6], [9, 1, 4, 5], [7, 2, 2, 1]])
w[1] = np.array([[6, 4, 10, 10]])
w[2] = np.array([6, 6, 7, 5])
model.get_layer('LST34724').set_weights(w) 
in0Zer78475 = tf.constant([[[1.2897, 1.3333, 1.5372], [1.1106, 1.8749, 1.0207], [1.3897, 1.0717, 1.75]]])
in0Min10598 = tf.constant([[[0.4091], [0.879]]])
in1Min10598 = tf.constant([[[0.2847], [0.2797]]])
in0Glo3855 = tf.constant([[[[1.8908, 1.0491]]]])
in0Con2223 = tf.constant([[0.3915, 0.2606, 0.1254, 0.6918, 0.9099, 0.0582, 0.6021, 0.2302, 0.0686, 0.9047, 0.3875, 0.4039, 0.4845]])
in0Add90554 = tf.constant([[[[0.1359], [0.6247]], [[0.7967], [0.3957]]]])
in1Add90554 = tf.constant([[[[0.4931], [0.4194]], [[0.0761], [0.7339]]]])
print (np.array2string(model.predict([in0Zer78475,in0Min10598,in1Min10598,in0Glo3855,in0Con2223,in0Add90554,in1Add90554],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST34724.png')

LZer78475 = zero_padding1D_layer([[[1.2897, 1.3333, 1.5372], [1.1106, 1.8749, 1.0207], [1.3897, 1.0717, 1.75]]], 1, 1, Zer78475), 
LFla70963 = flatten_layer(Zer78475, Fla70963), 
LMin10598 = minimum_layer([[[[0.4091], [0.879]]], [[[0.2847], [0.2797]]]], Min10598), 
LFla88582 = flatten_layer(Min10598, Fla88582), 
LGlo3855 = global_average_pooling2D_layer([[[[1.8908, 1.0491]]]], Glo3855), 
LSub86943 = subtract_layer(Fla88582,Glo3855, Sub86943), 
LCon2223 = concatenate_layer([Sub86943,[[0.3915, 0.2606, 0.1254, 0.6918, 0.9099, 0.0582, 0.6021, 0.2302, 0.0686, 0.9047, 0.3875, 0.4039, 0.4845]]], 1, Con2223), 
LAve55407 = average_layer([Fla70963,Con2223], Ave55407), 
LRes90692 = reshape_layer(Ave55407, [15, 1], Res90692), 
LRes43761 = reshape_layer(Res90692, [15, 1, 1], Res43761), 
LZer94775 = zero_padding2D_layer(Res43761, 0, 0, 2, 0, Zer94775), 
LAdd90554 = add_layer([[[[[0.1359], [0.6247]], [[0.7967], [0.3957]]]], [[[[0.4931], [0.4194]], [[0.0761], [0.7339]]]]], Add90554), 
LZer5737 = zero_padding2D_layer(Add90554, 13, 0, 1, 0, Zer5737), 
LMin13668 = minimum_layer([Zer94775,Zer5737], Min13668), 
LRes52561 = reshape_layer(Min13668, [15, 3], Res52561), 
LLST34724 = lstm_layer(Res52561,[[7, 5, 8, 6], [9, 1, 4, 5], [7, 2, 2, 1]],[[6, 4, 10, 10]],[6, 6, 7, 5], LST34724), 
exec_layers([LZer78475,LFla70963,LMin10598,LFla88582,LGlo3855,LSub86943,LCon2223,LAve55407,LRes90692,LRes43761,LZer94775,LAdd90554,LZer5737,LMin13668,LRes52561,LLST34724],["Zer78475","Fla70963","Min10598","Fla88582","Glo3855","Sub86943","Con2223","Ave55407","Res90692","Res43761","Zer94775","Add90554","Zer5737","Min13668","Res52561","LST34724"],LST34724,"LST34724")

Actual (Unparsed): [[0.9999998]]

Expected (Unparsed): [[0.9999997599085542]]

Actual:   [[1]]

Expected: [[1]]