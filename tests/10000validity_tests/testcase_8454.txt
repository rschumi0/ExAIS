import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Den37978 = tf.keras.layers.Input(shape=([2, 4, 4]))
in0Sub51802 = tf.keras.layers.Input(shape=([2]))
in1Sub51802 = tf.keras.layers.Input(shape=([2]))
in0Con31911 = tf.keras.layers.Input(shape=([2, 5]))

Den37978 = keras.layers.Dense(2,name = 'Den37978', )(in0Den37978)
Res57115 = keras.layers.Reshape((2, 8), name = 'Res57115', )(Den37978)
Sub51802 = keras.layers.Subtract(name = 'Sub51802', )([in0Sub51802,in1Sub51802])
Res48579 = keras.layers.Reshape((2, 1), name = 'Res48579', )(Sub51802)
Loc60119 = keras.layers.LocallyConnected1D(3, (1),strides=(1), name = 'Loc60119', )(Res48579)
Thr61565 = keras.layers.ThresholdedReLU(theta=1.8941287883461504, name = 'Thr61565', )(Loc60119)
Con31911 = keras.layers.Concatenate(axis=2, name = 'Con31911', )([Thr61565,in0Con31911])
Add15285 = keras.layers.Add(name = 'Add15285', )([Res57115,Con31911])
Con9368 = keras.layers.Conv1D(3, (2),strides=(1), padding='same', dilation_rate=(1), name = 'Con9368', )(Add15285)
model = tf.keras.models.Model(inputs=[in0Den37978,in0Sub51802,in1Sub51802,in0Con31911], outputs=Con9368)
w = model.get_layer('Den37978').get_weights() 
w[0] = np.array([[0.0106, 0.0106], [0.6169, 0.5731], [0.2836, 0.5273], [0.7168, 0.6974]])
w[1] = np.array([0.6732, 0.7446])
model.get_layer('Den37978').set_weights(w) 
w = model.get_layer('Loc60119').get_weights() 
w[0] = np.array([[[0.522, 0.5092, 0.0342]], [[0.0008, 0.6559, 0.4233]]])
w[1] = np.array([[0, 0, 0], [0, 0, 0]])
model.get_layer('Loc60119').set_weights(w) 
w = model.get_layer('Con9368').get_weights() 
w[0] = np.array([[[0.1575, 0.3128, 0.7309], [0.951, 0.8069, 0.2948], [0.725, 0.5641, 0.2768], [0.4096, 0.1662, 0.8191], [0.1525, 0.727, 0.1639], [0.706, 0.5608, 0.7562], [0.9169, 0.0946, 0.8932], [0.2383, 0.8525, 0.5832]], [[0.0499, 0.1387, 0.4102], [0.3879, 0.8546, 0.2123], [0.7709, 0.0318, 0.8446], [0.3581, 0.0247, 0.7042], [0.7326, 0.6069, 0.5032], [0.5521, 0.4475, 0.9916], [0.2562, 0.8364, 0.8176], [0.7394, 0.9458, 0.8437]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con9368').set_weights(w) 
in0Den37978 = tf.constant([[[[0.0262, 0.5293, 0.7031, 0.985], [0.7574, 0.7356, 0.9757, 0.4358], [0.6418, 0.8569, 0.0012, 0.9767], [0.6017, 0.2922, 0.614, 0.2408]], [[0.3386, 0.9088, 0.4255, 0.748], [0.0389, 0.6258, 0.8527, 0.055], [0.551, 0.9968, 0.524, 0.8252], [0.9205, 0.2796, 0.76, 0.9194]]]])
in0Sub51802 = tf.constant([[0.6777, 0.4051]])
in1Sub51802 = tf.constant([[0.2311, 0.0478]])
in0Con31911 = tf.constant([[[0.1453, 0.9871, 0.1335, 0.6661, 0.153], [0.73, 0.4683, 0.1246, 0.8322, 0.3865]]])
print (np.array2string(model.predict([in0Den37978,in0Sub51802,in1Sub51802,in0Con31911],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con9368.png')

LDen37978 = dense_layer([[[[0.0262, 0.5293, 0.7031, 0.985], [0.7574, 0.7356, 0.9757, 0.4358], [0.6418, 0.8569, 0.0012, 0.9767], [0.6017, 0.2922, 0.614, 0.2408]], [[0.3386, 0.9088, 0.4255, 0.748], [0.0389, 0.6258, 0.8527, 0.055], [0.551, 0.9968, 0.524, 0.8252], [0.9205, 0.2796, 0.76, 0.9194]]]], [[0.0106, 0.0106], [0.6169, 0.5731], [0.2836, 0.5273], [0.7168, 0.6974]],[0.6732, 0.7446], Den37978), 
LRes57115 = reshape_layer(Den37978, [2, 8], Res57115), 
LSub51802 = subtract_layer([[0.6777, 0.4051]], [[0.2311, 0.0478]], Sub51802), 
LRes48579 = reshape_layer(Sub51802, [2, 1], Res48579), 
LLoc60119 = locally_connected1D_layer(Res48579, 1,[[[0.522, 0.5092, 0.0342]], [[0.0008, 0.6559, 0.4233]]],[[0, 0, 0], [0, 0, 0]], 1, Loc60119), 
LThr61565 = thresholded_relu_layer(Loc60119, 1.8941287883461504, Thr61565), 
LCon31911 = concatenate_layer([Thr61565,[[[0.1453, 0.9871, 0.1335, 0.6661, 0.153], [0.73, 0.4683, 0.1246, 0.8322, 0.3865]]]], 2, Con31911), 
LAdd15285 = add_layer([Res57115,Con31911], Add15285), 
LCon9368 = conv1D_layer(Add15285, 2,[[[0.1575, 0.3128, 0.7309], [0.951, 0.8069, 0.2948], [0.725, 0.5641, 0.2768], [0.4096, 0.1662, 0.8191], [0.1525, 0.727, 0.1639], [0.706, 0.5608, 0.7562], [0.9169, 0.0946, 0.8932], [0.2383, 0.8525, 0.5832]], [[0.0499, 0.1387, 0.4102], [0.3879, 0.8546, 0.2123], [0.7709, 0.0318, 0.8446], [0.3581, 0.0247, 0.7042], [0.7326, 0.6069, 0.5032], [0.5521, 0.4475, 0.9916], [0.2562, 0.8364, 0.8176], [0.7394, 0.9458, 0.8437]]],[0, 0, 0], 1, true, 1, Con9368), 
exec_layers([LDen37978,LRes57115,LSub51802,LRes48579,LLoc60119,LThr61565,LCon31911,LAdd15285,LCon9368],["Den37978","Res57115","Sub51802","Res48579","Loc60119","Thr61565","Con31911","Add15285","Con9368"],Con9368,"Con9368")

Actual (Unparsed): [[[16.6446494, 17.3833487, 20.4389114], [9.0494702, 8.7085607, 10.0543645]]]

Expected (Unparsed): [[[16.644649341964,17.383348651601,20.438911375318003],[9.049470208458,8.708560695903001,10.054364469261001]]]

Actual:   [[[16.6447, 17.3834, 20.439], [9.0495, 8.7086, 10.0544]]]

Expected: [[[16.6447, 17.3834, 20.439], [9.0495, 8.7086, 10.0544]]]