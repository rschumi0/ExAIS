import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub38869 = tf.keras.layers.Input(shape=([3, 3, 2, 2]))
in1Sub38869 = tf.keras.layers.Input(shape=([3, 3, 2, 2]))

Sub38869 = keras.layers.Subtract(name = 'Sub38869', )([in0Sub38869,in1Sub38869])
Res24036 = keras.layers.Reshape((3, 3, 4), name = 'Res24036', )(Sub38869)
Con11478 = keras.layers.Conv2D(2, (1, 3),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con11478', )(Res24036)
model = tf.keras.models.Model(inputs=[in0Sub38869,in1Sub38869], outputs=Con11478)
w = model.get_layer('Con11478').get_weights() 
w[0] = np.array([[[[0.5076, 0.2601], [0.9372, 0.0669], [0.3445, 0.1297], [0.5257, 0.3632]], [[0.34, 0.0288], [0.5584, 0.5945], [0.5762, 0.9825], [0.0332, 0.4626]], [[0.7664, 0.581], [0.1819, 0.788], [0.4693, 0.8632], [0.5678, 0.0772]]]])
w[1] = np.array([0, 0])
model.get_layer('Con11478').set_weights(w) 
in0Sub38869 = tf.constant([[[[[0.6634, 0.5481], [0.2825, 0.4888]], [[0.7881, 0.3194], [0.5641, 0.3834]], [[0.7799, 0.5401], [0.2928, 0.21]]], [[[0.8277, 0.634], [0.7861, 0.7324]], [[0.7206, 0.7944], [0.8792, 0.9165]], [[0.3516, 0.6268], [0.1892, 0.9802]]], [[[0.5413, 0.8527], [0.8215, 0.4889]], [[0.3527, 0.1055], [0.8306, 0.5944]], [[0.4867, 0.9307], [0.5584, 0.6124]]]]])
in1Sub38869 = tf.constant([[[[[0.7926, 0.4608], [0.304, 0.0064]], [[0.4058, 0.8784], [0.6527, 0.5065]], [[0.534, 0.704], [0.1875, 0.5279]]], [[[0.453, 0.1471], [0.2388, 0.2729]], [[0.8437, 0.2481], [0.7892, 0.9048]], [[0.206, 0.3002], [0.6448, 0.9596]]], [[[0.7186, 0.0941], [0.5062, 0.7285]], [[0.577, 0.8518], [0.6309, 0.688]], [[0.5408, 0.331], [0.3643, 0.1784]]]]])
print (np.array2string(model.predict([in0Sub38869,in1Sub38869],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con11478.png')

LSub38869 = subtract_layer([[[[[0.6634, 0.5481], [0.2825, 0.4888]], [[0.7881, 0.3194], [0.5641, 0.3834]], [[0.7799, 0.5401], [0.2928, 0.21]]], [[[0.8277, 0.634], [0.7861, 0.7324]], [[0.7206, 0.7944], [0.8792, 0.9165]], [[0.3516, 0.6268], [0.1892, 0.9802]]], [[[0.5413, 0.8527], [0.8215, 0.4889]], [[0.3527, 0.1055], [0.8306, 0.5944]], [[0.4867, 0.9307], [0.5584, 0.6124]]]]], [[[[[0.7926, 0.4608], [0.304, 0.0064]], [[0.4058, 0.8784], [0.6527, 0.5065]], [[0.534, 0.704], [0.1875, 0.5279]]], [[[0.453, 0.1471], [0.2388, 0.2729]], [[0.8437, 0.2481], [0.7892, 0.9048]], [[0.206, 0.3002], [0.6448, 0.9596]]], [[[0.7186, 0.0941], [0.5062, 0.7285]], [[0.577, 0.8518], [0.6309, 0.688]], [[0.5408, 0.331], [0.3643, 0.1784]]]]], Sub38869), 
LRes24036 = reshape_layer(Sub38869, [3, 3, 4], Res24036), 
LCon11478 = conv2D_layer(Res24036, 1, 3,[[[[0.5076, 0.2601], [0.9372, 0.0669], [0.3445, 0.1297], [0.5257, 0.3632]], [[0.34, 0.0288], [0.5584, 0.5945], [0.5762, 0.9825], [0.0332, 0.4626]], [[0.7664, 0.581], [0.1819, 0.788], [0.4693, 0.8632], [0.5678, 0.0772]]]],[0, 0], 1, 1, true, 1, 1, Con11478), 
exec_layers([LSub38869,LRes24036,LCon11478],["Sub38869","Res24036","Con11478"],Con11478,"Con11478")

Actual (Unparsed): [[[[0.0882842, -0.0541452], [0.0526828, -0.2405884], [-0.3828719, -0.1281221]], [[0.7838010, 1.4880948], [1.3609507, 0.7332465], [0.4567071, -0.2192889]], [[0.2699590, 0.0915771], [0.6277288, 0.3034604], [-0.3509683, 0.6300728]]]]

Expected (Unparsed): [[[[0.0882841600000001,-0.05414515999999987],[0.05268275000000011,-0.2405884599999998],[-0.38287186999999984,-0.12812212999999995]],[[0.78380101,1.4880949],[1.36095074,0.73324658],[0.45670712999999996,-0.21928886000000003]],[[0.26995902000000016,0.09157717000000012],[0.6277287900000003,0.30346041999999995],[-0.3509682099999999,0.6300728900000001]]]]

Actual:   [[[[0.0883, -0.0541], [0.0527, -0.2405], [-0.3828, -0.1281]], [[0.7839, 1.4881], [1.361, 0.7333], [0.4568, -0.2192]], [[0.27, 0.0916], [0.6278, 0.3035], [-0.3509, 0.6301]]]]

Expected: [[[[0.0883, -0.0541], [0.0527, -0.2405], [-0.3828, -0.1281]], [[0.7839, 1.4881], [1.361, 0.7333], [0.4568, -0.2192]], [[0.27, 0.0916], [0.6278, 0.3035], [-0.3509, 0.6301]]]]