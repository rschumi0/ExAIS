import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Lay70310 = tf.keras.layers.Input(shape=([2]))
in0Con16519 = tf.keras.layers.Input(shape=([1, 2]))
in0Up_32216 = tf.keras.layers.Input(shape=([4, 4, 2, 3]))
in0Glo48189 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Glo40617 = tf.keras.layers.Input(shape=([1, 2]))

Lay70310 = keras.layers.LayerNormalization(axis=1, epsilon=1.561868281444689, name = 'Lay70310', )(in0Lay70310)
Res58640 = keras.layers.Reshape((2, 1), name = 'Res58640', )(Lay70310)
Res72987 = keras.layers.Reshape((2, 1, 1), name = 'Res72987', )(Res58640)
Glo88116 = keras.layers.GlobalMaxPool2D(name = 'Glo88116', )(Res72987)
Res37035 = keras.layers.Reshape((1, 1), name = 'Res37035', )(Glo88116)
Con16519 = keras.layers.Concatenate(axis=2, name = 'Con16519', )([Res37035,in0Con16519])
Up_32216 = keras.layers.UpSampling3D(size=(2, 1, 1), name = 'Up_32216', )(in0Up_32216)
Glo93138 = keras.layers.GlobalMaxPool3D(name = 'Glo93138', )(Up_32216)
Res48116 = keras.layers.Reshape((3, 1), name = 'Res48116', )(Glo93138)
Res91577 = keras.layers.Reshape((3, 1, 1), name = 'Res91577', )(Res48116)
Zer94006 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer94006', )(Res91577)
Glo48189 = keras.layers.GlobalAveragePooling2D(name = 'Glo48189', )(in0Glo48189)
Glo40617 = keras.layers.GlobalMaxPool1D(name = 'Glo40617', )(in0Glo40617)
Add59924 = keras.layers.Add(name = 'Add59924', )([Glo48189,Glo40617])
Res99203 = keras.layers.Reshape((2, 1), name = 'Res99203', )(Add59924)
Res73921 = keras.layers.Reshape((2, 1, 1), name = 'Res73921', )(Res99203)
Zer62132 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer62132', )(Res73921)
Sub68874 = keras.layers.Subtract(name = 'Sub68874', )([Zer94006,Zer62132])
Res2545 = keras.layers.Reshape((4, 3), name = 'Res2545', )(Sub68874)
Dot21347 = keras.layers.Dot(axes=(2, 2), name = 'Dot21347', )([Con16519,Res2545])
Sim12903 = keras.layers.SimpleRNN(3,name = 'Sim12903', )(Dot21347)
model = tf.keras.models.Model(inputs=[in0Lay70310,in0Con16519,in0Up_32216,in0Glo48189,in0Glo40617], outputs=Sim12903)
w = model.get_layer('Sim12903').get_weights() 
w[0] = np.array([[5, 3, 3], [4, 10, 4], [2, 1, 6], [6, 5, 5]])
w[1] = np.array([[6, 7, 7], [2, 6, 10], [2, 3, 6]])
w[2] = np.array([5, 7, 7])
model.get_layer('Sim12903').set_weights(w) 
in0Lay70310 = tf.constant([[1.2045, 1.7159]])
in0Con16519 = tf.constant([[[0.5856, 0.2621]]])
in0Up_32216 = tf.constant([[[[[1.6525, 1.2248, 1.304], [1.6699, 1.2958, 1.3722]], [[1.9595, 1.264, 1.4469], [1.9998, 1.4636, 1.4385]], [[1.7309, 1.3432, 1.508], [1.6625, 1.6076, 1.1192]], [[1.3449, 1.5437, 1.0998], [1.9262, 1.0526, 1.1833]]], [[[1.9253, 1.2706, 1.5262], [1.3423, 1.7144, 1.9458]], [[1.2859, 1.7192, 1.7941], [1.1739, 1.5758, 1.0235]], [[1.2303, 1.2607, 1.5125], [1.0769, 1.4325, 1.5129]], [[1.2361, 1.8711, 1.6447], [1.8189, 1.1115, 1.3696]]], [[[1.0769, 1.6036, 1.0375], [1.8536, 1.2591, 1.8352]], [[1.8287, 1.7785, 1.4453], [1.3819, 1.4536, 1.4372]], [[1.5333, 1.2971, 1.6369], [1.2028, 1.0253, 1.5428]], [[1.9626, 1.7653, 1.006], [1.257, 1.1513, 1.5678]]], [[[1.9838, 1.9119, 1.6274], [1.5998, 1.7077, 1.6174]], [[1.84, 1.8105, 1.752], [1.3831, 1.0577, 1.6684]], [[1.7422, 1.3656, 1.5163], [1.8121, 1.5849, 1.0033]], [[1.8679, 1.3124, 1.9618], [1.4663, 1.8525, 1.7975]]]]])
in0Glo48189 = tf.constant([[[[1.6462, 1.036], [1.9932, 1.58]], [[1.9126, 1.8674], [1.9024, 1.9705]]]])
in0Glo40617 = tf.constant([[[1.4204, 1.0867]]])
print (np.array2string(model.predict([in0Lay70310,in0Con16519,in0Up_32216,in0Glo48189,in0Glo40617],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sim12903.png')

LLay70310 = layer_normalization_layer([[1.2045, 1.7159]], 1, 1.561868281444689, Lay70310), 
LRes58640 = reshape_layer(Lay70310, [2, 1], Res58640), 
LRes72987 = reshape_layer(Res58640, [2, 1, 1], Res72987), 
LGlo88116 = global_max_pool2D_layer(Res72987, Glo88116), 
LRes37035 = reshape_layer(Glo88116, [1, 1], Res37035), 
LCon16519 = concatenate_layer([Res37035,[[[0.5856, 0.2621]]]], 2, Con16519), 
LUp_32216 = up_sampling3D_layer([[[[[1.6525, 1.2248, 1.304], [1.6699, 1.2958, 1.3722]], [[1.9595, 1.264, 1.4469], [1.9998, 1.4636, 1.4385]], [[1.7309, 1.3432, 1.508], [1.6625, 1.6076, 1.1192]], [[1.3449, 1.5437, 1.0998], [1.9262, 1.0526, 1.1833]]], [[[1.9253, 1.2706, 1.5262], [1.3423, 1.7144, 1.9458]], [[1.2859, 1.7192, 1.7941], [1.1739, 1.5758, 1.0235]], [[1.2303, 1.2607, 1.5125], [1.0769, 1.4325, 1.5129]], [[1.2361, 1.8711, 1.6447], [1.8189, 1.1115, 1.3696]]], [[[1.0769, 1.6036, 1.0375], [1.8536, 1.2591, 1.8352]], [[1.8287, 1.7785, 1.4453], [1.3819, 1.4536, 1.4372]], [[1.5333, 1.2971, 1.6369], [1.2028, 1.0253, 1.5428]], [[1.9626, 1.7653, 1.006], [1.257, 1.1513, 1.5678]]], [[[1.9838, 1.9119, 1.6274], [1.5998, 1.7077, 1.6174]], [[1.84, 1.8105, 1.752], [1.3831, 1.0577, 1.6684]], [[1.7422, 1.3656, 1.5163], [1.8121, 1.5849, 1.0033]], [[1.8679, 1.3124, 1.9618], [1.4663, 1.8525, 1.7975]]]]], 2, 1, 1, Up_32216), 
LGlo93138 = global_max_pool3D_layer(Up_32216, Glo93138), 
LRes48116 = reshape_layer(Glo93138, [3, 1], Res48116), 
LRes91577 = reshape_layer(Res48116, [3, 1, 1], Res91577), 
LZer94006 = zero_padding2D_layer(Res91577, 1, 0, 2, 0, Zer94006), 
LGlo48189 = global_average_pooling2D_layer([[[[1.6462, 1.036], [1.9932, 1.58]], [[1.9126, 1.8674], [1.9024, 1.9705]]]], Glo48189), 
LGlo40617 = global_max_pool1D_layer([[[1.4204, 1.0867]]], Glo40617), 
LAdd59924 = add_layer([Glo48189,Glo40617], Add59924), 
LRes99203 = reshape_layer(Add59924, [2, 1], Res99203), 
LRes73921 = reshape_layer(Res99203, [2, 1, 1], Res73921), 
LZer62132 = zero_padding2D_layer(Res73921, 1, 1, 1, 1, Zer62132), 
LSub68874 = subtract_layer(Zer94006,Zer62132, Sub68874), 
LRes2545 = reshape_layer(Sub68874, [4, 3], Res2545), 
LDot21347 = dot_layer(Con16519,Res2545, 2, 2, Dot21347), 
LSim12903 = simple_rnn_layer(Dot21347,[[5, 3, 3], [4, 10, 4], [2, 1, 6], [6, 5, 5]],[[6, 7, 7], [2, 6, 10], [2, 3, 6]],[5, 7, 7], Sim12903), 
exec_layers([LLay70310,LRes58640,LRes72987,LGlo88116,LRes37035,LCon16519,LUp_32216,LGlo93138,LRes48116,LRes91577,LZer94006,LGlo48189,LGlo40617,LAdd59924,LRes99203,LRes73921,LZer62132,LSub68874,LRes2545,LDot21347,LSim12903],["Lay70310","Res58640","Res72987","Glo88116","Res37035","Con16519","Up_32216","Glo93138","Res48116","Res91577","Zer94006","Glo48189","Glo40617","Add59924","Res99203","Res73921","Zer62132","Sub68874","Res2545","Dot21347","Sim12903"],Sim12903,"Sim12903")

Actual (Unparsed): [[0.3176654, -0.9999665, -0.9867622]]

Expected (Unparsed): [[0.3176654809331503,-0.9999665170813775,-0.9867622191476586]]

Actual:   [[0.3177, -0.9999, -0.9867]]

Expected: [[0.3177, -0.9999, -0.9867]]