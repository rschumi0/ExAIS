import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul42123 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul42123 = tf.keras.layers.Input(shape=([2, 2]))
in0Add14671 = tf.keras.layers.Input(shape=([1, 1]))
in1Add14671 = tf.keras.layers.Input(shape=([1, 1]))

Mul42123 = keras.layers.Multiply(name = 'Mul42123', )([in0Mul42123,in1Mul42123])
Res84753 = keras.layers.Reshape((2, 2, 1), name = 'Res84753', )(Mul42123)
Res38946 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res38946', )(Res84753)
Zer71318 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (2, 0)), name = 'Zer71318', )(Res38946)
Add14671 = keras.layers.Add(name = 'Add14671', )([in0Add14671,in1Add14671])
Res85789 = keras.layers.Reshape((1, 1, 1), name = 'Res85789', )(Add14671)
Res95475 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res95475', )(Res85789)
Zer18759 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer18759', )(Res95475)
Sub16991 = keras.layers.Subtract(name = 'Sub16991', )([Zer71318,Zer18759])
model = tf.keras.models.Model(inputs=[in0Mul42123,in1Mul42123,in0Add14671,in1Add14671], outputs=Sub16991)
in0Mul42123 = tf.constant([[[0.1316, 0.6009], [0.1361, 0.3135]]])
in1Mul42123 = tf.constant([[[0.1457, 0.973], [0.1529, 0.6414]]])
in0Add14671 = tf.constant([[[0.6697]]])
in1Add14671 = tf.constant([[[0.9075]]])
print (np.array2string(model.predict([in0Mul42123,in1Mul42123,in0Add14671,in1Add14671],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub16991.png')

LMul42123 = multiply_layer([[[[0.1316, 0.6009], [0.1361, 0.3135]]], [[[0.1457, 0.973], [0.1529, 0.6414]]]], Mul42123), 
LRes84753 = reshape_layer(Mul42123, [2, 2, 1], Res84753), 
LRes38946 = reshape_layer(Res84753, [2, 2, 1, 1], Res38946), 
LZer71318 = zero_padding3D_layer(Res38946, 1, 0, 1, 0, 2, 0, Zer71318), 
LAdd14671 = add_layer([[[[0.6697]]], [[[0.9075]]]], Add14671), 
LRes85789 = reshape_layer(Add14671, [1, 1, 1], Res85789), 
LRes95475 = reshape_layer(Res85789, [1, 1, 1, 1], Res95475), 
LZer18759 = zero_padding3D_layer(Res95475, 1, 1, 1, 1, 1, 1, Zer18759), 
LSub16991 = subtract_layer(Zer71318,Zer18759, Sub16991), 
exec_layers([LMul42123,LRes84753,LRes38946,LZer71318,LAdd14671,LRes85789,LRes95475,LZer18759,LSub16991],["Mul42123","Res84753","Res38946","Zer71318","Add14671","Res85789","Res95475","Zer18759","Sub16991"],Sub16991,"Sub16991")

Actual (Unparsed): [[[[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [-1.5772001], [0.0191741]], [[0.0000000], [0.0000000], [0.5846757]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0208097]], [[0.0000000], [0.0000000], [0.2010789]]]]]

Expected (Unparsed): [[[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]]],[[[0],[0],[0]],[[0],[-1.5772],[0.01917412]],[[0],[0],[0.5846757]]],[[[0],[0],[0]],[[0],[0],[0.020809690000000002]],[[0],[0],[0.2010789]]]]]

Actual:   [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [-1.5772], [0.0192]], [[0], [0], [0.5847]]], [[[0], [0], [0]], [[0], [0], [0.0209]], [[0], [0], [0.2011]]]]]

Expected: [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [-1.5772], [0.0192]], [[0], [0], [0.5847]]], [[[0], [0], [0]], [[0], [0], [0.0209]], [[0], [0], [0.2011]]]]]