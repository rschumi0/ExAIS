import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max37490 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Max37490 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in0Con32094 = tf.keras.layers.Input(shape=([2, 7, 2, 3]))
in0Dot53187 = tf.keras.layers.Input(shape=([2]))
in1Dot53187 = tf.keras.layers.Input(shape=([2]))

Max37490 = keras.layers.Maximum(name = 'Max37490', )([in0Max37490,in1Max37490])
Lea76524 = keras.layers.LeakyReLU(alpha=7.8332597345323105, name = 'Lea76524', )(Max37490)
Res18268 = keras.layers.Reshape((1, 1, 1), name = 'Res18268', )(Lea76524)
Res359 = keras.layers.Reshape((1, 1), name = 'Res359', )(Res18268)
Loc33116 = keras.layers.LocallyConnected1D(4, (1),strides=(1), name = 'Loc33116', )(Res359)
Res89495 = keras.layers.Reshape((1, 4, 1), name = 'Res89495', )(Loc33116)
Res52517 = keras.layers.Reshape((1, 4, 1, 1), name = 'Res52517', )(Res89495)
Zer84160 = keras.layers.ZeroPadding3D(padding=((1, 0), (3, 0), (1, 0)), name = 'Zer84160', )(Res52517)
Con32094 = keras.layers.Concatenate(axis=4, name = 'Con32094', )([Zer84160,in0Con32094])
Dot53187 = keras.layers.Dot(axes=(1, 1), name = 'Dot53187', )([in0Dot53187,in1Dot53187])
Res7156 = keras.layers.Reshape((1, 1), name = 'Res7156', )(Dot53187)
Res61324 = keras.layers.Reshape((1, 1, 1), name = 'Res61324', )(Res7156)
Res85328 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res85328', )(Res61324)
Con247 = keras.layers.Conv3D(4, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con247', )(Res85328)
Up_13172 = keras.layers.UpSampling3D(size=(2, 1, 2), name = 'Up_13172', )(Con247)
Zer45338 = keras.layers.ZeroPadding3D(padding=((0, 0), (6, 0), (0, 0)), name = 'Zer45338', )(Up_13172)
Mul83336 = keras.layers.Multiply(name = 'Mul83336', )([Con32094,Zer45338])
model = tf.keras.models.Model(inputs=[in0Max37490,in1Max37490,in0Con32094,in0Dot53187,in1Dot53187], outputs=Mul83336)
w = model.get_layer('Loc33116').get_weights() 
w[0] = np.array([[[0.4525, 0.7169, 0.7333, 0.4363]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc33116').set_weights(w) 
w = model.get_layer('Con247').get_weights() 
w[0] = np.array([[[[[0.0839, 0.0971, 0.0128, 0.7033]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con247').set_weights(w) 
in0Max37490 = tf.constant([[[[[0.0888]]]]])
in1Max37490 = tf.constant([[[[[0.6545]]]]])
in0Con32094 = tf.constant([[[[[0.2041, 0.1113, 0.1057], [0.7009, 0.1017, 0.0227]], [[0.0865, 0.2077, 0.1095], [0.1073, 0.7804, 0.4932]], [[0.1655, 0.6879, 0.4241], [0.7859, 0.0038, 0.1711]], [[0.3912, 0.3955, 0.2182], [0.6635, 0.7717, 0.1375]], [[0.5756, 0.2076, 0.9298], [0.3752, 0.9311, 0.8138]], [[0.2053, 0.2658, 0.0751], [0.1957, 0.2234, 0.9789]], [[0.7166, 0.0052, 0.9904], [0.4988, 0.5994, 0.4063]]], [[[0.062, 0.1183, 0.435], [0.0276, 0.5947, 0.8836]], [[0.9375, 0.6892, 0.0162], [0.0628, 0.7502, 0.8136]], [[0.3846, 0.1721, 0.4638], [0.0974, 0.2443, 0.2198]], [[0.2453, 0.848, 0.9323], [0.6037, 0.8176, 0.3685]], [[0.8421, 0.5342, 0.6631], [0.9137, 0.1072, 0.9433]], [[0.3575, 0.0331, 0.5336], [0.5912, 0.8844, 0.5673]], [[0.3791, 0.4805, 0.6293], [0.1697, 0.7552, 0.7518]]]]])
in0Dot53187 = tf.constant([[0.6213, 0.5482]])
in1Dot53187 = tf.constant([[0.1463, 0.8927]])
print (np.array2string(model.predict([in0Max37490,in1Max37490,in0Con32094,in0Dot53187,in1Dot53187],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul83336.png')

LMax37490 = maximum_layer([[[[[[0.0888]]]]], [[[[[0.6545]]]]]], Max37490), 
LLea76524 = leaky_relu_layer(Max37490, 7.8332597345323105, Lea76524), 
LRes18268 = reshape_layer(Lea76524, [1, 1, 1], Res18268), 
LRes359 = reshape_layer(Res18268, [1, 1], Res359), 
LLoc33116 = locally_connected1D_layer(Res359, 1,[[[0.4525, 0.7169, 0.7333, 0.4363]]],[[0, 0, 0, 0]], 1, Loc33116), 
LRes89495 = reshape_layer(Loc33116, [1, 4, 1], Res89495), 
LRes52517 = reshape_layer(Res89495, [1, 4, 1, 1], Res52517), 
LZer84160 = zero_padding3D_layer(Res52517, 1, 0, 3, 0, 1, 0, Zer84160), 
LCon32094 = concatenate_layer([Zer84160,[[[[[0.2041, 0.1113, 0.1057], [0.7009, 0.1017, 0.0227]], [[0.0865, 0.2077, 0.1095], [0.1073, 0.7804, 0.4932]], [[0.1655, 0.6879, 0.4241], [0.7859, 0.0038, 0.1711]], [[0.3912, 0.3955, 0.2182], [0.6635, 0.7717, 0.1375]], [[0.5756, 0.2076, 0.9298], [0.3752, 0.9311, 0.8138]], [[0.2053, 0.2658, 0.0751], [0.1957, 0.2234, 0.9789]], [[0.7166, 0.0052, 0.9904], [0.4988, 0.5994, 0.4063]]], [[[0.062, 0.1183, 0.435], [0.0276, 0.5947, 0.8836]], [[0.9375, 0.6892, 0.0162], [0.0628, 0.7502, 0.8136]], [[0.3846, 0.1721, 0.4638], [0.0974, 0.2443, 0.2198]], [[0.2453, 0.848, 0.9323], [0.6037, 0.8176, 0.3685]], [[0.8421, 0.5342, 0.6631], [0.9137, 0.1072, 0.9433]], [[0.3575, 0.0331, 0.5336], [0.5912, 0.8844, 0.5673]], [[0.3791, 0.4805, 0.6293], [0.1697, 0.7552, 0.7518]]]]]], 4, Con32094), 
LDot53187 = dot_layer([[0.6213, 0.5482]], [[0.1463, 0.8927]], 1, 1, Dot53187), 
LRes7156 = reshape_layer(Dot53187, [1, 1], Res7156), 
LRes61324 = reshape_layer(Res7156, [1, 1, 1], Res61324), 
LRes85328 = reshape_layer(Res61324, [1, 1, 1, 1], Res85328), 
LCon247 = conv3D_layer(Res85328, 1, 1, 1,[[[[[0.0839, 0.0971, 0.0128, 0.7033]]]]],[0, 0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con247), 
LUp_13172 = up_sampling3D_layer(Con247, 2, 1, 2, Up_13172), 
LZer45338 = zero_padding3D_layer(Up_13172, 0, 0, 6, 0, 0, 0, Zer45338), 
LMul83336 = multiply_layer([Con32094,Zer45338], Mul83336), 
exec_layers([LMax37490,LLea76524,LRes18268,LRes359,LLoc33116,LRes89495,LRes52517,LZer84160,LCon32094,LDot53187,LRes7156,LRes61324,LRes85328,LCon247,LUp_13172,LZer45338,LMul83336],["Max37490","Lea76524","Res18268","Res359","Loc33116","Res89495","Res52517","Zer84160","Con32094","Dot53187","Res7156","Res61324","Res85328","Con247","Up_13172","Zer45338","Mul83336"],Mul83336,"Mul83336")

Actual (Unparsed): [[[[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0403766, 0.0000386, 0.4041891], [0.0000000, 0.0281047, 0.0044521, 0.1658139]]], [[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0213603, 0.0035689, 0.2568217], [0.0139024, 0.0095617, 0.0056093, 0.3068148]]]]]

Expected (Unparsed): [[[[[0,0.0,0.0,0.0],[0,0.0,0.0,0.0]],[[0,0.0,0.0,0.0],[0,0.0,0.0,0.0]],[[0,0.0,0.0,0.0],[0,0.0,0.0,0.0]],[[0,0.0,0.0,0.0],[0,0.0,0.0,0.0]],[[0,0.0,0.0,0.0],[0,0.0,0.0,0.0]],[[0,0.0,0.0,0.0],[0,0.0,0.0,0.0]],[[0.0,0.040376567191653806,3.862305940480001e-5,0.40418910970062566],[0.0,0.028104705156568405,0.004452050347545601,0.16581384821422074]]],[[[0,0.0,0.0,0.0],[0,0.0,0.0,0.0]],[[0,0.0,0.0,0.0],[0,0.0,0.0,0.0]],[[0,0.0,0.0,0.0],[0,0.0,0.0,0.0]],[[0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]],[[0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]],[[0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]],[[0.0,0.0213602520546413,0.0035689192392320004,0.25682169500666774],[0.01390241292063885,0.009561684974077101,0.005609256627404801,0.3068147947020703]]]]]

Actual:   [[[[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0.0404, 0.0001, 0.4042], [0, 0.0282, 0.0045, 0.1659]]], [[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0.0214, 0.0036, 0.2569], [0.014, 0.0096, 0.0057, 0.3069]]]]]

Expected: [[[[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0.0404, 0.0001, 0.4042], [0, 0.0282, 0.0045, 0.1659]]], [[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0.0214, 0.0036, 0.2569], [0.014, 0.0096, 0.0057, 0.3069]]]]]