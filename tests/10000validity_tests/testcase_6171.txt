import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot78063 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot78063 = tf.keras.layers.Input(shape=([3, 2]))
in0Con97172 = tf.keras.layers.Input(shape=([3, 1]))
in0Cro60852 = tf.keras.layers.Input(shape=([1, 4]))
in0Dot45313 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot45313 = tf.keras.layers.Input(shape=([2, 3]))
in0Con76249 = tf.keras.layers.Input(shape=([2, 2]))

Dot78063 = keras.layers.Dot(axes=(2, 2), name = 'Dot78063', )([in0Dot78063,in1Dot78063])
Con97172 = keras.layers.Concatenate(axis=2, name = 'Con97172', )([Dot78063,in0Con97172])
Cro60852 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro60852', )(in0Cro60852)
Zer14158 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer14158', )(Cro60852)
Dot45313 = keras.layers.Dot(axes=(2, 2), name = 'Dot45313', )([in0Dot45313,in1Dot45313])
Con76249 = keras.layers.Concatenate(axis=2, name = 'Con76249', )([Dot45313,in0Con76249])
Sub9092 = keras.layers.Subtract(name = 'Sub9092', )([Zer14158,Con76249])
Zer83607 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer83607', )(Sub9092)
Add18764 = keras.layers.Add(name = 'Add18764', )([Con97172,Zer83607])
Max2368 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='valid', name = 'Max2368', )(Add18764)
model = tf.keras.models.Model(inputs=[in0Dot78063,in1Dot78063,in0Con97172,in0Cro60852,in0Dot45313,in1Dot45313,in0Con76249], outputs=Max2368)
in0Dot78063 = tf.constant([[[0.4407, 0.9372], [0.8108, 0.9434], [0.857, 0.5651]]])
in1Dot78063 = tf.constant([[[0.4699, 0.4174], [0.0666, 0.8972], [0.8159, 0.8783]]])
in0Con97172 = tf.constant([[[0.6005], [0.7817], [0.7783]]])
in0Cro60852 = tf.constant([[[1.921, 1.7405, 1.6972, 1.0277]]])
in0Dot45313 = tf.constant([[[0.2293, 0.8196, 0.5289], [0.2053, 0.7477, 0.4992]]])
in1Dot45313 = tf.constant([[[0.6747, 0.2516, 0.3783], [0.8878, 0.0332, 0.4557]]])
in0Con76249 = tf.constant([[[0.66, 0.8288], [0.0764, 0.3143]]])
print (np.array2string(model.predict([in0Dot78063,in1Dot78063,in0Con97172,in0Cro60852,in0Dot45313,in1Dot45313,in0Con76249],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max2368.png')

LDot78063 = dot_layer([[[0.4407, 0.9372], [0.8108, 0.9434], [0.857, 0.5651]]], [[[0.4699, 0.4174], [0.0666, 0.8972], [0.8159, 0.8783]]], 2, 2, Dot78063), 
LCon97172 = concatenate_layer([Dot78063,[[[0.6005], [0.7817], [0.7783]]]], 2, Con97172), 
LCro60852 = cropping1D_layer([[[1.921, 1.7405, 1.6972, 1.0277]]], 0, 0, Cro60852), 
LZer14158 = zero_padding1D_layer(Cro60852, 1, 0, Zer14158), 
LDot45313 = dot_layer([[[0.2293, 0.8196, 0.5289], [0.2053, 0.7477, 0.4992]]], [[[0.6747, 0.2516, 0.3783], [0.8878, 0.0332, 0.4557]]], 2, 2, Dot45313), 
LCon76249 = concatenate_layer([Dot45313,[[[0.66, 0.8288], [0.0764, 0.3143]]]], 2, Con76249), 
LSub9092 = subtract_layer(Zer14158,Con76249, Sub9092), 
LZer83607 = zero_padding1D_layer(Sub9092, 1, 0, Zer83607), 
LAdd18764 = add_layer([Con97172,Zer83607], Add18764), 
LMax2368 = max_pool1D_layer(Add18764, 1, 1, false, Max2368), 
exec_layers([LDot78063,LCon97172,LCro60852,LZer14158,LDot45313,LCon76249,LSub9092,LZer83607,LAdd18764,LMax2368],["Dot78063","Con97172","Cro60852","Zer14158","Dot45313","Con76249","Sub9092","Zer83607","Add18764","Max2368"],Max2368,"Max2368")

Actual (Unparsed): [[[0.5982722, 0.8702065, 1.1827099, 0.6005000], [0.2137671, 0.4286148, 0.8301200, -0.0471000], [2.0440925, 1.8700095, 2.8163536, 1.4916999]]]

Expected (Unparsed): [[[0.59827221,0.87020646,1.18270989,0.6005],[0.21376713999999986,0.4286147699999999,0.83011994,-0.04710000000000003],[2.04409245,1.8700094999999999,2.81635363,1.4917]]]

Actual:   [[[0.5983, 0.8703, 1.1828, 0.6005], [0.2138, 0.4287, 0.8302, -0.0471], [2.0441, 1.8701, 2.8164, 1.4917]]]

Expected: [[[0.5983, 0.8703, 1.1828, 0.6005], [0.2138, 0.4287, 0.8302, -0.0471], [2.0441, 1.8701, 2.8164, 1.4917]]]