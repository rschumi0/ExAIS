import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min5579 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Min5579 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in0Mul86680 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Mul86680 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con21180 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0GRU9982 = tf.keras.layers.Input(shape=([2, 2]))

Min5579 = keras.layers.Minimum(name = 'Min5579', )([in0Min5579,in1Min5579])
Res39774 = keras.layers.Reshape((1, 1, 2), name = 'Res39774', )(Min5579)
Zer38867 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer38867', )(Res39774)
Mul86680 = keras.layers.Multiply(name = 'Mul86680', )([in0Mul86680,in1Mul86680])
Sub13652 = keras.layers.Subtract(name = 'Sub13652', )([Zer38867,Mul86680])
Res7479 = keras.layers.Reshape((2, 2), name = 'Res7479', )(Sub13652)
Ave32736 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave32736', )(Res7479)
Res10979 = keras.layers.Reshape((2, 2, 1), name = 'Res10979', )(Ave32736)
Con21180 = keras.layers.Concatenate(axis=3, name = 'Con21180', )([Res10979,in0Con21180])
GRU9982 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU9982', )(in0GRU9982)
Res35875 = keras.layers.Reshape((1, 1), name = 'Res35875', )(GRU9982)
GRU4850 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU4850', )(Res35875)
Res7846 = keras.layers.Reshape((2, 1), name = 'Res7846', )(GRU4850)
Res85780 = keras.layers.Reshape((2, 1, 1), name = 'Res85780', )(Res7846)
Sep71367 = keras.layers.SeparableConv2D(3, (1, 1),strides=(2, 2), padding='valid', name = 'Sep71367', )(Res85780)
Zer14827 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer14827', )(Sep71367)
Sub96030 = keras.layers.Subtract(name = 'Sub96030', )([Con21180,Zer14827])
model = tf.keras.models.Model(inputs=[in0Min5579,in1Min5579,in0Mul86680,in1Mul86680,in0Con21180,in0GRU9982], outputs=Sub96030)
w = model.get_layer('GRU9982').get_weights() 
w[0] = np.array([[3, 7, 10], [2, 5, 6]])
w[1] = np.array([[2, 7, 9]])
w[2] = np.array([6, 2, 3])
model.get_layer('GRU9982').set_weights(w) 
w = model.get_layer('GRU4850').get_weights() 
w[0] = np.array([[7, 9, 2, 2, 6, 3]])
w[1] = np.array([[7, 5, 10, 10, 7, 7], [9, 5, 1, 8, 3, 1]])
w[2] = np.array([10, 7, 2, 5, 5, 8])
model.get_layer('GRU4850').set_weights(w) 
w = model.get_layer('Sep71367').get_weights() 
w[0] = np.array([[[[0.4829]]]])
w[1] = np.array([[[[0.8304, 0.0481, 0.9196]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep71367').set_weights(w) 
in0Min5579 = tf.constant([[[[[0.8131, 0.0257]]]]])
in1Min5579 = tf.constant([[[[[0.9733, 0.3241]]]]])
in0Mul86680 = tf.constant([[[[0.4735, 0.5579]], [[0.7414, 0.7856]]]])
in1Mul86680 = tf.constant([[[[0.2468, 0.3677]], [[0.8022, 0.1793]]]])
in0Con21180 = tf.constant([[[[0.1469, 0.0218], [0.0278, 0.7494]], [[0.0845, 0.6138], [0.2785, 0.5049]]]])
in0GRU9982 = tf.constant([[[2, 2], [4, 3]]])
print (np.array2string(model.predict([in0Min5579,in1Min5579,in0Mul86680,in1Mul86680,in0Con21180,in0GRU9982],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub96030.png')

LMin5579 = minimum_layer([[[[[[0.8131, 0.0257]]]]], [[[[[0.9733, 0.3241]]]]]], Min5579), 
LRes39774 = reshape_layer(Min5579, [1, 1, 2], Res39774), 
LZer38867 = zero_padding2D_layer(Res39774, 1, 0, 0, 0, Zer38867), 
LMul86680 = multiply_layer([[[[[0.4735, 0.5579]], [[0.7414, 0.7856]]]], [[[[0.2468, 0.3677]], [[0.8022, 0.1793]]]]], Mul86680), 
LSub13652 = subtract_layer(Zer38867,Mul86680, Sub13652), 
LRes7479 = reshape_layer(Sub13652, [2, 2], Res7479), 
LAve32736 = average_pooling1D_layer(Res7479, 1, Ave32736), 
LRes10979 = reshape_layer(Ave32736, [2, 2, 1], Res10979), 
LCon21180 = concatenate_layer([Res10979,[[[[0.1469, 0.0218], [0.0278, 0.7494]], [[0.0845, 0.6138], [0.2785, 0.5049]]]]], 3, Con21180), 
LGRU9982 = gru_layer([[[2, 2], [4, 3]]],[[3, 7, 10], [2, 5, 6]],[[2, 7, 9]],[6, 2, 3], false, GRU9982), 
LRes35875 = reshape_layer(GRU9982, [1, 1], Res35875), 
LGRU4850 = gru_layer(Res35875,[[7, 9, 2, 2, 6, 3]],[[7, 5, 10, 10, 7, 7], [9, 5, 1, 8, 3, 1]],[10, 7, 2, 5, 5, 8], false, GRU4850), 
LRes7846 = reshape_layer(GRU4850, [2, 1], Res7846), 
LRes85780 = reshape_layer(Res7846, [2, 1, 1], Res85780), 
LSep71367 = separable_conv2D_layer(Res85780, 1, 1,[[[[[0.4829]]]],[[[[0.8304, 0.0481, 0.9196]]]]],[0, 0, 0], 2, 2, false, Sep71367), 
LZer14827 = zero_padding2D_layer(Sep71367, 1, 0, 1, 0, Zer14827), 
LSub96030 = subtract_layer(Con21180,Zer14827, Sub96030), 
exec_layers([LMin5579,LRes39774,LZer38867,LMul86680,LSub13652,LRes7479,LAve32736,LRes10979,LCon21180,LGRU9982,LRes35875,LGRU4850,LRes7846,LRes85780,LSep71367,LZer14827,LSub96030],["Min5579","Res39774","Zer38867","Mul86680","Sub13652","Res7479","Ave32736","Res10979","Con21180","GRU9982","Res35875","GRU4850","Res7846","Res85780","Sep71367","Zer14827","Sub96030"],Sub96030,"Sub96030")

Actual (Unparsed): [[[[-0.1168598, 0.1469000, 0.0218000], [-0.2051398, 0.0278000, 0.7494000]], [[0.2183489, 0.0845000, 0.6138000], [-0.1151763, 0.2784989, 0.5048798]]]]

Expected (Unparsed): [[[[-0.11685979999999999,0.1469,0.0218],[-0.20513983,0.0278,0.7494]],[[0.21834892000000006,0.0845,0.6138],[-0.11517628288537639,0.27849894561803157,0.5048798417950481]]]]

Actual:   [[[[-0.1168, 0.1469, 0.0218], [-0.2051, 0.0278, 0.7494]], [[0.2184, 0.0845, 0.6138], [-0.1151, 0.2785, 0.5049]]]]

Expected: [[[[-0.1168, 0.1469, 0.0218], [-0.2051, 0.0278, 0.7494]], [[0.2184, 0.0845, 0.6138], [-0.1151, 0.2785, 0.5049]]]]