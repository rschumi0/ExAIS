import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave24582 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Ave24582 = tf.keras.layers.Input(shape=([2, 1, 2]))

Ave24582 = keras.layers.Average(name = 'Ave24582', )([in0Ave24582,in1Ave24582])
Res88035 = keras.layers.Reshape((2, 2), name = 'Res88035', )(Ave24582)
Loc14155 = keras.layers.LocallyConnected1D(4, (1),strides=(1), name = 'Loc14155', )(Res88035)
Ave37558 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave37558', )(Loc14155)
model = tf.keras.models.Model(inputs=[in0Ave24582,in1Ave24582], outputs=Ave37558)
w = model.get_layer('Loc14155').get_weights() 
w[0] = np.array([[[0.5573, 0.7694, 0.5219, 0.4994], [0.3015, 0.8978, 0.2886, 0.3411]], [[0.0828, 0.7068, 0.0058, 0.9752], [0.7905, 0.9133, 0.517, 0.7217]]])
w[1] = np.array([[0, 0, 0, 0], [0, 0, 0, 0]])
model.get_layer('Loc14155').set_weights(w) 
in0Ave24582 = tf.constant([[[[0.1598, 0.1235]], [[0.9773, 0.6434]]]])
in1Ave24582 = tf.constant([[[[0.3661, 0.144]], [[0.7447, 0.3328]]]])
print (np.array2string(model.predict([in0Ave24582,in1Ave24582],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave37558.png')

LAve24582 = average_layer([[[[[0.1598, 0.1235]], [[0.9773, 0.6434]]]], [[[[0.3661, 0.144]], [[0.7447, 0.3328]]]]], Ave24582), 
LRes88035 = reshape_layer(Ave24582, [2, 2], Res88035), 
LLoc14155 = locally_connected1D_layer(Res88035, 1,[[[0.5573, 0.7694, 0.5219, 0.4994], [0.3015, 0.8978, 0.2886, 0.3411]], [[0.0828, 0.7068, 0.0058, 0.9752], [0.7905, 0.9133, 0.517, 0.7217]]],[[0, 0, 0, 0], [0, 0, 0, 0]], 1, Loc14155), 
LAve37558 = average_pooling1D_layer(Loc14155, 1, Ave37558), 
exec_layers([LAve24582,LRes88035,LLoc14155,LAve37558],["Ave24582","Res88035","Loc14155","Ave37558"],Ave37558,"Ave37558")

Actual (Unparsed): [[[0.1868677, 0.3223945, 0.1758339, 0.1769394], [0.4571339, 1.0543365, 0.2573415, 1.1919090]]]

Expected (Unparsed): [[[0.18686766,0.32239448,0.175833855,0.176939355],[0.45713384999999995,1.05433653,0.2573415,1.1919089699999998]]]

Actual:   [[[0.1869, 0.3224, 0.1759, 0.177], [0.4572, 1.0544, 0.2574, 1.192]]]

Expected: [[[0.1869, 0.3224, 0.1759, 0.177], [0.4572, 1.0544, 0.2574, 1.192]]]