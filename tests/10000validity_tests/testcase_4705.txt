import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max3635 = tf.keras.layers.Input(shape=([2, 2]))
in0Con28284 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Mul55079 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Mul55079 = tf.keras.layers.Input(shape=([2, 2, 2]))

Max3635 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='same', name = 'Max3635', )(in0Max3635)
Sim67231 = keras.layers.SimpleRNN(3,name = 'Sim67231', )(Max3635)
Res53654 = keras.layers.Reshape((3, 1), name = 'Res53654', )(Sim67231)
Res87322 = keras.layers.Reshape((3, 1, 1), name = 'Res87322', )(Res53654)
Res75059 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res75059', )(Res87322)
Glo35818 = keras.layers.GlobalMaxPool3D(name = 'Glo35818', )(Res75059)
Res19957 = keras.layers.Reshape((1, 1), name = 'Res19957', )(Glo35818)
Res23977 = keras.layers.Reshape((1, 1, 1), name = 'Res23977', )(Res19957)
Zer17602 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer17602', )(Res23977)
Con28284 = keras.layers.Concatenate(axis=3, name = 'Con28284', )([Zer17602,in0Con28284])
Mul55079 = keras.layers.Multiply(name = 'Mul55079', )([in0Mul55079,in1Mul55079])
Sub72371 = keras.layers.Subtract(name = 'Sub72371', )([Con28284,Mul55079])
Res33125 = keras.layers.Reshape((2, 4), name = 'Res33125', )(Sub72371)
Con28850 = keras.layers.Conv1D(4, (2),strides=(1), padding='valid', dilation_rate=(1), name = 'Con28850', )(Res33125)
model = tf.keras.models.Model(inputs=[in0Max3635,in0Con28284,in0Mul55079,in1Mul55079], outputs=Con28850)
w = model.get_layer('Sim67231').get_weights() 
w[0] = np.array([[9, 2, 6], [7, 9, 5]])
w[1] = np.array([[9, 10, 6], [6, 7, 4], [10, 8, 5]])
w[2] = np.array([2, 6, 2])
model.get_layer('Sim67231').set_weights(w) 
w = model.get_layer('Con28850').get_weights() 
w[0] = np.array([[[0.2093, 0.4681, 0.5273, 0.9384], [0.5431, 0.4475, 0.1575, 0.7247], [0.3179, 0.8451, 0.1086, 0.8849], [0.0698, 0.2389, 0.0579, 0.802]], [[0.758, 0.2457, 0.2123, 0.5181], [0.8503, 0.6007, 0.6564, 0.4151], [0.3651, 0.6342, 0.2321, 0.3682], [0.74, 0.2232, 0.0036, 0.8213]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con28850').set_weights(w) 
in0Max3635 = tf.constant([[[1.6264, 1.2227], [1.1716, 1.1131]]])
in0Con28284 = tf.constant([[[[0.5238], [0.3009]], [[0.875], [0.2628]]]])
in0Mul55079 = tf.constant([[[[0.0222, 0.0975], [0.3594, 0.51]], [[0.5068, 0.2265], [0.4362, 0.348]]]])
in1Mul55079 = tf.constant([[[[0.3956, 0.0776], [0.4017, 0.1813]], [[0.8249, 0.899], [0.3893, 0.1856]]]])
print (np.array2string(model.predict([in0Max3635,in0Con28284,in0Mul55079,in1Mul55079],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con28850.png')

LMax3635 = max_pool1D_layer([[[1.6264, 1.2227], [1.1716, 1.1131]]], 1, 1, true, Max3635), 
LSim67231 = simple_rnn_layer(Max3635,[[9, 2, 6], [7, 9, 5]],[[9, 10, 6], [6, 7, 4], [10, 8, 5]],[2, 6, 2], Sim67231), 
LRes53654 = reshape_layer(Sim67231, [3, 1], Res53654), 
LRes87322 = reshape_layer(Res53654, [3, 1, 1], Res87322), 
LRes75059 = reshape_layer(Res87322, [3, 1, 1, 1], Res75059), 
LGlo35818 = global_max_pool3D_layer(Res75059, Glo35818), 
LRes19957 = reshape_layer(Glo35818, [1, 1], Res19957), 
LRes23977 = reshape_layer(Res19957, [1, 1, 1], Res23977), 
LZer17602 = zero_padding2D_layer(Res23977, 1, 0, 1, 0, Zer17602), 
LCon28284 = concatenate_layer([Zer17602,[[[[0.5238], [0.3009]], [[0.875], [0.2628]]]]], 3, Con28284), 
LMul55079 = multiply_layer([[[[[0.0222, 0.0975], [0.3594, 0.51]], [[0.5068, 0.2265], [0.4362, 0.348]]]], [[[[0.3956, 0.0776], [0.4017, 0.1813]], [[0.8249, 0.899], [0.3893, 0.1856]]]]], Mul55079), 
LSub72371 = subtract_layer(Con28284,Mul55079, Sub72371), 
LRes33125 = reshape_layer(Sub72371, [2, 4], Res33125), 
LCon28850 = conv1D_layer(Res33125, 2,[[[0.2093, 0.4681, 0.5273, 0.9384], [0.5431, 0.4475, 0.1575, 0.7247], [0.3179, 0.8451, 0.1086, 0.8849], [0.0698, 0.2389, 0.0579, 0.802]], [[0.758, 0.2457, 0.2123, 0.5181], [0.8503, 0.6007, 0.6564, 0.4151], [0.3651, 0.6342, 0.2321, 0.3682], [0.74, 0.2232, 0.0036, 0.8213]]],[0, 0, 0, 0], 1, false, 1, Con28850), 
exec_layers([LMax3635,LSim67231,LRes53654,LRes87322,LRes75059,LGlo35818,LRes19957,LRes23977,LZer17602,LCon28284,LMul55079,LSub72371,LRes33125,LCon28850],["Max3635","Sim67231","Res53654","Res87322","Res75059","Glo35818","Res19957","Res23977","Zer17602","Con28284","Mul55079","Sub72371","Res33125","Con28850"],Con28850,"Con28850")

Actual (Unparsed): [[[0.9509421, 1.0260157, 0.6184033, 0.9358438]]]

Expected (Unparsed): [[[0.9509420731059999,1.0260156346040001,0.6184033344340001,0.9358437331160001]]]

Actual:   [[[0.951, 1.0261, 0.6185, 0.9359]]]

Expected: [[[0.951, 1.0261, 0.6185, 0.9359]]]