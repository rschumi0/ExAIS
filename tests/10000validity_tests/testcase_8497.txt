import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul51058 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Mul51058 = tf.keras.layers.Input(shape=([2, 2, 1]))

Mul51058 = keras.layers.Multiply(name = 'Mul51058', )([in0Mul51058,in1Mul51058])
Res71879 = keras.layers.Reshape((2, 2), name = 'Res71879', )(Mul51058)
Con96008 = keras.layers.Conv1D(3, (2),strides=(2), padding='same', dilation_rate=(1), name = 'Con96008', )(Res71879)
Res28043 = keras.layers.Reshape((1, 3, 1), name = 'Res28043', )(Con96008)
Glo3585 = keras.layers.GlobalAveragePooling2D(name = 'Glo3585', )(Res28043)
model = tf.keras.models.Model(inputs=[in0Mul51058,in1Mul51058], outputs=Glo3585)
w = model.get_layer('Con96008').get_weights() 
w[0] = np.array([[[0.8549, 0.1495, 0.3931], [0.7584, 0.404, 0.5279]], [[0.0314, 0.6243, 0.3192], [0.2964, 0.3597, 0.1706]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con96008').set_weights(w) 
in0Mul51058 = tf.constant([[[[0.6539], [0.6912]], [[0.834], [0.7919]]]])
in1Mul51058 = tf.constant([[[[0.7211], [0.9905]], [[0.2076], [0.926]]]])
print (np.array2string(model.predict([in0Mul51058,in1Mul51058],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo3585.png')

LMul51058 = multiply_layer([[[[[0.6539], [0.6912]], [[0.834], [0.7919]]]], [[[[0.7211], [0.9905]], [[0.2076], [0.926]]]]], Mul51058), 
LRes71879 = reshape_layer(Mul51058, [2, 2], Res71879), 
LCon96008 = conv1D_layer(Res71879, 2,[[[0.8549, 0.1495, 0.3931], [0.7584, 0.404, 0.5279]], [[0.0314, 0.6243, 0.3192], [0.2964, 0.3597, 0.1706]]],[0, 0, 0], 2, true, 1, Con96008), 
LRes28043 = reshape_layer(Con96008, [1, 3, 1], Res28043), 
LGlo3585 = global_average_pooling2D_layer(Res28043, Glo3585), 
exec_layers([LMul51058,LRes71879,LCon96008,LRes28043,LGlo3585],["Mul51058","Res71879","Con96008","Res28043","Glo3585"],Glo3585,"Glo3585")

Actual (Unparsed): [[0.8637356]]

Expected (Unparsed): [[0.863735600665]]

Actual:   [[0.8638]]

Expected: [[0.8638]]