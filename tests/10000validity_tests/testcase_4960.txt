import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul41358 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Mul41358 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Ave58179 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave58179 = tf.keras.layers.Input(shape=([2, 1]))

Mul41358 = keras.layers.Multiply(name = 'Mul41358', )([in0Mul41358,in1Mul41358])
Res93718 = keras.layers.Reshape((2, 1, 1), name = 'Res93718', )(Mul41358)
Res85673 = keras.layers.Reshape((2, 1), name = 'Res85673', )(Res93718)
Sep16622 = keras.layers.SeparableConv1D(3, (2),strides=(1), padding='valid', name = 'Sep16622', )(Res85673)
Zer46846 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer46846', )(Sep16622)
Ave58179 = keras.layers.Average(name = 'Ave58179', )([in0Ave58179,in1Ave58179])
Dot66729 = keras.layers.Dot(axes=(1, 1), name = 'Dot66729', )([Zer46846,Ave58179])
Res80434 = keras.layers.Reshape((3, 1, 1), name = 'Res80434', )(Dot66729)
Res37423 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res37423', )(Res80434)
Zer24979 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer24979', )(Res37423)
model = tf.keras.models.Model(inputs=[in0Mul41358,in1Mul41358,in0Ave58179,in1Ave58179], outputs=Zer24979)
w = model.get_layer('Sep16622').get_weights() 
w[0] = np.array([[[0.2996]], [[0.8126]]])
w[1] = np.array([[[0.9834, 0.9291, 0.501]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep16622').set_weights(w) 
in0Mul41358 = tf.constant([[[[[0.766]]], [[[0.5192]]]]])
in1Mul41358 = tf.constant([[[[[0.2674]]], [[[0.9695]]]]])
in0Ave58179 = tf.constant([[[0.9715], [0.1326]]])
in1Ave58179 = tf.constant([[[0.8654], [0.4283]]])
print (np.array2string(model.predict([in0Mul41358,in1Mul41358,in0Ave58179,in1Ave58179],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Zer24979.png')

LMul41358 = multiply_layer([[[[[[0.766]]], [[[0.5192]]]]], [[[[[0.2674]]], [[[0.9695]]]]]], Mul41358), 
LRes93718 = reshape_layer(Mul41358, [2, 1, 1], Res93718), 
LRes85673 = reshape_layer(Res93718, [2, 1], Res85673), 
LSep16622 = separable_conv1D_layer(Res85673, 2,[[[[0.2996]], [[0.8126]]],[[[0.9834, 0.9291, 0.501]]]],[0, 0, 0], 1, false, Sep16622), 
LZer46846 = zero_padding1D_layer(Sep16622, 1, 0, Zer46846), 
LAve58179 = average_layer([[[[0.9715], [0.1326]]], [[[0.8654], [0.4283]]]], Ave58179), 
LDot66729 = dot_layer(Zer46846,Ave58179, 1, 1, Dot66729), 
LRes80434 = reshape_layer(Dot66729, [3, 1, 1], Res80434), 
LRes37423 = reshape_layer(Res80434, [3, 1, 1, 1], Res37423), 
LZer24979 = zero_padding3D_layer(Res37423, 1, 1, 1, 1, 1, 1, Zer24979), 
exec_layers([LMul41358,LRes93718,LRes85673,LSep16622,LZer46846,LAve58179,LDot66729,LRes80434,LRes37423,LZer24979],["Mul41358","Res93718","Res85673","Sep16622","Zer46846","Ave58179","Dot66729","Res80434","Res37423","Zer24979"],Zer24979,"Zer24979")

Actual (Unparsed): [[[[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.1297339], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.1225704], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0660938], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]]]]

Expected (Unparsed): [[[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]]],[[[0],[0],[0]],[[0],[0.12973388483132858],[0]],[[0],[0],[0]]],[[[0],[0],[0]],[[0],[0.1225704213918928],[0]],[[0],[0],[0]]],[[[0],[0],[0]],[[0],[0.06609383394396544],[0]],[[0],[0],[0]]],[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]]]]]

Actual:   [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0.1298], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0.1226], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0.0661], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]]]]

Expected: [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0.1298], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0.1226], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0.0661], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]]]]