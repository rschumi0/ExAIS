import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave67738 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave67738 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Min1295 = tf.keras.layers.Input(shape=([2, 2]))
in1Min1295 = tf.keras.layers.Input(shape=([2, 2]))
in0Con19646 = tf.keras.layers.Input(shape=([1]))
in0Dot59089 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot59089 = tf.keras.layers.Input(shape=([2, 3]))
in0Con17982 = tf.keras.layers.Input(shape=([2, 1, 3, 1]))
in0Max82083 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Max82083 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))

Ave67738 = keras.layers.Average(name = 'Ave67738', )([in0Ave67738,in1Ave67738])
Res85881 = keras.layers.Reshape((2, 2), name = 'Res85881', )(Ave67738)
Fla10334 = keras.layers.Flatten(name = 'Fla10334', )(Res85881)
Min1295 = keras.layers.Minimum(name = 'Min1295', )([in0Min1295,in1Min1295])
Sim61571 = keras.layers.SimpleRNN(3,name = 'Sim61571', )(Min1295)
Con19646 = keras.layers.Concatenate(axis=1, name = 'Con19646', )([Sim61571,in0Con19646])
Add94292 = keras.layers.Add(name = 'Add94292', )([Fla10334,Con19646])
Res36158 = keras.layers.Reshape((4, 1), name = 'Res36158', )(Add94292)
Cro31548 = keras.layers.Cropping1D(cropping=((1, 0)), name = 'Cro31548', )(Res36158)
Dot59089 = keras.layers.Dot(axes=(2, 2), name = 'Dot59089', )([in0Dot59089,in1Dot59089])
Glo44494 = keras.layers.GlobalAveragePooling1D(name = 'Glo44494', )(Dot59089)
Res14556 = keras.layers.Reshape((2, 1), name = 'Res14556', )(Glo44494)
Res97632 = keras.layers.Reshape((2, 1, 1), name = 'Res97632', )(Res14556)
Res5129 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res5129', )(Res97632)
Zer56894 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer56894', )(Res5129)
Con17982 = keras.layers.Concatenate(axis=4, name = 'Con17982', )([Zer56894,in0Con17982])
Max82083 = keras.layers.Maximum(name = 'Max82083', )([in0Max82083,in1Max82083])
Zer15044 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (1, 0)), name = 'Zer15044', )(Max82083)
Mul13510 = keras.layers.Multiply(name = 'Mul13510', )([Con17982,Zer15044])
Res25256 = keras.layers.Reshape((2, 1, 6), name = 'Res25256', )(Mul13510)
Res38974 = keras.layers.Reshape((2, 6), name = 'Res38974', )(Res25256)
Zer24578 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer24578', )(Res38974)
Dot34673 = keras.layers.Dot(axes=(1, 1), name = 'Dot34673', )([Cro31548,Zer24578])
model = tf.keras.models.Model(inputs=[in0Ave67738,in1Ave67738,in0Min1295,in1Min1295,in0Con19646,in0Dot59089,in1Dot59089,in0Con17982,in0Max82083,in1Max82083], outputs=Dot34673)
w = model.get_layer('Sim61571').get_weights() 
w[0] = np.array([[2, 3, 5], [9, 1, 8]])
w[1] = np.array([[5, 1, 1], [4, 2, 4], [6, 10, 3]])
w[2] = np.array([5, 1, 1])
model.get_layer('Sim61571').set_weights(w) 
in0Ave67738 = tf.constant([[[[0.8878], [0.3701]], [[0.4766], [0.9358]]]])
in1Ave67738 = tf.constant([[[[0.1986], [0.083]], [[0.9383], [0.6203]]]])
in0Min1295 = tf.constant([[[0.0793, 0.5329], [0.7035, 0.7673]]])
in1Min1295 = tf.constant([[[0.5735, 0.8484], [0.0644, 0.3208]]])
in0Con19646 = tf.constant([[0.914]])
in0Dot59089 = tf.constant([[[0.8448, 0.883, 0.9533], [0.0338, 0.9631, 0.6212]]])
in1Dot59089 = tf.constant([[[0.6005, 0.0088, 0.6269], [0.6077, 0.096, 0.3044]]])
in0Con17982 = tf.constant([[[[[0.1263], [0.4266], [0.7071]]], [[[0.211], [0.9147], [0.8459]]]]])
in0Max82083 = tf.constant([[[[[0.5538, 0.2047], [0.1041, 0.0588]]]]])
in1Max82083 = tf.constant([[[[[0.9688, 0.5017], [0.6322, 0.6803]]]]])
print (np.array2string(model.predict([in0Ave67738,in1Ave67738,in0Min1295,in1Min1295,in0Con19646,in0Dot59089,in1Dot59089,in0Con17982,in0Max82083,in1Max82083],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot34673.png')

LAve67738 = average_layer([[[[[0.8878], [0.3701]], [[0.4766], [0.9358]]]], [[[[0.1986], [0.083]], [[0.9383], [0.6203]]]]], Ave67738), 
LRes85881 = reshape_layer(Ave67738, [2, 2], Res85881), 
LFla10334 = flatten_layer(Res85881, Fla10334), 
LMin1295 = minimum_layer([[[[0.0793, 0.5329], [0.7035, 0.7673]]], [[[0.5735, 0.8484], [0.0644, 0.3208]]]], Min1295), 
LSim61571 = simple_rnn_layer(Min1295,[[2, 3, 5], [9, 1, 8]],[[5, 1, 1], [4, 2, 4], [6, 10, 3]],[5, 1, 1], Sim61571), 
LCon19646 = concatenate_layer([Sim61571,[[0.914]]], 1, Con19646), 
LAdd94292 = add_layer([Fla10334,Con19646], Add94292), 
LRes36158 = reshape_layer(Add94292, [4, 1], Res36158), 
LCro31548 = cropping1D_layer(Res36158, 1, 0, Cro31548), 
LDot59089 = dot_layer([[[0.8448, 0.883, 0.9533], [0.0338, 0.9631, 0.6212]]], [[[0.6005, 0.0088, 0.6269], [0.6077, 0.096, 0.3044]]], 2, 2, Dot59089), 
LGlo44494 = global_average_pooling1D_layer(Dot59089, Glo44494), 
LRes14556 = reshape_layer(Glo44494, [2, 1], Res14556), 
LRes97632 = reshape_layer(Res14556, [2, 1, 1], Res97632), 
LRes5129 = reshape_layer(Res97632, [2, 1, 1, 1], Res5129), 
LZer56894 = zero_padding3D_layer(Res5129, 0, 0, 0, 0, 2, 0, Zer56894), 
LCon17982 = concatenate_layer([Zer56894,[[[[[0.1263], [0.4266], [0.7071]]], [[[0.211], [0.9147], [0.8459]]]]]], 4, Con17982), 
LMax82083 = maximum_layer([[[[[[0.5538, 0.2047], [0.1041, 0.0588]]]]], [[[[[0.9688, 0.5017], [0.6322, 0.6803]]]]]], Max82083), 
LZer15044 = zero_padding3D_layer(Max82083, 1, 0, 0, 0, 1, 0, Zer15044), 
LMul13510 = multiply_layer([Con17982,Zer15044], Mul13510), 
LRes25256 = reshape_layer(Mul13510, [2, 1, 6], Res25256), 
LRes38974 = reshape_layer(Res25256, [2, 6], Res38974), 
LZer24578 = zero_padding1D_layer(Res38974, 1, 0, Zer24578), 
LDot34673 = dot_layer(Cro31548,Zer24578, 1, 1, Dot34673), 
exec_layers([LAve67738,LRes85881,LFla10334,LMin1295,LSim61571,LCon19646,LAdd94292,LRes36158,LCro31548,LDot59089,LGlo44494,LRes14556,LRes97632,LRes5129,LZer56894,LCon17982,LMax82083,LZer15044,LMul13510,LRes25256,LRes38974,LZer24578,LDot34673],["Ave67738","Res85881","Fla10334","Min1295","Sim61571","Con19646","Add94292","Res36158","Cro31548","Dot59089","Glo44494","Res14556","Res97632","Res5129","Zer56894","Con17982","Max82083","Zer15044","Mul13510","Res25256","Res38974","Zer24578","Dot34673"],Dot34673,"Dot34673")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.7764901, 0.6367091, 0.9737168]]]

Expected (Unparsed): [[[0.0,0.0,0.0,0.7764901883295,0.6367090863594831,0.9737168561285]]]

Actual:   [[[0, 0, 0, 0.7765, 0.6368, 0.9738]]]

Expected: [[[0, 0, 0, 0.7765, 0.6368, 0.9738]]]