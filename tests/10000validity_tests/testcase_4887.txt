import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con9046 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Dot83351 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot83351 = tf.keras.layers.Input(shape=([2, 3]))
in0Glo93273 = tf.keras.layers.Input(shape=([2, 1]))
in0Con28359 = tf.keras.layers.Input(shape=([3, 3, 3]))

Con9046 = keras.layers.Conv3D(2, (1, 1, 2),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con9046', )(in0Con9046)
Res88978 = keras.layers.Reshape((1, 2, 4), name = 'Res88978', )(Con9046)
Zer85053 = keras.layers.ZeroPadding2D(padding=((2, 0), (1, 0)), name = 'Zer85053', )(Res88978)
Dot83351 = keras.layers.Dot(axes=(1, 1), name = 'Dot83351', )([in0Dot83351,in1Dot83351])
Res70567 = keras.layers.Reshape((3, 3, 1), name = 'Res70567', )(Dot83351)
Glo93273 = keras.layers.GlobalAveragePooling1D(name = 'Glo93273', )(in0Glo93273)
Res92979 = keras.layers.Reshape((1, 1), name = 'Res92979', )(Glo93273)
Res23495 = keras.layers.Reshape((1, 1, 1), name = 'Res23495', )(Res92979)
Ave74618 = keras.layers.AveragePooling2D(pool_size=(1, 1), strides=(1, 1), padding='valid', name = 'Ave74618', )(Res23495)
Zer49135 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer49135', )(Ave74618)
Add96519 = keras.layers.Add(name = 'Add96519', )([Res70567,Zer49135])
Con28359 = keras.layers.Concatenate(axis=3, name = 'Con28359', )([Add96519,in0Con28359])
Sub34732 = keras.layers.Subtract(name = 'Sub34732', )([Zer85053,Con28359])
model = tf.keras.models.Model(inputs=[in0Con9046,in0Dot83351,in1Dot83351,in0Glo93273,in0Con28359], outputs=Sub34732)
w = model.get_layer('Con9046').get_weights() 
w[0] = np.array([[[[[0.6561, 0.5136], [0.5331, 0.8634]], [[0.2425, 0.9845], [0.6326, 0.4699]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con9046').set_weights(w) 
in0Con9046 = tf.constant([[[[[0.1615, 0.3416], [0.8209, 0.8518]], [[0.0699, 0.9361], [0.1576, 0.7292]]]]])
in0Dot83351 = tf.constant([[[0.3882, 0.1267, 0.8054], [0.366, 0.6035, 0.0662]]])
in1Dot83351 = tf.constant([[[0.3822, 0.7429, 0.5944], [0.9316, 0.1235, 0.8438]]])
in0Glo93273 = tf.constant([[[1.2431], [1.8406]]])
in0Con28359 = tf.constant([[[[0.1676, 0.8255, 0.6355], [0.8249, 0.352, 0.3098], [0.8953, 0.9841, 0.928]], [[0.5955, 0.4895, 0.475], [0.6844, 0.6512, 0.7891], [0.9551, 0.5958, 0.4246]], [[0.7905, 0.9895, 0.9712], [0.9628, 0.4051, 0.716], [0.1243, 0.0676, 0.4588]]]])
print (np.array2string(model.predict([in0Con9046,in0Dot83351,in1Dot83351,in0Glo93273,in0Con28359],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub34732.png')

LCon9046 = conv3D_layer([[[[[0.1615, 0.3416], [0.8209, 0.8518]], [[0.0699, 0.9361], [0.1576, 0.7292]]]]], 1, 1, 2,[[[[[0.6561, 0.5136], [0.5331, 0.8634]], [[0.2425, 0.9845], [0.6326, 0.4699]]]]],[0, 0], 1, 1, 1, true, 1, 1, 1, Con9046), 
LRes88978 = reshape_layer(Con9046, [1, 2, 4], Res88978), 
LZer85053 = zero_padding2D_layer(Res88978, 2, 0, 1, 0, Zer85053), 
LDot83351 = dot_layer([[[0.3882, 0.1267, 0.8054], [0.366, 0.6035, 0.0662]]], [[[0.3822, 0.7429, 0.5944], [0.9316, 0.1235, 0.8438]]], 1, 1, Dot83351), 
LRes70567 = reshape_layer(Dot83351, [3, 3, 1], Res70567), 
LGlo93273 = global_average_pooling1D_layer([[[1.2431], [1.8406]]], Glo93273), 
LRes92979 = reshape_layer(Glo93273, [1, 1], Res92979), 
LRes23495 = reshape_layer(Res92979, [1, 1, 1], Res23495), 
LAve74618 = average_pooling2D_layer(Res23495, 1, 1, 1, 1, false, Ave74618), 
LZer49135 = zero_padding2D_layer(Ave74618, 2, 0, 2, 0, Zer49135), 
LAdd96519 = add_layer([Res70567,Zer49135], Add96519), 
LCon28359 = concatenate_layer([Add96519,[[[[0.1676, 0.8255, 0.6355], [0.8249, 0.352, 0.3098], [0.8953, 0.9841, 0.928]], [[0.5955, 0.4895, 0.475], [0.6844, 0.6512, 0.7891], [0.9551, 0.5958, 0.4246]], [[0.7905, 0.9895, 0.9712], [0.9628, 0.4051, 0.716], [0.1243, 0.0676, 0.4588]]]]], 3, Con28359), 
LSub34732 = subtract_layer(Zer85053,Con28359, Sub34732), 
exec_layers([LCon9046,LRes88978,LZer85053,LDot83351,LRes70567,LGlo93273,LRes92979,LRes23495,LAve74618,LZer49135,LAdd96519,LCon28359,LSub34732],["Con9046","Res88978","Zer85053","Dot83351","Res70567","Glo93273","Res92979","Res23495","Ave74618","Zer49135","Add96519","Con28359","Sub34732"],Sub34732,"Sub34732")

Actual (Unparsed): [[[[-0.4893356, -0.1676000, -0.8255000, -0.6355000], [-0.3335948, -0.8249000, -0.3520000, -0.3098000], [-0.5395769, -0.8953000, -0.9841000, -0.9280000]], [[-0.6106453, -0.5955000, -0.4895000, -0.4750000], [-0.1686577, -0.6844000, -0.6512000, -0.7891000], [-0.5845438, -0.9551000, -0.5958000, -0.4246000]], [[-0.3694958, -0.7905000, -0.9895000, -0.9712000], [0.4194767, 0.6235207, 0.5875871, 0.4410584], [-1.0320331, 1.2176377, 0.4245379, 0.2517347]]]]

Expected (Unparsed): [[[[-0.48933563999999996,-0.1676,-0.8255,-0.6355],[-0.33359478,-0.8249,-0.352,-0.3098],[-0.53957688,-0.8953,-0.9841,-0.928]],[[-0.61064534,-0.5955,-0.4895,-0.475],[-0.16865768000000003,-0.6844,-0.6512,-0.7891],[-0.58454378,-0.9551,-0.5958,-0.4246]],[[-0.3694958,-0.7905,-0.9895,-0.9712],[0.41947667999999994,0.6235207100000001,0.58758707,0.44105835999999976],[-1.0320331000000003,1.2176376599999998,0.42453788,0.25173464]]]]

Actual:   [[[[-0.4893, -0.1676, -0.8255, -0.6355], [-0.3335, -0.8249, -0.352, -0.3098], [-0.5395, -0.8953, -0.9841, -0.928]], [[-0.6106, -0.5955, -0.4895, -0.475], [-0.1686, -0.6844, -0.6512, -0.7891], [-0.5845, -0.9551, -0.5958, -0.4246]], [[-0.3694, -0.7905, -0.9895, -0.9712], [0.4195, 0.6236, 0.5876, 0.4411], [-1.032, 1.2177, 0.4246, 0.2518]]]]

Expected: [[[[-0.4893, -0.1676, -0.8255, -0.6355], [-0.3335, -0.8249, -0.352, -0.3098], [-0.5395, -0.8953, -0.9841, -0.928]], [[-0.6106, -0.5955, -0.4895, -0.475], [-0.1686, -0.6844, -0.6512, -0.7891], [-0.5845, -0.9551, -0.5958, -0.4246]], [[-0.3694, -0.7905, -0.9895, -0.9712], [0.4195, 0.6236, 0.5876, 0.4411], [-1.032, 1.2177, 0.4246, 0.2518]]]]