import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max423 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Max423 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Sub50611 = tf.keras.layers.Input(shape=([2]))
in1Sub50611 = tf.keras.layers.Input(shape=([2]))
in0Con78745 = tf.keras.layers.Input(shape=([2, 1, 3, 1]))
in0Mul22230 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Mul22230 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in0Con33760 = tf.keras.layers.Input(shape=([2, 1, 3, 1]))

Max423 = keras.layers.Maximum(name = 'Max423', )([in0Max423,in1Max423])
Res67901 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res67901', )(Max423)
Con36664 = keras.layers.Conv3D(3, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con36664', )(Res67901)
Zer380 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (1, 0)), name = 'Zer380', )(Con36664)
Sub50611 = keras.layers.Subtract(name = 'Sub50611', )([in0Sub50611,in1Sub50611])
Res41697 = keras.layers.Reshape((2, 1), name = 'Res41697', )(Sub50611)
Res26403 = keras.layers.Reshape((2, 1, 1), name = 'Res26403', )(Res41697)
Res24718 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res24718', )(Res26403)
Zer93881 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer93881', )(Res24718)
Con78745 = keras.layers.Concatenate(axis=4, name = 'Con78745', )([Zer93881,in0Con78745])
Mul22230 = keras.layers.Multiply(name = 'Mul22230', )([in0Mul22230,in1Mul22230])
Zer71665 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (1, 0)), name = 'Zer71665', )(Mul22230)
Sub3871 = keras.layers.Subtract(name = 'Sub3871', )([Con78745,Zer71665])
Con33760 = keras.layers.Concatenate(axis=4, name = 'Con33760', )([Sub3871,in0Con33760])
Sub86391 = keras.layers.Subtract(name = 'Sub86391', )([Zer380,Con33760])
Res69565 = keras.layers.Reshape((2, 1, 9), name = 'Res69565', )(Sub86391)
Con90426 = keras.layers.Conv2DTranspose(4, (1, 1),strides=(1, 1), padding='valid', name = 'Con90426', )(Res69565)
Res93797 = keras.layers.Reshape((2, 1, 4, 1), name = 'Res93797', )(Con90426)
PRe95038 = keras.layers.PReLU(name = 'PRe95038', )(Res93797)
model = tf.keras.models.Model(inputs=[in0Max423,in1Max423,in0Sub50611,in1Sub50611,in0Con78745,in0Mul22230,in1Mul22230,in0Con33760], outputs=PRe95038)
w = model.get_layer('Con36664').get_weights() 
w[0] = np.array([[[[[0.2232, 0.5228, 0.2793]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con36664').set_weights(w) 
w = model.get_layer('Con90426').get_weights() 
w[0] = np.array([[[[0.217, 0.4038, 0.9897, 0.669, 0.857, 0.8899, 0.4395, 0.5696, 0.1989], [0.7034, 0.5367, 0.5446, 0.9766, 0.4504, 0.9704, 0.1342, 0.614, 0.9505], [0.1631, 0.525, 0.0999, 0.3735, 0.2995, 0.2727, 0.7669, 0.3521, 0.414], [0.8449, 0.3874, 0.4838, 0.7917, 0.8829, 0.0056, 0.2385, 0.7063, 0.0743]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con90426').set_weights(w) 
w = model.get_layer('PRe95038').get_weights() 
w[0] = np.array([[[[0.051], [0.0709], [0.0142], [0.8717]]], [[[0.7871], [0.4672], [0.876], [0.9842]]]])
model.get_layer('PRe95038').set_weights(w) 
in0Max423 = tf.constant([[[[0.1814, 0.998]]]])
in1Max423 = tf.constant([[[[0.5438, 0.8822]]]])
in0Sub50611 = tf.constant([[0.8833, 0.6043]])
in1Sub50611 = tf.constant([[0.7056, 0.9704]])
in0Con78745 = tf.constant([[[[[0.8099], [0.5582], [0.0755]]], [[[0.8884], [0.8225], [0.2539]]]]])
in0Mul22230 = tf.constant([[[[[0.3601, 0.9802], [0.0332, 0.5571]]]]])
in1Mul22230 = tf.constant([[[[[0.4011, 0.9418], [0.2362, 0.8875]]]]])
in0Con33760 = tf.constant([[[[[0.1738], [0.3402], [0.5066]]], [[[0.2638], [0.4595], [0.0208]]]]])
print (np.array2string(model.predict([in0Max423,in1Max423,in0Sub50611,in1Sub50611,in0Con78745,in0Mul22230,in1Mul22230,in0Con33760],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='PRe95038.png')

LMax423 = maximum_layer([[[[[0.1814, 0.998]]]], [[[[0.5438, 0.8822]]]]], Max423), 
LRes67901 = reshape_layer(Max423, [1, 1, 2, 1], Res67901), 
LCon36664 = conv3D_layer(Res67901, 1, 1, 1,[[[[[0.2232, 0.5228, 0.2793]]]]],[0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con36664), 
LZer380 = zero_padding3D_layer(Con36664, 1, 0, 0, 0, 1, 0, Zer380), 
LSub50611 = subtract_layer([[0.8833, 0.6043]], [[0.7056, 0.9704]], Sub50611), 
LRes41697 = reshape_layer(Sub50611, [2, 1], Res41697), 
LRes26403 = reshape_layer(Res41697, [2, 1, 1], Res26403), 
LRes24718 = reshape_layer(Res26403, [2, 1, 1, 1], Res24718), 
LZer93881 = zero_padding3D_layer(Res24718, 0, 0, 0, 0, 2, 0, Zer93881), 
LCon78745 = concatenate_layer([Zer93881,[[[[[0.8099], [0.5582], [0.0755]]], [[[0.8884], [0.8225], [0.2539]]]]]], 4, Con78745), 
LMul22230 = multiply_layer([[[[[[0.3601, 0.9802], [0.0332, 0.5571]]]]], [[[[[0.4011, 0.9418], [0.2362, 0.8875]]]]]], Mul22230), 
LZer71665 = zero_padding3D_layer(Mul22230, 1, 0, 0, 0, 1, 0, Zer71665), 
LSub3871 = subtract_layer(Con78745,Zer71665, Sub3871), 
LCon33760 = concatenate_layer([Sub3871,[[[[[0.1738], [0.3402], [0.5066]]], [[[0.2638], [0.4595], [0.0208]]]]]], 4, Con33760), 
LSub86391 = subtract_layer(Zer380,Con33760, Sub86391), 
LRes69565 = reshape_layer(Sub86391, [2, 1, 9], Res69565), 
LCon90426 = conv2D_transpose_layer(Res69565, 1, 1,[[[[0.217, 0.4038, 0.9897, 0.669, 0.857, 0.8899, 0.4395, 0.5696, 0.1989], [0.7034, 0.5367, 0.5446, 0.9766, 0.4504, 0.9704, 0.1342, 0.614, 0.9505], [0.1631, 0.525, 0.0999, 0.3735, 0.2995, 0.2727, 0.7669, 0.3521, 0.414], [0.8449, 0.3874, 0.4838, 0.7917, 0.8829, 0.0056, 0.2385, 0.7063, 0.0743]]]],[0, 0, 0, 0], 1, 1, false, Con90426), 
LRes93797 = reshape_layer(Con90426, [2, 1, 4, 1], Res93797), 
LPRe95038 = prelu_layer(Res93797, [[[[0.051], [0.0709], [0.0142], [0.8717]]], [[[0.7871], [0.4672], [0.876], [0.9842]]]], PRe95038), 
exec_layers([LMax423,LRes67901,LCon36664,LZer380,LSub50611,LRes41697,LRes26403,LRes24718,LZer93881,LCon78745,LMul22230,LZer71665,LSub3871,LCon33760,LSub86391,LRes69565,LCon90426,LRes93797,LPRe95038],["Max423","Res67901","Con36664","Zer380","Sub50611","Res41697","Res26403","Res24718","Zer93881","Con78745","Mul22230","Zer71665","Sub3871","Con33760","Sub86391","Res69565","Con90426","Res93797","PRe95038"],PRe95038,"PRe95038")

Actual (Unparsed): [[[[[-0.0766038], [-0.1178780], [-0.0152665], [-0.8943006]]], [[[0.3619118], [0.3072834], [0.4707155], [0.7766773]]]]]

Expected (Unparsed): [[[[[-0.07660381305],[-0.117878042929],[-0.015266528488],[-0.894300635636]]],[[[0.36191181847600007],[0.307283374266],[0.47071551356400004],[0.776677290318]]]]]

Actual:   [[[[[-0.0766], [-0.1178], [-0.0152], [-0.8943]]], [[[0.362], [0.3073], [0.4708], [0.7767]]]]]

Expected: [[[[[-0.0766], [-0.1178], [-0.0152], [-0.8943]]], [[[0.362], [0.3073], [0.4708], [0.7767]]]]]