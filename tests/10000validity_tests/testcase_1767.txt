import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max19241 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Max19241 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Mul89608 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Mul89608 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))

Max19241 = keras.layers.Maximum(name = 'Max19241', )([in0Max19241,in1Max19241])
Res95165 = keras.layers.Reshape((2, 4), name = 'Res95165', )(Max19241)
Glo54433 = keras.layers.GlobalAveragePooling1D(name = 'Glo54433', )(Res95165)
Res15479 = keras.layers.Reshape((4, 1), name = 'Res15479', )(Glo54433)
Res87509 = keras.layers.Reshape((4, 1, 1), name = 'Res87509', )(Res15479)
Res30294 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res30294', )(Res87509)
Zer47542 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer47542', )(Res30294)
Mul89608 = keras.layers.Multiply(name = 'Mul89608', )([in0Mul89608,in1Mul89608])
Zer3392 = keras.layers.ZeroPadding3D(padding=((3, 0), (1, 0), (0, 0)), name = 'Zer3392', )(Mul89608)
Ave98120 = keras.layers.Average(name = 'Ave98120', )([Zer47542,Zer3392])
model = tf.keras.models.Model(inputs=[in0Max19241,in1Max19241,in0Mul89608,in1Mul89608], outputs=Ave98120)
in0Max19241 = tf.constant([[[[0.0944, 0.1212], [0.2518, 0.159]], [[0.8982, 0.1881], [0.6185, 0.7705]]]])
in1Max19241 = tf.constant([[[[0.7245, 0.9067], [0.5533, 0.8053]], [[0.4294, 0.0328], [0.4484, 0.9]]]])
in0Mul89608 = tf.constant([[[[[0.4826]], [[0.0334]]]]])
in1Mul89608 = tf.constant([[[[[0.6392]], [[0.0037]]]]])
print (np.array2string(model.predict([in0Max19241,in1Max19241,in0Mul89608,in1Mul89608],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave98120.png')

LMax19241 = maximum_layer([[[[[0.0944, 0.1212], [0.2518, 0.159]], [[0.8982, 0.1881], [0.6185, 0.7705]]]], [[[[0.7245, 0.9067], [0.5533, 0.8053]], [[0.4294, 0.0328], [0.4484, 0.9]]]]], Max19241), 
LRes95165 = reshape_layer(Max19241, [2, 4], Res95165), 
LGlo54433 = global_average_pooling1D_layer(Res95165, Glo54433), 
LRes15479 = reshape_layer(Glo54433, [4, 1], Res15479), 
LRes87509 = reshape_layer(Res15479, [4, 1, 1], Res87509), 
LRes30294 = reshape_layer(Res87509, [4, 1, 1, 1], Res30294), 
LZer47542 = zero_padding3D_layer(Res30294, 0, 0, 2, 0, 0, 0, Zer47542), 
LMul89608 = multiply_layer([[[[[[0.4826]], [[0.0334]]]]], [[[[[0.6392]], [[0.0037]]]]]], Mul89608), 
LZer3392 = zero_padding3D_layer(Mul89608, 3, 0, 1, 0, 0, 0, Zer3392), 
LAve98120 = average_layer([Zer47542,Zer3392], Ave98120), 
exec_layers([LMax19241,LRes95165,LGlo54433,LRes15479,LRes87509,LRes30294,LZer47542,LMul89608,LZer3392,LAve98120],["Max19241","Res95165","Glo54433","Res15479","Res87509","Res30294","Zer47542","Mul89608","Zer3392","Ave98120"],Ave98120,"Ave98120")

Actual (Unparsed): [[[[[0.0000000]], [[0.0000000]], [[0.4056750]]], [[[0.0000000]], [[0.0000000]], [[0.2737000]]], [[[0.0000000]], [[0.0000000]], [[0.2929500]]], [[[0.0000000]], [[0.1542390]], [[0.4263868]]]]]

Expected (Unparsed): [[[[[0]],[[0]],[[0.405675]]],[[[0]],[[0]],[[0.2737]]],[[[0]],[[0]],[[0.29295000000000004]]],[[[0]],[[0.15423895999999998]],[[0.42638679]]]]]

Actual:   [[[[[0]], [[0]], [[0.4057]]], [[[0]], [[0]], [[0.2737]]], [[[0]], [[0]], [[0.293]]], [[[0]], [[0.1543]], [[0.4264]]]]]

Expected: [[[[[0]], [[0]], [[0.4057]]], [[[0]], [[0]], [[0.2737]]], [[[0]], [[0]], [[0.293]]], [[[0]], [[0.1543]], [[0.4264]]]]]