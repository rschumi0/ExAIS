import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con22875 = tf.keras.layers.Input(shape=([2, 1]))
in0Ave71232 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Ave71232 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))

Con22875 = keras.layers.Conv1D(3, (2),strides=(1), padding='valid', dilation_rate=(1), name = 'Con22875', )(in0Con22875)
Res92748 = keras.layers.Reshape((1, 3, 1), name = 'Res92748', )(Con22875)
Res71786 = keras.layers.Reshape((1, 3, 1, 1), name = 'Res71786', )(Res92748)
Zer37987 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (0, 0)), name = 'Zer37987', )(Res71786)
Ave71232 = keras.layers.Average(name = 'Ave71232', )([in0Ave71232,in1Ave71232])
Zer88331 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer88331', )(Ave71232)
Mul25246 = keras.layers.Multiply(name = 'Mul25246', )([Zer37987,Zer88331])
model = tf.keras.models.Model(inputs=[in0Con22875,in0Ave71232,in1Ave71232], outputs=Mul25246)
w = model.get_layer('Con22875').get_weights() 
w[0] = np.array([[[0.5555, 0.6275, 0.1078]], [[0.9593, 0.7203, 0.3787]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con22875').set_weights(w) 
in0Con22875 = tf.constant([[[0.9339], [0.2199]]])
in0Ave71232 = tf.constant([[[[[0.4417]], [[0.0648]]], [[[0.9198]], [[0.6723]]]]])
in1Ave71232 = tf.constant([[[[[0.1674]], [[0.8118]]], [[[0.5139]], [[0.1068]]]]])
print (np.array2string(model.predict([in0Con22875,in0Ave71232,in1Ave71232],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul25246.png')

LCon22875 = conv1D_layer([[[0.9339], [0.2199]]], 2,[[[0.5555, 0.6275, 0.1078]], [[0.9593, 0.7203, 0.3787]]],[0, 0, 0], 1, false, 1, Con22875), 
LRes92748 = reshape_layer(Con22875, [1, 3, 1], Res92748), 
LRes71786 = reshape_layer(Res92748, [1, 3, 1, 1], Res71786), 
LZer37987 = zero_padding3D_layer(Res71786, 1, 0, 1, 0, 0, 0, Zer37987), 
LAve71232 = average_layer([[[[[[0.4417]], [[0.0648]]], [[[0.9198]], [[0.6723]]]]], [[[[[0.1674]], [[0.8118]]], [[[0.5139]], [[0.1068]]]]]], Ave71232), 
LZer88331 = zero_padding3D_layer(Ave71232, 0, 0, 2, 0, 0, 0, Zer88331), 
LMul25246 = multiply_layer([Zer37987,Zer88331], Mul25246), 
exec_layers([LCon22875,LRes92748,LRes71786,LZer37987,LAve71232,LZer88331,LMul25246],["Con22875","Res92748","Res71786","Zer37987","Ave71232","Zer88331","Mul25246"],Mul25246,"Mul25246")

Actual (Unparsed): [[[[[0.0000000]], [[0.0000000]], [[0.0000000]], [[0.0000000]]], [[[0.0000000]], [[0.0000000]], [[0.5336348]], [[0.0716579]]]]]

Expected (Unparsed): [[[[[0]],[[0]],[[0.0]],[[0.0]]],[[[0]],[[0.0]],[[0.533634767307]],[[0.0716579367525]]]]]

Actual:   [[[[[0]], [[0]], [[0]], [[0]]], [[[0]], [[0]], [[0.5337]], [[0.0717]]]]]

Expected: [[[[[0]], [[0]], [[0]], [[0]]], [[[0]], [[0]], [[0.5337]], [[0.0717]]]]]