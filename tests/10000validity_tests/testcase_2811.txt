import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave30427 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in1Ave30427 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in0Min93179 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Min93179 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in0Con43125 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Add63660 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Add63660 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con52617 = tf.keras.layers.Input(shape=([2, 2, 2]))

Ave30427 = keras.layers.Average(name = 'Ave30427', )([in0Ave30427,in1Ave30427])
Res32048 = keras.layers.Reshape((2, 1, 4), name = 'Res32048', )(Ave30427)
Zer51931 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer51931', )(Res32048)
Min93179 = keras.layers.Minimum(name = 'Min93179', )([in0Min93179,in1Min93179])
Res70586 = keras.layers.Reshape((1, 1, 1), name = 'Res70586', )(Min93179)
Zer4918 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer4918', )(Res70586)
Con43125 = keras.layers.Concatenate(axis=3, name = 'Con43125', )([Zer4918,in0Con43125])
Add63660 = keras.layers.Add(name = 'Add63660', )([in0Add63660,in1Add63660])
Mul78970 = keras.layers.Multiply(name = 'Mul78970', )([Con43125,Add63660])
Con52617 = keras.layers.Concatenate(axis=3, name = 'Con52617', )([Mul78970,in0Con52617])
Add61017 = keras.layers.Add(name = 'Add61017', )([Zer51931,Con52617])
Res43247 = keras.layers.Reshape((2, 8), name = 'Res43247', )(Add61017)
LST59186 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST59186', )(Res43247)
model = tf.keras.models.Model(inputs=[in0Ave30427,in1Ave30427,in0Min93179,in1Min93179,in0Con43125,in0Add63660,in1Add63660,in0Con52617], outputs=LST59186)
w = model.get_layer('LST59186').get_weights() 
w[0] = np.array([[4, 1, 4, 9, 3, 9, 1, 9], [3, 8, 8, 5, 9, 8, 8, 9], [2, 2, 7, 4, 4, 5, 9, 9], [5, 9, 10, 1, 6, 10, 1, 3], [7, 1, 6, 9, 7, 9, 8, 8], [2, 8, 6, 3, 2, 8, 4, 3], [10, 1, 5, 2, 6, 3, 4, 1], [4, 6, 4, 2, 9, 3, 3, 5]])
w[1] = np.array([[8, 10, 4, 9, 2, 8, 2, 5], [1, 10, 8, 1, 7, 3, 8, 4]])
w[2] = np.array([3, 2, 2, 6, 9, 8, 7, 1])
model.get_layer('LST59186').set_weights(w) 
in0Ave30427 = tf.constant([[[[[0.4945, 0.9789], [0.3602, 0.7287]]], [[[0.2906, 0.983], [0.4793, 0.6832]]]]])
in1Ave30427 = tf.constant([[[[[0.0248, 0.7657], [0.0453, 0.1698]]], [[[0.088, 0.1576], [0.1424, 0.7611]]]]])
in0Min93179 = tf.constant([[[[[0.3935]]]]])
in1Min93179 = tf.constant([[[[[0.5416]]]]])
in0Con43125 = tf.constant([[[[0.6937], [0.9733]], [[0.7273], [0.46]]]])
in0Add63660 = tf.constant([[[[0.8629, 0.1725], [0.119, 0.9979]], [[0.2748, 0.8303], [0.894, 0.9771]]]])
in1Add63660 = tf.constant([[[[0.2098, 0.2626], [0.1158, 0.5642]], [[0.769, 0.8267], [0.7615, 0.3673]]]])
in0Con52617 = tf.constant([[[[0.3193, 0.7172], [0.1108, 0.5631]], [[0.873, 0.5544], [0.303, 0.8635]]]])
print (np.array2string(model.predict([in0Ave30427,in1Ave30427,in0Min93179,in1Min93179,in0Con43125,in0Add63660,in1Add63660,in0Con52617],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST59186.png')

LAve30427 = average_layer([[[[[[0.4945, 0.9789], [0.3602, 0.7287]]], [[[0.2906, 0.983], [0.4793, 0.6832]]]]], [[[[[0.0248, 0.7657], [0.0453, 0.1698]]], [[[0.088, 0.1576], [0.1424, 0.7611]]]]]], Ave30427), 
LRes32048 = reshape_layer(Ave30427, [2, 1, 4], Res32048), 
LZer51931 = zero_padding2D_layer(Res32048, 0, 0, 1, 0, Zer51931), 
LMin93179 = minimum_layer([[[[[[0.3935]]]]], [[[[[0.5416]]]]]], Min93179), 
LRes70586 = reshape_layer(Min93179, [1, 1, 1], Res70586), 
LZer4918 = zero_padding2D_layer(Res70586, 1, 0, 1, 0, Zer4918), 
LCon43125 = concatenate_layer([Zer4918,[[[[0.6937], [0.9733]], [[0.7273], [0.46]]]]], 3, Con43125), 
LAdd63660 = add_layer([[[[[0.8629, 0.1725], [0.119, 0.9979]], [[0.2748, 0.8303], [0.894, 0.9771]]]], [[[[0.2098, 0.2626], [0.1158, 0.5642]], [[0.769, 0.8267], [0.7615, 0.3673]]]]], Add63660), 
LMul78970 = multiply_layer([Con43125,Add63660], Mul78970), 
LCon52617 = concatenate_layer([Mul78970,[[[[0.3193, 0.7172], [0.1108, 0.5631]], [[0.873, 0.5544], [0.303, 0.8635]]]]], 3, Con52617), 
LAdd61017 = add_layer([Zer51931,Con52617], Add61017), 
LRes43247 = reshape_layer(Add61017, [2, 8], Res43247), 
LLST59186 = lstm_layer(Res43247,[[4, 1, 4, 9, 3, 9, 1, 9], [3, 8, 8, 5, 9, 8, 8, 9], [2, 2, 7, 4, 4, 5, 9, 9], [5, 9, 10, 1, 6, 10, 1, 3], [7, 1, 6, 9, 7, 9, 8, 8], [2, 8, 6, 3, 2, 8, 4, 3], [10, 1, 5, 2, 6, 3, 4, 1], [4, 6, 4, 2, 9, 3, 3, 5]],[[8, 10, 4, 9, 2, 8, 2, 5], [1, 10, 8, 1, 7, 3, 8, 4]],[3, 2, 2, 6, 9, 8, 7, 1], LST59186), 
exec_layers([LAve30427,LRes32048,LZer51931,LMin93179,LRes70586,LZer4918,LCon43125,LAdd63660,LMul78970,LCon52617,LAdd61017,LRes43247,LLST59186],["Ave30427","Res32048","Zer51931","Min93179","Res70586","Zer4918","Con43125","Add63660","Mul78970","Con52617","Add61017","Res43247","LST59186"],LST59186,"LST59186")

Actual (Unparsed): [[0.9640276, 0.9640276]]

Expected (Unparsed): [[0.9640275800544232,0.9640275800758169]]

Actual:   [[0.9641, 0.9641]]

Expected: [[0.9641, 0.9641]]