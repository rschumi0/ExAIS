import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave81251 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Ave81251 = tf.keras.layers.Input(shape=([2, 2, 2]))

Ave81251 = keras.layers.Average(name = 'Ave81251', )([in0Ave81251,in1Ave81251])
Res77635 = keras.layers.Reshape((2, 4), name = 'Res77635', )(Ave81251)
LST53311 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST53311', )(Res77635)
model = tf.keras.models.Model(inputs=[in0Ave81251,in1Ave81251], outputs=LST53311)
w = model.get_layer('LST53311').get_weights() 
w[0] = np.array([[6, 1, 2, 3], [4, 7, 1, 9], [5, 5, 9, 2], [10, 5, 1, 2]])
w[1] = np.array([[10, 6, 1, 10]])
w[2] = np.array([3, 3, 8, 6])
model.get_layer('LST53311').set_weights(w) 
in0Ave81251 = tf.constant([[[[0.51, 0.6282], [0.7229, 0.2256]], [[0.32, 0.915], [0.8, 0.7798]]]])
in1Ave81251 = tf.constant([[[[0.1594, 0.9546], [0.3179, 0.7983]], [[0.2801, 0.9424], [0.2125, 0.9196]]]])
print (np.array2string(model.predict([in0Ave81251,in1Ave81251],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST53311.png')

LAve81251 = average_layer([[[[[0.51, 0.6282], [0.7229, 0.2256]], [[0.32, 0.915], [0.8, 0.7798]]]], [[[[0.1594, 0.9546], [0.3179, 0.7983]], [[0.2801, 0.9424], [0.2125, 0.9196]]]]], Ave81251), 
LRes77635 = reshape_layer(Ave81251, [2, 4], Res77635), 
LLST53311 = lstm_layer(Res77635,[[6, 1, 2, 3], [4, 7, 1, 9], [5, 5, 9, 2], [10, 5, 1, 2]],[[10, 6, 1, 10]],[3, 3, 8, 6], LST53311), 
exec_layers([LAve81251,LRes77635,LLST53311],["Ave81251","Res77635","LST53311"],LST53311,"LST53311")

Actual (Unparsed): [[0.9640276]]

Expected (Unparsed): [[0.9640275711938466]]

Actual:   [[0.9641]]

Expected: [[0.9641]]