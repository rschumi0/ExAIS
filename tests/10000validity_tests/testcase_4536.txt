import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub4945 = tf.keras.layers.Input(shape=([2]))
in1Sub4945 = tf.keras.layers.Input(shape=([2]))
in0Con70578 = tf.keras.layers.Input(shape=([3, 3]))
in0Sub52335 = tf.keras.layers.Input(shape=([3, 2, 2]))
in1Sub52335 = tf.keras.layers.Input(shape=([3, 2, 2]))
in0Max25206 = tf.keras.layers.Input(shape=([1, 1]))
in1Max25206 = tf.keras.layers.Input(shape=([1, 1]))
in0Con53905 = tf.keras.layers.Input(shape=([3, 3]))

Sub4945 = keras.layers.Subtract(name = 'Sub4945', )([in0Sub4945,in1Sub4945])
Res92888 = keras.layers.Reshape((2, 1), name = 'Res92888', )(Sub4945)
Cro14906 = keras.layers.Cropping1D(cropping=((0, 1)), name = 'Cro14906', )(Res92888)
ReL87464 = keras.layers.ReLU(max_value=7.108961739825472, negative_slope=5.878673715749581, threshold=0.7563074688834037, name = 'ReL87464', )(Cro14906)
Zer61739 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer61739', )(ReL87464)
Con70578 = keras.layers.Concatenate(axis=2, name = 'Con70578', )([Zer61739,in0Con70578])
Sub52335 = keras.layers.Subtract(name = 'Sub52335', )([in0Sub52335,in1Sub52335])
Res22254 = keras.layers.Reshape((3, 4), name = 'Res22254', )(Sub52335)
Max25206 = keras.layers.Maximum(name = 'Max25206', )([in0Max25206,in1Max25206])
Ave84448 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave84448', )(Max25206)
Zer63187 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer63187', )(Ave84448)
Con53905 = keras.layers.Concatenate(axis=2, name = 'Con53905', )([Zer63187,in0Con53905])
Mul14913 = keras.layers.Multiply(name = 'Mul14913', )([Res22254,Con53905])
Ave68050 = keras.layers.Average(name = 'Ave68050', )([Con70578,Mul14913])
model = tf.keras.models.Model(inputs=[in0Sub4945,in1Sub4945,in0Con70578,in0Sub52335,in1Sub52335,in0Max25206,in1Max25206,in0Con53905], outputs=Ave68050)
in0Sub4945 = tf.constant([[0.0799, 0.673]])
in1Sub4945 = tf.constant([[0.5343, 0.0956]])
in0Con70578 = tf.constant([[[0.7678, 0.1489, 0.4675], [0.6077, 0.8318, 0.1059], [0.3424, 0.2573, 0.4953]]])
in0Sub52335 = tf.constant([[[[0.6117, 0.9369], [0.9677, 0.0681]], [[0.6318, 0.7949], [0.3492, 0.0531]], [[0.9951, 0.0716], [0.5241, 0.1828]]]])
in1Sub52335 = tf.constant([[[[0.4576, 0.7509], [0.6442, 0.0186]], [[0.8824, 0.2095], [0.1949, 0.0891]], [[0.9203, 0.7119], [0.9747, 0.5346]]]])
in0Max25206 = tf.constant([[[0.3667]]])
in1Max25206 = tf.constant([[[0.9483]]])
in0Con53905 = tf.constant([[[0.2891, 0.4544, 0.489], [0.3115, 0.2492, 0.0495], [0.2378, 0.8386, 0.2321]]])
print (np.array2string(model.predict([in0Sub4945,in1Sub4945,in0Con70578,in0Sub52335,in1Sub52335,in0Max25206,in1Max25206,in0Con53905],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave68050.png')

LSub4945 = subtract_layer([[0.0799, 0.673]], [[0.5343, 0.0956]], Sub4945), 
LRes92888 = reshape_layer(Sub4945, [2, 1], Res92888), 
LCro14906 = cropping1D_layer(Res92888, 0, 1, Cro14906), 
LReL87464 = relu_layer(Cro14906, 7.108961739825472, 5.878673715749581, 0.7563074688834037, ReL87464), 
LZer61739 = zero_padding1D_layer(ReL87464, 2, 0, Zer61739), 
LCon70578 = concatenate_layer([Zer61739,[[[0.7678, 0.1489, 0.4675], [0.6077, 0.8318, 0.1059], [0.3424, 0.2573, 0.4953]]]], 2, Con70578), 
LSub52335 = subtract_layer([[[[0.6117, 0.9369], [0.9677, 0.0681]], [[0.6318, 0.7949], [0.3492, 0.0531]], [[0.9951, 0.0716], [0.5241, 0.1828]]]], [[[[0.4576, 0.7509], [0.6442, 0.0186]], [[0.8824, 0.2095], [0.1949, 0.0891]], [[0.9203, 0.7119], [0.9747, 0.5346]]]], Sub52335), 
LRes22254 = reshape_layer(Sub52335, [3, 4], Res22254), 
LMax25206 = maximum_layer([[[[0.3667]]], [[[0.9483]]]], Max25206), 
LAve84448 = average_pooling1D_layer(Max25206, 1, Ave84448), 
LZer63187 = zero_padding1D_layer(Ave84448, 2, 0, Zer63187), 
LCon53905 = concatenate_layer([Zer63187,[[[0.2891, 0.4544, 0.489], [0.3115, 0.2492, 0.0495], [0.2378, 0.8386, 0.2321]]]], 2, Con53905), 
LMul14913 = multiply_layer([Res22254,Con53905], Mul14913), 
LAve68050 = average_layer([Con70578,Mul14913], Ave68050), 
exec_layers([LSub4945,LRes92888,LCro14906,LReL87464,LZer61739,LCon70578,LSub52335,LRes22254,LMax25206,LAve84448,LZer63187,LCon53905,LMul14913,LAve68050],["Sub4945","Res92888","Cro14906","ReL87464","Zer61739","Con70578","Sub52335","Res22254","Max25206","Ave84448","Zer63187","Con53905","Mul14913","Ave68050"],Ave68050,"Ave68050")

Actual (Unparsed): [[[0.0000000, 0.4107863, 0.1479492, 0.2458527], [0.0000000, 0.3950260, 0.4351258, 0.0520590], [-3.5232108, 0.0950683, -0.0602866, 0.2068236]]]

Expected (Unparsed): [[[0.0,0.4107863,0.1479492,0.24585275],[0.0,0.39502605,0.43512578,0.052058999999999994],[-3.523210667393285,0.09506832999999999,-0.060286580000000006,0.20682361000000002]]]

Actual:   [[[0, 0.4108, 0.148, 0.2459], [0, 0.3951, 0.4352, 0.0521], [-3.5232, 0.0951, -0.0602, 0.2069]]]

Expected: [[[0, 0.4108, 0.148, 0.2459], [0, 0.3951, 0.4352, 0.0521], [-3.5232, 0.0951, -0.0602, 0.2069]]]