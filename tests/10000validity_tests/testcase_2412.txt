import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub12346 = tf.keras.layers.Input(shape=([3]))
in1Sub12346 = tf.keras.layers.Input(shape=([3]))
in0Con61142 = tf.keras.layers.Input(shape=([3, 1, 2]))
in0Con49459 = tf.keras.layers.Input(shape=([2, 1, 2]))

Sub12346 = keras.layers.Subtract(name = 'Sub12346', )([in0Sub12346,in1Sub12346])
Res48442 = keras.layers.Reshape((3, 1), name = 'Res48442', )(Sub12346)
Res56005 = keras.layers.Reshape((3, 1, 1), name = 'Res56005', )(Res48442)
Con61142 = keras.layers.Concatenate(axis=3, name = 'Con61142', )([Res56005,in0Con61142])
Con49459 = keras.layers.Conv2DTranspose(3, (2, 1),strides=(1, 1), padding='valid', name = 'Con49459', )(in0Con49459)
Max79147 = keras.layers.Maximum(name = 'Max79147', )([Con61142,Con49459])
model = tf.keras.models.Model(inputs=[in0Sub12346,in1Sub12346,in0Con61142,in0Con49459], outputs=Max79147)
w = model.get_layer('Con49459').get_weights() 
w[0] = np.array([[[[0.3217, 0.0282], [0.4038, 0.9695], [0.321, 0.0115]]], [[[0.4635, 0.2326], [0.4588, 0.2368], [0.5311, 0.179]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con49459').set_weights(w) 
in0Sub12346 = tf.constant([[0.2199, 0.9532, 0.8782]])
in1Sub12346 = tf.constant([[0.4167, 0.7378, 0.9826]])
in0Con61142 = tf.constant([[[[0.9129, 0.3546]], [[0.0571, 0.5662]], [[0.2671, 0.0935]]]])
in0Con49459 = tf.constant([[[[0.1153, 0.1273]], [[0.6757, 0.8291]]]])
print (np.array2string(model.predict([in0Sub12346,in1Sub12346,in0Con61142,in0Con49459],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max79147.png')

LSub12346 = subtract_layer([[0.2199, 0.9532, 0.8782]], [[0.4167, 0.7378, 0.9826]], Sub12346), 
LRes48442 = reshape_layer(Sub12346, [3, 1], Res48442), 
LRes56005 = reshape_layer(Res48442, [3, 1, 1], Res56005), 
LCon61142 = concatenate_layer([Res56005,[[[[0.9129, 0.3546]], [[0.0571, 0.5662]], [[0.2671, 0.0935]]]]], 3, Con61142), 
LCon49459 = conv2D_transpose_layer([[[[0.1153, 0.1273]], [[0.6757, 0.8291]]]], 2, 1,[[[[0.3217, 0.0282], [0.4038, 0.9695], [0.321, 0.0115]]], [[[0.4635, 0.2326], [0.4588, 0.2368], [0.5311, 0.179]]]],[0, 0, 0], 1, 1, false, Con49459), 
LMax79147 = maximum_layer([Con61142,Con49459], Max79147), 
exec_layers([LSub12346,LRes48442,LRes56005,LCon61142,LCon49459,LMax79147],["Sub12346","Res48442","Res56005","Con61142","Con49459","Max79147"],Max79147,"Max79147")

Actual (Unparsed): [[[[0.0406819, 0.9129000, 0.3546000]], [[0.3238048, 1.1597044, 0.5662000]], [[0.5060356, 0.5063420, 0.5072732]]]]

Expected (Unparsed): [[[[0.04068187,0.9129,0.3546]],[[0.32380484000000004,1.15970439,0.5662]],[[0.50603561,0.5063420399999999,0.5072731699999999]]]]

Actual:   [[[[0.0407, 0.9129, 0.3546]], [[0.3239, 1.1598, 0.5662]], [[0.5061, 0.5064, 0.5073]]]]

Expected: [[[[0.0407, 0.9129, 0.3546]], [[0.3239, 1.1598, 0.5662]], [[0.5061, 0.5064, 0.5073]]]]