import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min2711 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Min2711 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))

Min2711 = keras.layers.Minimum(name = 'Min2711', )([in0Min2711,in1Min2711])
Res92703 = keras.layers.Reshape((1, 2, 1), name = 'Res92703', )(Min2711)
Res74388 = keras.layers.Reshape((1, 2), name = 'Res74388', )(Res92703)
Cro62163 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro62163', )(Res74388)
GRU68742 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU68742', )(Cro62163)
Res25324 = keras.layers.Reshape((3, 1), name = 'Res25324', )(GRU68742)
Res77016 = keras.layers.Reshape((3, 1, 1), name = 'Res77016', )(Res25324)
Res93492 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res93492', )(Res77016)
Con66391 = keras.layers.Conv3DTranspose(4, (2, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con66391', )(Res93492)
model = tf.keras.models.Model(inputs=[in0Min2711,in1Min2711], outputs=Con66391)
w = model.get_layer('GRU68742').get_weights() 
w[0] = np.array([[2, 5, 6, 2, 3, 5, 4, 10, 6], [6, 1, 9, 9, 4, 4, 3, 4, 4]])
w[1] = np.array([[10, 8, 5, 5, 7, 1, 7, 5, 10], [10, 6, 1, 2, 10, 5, 8, 5, 7], [5, 10, 10, 9, 3, 5, 8, 7, 7]])
w[2] = np.array([10, 8, 3, 5, 9, 4, 6, 2, 4])
model.get_layer('GRU68742').set_weights(w) 
w = model.get_layer('Con66391').get_weights() 
w[0] = np.array([[[[[0.8629], [0.0404], [0.1202], [0.9722]]]], [[[[0.8498], [0.1186], [0.0849], [0.1296]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con66391').set_weights(w) 
in0Min2711 = tf.constant([[[[[0.3343]], [[0.7259]]]]])
in1Min2711 = tf.constant([[[[[0.1688]], [[0.8204]]]]])
print (np.array2string(model.predict([in0Min2711,in1Min2711],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con66391.png')

LMin2711 = minimum_layer([[[[[[0.3343]], [[0.7259]]]]], [[[[[0.1688]], [[0.8204]]]]]], Min2711), 
LRes92703 = reshape_layer(Min2711, [1, 2, 1], Res92703), 
LRes74388 = reshape_layer(Res92703, [1, 2], Res74388), 
LCro62163 = cropping1D_layer(Res74388, 0, 0, Cro62163), 
LGRU68742 = gru_layer(Cro62163,[[2, 5, 6, 2, 3, 5, 4, 10, 6], [6, 1, 9, 9, 4, 4, 3, 4, 4]],[[10, 8, 5, 5, 7, 1, 7, 5, 10], [10, 6, 1, 2, 10, 5, 8, 5, 7], [5, 10, 10, 9, 3, 5, 8, 7, 7]],[10, 8, 3, 5, 9, 4, 6, 2, 4], false, GRU68742), 
LRes25324 = reshape_layer(GRU68742, [3, 1], Res25324), 
LRes77016 = reshape_layer(Res25324, [3, 1, 1], Res77016), 
LRes93492 = reshape_layer(Res77016, [3, 1, 1, 1], Res93492), 
LCon66391 = conv3D_transpose_layer(Res93492, 2, 1, 1,[[[[[0.8629], [0.0404], [0.1202], [0.9722]]]], [[[[0.8498], [0.1186], [0.0849], [0.1296]]]]],[0, 0, 0, 0], 1, 1, 1, false, Con66391), 
exec_layers([LMin2711,LRes92703,LRes74388,LCro62163,LGRU68742,LRes25324,LRes77016,LRes93492,LCon66391],["Min2711","Res92703","Res74388","Cro62163","GRU68742","Res25324","Res77016","Res93492","Con66391"],Con66391,"Con66391")

Actual (Unparsed): [[[[[0.0000004, 0.0000000, 0.0000000, 0.0000004]]], [[[0.0000606, 0.0000029, 0.0000084, 0.0000679]]], [[[0.0000820, 0.0000093, 0.0000091, 0.0000346]]], [[[0.0000224, 0.0000031, 0.0000022, 0.0000034]]]]]

Expected (Unparsed): [[[[[3.5881570881514224e-7,1.6799344809516453e-8,4.9982209061977163e-8,4.0426542138148254e-7]]],[[[6.0577945628190436e-5,2.8689633366847173e-6,8.424449689333675e-6,6.790686811971168e-5]]],[[[8.20048975296236e-5,9.340012942618503e-6,9.086752718621356e-6,3.4614447332926836e-5]]],[[[2.235007641084178e-5,3.1192269502539835e-6,2.2329036094145296e-6,3.40853130483066e-6]]]]]

Actual:   [[[[[0, 0, 0, 0]]], [[[0.0001, 0, 0, 0.0001]]], [[[0.0001, 0, 0, 0.0001]]], [[[0.0001, 0, 0, 0]]]]]

Expected: [[[[[0, 0, 0, 0]]], [[[0.0001, 0, 0, 0.0001]]], [[[0.0001, 0, 0, 0.0001]]], [[[0.0001, 0, 0, 0]]]]]