import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul54049 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Mul54049 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Con49451 = tf.keras.layers.Input(shape=([2, 7]))
in0Mul23627 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul23627 = tf.keras.layers.Input(shape=([2, 1]))

Mul54049 = keras.layers.Multiply(name = 'Mul54049', )([in0Mul54049,in1Mul54049])
Res7916 = keras.layers.Reshape((2, 2, 1), name = 'Res7916', )(Mul54049)
Con6883 = keras.layers.Conv2D(4, (1, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con6883', )(Res7916)
Res340 = keras.layers.Reshape((2, 8), name = 'Res340', )(Con6883)
Con49451 = keras.layers.Concatenate(axis=2, name = 'Con49451', )([Res340,in0Con49451])
Mul23627 = keras.layers.Multiply(name = 'Mul23627', )([in0Mul23627,in1Mul23627])
Dot92167 = keras.layers.Dot(axes=(1, 1), name = 'Dot92167', )([Con49451,Mul23627])
model = tf.keras.models.Model(inputs=[in0Mul54049,in1Mul54049,in0Con49451,in0Mul23627,in1Mul23627], outputs=Dot92167)
w = model.get_layer('Con6883').get_weights() 
w[0] = np.array([[[[0.9359, 0.5201, 0.4786, 0.2702]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con6883').set_weights(w) 
in0Mul54049 = tf.constant([[[[[0.3037]], [[0.9969]]], [[[0.3396]], [[0.5377]]]]])
in1Mul54049 = tf.constant([[[[[0.6052]], [[0.0614]]], [[[0.7044]], [[0.8626]]]]])
in0Con49451 = tf.constant([[[0.1827, 0.6928, 0.2564, 0.4557, 0.9919, 0.963, 0.7344], [0.2249, 0.1133, 0.8319, 0.0652, 0.27, 0.8892, 0.8802]]])
in0Mul23627 = tf.constant([[[0.0704], [0.7468]]])
in1Mul23627 = tf.constant([[[0.2865], [0.0951]]])
print (np.array2string(model.predict([in0Mul54049,in1Mul54049,in0Con49451,in0Mul23627,in1Mul23627],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot92167.png')

LMul54049 = multiply_layer([[[[[[0.3037]], [[0.9969]]], [[[0.3396]], [[0.5377]]]]], [[[[[0.6052]], [[0.0614]]], [[[0.7044]], [[0.8626]]]]]], Mul54049), 
LRes7916 = reshape_layer(Mul54049, [2, 2, 1], Res7916), 
LCon6883 = conv2D_layer(Res7916, 1, 1,[[[[0.9359, 0.5201, 0.4786, 0.2702]]]],[0, 0, 0, 0], 1, 1, false, 1, 1, Con6883), 
LRes340 = reshape_layer(Con6883, [2, 8], Res340), 
LCon49451 = concatenate_layer([Res340,[[[0.1827, 0.6928, 0.2564, 0.4557, 0.9919, 0.963, 0.7344], [0.2249, 0.1133, 0.8319, 0.0652, 0.27, 0.8892, 0.8802]]]], 2, Con49451), 
LMul23627 = multiply_layer([[[[0.0704], [0.7468]]], [[[0.2865], [0.0951]]]], Mul23627), 
LDot92167 = dot_layer(Con49451,Mul23627, 1, 1, Dot92167), 
exec_layers([LMul54049,LRes7916,LCon6883,LRes340,LCon49451,LMul23627,LDot92167],["Mul54049","Res7916","Con6883","Res340","Con49451","Mul23627","Dot92167"],Dot92167,"Dot92167")

Actual (Unparsed): [[[0.0193697], [0.0107642], [0.0099053], [0.0055921], [0.0319847], [0.0177746], [0.0163563], [0.0092342], [0.0196575], [0.0220201], [0.0642536], [0.0138218], [0.0391818], [0.0825749], [0.0773250]]]

Expected (Unparsed): [[[0.019369681341011462],[0.010764153505139505],[0.009905256426763636],[0.0055921443512568616],[0.031984745232705586],[0.01777461907845943],[0.01635634049404092],[0.009234189723129662],[0.019657536852],[0.022020141924],[0.06425358913200001],[0.013821835055999997],[0.03918180984],[0.082574913456],[0.077324956776]]]

Actual:   [[[0.0194], [0.0108], [0.01], [0.0056], [0.032], [0.0178], [0.0164], [0.0093], [0.0197], [0.0221], [0.0643], [0.0139], [0.0392], [0.0826], [0.0774]]]

Expected: [[[0.0194], [0.0108], [0.01], [0.0056], [0.032], [0.0178], [0.0164], [0.0093], [0.0197], [0.0221], [0.0643], [0.0139], [0.0392], [0.0826], [0.0774]]]