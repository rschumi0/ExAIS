import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot31842 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot31842 = tf.keras.layers.Input(shape=([2, 3]))
in0Con57687 = tf.keras.layers.Input(shape=([1]))
in0Ave6419 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave6419 = tf.keras.layers.Input(shape=([2, 2]))

Dot31842 = keras.layers.Dot(axes=(1, 1), name = 'Dot31842', )([in0Dot31842,in1Dot31842])
Res3463 = keras.layers.Reshape((3, 3, 1), name = 'Res3463', )(Dot31842)
Dep33219 = keras.layers.DepthwiseConv2D((1, 3),strides=(3, 3), padding='same', name = 'Dep33219', )(Res3463)
Res60250 = keras.layers.Reshape((1, 1), name = 'Res60250', )(Dep33219)
Fla71707 = keras.layers.Flatten(name = 'Fla71707', )(Res60250)
Con57687 = keras.layers.Concatenate(axis=1, name = 'Con57687', )([Fla71707,in0Con57687])
Ave6419 = keras.layers.Average(name = 'Ave6419', )([in0Ave6419,in1Ave6419])
GRU43989 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU43989', )(Ave6419)
Ave19494 = keras.layers.Average(name = 'Ave19494', )([Con57687,GRU43989])
model = tf.keras.models.Model(inputs=[in0Dot31842,in1Dot31842,in0Con57687,in0Ave6419,in1Ave6419], outputs=Ave19494)
w = model.get_layer('Dep33219').get_weights() 
w[0] = np.array([[[[0.5933]], [[0.6398]], [[0.4963]]]])
w[1] = np.array([0])
model.get_layer('Dep33219').set_weights(w) 
w = model.get_layer('GRU43989').get_weights() 
w[0] = np.array([[6, 9, 6, 6, 9, 8], [5, 3, 3, 10, 7, 6]])
w[1] = np.array([[4, 10, 4, 5, 10, 6], [6, 5, 5, 9, 2, 5]])
w[2] = np.array([[2, 7, 2, 3, 3, 8], [10, 7, 4, 8, 3, 7]])
model.get_layer('GRU43989').set_weights(w) 
in0Dot31842 = tf.constant([[[0.1995, 0.2774, 0.1857], [0.1681, 0.3701, 0.3346]]])
in1Dot31842 = tf.constant([[[0.4486, 0.7401, 0.1038], [0.4841, 0.6032, 0.5048]]])
in0Con57687 = tf.constant([[0.6395]])
in0Ave6419 = tf.constant([[[0.7476, 0.1351], [0.3825, 0.3409]]])
in1Ave6419 = tf.constant([[[0.2316, 0.9745], [0.1068, 0.3067]]])
print (np.array2string(model.predict([in0Dot31842,in1Dot31842,in0Con57687,in0Ave6419,in1Ave6419],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave19494.png')

LDot31842 = dot_layer([[[0.1995, 0.2774, 0.1857], [0.1681, 0.3701, 0.3346]]], [[[0.4486, 0.7401, 0.1038], [0.4841, 0.6032, 0.5048]]], 1, 1, Dot31842), 
LRes3463 = reshape_layer(Dot31842, [3, 3, 1], Res3463), 
LDep33219 = depthwise_conv2D_layer(Res3463, 1, 3,[[[[0.5933]], [[0.6398]], [[0.4963]]]],[0], 3, 3, true, Dep33219), 
LRes60250 = reshape_layer(Dep33219, [1, 1], Res60250), 
LFla71707 = flatten_layer(Res60250, Fla71707), 
LCon57687 = concatenate_layer([Fla71707,[[0.6395]]], 1, Con57687), 
LAve6419 = average_layer([[[[0.7476, 0.1351], [0.3825, 0.3409]]], [[[0.2316, 0.9745], [0.1068, 0.3067]]]], Ave6419), 
LGRU43989 = gru_layer(Ave6419,[[6, 9, 6, 6, 9, 8], [5, 3, 3, 10, 7, 6]],[[4, 10, 4, 5, 10, 6], [6, 5, 5, 9, 2, 5]],[[2, 7, 2, 3, 3, 8], [10, 7, 4, 8, 3, 7]], true, GRU43989), 
LAve19494 = average_layer([Con57687,GRU43989], Ave19494), 
exec_layers([LDot31842,LRes3463,LDep33219,LRes60250,LFla71707,LCon57687,LAve6419,LGRU43989,LAve19494],["Dot31842","Res3463","Dep33219","Res60250","Fla71707","Con57687","Ave6419","GRU43989","Ave19494"],Ave19494,"Ave19494")

Actual (Unparsed): [[0.1565560, 0.3197500]]

Expected (Unparsed): [[0.1565559625329029,0.31975001836706507]]

Actual:   [[0.1566, 0.3198]]

Expected: [[0.1566, 0.3198]]