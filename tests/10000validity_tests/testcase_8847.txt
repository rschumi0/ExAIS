import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub3410 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Sub3410 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Mas27514 = tf.keras.layers.Input(shape=([1, 3]))
in0Con42410 = tf.keras.layers.Input(shape=([1, 3, 1]))
in0Ave95206 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Ave95206 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in0Con12296 = tf.keras.layers.Input(shape=([7]))

Sub3410 = keras.layers.Subtract(name = 'Sub3410', )([in0Sub3410,in1Sub3410])
Res74070 = keras.layers.Reshape((2, 4), name = 'Res74070', )(Sub3410)
Fla47369 = keras.layers.Flatten(name = 'Fla47369', )(Res74070)
Mas27514 = keras.layers.Masking(mask_value=2, name = 'Mas27514', )(in0Mas27514)
Res92080 = keras.layers.Reshape((1, 3, 1), name = 'Res92080', )(Mas27514)
Con42410 = keras.layers.Concatenate(axis=3, name = 'Con42410', )([Res92080,in0Con42410])
Ave95206 = keras.layers.Average(name = 'Ave95206', )([in0Ave95206,in1Ave95206])
Res50470 = keras.layers.Reshape((1, 1, 2), name = 'Res50470', )(Ave95206)
Con6163 = keras.layers.Conv2D(2, (1, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con6163', )(Res50470)
Zer92960 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer92960', )(Con6163)
Max87792 = keras.layers.Maximum(name = 'Max87792', )([Con42410,Zer92960])
Res2683 = keras.layers.Reshape((1, 6), name = 'Res2683', )(Max87792)
GRU98599 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU98599', )(Res2683)
Con12296 = keras.layers.Concatenate(axis=1, name = 'Con12296', )([GRU98599,in0Con12296])
Sub72693 = keras.layers.Subtract(name = 'Sub72693', )([Fla47369,Con12296])
model = tf.keras.models.Model(inputs=[in0Sub3410,in1Sub3410,in0Mas27514,in0Con42410,in0Ave95206,in1Ave95206,in0Con12296], outputs=Sub72693)
w = model.get_layer('Con6163').get_weights() 
w[0] = np.array([[[[0.2607, 0.7496], [0.8236, 0.5465]]]])
w[1] = np.array([0, 0])
model.get_layer('Con6163').set_weights(w) 
w = model.get_layer('GRU98599').get_weights() 
w[0] = np.array([[10, 4, 5], [8, 1, 4], [6, 9, 5], [8, 8, 9], [10, 6, 4], [7, 2, 9]])
w[1] = np.array([[5, 10, 7]])
w[2] = np.array([[2, 3, 4], [1, 1, 1]])
model.get_layer('GRU98599').set_weights(w) 
in0Sub3410 = tf.constant([[[[0.3013, 0.5642], [0.0959, 0.7453]], [[0.2751, 0.7551], [0.3066, 0.4742]]]])
in1Sub3410 = tf.constant([[[[0.8837, 0.027], [0.4958, 0.3387]], [[0.3439, 0.2058], [0.7421, 0.3125]]]])
in0Mas27514 = tf.constant([[[1.8962, 1.4712, 1.6629]]])
in0Con42410 = tf.constant([[[[0.6863], [0.8218], [0.6465]]]])
in0Ave95206 = tf.constant([[[[[0.9867, 0.3757]]]]])
in1Ave95206 = tf.constant([[[[[0.5306, 0.5269]]]]])
in0Con12296 = tf.constant([[0.2754, 0.7367, 0.4037, 0.9633, 0.8909, 0.6944, 0.4534]])
print (np.array2string(model.predict([in0Sub3410,in1Sub3410,in0Mas27514,in0Con42410,in0Ave95206,in1Ave95206,in0Con12296],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub72693.png')

LSub3410 = subtract_layer([[[[0.3013, 0.5642], [0.0959, 0.7453]], [[0.2751, 0.7551], [0.3066, 0.4742]]]], [[[[0.8837, 0.027], [0.4958, 0.3387]], [[0.3439, 0.2058], [0.7421, 0.3125]]]], Sub3410), 
LRes74070 = reshape_layer(Sub3410, [2, 4], Res74070), 
LFla47369 = flatten_layer(Res74070, Fla47369), 
LMas27514 = masking_layer([[[1.8962, 1.4712, 1.6629]]], 2, Mas27514), 
LRes92080 = reshape_layer(Mas27514, [1, 3, 1], Res92080), 
LCon42410 = concatenate_layer([Res92080,[[[[0.6863], [0.8218], [0.6465]]]]], 3, Con42410), 
LAve95206 = average_layer([[[[[[0.9867, 0.3757]]]]], [[[[[0.5306, 0.5269]]]]]], Ave95206), 
LRes50470 = reshape_layer(Ave95206, [1, 1, 2], Res50470), 
LCon6163 = conv2D_layer(Res50470, 1, 1,[[[[0.2607, 0.7496], [0.8236, 0.5465]]]],[0, 0], 1, 1, false, 1, 1, Con6163), 
LZer92960 = zero_padding2D_layer(Con6163, 0, 0, 2, 0, Zer92960), 
LMax87792 = maximum_layer([Con42410,Zer92960], Max87792), 
LRes2683 = reshape_layer(Max87792, [1, 6], Res2683), 
LGRU98599 = gru_layer(Res2683,[[10, 4, 5], [8, 1, 4], [6, 9, 5], [8, 8, 9], [10, 6, 4], [7, 2, 9]],[[5, 10, 7]],[[2, 3, 4], [1, 1, 1]], true, GRU98599), 
LCon12296 = concatenate_layer([GRU98599,[[0.2754, 0.7367, 0.4037, 0.9633, 0.8909, 0.6944, 0.4534]]], 1, Con12296), 
LSub72693 = subtract_layer(Fla47369,Con12296, Sub72693), 
exec_layers([LSub3410,LRes74070,LFla47369,LMas27514,LRes92080,LCon42410,LAve95206,LRes50470,LCon6163,LZer92960,LMax87792,LRes2683,LGRU98599,LCon12296,LSub72693],["Sub3410","Res74070","Fla47369","Mas27514","Res92080","Con42410","Ave95206","Res50470","Con6163","Zer92960","Max87792","Res2683","GRU98599","Con12296","Sub72693"],Sub72693,"Sub72693")

Actual (Unparsed): [[-0.5824000, 0.2618000, -1.1366000, 0.0029000, -1.0321000, -0.3416000, -1.1299000, -0.2917000]]

Expected (Unparsed): [[-0.5824,0.26180000000000003,-1.1366,0.002899999999999958,-1.0321,-0.3416,-1.1299000000000001,-0.2917]]

Actual:   [[-0.5824, 0.2618, -1.1366, 0.0029, -1.0321, -0.3416, -1.1299, -0.2917]]

Expected: [[-0.5824, 0.2619, -1.1366, 0.0029, -1.0321, -0.3416, -1.1299, -0.2917]]