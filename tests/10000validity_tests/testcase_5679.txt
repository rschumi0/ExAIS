import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc58537 = tf.keras.layers.Input(shape=([2, 2]))
in0Max28162 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Max28162 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Mul97248 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul97248 = tf.keras.layers.Input(shape=([2, 1]))
in0Add80351 = tf.keras.layers.Input(shape=([1, 1]))
in1Add80351 = tf.keras.layers.Input(shape=([1, 1]))
in0Ave79015 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Ave79015 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))

Loc58537 = keras.layers.LocallyConnected1D(2, (2),strides=(1), name = 'Loc58537', )(in0Loc58537)
Res16481 = keras.layers.Reshape((1, 2, 1), name = 'Res16481', )(Loc58537)
Res69052 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res69052', )(Res16481)
Zer24192 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (1, 0)), name = 'Zer24192', )(Res69052)
Max28162 = keras.layers.Maximum(name = 'Max28162', )([in0Max28162,in1Max28162])
Mul72875 = keras.layers.Multiply(name = 'Mul72875', )([Zer24192,Max28162])
Zer81668 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (1, 0)), name = 'Zer81668', )(Mul72875)
Mul97248 = keras.layers.Multiply(name = 'Mul97248', )([in0Mul97248,in1Mul97248])
Add80351 = keras.layers.Add(name = 'Add80351', )([in0Add80351,in1Add80351])
Zer39207 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer39207', )(Add80351)
Add39973 = keras.layers.Add(name = 'Add39973', )([Mul97248,Zer39207])
Res17304 = keras.layers.Reshape((2, 1, 1), name = 'Res17304', )(Add39973)
Res50820 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res50820', )(Res17304)
Zer39716 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (0, 0)), name = 'Zer39716', )(Res50820)
Ave79015 = keras.layers.Average(name = 'Ave79015', )([in0Ave79015,in1Ave79015])
Ave18790 = keras.layers.Average(name = 'Ave18790', )([Zer39716,Ave79015])
Zer4373 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer4373', )(Ave18790)
Mul80795 = keras.layers.Multiply(name = 'Mul80795', )([Zer81668,Zer4373])
model = tf.keras.models.Model(inputs=[in0Loc58537,in0Max28162,in1Max28162,in0Mul97248,in1Mul97248,in0Add80351,in1Add80351,in0Ave79015,in1Ave79015], outputs=Mul80795)
w = model.get_layer('Loc58537').get_weights() 
w[0] = np.array([[[0.7686, 0.7349], [0.9417, 0.7059], [0.2807, 0.213], [0.4423, 0.4226]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc58537').set_weights(w) 
in0Loc58537 = tf.constant([[[0.4786, 0.6195], [0.3057, 0.152]]])
in0Max28162 = tf.constant([[[[[0.3598], [0.0905]], [[0.5946], [0.3548]]]]])
in1Max28162 = tf.constant([[[[[0.7121], [0.6946]], [[0.24], [0.4405]]]]])
in0Mul97248 = tf.constant([[[0.427], [0.8286]]])
in1Mul97248 = tf.constant([[[0.742], [0.2395]]])
in0Add80351 = tf.constant([[[0.3165]]])
in1Add80351 = tf.constant([[[0.8598]]])
in0Ave79015 = tf.constant([[[[[0.0944]], [[0.0804]]], [[[0.009]], [[0.249]]]]])
in1Ave79015 = tf.constant([[[[[0.203]], [[0.4284]]], [[[0.1816]], [[0.4685]]]]])
print (np.array2string(model.predict([in0Loc58537,in0Max28162,in1Max28162,in0Mul97248,in1Mul97248,in0Add80351,in1Add80351,in0Ave79015,in1Ave79015],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul80795.png')

LLoc58537 = locally_connected1D_layer([[[0.4786, 0.6195], [0.3057, 0.152]]], 2,[[[0.7686, 0.7349], [0.9417, 0.7059], [0.2807, 0.213], [0.4423, 0.4226]]],[[0, 0]], 1, Loc58537), 
LRes16481 = reshape_layer(Loc58537, [1, 2, 1], Res16481), 
LRes69052 = reshape_layer(Res16481, [1, 2, 1, 1], Res69052), 
LZer24192 = zero_padding3D_layer(Res69052, 0, 0, 0, 0, 1, 0, Zer24192), 
LMax28162 = maximum_layer([[[[[[0.3598], [0.0905]], [[0.5946], [0.3548]]]]], [[[[[0.7121], [0.6946]], [[0.24], [0.4405]]]]]], Max28162), 
LMul72875 = multiply_layer([Zer24192,Max28162], Mul72875), 
LZer81668 = zero_padding3D_layer(Mul72875, 1, 0, 0, 0, 1, 0, Zer81668), 
LMul97248 = multiply_layer([[[[0.427], [0.8286]]], [[[0.742], [0.2395]]]], Mul97248), 
LAdd80351 = add_layer([[[[0.3165]]], [[[0.8598]]]], Add80351), 
LZer39207 = zero_padding1D_layer(Add80351, 1, 0, Zer39207), 
LAdd39973 = add_layer([Mul97248,Zer39207], Add39973), 
LRes17304 = reshape_layer(Add39973, [2, 1, 1], Res17304), 
LRes50820 = reshape_layer(Res17304, [2, 1, 1, 1], Res50820), 
LZer39716 = zero_padding3D_layer(Res50820, 0, 0, 1, 0, 0, 0, Zer39716), 
LAve79015 = average_layer([[[[[[0.0944]], [[0.0804]]], [[[0.009]], [[0.249]]]]], [[[[[0.203]], [[0.4284]]], [[[0.1816]], [[0.4685]]]]]], Ave79015), 
LAve18790 = average_layer([Zer39716,Ave79015], Ave18790), 
LZer4373 = zero_padding3D_layer(Ave18790, 0, 0, 0, 0, 2, 0, Zer4373), 
LMul80795 = multiply_layer([Zer81668,Zer4373], Mul80795), 
exec_layers([LLoc58537,LRes16481,LRes69052,LZer24192,LMax28162,LMul72875,LZer81668,LMul97248,LAdd80351,LZer39207,LAdd39973,LRes17304,LRes50820,LZer39716,LAve79015,LAve18790,LZer4373,LMul80795],["Loc58537","Res16481","Res69052","Zer24192","Max28162","Mul72875","Zer81668","Mul97248","Add80351","Zer39207","Add39973","Res17304","Res50820","Zer39716","Ave79015","Ave18790","Zer4373","Mul80795"],Mul80795,"Mul80795")

Actual (Unparsed): [[[[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0365489]], [[0.0000000], [0.0000000], [0.3506395]]]]]

Expected (Unparsed): [[[[[0],[0],[0.0]],[[0],[0],[0.0]]],[[[0],[0.0],[0.036548941695443]],[[0],[0.0],[0.3506395645242361]]]]]

Actual:   [[[[[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0.0366]], [[0], [0], [0.3507]]]]]

Expected: [[[[[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0.0366]], [[0], [0], [0.3507]]]]]