import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot48561 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot48561 = tf.keras.layers.Input(shape=([2, 3]))
in0Ave63833 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Ave63833 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con65732 = tf.keras.layers.Input(shape=([4, 4, 2]))

Dot48561 = keras.layers.Dot(axes=(2, 2), name = 'Dot48561', )([in0Dot48561,in1Dot48561])
Res63941 = keras.layers.Reshape((2, 2, 1), name = 'Res63941', )(Dot48561)
Res45230 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res45230', )(Res63941)
Zer89258 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer89258', )(Res45230)
Res63811 = keras.layers.Reshape((4, 4, 3), name = 'Res63811', )(Zer89258)
Ave63833 = keras.layers.Average(name = 'Ave63833', )([in0Ave63833,in1Ave63833])
Zer75457 = keras.layers.ZeroPadding2D(padding=((3, 0), (2, 0)), name = 'Zer75457', )(Ave63833)
Con65732 = keras.layers.Concatenate(axis=3, name = 'Con65732', )([Zer75457,in0Con65732])
Sub94699 = keras.layers.Subtract(name = 'Sub94699', )([Res63811,Con65732])
model = tf.keras.models.Model(inputs=[in0Dot48561,in1Dot48561,in0Ave63833,in1Ave63833,in0Con65732], outputs=Sub94699)
in0Dot48561 = tf.constant([[[0.6988, 0.4995, 0.473], [0.5898, 0.4174, 0.3371]]])
in1Dot48561 = tf.constant([[[0.3874, 0.9771, 0.5572], [0.1056, 0.4014, 0.5716]]])
in0Ave63833 = tf.constant([[[[0.1355], [0.0319]]]])
in1Ave63833 = tf.constant([[[[0.1889], [0.3546]]]])
in0Con65732 = tf.constant([[[[0.8248, 0.5165], [0.0585, 0.2675], [0.2745, 0.9389], [0.4956, 0.5419]], [[0.8567, 0.0131], [0.4901, 0.5469], [0.8551, 0.9973], [0.767, 0.1414]], [[0.1798, 0.4144], [0.6881, 0.7893], [0.7352, 0.3913], [0.4138, 0.1981]], [[0.3058, 0.4209], [0.0764, 0.401], [0.0754, 0.7749], [0.3412, 0.2938]]]])
print (np.array2string(model.predict([in0Dot48561,in1Dot48561,in0Ave63833,in1Ave63833,in0Con65732],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub94699.png')

LDot48561 = dot_layer([[[0.6988, 0.4995, 0.473], [0.5898, 0.4174, 0.3371]]], [[[0.3874, 0.9771, 0.5572], [0.1056, 0.4014, 0.5716]]], 2, 2, Dot48561), 
LRes63941 = reshape_layer(Dot48561, [2, 2, 1], Res63941), 
LRes45230 = reshape_layer(Res63941, [2, 2, 1, 1], Res45230), 
LZer89258 = zero_padding3D_layer(Res45230, 1, 1, 1, 1, 1, 1, Zer89258), 
LRes63811 = reshape_layer(Zer89258, [4, 4, 3], Res63811), 
LAve63833 = average_layer([[[[[0.1355], [0.0319]]]], [[[[0.1889], [0.3546]]]]], Ave63833), 
LZer75457 = zero_padding2D_layer(Ave63833, 3, 0, 2, 0, Zer75457), 
LCon65732 = concatenate_layer([Zer75457,[[[[0.8248, 0.5165], [0.0585, 0.2675], [0.2745, 0.9389], [0.4956, 0.5419]], [[0.8567, 0.0131], [0.4901, 0.5469], [0.8551, 0.9973], [0.767, 0.1414]], [[0.1798, 0.4144], [0.6881, 0.7893], [0.7352, 0.3913], [0.4138, 0.1981]], [[0.3058, 0.4209], [0.0764, 0.401], [0.0754, 0.7749], [0.3412, 0.2938]]]]], 3, Con65732), 
LSub94699 = subtract_layer(Res63811,Con65732, Sub94699), 
exec_layers([LDot48561,LRes63941,LRes45230,LZer89258,LRes63811,LAve63833,LZer75457,LCon65732,LSub94699],["Dot48561","Res63941","Res45230","Zer89258","Res63811","Ave63833","Zer75457","Con65732","Sub94699"],Sub94699,"Sub94699")

Actual (Unparsed): [[[[0.0000000, -0.8248000, -0.5165000], [0.0000000, -0.0585000, -0.2675000], [0.0000000, -0.2745000, -0.9389000], [0.0000000, -0.4956000, -0.5419000]], [[0.0000000, -0.8567000, -0.0131000], [0.0000000, 0.5322322, -0.5469000], [0.0000000, -0.3104406, -0.9973000], [0.0000000, -0.7670000, -0.1414000]], [[0.0000000, -0.1798000, -0.4144000], [0.0000000, 0.1360622, -0.7893000], [0.0000000, -0.3126864, -0.3913000], [0.0000000, -0.4138000, -0.1981000]], [[0.0000000, -0.3058000, -0.4209000], [0.0000000, -0.0764000, -0.4010000], [-0.1622000, -0.0754000, -0.7749000], [-0.1932500, -0.3412000, -0.2938000]]]]

Expected (Unparsed): [[[[0,-0.8248,-0.5165],[0,-0.0585,-0.2675],[0,-0.2745,-0.9389],[0,-0.4956,-0.5419]],[[0,-0.8567,-0.0131],[0,0.5322321699999999,-0.5469],[0,-0.31044062000000006,-0.9973],[0,-0.767,-0.1414]],[[0,-0.1798,-0.4144],[0,0.13606218000000003,-0.7893],[0,-0.3126864,-0.3913],[0,-0.4138,-0.1981]],[[0,-0.3058,-0.4209],[0,-0.0764,-0.401],[-0.1622,-0.0754,-0.7749],[-0.19325,-0.3412,-0.2938]]]]

Actual:   [[[[0, -0.8248, -0.5165], [0, -0.0585, -0.2675], [0, -0.2745, -0.9389], [0, -0.4956, -0.5419]], [[0, -0.8567, -0.0131], [0, 0.5323, -0.5469], [0, -0.3104, -0.9973], [0, -0.767, -0.1414]], [[0, -0.1798, -0.4144], [0, 0.1361, -0.7893], [0, -0.3126, -0.3913], [0, -0.4138, -0.1981]], [[0, -0.3058, -0.4209], [0, -0.0764, -0.401], [-0.1622, -0.0754, -0.7749], [-0.1932, -0.3412, -0.2938]]]]

Expected: [[[[0, -0.8248, -0.5165], [0, -0.0585, -0.2675], [0, -0.2745, -0.9389], [0, -0.4956, -0.5419]], [[0, -0.8567, -0.0131], [0, 0.5323, -0.5469], [0, -0.3104, -0.9973], [0, -0.767, -0.1414]], [[0, -0.1798, -0.4144], [0, 0.1361, -0.7893], [0, -0.3126, -0.3913], [0, -0.4138, -0.1981]], [[0, -0.3058, -0.4209], [0, -0.0764, -0.401], [-0.1622, -0.0754, -0.7749], [-0.1932, -0.3412, -0.2938]]]]