import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot83279 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot83279 = tf.keras.layers.Input(shape=([3, 3]))
in0Mul4282 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Mul4282 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))

Dot83279 = keras.layers.Dot(axes=(2, 2), name = 'Dot83279', )([in0Dot83279,in1Dot83279])
Res67220 = keras.layers.Reshape((3, 3, 1), name = 'Res67220', )(Dot83279)
Ave8357 = keras.layers.AveragePooling2D(pool_size=(2, 2), strides=(1, 1), padding='valid', name = 'Ave8357', )(Res67220)
Res37194 = keras.layers.Reshape((2, 2), name = 'Res37194', )(Ave8357)
Mul4282 = keras.layers.Multiply(name = 'Mul4282', )([in0Mul4282,in1Mul4282])
Res17707 = keras.layers.Reshape((1, 1, 2), name = 'Res17707', )(Mul4282)
Res74003 = keras.layers.Reshape((1, 2), name = 'Res74003', )(Res17707)
Ave8135 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='valid', name = 'Ave8135', )(Res74003)
Zer63705 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer63705', )(Ave8135)
Ave37117 = keras.layers.Average(name = 'Ave37117', )([Res37194,Zer63705])
model = tf.keras.models.Model(inputs=[in0Dot83279,in1Dot83279,in0Mul4282,in1Mul4282], outputs=Ave37117)
in0Dot83279 = tf.constant([[[0.765, 0.7679, 0.6433], [0.1207, 0.1893, 0.7329], [0.9626, 0.3746, 0.1283]]])
in1Dot83279 = tf.constant([[[0.4148, 0.3815, 0.3167], [0.5634, 0.6383, 0.2225], [0.7659, 0.7829, 0.3292]]])
in0Mul4282 = tf.constant([[[[[0.9593], [0.173]]]]])
in1Mul4282 = tf.constant([[[[[0.5726], [0.796]]]]])
print (np.array2string(model.predict([in0Dot83279,in1Dot83279,in0Mul4282,in1Mul4282],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave37117.png')

LDot83279 = dot_layer([[[0.765, 0.7679, 0.6433], [0.1207, 0.1893, 0.7329], [0.9626, 0.3746, 0.1283]]], [[[0.4148, 0.3815, 0.3167], [0.5634, 0.6383, 0.2225], [0.7659, 0.7829, 0.3292]]], 2, 2, Dot83279), 
LRes67220 = reshape_layer(Dot83279, [3, 3, 1], Res67220), 
LAve8357 = average_pooling2D_layer(Res67220, 2, 2, 1, 1, false, Ave8357), 
LRes37194 = reshape_layer(Ave8357, [2, 2], Res37194), 
LMul4282 = multiply_layer([[[[[[0.9593], [0.173]]]]], [[[[[0.5726], [0.796]]]]]], Mul4282), 
LRes17707 = reshape_layer(Mul4282, [1, 1, 2], Res17707), 
LRes74003 = reshape_layer(Res17707, [1, 2], Res74003), 
LAve8135 = average_pooling1D_layer(Res74003, 1, 1, false, Ave8135), 
LZer63705 = zero_padding1D_layer(Ave8135, 1, 0, Zer63705), 
LAve37117 = average_layer([Res37194,Zer63705], Ave37117), 
exec_layers([LDot83279,LRes67220,LAve8357,LRes37194,LMul4282,LRes17707,LRes74003,LAve8135,LZer63705,LAve37117],["Dot83279","Res67220","Ave8357","Res37194","Mul4282","Res17707","Res74003","Ave8135","Zer63705","Ave37117"],Ave37117,"Ave37117")

Actual (Unparsed): [[[0.3230739, 0.4121229], [0.5370361, 0.4084252]]]

Expected (Unparsed): [[[0.3230739175,0.41212289874999997],[0.53703613,0.40842517624999997]]]

Actual:   [[[0.3231, 0.4122], [0.5371, 0.4085]]]

Expected: [[[0.3231, 0.4122], [0.5371, 0.4085]]]