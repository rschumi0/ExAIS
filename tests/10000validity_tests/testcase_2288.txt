import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub56711 = tf.keras.layers.Input(shape=([3, 2, 2]))
in1Sub56711 = tf.keras.layers.Input(shape=([3, 2, 2]))
in0Max12788 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Max12788 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Sub90899 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub90899 = tf.keras.layers.Input(shape=([2, 2]))
in0Con70236 = tf.keras.layers.Input(shape=([2, 1]))

Sub56711 = keras.layers.Subtract(name = 'Sub56711', )([in0Sub56711,in1Sub56711])
Max12788 = keras.layers.Maximum(name = 'Max12788', )([in0Max12788,in1Max12788])
Zer55046 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer55046', )(Max12788)
Ave87433 = keras.layers.Average(name = 'Ave87433', )([Sub56711,Zer55046])
Res23466 = keras.layers.Reshape((3, 4), name = 'Res23466', )(Ave87433)
Con52787 = keras.layers.Conv1D(3, (3),strides=(2), padding='valid', dilation_rate=(1), name = 'Con52787', )(Res23466)
Zer78776 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer78776', )(Con52787)
Sub90899 = keras.layers.Subtract(name = 'Sub90899', )([in0Sub90899,in1Sub90899])
ELU92896 = keras.layers.ELU(alpha=-1.7132613750908234, name = 'ELU92896', )(Sub90899)
Con70236 = keras.layers.Concatenate(axis=2, name = 'Con70236', )([ELU92896,in0Con70236])
Ave27887 = keras.layers.Average(name = 'Ave27887', )([Zer78776,Con70236])
model = tf.keras.models.Model(inputs=[in0Sub56711,in1Sub56711,in0Max12788,in1Max12788,in0Sub90899,in1Sub90899,in0Con70236], outputs=Ave27887)
w = model.get_layer('Con52787').get_weights() 
w[0] = np.array([[[0.3963, 0.1014, 0.9302], [0.4521, 0.4008, 0.5621], [0.7443, 0.102, 0.8645], [0.5724, 0.2559, 0.5431]], [[0.5251, 0.3983, 0.3037], [0.5413, 0.0569, 0.3711], [0.0196, 0.9389, 0.6951], [0.3728, 0.5373, 0.6711]], [[0.1448, 0.6891, 0.3207], [0.3542, 0.0085, 0.7635], [0.4779, 0.6369, 0.3071], [0.0818, 0.0429, 0.092]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con52787').set_weights(w) 
in0Sub56711 = tf.constant([[[[0.2205, 0.6926], [0.807, 0.089]], [[0.6247, 0.2553], [0.2338, 0.88]], [[0.4262, 0.057], [0.3599, 0.3851]]]])
in1Sub56711 = tf.constant([[[[0.0056, 0.5529], [0.9493, 0.295]], [[0.768, 0.3799], [0.0573, 0.3481]], [[0.5466, 0.5048], [0.7614, 0.6674]]]])
in0Max12788 = tf.constant([[[[0.2079, 0.0954], [0.7724, 0.1548]], [[0.801, 0.5901], [0.3978, 0.8477]]]])
in1Max12788 = tf.constant([[[[0.7308, 0.9912], [0.3497, 0.2014]], [[0.596, 0.2343], [0.4489, 0.1102]]]])
in0Sub90899 = tf.constant([[[0.5337, 0.5983], [0.3593, 0.1031]]])
in1Sub90899 = tf.constant([[[0.1361, 0.5107], [0.1116, 0.558]]])
in0Con70236 = tf.constant([[[0.685], [0.7432]]])
print (np.array2string(model.predict([in0Sub56711,in1Sub56711,in0Max12788,in1Max12788,in0Sub90899,in1Sub90899,in0Con70236],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave27887.png')

LSub56711 = subtract_layer([[[[0.2205, 0.6926], [0.807, 0.089]], [[0.6247, 0.2553], [0.2338, 0.88]], [[0.4262, 0.057], [0.3599, 0.3851]]]], [[[[0.0056, 0.5529], [0.9493, 0.295]], [[0.768, 0.3799], [0.0573, 0.3481]], [[0.5466, 0.5048], [0.7614, 0.6674]]]], Sub56711), 
LMax12788 = maximum_layer([[[[[0.2079, 0.0954], [0.7724, 0.1548]], [[0.801, 0.5901], [0.3978, 0.8477]]]], [[[[0.7308, 0.9912], [0.3497, 0.2014]], [[0.596, 0.2343], [0.4489, 0.1102]]]]], Max12788), 
LZer55046 = zero_padding2D_layer(Max12788, 1, 0, 0, 0, Zer55046), 
LAve87433 = average_layer([Sub56711,Zer55046], Ave87433), 
LRes23466 = reshape_layer(Ave87433, [3, 4], Res23466), 
LCon52787 = conv1D_layer(Res23466, 3,[[[0.3963, 0.1014, 0.9302], [0.4521, 0.4008, 0.5621], [0.7443, 0.102, 0.8645], [0.5724, 0.2559, 0.5431]], [[0.5251, 0.3983, 0.3037], [0.5413, 0.0569, 0.3711], [0.0196, 0.9389, 0.6951], [0.3728, 0.5373, 0.6711]], [[0.1448, 0.6891, 0.3207], [0.3542, 0.0085, 0.7635], [0.4779, 0.6369, 0.3071], [0.0818, 0.0429, 0.092]]],[0, 0, 0], 2, false, 1, Con52787), 
LZer78776 = zero_padding1D_layer(Con52787, 1, 0, Zer78776), 
LSub90899 = subtract_layer([[[0.5337, 0.5983], [0.3593, 0.1031]]], [[[0.1361, 0.5107], [0.1116, 0.558]]], Sub90899), 
LELU92896 = elu_layer(Sub90899, -1.7132613750908234, ELU92896), 
LCon70236 = concatenate_layer([ELU92896,[[[0.685], [0.7432]]]], 2, Con70236), 
LAve27887 = average_layer([Zer78776,Con70236], Ave27887), 
exec_layers([LSub56711,LMax12788,LZer55046,LAve87433,LRes23466,LCon52787,LZer78776,LSub90899,LELU92896,LCon70236,LAve27887],["Sub56711","Max12788","Zer55046","Ave87433","Res23466","Con52787","Zer78776","Sub90899","ELU92896","Con70236","Ave27887"],Ave27887,"Ave27887")

Actual (Unparsed): [[[0.1988000, 0.0438000, 0.3425000], [0.4268275, 0.8389496, 0.8937833]]]

Expected (Unparsed): [[[0.19879999999999998,0.043800000000000006,0.3425],[0.4268275450000001,0.8389495970727037,0.8937833100000001]]]

Actual:   [[[0.1988, 0.0438, 0.3425], [0.4269, 0.839, 0.8938]]]

Expected: [[[0.1988, 0.0439, 0.3425], [0.4269, 0.839, 0.8938]]]