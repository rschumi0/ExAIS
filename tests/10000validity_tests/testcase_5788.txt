import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add15423 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Add15423 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Con33927 = tf.keras.layers.Input(shape=([4, 3]))
in0Sub15624 = tf.keras.layers.Input(shape=([2]))
in1Sub15624 = tf.keras.layers.Input(shape=([2]))
in0Con78938 = tf.keras.layers.Input(shape=([2, 3]))
in0Ave74761 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Ave74761 = tf.keras.layers.Input(shape=([2, 2, 2]))

Add15423 = keras.layers.Add(name = 'Add15423', )([in0Add15423,in1Add15423])
Res30344 = keras.layers.Reshape((2, 1, 1), name = 'Res30344', )(Add15423)
Res89756 = keras.layers.Reshape((2, 1), name = 'Res89756', )(Res30344)
Zer67270 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer67270', )(Res89756)
Con33927 = keras.layers.Concatenate(axis=2, name = 'Con33927', )([Zer67270,in0Con33927])
Sub15624 = keras.layers.Subtract(name = 'Sub15624', )([in0Sub15624,in1Sub15624])
Res17965 = keras.layers.Reshape((2, 1), name = 'Res17965', )(Sub15624)
Con78938 = keras.layers.Concatenate(axis=2, name = 'Con78938', )([Res17965,in0Con78938])
Ave74761 = keras.layers.Average(name = 'Ave74761', )([in0Ave74761,in1Ave74761])
Res50081 = keras.layers.Reshape((2, 4), name = 'Res50081', )(Ave74761)
Dot80011 = keras.layers.Dot(axes=(1, 1), name = 'Dot80011', )([Con78938,Res50081])
Sub99191 = keras.layers.Subtract(name = 'Sub99191', )([Con33927,Dot80011])
Res94416 = keras.layers.Reshape((4, 4, 1), name = 'Res94416', )(Sub99191)
Ave3878 = keras.layers.AveragePooling2D(pool_size=(2, 4), name = 'Ave3878', )(Res94416)
model = tf.keras.models.Model(inputs=[in0Add15423,in1Add15423,in0Con33927,in0Sub15624,in1Sub15624,in0Con78938,in0Ave74761,in1Ave74761], outputs=Ave3878)
in0Add15423 = tf.constant([[[[[0.3891]]], [[[0.9093]]]]])
in1Add15423 = tf.constant([[[[[0.0199]]], [[[0.8952]]]]])
in0Con33927 = tf.constant([[[0.2319, 0.5421, 0.5189], [0.7216, 0.1908, 0.4531], [0.6149, 0.2755, 0.9808], [0.9668, 0.0774, 0.3361]]])
in0Sub15624 = tf.constant([[0.3581, 0.8133]])
in1Sub15624 = tf.constant([[0.9654, 0.5427]])
in0Con78938 = tf.constant([[[0.3464, 0.8284, 0.6415], [0.9016, 0.6915, 0.6646]]])
in0Ave74761 = tf.constant([[[[0.9418, 0.5348], [0.454, 0.2912]], [[0.4816, 0.0015], [0.1952, 0.5345]]]])
in1Ave74761 = tf.constant([[[[0.4208, 0.3343], [0.3085, 0.5537]], [[0.2007, 0.3257], [0.7256, 0.2261]]]])
print (np.array2string(model.predict([in0Add15423,in1Add15423,in0Con33927,in0Sub15624,in1Sub15624,in0Con78938,in0Ave74761,in1Ave74761],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave3878.png')

LAdd15423 = add_layer([[[[[[0.3891]]], [[[0.9093]]]]], [[[[[0.0199]]], [[[0.8952]]]]]], Add15423), 
LRes30344 = reshape_layer(Add15423, [2, 1, 1], Res30344), 
LRes89756 = reshape_layer(Res30344, [2, 1], Res89756), 
LZer67270 = zero_padding1D_layer(Res89756, 2, 0, Zer67270), 
LCon33927 = concatenate_layer([Zer67270,[[[0.2319, 0.5421, 0.5189], [0.7216, 0.1908, 0.4531], [0.6149, 0.2755, 0.9808], [0.9668, 0.0774, 0.3361]]]], 2, Con33927), 
LSub15624 = subtract_layer([[0.3581, 0.8133]], [[0.9654, 0.5427]], Sub15624), 
LRes17965 = reshape_layer(Sub15624, [2, 1], Res17965), 
LCon78938 = concatenate_layer([Res17965,[[[0.3464, 0.8284, 0.6415], [0.9016, 0.6915, 0.6646]]]], 2, Con78938), 
LAve74761 = average_layer([[[[[0.9418, 0.5348], [0.454, 0.2912]], [[0.4816, 0.0015], [0.1952, 0.5345]]]], [[[[0.4208, 0.3343], [0.3085, 0.5537]], [[0.2007, 0.3257], [0.7256, 0.2261]]]]], Ave74761), 
LRes50081 = reshape_layer(Ave74761, [2, 4], Res50081), 
LDot80011 = dot_layer(Con78938,Res50081, 1, 1, Dot80011), 
LSub99191 = subtract_layer(Con33927,Dot80011, Sub99191), 
LRes94416 = reshape_layer(Sub99191, [4, 4, 1], Res94416), 
LAve3878 = average_pooling2D_layer(Res94416, 2, 4, Ave3878), 
exec_layers([LAdd15423,LRes30344,LRes89756,LZer67270,LCon33927,LSub15624,LRes17965,LCon78938,LAve74761,LRes50081,LDot80011,LSub99191,LRes94416,LAve3878],["Add15423","Res30344","Res89756","Zer67270","Con33927","Sub15624","Res17965","Con78938","Ave74761","Res50081","Dot80011","Sub99191","Res94416","Ave3878"],Ave3878,"Ave3878")

Actual (Unparsed): [[[[0.1977593]], [[0.1023611]]]]

Expected (Unparsed): [[[[0.19775926312500003]],[[0.10236108875000005]]]]

Actual:   [[[[0.1978]], [[0.1024]]]]

Expected: [[[[0.1978]], [[0.1024]]]]