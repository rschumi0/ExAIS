import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul74049 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Mul74049 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Mul71576 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul71576 = tf.keras.layers.Input(shape=([1, 1]))
in0Con12691 = tf.keras.layers.Input(shape=([2]))

Mul74049 = keras.layers.Multiply(name = 'Mul74049', )([in0Mul74049,in1Mul74049])
Den5780 = keras.layers.Dense(2,name = 'Den5780', )(Mul74049)
Res25104 = keras.layers.Reshape((1, 1, 4), name = 'Res25104', )(Den5780)
Res96648 = keras.layers.Reshape((1, 4), name = 'Res96648', )(Res25104)
Loc23133 = keras.layers.LocallyConnected1D(3, (1),strides=(1), name = 'Loc23133', )(Res96648)
Fla99478 = keras.layers.Flatten(name = 'Fla99478', )(Loc23133)
Mul71576 = keras.layers.Multiply(name = 'Mul71576', )([in0Mul71576,in1Mul71576])
Res51465 = keras.layers.Reshape((1, 1, 1), name = 'Res51465', )(Mul71576)
Glo99742 = keras.layers.GlobalMaxPool2D(name = 'Glo99742', )(Res51465)
Con12691 = keras.layers.Concatenate(axis=1, name = 'Con12691', )([Glo99742,in0Con12691])
Max79816 = keras.layers.Maximum(name = 'Max79816', )([Fla99478,Con12691])
model = tf.keras.models.Model(inputs=[in0Mul74049,in1Mul74049,in0Mul71576,in1Mul71576,in0Con12691], outputs=Max79816)
w = model.get_layer('Den5780').get_weights() 
w[0] = np.array([[0.1083, 0.0793]])
w[1] = np.array([0.1829, 0.9254])
model.get_layer('Den5780').set_weights(w) 
w = model.get_layer('Loc23133').get_weights() 
w[0] = np.array([[[0.3771, 0.7633, 0.0653], [0.6046, 0.7562, 0.924], [0.8783, 0.8153, 0.0153], [0.5615, 0.9887, 0.1636]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc23133').set_weights(w) 
in0Mul74049 = tf.constant([[[[[0.0521], [0.084]]]]])
in1Mul74049 = tf.constant([[[[[0.7527], [0.3329]]]]])
in0Mul71576 = tf.constant([[[0.5676]]])
in1Mul71576 = tf.constant([[[0.4391]]])
in0Con12691 = tf.constant([[0.8756, 0.2742]])
print (np.array2string(model.predict([in0Mul74049,in1Mul74049,in0Mul71576,in1Mul71576,in0Con12691],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max79816.png')

LMul74049 = multiply_layer([[[[[[0.0521], [0.084]]]]], [[[[[0.7527], [0.3329]]]]]], Mul74049), 
LDen5780 = dense_layer(Mul74049, [[0.1083, 0.0793]],[0.1829, 0.9254], Den5780), 
LRes25104 = reshape_layer(Den5780, [1, 1, 4], Res25104), 
LRes96648 = reshape_layer(Res25104, [1, 4], Res96648), 
LLoc23133 = locally_connected1D_layer(Res96648, 1,[[[0.3771, 0.7633, 0.0653], [0.6046, 0.7562, 0.924], [0.8783, 0.8153, 0.0153], [0.5615, 0.9887, 0.1636]]],[[0, 0, 0]], 1, Loc23133), 
LFla99478 = flatten_layer(Loc23133, Fla99478), 
LMul71576 = multiply_layer([[[[0.5676]]], [[[0.4391]]]], Mul71576), 
LRes51465 = reshape_layer(Mul71576, [1, 1, 1], Res51465), 
LGlo99742 = global_max_pool2D_layer(Res51465, Glo99742), 
LCon12691 = concatenate_layer([Glo99742,[[0.8756, 0.2742]]], 1, Con12691), 
LMax79816 = maximum_layer([Fla99478,Con12691], Max79816), 
exec_layers([LMul74049,LDen5780,LRes25104,LRes96648,LLoc23133,LFla99478,LMul71576,LRes51465,LGlo99742,LCon12691,LMax79816],["Mul74049","Den5780","Res25104","Res96648","Loc23133","Fla99478","Mul71576","Res51465","Glo99742","Con12691","Max79816"],Max79816,"Max79816")

Actual (Unparsed): [[1.3161084, 1.9137114, 1.0247667]]

Expected (Unparsed): [[1.31610838026343,1.9137113686914635,1.0247666910680193]]

Actual:   [[1.3162, 1.9138, 1.0248]]

Expected: [[1.3162, 1.9138, 1.0248]]