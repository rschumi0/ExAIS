import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mas48533 = tf.keras.layers.Input(shape=([2, 3, 1]))

Mas48533 = keras.layers.Masking(mask_value=2, name = 'Mas48533', )(in0Mas48533)
Res26961 = keras.layers.Reshape((2, 3), name = 'Res26961', )(Mas48533)
GRU24900 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU24900', )(Res26961)
Res56823 = keras.layers.Reshape((2, 1), name = 'Res56823', )(GRU24900)
GRU50999 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU50999', )(Res56823)
Mas11175 = keras.layers.Masking(mask_value=1, name = 'Mas11175', )(GRU50999)
model = tf.keras.models.Model(inputs=[in0Mas48533], outputs=Mas11175)
w = model.get_layer('GRU24900').get_weights() 
w[0] = np.array([[10, 4, 7, 6, 2, 2], [8, 5, 10, 8, 1, 6], [8, 10, 5, 7, 10, 7]])
w[1] = np.array([[2, 3, 4, 5, 7, 10], [8, 8, 3, 9, 4, 2]])
w[2] = np.array([[4, 6, 10, 1, 3, 2], [5, 6, 10, 4, 5, 3]])
model.get_layer('GRU24900').set_weights(w) 
w = model.get_layer('GRU50999').get_weights() 
w[0] = np.array([[2, 3, 4, 8, 9, 5, 4, 9, 9]])
w[1] = np.array([[3, 2, 7, 7, 1, 10, 4, 10, 6], [6, 4, 8, 6, 8, 1, 6, 6, 2], [7, 4, 9, 2, 5, 8, 9, 4, 8]])
w[2] = np.array([9, 9, 4, 3, 4, 3, 4, 2, 9])
model.get_layer('GRU50999').set_weights(w) 
in0Mas48533 = tf.constant([[[[1.5271], [1.828], [1.8578]], [[1.7041], [1.0907], [1.907]]]])
print (np.array2string(model.predict([in0Mas48533],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mas11175.png')

LMas48533 = masking_layer([[[[1.5271], [1.828], [1.8578]], [[1.7041], [1.0907], [1.907]]]], 2, Mas48533), 
LRes26961 = reshape_layer(Mas48533, [2, 3], Res26961), 
LGRU24900 = gru_layer(Res26961,[[10, 4, 7, 6, 2, 2], [8, 5, 10, 8, 1, 6], [8, 10, 5, 7, 10, 7]],[[2, 3, 4, 5, 7, 10], [8, 8, 3, 9, 4, 2]],[[4, 6, 10, 1, 3, 2], [5, 6, 10, 4, 5, 3]], true, GRU24900), 
LRes56823 = reshape_layer(GRU24900, [2, 1], Res56823), 
LGRU50999 = gru_layer(Res56823,[[2, 3, 4, 8, 9, 5, 4, 9, 9]],[[3, 2, 7, 7, 1, 10, 4, 10, 6], [6, 4, 8, 6, 8, 1, 6, 6, 2], [7, 4, 9, 2, 5, 8, 9, 4, 8]],[9, 9, 4, 3, 4, 3, 4, 2, 9], false, GRU50999), 
LMas11175 = masking_layer(GRU50999, 1, Mas11175), 
exec_layers([LMas48533,LRes26961,LGRU24900,LRes56823,LGRU50999,LMas11175],["Mas48533","Res26961","GRU24900","Res56823","GRU50999","Mas11175"],Mas11175,"Mas11175")

Actual (Unparsed): [[0.0002319, 0.0002301, 0.0330228]]

Expected (Unparsed): [[0.0002319258475375759,0.0002300981075825276,0.03302276411774824]]

Actual:   [[0.0003, 0.0003, 0.0331]]

Expected: [[0.0003, 0.0003, 0.0331]]