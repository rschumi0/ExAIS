import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max87070 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Max87070 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Max17395 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Max17395 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Con77763 = tf.keras.layers.Input(shape=([13]))

Max87070 = keras.layers.Maximum(name = 'Max87070', )([in0Max87070,in1Max87070])
Mas61571 = keras.layers.Masking(mask_value=1, name = 'Mas61571', )(Max87070)
Res41756 = keras.layers.Reshape((2, 2, 4), name = 'Res41756', )(Mas61571)
Res58542 = keras.layers.Reshape((2, 8), name = 'Res58542', )(Res41756)
Fla47707 = keras.layers.Flatten(name = 'Fla47707', )(Res58542)
Max17395 = keras.layers.Maximum(name = 'Max17395', )([in0Max17395,in1Max17395])
Res39799 = keras.layers.Reshape((1, 2, 2), name = 'Res39799', )(Max17395)
Glo63675 = keras.layers.GlobalMaxPool2D(name = 'Glo63675', )(Res39799)
Res64986 = keras.layers.Reshape((2, 1), name = 'Res64986', )(Glo63675)
GRU82962 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU82962', )(Res64986)
Con77763 = keras.layers.Concatenate(axis=1, name = 'Con77763', )([GRU82962,in0Con77763])
Max37628 = keras.layers.Maximum(name = 'Max37628', )([Fla47707,Con77763])
model = tf.keras.models.Model(inputs=[in0Max87070,in1Max87070,in0Max17395,in1Max17395,in0Con77763], outputs=Max37628)
w = model.get_layer('GRU82962').get_weights() 
w[0] = np.array([[8, 6, 7, 6, 3, 10, 2, 2, 5]])
w[1] = np.array([[8, 4, 2, 9, 10, 10, 10, 6, 10], [10, 10, 6, 3, 8, 5, 10, 10, 7], [2, 10, 8, 10, 5, 2, 9, 2, 8]])
w[2] = np.array([[4, 10, 2, 1, 4, 3, 3, 1, 3], [9, 4, 2, 9, 10, 5, 4, 10, 4]])
model.get_layer('GRU82962').set_weights(w) 
in0Max87070 = tf.constant([[[[[0.6266, 0.7901], [0.0514, 0.7037]], [[0.2819, 0.3598], [0.1929, 0.7697]]], [[[0.0187, 0.8632], [0.4839, 0.0184]], [[0.7909, 0.6303], [0.6772, 0.2829]]]]])
in1Max87070 = tf.constant([[[[[0.3728, 0.8048], [0.2958, 0.307]], [[0.9398, 0.9628], [0.9918, 0.3112]]], [[[0.999, 0.7876], [0.2776, 0.7917]], [[0.4927, 0.2223], [0.8517, 0.1105]]]]])
in0Max17395 = tf.constant([[[[[0.9503], [0.8614]], [[0.4368], [0.0405]]]]])
in1Max17395 = tf.constant([[[[[0.1568], [0.4734]], [[0.7738], [0.3273]]]]])
in0Con77763 = tf.constant([[0.6027, 0.0844, 0.1353, 0.2885, 0.6523, 0.227, 0.8831, 0.6517, 0.2788, 0.2747, 0.0807, 0.5447, 0.8851]])
print (np.array2string(model.predict([in0Max87070,in1Max87070,in0Max17395,in1Max17395,in0Con77763],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max37628.png')

LMax87070 = maximum_layer([[[[[[0.6266, 0.7901], [0.0514, 0.7037]], [[0.2819, 0.3598], [0.1929, 0.7697]]], [[[0.0187, 0.8632], [0.4839, 0.0184]], [[0.7909, 0.6303], [0.6772, 0.2829]]]]], [[[[[0.3728, 0.8048], [0.2958, 0.307]], [[0.9398, 0.9628], [0.9918, 0.3112]]], [[[0.999, 0.7876], [0.2776, 0.7917]], [[0.4927, 0.2223], [0.8517, 0.1105]]]]]], Max87070), 
LMas61571 = masking_layer(Max87070, 1, Mas61571), 
LRes41756 = reshape_layer(Mas61571, [2, 2, 4], Res41756), 
LRes58542 = reshape_layer(Res41756, [2, 8], Res58542), 
LFla47707 = flatten_layer(Res58542, Fla47707), 
LMax17395 = maximum_layer([[[[[[0.9503], [0.8614]], [[0.4368], [0.0405]]]]], [[[[[0.1568], [0.4734]], [[0.7738], [0.3273]]]]]], Max17395), 
LRes39799 = reshape_layer(Max17395, [1, 2, 2], Res39799), 
LGlo63675 = global_max_pool2D_layer(Res39799, Glo63675), 
LRes64986 = reshape_layer(Glo63675, [2, 1], Res64986), 
LGRU82962 = gru_layer(Res64986,[[8, 6, 7, 6, 3, 10, 2, 2, 5]],[[8, 4, 2, 9, 10, 10, 10, 6, 10], [10, 10, 6, 3, 8, 5, 10, 10, 7], [2, 10, 8, 10, 5, 2, 9, 2, 8]],[[4, 10, 2, 1, 4, 3, 3, 1, 3], [9, 4, 2, 9, 10, 5, 4, 10, 4]], true, GRU82962), 
LCon77763 = concatenate_layer([GRU82962,[[0.6027, 0.0844, 0.1353, 0.2885, 0.6523, 0.227, 0.8831, 0.6517, 0.2788, 0.2747, 0.0807, 0.5447, 0.8851]]], 1, Con77763), 
LMax37628 = maximum_layer([Fla47707,Con77763], Max37628), 
exec_layers([LMax87070,LMas61571,LRes41756,LRes58542,LFla47707,LMax17395,LRes39799,LGlo63675,LRes64986,LGRU82962,LCon77763,LMax37628],["Max87070","Mas61571","Res41756","Res58542","Fla47707","Max17395","Res39799","Glo63675","Res64986","GRU82962","Con77763","Max37628"],Max37628,"Max37628")

Actual (Unparsed): [[0.6266000, 0.8048000, 0.2958000, 0.7037000, 0.9398000, 0.9628000, 0.9918000, 0.7697000, 0.9990000, 0.8831000, 0.6517000, 0.7917000, 0.7909000, 0.6303000, 0.8517000, 0.8851000]]

Expected (Unparsed): [[0.6266,0.8048,0.2958,0.7037,0.9398,0.9628,0.9918,0.7697,0.999,0.8831,0.6517,0.7917,0.7909,0.6303,0.8517,0.8851]]

Actual:   [[0.6266, 0.8048, 0.2958, 0.7037, 0.9398, 0.9628, 0.9918, 0.7697, 0.999, 0.8831, 0.6517, 0.7917, 0.7909, 0.6303, 0.8517, 0.8851]]

Expected: [[0.6266, 0.8048, 0.2958, 0.7037, 0.9398, 0.9628, 0.9918, 0.7697, 0.999, 0.8831, 0.6517, 0.7917, 0.7909, 0.6303, 0.8517, 0.8851]]