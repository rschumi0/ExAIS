import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot44292 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot44292 = tf.keras.layers.Input(shape=([3, 2]))
in0Con78497 = tf.keras.layers.Input(shape=([2, 4, 1]))
in0Ave865 = tf.keras.layers.Input(shape=([1, 2]))

Dot44292 = keras.layers.Dot(axes=(1, 1), name = 'Dot44292', )([in0Dot44292,in1Dot44292])
Res25998 = keras.layers.Reshape((2, 2, 1), name = 'Res25998', )(Dot44292)
Zer24910 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer24910', )(Res25998)
Con78497 = keras.layers.Concatenate(axis=3, name = 'Con78497', )([Zer24910,in0Con78497])
Ave865 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave865', )(in0Ave865)
Res94339 = keras.layers.Reshape((1, 2, 1), name = 'Res94339', )(Ave865)
Zer82524 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer82524', )(Res94339)
Loc56062 = keras.layers.LocallyConnected2D(2, (3, 2),strides=(1, 1), name = 'Loc56062', )(Zer82524)
Zer15378 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer15378', )(Loc56062)
Max24997 = keras.layers.Maximum(name = 'Max24997', )([Con78497,Zer15378])
Res10168 = keras.layers.Reshape((2, 4, 2, 1), name = 'Res10168', )(Max24997)
Con69236 = keras.layers.Conv3D(4, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con69236', )(Res10168)
model = tf.keras.models.Model(inputs=[in0Dot44292,in1Dot44292,in0Con78497,in0Ave865], outputs=Con69236)
w = model.get_layer('Loc56062').get_weights() 
w[0] = np.array([[[0.0512, 0.6121], [0.3825, 0.671], [0.9924, 0.7194], [0.0668, 0.1589], [0.021, 0.4926], [0.0114, 0.8126]], [[0.6484, 0.5336], [0.61, 0.4359], [0.0964, 0.045], [0.3383, 0.8909], [0.6686, 0.733], [0.2542, 0.1997]], [[0.1204, 0.8633], [0.9864, 0.7562], [0.0041, 0.0187], [0.2952, 0.3633], [0.2154, 0.5493], [0.2352, 0.0874]]])
w[1] = np.array([[[0, 0], [0, 0], [0, 0]]])
model.get_layer('Loc56062').set_weights(w) 
w = model.get_layer('Con69236').get_weights() 
w[0] = np.array([[[[[0.8667, 0.8889, 0.532, 0.3599]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con69236').set_weights(w) 
in0Dot44292 = tf.constant([[[0.5221, 0.465], [0.7485, 0.5559], [0.2717, 0.7889]]])
in1Dot44292 = tf.constant([[[0.9141, 0.9674], [0.9592, 0.7248], [0.2717, 0.9329]]])
in0Con78497 = tf.constant([[[[0.842], [0.3346], [0.6501], [0.5045]], [[0.0469], [0.7579], [0.5732], [0.2897]]]])
in0Ave865 = tf.constant([[[1.612, 1.8769]]])
print (np.array2string(model.predict([in0Dot44292,in1Dot44292,in0Con78497,in0Ave865],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con69236.png')

LDot44292 = dot_layer([[[0.5221, 0.465], [0.7485, 0.5559], [0.2717, 0.7889]]], [[[0.9141, 0.9674], [0.9592, 0.7248], [0.2717, 0.9329]]], 1, 1, Dot44292), 
LRes25998 = reshape_layer(Dot44292, [2, 2, 1], Res25998), 
LZer24910 = zero_padding2D_layer(Res25998, 0, 0, 2, 0, Zer24910), 
LCon78497 = concatenate_layer([Zer24910,[[[[0.842], [0.3346], [0.6501], [0.5045]], [[0.0469], [0.7579], [0.5732], [0.2897]]]]], 3, Con78497), 
LAve865 = average_pooling1D_layer([[[1.612, 1.8769]]], 1, Ave865), 
LRes94339 = reshape_layer(Ave865, [1, 2, 1], Res94339), 
LZer82524 = zero_padding2D_layer(Res94339, 1, 1, 1, 1, Zer82524), 
LLoc56062 = locally_connected2D_layer(Zer82524, 3, 2,[[[0.0512, 0.6121], [0.3825, 0.671], [0.9924, 0.7194], [0.0668, 0.1589], [0.021, 0.4926], [0.0114, 0.8126]], [[0.6484, 0.5336], [0.61, 0.4359], [0.0964, 0.045], [0.3383, 0.8909], [0.6686, 0.733], [0.2542, 0.1997]], [[0.1204, 0.8633], [0.9864, 0.7562], [0.0041, 0.0187], [0.2952, 0.3633], [0.2154, 0.5493], [0.2352, 0.0874]]],[[[0, 0], [0, 0], [0, 0]]], 1, 1, Loc56062), 
LZer15378 = zero_padding2D_layer(Loc56062, 1, 0, 1, 0, Zer15378), 
LMax24997 = maximum_layer([Con78497,Zer15378], Max24997), 
LRes10168 = reshape_layer(Max24997, [2, 4, 2, 1], Res10168), 
LCon69236 = conv3D_layer(Res10168, 1, 1, 1,[[[[[0.8667, 0.8889, 0.532, 0.3599]]]]],[0, 0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con69236), 
exec_layers([LDot44292,LRes25998,LZer24910,LCon78497,LAve865,LRes94339,LZer82524,LLoc56062,LZer15378,LMax24997,LRes10168,LCon69236],["Dot44292","Res25998","Zer24910","Con78497","Ave865","Res94339","Zer82524","Loc56062","Zer15378","Max24997","Res10168","Con69236"],Con69236,"Con69236")

Actual (Unparsed): [[[[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.7297614, 0.7484538, 0.4479440, 0.3030358]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.2899978, 0.2974259, 0.1780072, 0.1204225]], [[1.0998715, 1.1280440, 0.6751259, 0.4567252], [0.5634417, 0.5778739, 0.3458532, 0.2339710]], [[1.1276298, 1.1565133, 0.6921646, 0.4682519], [0.4372501, 0.4484500, 0.2683940, 0.1815695]]], [[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0406482, 0.0416894, 0.0249508, 0.0168793]], [[0.0933276, 0.0957182, 0.0572866, 0.0387546], [0.6568719, 0.6736973, 0.4032028, 0.2727682]], [[1.0163097, 1.0423418, 0.6238338, 0.4220259], [1.5121056, 1.5508373, 0.9281645, 0.6279068]], [[1.3769455, 1.4122151, 0.8452002, 0.5717811], [0.2510830, 0.2575143, 0.1541204, 0.1042630]]]]]

Expected (Unparsed): [[[[[0.0,0.0,0.0,0.0],[0.7297614,0.7484538,0.447944,0.30303579999999997]],[[0.0,0.0,0.0,0.0],[0.28999782,0.29742594,0.1780072,0.12042254000000001]],[[1.09987150779,1.12804405593,0.6751259284000001,0.45672522863000004],[0.56344167,0.57787389,0.3458532,0.23397099]],[[1.127629802709,1.156513362903,0.69216459564,0.468251951073],[0.43725014999999995,0.44845005,0.26839399999999997,0.18156954999999997]]],[[[0.0,0.0,0.0,0.0],[0.04064823,0.041689409999999996,0.0249508,0.016879309999999998]],[[0.09332764272,0.09571817424000001,0.057286611200000004,0.038754607840000004],[0.65687193,0.67369731,0.40320280000000003,0.27276821]],[[1.016309675997,1.0423418379990002,0.6238337921200001,0.42202590560900005],[1.512105671007,1.550837349669,0.92816455172,0.6279068085789999]],[[1.376945470071,1.4122151013570001,0.8452001731600001,0.571781094587],[0.25108299,0.25751433,0.15412040000000002,0.10426303]]]]]

Actual:   [[[[[0, 0, 0, 0], [0.7298, 0.7485, 0.448, 0.3031]], [[0, 0, 0, 0], [0.29, 0.2975, 0.1781, 0.1205]], [[1.0999, 1.1281, 0.6752, 0.4568], [0.5635, 0.5779, 0.3459, 0.234]], [[1.1277, 1.1566, 0.6922, 0.4683], [0.4373, 0.4485, 0.2684, 0.1816]]], [[[0, 0, 0, 0], [0.0407, 0.0417, 0.025, 0.0169]], [[0.0934, 0.0958, 0.0573, 0.0388], [0.6569, 0.6737, 0.4033, 0.2728]], [[1.0164, 1.0424, 0.6239, 0.4221], [1.5122, 1.5509, 0.9282, 0.628]], [[1.377, 1.4123, 0.8453, 0.5718], [0.2511, 0.2576, 0.1542, 0.1043]]]]]

Expected: [[[[[0, 0, 0, 0], [0.7298, 0.7485, 0.448, 0.3031]], [[0, 0, 0, 0], [0.29, 0.2975, 0.1781, 0.1205]], [[1.0999, 1.1281, 0.6752, 0.4568], [0.5635, 0.5779, 0.3459, 0.234]], [[1.1277, 1.1566, 0.6922, 0.4683], [0.4373, 0.4485, 0.2684, 0.1816]]], [[[0, 0, 0, 0], [0.0407, 0.0417, 0.025, 0.0169]], [[0.0934, 0.0958, 0.0573, 0.0388], [0.6569, 0.6737, 0.4033, 0.2728]], [[1.0164, 1.0424, 0.6239, 0.4221], [1.5122, 1.5509, 0.9282, 0.628]], [[1.377, 1.4123, 0.8453, 0.5718], [0.2511, 0.2576, 0.1542, 0.1043]]]]]