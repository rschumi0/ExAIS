import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub17185 = tf.keras.layers.Input(shape=([3, 3, 2]))
in1Sub17185 = tf.keras.layers.Input(shape=([3, 3, 2]))
in0Con58146 = tf.keras.layers.Input(shape=([5, 4, 4, 2]))
in0Zer4965 = tf.keras.layers.Input(shape=([3, 2, 2, 3]))

Sub17185 = keras.layers.Subtract(name = 'Sub17185', )([in0Sub17185,in1Sub17185])
Res12822 = keras.layers.Reshape((3, 6), name = 'Res12822', )(Sub17185)
Sim91236 = keras.layers.SimpleRNN(2,name = 'Sim91236', )(Res12822)
Res58727 = keras.layers.Reshape((2, 1), name = 'Res58727', )(Sim91236)
Res70101 = keras.layers.Reshape((2, 1, 1), name = 'Res70101', )(Res58727)
Res52204 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res52204', )(Res70101)
Zer42997 = keras.layers.ZeroPadding3D(padding=((3, 0), (3, 0), (3, 0)), name = 'Zer42997', )(Res52204)
Con58146 = keras.layers.Concatenate(axis=4, name = 'Con58146', )([Zer42997,in0Con58146])
Zer4965 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer4965', )(in0Zer4965)
Ave34792 = keras.layers.Average(name = 'Ave34792', )([Con58146,Zer4965])
model = tf.keras.models.Model(inputs=[in0Sub17185,in1Sub17185,in0Con58146,in0Zer4965], outputs=Ave34792)
w = model.get_layer('Sim91236').get_weights() 
w[0] = np.array([[5, 5], [8, 10], [3, 7], [8, 5], [8, 6], [2, 10]])
w[1] = np.array([[9, 10], [6, 8]])
w[2] = np.array([7, 6])
model.get_layer('Sim91236').set_weights(w) 
in0Sub17185 = tf.constant([[[[0.0117, 0.9389], [0.5795, 0.0832], [0.0422, 0.309]], [[0.0214, 0.8532], [0.6348, 0.8953], [0.2497, 0.1421]], [[0.9566, 0.2599], [0.8234, 0.3751], [0.5607, 0.9279]]]])
in1Sub17185 = tf.constant([[[[0.9832, 0.765], [0.3622, 0.3066], [0.3461, 0.5062]], [[0.8851, 0.7183], [0.4798, 0.3839], [0.9152, 0.9825]], [[0.4248, 0.1534], [0.3159, 0.3921], [0.4899, 0.7179]]]])
in0Con58146 = tf.constant([[[[[0.6588, 0.3442], [0.6014, 0.7635], [0.9101, 0.8044], [0.193, 0.9503]], [[0.8909, 0.4189], [0.0566, 0.9833], [0.7835, 0.6381], [0.6568, 0.857]], [[0.4759, 0.0494], [0.6968, 0.1507], [0.7905, 0.4304], [0.2765, 0.0938]], [[0.1966, 0.1133], [0.4331, 0.6263], [0.561, 0.852], [0.9646, 0.6562]]], [[[0.1638, 0.9418], [0.6933, 0.9763], [0.2906, 0.5581], [0.4872, 0.7234]], [[0.2024, 0.1516], [0.4243, 0.8377], [0.1796, 0.2665], [0.459, 0.7113]], [[0.6371, 0.3327], [0.8284, 0.1026], [0.0174, 0.8239], [0.2241, 0.4374]], [[0.2811, 0.6706], [0.4467, 0.8179], [0.3366, 0.969], [0.858, 0.4162]]], [[[0.6753, 0.839], [0.4526, 0.4439], [0.8139, 0.7483], [0.7804, 0.5549]], [[0.8823, 0.7414], [0.2687, 0.367], [0.8436, 0.7927], [0.7176, 0.7684]], [[0.3826, 0.9354], [0.8708, 0.8101], [0.458, 0.9101], [0.0013, 0.2845]], [[0.8768, 0.8222], [0.3922, 0.5359], [0.0227, 0.7039], [0.4437, 0.6569]]], [[[0.0423, 0.9317], [0.8906, 0.9881], [0.381, 0.171], [0.2755, 0.7568]], [[0.5462, 0.8864], [0.3926, 0.7638], [0.3728, 0.4895], [0.8867, 0.263]], [[0.8658, 0.8764], [0.5774, 0.5622], [0.9061, 0.451], [0.3574, 0.4187]], [[0.716, 0.726], [0.7144, 0.0051], [0.0042, 0.2455], [0.0172, 0.0751]]], [[[0.1359, 0.886], [0.7168, 0.9719], [0.506, 0.5553], [0.5217, 0.2924]], [[0.5342, 0.9318], [0.4251, 0.3447], [0.3446, 0.1661], [0.1842, 0.0157]], [[0.245, 0.4003], [0.484, 0.3086], [0.5801, 0.5507], [0.5505, 0.5972]], [[0.3942, 0.0483], [0.4252, 0.6004], [0.6128, 0.1338], [0.4559, 0.1827]]]]])
in0Zer4965 = tf.constant([[[[[1.9095, 1.1155, 1.9353], [1.0872, 1.0099, 1.0273]], [[1.4834, 1.335, 1.4032], [1.7207, 1.9435, 1.2877]]], [[[1.3172, 1.9871, 1.6263], [1.4789, 1.1925, 1.3613]], [[1.635, 1.9783, 1.877], [1.4265, 1.5691, 1.0688]]], [[[1.2004, 1.4491, 1.6516], [1.3824, 1.7535, 1.5686]], [[1.8019, 1.0337, 1.0971], [1.2094, 1.715, 1.4877]]]]])
print (np.array2string(model.predict([in0Sub17185,in1Sub17185,in0Con58146,in0Zer4965],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave34792.png')

LSub17185 = subtract_layer([[[[0.0117, 0.9389], [0.5795, 0.0832], [0.0422, 0.309]], [[0.0214, 0.8532], [0.6348, 0.8953], [0.2497, 0.1421]], [[0.9566, 0.2599], [0.8234, 0.3751], [0.5607, 0.9279]]]], [[[[0.9832, 0.765], [0.3622, 0.3066], [0.3461, 0.5062]], [[0.8851, 0.7183], [0.4798, 0.3839], [0.9152, 0.9825]], [[0.4248, 0.1534], [0.3159, 0.3921], [0.4899, 0.7179]]]], Sub17185), 
LRes12822 = reshape_layer(Sub17185, [3, 6], Res12822), 
LSim91236 = simple_rnn_layer(Res12822,[[5, 5], [8, 10], [3, 7], [8, 5], [8, 6], [2, 10]],[[9, 10], [6, 8]],[7, 6], Sim91236), 
LRes58727 = reshape_layer(Sim91236, [2, 1], Res58727), 
LRes70101 = reshape_layer(Res58727, [2, 1, 1], Res70101), 
LRes52204 = reshape_layer(Res70101, [2, 1, 1, 1], Res52204), 
LZer42997 = zero_padding3D_layer(Res52204, 3, 0, 3, 0, 3, 0, Zer42997), 
LCon58146 = concatenate_layer([Zer42997,[[[[[0.6588, 0.3442], [0.6014, 0.7635], [0.9101, 0.8044], [0.193, 0.9503]], [[0.8909, 0.4189], [0.0566, 0.9833], [0.7835, 0.6381], [0.6568, 0.857]], [[0.4759, 0.0494], [0.6968, 0.1507], [0.7905, 0.4304], [0.2765, 0.0938]], [[0.1966, 0.1133], [0.4331, 0.6263], [0.561, 0.852], [0.9646, 0.6562]]], [[[0.1638, 0.9418], [0.6933, 0.9763], [0.2906, 0.5581], [0.4872, 0.7234]], [[0.2024, 0.1516], [0.4243, 0.8377], [0.1796, 0.2665], [0.459, 0.7113]], [[0.6371, 0.3327], [0.8284, 0.1026], [0.0174, 0.8239], [0.2241, 0.4374]], [[0.2811, 0.6706], [0.4467, 0.8179], [0.3366, 0.969], [0.858, 0.4162]]], [[[0.6753, 0.839], [0.4526, 0.4439], [0.8139, 0.7483], [0.7804, 0.5549]], [[0.8823, 0.7414], [0.2687, 0.367], [0.8436, 0.7927], [0.7176, 0.7684]], [[0.3826, 0.9354], [0.8708, 0.8101], [0.458, 0.9101], [0.0013, 0.2845]], [[0.8768, 0.8222], [0.3922, 0.5359], [0.0227, 0.7039], [0.4437, 0.6569]]], [[[0.0423, 0.9317], [0.8906, 0.9881], [0.381, 0.171], [0.2755, 0.7568]], [[0.5462, 0.8864], [0.3926, 0.7638], [0.3728, 0.4895], [0.8867, 0.263]], [[0.8658, 0.8764], [0.5774, 0.5622], [0.9061, 0.451], [0.3574, 0.4187]], [[0.716, 0.726], [0.7144, 0.0051], [0.0042, 0.2455], [0.0172, 0.0751]]], [[[0.1359, 0.886], [0.7168, 0.9719], [0.506, 0.5553], [0.5217, 0.2924]], [[0.5342, 0.9318], [0.4251, 0.3447], [0.3446, 0.1661], [0.1842, 0.0157]], [[0.245, 0.4003], [0.484, 0.3086], [0.5801, 0.5507], [0.5505, 0.5972]], [[0.3942, 0.0483], [0.4252, 0.6004], [0.6128, 0.1338], [0.4559, 0.1827]]]]]], 4, Con58146), 
LZer4965 = zero_padding3D_layer([[[[[1.9095, 1.1155, 1.9353], [1.0872, 1.0099, 1.0273]], [[1.4834, 1.335, 1.4032], [1.7207, 1.9435, 1.2877]]], [[[1.3172, 1.9871, 1.6263], [1.4789, 1.1925, 1.3613]], [[1.635, 1.9783, 1.877], [1.4265, 1.5691, 1.0688]]], [[[1.2004, 1.4491, 1.6516], [1.3824, 1.7535, 1.5686]], [[1.8019, 1.0337, 1.0971], [1.2094, 1.715, 1.4877]]]]], 1, 1, 1, 1, 1, 1, Zer4965), 
LAve34792 = average_layer([Con58146,Zer4965], Ave34792), 
exec_layers([LSub17185,LRes12822,LSim91236,LRes58727,LRes70101,LRes52204,LZer42997,LCon58146,LZer4965,LAve34792],["Sub17185","Res12822","Sim91236","Res58727","Res70101","Res52204","Zer42997","Con58146","Zer4965","Ave34792"],Ave34792,"Ave34792")

Actual (Unparsed): [[[[[0.0000000, 0.3294000, 0.1721000], [0.0000000, 0.3007000, 0.3817500], [0.0000000, 0.4550500, 0.4022000], [0.0000000, 0.0965000, 0.4751500]], [[0.0000000, 0.4454500, 0.2094500], [0.0000000, 0.0283000, 0.4916500], [0.0000000, 0.3917500, 0.3190500], [0.0000000, 0.3284000, 0.4285000]], [[0.0000000, 0.2379500, 0.0247000], [0.0000000, 0.3484000, 0.0753500], [0.0000000, 0.3952500, 0.2152000], [0.0000000, 0.1382500, 0.0469000]], [[0.0000000, 0.0983000, 0.0566500], [0.0000000, 0.2165500, 0.3131500], [0.0000000, 0.2805000, 0.4260000], [0.0000000, 0.4823000, 0.3281000]]], [[[0.0000000, 0.0819000, 0.4709000], [0.0000000, 0.3466500, 0.4881500], [0.0000000, 0.1453000, 0.2790500], [0.0000000, 0.2436000, 0.3617000]], [[0.0000000, 0.1012000, 0.0758000], [0.9547500, 0.7699000, 1.3865000], [0.5436000, 0.5947500, 0.6469000], [0.0000000, 0.2295000, 0.3556500]], [[0.0000000, 0.3185500, 0.1663500], [0.7417000, 1.0817000, 0.7529000], [0.8603500, 0.9804500, 1.0558000], [0.0000000, 0.1120500, 0.2187000]], [[0.0000000, 0.1405500, 0.3353000], [0.0000000, 0.2233500, 0.4089500], [0.0000000, 0.1683000, 0.4845000], [0.0000000, 0.4290000, 0.2081000]]], [[[0.0000000, 0.3376500, 0.4195000], [0.0000000, 0.2263000, 0.2219500], [0.0000000, 0.4069500, 0.3741500], [0.0000000, 0.3902000, 0.2774500]], [[0.0000000, 0.4411500, 0.3707000], [0.6586000, 1.1279000, 0.9966500], [0.7394500, 1.0180500, 1.0770000], [0.0000000, 0.3588000, 0.3842000]], [[0.0000000, 0.1913000, 0.4677000], [0.8175000, 1.4245500, 1.3435500], [0.7132500, 1.0135500, 0.9894500], [0.0000000, 0.0006500, 0.1422500]], [[0.0000000, 0.4384000, 0.4111000], [0.0000000, 0.1961000, 0.2679500], [0.0000000, 0.0113500, 0.3519500], [0.0000000, 0.2218500, 0.3284500]]], [[[0.0000000, 0.0211500, 0.4658500], [0.0000000, 0.4453000, 0.4940500], [0.0000000, 0.1905000, 0.0855000], [0.0000000, 0.1377500, 0.3784000]], [[0.0000000, 0.2731000, 0.4432000], [0.6002000, 0.9208500, 1.2077000], [0.6912000, 1.0631500, 1.0290500], [0.0000000, 0.4433500, 0.1315000]], [[0.0000000, 0.4329000, 0.4382000], [0.9009500, 0.8055500, 0.8296500], [0.6047000, 1.3105500, 0.9693500], [0.0000000, 0.1787000, 0.2093500]], [[0.0000000, 0.3580000, 0.3630000], [0.0000000, 0.3572000, 0.0025500], [0.0000000, 0.0021000, 0.1227500], [-0.4856697, 0.0086000, 0.0375500]]], [[[0.0000000, 0.0679500, 0.4430000], [0.0000000, 0.3584000, 0.4859500], [0.0000000, 0.2530000, 0.2776500], [0.0000000, 0.2608500, 0.1462000]], [[0.0000000, 0.2671000, 0.4659000], [0.0000000, 0.2125500, 0.1723500], [0.0000000, 0.1723000, 0.0830500], [0.0000000, 0.0921000, 0.0078500]], [[0.0000000, 0.1225000, 0.2001500], [0.0000000, 0.2420000, 0.1543000], [0.0000000, 0.2900500, 0.2753500], [0.0000000, 0.2752500, 0.2986000]], [[0.0000000, 0.1971000, 0.0241500], [0.0000000, 0.2126000, 0.3002000], [0.0000000, 0.3064000, 0.0669000], [-0.4897076, 0.2279500, 0.0913500]]]]]

Expected (Unparsed): [[[[[0,0.3294,0.1721],[0,0.3007,0.38175],[0,0.45505,0.4022],[0,0.0965,0.47515]],[[0,0.44545,0.20945],[0,0.0283,0.49165],[0,0.39175,0.31905],[0,0.3284,0.4285]],[[0,0.23795,0.0247],[0,0.3484,0.07535],[0,0.39525,0.2152],[0,0.13825,0.0469]],[[0,0.0983,0.05665],[0,0.21655,0.31315],[0,0.2805,0.426],[0,0.4823,0.3281]]],[[[0,0.0819,0.4709],[0,0.34665,0.48815],[0,0.1453,0.27905],[0,0.2436,0.3617]],[[0,0.1012,0.0758],[0.95475,0.7699,1.3865],[0.5436,0.59475,0.6469],[0,0.2295,0.35565]],[[0,0.31855,0.16635],[0.7417,1.0817,0.7529],[0.86035,0.98045,1.0558],[0,0.11205,0.2187]],[[0,0.14055,0.3353],[0,0.22335,0.40895],[0,0.1683,0.4845],[0,0.429,0.2081]]],[[[0,0.33765,0.4195],[0,0.2263,0.22195],[0,0.40695,0.37415],[0,0.3902,0.27745]],[[0,0.44115,0.3707],[0.6586,1.1279000000000001,0.99665],[0.73945,1.01805,1.077],[0,0.3588,0.3842]],[[0,0.1913,0.4677],[0.8175,1.42455,1.34355],[0.71325,1.01355,0.9894499999999999],[0,0.00065,0.14225]],[[0,0.4384,0.4111],[0,0.1961,0.26795],[0,0.01135,0.35195],[0,0.22185,0.32845]]],[[[0,0.02115,0.46585],[0,0.4453,0.49405],[0,0.1905,0.0855],[0,0.13775,0.3784]],[[0,0.2731,0.4432],[0.6002,0.9208500000000001,1.2077],[0.6912,1.06315,1.02905],[0,0.44335,0.1315]],[[0,0.4329,0.4382],[0.90095,0.80555,0.82965],[0.6047,1.31055,0.96935],[0,0.1787,0.20935]],[[0,0.358,0.363],[0,0.3572,0.00255],[0,0.0021,0.12275],[-0.4856697474218322,0.0086,0.03755]]],[[[0,0.06795,0.443],[0,0.3584,0.48595],[0,0.253,0.27765],[0,0.26085,0.1462]],[[0,0.2671,0.4659],[0,0.21255,0.17235],[0,0.1723,0.08305],[0,0.0921,0.00785]],[[0,0.1225,0.20015],[0,0.242,0.1543],[0,0.29005,0.27535],[0,0.27525,0.2986]],[[0,0.1971,0.02415],[0,0.2126,0.3002],[0,0.3064,0.0669],[-0.4897076575053874,0.22795,0.09135]]]]]

Actual:   [[[[[0, 0.3294, 0.1721], [0, 0.3007, 0.3818], [0, 0.4551, 0.4022], [0, 0.0965, 0.4752]], [[0, 0.4455, 0.2095], [0, 0.0283, 0.4917], [0, 0.3918, 0.3191], [0, 0.3284, 0.4285]], [[0, 0.238, 0.0247], [0, 0.3484, 0.0754], [0, 0.3953, 0.2152], [0, 0.1383, 0.0469]], [[0, 0.0983, 0.0567], [0, 0.2166, 0.3132], [0, 0.2805, 0.426], [0, 0.4823, 0.3281]]], [[[0, 0.0819, 0.4709], [0, 0.3467, 0.4882], [0, 0.1453, 0.2791], [0, 0.2436, 0.3617]], [[0, 0.1012, 0.0758], [0.9548, 0.7699, 1.3865], [0.5436, 0.5948, 0.6469], [0, 0.2295, 0.3557]], [[0, 0.3186, 0.1664], [0.7417, 1.0817, 0.7529], [0.8604, 0.9805, 1.0558], [0, 0.1121, 0.2187]], [[0, 0.1406, 0.3353], [0, 0.2234, 0.409], [0, 0.1683, 0.4845], [0, 0.429, 0.2081]]], [[[0, 0.3377, 0.4195], [0, 0.2263, 0.222], [0, 0.407, 0.3742], [0, 0.3902, 0.2775]], [[0, 0.4412, 0.3707], [0.6586, 1.1279, 0.9967], [0.7395, 1.0181, 1.077], [0, 0.3588, 0.3842]], [[0, 0.1913, 0.4677], [0.8175, 1.4246, 1.3436], [0.7133, 1.0136, 0.9895], [0, 0.0007, 0.1423]], [[0, 0.4384, 0.4111], [0, 0.1961, 0.268], [0, 0.0114, 0.352], [0, 0.2219, 0.3285]]], [[[0, 0.0212, 0.4659], [0, 0.4453, 0.4941], [0, 0.1905, 0.0855], [0, 0.1378, 0.3784]], [[0, 0.2731, 0.4432], [0.6002, 0.9209, 1.2077], [0.6912, 1.0632, 1.0291], [0, 0.4434, 0.1315]], [[0, 0.4329, 0.4382], [0.901, 0.8056, 0.8297], [0.6047, 1.3106, 0.9694], [0, 0.1787, 0.2094]], [[0, 0.358, 0.363], [0, 0.3572, 0.0026], [0, 0.0021, 0.1228], [-0.4856, 0.0086, 0.0376]]], [[[0, 0.068, 0.443], [0, 0.3584, 0.486], [0, 0.253, 0.2777], [0, 0.2609, 0.1462]], [[0, 0.2671, 0.4659], [0, 0.2126, 0.1724], [0, 0.1723, 0.0831], [0, 0.0921, 0.0079]], [[0, 0.1225, 0.2002], [0, 0.242, 0.1543], [0, 0.2901, 0.2754], [0, 0.2753, 0.2986]], [[0, 0.1971, 0.0242], [0, 0.2126, 0.3002], [0, 0.3064, 0.0669], [-0.4897, 0.228, 0.0914]]]]]

Expected: [[[[[0, 0.3294, 0.1721], [0, 0.3007, 0.3818], [0, 0.4551, 0.4022], [0, 0.0965, 0.4752]], [[0, 0.4455, 0.2095], [0, 0.0283, 0.4917], [0, 0.3918, 0.3191], [0, 0.3284, 0.4285]], [[0, 0.238, 0.0247], [0, 0.3484, 0.0754], [0, 0.3953, 0.2152], [0, 0.1383, 0.0469]], [[0, 0.0983, 0.0567], [0, 0.2166, 0.3132], [0, 0.2805, 0.426], [0, 0.4823, 0.3281]]], [[[0, 0.0819, 0.4709], [0, 0.3467, 0.4882], [0, 0.1453, 0.2791], [0, 0.2436, 0.3617]], [[0, 0.1012, 0.0758], [0.9548, 0.7699, 1.3865], [0.5436, 0.5948, 0.6469], [0, 0.2295, 0.3557]], [[0, 0.3186, 0.1664], [0.7417, 1.0817, 0.7529], [0.8604, 0.9805, 1.0558], [0, 0.1121, 0.2187]], [[0, 0.1406, 0.3353], [0, 0.2234, 0.409], [0, 0.1683, 0.4845], [0, 0.429, 0.2081]]], [[[0, 0.3377, 0.4195], [0, 0.2263, 0.222], [0, 0.407, 0.3742], [0, 0.3902, 0.2775]], [[0, 0.4412, 0.3707], [0.6586, 1.128, 0.9967], [0.7395, 1.0181, 1.077], [0, 0.3588, 0.3842]], [[0, 0.1913, 0.4677], [0.8175, 1.4246, 1.3436], [0.7133, 1.0136, 0.9895], [0, 0.0007, 0.1423]], [[0, 0.4384, 0.4111], [0, 0.1961, 0.268], [0, 0.0114, 0.352], [0, 0.2219, 0.3285]]], [[[0, 0.0212, 0.4659], [0, 0.4453, 0.4941], [0, 0.1905, 0.0855], [0, 0.1378, 0.3784]], [[0, 0.2731, 0.4432], [0.6002, 0.9209, 1.2077], [0.6912, 1.0632, 1.0291], [0, 0.4434, 0.1315]], [[0, 0.4329, 0.4382], [0.901, 0.8056, 0.8297], [0.6047, 1.3106, 0.9694], [0, 0.1787, 0.2094]], [[0, 0.358, 0.363], [0, 0.3572, 0.0026], [0, 0.0021, 0.1228], [-0.4856, 0.0086, 0.0376]]], [[[0, 0.068, 0.443], [0, 0.3584, 0.486], [0, 0.253, 0.2777], [0, 0.2609, 0.1462]], [[0, 0.2671, 0.4659], [0, 0.2126, 0.1724], [0, 0.1723, 0.0831], [0, 0.0921, 0.0079]], [[0, 0.1225, 0.2002], [0, 0.242, 0.1543], [0, 0.2901, 0.2754], [0, 0.2753, 0.2986]], [[0, 0.1971, 0.0242], [0, 0.2126, 0.3002], [0, 0.3064, 0.0669], [-0.4897, 0.228, 0.0914]]]]]