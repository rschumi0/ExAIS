import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0GRU33029 = tf.keras.layers.Input(shape=([2, 3]))
in0Con1236 = tf.keras.layers.Input(shape=([2, 3]))
in0Sim90990 = tf.keras.layers.Input(shape=([1, 1]))
in0Con48080 = tf.keras.layers.Input(shape=([1, 3]))
in0Fla28745 = tf.keras.layers.Input(shape=([1, 4, 1]))
in0Mul1610 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul1610 = tf.keras.layers.Input(shape=([2, 1]))
in0Con19095 = tf.keras.layers.Input(shape=([2, 3]))

GRU33029 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU33029', )(in0GRU33029)
Res23903 = keras.layers.Reshape((2, 1), name = 'Res23903', )(GRU33029)
Con1236 = keras.layers.Concatenate(axis=2, name = 'Con1236', )([Res23903,in0Con1236])
Sim90990 = keras.layers.SimpleRNN(1,name = 'Sim90990', )(in0Sim90990)
Res80523 = keras.layers.Reshape((1, 1), name = 'Res80523', )(Sim90990)
Con48080 = keras.layers.Concatenate(axis=2, name = 'Con48080', )([Res80523,in0Con48080])
Fla28745 = keras.layers.Flatten(name = 'Fla28745', )(in0Fla28745)
Res56705 = keras.layers.Reshape((4, 1), name = 'Res56705', )(Fla28745)
Per52723 = keras.layers.Permute((2,1), name = 'Per52723',)(Res56705)
Add34204 = keras.layers.Add(name = 'Add34204', )([Con48080,Per52723])
Zer42253 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer42253', )(Add34204)
Mul1610 = keras.layers.Multiply(name = 'Mul1610', )([in0Mul1610,in1Mul1610])
Con19095 = keras.layers.Concatenate(axis=2, name = 'Con19095', )([Mul1610,in0Con19095])
Max36774 = keras.layers.Maximum(name = 'Max36774', )([Zer42253,Con19095])
Max46919 = keras.layers.Maximum(name = 'Max46919', )([Con1236,Max36774])
model = tf.keras.models.Model(inputs=[in0GRU33029,in0Con1236,in0Sim90990,in0Con48080,in0Fla28745,in0Mul1610,in1Mul1610,in0Con19095], outputs=Max46919)
w = model.get_layer('GRU33029').get_weights() 
w[0] = np.array([[5, 4, 7, 5, 6, 2], [7, 3, 8, 10, 2, 6], [6, 7, 8, 3, 1, 2]])
w[1] = np.array([[3, 5, 4, 6, 8, 8], [6, 9, 4, 5, 2, 7]])
w[2] = np.array([[2, 2, 7, 10, 8, 5], [2, 6, 4, 2, 3, 6]])
model.get_layer('GRU33029').set_weights(w) 
w = model.get_layer('Sim90990').get_weights() 
w[0] = np.array([[6]])
w[1] = np.array([[9]])
w[2] = np.array([1])
model.get_layer('Sim90990').set_weights(w) 
in0GRU33029 = tf.constant([[[1, 8, 4], [2, 3, 6]]])
in0Con1236 = tf.constant([[[0.486, 0.9144, 0.0995], [0.6071, 0.7486, 0.9263]]])
in0Sim90990 = tf.constant([[[10]]])
in0Con48080 = tf.constant([[[0.0353, 0.2061, 0.9662]]])
in0Fla28745 = tf.constant([[[[1.3201], [1.805], [1.0061], [1.0254]]]])
in0Mul1610 = tf.constant([[[0.8196], [0.1331]]])
in1Mul1610 = tf.constant([[[0.7921], [0.0681]]])
in0Con19095 = tf.constant([[[0.2411, 0.9921, 0.9572], [0.7717, 0.2998, 0.7335]]])
print (np.array2string(model.predict([in0GRU33029,in0Con1236,in0Sim90990,in0Con48080,in0Fla28745,in0Mul1610,in1Mul1610,in0Con19095],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max46919.png')

LGRU33029 = gru_layer([[[1, 8, 4], [2, 3, 6]]],[[5, 4, 7, 5, 6, 2], [7, 3, 8, 10, 2, 6], [6, 7, 8, 3, 1, 2]],[[3, 5, 4, 6, 8, 8], [6, 9, 4, 5, 2, 7]],[[2, 2, 7, 10, 8, 5], [2, 6, 4, 2, 3, 6]], true, GRU33029), 
LRes23903 = reshape_layer(GRU33029, [2, 1], Res23903), 
LCon1236 = concatenate_layer([Res23903,[[[0.486, 0.9144, 0.0995], [0.6071, 0.7486, 0.9263]]]], 2, Con1236), 
LSim90990 = simple_rnn_layer([[[10]]],[[6]],[[9]],[1], Sim90990), 
LRes80523 = reshape_layer(Sim90990, [1, 1], Res80523), 
LCon48080 = concatenate_layer([Res80523,[[[0.0353, 0.2061, 0.9662]]]], 2, Con48080), 
LFla28745 = flatten_layer([[[[1.3201], [1.805], [1.0061], [1.0254]]]], Fla28745), 
LRes56705 = reshape_layer(Fla28745, [4, 1], Res56705), 
LPer52723 = permute_layer(Res56705, 2,1, Per52723), 
LAdd34204 = add_layer([Con48080,Per52723], Add34204), 
LZer42253 = zero_padding1D_layer(Add34204, 1, 0, Zer42253), 
LMul1610 = multiply_layer([[[[0.8196], [0.1331]]], [[[0.7921], [0.0681]]]], Mul1610), 
LCon19095 = concatenate_layer([Mul1610,[[[0.2411, 0.9921, 0.9572], [0.7717, 0.2998, 0.7335]]]], 2, Con19095), 
LMax36774 = maximum_layer([Zer42253,Con19095], Max36774), 
LMax46919 = maximum_layer([Con1236,Max36774], Max46919), 
exec_layers([LGRU33029,LRes23903,LCon1236,LSim90990,LRes80523,LCon48080,LFla28745,LRes56705,LPer52723,LAdd34204,LZer42253,LMul1610,LCon19095,LMax36774,LMax46919],["GRU33029","Res23903","Con1236","Sim90990","Res80523","Con48080","Fla28745","Res56705","Per52723","Add34204","Zer42253","Mul1610","Con19095","Max36774","Max46919"],Max46919,"Max46919")

Actual (Unparsed): [[[0.6492052, 0.4860000, 0.9921000, 0.9572000], [2.3200999, 1.8402999, 1.2122001, 1.9916000]]]

Expected (Unparsed): [[[0.6492051600000001,0.486,0.9921,0.9572],[2.3201,1.8403,1.2122,1.9916]]]

Actual:   [[[0.6493, 0.486, 0.9921, 0.9572], [2.3201, 1.8403, 1.2123, 1.9916]]]

Expected: [[[0.6493, 0.486, 0.9921, 0.9572], [2.3201, 1.8403, 1.2122, 1.9916]]]