import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max81244 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Max81244 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Add83533 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Add83533 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Dot72851 = tf.keras.layers.Input(shape=([2]))
in1Dot72851 = tf.keras.layers.Input(shape=([2]))
in0Ave84633 = tf.keras.layers.Input(shape=([1, 1]))
in1Ave84633 = tf.keras.layers.Input(shape=([1, 1]))

Max81244 = keras.layers.Maximum(name = 'Max81244', )([in0Max81244,in1Max81244])
Add83533 = keras.layers.Add(name = 'Add83533', )([in0Add83533,in1Add83533])
Cro86896 = keras.layers.Cropping2D(cropping=((0, 0), (0, 1)), name = 'Cro86896', )(Add83533)
Dep2393 = keras.layers.DepthwiseConv2D((1, 2),strides=(1, 1), padding='same', name = 'Dep2393', )(Cro86896)
Zer76348 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer76348', )(Dep2393)
Min81815 = keras.layers.Minimum(name = 'Min81815', )([Max81244,Zer76348])
Res43111 = keras.layers.Reshape((2, 2, 2, 1), name = 'Res43111', )(Min81815)
Zer10680 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (1, 0)), name = 'Zer10680', )(Res43111)
Dot72851 = keras.layers.Dot(axes=(1, 1), name = 'Dot72851', )([in0Dot72851,in1Dot72851])
Res98170 = keras.layers.Reshape((1, 1), name = 'Res98170', )(Dot72851)
Ave84633 = keras.layers.Average(name = 'Ave84633', )([in0Ave84633,in1Ave84633])
Max92429 = keras.layers.Maximum(name = 'Max92429', )([Res98170,Ave84633])
Res26713 = keras.layers.Reshape((1, 1, 1), name = 'Res26713', )(Max92429)
Res58529 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res58529', )(Res26713)
Zer28280 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer28280', )(Res58529)
Max43564 = keras.layers.Maximum(name = 'Max43564', )([Zer10680,Zer28280])
model = tf.keras.models.Model(inputs=[in0Max81244,in1Max81244,in0Add83533,in1Add83533,in0Dot72851,in1Dot72851,in0Ave84633,in1Ave84633], outputs=Max43564)
w = model.get_layer('Dep2393').get_weights() 
w[0] = np.array([[[[0.8774], [0.3718]], [[0.7121], [0.5787]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep2393').set_weights(w) 
in0Max81244 = tf.constant([[[[0.747, 0.0845], [0.0611, 0.6874]], [[0.5925, 0.2514], [0.6729, 0.4274]]]])
in1Max81244 = tf.constant([[[[0.7165, 0.1138], [0.3863, 0.2088]], [[0.4957, 0.1045], [0.5239, 0.4819]]]])
in0Add83533 = tf.constant([[[[0.2414, 0.2018], [0.8802, 0.562]], [[0.7231, 0.5855], [0.9541, 0.9883]]]])
in1Add83533 = tf.constant([[[[0.2078, 0.8914], [0.8979, 0.5084]], [[0.1094, 0.9693], [0.4321, 0.0917]]]])
in0Dot72851 = tf.constant([[0.5029, 0.4614]])
in1Dot72851 = tf.constant([[0.4638, 0.2487]])
in0Ave84633 = tf.constant([[[0.8272]]])
in1Ave84633 = tf.constant([[[0.0983]]])
print (np.array2string(model.predict([in0Max81244,in1Max81244,in0Add83533,in1Add83533,in0Dot72851,in1Dot72851,in0Ave84633,in1Ave84633],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max43564.png')

LMax81244 = maximum_layer([[[[[0.747, 0.0845], [0.0611, 0.6874]], [[0.5925, 0.2514], [0.6729, 0.4274]]]], [[[[0.7165, 0.1138], [0.3863, 0.2088]], [[0.4957, 0.1045], [0.5239, 0.4819]]]]], Max81244), 
LAdd83533 = add_layer([[[[[0.2414, 0.2018], [0.8802, 0.562]], [[0.7231, 0.5855], [0.9541, 0.9883]]]], [[[[0.2078, 0.8914], [0.8979, 0.5084]], [[0.1094, 0.9693], [0.4321, 0.0917]]]]], Add83533), 
LCro86896 = cropping2D_layer(Add83533, 0, 0, 0, 1, Cro86896), 
LDep2393 = depthwise_conv2D_layer(Cro86896, 1, 2,[[[[0.8774], [0.3718]], [[0.7121], [0.5787]]]],[0, 0], 1, 1, true, Dep2393), 
LZer76348 = zero_padding2D_layer(Dep2393, 0, 0, 1, 0, Zer76348), 
LMin81815 = minimum_layer([Max81244,Zer76348], Min81815), 
LRes43111 = reshape_layer(Min81815, [2, 2, 2, 1], Res43111), 
LZer10680 = zero_padding3D_layer(Res43111, 1, 0, 1, 0, 1, 0, Zer10680), 
LDot72851 = dot_layer([[0.5029, 0.4614]], [[0.4638, 0.2487]], 1, 1, Dot72851), 
LRes98170 = reshape_layer(Dot72851, [1, 1], Res98170), 
LAve84633 = average_layer([[[[0.8272]]], [[[0.0983]]]], Ave84633), 
LMax92429 = maximum_layer([Res98170,Ave84633], Max92429), 
LRes26713 = reshape_layer(Max92429, [1, 1, 1], Res26713), 
LRes58529 = reshape_layer(Res26713, [1, 1, 1, 1], Res58529), 
LZer28280 = zero_padding3D_layer(Res58529, 1, 1, 1, 1, 1, 1, Zer28280), 
LMax43564 = maximum_layer([Zer10680,Zer28280], Max43564), 
exec_layers([LMax81244,LAdd83533,LCro86896,LDep2393,LZer76348,LMin81815,LRes43111,LZer10680,LDot72851,LRes98170,LAve84633,LMax92429,LRes26713,LRes58529,LZer28280,LMax43564],["Max81244","Add83533","Cro86896","Dep2393","Zer76348","Min81815","Res43111","Zer10680","Dot72851","Res98170","Ave84633","Max92429","Res26713","Res58529","Zer28280","Max43564"],Max43564,"Max43564")

Actual (Unparsed): [[[[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.4627500], [0.0000000]], [[0.0000000], [0.3863000], [0.4064518]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.6729000], [0.4819000]]]]]

Expected (Unparsed): [[[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]]],[[[0],[0],[0]],[[0],[0.46275],[0]],[[0],[0.3863],[0.40645176]]],[[[0],[0],[0]],[[0],[0],[0]],[[0],[0.6729],[0.4819]]]]]

Actual:   [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0.4628], [0]], [[0], [0.3863], [0.4065]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0.6729], [0.4819]]]]]

Expected: [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0.4628], [0]], [[0], [0.3863], [0.4065]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0.6729], [0.4819]]]]]