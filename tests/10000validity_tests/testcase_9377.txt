import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add32172 = tf.keras.layers.Input(shape=([2, 2]))
in1Add32172 = tf.keras.layers.Input(shape=([2, 2]))
in0Con27707 = tf.keras.layers.Input(shape=([1, 11, 2]))
in0Con70758 = tf.keras.layers.Input(shape=([1, 1, 1]))

Add32172 = keras.layers.Add(name = 'Add32172', )([in0Add32172,in1Add32172])
Res60666 = keras.layers.Reshape((2, 2, 1), name = 'Res60666', )(Add32172)
Res63703 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res63703', )(Res60666)
Glo30182 = keras.layers.GlobalAveragePooling3D(name = 'Glo30182', )(Res63703)
Res80216 = keras.layers.Reshape((1, 1), name = 'Res80216', )(Glo30182)
Glo365 = keras.layers.GlobalAveragePooling1D(name = 'Glo365', )(Res80216)
Res49413 = keras.layers.Reshape((1, 1), name = 'Res49413', )(Glo365)
Res67736 = keras.layers.Reshape((1, 1, 1), name = 'Res67736', )(Res49413)
Zer62085 = keras.layers.ZeroPadding2D(padding=((0, 0), (10, 0)), name = 'Zer62085', )(Res67736)
Con27707 = keras.layers.Concatenate(axis=3, name = 'Con27707', )([Zer62085,in0Con27707])
Con70758 = keras.layers.Conv2DTranspose(3, (1, 1),strides=(1, 11), padding='valid', name = 'Con70758', )(in0Con70758)
Mul39207 = keras.layers.Multiply(name = 'Mul39207', )([Con27707,Con70758])
model = tf.keras.models.Model(inputs=[in0Add32172,in1Add32172,in0Con27707,in0Con70758], outputs=Mul39207)
w = model.get_layer('Con70758').get_weights() 
w[0] = np.array([[[[0.5202], [0.2928], [0.7895]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con70758').set_weights(w) 
in0Add32172 = tf.constant([[[0.9984, 0.6121], [0.915, 0.7935]]])
in1Add32172 = tf.constant([[[0.1208, 0.0732], [0.9685, 0.7094]]])
in0Con27707 = tf.constant([[[[0.1331, 0.4642], [0.9327, 0.5497], [0.1967, 0.0806], [0.1467, 0.0524], [0.5186, 0.1912], [0.4121, 0.8571], [0.2103, 0.6643], [0.1862, 0.2028], [0.0462, 0.2995], [0.1531, 0.0888], [0.1554, 0.65]]]])
in0Con70758 = tf.constant([[[[0.3502]]]])
print (np.array2string(model.predict([in0Add32172,in1Add32172,in0Con27707,in0Con70758],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul39207.png')

LAdd32172 = add_layer([[[[0.9984, 0.6121], [0.915, 0.7935]]], [[[0.1208, 0.0732], [0.9685, 0.7094]]]], Add32172), 
LRes60666 = reshape_layer(Add32172, [2, 2, 1], Res60666), 
LRes63703 = reshape_layer(Res60666, [2, 2, 1, 1], Res63703), 
LGlo30182 = global_average_pooling3D_layer(Res63703, Glo30182), 
LRes80216 = reshape_layer(Glo30182, [1, 1], Res80216), 
LGlo365 = global_average_pooling1D_layer(Res80216, Glo365), 
LRes49413 = reshape_layer(Glo365, [1, 1], Res49413), 
LRes67736 = reshape_layer(Res49413, [1, 1, 1], Res67736), 
LZer62085 = zero_padding2D_layer(Res67736, 0, 0, 10, 0, Zer62085), 
LCon27707 = concatenate_layer([Zer62085,[[[[0.1331, 0.4642], [0.9327, 0.5497], [0.1967, 0.0806], [0.1467, 0.0524], [0.5186, 0.1912], [0.4121, 0.8571], [0.2103, 0.6643], [0.1862, 0.2028], [0.0462, 0.2995], [0.1531, 0.0888], [0.1554, 0.65]]]]], 3, Con27707), 
LCon70758 = conv2D_transpose_layer([[[[0.3502]]]], 1, 1,[[[[0.5202], [0.2928], [0.7895]]]],[0, 0, 0], 1, 11, false, Con70758), 
LMul39207 = multiply_layer([Con27707,Con70758], Mul39207), 
exec_layers([LAdd32172,LRes60666,LRes63703,LGlo30182,LRes80216,LGlo365,LRes49413,LRes67736,LZer62085,LCon27707,LCon70758,LMul39207],["Add32172","Res60666","Res63703","Glo30182","Res80216","Glo365","Res49413","Res67736","Zer62085","Con27707","Con70758","Mul39207"],Mul39207,"Mul39207")

Actual (Unparsed): [[[[0.0000000, 0.0136479, 0.1283434], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]]]]

Expected (Unparsed): [[[[0.0,0.013647882336,0.12834336217999998],[0,0.0,0.0],[0,0.0,0.0],[0,0.0,0.0],[0,0.0,0.0],[0,0.0,0.0],[0,0.0,0.0],[0,0.0,0.0],[0,0.0,0.0],[0,0.0,0.0],[0.0,0.0,0.0]]]]

Actual:   [[[[0, 0.0137, 0.1284], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]]]

Expected: [[[[0, 0.0137, 0.1284], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]]]