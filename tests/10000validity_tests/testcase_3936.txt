import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave51412 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Ave51412 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con30339 = tf.keras.layers.Input(shape=([4, 1, 1, 1]))
in0Cro6163 = tf.keras.layers.Input(shape=([4, 1, 1, 2]))

Ave51412 = keras.layers.Average(name = 'Ave51412', )([in0Ave51412,in1Ave51412])
Res22570 = keras.layers.Reshape((2, 2), name = 'Res22570', )(Ave51412)
Per85776 = keras.layers.Permute((1,2), name = 'Per85776',)(Res22570)
Fla69083 = keras.layers.Flatten(name = 'Fla69083', )(Per85776)
Res57454 = keras.layers.Reshape((4, 1), name = 'Res57454', )(Fla69083)
Res29984 = keras.layers.Reshape((4, 1, 1), name = 'Res29984', )(Res57454)
Res13734 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res13734', )(Res29984)
Con30339 = keras.layers.Concatenate(axis=4, name = 'Con30339', )([Res13734,in0Con30339])
Cro6163 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro6163', )(in0Cro6163)
Ave26142 = keras.layers.Average(name = 'Ave26142', )([Con30339,Cro6163])
model = tf.keras.models.Model(inputs=[in0Ave51412,in1Ave51412,in0Con30339,in0Cro6163], outputs=Ave26142)
in0Ave51412 = tf.constant([[[[0.7807, 0.0563]], [[0.7151, 0.0372]]]])
in1Ave51412 = tf.constant([[[[0.4434, 0.1457]], [[0.5323, 0.7305]]]])
in0Con30339 = tf.constant([[[[[0.5529]]], [[[0.4175]]], [[[0.2975]]], [[[0.3663]]]]])
in0Cro6163 = tf.constant([[[[[1.4138, 1.1182]]], [[[1.0899, 1.5364]]], [[[1.3638, 1.94]]], [[[1.3087, 1.3612]]]]])
print (np.array2string(model.predict([in0Ave51412,in1Ave51412,in0Con30339,in0Cro6163],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave26142.png')

LAve51412 = average_layer([[[[[0.7807, 0.0563]], [[0.7151, 0.0372]]]], [[[[0.4434, 0.1457]], [[0.5323, 0.7305]]]]], Ave51412), 
LRes22570 = reshape_layer(Ave51412, [2, 2], Res22570), 
LPer85776 = permute_layer(Res22570, 1,2, Per85776), 
LFla69083 = flatten_layer(Per85776, Fla69083), 
LRes57454 = reshape_layer(Fla69083, [4, 1], Res57454), 
LRes29984 = reshape_layer(Res57454, [4, 1, 1], Res29984), 
LRes13734 = reshape_layer(Res29984, [4, 1, 1, 1], Res13734), 
LCon30339 = concatenate_layer([Res13734,[[[[[0.5529]]], [[[0.4175]]], [[[0.2975]]], [[[0.3663]]]]]], 4, Con30339), 
LCro6163 = cropping3D_layer([[[[[1.4138, 1.1182]]], [[[1.0899, 1.5364]]], [[[1.3638, 1.94]]], [[[1.3087, 1.3612]]]]], 0, 0, 0, 0, 0, 0, Cro6163), 
LAve26142 = average_layer([Con30339,Cro6163], Ave26142), 
exec_layers([LAve51412,LRes22570,LPer85776,LFla69083,LRes57454,LRes29984,LRes13734,LCon30339,LCro6163,LAve26142],["Ave51412","Res22570","Per85776","Fla69083","Res57454","Res29984","Res13734","Con30339","Cro6163","Ave26142"],Ave26142,"Ave26142")

Actual (Unparsed): [[[[[1.0129250, 0.8355500]]], [[[0.5954500, 0.9769500]]], [[[0.9937500, 1.1187500]]], [[[0.8462750, 0.8637500]]]]]

Expected (Unparsed): [[[[[1.012925,0.83555]]],[[[0.59545,0.97695]]],[[[0.9937499999999999,1.11875]]],[[[0.846275,0.86375]]]]]

Actual:   [[[[[1.013, 0.8356]]], [[[0.5955, 0.977]]], [[[0.9938, 1.1188]]], [[[0.8463, 0.8638]]]]]

Expected: [[[[[1.013, 0.8356]]], [[[0.5955, 0.977]]], [[[0.9938, 1.1188]]], [[[0.8463, 0.8638]]]]]