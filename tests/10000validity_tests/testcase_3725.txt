import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con24836 = tf.keras.layers.Input(shape=([2, 2]))
in0LST89450 = tf.keras.layers.Input(shape=([2, 1]))

Con24836 = keras.layers.Conv1D(2, (2),strides=(9), padding='valid', dilation_rate=(1), name = 'Con24836', )(in0Con24836)
Res40861 = keras.layers.Reshape((1, 2, 1), name = 'Res40861', )(Con24836)
Res42124 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res42124', )(Res40861)
Cro68167 = keras.layers.Cropping3D(cropping=((0, 0), (0, 1), (0, 0)), name = 'Cro68167', )(Res42124)
Res60669 = keras.layers.Reshape((1, 1, 1), name = 'Res60669', )(Cro68167)
Res88571 = keras.layers.Reshape((1, 1), name = 'Res88571', )(Res60669)
Fla49363 = keras.layers.Flatten(name = 'Fla49363', )(Res88571)
LST89450 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST89450', )(in0LST89450)
Res82122 = keras.layers.Reshape((1, 1), name = 'Res82122', )(LST89450)
Res7264 = keras.layers.Reshape((1, 1, 1), name = 'Res7264', )(Res82122)
Glo72010 = keras.layers.GlobalAveragePooling2D(name = 'Glo72010', )(Res7264)
Add20784 = keras.layers.Add(name = 'Add20784', )([Fla49363,Glo72010])
Res52417 = keras.layers.Reshape((1, 1), name = 'Res52417', )(Add20784)
GRU98880 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU98880', )(Res52417)
model = tf.keras.models.Model(inputs=[in0Con24836,in0LST89450], outputs=GRU98880)
w = model.get_layer('Con24836').get_weights() 
w[0] = np.array([[[0.7539, 0.2355], [0.4915, 0.5462]], [[0.0608, 0.0944], [0.4653, 0.3092]]])
w[1] = np.array([0, 0])
model.get_layer('Con24836').set_weights(w) 
w = model.get_layer('LST89450').get_weights() 
w[0] = np.array([[8, 8, 4, 9]])
w[1] = np.array([[10, 2, 7, 4]])
w[2] = np.array([10, 6, 7, 1])
model.get_layer('LST89450').set_weights(w) 
w = model.get_layer('GRU98880').get_weights() 
w[0] = np.array([[5, 8, 7]])
w[1] = np.array([[7, 5, 5]])
w[2] = np.array([[9, 3, 10], [7, 6, 5]])
model.get_layer('GRU98880').set_weights(w) 
in0Con24836 = tf.constant([[[0.6875, 0.3183], [0.4973, 0.5757]]])
in0LST89450 = tf.constant([[[1], [6]]])
print (np.array2string(model.predict([in0Con24836,in0LST89450],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU98880.png')

LCon24836 = conv1D_layer([[[0.6875, 0.3183], [0.4973, 0.5757]]], 2,[[[0.7539, 0.2355], [0.4915, 0.5462]], [[0.0608, 0.0944], [0.4653, 0.3092]]],[0, 0], 9, false, 1, Con24836), 
LRes40861 = reshape_layer(Con24836, [1, 2, 1], Res40861), 
LRes42124 = reshape_layer(Res40861, [1, 2, 1, 1], Res42124), 
LCro68167 = cropping3D_layer(Res42124, 0, 0, 0, 1, 0, 0, Cro68167), 
LRes60669 = reshape_layer(Cro68167, [1, 1, 1], Res60669), 
LRes88571 = reshape_layer(Res60669, [1, 1], Res88571), 
LFla49363 = flatten_layer(Res88571, Fla49363), 
LLST89450 = lstm_layer([[[1], [6]]],[[8, 8, 4, 9]],[[10, 2, 7, 4]],[10, 6, 7, 1], LST89450), 
LRes82122 = reshape_layer(LST89450, [1, 1], Res82122), 
LRes7264 = reshape_layer(Res82122, [1, 1, 1], Res7264), 
LGlo72010 = global_average_pooling2D_layer(Res7264, Glo72010), 
LAdd20784 = add_layer([Fla49363,Glo72010], Add20784), 
LRes52417 = reshape_layer(Add20784, [1, 1], Res52417), 
LGRU98880 = gru_layer(Res52417,[[5, 8, 7]],[[7, 5, 5]],[[9, 3, 10], [7, 6, 5]], true, GRU98880), 
exec_layers([LCon24836,LRes40861,LRes42124,LCro68167,LRes60669,LRes88571,LFla49363,LLST89450,LRes82122,LRes7264,LGlo72010,LAdd20784,LRes52417,LGRU98880],["Con24836","Res40861","Res42124","Cro68167","Res60669","Res88571","Fla49363","LST89450","Res82122","Res7264","Glo72010","Add20784","Res52417","GRU98880"],GRU98880,"GRU98880")

Actual (Unparsed): [[0.0000000]]

Expected (Unparsed): [[7.004619106965038e-12]]

Actual:   [[0]]

Expected: [[0]]