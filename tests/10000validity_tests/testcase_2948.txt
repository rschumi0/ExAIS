import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc52820 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Ave25760 = tf.keras.layers.Input(shape=([1, 1]))
in1Ave25760 = tf.keras.layers.Input(shape=([1, 1]))
in0Con66293 = tf.keras.layers.Input(shape=([2, 1, 2]))

Loc52820 = keras.layers.LocallyConnected2D(3, (1, 1),strides=(1, 1), name = 'Loc52820', )(in0Loc52820)
Ave25760 = keras.layers.Average(name = 'Ave25760', )([in0Ave25760,in1Ave25760])
Res25447 = keras.layers.Reshape((1, 1, 1), name = 'Res25447', )(Ave25760)
Cro82954 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro82954', )(Res25447)
Zer21516 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer21516', )(Cro82954)
Con66293 = keras.layers.Concatenate(axis=3, name = 'Con66293', )([Zer21516,in0Con66293])
Ave76267 = keras.layers.Average(name = 'Ave76267', )([Loc52820,Con66293])
model = tf.keras.models.Model(inputs=[in0Loc52820,in0Ave25760,in1Ave25760,in0Con66293], outputs=Ave76267)
w = model.get_layer('Loc52820').get_weights() 
w[0] = np.array([[[0.9637, 0.2152, 0.8874]], [[0.8892, 0.8099, 0.4187]]])
w[1] = np.array([[[0, 0, 0]], [[0, 0, 0]]])
model.get_layer('Loc52820').set_weights(w) 
in0Loc52820 = tf.constant([[[[0.7519]], [[0.4296]]]])
in0Ave25760 = tf.constant([[[0.8791]]])
in1Ave25760 = tf.constant([[[0.6123]]])
in0Con66293 = tf.constant([[[[0.351, 0.1753]], [[0.3597, 0.1359]]]])
print (np.array2string(model.predict([in0Loc52820,in0Ave25760,in1Ave25760,in0Con66293],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave76267.png')

LLoc52820 = locally_connected2D_layer([[[[0.7519]], [[0.4296]]]], 1, 1,[[[0.9637, 0.2152, 0.8874]], [[0.8892, 0.8099, 0.4187]]],[[[0, 0, 0]], [[0, 0, 0]]], 1, 1, Loc52820), 
LAve25760 = average_layer([[[[0.8791]]], [[[0.6123]]]], Ave25760), 
LRes25447 = reshape_layer(Ave25760, [1, 1, 1], Res25447), 
LCro82954 = cropping2D_layer(Res25447, 0, 0, 0, 0, Cro82954), 
LZer21516 = zero_padding2D_layer(Cro82954, 1, 0, 0, 0, Zer21516), 
LCon66293 = concatenate_layer([Zer21516,[[[[0.351, 0.1753]], [[0.3597, 0.1359]]]]], 3, Con66293), 
LAve76267 = average_layer([Loc52820,Con66293], Ave76267), 
exec_layers([LLoc52820,LAve25760,LRes25447,LCro82954,LZer21516,LCon66293,LAve76267],["Loc52820","Ave25760","Res25447","Cro82954","Zer21516","Con66293","Ave76267"],Ave76267,"Ave76267")

Actual (Unparsed): [[[[0.3623030, 0.2564044, 0.4212680]], [[0.5638502, 0.3538165, 0.1578868]]]]

Expected (Unparsed): [[[[0.362303015,0.25640444,0.42126803]],[[0.56385016,0.35381651999999997,0.15788676000000001]]]]

Actual:   [[[[0.3624, 0.2565, 0.4213]], [[0.5639, 0.3539, 0.1579]]]]

Expected: [[[[0.3624, 0.2565, 0.4213]], [[0.5639, 0.3539, 0.1579]]]]