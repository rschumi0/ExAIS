import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add61972 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Add61972 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Max15932 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Max15932 = tf.keras.layers.Input(shape=([1, 2, 2]))

Add61972 = keras.layers.Add(name = 'Add61972', )([in0Add61972,in1Add61972])
Loc7101 = keras.layers.LocallyConnected2D(2, (1, 1),strides=(4, 1), name = 'Loc7101', )(Add61972)
Res12562 = keras.layers.Reshape((1, 2), name = 'Res12562', )(Loc7101)
Max15932 = keras.layers.Maximum(name = 'Max15932', )([in0Max15932,in1Max15932])
Res55291 = keras.layers.Reshape((1, 4), name = 'Res55291', )(Max15932)
LST53404 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST53404', )(Res55291)
Res50897 = keras.layers.Reshape((3, 1), name = 'Res50897', )(LST53404)
Res92563 = keras.layers.Reshape((3, 1, 1), name = 'Res92563', )(Res50897)
Loc34445 = keras.layers.LocallyConnected2D(2, (3, 1),strides=(1, 1), name = 'Loc34445', )(Res92563)
Res96599 = keras.layers.Reshape((1, 2), name = 'Res96599', )(Loc34445)
Per32779 = keras.layers.Permute((1,2), name = 'Per32779',)(Res96599)
Ave64831 = keras.layers.Average(name = 'Ave64831', )([Res12562,Per32779])
Res20173 = keras.layers.Reshape((1, 2, 1), name = 'Res20173', )(Ave64831)
Zer76682 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer76682', )(Res20173)
model = tf.keras.models.Model(inputs=[in0Add61972,in1Add61972,in0Max15932,in1Max15932], outputs=Zer76682)
w = model.get_layer('Loc7101').get_weights() 
w[0] = np.array([[[0.5936, 0.8204]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc7101').set_weights(w) 
w = model.get_layer('LST53404').get_weights() 
w[0] = np.array([[3, 4, 8, 7, 5, 10, 8, 10, 10, 3, 1, 8], [1, 5, 2, 7, 8, 6, 6, 5, 7, 3, 2, 1], [7, 1, 7, 9, 1, 4, 8, 9, 3, 8, 2, 4], [2, 1, 6, 5, 3, 3, 10, 6, 8, 10, 6, 1]])
w[1] = np.array([[10, 2, 1, 7, 10, 9, 7, 8, 1, 10, 3, 5], [2, 1, 7, 3, 1, 4, 10, 6, 5, 8, 1, 4], [2, 3, 2, 4, 5, 6, 2, 6, 5, 8, 6, 6]])
w[2] = np.array([10, 5, 10, 3, 9, 2, 1, 1, 7, 1, 5, 10])
model.get_layer('LST53404').set_weights(w) 
w = model.get_layer('Loc34445').get_weights() 
w[0] = np.array([[[0.2514, 0.9532], [0.6687, 0.8682], [0.9483, 0.7069]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc34445').set_weights(w) 
in0Add61972 = tf.constant([[[[0.6491]]]])
in1Add61972 = tf.constant([[[[0.0119]]]])
in0Max15932 = tf.constant([[[[0.4636, 0.2848], [0.2582, 0.5256]]]])
in1Max15932 = tf.constant([[[[0.0863, 0.0133], [0.1979, 0.3406]]]])
print (np.array2string(model.predict([in0Add61972,in1Add61972,in0Max15932,in1Max15932],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Zer76682.png')

LAdd61972 = add_layer([[[[[0.6491]]]], [[[[0.0119]]]]], Add61972), 
LLoc7101 = locally_connected2D_layer(Add61972, 1, 1,[[[0.5936, 0.8204]]],[[[0, 0]]], 4, 1, Loc7101), 
LRes12562 = reshape_layer(Loc7101, [1, 2], Res12562), 
LMax15932 = maximum_layer([[[[[0.4636, 0.2848], [0.2582, 0.5256]]]], [[[[0.0863, 0.0133], [0.1979, 0.3406]]]]], Max15932), 
LRes55291 = reshape_layer(Max15932, [1, 4], Res55291), 
LLST53404 = lstm_layer(Res55291,[[3, 4, 8, 7, 5, 10, 8, 10, 10, 3, 1, 8], [1, 5, 2, 7, 8, 6, 6, 5, 7, 3, 2, 1], [7, 1, 7, 9, 1, 4, 8, 9, 3, 8, 2, 4], [2, 1, 6, 5, 3, 3, 10, 6, 8, 10, 6, 1]],[[10, 2, 1, 7, 10, 9, 7, 8, 1, 10, 3, 5], [2, 1, 7, 3, 1, 4, 10, 6, 5, 8, 1, 4], [2, 3, 2, 4, 5, 6, 2, 6, 5, 8, 6, 6]],[10, 5, 10, 3, 9, 2, 1, 1, 7, 1, 5, 10], LST53404), 
LRes50897 = reshape_layer(LST53404, [3, 1], Res50897), 
LRes92563 = reshape_layer(Res50897, [3, 1, 1], Res92563), 
LLoc34445 = locally_connected2D_layer(Res92563, 3, 1,[[[0.2514, 0.9532], [0.6687, 0.8682], [0.9483, 0.7069]]],[[[0, 0]]], 1, 1, Loc34445), 
LRes96599 = reshape_layer(Loc34445, [1, 2], Res96599), 
LPer32779 = permute_layer(Res96599, 1,2, Per32779), 
LAve64831 = average_layer([Res12562,Per32779], Ave64831), 
LRes20173 = reshape_layer(Ave64831, [1, 2, 1], Res20173), 
LZer76682 = zero_padding2D_layer(Res20173, 1, 1, 1, 1, Zer76682), 
exec_layers([LAdd61972,LLoc7101,LRes12562,LMax15932,LRes55291,LLST53404,LRes50897,LRes92563,LLoc34445,LRes96599,LPer32779,LAve64831,LRes20173,LZer76682],["Add61972","Loc7101","Res12562","Max15932","Res55291","LST53404","Res50897","Res92563","Loc34445","Res96599","Per32779","Ave64831","Res20173","Zer76682"],Zer76682,"Zer76682")

Actual (Unparsed): [[[[0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.9076317], [1.2338606], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000]]]]

Expected (Unparsed): [[[[0],[0],[0],[0]],[[0],[0.9076316676530688],[1.2338606225381943],[0]],[[0],[0],[0],[0]]]]

Actual:   [[[[0], [0], [0], [0]], [[0], [0.9077], [1.2339], [0]], [[0], [0], [0], [0]]]]

Expected: [[[[0], [0], [0], [0]], [[0], [0.9077], [1.2339], [0]], [[0], [0], [0], [0]]]]