import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub42430 = tf.keras.layers.Input(shape=([3, 3]))
in1Sub42430 = tf.keras.layers.Input(shape=([3, 3]))
in0Sub27173 = tf.keras.layers.Input(shape=([2, 2, 3, 3]))
in1Sub27173 = tf.keras.layers.Input(shape=([2, 2, 3, 3]))

Sub42430 = keras.layers.Subtract(name = 'Sub42430', )([in0Sub42430,in1Sub42430])
Res93697 = keras.layers.Reshape((3, 3, 1), name = 'Res93697', )(Sub42430)
Dep63687 = keras.layers.DepthwiseConv2D((2, 3),strides=(1, 1), padding='valid', name = 'Dep63687', )(Res93697)
Res28407 = keras.layers.Reshape((2, 1), name = 'Res28407', )(Dep63687)
Sub27173 = keras.layers.Subtract(name = 'Sub27173', )([in0Sub27173,in1Sub27173])
Res98640 = keras.layers.Reshape((2, 2, 9), name = 'Res98640', )(Sub27173)
Res63313 = keras.layers.Reshape((2, 18), name = 'Res63313', )(Res98640)
Dot20562 = keras.layers.Dot(axes=(1, 1), name = 'Dot20562', )([Res28407,Res63313])
model = tf.keras.models.Model(inputs=[in0Sub42430,in1Sub42430,in0Sub27173,in1Sub27173], outputs=Dot20562)
w = model.get_layer('Dep63687').get_weights() 
w[0] = np.array([[[[0.3093]], [[0.1281]], [[0.4278]]], [[[0.579]], [[0.6393]], [[0.6238]]]])
w[1] = np.array([0])
model.get_layer('Dep63687').set_weights(w) 
in0Sub42430 = tf.constant([[[0.0337, 0.3405, 0.569], [0.3126, 0.5359, 0.6447], [0.1633, 0.1199, 0.0433]]])
in1Sub42430 = tf.constant([[[0.1808, 0.7972, 0.3634], [0.1246, 0.1024, 0.6531], [0.5519, 0.9994, 0.5643]]])
in0Sub27173 = tf.constant([[[[[0.4192, 0.5745, 0.5511], [0.5112, 0.7224, 0.7753], [0.5487, 0.9802, 0.5857]], [[0.354, 0.3192, 0.1777], [0.0626, 0.2195, 0.3772], [0.0798, 0.4818, 0.5536]]], [[[0.0687, 0.3317, 0.7994], [0.5121, 0.1116, 0.7787], [0.4009, 0.6812, 0.0299]], [[0.0449, 0.3217, 0.1389], [0.8662, 0.1968, 0.2598], [0.2278, 0.2335, 0.6777]]]]])
in1Sub27173 = tf.constant([[[[[0.946, 0.4369, 0.7186], [0.378, 0.4046, 0.1097], [0.8863, 0.9204, 0.3881]], [[0.0506, 0.6504, 0.9817], [0.8045, 0.4827, 0.5735], [0.7451, 0.2652, 0.229]]], [[[0.739, 0.387, 0.9805], [0.4299, 0.1977, 0.8342], [0.1014, 0.5933, 0.6332]], [[0.9, 0.2677, 0.2782], [0.8135, 0.3032, 0.558], [0.2536, 0.5999, 0.0079]]]]])
print (np.array2string(model.predict([in0Sub42430,in1Sub42430,in0Sub27173,in1Sub27173],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot20562.png')

LSub42430 = subtract_layer([[[0.0337, 0.3405, 0.569], [0.3126, 0.5359, 0.6447], [0.1633, 0.1199, 0.0433]]], [[[0.1808, 0.7972, 0.3634], [0.1246, 0.1024, 0.6531], [0.5519, 0.9994, 0.5643]]], Sub42430), 
LRes93697 = reshape_layer(Sub42430, [3, 3, 1], Res93697), 
LDep63687 = depthwise_conv2D_layer(Res93697, 2, 3,[[[[0.3093]], [[0.1281]], [[0.4278]]], [[[0.579]], [[0.6393]], [[0.6238]]]],[0], 1, 1, false, Dep63687), 
LRes28407 = reshape_layer(Dep63687, [2, 1], Res28407), 
LSub27173 = subtract_layer([[[[[0.4192, 0.5745, 0.5511], [0.5112, 0.7224, 0.7753], [0.5487, 0.9802, 0.5857]], [[0.354, 0.3192, 0.1777], [0.0626, 0.2195, 0.3772], [0.0798, 0.4818, 0.5536]]], [[[0.0687, 0.3317, 0.7994], [0.5121, 0.1116, 0.7787], [0.4009, 0.6812, 0.0299]], [[0.0449, 0.3217, 0.1389], [0.8662, 0.1968, 0.2598], [0.2278, 0.2335, 0.6777]]]]], [[[[[0.946, 0.4369, 0.7186], [0.378, 0.4046, 0.1097], [0.8863, 0.9204, 0.3881]], [[0.0506, 0.6504, 0.9817], [0.8045, 0.4827, 0.5735], [0.7451, 0.2652, 0.229]]], [[[0.739, 0.387, 0.9805], [0.4299, 0.1977, 0.8342], [0.1014, 0.5933, 0.6332]], [[0.9, 0.2677, 0.2782], [0.8135, 0.3032, 0.558], [0.2536, 0.5999, 0.0079]]]]], Sub27173), 
LRes98640 = reshape_layer(Sub27173, [2, 2, 9], Res98640), 
LRes63313 = reshape_layer(Res98640, [2, 18], Res63313), 
LDot20562 = dot_layer(Res28407,Res63313, 1, 1, Dot20562), 
exec_layers([LSub42430,LRes93697,LDep63687,LRes28407,LSub27173,LRes98640,LRes63313,LDot20562],["Sub42430","Res93697","Dep63687","Res28407","Sub27173","Res98640","Res63313","Dot20562"],Dot20562,"Dot20562")

Actual (Unparsed): [[[0.4796340, 0.1056035, 0.1204066, -0.0338005, 0.2021901, 0.2983672, -0.4232759, -0.0662822, 0.6766789, 0.9676127, -0.1749072, -0.1536179, -0.3233879, 0.0106419, 0.2272581, -0.2167807, 0.4461925, -0.5528758]]]

Expected (Unparsed): [[[0.479633911928,0.10560353997200002,0.12040655847700002,-0.03380053477199999,0.20219008382999998,0.2983671647160001,-0.423275843516,-0.06628214643,0.6766788919319999,0.9676127195659999,-0.174907212192,-0.15361791936400007,-0.323387907883,0.010641834616000004,0.227258075961,-0.21678073769700007,0.44619244201399993,-0.5528757718899999]]]

Actual:   [[[0.4797, 0.1057, 0.1205, -0.0338, 0.2022, 0.2984, -0.4232, -0.0662, 0.6767, 0.9677, -0.1749, -0.1536, -0.3233, 0.0107, 0.2273, -0.2167, 0.4462, -0.5528]]]

Expected: [[[0.4797, 0.1057, 0.1205, -0.0338, 0.2022, 0.2984, -0.4232, -0.0662, 0.6767, 0.9677, -0.1749, -0.1536, -0.3233, 0.0107, 0.2273, -0.2167, 0.4462, -0.5528]]]