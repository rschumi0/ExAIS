import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max76238 = tf.keras.layers.Input(shape=([1, 1]))
in0Con58851 = tf.keras.layers.Input(shape=([3, 1]))
in0Add84319 = tf.keras.layers.Input(shape=([2, 2]))
in1Add84319 = tf.keras.layers.Input(shape=([2, 2]))
in0Loc91964 = tf.keras.layers.Input(shape=([1, 2]))

Max76238 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max76238', )(in0Max76238)
Res60229 = keras.layers.Reshape((1, 1, 1), name = 'Res60229', )(Max76238)
Con57530 = keras.layers.Conv2DTranspose(3, (1, 1),strides=(1, 1), padding='same', name = 'Con57530', )(Res60229)
Res7080 = keras.layers.Reshape((1, 3), name = 'Res7080', )(Con57530)
Per21389 = keras.layers.Permute((2,1), name = 'Per21389',)(Res7080)
Con58851 = keras.layers.Concatenate(axis=2, name = 'Con58851', )([Per21389,in0Con58851])
Add84319 = keras.layers.Add(name = 'Add84319', )([in0Add84319,in1Add84319])
Zer64778 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer64778', )(Add84319)
Ave40571 = keras.layers.Average(name = 'Ave40571', )([Con58851,Zer64778])
Res70459 = keras.layers.Reshape((3, 2, 1), name = 'Res70459', )(Ave40571)
Res15914 = keras.layers.Reshape((3, 2, 1, 1), name = 'Res15914', )(Res70459)
Zer40658 = keras.layers.ZeroPadding3D(padding=((0, 0), (4, 0), (0, 0)), name = 'Zer40658', )(Res15914)
Loc91964 = keras.layers.LocallyConnected1D(2, (1),strides=(8), name = 'Loc91964', )(in0Loc91964)
Loc524 = keras.layers.LocallyConnected1D(4, (1),strides=(1), name = 'Loc524', )(Loc91964)
Res15337 = keras.layers.Reshape((1, 4, 1), name = 'Res15337', )(Loc524)
Res56214 = keras.layers.Reshape((1, 4, 1, 1), name = 'Res56214', )(Res15337)
Cro63424 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro63424', )(Res56214)
Zer46187 = keras.layers.ZeroPadding3D(padding=((2, 0), (2, 0), (0, 0)), name = 'Zer46187', )(Cro63424)
Sub18918 = keras.layers.Subtract(name = 'Sub18918', )([Zer40658,Zer46187])
model = tf.keras.models.Model(inputs=[in0Max76238,in0Con58851,in0Add84319,in1Add84319,in0Loc91964], outputs=Sub18918)
w = model.get_layer('Con57530').get_weights() 
w[0] = np.array([[[[0.9491], [0.1909], [0.8405]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con57530').set_weights(w) 
w = model.get_layer('Loc91964').get_weights() 
w[0] = np.array([[[0.6857, 0.1234], [0.3842, 0.4897]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc91964').set_weights(w) 
w = model.get_layer('Loc524').get_weights() 
w[0] = np.array([[[0.4128, 0.5268, 0.8513, 0.6541], [0.2182, 0.6793, 0.5197, 0.9257]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc524').set_weights(w) 
in0Max76238 = tf.constant([[[1.2881]]])
in0Con58851 = tf.constant([[[0.7212], [0.6773], [0.8048]]])
in0Add84319 = tf.constant([[[0.9892, 0.6734], [0.638, 0.1565]]])
in1Add84319 = tf.constant([[[0.2392, 0.2259], [0.3469, 0.2623]]])
in0Loc91964 = tf.constant([[[0.3958, 0.4374]]])
print (np.array2string(model.predict([in0Max76238,in0Con58851,in0Add84319,in1Add84319,in0Loc91964],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub18918.png')

LMax76238 = max_pool1D_layer([[[1.2881]]], 1, Max76238), 
LRes60229 = reshape_layer(Max76238, [1, 1, 1], Res60229), 
LCon57530 = conv2D_transpose_layer(Res60229, 1, 1,[[[[0.9491], [0.1909], [0.8405]]]],[0, 0, 0], 1, 1, true, Con57530), 
LRes7080 = reshape_layer(Con57530, [1, 3], Res7080), 
LPer21389 = permute_layer(Res7080, 2,1, Per21389), 
LCon58851 = concatenate_layer([Per21389,[[[0.7212], [0.6773], [0.8048]]]], 2, Con58851), 
LAdd84319 = add_layer([[[[0.9892, 0.6734], [0.638, 0.1565]]], [[[0.2392, 0.2259], [0.3469, 0.2623]]]], Add84319), 
LZer64778 = zero_padding1D_layer(Add84319, 1, 0, Zer64778), 
LAve40571 = average_layer([Con58851,Zer64778], Ave40571), 
LRes70459 = reshape_layer(Ave40571, [3, 2, 1], Res70459), 
LRes15914 = reshape_layer(Res70459, [3, 2, 1, 1], Res15914), 
LZer40658 = zero_padding3D_layer(Res15914, 0, 0, 4, 0, 0, 0, Zer40658), 
LLoc91964 = locally_connected1D_layer([[[0.3958, 0.4374]]], 1,[[[0.6857, 0.1234], [0.3842, 0.4897]]],[[0, 0]], 8, Loc91964), 
LLoc524 = locally_connected1D_layer(Loc91964, 1,[[[0.4128, 0.5268, 0.8513, 0.6541], [0.2182, 0.6793, 0.5197, 0.9257]]],[[0, 0, 0, 0]], 1, Loc524), 
LRes15337 = reshape_layer(Loc524, [1, 4, 1], Res15337), 
LRes56214 = reshape_layer(Res15337, [1, 4, 1, 1], Res56214), 
LCro63424 = cropping3D_layer(Res56214, 0, 0, 0, 0, 0, 0, Cro63424), 
LZer46187 = zero_padding3D_layer(Cro63424, 2, 0, 2, 0, 0, 0, Zer46187), 
LSub18918 = subtract_layer(Zer40658,Zer46187, Sub18918), 
exec_layers([LMax76238,LRes60229,LCon57530,LRes7080,LPer21389,LCon58851,LAdd84319,LZer64778,LAve40571,LRes70459,LRes15914,LZer40658,LLoc91964,LLoc524,LRes15337,LRes56214,LCro63424,LZer46187,LSub18918],["Max76238","Res60229","Con57530","Res7080","Per21389","Con58851","Add84319","Zer64778","Ave40571","Res70459","Res15914","Zer40658","Loc91964","Loc524","Res15337","Res56214","Cro63424","Zer46187","Sub18918"],Sub18918,"Sub18918")

Actual (Unparsed): [[[[[0.0000000]], [[0.0000000]], [[0.0000000]], [[0.0000000]], [[0.6112679]], [[0.3606000]]], [[[0.0000000]], [[0.0000000]], [[0.0000000]], [[0.0000000]], [[0.7371491]], [[0.7883000]]], [[[0.0000000]], [[0.0000000]], [[-0.2387992]], [[-0.4101825]], [[0.5229709]], [[0.0808634]]]]]

Expected (Unparsed): [[[[[0]],[[0]],[[0]],[[0]],[[0.611267855]],[[0.3606]]],[[[0]],[[0]],[[0]],[[0]],[[0.737149145]],[[0.7883]]],[[[0]],[[0]],[[-0.238799169292]],[[-0.4101825014020001]],[[0.5229709030680001]],[[0.08086342947599989]]]]]

Actual:   [[[[[0]], [[0]], [[0]], [[0]], [[0.6113]], [[0.3606]]], [[[0]], [[0]], [[0]], [[0]], [[0.7372]], [[0.7883]]], [[[0]], [[0]], [[-0.2387]], [[-0.4101]], [[0.523]], [[0.0809]]]]]

Expected: [[[[[0]], [[0]], [[0]], [[0]], [[0.6113]], [[0.3606]]], [[[0]], [[0]], [[0]], [[0]], [[0.7372]], [[0.7883]]], [[[0]], [[0]], [[-0.2387]], [[-0.4101]], [[0.523]], [[0.0809]]]]]