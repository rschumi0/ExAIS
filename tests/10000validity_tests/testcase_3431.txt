import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Up_6000 = tf.keras.layers.Input(shape=([3, 3, 2]))

Up_6000 = keras.layers.UpSampling2D(size=(2, 2), name = 'Up_6000', )(in0Up_6000)
ELU59326 = keras.layers.ELU(alpha=-2.6657485470938553, name = 'ELU59326', )(Up_6000)
Res3445 = keras.layers.Reshape((6, 12), name = 'Res3445', )(ELU59326)
LST69755 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST69755', )(Res3445)
Res31462 = keras.layers.Reshape((2, 1), name = 'Res31462', )(LST69755)
Res26356 = keras.layers.Reshape((2, 1, 1), name = 'Res26356', )(Res31462)
Ave99330 = keras.layers.AveragePooling2D(pool_size=(2, 1), strides=(9, 1), padding='valid', name = 'Ave99330', )(Res26356)
model = tf.keras.models.Model(inputs=[in0Up_6000], outputs=Ave99330)
w = model.get_layer('LST69755').get_weights() 
w[0] = np.array([[4, 8, 8, 2, 4, 7, 8, 1], [10, 8, 10, 3, 3, 7, 1, 8], [4, 8, 2, 10, 1, 5, 3, 4], [7, 1, 1, 1, 7, 8, 7, 3], [6, 10, 9, 10, 7, 2, 4, 2], [3, 4, 3, 6, 5, 4, 1, 6], [1, 4, 8, 10, 10, 5, 1, 7], [5, 5, 2, 5, 6, 4, 5, 9], [4, 10, 10, 1, 9, 1, 7, 7], [6, 1, 8, 10, 9, 7, 1, 2], [1, 9, 10, 8, 5, 8, 4, 6], [9, 1, 8, 2, 9, 6, 4, 1]])
w[1] = np.array([[8, 9, 9, 10, 10, 4, 7, 5], [1, 6, 1, 7, 1, 2, 1, 2]])
w[2] = np.array([2, 3, 9, 1, 9, 5, 9, 7])
model.get_layer('LST69755').set_weights(w) 
in0Up_6000 = tf.constant([[[[1.5882, 1.5518], [1.8435, 1.3825], [1.8015, 1.8694]], [[1.1871, 1.972], [1.2319, 1.0178], [1.069, 1.7616]], [[1.6806, 1.3818], [1.1141, 1.2884], [1.8839, 1.3929]]]])
print (np.array2string(model.predict([in0Up_6000],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave99330.png')

LUp_6000 = up_sampling2D_layer([[[[1.5882, 1.5518], [1.8435, 1.3825], [1.8015, 1.8694]], [[1.1871, 1.972], [1.2319, 1.0178], [1.069, 1.7616]], [[1.6806, 1.3818], [1.1141, 1.2884], [1.8839, 1.3929]]]], 2, 2, Up_6000), 
LELU59326 = elu_layer(Up_6000, -2.6657485470938553, ELU59326), 
LRes3445 = reshape_layer(ELU59326, [6, 12], Res3445), 
LLST69755 = lstm_layer(Res3445,[[4, 8, 8, 2, 4, 7, 8, 1], [10, 8, 10, 3, 3, 7, 1, 8], [4, 8, 2, 10, 1, 5, 3, 4], [7, 1, 1, 1, 7, 8, 7, 3], [6, 10, 9, 10, 7, 2, 4, 2], [3, 4, 3, 6, 5, 4, 1, 6], [1, 4, 8, 10, 10, 5, 1, 7], [5, 5, 2, 5, 6, 4, 5, 9], [4, 10, 10, 1, 9, 1, 7, 7], [6, 1, 8, 10, 9, 7, 1, 2], [1, 9, 10, 8, 5, 8, 4, 6], [9, 1, 8, 2, 9, 6, 4, 1]],[[8, 9, 9, 10, 10, 4, 7, 5], [1, 6, 1, 7, 1, 2, 1, 2]],[2, 3, 9, 1, 9, 5, 9, 7], LST69755), 
LRes31462 = reshape_layer(LST69755, [2, 1], Res31462), 
LRes26356 = reshape_layer(Res31462, [2, 1, 1], Res26356), 
LAve99330 = average_pooling2D_layer(Res26356, 2, 1, 9, 1, false, Ave99330), 
exec_layers([LUp_6000,LELU59326,LRes3445,LLST69755,LRes31462,LRes26356,LAve99330],["Up_6000","ELU59326","Res3445","LST69755","Res31462","Res26356","Ave99330"],Ave99330,"Ave99330")

Actual (Unparsed): [[[[0.9999877]]]]

Expected (Unparsed): [[[[0.9999877116507956]]]]

Actual:   [[[[1]]]]

Expected: [[[[1]]]]