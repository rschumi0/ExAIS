import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Cro64999 = tf.keras.layers.Input(shape=([4, 4, 3, 4]))
in0Con44859 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Add20991 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Add20991 = tf.keras.layers.Input(shape=([2, 2, 2]))

Cro64999 = keras.layers.Cropping3D(cropping=((3, 0), (0, 3), (1, 1)), name = 'Cro64999', )(in0Cro64999)
Res35467 = keras.layers.Reshape((1, 1, 4), name = 'Res35467', )(Cro64999)
Res34026 = keras.layers.Reshape((1, 4), name = 'Res34026', )(Res35467)
Sim45607 = keras.layers.SimpleRNN(1,name = 'Sim45607', )(Res34026)
Res68978 = keras.layers.Reshape((1, 1), name = 'Res68978', )(Sim45607)
Res72414 = keras.layers.Reshape((1, 1, 1), name = 'Res72414', )(Res68978)
Zer6763 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer6763', )(Res72414)
Con44859 = keras.layers.Concatenate(axis=3, name = 'Con44859', )([Zer6763,in0Con44859])
Add20991 = keras.layers.Add(name = 'Add20991', )([in0Add20991,in1Add20991])
Max297 = keras.layers.Maximum(name = 'Max297', )([Con44859,Add20991])
model = tf.keras.models.Model(inputs=[in0Cro64999,in0Con44859,in0Add20991,in1Add20991], outputs=Max297)
w = model.get_layer('Sim45607').get_weights() 
w[0] = np.array([[1], [3], [4], [2]])
w[1] = np.array([[8]])
w[2] = np.array([3])
model.get_layer('Sim45607').set_weights(w) 
in0Cro64999 = tf.constant([[[[[1.6877, 1.8439, 1.1534, 1.6292], [1.0677, 1.017, 1.0696, 1.8744], [1.4454, 1.3489, 1.0122, 1.0577]], [[1.947, 1.5423, 1.7984, 1.7176], [1.3455, 1.2471, 1.0777, 1.3778], [1.5277, 1.6885, 1.488, 1.8113]], [[1.8402, 1.5606, 1.727, 1.0679], [1.5736, 1.7115, 1.8119, 1.5273], [1.4703, 1.7832, 1.2562, 1.8306]], [[1.6808, 1.7616, 1.7563, 1.7895], [1.032, 1.3449, 1.2544, 1.2766], [1.8242, 1.1427, 1.9157, 1.6598]]], [[[1.6242, 1.9826, 1.6462, 1.558], [1.6855, 1.0186, 1.2632, 1.5709], [1.6928, 1.9118, 1.3275, 1.1589]], [[1.503, 1.0854, 1.9471, 1.0391], [1.4326, 1.9425, 1.5723, 1.3001], [1.43, 1.9806, 1.9131, 1.9376]], [[1.1617, 1.9359, 1.6339, 1.6648], [1.6408, 1.4475, 1.4041, 1.6634], [1.5311, 1.2442, 1.2185, 1.4025]], [[1.6718, 1.5249, 1.6387, 1.7804], [1.6827, 1.0302, 1.7552, 1.6179], [1.7376, 1.2819, 1.2172, 1.9686]]], [[[1.7192, 1.609, 1.6397, 1.8024], [1.0082, 1.8663, 1.0584, 1.3641], [1.0993, 1.2088, 1.8758, 1.9145]], [[1.0874, 1.8871, 1.9162, 1.6192], [1.8209, 1.7926, 1.7928, 1.0664], [1.1798, 1.4011, 1.7776, 1.2677]], [[1.5063, 1.838, 1.7615, 1.0242], [1.6848, 1.0206, 1.6922, 1.224], [1.7525, 1.2175, 1.0877, 1.9782]], [[1.2058, 1.9154, 1.8352, 1.5011], [1.3589, 1.5752, 1.5071, 1.2906], [1.2135, 1.7254, 1.853, 1.4777]]], [[[1.2977, 1.8437, 1.9573, 1.1775], [1.8506, 1.6555, 1.794, 1.2969], [1.5381, 1.7962, 1.5542, 1.5328]], [[1.6171, 1.2707, 1.1738, 1.2288], [1.0892, 1.7777, 1.947, 1.3496], [1.9237, 1.7625, 1.9764, 1.0785]], [[1.8737, 1.011, 1.4782, 1.4482], [1.7522, 1.7048, 1.6423, 1.9725], [1.2972, 1.12, 1.8246, 1.4657]], [[1.9106, 1.5697, 1.3438, 1.1039], [1.6243, 1.7678, 1.0448, 1.3157], [1.6224, 1.522, 1.0983, 1.2703]]]]])
in0Con44859 = tf.constant([[[[0.8143], [0.5003]], [[0.8329], [0.0997]]]])
in0Add20991 = tf.constant([[[[0.5263, 0.5506], [0.2087, 0.5743]], [[0.4361, 0.2631], [0.5211, 0.2849]]]])
in1Add20991 = tf.constant([[[[0.414, 0.5452], [0.0358, 0.4998]], [[0.6958, 0.9423], [0.2674, 0.5943]]]])
print (np.array2string(model.predict([in0Cro64999,in0Con44859,in0Add20991,in1Add20991],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max297.png')

LCro64999 = cropping3D_layer([[[[[1.6877, 1.8439, 1.1534, 1.6292], [1.0677, 1.017, 1.0696, 1.8744], [1.4454, 1.3489, 1.0122, 1.0577]], [[1.947, 1.5423, 1.7984, 1.7176], [1.3455, 1.2471, 1.0777, 1.3778], [1.5277, 1.6885, 1.488, 1.8113]], [[1.8402, 1.5606, 1.727, 1.0679], [1.5736, 1.7115, 1.8119, 1.5273], [1.4703, 1.7832, 1.2562, 1.8306]], [[1.6808, 1.7616, 1.7563, 1.7895], [1.032, 1.3449, 1.2544, 1.2766], [1.8242, 1.1427, 1.9157, 1.6598]]], [[[1.6242, 1.9826, 1.6462, 1.558], [1.6855, 1.0186, 1.2632, 1.5709], [1.6928, 1.9118, 1.3275, 1.1589]], [[1.503, 1.0854, 1.9471, 1.0391], [1.4326, 1.9425, 1.5723, 1.3001], [1.43, 1.9806, 1.9131, 1.9376]], [[1.1617, 1.9359, 1.6339, 1.6648], [1.6408, 1.4475, 1.4041, 1.6634], [1.5311, 1.2442, 1.2185, 1.4025]], [[1.6718, 1.5249, 1.6387, 1.7804], [1.6827, 1.0302, 1.7552, 1.6179], [1.7376, 1.2819, 1.2172, 1.9686]]], [[[1.7192, 1.609, 1.6397, 1.8024], [1.0082, 1.8663, 1.0584, 1.3641], [1.0993, 1.2088, 1.8758, 1.9145]], [[1.0874, 1.8871, 1.9162, 1.6192], [1.8209, 1.7926, 1.7928, 1.0664], [1.1798, 1.4011, 1.7776, 1.2677]], [[1.5063, 1.838, 1.7615, 1.0242], [1.6848, 1.0206, 1.6922, 1.224], [1.7525, 1.2175, 1.0877, 1.9782]], [[1.2058, 1.9154, 1.8352, 1.5011], [1.3589, 1.5752, 1.5071, 1.2906], [1.2135, 1.7254, 1.853, 1.4777]]], [[[1.2977, 1.8437, 1.9573, 1.1775], [1.8506, 1.6555, 1.794, 1.2969], [1.5381, 1.7962, 1.5542, 1.5328]], [[1.6171, 1.2707, 1.1738, 1.2288], [1.0892, 1.7777, 1.947, 1.3496], [1.9237, 1.7625, 1.9764, 1.0785]], [[1.8737, 1.011, 1.4782, 1.4482], [1.7522, 1.7048, 1.6423, 1.9725], [1.2972, 1.12, 1.8246, 1.4657]], [[1.9106, 1.5697, 1.3438, 1.1039], [1.6243, 1.7678, 1.0448, 1.3157], [1.6224, 1.522, 1.0983, 1.2703]]]]], 3, 0, 0, 3, 1, 1, Cro64999), 
LRes35467 = reshape_layer(Cro64999, [1, 1, 4], Res35467), 
LRes34026 = reshape_layer(Res35467, [1, 4], Res34026), 
LSim45607 = simple_rnn_layer(Res34026,[[1], [3], [4], [2]],[[8]],[3], Sim45607), 
LRes68978 = reshape_layer(Sim45607, [1, 1], Res68978), 
LRes72414 = reshape_layer(Res68978, [1, 1, 1], Res72414), 
LZer6763 = zero_padding2D_layer(Res72414, 1, 0, 1, 0, Zer6763), 
LCon44859 = concatenate_layer([Zer6763,[[[[0.8143], [0.5003]], [[0.8329], [0.0997]]]]], 3, Con44859), 
LAdd20991 = add_layer([[[[[0.5263, 0.5506], [0.2087, 0.5743]], [[0.4361, 0.2631], [0.5211, 0.2849]]]], [[[[0.414, 0.5452], [0.0358, 0.4998]], [[0.6958, 0.9423], [0.2674, 0.5943]]]]], Add20991), 
LMax297 = maximum_layer([Con44859,Add20991], Max297), 
exec_layers([LCro64999,LRes35467,LRes34026,LSim45607,LRes68978,LRes72414,LZer6763,LCon44859,LAdd20991,LMax297],["Cro64999","Res35467","Res34026","Sim45607","Res68978","Res72414","Zer6763","Con44859","Add20991","Max297"],Max297,"Max297")

Actual (Unparsed): [[[[0.9403000, 1.0958000], [0.2445000, 1.0741000]], [[1.1319000, 1.2054000], [1.0000000, 0.8792000]]]]

Expected (Unparsed): [[[[0.9402999999999999,1.0958],[0.2445,1.0741]],[[1.1319,1.2054],[1.0,0.8792]]]]

Actual:   [[[[0.9403, 1.0958], [0.2445, 1.0741]], [[1.1319, 1.2054], [1, 0.8792]]]]

Expected: [[[[0.9403, 1.0958], [0.2445, 1.0741]], [[1.1319, 1.2054], [1, 0.8792]]]]