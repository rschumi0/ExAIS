import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot16576 = tf.keras.layers.Input(shape=([3]))
in1Dot16576 = tf.keras.layers.Input(shape=([3]))
in0Con86821 = tf.keras.layers.Input(shape=([2, 1, 17]))
in0Zer64970 = tf.keras.layers.Input(shape=([4, 3, 4, 3]))

Dot16576 = keras.layers.Dot(axes=(1, 1), name = 'Dot16576', )([in0Dot16576,in1Dot16576])
Res75777 = keras.layers.Reshape((1, 1), name = 'Res75777', )(Dot16576)
Res30078 = keras.layers.Reshape((1, 1, 1), name = 'Res30078', )(Res75777)
Zer53255 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer53255', )(Res30078)
Con86821 = keras.layers.Concatenate(axis=3, name = 'Con86821', )([Zer53255,in0Con86821])
Zer64970 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer64970', )(in0Zer64970)
Res35512 = keras.layers.Reshape((6, 5, 18), name = 'Res35512', )(Zer64970)
Dep13265 = keras.layers.DepthwiseConv2D((1, 3),strides=(5, 5), padding='same', name = 'Dep13265', )(Res35512)
Add9502 = keras.layers.Add(name = 'Add9502', )([Con86821,Dep13265])
model = tf.keras.models.Model(inputs=[in0Dot16576,in1Dot16576,in0Con86821,in0Zer64970], outputs=Add9502)
w = model.get_layer('Dep13265').get_weights() 
w[0] = np.array([[[[0.4872], [0.458], [0.2921], [0.9936], [0.9056], [0.8767], [0.6003], [0.1819], [0.3888], [0.2728], [0.2212], [0.5249], [0.5953], [0.4928], [0.6052], [0.4086], [0.3224], [0.8917]], [[0.3301], [0.7503], [0.9226], [0.0005], [0.7896], [0.7516], [0.1728], [0.4204], [0.3989], [0.1566], [0.1235], [0.1929], [0.4893], [0.6497], [0.0077], [0.7363], [0.2656], [0.1393]], [[0.3783], [0.0676], [0.4208], [0.0617], [0.26], [0.4343], [0.2693], [0.5169], [0.2508], [0.6709], [0.5414], [0.9977], [0.1902], [0.562], [0.3106], [0.7121], [0.2214], [0.2488]]]])
w[1] = np.array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
model.get_layer('Dep13265').set_weights(w) 
in0Dot16576 = tf.constant([[0.3601, 0.6695, 0.6304]])
in1Dot16576 = tf.constant([[0.2293, 0.3607, 0.4518]])
in0Con86821 = tf.constant([[[[0.6169, 0.8335, 0.119, 0.561, 0.0081, 0.8911, 0.6108, 0.6899, 0.7966, 0.5685, 0.4255, 0.5672, 0.8237, 0.2256, 0.1246, 0.3956, 0.282]], [[0.153, 0.118, 0.6919, 0.4063, 0.6528, 0.0597, 0.418, 0.3811, 0.1556, 0.8071, 0.9509, 0.9296, 0.0363, 0.9682, 0.7135, 0.5193, 0.0189]]]])
in0Zer64970 = tf.constant([[[[[1.8027, 1.9355, 1.6678], [1.2711, 1.3351, 1.126], [1.8105, 1.9886, 1.4327], [1.7622, 1.4956, 1.063]], [[1.5425, 1.1327, 1.4863], [1.5597, 1.5363, 1.7066], [1.2168, 1.6043, 1.3137], [1.6879, 1.0992, 1.7772]], [[1.573, 1.1268, 1.104], [1.7641, 1.827, 1.0894], [1.4719, 1.3007, 1.2187], [1.4373, 1.3516, 1.081]]], [[[1.3313, 1.2285, 1.7451], [1.8318, 1.9802, 1.6145], [1.3944, 1.203, 1.9252], [1.3788, 1.1407, 1.466]], [[1.5483, 1.9386, 1.8535], [1.2733, 1.8029, 1.7161], [1.2363, 1.8894, 1.1616], [1.2724, 1.6924, 1.3725]], [[1.8645, 1.4949, 1.9606], [1.1589, 1.4987, 1.4293], [1.4147, 1.3834, 1.8332], [1.0567, 1.7639, 1.0537]]], [[[1.8693, 1.4291, 1.3852], [1.8896, 1.2753, 1.0974], [1.6737, 1.237, 1.7235], [1.6948, 1.6079, 1.9716]], [[1.1658, 1.8675, 1.1894], [1.7158, 1.7488, 1.4887], [1.5411, 1.0148, 1.8969], [1.2326, 1.226, 1.3364]], [[1.0742, 1.141, 1.7823], [1.8911, 1.8702, 1.7696], [1.5618, 1.3062, 1.3516], [1.8693, 1.706, 1.1281]]], [[[1.0713, 1.3232, 1.4978], [1.9768, 1.7323, 1.2422], [1.3846, 1.9301, 1.2672], [1.7006, 1.6865, 1.3794]], [[1.011, 1.5856, 1.3754], [1.1618, 1.7249, 1.428], [1.3355, 1.2498, 1.4536], [1.884, 1.2065, 1.6608]], [[1.5925, 1.7464, 1.2448], [1.5304, 1.0809, 1.9767], [1.6415, 1.4904, 1.3394], [1.2713, 1.3834, 1.5891]]]]])
print (np.array2string(model.predict([in0Dot16576,in1Dot16576,in0Con86821,in0Zer64970],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add9502.png')

LDot16576 = dot_layer([[0.3601, 0.6695, 0.6304]], [[0.2293, 0.3607, 0.4518]], 1, 1, Dot16576), 
LRes75777 = reshape_layer(Dot16576, [1, 1], Res75777), 
LRes30078 = reshape_layer(Res75777, [1, 1, 1], Res30078), 
LZer53255 = zero_padding2D_layer(Res30078, 1, 0, 0, 0, Zer53255), 
LCon86821 = concatenate_layer([Zer53255,[[[[0.6169, 0.8335, 0.119, 0.561, 0.0081, 0.8911, 0.6108, 0.6899, 0.7966, 0.5685, 0.4255, 0.5672, 0.8237, 0.2256, 0.1246, 0.3956, 0.282]], [[0.153, 0.118, 0.6919, 0.4063, 0.6528, 0.0597, 0.418, 0.3811, 0.1556, 0.8071, 0.9509, 0.9296, 0.0363, 0.9682, 0.7135, 0.5193, 0.0189]]]]], 3, Con86821), 
LZer64970 = zero_padding3D_layer([[[[[1.8027, 1.9355, 1.6678], [1.2711, 1.3351, 1.126], [1.8105, 1.9886, 1.4327], [1.7622, 1.4956, 1.063]], [[1.5425, 1.1327, 1.4863], [1.5597, 1.5363, 1.7066], [1.2168, 1.6043, 1.3137], [1.6879, 1.0992, 1.7772]], [[1.573, 1.1268, 1.104], [1.7641, 1.827, 1.0894], [1.4719, 1.3007, 1.2187], [1.4373, 1.3516, 1.081]]], [[[1.3313, 1.2285, 1.7451], [1.8318, 1.9802, 1.6145], [1.3944, 1.203, 1.9252], [1.3788, 1.1407, 1.466]], [[1.5483, 1.9386, 1.8535], [1.2733, 1.8029, 1.7161], [1.2363, 1.8894, 1.1616], [1.2724, 1.6924, 1.3725]], [[1.8645, 1.4949, 1.9606], [1.1589, 1.4987, 1.4293], [1.4147, 1.3834, 1.8332], [1.0567, 1.7639, 1.0537]]], [[[1.8693, 1.4291, 1.3852], [1.8896, 1.2753, 1.0974], [1.6737, 1.237, 1.7235], [1.6948, 1.6079, 1.9716]], [[1.1658, 1.8675, 1.1894], [1.7158, 1.7488, 1.4887], [1.5411, 1.0148, 1.8969], [1.2326, 1.226, 1.3364]], [[1.0742, 1.141, 1.7823], [1.8911, 1.8702, 1.7696], [1.5618, 1.3062, 1.3516], [1.8693, 1.706, 1.1281]]], [[[1.0713, 1.3232, 1.4978], [1.9768, 1.7323, 1.2422], [1.3846, 1.9301, 1.2672], [1.7006, 1.6865, 1.3794]], [[1.011, 1.5856, 1.3754], [1.1618, 1.7249, 1.428], [1.3355, 1.2498, 1.4536], [1.884, 1.2065, 1.6608]], [[1.5925, 1.7464, 1.2448], [1.5304, 1.0809, 1.9767], [1.6415, 1.4904, 1.3394], [1.2713, 1.3834, 1.5891]]]]], 1, 1, 1, 1, 1, 1, Zer64970), 
LRes35512 = reshape_layer(Zer64970, [6, 5, 18], Res35512), 
LDep13265 = depthwise_conv2D_layer(Res35512, 1, 3,[[[[0.4872], [0.458], [0.2921], [0.9936], [0.9056], [0.8767], [0.6003], [0.1819], [0.3888], [0.2728], [0.2212], [0.5249], [0.5953], [0.4928], [0.6052], [0.4086], [0.3224], [0.8917]], [[0.3301], [0.7503], [0.9226], [0.0005], [0.7896], [0.7516], [0.1728], [0.4204], [0.3989], [0.1566], [0.1235], [0.1929], [0.4893], [0.6497], [0.0077], [0.7363], [0.2656], [0.1393]], [[0.3783], [0.0676], [0.4208], [0.0617], [0.26], [0.4343], [0.2693], [0.5169], [0.2508], [0.6709], [0.5414], [0.9977], [0.1902], [0.562], [0.3106], [0.7121], [0.2214], [0.2488]]]],[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 5, 5, true, Dep13265), 
LAdd9502 = add_layer([Con86821,Dep13265], Add9502), 
exec_layers([LDot16576,LRes75777,LRes30078,LZer53255,LCon86821,LZer64970,LRes35512,LDep13265,LAdd9502],["Dot16576","Res75777","Res30078","Zer53255","Con86821","Zer64970","Res35512","Dep13265","Add9502"],Add9502,"Add9502")

Actual (Unparsed): [[[[0.0000000, 0.6169000, 0.8335000, 0.1190000, 0.5610000, 0.0081000, 0.8911000, 0.6108000, 0.6899000, 0.7966000, 0.5685000, 0.4255000, 0.5672000, 0.8237000, 0.2256000, 0.1246000, 0.3956000, 0.2820000]], [[0.6088743, 0.1530000, 0.1180000, 0.6919000, 0.4063000, 0.6528000, 0.0597000, 0.4180000, 0.3811000, 0.1556000, 0.8071000, 0.9509000, 0.9296000, 0.0363000, 0.9682000, 0.7135000, 0.5193000, 0.0189000]]]]

Expected (Unparsed): [[[[0.0,0.6169,0.8335,0.119,0.561,0.0081,0.8911,0.6108,0.6899,0.7966,0.5685,0.4255,0.5672,0.8237,0.2256,0.1246,0.3956,0.282]],[[0.6088743,0.153,0.118,0.6919,0.4063,0.6528,0.0597,0.418,0.3811,0.1556,0.8071,0.9509,0.9296,0.0363,0.9682,0.7135,0.5193,0.0189]]]]

Actual:   [[[[0, 0.6169, 0.8335, 0.119, 0.561, 0.0081, 0.8911, 0.6108, 0.6899, 0.7966, 0.5685, 0.4255, 0.5672, 0.8237, 0.2256, 0.1246, 0.3956, 0.282]], [[0.6089, 0.153, 0.118, 0.6919, 0.4063, 0.6528, 0.0597, 0.418, 0.3811, 0.1556, 0.8071, 0.9509, 0.9296, 0.0363, 0.9682, 0.7135, 0.5193, 0.0189]]]]

Expected: [[[[0, 0.6169, 0.8335, 0.119, 0.561, 0.0081, 0.8911, 0.6108, 0.6899, 0.7966, 0.5685, 0.4255, 0.5672, 0.8237, 0.2256, 0.1246, 0.3956, 0.282]], [[0.6089, 0.153, 0.118, 0.6919, 0.4063, 0.6528, 0.0597, 0.418, 0.3811, 0.1556, 0.8071, 0.9509, 0.9296, 0.0363, 0.9682, 0.7135, 0.5193, 0.0189]]]]