import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max76094 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Max76094 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Min8207 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Min8207 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con54898 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Sub21563 = tf.keras.layers.Input(shape=([2, 3, 2, 2]))
in1Sub21563 = tf.keras.layers.Input(shape=([2, 3, 2, 2]))
in0Ave18186 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Ave18186 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Con93271 = tf.keras.layers.Input(shape=([2, 3, 2, 1]))

Max76094 = keras.layers.Maximum(name = 'Max76094', )([in0Max76094,in1Max76094])
Res41057 = keras.layers.Reshape((2, 1, 2), name = 'Res41057', )(Max76094)
Res86389 = keras.layers.Reshape((2, 2), name = 'Res86389', )(Res41057)
Min8207 = keras.layers.Minimum(name = 'Min8207', )([in0Min8207,in1Min8207])
Res79443 = keras.layers.Reshape((2, 2), name = 'Res79443', )(Min8207)
Dot28739 = keras.layers.Dot(axes=(2, 2), name = 'Dot28739', )([Res86389,Res79443])
Res48218 = keras.layers.Reshape((2, 2, 1), name = 'Res48218', )(Dot28739)
Max19903 = keras.layers.MaxPool2D(pool_size=(1, 2), strides=(1, 2), padding='valid', name = 'Max19903', )(Res48218)
Zer36147 = keras.layers.ZeroPadding2D(padding=((8, 0), (13, 0)), name = 'Zer36147', )(Max19903)
Con54898 = keras.layers.Conv2DTranspose(4, (1, 1),strides=(1, 1), padding='same', name = 'Con54898', )(in0Con54898)
Res95809 = keras.layers.Reshape((2, 8), name = 'Res95809', )(Con54898)
Sub21563 = keras.layers.Subtract(name = 'Sub21563', )([in0Sub21563,in1Sub21563])
Ave18186 = keras.layers.Average(name = 'Ave18186', )([in0Ave18186,in1Ave18186])
Zer82798 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (1, 0)), name = 'Zer82798', )(Ave18186)
Con93271 = keras.layers.Concatenate(axis=4, name = 'Con93271', )([Zer82798,in0Con93271])
Max29515 = keras.layers.Maximum(name = 'Max29515', )([Sub21563,Con93271])
Res57042 = keras.layers.Reshape((2, 3, 4), name = 'Res57042', )(Max29515)
Res40928 = keras.layers.Reshape((2, 12), name = 'Res40928', )(Res57042)
Dot8327 = keras.layers.Dot(axes=(1, 1), name = 'Dot8327', )([Res95809,Res40928])
Res91619 = keras.layers.Reshape((8, 12, 1), name = 'Res91619', )(Dot8327)
Zer92388 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer92388', )(Res91619)
Sub78066 = keras.layers.Subtract(name = 'Sub78066', )([Zer36147,Zer92388])
model = tf.keras.models.Model(inputs=[in0Max76094,in1Max76094,in0Min8207,in1Min8207,in0Con54898,in0Sub21563,in1Sub21563,in0Ave18186,in1Ave18186,in0Con93271], outputs=Sub78066)
w = model.get_layer('Con54898').get_weights() 
w[0] = np.array([[[[0.2021, 0.7238], [0.7242, 0.8551], [0.1102, 0.0222], [0.9639, 0.1009]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con54898').set_weights(w) 
in0Max76094 = tf.constant([[[[[0.6335], [0.3534]]], [[[0.8756], [0.1604]]]]])
in1Max76094 = tf.constant([[[[[0.1084], [0.2446]]], [[[0.088], [0.153]]]]])
in0Min8207 = tf.constant([[[[0.0579], [0.5779]], [[0.2073], [0.9431]]]])
in1Min8207 = tf.constant([[[[0.6379], [0.4377]], [[0.8653], [0.0699]]]])
in0Con54898 = tf.constant([[[[0.8703, 0.7844], [0.9558, 0.4594]], [[0.6152, 0.2959], [0.1664, 0.4033]]]])
in0Sub21563 = tf.constant([[[[[0.5395, 0.1876], [0.7445, 0.9025]], [[0.7135, 0.6334], [0.3492, 0.2672]], [[0.2872, 0.1474], [0.5504, 0.1185]]], [[[0.553, 0.2992], [0.7817, 0.9665]], [[0.5814, 0.437], [0.3272, 0.3548]], [[0.5371, 0.669], [0.2267, 0.1562]]]]])
in1Sub21563 = tf.constant([[[[[0.722, 0.2163], [0.8243, 0.9791]], [[0.3768, 0.39], [0.049, 0.8021]], [[0.2744, 0.8701], [0.4184, 0.8937]]], [[[0.1841, 0.6655], [0.1875, 0.791]], [[0.3539, 0.1226], [0.0232, 0.6163]], [[0.2609, 0.6137], [0.0826, 0.288]]]]])
in0Ave18186 = tf.constant([[[[[0.0151]]], [[[0.0867]]]]])
in1Ave18186 = tf.constant([[[[[0.3944]]], [[[0.2506]]]]])
in0Con93271 = tf.constant([[[[[0.2505], [0.7228]], [[0.5189], [0.7643]], [[0.4417], [0.9726]]], [[[0.6596], [0.3826]], [[0.1487], [0.3131]], [[0.0302], [0.3811]]]]])
print (np.array2string(model.predict([in0Max76094,in1Max76094,in0Min8207,in1Min8207,in0Con54898,in0Sub21563,in1Sub21563,in0Ave18186,in1Ave18186,in0Con93271],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub78066.png')

LMax76094 = maximum_layer([[[[[[0.6335], [0.3534]]], [[[0.8756], [0.1604]]]]], [[[[[0.1084], [0.2446]]], [[[0.088], [0.153]]]]]], Max76094), 
LRes41057 = reshape_layer(Max76094, [2, 1, 2], Res41057), 
LRes86389 = reshape_layer(Res41057, [2, 2], Res86389), 
LMin8207 = minimum_layer([[[[[0.0579], [0.5779]], [[0.2073], [0.9431]]]], [[[[0.6379], [0.4377]], [[0.8653], [0.0699]]]]], Min8207), 
LRes79443 = reshape_layer(Min8207, [2, 2], Res79443), 
LDot28739 = dot_layer(Res86389,Res79443, 2, 2, Dot28739), 
LRes48218 = reshape_layer(Dot28739, [2, 2, 1], Res48218), 
LMax19903 = max_pool2D_layer(Res48218, 1, 2, 1, 2, false, Max19903), 
LZer36147 = zero_padding2D_layer(Max19903, 8, 0, 13, 0, Zer36147), 
LCon54898 = conv2D_transpose_layer([[[[0.8703, 0.7844], [0.9558, 0.4594]], [[0.6152, 0.2959], [0.1664, 0.4033]]]], 1, 1,[[[[0.2021, 0.7238], [0.7242, 0.8551], [0.1102, 0.0222], [0.9639, 0.1009]]]],[0, 0, 0, 0], 1, 1, true, Con54898), 
LRes95809 = reshape_layer(Con54898, [2, 8], Res95809), 
LSub21563 = subtract_layer([[[[[0.5395, 0.1876], [0.7445, 0.9025]], [[0.7135, 0.6334], [0.3492, 0.2672]], [[0.2872, 0.1474], [0.5504, 0.1185]]], [[[0.553, 0.2992], [0.7817, 0.9665]], [[0.5814, 0.437], [0.3272, 0.3548]], [[0.5371, 0.669], [0.2267, 0.1562]]]]], [[[[[0.722, 0.2163], [0.8243, 0.9791]], [[0.3768, 0.39], [0.049, 0.8021]], [[0.2744, 0.8701], [0.4184, 0.8937]]], [[[0.1841, 0.6655], [0.1875, 0.791]], [[0.3539, 0.1226], [0.0232, 0.6163]], [[0.2609, 0.6137], [0.0826, 0.288]]]]], Sub21563), 
LAve18186 = average_layer([[[[[[0.0151]]], [[[0.0867]]]]], [[[[[0.3944]]], [[[0.2506]]]]]], Ave18186), 
LZer82798 = zero_padding3D_layer(Ave18186, 0, 0, 2, 0, 1, 0, Zer82798), 
LCon93271 = concatenate_layer([Zer82798,[[[[[0.2505], [0.7228]], [[0.5189], [0.7643]], [[0.4417], [0.9726]]], [[[0.6596], [0.3826]], [[0.1487], [0.3131]], [[0.0302], [0.3811]]]]]], 4, Con93271), 
LMax29515 = maximum_layer([Sub21563,Con93271], Max29515), 
LRes57042 = reshape_layer(Max29515, [2, 3, 4], Res57042), 
LRes40928 = reshape_layer(Res57042, [2, 12], Res40928), 
LDot8327 = dot_layer(Res95809,Res40928, 1, 1, Dot8327), 
LRes91619 = reshape_layer(Dot8327, [8, 12, 1], Res91619), 
LZer92388 = zero_padding2D_layer(Res91619, 1, 1, 1, 1, Zer92388), 
LSub78066 = subtract_layer(Zer36147,Zer92388, Sub78066), 
exec_layers([LMax76094,LRes41057,LRes86389,LMin8207,LRes79443,LDot28739,LRes48218,LMax19903,LZer36147,LCon54898,LRes95809,LSub21563,LAve18186,LZer82798,LCon93271,LMax29515,LRes57042,LRes40928,LDot8327,LRes91619,LZer92388,LSub78066],["Max76094","Res41057","Res86389","Min8207","Res79443","Dot28739","Res48218","Max19903","Zer36147","Con54898","Res95809","Sub21563","Ave18186","Zer82798","Con93271","Max29515","Res57042","Res40928","Dot8327","Res91619","Zer92388","Sub78066"],Sub78066,"Sub78066")

Actual (Unparsed): [[[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [-0.1248742], [-0.4095584], [-0.2011393], [-0.6670121], [-0.3273921], [-0.4922986], [-0.3261450], [-0.6743470], [-0.1030135], [-0.3471835], [-0.2093483], [-0.8522647], [0.0000000]], [[0.0000000], [-0.2576958], [-0.7866683], [-0.4150796], [-1.2076372], [-0.5969712], [-0.8947197], [-0.6029235], [-1.2130798], [-0.2095930], [-0.6132868], [-0.3841929], [-1.5315821], [0.0000000]], [[0.0000000], [-0.0274329], [-0.0774374], [-0.0441871], [-0.1103599], [-0.0550729], [-0.0821822], [-0.0566255], [-0.1098944], [-0.0219899], [-0.0541661], [-0.0357439], [-0.1385559], [0.0000000]], [[0.0000000], [-0.2297685], [-0.6407963], [-0.3700960], [-0.9018522], [-0.4507979], [-0.6721881], [-0.4649377], [-0.8966625], [-0.1837813], [-0.4399365], [-0.2930095], [-1.1302413], [0.0000000]], [[0.0000000], [-0.1200909], [-0.3464079], [-0.1934347], [-0.5045130], [-0.2510567], [-0.3751249], [-0.2567730], [-0.5037038], [-0.0966423], [-0.2501955], [-0.1625351], [-0.6353398], [0.0000000]], [[0.0000000], [-0.1716745], [-0.5787555], [-0.2765221], [-0.9623049], [-0.4711987], [-0.7093305], [-0.4671961], [-0.9749902], [-0.1424232], [-0.5049897], [-0.3006430], [-1.2326457], [0.0000000]], [[0.0000000], [-0.0100675], [-0.0469406], [-0.0162160], [-0.0939449], [-0.0451068], [-0.0685275], [-0.0429778], [-0.0968426], [-0.0090164], [-0.0525378], [-0.0282569], [-0.1227628], [0.0000000]], [[0.0000000], [-0.0741806], [-0.3750324], [-0.1194853], [-0.7763522], [-0.3715545], [-0.5653345], [-0.3516184], [-0.8025342], [-0.0679259], [-0.4385307], [-0.2320393], [-1.0177693], [0.1913628]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.1927238]]]]

Expected (Unparsed): [[[[0],[0],[0],[0],[0],[0],[0],[0],[0],[0],[0],[0],[0],[0]],[[0],[-0.12487425102600001],[-0.409558368339],[-0.20113927882799998],[-0.667012114264],[-0.327392096395],[-0.492298666511],[-0.32614495163],[-0.674346971159],[-0.10301344398800003],[-0.347183465797],[-0.20934829960349996],[-0.8522647179839999],[0]],[[0],[-0.25769580697699995],[-0.7866682838779999],[-0.41507955680599995],[-1.2076372251779999],[-0.596971203465],[-0.8947196979219999],[-0.60292349906],[-1.2130798515929997],[-0.20959299282600002],[-0.613286789619],[-0.38419292856949994],[-1.531582119943],[0]],[[0],[-0.027432886978],[-0.077437352962],[-0.044187100683999996],[-0.110359904924],[-0.05507290770800001],[-0.082182179874],[-0.056625548228000006],[-0.10989441624400001],[-0.021989847796000005],[-0.054166101164],[-0.035743913488],[-0.138555879746],[0]],[[0],[-0.229768475951],[-0.640796316929],[-0.37009603797799995],[-0.9018522202979999],[-0.450797898096],[-0.672188078953],[-0.464937711986],[-0.8966624801879999],[-0.18378126442200002],[-0.43993649674799995],[-0.293009505671],[-1.130241375787],[0]],[[0],[-0.120090960822],[-0.346407917058],[-0.19343466771599999],[-0.504512985668],[-0.25105664948],[-0.375124959922],[-0.2567729521],[-0.5037038534080001],[-0.09664230559600001],[-0.250195503824],[-0.162535144602],[-0.635339767518],[0]],[[0],[-0.17167451711899998],[-0.5787555377659999],[-0.27652208748199997],[-0.9623049096859999],[-0.47119872663499995],[-0.709330512794],[-0.46719608249999994],[-0.9749902512909998],[-0.14242313594200004],[-0.5049896812729999],[-0.30064295361649995],[-1.232645676961],[0]],[[0],[-0.010067480206],[-0.046940564104],[-0.016216038868],[-0.093944883356],[-0.04510682157800001],[-0.068527541952],[-0.04297778172800001],[-0.09684259618600001],[-0.009016403500000004],[-0.05253781379],[-0.028256874810999998],[-0.122762801978],[0]],[[0],[-0.074180599577],[-0.375032373968],[-0.11948525960599998],[-0.776352231842],[-0.37155449431099996],[-0.565334524004],[-0.35161837653600003],[-0.802534196527],[-0.06792584209000004],[-0.43853065056499996],[-0.23203929122449998],[-1.017769343131],[0.19136282999999998]],[[0],[0],[0],[0],[0],[0],[0],[0],[0],[0],[0],[0],[0],[0.19272384]]]]

Actual:   [[[[0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0]], [[0], [-0.1248], [-0.4095], [-0.2011], [-0.667], [-0.3273], [-0.4922], [-0.3261], [-0.6743], [-0.103], [-0.3471], [-0.2093], [-0.8522], [0]], [[0], [-0.2576], [-0.7866], [-0.415], [-1.2076], [-0.5969], [-0.8947], [-0.6029], [-1.213], [-0.2095], [-0.6132], [-0.3841], [-1.5315], [0]], [[0], [-0.0274], [-0.0774], [-0.0441], [-0.1103], [-0.055], [-0.0821], [-0.0566], [-0.1098], [-0.0219], [-0.0541], [-0.0357], [-0.1385], [0]], [[0], [-0.2297], [-0.6407], [-0.37], [-0.9018], [-0.4507], [-0.6721], [-0.4649], [-0.8966], [-0.1837], [-0.4399], [-0.293], [-1.1302], [0]], [[0], [-0.12], [-0.3464], [-0.1934], [-0.5045], [-0.251], [-0.3751], [-0.2567], [-0.5037], [-0.0966], [-0.2501], [-0.1625], [-0.6353], [0]], [[0], [-0.1716], [-0.5787], [-0.2765], [-0.9623], [-0.4711], [-0.7093], [-0.4671], [-0.9749], [-0.1424], [-0.5049], [-0.3006], [-1.2326], [0]], [[0], [-0.01], [-0.0469], [-0.0162], [-0.0939], [-0.0451], [-0.0685], [-0.0429], [-0.0968], [-0.009], [-0.0525], [-0.0282], [-0.1227], [0]], [[0], [-0.0741], [-0.375], [-0.1194], [-0.7763], [-0.3715], [-0.5653], [-0.3516], [-0.8025], [-0.0679], [-0.4385], [-0.232], [-1.0177], [0.1914]], [[0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0.1928]]]]

Expected: [[[[0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0]], [[0], [-0.1248], [-0.4095], [-0.2011], [-0.667], [-0.3273], [-0.4922], [-0.3261], [-0.6743], [-0.103], [-0.3471], [-0.2093], [-0.8522], [0]], [[0], [-0.2576], [-0.7866], [-0.415], [-1.2076], [-0.5969], [-0.8947], [-0.6029], [-1.213], [-0.2095], [-0.6132], [-0.3841], [-1.5315], [0]], [[0], [-0.0274], [-0.0774], [-0.0441], [-0.1103], [-0.055], [-0.0821], [-0.0566], [-0.1098], [-0.0219], [-0.0541], [-0.0357], [-0.1385], [0]], [[0], [-0.2297], [-0.6407], [-0.37], [-0.9018], [-0.4507], [-0.6721], [-0.4649], [-0.8966], [-0.1837], [-0.4399], [-0.293], [-1.1302], [0]], [[0], [-0.12], [-0.3464], [-0.1934], [-0.5045], [-0.251], [-0.3751], [-0.2567], [-0.5037], [-0.0966], [-0.2501], [-0.1625], [-0.6353], [0]], [[0], [-0.1716], [-0.5787], [-0.2765], [-0.9623], [-0.4711], [-0.7093], [-0.4671], [-0.9749], [-0.1424], [-0.5049], [-0.3006], [-1.2326], [0]], [[0], [-0.01], [-0.0469], [-0.0162], [-0.0939], [-0.0451], [-0.0685], [-0.0429], [-0.0968], [-0.009], [-0.0525], [-0.0282], [-0.1227], [0]], [[0], [-0.0741], [-0.375], [-0.1194], [-0.7763], [-0.3715], [-0.5653], [-0.3516], [-0.8025], [-0.0679], [-0.4385], [-0.232], [-1.0177], [0.1914]], [[0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0.1928]]]]