import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min34007 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Min34007 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Con10596 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in0Con77798 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))

Min34007 = keras.layers.Minimum(name = 'Min34007', )([in0Min34007,in1Min34007])
Res94170 = keras.layers.Reshape((2, 2, 1), name = 'Res94170', )(Min34007)
Res30361 = keras.layers.Reshape((2, 2), name = 'Res30361', )(Res94170)
Fla35540 = keras.layers.Flatten(name = 'Fla35540', )(Res30361)
Res61142 = keras.layers.Reshape((4, 1), name = 'Res61142', )(Fla35540)
Res44532 = keras.layers.Reshape((4, 1, 1), name = 'Res44532', )(Res61142)
Glo42530 = keras.layers.GlobalMaxPool2D(name = 'Glo42530', )(Res44532)
Res71757 = keras.layers.Reshape((1, 1), name = 'Res71757', )(Glo42530)
Res50646 = keras.layers.Reshape((1, 1, 1), name = 'Res50646', )(Res71757)
Res21425 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res21425', )(Res50646)
Zer13510 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (1, 0)), name = 'Zer13510', )(Res21425)
Con10596 = keras.layers.Concatenate(axis=4, name = 'Con10596', )([Zer13510,in0Con10596])
Con77798 = keras.layers.Conv3D(3, (1, 1, 1),strides=(6, 2, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con77798', )(in0Con77798)
Bat43845 = keras.layers.BatchNormalization(axis=2, epsilon=0.3997493277382338,  name = 'Bat43845', )(Con77798)
Lea70298 = keras.layers.LeakyReLU(alpha=2.793208794253121, name = 'Lea70298', )(Bat43845)
Mul91712 = keras.layers.Multiply(name = 'Mul91712', )([Con10596,Lea70298])
model = tf.keras.models.Model(inputs=[in0Min34007,in1Min34007,in0Con10596,in0Con77798], outputs=Mul91712)
w = model.get_layer('Con77798').get_weights() 
w[0] = np.array([[[[[0.3712, 0.0218, 0.0732], [0.0569, 0.377, 0.9802]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con77798').set_weights(w) 
w = model.get_layer('Bat43845').get_weights() 
w[0] = np.array([0.1768])
w[1] = np.array([0.0806])
w[2] = np.array([0.0741])
w[3] = np.array([0.8967])
model.get_layer('Bat43845').set_weights(w) 
in0Min34007 = tf.constant([[[[[0.4988]], [[0.7567]]], [[[0.783]], [[0.539]]]]])
in1Min34007 = tf.constant([[[[[0.1983]], [[0.0935]]], [[[0.0469]], [[0.3147]]]]])
in0Con10596 = tf.constant([[[[[0.2845, 0.0764], [0.9597, 0.3713]]]]])
in0Con77798 = tf.constant([[[[[0.1959, 0.8093], [0.9974, 0.4732]], [[0.303, 0.1151], [0.0508, 0.7155]]]]])
print (np.array2string(model.predict([in0Min34007,in1Min34007,in0Con10596,in0Con77798],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul91712.png')

LMin34007 = minimum_layer([[[[[[0.4988]], [[0.7567]]], [[[0.783]], [[0.539]]]]], [[[[[0.1983]], [[0.0935]]], [[[0.0469]], [[0.3147]]]]]], Min34007), 
LRes94170 = reshape_layer(Min34007, [2, 2, 1], Res94170), 
LRes30361 = reshape_layer(Res94170, [2, 2], Res30361), 
LFla35540 = flatten_layer(Res30361, Fla35540), 
LRes61142 = reshape_layer(Fla35540, [4, 1], Res61142), 
LRes44532 = reshape_layer(Res61142, [4, 1, 1], Res44532), 
LGlo42530 = global_max_pool2D_layer(Res44532, Glo42530), 
LRes71757 = reshape_layer(Glo42530, [1, 1], Res71757), 
LRes50646 = reshape_layer(Res71757, [1, 1, 1], Res50646), 
LRes21425 = reshape_layer(Res50646, [1, 1, 1, 1], Res21425), 
LZer13510 = zero_padding3D_layer(Res21425, 0, 0, 0, 0, 1, 0, Zer13510), 
LCon10596 = concatenate_layer([Zer13510,[[[[[0.2845, 0.0764], [0.9597, 0.3713]]]]]], 4, Con10596), 
LCon77798 = conv3D_layer([[[[[0.1959, 0.8093], [0.9974, 0.4732]], [[0.303, 0.1151], [0.0508, 0.7155]]]]], 1, 1, 1,[[[[[0.3712, 0.0218, 0.0732], [0.0569, 0.377, 0.9802]]]]],[0, 0, 0], 6, 2, 1, false, 1, 1, 1, Con77798), 
LBat43845 = batch_normalization_layer(Con77798, 2, 0.3997493277382338, [0.1768], [0.0806], [0.0741], [0.8967], Bat43845), 
LLea70298 = leaky_relu_layer(Bat43845, 2.793208794253121, Lea70298), 
LMul91712 = multiply_layer([Con10596,Lea70298], Mul91712), 
exec_layers([LMin34007,LRes94170,LRes30361,LFla35540,LRes61142,LRes44532,LGlo42530,LRes71757,LRes50646,LRes21425,LZer13510,LCon10596,LCon77798,LBat43845,LLea70298,LMul91712],["Min34007","Res94170","Res30361","Fla35540","Res61142","Res44532","Glo42530","Res71757","Res50646","Res21425","Zer13510","Con10596","Con77798","Bat43845","Lea70298","Mul91712"],Mul91712,"Mul91712")

Actual (Unparsed): [[[[[0.0000000, 0.0333243, 0.0148596], [0.0411513, 0.0961341, 0.0566056]]]]]

Expected (Unparsed): [[[[[0.0,0.033324293206128286,0.014859603653003439],[0.04115126588219839,0.09613406112820776,0.056605609961322086]]]]]

Actual:   [[[[[0, 0.0334, 0.0149], [0.0412, 0.0962, 0.0567]]]]]

Expected: [[[[[0, 0.0334, 0.0149], [0.0412, 0.0962, 0.0567]]]]]