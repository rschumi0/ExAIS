import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub27773 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub27773 = tf.keras.layers.Input(shape=([3, 2]))
in0Add30688 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Add30688 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Glo45186 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Mul42753 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul42753 = tf.keras.layers.Input(shape=([1, 1]))
in0Con94267 = tf.keras.layers.Input(shape=([1, 1]))
in0Con37126 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Dot92199 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot92199 = tf.keras.layers.Input(shape=([3, 2]))
in0Con9191 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Max30668 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Max30668 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Loc40639 = tf.keras.layers.Input(shape=([2, 1, 1]))

Sub27773 = keras.layers.Subtract(name = 'Sub27773', )([in0Sub27773,in1Sub27773])
Add30688 = keras.layers.Add(name = 'Add30688', )([in0Add30688,in1Add30688])
Res43473 = keras.layers.Reshape((1, 2), name = 'Res43473', )(Add30688)
Glo45186 = keras.layers.GlobalMaxPool3D(name = 'Glo45186', )(in0Glo45186)
Res59579 = keras.layers.Reshape((1, 1), name = 'Res59579', )(Glo45186)
Mul42753 = keras.layers.Multiply(name = 'Mul42753', )([in0Mul42753,in1Mul42753])
Ave58099 = keras.layers.Average(name = 'Ave58099', )([Res59579,Mul42753])
Con94267 = keras.layers.Concatenate(axis=2, name = 'Con94267', )([Ave58099,in0Con94267])
Mul68380 = keras.layers.Multiply(name = 'Mul68380', )([Res43473,Con94267])
Zer37040 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer37040', )(Mul68380)
Mul11753 = keras.layers.Multiply(name = 'Mul11753', )([Sub27773,Zer37040])
Res87955 = keras.layers.Reshape((3, 2, 1), name = 'Res87955', )(Mul11753)
Zer36516 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer36516', )(Res87955)
Con37126 = keras.layers.Concatenate(axis=3, name = 'Con37126', )([Zer36516,in0Con37126])
Dot92199 = keras.layers.Dot(axes=(2, 2), name = 'Dot92199', )([in0Dot92199,in1Dot92199])
Res9467 = keras.layers.Reshape((3, 3, 1), name = 'Res9467', )(Dot92199)
Con9191 = keras.layers.Concatenate(axis=3, name = 'Con9191', )([Res9467,in0Con9191])
Max30668 = keras.layers.Maximum(name = 'Max30668', )([in0Max30668,in1Max30668])
Res52169 = keras.layers.Reshape((2, 2, 2), name = 'Res52169', )(Max30668)
Loc40639 = keras.layers.LocallyConnected2D(2, (2, 1),strides=(1, 1), name = 'Loc40639', )(in0Loc40639)
Zer91540 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer91540', )(Loc40639)
Min22049 = keras.layers.Minimum(name = 'Min22049', )([Res52169,Zer91540])
Zer5375 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer5375', )(Min22049)
Mul1176 = keras.layers.Multiply(name = 'Mul1176', )([Con9191,Zer5375])
Add83015 = keras.layers.Add(name = 'Add83015', )([Con37126,Mul1176])
model = tf.keras.models.Model(inputs=[in0Sub27773,in1Sub27773,in0Add30688,in1Add30688,in0Glo45186,in0Mul42753,in1Mul42753,in0Con94267,in0Con37126,in0Dot92199,in1Dot92199,in0Con9191,in0Max30668,in1Max30668,in0Loc40639], outputs=Add83015)
w = model.get_layer('Loc40639').get_weights() 
w[0] = np.array([[[0.4991, 0.5522], [0.9534, 0.4517]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc40639').set_weights(w) 
in0Sub27773 = tf.constant([[[0.9662, 0.5028], [0.3022, 0.776], [0.3148, 0.6032]]])
in1Sub27773 = tf.constant([[[0.2221, 0.3856], [0.7598, 0.3305], [0.7043, 0.5876]]])
in0Add30688 = tf.constant([[[[0.7599, 0.605]]]])
in1Add30688 = tf.constant([[[[0.0311, 0.912]]]])
in0Glo45186 = tf.constant([[[[[1.2385]], [[1.9268]]]]])
in0Mul42753 = tf.constant([[[0.8884]]])
in1Mul42753 = tf.constant([[[0.8862]]])
in0Con94267 = tf.constant([[[0.895]]])
in0Con37126 = tf.constant([[[[0.3505], [0.8161], [0.7733]], [[0.7836], [0.532], [0.2526]], [[0.681], [0.6915], [0.4114]]]])
in0Dot92199 = tf.constant([[[0.2448, 0.8276], [0.977, 0.4081], [0.1519, 0.6118]]])
in1Dot92199 = tf.constant([[[0.0067, 0.4098], [0.972, 0.7455], [0.3229, 0.8159]]])
in0Con9191 = tf.constant([[[[0.0108], [0.0325], [0.2353]], [[0.7074], [0.1688], [0.8333]], [[0.2721], [0.7364], [0.9527]]]])
in0Max30668 = tf.constant([[[[[0.8091, 0.2109]], [[0.6868, 0.7066]]], [[[0.8215, 0.2418]], [[0.4058, 0.155]]]]])
in1Max30668 = tf.constant([[[[[0.3185, 0.1255]], [[0.0944, 0.4216]]], [[[0.7775, 0.1706]], [[0.8348, 0.0653]]]]])
in0Loc40639 = tf.constant([[[[0.6368]], [[0.5173]]]])
print (np.array2string(model.predict([in0Sub27773,in1Sub27773,in0Add30688,in1Add30688,in0Glo45186,in0Mul42753,in1Mul42753,in0Con94267,in0Con37126,in0Dot92199,in1Dot92199,in0Con9191,in0Max30668,in1Max30668,in0Loc40639],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add83015.png')

LSub27773 = subtract_layer([[[0.9662, 0.5028], [0.3022, 0.776], [0.3148, 0.6032]]], [[[0.2221, 0.3856], [0.7598, 0.3305], [0.7043, 0.5876]]], Sub27773), 
LAdd30688 = add_layer([[[[[0.7599, 0.605]]]], [[[[0.0311, 0.912]]]]], Add30688), 
LRes43473 = reshape_layer(Add30688, [1, 2], Res43473), 
LGlo45186 = global_max_pool3D_layer([[[[[1.2385]], [[1.9268]]]]], Glo45186), 
LRes59579 = reshape_layer(Glo45186, [1, 1], Res59579), 
LMul42753 = multiply_layer([[[[0.8884]]], [[[0.8862]]]], Mul42753), 
LAve58099 = average_layer([Res59579,Mul42753], Ave58099), 
LCon94267 = concatenate_layer([Ave58099,[[[0.895]]]], 2, Con94267), 
LMul68380 = multiply_layer([Res43473,Con94267], Mul68380), 
LZer37040 = zero_padding1D_layer(Mul68380, 2, 0, Zer37040), 
LMul11753 = multiply_layer([Sub27773,Zer37040], Mul11753), 
LRes87955 = reshape_layer(Mul11753, [3, 2, 1], Res87955), 
LZer36516 = zero_padding2D_layer(Res87955, 0, 0, 1, 0, Zer36516), 
LCon37126 = concatenate_layer([Zer36516,[[[[0.3505], [0.8161], [0.7733]], [[0.7836], [0.532], [0.2526]], [[0.681], [0.6915], [0.4114]]]]], 3, Con37126), 
LDot92199 = dot_layer([[[0.2448, 0.8276], [0.977, 0.4081], [0.1519, 0.6118]]], [[[0.0067, 0.4098], [0.972, 0.7455], [0.3229, 0.8159]]], 2, 2, Dot92199), 
LRes9467 = reshape_layer(Dot92199, [3, 3, 1], Res9467), 
LCon9191 = concatenate_layer([Res9467,[[[[0.0108], [0.0325], [0.2353]], [[0.7074], [0.1688], [0.8333]], [[0.2721], [0.7364], [0.9527]]]]], 3, Con9191), 
LMax30668 = maximum_layer([[[[[[0.8091, 0.2109]], [[0.6868, 0.7066]]], [[[0.8215, 0.2418]], [[0.4058, 0.155]]]]], [[[[[0.3185, 0.1255]], [[0.0944, 0.4216]]], [[[0.7775, 0.1706]], [[0.8348, 0.0653]]]]]], Max30668), 
LRes52169 = reshape_layer(Max30668, [2, 2, 2], Res52169), 
LLoc40639 = locally_connected2D_layer([[[[0.6368]], [[0.5173]]]], 2, 1,[[[0.4991, 0.5522], [0.9534, 0.4517]]],[[[0, 0]]], 1, 1, Loc40639), 
LZer91540 = zero_padding2D_layer(Loc40639, 1, 0, 1, 0, Zer91540), 
LMin22049 = minimum_layer([Res52169,Zer91540], Min22049), 
LZer5375 = zero_padding2D_layer(Min22049, 1, 0, 1, 0, Zer5375), 
LMul1176 = multiply_layer([Con9191,Zer5375], Mul1176), 
LAdd83015 = add_layer([Con37126,Mul1176], Add83015), 
exec_layers([LSub27773,LAdd30688,LRes43473,LGlo45186,LRes59579,LMul42753,LAve58099,LCon94267,LMul68380,LZer37040,LMul11753,LRes87955,LZer36516,LCon37126,LDot92199,LRes9467,LCon9191,LMax30668,LRes52169,LLoc40639,LZer91540,LMin22049,LZer5375,LMul1176,LAdd83015],["Sub27773","Add30688","Res43473","Glo45186","Res59579","Mul42753","Ave58099","Con94267","Mul68380","Zer37040","Mul11753","Res87955","Zer36516","Con37126","Dot92199","Res9467","Con9191","Max30668","Res52169","Loc40639","Zer91540","Min22049","Zer5375","Mul1176","Add83015"],Add83015,"Add83015")

Actual (Unparsed): [[[[0.0000000, 0.3505000], [0.0000000, 0.8161000], [0.0000000, 0.7733000]], [[0.0000000, 0.7836000], [0.0000000, 0.5320000], [0.0000000, 0.2526000]], [[0.0000000, 0.6810000], [-0.4180996, 0.6915000], [0.4657950, 0.5590685]]]]

Expected (Unparsed): [[[[0.0,0.3505],[0.0,0.8161],[0.0,0.7733]],[[0.0,0.7836],[0.0,0.532],[0.0,0.2526]],[[0.0,0.681],[-0.4180996535487801,0.6915],[0.4657949835038909,0.5590685]]]]

Actual:   [[[[0, 0.3505], [0, 0.8161], [0, 0.7733]], [[0, 0.7836], [0, 0.532], [0, 0.2526]], [[0, 0.681], [-0.418, 0.6915], [0.4658, 0.5591]]]]

Expected: [[[[0, 0.3505], [0, 0.8161], [0, 0.7733]], [[0, 0.7836], [0, 0.532], [0, 0.2526]], [[0, 0.681], [-0.418, 0.6915], [0.4658, 0.5591]]]]