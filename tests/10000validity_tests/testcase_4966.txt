import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min6192 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Min6192 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Dot48334 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot48334 = tf.keras.layers.Input(shape=([2, 2]))
in0Sep27322 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con83315 = tf.keras.layers.Input(shape=([3]))

Min6192 = keras.layers.Minimum(name = 'Min6192', )([in0Min6192,in1Min6192])
Lay38618 = keras.layers.LayerNormalization(axis=1, epsilon=2.1775896184855177, name = 'Lay38618', )(Min6192)
Res60045 = keras.layers.Reshape((1, 2, 2), name = 'Res60045', )(Lay38618)
Dot48334 = keras.layers.Dot(axes=(2, 1), name = 'Dot48334', )([in0Dot48334,in1Dot48334])
Res29380 = keras.layers.Reshape((1, 2, 2), name = 'Res29380', )(Dot48334)
Max53456 = keras.layers.Maximum(name = 'Max53456', )([Res60045,Res29380])
Res36379 = keras.layers.Reshape((1, 4), name = 'Res36379', )(Max53456)
Fla58 = keras.layers.Flatten(name = 'Fla58', )(Res36379)
Sep27322 = keras.layers.SeparableConv2D(4, (1, 1),strides=(1, 1), padding='valid', name = 'Sep27322', )(in0Sep27322)
Res2828 = keras.layers.Reshape((1, 8), name = 'Res2828', )(Sep27322)
GRU73685 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU73685', )(Res2828)
Con83315 = keras.layers.Concatenate(axis=1, name = 'Con83315', )([GRU73685,in0Con83315])
Mul73997 = keras.layers.Multiply(name = 'Mul73997', )([Fla58,Con83315])
model = tf.keras.models.Model(inputs=[in0Min6192,in1Min6192,in0Dot48334,in1Dot48334,in0Sep27322,in0Con83315], outputs=Mul73997)
w = model.get_layer('Sep27322').get_weights() 
w[0] = np.array([[[[0.8917], [0.7488]]]])
w[1] = np.array([[[[0.8625, 0.7992, 0.5984, 0.8284], [0.2343, 0.6824, 0.9284, 0.6755]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep27322').set_weights(w) 
w = model.get_layer('GRU73685').get_weights() 
w[0] = np.array([[7, 6, 6], [6, 4, 3], [6, 9, 10], [3, 4, 8], [4, 6, 2], [9, 9, 2], [10, 2, 2], [3, 8, 5]])
w[1] = np.array([[1, 1, 5]])
w[2] = np.array([[9, 6, 9], [2, 8, 7]])
model.get_layer('GRU73685').set_weights(w) 
in0Min6192 = tf.constant([[[[[0.271, 0.5167]], [[0.2176, 0.5026]]]]])
in1Min6192 = tf.constant([[[[[0.4405, 0.1249]], [[0.4617, 0.0555]]]]])
in0Dot48334 = tf.constant([[[0.9209, 0.6381], [0.8673, 0.3999]]])
in1Dot48334 = tf.constant([[[0.0647, 0.0244], [0.2928, 0.0318]]])
in0Sep27322 = tf.constant([[[[0.8575, 0.8035], [0.6269, 0.7102]]]])
in0Con83315 = tf.constant([[0.955, 0.3923, 0.8117]])
print (np.array2string(model.predict([in0Min6192,in1Min6192,in0Dot48334,in1Dot48334,in0Sep27322,in0Con83315],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul73997.png')

LMin6192 = minimum_layer([[[[[[0.271, 0.5167]], [[0.2176, 0.5026]]]]], [[[[[0.4405, 0.1249]], [[0.4617, 0.0555]]]]]], Min6192), 
LLay38618 = layer_normalization_layer(Min6192, 1, 2.1775896184855177, Lay38618), 
LRes60045 = reshape_layer(Lay38618, [1, 2, 2], Res60045), 
LDot48334 = dot_layer([[[0.9209, 0.6381], [0.8673, 0.3999]]], [[[0.0647, 0.0244], [0.2928, 0.0318]]], 2, 1, Dot48334), 
LRes29380 = reshape_layer(Dot48334, [1, 2, 2], Res29380), 
LMax53456 = maximum_layer([Res60045,Res29380], Max53456), 
LRes36379 = reshape_layer(Max53456, [1, 4], Res36379), 
LFla58 = flatten_layer(Res36379, Fla58), 
LSep27322 = separable_conv2D_layer([[[[0.8575, 0.8035], [0.6269, 0.7102]]]], 1, 1,[[[[[0.8917], [0.7488]]]],[[[[0.8625, 0.7992, 0.5984, 0.8284], [0.2343, 0.6824, 0.9284, 0.6755]]]]],[0, 0, 0, 0], 1, 1, false, Sep27322), 
LRes2828 = reshape_layer(Sep27322, [1, 8], Res2828), 
LGRU73685 = gru_layer(Res2828,[[7, 6, 6], [6, 4, 3], [6, 9, 10], [3, 4, 8], [4, 6, 2], [9, 9, 2], [10, 2, 2], [3, 8, 5]],[[1, 1, 5]],[[9, 6, 9], [2, 8, 7]], true, GRU73685), 
LCon83315 = concatenate_layer([GRU73685,[[0.955, 0.3923, 0.8117]]], 1, Con83315), 
LMul73997 = multiply_layer([Fla58,Con83315], Mul73997), 
exec_layers([LMin6192,LLay38618,LRes60045,LDot48334,LRes29380,LMax53456,LRes36379,LFla58,LSep27322,LRes2828,LGRU73685,LCon83315,LMul73997],["Min6192","Lay38618","Res60045","Dot48334","Res29380","Max53456","Res36379","Fla58","Sep27322","Res2828","GRU73685","Con83315","Mul73997"],Mul73997,"Mul73997")

Actual (Unparsed): [[0.0000000, 0.0408373, 0.0679483, 0.0274995]]

Expected (Unparsed): [[0.0,0.0408372707,0.06794833326899999,0.027499535597999995]]

Actual:   [[0, 0.0409, 0.068, 0.0275]]

Expected: [[0, 0.0409, 0.068, 0.0275]]