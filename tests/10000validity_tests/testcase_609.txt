import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave53685 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave53685 = tf.keras.layers.Input(shape=([2, 2]))
in0Add50048 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Add50048 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Mul93077 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul93077 = tf.keras.layers.Input(shape=([1, 1]))

Ave53685 = keras.layers.Average(name = 'Ave53685', )([in0Ave53685,in1Ave53685])
GRU7152 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU7152', )(Ave53685)
Res23175 = keras.layers.Reshape((3, 1), name = 'Res23175', )(GRU7152)
Add50048 = keras.layers.Add(name = 'Add50048', )([in0Add50048,in1Add50048])
Res1876 = keras.layers.Reshape((1, 4), name = 'Res1876', )(Add50048)
GRU21668 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU21668', )(Res1876)
Res24608 = keras.layers.Reshape((1, 1), name = 'Res24608', )(GRU21668)
Mul93077 = keras.layers.Multiply(name = 'Mul93077', )([in0Mul93077,in1Mul93077])
Thr28536 = keras.layers.ThresholdedReLU(theta=0.2070902838212277, name = 'Thr28536', )(Mul93077)
Dot69699 = keras.layers.Dot(axes=(2, 2), name = 'Dot69699', )([Res24608,Thr28536])
Zer65418 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer65418', )(Dot69699)
Max17921 = keras.layers.Maximum(name = 'Max17921', )([Res23175,Zer65418])
model = tf.keras.models.Model(inputs=[in0Ave53685,in1Ave53685,in0Add50048,in1Add50048,in0Mul93077,in1Mul93077], outputs=Max17921)
w = model.get_layer('GRU7152').get_weights() 
w[0] = np.array([[2, 1, 4, 4, 8, 7, 4, 10, 8], [4, 8, 7, 7, 10, 3, 10, 3, 8]])
w[1] = np.array([[5, 3, 2, 6, 3, 5, 9, 8, 2], [7, 10, 1, 10, 9, 10, 6, 6, 1], [8, 5, 1, 8, 4, 9, 10, 9, 9]])
w[2] = np.array([[10, 3, 7, 6, 7, 7, 3, 6, 2], [6, 3, 9, 1, 4, 3, 10, 1, 6]])
model.get_layer('GRU7152').set_weights(w) 
w = model.get_layer('GRU21668').get_weights() 
w[0] = np.array([[10, 10, 4], [6, 5, 9], [6, 4, 5], [6, 7, 6]])
w[1] = np.array([[6, 5, 2]])
w[2] = np.array([2, 1, 6])
model.get_layer('GRU21668').set_weights(w) 
in0Ave53685 = tf.constant([[[0.8728, 0.8191], [0.5173, 0.6018]]])
in1Ave53685 = tf.constant([[[0.3023, 0.5159], [0.9883, 0.5795]]])
in0Add50048 = tf.constant([[[[0.2117, 0.284], [0.5816, 0.9239]]]])
in1Add50048 = tf.constant([[[[0.394, 0.2448], [0.4733, 0.2043]]]])
in0Mul93077 = tf.constant([[[0.9926]]])
in1Mul93077 = tf.constant([[[0.7254]]])
print (np.array2string(model.predict([in0Ave53685,in1Ave53685,in0Add50048,in1Add50048,in0Mul93077,in1Mul93077],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max17921.png')

LAve53685 = average_layer([[[[0.8728, 0.8191], [0.5173, 0.6018]]], [[[0.3023, 0.5159], [0.9883, 0.5795]]]], Ave53685), 
LGRU7152 = gru_layer(Ave53685,[[2, 1, 4, 4, 8, 7, 4, 10, 8], [4, 8, 7, 7, 10, 3, 10, 3, 8]],[[5, 3, 2, 6, 3, 5, 9, 8, 2], [7, 10, 1, 10, 9, 10, 6, 6, 1], [8, 5, 1, 8, 4, 9, 10, 9, 9]],[[10, 3, 7, 6, 7, 7, 3, 6, 2], [6, 3, 9, 1, 4, 3, 10, 1, 6]], true, GRU7152), 
LRes23175 = reshape_layer(GRU7152, [3, 1], Res23175), 
LAdd50048 = add_layer([[[[[0.2117, 0.284], [0.5816, 0.9239]]]], [[[[0.394, 0.2448], [0.4733, 0.2043]]]]], Add50048), 
LRes1876 = reshape_layer(Add50048, [1, 4], Res1876), 
LGRU21668 = gru_layer(Res1876,[[10, 10, 4], [6, 5, 9], [6, 4, 5], [6, 7, 6]],[[6, 5, 2]],[2, 1, 6], false, GRU21668), 
LRes24608 = reshape_layer(GRU21668, [1, 1], Res24608), 
LMul93077 = multiply_layer([[[[0.9926]]], [[[0.7254]]]], Mul93077), 
LThr28536 = thresholded_relu_layer(Mul93077, 0.2070902838212277, Thr28536), 
LDot69699 = dot_layer(Res24608,Thr28536, 2, 2, Dot69699), 
LZer65418 = zero_padding1D_layer(Dot69699, 2, 0, Zer65418), 
LMax17921 = maximum_layer([Res23175,Zer65418], Max17921), 
exec_layers([LAve53685,LGRU7152,LRes23175,LAdd50048,LRes1876,LGRU21668,LRes24608,LMul93077,LThr28536,LDot69699,LZer65418,LMax17921],["Ave53685","GRU7152","Res23175","Add50048","Res1876","GRU21668","Res24608","Mul93077","Thr28536","Dot69699","Zer65418","Max17921"],Max17921,"Max17921")

Actual (Unparsed): [[[0.0000000], [0.0000170], [0.0000000]]]

Expected (Unparsed): [[[4.7579020666689745e-9],[1.69604044581052e-5],[1.8901591402274467e-10]]]

Actual:   [[[0], [0.0001], [0]]]

Expected: [[[0], [0.0001], [0]]]