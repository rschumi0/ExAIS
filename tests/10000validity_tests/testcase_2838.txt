import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave27129 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Ave27129 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con72154 = tf.keras.layers.Input(shape=([2, 2]))
in0PRe4564 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Add69171 = tf.keras.layers.Input(shape=([2, 2]))
in1Add69171 = tf.keras.layers.Input(shape=([2, 2]))
in0Con10296 = tf.keras.layers.Input(shape=([2, 1]))

Ave27129 = keras.layers.Average(name = 'Ave27129', )([in0Ave27129,in1Ave27129])
Up_27537 = keras.layers.UpSampling2D(size=(1, 2), name = 'Up_27537', )(Ave27129)
Cro94405 = keras.layers.Cropping2D(cropping=((0, 0), (2, 1)), name = 'Cro94405', )(Up_27537)
Glo42872 = keras.layers.GlobalMaxPool2D(name = 'Glo42872', )(Cro94405)
Res38488 = keras.layers.Reshape((2, 1), name = 'Res38488', )(Glo42872)
Con72154 = keras.layers.Concatenate(axis=2, name = 'Con72154', )([Res38488,in0Con72154])
PRe4564 = keras.layers.PReLU(name = 'PRe4564', input_shape=(1, 1, 1))(in0PRe4564)
Res47489 = keras.layers.Reshape((1, 1), name = 'Res47489', )(PRe4564)
Sim40866 = keras.layers.SimpleRNN(3,name = 'Sim40866', )(Res47489)
Res51331 = keras.layers.Reshape((3, 1), name = 'Res51331', )(Sim40866)
Per17609 = keras.layers.Permute((2,1), name = 'Per17609',)(Res51331)
Zer40095 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer40095', )(Per17609)
Add69171 = keras.layers.Add(name = 'Add69171', )([in0Add69171,in1Add69171])
Con10296 = keras.layers.Concatenate(axis=2, name = 'Con10296', )([Add69171,in0Con10296])
Ave33494 = keras.layers.Average(name = 'Ave33494', )([Zer40095,Con10296])
Max58036 = keras.layers.Maximum(name = 'Max58036', )([Con72154,Ave33494])
model = tf.keras.models.Model(inputs=[in0Ave27129,in1Ave27129,in0Con72154,in0PRe4564,in0Add69171,in1Add69171,in0Con10296], outputs=Max58036)
w = model.get_layer('PRe4564').get_weights() 
w[0] = np.array([[[0.9289]]])
model.get_layer('PRe4564').set_weights(w) 
w = model.get_layer('Sim40866').get_weights() 
w[0] = np.array([[8, 5, 4]])
w[1] = np.array([[10, 6, 10], [2, 5, 3], [9, 3, 7]])
w[2] = np.array([4, 8, 5])
model.get_layer('Sim40866').set_weights(w) 
in0Ave27129 = tf.constant([[[[0.666, 0.4158], [0.9611, 0.1195]]]])
in1Ave27129 = tf.constant([[[[0.8581, 0.3748], [0.5455, 0.6043]]]])
in0Con72154 = tf.constant([[[0.2115, 0.069], [0.1888, 0.0724]]])
in0PRe4564 = tf.constant([[[[0.4068]]]])
in0Add69171 = tf.constant([[[0.3808, 0.0115], [0.3387, 0.1266]]])
in1Add69171 = tf.constant([[[0.2498, 0.6764], [0.293, 0.1827]]])
in0Con10296 = tf.constant([[[0.3321], [0.454]]])
print (np.array2string(model.predict([in0Ave27129,in1Ave27129,in0Con72154,in0PRe4564,in0Add69171,in1Add69171,in0Con10296],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max58036.png')

LAve27129 = average_layer([[[[[0.666, 0.4158], [0.9611, 0.1195]]]], [[[[0.8581, 0.3748], [0.5455, 0.6043]]]]], Ave27129), 
LUp_27537 = up_sampling2D_layer(Ave27129, 1, 2, Up_27537), 
LCro94405 = cropping2D_layer(Up_27537, 0, 0, 2, 1, Cro94405), 
LGlo42872 = global_max_pool2D_layer(Cro94405, Glo42872), 
LRes38488 = reshape_layer(Glo42872, [2, 1], Res38488), 
LCon72154 = concatenate_layer([Res38488,[[[0.2115, 0.069], [0.1888, 0.0724]]]], 2, Con72154), 
LPRe4564 = prelu_layer([[[[0.4068]]]], [[[0.9289]]], PRe4564), 
LRes47489 = reshape_layer(PRe4564, [1, 1], Res47489), 
LSim40866 = simple_rnn_layer(Res47489,[[8, 5, 4]],[[10, 6, 10], [2, 5, 3], [9, 3, 7]],[4, 8, 5], Sim40866), 
LRes51331 = reshape_layer(Sim40866, [3, 1], Res51331), 
LPer17609 = permute_layer(Res51331, 2,1, Per17609), 
LZer40095 = zero_padding1D_layer(Per17609, 1, 0, Zer40095), 
LAdd69171 = add_layer([[[[0.3808, 0.0115], [0.3387, 0.1266]]], [[[0.2498, 0.6764], [0.293, 0.1827]]]], Add69171), 
LCon10296 = concatenate_layer([Add69171,[[[0.3321], [0.454]]]], 2, Con10296), 
LAve33494 = average_layer([Zer40095,Con10296], Ave33494), 
LMax58036 = maximum_layer([Con72154,Ave33494], Max58036), 
exec_layers([LAve27129,LUp_27537,LCro94405,LGlo42872,LRes38488,LCon72154,LPRe4564,LRes47489,LSim40866,LRes51331,LPer17609,LZer40095,LAdd69171,LCon10296,LAve33494,LMax58036],["Ave27129","Up_27537","Cro94405","Glo42872","Res38488","Con72154","PRe4564","Res47489","Sim40866","Res51331","Per17609","Zer40095","Add69171","Con10296","Ave33494","Max58036"],Max58036,"Max58036")

Actual (Unparsed): [[[0.7533000, 0.3439500, 0.1660500], [0.8158495, 0.6546500, 0.7269982]]]

Expected (Unparsed): [[[0.7533,0.34395,0.16605],[0.8158495000713756,0.6546499980743457,0.7269982473852681]]]

Actual:   [[[0.7533, 0.344, 0.1661], [0.8159, 0.6547, 0.727]]]

Expected: [[[0.7533, 0.344, 0.1661], [0.8159, 0.6547, 0.727]]]