import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max72807 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Max72807 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Zer3222 = tf.keras.layers.Input(shape=([1, 4, 1]))
in0LST66633 = tf.keras.layers.Input(shape=([2, 2]))
in0Con69379 = tf.keras.layers.Input(shape=([3, 1]))
in0Sub93070 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub93070 = tf.keras.layers.Input(shape=([2, 2]))
in0Con69976 = tf.keras.layers.Input(shape=([3, 4]))

Max72807 = keras.layers.Maximum(name = 'Max72807', )([in0Max72807,in1Max72807])
Zer97262 = keras.layers.ZeroPadding2D(padding=((2, 0), (5, 0)), name = 'Zer97262', )(Max72807)
Zer3222 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer3222', )(in0Zer3222)
Ave34699 = keras.layers.Average(name = 'Ave34699', )([Zer97262,Zer3222])
Res7347 = keras.layers.Reshape((3, 6), name = 'Res7347', )(Ave34699)
LST66633 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST66633', )(in0LST66633)
Res66965 = keras.layers.Reshape((3, 1), name = 'Res66965', )(LST66633)
Res43024 = keras.layers.Reshape((3, 1, 1), name = 'Res43024', )(Res66965)
Res83043 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res83043', )(Res43024)
Cro72024 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro72024', )(Res83043)
Res60282 = keras.layers.Reshape((3, 1, 1), name = 'Res60282', )(Cro72024)
Res90845 = keras.layers.Reshape((3, 1), name = 'Res90845', )(Res60282)
Con69379 = keras.layers.Concatenate(axis=2, name = 'Con69379', )([Res90845,in0Con69379])
Sub93070 = keras.layers.Subtract(name = 'Sub93070', )([in0Sub93070,in1Sub93070])
Dot59256 = keras.layers.Dot(axes=(2, 2), name = 'Dot59256', )([Con69379,Sub93070])
Con69976 = keras.layers.Concatenate(axis=2, name = 'Con69976', )([Dot59256,in0Con69976])
Mul34283 = keras.layers.Multiply(name = 'Mul34283', )([Res7347,Con69976])
Res17827 = keras.layers.Reshape((3, 6, 1), name = 'Res17827', )(Mul34283)
Con12791 = keras.layers.Conv2D(3, (2, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con12791', )(Res17827)
model = tf.keras.models.Model(inputs=[in0Max72807,in1Max72807,in0Zer3222,in0LST66633,in0Con69379,in0Sub93070,in1Sub93070,in0Con69976], outputs=Con12791)
w = model.get_layer('LST66633').get_weights() 
w[0] = np.array([[7, 10, 4, 8, 2, 3, 2, 9, 9, 2, 6, 9], [3, 2, 10, 5, 1, 3, 9, 3, 7, 7, 6, 6]])
w[1] = np.array([[9, 9, 10, 1, 3, 6, 3, 10, 8, 1, 9, 7], [9, 1, 7, 10, 6, 7, 3, 7, 8, 7, 8, 4], [1, 4, 6, 6, 3, 4, 10, 2, 9, 9, 9, 3]])
w[2] = np.array([10, 8, 1, 1, 8, 1, 1, 8, 7, 6, 9, 9])
model.get_layer('LST66633').set_weights(w) 
w = model.get_layer('Con12791').get_weights() 
w[0] = np.array([[[[0.3368, 0.3806, 0.1653]]], [[[0.6211, 0.5993, 0.8823]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con12791').set_weights(w) 
in0Max72807 = tf.constant([[[[0.817]]]])
in1Max72807 = tf.constant([[[[0.7814]]]])
in0Zer3222 = tf.constant([[[[1.5779], [1.9694], [1.3781], [1.6604]]]])
in0LST66633 = tf.constant([[[8, 6], [2, 9]]])
in0Con69379 = tf.constant([[[0.5964], [0.84], [0.194]]])
in0Sub93070 = tf.constant([[[0.3757, 0.0203], [0.4816, 0.7721]]])
in1Sub93070 = tf.constant([[[0.0483, 0.0909], [0.4994, 0.1941]]])
in0Con69976 = tf.constant([[[0.4322, 0.386, 0.8061, 0.2913], [0.3805, 0.109, 0.9103, 0.3971], [0.7615, 0.8869, 0.6144, 0.44]]])
print (np.array2string(model.predict([in0Max72807,in1Max72807,in0Zer3222,in0LST66633,in0Con69379,in0Sub93070,in1Sub93070,in0Con69976],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con12791.png')

LMax72807 = maximum_layer([[[[[0.817]]]], [[[[0.7814]]]]], Max72807), 
LZer97262 = zero_padding2D_layer(Max72807, 2, 0, 5, 0, Zer97262), 
LZer3222 = zero_padding2D_layer([[[[1.5779], [1.9694], [1.3781], [1.6604]]]], 1, 1, 1, 1, Zer3222), 
LAve34699 = average_layer([Zer97262,Zer3222], Ave34699), 
LRes7347 = reshape_layer(Ave34699, [3, 6], Res7347), 
LLST66633 = lstm_layer([[[8, 6], [2, 9]]],[[7, 10, 4, 8, 2, 3, 2, 9, 9, 2, 6, 9], [3, 2, 10, 5, 1, 3, 9, 3, 7, 7, 6, 6]],[[9, 9, 10, 1, 3, 6, 3, 10, 8, 1, 9, 7], [9, 1, 7, 10, 6, 7, 3, 7, 8, 7, 8, 4], [1, 4, 6, 6, 3, 4, 10, 2, 9, 9, 9, 3]],[10, 8, 1, 1, 8, 1, 1, 8, 7, 6, 9, 9], LST66633), 
LRes66965 = reshape_layer(LST66633, [3, 1], Res66965), 
LRes43024 = reshape_layer(Res66965, [3, 1, 1], Res43024), 
LRes83043 = reshape_layer(Res43024, [3, 1, 1, 1], Res83043), 
LCro72024 = cropping3D_layer(Res83043, 0, 0, 0, 0, 0, 0, Cro72024), 
LRes60282 = reshape_layer(Cro72024, [3, 1, 1], Res60282), 
LRes90845 = reshape_layer(Res60282, [3, 1], Res90845), 
LCon69379 = concatenate_layer([Res90845,[[[0.5964], [0.84], [0.194]]]], 2, Con69379), 
LSub93070 = subtract_layer([[[0.3757, 0.0203], [0.4816, 0.7721]]], [[[0.0483, 0.0909], [0.4994, 0.1941]]], Sub93070), 
LDot59256 = dot_layer(Con69379,Sub93070, 2, 2, Dot59256), 
LCon69976 = concatenate_layer([Dot59256,[[[0.4322, 0.386, 0.8061, 0.2913], [0.3805, 0.109, 0.9103, 0.3971], [0.7615, 0.8869, 0.6144, 0.44]]]], 2, Con69976), 
LMul34283 = multiply_layer([Res7347,Con69976], Mul34283), 
LRes17827 = reshape_layer(Mul34283, [3, 6, 1], Res17827), 
LCon12791 = conv2D_layer(Res17827, 2, 1,[[[[0.3368, 0.3806, 0.1653]]], [[[0.6211, 0.5993, 0.8823]]]],[0, 0, 0], 1, 1, false, 1, 1, Con12791), 
exec_layers([LMax72807,LZer97262,LZer3222,LAve34699,LRes7347,LLST66633,LRes66965,LRes43024,LRes83043,LCro72024,LRes60282,LRes90845,LCon69379,LSub93070,LDot59256,LCon69976,LMul34283,LRes17827,LCon12791],["Max72807","Zer97262","Zer3222","Ave34699","Res7347","LST66633","Res66965","Res43024","Res83043","Cro72024","Res60282","Res90845","Con69379","Sub93070","Dot59256","Con69976","Mul34283","Res17827","Con12791"],Con12791,"Con12791")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000000], [0.2295044, 0.2214490, 0.3260212], [0.2327127, 0.2245447, 0.3305787], [0.0466486, 0.0450113, 0.0662664], [0.4693846, 0.4529096, 0.6667815], [0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000], [0.1244519, 0.1406366, 0.0610805], [0.1261917, 0.1426026, 0.0619343], [0.0252959, 0.0285855, 0.0124151], [0.2545302, 0.2876313, 0.1249223], [0.1116365, 0.1077182, 0.1585846]]]]

Expected (Unparsed): [[[[0.0,0.0,0.0],[0.22950444097598516,0.22144906050057625,0.32602120153455433],[0.232712723185,0.224544735155,0.33057870820499996],[0.046648616095000005,0.045011295485000005,0.066266420835],[0.469384561366,0.452909624258,0.666781514238],[0.0,0.0,0.0]],[[0.0,0.0,0.0],[0.12445193321640927,0.140636596740396,0.061080476724086855],[0.12619166828,0.14260258001,0.061934331255],[0.02529585236,0.028585514870000002,0.012415096185000002],[0.254530221008,0.287631241436,0.124922344218],[0.11163651399999999,0.107718182,0.158584602]]]]

Actual:   [[[[0, 0, 0], [0.2296, 0.2215, 0.3261], [0.2328, 0.2246, 0.3306], [0.0467, 0.0451, 0.0663], [0.4694, 0.453, 0.6668], [0, 0, 0]], [[0, 0, 0], [0.1245, 0.1407, 0.0611], [0.1262, 0.1427, 0.062], [0.0253, 0.0286, 0.0125], [0.2546, 0.2877, 0.125], [0.1117, 0.1078, 0.1586]]]]

Expected: [[[[0, 0, 0], [0.2296, 0.2215, 0.3261], [0.2328, 0.2246, 0.3306], [0.0467, 0.0451, 0.0663], [0.4694, 0.453, 0.6668], [0, 0, 0]], [[0, 0, 0], [0.1245, 0.1407, 0.0611], [0.1262, 0.1427, 0.062], [0.0253, 0.0286, 0.0125], [0.2546, 0.2877, 0.125], [0.1117, 0.1078, 0.1586]]]]