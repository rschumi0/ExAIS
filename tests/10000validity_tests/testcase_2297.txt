import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add95380 = tf.keras.layers.Input(shape=([2, 1]))
in1Add95380 = tf.keras.layers.Input(shape=([2, 1]))
in0Con72510 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in0Con64936 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Max47860 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Max47860 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0ReL88616 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Con24336 = tf.keras.layers.Input(shape=([4, 4]))

Add95380 = keras.layers.Add(name = 'Add95380', )([in0Add95380,in1Add95380])
Max79524 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='same', name = 'Max79524', )(Add95380)
Res88983 = keras.layers.Reshape((2, 1, 1), name = 'Res88983', )(Max79524)
Res68032 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res68032', )(Res88983)
Zer49134 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (1, 0)), name = 'Zer49134', )(Res68032)
Con72510 = keras.layers.Concatenate(axis=4, name = 'Con72510', )([Zer49134,in0Con72510])
Con64936 = keras.layers.Conv3D(3, (2, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con64936', )(in0Con64936)
Max68530 = keras.layers.Maximum(name = 'Max68530', )([Con72510,Con64936])
Res42821 = keras.layers.Reshape((2, 1, 6), name = 'Res42821', )(Max68530)
Res84669 = keras.layers.Reshape((2, 6), name = 'Res84669', )(Res42821)
Zer1876 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer1876', )(Res84669)
Max47860 = keras.layers.Maximum(name = 'Max47860', )([in0Max47860,in1Max47860])
Res62594 = keras.layers.Reshape((2, 2, 2), name = 'Res62594', )(Max47860)
Res39498 = keras.layers.Reshape((2, 4), name = 'Res39498', )(Res62594)
ReL88616 = keras.layers.ReLU(max_value=6.475289968545076, negative_slope=0.7631318300748048, threshold=3.5162137761813526, name = 'ReL88616', input_shape=(2, 1, 1, 2))(in0ReL88616)
Res69632 = keras.layers.Reshape((2, 1, 2), name = 'Res69632', )(ReL88616)
Res36292 = keras.layers.Reshape((2, 2), name = 'Res36292', )(Res69632)
Dot62528 = keras.layers.Dot(axes=(1, 1), name = 'Dot62528', )([Res39498,Res36292])
ReL53345 = keras.layers.ReLU(max_value=7.5260373976521295, negative_slope=7.062745646775957, threshold=0.5143193196139895, name = 'ReL53345', )(Dot62528)
Con24336 = keras.layers.Concatenate(axis=2, name = 'Con24336', )([ReL53345,in0Con24336])
Ave88338 = keras.layers.Average(name = 'Ave88338', )([Zer1876,Con24336])
model = tf.keras.models.Model(inputs=[in0Add95380,in1Add95380,in0Con72510,in0Con64936,in0Max47860,in1Max47860,in0ReL88616,in0Con24336], outputs=Ave88338)
w = model.get_layer('Con64936').get_weights() 
w[0] = np.array([[[[[0.4083, 0.7854, 0.2823]]]], [[[[0.7669, 0.3136, 0.7634]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con64936').set_weights(w) 
in0Add95380 = tf.constant([[[0.8964], [0.7607]]])
in1Add95380 = tf.constant([[[0.5748], [0.5286]]])
in0Con72510 = tf.constant([[[[[0.9952, 0.6627], [0.2103, 0.104]]], [[[0.3971, 0.2366], [0.0062, 0.253]]]]])
in0Con64936 = tf.constant([[[[[0.6863], [0.5865]]], [[[0.1857], [0.3106]]]]])
in0Max47860 = tf.constant([[[[[0.8503], [0.455]], [[0.5904], [0.8101]]], [[[0.6348], [0.5298]], [[0.2613], [0.272]]]]])
in1Max47860 = tf.constant([[[[[0.4431], [0.711]], [[0.6012], [0.2428]]], [[[0.6795], [0.1978]], [[0.0145], [0.0872]]]]])
in0ReL88616 = tf.constant([[[[[0.1887, 0.1276]]], [[[0.9177, 0.9034]]]]])
in0Con24336 = tf.constant([[[0.1039, 0.2779, 0.2086, 0.3637], [0.9271, 0.0019, 0.3936, 0.4052], [0.6391, 0.5282, 0.6103, 0.9224], [0.2536, 0.9553, 0.3048, 0.9009]]])
print (np.array2string(model.predict([in0Add95380,in1Add95380,in0Con72510,in0Con64936,in0Max47860,in1Max47860,in0ReL88616,in0Con24336],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave88338.png')

LAdd95380 = add_layer([[[[0.8964], [0.7607]]], [[[0.5748], [0.5286]]]], Add95380), 
LMax79524 = max_pool1D_layer(Add95380, 1, 1, true, Max79524), 
LRes88983 = reshape_layer(Max79524, [2, 1, 1], Res88983), 
LRes68032 = reshape_layer(Res88983, [2, 1, 1, 1], Res68032), 
LZer49134 = zero_padding3D_layer(Res68032, 0, 0, 0, 0, 1, 0, Zer49134), 
LCon72510 = concatenate_layer([Zer49134,[[[[[0.9952, 0.6627], [0.2103, 0.104]]], [[[0.3971, 0.2366], [0.0062, 0.253]]]]]], 4, Con72510), 
LCon64936 = conv3D_layer([[[[[0.6863], [0.5865]]], [[[0.1857], [0.3106]]]]], 2, 1, 1,[[[[[0.4083, 0.7854, 0.2823]]]], [[[[0.7669, 0.3136, 0.7634]]]]],[0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con64936), 
LMax68530 = maximum_layer([Con72510,Con64936], Max68530), 
LRes42821 = reshape_layer(Max68530, [2, 1, 6], Res42821), 
LRes84669 = reshape_layer(Res42821, [2, 6], Res84669), 
LZer1876 = zero_padding1D_layer(Res84669, 2, 0, Zer1876), 
LMax47860 = maximum_layer([[[[[[0.8503], [0.455]], [[0.5904], [0.8101]]], [[[0.6348], [0.5298]], [[0.2613], [0.272]]]]], [[[[[0.4431], [0.711]], [[0.6012], [0.2428]]], [[[0.6795], [0.1978]], [[0.0145], [0.0872]]]]]], Max47860), 
LRes62594 = reshape_layer(Max47860, [2, 2, 2], Res62594), 
LRes39498 = reshape_layer(Res62594, [2, 4], Res39498), 
LReL88616 = relu_layer([[[[[0.1887, 0.1276]]], [[[0.9177, 0.9034]]]]], 6.475289968545076, 0.7631318300748048, 3.5162137761813526, ReL88616), 
LRes69632 = reshape_layer(ReL88616, [2, 1, 2], Res69632), 
LRes36292 = reshape_layer(Res69632, [2, 2], Res36292), 
LDot62528 = dot_layer(Res39498,Res36292, 1, 1, Dot62528), 
LReL53345 = relu_layer(Dot62528, 7.5260373976521295, 7.062745646775957, 0.5143193196139895, ReL53345), 
LCon24336 = concatenate_layer([ReL53345,[[[0.1039, 0.2779, 0.2086, 0.3637], [0.9271, 0.0019, 0.3936, 0.4052], [0.6391, 0.5282, 0.6103, 0.9224], [0.2536, 0.9553, 0.3048, 0.9009]]]], 2, Con24336), 
LAve88338 = average_layer([Zer1876,Con24336], Ave88338), 
exec_layers([LAdd95380,LMax79524,LRes88983,LRes68032,LZer49134,LCon72510,LCon64936,LMax68530,LRes42821,LRes84669,LZer1876,LMax47860,LRes62594,LRes39498,LReL88616,LRes69632,LRes36292,LDot62528,LReL53345,LCon24336,LAve88338],["Add95380","Max79524","Res88983","Res68032","Zer49134","Con72510","Con64936","Max68530","Res42821","Res84669","Zer1876","Max47860","Res62594","Res39498","ReL88616","Res69632","Res36292","Dot62528","ReL53345","Con24336","Ave88338"],Ave88338,"Ave88338")

Actual (Unparsed): [[[-14.1995349, -14.3657301, 0.0519500, 0.1389500, 0.1043000, 0.1818500], [-11.9020759, -12.0395651, 0.4635500, 0.0009500, 0.1968000, 0.2026000], [-8.8259119, -8.6486892, 0.6509000, 0.9997000, 0.5841706, 0.6625405], [-10.9475204, -10.9307530, 0.2451000, 1.1223000, 0.2743726, 0.5769500]]]

Expected (Unparsed): [[[-14.199534896898554,-14.365730050323405,0.05195,0.13895,0.1043,0.18185],[-11.90207569811461,-12.039564906420242,0.46355,0.00095,0.1968,0.2026],[-8.825912013074824,-8.648689305161625,0.6509,0.9997,0.58417063,0.662540495],[-10.947520098110138,-10.930752758336943,0.24509999999999998,1.1223,0.27437262,0.5769500000000001]]]

Actual:   [[[-14.1995, -14.3657, 0.052, 0.139, 0.1043, 0.1819], [-11.902, -12.0395, 0.4636, 0.001, 0.1968, 0.2026], [-8.8259, -8.6486, 0.6509, 0.9997, 0.5842, 0.6626], [-10.9475, -10.9307, 0.2451, 1.1223, 0.2744, 0.577]]]

Expected: [[[-14.1995, -14.3657, 0.052, 0.139, 0.1043, 0.1819], [-11.902, -12.0395, 0.4636, 0.001, 0.1968, 0.2026], [-8.8259, -8.6486, 0.6509, 0.9997, 0.5842, 0.6626], [-10.9475, -10.9307, 0.2451, 1.1223, 0.2744, 0.577]]]