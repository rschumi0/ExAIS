import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min83205 = tf.keras.layers.Input(shape=([2, 2]))
in1Min83205 = tf.keras.layers.Input(shape=([2, 2]))
in0Con12890 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Sof83928 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

Min83205 = keras.layers.Minimum(name = 'Min83205', )([in0Min83205,in1Min83205])
Res93080 = keras.layers.Reshape((2, 2, 1), name = 'Res93080', )(Min83205)
Res67601 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res67601', )(Res93080)
Con12890 = keras.layers.Concatenate(axis=4, name = 'Con12890', )([Res67601,in0Con12890])
Sof83928 = keras.layers.Softmax(axis=1, name = 'Sof83928', input_shape=(2, 2, 1, 2))(in0Sof83928)
Sub28433 = keras.layers.Subtract(name = 'Sub28433', )([Con12890,Sof83928])
model = tf.keras.models.Model(inputs=[in0Min83205,in1Min83205,in0Con12890,in0Sof83928], outputs=Sub28433)
in0Min83205 = tf.constant([[[0.9453, 0.5783], [0.3879, 0.7468]]])
in1Min83205 = tf.constant([[[0.5659, 0.9563], [0.2114, 0.6201]]])
in0Con12890 = tf.constant([[[[[0.961]], [[0.6153]]], [[[0.0798]], [[0.1346]]]]])
in0Sof83928 = tf.constant([[[[[0.8366, 0.6571]], [[0.8284, 0.4953]]], [[[0.0369, 0.4352]], [[0.809, 0.9562]]]]])
print (np.array2string(model.predict([in0Min83205,in1Min83205,in0Con12890,in0Sof83928],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub28433.png')

LMin83205 = minimum_layer([[[[0.9453, 0.5783], [0.3879, 0.7468]]], [[[0.5659, 0.9563], [0.2114, 0.6201]]]], Min83205), 
LRes93080 = reshape_layer(Min83205, [2, 2, 1], Res93080), 
LRes67601 = reshape_layer(Res93080, [2, 2, 1, 1], Res67601), 
LCon12890 = concatenate_layer([Res67601,[[[[[0.961]], [[0.6153]]], [[[0.0798]], [[0.1346]]]]]], 4, Con12890), 
LSof83928 = softmax_layer([[[[[0.8366, 0.6571]], [[0.8284, 0.4953]]], [[[0.0369, 0.4352]], [[0.809, 0.9562]]]]], 1, Sof83928), 
LSub28433 = subtract_layer(Con12890,Sof83928, Sub28433), 
exec_layers([LMin83205,LRes93080,LRes67601,LCon12890,LSof83928,LSub28433],["Min83205","Res93080","Res67601","Con12890","Sof83928","Sub28433"],Sub28433,"Sub28433")

Actual (Unparsed): [[[[[-0.1240103, 0.4057515]], [[0.0734502, 0.2285277]]], [[[-0.0986897, -0.3649515]], [[0.1249499, -0.4786277]]]]]

Expected (Unparsed): [[[[[-0.12401030456156481,0.4057515153264405]],[[0.07345015210644201,0.2285276594273436]]],[[[-0.09868969543843528,-0.36495151532644055]],[[0.12494984789355795,-0.4786276594273436]]]]]

Actual:   [[[[[-0.124, 0.4058]], [[0.0735, 0.2286]]], [[[-0.0986, -0.3649]], [[0.125, -0.4786]]]]]

Expected: [[[[[-0.124, 0.4058]], [[0.0735, 0.2286]]], [[[-0.0986, -0.3649]], [[0.125, -0.4786]]]]]