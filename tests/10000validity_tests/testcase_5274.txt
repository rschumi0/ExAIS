import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Bat91009 = tf.keras.layers.Input(shape=([3, 4]))

Bat91009 = keras.layers.BatchNormalization(axis=1, epsilon=0.9719611562709822,  name = 'Bat91009', )(in0Bat91009)
Res4185 = keras.layers.Reshape((3, 4, 1), name = 'Res4185', )(Bat91009)
Glo97651 = keras.layers.GlobalMaxPool2D(name = 'Glo97651', )(Res4185)
Res12903 = keras.layers.Reshape((1, 1), name = 'Res12903', )(Glo97651)
Res34697 = keras.layers.Reshape((1, 1, 1), name = 'Res34697', )(Res12903)
Sep72885 = keras.layers.SeparableConv2D(3, (1, 1),strides=(1, 1), padding='same', name = 'Sep72885', )(Res34697)
model = tf.keras.models.Model(inputs=[in0Bat91009], outputs=Sep72885)
w = model.get_layer('Bat91009').get_weights() 
w[0] = np.array([0.168, 0.1287, 0.5973])
w[1] = np.array([0.9098, 0.4573, 0.0041])
w[2] = np.array([0.4313, 0.2365, 0.8581])
w[3] = np.array([0.6468, 0.0473, 0.5786])
model.get_layer('Bat91009').set_weights(w) 
w = model.get_layer('Sep72885').get_weights() 
w[0] = np.array([[[[0.4862]]]])
w[1] = np.array([[[[0.2909, 0.7304, 0.8534]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep72885').set_weights(w) 
in0Bat91009 = tf.constant([[[1.2532, 1.6814, 1.3668, 1.4361], [1.1462, 1.0415, 1.069, 1.3508], [1.5044, 1.3496, 1.0378, 1.3848]]])
print (np.array2string(model.predict([in0Bat91009],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sep72885.png')

LBat91009 = batch_normalization_layer([[[1.2532, 1.6814, 1.3668, 1.4361], [1.1462, 1.0415, 1.069, 1.3508], [1.5044, 1.3496, 1.0378, 1.3848]]], 1, 0.9719611562709822, [0.168, 0.1287, 0.5973], [0.9098, 0.4573, 0.0041], [0.4313, 0.2365, 0.8581], [0.6468, 0.0473, 0.5786], Bat91009), 
LRes4185 = reshape_layer(Bat91009, [3, 4, 1], Res4185), 
LGlo97651 = global_max_pool2D_layer(Res4185, Glo97651), 
LRes12903 = reshape_layer(Glo97651, [1, 1], Res12903), 
LRes34697 = reshape_layer(Res12903, [1, 1, 1], Res34697), 
LSep72885 = separable_conv2D_layer(Res34697, 1, 1,[[[[[0.4862]]]],[[[[0.2909, 0.7304, 0.8534]]]]],[0, 0, 0], 1, 1, true, Sep72885), 
exec_layers([LBat91009,LRes4185,LGlo97651,LRes12903,LRes34697,LSep72885],["Bat91009","Res4185","Glo97651","Res12903","Res34697","Sep72885"],Sep72885,"Sep72885")

Actual (Unparsed): [[[[0.1520246, 0.3817076, 0.4459875]]]]

Expected (Unparsed): [[[[0.15202456611922058,0.3817076077465752,0.44598750335559595]]]]

Actual:   [[[[0.1521, 0.3818, 0.446]]]]

Expected: [[[[0.1521, 0.3818, 0.446]]]]