import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot41107 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot41107 = tf.keras.layers.Input(shape=([2, 2]))
in0Min22506 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Min22506 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Up_30191 = tf.keras.layers.Input(shape=([4, 3]))
in0Con89594 = tf.keras.layers.Input(shape=([4, 5]))
in0Max71533 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con94339 = tf.keras.layers.Input(shape=([1, 1]))
in0Ave34493 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave34493 = tf.keras.layers.Input(shape=([1, 2]))
in0Con23629 = tf.keras.layers.Input(shape=([4, 6]))

Dot41107 = keras.layers.Dot(axes=(1, 2), name = 'Dot41107', )([in0Dot41107,in1Dot41107])
Res1297 = keras.layers.Reshape((2, 2, 1), name = 'Res1297', )(Dot41107)
Sep8409 = keras.layers.SeparableConv2D(2, (1, 1),strides=(1, 1), padding='same', name = 'Sep8409', )(Res1297)
Zer30830 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer30830', )(Sep8409)
Min22506 = keras.layers.Minimum(name = 'Min22506', )([in0Min22506,in1Min22506])
Zer58208 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer58208', )(Min22506)
Sub62291 = keras.layers.Subtract(name = 'Sub62291', )([Zer30830,Zer58208])
Res88840 = keras.layers.Reshape((3, 8), name = 'Res88840', )(Sub62291)
Zer30870 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer30870', )(Res88840)
Up_30191 = keras.layers.UpSampling1D(size=(1), name = 'Up_30191', )(in0Up_30191)
Con89594 = keras.layers.Concatenate(axis=2, name = 'Con89594', )([Up_30191,in0Con89594])
Ave98879 = keras.layers.Average(name = 'Ave98879', )([Zer30870,Con89594])
Max71533 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max71533', )(in0Max71533)
Res35973 = keras.layers.Reshape((1, 1), name = 'Res35973', )(Max71533)
Con94339 = keras.layers.Concatenate(axis=2, name = 'Con94339', )([Res35973,in0Con94339])
Ave34493 = keras.layers.Average(name = 'Ave34493', )([in0Ave34493,in1Ave34493])
Mul26275 = keras.layers.Multiply(name = 'Mul26275', )([Con94339,Ave34493])
Zer38970 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer38970', )(Mul26275)
Con23629 = keras.layers.Concatenate(axis=2, name = 'Con23629', )([Zer38970,in0Con23629])
Sub63500 = keras.layers.Subtract(name = 'Sub63500', )([Ave98879,Con23629])
model = tf.keras.models.Model(inputs=[in0Dot41107,in1Dot41107,in0Min22506,in1Min22506,in0Up_30191,in0Con89594,in0Max71533,in0Con94339,in0Ave34493,in1Ave34493,in0Con23629], outputs=Sub63500)
w = model.get_layer('Sep8409').get_weights() 
w[0] = np.array([[[[0.1782]]]])
w[1] = np.array([[[[0.0906, 0.5006]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep8409').set_weights(w) 
in0Dot41107 = tf.constant([[[0.7129, 0.8517], [0.7454, 0.4312]]])
in1Dot41107 = tf.constant([[[0.7749, 0.2191], [0.2677, 0.6651]]])
in0Min22506 = tf.constant([[[[0.5504, 0.4886], [0.8581, 0.6106]]]])
in1Min22506 = tf.constant([[[[0.4265, 0.0427], [0.2056, 0.8242]]]])
in0Up_30191 = tf.constant([[[1.0499, 1.773, 1.1613], [1.2252, 1.7363, 1.4779], [1.4683, 1.0049, 1.9183], [1.8632, 1.0901, 1.0135]]])
in0Con89594 = tf.constant([[[0.8422, 0.6057, 0.8234, 0.4978, 0.1728], [0.2823, 0.0531, 0.0752, 0.0347, 0.6857], [0.0854, 0.5325, 0.4246, 0.5816, 0.3377], [0.2672, 0.5144, 0.6832, 0.5643, 0.1816]]])
in0Max71533 = tf.constant([[[[1.5048]]]])
in0Con94339 = tf.constant([[[0.053]]])
in0Ave34493 = tf.constant([[[0.4997, 0.99]]])
in1Ave34493 = tf.constant([[[0.8179, 0.4893]]])
in0Con23629 = tf.constant([[[0.0816, 0.6186, 0.0782, 0.6328, 0.6709, 0.7706], [0.9852, 0.4906, 0.6581, 0.42, 0.5968, 0.4894], [0.317, 0.1185, 0.8638, 0.7598, 0.5677, 0.2495], [0.2439, 0.2557, 0.3171, 0.3141, 0.4929, 0.6341]]])
print (np.array2string(model.predict([in0Dot41107,in1Dot41107,in0Min22506,in1Min22506,in0Up_30191,in0Con89594,in0Max71533,in0Con94339,in0Ave34493,in1Ave34493,in0Con23629],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub63500.png')

LDot41107 = dot_layer([[[0.7129, 0.8517], [0.7454, 0.4312]]], [[[0.7749, 0.2191], [0.2677, 0.6651]]], 1, 2, Dot41107), 
LRes1297 = reshape_layer(Dot41107, [2, 2, 1], Res1297), 
LSep8409 = separable_conv2D_layer(Res1297, 1, 1,[[[[[0.1782]]]],[[[[0.0906, 0.5006]]]]],[0, 0], 1, 1, true, Sep8409), 
LZer30830 = zero_padding2D_layer(Sep8409, 1, 0, 2, 0, Zer30830), 
LMin22506 = minimum_layer([[[[[0.5504, 0.4886], [0.8581, 0.6106]]]], [[[[0.4265, 0.0427], [0.2056, 0.8242]]]]], Min22506), 
LZer58208 = zero_padding2D_layer(Min22506, 1, 1, 1, 1, Zer58208), 
LSub62291 = subtract_layer(Zer30830,Zer58208, Sub62291), 
LRes88840 = reshape_layer(Sub62291, [3, 8], Res88840), 
LZer30870 = zero_padding1D_layer(Res88840, 1, 0, Zer30870), 
LUp_30191 = up_sampling1D_layer([[[1.0499, 1.773, 1.1613], [1.2252, 1.7363, 1.4779], [1.4683, 1.0049, 1.9183], [1.8632, 1.0901, 1.0135]]], 1, Up_30191), 
LCon89594 = concatenate_layer([Up_30191,[[[0.8422, 0.6057, 0.8234, 0.4978, 0.1728], [0.2823, 0.0531, 0.0752, 0.0347, 0.6857], [0.0854, 0.5325, 0.4246, 0.5816, 0.3377], [0.2672, 0.5144, 0.6832, 0.5643, 0.1816]]]], 2, Con89594), 
LAve98879 = average_layer([Zer30870,Con89594], Ave98879), 
LMax71533 = max_pool2D_layer([[[[1.5048]]]], 1, 1, Max71533), 
LRes35973 = reshape_layer(Max71533, [1, 1], Res35973), 
LCon94339 = concatenate_layer([Res35973,[[[0.053]]]], 2, Con94339), 
LAve34493 = average_layer([[[[0.4997, 0.99]]], [[[0.8179, 0.4893]]]], Ave34493), 
LMul26275 = multiply_layer([Con94339,Ave34493], Mul26275), 
LZer38970 = zero_padding1D_layer(Mul26275, 3, 0, Zer38970), 
LCon23629 = concatenate_layer([Zer38970,[[[0.0816, 0.6186, 0.0782, 0.6328, 0.6709, 0.7706], [0.9852, 0.4906, 0.6581, 0.42, 0.5968, 0.4894], [0.317, 0.1185, 0.8638, 0.7598, 0.5677, 0.2495], [0.2439, 0.2557, 0.3171, 0.3141, 0.4929, 0.6341]]]], 2, Con23629), 
LSub63500 = subtract_layer(Ave98879,Con23629, Sub63500), 
exec_layers([LDot41107,LRes1297,LSep8409,LZer30830,LMin22506,LZer58208,LSub62291,LRes88840,LZer30870,LUp_30191,LCon89594,LAve98879,LMax71533,LRes35973,LCon94339,LAve34493,LMul26275,LZer38970,LCon23629,LSub63500],["Dot41107","Res1297","Sep8409","Zer30830","Min22506","Zer58208","Sub62291","Res88840","Zer30870","Up_30191","Con89594","Ave98879","Max71533","Res35973","Con94339","Ave34493","Mul26275","Zer38970","Con23629","Sub63500"],Sub63500,"Sub63500")

Actual (Unparsed): [[[0.5249500, 0.8865000, 0.4990500, -0.1975000, 0.2246500, -0.2211000, -0.4220000, -0.6842000], [0.6126000, 0.8681500, -0.2462500, -0.3494500, -0.6315500, -0.3824000, -0.5794500, -0.1465500], [0.7341500, 0.5024500, 0.4289000, -0.0971500, -0.6945722, -0.8208754, -0.2713574, -0.0500249], [-0.0597622, 0.5058486, 0.2628500, -0.1221000, -0.0538097, 0.0611515, -0.2065944, -0.5203385]]]

Expected (Unparsed): [[[0.52495,0.8865,0.49905,-0.19750000000000006,0.22465000000000002,-0.22110000000000002,-0.42200000000000004,-0.6841999999999999],[0.6126,0.86815,-0.24624999999999997,-0.34945,-0.6315500000000001,-0.38239999999999996,-0.57945,-0.14655],[0.73415,0.50245,0.4289,-0.09714999999999999,-0.694572190436859,-0.820875370118009,-0.2713573773612798,-0.05002486873130979],[-0.059762239999999855,0.5058485500000001,0.26285000000000003,-0.12209999999999999,-0.05380966595520503,0.06115144837554504,-0.20659436854892338,-0.5203385308564134]]]

Actual:   [[[0.525, 0.8865, 0.4991, -0.1975, 0.2247, -0.2211, -0.422, -0.6842], [0.6126, 0.8682, -0.2462, -0.3494, -0.6315, -0.3824, -0.5794, -0.1465], [0.7342, 0.5025, 0.4289, -0.0971, -0.6945, -0.8208, -0.2713, -0.05], [-0.0597, 0.5059, 0.2629, -0.1221, -0.0538, 0.0612, -0.2065, -0.5203]]]

Expected: [[[0.525, 0.8865, 0.4991, -0.1975, 0.2247, -0.2211, -0.422, -0.6841], [0.6126, 0.8682, -0.2462, -0.3494, -0.6315, -0.3823, -0.5794, -0.1465], [0.7342, 0.5025, 0.4289, -0.0971, -0.6945, -0.8208, -0.2713, -0.05], [-0.0597, 0.5059, 0.2629, -0.122, -0.0538, 0.0612, -0.2065, -0.5203]]]