import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot7906 = tf.keras.layers.Input(shape=([2]))
in1Dot7906 = tf.keras.layers.Input(shape=([2]))
in0Con9416 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Min90396 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Min90396 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Sub8034 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub8034 = tf.keras.layers.Input(shape=([2, 3]))
in0Con61802 = tf.keras.layers.Input(shape=([2, 6]))

Dot7906 = keras.layers.Dot(axes=(1, 1), name = 'Dot7906', )([in0Dot7906,in1Dot7906])
Res11241 = keras.layers.Reshape((1, 1), name = 'Res11241', )(Dot7906)
Res54516 = keras.layers.Reshape((1, 1, 1), name = 'Res54516', )(Res11241)
Res42054 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res42054', )(Res54516)
Zer36253 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (1, 0)), name = 'Zer36253', )(Res42054)
Con9416 = keras.layers.Concatenate(axis=4, name = 'Con9416', )([Zer36253,in0Con9416])
Min90396 = keras.layers.Minimum(name = 'Min90396', )([in0Min90396,in1Min90396])
Add52182 = keras.layers.Add(name = 'Add52182', )([Con9416,Min90396])
Res27617 = keras.layers.Reshape((1, 2, 4), name = 'Res27617', )(Add52182)
Res13647 = keras.layers.Reshape((1, 8), name = 'Res13647', )(Res27617)
Zer59652 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer59652', )(Res13647)
Sub8034 = keras.layers.Subtract(name = 'Sub8034', )([in0Sub8034,in1Sub8034])
Loc78911 = keras.layers.LocallyConnected1D(2, (1),strides=(1), name = 'Loc78911', )(Sub8034)
Con61802 = keras.layers.Concatenate(axis=2, name = 'Con61802', )([Loc78911,in0Con61802])
Sub17672 = keras.layers.Subtract(name = 'Sub17672', )([Zer59652,Con61802])
model = tf.keras.models.Model(inputs=[in0Dot7906,in1Dot7906,in0Con9416,in0Min90396,in1Min90396,in0Sub8034,in1Sub8034,in0Con61802], outputs=Sub17672)
w = model.get_layer('Loc78911').get_weights() 
w[0] = np.array([[[0.3139, 0.9084], [0.1905, 0.987], [0.2638, 0.8705]], [[0.2376, 0.9807], [0.61, 0.0975], [0.5, 0.9203]]])
w[1] = np.array([[0, 0], [0, 0]])
model.get_layer('Loc78911').set_weights(w) 
in0Dot7906 = tf.constant([[0.4838, 0.6952]])
in1Dot7906 = tf.constant([[0.5244, 0.2872]])
in0Con9416 = tf.constant([[[[[0.5648], [0.3824]], [[0.6664], [0.9738]]]]])
in0Min90396 = tf.constant([[[[[0.6552, 0.0337], [0.3666, 0.0861]], [[0.0625, 0.918], [0.8457, 0.1052]]]]])
in1Min90396 = tf.constant([[[[[0.0179, 0.6777], [0.5969, 0.0097]], [[0.8629, 0.8116], [0.4736, 0.1669]]]]])
in0Sub8034 = tf.constant([[[0.3874, 0.8688, 0.7334], [0.9785, 0.7488, 0.4892]]])
in1Sub8034 = tf.constant([[[0.0171, 0.945, 0.9172], [0.5407, 0.496, 0.6162]]])
in0Con61802 = tf.constant([[[0.0256, 0.7082, 0.3832, 0.7807, 0.3291, 0.3362], [0.976, 0.7064, 0.575, 0.9284, 0.2486, 0.9081]]])
print (np.array2string(model.predict([in0Dot7906,in1Dot7906,in0Con9416,in0Min90396,in1Min90396,in0Sub8034,in1Sub8034,in0Con61802],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub17672.png')

LDot7906 = dot_layer([[0.4838, 0.6952]], [[0.5244, 0.2872]], 1, 1, Dot7906), 
LRes11241 = reshape_layer(Dot7906, [1, 1], Res11241), 
LRes54516 = reshape_layer(Res11241, [1, 1, 1], Res54516), 
LRes42054 = reshape_layer(Res54516, [1, 1, 1, 1], Res42054), 
LZer36253 = zero_padding3D_layer(Res42054, 0, 0, 1, 0, 1, 0, Zer36253), 
LCon9416 = concatenate_layer([Zer36253,[[[[[0.5648], [0.3824]], [[0.6664], [0.9738]]]]]], 4, Con9416), 
LMin90396 = minimum_layer([[[[[[0.6552, 0.0337], [0.3666, 0.0861]], [[0.0625, 0.918], [0.8457, 0.1052]]]]], [[[[[0.0179, 0.6777], [0.5969, 0.0097]], [[0.8629, 0.8116], [0.4736, 0.1669]]]]]], Min90396), 
LAdd52182 = add_layer([Con9416,Min90396], Add52182), 
LRes27617 = reshape_layer(Add52182, [1, 2, 4], Res27617), 
LRes13647 = reshape_layer(Res27617, [1, 8], Res13647), 
LZer59652 = zero_padding1D_layer(Res13647, 1, 0, Zer59652), 
LSub8034 = subtract_layer([[[0.3874, 0.8688, 0.7334], [0.9785, 0.7488, 0.4892]]], [[[0.0171, 0.945, 0.9172], [0.5407, 0.496, 0.6162]]], Sub8034), 
LLoc78911 = locally_connected1D_layer(Sub8034, 1,[[[0.3139, 0.9084], [0.1905, 0.987], [0.2638, 0.8705]], [[0.2376, 0.9807], [0.61, 0.0975], [0.5, 0.9203]]],[[0, 0], [0, 0]], 1, Loc78911), 
LCon61802 = concatenate_layer([Loc78911,[[[0.0256, 0.7082, 0.3832, 0.7807, 0.3291, 0.3362], [0.976, 0.7064, 0.575, 0.9284, 0.2486, 0.9081]]]], 2, Con61802), 
LSub17672 = subtract_layer(Zer59652,Con61802, Sub17672), 
exec_layers([LDot7906,LRes11241,LRes54516,LRes42054,LZer36253,LCon9416,LMin90396,LAdd52182,LRes27617,LRes13647,LZer59652,LSub8034,LLoc78911,LCon61802,LSub17672],["Dot7906","Res11241","Res54516","Res42054","Zer36253","Con9416","Min90396","Add52182","Res27617","Res13647","Zer59652","Sub8034","Loc78911","Con61802","Sub17672"],Sub17672,"Sub17672")

Actual (Unparsed): [[[-0.0532346, -0.1011732, -0.0256000, -0.7082000, -0.3832000, -0.7807000, -0.3291000, -0.3362000], [-0.1768293, 0.2613797, -0.6094000, -0.3143000, -0.5125000, 0.5496001, 0.6783662, 0.1709000]]]

Expected (Unparsed): [[[-0.05323463000000004,-0.10117322000000012,-0.0256,-0.7082,-0.3832,-0.7807,-0.3291,-0.3362],[-0.17682928000000003,0.2613796399999998,-0.6093999999999999,-0.3143,-0.5125,0.5496,0.6783661600000002,0.17089999999999994]]]

Actual:   [[[-0.0532, -0.1011, -0.0256, -0.7082, -0.3832, -0.7807, -0.3291, -0.3362], [-0.1768, 0.2614, -0.6094, -0.3143, -0.5125, 0.5497, 0.6784, 0.1709]]]

Expected: [[[-0.0532, -0.1011, -0.0256, -0.7082, -0.3832, -0.7807, -0.3291, -0.3362], [-0.1768, 0.2614, -0.6093, -0.3143, -0.5125, 0.5496, 0.6784, 0.1709]]]