import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min29088 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Min29088 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con76002 = tf.keras.layers.Input(shape=([4]))
in0Sub20762 = tf.keras.layers.Input(shape=([2, 2, 3]))
in1Sub20762 = tf.keras.layers.Input(shape=([2, 2, 3]))
in0GRU85566 = tf.keras.layers.Input(shape=([1, 2]))
in0Con41463 = tf.keras.layers.Input(shape=([9]))

Min29088 = keras.layers.Minimum(name = 'Min29088', )([in0Min29088,in1Min29088])
Res6384 = keras.layers.Reshape((2, 4), name = 'Res6384', )(Min29088)
Fla24629 = keras.layers.Flatten(name = 'Fla24629', )(Res6384)
Con76002 = keras.layers.Concatenate(axis=1, name = 'Con76002', )([Fla24629,in0Con76002])
Sub20762 = keras.layers.Subtract(name = 'Sub20762', )([in0Sub20762,in1Sub20762])
Res98148 = keras.layers.Reshape((2, 6), name = 'Res98148', )(Sub20762)
Fla97774 = keras.layers.Flatten(name = 'Fla97774', )(Res98148)
GRU85566 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU85566', )(in0GRU85566)
Con41463 = keras.layers.Concatenate(axis=1, name = 'Con41463', )([GRU85566,in0Con41463])
Ave79876 = keras.layers.Average(name = 'Ave79876', )([Fla97774,Con41463])
Max73903 = keras.layers.Maximum(name = 'Max73903', )([Con76002,Ave79876])
Res93738 = keras.layers.Reshape((12, 1), name = 'Res93738', )(Max73903)
Glo32895 = keras.layers.GlobalAveragePooling1D(name = 'Glo32895', )(Res93738)
model = tf.keras.models.Model(inputs=[in0Min29088,in1Min29088,in0Con76002,in0Sub20762,in1Sub20762,in0GRU85566,in0Con41463], outputs=Glo32895)
w = model.get_layer('GRU85566').get_weights() 
w[0] = np.array([[2, 7, 10, 8, 8, 5, 9, 7, 7], [9, 1, 6, 5, 1, 5, 1, 8, 4]])
w[1] = np.array([[10, 8, 5, 1, 2, 8, 10, 10, 8], [5, 3, 3, 9, 6, 7, 6, 3, 3], [4, 7, 7, 1, 9, 10, 6, 4, 1]])
w[2] = np.array([[8, 5, 2, 5, 3, 6, 8, 1, 6], [2, 6, 2, 9, 4, 2, 7, 2, 4]])
model.get_layer('GRU85566').set_weights(w) 
in0Min29088 = tf.constant([[[[0.3398, 0.1156], [0.2835, 0.237]], [[0.6019, 0.8684], [0.787, 0.2245]]]])
in1Min29088 = tf.constant([[[[0.1924, 0.4176], [0.4466, 0.0477]], [[0.975, 0.1218], [0.2843, 0.5556]]]])
in0Con76002 = tf.constant([[0.3523, 0.036, 0.8675, 0.3245]])
in0Sub20762 = tf.constant([[[[0.4977, 0.6556, 0.1504], [0.3064, 0.7545, 0.2722]], [[0.0043, 0.9701, 0.4254], [0.1028, 0.5569, 0.7154]]]])
in1Sub20762 = tf.constant([[[[0.5167, 0.0469, 0.7156], [0.1903, 0.0928, 0.2068]], [[0.1267, 0.3122, 0.9698], [0.8858, 0.8608, 0.848]]]])
in0GRU85566 = tf.constant([[[8, 5]]])
in0Con41463 = tf.constant([[0.9477, 0.7906, 0.3467, 0.8137, 0.8105, 0.2993, 0.8136, 0.9435, 0.3391]])
print (np.array2string(model.predict([in0Min29088,in1Min29088,in0Con76002,in0Sub20762,in1Sub20762,in0GRU85566,in0Con41463],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo32895.png')

LMin29088 = minimum_layer([[[[[0.3398, 0.1156], [0.2835, 0.237]], [[0.6019, 0.8684], [0.787, 0.2245]]]], [[[[0.1924, 0.4176], [0.4466, 0.0477]], [[0.975, 0.1218], [0.2843, 0.5556]]]]], Min29088), 
LRes6384 = reshape_layer(Min29088, [2, 4], Res6384), 
LFla24629 = flatten_layer(Res6384, Fla24629), 
LCon76002 = concatenate_layer([Fla24629,[[0.3523, 0.036, 0.8675, 0.3245]]], 1, Con76002), 
LSub20762 = subtract_layer([[[[0.4977, 0.6556, 0.1504], [0.3064, 0.7545, 0.2722]], [[0.0043, 0.9701, 0.4254], [0.1028, 0.5569, 0.7154]]]], [[[[0.5167, 0.0469, 0.7156], [0.1903, 0.0928, 0.2068]], [[0.1267, 0.3122, 0.9698], [0.8858, 0.8608, 0.848]]]], Sub20762), 
LRes98148 = reshape_layer(Sub20762, [2, 6], Res98148), 
LFla97774 = flatten_layer(Res98148, Fla97774), 
LGRU85566 = gru_layer([[[8, 5]]],[[2, 7, 10, 8, 8, 5, 9, 7, 7], [9, 1, 6, 5, 1, 5, 1, 8, 4]],[[10, 8, 5, 1, 2, 8, 10, 10, 8], [5, 3, 3, 9, 6, 7, 6, 3, 3], [4, 7, 7, 1, 9, 10, 6, 4, 1]],[[8, 5, 2, 5, 3, 6, 8, 1, 6], [2, 6, 2, 9, 4, 2, 7, 2, 4]], true, GRU85566), 
LCon41463 = concatenate_layer([GRU85566,[[0.9477, 0.7906, 0.3467, 0.8137, 0.8105, 0.2993, 0.8136, 0.9435, 0.3391]]], 1, Con41463), 
LAve79876 = average_layer([Fla97774,Con41463], Ave79876), 
LMax73903 = maximum_layer([Con76002,Ave79876], Max73903), 
LRes93738 = reshape_layer(Max73903, [12, 1], Res93738), 
LGlo32895 = global_average_pooling1D_layer(Res93738, Glo32895), 
exec_layers([LMin29088,LRes6384,LFla24629,LCon76002,LSub20762,LRes98148,LFla97774,LGRU85566,LCon41463,LAve79876,LMax73903,LRes93738,LGlo32895],["Min29088","Res6384","Fla24629","Con76002","Sub20762","Res98148","Fla97774","GRU85566","Con41463","Ave79876","Max73903","Res93738","Glo32895"],Glo32895,"Glo32895")

Actual (Unparsed): [[0.4087083]]

Expected (Unparsed): [[0.4087083333333334]]

Actual:   [[0.4088]]

Expected: [[0.4088]]