import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub56401 = tf.keras.layers.Input(shape=([3, 3, 2]))
in1Sub56401 = tf.keras.layers.Input(shape=([3, 3, 2]))
in0Lay77195 = tf.keras.layers.Input(shape=([4, 2, 4]))
in0Con43154 = tf.keras.layers.Input(shape=([4, 4, 4]))

Sub56401 = keras.layers.Subtract(name = 'Sub56401', )([in0Sub56401,in1Sub56401])
Res58826 = keras.layers.Reshape((3, 3, 2, 1), name = 'Res58826', )(Sub56401)
Con96603 = keras.layers.Conv3DTranspose(4, (1, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con96603', )(Res58826)
Res1252 = keras.layers.Reshape((3, 3, 8), name = 'Res1252', )(Con96603)
Zer69499 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer69499', )(Res1252)
Lay77195 = keras.layers.LayerNormalization(axis=1, epsilon=1.1143261276043424, name = 'Lay77195', )(in0Lay77195)
Zer77680 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer77680', )(Lay77195)
Con43154 = keras.layers.Concatenate(axis=3, name = 'Con43154', )([Zer77680,in0Con43154])
Min15958 = keras.layers.Minimum(name = 'Min15958', )([Zer69499,Con43154])
Res66966 = keras.layers.Reshape((4, 32), name = 'Res66966', )(Min15958)
Glo21915 = keras.layers.GlobalAveragePooling1D(name = 'Glo21915', )(Res66966)
Res89484 = keras.layers.Reshape((32, 1), name = 'Res89484', )(Glo21915)
PRe1427 = keras.layers.PReLU(name = 'PRe1427', )(Res89484)
model = tf.keras.models.Model(inputs=[in0Sub56401,in1Sub56401,in0Lay77195,in0Con43154], outputs=PRe1427)
w = model.get_layer('Con96603').get_weights() 
w[0] = np.array([[[[[0.5256], [0.1934], [0.6154], [0.9249]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con96603').set_weights(w) 
w = model.get_layer('PRe1427').get_weights() 
w[0] = np.array([[0.6292], [0.1957], [0.7396], [0.3878], [0.4736], [0.612], [0.1057], [0.7513], [0.6078], [0.6614], [0.3068], [0.8787], [0.8016], [0.1611], [0.7923], [0.5198], [0.1881], [0.1239], [0.4975], [0.8043], [0.0721], [0.8679], [0.1124], [0.5131], [0.3528], [0.4929], [0.2704], [0.4184], [0.3189], [0.5557], [0.729], [0.4333]])
model.get_layer('PRe1427').set_weights(w) 
in0Sub56401 = tf.constant([[[[0.9838, 0.6386], [0.5799, 0.3526], [0.9371, 0.6127]], [[0.8638, 0.258], [0.8096, 0.9354], [0.6533, 0.0315]], [[0.1978, 0.1755], [0.4214, 0.3762], [0.7274, 0.8029]]]])
in1Sub56401 = tf.constant([[[[0.9727, 0.3735], [0.7459, 0.183], [0.7271, 0.7196]], [[0.4499, 0.1889], [0.0812, 0.8314], [0.0497, 0.2076]], [[0.3206, 0.1594], [0.604, 0.7884], [0.7895, 0.8466]]]])
in0Lay77195 = tf.constant([[[[1.8401, 1.5638, 1.4069, 1.0794], [1.6187, 1.358, 1.1695, 1.0913]], [[1.6955, 1.5908, 1.975, 1.8011], [1.0898, 1.1834, 1.9598, 1.494]], [[1.6757, 1.1773, 1.5575, 1.7854], [1.5795, 1.1891, 1.6518, 1.3498]], [[1.5888, 1.6406, 1.5242, 1.5385], [1.0568, 1.4281, 1.7779, 1.0655]]]])
in0Con43154 = tf.constant([[[[0.2982, 0.0208, 0.7015, 0.0252], [0.2011, 0.6038, 0.2484, 0.9835], [0.3674, 0.3328, 0.34, 0.2546], [0.366, 0.997, 0.6149, 0.2149]], [[0.8579, 0.0575, 0.432, 0.2474], [0.3188, 0.854, 0.1474, 0.8007], [0.0588, 0.1424, 0.5062, 0.6083], [0.7411, 0.3484, 0.2572, 0.7064]], [[0.2665, 0.8416, 0.0872, 0.2597], [0.4537, 0.6088, 0.3699, 0.2333], [0.4226, 0.9393, 0.0223, 0.6346], [0.9658, 0.119, 0.9722, 0.387]], [[0.4793, 0.6773, 0.3542, 0.8985], [0.2169, 0.4285, 0.5716, 0.0364], [0.7317, 0.4078, 0.7884, 0.5343], [0.3709, 0.8141, 0.2483, 0.8193]]]])
print (np.array2string(model.predict([in0Sub56401,in1Sub56401,in0Lay77195,in0Con43154],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='PRe1427.png')

LSub56401 = subtract_layer([[[[0.9838, 0.6386], [0.5799, 0.3526], [0.9371, 0.6127]], [[0.8638, 0.258], [0.8096, 0.9354], [0.6533, 0.0315]], [[0.1978, 0.1755], [0.4214, 0.3762], [0.7274, 0.8029]]]], [[[[0.9727, 0.3735], [0.7459, 0.183], [0.7271, 0.7196]], [[0.4499, 0.1889], [0.0812, 0.8314], [0.0497, 0.2076]], [[0.3206, 0.1594], [0.604, 0.7884], [0.7895, 0.8466]]]], Sub56401), 
LRes58826 = reshape_layer(Sub56401, [3, 3, 2, 1], Res58826), 
LCon96603 = conv3D_transpose_layer(Res58826, 1, 1, 1,[[[[[0.5256], [0.1934], [0.6154], [0.9249]]]]],[0, 0, 0, 0], 1, 1, 1, false, Con96603), 
LRes1252 = reshape_layer(Con96603, [3, 3, 8], Res1252), 
LZer69499 = zero_padding2D_layer(Res1252, 1, 0, 1, 0, Zer69499), 
LLay77195 = layer_normalization_layer([[[[1.8401, 1.5638, 1.4069, 1.0794], [1.6187, 1.358, 1.1695, 1.0913]], [[1.6955, 1.5908, 1.975, 1.8011], [1.0898, 1.1834, 1.9598, 1.494]], [[1.6757, 1.1773, 1.5575, 1.7854], [1.5795, 1.1891, 1.6518, 1.3498]], [[1.5888, 1.6406, 1.5242, 1.5385], [1.0568, 1.4281, 1.7779, 1.0655]]]], 1, 1.1143261276043424, Lay77195), 
LZer77680 = zero_padding2D_layer(Lay77195, 0, 0, 2, 0, Zer77680), 
LCon43154 = concatenate_layer([Zer77680,[[[[0.2982, 0.0208, 0.7015, 0.0252], [0.2011, 0.6038, 0.2484, 0.9835], [0.3674, 0.3328, 0.34, 0.2546], [0.366, 0.997, 0.6149, 0.2149]], [[0.8579, 0.0575, 0.432, 0.2474], [0.3188, 0.854, 0.1474, 0.8007], [0.0588, 0.1424, 0.5062, 0.6083], [0.7411, 0.3484, 0.2572, 0.7064]], [[0.2665, 0.8416, 0.0872, 0.2597], [0.4537, 0.6088, 0.3699, 0.2333], [0.4226, 0.9393, 0.0223, 0.6346], [0.9658, 0.119, 0.9722, 0.387]], [[0.4793, 0.6773, 0.3542, 0.8985], [0.2169, 0.4285, 0.5716, 0.0364], [0.7317, 0.4078, 0.7884, 0.5343], [0.3709, 0.8141, 0.2483, 0.8193]]]]], 3, Con43154), 
LMin15958 = minimum_layer([Zer69499,Con43154], Min15958), 
LRes66966 = reshape_layer(Min15958, [4, 32], Res66966), 
LGlo21915 = global_average_pooling1D_layer(Res66966, Glo21915), 
LRes89484 = reshape_layer(Glo21915, [32, 1], Res89484), 
LPRe1427 = prelu_layer(Res89484, [[0.6292], [0.1957], [0.7396], [0.3878], [0.4736], [0.612], [0.1057], [0.7513], [0.6078], [0.6614], [0.3068], [0.8787], [0.8016], [0.1611], [0.7923], [0.5198], [0.1881], [0.1239], [0.4975], [0.8043], [0.0721], [0.8679], [0.1124], [0.5131], [0.3528], [0.4929], [0.2704], [0.4184], [0.3189], [0.5557], [0.729], [0.4333]], PRe1427), 
exec_layers([LSub56401,LRes58826,LCon96603,LRes1252,LZer69499,LLay77195,LZer77680,LCon43154,LMin15958,LRes66966,LGlo21915,LRes89484,LPRe1427],["Sub56401","Res58826","Con96603","Res1252","Zer69499","Lay77195","Zer77680","Con43154","Min15958","Res66966","Glo21915","Res89484","PRe1427"],PRe1427,"PRe1427")

Actual (Unparsed): [[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [-0.0098074], [-0.0039270], [-0.0057963], [-0.0249502], [0.0460294], [0.0169370], [0.0499580], [0.0809981], [-0.0101194], [-0.0112173], [-0.0575553], [-0.1084187], [-0.0018600], [-0.0058161], [-0.0035686], [-0.0164437], [-0.0229009], [-0.0254987], [-0.0221225], [-0.0035050], [-0.0136899], [-0.0087778], [-0.0366416], [-0.0327320]]]

Expected (Unparsed): [[[0],[0],[0],[0],[0],[0],[0],[0],[-0.009807412175999999],[-0.003926983132],[-0.005796304903999999],[-0.024950185641],[0.04602941999999999],[0.016937004999999998],[0.04995802],[0.0809981175],[-0.010119352120735897],[-0.011217323299879256],[-0.05755528913836131],[-0.10841869600611455],[-0.0018599983079999997],[-0.005816066948999998],[-0.0035685887240000003],[-0.016443718483499997],[-0.022900936170651698],[-0.025498697970105327],[-0.02212246144969029],[-0.0035049853420355977],[-0.013689860382000004],[-0.008777806636500001],[-0.036641577555000006],[-0.032732005209750004]]]

Actual:   [[[0], [0], [0], [0], [0], [0], [0], [0], [-0.0098], [-0.0039], [-0.0057], [-0.0249], [0.0461], [0.017], [0.05], [0.081], [-0.0101], [-0.0112], [-0.0575], [-0.1084], [-0.0018], [-0.0058], [-0.0035], [-0.0164], [-0.0229], [-0.0254], [-0.0221], [-0.0035], [-0.0136], [-0.0087], [-0.0366], [-0.0327]]]

Expected: [[[0], [0], [0], [0], [0], [0], [0], [0], [-0.0098], [-0.0039], [-0.0057], [-0.0249], [0.0461], [0.017], [0.05], [0.081], [-0.0101], [-0.0112], [-0.0575], [-0.1084], [-0.0018], [-0.0058], [-0.0035], [-0.0164], [-0.0229], [-0.0254], [-0.0221], [-0.0035], [-0.0136], [-0.0087], [-0.0366], [-0.0327]]]