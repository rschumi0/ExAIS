import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max21222 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Max21222 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con1109 = tf.keras.layers.Input(shape=([4, 1]))
in0Zer11973 = tf.keras.layers.Input(shape=([2, 3]))
in0Max8769 = tf.keras.layers.Input(shape=([1, 2, 1]))

Max21222 = keras.layers.Maximum(name = 'Max21222', )([in0Max21222,in1Max21222])
Res67114 = keras.layers.Reshape((2, 2), name = 'Res67114', )(Max21222)
Zer29123 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer29123', )(Res67114)
Con1109 = keras.layers.Concatenate(axis=2, name = 'Con1109', )([Zer29123,in0Con1109])
Zer11973 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer11973', )(in0Zer11973)
Min55269 = keras.layers.Minimum(name = 'Min55269', )([Con1109,Zer11973])
LST91916 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST91916', )(Min55269)
Res66118 = keras.layers.Reshape((2, 1), name = 'Res66118', )(LST91916)
Res56135 = keras.layers.Reshape((2, 1, 1), name = 'Res56135', )(Res66118)
Zer17802 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer17802', )(Res56135)
Max8769 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max8769', )(in0Max8769)
Zer62640 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer62640', )(Max8769)
Max94262 = keras.layers.Maximum(name = 'Max94262', )([Zer17802,Zer62640])
model = tf.keras.models.Model(inputs=[in0Max21222,in1Max21222,in0Con1109,in0Zer11973,in0Max8769], outputs=Max94262)
w = model.get_layer('LST91916').get_weights() 
w[0] = np.array([[3, 10, 4, 2, 2, 4, 8, 10], [10, 7, 2, 5, 1, 1, 8, 8], [9, 4, 7, 2, 6, 1, 9, 8]])
w[1] = np.array([[10, 7, 3, 4, 7, 7, 6, 6], [8, 6, 6, 5, 4, 3, 6, 8]])
w[2] = np.array([8, 9, 5, 2, 7, 1, 3, 5])
model.get_layer('LST91916').set_weights(w) 
in0Max21222 = tf.constant([[[[0.2092, 0.4935]], [[0.6632, 0.2645]]]])
in1Max21222 = tf.constant([[[[0.7404, 0.3264]], [[0.2697, 0.0617]]]])
in0Con1109 = tf.constant([[[0.3606], [0.7567], [0.6657], [0.2074]]])
in0Zer11973 = tf.constant([[[1.13, 1.2241, 1.368], [1.4163, 1.3249, 1.4905]]])
in0Max8769 = tf.constant([[[[1.3082], [1.8705]]]])
print (np.array2string(model.predict([in0Max21222,in1Max21222,in0Con1109,in0Zer11973,in0Max8769],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max94262.png')

LMax21222 = maximum_layer([[[[[0.2092, 0.4935]], [[0.6632, 0.2645]]]], [[[[0.7404, 0.3264]], [[0.2697, 0.0617]]]]], Max21222), 
LRes67114 = reshape_layer(Max21222, [2, 2], Res67114), 
LZer29123 = zero_padding1D_layer(Res67114, 2, 0, Zer29123), 
LCon1109 = concatenate_layer([Zer29123,[[[0.3606], [0.7567], [0.6657], [0.2074]]]], 2, Con1109), 
LZer11973 = zero_padding1D_layer([[[1.13, 1.2241, 1.368], [1.4163, 1.3249, 1.4905]]], 1, 1, Zer11973), 
LMin55269 = minimum_layer([Con1109,Zer11973], Min55269), 
LLST91916 = lstm_layer(Min55269,[[3, 10, 4, 2, 2, 4, 8, 10], [10, 7, 2, 5, 1, 1, 8, 8], [9, 4, 7, 2, 6, 1, 9, 8]],[[10, 7, 3, 4, 7, 7, 6, 6], [8, 6, 6, 5, 4, 3, 6, 8]],[8, 9, 5, 2, 7, 1, 3, 5], LST91916), 
LRes66118 = reshape_layer(LST91916, [2, 1], Res66118), 
LRes56135 = reshape_layer(Res66118, [2, 1, 1], Res56135), 
LZer17802 = zero_padding2D_layer(Res56135, 0, 0, 2, 0, Zer17802), 
LMax8769 = max_pool2D_layer([[[[1.3082], [1.8705]]]], 1, 1, Max8769), 
LZer62640 = zero_padding2D_layer(Max8769, 1, 0, 1, 0, Zer62640), 
LMax94262 = maximum_layer([Zer17802,Zer62640], Max94262), 
exec_layers([LMax21222,LRes67114,LZer29123,LCon1109,LZer11973,LMin55269,LLST91916,LRes66118,LRes56135,LZer17802,LMax8769,LZer62640,LMax94262],["Max21222","Res67114","Zer29123","Con1109","Zer11973","Min55269","LST91916","Res66118","Res56135","Zer17802","Max8769","Zer62640","Max94262"],Max94262,"Max94262")

Actual (Unparsed): [[[[0.0000000], [0.0000000], [0.9993285]], [[0.0000000], [1.3082000], [1.8705000]]]]

Expected (Unparsed): [[[[0],[0],[0.9993285136855975]],[[0],[1.3082],[1.8705]]]]

Actual:   [[[[0], [0], [0.9994]], [[0], [1.3082], [1.8705]]]]

Expected: [[[[0], [0], [0.9994]], [[0], [1.3082], [1.8705]]]]