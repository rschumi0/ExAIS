import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Zer49508 = tf.keras.layers.Input(shape=([3, 1, 3]))
in0Con16384 = tf.keras.layers.Input(shape=([4, 3]))
in0Max18608 = tf.keras.layers.Input(shape=([1, 2]))
in1Max18608 = tf.keras.layers.Input(shape=([1, 2]))
in0Con31083 = tf.keras.layers.Input(shape=([3, 2]))
in0Ave21634 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Ave21634 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Max57778 = tf.keras.layers.Input(shape=([2, 1]))
in1Max57778 = tf.keras.layers.Input(shape=([2, 1]))
in0Con78786 = tf.keras.layers.Input(shape=([4, 3]))

Zer49508 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer49508', )(in0Zer49508)
Res93984 = keras.layers.Reshape((5, 9), name = 'Res93984', )(Zer49508)
LST30786 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST30786', )(Res93984)
Res50208 = keras.layers.Reshape((2, 1), name = 'Res50208', )(LST30786)
Max93549 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max93549', )(Res50208)
Zer39944 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer39944', )(Max93549)
Con16384 = keras.layers.Concatenate(axis=2, name = 'Con16384', )([Zer39944,in0Con16384])
Max18608 = keras.layers.Maximum(name = 'Max18608', )([in0Max18608,in1Max18608])
Zer38171 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer38171', )(Max18608)
Con31083 = keras.layers.Concatenate(axis=2, name = 'Con31083', )([Zer38171,in0Con31083])
Ave21634 = keras.layers.Average(name = 'Ave21634', )([in0Ave21634,in1Ave21634])
Res78784 = keras.layers.Reshape((1, 4), name = 'Res78784', )(Ave21634)
Zer396 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer396', )(Res78784)
Dot70433 = keras.layers.Dot(axes=(1, 1), name = 'Dot70433', )([Con31083,Zer396])
Max57778 = keras.layers.Maximum(name = 'Max57778', )([in0Max57778,in1Max57778])
Zer63533 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer63533', )(Max57778)
Con78786 = keras.layers.Concatenate(axis=2, name = 'Con78786', )([Zer63533,in0Con78786])
Ave96795 = keras.layers.Average(name = 'Ave96795', )([Dot70433,Con78786])
Add81145 = keras.layers.Add(name = 'Add81145', )([Con16384,Ave96795])
model = tf.keras.models.Model(inputs=[in0Zer49508,in0Con16384,in0Max18608,in1Max18608,in0Con31083,in0Ave21634,in1Ave21634,in0Max57778,in1Max57778,in0Con78786], outputs=Add81145)
w = model.get_layer('LST30786').get_weights() 
w[0] = np.array([[8, 1, 2, 5, 5, 10, 10, 2], [8, 10, 4, 3, 4, 4, 3, 4], [1, 1, 3, 5, 1, 6, 9, 6], [10, 6, 10, 5, 4, 10, 9, 8], [3, 8, 4, 4, 8, 1, 5, 2], [2, 10, 1, 8, 10, 4, 2, 6], [8, 1, 9, 2, 9, 4, 10, 5], [9, 1, 2, 4, 5, 8, 6, 1], [6, 1, 4, 4, 1, 6, 2, 1]])
w[1] = np.array([[9, 4, 7, 2, 9, 5, 2, 4], [4, 2, 6, 4, 2, 2, 3, 8]])
w[2] = np.array([6, 9, 3, 2, 10, 10, 1, 4])
model.get_layer('LST30786').set_weights(w) 
in0Zer49508 = tf.constant([[[[1.9463, 1.7184, 1.1643]], [[1.3334, 1.8088, 1.3616]], [[1.7364, 1.0683, 1.4834]]]])
in0Con16384 = tf.constant([[[0.1411, 0.3399, 0.4597], [0.6381, 0.5603, 0.5116], [0.2193, 0.4801, 0.9441], [0.37, 0.7908, 0.5582]]])
in0Max18608 = tf.constant([[[0.1059, 0.8291]]])
in1Max18608 = tf.constant([[[0.5474, 0.3918]]])
in0Con31083 = tf.constant([[[0.6467, 0.7243], [0.9618, 0.9057], [0.4082, 0.5431]]])
in0Ave21634 = tf.constant([[[[0.5144, 0.5892], [0.8061, 0.1559]]]])
in1Ave21634 = tf.constant([[[[0.0485, 0.8716], [0.1733, 0.9707]]]])
in0Max57778 = tf.constant([[[0.2529], [0.4517]]])
in1Max57778 = tf.constant([[[0.5846], [0.8576]]])
in0Con78786 = tf.constant([[[0.1877, 0.7276, 0.6509], [0.9746, 0.5509, 0.2806], [0.9935, 0.7644, 0.5978], [0.7044, 0.5821, 0.2482]]])
print (np.array2string(model.predict([in0Zer49508,in0Con16384,in0Max18608,in1Max18608,in0Con31083,in0Ave21634,in1Ave21634,in0Max57778,in1Max57778,in0Con78786],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add81145.png')

LZer49508 = zero_padding2D_layer([[[[1.9463, 1.7184, 1.1643]], [[1.3334, 1.8088, 1.3616]], [[1.7364, 1.0683, 1.4834]]]], 1, 1, 1, 1, Zer49508), 
LRes93984 = reshape_layer(Zer49508, [5, 9], Res93984), 
LLST30786 = lstm_layer(Res93984,[[8, 1, 2, 5, 5, 10, 10, 2], [8, 10, 4, 3, 4, 4, 3, 4], [1, 1, 3, 5, 1, 6, 9, 6], [10, 6, 10, 5, 4, 10, 9, 8], [3, 8, 4, 4, 8, 1, 5, 2], [2, 10, 1, 8, 10, 4, 2, 6], [8, 1, 9, 2, 9, 4, 10, 5], [9, 1, 2, 4, 5, 8, 6, 1], [6, 1, 4, 4, 1, 6, 2, 1]],[[9, 4, 7, 2, 9, 5, 2, 4], [4, 2, 6, 4, 2, 2, 3, 8]],[6, 9, 3, 2, 10, 10, 1, 4], LST30786), 
LRes50208 = reshape_layer(LST30786, [2, 1], Res50208), 
LMax93549 = max_pool1D_layer(Res50208, 1, Max93549), 
LZer39944 = zero_padding1D_layer(Max93549, 2, 0, Zer39944), 
LCon16384 = concatenate_layer([Zer39944,[[[0.1411, 0.3399, 0.4597], [0.6381, 0.5603, 0.5116], [0.2193, 0.4801, 0.9441], [0.37, 0.7908, 0.5582]]]], 2, Con16384), 
LMax18608 = maximum_layer([[[[0.1059, 0.8291]]], [[[0.5474, 0.3918]]]], Max18608), 
LZer38171 = zero_padding1D_layer(Max18608, 2, 0, Zer38171), 
LCon31083 = concatenate_layer([Zer38171,[[[0.6467, 0.7243], [0.9618, 0.9057], [0.4082, 0.5431]]]], 2, Con31083), 
LAve21634 = average_layer([[[[[0.5144, 0.5892], [0.8061, 0.1559]]]], [[[[0.0485, 0.8716], [0.1733, 0.9707]]]]], Ave21634), 
LRes78784 = reshape_layer(Ave21634, [1, 4], Res78784), 
LZer396 = zero_padding1D_layer(Res78784, 1, 1, Zer396), 
LDot70433 = dot_layer(Con31083,Zer396, 1, 1, Dot70433), 
LMax57778 = maximum_layer([[[[0.2529], [0.4517]]], [[[0.5846], [0.8576]]]], Max57778), 
LZer63533 = zero_padding1D_layer(Max57778, 2, 0, Zer63533), 
LCon78786 = concatenate_layer([Zer63533,[[[0.1877, 0.7276, 0.6509], [0.9746, 0.5509, 0.2806], [0.9935, 0.7644, 0.5978], [0.7044, 0.5821, 0.2482]]]], 2, Con78786), 
LAve96795 = average_layer([Dot70433,Con78786], Ave96795), 
LAdd81145 = add_layer([Con16384,Ave96795], Add81145), 
exec_layers([LZer49508,LRes93984,LLST30786,LRes50208,LMax93549,LZer39944,LCon16384,LMax18608,LZer38171,LCon31083,LAve21634,LRes78784,LZer396,LDot70433,LMax57778,LZer63533,LCon78786,LAve96795,LAdd81145],["Zer49508","Res93984","LST30786","Res50208","Max93549","Zer39944","Con16384","Max18608","Zer38171","Con31083","Ave21634","Res78784","Zer396","Dot70433","Max57778","Zer63533","Con78786","Ave96795","Add81145"],Add81145,"Add81145")

Actual (Unparsed): [[[0.0000000, 0.2349500, 0.7037000, 0.7851500], [0.0000000, 1.1254000, 0.8357500, 0.6519000], [1.4250773, 1.0672993, 1.0977967, 1.5138910], [1.5561634, 1.0529617, 1.3036106, 0.9373904]]]

Expected (Unparsed): [[[0.0,0.23495,0.7037,0.78515],[0.0,1.1254,0.83575,0.6519],[1.4250773593586956,1.06729936,1.09779673,1.51389097],[1.556163455918901,1.05296164,1.303610645,0.937390405]]]

Actual:   [[[0, 0.235, 0.7037, 0.7852], [0, 1.1254, 0.8358, 0.6519], [1.4251, 1.0673, 1.0978, 1.5139], [1.5562, 1.053, 1.3037, 0.9374]]]

Expected: [[[0, 0.235, 0.7037, 0.7852], [0, 1.1254, 0.8358, 0.6519], [1.4251, 1.0673, 1.0978, 1.5139], [1.5562, 1.053, 1.3037, 0.9374]]]