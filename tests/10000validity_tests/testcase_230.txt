import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add36020 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Add36020 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Dot14893 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot14893 = tf.keras.layers.Input(shape=([2, 3]))
in0Dot10914 = tf.keras.layers.Input(shape=([3]))
in1Dot10914 = tf.keras.layers.Input(shape=([3]))
in0Con88118 = tf.keras.layers.Input(shape=([2]))
in0Con40823 = tf.keras.layers.Input(shape=([5]))
in0Mul53081 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul53081 = tf.keras.layers.Input(shape=([1, 1]))

Add36020 = keras.layers.Add(name = 'Add36020', )([in0Add36020,in1Add36020])
Res18184 = keras.layers.Reshape((2, 2, 2), name = 'Res18184', )(Add36020)
Res38342 = keras.layers.Reshape((2, 4), name = 'Res38342', )(Res18184)
Fla12893 = keras.layers.Flatten(name = 'Fla12893', )(Res38342)
Dot14893 = keras.layers.Dot(axes=(1, 1), name = 'Dot14893', )([in0Dot14893,in1Dot14893])
Glo37864 = keras.layers.GlobalMaxPool1D(name = 'Glo37864', )(Dot14893)
Dot10914 = keras.layers.Dot(axes=(1, 1), name = 'Dot10914', )([in0Dot10914,in1Dot10914])
Con88118 = keras.layers.Concatenate(axis=1, name = 'Con88118', )([Dot10914,in0Con88118])
Min16397 = keras.layers.Minimum(name = 'Min16397', )([Glo37864,Con88118])
Con40823 = keras.layers.Concatenate(axis=1, name = 'Con40823', )([Min16397,in0Con40823])
Mul91975 = keras.layers.Multiply(name = 'Mul91975', )([Fla12893,Con40823])
Res19392 = keras.layers.Reshape((8, 1), name = 'Res19392', )(Mul91975)
Mul53081 = keras.layers.Multiply(name = 'Mul53081', )([in0Mul53081,in1Mul53081])
Zer52497 = keras.layers.ZeroPadding1D(padding=((7, 0)), name = 'Zer52497', )(Mul53081)
Max97356 = keras.layers.Maximum(name = 'Max97356', )([Res19392,Zer52497])
model = tf.keras.models.Model(inputs=[in0Add36020,in1Add36020,in0Dot14893,in1Dot14893,in0Dot10914,in1Dot10914,in0Con88118,in0Con40823,in0Mul53081,in1Mul53081], outputs=Max97356)
in0Add36020 = tf.constant([[[[[0.5563, 0.0222]], [[0.9274, 0.8672]]], [[[0.945, 0.7777]], [[0.1274, 0.2039]]]]])
in1Add36020 = tf.constant([[[[[0.5059, 0.0499]], [[0.5509, 0.9377]]], [[[0.1393, 0.3908]], [[0.1615, 0.4249]]]]])
in0Dot14893 = tf.constant([[[0.3403, 0.6458, 0.1104], [0.593, 0.8337, 0.6656]]])
in1Dot14893 = tf.constant([[[0.0907, 0.7271, 0.5569], [0.9981, 0.8361, 0.4618]]])
in0Dot10914 = tf.constant([[0.2507, 0.9899, 0.6862]])
in1Dot10914 = tf.constant([[0.2289, 0.2159, 0.9113]])
in0Con88118 = tf.constant([[0.1372, 0.6227]])
in0Con40823 = tf.constant([[0.5639, 0.0378, 0.3302, 0.0903, 0.5638]])
in0Mul53081 = tf.constant([[[0.0188]]])
in1Mul53081 = tf.constant([[[0.3027]]])
print (np.array2string(model.predict([in0Add36020,in1Add36020,in0Dot14893,in1Dot14893,in0Dot10914,in1Dot10914,in0Con88118,in0Con40823,in0Mul53081,in1Mul53081],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max97356.png')

LAdd36020 = add_layer([[[[[[0.5563, 0.0222]], [[0.9274, 0.8672]]], [[[0.945, 0.7777]], [[0.1274, 0.2039]]]]], [[[[[0.5059, 0.0499]], [[0.5509, 0.9377]]], [[[0.1393, 0.3908]], [[0.1615, 0.4249]]]]]], Add36020), 
LRes18184 = reshape_layer(Add36020, [2, 2, 2], Res18184), 
LRes38342 = reshape_layer(Res18184, [2, 4], Res38342), 
LFla12893 = flatten_layer(Res38342, Fla12893), 
LDot14893 = dot_layer([[[0.3403, 0.6458, 0.1104], [0.593, 0.8337, 0.6656]]], [[[0.0907, 0.7271, 0.5569], [0.9981, 0.8361, 0.4618]]], 1, 1, Dot14893), 
LGlo37864 = global_max_pool1D_layer(Dot14893, Glo37864), 
LDot10914 = dot_layer([[0.2507, 0.9899, 0.6862]], [[0.2289, 0.2159, 0.9113]], 1, 1, Dot10914), 
LCon88118 = concatenate_layer([Dot10914,[[0.1372, 0.6227]]], 1, Con88118), 
LMin16397 = minimum_layer([Glo37864,Con88118], Min16397), 
LCon40823 = concatenate_layer([Min16397,[[0.5639, 0.0378, 0.3302, 0.0903, 0.5638]]], 1, Con40823), 
LMul91975 = multiply_layer([Fla12893,Con40823], Mul91975), 
LRes19392 = reshape_layer(Mul91975, [8, 1], Res19392), 
LMul53081 = multiply_layer([[[[0.0188]]], [[[0.3027]]]], Mul53081), 
LZer52497 = zero_padding1D_layer(Mul53081, 7, 0, Zer52497), 
LMax97356 = maximum_layer([Res19392,Zer52497], Max97356), 
exec_layers([LAdd36020,LRes18184,LRes38342,LFla12893,LDot14893,LGlo37864,LDot10914,LCon88118,LMin16397,LCon40823,LMul91975,LRes19392,LMul53081,LZer52497,LMax97356],["Add36020","Res18184","Res38342","Fla12893","Dot14893","Glo37864","Dot10914","Con88118","Min16397","Con40823","Mul91975","Res19392","Mul53081","Zer52497","Max97356"],Max97356,"Max97356")

Actual (Unparsed): [[[0.9460909], [0.0098921], [0.9205374], [1.0177831], [0.0409865], [0.3858387], [0.0260877], [0.3545174]]]

Expected (Unparsed): [[[0.9460909498660001],[0.009892119999999999],[0.92053741],[1.0177831099999999],[0.04098654],[0.3858386999999999],[0.026087670000000007],[0.35451744]]]

Actual:   [[[0.9461], [0.0099], [0.9206], [1.0178], [0.041], [0.3859], [0.0261], [0.3546]]]

Expected: [[[0.9461], [0.0099], [0.9206], [1.0178], [0.041], [0.3859], [0.0261], [0.3546]]]