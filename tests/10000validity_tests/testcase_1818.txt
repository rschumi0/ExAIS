import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max81515 = tf.keras.layers.Input(shape=([2, 2]))
in1Max81515 = tf.keras.layers.Input(shape=([2, 2]))
in0Con16060 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Add39245 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Add39245 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Sep92045 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con72198 = tf.keras.layers.Input(shape=([7]))

Max81515 = keras.layers.Maximum(name = 'Max81515', )([in0Max81515,in1Max81515])
Res2618 = keras.layers.Reshape((2, 2, 1), name = 'Res2618', )(Max81515)
Res34794 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res34794', )(Res2618)
Con16060 = keras.layers.Concatenate(axis=4, name = 'Con16060', )([Res34794,in0Con16060])
Add39245 = keras.layers.Add(name = 'Add39245', )([in0Add39245,in1Add39245])
Zer41637 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (0, 0)), name = 'Zer41637', )(Add39245)
Max35642 = keras.layers.Maximum(name = 'Max35642', )([Con16060,Zer41637])
Res3000 = keras.layers.Reshape((2, 2, 2), name = 'Res3000', )(Max35642)
Res26199 = keras.layers.Reshape((2, 4), name = 'Res26199', )(Res3000)
Fla5482 = keras.layers.Flatten(name = 'Fla5482', )(Res26199)
Sep92045 = keras.layers.SeparableConv2D(2, (2, 1),strides=(1, 1), padding='same', name = 'Sep92045', )(in0Sep92045)
Res6455 = keras.layers.Reshape((2, 1, 2, 1), name = 'Res6455', )(Sep92045)
Glo34289 = keras.layers.GlobalMaxPool3D(name = 'Glo34289', )(Res6455)
Con72198 = keras.layers.Concatenate(axis=1, name = 'Con72198', )([Glo34289,in0Con72198])
Mul74172 = keras.layers.Multiply(name = 'Mul74172', )([Fla5482,Con72198])
model = tf.keras.models.Model(inputs=[in0Max81515,in1Max81515,in0Con16060,in0Add39245,in1Add39245,in0Sep92045,in0Con72198], outputs=Mul74172)
w = model.get_layer('Sep92045').get_weights() 
w[0] = np.array([[[[0.6512]]], [[[0.3282]]]])
w[1] = np.array([[[[0.4316, 0.378]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep92045').set_weights(w) 
in0Max81515 = tf.constant([[[0.4159, 0.1644], [0.6997, 0.853]]])
in1Max81515 = tf.constant([[[0.4761, 0.6576], [0.6254, 0.284]]])
in0Con16060 = tf.constant([[[[[0.5007]], [[0.1695]]], [[[0.3614]], [[0.1008]]]]])
in0Add39245 = tf.constant([[[[[0.9974, 0.4772]], [[0.4217, 0.3764]]]]])
in1Add39245 = tf.constant([[[[[0.2003, 0.1605]], [[0.6216, 0.5522]]]]])
in0Sep92045 = tf.constant([[[[0.5624]], [[0.6281]]]])
in0Con72198 = tf.constant([[0.5722, 0.9642, 0.2974, 0.8029, 0.8666, 0.9264, 0.6621]])
print (np.array2string(model.predict([in0Max81515,in1Max81515,in0Con16060,in0Add39245,in1Add39245,in0Sep92045,in0Con72198],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul74172.png')

LMax81515 = maximum_layer([[[[0.4159, 0.1644], [0.6997, 0.853]]], [[[0.4761, 0.6576], [0.6254, 0.284]]]], Max81515), 
LRes2618 = reshape_layer(Max81515, [2, 2, 1], Res2618), 
LRes34794 = reshape_layer(Res2618, [2, 2, 1, 1], Res34794), 
LCon16060 = concatenate_layer([Res34794,[[[[[0.5007]], [[0.1695]]], [[[0.3614]], [[0.1008]]]]]], 4, Con16060), 
LAdd39245 = add_layer([[[[[[0.9974, 0.4772]], [[0.4217, 0.3764]]]]], [[[[[0.2003, 0.1605]], [[0.6216, 0.5522]]]]]], Add39245), 
LZer41637 = zero_padding3D_layer(Add39245, 1, 0, 0, 0, 0, 0, Zer41637), 
LMax35642 = maximum_layer([Con16060,Zer41637], Max35642), 
LRes3000 = reshape_layer(Max35642, [2, 2, 2], Res3000), 
LRes26199 = reshape_layer(Res3000, [2, 4], Res26199), 
LFla5482 = flatten_layer(Res26199, Fla5482), 
LSep92045 = separable_conv2D_layer([[[[0.5624]], [[0.6281]]]], 2, 1,[[[[[0.6512]]], [[[0.3282]]]],[[[[0.4316, 0.378]]]]],[0, 0], 1, 1, true, Sep92045), 
LRes6455 = reshape_layer(Sep92045, [2, 1, 2, 1], Res6455), 
LGlo34289 = global_max_pool3D_layer(Res6455, Glo34289), 
LCon72198 = concatenate_layer([Glo34289,[[0.5722, 0.9642, 0.2974, 0.8029, 0.8666, 0.9264, 0.6621]]], 1, Con72198), 
LMul74172 = multiply_layer([Fla5482,Con72198], Mul74172), 
exec_layers([LMax81515,LRes2618,LRes34794,LCon16060,LAdd39245,LZer41637,LMax35642,LRes3000,LRes26199,LFla5482,LSep92045,LRes6455,LGlo34289,LCon72198,LMul74172],["Max81515","Res2618","Res34794","Con16060","Add39245","Zer41637","Max35642","Res3000","Res26199","Fla5482","Sep92045","Res6455","Glo34289","Con72198","Mul74172"],Mul74172,"Mul74172")

Actual (Unparsed): [[0.1176148, 0.2865005, 0.6340579, 0.0504093, 0.9616333, 0.5526308, 0.9665131, 0.6148261]]

Expected (Unparsed): [[0.11761481211994798,0.28650054,0.6340579199999999,0.050409300000000004,0.96163333,0.5526308200000001,0.9665131200000001,0.6148260600000001]]

Actual:   [[0.1177, 0.2866, 0.6341, 0.0505, 0.9617, 0.5527, 0.9666, 0.6149]]

Expected: [[0.1177, 0.2866, 0.6341, 0.0505, 0.9617, 0.5527, 0.9666, 0.6149]]