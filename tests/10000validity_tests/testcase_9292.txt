import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot98923 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot98923 = tf.keras.layers.Input(shape=([3, 2]))
in0Fla33561 = tf.keras.layers.Input(shape=([1, 1, 4]))
in0Sub57004 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub57004 = tf.keras.layers.Input(shape=([3, 2]))
in0Glo25231 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Con19631 = tf.keras.layers.Input(shape=([3]))
in0Con9699 = tf.keras.layers.Input(shape=([14]))

Dot98923 = keras.layers.Dot(axes=(2, 2), name = 'Dot98923', )([in0Dot98923,in1Dot98923])
Res85051 = keras.layers.Reshape((3, 3, 1), name = 'Res85051', )(Dot98923)
Con26815 = keras.layers.Conv2DTranspose(2, (3, 3),strides=(1, 1), padding='same', name = 'Con26815', )(Res85051)
Res78888 = keras.layers.Reshape((3, 6), name = 'Res78888', )(Con26815)
Fla12883 = keras.layers.Flatten(name = 'Fla12883', )(Res78888)
Fla33561 = keras.layers.Flatten(name = 'Fla33561', )(in0Fla33561)
Sub57004 = keras.layers.Subtract(name = 'Sub57004', )([in0Sub57004,in1Sub57004])
LST68748 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST68748', )(Sub57004)
Glo25231 = keras.layers.GlobalMaxPool3D(name = 'Glo25231', )(in0Glo25231)
Mul40544 = keras.layers.Multiply(name = 'Mul40544', )([LST68748,Glo25231])
Con19631 = keras.layers.Concatenate(axis=1, name = 'Con19631', )([Mul40544,in0Con19631])
Mul92335 = keras.layers.Multiply(name = 'Mul92335', )([Fla33561,Con19631])
Con9699 = keras.layers.Concatenate(axis=1, name = 'Con9699', )([Mul92335,in0Con9699])
Add3480 = keras.layers.Add(name = 'Add3480', )([Fla12883,Con9699])
model = tf.keras.models.Model(inputs=[in0Dot98923,in1Dot98923,in0Fla33561,in0Sub57004,in1Sub57004,in0Glo25231,in0Con19631,in0Con9699], outputs=Add3480)
w = model.get_layer('Con26815').get_weights() 
w[0] = np.array([[[[0.5435], [0.356]], [[0.3697], [0.2279]], [[0.9003], [0.0359]]], [[[0.3563], [0.6618]], [[0.5089], [0.2929]], [[0.3365], [0.9567]]], [[[0.6793], [0.1102]], [[0.1469], [0.8717]], [[0.2184], [0.5805]]]])
w[1] = np.array([0, 0])
model.get_layer('Con26815').set_weights(w) 
w = model.get_layer('LST68748').get_weights() 
w[0] = np.array([[1, 5, 10, 6], [4, 4, 7, 6]])
w[1] = np.array([[8, 9, 9, 10]])
w[2] = np.array([6, 4, 8, 10])
model.get_layer('LST68748').set_weights(w) 
in0Dot98923 = tf.constant([[[0.4669, 0.7367], [0.7021, 0.1155], [0.8681, 0.7094]]])
in1Dot98923 = tf.constant([[[0.2667, 0.7869], [0.8926, 0.7676], [0.1272, 0.8053]]])
in0Fla33561 = tf.constant([[[[1.2143, 1.5988, 1.8754, 1.4579]]]])
in0Sub57004 = tf.constant([[[0.0771, 0.6314], [0.9941, 0.9273], [0.5199, 0.6611]]])
in1Sub57004 = tf.constant([[[0.3029, 0.662], [0.659, 0.1629], [0.9019, 0.8935]]])
in0Glo25231 = tf.constant([[[[[1.6082], [1.0759]], [[1.1862], [1.5673]]], [[[1.3559], [1.3756]], [[1.8831], [1.7494]]]]])
in0Con19631 = tf.constant([[0.657, 0.3983, 0.1815]])
in0Con9699 = tf.constant([[0.4133, 0.04, 0.3932, 0.5431, 0.1178, 0.3475, 0.8793, 0.6506, 0.1417, 0.3002, 0.3803, 0.5084, 0.084, 0.4143]])
print (np.array2string(model.predict([in0Dot98923,in1Dot98923,in0Fla33561,in0Sub57004,in1Sub57004,in0Glo25231,in0Con19631,in0Con9699],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add3480.png')

LDot98923 = dot_layer([[[0.4669, 0.7367], [0.7021, 0.1155], [0.8681, 0.7094]]], [[[0.2667, 0.7869], [0.8926, 0.7676], [0.1272, 0.8053]]], 2, 2, Dot98923), 
LRes85051 = reshape_layer(Dot98923, [3, 3, 1], Res85051), 
LCon26815 = conv2D_transpose_layer(Res85051, 3, 3,[[[[0.5435], [0.356]], [[0.3697], [0.2279]], [[0.9003], [0.0359]]], [[[0.3563], [0.6618]], [[0.5089], [0.2929]], [[0.3365], [0.9567]]], [[[0.6793], [0.1102]], [[0.1469], [0.8717]], [[0.2184], [0.5805]]]],[0, 0], 1, 1, true, Con26815), 
LRes78888 = reshape_layer(Con26815, [3, 6], Res78888), 
LFla12883 = flatten_layer(Res78888, Fla12883), 
LFla33561 = flatten_layer([[[[1.2143, 1.5988, 1.8754, 1.4579]]]], Fla33561), 
LSub57004 = subtract_layer([[[0.0771, 0.6314], [0.9941, 0.9273], [0.5199, 0.6611]]], [[[0.3029, 0.662], [0.659, 0.1629], [0.9019, 0.8935]]], Sub57004), 
LLST68748 = lstm_layer(Sub57004,[[1, 5, 10, 6], [4, 4, 7, 6]],[[8, 9, 9, 10]],[6, 4, 8, 10], LST68748), 
LGlo25231 = global_max_pool3D_layer([[[[[1.6082], [1.0759]], [[1.1862], [1.5673]]], [[[1.3559], [1.3756]], [[1.8831], [1.7494]]]]], Glo25231), 
LMul40544 = multiply_layer([LST68748,Glo25231], Mul40544), 
LCon19631 = concatenate_layer([Mul40544,[[0.657, 0.3983, 0.1815]]], 1, Con19631), 
LMul92335 = multiply_layer([Fla33561,Con19631], Mul92335), 
LCon9699 = concatenate_layer([Mul92335,[[0.4133, 0.04, 0.3932, 0.5431, 0.1178, 0.3475, 0.8793, 0.6506, 0.1417, 0.3002, 0.3803, 0.5084, 0.084, 0.4143]]], 1, Con9699), 
LAdd3480 = add_layer([Fla12883,Con9699], Add3480), 
exec_layers([LDot98923,LRes85051,LCon26815,LRes78888,LFla12883,LFla33561,LSub57004,LLST68748,LGlo25231,LMul40544,LCon19631,LMul92335,LCon9699,LAdd3480],["Dot98923","Res85051","Con26815","Res78888","Fla12883","Fla33561","Sub57004","LST68748","Glo25231","Mul40544","Con19631","Mul92335","Con9699","Add3480"],Add3480,"Add3480")

Actual (Unparsed): [[3.4752364, 2.2247841, 2.3303143, 1.8958930, 1.7873965, 1.2381087, 2.5693801, 2.4697992, 2.9511392, 2.8524614, 2.9630781, 2.7302176, 1.5405032, 1.7259813, 1.8500643, 2.9066788, 1.0579125, 2.4504316]]

Expected (Unparsed): [[3.475236362611952,2.2247841362000003,2.330314325214,1.8958930023100002,1.7873965229779998,1.23810873428,2.569380122499,2.469799277007,2.951139276589,2.852461384761,2.963078159936,2.730217632034,1.540503205163,1.725981292263,1.8500643303500002,2.906678856979,1.0579124581430002,2.4504316664449997]]

Actual:   [[3.4753, 2.2248, 2.3304, 1.8959, 1.7874, 1.2382, 2.5694, 2.4698, 2.9512, 2.8525, 2.9631, 2.7303, 1.5406, 1.726, 1.8501, 2.9067, 1.058, 2.4505]]

Expected: [[3.4753, 2.2248, 2.3304, 1.8959, 1.7874, 1.2382, 2.5694, 2.4698, 2.9512, 2.8525, 2.9631, 2.7303, 1.5406, 1.726, 1.8501, 2.9067, 1.058, 2.4505]]