import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Cro38800 = tf.keras.layers.Input(shape=([1, 2, 3, 2]))
in0Con21551 = tf.keras.layers.Input(shape=([3, 1]))
in0Per88482 = tf.keras.layers.Input(shape=([3, 3]))
in0Sub2877 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub2877 = tf.keras.layers.Input(shape=([3, 2]))
in0Con79907 = tf.keras.layers.Input(shape=([3, 1]))

Cro38800 = keras.layers.Cropping3D(cropping=((0, 0), (1, 0), (2, 0)), name = 'Cro38800', )(in0Cro38800)
Res92365 = keras.layers.Reshape((1, 1, 2), name = 'Res92365', )(Cro38800)
PRe168 = keras.layers.PReLU(name = 'PRe168', )(Res92365)
Res66219 = keras.layers.Reshape((1, 2), name = 'Res66219', )(PRe168)
Zer87646 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer87646', )(Res66219)
Con21551 = keras.layers.Concatenate(axis=2, name = 'Con21551', )([Zer87646,in0Con21551])
Per88482 = keras.layers.Permute((1,2), name = 'Per88482',)(in0Per88482)
Sub2877 = keras.layers.Subtract(name = 'Sub2877', )([in0Sub2877,in1Sub2877])
Con79907 = keras.layers.Concatenate(axis=2, name = 'Con79907', )([Sub2877,in0Con79907])
Ave7704 = keras.layers.Average(name = 'Ave7704', )([Per88482,Con79907])
Add84777 = keras.layers.Add(name = 'Add84777', )([Con21551,Ave7704])
Sof34032 = keras.layers.Softmax(axis=1, name = 'Sof34032', )(Add84777)
model = tf.keras.models.Model(inputs=[in0Cro38800,in0Con21551,in0Per88482,in0Sub2877,in1Sub2877,in0Con79907], outputs=Sof34032)
w = model.get_layer('PRe168').get_weights() 
w[0] = np.array([[[0.1434, 0.1927]]])
model.get_layer('PRe168').set_weights(w) 
in0Cro38800 = tf.constant([[[[[1.1187, 1.4781], [1.0608, 1.8683], [1.4607, 1.5529]], [[1.8413, 1.7713], [1.8951, 1.7251], [1.4729, 1.7831]]]]])
in0Con21551 = tf.constant([[[0.4596], [0.5438], [0.838]]])
in0Per88482 = tf.constant([[[1.1927, 1.7503, 1.7851], [1.5348, 1.3984, 1.5065], [1.5375, 1.2564, 1.7842]]])
in0Sub2877 = tf.constant([[[0.1166, 0.4102], [0.872, 0.9092], [0.4077, 0.0722]]])
in1Sub2877 = tf.constant([[[0.2997, 0.7804], [0.4274, 0.1794], [0.8036, 0.3928]]])
in0Con79907 = tf.constant([[[0.8102], [0.769], [0.4053]]])
print (np.array2string(model.predict([in0Cro38800,in0Con21551,in0Per88482,in0Sub2877,in1Sub2877,in0Con79907],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sof34032.png')

LCro38800 = cropping3D_layer([[[[[1.1187, 1.4781], [1.0608, 1.8683], [1.4607, 1.5529]], [[1.8413, 1.7713], [1.8951, 1.7251], [1.4729, 1.7831]]]]], 0, 0, 1, 0, 2, 0, Cro38800), 
LRes92365 = reshape_layer(Cro38800, [1, 1, 2], Res92365), 
LPRe168 = prelu_layer(Res92365, [[[0.1434, 0.1927]]], PRe168), 
LRes66219 = reshape_layer(PRe168, [1, 2], Res66219), 
LZer87646 = zero_padding1D_layer(Res66219, 2, 0, Zer87646), 
LCon21551 = concatenate_layer([Zer87646,[[[0.4596], [0.5438], [0.838]]]], 2, Con21551), 
LPer88482 = permute_layer([[[1.1927, 1.7503, 1.7851], [1.5348, 1.3984, 1.5065], [1.5375, 1.2564, 1.7842]]], 1,2, Per88482), 
LSub2877 = subtract_layer([[[0.1166, 0.4102], [0.872, 0.9092], [0.4077, 0.0722]]], [[[0.2997, 0.7804], [0.4274, 0.1794], [0.8036, 0.3928]]], Sub2877), 
LCon79907 = concatenate_layer([Sub2877,[[[0.8102], [0.769], [0.4053]]]], 2, Con79907), 
LAve7704 = average_layer([Per88482,Con79907], Ave7704), 
LAdd84777 = add_layer([Con21551,Ave7704], Add84777), 
LSof34032 = softmax_layer(Add84777, 1, Sof34032), 
exec_layers([LCro38800,LRes92365,LPRe168,LRes66219,LZer87646,LCon21551,LPer88482,LSub2877,LCon79907,LAve7704,LAdd84777,LSof34032],["Cro38800","Res92365","PRe168","Res66219","Zer87646","Con21551","Per88482","Sub2877","Con79907","Ave7704","Add84777","Sof34032"],Sof34032,"Sof34032")

Actual (Unparsed): [[[0.1372971, 0.1385626, 0.3206221], [0.2229722, 0.2014160, 0.2972470], [0.6397307, 0.6600214, 0.3821309]]]

Expected (Unparsed): [[[0.1372971073732481,0.1385626104573147,0.32062213192382577],[0.2229722322441096,0.20141597251084786,0.2972469487584744],[0.6397306603826424,0.6600214170318375,0.3821309193176998]]]

Actual:   [[[0.1373, 0.1386, 0.3207], [0.223, 0.2015, 0.2973], [0.6398, 0.6601, 0.3822]]]

Expected: [[[0.1373, 0.1386, 0.3207], [0.223, 0.2015, 0.2973], [0.6398, 0.6601, 0.3822]]]