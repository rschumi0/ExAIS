import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0GRU96936 = tf.keras.layers.Input(shape=([2, 2]))
in0Cro15732 = tf.keras.layers.Input(shape=([3, 1, 2, 3]))
in0Con4417 = tf.keras.layers.Input(shape=([9]))
in0Add67925 = tf.keras.layers.Input(shape=([1, 2]))
in1Add67925 = tf.keras.layers.Input(shape=([1, 2]))

GRU96936 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU96936', )(in0GRU96936)
Res4145 = keras.layers.Reshape((1, 1), name = 'Res4145', )(GRU96936)
Res1835 = keras.layers.Reshape((1, 1, 1), name = 'Res1835', )(Res4145)
Zer42185 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer42185', )(Res1835)
Loc24903 = keras.layers.LocallyConnected2D(2, (2, 1),strides=(1, 1), name = 'Loc24903', )(Zer42185)
Res99354 = keras.layers.Reshape((2, 6), name = 'Res99354', )(Loc24903)
Fla50890 = keras.layers.Flatten(name = 'Fla50890', )(Res99354)
Cro15732 = keras.layers.Cropping3D(cropping=((0, 1), (0, 0), (0, 0)), name = 'Cro15732', )(in0Cro15732)
Res11260 = keras.layers.Reshape((2, 1, 6), name = 'Res11260', )(Cro15732)
Loc42762 = keras.layers.LocallyConnected2D(4, (1, 1),strides=(5, 1), name = 'Loc42762', )(Res11260)
Res63431 = keras.layers.Reshape((1, 4), name = 'Res63431', )(Loc42762)
GRU44366 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU44366', )(Res63431)
Con4417 = keras.layers.Concatenate(axis=1, name = 'Con4417', )([GRU44366,in0Con4417])
Ave45904 = keras.layers.Average(name = 'Ave45904', )([Fla50890,Con4417])
Res11774 = keras.layers.Reshape((12, 1), name = 'Res11774', )(Ave45904)
Res77279 = keras.layers.Reshape((12, 1, 1), name = 'Res77279', )(Res11774)
Zer11105 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer11105', )(Res77279)
Add67925 = keras.layers.Add(name = 'Add67925', )([in0Add67925,in1Add67925])
Res9797 = keras.layers.Reshape((1, 2, 1), name = 'Res9797', )(Add67925)
Glo29034 = keras.layers.GlobalAveragePooling2D(name = 'Glo29034', )(Res9797)
Res97497 = keras.layers.Reshape((1, 1), name = 'Res97497', )(Glo29034)
Res85123 = keras.layers.Reshape((1, 1, 1), name = 'Res85123', )(Res97497)
Up_71902 = keras.layers.UpSampling2D(size=(1, 2), name = 'Up_71902', )(Res85123)
Zer9040 = keras.layers.ZeroPadding2D(padding=((11, 0), (1, 0)), name = 'Zer9040', )(Up_71902)
Ave77283 = keras.layers.Average(name = 'Ave77283', )([Zer11105,Zer9040])
model = tf.keras.models.Model(inputs=[in0GRU96936,in0Cro15732,in0Con4417,in0Add67925,in1Add67925], outputs=Ave77283)
w = model.get_layer('GRU96936').get_weights() 
w[0] = np.array([[4, 5, 6], [3, 5, 6]])
w[1] = np.array([[7, 10, 8]])
w[2] = np.array([[1, 9, 7], [5, 3, 5]])
model.get_layer('GRU96936').set_weights(w) 
w = model.get_layer('Loc24903').get_weights() 
w[0] = np.array([[[0.9584, 0.3006], [0.8803, 0.0733]], [[0.0341, 0.4688], [0.0976, 0.3416]], [[0.2613, 0.1353], [0.1007, 0.9345]], [[0.5167, 0.9432], [0.1728, 0.8509]], [[0.584, 0.7087], [0.7366, 0.6018]], [[0.5512, 0.2252], [0.565, 0.4405]]])
w[1] = np.array([[[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0]]])
model.get_layer('Loc24903').set_weights(w) 
w = model.get_layer('Loc42762').get_weights() 
w[0] = np.array([[[0.2944, 0.1929, 0.4363, 0.0545], [0.1112, 0.8498, 0.3628, 0.1094], [0.8697, 0.3074, 0.0413, 0.2173], [0.5954, 0.6923, 0.6302, 0.2683], [0.5028, 0.2293, 0.9427, 0.461], [0.7352, 0.4763, 0.1783, 0.6488]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc42762').set_weights(w) 
w = model.get_layer('GRU44366').get_weights() 
w[0] = np.array([[9, 1, 4, 10, 2, 2, 4, 5, 6], [2, 6, 5, 10, 8, 9, 9, 4, 4], [5, 1, 2, 10, 5, 3, 9, 10, 6], [1, 4, 7, 3, 10, 9, 10, 4, 4]])
w[1] = np.array([[4, 6, 8, 6, 5, 4, 6, 10, 3], [5, 2, 7, 5, 8, 2, 4, 7, 10], [2, 4, 5, 3, 7, 10, 8, 8, 4]])
w[2] = np.array([[2, 6, 7, 9, 3, 7, 1, 1, 3], [7, 8, 10, 3, 2, 10, 5, 8, 6]])
model.get_layer('GRU44366').set_weights(w) 
in0GRU96936 = tf.constant([[[10, 9], [1, 2]]])
in0Cro15732 = tf.constant([[[[[1.8255, 1.7486, 1.2282], [1.8539, 1.7769, 1.3082]]], [[[1.5682, 1.3304, 1.4478], [1.3315, 1.0116, 1.4645]]], [[[1.6113, 1.8126, 1.3417], [1.5088, 1.1086, 1.4909]]]]])
in0Con4417 = tf.constant([[0.2864, 0.389, 0.1428, 0.3925, 0.8164, 0.7847, 0.4308, 0.914, 0.7125]])
in0Add67925 = tf.constant([[[0.2144, 0.1754]]])
in1Add67925 = tf.constant([[[0.7825, 0.5397]]])
print (np.array2string(model.predict([in0GRU96936,in0Cro15732,in0Con4417,in0Add67925,in1Add67925],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave77283.png')

LGRU96936 = gru_layer([[[10, 9], [1, 2]]],[[4, 5, 6], [3, 5, 6]],[[7, 10, 8]],[[1, 9, 7], [5, 3, 5]], true, GRU96936), 
LRes4145 = reshape_layer(GRU96936, [1, 1], Res4145), 
LRes1835 = reshape_layer(Res4145, [1, 1, 1], Res1835), 
LZer42185 = zero_padding2D_layer(Res1835, 1, 1, 1, 1, Zer42185), 
LLoc24903 = locally_connected2D_layer(Zer42185, 2, 1,[[[0.9584, 0.3006], [0.8803, 0.0733]], [[0.0341, 0.4688], [0.0976, 0.3416]], [[0.2613, 0.1353], [0.1007, 0.9345]], [[0.5167, 0.9432], [0.1728, 0.8509]], [[0.584, 0.7087], [0.7366, 0.6018]], [[0.5512, 0.2252], [0.565, 0.4405]]],[[[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0]]], 1, 1, Loc24903), 
LRes99354 = reshape_layer(Loc24903, [2, 6], Res99354), 
LFla50890 = flatten_layer(Res99354, Fla50890), 
LCro15732 = cropping3D_layer([[[[[1.8255, 1.7486, 1.2282], [1.8539, 1.7769, 1.3082]]], [[[1.5682, 1.3304, 1.4478], [1.3315, 1.0116, 1.4645]]], [[[1.6113, 1.8126, 1.3417], [1.5088, 1.1086, 1.4909]]]]], 0, 1, 0, 0, 0, 0, Cro15732), 
LRes11260 = reshape_layer(Cro15732, [2, 1, 6], Res11260), 
LLoc42762 = locally_connected2D_layer(Res11260, 1, 1,[[[0.2944, 0.1929, 0.4363, 0.0545], [0.1112, 0.8498, 0.3628, 0.1094], [0.8697, 0.3074, 0.0413, 0.2173], [0.5954, 0.6923, 0.6302, 0.2683], [0.5028, 0.2293, 0.9427, 0.461], [0.7352, 0.4763, 0.1783, 0.6488]]],[[[0, 0, 0, 0]]], 5, 1, Loc42762), 
LRes63431 = reshape_layer(Loc42762, [1, 4], Res63431), 
LGRU44366 = gru_layer(Res63431,[[9, 1, 4, 10, 2, 2, 4, 5, 6], [2, 6, 5, 10, 8, 9, 9, 4, 4], [5, 1, 2, 10, 5, 3, 9, 10, 6], [1, 4, 7, 3, 10, 9, 10, 4, 4]],[[4, 6, 8, 6, 5, 4, 6, 10, 3], [5, 2, 7, 5, 8, 2, 4, 7, 10], [2, 4, 5, 3, 7, 10, 8, 8, 4]],[[2, 6, 7, 9, 3, 7, 1, 1, 3], [7, 8, 10, 3, 2, 10, 5, 8, 6]], true, GRU44366), 
LCon4417 = concatenate_layer([GRU44366,[[0.2864, 0.389, 0.1428, 0.3925, 0.8164, 0.7847, 0.4308, 0.914, 0.7125]]], 1, Con4417), 
LAve45904 = average_layer([Fla50890,Con4417], Ave45904), 
LRes11774 = reshape_layer(Ave45904, [12, 1], Res11774), 
LRes77279 = reshape_layer(Res11774, [12, 1, 1], Res77279), 
LZer11105 = zero_padding2D_layer(Res77279, 0, 0, 2, 0, Zer11105), 
LAdd67925 = add_layer([[[[0.2144, 0.1754]]], [[[0.7825, 0.5397]]]], Add67925), 
LRes9797 = reshape_layer(Add67925, [1, 2, 1], Res9797), 
LGlo29034 = global_average_pooling2D_layer(Res9797, Glo29034), 
LRes97497 = reshape_layer(Glo29034, [1, 1], Res97497), 
LRes85123 = reshape_layer(Res97497, [1, 1, 1], Res85123), 
LUp_71902 = up_sampling2D_layer(Res85123, 1, 2, Up_71902), 
LZer9040 = zero_padding2D_layer(Up_71902, 11, 0, 1, 0, Zer9040), 
LAve77283 = average_layer([Zer11105,Zer9040], Ave77283), 
exec_layers([LGRU96936,LRes4145,LRes1835,LZer42185,LLoc24903,LRes99354,LFla50890,LCro15732,LRes11260,LLoc42762,LRes63431,LGRU44366,LCon4417,LAve45904,LRes11774,LRes77279,LZer11105,LAdd67925,LRes9797,LGlo29034,LRes97497,LRes85123,LUp_71902,LZer9040,LAve77283],["GRU96936","Res4145","Res1835","Zer42185","Loc24903","Res99354","Fla50890","Cro15732","Res11260","Loc42762","Res63431","GRU44366","Con4417","Ave45904","Res11774","Res77279","Zer11105","Add67925","Res9797","Glo29034","Res97497","Res85123","Up_71902","Zer9040","Ave77283"],Ave77283,"Ave77283")

Actual (Unparsed): [[[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0716000]], [[0.0000000], [0.0000000], [0.0972500]], [[0.0000000], [0.0000000], [0.0357000]], [[0.0000000], [0.0000000], [0.0981250]], [[0.0000000], [0.0000000], [0.2041000]], [[0.0000000], [0.0000000], [0.1961750]], [[0.0000000], [0.0000000], [0.1077000]], [[0.0000000], [0.0000000], [0.2285000]], [[0.0000000], [0.4280000], [0.6061250]]]]

Expected (Unparsed): [[[[0],[0],[0.0]],[[0],[0],[0.0]],[[0],[0],[2.7458579547001706e-9]],[[0],[0],[0.07160000961050283]],[[0],[0],[0.09725]],[[0],[0],[0.0357]],[[0],[0],[0.098125]],[[0],[0],[0.2041]],[[0],[0],[0.19617501643013366]],[[0],[0],[0.10770001993841735]],[[0],[0],[0.2285]],[[0],[0.428],[0.606125]]]]

Actual:   [[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0.0716]], [[0], [0], [0.0973]], [[0], [0], [0.0357]], [[0], [0], [0.0982]], [[0], [0], [0.2041]], [[0], [0], [0.1962]], [[0], [0], [0.1077]], [[0], [0], [0.2285]], [[0], [0.428], [0.6062]]]]

Expected: [[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0.0717]], [[0], [0], [0.0973]], [[0], [0], [0.0357]], [[0], [0], [0.0982]], [[0], [0], [0.2041]], [[0], [0], [0.1962]], [[0], [0], [0.1078]], [[0], [0], [0.2285]], [[0], [0.428], [0.6062]]]]