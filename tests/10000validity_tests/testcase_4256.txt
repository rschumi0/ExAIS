import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max60600 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Max60600 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Max49671 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Max49671 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con90086 = tf.keras.layers.Input(shape=([2, 6, 2, 1]))
in0Max60175 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Max60175 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))

Max60600 = keras.layers.Maximum(name = 'Max60600', )([in0Max60600,in1Max60600])
Res18363 = keras.layers.Reshape((2, 1), name = 'Res18363', )(Max60600)
Max49671 = keras.layers.Maximum(name = 'Max49671', )([in0Max49671,in1Max49671])
Res26077 = keras.layers.Reshape((2, 4), name = 'Res26077', )(Max49671)
Dot68186 = keras.layers.Dot(axes=(1, 1), name = 'Dot68186', )([Res18363,Res26077])
Res20151 = keras.layers.Reshape((1, 4, 1), name = 'Res20151', )(Dot68186)
Res66587 = keras.layers.Reshape((1, 4, 1, 1), name = 'Res66587', )(Res20151)
Zer62425 = keras.layers.ZeroPadding3D(padding=((1, 0), (2, 0), (1, 0)), name = 'Zer62425', )(Res66587)
Con90086 = keras.layers.Concatenate(axis=4, name = 'Con90086', )([Zer62425,in0Con90086])
Max60175 = keras.layers.Maximum(name = 'Max60175', )([in0Max60175,in1Max60175])
Zer31702 = keras.layers.ZeroPadding3D(padding=((0, 0), (4, 0), (0, 0)), name = 'Zer31702', )(Max60175)
Max16857 = keras.layers.Maximum(name = 'Max16857', )([Con90086,Zer31702])
Res64209 = keras.layers.Reshape((2, 6, 4), name = 'Res64209', )(Max16857)
Res22854 = keras.layers.Reshape((2, 24), name = 'Res22854', )(Res64209)
Loc17242 = keras.layers.LocallyConnected1D(4, (1),strides=(2), name = 'Loc17242', )(Res22854)
model = tf.keras.models.Model(inputs=[in0Max60600,in1Max60600,in0Max49671,in1Max49671,in0Con90086,in0Max60175,in1Max60175], outputs=Loc17242)
w = model.get_layer('Loc17242').get_weights() 
w[0] = np.array([[[0.9583, 0.6612, 0.1569, 0.8713], [0.1996, 0.2809, 0.5487, 0.4539], [0.5522, 0.6162, 0.3888, 0.4783], [0.9716, 0.3523, 0.3365, 0.0698], [0.2822, 0.3698, 0.122, 0.1054], [0.4494, 0.4941, 0.3804, 0.9535], [0.0677, 0.918, 0.6086, 0.5737], [0.2064, 0.1718, 0.4657, 0.5565], [0.5772, 0.654, 0.4181, 0.9073], [0.9717, 0.2934, 0.1598, 0.5081], [0.0532, 0.8681, 0.3362, 0.2279], [0.8805, 0.871, 0.8388, 0.5942], [0.9938, 0.5845, 0.3507, 0.7859], [0.4966, 0.2008, 0.872, 0.4641], [0.333, 0.4093, 0.6809, 0.619], [0.8754, 0.8615, 0.5479, 0.175], [0.0164, 0.3172, 0.0579, 0.5751], [0.1873, 0.0823, 0.573, 0.9398], [0.1148, 0.5506, 0.713, 0.6874], [0.6709, 0.281, 0.2265, 0.6901], [0.8717, 0.0595, 0.7802, 0.1417], [0.936, 0.8231, 0.5006, 0.3186], [0.3291, 0.1554, 0.0715, 0.3221], [0.8848, 0.3029, 0.8113, 0.7139]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc17242').set_weights(w) 
in0Max60600 = tf.constant([[[[0.7795]], [[0.6104]]]])
in1Max60600 = tf.constant([[[[0.6085]], [[0.1809]]]])
in0Max49671 = tf.constant([[[[0.6224, 0.0198], [0.0274, 0.764]], [[0.2929, 0.9516], [0.6262, 0.5528]]]])
in1Max49671 = tf.constant([[[[0.9655, 0.7913], [0.983, 0.9508]], [[0.0539, 0.5378], [0.2977, 0.5242]]]])
in0Con90086 = tf.constant([[[[[0.0219], [0.8606]], [[0.5373], [0.2087]], [[0.4292], [0.7994]], [[0.4393], [0.8086]], [[0.2512], [0.9825]], [[0.5555], [0.8309]]], [[[0.8743], [0.1369]], [[0.7629], [0.5956]], [[0.8976], [0.4942]], [[0.5623], [0.2998]], [[0.2642], [0.198]], [[0.6478], [0.5276]]]]])
in0Max60175 = tf.constant([[[[[0.508, 0.1227], [0.904, 0.4515]], [[0.2081, 0.6266], [0.0636, 0.978]]], [[[0.474, 0.7411], [0.905, 0.322]], [[0.31, 0.001], [0.4289, 0.2387]]]]])
in1Max60175 = tf.constant([[[[[0.7727, 0.8957], [0.2185, 0.104]], [[0.7659, 0.9579], [0.8635, 0.9517]]], [[[0.6407, 0.3209], [0.1377, 0.3696]], [[0.2139, 0.0415], [0.651, 0.5396]]]]])
print (np.array2string(model.predict([in0Max60600,in1Max60600,in0Max49671,in1Max49671,in0Con90086,in0Max60175,in1Max60175],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc17242.png')

LMax60600 = maximum_layer([[[[[0.7795]], [[0.6104]]]], [[[[0.6085]], [[0.1809]]]]], Max60600), 
LRes18363 = reshape_layer(Max60600, [2, 1], Res18363), 
LMax49671 = maximum_layer([[[[[0.6224, 0.0198], [0.0274, 0.764]], [[0.2929, 0.9516], [0.6262, 0.5528]]]], [[[[0.9655, 0.7913], [0.983, 0.9508]], [[0.0539, 0.5378], [0.2977, 0.5242]]]]], Max49671), 
LRes26077 = reshape_layer(Max49671, [2, 4], Res26077), 
LDot68186 = dot_layer(Res18363,Res26077, 1, 1, Dot68186), 
LRes20151 = reshape_layer(Dot68186, [1, 4, 1], Res20151), 
LRes66587 = reshape_layer(Res20151, [1, 4, 1, 1], Res66587), 
LZer62425 = zero_padding3D_layer(Res66587, 1, 0, 2, 0, 1, 0, Zer62425), 
LCon90086 = concatenate_layer([Zer62425,[[[[[0.0219], [0.8606]], [[0.5373], [0.2087]], [[0.4292], [0.7994]], [[0.4393], [0.8086]], [[0.2512], [0.9825]], [[0.5555], [0.8309]]], [[[0.8743], [0.1369]], [[0.7629], [0.5956]], [[0.8976], [0.4942]], [[0.5623], [0.2998]], [[0.2642], [0.198]], [[0.6478], [0.5276]]]]]], 4, Con90086), 
LMax60175 = maximum_layer([[[[[[0.508, 0.1227], [0.904, 0.4515]], [[0.2081, 0.6266], [0.0636, 0.978]]], [[[0.474, 0.7411], [0.905, 0.322]], [[0.31, 0.001], [0.4289, 0.2387]]]]], [[[[[0.7727, 0.8957], [0.2185, 0.104]], [[0.7659, 0.9579], [0.8635, 0.9517]]], [[[0.6407, 0.3209], [0.1377, 0.3696]], [[0.2139, 0.0415], [0.651, 0.5396]]]]]], Max60175), 
LZer31702 = zero_padding3D_layer(Max60175, 0, 0, 4, 0, 0, 0, Zer31702), 
LMax16857 = maximum_layer([Con90086,Zer31702], Max16857), 
LRes64209 = reshape_layer(Max16857, [2, 6, 4], Res64209), 
LRes22854 = reshape_layer(Res64209, [2, 24], Res22854), 
LLoc17242 = locally_connected1D_layer(Res22854, 1,[[[0.9583, 0.6612, 0.1569, 0.8713], [0.1996, 0.2809, 0.5487, 0.4539], [0.5522, 0.6162, 0.3888, 0.4783], [0.9716, 0.3523, 0.3365, 0.0698], [0.2822, 0.3698, 0.122, 0.1054], [0.4494, 0.4941, 0.3804, 0.9535], [0.0677, 0.918, 0.6086, 0.5737], [0.2064, 0.1718, 0.4657, 0.5565], [0.5772, 0.654, 0.4181, 0.9073], [0.9717, 0.2934, 0.1598, 0.5081], [0.0532, 0.8681, 0.3362, 0.2279], [0.8805, 0.871, 0.8388, 0.5942], [0.9938, 0.5845, 0.3507, 0.7859], [0.4966, 0.2008, 0.872, 0.4641], [0.333, 0.4093, 0.6809, 0.619], [0.8754, 0.8615, 0.5479, 0.175], [0.0164, 0.3172, 0.0579, 0.5751], [0.1873, 0.0823, 0.573, 0.9398], [0.1148, 0.5506, 0.713, 0.6874], [0.6709, 0.281, 0.2265, 0.6901], [0.8717, 0.0595, 0.7802, 0.1417], [0.936, 0.8231, 0.5006, 0.3186], [0.3291, 0.1554, 0.0715, 0.3221], [0.8848, 0.3029, 0.8113, 0.7139]]],[[0, 0, 0, 0]], 2, Loc17242), 
exec_layers([LMax60600,LRes18363,LMax49671,LRes26077,LDot68186,LRes20151,LRes66587,LZer62425,LCon90086,LMax60175,LZer31702,LMax16857,LRes64209,LRes22854,LLoc17242],["Max60600","Res18363","Max49671","Res26077","Dot68186","Res20151","Res66587","Zer62425","Con90086","Max60175","Zer31702","Max16857","Res64209","Res22854","Loc17242"],Loc17242,"Loc17242")

Actual (Unparsed): [[[6.8291156, 4.5747847, 5.5257486, 5.7125655]]]

Expected (Unparsed): [[[6.829115679999998,4.57478479,5.525748610000001,5.712565519999998]]]

Actual:   [[[6.8292, 4.5748, 5.5258, 5.7126]]]

Expected: [[[6.8292, 4.5748, 5.5258, 5.7126]]]