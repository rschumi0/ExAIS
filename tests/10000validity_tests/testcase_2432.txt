import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul10142 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Mul10142 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con88567 = tf.keras.layers.Input(shape=([1, 19]))
in0Loc85569 = tf.keras.layers.Input(shape=([2, 1]))
in0Con77459 = tf.keras.layers.Input(shape=([2, 1]))
in0Con54648 = tf.keras.layers.Input(shape=([1, 18]))

Mul10142 = keras.layers.Multiply(name = 'Mul10142', )([in0Mul10142,in1Mul10142])
Res92089 = keras.layers.Reshape((1, 2), name = 'Res92089', )(Mul10142)
Per16298 = keras.layers.Permute((1,2), name = 'Per16298',)(Res92089)
ELU33012 = keras.layers.ELU(alpha=7.059383043341853, name = 'ELU33012', )(Per16298)
Res30262 = keras.layers.Reshape((1, 2, 1), name = 'Res30262', )(ELU33012)
Res87242 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res87242', )(Res30262)
Cro47836 = keras.layers.Cropping3D(cropping=((0, 0), (1, 0), (0, 0)), name = 'Cro47836', )(Res87242)
Res31010 = keras.layers.Reshape((1, 1, 1), name = 'Res31010', )(Cro47836)
Res20483 = keras.layers.Reshape((1, 1), name = 'Res20483', )(Res31010)
Con88567 = keras.layers.Concatenate(axis=2, name = 'Con88567', )([Res20483,in0Con88567])
Loc85569 = keras.layers.LocallyConnected1D(4, (1),strides=(2), name = 'Loc85569', )(in0Loc85569)
Res49286 = keras.layers.Reshape((1, 4, 1), name = 'Res49286', )(Loc85569)
Res76725 = keras.layers.Reshape((1, 4, 1, 1), name = 'Res76725', )(Res49286)
Con6205 = keras.layers.Conv3DTranspose(4, (1, 2, 1),strides=(1, 1, 1), padding='valid', name = 'Con6205', )(Res76725)
Res74972 = keras.layers.Reshape((1, 5, 4), name = 'Res74972', )(Con6205)
Res48898 = keras.layers.Reshape((1, 20), name = 'Res48898', )(Res74972)
Con77459 = keras.layers.Conv1D(2, (2),strides=(1), padding='valid', dilation_rate=(1), name = 'Con77459', )(in0Con77459)
Con54648 = keras.layers.Concatenate(axis=2, name = 'Con54648', )([Con77459,in0Con54648])
Mul68087 = keras.layers.Multiply(name = 'Mul68087', )([Res48898,Con54648])
Add2966 = keras.layers.Add(name = 'Add2966', )([Con88567,Mul68087])
model = tf.keras.models.Model(inputs=[in0Mul10142,in1Mul10142,in0Con88567,in0Loc85569,in0Con77459,in0Con54648], outputs=Add2966)
w = model.get_layer('Loc85569').get_weights() 
w[0] = np.array([[[0.4238, 0.0554, 0.4101, 0.8653]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc85569').set_weights(w) 
w = model.get_layer('Con6205').get_weights() 
w[0] = np.array([[[[[0.47], [0.3284], [0.448], [0.9442]]], [[[0.4805], [0.1889], [0.624], [0.9178]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con6205').set_weights(w) 
w = model.get_layer('Con77459').get_weights() 
w[0] = np.array([[[0.0281, 0.0967]], [[0.7185, 0.6143]]])
w[1] = np.array([0, 0])
model.get_layer('Con77459').set_weights(w) 
in0Mul10142 = tf.constant([[[[0.5332, 0.7509]]]])
in1Mul10142 = tf.constant([[[[0.0736, 0.7049]]]])
in0Con88567 = tf.constant([[[0.1365, 0.8955, 0.2217, 0.2258, 0.7559, 0.3737, 0.0067, 0.7064, 0.3406, 0.3782, 0.1519, 0.4206, 0.4458, 0.3943, 0.9391, 0.8089, 0.1553, 0.7873, 0.5571]]])
in0Loc85569 = tf.constant([[[0.5428], [0.1831]]])
in0Con77459 = tf.constant([[[0.9877], [0.2919]]])
in0Con54648 = tf.constant([[[0.6062, 0.8654, 0.1158, 0.9385, 0.1156, 0.104, 0.2031, 0.1374, 0.2906, 0.4934, 0.2519, 0.4486, 0.8331, 0.2017, 0.0223, 0.0205, 0.1467, 0.6221]]])
print (np.array2string(model.predict([in0Mul10142,in1Mul10142,in0Con88567,in0Loc85569,in0Con77459,in0Con54648],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add2966.png')

LMul10142 = multiply_layer([[[[[0.5332, 0.7509]]]], [[[[0.0736, 0.7049]]]]], Mul10142), 
LRes92089 = reshape_layer(Mul10142, [1, 2], Res92089), 
LPer16298 = permute_layer(Res92089, 1,2, Per16298), 
LELU33012 = elu_layer(Per16298, 7.059383043341853, ELU33012), 
LRes30262 = reshape_layer(ELU33012, [1, 2, 1], Res30262), 
LRes87242 = reshape_layer(Res30262, [1, 2, 1, 1], Res87242), 
LCro47836 = cropping3D_layer(Res87242, 0, 0, 1, 0, 0, 0, Cro47836), 
LRes31010 = reshape_layer(Cro47836, [1, 1, 1], Res31010), 
LRes20483 = reshape_layer(Res31010, [1, 1], Res20483), 
LCon88567 = concatenate_layer([Res20483,[[[0.1365, 0.8955, 0.2217, 0.2258, 0.7559, 0.3737, 0.0067, 0.7064, 0.3406, 0.3782, 0.1519, 0.4206, 0.4458, 0.3943, 0.9391, 0.8089, 0.1553, 0.7873, 0.5571]]]], 2, Con88567), 
LLoc85569 = locally_connected1D_layer([[[0.5428], [0.1831]]], 1,[[[0.4238, 0.0554, 0.4101, 0.8653]]],[[0, 0, 0, 0]], 2, Loc85569), 
LRes49286 = reshape_layer(Loc85569, [1, 4, 1], Res49286), 
LRes76725 = reshape_layer(Res49286, [1, 4, 1, 1], Res76725), 
LCon6205 = conv3D_transpose_layer(Res76725, 1, 2, 1,[[[[[0.47], [0.3284], [0.448], [0.9442]]], [[[0.4805], [0.1889], [0.624], [0.9178]]]]],[0, 0, 0, 0], 1, 1, 1, false, Con6205), 
LRes74972 = reshape_layer(Con6205, [1, 5, 4], Res74972), 
LRes48898 = reshape_layer(Res74972, [1, 20], Res48898), 
LCon77459 = conv1D_layer([[[0.9877], [0.2919]]], 2,[[[0.0281, 0.0967]], [[0.7185, 0.6143]]],[0, 0], 1, false, 1, Con77459), 
LCon54648 = concatenate_layer([Con77459,[[[0.6062, 0.8654, 0.1158, 0.9385, 0.1156, 0.104, 0.2031, 0.1374, 0.2906, 0.4934, 0.2519, 0.4486, 0.8331, 0.2017, 0.0223, 0.0205, 0.1467, 0.6221]]]], 2, Con54648), 
LMul68087 = multiply_layer([Res48898,Con54648], Mul68087), 
LAdd2966 = add_layer([Con88567,Mul68087], Add2966), 
exec_layers([LMul10142,LRes92089,LPer16298,LELU33012,LRes30262,LRes87242,LCro47836,LRes31010,LRes20483,LCon88567,LLoc85569,LRes49286,LRes76725,LCon6205,LRes74972,LRes48898,LCon77459,LCon54648,LMul68087,LAdd2966],["Mul10142","Res92089","Per16298","ELU33012","Res30262","Res87242","Cro47836","Res31010","Res20483","Con88567","Loc85569","Res49286","Res76725","Con6205","Res74972","Res48898","Con77459","Con54648","Mul68087","Add2966"],Add2966,"Add2966")

Actual (Unparsed): [[[0.5549858, 0.1572616, 0.9579733, 0.4096670, 0.2402364, 0.8059499, 0.3918510, 0.0316104, 0.7305836, 0.3514248, 0.4126332, 0.2692208, 0.5031507, 0.5338575, 0.6853207, 1.0697574, 0.8139327, 0.1571188, 0.8302953, 0.8252728]]]

Expected (Unparsed): [[[0.5549857995208708,0.15726155112703377,0.9579733417584639,0.4096670295566752,0.240236437780136,0.8059498811274041,0.391851046492672,0.031610351990784,0.730583572910756,0.351424787404168,0.41263325221299196,0.2692208230677008,0.503150720898646,0.5338575207655928,0.6853206839194239,1.0697573870598704,0.8139327435133259,0.15711883105865798,0.830295326001472,0.8252728437811592]]]

Actual:   [[[0.555, 0.1573, 0.958, 0.4097, 0.2403, 0.806, 0.3919, 0.0317, 0.7306, 0.3515, 0.4127, 0.2693, 0.5032, 0.5339, 0.6854, 1.0698, 0.814, 0.1572, 0.8303, 0.8253]]]

Expected: [[[0.555, 0.1573, 0.958, 0.4097, 0.2403, 0.806, 0.3919, 0.0317, 0.7306, 0.3515, 0.4127, 0.2693, 0.5032, 0.5339, 0.6854, 1.0698, 0.814, 0.1572, 0.8303, 0.8253]]]