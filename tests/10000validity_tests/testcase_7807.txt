import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub39345 = tf.keras.layers.Input(shape=([2, 3, 3, 2]))
in1Sub39345 = tf.keras.layers.Input(shape=([2, 3, 3, 2]))
in0Con9055 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Lea49420 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con28078 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Mul24475 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Mul24475 = tf.keras.layers.Input(shape=([2, 1, 2]))

Sub39345 = keras.layers.Subtract(name = 'Sub39345', )([in0Sub39345,in1Sub39345])
Res44500 = keras.layers.Reshape((2, 3, 6), name = 'Res44500', )(Sub39345)
Res44670 = keras.layers.Reshape((2, 18), name = 'Res44670', )(Res44500)
GRU23480 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU23480', )(Res44670)
Res93458 = keras.layers.Reshape((1, 1), name = 'Res93458', )(GRU23480)
Res75201 = keras.layers.Reshape((1, 1, 1), name = 'Res75201', )(Res93458)
Zer29291 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer29291', )(Res75201)
Con9055 = keras.layers.Concatenate(axis=3, name = 'Con9055', )([Zer29291,in0Con9055])
Lea49420 = keras.layers.LeakyReLU(alpha=7.3288275177397715, name = 'Lea49420', input_shape=(2, 1, 1))(in0Lea49420)
Con28078 = keras.layers.Concatenate(axis=3, name = 'Con28078', )([Lea49420,in0Con28078])
Mul24475 = keras.layers.Multiply(name = 'Mul24475', )([in0Mul24475,in1Mul24475])
Max67537 = keras.layers.Maximum(name = 'Max67537', )([Con28078,Mul24475])
Add9889 = keras.layers.Add(name = 'Add9889', )([Con9055,Max67537])
model = tf.keras.models.Model(inputs=[in0Sub39345,in1Sub39345,in0Con9055,in0Lea49420,in0Con28078,in0Mul24475,in1Mul24475], outputs=Add9889)
w = model.get_layer('GRU23480').get_weights() 
w[0] = np.array([[9, 3, 1], [2, 7, 1], [9, 7, 7], [10, 2, 5], [10, 8, 10], [1, 2, 8], [8, 10, 1], [2, 9, 8], [2, 1, 8], [10, 8, 3], [4, 6, 8], [1, 10, 6], [5, 10, 10], [3, 5, 5], [4, 2, 4], [2, 2, 5], [1, 1, 1], [5, 4, 6]])
w[1] = np.array([[2, 3, 1]])
w[2] = np.array([5, 6, 10])
model.get_layer('GRU23480').set_weights(w) 
in0Sub39345 = tf.constant([[[[[0.7865, 0.3015], [0.835, 0.4729], [0.1385, 0.6158]], [[0.3551, 0.805], [0.0702, 0.8207], [0.101, 0.3888]], [[0.3358, 0.1753], [0.9761, 0.5018], [0.9098, 0.554]]], [[[0.3626, 0.8868], [0.4462, 0.7418], [0.7372, 0.7059]], [[0.3563, 0.5227], [0.9456, 0.0793], [0.522, 0.2342]], [[0.967, 0.9076], [0.2386, 0.7676], [0.5986, 0.6207]]]]])
in1Sub39345 = tf.constant([[[[[0.8451, 0.83], [0.8639, 0.4759], [0.6379, 0.6539]], [[0.1043, 0.0344], [0.0882, 0.2367], [0.6559, 0.4882]], [[0.0891, 0.6265], [0.7292, 0.5779], [0.9396, 0.7296]]], [[[0.6133, 0.9454], [0.0443, 0.6096], [0.6067, 0.9015]], [[0.8514, 0.2729], [0.1402, 0.7488], [0.3828, 0.4898]], [[0.404, 0.0022], [0.8205, 0.2884], [0.4147, 0.0706]]]]])
in0Con9055 = tf.constant([[[[0.8007]], [[0.2148]]]])
in0Lea49420 = tf.constant([[[[0.0032]], [[0.3756]]]])
in0Con28078 = tf.constant([[[[0.6174]], [[0.4487]]]])
in0Mul24475 = tf.constant([[[[0.8671, 0.2291]], [[0.363, 0.8907]]]])
in1Mul24475 = tf.constant([[[[0.3023, 0.9943]], [[0.7828, 0.5747]]]])
print (np.array2string(model.predict([in0Sub39345,in1Sub39345,in0Con9055,in0Lea49420,in0Con28078,in0Mul24475,in1Mul24475],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add9889.png')

LSub39345 = subtract_layer([[[[[0.7865, 0.3015], [0.835, 0.4729], [0.1385, 0.6158]], [[0.3551, 0.805], [0.0702, 0.8207], [0.101, 0.3888]], [[0.3358, 0.1753], [0.9761, 0.5018], [0.9098, 0.554]]], [[[0.3626, 0.8868], [0.4462, 0.7418], [0.7372, 0.7059]], [[0.3563, 0.5227], [0.9456, 0.0793], [0.522, 0.2342]], [[0.967, 0.9076], [0.2386, 0.7676], [0.5986, 0.6207]]]]], [[[[[0.8451, 0.83], [0.8639, 0.4759], [0.6379, 0.6539]], [[0.1043, 0.0344], [0.0882, 0.2367], [0.6559, 0.4882]], [[0.0891, 0.6265], [0.7292, 0.5779], [0.9396, 0.7296]]], [[[0.6133, 0.9454], [0.0443, 0.6096], [0.6067, 0.9015]], [[0.8514, 0.2729], [0.1402, 0.7488], [0.3828, 0.4898]], [[0.404, 0.0022], [0.8205, 0.2884], [0.4147, 0.0706]]]]], Sub39345), 
LRes44500 = reshape_layer(Sub39345, [2, 3, 6], Res44500), 
LRes44670 = reshape_layer(Res44500, [2, 18], Res44670), 
LGRU23480 = gru_layer(Res44670,[[9, 3, 1], [2, 7, 1], [9, 7, 7], [10, 2, 5], [10, 8, 10], [1, 2, 8], [8, 10, 1], [2, 9, 8], [2, 1, 8], [10, 8, 3], [4, 6, 8], [1, 10, 6], [5, 10, 10], [3, 5, 5], [4, 2, 4], [2, 2, 5], [1, 1, 1], [5, 4, 6]],[[2, 3, 1]],[5, 6, 10], false, GRU23480), 
LRes93458 = reshape_layer(GRU23480, [1, 1], Res93458), 
LRes75201 = reshape_layer(Res93458, [1, 1, 1], Res75201), 
LZer29291 = zero_padding2D_layer(Res75201, 1, 0, 0, 0, Zer29291), 
LCon9055 = concatenate_layer([Zer29291,[[[[0.8007]], [[0.2148]]]]], 3, Con9055), 
LLea49420 = leaky_relu_layer([[[[0.0032]], [[0.3756]]]], 7.3288275177397715, Lea49420), 
LCon28078 = concatenate_layer([Lea49420,[[[[0.6174]], [[0.4487]]]]], 3, Con28078), 
LMul24475 = multiply_layer([[[[[0.8671, 0.2291]], [[0.363, 0.8907]]]], [[[[0.3023, 0.9943]], [[0.7828, 0.5747]]]]], Mul24475), 
LMax67537 = maximum_layer([Con28078,Mul24475], Max67537), 
LAdd9889 = add_layer([Con9055,Max67537], Add9889), 
exec_layers([LSub39345,LRes44500,LRes44670,LGRU23480,LRes93458,LRes75201,LZer29291,LCon9055,LLea49420,LCon28078,LMul24475,LMax67537,LAdd9889],["Sub39345","Res44500","Res44670","GRU23480","Res93458","Res75201","Zer29291","Con9055","Lea49420","Con28078","Mul24475","Max67537","Add9889"],Add9889,"Add9889")

Actual (Unparsed): [[[[0.2621243, 1.4181000]], [[0.3832763, 0.7266853]]]]

Expected (Unparsed): [[[[0.26212433,1.4181]],[[0.38327627034049494,0.72668529]]]]

Actual:   [[[[0.2622, 1.4181]], [[0.3833, 0.7267]]]]

Expected: [[[[0.2622, 1.4181]], [[0.3833, 0.7267]]]]