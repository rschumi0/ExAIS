import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave61443 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Ave61443 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))

Ave61443 = keras.layers.Average(name = 'Ave61443', )([in0Ave61443,in1Ave61443])
Res52871 = keras.layers.Reshape((2, 2, 2), name = 'Res52871', )(Ave61443)
Loc97295 = keras.layers.LocallyConnected2D(3, (1, 1),strides=(1, 1), name = 'Loc97295', )(Res52871)
Sof99887 = keras.layers.Softmax(axis=1, name = 'Sof99887', )(Loc97295)
model = tf.keras.models.Model(inputs=[in0Ave61443,in1Ave61443], outputs=Sof99887)
w = model.get_layer('Loc97295').get_weights() 
w[0] = np.array([[[0.1067, 0.4217, 0.482], [0.9464, 0.4013, 0.7291]], [[0.1922, 0.307, 0.082], [0.5783, 0.1113, 0.5641]], [[0.6082, 0.2988, 0.5945], [0.8211, 0.7673, 0.5225]], [[0.16, 0.2386, 0.7193], [0.9126, 0.8431, 0.0202]]])
w[1] = np.array([[[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0, 0]]])
model.get_layer('Loc97295').set_weights(w) 
in0Ave61443 = tf.constant([[[[[0.3886], [0.385]], [[0.1668], [0.5627]]], [[[0.2151], [0.0207]], [[0.524], [0.3254]]]]])
in1Ave61443 = tf.constant([[[[[0.5762], [0.2308]], [[0.5915], [0.1502]]], [[[0.0394], [0.87]], [[0.3732], [0.0375]]]]])
print (np.array2string(model.predict([in0Ave61443,in1Ave61443],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sof99887.png')

LAve61443 = average_layer([[[[[[0.3886], [0.385]], [[0.1668], [0.5627]]], [[[0.2151], [0.0207]], [[0.524], [0.3254]]]]], [[[[[0.5762], [0.2308]], [[0.5915], [0.1502]]], [[[0.0394], [0.87]], [[0.3732], [0.0375]]]]]], Ave61443), 
LRes52871 = reshape_layer(Ave61443, [2, 2, 2], Res52871), 
LLoc97295 = locally_connected2D_layer(Res52871, 1, 1,[[[0.1067, 0.4217, 0.482], [0.9464, 0.4013, 0.7291]], [[0.1922, 0.307, 0.082], [0.5783, 0.1113, 0.5641]], [[0.6082, 0.2988, 0.5945], [0.8211, 0.7673, 0.5225]], [[0.16, 0.2386, 0.7193], [0.9126, 0.8431, 0.0202]]],[[[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0, 0]]], 1, 1, Loc97295), 
LSof99887 = softmax_layer(Loc97295, 1, Sof99887), 
exec_layers([LAve61443,LRes52871,LLoc97295,LSof99887],["Ave61443","Res52871","Loc97295","Sof99887"],Sof99887,"Sof99887")

Actual (Unparsed): [[[[0.4749705, 0.4868153, 0.5370970], [0.5104086, 0.4740372, 0.4764725]], [[0.5250295, 0.5131847, 0.4629030], [0.4895914, 0.5259628, 0.5235275]]]]

Expected (Unparsed): [[[[0.47497051487421227,0.4868153059943035,0.5370970018780666],[0.5104085948187357,0.47403724193039876,0.47647250649309403]],[[0.5250294851257877,0.5131846940056964,0.4629029981219335],[0.4895914051812643,0.5259627580696011,0.523527493506906]]]]

Actual:   [[[[0.475, 0.4869, 0.5371], [0.5105, 0.4741, 0.4765]], [[0.5251, 0.5132, 0.463], [0.4896, 0.526, 0.5236]]]]

Expected: [[[[0.475, 0.4869, 0.5371], [0.5105, 0.4741, 0.4765]], [[0.5251, 0.5132, 0.463], [0.4896, 0.526, 0.5236]]]]