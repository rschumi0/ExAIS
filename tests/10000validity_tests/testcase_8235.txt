import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave2405 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Ave2405 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Min47422 = tf.keras.layers.Input(shape=([2, 2]))
in1Min47422 = tf.keras.layers.Input(shape=([2, 2]))

Ave2405 = keras.layers.Average(name = 'Ave2405', )([in0Ave2405,in1Ave2405])
Res55204 = keras.layers.Reshape((1, 2, 1), name = 'Res55204', )(Ave2405)
Res90522 = keras.layers.Reshape((1, 2), name = 'Res90522', )(Res55204)
Zer50284 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer50284', )(Res90522)
Min47422 = keras.layers.Minimum(name = 'Min47422', )([in0Min47422,in1Min47422])
Sub8645 = keras.layers.Subtract(name = 'Sub8645', )([Zer50284,Min47422])
GRU91041 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU91041', )(Sub8645)
model = tf.keras.models.Model(inputs=[in0Ave2405,in1Ave2405,in0Min47422,in1Min47422], outputs=GRU91041)
w = model.get_layer('GRU91041').get_weights() 
w[0] = np.array([[5, 2, 2, 3, 4, 1, 9, 8, 5], [2, 9, 9, 10, 3, 8, 9, 3, 4]])
w[1] = np.array([[8, 1, 10, 5, 6, 2, 3, 3, 5], [10, 1, 6, 1, 4, 6, 8, 1, 8], [8, 9, 5, 3, 3, 2, 7, 6, 3]])
w[2] = np.array([8, 4, 1, 5, 7, 4, 1, 1, 8])
model.get_layer('GRU91041').set_weights(w) 
in0Ave2405 = tf.constant([[[[[0.6704]], [[0.7184]]]]])
in1Ave2405 = tf.constant([[[[[0.7824]], [[0.0241]]]]])
in0Min47422 = tf.constant([[[0.5415, 0.2378], [0.6211, 0.0984]]])
in1Min47422 = tf.constant([[[0.4821, 0.1784], [0.0804, 0.6204]]])
print (np.array2string(model.predict([in0Ave2405,in1Ave2405,in0Min47422,in1Min47422],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU91041.png')

LAve2405 = average_layer([[[[[[0.6704]], [[0.7184]]]]], [[[[[0.7824]], [[0.0241]]]]]], Ave2405), 
LRes55204 = reshape_layer(Ave2405, [1, 2, 1], Res55204), 
LRes90522 = reshape_layer(Res55204, [1, 2], Res90522), 
LZer50284 = zero_padding1D_layer(Res90522, 1, 0, Zer50284), 
LMin47422 = minimum_layer([[[[0.5415, 0.2378], [0.6211, 0.0984]]], [[[0.4821, 0.1784], [0.0804, 0.6204]]]], Min47422), 
LSub8645 = subtract_layer(Zer50284,Min47422, Sub8645), 
LGRU91041 = gru_layer(Sub8645,[[5, 2, 2, 3, 4, 1, 9, 8, 5], [2, 9, 9, 10, 3, 8, 9, 3, 4]],[[8, 1, 10, 5, 6, 2, 3, 3, 5], [10, 1, 6, 1, 4, 6, 8, 1, 8], [8, 9, 5, 3, 3, 2, 7, 6, 3]],[8, 4, 1, 5, 7, 4, 1, 1, 8], false, GRU91041), 
exec_layers([LAve2405,LRes55204,LRes90522,LZer50284,LMin47422,LSub8645,LGRU91041],["Ave2405","Res55204","Res90522","Zer50284","Min47422","Sub8645","GRU91041"],GRU91041,"GRU91041")

Actual (Unparsed): [[-0.0053101, -0.1926306, 0.8277386]]

Expected (Unparsed): [[-0.0053101232583257565,-0.19263064847387976,0.8277385816672393]]

Actual:   [[-0.0053, -0.1926, 0.8278]]

Expected: [[-0.0053, -0.1926, 0.8278]]