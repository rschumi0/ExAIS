import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot35643 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot35643 = tf.keras.layers.Input(shape=([3, 3]))
in0Ave71439 = tf.keras.layers.Input(shape=([1, 1]))
in0Con27469 = tf.keras.layers.Input(shape=([3, 2]))

Dot35643 = keras.layers.Dot(axes=(1, 2), name = 'Dot35643', )([in0Dot35643,in1Dot35643])
Per49675 = keras.layers.Permute((2,1), name = 'Per49675',)(Dot35643)
Ave71439 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave71439', )(in0Ave71439)
Zer48843 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer48843', )(Ave71439)
Con27469 = keras.layers.Concatenate(axis=2, name = 'Con27469', )([Zer48843,in0Con27469])
Sub29805 = keras.layers.Subtract(name = 'Sub29805', )([Per49675,Con27469])
Res98250 = keras.layers.Reshape((3, 3, 1), name = 'Res98250', )(Sub29805)
Con78285 = keras.layers.Conv2D(2, (2, 2),strides=(1, 2), padding='valid', dilation_rate=(1, 1), name = 'Con78285', )(Res98250)
model = tf.keras.models.Model(inputs=[in0Dot35643,in1Dot35643,in0Ave71439,in0Con27469], outputs=Con78285)
w = model.get_layer('Con78285').get_weights() 
w[0] = np.array([[[[0.811, 0.0835]], [[0.1295, 0.3591]]], [[[0.2435, 0.5571]], [[0.4069, 0.1029]]]])
w[1] = np.array([0, 0])
model.get_layer('Con78285').set_weights(w) 
in0Dot35643 = tf.constant([[[0.8539, 0.6028, 0.2878], [0.9051, 0.5013, 0.5402], [0.6168, 0.674, 0.1735]]])
in1Dot35643 = tf.constant([[[0.0438, 0.8642, 0.6642], [0.7478, 0.4872, 0.8377], [0.0605, 0.8224, 0.6742]]])
in0Ave71439 = tf.constant([[[1.559]]])
in0Con27469 = tf.constant([[[0.0262, 0.3894], [0.4784, 0.3287], [0.905, 0.4597]]])
print (np.array2string(model.predict([in0Dot35643,in1Dot35643,in0Ave71439,in0Con27469],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con78285.png')

LDot35643 = dot_layer([[[0.8539, 0.6028, 0.2878], [0.9051, 0.5013, 0.5402], [0.6168, 0.674, 0.1735]]], [[[0.0438, 0.8642, 0.6642], [0.7478, 0.4872, 0.8377], [0.0605, 0.8224, 0.6742]]], 1, 2, Dot35643), 
LPer49675 = permute_layer(Dot35643, 2,1, Per49675), 
LAve71439 = average_pooling1D_layer([[[1.559]]], 1, Ave71439), 
LZer48843 = zero_padding1D_layer(Ave71439, 2, 0, Zer48843), 
LCon27469 = concatenate_layer([Zer48843,[[[0.0262, 0.3894], [0.4784, 0.3287], [0.905, 0.4597]]]], 2, Con27469), 
LSub29805 = subtract_layer(Per49675,Con27469, Sub29805), 
LRes98250 = reshape_layer(Sub29805, [3, 3, 1], Res98250), 
LCon78285 = conv2D_layer(Res98250, 2, 2,[[[[0.811, 0.0835]], [[0.1295, 0.3591]]], [[[0.2435, 0.5571]], [[0.4069, 0.1029]]]],[0, 0], 1, 2, false, 1, 1, Con78285), 
exec_layers([LDot35643,LPer49675,LAve71439,LZer48843,LCon27469,LSub29805,LRes98250,LCon78285],["Dot35643","Per49675","Ave71439","Zer48843","Con27469","Sub29805","Res98250","Con78285"],Con78285,"Con78285")

Actual (Unparsed): [[[[1.8175904, 1.3886784]], [[1.3104082, 0.2202369]]]]

Expected (Unparsed): [[[[1.8175904164,1.3886784308400004]],[[1.3104082454330004,0.22023694640300018]]]]

Actual:   [[[[1.8176, 1.3887]], [[1.3105, 0.2203]]]]

Expected: [[[[1.8176, 1.3887]], [[1.3105, 0.2203]]]]