import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con90013 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Max84014 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Max84014 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Add57139 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Add57139 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con50755 = tf.keras.layers.Input(shape=([1]))
in0Sub12392 = tf.keras.layers.Input(shape=([3]))
in1Sub12392 = tf.keras.layers.Input(shape=([3]))
in0Con10279 = tf.keras.layers.Input(shape=([1]))

Con90013 = keras.layers.Conv3DTranspose(2, (1, 1, 1),strides=(1, 1, 1), padding='same', name = 'Con90013', )(in0Con90013)
Res36360 = keras.layers.Reshape((1, 1, 4), name = 'Res36360', )(Con90013)
Max84014 = keras.layers.Maximum(name = 'Max84014', )([in0Max84014,in1Max84014])
Res74012 = keras.layers.Reshape((2, 2), name = 'Res74012', )(Max84014)
Fla65513 = keras.layers.Flatten(name = 'Fla65513', )(Res74012)
Add57139 = keras.layers.Add(name = 'Add57139', )([in0Add57139,in1Add57139])
Res39889 = keras.layers.Reshape((2, 1), name = 'Res39889', )(Add57139)
Fla56372 = keras.layers.Flatten(name = 'Fla56372', )(Res39889)
Con50755 = keras.layers.Concatenate(axis=1, name = 'Con50755', )([Fla56372,in0Con50755])
Sub12392 = keras.layers.Subtract(name = 'Sub12392', )([in0Sub12392,in1Sub12392])
Ave1185 = keras.layers.Average(name = 'Ave1185', )([Con50755,Sub12392])
Con10279 = keras.layers.Concatenate(axis=1, name = 'Con10279', )([Ave1185,in0Con10279])
Add5281 = keras.layers.Add(name = 'Add5281', )([Fla65513,Con10279])
Res7450 = keras.layers.Reshape((1, 1, 4), name = 'Res7450', )(Add5281)
Min33386 = keras.layers.Minimum(name = 'Min33386', )([Res36360,Res7450])
model = tf.keras.models.Model(inputs=[in0Con90013,in0Max84014,in1Max84014,in0Add57139,in1Add57139,in0Con50755,in0Sub12392,in1Sub12392,in0Con10279], outputs=Min33386)
w = model.get_layer('Con90013').get_weights() 
w[0] = np.array([[[[[0.0644], [0.2258]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con90013').set_weights(w) 
in0Con90013 = tf.constant([[[[[0.8307], [0.2486]]]]])
in0Max84014 = tf.constant([[[[0.7597], [0.4772]], [[0.9318], [0.3036]]]])
in1Max84014 = tf.constant([[[[0.0262], [0.9488]], [[0.2228], [0.1388]]]])
in0Add57139 = tf.constant([[[[0.9303]], [[0.1736]]]])
in1Add57139 = tf.constant([[[[0.7476]], [[0.3872]]]])
in0Con50755 = tf.constant([[0.6182]])
in0Sub12392 = tf.constant([[0.8532, 0.5676, 0.6494]])
in1Sub12392 = tf.constant([[0.6504, 0.2956, 0.9869]])
in0Con10279 = tf.constant([[0.4526]])
print (np.array2string(model.predict([in0Con90013,in0Max84014,in1Max84014,in0Add57139,in1Add57139,in0Con50755,in0Sub12392,in1Sub12392,in0Con10279],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min33386.png')

LCon90013 = conv3D_transpose_layer([[[[[0.8307], [0.2486]]]]], 1, 1, 1,[[[[[0.0644], [0.2258]]]]],[0, 0], 1, 1, 1, true, Con90013), 
LRes36360 = reshape_layer(Con90013, [1, 1, 4], Res36360), 
LMax84014 = maximum_layer([[[[[0.7597], [0.4772]], [[0.9318], [0.3036]]]], [[[[0.0262], [0.9488]], [[0.2228], [0.1388]]]]], Max84014), 
LRes74012 = reshape_layer(Max84014, [2, 2], Res74012), 
LFla65513 = flatten_layer(Res74012, Fla65513), 
LAdd57139 = add_layer([[[[[0.9303]], [[0.1736]]]], [[[[0.7476]], [[0.3872]]]]], Add57139), 
LRes39889 = reshape_layer(Add57139, [2, 1], Res39889), 
LFla56372 = flatten_layer(Res39889, Fla56372), 
LCon50755 = concatenate_layer([Fla56372,[[0.6182]]], 1, Con50755), 
LSub12392 = subtract_layer([[0.8532, 0.5676, 0.6494]], [[0.6504, 0.2956, 0.9869]], Sub12392), 
LAve1185 = average_layer([Con50755,Sub12392], Ave1185), 
LCon10279 = concatenate_layer([Ave1185,[[0.4526]]], 1, Con10279), 
LAdd5281 = add_layer([Fla65513,Con10279], Add5281), 
LRes7450 = reshape_layer(Add5281, [1, 1, 4], Res7450), 
LMin33386 = minimum_layer([Res36360,Res7450], Min33386), 
exec_layers([LCon90013,LRes36360,LMax84014,LRes74012,LFla65513,LAdd57139,LRes39889,LFla56372,LCon50755,LSub12392,LAve1185,LCon10279,LAdd5281,LRes7450,LMin33386],["Con90013","Res36360","Max84014","Res74012","Fla65513","Add57139","Res39889","Fla56372","Con50755","Sub12392","Ave1185","Con10279","Add5281","Res7450","Min33386"],Min33386,"Min33386")

Actual (Unparsed): [[[[0.0534971, 0.1875721, 0.0160098, 0.0561339]]]]

Expected (Unparsed): [[[[0.053497079999999995,0.18757206,0.016009839999999997,0.05613388]]]]

Actual:   [[[[0.0535, 0.1876, 0.0161, 0.0562]]]]

Expected: [[[[0.0535, 0.1876, 0.0161, 0.0562]]]]