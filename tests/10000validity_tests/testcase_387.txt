import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul80238 = tf.keras.layers.Input(shape=([1, 2]))
in1Mul80238 = tf.keras.layers.Input(shape=([1, 2]))
in0Sub41779 = tf.keras.layers.Input(shape=([2, 3, 2]))
in1Sub41779 = tf.keras.layers.Input(shape=([2, 3, 2]))

Mul80238 = keras.layers.Multiply(name = 'Mul80238', )([in0Mul80238,in1Mul80238])
Glo48929 = keras.layers.GlobalMaxPool1D(name = 'Glo48929', )(Mul80238)
Res3477 = keras.layers.Reshape((2, 1), name = 'Res3477', )(Glo48929)
Res66458 = keras.layers.Reshape((2, 1, 1), name = 'Res66458', )(Res3477)
Loc27543 = keras.layers.LocallyConnected2D(2, (1, 1),strides=(2, 1), name = 'Loc27543', )(Res66458)
Zer27712 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer27712', )(Loc27543)
Sub41779 = keras.layers.Subtract(name = 'Sub41779', )([in0Sub41779,in1Sub41779])
Dep40557 = keras.layers.DepthwiseConv2D((2, 1),strides=(1, 1), padding='same', name = 'Dep40557', )(Sub41779)
Min73269 = keras.layers.Minimum(name = 'Min73269', )([Zer27712,Dep40557])
model = tf.keras.models.Model(inputs=[in0Mul80238,in1Mul80238,in0Sub41779,in1Sub41779], outputs=Min73269)
w = model.get_layer('Loc27543').get_weights() 
w[0] = np.array([[[0.3253, 0.441]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc27543').set_weights(w) 
w = model.get_layer('Dep40557').get_weights() 
w[0] = np.array([[[[0.2012], [0.5173]]], [[[0.976], [0.0375]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep40557').set_weights(w) 
in0Mul80238 = tf.constant([[[0.4289, 0.9644]]])
in1Mul80238 = tf.constant([[[0.2895, 0.5541]]])
in0Sub41779 = tf.constant([[[[0.9937, 0.1757], [0.7791, 0.7074], [0.4669, 0.4212]], [[0.1064, 0.0519], [0.9419, 0.1095], [0.2192, 0.5146]]]])
in1Sub41779 = tf.constant([[[[0.5097, 0.4938], [0.5788, 0.6519], [0.2298, 0.8589]], [[0.1788, 0.102], [0.6184, 0.5228], [0.2946, 0.2042]]]])
print (np.array2string(model.predict([in0Mul80238,in1Mul80238,in0Sub41779,in1Sub41779],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min73269.png')

LMul80238 = multiply_layer([[[[0.4289, 0.9644]]], [[[0.2895, 0.5541]]]], Mul80238), 
LGlo48929 = global_max_pool1D_layer(Mul80238, Glo48929), 
LRes3477 = reshape_layer(Glo48929, [2, 1], Res3477), 
LRes66458 = reshape_layer(Res3477, [2, 1, 1], Res66458), 
LLoc27543 = locally_connected2D_layer(Res66458, 1, 1,[[[0.3253, 0.441]]],[[[0, 0]]], 2, 1, Loc27543), 
LZer27712 = zero_padding2D_layer(Loc27543, 1, 0, 2, 0, Zer27712), 
LSub41779 = subtract_layer([[[[0.9937, 0.1757], [0.7791, 0.7074], [0.4669, 0.4212]], [[0.1064, 0.0519], [0.9419, 0.1095], [0.2192, 0.5146]]]], [[[[0.5097, 0.4938], [0.5788, 0.6519], [0.2298, 0.8589]], [[0.1788, 0.102], [0.6184, 0.5228], [0.2946, 0.2042]]]], Sub41779), 
LDep40557 = depthwise_conv2D_layer(Sub41779, 2, 1,[[[[0.2012], [0.5173]]], [[[0.976], [0.0375]]]],[0, 0], 1, 1, true, Dep40557), 
LMin73269 = minimum_layer([Zer27712,Dep40557], Min73269), 
exec_layers([LMul80238,LGlo48929,LRes3477,LRes66458,LLoc27543,LZer27712,LSub41779,LDep40557,LMin73269],["Mul80238","Glo48929","Res3477","Res66458","Loc27543","Zer27712","Sub41779","Dep40557","Min73269"],Min73269,"Min73269")

Actual (Unparsed): [[[[0.0000000, -0.1664319], [0.0000000, 0.0000000], [-0.0258859, -0.2147822]], [[-0.0145669, -0.0259167], [0.0000000, -0.2138001], [-0.0151705, 0.0547574]]]]

Expected (Unparsed): [[[[0,-0.16643188000000003],[0,0],[-0.02588587999999998,-0.21478220999999997]],[[-0.014566879999999997,-0.025916729999999995],[0,-0.21380009000000003],[-0.015170479999999993,0.05475744855]]]]

Actual:   [[[[0, -0.1664], [0, 0], [-0.0258, -0.2147]], [[-0.0145, -0.0259], [0, -0.2138], [-0.0151, 0.0548]]]]

Expected: [[[[0, -0.1664], [0, 0], [-0.0258, -0.2147]], [[-0.0145, -0.0259], [0, -0.2138], [-0.0151, 0.0548]]]]