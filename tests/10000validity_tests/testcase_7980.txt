import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot18377 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot18377 = tf.keras.layers.Input(shape=([3, 3]))
in0Con85881 = tf.keras.layers.Input(shape=([3, 3, 3, 1]))
in0Ave35867 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Ave35867 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))

Dot18377 = keras.layers.Dot(axes=(2, 1), name = 'Dot18377', )([in0Dot18377,in1Dot18377])
Lay75143 = keras.layers.LayerNormalization(axis=1, epsilon=2.086903062871767, name = 'Lay75143', )(Dot18377)
Res43558 = keras.layers.Reshape((3, 3, 1), name = 'Res43558', )(Lay75143)
Res79073 = keras.layers.Reshape((3, 3, 1, 1), name = 'Res79073', )(Res43558)
Zer50035 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer50035', )(Res79073)
Con85881 = keras.layers.Concatenate(axis=4, name = 'Con85881', )([Zer50035,in0Con85881])
Ave35867 = keras.layers.Average(name = 'Ave35867', )([in0Ave35867,in1Ave35867])
Zer99298 = keras.layers.ZeroPadding3D(padding=((2, 0), (1, 0), (1, 0)), name = 'Zer99298', )(Ave35867)
Max72629 = keras.layers.Maximum(name = 'Max72629', )([Con85881,Zer99298])
Lay91505 = keras.layers.LayerNormalization(axis=1, epsilon=1.6752386512888258, name = 'Lay91505', )(Max72629)
Con9498 = keras.layers.Conv3DTranspose(2, (3, 2, 1),strides=(1, 1, 1), padding='valid', name = 'Con9498', )(Lay91505)
model = tf.keras.models.Model(inputs=[in0Dot18377,in1Dot18377,in0Con85881,in0Ave35867,in1Ave35867], outputs=Con9498)
w = model.get_layer('Con9498').get_weights() 
w[0] = np.array([[[[[0.2766, 0.2005], [0.1625, 0.1936]]], [[[0.7821, 0.7863], [0.6799, 0.2344]]]], [[[[0.5141, 0.1898], [0.7009, 0.1948]]], [[[0.3547, 0.4131], [0.8186, 0.3964]]]], [[[[0.5726, 0.403], [0.8864, 0.1245]]], [[[0.6808, 0.5838], [0.9539, 0.3462]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con9498').set_weights(w) 
in0Dot18377 = tf.constant([[[0.9246, 0.7508, 0.8371], [0.4787, 0.5464, 0.0813], [0.8139, 0.5632, 0.623]]])
in1Dot18377 = tf.constant([[[0.682, 0.7243, 0.6702], [0.4609, 0.1064, 0.5217], [0.8782, 0.6216, 0.2613]]])
in0Con85881 = tf.constant([[[[[0.7598], [0.0657], [0.2263]], [[0.8291], [0.0002], [0.628]], [[0.7178], [0.0406], [0.3126]]], [[[0.1604], [0.865], [0.4975]], [[0.8627], [0.8914], [0.8557]], [[0.3079], [0.3517], [0.6824]]], [[[0.3131], [0.4647], [0.6406]], [[0.9502], [0.2397], [0.1042]], [[0.5441], [0.4119], [0.9375]]]]])
in0Ave35867 = tf.constant([[[[[0.3084, 0.31], [0.6768, 0.5628]], [[0.393, 0.8573], [0.1586, 0.1596]]]]])
in1Ave35867 = tf.constant([[[[[0.2583, 0.3483], [0.7395, 0.9954]], [[0.7807, 0.2256], [0.046, 0.6408]]]]])
print (np.array2string(model.predict([in0Dot18377,in1Dot18377,in0Con85881,in0Ave35867,in1Ave35867],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con9498.png')

LDot18377 = dot_layer([[[0.9246, 0.7508, 0.8371], [0.4787, 0.5464, 0.0813], [0.8139, 0.5632, 0.623]]], [[[0.682, 0.7243, 0.6702], [0.4609, 0.1064, 0.5217], [0.8782, 0.6216, 0.2613]]], 2, 1, Dot18377), 
LLay75143 = layer_normalization_layer(Dot18377, 1, 2.086903062871767, Lay75143), 
LRes43558 = reshape_layer(Lay75143, [3, 3, 1], Res43558), 
LRes79073 = reshape_layer(Res43558, [3, 3, 1, 1], Res79073), 
LZer50035 = zero_padding3D_layer(Res79073, 0, 0, 0, 0, 2, 0, Zer50035), 
LCon85881 = concatenate_layer([Zer50035,[[[[[0.7598], [0.0657], [0.2263]], [[0.8291], [0.0002], [0.628]], [[0.7178], [0.0406], [0.3126]]], [[[0.1604], [0.865], [0.4975]], [[0.8627], [0.8914], [0.8557]], [[0.3079], [0.3517], [0.6824]]], [[[0.3131], [0.4647], [0.6406]], [[0.9502], [0.2397], [0.1042]], [[0.5441], [0.4119], [0.9375]]]]]], 4, Con85881), 
LAve35867 = average_layer([[[[[[0.3084, 0.31], [0.6768, 0.5628]], [[0.393, 0.8573], [0.1586, 0.1596]]]]], [[[[[0.2583, 0.3483], [0.7395, 0.9954]], [[0.7807, 0.2256], [0.046, 0.6408]]]]]], Ave35867), 
LZer99298 = zero_padding3D_layer(Ave35867, 2, 0, 1, 0, 1, 0, Zer99298), 
LMax72629 = maximum_layer([Con85881,Zer99298], Max72629), 
LLay91505 = layer_normalization_layer(Max72629, 1, 1.6752386512888258, Lay91505), 
LCon9498 = conv3D_transpose_layer(Lay91505, 3, 2, 1,[[[[[0.2766, 0.2005], [0.1625, 0.1936]]], [[[0.7821, 0.7863], [0.6799, 0.2344]]]], [[[[0.5141, 0.1898], [0.7009, 0.1948]]], [[[0.3547, 0.4131], [0.8186, 0.3964]]]], [[[[0.5726, 0.403], [0.8864, 0.1245]]], [[[0.6808, 0.5838], [0.9539, 0.3462]]]]],[0, 0], 1, 1, 1, false, Con9498), 
exec_layers([LDot18377,LLay75143,LRes43558,LRes79073,LZer50035,LCon85881,LAve35867,LZer99298,LMax72629,LLay91505,LCon9498],["Dot18377","Lay75143","Res43558","Res79073","Zer50035","Con85881","Ave35867","Zer99298","Max72629","Lay91505","Con9498"],Con9498,"Con9498")

Actual (Unparsed): [[[[[0.0530031, 0.0511791], [-0.0599983, -0.0579335], [0.0034086, -0.0112644]], [[0.1998803, 0.0542575], [-0.3159755, -0.1404552], [-0.0647709, 0.0250724]], [[-0.0014184, 0.0195243], [-0.3767190, -0.1841964], [-0.1539659, -0.1005198]], [[0.1171970, 0.0349370], [-0.2779610, -0.1488904], [-0.1421662, -0.0107243]]], [[[0.0120676, 0.0147008], [0.0032670, -0.0002962], [0.0171523, 0.0534942]], [[-0.0505758, 0.0498000], [0.0693595, -0.1002475], [-0.1746602, -0.1001148]], [[-0.0321472, -0.0219434], [-0.0741413, -0.3060507], [-0.2113549, -0.2360192]], [[-0.0681761, 0.0204044], [-0.2290533, -0.2960960], [-0.1144505, -0.0857220]]], [[[0.0555655, -0.0184950], [-0.0638022, 0.0210372], [-0.0184112, 0.0588868]], [[0.0094852, 0.0014995], [-0.1549872, -0.0552348], [-0.0424692, -0.1539807]], [[0.0451860, -0.0171951], [-0.1557825, -0.1776800], [0.0498271, -0.0190493]], [[0.0313997, -0.0100681], [0.1084385, -0.0790828], [0.0648962, -0.0143699]]], [[[-0.0906952, -0.0381351], [0.1206643, 0.0372330], [-0.0372315, -0.0843644]], [[-0.1370494, -0.0865192], [0.3419559, 0.1745616], [0.0477597, -0.0484266]], [[-0.0493919, -0.0009574], [0.3015085, 0.2655702], [0.0105133, 0.0348077]], [[-0.0897394, -0.0507994], [0.0947990, 0.1812962], [0.0592003, 0.0300187]]], [[[-0.0299410, -0.0092498], [-0.0001308, -0.0000404], [0.0350818, -0.0167522]], [[-0.0217403, -0.0190378], [0.0596472, 0.1213759], [0.2341406, 0.2774496]], [[0.0377715, 0.0205715], [0.3051343, 0.4023569], [0.3049804, 0.3207806]], [[0.0093187, 0.0055261], [0.3037768, 0.3427730], [0.1325202, 0.0807975]]]]]

Expected (Unparsed): [[[[[0.05300313959633886,0.05117909140075413],[-0.05999832097408954,-0.057933540850791686],[0.003408607052272049,-0.0112643989778312]],[[0.19988026339027337,0.054257532894392904],[-0.31597546843602986,-0.14045514963383807],[-0.06477090554507504,0.025072391038421526]],[[-0.0014184125063044367,0.019524343953109185],[-0.37671902304109967,-0.18419635074179613],[-0.15396590244034242,-0.10051975658017573]],[[0.11719700250462839,0.034937018170017674],[-0.2779609657992317,-0.14889042841087236],[-0.142166245703718,-0.010724323890057959]]],[[[0.012067611381811567,0.014700796054974541],[0.0032669958010368635,-0.0002962418214046969],[0.017152287742160606,0.05349421650686577]],[[-0.050575809168087696,0.04979996487947649],[0.06935954307343345,-0.10024750608111582],[-0.17466023768924477,-0.1001147843229063]],[[-0.032147158389167714,-0.021943389462207374],[-0.07414127258578783,-0.306050709581535],[-0.21135494015946613,-0.23601923400971334]],[[-0.06817606349983987,0.020404349869563687],[-0.22905333913200637,-0.29609595285443674],[-0.11445045231220767,-0.08572200192341155]]],[[[0.05556548597430375,-0.018494988848836894],[-0.06380218702680823,0.021037207346381176],[-0.018411175545257272,0.058886767454060254]],[[0.009485229427113412,0.0014994603831388932],[-0.1549871685351547,-0.055234846909350675],[-0.042469213004913214,-0.15398066252835357]],[[0.04518599124128381,-0.017195066761250065],[-0.15578247378750376,-0.1776800142253488],[0.04982710684969406,-0.019049303816798882]],[[0.031399711176613804,-0.010068123036002755],[0.10843849090800853,-0.07908276042252163],[0.06489619986538651,-0.01436985719650373]]],[[[-0.09069523063232383,-0.03813513362709967],[0.12066434226547261,0.03723299305079947],[-0.03723147539290326,-0.08436435050644124]],[[-0.13704936200413437,-0.08651915756730728],[0.34195588154691714,0.17456164688205847],[0.04775972504365461,-0.0484265933004492]],[[-0.049391914701852085,-0.0009574005783823097],[0.3015084660683394,0.26557021906129913],[0.010513312306935571,0.03480766974591316]],[[-0.08973938714356812,-0.05079936137271494],[0.09479901281154537,0.18129616221509748],[0.05920034852117974,0.030018666273377133]]],[[[-0.02994100632013038,-0.009249764979792139],[-0.0001308300656117616,-4.04177249842787e-5],[0.03508175614372795,-0.016752234476653537]],[[-0.021740321645164675,-0.019037800589700966],[0.05964721235083394,0.12137585574224603],[0.23414063119557862,0.27744964911328757]],[[0.03777149435604076,0.02057151284873074],[0.30513430334605185,0.4023568554873808],[0.3049804234431788,0.3207806246607747]],[[0.009318736962165824,0.005526116369136362],[0.3037768012116844,0.3427729794727333],[0.1325201496293594,0.08079751673659616]]]]]

Actual:   [[[[[0.0531, 0.0512], [-0.0599, -0.0579], [0.0035, -0.0112]], [[0.1999, 0.0543], [-0.3159, -0.1404], [-0.0647, 0.0251]], [[-0.0014, 0.0196], [-0.3767, -0.1841], [-0.1539, -0.1005]], [[0.1172, 0.035], [-0.2779, -0.1488], [-0.1421, -0.0107]]], [[[0.0121, 0.0148], [0.0033, -0.0002], [0.0172, 0.0535]], [[-0.0505, 0.0498], [0.0694, -0.1002], [-0.1746, -0.1001]], [[-0.0321, -0.0219], [-0.0741, -0.306], [-0.2113, -0.236]], [[-0.0681, 0.0205], [-0.229, -0.296], [-0.1144, -0.0857]]], [[[0.0556, -0.0184], [-0.0638, 0.0211], [-0.0184, 0.0589]], [[0.0095, 0.0015], [-0.1549, -0.0552], [-0.0424, -0.1539]], [[0.0452, -0.0171], [-0.1557, -0.1776], [0.0499, -0.019]], [[0.0314, -0.01], [0.1085, -0.079], [0.0649, -0.0143]]], [[[-0.0906, -0.0381], [0.1207, 0.0373], [-0.0372, -0.0843]], [[-0.137, -0.0865], [0.342, 0.1746], [0.0478, -0.0484]], [[-0.0493, -0.0009], [0.3016, 0.2656], [0.0106, 0.0349]], [[-0.0897, -0.0507], [0.0948, 0.1813], [0.0593, 0.0301]]], [[[-0.0299, -0.0092], [-0.0001, -0], [0.0351, -0.0167]], [[-0.0217, -0.019], [0.0597, 0.1214], [0.2342, 0.2775]], [[0.0378, 0.0206], [0.3052, 0.4024], [0.305, 0.3208]], [[0.0094, 0.0056], [0.3038, 0.3428], [0.1326, 0.0808]]]]]

Expected: [[[[[0.0531, 0.0512], [-0.0599, -0.0579], [0.0035, -0.0112]], [[0.1999, 0.0543], [-0.3159, -0.1404], [-0.0647, 0.0251]], [[-0.0014, 0.0196], [-0.3767, -0.1841], [-0.1539, -0.1005]], [[0.1172, 0.035], [-0.2779, -0.1488], [-0.1421, -0.0107]]], [[[0.0121, 0.0148], [0.0033, -0.0002], [0.0172, 0.0535]], [[-0.0505, 0.0498], [0.0694, -0.1002], [-0.1746, -0.1001]], [[-0.0321, -0.0219], [-0.0741, -0.306], [-0.2113, -0.236]], [[-0.0681, 0.0205], [-0.229, -0.296], [-0.1144, -0.0857]]], [[[0.0556, -0.0184], [-0.0638, 0.0211], [-0.0184, 0.0589]], [[0.0095, 0.0015], [-0.1549, -0.0552], [-0.0424, -0.1539]], [[0.0452, -0.0171], [-0.1557, -0.1776], [0.0499, -0.019]], [[0.0314, -0.01], [0.1085, -0.079], [0.0649, -0.0143]]], [[[-0.0906, -0.0381], [0.1207, 0.0373], [-0.0372, -0.0843]], [[-0.137, -0.0865], [0.342, 0.1746], [0.0478, -0.0484]], [[-0.0493, -0.0009], [0.3016, 0.2656], [0.0106, 0.0349]], [[-0.0897, -0.0507], [0.0948, 0.1813], [0.0593, 0.0301]]], [[[-0.0299, -0.0092], [-0.0001, -0], [0.0351, -0.0167]], [[-0.0217, -0.019], [0.0597, 0.1214], [0.2342, 0.2775]], [[0.0378, 0.0206], [0.3052, 0.4024], [0.305, 0.3208]], [[0.0094, 0.0056], [0.3038, 0.3428], [0.1326, 0.0808]]]]]