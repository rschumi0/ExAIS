import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con76586 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Sep67966 = tf.keras.layers.Input(shape=([1, 2]))
in0Glo83801 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in0Con56102 = tf.keras.layers.Input(shape=([1]))
in0Con54689 = tf.keras.layers.Input(shape=([3, 1, 1, 3]))
in0Max86762 = tf.keras.layers.Input(shape=([2, 1]))
in1Max86762 = tf.keras.layers.Input(shape=([2, 1]))

Con76586 = keras.layers.Conv2D(4, (1, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con76586', )(in0Con76586)
Res84889 = keras.layers.Reshape((2, 4), name = 'Res84889', )(Con76586)
Sep67966 = keras.layers.SeparableConv1D(4, (1),strides=(1), padding='same', name = 'Sep67966', )(in0Sep67966)
Zer89437 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer89437', )(Sep67966)
Max52619 = keras.layers.Maximum(name = 'Max52619', )([Res84889,Zer89437])
Loc86939 = keras.layers.LocallyConnected1D(3, (2),strides=(1), name = 'Loc86939', )(Max52619)
Fla2025 = keras.layers.Flatten(name = 'Fla2025', )(Loc86939)
Glo83801 = keras.layers.GlobalAveragePooling3D(name = 'Glo83801', )(in0Glo83801)
Thr17559 = keras.layers.ThresholdedReLU(theta=5.235209943890032, name = 'Thr17559', )(Glo83801)
Con56102 = keras.layers.Concatenate(axis=1, name = 'Con56102', )([Thr17559,in0Con56102])
Sub95129 = keras.layers.Subtract(name = 'Sub95129', )([Fla2025,Con56102])
Res22989 = keras.layers.Reshape((3, 1), name = 'Res22989', )(Sub95129)
Res80781 = keras.layers.Reshape((3, 1, 1), name = 'Res80781', )(Res22989)
Res89772 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res89772', )(Res80781)
Con54689 = keras.layers.Concatenate(axis=4, name = 'Con54689', )([Res89772,in0Con54689])
Max86762 = keras.layers.Maximum(name = 'Max86762', )([in0Max86762,in1Max86762])
Res1079 = keras.layers.Reshape((2, 1, 1), name = 'Res1079', )(Max86762)
Res21886 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res21886', )(Res1079)
Con2949 = keras.layers.Conv3DTranspose(4, (1, 1, 1),strides=(1, 1, 1), padding='same', name = 'Con2949', )(Res21886)
Zer80824 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (0, 0)), name = 'Zer80824', )(Con2949)
Ave68831 = keras.layers.Average(name = 'Ave68831', )([Con54689,Zer80824])
model = tf.keras.models.Model(inputs=[in0Con76586,in0Sep67966,in0Glo83801,in0Con56102,in0Con54689,in0Max86762,in1Max86762], outputs=Ave68831)
w = model.get_layer('Con76586').get_weights() 
w[0] = np.array([[[[0.1987, 0.8099, 0.3073, 0.6475], [0.6379, 0.42, 0.0635, 0.6433]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con76586').set_weights(w) 
w = model.get_layer('Sep67966').get_weights() 
w[0] = np.array([[[0.1524], [0.124]]])
w[1] = np.array([[[0.3224, 0.9706, 0.8268, 0.5331], [0.7525, 0.7527, 0.6501, 0.1057]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep67966').set_weights(w) 
w = model.get_layer('Loc86939').get_weights() 
w[0] = np.array([[[0.409, 0.8584, 0.0939], [0.5336, 0.9233, 0.5796], [0.4383, 0.1737, 0.2393], [0.7343, 0.7679, 0.9492], [0.0016, 0.1245, 0.8895], [0.3905, 0.3951, 0.9748], [0.0397, 0.0779, 0.6106], [0.4804, 0.9256, 0.4951]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc86939').set_weights(w) 
w = model.get_layer('Con2949').get_weights() 
w[0] = np.array([[[[[0.2051], [0.8135], [0.7854], [0.2514]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con2949').set_weights(w) 
in0Con76586 = tf.constant([[[[0.7511, 0.7439]], [[0.0345, 0.0164]]]])
in0Sep67966 = tf.constant([[[0.3862, 0.3783]]])
in0Glo83801 = tf.constant([[[[[1.6709, 1.455], [1.2565, 1.7818]]], [[[1.168, 1.0888], [1.5584, 1.2224]]]]])
in0Con56102 = tf.constant([[0.46]])
in0Con54689 = tf.constant([[[[[0.6631, 0.0586, 0.9102]]], [[[0.3, 0.8254, 0.0354]]], [[[0.2562, 0.3279, 0.3108]]]]])
in0Max86762 = tf.constant([[[0.0465], [0.6881]]])
in1Max86762 = tf.constant([[[0.0158], [0.5064]]])
print (np.array2string(model.predict([in0Con76586,in0Sep67966,in0Glo83801,in0Con56102,in0Con54689,in0Max86762,in1Max86762],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave68831.png')

LCon76586 = conv2D_layer([[[[0.7511, 0.7439]], [[0.0345, 0.0164]]]], 1, 1,[[[[0.1987, 0.8099, 0.3073, 0.6475], [0.6379, 0.42, 0.0635, 0.6433]]]],[0, 0, 0, 0], 1, 1, false, 1, 1, Con76586), 
LRes84889 = reshape_layer(Con76586, [2, 4], Res84889), 
LSep67966 = separable_conv1D_layer([[[0.3862, 0.3783]]], 1,[[[[0.1524], [0.124]]],[[[0.3224, 0.9706, 0.8268, 0.5331], [0.7525, 0.7527, 0.6501, 0.1057]]]],[0, 0, 0, 0], 1, true, Sep67966), 
LZer89437 = zero_padding1D_layer(Sep67966, 1, 0, Zer89437), 
LMax52619 = maximum_layer([Res84889,Zer89437], Max52619), 
LLoc86939 = locally_connected1D_layer(Max52619, 2,[[[0.409, 0.8584, 0.0939], [0.5336, 0.9233, 0.5796], [0.4383, 0.1737, 0.2393], [0.7343, 0.7679, 0.9492], [0.0016, 0.1245, 0.8895], [0.3905, 0.3951, 0.9748], [0.0397, 0.0779, 0.6106], [0.4804, 0.9256, 0.4951]]],[[0, 0, 0]], 1, Loc86939), 
LFla2025 = flatten_layer(Loc86939, Fla2025), 
LGlo83801 = global_average_pooling3D_layer([[[[[1.6709, 1.455], [1.2565, 1.7818]]], [[[1.168, 1.0888], [1.5584, 1.2224]]]]], Glo83801), 
LThr17559 = thresholded_relu_layer(Glo83801, 5.235209943890032, Thr17559), 
LCon56102 = concatenate_layer([Thr17559,[[0.46]]], 1, Con56102), 
LSub95129 = subtract_layer(Fla2025,Con56102, Sub95129), 
LRes22989 = reshape_layer(Sub95129, [3, 1], Res22989), 
LRes80781 = reshape_layer(Res22989, [3, 1, 1], Res80781), 
LRes89772 = reshape_layer(Res80781, [3, 1, 1, 1], Res89772), 
LCon54689 = concatenate_layer([Res89772,[[[[[0.6631, 0.0586, 0.9102]]], [[[0.3, 0.8254, 0.0354]]], [[[0.2562, 0.3279, 0.3108]]]]]], 4, Con54689), 
LMax86762 = maximum_layer([[[[0.0465], [0.6881]]], [[[0.0158], [0.5064]]]], Max86762), 
LRes1079 = reshape_layer(Max86762, [2, 1, 1], Res1079), 
LRes21886 = reshape_layer(Res1079, [2, 1, 1, 1], Res21886), 
LCon2949 = conv3D_transpose_layer(Res21886, 1, 1, 1,[[[[[0.2051], [0.8135], [0.7854], [0.2514]]]]],[0, 0, 0, 0], 1, 1, 1, true, Con2949), 
LZer80824 = zero_padding3D_layer(Con2949, 1, 0, 0, 0, 0, 0, Zer80824), 
LAve68831 = average_layer([Con54689,Zer80824], Ave68831), 
exec_layers([LCon76586,LRes84889,LSep67966,LZer89437,LMax52619,LLoc86939,LFla2025,LGlo83801,LThr17559,LCon56102,LSub95129,LRes22989,LRes80781,LRes89772,LCon54689,LMax86762,LRes1079,LRes21886,LCon2949,LZer80824,LAve68831],["Con76586","Res84889","Sep67966","Zer89437","Max52619","Loc86939","Fla2025","Glo83801","Thr17559","Con56102","Sub95129","Res22989","Res80781","Res89772","Con54689","Max86762","Res1079","Res21886","Con2949","Zer80824","Ave68831"],Ave68831,"Ave68831")

Actual (Unparsed): [[[[[0.8168034, 0.3315500, 0.0293000, 0.4551000]]], [[[1.1337155, 0.1689139, 0.4309605, 0.0235450]]], [[[0.7302434, 0.4079847, 0.4341669, 0.2418942]]]]]

Expected (Unparsed): [[[[[0.8168033948348296,0.33155,0.0293,0.4551]]],[[[1.1337155127101715,0.168913875,0.43096055,0.02354505]]],[[[0.7302434356855547,0.407984675,0.43416687,0.24189417000000002]]]]]

Actual:   [[[[[0.8169, 0.3316, 0.0293, 0.4551]]], [[[1.1338, 0.169, 0.431, 0.0236]]], [[[0.7303, 0.408, 0.4342, 0.2419]]]]]

Expected: [[[[[0.8169, 0.3316, 0.0293, 0.4551]]], [[[1.1338, 0.169, 0.431, 0.0236]]], [[[0.7303, 0.408, 0.4342, 0.2419]]]]]