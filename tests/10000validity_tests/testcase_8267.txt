import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min9643 = tf.keras.layers.Input(shape=([2, 1]))
in1Min9643 = tf.keras.layers.Input(shape=([2, 1]))
in0Add81354 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Add81354 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Con99231 = tf.keras.layers.Input(shape=([2, 2, 3]))
in0Con71116 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Dep21626 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con40392 = tf.keras.layers.Input(shape=([2, 2, 3]))

Min9643 = keras.layers.Minimum(name = 'Min9643', )([in0Min9643,in1Min9643])
Res63720 = keras.layers.Reshape((2, 1, 1), name = 'Res63720', )(Min9643)
Res24270 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res24270', )(Res63720)
Zer43765 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (0, 0)), name = 'Zer43765', )(Res24270)
Add81354 = keras.layers.Add(name = 'Add81354', )([in0Add81354,in1Add81354])
Min54019 = keras.layers.Minimum(name = 'Min54019', )([Zer43765,Add81354])
Res29135 = keras.layers.Reshape((2, 2, 1), name = 'Res29135', )(Min54019)
Con99231 = keras.layers.Concatenate(axis=3, name = 'Con99231', )([Res29135,in0Con99231])
Con71116 = keras.layers.Conv3DTranspose(4, (1, 1, 1),strides=(1, 1, 1), padding='same', name = 'Con71116', )(in0Con71116)
ReL28784 = keras.layers.ReLU(max_value=3.2268872841995657, negative_slope=2.0496238916156084, threshold=8.833842860852265, name = 'ReL28784', )(Con71116)
Res66738 = keras.layers.Reshape((2, 2, 4), name = 'Res66738', )(ReL28784)
Dep21626 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='valid', name = 'Dep21626', )(in0Dep21626)
Zer26062 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer26062', )(Dep21626)
Con40392 = keras.layers.Concatenate(axis=3, name = 'Con40392', )([Zer26062,in0Con40392])
Mul79994 = keras.layers.Multiply(name = 'Mul79994', )([Res66738,Con40392])
Min20818 = keras.layers.Minimum(name = 'Min20818', )([Con99231,Mul79994])
model = tf.keras.models.Model(inputs=[in0Min9643,in1Min9643,in0Add81354,in1Add81354,in0Con99231,in0Con71116,in0Dep21626,in0Con40392], outputs=Min20818)
w = model.get_layer('Con71116').get_weights() 
w[0] = np.array([[[[[0.7062, 0.0557], [0.1997, 0.1576], [0.5063, 0.7249], [0.9873, 0.2471]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con71116').set_weights(w) 
w = model.get_layer('Dep21626').get_weights() 
w[0] = np.array([[[[0.916]]]])
w[1] = np.array([0])
model.get_layer('Dep21626').set_weights(w) 
in0Min9643 = tf.constant([[[0.4123], [0.615]]])
in1Min9643 = tf.constant([[[0.966], [0.6126]]])
in0Add81354 = tf.constant([[[[[0.0602]], [[0.5519]]], [[[0.5437]], [[0.4352]]]]])
in1Add81354 = tf.constant([[[[[0.0588]], [[0.3442]]], [[[0.4205]], [[0.9609]]]]])
in0Con99231 = tf.constant([[[[0.6416, 0.063, 0.1804], [0.2335, 0.4218, 0.7642]], [[0.283, 0.5172, 0.432], [0.3458, 0.0678, 0.3058]]]])
in0Con71116 = tf.constant([[[[[0.6607, 0.8459]], [[0.2156, 0.4936]]], [[[0.2196, 0.9656]], [[0.6496, 0.7663]]]]])
in0Dep21626 = tf.constant([[[[0.6695]]]])
in0Con40392 = tf.constant([[[[0.191, 0.994, 0.9526], [0.0535, 0.7495, 0.4487]], [[0.4972, 0.2127, 0.3956], [0.0756, 0.6894, 0.1389]]]])
print (np.array2string(model.predict([in0Min9643,in1Min9643,in0Add81354,in1Add81354,in0Con99231,in0Con71116,in0Dep21626,in0Con40392],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min20818.png')

LMin9643 = minimum_layer([[[[0.4123], [0.615]]], [[[0.966], [0.6126]]]], Min9643), 
LRes63720 = reshape_layer(Min9643, [2, 1, 1], Res63720), 
LRes24270 = reshape_layer(Res63720, [2, 1, 1, 1], Res24270), 
LZer43765 = zero_padding3D_layer(Res24270, 0, 0, 1, 0, 0, 0, Zer43765), 
LAdd81354 = add_layer([[[[[[0.0602]], [[0.5519]]], [[[0.5437]], [[0.4352]]]]], [[[[[0.0588]], [[0.3442]]], [[[0.4205]], [[0.9609]]]]]], Add81354), 
LMin54019 = minimum_layer([Zer43765,Add81354], Min54019), 
LRes29135 = reshape_layer(Min54019, [2, 2, 1], Res29135), 
LCon99231 = concatenate_layer([Res29135,[[[[0.6416, 0.063, 0.1804], [0.2335, 0.4218, 0.7642]], [[0.283, 0.5172, 0.432], [0.3458, 0.0678, 0.3058]]]]], 3, Con99231), 
LCon71116 = conv3D_transpose_layer([[[[[0.6607, 0.8459]], [[0.2156, 0.4936]]], [[[0.2196, 0.9656]], [[0.6496, 0.7663]]]]], 1, 1, 1,[[[[[0.7062, 0.0557], [0.1997, 0.1576], [0.5063, 0.7249], [0.9873, 0.2471]]]]],[0, 0, 0, 0], 1, 1, 1, true, Con71116), 
LReL28784 = relu_layer(Con71116, 3.2268872841995657, 2.0496238916156084, 8.833842860852265, ReL28784), 
LRes66738 = reshape_layer(ReL28784, [2, 2, 4], Res66738), 
LDep21626 = depthwise_conv2D_layer([[[[0.6695]]]], 1, 1,[[[[0.916]]]],[0], 1, 1, false, Dep21626), 
LZer26062 = zero_padding2D_layer(Dep21626, 1, 0, 1, 0, Zer26062), 
LCon40392 = concatenate_layer([Zer26062,[[[[0.191, 0.994, 0.9526], [0.0535, 0.7495, 0.4487]], [[0.4972, 0.2127, 0.3956], [0.0756, 0.6894, 0.1389]]]]], 3, Con40392), 
LMul79994 = multiply_layer([Res66738,Con40392], Mul79994), 
LMin20818 = minimum_layer([Con99231,Mul79994], Min20818), 
exec_layers([LMin9643,LRes63720,LRes24270,LZer43765,LAdd81354,LMin54019,LRes29135,LCon99231,LCon71116,LReL28784,LRes66738,LDep21626,LZer26062,LCon40392,LMul79994,LMin20818],["Min9643","Res63720","Res24270","Zer43765","Add81354","Min54019","Res29135","Con99231","Con71116","ReL28784","Res66738","Dep21626","Zer26062","Con40392","Mul79994","Min20818"],Min20818,"Min20818")

Actual (Unparsed): [[[[-0.0000000, -3.3544148, -16.0666345, -15.5661039], [-0.0000000, -0.9554225, -12.8531337, -7.8162550]], [[-0.0000000, -8.8025593, -3.4975343, -6.7934940], [-10.4734794, -1.3300033, -11.2326717, -2.2784360]]]]

Expected (Unparsed): [[[[0,-3.3544147911977205,-16.066634220799777,-15.566103938926132],[-0.0,-0.9554225349809238,-12.853134073116479,-7.816254798225684]],[[0,-8.802559125027507,-3.49753442290701,-6.793494186131867],[-10.473479524189102,-1.3300033492827459,-11.232671434539547,-2.278436018102368]]]]

Actual:   [[[[-0, -3.3544, -16.0666, -15.5661], [-0, -0.9554, -12.8531, -7.8162]], [[-0, -8.8025, -3.4975, -6.7934], [-10.4734, -1.33, -11.2326, -2.2784]]]]

Expected: [[[[0, -3.3544, -16.0666, -15.5661], [-0, -0.9554, -12.8531, -7.8162]], [[0, -8.8025, -3.4975, -6.7934], [-10.4734, -1.33, -11.2326, -2.2784]]]]