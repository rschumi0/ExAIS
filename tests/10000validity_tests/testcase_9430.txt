import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con67429 = tf.keras.layers.Input(shape=([2, 1]))
in0Con73531 = tf.keras.layers.Input(shape=([2, 4, 3, 1]))
in0Ave66316 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Ave66316 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))

Con67429 = keras.layers.Conv1D(4, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con67429', )(in0Con67429)
Res48225 = keras.layers.Reshape((2, 4, 1), name = 'Res48225', )(Con67429)
Res99677 = keras.layers.Reshape((2, 4, 1, 1), name = 'Res99677', )(Res48225)
Zer43759 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer43759', )(Res99677)
Con73531 = keras.layers.Concatenate(axis=4, name = 'Con73531', )([Zer43759,in0Con73531])
Ave66316 = keras.layers.Average(name = 'Ave66316', )([in0Ave66316,in1Ave66316])
Up_84240 = keras.layers.UpSampling3D(size=(2, 1, 1), name = 'Up_84240', )(Ave66316)
Zer11660 = keras.layers.ZeroPadding3D(padding=((0, 0), (3, 0), (1, 0)), name = 'Zer11660', )(Up_84240)
Ave35547 = keras.layers.Average(name = 'Ave35547', )([Con73531,Zer11660])
Res66848 = keras.layers.Reshape((2, 4, 6), name = 'Res66848', )(Ave35547)
Res86569 = keras.layers.Reshape((2, 24), name = 'Res86569', )(Res66848)
Max2930 = keras.layers.MaxPool1D(pool_size=(2), name = 'Max2930', )(Res86569)
model = tf.keras.models.Model(inputs=[in0Con67429,in0Con73531,in0Ave66316,in1Ave66316], outputs=Max2930)
w = model.get_layer('Con67429').get_weights() 
w[0] = np.array([[[0.166, 0.4498, 0.0725, 0.8964]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con67429').set_weights(w) 
in0Con67429 = tf.constant([[[0.1566], [0.8551]]])
in0Con73531 = tf.constant([[[[[0.2584], [0.4292], [0.1053]], [[0.6422], [0.068], [0.4677]], [[0.8062], [0.4688], [0.0989]], [[0.1393], [0.7617], [0.206]]], [[[0.9396], [0.6324], [0.3285]], [[0.5324], [0.9139], [0.7794]], [[0.3926], [0.2995], [0.1416]], [[0.5688], [0.087], [0.6284]]]]])
in0Ave66316 = tf.constant([[[[[0.6469, 0.2606], [0.5661, 0.3011]]]]])
in1Ave66316 = tf.constant([[[[[0.6581, 0.758], [0.9799, 0.2891]]]]])
print (np.array2string(model.predict([in0Con67429,in0Con73531,in0Ave66316,in1Ave66316],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max2930.png')

LCon67429 = conv1D_layer([[[0.1566], [0.8551]]], 1,[[[0.166, 0.4498, 0.0725, 0.8964]]],[0, 0, 0, 0], 1, false, 1, Con67429), 
LRes48225 = reshape_layer(Con67429, [2, 4, 1], Res48225), 
LRes99677 = reshape_layer(Res48225, [2, 4, 1, 1], Res99677), 
LZer43759 = zero_padding3D_layer(Res99677, 0, 0, 0, 0, 2, 0, Zer43759), 
LCon73531 = concatenate_layer([Zer43759,[[[[[0.2584], [0.4292], [0.1053]], [[0.6422], [0.068], [0.4677]], [[0.8062], [0.4688], [0.0989]], [[0.1393], [0.7617], [0.206]]], [[[0.9396], [0.6324], [0.3285]], [[0.5324], [0.9139], [0.7794]], [[0.3926], [0.2995], [0.1416]], [[0.5688], [0.087], [0.6284]]]]]], 4, Con73531), 
LAve66316 = average_layer([[[[[[0.6469, 0.2606], [0.5661, 0.3011]]]]], [[[[[0.6581, 0.758], [0.9799, 0.2891]]]]]], Ave66316), 
LUp_84240 = up_sampling3D_layer(Ave66316, 2, 1, 1, Up_84240), 
LZer11660 = zero_padding3D_layer(Up_84240, 0, 0, 3, 0, 1, 0, Zer11660), 
LAve35547 = average_layer([Con73531,Zer11660], Ave35547), 
LRes66848 = reshape_layer(Ave35547, [2, 4, 6], Res66848), 
LRes86569 = reshape_layer(Res66848, [2, 24], Res86569), 
LMax2930 = max_pool1D_layer(Res86569, 2, Max2930), 
exec_layers([LCon67429,LRes48225,LRes99677,LZer43759,LCon73531,LAve66316,LUp_84240,LZer11660,LAve35547,LRes66848,LRes86569,LMax2930],["Con67429","Res48225","Res99677","Zer43759","Con73531","Ave66316","Up_84240","Zer11660","Ave35547","Res66848","Res86569","Max2930"],Max2930,"Max2930")

Actual (Unparsed): [[[0.0000000, 0.4698000, 0.0000000, 0.3162000, 0.0709733, 0.1642500, 0.0000000, 0.3211000, 0.0000000, 0.4569500, 0.1923120, 0.3897000, 0.0000000, 0.4031000, 0.0000000, 0.2344000, 0.0309974, 0.0708000, 0.0000000, 0.2844000, 0.3262500, 0.6355000, 0.7697558, 0.4617500]]]

Expected (Unparsed): [[[0,0.4698,0,0.3162,0.0709733,0.16425,0,0.3211,0,0.45695,0.19231199,0.3897,0,0.4031,0,0.2344,0.030997374999999997,0.0708,0,0.2844,0.32625000000000004,0.6355,0.76975582,0.46175]]]

Actual:   [[[0, 0.4698, 0, 0.3162, 0.071, 0.1643, 0, 0.3211, 0, 0.457, 0.1924, 0.3897, 0, 0.4031, 0, 0.2344, 0.031, 0.0708, 0, 0.2844, 0.3263, 0.6355, 0.7698, 0.4618]]]

Expected: [[[0, 0.4698, 0, 0.3162, 0.071, 0.1643, 0, 0.3211, 0, 0.457, 0.1924, 0.3897, 0, 0.4031, 0, 0.2344, 0.031, 0.0708, 0, 0.2844, 0.3263, 0.6355, 0.7698, 0.4618]]]