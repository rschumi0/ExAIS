import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Bat36134 = tf.keras.layers.Input(shape=([4]))
in0Per85911 = tf.keras.layers.Input(shape=([3, 3]))

Bat36134 = keras.layers.BatchNormalization(axis=1, epsilon=0.516078887756246,  name = 'Bat36134', )(in0Bat36134)
Res55645 = keras.layers.Reshape((4, 1), name = 'Res55645', )(Bat36134)
Res60064 = keras.layers.Reshape((4, 1, 1), name = 'Res60064', )(Res55645)
Zer14062 = keras.layers.ZeroPadding2D(padding=((0, 0), (4, 0)), name = 'Zer14062', )(Res60064)
Per85911 = keras.layers.Permute((1,2), name = 'Per85911',)(in0Per85911)
Res99 = keras.layers.Reshape((3, 3, 1), name = 'Res99', )(Per85911)
Ave67721 = keras.layers.AveragePooling2D(pool_size=(1, 3), strides=(1, 1), padding='same', name = 'Ave67721', )(Res99)
Zer97175 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer97175', )(Ave67721)
Mul42187 = keras.layers.Multiply(name = 'Mul42187', )([Zer14062,Zer97175])
model = tf.keras.models.Model(inputs=[in0Bat36134,in0Per85911], outputs=Mul42187)
w = model.get_layer('Bat36134').get_weights() 
w[0] = np.array([0.3778, 0.6006, 0.095, 0.1933])
w[1] = np.array([0.7948, 0.6538, 0.314, 0.9625])
w[2] = np.array([0.847, 0.1522, 0.7077, 0.2944])
w[3] = np.array([0.8697, 0.4856, 0.7541, 0.0392])
model.get_layer('Bat36134').set_weights(w) 
in0Bat36134 = tf.constant([[1.1779, 1.367, 1.7442, 1.7879]])
in0Per85911 = tf.constant([[[1.519, 1.6392, 1.3224], [1.3652, 1.3645, 1.6188], [1.6983, 1.1283, 1.9228]]])
print (np.array2string(model.predict([in0Bat36134,in0Per85911],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul42187.png')

LBat36134 = batch_normalization_layer([[1.1779, 1.367, 1.7442, 1.7879]], 1, 0.516078887756246, [0.3778, 0.6006, 0.095, 0.1933], [0.7948, 0.6538, 0.314, 0.9625], [0.847, 0.1522, 0.7077, 0.2944], [0.8697, 0.4856, 0.7541, 0.0392], Bat36134), 
LRes55645 = reshape_layer(Bat36134, [4, 1], Res55645), 
LRes60064 = reshape_layer(Res55645, [4, 1, 1], Res60064), 
LZer14062 = zero_padding2D_layer(Res60064, 0, 0, 4, 0, Zer14062), 
LPer85911 = permute_layer([[[1.519, 1.6392, 1.3224], [1.3652, 1.3645, 1.6188], [1.6983, 1.1283, 1.9228]]], 1,2, Per85911), 
LRes99 = reshape_layer(Per85911, [3, 3, 1], Res99), 
LAve67721 = average_pooling2D_layer(Res99, 1, 3, 1, 1, true, Ave67721), 
LZer97175 = zero_padding2D_layer(Ave67721, 1, 0, 2, 0, Zer97175), 
LMul42187 = multiply_layer([Zer14062,Zer97175], Mul42187), 
exec_layers([LBat36134,LRes55645,LRes60064,LZer14062,LPer85911,LRes99,LAve67721,LZer97175,LMul42187],["Bat36134","Res55645","Res60064","Zer14062","Per85911","Res99","Ave67721","Zer97175","Mul42187"],Mul42187,"Mul42187")

Actual (Unparsed): [[[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [2.0476460]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.5987030]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [2.0593696]]]]

Expected (Unparsed): [[[[0],[0],[0],[0],[0.0]],[[0],[0],[0.0],[0.0],[2.0476460706754627]],[[0],[0],[0.0],[0.0],[0.5987029996662007]],[[0],[0],[0.0],[0.0],[2.059369725793162]]]]

Actual:   [[[[0], [0], [0], [0], [0]], [[0], [0], [0], [0], [2.0477]], [[0], [0], [0], [0], [0.5988]], [[0], [0], [0], [0], [2.0594]]]]

Expected: [[[[0], [0], [0], [0], [0]], [[0], [0], [0], [0], [2.0477]], [[0], [0], [0], [0], [0.5988]], [[0], [0], [0], [0], [2.0594]]]]