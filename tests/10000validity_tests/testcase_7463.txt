import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave38443 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Ave38443 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con43930 = tf.keras.layers.Input(shape=([3, 5, 1]))
in0Sub19699 = tf.keras.layers.Input(shape=([2, 3, 2]))
in1Sub19699 = tf.keras.layers.Input(shape=([2, 3, 2]))
in0Con22835 = tf.keras.layers.Input(shape=([3, 5, 1]))
in0Mas83191 = tf.keras.layers.Input(shape=([3, 1, 3]))

Ave38443 = keras.layers.Average(name = 'Ave38443', )([in0Ave38443,in1Ave38443])
Res40238 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res40238', )(Ave38443)
Cro69254 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro69254', )(Res40238)
Res8031 = keras.layers.Reshape((1, 1, 2), name = 'Res8031', )(Cro69254)
Zer20855 = keras.layers.ZeroPadding2D(padding=((2, 0), (4, 0)), name = 'Zer20855', )(Res8031)
Con43930 = keras.layers.Concatenate(axis=3, name = 'Con43930', )([Zer20855,in0Con43930])
Sub19699 = keras.layers.Subtract(name = 'Sub19699', )([in0Sub19699,in1Sub19699])
Zer13884 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer13884', )(Sub19699)
Con22835 = keras.layers.Concatenate(axis=3, name = 'Con22835', )([Zer13884,in0Con22835])
Mas83191 = keras.layers.Masking(mask_value=2, name = 'Mas83191', )(in0Mas83191)
Zer28584 = keras.layers.ZeroPadding2D(padding=((0, 0), (4, 0)), name = 'Zer28584', )(Mas83191)
Add90467 = keras.layers.Add(name = 'Add90467', )([Con22835,Zer28584])
Add27062 = keras.layers.Add(name = 'Add27062', )([Con43930,Add90467])
Res135 = keras.layers.Reshape((3, 15), name = 'Res135', )(Add27062)
Sim45570 = keras.layers.SimpleRNN(2,name = 'Sim45570', )(Res135)
model = tf.keras.models.Model(inputs=[in0Ave38443,in1Ave38443,in0Con43930,in0Sub19699,in1Sub19699,in0Con22835,in0Mas83191], outputs=Sim45570)
w = model.get_layer('Sim45570').get_weights() 
w[0] = np.array([[6, 2], [1, 1], [3, 9], [10, 5], [4, 9], [9, 7], [4, 8], [6, 4], [1, 6], [6, 2], [2, 5], [6, 8], [10, 8], [3, 7], [5, 8]])
w[1] = np.array([[7, 3], [1, 3]])
w[2] = np.array([1, 4])
model.get_layer('Sim45570').set_weights(w) 
in0Ave38443 = tf.constant([[[[0.7225, 0.7615]]]])
in1Ave38443 = tf.constant([[[[0.4842, 0.4655]]]])
in0Con43930 = tf.constant([[[[0.3228], [0.0308], [0.0185], [0.2356], [0.1798]], [[0.563], [0.2178], [0.7663], [0.3504], [0.3679]], [[0.643], [0.372], [0.6918], [0.4038], [0.3804]]]])
in0Sub19699 = tf.constant([[[[0.2111, 0.7063], [0.923, 0.2864], [0.0957, 0.429]], [[0.7366, 0.0154], [0.5609, 0.7743], [0.5354, 0.8556]]]])
in1Sub19699 = tf.constant([[[[0.9519, 0.543], [0.5649, 0.7617], [0.0206, 0.6537]], [[0.577, 0.066], [0.9683, 0.8537], [0.6184, 0.5975]]]])
in0Con22835 = tf.constant([[[[0.8983], [0.6746], [0.3306], [0.2552], [0.8752]], [[0.1841], [0.9652], [0.1105], [0.1277], [0.4907]], [[0.3569], [0.3866], [0.0364], [0.5901], [0.1334]]]])
in0Mas83191 = tf.constant([[[[1.4072, 1.608, 1.9247]], [[1.988, 1.9103, 1.4075]], [[1.1056, 1.0576, 1.5161]]]])
print (np.array2string(model.predict([in0Ave38443,in1Ave38443,in0Con43930,in0Sub19699,in1Sub19699,in0Con22835,in0Mas83191],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sim45570.png')

LAve38443 = average_layer([[[[[0.7225, 0.7615]]]], [[[[0.4842, 0.4655]]]]], Ave38443), 
LRes40238 = reshape_layer(Ave38443, [1, 1, 2, 1], Res40238), 
LCro69254 = cropping3D_layer(Res40238, 0, 0, 0, 0, 0, 0, Cro69254), 
LRes8031 = reshape_layer(Cro69254, [1, 1, 2], Res8031), 
LZer20855 = zero_padding2D_layer(Res8031, 2, 0, 4, 0, Zer20855), 
LCon43930 = concatenate_layer([Zer20855,[[[[0.3228], [0.0308], [0.0185], [0.2356], [0.1798]], [[0.563], [0.2178], [0.7663], [0.3504], [0.3679]], [[0.643], [0.372], [0.6918], [0.4038], [0.3804]]]]], 3, Con43930), 
LSub19699 = subtract_layer([[[[0.2111, 0.7063], [0.923, 0.2864], [0.0957, 0.429]], [[0.7366, 0.0154], [0.5609, 0.7743], [0.5354, 0.8556]]]], [[[[0.9519, 0.543], [0.5649, 0.7617], [0.0206, 0.6537]], [[0.577, 0.066], [0.9683, 0.8537], [0.6184, 0.5975]]]], Sub19699), 
LZer13884 = zero_padding2D_layer(Sub19699, 1, 0, 2, 0, Zer13884), 
LCon22835 = concatenate_layer([Zer13884,[[[[0.8983], [0.6746], [0.3306], [0.2552], [0.8752]], [[0.1841], [0.9652], [0.1105], [0.1277], [0.4907]], [[0.3569], [0.3866], [0.0364], [0.5901], [0.1334]]]]], 3, Con22835), 
LMas83191 = masking_layer([[[[1.4072, 1.608, 1.9247]], [[1.988, 1.9103, 1.4075]], [[1.1056, 1.0576, 1.5161]]]], 2, Mas83191), 
LZer28584 = zero_padding2D_layer(Mas83191, 0, 0, 4, 0, Zer28584), 
LAdd90467 = add_layer([Con22835,Zer28584], Add90467), 
LAdd27062 = add_layer([Con43930,Add90467], Add27062), 
LRes135 = reshape_layer(Add27062, [3, 15], Res135), 
LSim45570 = simple_rnn_layer(Res135,[[6, 2], [1, 1], [3, 9], [10, 5], [4, 9], [9, 7], [4, 8], [6, 4], [1, 6], [6, 2], [2, 5], [6, 8], [10, 8], [3, 7], [5, 8]],[[7, 3], [1, 3]],[1, 4], Sim45570), 
exec_layers([LAve38443,LRes40238,LCro69254,LRes8031,LZer20855,LCon43930,LSub19699,LZer13884,LCon22835,LMas83191,LZer28584,LAdd90467,LAdd27062,LRes135,LSim45570],["Ave38443","Res40238","Cro69254","Res8031","Zer20855","Con43930","Sub19699","Zer13884","Con22835","Mas83191","Zer28584","Add90467","Add27062","Res135","Sim45570"],Sim45570,"Sim45570")

Actual (Unparsed): [[1.0000000, 1.0000000]]

Expected (Unparsed): [[1.0,1.0]]

Actual:   [[1, 1]]

Expected: [[1, 1]]