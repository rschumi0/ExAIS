import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Up_7580 = tf.keras.layers.Input(shape=([2, 4, 2, 3]))
in0Up_38709 = tf.keras.layers.Input(shape=([2, 1]))
in0Con17186 = tf.keras.layers.Input(shape=([4, 47]))

Up_7580 = keras.layers.UpSampling3D(size=(2, 2, 1), name = 'Up_7580', )(in0Up_7580)
Res36299 = keras.layers.Reshape((4, 8, 6), name = 'Res36299', )(Up_7580)
Res30144 = keras.layers.Reshape((4, 48), name = 'Res30144', )(Res36299)
Up_38709 = keras.layers.UpSampling1D(size=(2), name = 'Up_38709', )(in0Up_38709)
Con17186 = keras.layers.Concatenate(axis=2, name = 'Con17186', )([Up_38709,in0Con17186])
Mul66611 = keras.layers.Multiply(name = 'Mul66611', )([Res30144,Con17186])
Max13766 = keras.layers.MaxPool1D(pool_size=(2), strides=(1), padding='valid', name = 'Max13766', )(Mul66611)
model = tf.keras.models.Model(inputs=[in0Up_7580,in0Up_38709,in0Con17186], outputs=Max13766)
in0Up_7580 = tf.constant([[[[[1.9449, 1.978, 1.7435], [1.5581, 1.1157, 1.4082]], [[1.5195, 1.5206, 1.5443], [1.5356, 1.6838, 1.3776]], [[1.2674, 1.9384, 1.967], [1.4643, 1.6718, 1.7665]], [[1.379, 1.0667, 1.8595], [1.1961, 1.0041, 1.6353]]], [[[1.9834, 1.0214, 1.232], [1.9369, 1.1167, 1.0817]], [[1.3213, 1.0074, 1.0819], [1.0597, 1.5675, 1.7466]], [[1.804, 1.5522, 1.5072], [1.0029, 1.1783, 1.2194]], [[1.5244, 1.0383, 1.1455], [1.243, 1.9497, 1.3339]]]]])
in0Up_38709 = tf.constant([[[1.6524], [1.29]]])
in0Con17186 = tf.constant([[[0.2048, 0.7841, 0.2276, 0.02, 0.9679, 0.113, 0.731, 0.309, 0.4102, 0.2257, 0.184, 0.1151, 0.325, 0.8306, 0.6998, 0.2252, 0.2153, 0.3964, 0.8973, 0.7171, 0.2708, 0.421, 0.4276, 0.0973, 0.4374, 0.542, 0.2888, 0.2565, 0.2043, 0.4951, 0.1808, 0.1751, 0.8684, 0.4765, 0.1755, 0.3779, 0.1996, 0.2941, 0.5327, 0.9787, 0.6289, 0.8016, 0.5802, 0.784, 0.3062, 0.5022, 0.1948], [0.3297, 0.6351, 0.8824, 0.5684, 0.9159, 0.1829, 0.9875, 0.6272, 0.6727, 0.182, 0.9892, 0.6803, 0.4407, 0.1949, 0.0094, 0.6207, 0.7847, 0.8979, 0.265, 0.2732, 0.7687, 0.3511, 0.6744, 0.2913, 0.2191, 0.5731, 0.4299, 0.3409, 0.0747, 0.7123, 0.6789, 0.1783, 0.084, 0.6172, 0.3822, 0.6268, 0.5443, 0.149, 0.6207, 0.3894, 0.0003, 0.1488, 0.1054, 0.0968, 0.8186, 0.5764, 0.417], [0.9805, 0.3383, 0.971, 0.5427, 0.0888, 0.8598, 0.047, 0.6131, 0.0159, 0.0806, 0.9383, 0.3485, 0.7044, 0.7107, 0.3288, 0.6165, 0.9964, 0.9091, 0.4662, 0.6769, 0.2604, 0.8704, 0.8485, 0.1422, 0.6001, 0.3618, 0.1897, 0.4177, 0.8652, 0.2583, 0.1285, 0.4041, 0.9243, 0.1608, 0.0234, 0.5392, 0.4379, 0.9909, 0.096, 0.8381, 0.6724, 0.0549, 0.1276, 0.4499, 0.7349, 0.4414, 0.8945], [0.3909, 0.9752, 0.778, 0.5339, 0.5368, 0.2019, 0.3078, 0.0746, 0.6611, 0.7897, 0.9687, 0.4347, 0.2922, 0.7169, 0.6586, 0.2954, 0.427, 0.0657, 0.1497, 0.3898, 0.6889, 0.541, 0.183, 0.913, 0.3457, 0.1217, 0.1146, 0.9551, 0.7128, 0.0422, 0.1139, 0.0869, 0.8603, 0.9221, 0.3196, 0.4861, 0.2146, 0.0112, 0.5495, 0.2822, 0.5984, 0.1967, 0.1276, 0.1208, 0.4901, 0.6327, 0.1451]]])
print (np.array2string(model.predict([in0Up_7580,in0Up_38709,in0Con17186],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max13766.png')

LUp_7580 = up_sampling3D_layer([[[[[1.9449, 1.978, 1.7435], [1.5581, 1.1157, 1.4082]], [[1.5195, 1.5206, 1.5443], [1.5356, 1.6838, 1.3776]], [[1.2674, 1.9384, 1.967], [1.4643, 1.6718, 1.7665]], [[1.379, 1.0667, 1.8595], [1.1961, 1.0041, 1.6353]]], [[[1.9834, 1.0214, 1.232], [1.9369, 1.1167, 1.0817]], [[1.3213, 1.0074, 1.0819], [1.0597, 1.5675, 1.7466]], [[1.804, 1.5522, 1.5072], [1.0029, 1.1783, 1.2194]], [[1.5244, 1.0383, 1.1455], [1.243, 1.9497, 1.3339]]]]], 2, 2, 1, Up_7580), 
LRes36299 = reshape_layer(Up_7580, [4, 8, 6], Res36299), 
LRes30144 = reshape_layer(Res36299, [4, 48], Res30144), 
LUp_38709 = up_sampling1D_layer([[[1.6524], [1.29]]], 2, Up_38709), 
LCon17186 = concatenate_layer([Up_38709,[[[0.2048, 0.7841, 0.2276, 0.02, 0.9679, 0.113, 0.731, 0.309, 0.4102, 0.2257, 0.184, 0.1151, 0.325, 0.8306, 0.6998, 0.2252, 0.2153, 0.3964, 0.8973, 0.7171, 0.2708, 0.421, 0.4276, 0.0973, 0.4374, 0.542, 0.2888, 0.2565, 0.2043, 0.4951, 0.1808, 0.1751, 0.8684, 0.4765, 0.1755, 0.3779, 0.1996, 0.2941, 0.5327, 0.9787, 0.6289, 0.8016, 0.5802, 0.784, 0.3062, 0.5022, 0.1948], [0.3297, 0.6351, 0.8824, 0.5684, 0.9159, 0.1829, 0.9875, 0.6272, 0.6727, 0.182, 0.9892, 0.6803, 0.4407, 0.1949, 0.0094, 0.6207, 0.7847, 0.8979, 0.265, 0.2732, 0.7687, 0.3511, 0.6744, 0.2913, 0.2191, 0.5731, 0.4299, 0.3409, 0.0747, 0.7123, 0.6789, 0.1783, 0.084, 0.6172, 0.3822, 0.6268, 0.5443, 0.149, 0.6207, 0.3894, 0.0003, 0.1488, 0.1054, 0.0968, 0.8186, 0.5764, 0.417], [0.9805, 0.3383, 0.971, 0.5427, 0.0888, 0.8598, 0.047, 0.6131, 0.0159, 0.0806, 0.9383, 0.3485, 0.7044, 0.7107, 0.3288, 0.6165, 0.9964, 0.9091, 0.4662, 0.6769, 0.2604, 0.8704, 0.8485, 0.1422, 0.6001, 0.3618, 0.1897, 0.4177, 0.8652, 0.2583, 0.1285, 0.4041, 0.9243, 0.1608, 0.0234, 0.5392, 0.4379, 0.9909, 0.096, 0.8381, 0.6724, 0.0549, 0.1276, 0.4499, 0.7349, 0.4414, 0.8945], [0.3909, 0.9752, 0.778, 0.5339, 0.5368, 0.2019, 0.3078, 0.0746, 0.6611, 0.7897, 0.9687, 0.4347, 0.2922, 0.7169, 0.6586, 0.2954, 0.427, 0.0657, 0.1497, 0.3898, 0.6889, 0.541, 0.183, 0.913, 0.3457, 0.1217, 0.1146, 0.9551, 0.7128, 0.0422, 0.1139, 0.0869, 0.8603, 0.9221, 0.3196, 0.4861, 0.2146, 0.0112, 0.5495, 0.2822, 0.5984, 0.1967, 0.1276, 0.1208, 0.4901, 0.6327, 0.1451]]]], 2, Con17186), 
LMul66611 = multiply_layer([Res30144,Con17186], Mul66611), 
LMax13766 = max_pool1D_layer(Mul66611, 2, 1, false, Max13766), 
exec_layers([LUp_7580,LRes36299,LRes30144,LUp_38709,LCon17186,LMul66611,LMax13766],["Up_7580","Res36299","Res30144","Up_38709","Con17186","Mul66611","Max13766"],Max13766,"Max13766")

Actual (Unparsed): [[[3.2137529, 0.6521466, 1.3670783, 1.3748674, 0.6341639, 1.3629968, 0.3557222, 1.9532751, 1.0935232, 1.0481338, 0.2518135, 1.3929915, 1.0337159, 0.6701284, 1.2826956, 1.0746129, 1.0451347, 1.0810027, 1.3643590, 1.3644344, 1.1074175, 1.1804157, 0.7088798, 0.9290534, 0.3691936, 0.8478562, 1.1272876, 0.6295026, 0.5699166, 0.3608960, 0.9027690, 1.3159798, 0.3507161, 1.2715981, 1.0318350, 0.6751563, 0.8643572, 0.5806048, 0.5468789, 0.7424193, 0.9827126, 1.0284402, 1.1054063, 0.6188993, 1.4578480, 0.9791275, 0.5787632, 0.6819201], [3.2137529, 1.0014827, 1.1072969, 1.8807299, 0.6341639, 1.2897704, 1.7053273, 1.9532751, 1.0935232, 1.0481338, 0.2030574, 1.3929915, 1.0337159, 0.7096126, 0.7689063, 0.3484294, 1.0451347, 1.7403123, 1.3643590, 0.4696499, 0.7323381, 1.1804157, 1.3643520, 1.4819902, 0.3691936, 0.9314752, 1.1272876, 0.6295026, 0.5699166, 1.0550249, 0.9027690, 1.3159798, 0.6090595, 0.9269805, 1.0318350, 0.6751563, 0.8643572, 0.5806048, 1.1350759, 0.7424193, 1.6340436, 0.8969143, 0.2051952, 0.1324871, 0.5153604, 0.9791275, 0.8605976, 1.1931736], [2.5585859, 1.0014827, 1.2014464, 1.8807299, 0.6060331, 0.5806566, 1.7053273, 0.3143869, 0.7553392, 1.2804845, 0.8818580, 1.0478427, 0.5743691, 0.7096126, 0.7756141, 0.6979184, 0.9663638, 1.7403123, 1.2011939, 0.4696499, 0.7323381, 0.7300273, 1.3643520, 1.4819902, 1.6470520, 0.9314752, 0.5453049, 0.1902501, 1.1253944, 1.0550249, 0.4659732, 0.1994577, 0.6090595, 0.9269805, 1.0865105, 0.3897202, 0.8219565, 0.4546716, 1.1350759, 0.6830285, 1.6340436, 0.8969143, 0.2998495, 0.1324871, 0.5153604, 0.9134807, 1.2335752, 1.1931736]]]

Expected (Unparsed): [[[3.21375276,0.6521466,1.36707835,1.37486744,0.63416388,1.3629967799999998,0.35572221000000004,1.953275,1.0935232,1.04813387,0.25181349,1.3929914399999999,1.03371585,0.67012842,1.28269558,1.07461288,1.04513466,1.0810027199999999,1.36435905,1.3644343799999998,1.10741753,1.18041572,0.7088798,0.92905344,0.36919362000000006,0.84785616,1.1272877000000001,0.62950257,0.56991662,0.36089595,0.9027690200000001,1.3159797599999998,0.3507161,1.27159812,1.0318349599999999,0.6751562999999999,0.8643572,0.58060481,0.54687895,0.74241927,0.98271267,1.02844017,1.1054064,0.61889934,1.457848,0.97912746,0.57876324,0.6819200999999999],[3.21375276,1.0014827000000002,1.10729685,1.8807299,0.63416388,1.28977038,1.70532732,1.953275,1.0935232,1.04813387,0.20305739999999997,1.3929914399999999,1.03371585,0.7096125600000001,0.7689063300000001,0.34842936,1.04513466,1.74031224,1.36435905,0.46964988,0.73233811,1.18041572,1.3643519999999998,1.4819901,0.36919362000000006,0.9314752199999999,1.1272877000000001,0.62950257,0.56991662,1.05502488,0.9027690200000001,1.3159797599999998,0.6090595200000001,0.92698047,1.0318349599999999,0.6751562999999999,0.8643572,0.58060481,1.13507595,0.74241927,1.63404357,0.89691436,0.2051952,0.13248707999999998,0.51536045,0.97912746,0.86059758,1.19317355],[2.558586,1.0014827000000002,1.2014464,1.8807299,0.6060330899999999,0.5806565600000001,1.70532732,0.31438692000000007,0.7553392,1.2804845900000001,0.88185799,1.04784279,0.5743691099999999,0.7096125600000001,0.77561411,0.69791842,0.96636375,1.74031224,1.20119383,0.46964988,0.73233811,0.73002733,1.3643519999999998,1.4819901,1.6470520000000002,0.9314752199999999,0.5453049600000001,0.19025013,1.1253943299999998,1.05502488,0.4659732,0.19945770000000002,0.6090595200000001,0.92698047,1.08651043,0.38972024,0.82195648,0.45467157,1.13507595,0.6830285,1.63404357,0.89691436,0.29984948,0.13248707999999998,0.51536045,0.9134807,1.23357519,1.19317355]]]

Actual:   [[[3.2138, 0.6522, 1.3671, 1.3749, 0.6342, 1.363, 0.3558, 1.9533, 1.0936, 1.0482, 0.2519, 1.393, 1.0338, 0.6702, 1.2827, 1.0747, 1.0452, 1.0811, 1.3644, 1.3645, 1.1075, 1.1805, 0.7089, 0.9291, 0.3692, 0.8479, 1.1273, 0.6296, 0.57, 0.3609, 0.9028, 1.316, 0.3508, 1.2716, 1.0319, 0.6752, 0.8644, 0.5807, 0.5469, 0.7425, 0.9828, 1.0285, 1.1055, 0.6189, 1.4579, 0.9792, 0.5788, 0.682], [3.2138, 1.0015, 1.1073, 1.8808, 0.6342, 1.2898, 1.7054, 1.9533, 1.0936, 1.0482, 0.2031, 1.393, 1.0338, 0.7097, 0.769, 0.3485, 1.0452, 1.7404, 1.3644, 0.4697, 0.7324, 1.1805, 1.3644, 1.482, 0.3692, 0.9315, 1.1273, 0.6296, 0.57, 1.0551, 0.9028, 1.316, 0.6091, 0.927, 1.0319, 0.6752, 0.8644, 0.5807, 1.1351, 0.7425, 1.6341, 0.897, 0.2052, 0.1325, 0.5154, 0.9792, 0.8606, 1.1932], [2.5586, 1.0015, 1.2015, 1.8808, 0.6061, 0.5807, 1.7054, 0.3144, 0.7554, 1.2805, 0.8819, 1.0479, 0.5744, 0.7097, 0.7757, 0.698, 0.9664, 1.7404, 1.2012, 0.4697, 0.7324, 0.7301, 1.3644, 1.482, 1.6471, 0.9315, 0.5454, 0.1903, 1.1254, 1.0551, 0.466, 0.1995, 0.6091, 0.927, 1.0866, 0.3898, 0.822, 0.4547, 1.1351, 0.6831, 1.6341, 0.897, 0.2999, 0.1325, 0.5154, 0.9135, 1.2336, 1.1932]]]

Expected: [[[3.2138, 0.6522, 1.3671, 1.3749, 0.6342, 1.363, 0.3558, 1.9533, 1.0936, 1.0482, 0.2519, 1.393, 1.0338, 0.6702, 1.2827, 1.0747, 1.0452, 1.0811, 1.3644, 1.3645, 1.1075, 1.1805, 0.7089, 0.9291, 0.3692, 0.8479, 1.1273, 0.6296, 0.57, 0.3609, 0.9028, 1.316, 0.3508, 1.2716, 1.0319, 0.6752, 0.8644, 0.5807, 0.5469, 0.7425, 0.9828, 1.0285, 1.1055, 0.6189, 1.4579, 0.9792, 0.5788, 0.682], [3.2138, 1.0015, 1.1073, 1.8808, 0.6342, 1.2898, 1.7054, 1.9533, 1.0936, 1.0482, 0.2031, 1.393, 1.0338, 0.7097, 0.769, 0.3485, 1.0452, 1.7404, 1.3644, 0.4697, 0.7324, 1.1805, 1.3644, 1.482, 0.3692, 0.9315, 1.1273, 0.6296, 0.57, 1.0551, 0.9028, 1.316, 0.6091, 0.927, 1.0319, 0.6752, 0.8644, 0.5807, 1.1351, 0.7425, 1.6341, 0.897, 0.2052, 0.1325, 0.5154, 0.9792, 0.8606, 1.1932], [2.5586, 1.0015, 1.2015, 1.8808, 0.6061, 0.5807, 1.7054, 0.3144, 0.7554, 1.2805, 0.8819, 1.0479, 0.5744, 0.7097, 0.7757, 0.698, 0.9664, 1.7404, 1.2012, 0.4697, 0.7324, 0.7301, 1.3644, 1.482, 1.6471, 0.9315, 0.5454, 0.1903, 1.1254, 1.0551, 0.466, 0.1995, 0.6091, 0.927, 1.0866, 0.3898, 0.822, 0.4547, 1.1351, 0.6831, 1.6341, 0.897, 0.2999, 0.1325, 0.5154, 0.9135, 1.2336, 1.1932]]]