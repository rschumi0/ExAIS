import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST96559 = tf.keras.layers.Input(shape=([1, 3]))

LST96559 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST96559', )(in0LST96559)
Res11085 = keras.layers.Reshape((3, 1), name = 'Res11085', )(LST96559)
Res58774 = keras.layers.Reshape((3, 1, 1), name = 'Res58774', )(Res11085)
Con70718 = keras.layers.Conv2DTranspose(2, (3, 1),strides=(1, 1), padding='valid', name = 'Con70718', )(Res58774)
Zer86993 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer86993', )(Con70718)
Con356 = keras.layers.Conv2DTranspose(4, (2, 2),strides=(2, 1), padding='same', name = 'Con356', )(Zer86993)
model = tf.keras.models.Model(inputs=[in0LST96559], outputs=Con356)
w = model.get_layer('LST96559').get_weights() 
w[0] = np.array([[9, 3, 5, 5, 10, 2, 5, 9, 6, 2, 9, 1], [6, 4, 9, 4, 10, 6, 1, 8, 9, 5, 10, 2], [9, 10, 3, 2, 2, 2, 5, 7, 8, 4, 6, 7]])
w[1] = np.array([[4, 1, 6, 5, 2, 6, 5, 1, 3, 6, 6, 1], [5, 9, 8, 7, 5, 5, 8, 1, 1, 6, 4, 10], [9, 8, 2, 9, 4, 6, 3, 1, 8, 7, 10, 10]])
w[2] = np.array([2, 2, 6, 2, 9, 2, 9, 1, 3, 5, 7, 2])
model.get_layer('LST96559').set_weights(w) 
w = model.get_layer('Con70718').get_weights() 
w[0] = np.array([[[[0.2042], [0.7289]]], [[[0.8891], [0.7389]]], [[[0.2672], [0.9197]]]])
w[1] = np.array([0, 0])
model.get_layer('Con70718').set_weights(w) 
w = model.get_layer('Con356').get_weights() 
w[0] = np.array([[[[0.4832, 0.5829], [0.7124, 0.9709], [0.0076, 0.6171], [0.864, 0.9614]], [[0.7372, 0.5792], [0.2505, 0.5363], [0.5012, 0.0674], [0.2331, 0.059]]], [[[0.6453, 0.8484], [0.6602, 0.3748], [0.8763, 0.5062], [0.9935, 0.3487]], [[0.8061, 0.8046], [0.4979, 0.5541], [0.8136, 0.8049], [0.0871, 0.5859]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con356').set_weights(w) 
in0LST96559 = tf.constant([[[7, 1, 9]]])
print (np.array2string(model.predict([in0LST96559],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con356.png')

LLST96559 = lstm_layer([[[7, 1, 9]]],[[9, 3, 5, 5, 10, 2, 5, 9, 6, 2, 9, 1], [6, 4, 9, 4, 10, 6, 1, 8, 9, 5, 10, 2], [9, 10, 3, 2, 2, 2, 5, 7, 8, 4, 6, 7]],[[4, 1, 6, 5, 2, 6, 5, 1, 3, 6, 6, 1], [5, 9, 8, 7, 5, 5, 8, 1, 1, 6, 4, 10], [9, 8, 2, 9, 4, 6, 3, 1, 8, 7, 10, 10]],[2, 2, 6, 2, 9, 2, 9, 1, 3, 5, 7, 2], LST96559), 
LRes11085 = reshape_layer(LST96559, [3, 1], Res11085), 
LRes58774 = reshape_layer(Res11085, [3, 1, 1], Res58774), 
LCon70718 = conv2D_transpose_layer(Res58774, 3, 1,[[[[0.2042], [0.7289]]], [[[0.8891], [0.7389]]], [[[0.2672], [0.9197]]]],[0, 0], 1, 1, false, Con70718), 
LZer86993 = zero_padding2D_layer(Con70718, 1, 1, 1, 1, Zer86993), 
LCon356 = conv2D_transpose_layer(Zer86993, 2, 2,[[[[0.4832, 0.5829], [0.7124, 0.9709], [0.0076, 0.6171], [0.864, 0.9614]], [[0.7372, 0.5792], [0.2505, 0.5363], [0.5012, 0.0674], [0.2331, 0.059]]], [[[0.6453, 0.8484], [0.6602, 0.3748], [0.8763, 0.5062], [0.9935, 0.3487]], [[0.8061, 0.8046], [0.4979, 0.5541], [0.8136, 0.8049], [0.0871, 0.5859]]]],[0, 0, 0, 0], 2, 1, true, Con356), 
exec_layers([LLST96559,LRes11085,LRes58774,LCon70718,LZer86993,LCon356],["LST96559","Res11085","Res58774","Con70718","Zer86993","Con356"],Con356,"Con356")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.3987290, 0.6497625, 0.3437502, 0.6680653], [0.4361765, 0.3366712, 0.1153609, 0.0690036]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.5713243, 0.3107339, 0.4172848, 0.3480791], [0.5720170, 0.3850275, 0.5733500, 0.3387939]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [1.0539421, 1.6785184, 0.6961644, 1.7941286], [1.2612993, 0.8080916, 0.4926689, 0.2600451]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [1.4857087, 0.9686930, 1.2955167, 1.2170392], [1.5706364, 1.0339875, 1.5772166, 0.7274827]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [1.5605577, 2.5035458, 1.1299514, 2.6433520], [1.8170118, 1.2347128, 0.6418716, 0.3488064]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [2.2112777, 1.3655666, 1.8284038, 1.6634572], [2.2982486, 1.5234219, 2.3065652, 1.1555941]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [1.1618287, 1.8537833, 0.7862012, 1.9752868], [1.3808353, 0.8980416, 0.5265108, 0.2798028]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [1.6399534, 1.0548327, 1.4111190, 1.3153781], [1.7262316, 1.1383944, 1.7332153, 0.8168002]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.5066156, 0.8250273, 0.4337870, 0.8492235], [0.5557125, 0.4266212, 0.1492027, 0.0887612]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.7255690, 0.3968736, 0.5328871, 0.4464180], [0.7276122, 0.4894344, 0.7293486, 0.4281114]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]]]]

Expected (Unparsed): [[[[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]],[[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]],[[0.0,0.0,0.0,0.0],[0.39872900277839984,0.6497625002328503,0.34375017563092736,0.6680652604597859],[0.43617648841950457,0.33667120364696784,0.11536087542567196,0.06900356829751483]],[[0.0,0.0,0.0,0.0],[0.5713243416110633,0.3107338884993032,0.4172847798158269,0.34807909204526305],[0.5720170419596713,0.38502748218814525,0.5733499612036004,0.33879388841468155]],[[0.0,0.0,0.0,0.0],[1.0539421105303608,1.6785184406996825,0.6961644291626049,1.7941285706607157],[1.261299325531982,0.8080916040245596,0.49266892302440674,0.2600451288482711]],[[0.0,0.0,0.0,0.0],[1.4857087479245763,0.9686930077559197,1.2955167075750809,1.2170391973832555],[1.5706363970376715,1.0339874830429236,1.5772166390886033,0.7274826964278763]],[[0.0,0.0,0.0,0.0],[1.5605577189197657,2.5035457815209448,1.1299513930699736,2.64335203960653],[1.8170117942357573,1.234712819909839,0.6418716307989343,0.34880635353666833]],[[0.0,0.0,0.0,0.0],[2.2112777029414254,1.3655665767718723,1.8284037577002517,1.6634572003671506],[2.2982486330155343,1.5234218928391614,2.3065652411985713,1.1555940779024652]],[[0.0,0.0,0.0,0.0],[1.1618287161413658,1.853783281288094,0.7862012174390463,1.9752867791467443],[1.3808353058162528,0.8980416162628712,0.5265107553732622,0.2798027852391535]],[[0.0,0.0,0.0,0.0],[1.639953361330362,1.0548326882725692,1.4111189778844246,1.3153781083218876],[1.7262315910558628,1.1383944106510162,1.7332152799949707,0.8168001894877837]],[[0.0,0.0,0.0,0.0],[0.5066156083894051,0.8250273408212621,0.43378696390736865,0.8492234689458144],[0.5557124687037754,0.42662121588527957,0.14920270777452746,0.08876122468839726]],[[0.0,0.0,0.0,0.0],[0.7255689550168491,0.39687356901595267,0.5328870501251707,0.446418002983895],[0.7276122359778627,0.4894344097962379,0.7293486021099679,0.4281113814745889]],[[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]],[[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]]]]

Actual:   [[[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0.3988, 0.6498, 0.3438, 0.6681], [0.4362, 0.3367, 0.1154, 0.0691]], [[0, 0, 0, 0], [0.5714, 0.3108, 0.4173, 0.3481], [0.5721, 0.3851, 0.5734, 0.3388]], [[0, 0, 0, 0], [1.054, 1.6786, 0.6962, 1.7942], [1.2613, 0.8081, 0.4927, 0.2601]], [[0, 0, 0, 0], [1.4858, 0.9687, 1.2956, 1.2171], [1.5707, 1.034, 1.5773, 0.7275]], [[0, 0, 0, 0], [1.5606, 2.5036, 1.13, 2.6434], [1.8171, 1.2348, 0.6419, 0.3489]], [[0, 0, 0, 0], [2.2113, 1.3656, 1.8285, 1.6635], [2.2983, 1.5235, 2.3066, 1.1556]], [[0, 0, 0, 0], [1.1619, 1.8538, 0.7863, 1.9753], [1.3809, 0.8981, 0.5266, 0.2799]], [[0, 0, 0, 0], [1.64, 1.0549, 1.4112, 1.3154], [1.7263, 1.1384, 1.7333, 0.8169]], [[0, 0, 0, 0], [0.5067, 0.8251, 0.4338, 0.8493], [0.5558, 0.4267, 0.1493, 0.0888]], [[0, 0, 0, 0], [0.7256, 0.3969, 0.5329, 0.4465], [0.7277, 0.4895, 0.7294, 0.4282]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]]]

Expected: [[[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0.3988, 0.6498, 0.3438, 0.6681], [0.4362, 0.3367, 0.1154, 0.0691]], [[0, 0, 0, 0], [0.5714, 0.3108, 0.4173, 0.3481], [0.5721, 0.3851, 0.5734, 0.3388]], [[0, 0, 0, 0], [1.054, 1.6786, 0.6962, 1.7942], [1.2613, 0.8081, 0.4927, 0.2601]], [[0, 0, 0, 0], [1.4858, 0.9687, 1.2956, 1.2171], [1.5707, 1.034, 1.5773, 0.7275]], [[0, 0, 0, 0], [1.5606, 2.5036, 1.13, 2.6434], [1.8171, 1.2348, 0.6419, 0.3489]], [[0, 0, 0, 0], [2.2113, 1.3656, 1.8285, 1.6635], [2.2983, 1.5235, 2.3066, 1.1556]], [[0, 0, 0, 0], [1.1619, 1.8538, 0.7863, 1.9753], [1.3809, 0.8981, 0.5266, 0.2799]], [[0, 0, 0, 0], [1.64, 1.0549, 1.4112, 1.3154], [1.7263, 1.1384, 1.7333, 0.8169]], [[0, 0, 0, 0], [0.5067, 0.8251, 0.4338, 0.8493], [0.5558, 0.4267, 0.1493, 0.0888]], [[0, 0, 0, 0], [0.7256, 0.3969, 0.5329, 0.4465], [0.7277, 0.4895, 0.7294, 0.4282]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]]]