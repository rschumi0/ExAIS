import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max22718 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Max22718 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Dot64155 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot64155 = tf.keras.layers.Input(shape=([2, 2]))

Max22718 = keras.layers.Maximum(name = 'Max22718', )([in0Max22718,in1Max22718])
Res50942 = keras.layers.Reshape((1, 4), name = 'Res50942', )(Max22718)
Con85422 = keras.layers.Conv1D(2, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con85422', )(Res50942)
Fla49166 = keras.layers.Flatten(name = 'Fla49166', )(Con85422)
Dot64155 = keras.layers.Dot(axes=(2, 1), name = 'Dot64155', )([in0Dot64155,in1Dot64155])
Con81475 = keras.layers.Conv1D(3, (2),strides=(8), padding='valid', dilation_rate=(1), name = 'Con81475', )(Dot64155)
Res47654 = keras.layers.Reshape((1, 3, 1), name = 'Res47654', )(Con81475)
Res88228 = keras.layers.Reshape((1, 3, 1, 1), name = 'Res88228', )(Res47654)
Con79150 = keras.layers.Conv3DTranspose(2, (1, 3, 1),strides=(1, 1, 1), padding='valid', name = 'Con79150', )(Res88228)
Res52436 = keras.layers.Reshape((1, 5, 2), name = 'Res52436', )(Con79150)
Res29255 = keras.layers.Reshape((1, 10), name = 'Res29255', )(Res52436)
LST31783 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST31783', )(Res29255)
Add94079 = keras.layers.Add(name = 'Add94079', )([Fla49166,LST31783])
model = tf.keras.models.Model(inputs=[in0Max22718,in1Max22718,in0Dot64155,in1Dot64155], outputs=Add94079)
w = model.get_layer('Con85422').get_weights() 
w[0] = np.array([[[0.0861, 0.769], [0.9712, 0.2204], [0.5033, 0.8797], [0.0737, 0.7249]]])
w[1] = np.array([0, 0])
model.get_layer('Con85422').set_weights(w) 
w = model.get_layer('Con81475').get_weights() 
w[0] = np.array([[[0.8023, 0.7575, 0.232], [0.6502, 0.4936, 0.0046]], [[0.6814, 0.7788, 0.2085], [0.2692, 0.3001, 0.266]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con81475').set_weights(w) 
w = model.get_layer('Con79150').get_weights() 
w[0] = np.array([[[[[0.0225], [0.8151]]], [[[0.0985], [0.643]]], [[[0.5844], [0.5594]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con79150').set_weights(w) 
w = model.get_layer('LST31783').get_weights() 
w[0] = np.array([[6, 1, 5, 4, 2, 5, 5, 5], [6, 5, 8, 9, 8, 1, 9, 5], [10, 4, 9, 4, 5, 9, 4, 2], [10, 7, 9, 2, 7, 6, 9, 6], [9, 8, 2, 1, 7, 2, 1, 2], [1, 5, 3, 9, 1, 8, 1, 7], [3, 4, 5, 2, 9, 10, 6, 8], [3, 2, 6, 10, 9, 5, 5, 10], [2, 2, 8, 10, 1, 6, 7, 6], [2, 6, 1, 1, 3, 6, 7, 5]])
w[1] = np.array([[7, 1, 3, 2, 5, 8, 6, 3], [3, 1, 10, 10, 5, 4, 10, 10]])
w[2] = np.array([3, 3, 6, 1, 7, 3, 9, 5])
model.get_layer('LST31783').set_weights(w) 
in0Max22718 = tf.constant([[[[0.2924, 0.443], [0.8294, 0.9842]]]])
in1Max22718 = tf.constant([[[[0.8777, 0.9368], [0.6489, 0.9649]]]])
in0Dot64155 = tf.constant([[[0.2238, 0.667], [0.5777, 0.9571]]])
in1Dot64155 = tf.constant([[[0.7409, 0.6068], [0.6742, 0.37]]])
print (np.array2string(model.predict([in0Max22718,in1Max22718,in0Dot64155,in1Dot64155],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add94079.png')

LMax22718 = maximum_layer([[[[[0.2924, 0.443], [0.8294, 0.9842]]]], [[[[0.8777, 0.9368], [0.6489, 0.9649]]]]], Max22718), 
LRes50942 = reshape_layer(Max22718, [1, 4], Res50942), 
LCon85422 = conv1D_layer(Res50942, 1,[[[0.0861, 0.769], [0.9712, 0.2204], [0.5033, 0.8797], [0.0737, 0.7249]]],[0, 0], 1, false, 1, Con85422), 
LFla49166 = flatten_layer(Con85422, Fla49166), 
LDot64155 = dot_layer([[[0.2238, 0.667], [0.5777, 0.9571]]], [[[0.7409, 0.6068], [0.6742, 0.37]]], 2, 1, Dot64155), 
LCon81475 = conv1D_layer(Dot64155, 2,[[[0.8023, 0.7575, 0.232], [0.6502, 0.4936, 0.0046]], [[0.6814, 0.7788, 0.2085], [0.2692, 0.3001, 0.266]]],[0, 0, 0], 8, false, 1, Con81475), 
LRes47654 = reshape_layer(Con81475, [1, 3, 1], Res47654), 
LRes88228 = reshape_layer(Res47654, [1, 3, 1, 1], Res88228), 
LCon79150 = conv3D_transpose_layer(Res88228, 1, 3, 1,[[[[[0.0225], [0.8151]]], [[[0.0985], [0.643]]], [[[0.5844], [0.5594]]]]],[0, 0], 1, 1, 1, false, Con79150), 
LRes52436 = reshape_layer(Con79150, [1, 5, 2], Res52436), 
LRes29255 = reshape_layer(Res52436, [1, 10], Res29255), 
LLST31783 = lstm_layer(Res29255,[[6, 1, 5, 4, 2, 5, 5, 5], [6, 5, 8, 9, 8, 1, 9, 5], [10, 4, 9, 4, 5, 9, 4, 2], [10, 7, 9, 2, 7, 6, 9, 6], [9, 8, 2, 1, 7, 2, 1, 2], [1, 5, 3, 9, 1, 8, 1, 7], [3, 4, 5, 2, 9, 10, 6, 8], [3, 2, 6, 10, 9, 5, 5, 10], [2, 2, 8, 10, 1, 6, 7, 6], [2, 6, 1, 1, 3, 6, 7, 5]],[[7, 1, 3, 2, 5, 8, 6, 3], [3, 1, 10, 10, 5, 4, 10, 10]],[3, 3, 6, 1, 7, 3, 9, 5], LST31783), 
LAdd94079 = add_layer([Fla49166,LST31783], Add94079), 
exec_layers([LMax22718,LRes50942,LCon85422,LFla49166,LDot64155,LCon81475,LRes47654,LRes88228,LCon79150,LRes52436,LRes29255,LLST31783,LAdd94079],["Max22718","Res50942","Con85422","Fla49166","Dot64155","Con81475","Res47654","Res88228","Con79150","Res52436","Res29255","LST31783","Add94079"],Add94079,"Add94079")

Actual (Unparsed): [[2.2369568, 3.0860859]]

Expected (Unparsed): [[2.2369568459557647,3.0860859359557646]]

Actual:   [[2.237, 3.0861]]

Expected: [[2.237, 3.0861]]