import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max41881 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Max41881 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))

Max41881 = keras.layers.Maximum(name = 'Max41881', )([in0Max41881,in1Max41881])
Res68570 = keras.layers.Reshape((2, 1, 2), name = 'Res68570', )(Max41881)
Res15797 = keras.layers.Reshape((2, 2), name = 'Res15797', )(Res68570)
LST32650 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST32650', )(Res15797)
model = tf.keras.models.Model(inputs=[in0Max41881,in1Max41881], outputs=LST32650)
w = model.get_layer('LST32650').get_weights() 
w[0] = np.array([[8, 8, 9, 1, 6, 1, 10, 1, 9, 6, 9, 7], [8, 1, 2, 9, 3, 2, 9, 1, 2, 3, 10, 2]])
w[1] = np.array([[6, 3, 10, 3, 6, 9, 8, 9, 9, 2, 1, 9], [2, 8, 9, 2, 2, 8, 5, 4, 3, 2, 8, 6], [10, 9, 4, 8, 1, 1, 4, 10, 4, 1, 4, 3]])
w[2] = np.array([7, 8, 6, 10, 9, 10, 5, 6, 9, 7, 3, 1])
model.get_layer('LST32650').set_weights(w) 
in0Max41881 = tf.constant([[[[[0.0539, 0.2797]]], [[[0.4119, 0.8012]]]]])
in1Max41881 = tf.constant([[[[[0.4312, 0.1887]]], [[[0.0113, 0.4652]]]]])
print (np.array2string(model.predict([in0Max41881,in1Max41881],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST32650.png')

LMax41881 = maximum_layer([[[[[[0.0539, 0.2797]]], [[[0.4119, 0.8012]]]]], [[[[[0.4312, 0.1887]]], [[[0.0113, 0.4652]]]]]], Max41881), 
LRes68570 = reshape_layer(Max41881, [2, 1, 2], Res68570), 
LRes15797 = reshape_layer(Res68570, [2, 2], Res15797), 
LLST32650 = lstm_layer(Res15797,[[8, 8, 9, 1, 6, 1, 10, 1, 9, 6, 9, 7], [8, 1, 2, 9, 3, 2, 9, 1, 2, 3, 10, 2]],[[6, 3, 10, 3, 6, 9, 8, 9, 9, 2, 1, 9], [2, 8, 9, 2, 2, 8, 5, 4, 3, 2, 8, 6], [10, 9, 4, 8, 1, 1, 4, 10, 4, 1, 4, 3]],[7, 8, 6, 10, 9, 10, 5, 6, 9, 7, 3, 1], LST32650), 
exec_layers([LMax41881,LRes68570,LRes15797,LLST32650],["Max41881","Res68570","Res15797","LST32650"],LST32650,"LST32650")

Actual (Unparsed): [[0.9640272, 0.9640268, 0.9640255]]

Expected (Unparsed): [[0.9640272115862479,0.9640268014619067,0.964025510161955]]

Actual:   [[0.9641, 0.9641, 0.9641]]

Expected: [[0.9641, 0.9641, 0.9641]]