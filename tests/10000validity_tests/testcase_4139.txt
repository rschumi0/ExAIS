import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max18997 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Max18997 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con55237 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Dot33254 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot33254 = tf.keras.layers.Input(shape=([2, 3]))

Max18997 = keras.layers.Maximum(name = 'Max18997', )([in0Max18997,in1Max18997])
Res31377 = keras.layers.Reshape((1, 2, 2, 1), name = 'Res31377', )(Max18997)
Glo2977 = keras.layers.GlobalAveragePooling3D(name = 'Glo2977', )(Res31377)
Res18215 = keras.layers.Reshape((1, 1), name = 'Res18215', )(Glo2977)
Res58312 = keras.layers.Reshape((1, 1, 1), name = 'Res58312', )(Res18215)
Res71896 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res71896', )(Res58312)
Zer43592 = keras.layers.ZeroPadding3D(padding=((3, 0), (3, 0), (2, 0)), name = 'Zer43592', )(Res71896)
Con55237 = keras.layers.Conv3D(2, (1, 1, 2),strides=(1, 6, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con55237', )(in0Con55237)
Res48425 = keras.layers.Reshape((2, 1, 2), name = 'Res48425', )(Con55237)
Res8044 = keras.layers.Reshape((2, 2), name = 'Res8044', )(Res48425)
Dot33254 = keras.layers.Dot(axes=(2, 2), name = 'Dot33254', )([in0Dot33254,in1Dot33254])
Max76125 = keras.layers.Maximum(name = 'Max76125', )([Res8044,Dot33254])
Res4718 = keras.layers.Reshape((2, 2, 1), name = 'Res4718', )(Max76125)
Res79665 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res79665', )(Res4718)
Zer65475 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer65475', )(Res79665)
Min44001 = keras.layers.Minimum(name = 'Min44001', )([Zer43592,Zer65475])
Res66000 = keras.layers.Reshape((4, 4, 3), name = 'Res66000', )(Min44001)
Max30639 = keras.layers.MaxPool2D(pool_size=(2, 1), strides=(4, 1), padding='valid', name = 'Max30639', )(Res66000)
model = tf.keras.models.Model(inputs=[in0Max18997,in1Max18997,in0Con55237,in0Dot33254,in1Dot33254], outputs=Max30639)
w = model.get_layer('Con55237').get_weights() 
w[0] = np.array([[[[[0.4359, 0.5813], [0.8308, 0.3618]], [[0.2719, 0.9418], [0.9327, 0.5281]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con55237').set_weights(w) 
in0Max18997 = tf.constant([[[[0.2458, 0.4353], [0.5302, 0.5897]]]])
in1Max18997 = tf.constant([[[[0.7593, 0.5126], [0.637, 0.5459]]]])
in0Con55237 = tf.constant([[[[[0.196, 0.4251], [0.8775, 0.3514]], [[0.3268, 0.8694], [0.9806, 0.0376]]], [[[0.8447, 0.7719], [0.4916, 0.7716]], [[0.0978, 0.8886], [0.3314, 0.2754]]]]])
in0Dot33254 = tf.constant([[[0.5851, 0.8581, 0.6369], [0.1266, 0.4519, 0.5317]]])
in1Dot33254 = tf.constant([[[0.8826, 0.8422, 0.2835], [0.1589, 0.0413, 0.2274]]])
print (np.array2string(model.predict([in0Max18997,in1Max18997,in0Con55237,in0Dot33254,in1Dot33254],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max30639.png')

LMax18997 = maximum_layer([[[[[0.2458, 0.4353], [0.5302, 0.5897]]]], [[[[0.7593, 0.5126], [0.637, 0.5459]]]]], Max18997), 
LRes31377 = reshape_layer(Max18997, [1, 2, 2, 1], Res31377), 
LGlo2977 = global_average_pooling3D_layer(Res31377, Glo2977), 
LRes18215 = reshape_layer(Glo2977, [1, 1], Res18215), 
LRes58312 = reshape_layer(Res18215, [1, 1, 1], Res58312), 
LRes71896 = reshape_layer(Res58312, [1, 1, 1, 1], Res71896), 
LZer43592 = zero_padding3D_layer(Res71896, 3, 0, 3, 0, 2, 0, Zer43592), 
LCon55237 = conv3D_layer([[[[[0.196, 0.4251], [0.8775, 0.3514]], [[0.3268, 0.8694], [0.9806, 0.0376]]], [[[0.8447, 0.7719], [0.4916, 0.7716]], [[0.0978, 0.8886], [0.3314, 0.2754]]]]], 1, 1, 2,[[[[[0.4359, 0.5813], [0.8308, 0.3618]], [[0.2719, 0.9418], [0.9327, 0.5281]]]]],[0, 0], 1, 6, 1, false, 1, 1, 1, Con55237), 
LRes48425 = reshape_layer(Con55237, [2, 1, 2], Res48425), 
LRes8044 = reshape_layer(Res48425, [2, 2], Res8044), 
LDot33254 = dot_layer([[[0.5851, 0.8581, 0.6369], [0.1266, 0.4519, 0.5317]]], [[[0.8826, 0.8422, 0.2835], [0.1589, 0.0413, 0.2274]]], 2, 2, Dot33254), 
LMax76125 = maximum_layer([Res8044,Dot33254], Max76125), 
LRes4718 = reshape_layer(Max76125, [2, 2, 1], Res4718), 
LRes79665 = reshape_layer(Res4718, [2, 2, 1, 1], Res79665), 
LZer65475 = zero_padding3D_layer(Res79665, 1, 1, 1, 1, 1, 1, Zer65475), 
LMin44001 = minimum_layer([Zer43592,Zer65475], Min44001), 
LRes66000 = reshape_layer(Min44001, [4, 4, 3], Res66000), 
LMax30639 = max_pool2D_layer(Res66000, 2, 1, 4, 1, false, Max30639), 
exec_layers([LMax18997,LRes31377,LGlo2977,LRes18215,LRes58312,LRes71896,LZer43592,LCon55237,LRes48425,LRes8044,LDot33254,LMax76125,LRes4718,LRes79665,LZer65475,LMin44001,LRes66000,LMax30639],["Max18997","Res31377","Glo2977","Res18215","Res58312","Res71896","Zer43592","Con55237","Res48425","Res8044","Dot33254","Max76125","Res4718","Res79665","Zer65475","Min44001","Res66000","Max30639"],Max30639,"Max30639")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]]]]

Expected (Unparsed): [[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]]]

Actual:   [[[[0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]]]

Expected: [[[[0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]]]