import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add18039 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Add18039 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con27352 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Add56893 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Add56893 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Max79054 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con66048 = tf.keras.layers.Input(shape=([2, 2, 1]))

Add18039 = keras.layers.Add(name = 'Add18039', )([in0Add18039,in1Add18039])
Res12304 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res12304', )(Add18039)
Con78215 = keras.layers.Conv3DTranspose(3, (1, 1, 1),strides=(1, 1, 1), padding='same', name = 'Con78215', )(Res12304)
Res59063 = keras.layers.Reshape((1, 1, 3), name = 'Res59063', )(Con78215)
Zer20974 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer20974', )(Res59063)
Con27352 = keras.layers.Conv3DTranspose(2, (1, 1, 1),strides=(1, 1, 1), padding='same', name = 'Con27352', )(in0Con27352)
Zer20905 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (0, 0)), name = 'Zer20905', )(Con27352)
Add56893 = keras.layers.Add(name = 'Add56893', )([in0Add56893,in1Add56893])
Mul58237 = keras.layers.Multiply(name = 'Mul58237', )([Zer20905,Add56893])
Res26385 = keras.layers.Reshape((2, 2, 2), name = 'Res26385', )(Mul58237)
Max79054 = keras.layers.MaxPool2D(pool_size=(2, 1), strides=(1, 1), padding='valid', name = 'Max79054', )(in0Max79054)
Zer16017 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer16017', )(Max79054)
Mul20664 = keras.layers.Multiply(name = 'Mul20664', )([Res26385,Zer16017])
Con66048 = keras.layers.Concatenate(axis=3, name = 'Con66048', )([Mul20664,in0Con66048])
Max19918 = keras.layers.Maximum(name = 'Max19918', )([Zer20974,Con66048])
model = tf.keras.models.Model(inputs=[in0Add18039,in1Add18039,in0Con27352,in0Add56893,in1Add56893,in0Max79054,in0Con66048], outputs=Max19918)
w = model.get_layer('Con78215').get_weights() 
w[0] = np.array([[[[[0.8551], [0.5982], [0.7715]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con78215').set_weights(w) 
w = model.get_layer('Con27352').get_weights() 
w[0] = np.array([[[[[0.3189], [0.4551]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con27352').set_weights(w) 
in0Add18039 = tf.constant([[[[0.1991]]]])
in1Add18039 = tf.constant([[[[0.3135]]]])
in0Con27352 = tf.constant([[[[[0.1149]]], [[[0.786]]]]])
in0Add56893 = tf.constant([[[[[0.8733, 0.8659]], [[0.4061, 0.2565]]], [[[0.4469, 0.6864]], [[0.4539, 0.0243]]]]])
in1Add56893 = tf.constant([[[[[0.7267, 0.8359]], [[0.0503, 0.6438]]], [[[0.759, 0.6174]], [[0.1983, 0.0489]]]]])
in0Max79054 = tf.constant([[[[1.2079, 1.0777]], [[1.8154, 1.4324]]]])
in0Con66048 = tf.constant([[[[0.172], [0.3514]], [[0.8617], [0.3341]]]])
print (np.array2string(model.predict([in0Add18039,in1Add18039,in0Con27352,in0Add56893,in1Add56893,in0Max79054,in0Con66048],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max19918.png')

LAdd18039 = add_layer([[[[[0.1991]]]], [[[[0.3135]]]]], Add18039), 
LRes12304 = reshape_layer(Add18039, [1, 1, 1, 1], Res12304), 
LCon78215 = conv3D_transpose_layer(Res12304, 1, 1, 1,[[[[[0.8551], [0.5982], [0.7715]]]]],[0, 0, 0], 1, 1, 1, true, Con78215), 
LRes59063 = reshape_layer(Con78215, [1, 1, 3], Res59063), 
LZer20974 = zero_padding2D_layer(Res59063, 1, 0, 1, 0, Zer20974), 
LCon27352 = conv3D_transpose_layer([[[[[0.1149]]], [[[0.786]]]]], 1, 1, 1,[[[[[0.3189], [0.4551]]]]],[0, 0], 1, 1, 1, true, Con27352), 
LZer20905 = zero_padding3D_layer(Con27352, 0, 0, 1, 0, 0, 0, Zer20905), 
LAdd56893 = add_layer([[[[[[0.8733, 0.8659]], [[0.4061, 0.2565]]], [[[0.4469, 0.6864]], [[0.4539, 0.0243]]]]], [[[[[0.7267, 0.8359]], [[0.0503, 0.6438]]], [[[0.759, 0.6174]], [[0.1983, 0.0489]]]]]], Add56893), 
LMul58237 = multiply_layer([Zer20905,Add56893], Mul58237), 
LRes26385 = reshape_layer(Mul58237, [2, 2, 2], Res26385), 
LMax79054 = max_pool2D_layer([[[[1.2079, 1.0777]], [[1.8154, 1.4324]]]], 2, 1, 1, 1, false, Max79054), 
LZer16017 = zero_padding2D_layer(Max79054, 1, 0, 1, 0, Zer16017), 
LMul20664 = multiply_layer([Res26385,Zer16017], Mul20664), 
LCon66048 = concatenate_layer([Mul20664,[[[[0.172], [0.3514]], [[0.8617], [0.3341]]]]], 3, Con66048), 
LMax19918 = maximum_layer([Zer20974,Con66048], Max19918), 
exec_layers([LAdd18039,LRes12304,LCon78215,LRes59063,LZer20974,LCon27352,LZer20905,LAdd56893,LMul58237,LRes26385,LMax79054,LZer16017,LMul20664,LCon66048,LMax19918],["Add18039","Res12304","Con78215","Res59063","Zer20974","Con27352","Zer20905","Add56893","Mul58237","Res26385","Max79054","Zer16017","Mul20664","Con66048","Max19918"],Max19918,"Max19918")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.1720000], [0.0000000, 0.0000000, 0.3514000]], [[0.0000000, 0.0000000, 0.8617000], [0.4383243, 0.3066373, 0.3954709]]]]

Expected (Unparsed): [[[[0,0,0.172],[0,0,0.3514]],[[0,0,0.8617],[0.43832425999999997,0.30663731999999994,0.39547089999999996]]]]

Actual:   [[[[0, 0, 0.172], [0, 0, 0.3514]], [[0, 0, 0.8617], [0.4384, 0.3067, 0.3955]]]]

Expected: [[[[0, 0, 0.172], [0, 0, 0.3514]], [[0, 0, 0.8617], [0.4384, 0.3067, 0.3955]]]]