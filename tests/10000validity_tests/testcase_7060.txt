import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max53914 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Max53914 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Den47925 = tf.keras.layers.Input(shape=([4, 4, 5]))
in0Con71724 = tf.keras.layers.Input(shape=([23]))

Max53914 = keras.layers.Maximum(name = 'Max53914', )([in0Max53914,in1Max53914])
Con33809 = keras.layers.Conv3DTranspose(2, (1, 2, 1),strides=(1, 2, 3), padding='same', name = 'Con33809', )(Max53914)
Res89872 = keras.layers.Reshape((1, 4, 6), name = 'Res89872', )(Con33809)
Res93973 = keras.layers.Reshape((1, 24), name = 'Res93973', )(Res89872)
Fla59202 = keras.layers.Flatten(name = 'Fla59202', )(Res93973)
Den47925 = keras.layers.Dense(2,name = 'Den47925', )(in0Den47925)
Glo31874 = keras.layers.GlobalMaxPool2D(name = 'Glo31874', )(Den47925)
Res17409 = keras.layers.Reshape((2, 1), name = 'Res17409', )(Glo31874)
Cro74759 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro74759', )(Res17409)
Res96773 = keras.layers.Reshape((2, 1, 1), name = 'Res96773', )(Cro74759)
Glo88452 = keras.layers.GlobalMaxPool2D(name = 'Glo88452', )(Res96773)
Con71724 = keras.layers.Concatenate(axis=1, name = 'Con71724', )([Glo88452,in0Con71724])
Mul91009 = keras.layers.Multiply(name = 'Mul91009', )([Fla59202,Con71724])
model = tf.keras.models.Model(inputs=[in0Max53914,in1Max53914,in0Den47925,in0Con71724], outputs=Mul91009)
w = model.get_layer('Con33809').get_weights() 
w[0] = np.array([[[[[0.316, 0.6497], [0.5503, 0.1284]]], [[[0.5968, 0.8648], [0.2074, 0.4677]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con33809').set_weights(w) 
w = model.get_layer('Den47925').get_weights() 
w[0] = np.array([[0.1417, 0.3764], [0.6611, 0.1514], [0.6826, 0.846], [0.6186, 0.7314], [0.0624, 0.6125]])
w[1] = np.array([0.3001, 0.2278])
model.get_layer('Den47925').set_weights(w) 
in0Max53914 = tf.constant([[[[[0.1884, 0.7627]], [[0.6921, 0.8988]]]]])
in1Max53914 = tf.constant([[[[[0.1212, 0.7091]], [[0.2742, 0.232]]]]])
in0Den47925 = tf.constant([[[[0.3783, 0.6166, 0.5434, 0.317, 0.9552], [0.9354, 0.7797, 0.9499, 0.4789, 0.7448], [0.4752, 0.6893, 0.9004, 0.49, 0.4993], [0.1552, 0.7209, 0.9412, 0.1251, 0.8624]], [[0.5828, 0.3121, 0.3856, 0.0932, 0.4684], [0.5566, 0.0381, 0.4103, 0.1995, 0.2193], [0.7486, 0.2843, 0.4039, 0.8617, 0.9793], [0.9705, 0.6283, 0.0041, 0.4581, 0.2048]], [[0.8132, 0.7306, 0.0435, 0.5115, 0.9198], [0.5883, 0.257, 0.9146, 0.0984, 0.1795], [0.7508, 0.6273, 0.4255, 0.8925, 0.5003], [0.8569, 0.8971, 0.5462, 0.5704, 0.2095]], [[0.0665, 0.3342, 0.8866, 0.3011, 0.4386], [0.3457, 0.5648, 0.0923, 0.4957, 0.1123], [0.9997, 0.1515, 0.0142, 0.0865, 0.0943], [0.5186, 0.159, 0.689, 0.7246, 0.0962]]]])
in0Con71724 = tf.constant([[0.6657, 0.5359, 0.4724, 0.0408, 0.0406, 0.4306, 0.7161, 0.3463, 0.2581, 0.6985, 0.0852, 0.3604, 0.4349, 0.4287, 0.1344, 0.2241, 0.7239, 0.8942, 0.7849, 0.068, 0.1779, 0.2345, 0.6058]])
print (np.array2string(model.predict([in0Max53914,in1Max53914,in0Den47925,in0Con71724],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul91009.png')

LMax53914 = maximum_layer([[[[[[0.1884, 0.7627]], [[0.6921, 0.8988]]]]], [[[[[0.1212, 0.7091]], [[0.2742, 0.232]]]]]], Max53914), 
LCon33809 = conv3D_transpose_layer(Max53914, 1, 2, 1,[[[[[0.316, 0.6497], [0.5503, 0.1284]]], [[[0.5968, 0.8648], [0.2074, 0.4677]]]]],[0, 0], 1, 2, 3, true, Con33809), 
LRes89872 = reshape_layer(Con33809, [1, 4, 6], Res89872), 
LRes93973 = reshape_layer(Res89872, [1, 24], Res93973), 
LFla59202 = flatten_layer(Res93973, Fla59202), 
LDen47925 = dense_layer([[[[0.3783, 0.6166, 0.5434, 0.317, 0.9552], [0.9354, 0.7797, 0.9499, 0.4789, 0.7448], [0.4752, 0.6893, 0.9004, 0.49, 0.4993], [0.1552, 0.7209, 0.9412, 0.1251, 0.8624]], [[0.5828, 0.3121, 0.3856, 0.0932, 0.4684], [0.5566, 0.0381, 0.4103, 0.1995, 0.2193], [0.7486, 0.2843, 0.4039, 0.8617, 0.9793], [0.9705, 0.6283, 0.0041, 0.4581, 0.2048]], [[0.8132, 0.7306, 0.0435, 0.5115, 0.9198], [0.5883, 0.257, 0.9146, 0.0984, 0.1795], [0.7508, 0.6273, 0.4255, 0.8925, 0.5003], [0.8569, 0.8971, 0.5462, 0.5704, 0.2095]], [[0.0665, 0.3342, 0.8866, 0.3011, 0.4386], [0.3457, 0.5648, 0.0923, 0.4957, 0.1123], [0.9997, 0.1515, 0.0142, 0.0865, 0.0943], [0.5186, 0.159, 0.689, 0.7246, 0.0962]]]], [[0.1417, 0.3764], [0.6611, 0.1514], [0.6826, 0.846], [0.6186, 0.7314], [0.0624, 0.6125]],[0.3001, 0.2278], Den47925), 
LGlo31874 = global_max_pool2D_layer(Den47925, Glo31874), 
LRes17409 = reshape_layer(Glo31874, [2, 1], Res17409), 
LCro74759 = cropping1D_layer(Res17409, 0, 0, Cro74759), 
LRes96773 = reshape_layer(Cro74759, [2, 1, 1], Res96773), 
LGlo88452 = global_max_pool2D_layer(Res96773, Glo88452), 
LCon71724 = concatenate_layer([Glo88452,[[0.6657, 0.5359, 0.4724, 0.0408, 0.0406, 0.4306, 0.7161, 0.3463, 0.2581, 0.6985, 0.0852, 0.3604, 0.4349, 0.4287, 0.1344, 0.2241, 0.7239, 0.8942, 0.7849, 0.068, 0.1779, 0.2345, 0.6058]]], 1, Con71724), 
LMul91009 = multiply_layer([Fla59202,Con71724], Mul91009), 
exec_layers([LMax53914,LCon33809,LRes89872,LRes93973,LFla59202,LDen47925,LGlo31874,LRes17409,LCro74759,LRes96773,LGlo88452,LCon71724,LMul91009],["Max53914","Con33809","Res89872","Res93973","Fla59202","Den47925","Glo31874","Res17409","Cro74759","Res96773","Glo88452","Con71724","Mul91009"],Mul91009,"Mul91009")

Actual (Unparsed): [[1.2810821, 0.1342099, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.3324318, 0.2834245, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.2892765, 0.2158272, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 1.0643909, 0.4426132, 0.0000000, 0.0000000, 0.0000000, 0.0000000]]

Expected (Unparsed): [[1.2810820619623602,0.13420991304,0.0,0.0,0.0,0.0,0.33243184644800006,0.283424467095,0.0,0.0,0.0,0.0,0.28927648718400006,0.215827192395,0.0,0.0,0.0,0.0,1.064390868384,0.4426131944700001,0.0,0.0,0.0,0.0]]

Actual:   [[1.2811, 0.1343, 0, 0, 0, 0, 0.3325, 0.2835, 0, 0, 0, 0, 0.2893, 0.2159, 0, 0, 0, 0, 1.0644, 0.4427, 0, 0, 0, 0]]

Expected: [[1.2811, 0.1343, 0, 0, 0, 0, 0.3325, 0.2835, 0, 0, 0, 0, 0.2893, 0.2159, 0, 0, 0, 0, 1.0644, 0.4427, 0, 0, 0, 0]]