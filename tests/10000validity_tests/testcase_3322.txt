import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add31146 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Add31146 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Sub51670 = tf.keras.layers.Input(shape=([2]))
in1Sub51670 = tf.keras.layers.Input(shape=([2]))
in0Con91180 = tf.keras.layers.Input(shape=([6]))
in0Con24073 = tf.keras.layers.Input(shape=([8, 1]))
in0Mul1443 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Mul1443 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))

Add31146 = keras.layers.Add(name = 'Add31146', )([in0Add31146,in1Add31146])
Res10427 = keras.layers.Reshape((2, 2, 2), name = 'Res10427', )(Add31146)
Res23644 = keras.layers.Reshape((2, 4), name = 'Res23644', )(Res10427)
Fla5593 = keras.layers.Flatten(name = 'Fla5593', )(Res23644)
Sub51670 = keras.layers.Subtract(name = 'Sub51670', )([in0Sub51670,in1Sub51670])
Con91180 = keras.layers.Concatenate(axis=1, name = 'Con91180', )([Sub51670,in0Con91180])
Max8111 = keras.layers.Maximum(name = 'Max8111', )([Fla5593,Con91180])
Res96223 = keras.layers.Reshape((8, 1), name = 'Res96223', )(Max8111)
Con24073 = keras.layers.Concatenate(axis=2, name = 'Con24073', )([Res96223,in0Con24073])
Mul1443 = keras.layers.Multiply(name = 'Mul1443', )([in0Mul1443,in1Mul1443])
Res72632 = keras.layers.Reshape((1, 1, 2), name = 'Res72632', )(Mul1443)
Res8084 = keras.layers.Reshape((1, 2), name = 'Res8084', )(Res72632)
Dot53716 = keras.layers.Dot(axes=(2, 2), name = 'Dot53716', )([Con24073,Res8084])
Sim13065 = keras.layers.SimpleRNN(3,name = 'Sim13065', )(Dot53716)
model = tf.keras.models.Model(inputs=[in0Add31146,in1Add31146,in0Sub51670,in1Sub51670,in0Con91180,in0Con24073,in0Mul1443,in1Mul1443], outputs=Sim13065)
w = model.get_layer('Sim13065').get_weights() 
w[0] = np.array([[2, 9, 4]])
w[1] = np.array([[6, 3, 4], [6, 8, 7], [10, 2, 5]])
w[2] = np.array([1, 9, 9])
model.get_layer('Sim13065').set_weights(w) 
in0Add31146 = tf.constant([[[[[0.488], [0.0075]], [[0.396], [0.8801]]], [[[0.1832], [0.5738]], [[0.5712], [0.9998]]]]])
in1Add31146 = tf.constant([[[[[0.8633], [0.5478]], [[0.3624], [0.4089]]], [[[0.7053], [0.8799]], [[0.1485], [0.0642]]]]])
in0Sub51670 = tf.constant([[0.9772, 0.237]])
in1Sub51670 = tf.constant([[0.7616, 0.1831]])
in0Con91180 = tf.constant([[0.1883, 0.5251, 0.0742, 0.3055, 0.6435, 0.6341]])
in0Con24073 = tf.constant([[[0.9345], [0.4163], [0.2764], [0.5195], [0.9521], [0.683], [0.4689], [0.3939]]])
in0Mul1443 = tf.constant([[[[[0.0138], [0.0954]]]]])
in1Mul1443 = tf.constant([[[[[0.4939], [0.0548]]]]])
print (np.array2string(model.predict([in0Add31146,in1Add31146,in0Sub51670,in1Sub51670,in0Con91180,in0Con24073,in0Mul1443,in1Mul1443],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sim13065.png')

LAdd31146 = add_layer([[[[[[0.488], [0.0075]], [[0.396], [0.8801]]], [[[0.1832], [0.5738]], [[0.5712], [0.9998]]]]], [[[[[0.8633], [0.5478]], [[0.3624], [0.4089]]], [[[0.7053], [0.8799]], [[0.1485], [0.0642]]]]]], Add31146), 
LRes10427 = reshape_layer(Add31146, [2, 2, 2], Res10427), 
LRes23644 = reshape_layer(Res10427, [2, 4], Res23644), 
LFla5593 = flatten_layer(Res23644, Fla5593), 
LSub51670 = subtract_layer([[0.9772, 0.237]], [[0.7616, 0.1831]], Sub51670), 
LCon91180 = concatenate_layer([Sub51670,[[0.1883, 0.5251, 0.0742, 0.3055, 0.6435, 0.6341]]], 1, Con91180), 
LMax8111 = maximum_layer([Fla5593,Con91180], Max8111), 
LRes96223 = reshape_layer(Max8111, [8, 1], Res96223), 
LCon24073 = concatenate_layer([Res96223,[[[0.9345], [0.4163], [0.2764], [0.5195], [0.9521], [0.683], [0.4689], [0.3939]]]], 2, Con24073), 
LMul1443 = multiply_layer([[[[[[0.0138], [0.0954]]]]], [[[[[0.4939], [0.0548]]]]]], Mul1443), 
LRes72632 = reshape_layer(Mul1443, [1, 1, 2], Res72632), 
LRes8084 = reshape_layer(Res72632, [1, 2], Res8084), 
LDot53716 = dot_layer(Con24073,Res8084, 2, 2, Dot53716), 
LSim13065 = simple_rnn_layer(Dot53716,[[2, 9, 4]],[[6, 3, 4], [6, 8, 7], [10, 2, 5]],[1, 9, 9], Sim13065), 
exec_layers([LAdd31146,LRes10427,LRes23644,LFla5593,LSub51670,LCon91180,LMax8111,LRes96223,LCon24073,LMul1443,LRes72632,LRes8084,LDot53716,LSim13065],["Add31146","Res10427","Res23644","Fla5593","Sub51670","Con91180","Max8111","Res96223","Con24073","Mul1443","Res72632","Res8084","Dot53716","Sim13065"],Sim13065,"Sim13065")

Actual (Unparsed): [[1.0000000, 1.0000000, 1.0000000]]

Expected (Unparsed): [[1.0,1.0,1.0]]

Actual:   [[1, 1, 1]]

Expected: [[1, 1, 1]]