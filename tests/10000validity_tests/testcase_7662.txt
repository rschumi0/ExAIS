import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot72364 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot72364 = tf.keras.layers.Input(shape=([3, 3]))

Dot72364 = keras.layers.Dot(axes=(2, 1), name = 'Dot72364', )([in0Dot72364,in1Dot72364])
Res87136 = keras.layers.Reshape((3, 3, 1), name = 'Res87136', )(Dot72364)
Res79347 = keras.layers.Reshape((3, 3, 1, 1), name = 'Res79347', )(Res87136)
Glo55630 = keras.layers.GlobalAveragePooling3D(name = 'Glo55630', )(Res79347)
Res53799 = keras.layers.Reshape((1, 1), name = 'Res53799', )(Glo55630)
Res14363 = keras.layers.Reshape((1, 1, 1), name = 'Res14363', )(Res53799)
Res87775 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res87775', )(Res14363)
Up_10506 = keras.layers.UpSampling3D(size=(2, 2, 1), name = 'Up_10506', )(Res87775)
Res25808 = keras.layers.Reshape((2, 2, 1), name = 'Res25808', )(Up_10506)
Glo61876 = keras.layers.GlobalMaxPool2D(name = 'Glo61876', )(Res25808)
Res75279 = keras.layers.Reshape((1, 1), name = 'Res75279', )(Glo61876)
GRU83827 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU83827', )(Res75279)
model = tf.keras.models.Model(inputs=[in0Dot72364,in1Dot72364], outputs=GRU83827)
w = model.get_layer('GRU83827').get_weights() 
w[0] = np.array([[5, 10, 7]])
w[1] = np.array([[10, 1, 8]])
w[2] = np.array([8, 10, 9])
model.get_layer('GRU83827').set_weights(w) 
in0Dot72364 = tf.constant([[[0.2424, 0.2879, 0.6496], [0.0791, 0.5492, 0.4101], [0.3887, 0.3867, 0.9107]]])
in1Dot72364 = tf.constant([[[0.1664, 0.3761, 0.9528], [0.6483, 0.8573, 0.511], [0.715, 0.9173, 0.5873]]])
print (np.array2string(model.predict([in0Dot72364,in1Dot72364],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU83827.png')

LDot72364 = dot_layer([[[0.2424, 0.2879, 0.6496], [0.0791, 0.5492, 0.4101], [0.3887, 0.3867, 0.9107]]], [[[0.1664, 0.3761, 0.9528], [0.6483, 0.8573, 0.511], [0.715, 0.9173, 0.5873]]], 2, 1, Dot72364), 
LRes87136 = reshape_layer(Dot72364, [3, 3, 1], Res87136), 
LRes79347 = reshape_layer(Res87136, [3, 3, 1, 1], Res79347), 
LGlo55630 = global_average_pooling3D_layer(Res79347, Glo55630), 
LRes53799 = reshape_layer(Glo55630, [1, 1], Res53799), 
LRes14363 = reshape_layer(Res53799, [1, 1, 1], Res14363), 
LRes87775 = reshape_layer(Res14363, [1, 1, 1, 1], Res87775), 
LUp_10506 = up_sampling3D_layer(Res87775, 2, 2, 1, Up_10506), 
LRes25808 = reshape_layer(Up_10506, [2, 2, 1], Res25808), 
LGlo61876 = global_max_pool2D_layer(Res25808, Glo61876), 
LRes75279 = reshape_layer(Glo61876, [1, 1], Res75279), 
LGRU83827 = gru_layer(Res75279,[[5, 10, 7]],[[10, 1, 8]],[8, 10, 9], false, GRU83827), 
exec_layers([LDot72364,LRes87136,LRes79347,LGlo55630,LRes53799,LRes14363,LRes87775,LUp_10506,LRes25808,LGlo61876,LRes75279,LGRU83827],["Dot72364","Res87136","Res79347","Glo55630","Res53799","Res14363","Res87775","Up_10506","Res25808","Glo61876","Res75279","GRU83827"],GRU83827,"GRU83827")

Actual (Unparsed): [[0.0000042]]

Expected (Unparsed): [[4.156782810737478e-6]]

Actual:   [[0]]

Expected: [[0]]