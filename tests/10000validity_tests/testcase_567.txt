import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max83330 = tf.keras.layers.Input(shape=([1, 2]))
in1Max83330 = tf.keras.layers.Input(shape=([1, 2]))
in0Cro22166 = tf.keras.layers.Input(shape=([1, 1]))
in0Ave3431 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Ave3431 = tf.keras.layers.Input(shape=([1, 1, 1]))

Max83330 = keras.layers.Maximum(name = 'Max83330', )([in0Max83330,in1Max83330])
Res51776 = keras.layers.Reshape((1, 2, 1), name = 'Res51776', )(Max83330)
Cro22166 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro22166', )(in0Cro22166)
Res50917 = keras.layers.Reshape((1, 1, 1), name = 'Res50917', )(Cro22166)
Ave3431 = keras.layers.Average(name = 'Ave3431', )([in0Ave3431,in1Ave3431])
Bat33625 = keras.layers.BatchNormalization(axis=2, epsilon=0.8787377786862727,  name = 'Bat33625', )(Ave3431)
Mul76460 = keras.layers.Multiply(name = 'Mul76460', )([Res50917,Bat33625])
Zer66721 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer66721', )(Mul76460)
Sub92023 = keras.layers.Subtract(name = 'Sub92023', )([Res51776,Zer66721])
model = tf.keras.models.Model(inputs=[in0Max83330,in1Max83330,in0Cro22166,in0Ave3431,in1Ave3431], outputs=Sub92023)
w = model.get_layer('Bat33625').get_weights() 
w[0] = np.array([0.111])
w[1] = np.array([0.0618])
w[2] = np.array([0.8922])
w[3] = np.array([0.0554])
model.get_layer('Bat33625').set_weights(w) 
in0Max83330 = tf.constant([[[0.35, 0.3095]]])
in1Max83330 = tf.constant([[[0.874, 0.546]]])
in0Cro22166 = tf.constant([[[1.0702]]])
in0Ave3431 = tf.constant([[[[0.6927]]]])
in1Ave3431 = tf.constant([[[[0.8357]]]])
print (np.array2string(model.predict([in0Max83330,in1Max83330,in0Cro22166,in0Ave3431,in1Ave3431],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub92023.png')

LMax83330 = maximum_layer([[[[0.35, 0.3095]]], [[[0.874, 0.546]]]], Max83330), 
LRes51776 = reshape_layer(Max83330, [1, 2, 1], Res51776), 
LCro22166 = cropping1D_layer([[[1.0702]]], 0, 0, Cro22166), 
LRes50917 = reshape_layer(Cro22166, [1, 1, 1], Res50917), 
LAve3431 = average_layer([[[[[0.6927]]]], [[[[0.8357]]]]], Ave3431), 
LBat33625 = batch_normalization_layer(Ave3431, 2, 0.8787377786862727, [0.111], [0.0618], [0.8922], [0.0554], Bat33625), 
LMul76460 = multiply_layer([Res50917,Bat33625], Mul76460), 
LZer66721 = zero_padding2D_layer(Mul76460, 0, 0, 1, 0, Zer66721), 
LSub92023 = subtract_layer(Res51776,Zer66721, Sub92023), 
exec_layers([LMax83330,LRes51776,LCro22166,LRes50917,LAve3431,LBat33625,LMul76460,LZer66721,LSub92023],["Max83330","Res51776","Cro22166","Res50917","Ave3431","Bat33625","Mul76460","Zer66721","Sub92023"],Sub92023,"Sub92023")

Actual (Unparsed): [[[[0.8740000], [0.4955940]]]]

Expected (Unparsed): [[[[0.874],[0.4955939475174302]]]]

Actual:   [[[[0.874], [0.4956]]]]

Expected: [[[[0.874], [0.4956]]]]