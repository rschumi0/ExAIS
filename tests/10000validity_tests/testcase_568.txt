import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo96257 = tf.keras.layers.Input(shape=([1, 1]))
in0Dot73619 = tf.keras.layers.Input(shape=([2]))
in1Dot73619 = tf.keras.layers.Input(shape=([2]))
in0Con71712 = tf.keras.layers.Input(shape=([3, 8]))

Glo96257 = keras.layers.GlobalAveragePooling1D(name = 'Glo96257', )(in0Glo96257)
Res32225 = keras.layers.Reshape((1, 1), name = 'Res32225', )(Glo96257)
Res79266 = keras.layers.Reshape((1, 1, 1), name = 'Res79266', )(Res32225)
Res99578 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res99578', )(Res79266)
Zer47622 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer47622', )(Res99578)
Res85431 = keras.layers.Reshape((3, 3, 3), name = 'Res85431', )(Zer47622)
Res308 = keras.layers.Reshape((3, 9), name = 'Res308', )(Res85431)
Dot73619 = keras.layers.Dot(axes=(1, 1), name = 'Dot73619', )([in0Dot73619,in1Dot73619])
Res20519 = keras.layers.Reshape((1, 1), name = 'Res20519', )(Dot73619)
Res65821 = keras.layers.Reshape((1, 1, 1), name = 'Res65821', )(Res20519)
Glo87374 = keras.layers.GlobalMaxPool2D(name = 'Glo87374', )(Res65821)
Res86909 = keras.layers.Reshape((1, 1), name = 'Res86909', )(Glo87374)
Res6595 = keras.layers.Reshape((1, 1, 1), name = 'Res6595', )(Res86909)
Max38709 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 1), padding='valid', name = 'Max38709', )(Res6595)
Res24450 = keras.layers.Reshape((1, 1), name = 'Res24450', )(Max38709)
PRe24858 = keras.layers.PReLU(name = 'PRe24858', )(Res24450)
Zer78085 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer78085', )(PRe24858)
Con71712 = keras.layers.Concatenate(axis=2, name = 'Con71712', )([Zer78085,in0Con71712])
Sub84456 = keras.layers.Subtract(name = 'Sub84456', )([Res308,Con71712])
Per83544 = keras.layers.Permute((1,2), name = 'Per83544',)(Sub84456)
model = tf.keras.models.Model(inputs=[in0Glo96257,in0Dot73619,in1Dot73619,in0Con71712], outputs=Per83544)
w = model.get_layer('PRe24858').get_weights() 
w[0] = np.array([[0.9665]])
model.get_layer('PRe24858').set_weights(w) 
in0Glo96257 = tf.constant([[[1.7982]]])
in0Dot73619 = tf.constant([[0.2963, 0.6347]])
in1Dot73619 = tf.constant([[0.4908, 0.7311]])
in0Con71712 = tf.constant([[[0.4907, 0.5266, 0.5885, 0.8233, 0.2329, 0.2235, 0.6702, 0.7369], [0.6962, 0.0492, 0.9665, 0.0629, 0.325, 0.6746, 0.8425, 0.5862], [0.8727, 0.8196, 0.7997, 0.907, 0.169, 0.3779, 0.6091, 0.884]]])
print (np.array2string(model.predict([in0Glo96257,in0Dot73619,in1Dot73619,in0Con71712],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Per83544.png')

LGlo96257 = global_average_pooling1D_layer([[[1.7982]]], Glo96257), 
LRes32225 = reshape_layer(Glo96257, [1, 1], Res32225), 
LRes79266 = reshape_layer(Res32225, [1, 1, 1], Res79266), 
LRes99578 = reshape_layer(Res79266, [1, 1, 1, 1], Res99578), 
LZer47622 = zero_padding3D_layer(Res99578, 1, 1, 1, 1, 1, 1, Zer47622), 
LRes85431 = reshape_layer(Zer47622, [3, 3, 3], Res85431), 
LRes308 = reshape_layer(Res85431, [3, 9], Res308), 
LDot73619 = dot_layer([[0.2963, 0.6347]], [[0.4908, 0.7311]], 1, 1, Dot73619), 
LRes20519 = reshape_layer(Dot73619, [1, 1], Res20519), 
LRes65821 = reshape_layer(Res20519, [1, 1, 1], Res65821), 
LGlo87374 = global_max_pool2D_layer(Res65821, Glo87374), 
LRes86909 = reshape_layer(Glo87374, [1, 1], Res86909), 
LRes6595 = reshape_layer(Res86909, [1, 1, 1], Res6595), 
LMax38709 = max_pool2D_layer(Res6595, 1, 1, 1, 1, false, Max38709), 
LRes24450 = reshape_layer(Max38709, [1, 1], Res24450), 
LPRe24858 = prelu_layer(Res24450, [[0.9665]], PRe24858), 
LZer78085 = zero_padding1D_layer(PRe24858, 2, 0, Zer78085), 
LCon71712 = concatenate_layer([Zer78085,[[[0.4907, 0.5266, 0.5885, 0.8233, 0.2329, 0.2235, 0.6702, 0.7369], [0.6962, 0.0492, 0.9665, 0.0629, 0.325, 0.6746, 0.8425, 0.5862], [0.8727, 0.8196, 0.7997, 0.907, 0.169, 0.3779, 0.6091, 0.884]]]], 2, Con71712), 
LSub84456 = subtract_layer(Res308,Con71712, Sub84456), 
LPer83544 = permute_layer(Sub84456, 1,2, Per83544), 
exec_layers([LGlo96257,LRes32225,LRes79266,LRes99578,LZer47622,LRes85431,LRes308,LDot73619,LRes20519,LRes65821,LGlo87374,LRes86909,LRes6595,LMax38709,LRes24450,LPRe24858,LZer78085,LCon71712,LSub84456,LPer83544],["Glo96257","Res32225","Res79266","Res99578","Zer47622","Res85431","Res308","Dot73619","Res20519","Res65821","Glo87374","Res86909","Res6595","Max38709","Res24450","PRe24858","Zer78085","Con71712","Sub84456","Per83544"],Per83544,"Per83544")

Actual (Unparsed): [[[0.0000000, -0.4907000, -0.5266000, -0.5885000, -0.8233000, -0.2329000, -0.2235000, -0.6702000, -0.7369000], [0.0000000, -0.6962000, -0.0492000, -0.9665000, 1.7353000, -0.3250000, -0.6746000, -0.8425000, -0.5862000], [-0.6094532, -0.8727000, -0.8196000, -0.7997000, -0.9070000, -0.1690000, -0.3779000, -0.6091000, -0.8840000]]]

Expected (Unparsed): [[[0,-0.4907,-0.5266,-0.5885,-0.8233,-0.2329,-0.2235,-0.6702,-0.7369],[0,-0.6962,-0.0492,-0.9665,1.7353,-0.325,-0.6746,-0.8425,-0.5862],[-0.60945321,-0.8727,-0.8196,-0.7997,-0.907,-0.169,-0.3779,-0.6091,-0.884]]]

Actual:   [[[0, -0.4907, -0.5266, -0.5885, -0.8233, -0.2329, -0.2235, -0.6702, -0.7369], [0, -0.6962, -0.0492, -0.9665, 1.7353, -0.325, -0.6746, -0.8425, -0.5862], [-0.6094, -0.8727, -0.8196, -0.7997, -0.907, -0.169, -0.3779, -0.6091, -0.884]]]

Expected: [[[0, -0.4907, -0.5266, -0.5885, -0.8233, -0.2329, -0.2235, -0.6702, -0.7369], [0, -0.6962, -0.0492, -0.9665, 1.7353, -0.325, -0.6746, -0.8425, -0.5862], [-0.6094, -0.8727, -0.8196, -0.7997, -0.907, -0.169, -0.3779, -0.6091, -0.884]]]