import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul58248 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Mul58248 = tf.keras.layers.Input(shape=([2, 2, 2]))

Mul58248 = keras.layers.Multiply(name = 'Mul58248', )([in0Mul58248,in1Mul58248])
Res83441 = keras.layers.Reshape((2, 4), name = 'Res83441', )(Mul58248)
Per28352 = keras.layers.Permute((2,1), name = 'Per28352',)(Res83441)
LST19114 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST19114', )(Per28352)
model = tf.keras.models.Model(inputs=[in0Mul58248,in1Mul58248], outputs=LST19114)
w = model.get_layer('LST19114').get_weights() 
w[0] = np.array([[9, 7, 2, 2, 3, 7, 6, 8, 2, 5, 9, 9], [7, 6, 9, 7, 8, 5, 2, 10, 4, 3, 6, 5]])
w[1] = np.array([[5, 1, 2, 5, 8, 3, 3, 9, 7, 10, 9, 6], [10, 4, 4, 4, 9, 2, 1, 1, 5, 1, 10, 9], [9, 9, 5, 7, 1, 4, 4, 4, 6, 8, 6, 10]])
w[2] = np.array([1, 10, 1, 7, 7, 7, 2, 10, 8, 7, 1, 8])
model.get_layer('LST19114').set_weights(w) 
in0Mul58248 = tf.constant([[[[1, 0.1549], [0.4606, 0.0261]], [[0.8194, 0.5083], [0.9199, 0.0289]]]])
in1Mul58248 = tf.constant([[[[0.9975, 0.5529], [0.1257, 0.0734]], [[0.1403, 0.6053], [0.5038, 0.9718]]]])
print (np.array2string(model.predict([in0Mul58248,in1Mul58248],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST19114.png')

LMul58248 = multiply_layer([[[[[1, 0.1549], [0.4606, 0.0261]], [[0.8194, 0.5083], [0.9199, 0.0289]]]], [[[[0.9975, 0.5529], [0.1257, 0.0734]], [[0.1403, 0.6053], [0.5038, 0.9718]]]]], Mul58248), 
LRes83441 = reshape_layer(Mul58248, [2, 4], Res83441), 
LPer28352 = permute_layer(Res83441, 2,1, Per28352), 
LLST19114 = lstm_layer(Per28352,[[9, 7, 2, 2, 3, 7, 6, 8, 2, 5, 9, 9], [7, 6, 9, 7, 8, 5, 2, 10, 4, 3, 6, 5]],[[5, 1, 2, 5, 8, 3, 3, 9, 7, 10, 9, 6], [10, 4, 4, 4, 9, 2, 1, 1, 5, 1, 10, 9], [9, 9, 5, 7, 1, 4, 4, 4, 6, 8, 6, 10]],[1, 10, 1, 7, 7, 7, 2, 10, 8, 7, 1, 8], LST19114), 
exec_layers([LMul58248,LRes83441,LPer28352,LLST19114],["Mul58248","Res83441","Per28352","LST19114"],LST19114,"LST19114")

Actual (Unparsed): [[0.9993293, 0.9993293, 0.9993054]]

Expected (Unparsed): [[0.9993292716573078,0.9993292997055997,0.9993054455966298]]

Actual:   [[0.9994, 0.9994, 0.9994]]

Expected: [[0.9994, 0.9994, 0.9994]]