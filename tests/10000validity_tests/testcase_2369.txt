import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sim2667 = tf.keras.layers.Input(shape=([1, 1]))
in0Max63727 = tf.keras.layers.Input(shape=([1, 1]))
in1Max63727 = tf.keras.layers.Input(shape=([1, 1]))
in0Max45988 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Max45988 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Add76252 = tf.keras.layers.Input(shape=([2, 2]))
in1Add76252 = tf.keras.layers.Input(shape=([2, 2]))

Sim2667 = keras.layers.SimpleRNN(1,name = 'Sim2667', )(in0Sim2667)
Res25479 = keras.layers.Reshape((1, 1), name = 'Res25479', )(Sim2667)
Max63727 = keras.layers.Maximum(name = 'Max63727', )([in0Max63727,in1Max63727])
Min80648 = keras.layers.Minimum(name = 'Min80648', )([Res25479,Max63727])
Zer72702 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer72702', )(Min80648)
Max45988 = keras.layers.Maximum(name = 'Max45988', )([in0Max45988,in1Max45988])
Res81313 = keras.layers.Reshape((1, 2, 1), name = 'Res81313', )(Max45988)
Res33665 = keras.layers.Reshape((1, 2), name = 'Res33665', )(Res81313)
Zer70200 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer70200', )(Res33665)
Add76252 = keras.layers.Add(name = 'Add76252', )([in0Add76252,in1Add76252])
Max5984 = keras.layers.Maximum(name = 'Max5984', )([Zer70200,Add76252])
Dot97170 = keras.layers.Dot(axes=(1, 1), name = 'Dot97170', )([Zer72702,Max5984])
Thr72183 = keras.layers.ThresholdedReLU(theta=0.34875845195150634, name = 'Thr72183', )(Dot97170)
model = tf.keras.models.Model(inputs=[in0Sim2667,in0Max63727,in1Max63727,in0Max45988,in1Max45988,in0Add76252,in1Add76252], outputs=Thr72183)
w = model.get_layer('Sim2667').get_weights() 
w[0] = np.array([[5]])
w[1] = np.array([[1]])
w[2] = np.array([5])
model.get_layer('Sim2667').set_weights(w) 
in0Sim2667 = tf.constant([[[8]]])
in0Max63727 = tf.constant([[[0.5464]]])
in1Max63727 = tf.constant([[[0.7202]]])
in0Max45988 = tf.constant([[[[[0.5063]], [[0.3436]]]]])
in1Max45988 = tf.constant([[[[[0.4623]], [[0.4934]]]]])
in0Add76252 = tf.constant([[[0.4176, 0.2497], [0.4093, 0.5246]]])
in1Add76252 = tf.constant([[[0.2156, 0.9286], [0.1916, 0.2487]]])
print (np.array2string(model.predict([in0Sim2667,in0Max63727,in1Max63727,in0Max45988,in1Max45988,in0Add76252,in1Add76252],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Thr72183.png')

LSim2667 = simple_rnn_layer([[[8]]],[[5]],[[1]],[5], Sim2667), 
LRes25479 = reshape_layer(Sim2667, [1, 1], Res25479), 
LMax63727 = maximum_layer([[[[0.5464]]], [[[0.7202]]]], Max63727), 
LMin80648 = minimum_layer([Res25479,Max63727], Min80648), 
LZer72702 = zero_padding1D_layer(Min80648, 1, 0, Zer72702), 
LMax45988 = maximum_layer([[[[[[0.5063]], [[0.3436]]]]], [[[[[0.4623]], [[0.4934]]]]]], Max45988), 
LRes81313 = reshape_layer(Max45988, [1, 2, 1], Res81313), 
LRes33665 = reshape_layer(Res81313, [1, 2], Res33665), 
LZer70200 = zero_padding1D_layer(Res33665, 1, 0, Zer70200), 
LAdd76252 = add_layer([[[[0.4176, 0.2497], [0.4093, 0.5246]]], [[[0.2156, 0.9286], [0.1916, 0.2487]]]], Add76252), 
LMax5984 = maximum_layer([Zer70200,Add76252], Max5984), 
LDot97170 = dot_layer(Zer72702,Max5984, 1, 1, Dot97170), 
LThr72183 = thresholded_relu_layer(Dot97170, 0.34875845195150634, Thr72183), 
exec_layers([LSim2667,LRes25479,LMax63727,LMin80648,LZer72702,LMax45988,LRes81313,LRes33665,LZer70200,LAdd76252,LMax5984,LDot97170,LThr72183],["Sim2667","Res25479","Max63727","Min80648","Zer72702","Max45988","Res81313","Res33665","Zer70200","Add76252","Max5984","Dot97170","Thr72183"],Thr72183,"Thr72183")

Actual (Unparsed): [[[0.4327682, 0.5569307]]]

Expected (Unparsed): [[[0.43276817999999995,0.5569306599999999]]]

Actual:   [[[0.4328, 0.557]]]

Expected: [[[0.4328, 0.557]]]