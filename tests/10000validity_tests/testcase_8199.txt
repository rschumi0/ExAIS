import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc42042 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Mul78015 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Mul78015 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con14195 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con31991 = tf.keras.layers.Input(shape=([4, 1]))
in0Sim71450 = tf.keras.layers.Input(shape=([3, 1]))

Loc42042 = keras.layers.LocallyConnected2D(2, (1, 1),strides=(1, 1), name = 'Loc42042', )(in0Loc42042)
Zer81272 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer81272', )(Loc42042)
Mul78015 = keras.layers.Multiply(name = 'Mul78015', )([in0Mul78015,in1Mul78015])
Con14195 = keras.layers.Concatenate(axis=3, name = 'Con14195', )([Mul78015,in0Con14195])
Max69843 = keras.layers.Maximum(name = 'Max69843', )([Zer81272,Con14195])
Res29430 = keras.layers.Reshape((1, 4), name = 'Res29430', )(Max69843)
Zer5944 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer5944', )(Res29430)
Con31991 = keras.layers.Concatenate(axis=2, name = 'Con31991', )([Zer5944,in0Con31991])
Sim71450 = keras.layers.SimpleRNN(2,name = 'Sim71450', )(in0Sim71450)
Den13940 = keras.layers.Dense(4,name = 'Den13940', )(Sim71450)
Res129 = keras.layers.Reshape((4, 1), name = 'Res129', )(Den13940)
Res69215 = keras.layers.Reshape((4, 1, 1), name = 'Res69215', )(Res129)
Res97538 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res97538', )(Res69215)
Con96540 = keras.layers.Conv3D(3, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con96540', )(Res97538)
Res8399 = keras.layers.Reshape((4, 1, 3), name = 'Res8399', )(Con96540)
Res63994 = keras.layers.Reshape((4, 3), name = 'Res63994', )(Res8399)
Dot50231 = keras.layers.Dot(axes=(1, 1), name = 'Dot50231', )([Con31991,Res63994])
model = tf.keras.models.Model(inputs=[in0Loc42042,in0Mul78015,in1Mul78015,in0Con14195,in0Con31991,in0Sim71450], outputs=Dot50231)
w = model.get_layer('Loc42042').get_weights() 
w[0] = np.array([[[0.342, 0.8113], [0.343, 0.4345]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc42042').set_weights(w) 
w = model.get_layer('Sim71450').get_weights() 
w[0] = np.array([[3, 9]])
w[1] = np.array([[7, 4], [7, 2]])
w[2] = np.array([9, 8])
model.get_layer('Sim71450').set_weights(w) 
w = model.get_layer('Den13940').get_weights() 
w[0] = np.array([[0.9591, 0.1378, 0.2853, 0.7222], [0.2406, 0.406, 0.3382, 0.5628]])
w[1] = np.array([0.6469, 0.1876, 0.743, 0.8307])
model.get_layer('Den13940').set_weights(w) 
w = model.get_layer('Con96540').get_weights() 
w[0] = np.array([[[[[0.058, 0.3035, 0.3116]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con96540').set_weights(w) 
in0Loc42042 = tf.constant([[[[0.176, 0.99]]]])
in0Mul78015 = tf.constant([[[[0.0366], [0.1864]]]])
in1Mul78015 = tf.constant([[[[0.1585], [0.7287]]]])
in0Con14195 = tf.constant([[[[0.1882], [0.0932]]]])
in0Con31991 = tf.constant([[[0.6269], [0.9343], [0.2378], [0.1133]]])
in0Sim71450 = tf.constant([[[9], [2], [10]]])
print (np.array2string(model.predict([in0Loc42042,in0Mul78015,in1Mul78015,in0Con14195,in0Con31991,in0Sim71450],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot50231.png')

LLoc42042 = locally_connected2D_layer([[[[0.176, 0.99]]]], 1, 1,[[[0.342, 0.8113], [0.343, 0.4345]]],[[[0, 0]]], 1, 1, Loc42042), 
LZer81272 = zero_padding2D_layer(Loc42042, 0, 0, 1, 0, Zer81272), 
LMul78015 = multiply_layer([[[[[0.0366], [0.1864]]]], [[[[0.1585], [0.7287]]]]], Mul78015), 
LCon14195 = concatenate_layer([Mul78015,[[[[0.1882], [0.0932]]]]], 3, Con14195), 
LMax69843 = maximum_layer([Zer81272,Con14195], Max69843), 
LRes29430 = reshape_layer(Max69843, [1, 4], Res29430), 
LZer5944 = zero_padding1D_layer(Res29430, 3, 0, Zer5944), 
LCon31991 = concatenate_layer([Zer5944,[[[0.6269], [0.9343], [0.2378], [0.1133]]]], 2, Con31991), 
LSim71450 = simple_rnn_layer([[[9], [2], [10]]],[[3, 9]],[[7, 4], [7, 2]],[9, 8], Sim71450), 
LDen13940 = dense_layer(Sim71450, [[0.9591, 0.1378, 0.2853, 0.7222], [0.2406, 0.406, 0.3382, 0.5628]],[0.6469, 0.1876, 0.743, 0.8307], Den13940), 
LRes129 = reshape_layer(Den13940, [4, 1], Res129), 
LRes69215 = reshape_layer(Res129, [4, 1, 1], Res69215), 
LRes97538 = reshape_layer(Res69215, [4, 1, 1, 1], Res97538), 
LCon96540 = conv3D_layer(Res97538, 1, 1, 1,[[[[[0.058, 0.3035, 0.3116]]]]],[0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con96540), 
LRes8399 = reshape_layer(Con96540, [4, 1, 3], Res8399), 
LRes63994 = reshape_layer(Res8399, [4, 3], Res63994), 
LDot50231 = dot_layer(Con31991,Res63994, 1, 1, Dot50231), 
exec_layers([LLoc42042,LZer81272,LMul78015,LCon14195,LMax69843,LRes29430,LZer5944,LCon31991,LSim71450,LDen13940,LRes129,LRes69215,LRes97538,LCon96540,LRes8399,LRes63994,LDot50231],["Loc42042","Zer81272","Mul78015","Con14195","Max69843","Res29430","Zer5944","Con31991","Sim71450","Den13940","Res129","Res69215","Res97538","Con96540","Res8399","Res63994","Dot50231"],Dot50231,"Dot50231")

Actual (Unparsed): [[[0.0007119, 0.0037250, 0.0038244], [0.0230941, 0.1208460, 0.1240712], [0.0490550, 0.2566932, 0.2635439], [0.0703063, 0.3678958, 0.3777144], [0.1395273, 0.7301127, 0.7495984]]]

Expected (Unparsed): [[[0.00071185646166,0.0037249730364449997,0.003824387473332],[0.023094134920000002,0.12084603359,0.124071248984],[0.04905503487720001,0.2566931566419,0.26354394599544007],[0.07030627746428,0.36789577948981,0.377714414790856],[0.13952729806,0.7301126717449999,0.7495983806119999]]]

Actual:   [[[0.0008, 0.0038, 0.0039], [0.0231, 0.1209, 0.1241], [0.0491, 0.2567, 0.2636], [0.0704, 0.3679, 0.3778], [0.1396, 0.7302, 0.7496]]]

Expected: [[[0.0008, 0.0038, 0.0039], [0.0231, 0.1209, 0.1241], [0.0491, 0.2567, 0.2636], [0.0704, 0.3679, 0.3778], [0.1396, 0.7302, 0.7496]]]