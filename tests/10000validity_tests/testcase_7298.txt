import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot92400 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot92400 = tf.keras.layers.Input(shape=([3, 2]))
in0Mul57938 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul57938 = tf.keras.layers.Input(shape=([2, 2]))
in0Con89971 = tf.keras.layers.Input(shape=([3, 1]))
in0Ave82311 = tf.keras.layers.Input(shape=([1, 1]))
in1Ave82311 = tf.keras.layers.Input(shape=([1, 1]))
in0Con5620 = tf.keras.layers.Input(shape=([3, 2]))
in0LST17998 = tf.keras.layers.Input(shape=([1, 1]))
in0Min4976 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Min4976 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con83950 = tf.keras.layers.Input(shape=([2, 1]))
in0Sep52597 = tf.keras.layers.Input(shape=([1, 2]))
in0Con2931 = tf.keras.layers.Input(shape=([3, 1]))

Dot92400 = keras.layers.Dot(axes=(2, 2), name = 'Dot92400', )([in0Dot92400,in1Dot92400])
Mul57938 = keras.layers.Multiply(name = 'Mul57938', )([in0Mul57938,in1Mul57938])
Zer61005 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer61005', )(Mul57938)
Con89971 = keras.layers.Concatenate(axis=2, name = 'Con89971', )([Zer61005,in0Con89971])
Sub98807 = keras.layers.Subtract(name = 'Sub98807', )([Dot92400,Con89971])
Ave82311 = keras.layers.Average(name = 'Ave82311', )([in0Ave82311,in1Ave82311])
Zer636 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer636', )(Ave82311)
Con5620 = keras.layers.Concatenate(axis=2, name = 'Con5620', )([Zer636,in0Con5620])
Max58655 = keras.layers.Maximum(name = 'Max58655', )([Sub98807,Con5620])
LST17998 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST17998', )(in0LST17998)
Res78645 = keras.layers.Reshape((1, 1), name = 'Res78645', )(LST17998)
Res87478 = keras.layers.Reshape((1, 1, 1), name = 'Res87478', )(Res78645)
Zer37647 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer37647', )(Res87478)
Min4976 = keras.layers.Minimum(name = 'Min4976', )([in0Min4976,in1Min4976])
Up_51004 = keras.layers.UpSampling2D(size=(2, 1), name = 'Up_51004', )(Min4976)
Add43324 = keras.layers.Add(name = 'Add43324', )([Zer37647,Up_51004])
Res30365 = keras.layers.Reshape((2, 1), name = 'Res30365', )(Add43324)
Con83950 = keras.layers.Concatenate(axis=2, name = 'Con83950', )([Res30365,in0Con83950])
Sep52597 = keras.layers.SeparableConv1D(2, (1),strides=(1), padding='valid', name = 'Sep52597', )(in0Sep52597)
Zer19281 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer19281', )(Sep52597)
Ave96131 = keras.layers.Average(name = 'Ave96131', )([Con83950,Zer19281])
Zer21194 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer21194', )(Ave96131)
Con2931 = keras.layers.Concatenate(axis=2, name = 'Con2931', )([Zer21194,in0Con2931])
Max13582 = keras.layers.Maximum(name = 'Max13582', )([Max58655,Con2931])
model = tf.keras.models.Model(inputs=[in0Dot92400,in1Dot92400,in0Mul57938,in1Mul57938,in0Con89971,in0Ave82311,in1Ave82311,in0Con5620,in0LST17998,in0Min4976,in1Min4976,in0Con83950,in0Sep52597,in0Con2931], outputs=Max13582)
w = model.get_layer('LST17998').get_weights() 
w[0] = np.array([[10, 9, 5, 6]])
w[1] = np.array([[4, 7, 9, 1]])
w[2] = np.array([8, 8, 9, 3])
model.get_layer('LST17998').set_weights(w) 
w = model.get_layer('Sep52597').get_weights() 
w[0] = np.array([[[0.462], [0.4976]]])
w[1] = np.array([[[0.4498, 0.0965], [0.9071, 0.6647]]])
w[2] = np.array([0, 0])
model.get_layer('Sep52597').set_weights(w) 
in0Dot92400 = tf.constant([[[0.344, 0.1935], [0.6273, 0.1317], [0.9255, 0.5744]]])
in1Dot92400 = tf.constant([[[0.0856, 0.1316], [0.6771, 0.4651], [0.089, 0.4152]]])
in0Mul57938 = tf.constant([[[0.5475, 0.9954], [0.5081, 0.1129]]])
in1Mul57938 = tf.constant([[[0.1602, 0.3496], [0.4256, 0.9404]]])
in0Con89971 = tf.constant([[[0.7835], [0.1967], [0.8441]]])
in0Ave82311 = tf.constant([[[0.6427]]])
in1Ave82311 = tf.constant([[[0.5453]]])
in0Con5620 = tf.constant([[[0.3157, 0.9985], [0.2691, 0.4661], [0.06, 0.4179]]])
in0LST17998 = tf.constant([[[4]]])
in0Min4976 = tf.constant([[[[0.6124]]]])
in1Min4976 = tf.constant([[[[0.6017]]]])
in0Con83950 = tf.constant([[[0.2289], [0.1401]]])
in0Sep52597 = tf.constant([[[0.9012, 0.6293]]])
in0Con2931 = tf.constant([[[0.909], [0.4898], [0.0345]]])
print (np.array2string(model.predict([in0Dot92400,in1Dot92400,in0Mul57938,in1Mul57938,in0Con89971,in0Ave82311,in1Ave82311,in0Con5620,in0LST17998,in0Min4976,in1Min4976,in0Con83950,in0Sep52597,in0Con2931],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max13582.png')

LDot92400 = dot_layer([[[0.344, 0.1935], [0.6273, 0.1317], [0.9255, 0.5744]]], [[[0.0856, 0.1316], [0.6771, 0.4651], [0.089, 0.4152]]], 2, 2, Dot92400), 
LMul57938 = multiply_layer([[[[0.5475, 0.9954], [0.5081, 0.1129]]], [[[0.1602, 0.3496], [0.4256, 0.9404]]]], Mul57938), 
LZer61005 = zero_padding1D_layer(Mul57938, 1, 0, Zer61005), 
LCon89971 = concatenate_layer([Zer61005,[[[0.7835], [0.1967], [0.8441]]]], 2, Con89971), 
LSub98807 = subtract_layer(Dot92400,Con89971, Sub98807), 
LAve82311 = average_layer([[[[0.6427]]], [[[0.5453]]]], Ave82311), 
LZer636 = zero_padding1D_layer(Ave82311, 2, 0, Zer636), 
LCon5620 = concatenate_layer([Zer636,[[[0.3157, 0.9985], [0.2691, 0.4661], [0.06, 0.4179]]]], 2, Con5620), 
LMax58655 = maximum_layer([Sub98807,Con5620], Max58655), 
LLST17998 = lstm_layer([[[4]]],[[10, 9, 5, 6]],[[4, 7, 9, 1]],[8, 8, 9, 3], LST17998), 
LRes78645 = reshape_layer(LST17998, [1, 1], Res78645), 
LRes87478 = reshape_layer(Res78645, [1, 1, 1], Res87478), 
LZer37647 = zero_padding2D_layer(Res87478, 1, 0, 0, 0, Zer37647), 
LMin4976 = minimum_layer([[[[[0.6124]]]], [[[[0.6017]]]]], Min4976), 
LUp_51004 = up_sampling2D_layer(Min4976, 2, 1, Up_51004), 
LAdd43324 = add_layer([Zer37647,Up_51004], Add43324), 
LRes30365 = reshape_layer(Add43324, [2, 1], Res30365), 
LCon83950 = concatenate_layer([Res30365,[[[0.2289], [0.1401]]]], 2, Con83950), 
LSep52597 = separable_conv1D_layer([[[0.9012, 0.6293]]], 1,[[[[0.462], [0.4976]]],[[[0.4498, 0.0965], [0.9071, 0.6647]]]],[0, 0], 1, false, Sep52597), 
LZer19281 = zero_padding1D_layer(Sep52597, 1, 0, Zer19281), 
LAve96131 = average_layer([Con83950,Zer19281], Ave96131), 
LZer21194 = zero_padding1D_layer(Ave96131, 1, 0, Zer21194), 
LCon2931 = concatenate_layer([Zer21194,[[[0.909], [0.4898], [0.0345]]]], 2, Con2931), 
LMax13582 = maximum_layer([Max58655,Con2931], Max13582), 
exec_layers([LDot92400,LMul57938,LZer61005,LCon89971,LSub98807,LAve82311,LZer636,LCon5620,LMax58655,LLST17998,LRes78645,LRes87478,LZer37647,LMin4976,LUp_51004,LAdd43324,LRes30365,LCon83950,LSep52597,LZer19281,LAve96131,LZer21194,LCon2931,LMax13582],["Dot92400","Mul57938","Zer61005","Con89971","Sub98807","Ave82311","Zer636","Con5620","Max58655","LST17998","Res78645","Res87478","Zer37647","Min4976","Up_51004","Add43324","Res30365","Con83950","Sep52597","Zer19281","Ave96131","Zer21194","Con2931","Max13582"],Max13582,"Max13582")

Actual (Unparsed): [[[0.0549110, 0.3229193, 0.9985000], [0.3008500, 0.2691000, 0.4898000], [0.9173097, 0.7876383, 0.4179000]]]

Expected (Unparsed): [[[0.054911,0.32291925,0.9985],[0.30085,0.2691,0.4898],[0.9173096844011666,0.7876383299999999,0.4179]]]

Actual:   [[[0.055, 0.323, 0.9985], [0.3009, 0.2691, 0.4898], [0.9174, 0.7877, 0.4179]]]

Expected: [[[0.055, 0.323, 0.9985], [0.3009, 0.2691, 0.4898], [0.9174, 0.7877, 0.4179]]]