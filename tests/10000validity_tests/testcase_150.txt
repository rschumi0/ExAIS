import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot31161 = tf.keras.layers.Input(shape=([3]))
in1Dot31161 = tf.keras.layers.Input(shape=([3]))
in0Con85639 = tf.keras.layers.Input(shape=([1, 2]))
in0Add86658 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Add86658 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Max3397 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Max3397 = tf.keras.layers.Input(shape=([1, 2, 1]))

Dot31161 = keras.layers.Dot(axes=(1, 1), name = 'Dot31161', )([in0Dot31161,in1Dot31161])
Res6867 = keras.layers.Reshape((1, 1), name = 'Res6867', )(Dot31161)
Con85639 = keras.layers.Concatenate(axis=2, name = 'Con85639', )([Res6867,in0Con85639])
Add86658 = keras.layers.Add(name = 'Add86658', )([in0Add86658,in1Add86658])
Zer63694 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer63694', )(Add86658)
Max3397 = keras.layers.Maximum(name = 'Max3397', )([in0Max3397,in1Max3397])
Zer85436 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer85436', )(Max3397)
Mul85499 = keras.layers.Multiply(name = 'Mul85499', )([Zer63694,Zer85436])
Res19416 = keras.layers.Reshape((2, 3), name = 'Res19416', )(Mul85499)
Dot37335 = keras.layers.Dot(axes=(2, 2), name = 'Dot37335', )([Con85639,Res19416])
Sep21095 = keras.layers.SeparableConv1D(4, (2),strides=(1), padding='same', name = 'Sep21095', )(Dot37335)
model = tf.keras.models.Model(inputs=[in0Dot31161,in1Dot31161,in0Con85639,in0Add86658,in1Add86658,in0Max3397,in1Max3397], outputs=Sep21095)
w = model.get_layer('Sep21095').get_weights() 
w[0] = np.array([[[0.7778], [0.0606]], [[0.8987], [0.4128]]])
w[1] = np.array([[[0.2678, 0.5076, 0.965, 0.7619], [0.2331, 0.2857, 0.9412, 0.2047]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep21095').set_weights(w) 
in0Dot31161 = tf.constant([[0.461, 0.0643, 0.4872]])
in1Dot31161 = tf.constant([[0.2989, 0.011, 0.3371]])
in0Con85639 = tf.constant([[[0.1097, 0.514]]])
in0Add86658 = tf.constant([[[[0.4025]], [[0.2553]]]])
in1Add86658 = tf.constant([[[[0.0422]], [[0.6477]]]])
in0Max3397 = tf.constant([[[[0.9932], [0.0737]]]])
in1Max3397 = tf.constant([[[[0.4423], [0.5892]]]])
print (np.array2string(model.predict([in0Dot31161,in1Dot31161,in0Con85639,in0Add86658,in1Add86658,in0Max3397,in1Max3397],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sep21095.png')

LDot31161 = dot_layer([[0.461, 0.0643, 0.4872]], [[0.2989, 0.011, 0.3371]], 1, 1, Dot31161), 
LRes6867 = reshape_layer(Dot31161, [1, 1], Res6867), 
LCon85639 = concatenate_layer([Res6867,[[[0.1097, 0.514]]]], 2, Con85639), 
LAdd86658 = add_layer([[[[[0.4025]], [[0.2553]]]], [[[[0.0422]], [[0.6477]]]]], Add86658), 
LZer63694 = zero_padding2D_layer(Add86658, 0, 0, 2, 0, Zer63694), 
LMax3397 = maximum_layer([[[[[0.9932], [0.0737]]]], [[[[0.4423], [0.5892]]]]], Max3397), 
LZer85436 = zero_padding2D_layer(Max3397, 1, 0, 1, 0, Zer85436), 
LMul85499 = multiply_layer([Zer63694,Zer85436], Mul85499), 
LRes19416 = reshape_layer(Mul85499, [2, 3], Res19416), 
LDot37335 = dot_layer(Con85639,Res19416, 2, 2, Dot37335), 
LSep21095 = separable_conv1D_layer(Dot37335, 2,[[[[0.7778], [0.0606]], [[0.8987], [0.4128]]],[[[0.2678, 0.5076, 0.965, 0.7619], [0.2331, 0.2857, 0.9412, 0.2047]]]],[0, 0, 0, 0], 1, true, Sep21095), 
exec_layers([LDot31161,LRes6867,LCon85639,LAdd86658,LZer63694,LMax3397,LZer85436,LMul85499,LRes19416,LDot37335,LSep21095],["Dot31161","Res6867","Con85639","Add86658","Zer63694","Max3397","Zer85436","Mul85499","Res19416","Dot37335","Sep21095"],Sep21095,"Sep21095")

Actual (Unparsed): [[[0.0038630, 0.0047347, 0.0155980, 0.0033924]]]

Expected (Unparsed): [[[0.003863033774221104,0.004734743669219088,0.015597972493766208,0.0033923767206480476]]]

Actual:   [[[0.0039, 0.0048, 0.0156, 0.0034]]]

Expected: [[[0.0039, 0.0048, 0.0156, 0.0034]]]