import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min34463 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Min34463 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Sub93242 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub93242 = tf.keras.layers.Input(shape=([2, 2]))
in0Con62887 = tf.keras.layers.Input(shape=([2, 2]))

Min34463 = keras.layers.Minimum(name = 'Min34463', )([in0Min34463,in1Min34463])
Res4612 = keras.layers.Reshape((1, 4), name = 'Res4612', )(Min34463)
Zer60268 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer60268', )(Res4612)
Sub93242 = keras.layers.Subtract(name = 'Sub93242', )([in0Sub93242,in1Sub93242])
Lay94990 = keras.layers.LayerNormalization(axis=1, epsilon=1.8412057580255825, name = 'Lay94990', )(Sub93242)
Con62887 = keras.layers.Concatenate(axis=2, name = 'Con62887', )([Lay94990,in0Con62887])
Sub33538 = keras.layers.Subtract(name = 'Sub33538', )([Zer60268,Con62887])
Res25276 = keras.layers.Reshape((2, 4, 1), name = 'Res25276', )(Sub33538)
Con70739 = keras.layers.Conv2D(4, (1, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con70739', )(Res25276)
model = tf.keras.models.Model(inputs=[in0Min34463,in1Min34463,in0Sub93242,in1Sub93242,in0Con62887], outputs=Con70739)
w = model.get_layer('Con70739').get_weights() 
w[0] = np.array([[[[0.2045, 0.9076, 0.2163, 0.0714]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con70739').set_weights(w) 
in0Min34463 = tf.constant([[[[0.0962, 0.1028], [0.9876, 0.4065]]]])
in1Min34463 = tf.constant([[[[0.3955, 0.553], [0.0445, 0.7207]]]])
in0Sub93242 = tf.constant([[[0.4549, 0.6885], [0.1498, 0.0852]]])
in1Sub93242 = tf.constant([[[0.0224, 0.1572], [0.3781, 0.7951]]])
in0Con62887 = tf.constant([[[0.1729, 0.3204], [0.7483, 0.9612]]])
print (np.array2string(model.predict([in0Min34463,in1Min34463,in0Sub93242,in1Sub93242,in0Con62887],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con70739.png')

LMin34463 = minimum_layer([[[[[0.0962, 0.1028], [0.9876, 0.4065]]]], [[[[0.3955, 0.553], [0.0445, 0.7207]]]]], Min34463), 
LRes4612 = reshape_layer(Min34463, [1, 4], Res4612), 
LZer60268 = zero_padding1D_layer(Res4612, 1, 0, Zer60268), 
LSub93242 = subtract_layer([[[0.4549, 0.6885], [0.1498, 0.0852]]], [[[0.0224, 0.1572], [0.3781, 0.7951]]], Sub93242), 
LLay94990 = layer_normalization_layer(Sub93242, 1, 1.8412057580255825, Lay94990), 
LCon62887 = concatenate_layer([Lay94990,[[[0.1729, 0.3204], [0.7483, 0.9612]]]], 2, Con62887), 
LSub33538 = subtract_layer(Zer60268,Con62887, Sub33538), 
LRes25276 = reshape_layer(Sub33538, [2, 4, 1], Res25276), 
LCon70739 = conv2D_layer(Res25276, 1, 1,[[[[0.2045, 0.9076, 0.2163, 0.0714]]]],[0, 0, 0, 0], 1, 1, true, 1, 1, Con70739), 
exec_layers([LMin34463,LRes4612,LZer60268,LSub93242,LLay94990,LCon62887,LSub33538,LRes25276,LCon70739],["Min34463","Res4612","Zer60268","Sub93242","Lay94990","Con62887","Sub33538","Res25276","Con70739"],Con70739,"Con70739")

Actual (Unparsed): [[[[-0.0483810, -0.2147217, -0.0511727, -0.0168919], [-0.0850567, -0.3774935, -0.0899646, -0.0296970], [-0.0353581, -0.1569240, -0.0373983, -0.0123451], [-0.0655218, -0.2907950, -0.0693025, -0.0228766]], [[0.0680539, 0.3020329, 0.0719807, 0.0237606], [0.1060793, 0.4707948, 0.1122002, 0.0370370], [-0.1439271, -0.6387689, -0.1522319, -0.0502513], [-0.1134361, -0.5034457, -0.1199816, -0.0396056]]]]

Expected (Unparsed): [[[[-0.04838100171331484,-0.21472174647923983,-0.051172668315843516,-0.016891948764453203],[-0.08505666533774199,-0.37749354259430135,-0.08996458050148455,-0.029697045990781313],[-0.035358049999999995,-0.15692404,-0.03739827,-0.012345060000000001],[-0.0655218,-0.29079504,-0.06930252,-0.022876560000000004]],[[0.06805390171331482,0.3020328664792398,0.07198072831584351,0.0237606287644532],[0.10607926533774198,0.47079482259430133,0.11220022050148455,0.037036965990781316],[-0.14392709999999997,-0.63876888,-0.15223193999999998,-0.05025132],[-0.11343615000000001,-0.5034457200000001,-0.11998161000000002,-0.03960558000000001]]]]

Actual:   [[[[-0.0483, -0.2147, -0.0511, -0.0168], [-0.085, -0.3774, -0.0899, -0.0296], [-0.0353, -0.1569, -0.0373, -0.0123], [-0.0655, -0.2907, -0.0693, -0.0228]], [[0.0681, 0.3021, 0.072, 0.0238], [0.1061, 0.4708, 0.1123, 0.0371], [-0.1439, -0.6387, -0.1522, -0.0502], [-0.1134, -0.5034, -0.1199, -0.0396]]]]

Expected: [[[[-0.0483, -0.2147, -0.0511, -0.0168], [-0.085, -0.3774, -0.0899, -0.0296], [-0.0353, -0.1569, -0.0373, -0.0123], [-0.0655, -0.2907, -0.0693, -0.0228]], [[0.0681, 0.3021, 0.072, 0.0238], [0.1061, 0.4708, 0.1123, 0.0371], [-0.1439, -0.6387, -0.1522, -0.0502], [-0.1134, -0.5034, -0.1199, -0.0396]]]]