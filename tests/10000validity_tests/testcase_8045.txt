import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max72041 = tf.keras.layers.Input(shape=([2, 1]))
in1Max72041 = tf.keras.layers.Input(shape=([2, 1]))
in0Max27239 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Max27239 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))

Max72041 = keras.layers.Maximum(name = 'Max72041', )([in0Max72041,in1Max72041])
Max27239 = keras.layers.Maximum(name = 'Max27239', )([in0Max27239,in1Max27239])
Res9646 = keras.layers.Reshape((1, 1, 1), name = 'Res9646', )(Max27239)
Res12714 = keras.layers.Reshape((1, 1), name = 'Res12714', )(Res9646)
Dot35413 = keras.layers.Dot(axes=(2, 2), name = 'Dot35413', )([Max72041,Res12714])
Sim93376 = keras.layers.SimpleRNN(1,name = 'Sim93376', )(Dot35413)
model = tf.keras.models.Model(inputs=[in0Max72041,in1Max72041,in0Max27239,in1Max27239], outputs=Sim93376)
w = model.get_layer('Sim93376').get_weights() 
w[0] = np.array([[5]])
w[1] = np.array([[9]])
w[2] = np.array([9])
model.get_layer('Sim93376').set_weights(w) 
in0Max72041 = tf.constant([[[0.6353], [0.5526]]])
in1Max72041 = tf.constant([[[0.5958], [0.3057]]])
in0Max27239 = tf.constant([[[[[0.8119]]]]])
in1Max27239 = tf.constant([[[[[0.0086]]]]])
print (np.array2string(model.predict([in0Max72041,in1Max72041,in0Max27239,in1Max27239],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sim93376.png')

LMax72041 = maximum_layer([[[[0.6353], [0.5526]]], [[[0.5958], [0.3057]]]], Max72041), 
LMax27239 = maximum_layer([[[[[[0.8119]]]]], [[[[[0.0086]]]]]], Max27239), 
LRes9646 = reshape_layer(Max27239, [1, 1, 1], Res9646), 
LRes12714 = reshape_layer(Res9646, [1, 1], Res12714), 
LDot35413 = dot_layer(Max72041,Res12714, 2, 2, Dot35413), 
LSim93376 = simple_rnn_layer(Dot35413,[[5]],[[9]],[9], Sim93376), 
exec_layers([LMax72041,LMax27239,LRes9646,LRes12714,LDot35413,LSim93376],["Max72041","Max27239","Res9646","Res12714","Dot35413","Sim93376"],Sim93376,"Sim93376")

Actual (Unparsed): [[1.0000000]]

Expected (Unparsed): [[1.0]]

Actual:   [[1]]

Expected: [[1]]