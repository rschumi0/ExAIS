import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo42434 = tf.keras.layers.Input(shape=([1, 1]))
in0Con18318 = tf.keras.layers.Input(shape=([1, 3]))
in0Max69931 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Max69931 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con69383 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Mul64951 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Mul64951 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))

Glo42434 = keras.layers.GlobalMaxPool1D(name = 'Glo42434', )(in0Glo42434)
Bat87471 = keras.layers.BatchNormalization(axis=1, epsilon=0.6884229050303402,  name = 'Bat87471', )(Glo42434)
Res11674 = keras.layers.Reshape((1, 1), name = 'Res11674', )(Bat87471)
Con18318 = keras.layers.Concatenate(axis=2, name = 'Con18318', )([Res11674,in0Con18318])
Max69931 = keras.layers.Maximum(name = 'Max69931', )([in0Max69931,in1Max69931])
Res32898 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res32898', )(Max69931)
Con69383 = keras.layers.Concatenate(axis=4, name = 'Con69383', )([Res32898,in0Con69383])
Mul64951 = keras.layers.Multiply(name = 'Mul64951', )([in0Mul64951,in1Mul64951])
Zer13593 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (0, 0)), name = 'Zer13593', )(Mul64951)
Add89292 = keras.layers.Add(name = 'Add89292', )([Con69383,Zer13593])
Res90945 = keras.layers.Reshape((1, 2, 2), name = 'Res90945', )(Add89292)
Res47748 = keras.layers.Reshape((1, 4), name = 'Res47748', )(Res90945)
Dot16529 = keras.layers.Dot(axes=(1, 1), name = 'Dot16529', )([Con18318,Res47748])
model = tf.keras.models.Model(inputs=[in0Glo42434,in0Con18318,in0Max69931,in1Max69931,in0Con69383,in0Mul64951,in1Mul64951], outputs=Dot16529)
w = model.get_layer('Bat87471').get_weights() 
w[0] = np.array([0.8239])
w[1] = np.array([0.4967])
w[2] = np.array([0.0127])
w[3] = np.array([0.3677])
model.get_layer('Bat87471').set_weights(w) 
in0Glo42434 = tf.constant([[[1.5878]]])
in0Con18318 = tf.constant([[[0.9867, 0.3545, 0.4889]]])
in0Max69931 = tf.constant([[[[0.6939], [0.7883]]]])
in1Max69931 = tf.constant([[[[0.142], [0.5034]]]])
in0Con69383 = tf.constant([[[[[0.8482]], [[0.6369]]]]])
in0Mul64951 = tf.constant([[[[[0.8691, 0.3459]]]]])
in1Mul64951 = tf.constant([[[[[0.7699, 0.1474]]]]])
print (np.array2string(model.predict([in0Glo42434,in0Con18318,in0Max69931,in1Max69931,in0Con69383,in0Mul64951,in1Mul64951],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot16529.png')

LGlo42434 = global_max_pool1D_layer([[[1.5878]]], Glo42434), 
LBat87471 = batch_normalization_layer(Glo42434, 1, 0.6884229050303402, [0.8239], [0.4967], [0.0127], [0.3677], Bat87471), 
LRes11674 = reshape_layer(Bat87471, [1, 1], Res11674), 
LCon18318 = concatenate_layer([Res11674,[[[0.9867, 0.3545, 0.4889]]]], 2, Con18318), 
LMax69931 = maximum_layer([[[[[0.6939], [0.7883]]]], [[[[0.142], [0.5034]]]]], Max69931), 
LRes32898 = reshape_layer(Max69931, [1, 2, 1, 1], Res32898), 
LCon69383 = concatenate_layer([Res32898,[[[[[0.8482]], [[0.6369]]]]]], 4, Con69383), 
LMul64951 = multiply_layer([[[[[[0.8691, 0.3459]]]]], [[[[[0.7699, 0.1474]]]]]], Mul64951), 
LZer13593 = zero_padding3D_layer(Mul64951, 0, 0, 1, 0, 0, 0, Zer13593), 
LAdd89292 = add_layer([Con69383,Zer13593], Add89292), 
LRes90945 = reshape_layer(Add89292, [1, 2, 2], Res90945), 
LRes47748 = reshape_layer(Res90945, [1, 4], Res47748), 
LDot16529 = dot_layer(Con18318,Res47748, 1, 1, Dot16529), 
exec_layers([LGlo42434,LBat87471,LRes11674,LCon18318,LMax69931,LRes32898,LCon69383,LMul64951,LZer13593,LAdd89292,LRes90945,LRes47748,LDot16529],["Glo42434","Bat87471","Res11674","Con18318","Max69931","Res32898","Con69383","Mul64951","Zer13593","Add89292","Res90945","Res47748","Dot16529"],Dot16529,"Dot16529")

Actual (Unparsed): [[[1.2208985, 1.4923853, 2.5642918, 1.2103165], [0.6846711, 0.8369190, 1.4380364, 0.6787368], [0.2459875, 0.3006869, 0.5166554, 0.2438555], [0.3392477, 0.4146850, 0.7125327, 0.3363073]]]

Expected (Unparsed): [[[1.2208985489398274,1.4923852849268795,2.564291789993879,1.2103164780667468],[0.68467113,0.83691894,1.4380364028030002,0.678736780722],[0.24598754999999997,0.3006869,0.516655421905,0.24385546647],[0.33924771,0.41468498,0.7125326820010001,0.33630729917400004]]]

Actual:   [[[1.2209, 1.4924, 2.5643, 1.2104], [0.6847, 0.837, 1.4381, 0.6788], [0.246, 0.3007, 0.5167, 0.2439], [0.3393, 0.4147, 0.7126, 0.3364]]]

Expected: [[[1.2209, 1.4924, 2.5643, 1.2104], [0.6847, 0.837, 1.4381, 0.6788], [0.246, 0.3007, 0.5167, 0.2439], [0.3393, 0.4147, 0.7126, 0.3364]]]