import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul83800 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Mul83800 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Dot53682 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot53682 = tf.keras.layers.Input(shape=([2, 2]))
in0Ave96505 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave96505 = tf.keras.layers.Input(shape=([1, 2]))
in0Con90237 = tf.keras.layers.Input(shape=([2, 2]))

Mul83800 = keras.layers.Multiply(name = 'Mul83800', )([in0Mul83800,in1Mul83800])
Con50617 = keras.layers.Conv2DTranspose(2, (2, 1),strides=(1, 1), padding='same', name = 'Con50617', )(Mul83800)
Res70313 = keras.layers.Reshape((1, 4), name = 'Res70313', )(Con50617)
Zer5161 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer5161', )(Res70313)
Dot53682 = keras.layers.Dot(axes=(1, 1), name = 'Dot53682', )([in0Dot53682,in1Dot53682])
Ave96505 = keras.layers.Average(name = 'Ave96505', )([in0Ave96505,in1Ave96505])
Zer12586 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer12586', )(Ave96505)
Sub28787 = keras.layers.Subtract(name = 'Sub28787', )([Dot53682,Zer12586])
Con90237 = keras.layers.Concatenate(axis=2, name = 'Con90237', )([Sub28787,in0Con90237])
Sub75266 = keras.layers.Subtract(name = 'Sub75266', )([Zer5161,Con90237])
model = tf.keras.models.Model(inputs=[in0Mul83800,in1Mul83800,in0Dot53682,in1Dot53682,in0Ave96505,in1Ave96505,in0Con90237], outputs=Sub75266)
w = model.get_layer('Con50617').get_weights() 
w[0] = np.array([[[[0.3299], [0.3194]]], [[[0.6693], [0.6708]]]])
w[1] = np.array([0, 0])
model.get_layer('Con50617').set_weights(w) 
in0Mul83800 = tf.constant([[[[0.566], [0.3498]]]])
in1Mul83800 = tf.constant([[[[0.5191], [0.3132]]]])
in0Dot53682 = tf.constant([[[0.1164, 0.614], [0.9376, 0.3775]]])
in1Dot53682 = tf.constant([[[0.188, 0.595], [0.3617, 0.2162]]])
in0Ave96505 = tf.constant([[[0.2318, 0.329]]])
in1Ave96505 = tf.constant([[[0.4792, 0.2467]]])
in0Con90237 = tf.constant([[[0.6847, 0.2924], [0.6066, 0.7348]]])
print (np.array2string(model.predict([in0Mul83800,in1Mul83800,in0Dot53682,in1Dot53682,in0Ave96505,in1Ave96505,in0Con90237],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub75266.png')

LMul83800 = multiply_layer([[[[[0.566], [0.3498]]]], [[[[0.5191], [0.3132]]]]], Mul83800), 
LCon50617 = conv2D_transpose_layer(Mul83800, 2, 1,[[[[0.3299], [0.3194]]], [[[0.6693], [0.6708]]]],[0, 0], 1, 1, true, Con50617), 
LRes70313 = reshape_layer(Con50617, [1, 4], Res70313), 
LZer5161 = zero_padding1D_layer(Res70313, 1, 0, Zer5161), 
LDot53682 = dot_layer([[[0.1164, 0.614], [0.9376, 0.3775]]], [[[0.188, 0.595], [0.3617, 0.2162]]], 1, 1, Dot53682), 
LAve96505 = average_layer([[[[0.2318, 0.329]]], [[[0.4792, 0.2467]]]], Ave96505), 
LZer12586 = zero_padding1D_layer(Ave96505, 1, 0, Zer12586), 
LSub28787 = subtract_layer(Dot53682,Zer12586, Sub28787), 
LCon90237 = concatenate_layer([Sub28787,[[[0.6847, 0.2924], [0.6066, 0.7348]]]], 2, Con90237), 
LSub75266 = subtract_layer(Zer5161,Con90237, Sub75266), 
exec_layers([LMul83800,LCon50617,LRes70313,LZer5161,LDot53682,LAve96505,LZer12586,LSub28787,LCon90237,LSub75266],["Mul83800","Con50617","Res70313","Zer5161","Dot53682","Ave96505","Zer12586","Sub28787","Con90237","Sub75266"],Sub75266,"Sub75266")

Actual (Unparsed): [[[-0.3610131, -0.2719671, -0.6847000, -0.2924000], [0.2004544, -0.0652524, -0.5704570, -0.6998074]]]

Expected (Unparsed): [[[-0.36101312,-0.27196712,-0.6847,-0.2924],[0.20045436694000004,-0.06525239436000001,-0.570457026936,-0.699807379216]]]

Actual:   [[[-0.361, -0.2719, -0.6847, -0.2924], [0.2005, -0.0652, -0.5704, -0.6998]]]

Expected: [[[-0.361, -0.2719, -0.6847, -0.2924], [0.2005, -0.0652, -0.5704, -0.6998]]]