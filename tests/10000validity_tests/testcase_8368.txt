import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub32926 = tf.keras.layers.Input(shape=([2, 3, 3, 2]))
in1Sub32926 = tf.keras.layers.Input(shape=([2, 3, 3, 2]))
in0Min87266 = tf.keras.layers.Input(shape=([2, 2]))
in1Min87266 = tf.keras.layers.Input(shape=([2, 2]))
in0Con81995 = tf.keras.layers.Input(shape=([2, 16]))
in0Sub33039 = tf.keras.layers.Input(shape=([2, 2, 3]))
in1Sub33039 = tf.keras.layers.Input(shape=([2, 2, 3]))

Sub32926 = keras.layers.Subtract(name = 'Sub32926', )([in0Sub32926,in1Sub32926])
Res18250 = keras.layers.Reshape((2, 3, 6), name = 'Res18250', )(Sub32926)
Res93690 = keras.layers.Reshape((2, 18), name = 'Res93690', )(Res18250)
Min87266 = keras.layers.Minimum(name = 'Min87266', )([in0Min87266,in1Min87266])
Con81995 = keras.layers.Concatenate(axis=2, name = 'Con81995', )([Min87266,in0Con81995])
Add52213 = keras.layers.Add(name = 'Add52213', )([Res93690,Con81995])
Res42352 = keras.layers.Reshape((2, 18, 1), name = 'Res42352', )(Add52213)
Sub33039 = keras.layers.Subtract(name = 'Sub33039', )([in0Sub33039,in1Sub33039])
Res32304 = keras.layers.Reshape((2, 6), name = 'Res32304', )(Sub33039)
Per94859 = keras.layers.Permute((1,2), name = 'Per94859',)(Res32304)
Res70764 = keras.layers.Reshape((2, 6, 1), name = 'Res70764', )(Per94859)
Dep41822 = keras.layers.DepthwiseConv2D((1, 6),strides=(1, 1), padding='same', name = 'Dep41822', )(Res70764)
Dep48085 = keras.layers.DepthwiseConv2D((1, 4),strides=(1, 1), padding='valid', name = 'Dep48085', )(Dep41822)
Zer4831 = keras.layers.ZeroPadding2D(padding=((0, 0), (15, 0)), name = 'Zer4831', )(Dep48085)
Max63770 = keras.layers.Maximum(name = 'Max63770', )([Res42352,Zer4831])
model = tf.keras.models.Model(inputs=[in0Sub32926,in1Sub32926,in0Min87266,in1Min87266,in0Con81995,in0Sub33039,in1Sub33039], outputs=Max63770)
w = model.get_layer('Dep41822').get_weights() 
w[0] = np.array([[[[0.8069]], [[0.7491]], [[0.116]], [[0.3227]], [[0.1443]], [[0.6299]]]])
w[1] = np.array([0])
model.get_layer('Dep41822').set_weights(w) 
w = model.get_layer('Dep48085').get_weights() 
w[0] = np.array([[[[0.7559]], [[0.3949]], [[0.1255]], [[0.0679]]]])
w[1] = np.array([0])
model.get_layer('Dep48085').set_weights(w) 
in0Sub32926 = tf.constant([[[[[0.5321, 0.1202], [0.9199, 0.8338], [0.35, 0.6078]], [[0.8875, 0.492], [0.1201, 0.742], [0.3323, 0.7255]], [[0.2191, 0.3401], [0.6113, 0.5032], [0.4206, 0.0776]]], [[[0.742, 0.7606], [0.8073, 0.2465], [0.2828, 0.2416]], [[0.5595, 0.4578], [0.9958, 0.4325], [0.1289, 0.2434]], [[0.2616, 0.8349], [0.4199, 0.6018], [0.8364, 0.05]]]]])
in1Sub32926 = tf.constant([[[[[0.9868, 0.1478], [0.9543, 0.407], [0.934, 0.677]], [[0.9612, 0.1564], [0.156, 0.6361], [0.6404, 0.5727]], [[0.7912, 0.2033], [0.1386, 0.6614], [0.2812, 0.4231]]], [[[0.9347, 0.5512], [0.222, 0.1185], [0.6048, 0.0639]], [[0.2756, 0.1046], [0.2362, 0.4056], [0.7694, 0.5699]], [[0.2133, 0.3953], [0.2533, 0.3534], [0.76, 0.16]]]]])
in0Min87266 = tf.constant([[[0.2053, 0.2509], [0.0605, 0.7623]]])
in1Min87266 = tf.constant([[[0.2835, 0.4112], [0.9986, 0.7996]]])
in0Con81995 = tf.constant([[[0.0828, 0.2068, 0.0876, 0.1831, 0.638, 0.1025, 0.6017, 0.1316, 0.5726, 0.1583, 0.477, 0.5512, 0.2875, 0.7658, 0.944, 0.2443], [0.9203, 0.8365, 0.1656, 0.0179, 0.4699, 0.7305, 0.8145, 0.1227, 0.4585, 0.71, 0.4588, 0.0688, 0.8986, 0.6651, 0.3086, 0.5167]]])
in0Sub33039 = tf.constant([[[[0.0048, 0.3455, 0.5591], [0.617, 0.4995, 0.067]], [[0.7137, 0.4065, 0.037], [0.4012, 0.1828, 0.135]]]])
in1Sub33039 = tf.constant([[[[0.3488, 0.5644, 0.8021], [0.936, 0.3828, 0.6932]], [[0.3549, 0.3286, 0.0184], [0.1276, 0.6363, 0.3873]]]])
print (np.array2string(model.predict([in0Sub32926,in1Sub32926,in0Min87266,in1Min87266,in0Con81995,in0Sub33039,in1Sub33039],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max63770.png')

LSub32926 = subtract_layer([[[[[0.5321, 0.1202], [0.9199, 0.8338], [0.35, 0.6078]], [[0.8875, 0.492], [0.1201, 0.742], [0.3323, 0.7255]], [[0.2191, 0.3401], [0.6113, 0.5032], [0.4206, 0.0776]]], [[[0.742, 0.7606], [0.8073, 0.2465], [0.2828, 0.2416]], [[0.5595, 0.4578], [0.9958, 0.4325], [0.1289, 0.2434]], [[0.2616, 0.8349], [0.4199, 0.6018], [0.8364, 0.05]]]]], [[[[[0.9868, 0.1478], [0.9543, 0.407], [0.934, 0.677]], [[0.9612, 0.1564], [0.156, 0.6361], [0.6404, 0.5727]], [[0.7912, 0.2033], [0.1386, 0.6614], [0.2812, 0.4231]]], [[[0.9347, 0.5512], [0.222, 0.1185], [0.6048, 0.0639]], [[0.2756, 0.1046], [0.2362, 0.4056], [0.7694, 0.5699]], [[0.2133, 0.3953], [0.2533, 0.3534], [0.76, 0.16]]]]], Sub32926), 
LRes18250 = reshape_layer(Sub32926, [2, 3, 6], Res18250), 
LRes93690 = reshape_layer(Res18250, [2, 18], Res93690), 
LMin87266 = minimum_layer([[[[0.2053, 0.2509], [0.0605, 0.7623]]], [[[0.2835, 0.4112], [0.9986, 0.7996]]]], Min87266), 
LCon81995 = concatenate_layer([Min87266,[[[0.0828, 0.2068, 0.0876, 0.1831, 0.638, 0.1025, 0.6017, 0.1316, 0.5726, 0.1583, 0.477, 0.5512, 0.2875, 0.7658, 0.944, 0.2443], [0.9203, 0.8365, 0.1656, 0.0179, 0.4699, 0.7305, 0.8145, 0.1227, 0.4585, 0.71, 0.4588, 0.0688, 0.8986, 0.6651, 0.3086, 0.5167]]]], 2, Con81995), 
LAdd52213 = add_layer([Res93690,Con81995], Add52213), 
LRes42352 = reshape_layer(Add52213, [2, 18, 1], Res42352), 
LSub33039 = subtract_layer([[[[0.0048, 0.3455, 0.5591], [0.617, 0.4995, 0.067]], [[0.7137, 0.4065, 0.037], [0.4012, 0.1828, 0.135]]]], [[[[0.3488, 0.5644, 0.8021], [0.936, 0.3828, 0.6932]], [[0.3549, 0.3286, 0.0184], [0.1276, 0.6363, 0.3873]]]], Sub33039), 
LRes32304 = reshape_layer(Sub33039, [2, 6], Res32304), 
LPer94859 = permute_layer(Res32304, 1,2, Per94859), 
LRes70764 = reshape_layer(Per94859, [2, 6, 1], Res70764), 
LDep41822 = depthwise_conv2D_layer(Res70764, 1, 6,[[[[0.8069]], [[0.7491]], [[0.116]], [[0.3227]], [[0.1443]], [[0.6299]]]],[0], 1, 1, true, Dep41822), 
LDep48085 = depthwise_conv2D_layer(Dep41822, 1, 4,[[[[0.7559]], [[0.3949]], [[0.1255]], [[0.0679]]]],[0], 1, 1, false, Dep48085), 
LZer4831 = zero_padding2D_layer(Dep48085, 0, 0, 15, 0, Zer4831), 
LMax63770 = maximum_layer([Res42352,Zer4831], Max63770), 
exec_layers([LSub32926,LRes18250,LRes93690,LMin87266,LCon81995,LAdd52213,LRes42352,LSub33039,LRes32304,LPer94859,LRes70764,LDep41822,LDep48085,LZer4831,LMax63770],["Sub32926","Res18250","Res93690","Min87266","Con81995","Add52213","Res42352","Sub33039","Res32304","Per94859","Res70764","Dep41822","Dep48085","Zer4831","Max63770"],Max63770,"Max63770")

Actual (Unparsed): [[[[0.0000000], [0.2233000], [0.0484000], [0.6336000], [0.0000000], [0.1139000], [0.5643000], [0.4381000], [0.5658000], [0.2375000], [0.2645000], [0.3111000], [0.0000000], [0.6880000], [0.7602000], [0.6076000], [1.0834000], [-0.1012000]], [[0.0000000], [0.9717000], [1.5056000], [0.9645000], [0.0000000], [0.1956000], [0.7538000], [1.0837000], [1.5741000], [0.1496000], [0.0000000], [0.3835000], [0.5071000], [0.5084000], [1.0652000], [0.9135000], [0.3850000], [0.4067000]]]]

Expected (Unparsed): [[[[0],[0.22330000000000003],[0.04840000000000001],[0.6336],[0],[0.11389999999999997],[0.5642999999999999],[0.4381],[0.5658],[0.2375],[0.2645],[0.31110000000000004],[0],[0.6880000000000001],[0.7602],[0.6076],[1.0834],[-0.10119999999999998]],[[0],[0.9717],[1.5056],[0.9645],[0],[0.19560000000000002],[0.7538],[1.0836999999999999],[1.5741],[0.14959999999999998],[0],[0.3835],[0.5071],[0.5084],[1.0652],[0.9135],[0.385],[0.40670000000000006]]]]

Actual:   [[[[0], [0.2233], [0.0484], [0.6336], [0], [0.1139], [0.5643], [0.4381], [0.5658], [0.2375], [0.2645], [0.3111], [0], [0.688], [0.7602], [0.6076], [1.0834], [-0.1012]], [[0], [0.9717], [1.5056], [0.9645], [0], [0.1956], [0.7538], [1.0837], [1.5741], [0.1496], [0], [0.3835], [0.5071], [0.5084], [1.0652], [0.9135], [0.385], [0.4067]]]]

Expected: [[[[0], [0.2234], [0.0485], [0.6336], [0], [0.1139], [0.5643], [0.4381], [0.5658], [0.2375], [0.2645], [0.3112], [0], [0.6881], [0.7602], [0.6076], [1.0834], [-0.1011]], [[0], [0.9717], [1.5056], [0.9645], [0], [0.1957], [0.7538], [1.0837], [1.5741], [0.1496], [0], [0.3835], [0.5071], [0.5084], [1.0652], [0.9135], [0.385], [0.4068]]]]