import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add6977 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Add6977 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con99640 = tf.keras.layers.Input(shape=([1]))
in0Sub5921 = tf.keras.layers.Input(shape=([3, 2, 2, 2]))
in1Sub5921 = tf.keras.layers.Input(shape=([3, 2, 2, 2]))
in0Sub38732 = tf.keras.layers.Input(shape=([2]))
in1Sub38732 = tf.keras.layers.Input(shape=([2]))
in0Con53460 = tf.keras.layers.Input(shape=([7]))

Add6977 = keras.layers.Add(name = 'Add6977', )([in0Add6977,in1Add6977])
Res60639 = keras.layers.Reshape((2, 4), name = 'Res60639', )(Add6977)
Fla39208 = keras.layers.Flatten(name = 'Fla39208', )(Res60639)
Con99640 = keras.layers.Concatenate(axis=1, name = 'Con99640', )([Fla39208,in0Con99640])
Sub5921 = keras.layers.Subtract(name = 'Sub5921', )([in0Sub5921,in1Sub5921])
Con25781 = keras.layers.Conv3D(3, (1, 2, 1),strides=(1, 1, 5), padding='valid', dilation_rate=(1, 1, 1), name = 'Con25781', )(Sub5921)
Res59513 = keras.layers.Reshape((3, 1, 3), name = 'Res59513', )(Con25781)
Res27698 = keras.layers.Reshape((3, 3), name = 'Res27698', )(Res59513)
Fla77667 = keras.layers.Flatten(name = 'Fla77667', )(Res27698)
Sub38732 = keras.layers.Subtract(name = 'Sub38732', )([in0Sub38732,in1Sub38732])
Con53460 = keras.layers.Concatenate(axis=1, name = 'Con53460', )([Sub38732,in0Con53460])
Add28827 = keras.layers.Add(name = 'Add28827', )([Fla77667,Con53460])
Min81045 = keras.layers.Minimum(name = 'Min81045', )([Con99640,Add28827])
Res43160 = keras.layers.Reshape((9, 1), name = 'Res43160', )(Min81045)
Max8646 = keras.layers.MaxPool1D(pool_size=(3), strides=(9), padding='same', name = 'Max8646', )(Res43160)
model = tf.keras.models.Model(inputs=[in0Add6977,in1Add6977,in0Con99640,in0Sub5921,in1Sub5921,in0Sub38732,in1Sub38732,in0Con53460], outputs=Max8646)
w = model.get_layer('Con25781').get_weights() 
w[0] = np.array([[[[[0.6845, 0.1747, 0.0889], [0.6468, 0.4555, 0.2436]]], [[[0.9962, 0.0608, 0.2049], [0.7717, 0.6217, 0.8154]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con25781').set_weights(w) 
in0Add6977 = tf.constant([[[[0.1193, 0.3676], [0.7546, 0.5106]], [[0.2698, 0.0101], [0.3822, 0.2393]]]])
in1Add6977 = tf.constant([[[[0.3823, 0.4765], [0.458, 0.7859]], [[0.2057, 0.5926], [0.0849, 0.6262]]]])
in0Con99640 = tf.constant([[0.0039]])
in0Sub5921 = tf.constant([[[[[0.9631, 0.7279], [0.3274, 0.9782]], [[0.296, 0.9695], [0.7489, 0.1127]]], [[[0.8459, 0.1675], [0.9262, 0.7889]], [[0.4681, 0.6191], [0.9721, 0.1671]]], [[[0.5183, 0.5175], [0.4252, 0.4207]], [[0.1308, 0.9372], [0.7415, 0.9341]]]]])
in1Sub5921 = tf.constant([[[[[0.9164, 0.0467], [0.0168, 0.406]], [[0.0446, 0.4438], [0.5026, 0.3999]]], [[[0.2529, 0.9981], [0.9384, 0.8843]], [[0.9202, 0.3453], [0.7166, 0.0865]]], [[[0.9816, 0.2325], [0.4226, 0.5492]], [[0.1245, 0.2375], [0.3449, 0.6209]]]]])
in0Sub38732 = tf.constant([[0.4012, 0.9991]])
in1Sub38732 = tf.constant([[0.1401, 0.7403]])
in0Con53460 = tf.constant([[0.5885, 0.2577, 0.6669, 0.7819, 0.2177, 0.9168, 0.2283]])
print (np.array2string(model.predict([in0Add6977,in1Add6977,in0Con99640,in0Sub5921,in1Sub5921,in0Sub38732,in1Sub38732,in0Con53460],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max8646.png')

LAdd6977 = add_layer([[[[[0.1193, 0.3676], [0.7546, 0.5106]], [[0.2698, 0.0101], [0.3822, 0.2393]]]], [[[[0.3823, 0.4765], [0.458, 0.7859]], [[0.2057, 0.5926], [0.0849, 0.6262]]]]], Add6977), 
LRes60639 = reshape_layer(Add6977, [2, 4], Res60639), 
LFla39208 = flatten_layer(Res60639, Fla39208), 
LCon99640 = concatenate_layer([Fla39208,[[0.0039]]], 1, Con99640), 
LSub5921 = subtract_layer([[[[[0.9631, 0.7279], [0.3274, 0.9782]], [[0.296, 0.9695], [0.7489, 0.1127]]], [[[0.8459, 0.1675], [0.9262, 0.7889]], [[0.4681, 0.6191], [0.9721, 0.1671]]], [[[0.5183, 0.5175], [0.4252, 0.4207]], [[0.1308, 0.9372], [0.7415, 0.9341]]]]], [[[[[0.9164, 0.0467], [0.0168, 0.406]], [[0.0446, 0.4438], [0.5026, 0.3999]]], [[[0.2529, 0.9981], [0.9384, 0.8843]], [[0.9202, 0.3453], [0.7166, 0.0865]]], [[[0.9816, 0.2325], [0.4226, 0.5492]], [[0.1245, 0.2375], [0.3449, 0.6209]]]]], Sub5921), 
LCon25781 = conv3D_layer(Sub5921, 1, 2, 1,[[[[[0.6845, 0.1747, 0.0889], [0.6468, 0.4555, 0.2436]]], [[[0.9962, 0.0608, 0.2049], [0.7717, 0.6217, 0.8154]]]]],[0, 0, 0], 1, 1, 5, false, 1, 1, 1, Con25781), 
LRes59513 = reshape_layer(Con25781, [3, 1, 3], Res59513), 
LRes27698 = reshape_layer(Res59513, [3, 3], Res27698), 
LFla77667 = flatten_layer(Res27698, Fla77667), 
LSub38732 = subtract_layer([[0.4012, 0.9991]], [[0.1401, 0.7403]], Sub38732), 
LCon53460 = concatenate_layer([Sub38732,[[0.5885, 0.2577, 0.6669, 0.7819, 0.2177, 0.9168, 0.2283]]], 1, Con53460), 
LAdd28827 = add_layer([Fla77667,Con53460], Add28827), 
LMin81045 = minimum_layer([Con99640,Add28827], Min81045), 
LRes43160 = reshape_layer(Min81045, [9, 1], Res43160), 
LMax8646 = max_pool1D_layer(Res43160, 3, 9, true, Max8646), 
exec_layers([LAdd6977,LRes60639,LFla39208,LCon99640,LSub5921,LCon25781,LRes59513,LRes27698,LFla77667,LSub38732,LCon53460,LAdd28827,LMin81045,LRes43160,LMax8646],["Add6977","Res60639","Fla39208","Con99640","Sub5921","Con25781","Res59513","Res27698","Fla77667","Sub38732","Con53460","Add28827","Min81045","Res43160","Max8646"],Max8646,"Max8646")

Actual (Unparsed): [[[1.2126000]]]

Expected (Unparsed): [[[1.2126000000000001]]]

Actual:   [[[1.2126]]]

Expected: [[[1.2127]]]