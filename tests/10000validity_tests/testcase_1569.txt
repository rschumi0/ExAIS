import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Per80457 = tf.keras.layers.Input(shape=([1, 3]))
in0Fla21103 = tf.keras.layers.Input(shape=([4]))
in0Con70337 = tf.keras.layers.Input(shape=([4, 1]))
in0Mul52005 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul52005 = tf.keras.layers.Input(shape=([2, 2]))

Per80457 = keras.layers.Permute((2,1), name = 'Per80457',)(in0Per80457)
Lay30019 = keras.layers.LayerNormalization(axis=1, epsilon=1.8952818371361453, name = 'Lay30019', )(Per80457)
Res49201 = keras.layers.Reshape((3, 1, 1), name = 'Res49201', )(Lay30019)
Res17759 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res17759', )(Res49201)
Con80141 = keras.layers.Conv3D(2, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con80141', )(Res17759)
Res70632 = keras.layers.Reshape((3, 1, 2), name = 'Res70632', )(Con80141)
Res32867 = keras.layers.Reshape((3, 2), name = 'Res32867', )(Res70632)
Zer60142 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer60142', )(Res32867)
Fla21103 = keras.layers.Flatten(name = 'Fla21103', )(in0Fla21103)
Res81841 = keras.layers.Reshape((4, 1), name = 'Res81841', )(Fla21103)
Con70337 = keras.layers.Concatenate(axis=2, name = 'Con70337', )([Res81841,in0Con70337])
Mul52005 = keras.layers.Multiply(name = 'Mul52005', )([in0Mul52005,in1Mul52005])
Zer46791 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer46791', )(Mul52005)
Max57412 = keras.layers.Maximum(name = 'Max57412', )([Con70337,Zer46791])
Sub62697 = keras.layers.Subtract(name = 'Sub62697', )([Zer60142,Max57412])
model = tf.keras.models.Model(inputs=[in0Per80457,in0Fla21103,in0Con70337,in0Mul52005,in1Mul52005], outputs=Sub62697)
w = model.get_layer('Con80141').get_weights() 
w[0] = np.array([[[[[0.5877, 0.9247]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con80141').set_weights(w) 
in0Per80457 = tf.constant([[[1.8222, 1.0637, 1.7893]]])
in0Fla21103 = tf.constant([[1.5362, 1.4012, 1.3722, 1.5483]])
in0Con70337 = tf.constant([[[0.0505], [0.6061], [0.5587], [0.3982]]])
in0Mul52005 = tf.constant([[[0.7024, 0.6055], [0.2191, 0.8807]]])
in1Mul52005 = tf.constant([[[0.8301, 0.63], [0.886, 0.9454]]])
print (np.array2string(model.predict([in0Per80457,in0Fla21103,in0Con70337,in0Mul52005,in1Mul52005],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub62697.png')

LPer80457 = permute_layer([[[1.8222, 1.0637, 1.7893]]], 2,1, Per80457), 
LLay30019 = layer_normalization_layer(Per80457, 1, 1.8952818371361453, Lay30019), 
LRes49201 = reshape_layer(Lay30019, [3, 1, 1], Res49201), 
LRes17759 = reshape_layer(Res49201, [3, 1, 1, 1], Res17759), 
LCon80141 = conv3D_layer(Res17759, 1, 1, 1,[[[[[0.5877, 0.9247]]]]],[0, 0], 1, 1, 1, true, 1, 1, 1, Con80141), 
LRes70632 = reshape_layer(Con80141, [3, 1, 2], Res70632), 
LRes32867 = reshape_layer(Res70632, [3, 2], Res32867), 
LZer60142 = zero_padding1D_layer(Res32867, 1, 0, Zer60142), 
LFla21103 = flatten_layer([[1.5362, 1.4012, 1.3722, 1.5483]], Fla21103), 
LRes81841 = reshape_layer(Fla21103, [4, 1], Res81841), 
LCon70337 = concatenate_layer([Res81841,[[[0.0505], [0.6061], [0.5587], [0.3982]]]], 2, Con70337), 
LMul52005 = multiply_layer([[[[0.7024, 0.6055], [0.2191, 0.8807]]], [[[0.8301, 0.63], [0.886, 0.9454]]]], Mul52005), 
LZer46791 = zero_padding1D_layer(Mul52005, 2, 0, Zer46791), 
LMax57412 = maximum_layer([Con70337,Zer46791], Max57412), 
LSub62697 = subtract_layer(Zer60142,Max57412, Sub62697), 
exec_layers([LPer80457,LLay30019,LRes49201,LRes17759,LCon80141,LRes70632,LRes32867,LZer60142,LFla21103,LRes81841,LCon70337,LMul52005,LZer46791,LMax57412,LSub62697],["Per80457","Lay30019","Res49201","Res17759","Con80141","Res70632","Res32867","Zer60142","Fla21103","Res81841","Con70337","Mul52005","Zer46791","Max57412","Sub62697"],Sub62697,"Sub62697")

Actual (Unparsed): [[[-1.5362000, -0.0505000], [-1.2920589, -0.4343749], [-1.5768707, -0.8807334], [-1.4527705, -0.6823055]]]

Expected (Unparsed): [[[-1.5362,-0.0505],[-1.29205883266257,-0.4343749065221685],[-1.5768707182783421,-0.880733372795615],[-1.452770449059088,-0.6823055006822166]]]

Actual:   [[[-1.5362, -0.0505], [-1.292, -0.4343], [-1.5768, -0.8807], [-1.4527, -0.6823]]]

Expected: [[[-1.5362, -0.0505], [-1.292, -0.4343], [-1.5768, -0.8807], [-1.4527, -0.6823]]]