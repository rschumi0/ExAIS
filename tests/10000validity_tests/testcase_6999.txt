import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave96616 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Ave96616 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))

Ave96616 = keras.layers.Average(name = 'Ave96616', )([in0Ave96616,in1Ave96616])
Res73490 = keras.layers.Reshape((1, 2, 4), name = 'Res73490', )(Ave96616)
Res2761 = keras.layers.Reshape((1, 8), name = 'Res2761', )(Res73490)
Fla463 = keras.layers.Flatten(name = 'Fla463', )(Res2761)
Res97382 = keras.layers.Reshape((8, 1), name = 'Res97382', )(Fla463)
Res13543 = keras.layers.Reshape((8, 1, 1), name = 'Res13543', )(Res97382)
Res125 = keras.layers.Reshape((8, 1, 1, 1), name = 'Res125', )(Res13543)
Zer30358 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer30358', )(Res125)
Res52101 = keras.layers.Reshape((10, 3, 3), name = 'Res52101', )(Zer30358)
Res71938 = keras.layers.Reshape((10, 9), name = 'Res71938', )(Res52101)
Per3892 = keras.layers.Permute((1,2), name = 'Per3892',)(Res71938)
model = tf.keras.models.Model(inputs=[in0Ave96616,in1Ave96616], outputs=Per3892)
in0Ave96616 = tf.constant([[[[[0.1598, 0.5371], [0.6936, 0.924]], [[0.0806, 0.2164], [0.7058, 0.9919]]]]])
in1Ave96616 = tf.constant([[[[[0.9017, 0.5925], [0.2215, 0.6267]], [[0.2572, 0.0147], [0.2341, 0.8099]]]]])
print (np.array2string(model.predict([in0Ave96616,in1Ave96616],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Per3892.png')

LAve96616 = average_layer([[[[[[0.1598, 0.5371], [0.6936, 0.924]], [[0.0806, 0.2164], [0.7058, 0.9919]]]]], [[[[[0.9017, 0.5925], [0.2215, 0.6267]], [[0.2572, 0.0147], [0.2341, 0.8099]]]]]], Ave96616), 
LRes73490 = reshape_layer(Ave96616, [1, 2, 4], Res73490), 
LRes2761 = reshape_layer(Res73490, [1, 8], Res2761), 
LFla463 = flatten_layer(Res2761, Fla463), 
LRes97382 = reshape_layer(Fla463, [8, 1], Res97382), 
LRes13543 = reshape_layer(Res97382, [8, 1, 1], Res13543), 
LRes125 = reshape_layer(Res13543, [8, 1, 1, 1], Res125), 
LZer30358 = zero_padding3D_layer(Res125, 1, 1, 1, 1, 1, 1, Zer30358), 
LRes52101 = reshape_layer(Zer30358, [10, 3, 3], Res52101), 
LRes71938 = reshape_layer(Res52101, [10, 9], Res71938), 
LPer3892 = permute_layer(Res71938, 1,2, Per3892), 
exec_layers([LAve96616,LRes73490,LRes2761,LFla463,LRes97382,LRes13543,LRes125,LZer30358,LRes52101,LRes71938,LPer3892],["Ave96616","Res73490","Res2761","Fla463","Res97382","Res13543","Res125","Zer30358","Res52101","Res71938","Per3892"],Per3892,"Per3892")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.5307500, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.5648000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.4575500, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.7753500, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.1689000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.1155500, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.4699500, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.9009000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000]]]

Expected (Unparsed): [[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0.5307499999999999,0,0,0,0],[0,0,0,0,0.5648,0,0,0,0],[0,0,0,0,0.45755,0,0,0,0],[0,0,0,0,0.77535,0,0,0,0],[0,0,0,0,0.1689,0,0,0,0],[0,0,0,0,0.11555,0,0,0,0],[0,0,0,0,0.46995,0,0,0,0],[0,0,0,0,0.9009,0,0,0,0],[0,0,0,0,0,0,0,0,0]]]

Actual:   [[[0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0.5308, 0, 0, 0, 0], [0, 0, 0, 0, 0.5648, 0, 0, 0, 0], [0, 0, 0, 0, 0.4576, 0, 0, 0, 0], [0, 0, 0, 0, 0.7754, 0, 0, 0, 0], [0, 0, 0, 0, 0.1689, 0, 0, 0, 0], [0, 0, 0, 0, 0.1156, 0, 0, 0, 0], [0, 0, 0, 0, 0.47, 0, 0, 0, 0], [0, 0, 0, 0, 0.9009, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0]]]

Expected: [[[0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0.5308, 0, 0, 0, 0], [0, 0, 0, 0, 0.5648, 0, 0, 0, 0], [0, 0, 0, 0, 0.4576, 0, 0, 0, 0], [0, 0, 0, 0, 0.7754, 0, 0, 0, 0], [0, 0, 0, 0, 0.1689, 0, 0, 0, 0], [0, 0, 0, 0, 0.1156, 0, 0, 0, 0], [0, 0, 0, 0, 0.47, 0, 0, 0, 0], [0, 0, 0, 0, 0.9009, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0]]]