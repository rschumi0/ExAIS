import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con20476 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Fla44094 = tf.keras.layers.Input(shape=([3]))
in0Con62685 = tf.keras.layers.Input(shape=([1, 3, 3]))
in0Sep49826 = tf.keras.layers.Input(shape=([1, 2]))

Con20476 = keras.layers.Conv2D(3, (2, 2),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con20476', )(in0Con20476)
Res22203 = keras.layers.Reshape((1, 3), name = 'Res22203', )(Con20476)
Fla44094 = keras.layers.Flatten(name = 'Fla44094', )(in0Fla44094)
Res65017 = keras.layers.Reshape((1, 3), name = 'Res65017', )(Fla44094)
Mul83577 = keras.layers.Multiply(name = 'Mul83577', )([Res22203,Res65017])
Res67609 = keras.layers.Reshape((1, 3, 1), name = 'Res67609', )(Mul83577)
Con62685 = keras.layers.Concatenate(axis=3, name = 'Con62685', )([Res67609,in0Con62685])
Sep49826 = keras.layers.SeparableConv1D(2, (1),strides=(1), padding='same', name = 'Sep49826', )(in0Sep49826)
Glo3832 = keras.layers.GlobalAveragePooling1D(name = 'Glo3832', )(Sep49826)
Res16226 = keras.layers.Reshape((2, 1), name = 'Res16226', )(Glo3832)
Res98043 = keras.layers.Reshape((2, 1, 1), name = 'Res98043', )(Res16226)
Sep90139 = keras.layers.SeparableConv2D(4, (2, 1),strides=(1, 1), padding='valid', name = 'Sep90139', )(Res98043)
Zer36504 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer36504', )(Sep90139)
Mul41248 = keras.layers.Multiply(name = 'Mul41248', )([Con62685,Zer36504])
model = tf.keras.models.Model(inputs=[in0Con20476,in0Fla44094,in0Con62685,in0Sep49826], outputs=Mul41248)
w = model.get_layer('Con20476').get_weights() 
w[0] = np.array([[[[0.0311, 0.7779, 0.9743]], [[0.7805, 0.2529, 0.8115]]], [[[0.7096, 0.2719, 0.1411]], [[0.655, 0.1742, 0.7476]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con20476').set_weights(w) 
w = model.get_layer('Sep49826').get_weights() 
w[0] = np.array([[[0.6371], [0.4725]]])
w[1] = np.array([[[0.0647, 0.0898], [0.7465, 0.4563]]])
w[2] = np.array([0, 0])
model.get_layer('Sep49826').set_weights(w) 
w = model.get_layer('Sep90139').get_weights() 
w[0] = np.array([[[[0.4947]]], [[[0.4566]]]])
w[1] = np.array([[[[0.681, 0.2167, 0.6878, 0.3619]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep90139').set_weights(w) 
in0Con20476 = tf.constant([[[[0.0715], [0.5843]], [[0.0456], [0.5478]]]])
in0Fla44094 = tf.constant([[1.1887, 1.3966, 1.1038]])
in0Con62685 = tf.constant([[[[0.0562, 0.7772, 0.1251], [0.5314, 0.5444, 0.8951], [0.614, 0.2317, 0.9479]]]])
in0Sep49826 = tf.constant([[[0.5765, 0.0196]]])
print (np.array2string(model.predict([in0Con20476,in0Fla44094,in0Con62685,in0Sep49826],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul41248.png')

LCon20476 = conv2D_layer([[[[0.0715], [0.5843]], [[0.0456], [0.5478]]]], 2, 2,[[[[0.0311, 0.7779, 0.9743]], [[0.7805, 0.2529, 0.8115]]], [[[0.7096, 0.2719, 0.1411]], [[0.655, 0.1742, 0.7476]]]],[0, 0, 0], 1, 1, false, 1, 1, Con20476), 
LRes22203 = reshape_layer(Con20476, [1, 3], Res22203), 
LFla44094 = flatten_layer([[1.1887, 1.3966, 1.1038]], Fla44094), 
LRes65017 = reshape_layer(Fla44094, [1, 3], Res65017), 
LMul83577 = multiply_layer([Res22203,Res65017], Mul83577), 
LRes67609 = reshape_layer(Mul83577, [1, 3, 1], Res67609), 
LCon62685 = concatenate_layer([Res67609,[[[[0.0562, 0.7772, 0.1251], [0.5314, 0.5444, 0.8951], [0.614, 0.2317, 0.9479]]]]], 3, Con62685), 
LSep49826 = separable_conv1D_layer([[[0.5765, 0.0196]]], 1,[[[[0.6371], [0.4725]]],[[[0.0647, 0.0898], [0.7465, 0.4563]]]],[0, 0], 1, true, Sep49826), 
LGlo3832 = global_average_pooling1D_layer(Sep49826, Glo3832), 
LRes16226 = reshape_layer(Glo3832, [2, 1], Res16226), 
LRes98043 = reshape_layer(Res16226, [2, 1, 1], Res98043), 
LSep90139 = separable_conv2D_layer(Res98043, 2, 1,[[[[[0.4947]]], [[[0.4566]]]],[[[[0.681, 0.2167, 0.6878, 0.3619]]]]],[0, 0, 0, 0], 1, 1, false, Sep90139), 
LZer36504 = zero_padding2D_layer(Sep90139, 0, 0, 2, 0, Zer36504), 
LMul41248 = multiply_layer([Con62685,Zer36504], Mul41248), 
exec_layers([LCon20476,LRes22203,LFla44094,LRes65017,LMul83577,LRes67609,LCon62685,LSep49826,LGlo3832,LRes16226,LRes98043,LSep90139,LZer36504,LMul41248],["Con20476","Res22203","Fla44094","Res65017","Mul83577","Res67609","Con62685","Sep49826","Glo3832","Res16226","Res98043","Sep90139","Zer36504","Mul41248"],Mul41248,"Mul41248")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0232060, 0.0042797, 0.0051259, 0.0110341]]]]

Expected (Unparsed): [[[[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0],[0.0232059787829508,0.004279695248682316,0.005125942939145854,0.011034093722848784]]]]

Actual:   [[[[0, 0, 0, 0], [0, 0, 0, 0], [0.0233, 0.0043, 0.0052, 0.0111]]]]

Expected: [[[[0, 0, 0, 0], [0, 0, 0, 0], [0.0233, 0.0043, 0.0052, 0.0111]]]]