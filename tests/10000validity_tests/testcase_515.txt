import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Zer77893 = tf.keras.layers.Input(shape=([4, 1, 3]))
in0Sub83195 = tf.keras.layers.Input(shape=([3]))
in1Sub83195 = tf.keras.layers.Input(shape=([3]))
in0Ave81838 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Ave81838 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con42234 = tf.keras.layers.Input(shape=([6, 3, 2]))
in0LST45040 = tf.keras.layers.Input(shape=([3, 1]))
in0Con61250 = tf.keras.layers.Input(shape=([53]))

Zer77893 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer77893', )(in0Zer77893)
Sub83195 = keras.layers.Subtract(name = 'Sub83195', )([in0Sub83195,in1Sub83195])
Res86402 = keras.layers.Reshape((3, 1), name = 'Res86402', )(Sub83195)
Res23211 = keras.layers.Reshape((3, 1, 1), name = 'Res23211', )(Res86402)
Ave81838 = keras.layers.Average(name = 'Ave81838', )([in0Ave81838,in1Ave81838])
PRe61609 = keras.layers.PReLU(name = 'PRe61609', )(Ave81838)
Zer6779 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer6779', )(PRe61609)
Ave20917 = keras.layers.Average(name = 'Ave20917', )([Res23211,Zer6779])
Zer10937 = keras.layers.ZeroPadding2D(padding=((3, 0), (2, 0)), name = 'Zer10937', )(Ave20917)
Con42234 = keras.layers.Concatenate(axis=3, name = 'Con42234', )([Zer10937,in0Con42234])
Min78411 = keras.layers.Minimum(name = 'Min78411', )([Zer77893,Con42234])
Res66052 = keras.layers.Reshape((6, 9), name = 'Res66052', )(Min78411)
Fla40762 = keras.layers.Flatten(name = 'Fla40762', )(Res66052)
LST45040 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST45040', )(in0LST45040)
Thr46529 = keras.layers.ThresholdedReLU(theta=2.4980496574102355, name = 'Thr46529', )(LST45040)
Res27881 = keras.layers.Reshape((1, 1), name = 'Res27881', )(Thr46529)
Res21305 = keras.layers.Reshape((1, 1, 1), name = 'Res21305', )(Res27881)
Res63812 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res63812', )(Res21305)
Glo61924 = keras.layers.GlobalMaxPool3D(name = 'Glo61924', )(Res63812)
Con61250 = keras.layers.Concatenate(axis=1, name = 'Con61250', )([Glo61924,in0Con61250])
Min23871 = keras.layers.Minimum(name = 'Min23871', )([Fla40762,Con61250])
model = tf.keras.models.Model(inputs=[in0Zer77893,in0Sub83195,in1Sub83195,in0Ave81838,in1Ave81838,in0Con42234,in0LST45040,in0Con61250], outputs=Min23871)
w = model.get_layer('PRe61609').get_weights() 
w[0] = np.array([[[0.1804]], [[0.8106]]])
model.get_layer('PRe61609').set_weights(w) 
w = model.get_layer('LST45040').get_weights() 
w[0] = np.array([[1, 2, 1, 9]])
w[1] = np.array([[10, 3, 6, 7]])
w[2] = np.array([7, 3, 2, 6])
model.get_layer('LST45040').set_weights(w) 
in0Zer77893 = tf.constant([[[[1.3496, 1.4206, 1.3898]], [[1.0677, 1.2324, 1.3135]], [[1.4642, 1.1646, 1.8979]], [[1.7206, 1.5642, 1.1679]]]])
in0Sub83195 = tf.constant([[0.1417, 0.2581, 0.8651]])
in1Sub83195 = tf.constant([[0.2193, 0.6195, 0.7214]])
in0Ave81838 = tf.constant([[[[0.8498]], [[0.3765]]]])
in1Ave81838 = tf.constant([[[[0.5291]], [[0.4216]]]])
in0Con42234 = tf.constant([[[[0.4956, 0.7044], [0.8276, 0.488], [0.4154, 0.0662]], [[0.7634, 0.2575], [0.8596, 0.9616], [0.1693, 0.5734]], [[0.2891, 0.6604], [0.6777, 0.6531], [0.8644, 0.8019]], [[0.4394, 0.2595], [0.8814, 0.4676], [0.5141, 0.5275]], [[0.2008, 0.4527], [0.5741, 0.9934], [0.9038, 0.5456]], [[0.0829, 0.7602], [0.5598, 0.2262], [0.4718, 0.6618]]]])
in0LST45040 = tf.constant([[[3], [10], [3]]])
in0Con61250 = tf.constant([[0.0003, 0.8201, 0.4793, 0.6095, 0.6876, 0.9822, 0.0981, 0.1478, 0.8583, 0.3062, 0.9332, 0.4276, 0.3919, 0.2052, 0.272, 0.4815, 0.3689, 0.7229, 0.9759, 0.165, 0.1551, 0.5153, 0.8906, 0.9167, 0.3609, 0.7246, 0.1901, 0.4024, 0.5675, 0.996, 0.477, 0.6163, 0.3979, 0.6734, 0.9185, 0.1981, 0.9835, 0.0338, 0.4339, 0.4335, 0.1251, 0.2711, 0.9627, 0.6511, 0.4812, 0.8247, 0.144, 0.501, 0.9288, 0.5642, 0.3138, 0.9079, 0.8386]])
print (np.array2string(model.predict([in0Zer77893,in0Sub83195,in1Sub83195,in0Ave81838,in1Ave81838,in0Con42234,in0LST45040,in0Con61250],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min23871.png')

LZer77893 = zero_padding2D_layer([[[[1.3496, 1.4206, 1.3898]], [[1.0677, 1.2324, 1.3135]], [[1.4642, 1.1646, 1.8979]], [[1.7206, 1.5642, 1.1679]]]], 1, 1, 1, 1, Zer77893), 
LSub83195 = subtract_layer([[0.1417, 0.2581, 0.8651]], [[0.2193, 0.6195, 0.7214]], Sub83195), 
LRes86402 = reshape_layer(Sub83195, [3, 1], Res86402), 
LRes23211 = reshape_layer(Res86402, [3, 1, 1], Res23211), 
LAve81838 = average_layer([[[[[0.8498]], [[0.3765]]]], [[[[0.5291]], [[0.4216]]]]], Ave81838), 
LPRe61609 = prelu_layer(Ave81838, [[[0.1804]], [[0.8106]]], PRe61609), 
LZer6779 = zero_padding2D_layer(PRe61609, 1, 0, 0, 0, Zer6779), 
LAve20917 = average_layer([Res23211,Zer6779], Ave20917), 
LZer10937 = zero_padding2D_layer(Ave20917, 3, 0, 2, 0, Zer10937), 
LCon42234 = concatenate_layer([Zer10937,[[[[0.4956, 0.7044], [0.8276, 0.488], [0.4154, 0.0662]], [[0.7634, 0.2575], [0.8596, 0.9616], [0.1693, 0.5734]], [[0.2891, 0.6604], [0.6777, 0.6531], [0.8644, 0.8019]], [[0.4394, 0.2595], [0.8814, 0.4676], [0.5141, 0.5275]], [[0.2008, 0.4527], [0.5741, 0.9934], [0.9038, 0.5456]], [[0.0829, 0.7602], [0.5598, 0.2262], [0.4718, 0.6618]]]]], 3, Con42234), 
LMin78411 = minimum_layer([Zer77893,Con42234], Min78411), 
LRes66052 = reshape_layer(Min78411, [6, 9], Res66052), 
LFla40762 = flatten_layer(Res66052, Fla40762), 
LLST45040 = lstm_layer([[[3], [10], [3]]],[[1, 2, 1, 9]],[[10, 3, 6, 7]],[7, 3, 2, 6], LST45040), 
LThr46529 = thresholded_relu_layer(LST45040, 2.4980496574102355, Thr46529), 
LRes27881 = reshape_layer(Thr46529, [1, 1], Res27881), 
LRes21305 = reshape_layer(Res27881, [1, 1, 1], Res21305), 
LRes63812 = reshape_layer(Res21305, [1, 1, 1, 1], Res63812), 
LGlo61924 = global_max_pool3D_layer(Res63812, Glo61924), 
LCon61250 = concatenate_layer([Glo61924,[[0.0003, 0.8201, 0.4793, 0.6095, 0.6876, 0.9822, 0.0981, 0.1478, 0.8583, 0.3062, 0.9332, 0.4276, 0.3919, 0.2052, 0.272, 0.4815, 0.3689, 0.7229, 0.9759, 0.165, 0.1551, 0.5153, 0.8906, 0.9167, 0.3609, 0.7246, 0.1901, 0.4024, 0.5675, 0.996, 0.477, 0.6163, 0.3979, 0.6734, 0.9185, 0.1981, 0.9835, 0.0338, 0.4339, 0.4335, 0.1251, 0.2711, 0.9627, 0.6511, 0.4812, 0.8247, 0.144, 0.501, 0.9288, 0.5642, 0.3138, 0.9079, 0.8386]]], 1, Con61250), 
LMin23871 = minimum_layer([Fla40762,Con61250], Min23871), 
exec_layers([LZer77893,LSub83195,LRes86402,LRes23211,LAve81838,LPRe61609,LZer6779,LAve20917,LZer10937,LCon42234,LMin78411,LRes66052,LFla40762,LLST45040,LThr46529,LRes27881,LRes21305,LRes63812,LGlo61924,LCon61250,LMin23871],["Zer77893","Sub83195","Res86402","Res23211","Ave81838","PRe61609","Zer6779","Ave20917","Zer10937","Con42234","Min78411","Res66052","Fla40762","LST45040","Thr46529","Res27881","Res21305","Res63812","Glo61924","Con61250","Min23871"],Min23871,"Min23871")

Actual (Unparsed): [[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.3919000, 0.2052000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.5153000, 0.6531000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.4770000, 0.4676000, -0.0388000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.4335000, 0.1251000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000]]

Expected (Unparsed): [[0,0,0,0,0,0,0,0,0,0,0,0,0,0.3919,0.2052,0,0,0,0,0,0,0,0.5153,0.6531,0,0,0,0,0,0,0,0.477,0.4676,-0.0388,0,0,0,0,0,0,0.4335,0.1251,0,0,0,0,0,0,0,0,0,0,0,0]]

Actual:   [[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.3919, 0.2052, 0, 0, 0, 0, 0, 0, 0, 0.5153, 0.6531, 0, 0, 0, 0, 0, 0, 0, 0.477, 0.4676, -0.0388, 0, 0, 0, 0, 0, 0, 0.4335, 0.1251, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]

Expected: [[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.3919, 0.2052, 0, 0, 0, 0, 0, 0, 0, 0.5153, 0.6531, 0, 0, 0, 0, 0, 0, 0, 0.477, 0.4676, -0.0388, 0, 0, 0, 0, 0, 0, 0.4335, 0.1251, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]