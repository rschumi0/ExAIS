import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max16715 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Max16715 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Mul28938 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Mul28938 = tf.keras.layers.Input(shape=([1, 2, 2]))

Max16715 = keras.layers.Maximum(name = 'Max16715', )([in0Max16715,in1Max16715])
Res14454 = keras.layers.Reshape((1, 1), name = 'Res14454', )(Max16715)
Zer28348 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer28348', )(Res14454)
Mul28938 = keras.layers.Multiply(name = 'Mul28938', )([in0Mul28938,in1Mul28938])
Res87809 = keras.layers.Reshape((1, 4), name = 'Res87809', )(Mul28938)
Per94045 = keras.layers.Permute((2,1), name = 'Per94045',)(Res87809)
Ave63370 = keras.layers.Average(name = 'Ave63370', )([Zer28348,Per94045])
model = tf.keras.models.Model(inputs=[in0Max16715,in1Max16715,in0Mul28938,in1Mul28938], outputs=Ave63370)
in0Max16715 = tf.constant([[[[0.848]]]])
in1Max16715 = tf.constant([[[[0.4983]]]])
in0Mul28938 = tf.constant([[[[0.0502, 0.8178], [0.5972, 0.3264]]]])
in1Mul28938 = tf.constant([[[[0.3656, 0.9652], [0.4642, 0.6205]]]])
print (np.array2string(model.predict([in0Max16715,in1Max16715,in0Mul28938,in1Mul28938],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave63370.png')

LMax16715 = maximum_layer([[[[[0.848]]]], [[[[0.4983]]]]], Max16715), 
LRes14454 = reshape_layer(Max16715, [1, 1], Res14454), 
LZer28348 = zero_padding1D_layer(Res14454, 3, 0, Zer28348), 
LMul28938 = multiply_layer([[[[[0.0502, 0.8178], [0.5972, 0.3264]]]], [[[[0.3656, 0.9652], [0.4642, 0.6205]]]]], Mul28938), 
LRes87809 = reshape_layer(Mul28938, [1, 4], Res87809), 
LPer94045 = permute_layer(Res87809, 2,1, Per94045), 
LAve63370 = average_layer([Zer28348,Per94045], Ave63370), 
exec_layers([LMax16715,LRes14454,LZer28348,LMul28938,LRes87809,LPer94045,LAve63370],["Max16715","Res14454","Zer28348","Mul28938","Res87809","Per94045","Ave63370"],Ave63370,"Ave63370")

Actual (Unparsed): [[[0.0091766], [0.3946703], [0.1386101], [0.5252656]]]

Expected (Unparsed): [[[0.00917656],[0.39467028],[0.13861012],[0.5252656]]]

Actual:   [[[0.0092], [0.3947], [0.1387], [0.5253]]]

Expected: [[[0.0092], [0.3947], [0.1387], [0.5253]]]