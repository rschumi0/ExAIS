import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min91256 = tf.keras.layers.Input(shape=([2, 1]))
in1Min91256 = tf.keras.layers.Input(shape=([2, 1]))
in0Con65850 = tf.keras.layers.Input(shape=([4, 1]))
in0Ave75563 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave75563 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Dot67384 = tf.keras.layers.Input(shape=([3]))
in1Dot67384 = tf.keras.layers.Input(shape=([3]))
in0Con39410 = tf.keras.layers.Input(shape=([3]))
in0Con15708 = tf.keras.layers.Input(shape=([4, 1]))
in0Dot88851 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot88851 = tf.keras.layers.Input(shape=([2, 3]))

Min91256 = keras.layers.Minimum(name = 'Min91256', )([in0Min91256,in1Min91256])
Zer5286 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer5286', )(Min91256)
Con65850 = keras.layers.Concatenate(axis=2, name = 'Con65850', )([Zer5286,in0Con65850])
Ave75563 = keras.layers.Average(name = 'Ave75563', )([in0Ave75563,in1Ave75563])
Res67671 = keras.layers.Reshape((2, 2), name = 'Res67671', )(Ave75563)
Fla23709 = keras.layers.Flatten(name = 'Fla23709', )(Res67671)
Dot67384 = keras.layers.Dot(axes=(1, 1), name = 'Dot67384', )([in0Dot67384,in1Dot67384])
Con39410 = keras.layers.Concatenate(axis=1, name = 'Con39410', )([Dot67384,in0Con39410])
Sub2554 = keras.layers.Subtract(name = 'Sub2554', )([Fla23709,Con39410])
Res10271 = keras.layers.Reshape((4, 1), name = 'Res10271', )(Sub2554)
Con15708 = keras.layers.Concatenate(axis=2, name = 'Con15708', )([Res10271,in0Con15708])
Dot88851 = keras.layers.Dot(axes=(2, 2), name = 'Dot88851', )([in0Dot88851,in1Dot88851])
Zer45156 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer45156', )(Dot88851)
Min7261 = keras.layers.Minimum(name = 'Min7261', )([Con15708,Zer45156])
Ave39892 = keras.layers.Average(name = 'Ave39892', )([Con65850,Min7261])
model = tf.keras.models.Model(inputs=[in0Min91256,in1Min91256,in0Con65850,in0Ave75563,in1Ave75563,in0Dot67384,in1Dot67384,in0Con39410,in0Con15708,in0Dot88851,in1Dot88851], outputs=Ave39892)
in0Min91256 = tf.constant([[[0.6437], [0.351]]])
in1Min91256 = tf.constant([[[0.1877], [0.1524]]])
in0Con65850 = tf.constant([[[0.3565], [0.9536], [0.4283], [0.6613]]])
in0Ave75563 = tf.constant([[[[0.2266], [0.7665]], [[0.7939], [0.228]]]])
in1Ave75563 = tf.constant([[[[0.154], [0.6705]], [[0.7558], [0.794]]]])
in0Dot67384 = tf.constant([[0.1141, 0.6089, 0.1586]])
in1Dot67384 = tf.constant([[0.2519, 0.2525, 0.3285]])
in0Con39410 = tf.constant([[0.0978, 0.9952, 0.6398]])
in0Con15708 = tf.constant([[[0.6522], [0.2356], [0.8721], [0.4112]]])
in0Dot88851 = tf.constant([[[0.8505, 0.8332, 0.9254], [0.1864, 0.5312, 0.2711]]])
in1Dot88851 = tf.constant([[[0.5045, 0.7935, 0.549], [0.58, 0.1537, 0.0687]]])
print (np.array2string(model.predict([in0Min91256,in1Min91256,in0Con65850,in0Ave75563,in1Ave75563,in0Dot67384,in1Dot67384,in0Con39410,in0Con15708,in0Dot88851,in1Dot88851],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave39892.png')

LMin91256 = minimum_layer([[[[0.6437], [0.351]]], [[[0.1877], [0.1524]]]], Min91256), 
LZer5286 = zero_padding1D_layer(Min91256, 2, 0, Zer5286), 
LCon65850 = concatenate_layer([Zer5286,[[[0.3565], [0.9536], [0.4283], [0.6613]]]], 2, Con65850), 
LAve75563 = average_layer([[[[[0.2266], [0.7665]], [[0.7939], [0.228]]]], [[[[0.154], [0.6705]], [[0.7558], [0.794]]]]], Ave75563), 
LRes67671 = reshape_layer(Ave75563, [2, 2], Res67671), 
LFla23709 = flatten_layer(Res67671, Fla23709), 
LDot67384 = dot_layer([[0.1141, 0.6089, 0.1586]], [[0.2519, 0.2525, 0.3285]], 1, 1, Dot67384), 
LCon39410 = concatenate_layer([Dot67384,[[0.0978, 0.9952, 0.6398]]], 1, Con39410), 
LSub2554 = subtract_layer(Fla23709,Con39410, Sub2554), 
LRes10271 = reshape_layer(Sub2554, [4, 1], Res10271), 
LCon15708 = concatenate_layer([Res10271,[[[0.6522], [0.2356], [0.8721], [0.4112]]]], 2, Con15708), 
LDot88851 = dot_layer([[[0.8505, 0.8332, 0.9254], [0.1864, 0.5312, 0.2711]]], [[[0.5045, 0.7935, 0.549], [0.58, 0.1537, 0.0687]]], 2, 2, Dot88851), 
LZer45156 = zero_padding1D_layer(Dot88851, 2, 0, Zer45156), 
LMin7261 = minimum_layer([Con15708,Zer45156], Min7261), 
LAve39892 = average_layer([Con65850,Min7261], Ave39892), 
exec_layers([LMin91256,LZer5286,LCon65850,LAve75563,LRes67671,LFla23709,LDot67384,LCon39410,LSub2554,LRes10271,LCon15708,LDot88851,LZer45156,LMin7261,LAve39892],["Min91256","Zer5286","Con65850","Ave75563","Res67671","Fla23709","Dot67384","Con39410","Sub2554","Res10271","Con15708","Dot88851","Zer45156","Min7261","Ave39892"],Ave39892,"Ave39892")

Actual (Unparsed): [[[-0.0221446, 0.1782500], [0.0000000, 0.4768000], [-0.0163250, 0.5566139], [0.0118000, 0.4348410]]]

Expected (Unparsed): [[[-0.02214456999999999,0.17825],[0,0.4768],[-0.016324999999999965,0.55661391],[0.011799999999999991,0.434841005]]]

Actual:   [[[-0.0221, 0.1783], [0, 0.4768], [-0.0163, 0.5567], [0.0118, 0.4349]]]

Expected: [[[-0.0221, 0.1783], [0, 0.4768], [-0.0163, 0.5567], [0.0118, 0.4349]]]