import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Cro43210 = tf.keras.layers.Input(shape=([1, 3, 1]))
in0Con61724 = tf.keras.layers.Input(shape=([2]))
in0Loc62712 = tf.keras.layers.Input(shape=([2, 2]))
in0Con53566 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

Cro43210 = keras.layers.Cropping2D(cropping=((0, 0), (1, 1)), name = 'Cro43210', )(in0Cro43210)
Res44800 = keras.layers.Reshape((1, 1), name = 'Res44800', )(Cro43210)
Con97742 = keras.layers.Conv1D(2, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con97742', )(Res44800)
Fla25971 = keras.layers.Flatten(name = 'Fla25971', )(Con97742)
Con61724 = keras.layers.Concatenate(axis=1, name = 'Con61724', )([Fla25971,in0Con61724])
Loc62712 = keras.layers.LocallyConnected1D(2, (1),strides=(1), name = 'Loc62712', )(in0Loc62712)
Fla23052 = keras.layers.Flatten(name = 'Fla23052', )(Loc62712)
Con53566 = keras.layers.Conv3DTranspose(4, (1, 1, 1),strides=(1, 7, 1), padding='same', name = 'Con53566', )(in0Con53566)
Res29147 = keras.layers.Reshape((2, 14, 4), name = 'Res29147', )(Con53566)
Glo37838 = keras.layers.GlobalMaxPool2D(name = 'Glo37838', )(Res29147)
Add81835 = keras.layers.Add(name = 'Add81835', )([Fla23052,Glo37838])
Mul90226 = keras.layers.Multiply(name = 'Mul90226', )([Con61724,Add81835])
model = tf.keras.models.Model(inputs=[in0Cro43210,in0Con61724,in0Loc62712,in0Con53566], outputs=Mul90226)
w = model.get_layer('Con97742').get_weights() 
w[0] = np.array([[[0.8195, 0.2578]]])
w[1] = np.array([0, 0])
model.get_layer('Con97742').set_weights(w) 
w = model.get_layer('Loc62712').get_weights() 
w[0] = np.array([[[0.3095, 0.6012], [0.7771, 0.9577]], [[0.6909, 0.8108], [0.7008, 0.5401]]])
w[1] = np.array([[0, 0], [0, 0]])
model.get_layer('Loc62712').set_weights(w) 
w = model.get_layer('Con53566').get_weights() 
w[0] = np.array([[[[[0.1215, 0.6871], [0.3545, 0.1836], [0.5064, 0.837], [0.8527, 0.6558]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con53566').set_weights(w) 
in0Cro43210 = tf.constant([[[[1.657], [1.7203], [1.3356]]]])
in0Con61724 = tf.constant([[0.9677, 0.6949]])
in0Loc62712 = tf.constant([[[0.5027, 0.9628], [0.0504, 0.7887]]])
in0Con53566 = tf.constant([[[[[0.3473, 0.1514]], [[0.4263, 0.5261]]], [[[0.5529, 0.4522]], [[0.3749, 0.7615]]]]])
print (np.array2string(model.predict([in0Cro43210,in0Con61724,in0Loc62712,in0Con53566],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul90226.png')

LCro43210 = cropping2D_layer([[[[1.657], [1.7203], [1.3356]]]], 0, 0, 1, 1, Cro43210), 
LRes44800 = reshape_layer(Cro43210, [1, 1], Res44800), 
LCon97742 = conv1D_layer(Res44800, 1,[[[0.8195, 0.2578]]],[0, 0], 1, true, 1, Con97742), 
LFla25971 = flatten_layer(Con97742, Fla25971), 
LCon61724 = concatenate_layer([Fla25971,[[0.9677, 0.6949]]], 1, Con61724), 
LLoc62712 = locally_connected1D_layer([[[0.5027, 0.9628], [0.0504, 0.7887]]], 1,[[[0.3095, 0.6012], [0.7771, 0.9577]], [[0.6909, 0.8108], [0.7008, 0.5401]]],[[0, 0], [0, 0]], 1, Loc62712), 
LFla23052 = flatten_layer(Loc62712, Fla23052), 
LCon53566 = conv3D_transpose_layer([[[[[0.3473, 0.1514]], [[0.4263, 0.5261]]], [[[0.5529, 0.4522]], [[0.3749, 0.7615]]]]], 1, 1, 1,[[[[[0.1215, 0.6871], [0.3545, 0.1836], [0.5064, 0.837], [0.8527, 0.6558]]]]],[0, 0, 0, 0], 1, 7, 1, true, Con53566), 
LRes29147 = reshape_layer(Con53566, [2, 14, 4], Res29147), 
LGlo37838 = global_max_pool2D_layer(Res29147, Glo37838), 
LAdd81835 = add_layer([Fla23052,Glo37838], Add81835), 
LMul90226 = multiply_layer([Con61724,Add81835], Mul90226), 
exec_layers([LCro43210,LRes44800,LCon97742,LFla25971,LCon61724,LLoc62712,LFla23052,LCon53566,LRes29147,LGlo37838,LAdd81835,LMul90226],["Cro43210","Res44800","Con97742","Fla25971","Con61724","Loc62712","Fla23052","Con53566","Res29147","Glo37838","Add81835","Mul90226"],Mul90226,"Mul90226")

Actual (Unparsed): [[2.0759865, 0.6667141, 1.3690702, 0.8935789]]

Expected (Unparsed): [[2.0759865397474004,0.6667140798586916,1.369070200086,0.893578942388]]

Actual:   [[2.076, 0.6668, 1.3691, 0.8936]]

Expected: [[2.076, 0.6668, 1.3691, 0.8936]]