import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul7573 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Mul7573 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Con54117 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0PRe20604 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Max2850 = tf.keras.layers.Input(shape=([1, 2]))
in1Max2850 = tf.keras.layers.Input(shape=([1, 2]))
in0Con73950 = tf.keras.layers.Input(shape=([1, 2, 1]))

Mul7573 = keras.layers.Multiply(name = 'Mul7573', )([in0Mul7573,in1Mul7573])
PRe99466 = keras.layers.PReLU(name = 'PRe99466', )(Mul7573)
Res32758 = keras.layers.Reshape((2, 2, 1), name = 'Res32758', )(PRe99466)
Con54117 = keras.layers.Concatenate(axis=3, name = 'Con54117', )([Res32758,in0Con54117])
PRe20604 = keras.layers.PReLU(name = 'PRe20604', input_shape=(1, 2, 2, 1))(in0PRe20604)
Res99645 = keras.layers.Reshape((1, 2, 2), name = 'Res99645', )(PRe20604)
Con66405 = keras.layers.Conv2DTranspose(3, (1, 2),strides=(1, 1), padding='same', name = 'Con66405', )(Res99645)
Con30135 = keras.layers.Conv2D(2, (1, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con30135', )(Con66405)
Mas44537 = keras.layers.Masking(mask_value=2, name = 'Mas44537', )(Con30135)
Max2850 = keras.layers.Maximum(name = 'Max2850', )([in0Max2850,in1Max2850])
Res47510 = keras.layers.Reshape((1, 2, 1), name = 'Res47510', )(Max2850)
Ave33144 = keras.layers.AveragePooling2D(pool_size=(1, 1), name = 'Ave33144', )(Res47510)
Con73950 = keras.layers.Concatenate(axis=3, name = 'Con73950', )([Ave33144,in0Con73950])
Sub55966 = keras.layers.Subtract(name = 'Sub55966', )([Mas44537,Con73950])
Zer50505 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer50505', )(Sub55966)
Ave5980 = keras.layers.Average(name = 'Ave5980', )([Con54117,Zer50505])
model = tf.keras.models.Model(inputs=[in0Mul7573,in1Mul7573,in0Con54117,in0PRe20604,in0Max2850,in1Max2850,in0Con73950], outputs=Ave5980)
w = model.get_layer('PRe99466').get_weights() 
w[0] = np.array([[[[0.5833]], [[0.9469]]], [[[0.4687]], [[0.4881]]]])
model.get_layer('PRe99466').set_weights(w) 
w = model.get_layer('PRe20604').get_weights() 
w[0] = np.array([[[[0.5636], [0.8358]], [[0.1721], [0.1732]]]])
model.get_layer('PRe20604').set_weights(w) 
w = model.get_layer('Con66405').get_weights() 
w[0] = np.array([[[[0.4092, 0.2219], [0.8479, 0.8716], [0.1069, 0.2547]], [[0.5942, 0.762], [0.9175, 0.9456], [0.1344, 0.3911]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con66405').set_weights(w) 
w = model.get_layer('Con30135').get_weights() 
w[0] = np.array([[[[0.6001, 0.5595], [0.0466, 0.5377], [0.6604, 0.908]]]])
w[1] = np.array([0, 0])
model.get_layer('Con30135').set_weights(w) 
in0Mul7573 = tf.constant([[[[[0.0355]], [[0.9405]]], [[[0.3497]], [[0.0977]]]]])
in1Mul7573 = tf.constant([[[[[0.3827]], [[0.9614]]], [[[0.4826]], [[0.8495]]]]])
in0Con54117 = tf.constant([[[[0.0316], [0.3725]], [[0.0513], [0.341]]]])
in0PRe20604 = tf.constant([[[[[0.9984], [0.7572]], [[0.0575], [0.6642]]]]])
in0Max2850 = tf.constant([[[0.0812, 0.8563]]])
in1Max2850 = tf.constant([[[0.5509, 0.2222]]])
in0Con73950 = tf.constant([[[[0.8741], [0.9718]]]])
print (np.array2string(model.predict([in0Mul7573,in1Mul7573,in0Con54117,in0PRe20604,in0Max2850,in1Max2850,in0Con73950],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave5980.png')

LMul7573 = multiply_layer([[[[[[0.0355]], [[0.9405]]], [[[0.3497]], [[0.0977]]]]], [[[[[0.3827]], [[0.9614]]], [[[0.4826]], [[0.8495]]]]]], Mul7573), 
LPRe99466 = prelu_layer(Mul7573, [[[[0.5833]], [[0.9469]]], [[[0.4687]], [[0.4881]]]], PRe99466), 
LRes32758 = reshape_layer(PRe99466, [2, 2, 1], Res32758), 
LCon54117 = concatenate_layer([Res32758,[[[[0.0316], [0.3725]], [[0.0513], [0.341]]]]], 3, Con54117), 
LPRe20604 = prelu_layer([[[[[0.9984], [0.7572]], [[0.0575], [0.6642]]]]], [[[[0.5636], [0.8358]], [[0.1721], [0.1732]]]], PRe20604), 
LRes99645 = reshape_layer(PRe20604, [1, 2, 2], Res99645), 
LCon66405 = conv2D_transpose_layer(Res99645, 1, 2,[[[[0.4092, 0.2219], [0.8479, 0.8716], [0.1069, 0.2547]], [[0.5942, 0.762], [0.9175, 0.9456], [0.1344, 0.3911]]]],[0, 0, 0], 1, 1, true, Con66405), 
LCon30135 = conv2D_layer(Con66405, 1, 1,[[[[0.6001, 0.5595], [0.0466, 0.5377], [0.6604, 0.908]]]],[0, 0], 1, 1, false, 1, 1, Con30135), 
LMas44537 = masking_layer(Con30135, 2, Mas44537), 
LMax2850 = maximum_layer([[[[0.0812, 0.8563]]], [[[0.5509, 0.2222]]]], Max2850), 
LRes47510 = reshape_layer(Max2850, [1, 2, 1], Res47510), 
LAve33144 = average_pooling2D_layer(Res47510, 1, 1, Ave33144), 
LCon73950 = concatenate_layer([Ave33144,[[[[0.8741], [0.9718]]]]], 3, Con73950), 
LSub55966 = subtract_layer(Mas44537,Con73950, Sub55966), 
LZer50505 = zero_padding2D_layer(Sub55966, 1, 0, 0, 0, Zer50505), 
LAve5980 = average_layer([Con54117,Zer50505], Ave5980), 
exec_layers([LMul7573,LPRe99466,LRes32758,LCon54117,LPRe20604,LRes99645,LCon66405,LCon30135,LMas44537,LMax2850,LRes47510,LAve33144,LCon73950,LSub55966,LZer50505,LAve5980],["Mul7573","PRe99466","Res32758","Con54117","PRe20604","Res99645","Con66405","Con30135","Mas44537","Max2850","Res47510","Ave33144","Con73950","Sub55966","Zer50505","Ave5980"],Ave5980,"Ave5980")

Actual (Unparsed): [[[[0.0067929, 0.0158000], [0.4520983, 0.1862500]], [[0.1159576, 0.2909353], [0.2683954, 0.9422728]]]]

Expected (Unparsed): [[[[0.006792924999999999,0.0158],[0.45209835000000004,0.18625]],[[0.11595760786200002,0.290935348898],[0.2683953745639999,0.9422728214314998]]]]

Actual:   [[[[0.0068, 0.0158], [0.4521, 0.1863]], [[0.116, 0.291], [0.2684, 0.9423]]]]

Expected: [[[[0.0068, 0.0158], [0.4521, 0.1863]], [[0.116, 0.291], [0.2684, 0.9423]]]]