import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub10681 = tf.keras.layers.Input(shape=([3, 3, 2]))
in1Sub10681 = tf.keras.layers.Input(shape=([3, 3, 2]))
in0Glo12955 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con22493 = tf.keras.layers.Input(shape=([16]))

Sub10681 = keras.layers.Subtract(name = 'Sub10681', )([in0Sub10681,in1Sub10681])
Res6536 = keras.layers.Reshape((3, 6), name = 'Res6536', )(Sub10681)
Fla72702 = keras.layers.Flatten(name = 'Fla72702', )(Res6536)
Glo12955 = keras.layers.GlobalAveragePooling2D(name = 'Glo12955', )(in0Glo12955)
Con22493 = keras.layers.Concatenate(axis=1, name = 'Con22493', )([Glo12955,in0Con22493])
Max69107 = keras.layers.Maximum(name = 'Max69107', )([Fla72702,Con22493])
Res29573 = keras.layers.Reshape((18, 1), name = 'Res29573', )(Max69107)
Res53384 = keras.layers.Reshape((18, 1, 1), name = 'Res53384', )(Res29573)
Res20138 = keras.layers.Reshape((18, 1, 1, 1), name = 'Res20138', )(Res53384)
Con95945 = keras.layers.Conv3DTranspose(3, (5, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con95945', )(Res20138)
PRe77623 = keras.layers.PReLU(name = 'PRe77623', )(Con95945)
model = tf.keras.models.Model(inputs=[in0Sub10681,in1Sub10681,in0Glo12955,in0Con22493], outputs=PRe77623)
w = model.get_layer('Con95945').get_weights() 
w[0] = np.array([[[[[0.7418], [0.087], [0.8883]]]], [[[[0.2497], [0.5485], [0.914]]]], [[[[0.3642], [0.9408], [0.2076]]]], [[[[0.5541], [0.1049], [0.0793]]]], [[[[0.6817], [0.7473], [0.1195]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con95945').set_weights(w) 
w = model.get_layer('PRe77623').get_weights() 
w[0] = np.array([[[[0.709, 0.0999, 0.0995]]], [[[0.8034, 0.1049, 0.76]]], [[[0.0365, 0.7927, 0.0764]]], [[[0.7738, 0.6802, 0.7767]]], [[[0.2999, 0.0636, 0.7144]]], [[[0.3227, 0.5518, 0.5563]]], [[[0.6726, 0.9248, 0.7211]]], [[[0.8461, 0.9842, 0.4257]]], [[[0.5244, 0.2992, 0.5424]]], [[[0.6809, 0.913, 0.5613]]], [[[0.5207, 0.8362, 0.267]]], [[[0.6937, 0.6578, 0.8712]]], [[[0.6053, 0.7122, 0.2553]]], [[[0.1238, 0.2029, 0.1323]]], [[[0.6872, 0.358, 0.2065]]], [[[0.2341, 0.3093, 0.5607]]], [[[0.0645, 0.1524, 0.2723]]], [[[0.0619, 0.8474, 0.5703]]], [[[0.8931, 0.7612, 0.8237]]], [[[0.7475, 0.9197, 0.212]]], [[[0.9798, 0.8523, 0.2366]]], [[[0.0672, 0.5215, 0.0804]]]])
model.get_layer('PRe77623').set_weights(w) 
in0Sub10681 = tf.constant([[[[0.3339, 0.0817], [0.9869, 0.8117], [0.2664, 0.498]], [[0.4486, 0.368], [0.4405, 0.9415], [0.3777, 0.8683]], [[0.3703, 0.2533], [0.648, 0.2548], [0.9366, 0.653]]]])
in1Sub10681 = tf.constant([[[[0.8733, 0.8837], [0.3141, 0.6901], [0.8389, 0.2997]], [[0.8098, 0.6316], [0.3599, 0.0003], [0.4102, 0.6402]], [[0.6211, 0.9184], [0.3607, 0.6647], [0.7217, 0.6793]]]])
in0Glo12955 = tf.constant([[[[1.1533, 1.304]]]])
in0Con22493 = tf.constant([[0.8393, 0.2454, 0.2112, 0.7912, 0.5925, 0.0796, 0.2846, 0.2699, 0.3737, 0.2866, 0.0506, 0.4962, 0.7333, 0.9232, 0.1089, 0.1122]])
print (np.array2string(model.predict([in0Sub10681,in1Sub10681,in0Glo12955,in0Con22493],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='PRe77623.png')

LSub10681 = subtract_layer([[[[0.3339, 0.0817], [0.9869, 0.8117], [0.2664, 0.498]], [[0.4486, 0.368], [0.4405, 0.9415], [0.3777, 0.8683]], [[0.3703, 0.2533], [0.648, 0.2548], [0.9366, 0.653]]]], [[[[0.8733, 0.8837], [0.3141, 0.6901], [0.8389, 0.2997]], [[0.8098, 0.6316], [0.3599, 0.0003], [0.4102, 0.6402]], [[0.6211, 0.9184], [0.3607, 0.6647], [0.7217, 0.6793]]]], Sub10681), 
LRes6536 = reshape_layer(Sub10681, [3, 6], Res6536), 
LFla72702 = flatten_layer(Res6536, Fla72702), 
LGlo12955 = global_average_pooling2D_layer([[[[1.1533, 1.304]]]], Glo12955), 
LCon22493 = concatenate_layer([Glo12955,[[0.8393, 0.2454, 0.2112, 0.7912, 0.5925, 0.0796, 0.2846, 0.2699, 0.3737, 0.2866, 0.0506, 0.4962, 0.7333, 0.9232, 0.1089, 0.1122]]], 1, Con22493), 
LMax69107 = maximum_layer([Fla72702,Con22493], Max69107), 
LRes29573 = reshape_layer(Max69107, [18, 1], Res29573), 
LRes53384 = reshape_layer(Res29573, [18, 1, 1], Res53384), 
LRes20138 = reshape_layer(Res53384, [18, 1, 1, 1], Res20138), 
LCon95945 = conv3D_transpose_layer(Res20138, 5, 1, 1,[[[[[0.7418], [0.087], [0.8883]]]], [[[[0.2497], [0.5485], [0.914]]]], [[[[0.3642], [0.9408], [0.2076]]]], [[[[0.5541], [0.1049], [0.0793]]]], [[[[0.6817], [0.7473], [0.1195]]]]],[0, 0, 0], 1, 1, 1, false, Con95945), 
LPRe77623 = prelu_layer(Con95945, [[[[0.709, 0.0999, 0.0995]]], [[[0.8034, 0.1049, 0.76]]], [[[0.0365, 0.7927, 0.0764]]], [[[0.7738, 0.6802, 0.7767]]], [[[0.2999, 0.0636, 0.7144]]], [[[0.3227, 0.5518, 0.5563]]], [[[0.6726, 0.9248, 0.7211]]], [[[0.8461, 0.9842, 0.4257]]], [[[0.5244, 0.2992, 0.5424]]], [[[0.6809, 0.913, 0.5613]]], [[[0.5207, 0.8362, 0.267]]], [[[0.6937, 0.6578, 0.8712]]], [[[0.6053, 0.7122, 0.2553]]], [[[0.1238, 0.2029, 0.1323]]], [[[0.6872, 0.358, 0.2065]]], [[[0.2341, 0.3093, 0.5607]]], [[[0.0645, 0.1524, 0.2723]]], [[[0.0619, 0.8474, 0.5703]]], [[[0.8931, 0.7612, 0.8237]]], [[[0.7475, 0.9197, 0.212]]], [[[0.9798, 0.8523, 0.2366]]], [[[0.0672, 0.5215, 0.0804]]]], PRe77623), 
exec_layers([LSub10681,LRes6536,LFla72702,LGlo12955,LCon22493,LMax69107,LRes29573,LRes53384,LRes20138,LCon95945,LPRe77623],["Sub10681","Res6536","Fla72702","Glo12955","Con22493","Max69107","Res29573","Res53384","Res20138","Con95945","PRe77623"],PRe77623,"PRe77623")

Actual (Unparsed): [[[[[0.8555180, 0.1003371, 1.0244764]]], [[[1.2552862, 0.7460331, 2.2124595]]], [[[1.3682334, 1.8732878, 2.1768313]]], [[[1.5055713, 1.8294902, 1.3472761]]], [[[2.0323686, 1.9412404, 0.8273698]]], [[[2.0830164, 1.4780717, 1.1691893]]], [[[1.4221251, 1.3371690, 1.4130762]]], [[[0.7794647, 1.2818147, 0.8225802]]], [[[1.0291598, 0.8666714, 0.5365481]]], [[[1.6659024, 0.9662922, 1.2542510]]], [[[1.0638932, 1.2676370, 1.3284135]]], [[[0.8606580, 1.2047292, 0.8236227]]], [[[0.9607314, 0.8245927, 0.4931274]]], [[[1.3337789, 1.0831167, 0.6886288]]], [[[1.0998479, 0.6928976, 1.1828062]]], [[[1.2720635, 1.1688425, 1.6315871]]], [[[0.9664422, 1.3048249, 1.2323289]]], [[[1.2177010, 1.4439141, 0.6051888]]], [[[1.1177186, 0.9085584, 0.3080032]]], [[[0.7892848, 0.8180081, 0.1506567]]], [[[0.2086674, 0.1723646, 0.0345780]]], [[[0.0764867, 0.0838471, 0.0134079]]]]]

Expected (Unparsed): [[[[[0.85551794,0.1003371,1.02447639]]],[[[1.25528621,0.74603305,2.2124594]]],[[[1.3682334000000003,1.8732877399999999,2.17683127]]],[[[1.5055712600000002,1.82949022,1.3472761100000001]]],[[[2.0323686100000002,1.94124043,0.8273697900000001]]],[[[2.08301641,1.4780716900000002,1.16918929]]],[[[1.4221251300000002,1.3371690100000002,1.41307624]]],[[[0.7794646700000001,1.28181471,0.82258026]]],[[[1.02915986,0.8666714400000001,0.5365481400000001]]],[[[1.6659023899999998,0.96629219,1.2542509700000002]]],[[[1.0638932300000001,1.26763707,1.3284135]]],[[[0.86065799,1.2047292299999999,0.82362268]]],[[[0.9607313800000001,0.8245927200000002,0.49312736]]],[[[1.33377891,1.08311667,0.68862883]]],[[[1.09984795,0.6928976299999998,1.1828062799999999]]],[[[1.27206349,1.1688425299999998,1.63158716]]],[[[0.96644216,1.3048249,1.2323289099999999]]],[[[1.217701,1.44391404,0.60518877]]],[[[1.11771865,0.9085583899999999,0.30800315]]],[[[0.78928477,0.8180081299999999,0.15065668999999998]]],[[[0.20866734999999997,0.17236454999999998,0.03457800999999999]]],[[[0.07648674,0.08384705999999999,0.013407899999999999]]]]]

Actual:   [[[[[0.8556, 0.1004, 1.0245]]], [[[1.2553, 0.7461, 2.2125]]], [[[1.3683, 1.8733, 2.1769]]], [[[1.5056, 1.8295, 1.3473]]], [[[2.0324, 1.9413, 0.8274]]], [[[2.0831, 1.4781, 1.1692]]], [[[1.4222, 1.3372, 1.4131]]], [[[0.7795, 1.2819, 0.8226]]], [[[1.0292, 0.8667, 0.5366]]], [[[1.666, 0.9663, 1.2543]]], [[[1.0639, 1.2677, 1.3285]]], [[[0.8607, 1.2048, 0.8237]]], [[[0.9608, 0.8246, 0.4932]]], [[[1.3338, 1.0832, 0.6887]]], [[[1.0999, 0.6929, 1.1829]]], [[[1.2721, 1.1689, 1.6316]]], [[[0.9665, 1.3049, 1.2324]]], [[[1.2178, 1.444, 0.6052]]], [[[1.1178, 0.9086, 0.3081]]], [[[0.7893, 0.8181, 0.1507]]], [[[0.2087, 0.1724, 0.0346]]], [[[0.0765, 0.0839, 0.0135]]]]]

Expected: [[[[[0.8556, 0.1004, 1.0245]]], [[[1.2553, 0.7461, 2.2125]]], [[[1.3683, 1.8733, 2.1769]]], [[[1.5056, 1.8295, 1.3473]]], [[[2.0324, 1.9413, 0.8274]]], [[[2.0831, 1.4781, 1.1692]]], [[[1.4222, 1.3372, 1.4131]]], [[[0.7795, 1.2819, 0.8226]]], [[[1.0292, 0.8667, 0.5366]]], [[[1.666, 0.9663, 1.2543]]], [[[1.0639, 1.2677, 1.3285]]], [[[0.8607, 1.2048, 0.8237]]], [[[0.9608, 0.8246, 0.4932]]], [[[1.3338, 1.0832, 0.6887]]], [[[1.0999, 0.6929, 1.1829]]], [[[1.2721, 1.1689, 1.6316]]], [[[0.9665, 1.3049, 1.2324]]], [[[1.2178, 1.444, 0.6052]]], [[[1.1178, 0.9086, 0.3081]]], [[[0.7893, 0.8181, 0.1507]]], [[[0.2087, 0.1724, 0.0346]]], [[[0.0765, 0.0839, 0.0135]]]]]