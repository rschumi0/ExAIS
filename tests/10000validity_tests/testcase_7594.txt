import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave69094 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave69094 = tf.keras.layers.Input(shape=([2, 2, 1]))

Ave69094 = keras.layers.Average(name = 'Ave69094', )([in0Ave69094,in1Ave69094])
Loc82116 = keras.layers.LocallyConnected2D(3, (1, 1),strides=(1, 1), name = 'Loc82116', )(Ave69094)
Mas16339 = keras.layers.Masking(mask_value=2, name = 'Mas16339', )(Loc82116)
model = tf.keras.models.Model(inputs=[in0Ave69094,in1Ave69094], outputs=Mas16339)
w = model.get_layer('Loc82116').get_weights() 
w[0] = np.array([[[0.8501, 0.4176, 0.2995]], [[0.8749, 0.9438, 0.6002]], [[0.3159, 0.917, 0.1817]], [[0.6293, 0.4392, 0.3427]]])
w[1] = np.array([[[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0, 0]]])
model.get_layer('Loc82116').set_weights(w) 
in0Ave69094 = tf.constant([[[[0.2851], [0.5269]], [[0.625], [0.1146]]]])
in1Ave69094 = tf.constant([[[[0.8178], [0.375]], [[0.401], [0.9685]]]])
print (np.array2string(model.predict([in0Ave69094,in1Ave69094],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mas16339.png')

LAve69094 = average_layer([[[[[0.2851], [0.5269]], [[0.625], [0.1146]]]], [[[[0.8178], [0.375]], [[0.401], [0.9685]]]]], Ave69094), 
LLoc82116 = locally_connected2D_layer(Ave69094, 1, 1,[[[0.8501, 0.4176, 0.2995]], [[0.8749, 0.9438, 0.6002]], [[0.3159, 0.917, 0.1817]], [[0.6293, 0.4392, 0.3427]]],[[[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0, 0]]], 1, 1, Loc82116), 
LMas16339 = masking_layer(Loc82116, 2, Mas16339), 
exec_layers([LAve69094,LLoc82116,LMas16339],["Ave69094","Loc82116","Mas16339"],Mas16339,"Mas16339")

Actual (Unparsed): [[[[0.4687876, 0.2302855, 0.1651593], [0.3945362, 0.4256066, 0.2706602]], [[0.1620567, 0.4704210, 0.0932121], [0.3407974, 0.2378488, 0.1855892]]]]

Expected (Unparsed): [[[[0.468787645,0.23028552000000002,0.165159275],[0.394536155,0.42560661,0.27066018999999997]],[[0.1620567,0.47042100000000003,0.0932121],[0.340797415,0.23784875999999996,0.185589185]]]]

Actual:   [[[[0.4688, 0.2303, 0.1652], [0.3946, 0.4257, 0.2707]], [[0.1621, 0.4705, 0.0933], [0.3408, 0.2379, 0.1856]]]]

Expected: [[[[0.4688, 0.2303, 0.1652], [0.3946, 0.4257, 0.2707]], [[0.1621, 0.4705, 0.0933], [0.3408, 0.2379, 0.1856]]]]