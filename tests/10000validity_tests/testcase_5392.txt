import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub62120 = tf.keras.layers.Input(shape=([2, 3, 3]))
in1Sub62120 = tf.keras.layers.Input(shape=([2, 3, 3]))
in0Ave766 = tf.keras.layers.Input(shape=([1, 1]))
in1Ave766 = tf.keras.layers.Input(shape=([1, 1]))
in0Con39834 = tf.keras.layers.Input(shape=([2, 8]))

Sub62120 = keras.layers.Subtract(name = 'Sub62120', )([in0Sub62120,in1Sub62120])
Res45144 = keras.layers.Reshape((2, 9), name = 'Res45144', )(Sub62120)
Ave766 = keras.layers.Average(name = 'Ave766', )([in0Ave766,in1Ave766])
Zer48108 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer48108', )(Ave766)
Con39834 = keras.layers.Concatenate(axis=2, name = 'Con39834', )([Zer48108,in0Con39834])
Mul57640 = keras.layers.Multiply(name = 'Mul57640', )([Res45144,Con39834])
model = tf.keras.models.Model(inputs=[in0Sub62120,in1Sub62120,in0Ave766,in1Ave766,in0Con39834], outputs=Mul57640)
in0Sub62120 = tf.constant([[[[0.9075, 0.6429, 0.3484], [0.1537, 0.3951, 0.3124], [0.1674, 0.1941, 0.003]], [[0.8837, 0.2968, 0.4918], [0.0485, 0.9189, 0.308], [0.3808, 0.4342, 0.031]]]])
in1Sub62120 = tf.constant([[[[0.2925, 0.3046, 0.4366], [0.6539, 0.6356, 0.5431], [0.2083, 0.107, 0.852]], [[0.0627, 0.5466, 0.8934], [0.6753, 0.1974, 0.4278], [0.437, 0.4988, 0.2204]]]])
in0Ave766 = tf.constant([[[0.9142]]])
in1Ave766 = tf.constant([[[0.1456]]])
in0Con39834 = tf.constant([[[0.3762, 0.3981, 0.5596, 0.7365, 0.6207, 0.7373, 0.9287, 0.9774], [0.3059, 0.1392, 0.0546, 0.5069, 0.7323, 0.6807, 0.3501, 0.1958]]])
print (np.array2string(model.predict([in0Sub62120,in1Sub62120,in0Ave766,in1Ave766,in0Con39834],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul57640.png')

LSub62120 = subtract_layer([[[[0.9075, 0.6429, 0.3484], [0.1537, 0.3951, 0.3124], [0.1674, 0.1941, 0.003]], [[0.8837, 0.2968, 0.4918], [0.0485, 0.9189, 0.308], [0.3808, 0.4342, 0.031]]]], [[[[0.2925, 0.3046, 0.4366], [0.6539, 0.6356, 0.5431], [0.2083, 0.107, 0.852]], [[0.0627, 0.5466, 0.8934], [0.6753, 0.1974, 0.4278], [0.437, 0.4988, 0.2204]]]], Sub62120), 
LRes45144 = reshape_layer(Sub62120, [2, 9], Res45144), 
LAve766 = average_layer([[[[0.9142]]], [[[0.1456]]]], Ave766), 
LZer48108 = zero_padding1D_layer(Ave766, 1, 0, Zer48108), 
LCon39834 = concatenate_layer([Zer48108,[[[0.3762, 0.3981, 0.5596, 0.7365, 0.6207, 0.7373, 0.9287, 0.9774], [0.3059, 0.1392, 0.0546, 0.5069, 0.7323, 0.6807, 0.3501, 0.1958]]]], 2, Con39834), 
LMul57640 = multiply_layer([Res45144,Con39834], Mul57640), 
exec_layers([LSub62120,LRes45144,LAve766,LZer48108,LCon39834,LMul57640],["Sub62120","Res45144","Ave766","Zer48108","Con39834","Mul57640"],Mul57640,"Mul57640")

Actual (Unparsed): [[[0.0000000, 0.1272685, -0.0351124, -0.2799119, -0.1771282, -0.1431955, -0.0301556, 0.0808898, -0.8298126], [0.4350479, -0.0764138, -0.0559027, -0.0342233, 0.3657284, -0.0877295, -0.0382553, -0.0226165, -0.0370845]]]

Expected (Unparsed): [[[0.0,0.12726846,-0.03511242,-0.27991192,-0.17712825000000004,-0.14319549,-0.030155570000000013,0.08088977,-0.8298126],[0.43504790000000004,-0.07641382,-0.05590271999999999,-0.03422328,0.36572835000000004,-0.08772954000000001,-0.03825533999999998,-0.02261646000000002,-0.03708452]]]

Actual:   [[[0, 0.1273, -0.0351, -0.2799, -0.1771, -0.1431, -0.0301, 0.0809, -0.8298], [0.4351, -0.0764, -0.0559, -0.0342, 0.3658, -0.0877, -0.0382, -0.0226, -0.037]]]

Expected: [[[0, 0.1273, -0.0351, -0.2799, -0.1771, -0.1431, -0.0301, 0.0809, -0.8298], [0.4351, -0.0764, -0.0559, -0.0342, 0.3658, -0.0877, -0.0382, -0.0226, -0.037]]]