import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Per67965 = tf.keras.layers.Input(shape=([3, 1]))
in0Sim70501 = tf.keras.layers.Input(shape=([3, 2]))
in0Con77660 = tf.keras.layers.Input(shape=([4]))

Per67965 = keras.layers.Permute((2,1), name = 'Per67965',)(in0Per67965)
Res73477 = keras.layers.Reshape((1, 3, 1), name = 'Res73477', )(Per67965)
Sep1298 = keras.layers.SeparableConv2D(2, (1, 1),strides=(1, 1), padding='valid', name = 'Sep1298', )(Res73477)
Res309 = keras.layers.Reshape((1, 6), name = 'Res309', )(Sep1298)
Fla62304 = keras.layers.Flatten(name = 'Fla62304', )(Res309)
Sim70501 = keras.layers.SimpleRNN(2,name = 'Sim70501', )(in0Sim70501)
Lea43092 = keras.layers.LeakyReLU(alpha=2.162519350895478, name = 'Lea43092', )(Sim70501)
Lay45084 = keras.layers.LayerNormalization(axis=1, epsilon=2.1519512531040705, name = 'Lay45084', )(Lea43092)
Con77660 = keras.layers.Concatenate(axis=1, name = 'Con77660', )([Lay45084,in0Con77660])
Ave27245 = keras.layers.Average(name = 'Ave27245', )([Fla62304,Con77660])
model = tf.keras.models.Model(inputs=[in0Per67965,in0Sim70501,in0Con77660], outputs=Ave27245)
w = model.get_layer('Sep1298').get_weights() 
w[0] = np.array([[[[0.8534]]]])
w[1] = np.array([[[[0.4637, 0.6451]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep1298').set_weights(w) 
w = model.get_layer('Sim70501').get_weights() 
w[0] = np.array([[6, 4], [1, 10]])
w[1] = np.array([[9, 5], [10, 5]])
w[2] = np.array([8, 8])
model.get_layer('Sim70501').set_weights(w) 
in0Per67965 = tf.constant([[[1.5814], [1.0327], [1.4134]]])
in0Sim70501 = tf.constant([[[7, 6], [1, 1], [10, 6]]])
in0Con77660 = tf.constant([[0.5755, 0.4687, 0.6016, 0.2279]])
print (np.array2string(model.predict([in0Per67965,in0Sim70501,in0Con77660],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave27245.png')

LPer67965 = permute_layer([[[1.5814], [1.0327], [1.4134]]], 2,1, Per67965), 
LRes73477 = reshape_layer(Per67965, [1, 3, 1], Res73477), 
LSep1298 = separable_conv2D_layer(Res73477, 1, 1,[[[[[0.8534]]]],[[[[0.4637, 0.6451]]]]],[0, 0], 1, 1, false, Sep1298), 
LRes309 = reshape_layer(Sep1298, [1, 6], Res309), 
LFla62304 = flatten_layer(Res309, Fla62304), 
LSim70501 = simple_rnn_layer([[[7, 6], [1, 1], [10, 6]]],[[6, 4], [1, 10]],[[9, 5], [10, 5]],[8, 8], Sim70501), 
LLea43092 = leaky_relu_layer(Sim70501, 2.162519350895478, Lea43092), 
LLay45084 = layer_normalization_layer(Lea43092, 1, 2.1519512531040705, Lay45084), 
LCon77660 = concatenate_layer([Lay45084,[[0.5755, 0.4687, 0.6016, 0.2279]]], 1, Con77660), 
LAve27245 = average_layer([Fla62304,Con77660], Ave27245), 
exec_layers([LPer67965,LRes73477,LSep1298,LRes309,LFla62304,LSim70501,LLea43092,LLay45084,LCon77660,LAve27245],["Per67965","Res73477","Sep1298","Res309","Fla62304","Sim70501","Lea43092","Lay45084","Con77660","Ave27245"],Ave27245,"Ave27245")

Actual (Unparsed): [[0.3128971, 0.4353028, 0.4920808, 0.5186153, 0.5804564, 0.5030084]]

Expected (Unparsed): [[0.31289705330600004,0.43530275843800004,0.49208083783300005,0.518615308359,0.580456440586,0.503008377878]]

Actual:   [[0.3129, 0.4354, 0.4921, 0.5187, 0.5805, 0.5031]]

Expected: [[0.3129, 0.4354, 0.4921, 0.5187, 0.5805, 0.5031]]