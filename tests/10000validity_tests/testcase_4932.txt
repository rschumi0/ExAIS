import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min8331 = tf.keras.layers.Input(shape=([2, 1]))
in1Min8331 = tf.keras.layers.Input(shape=([2, 1]))
in0Con97019 = tf.keras.layers.Input(shape=([2, 2]))
in0Sub40599 = tf.keras.layers.Input(shape=([3, 2, 3]))
in1Sub40599 = tf.keras.layers.Input(shape=([3, 2, 3]))

Min8331 = keras.layers.Minimum(name = 'Min8331', )([in0Min8331,in1Min8331])
Con97019 = keras.layers.Concatenate(axis=2, name = 'Con97019', )([Min8331,in0Con97019])
Sub40599 = keras.layers.Subtract(name = 'Sub40599', )([in0Sub40599,in1Sub40599])
Zer74385 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer74385', )(Sub40599)
Sep95526 = keras.layers.SeparableConv2D(3, (3, 2),strides=(4, 4), padding='valid', name = 'Sep95526', )(Zer74385)
Res98901 = keras.layers.Reshape((1, 3), name = 'Res98901', )(Sep95526)
Dot93158 = keras.layers.Dot(axes=(2, 2), name = 'Dot93158', )([Con97019,Res98901])
Res43727 = keras.layers.Reshape((2, 1, 1), name = 'Res43727', )(Dot93158)
Glo43839 = keras.layers.GlobalMaxPool2D(name = 'Glo43839', )(Res43727)
model = tf.keras.models.Model(inputs=[in0Min8331,in1Min8331,in0Con97019,in0Sub40599,in1Sub40599], outputs=Glo43839)
w = model.get_layer('Sep95526').get_weights() 
w[0] = np.array([[[[0.522], [0.8798], [0.855]], [[0.5082], [0.2084], [0.9284]]], [[[0.0786], [0.2024], [0.8205]], [[0.6845], [0.0139], [0.6885]]], [[[0.6059], [0.7895], [0.4299]], [[0.1345], [0.6207], [0.2589]]]])
w[1] = np.array([[[[0.7736, 0.5977, 0.1142], [0.9665, 0.5763, 0.8978], [0.8647, 0.2412, 0.8988]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep95526').set_weights(w) 
in0Min8331 = tf.constant([[[0.5548], [0.8217]]])
in1Min8331 = tf.constant([[[0.4271], [0.4462]]])
in0Con97019 = tf.constant([[[0.2377, 0.1546], [0.8775, 0.4212]]])
in0Sub40599 = tf.constant([[[[0.1532, 0.4115, 0.119], [0.9523, 0.5883, 0.5367]], [[0.2573, 0.6652, 0.4016], [0.5598, 0.1254, 0.4319]], [[0.5108, 0.9235, 0.0335], [0.0818, 0.8047, 0.1252]]]])
in1Sub40599 = tf.constant([[[[0.5616, 0.9067, 0.8595], [0.5778, 0.3096, 0.5117]], [[0.6235, 0.1652, 0.514], [0.671, 0.4765, 0.5549]], [[0.149, 0.9051, 0.2862], [0.4924, 0.5512, 0.988]]]])
print (np.array2string(model.predict([in0Min8331,in1Min8331,in0Con97019,in0Sub40599,in1Sub40599],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo43839.png')

LMin8331 = minimum_layer([[[[0.5548], [0.8217]]], [[[0.4271], [0.4462]]]], Min8331), 
LCon97019 = concatenate_layer([Min8331,[[[0.2377, 0.1546], [0.8775, 0.4212]]]], 2, Con97019), 
LSub40599 = subtract_layer([[[[0.1532, 0.4115, 0.119], [0.9523, 0.5883, 0.5367]], [[0.2573, 0.6652, 0.4016], [0.5598, 0.1254, 0.4319]], [[0.5108, 0.9235, 0.0335], [0.0818, 0.8047, 0.1252]]]], [[[[0.5616, 0.9067, 0.8595], [0.5778, 0.3096, 0.5117]], [[0.6235, 0.1652, 0.514], [0.671, 0.4765, 0.5549]], [[0.149, 0.9051, 0.2862], [0.4924, 0.5512, 0.988]]]], Sub40599), 
LZer74385 = zero_padding2D_layer(Sub40599, 1, 1, 1, 1, Zer74385), 
LSep95526 = separable_conv2D_layer(Zer74385, 3, 2,[[[[[0.522], [0.8798], [0.855]], [[0.5082], [0.2084], [0.9284]]], [[[0.0786], [0.2024], [0.8205]], [[0.6845], [0.0139], [0.6885]]], [[[0.6059], [0.7895], [0.4299]], [[0.1345], [0.6207], [0.2589]]]],[[[[0.7736, 0.5977, 0.1142], [0.9665, 0.5763, 0.8978], [0.8647, 0.2412, 0.8988]]]]],[0, 0, 0], 4, 4, false, Sep95526), 
LRes98901 = reshape_layer(Sep95526, [1, 3], Res98901), 
LDot93158 = dot_layer(Con97019,Res98901, 2, 2, Dot93158), 
LRes43727 = reshape_layer(Dot93158, [2, 1, 1], Res43727), 
LGlo43839 = global_max_pool2D_layer(Res43727, Glo43839), 
exec_layers([LMin8331,LCon97019,LSub40599,LZer74385,LSep95526,LRes98901,LDot93158,LRes43727,LGlo43839],["Min8331","Con97019","Sub40599","Zer74385","Sep95526","Res98901","Dot93158","Res43727","Glo43839"],Glo43839,"Glo43839")

Actual (Unparsed): [[-0.2570189]]

Expected (Unparsed): [[-0.2570189316472651]]

Actual:   [[-0.257]]

Expected: [[-0.257]]