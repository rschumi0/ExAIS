import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con35684 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Sub39466 = tf.keras.layers.Input(shape=([3, 3]))
in1Sub39466 = tf.keras.layers.Input(shape=([3, 3]))
in0Con79263 = tf.keras.layers.Input(shape=([5, 19, 1]))

Con35684 = keras.layers.Conv3DTranspose(3, (1, 1, 1),strides=(3, 5, 1), padding='valid', name = 'Con35684', )(in0Con35684)
Res50968 = keras.layers.Reshape((3, 10, 3), name = 'Res50968', )(Con35684)
Zer89221 = keras.layers.ZeroPadding2D(padding=((2, 0), (9, 0)), name = 'Zer89221', )(Res50968)
Sub39466 = keras.layers.Subtract(name = 'Sub39466', )([in0Sub39466,in1Sub39466])
Glo56674 = keras.layers.GlobalMaxPool1D(name = 'Glo56674', )(Sub39466)
Res76577 = keras.layers.Reshape((3, 1), name = 'Res76577', )(Glo56674)
Res15083 = keras.layers.Reshape((3, 1, 1), name = 'Res15083', )(Res76577)
Con38925 = keras.layers.Conv2DTranspose(2, (3, 1),strides=(1, 1), padding='valid', name = 'Con38925', )(Res15083)
Zer80190 = keras.layers.ZeroPadding2D(padding=((0, 0), (18, 0)), name = 'Zer80190', )(Con38925)
Con79263 = keras.layers.Concatenate(axis=3, name = 'Con79263', )([Zer80190,in0Con79263])
Ave36593 = keras.layers.Average(name = 'Ave36593', )([Zer89221,Con79263])
model = tf.keras.models.Model(inputs=[in0Con35684,in0Sub39466,in1Sub39466,in0Con79263], outputs=Ave36593)
w = model.get_layer('Con35684').get_weights() 
w[0] = np.array([[[[[0.5579, 0.1549], [0.8757, 0.1771], [0.5487, 0.8932]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con35684').set_weights(w) 
w = model.get_layer('Con38925').get_weights() 
w[0] = np.array([[[[0.0032], [0.3152]]], [[[0.256], [0.9883]]], [[[0.4756], [0.9088]]]])
w[1] = np.array([0, 0])
model.get_layer('Con38925').set_weights(w) 
in0Con35684 = tf.constant([[[[[0.9194, 0.0249]], [[0.7551, 0.6156]]]]])
in0Sub39466 = tf.constant([[[0.5492, 0.4817, 0.9632], [0.446, 0.1893, 0.9327], [0.6376, 0.342, 0.2593]]])
in1Sub39466 = tf.constant([[[0.0431, 0.8185, 0.4706], [0.9526, 0.9717, 0.6535], [0.9398, 0.8748, 0.4739]]])
in0Con79263 = tf.constant([[[[0.9248], [0.8892], [0.2381], [0.2895], [0.3724], [0.1695], [0.6437], [0.8535], [0.7856], [0.5145], [0.2198], [0.5983], [0.1282], [0.4862], [0.8861], [0.6514], [0.5241], [0.5744], [0.8291]], [[0.8971], [0.8833], [0.7341], [0.731], [0.9688], [0.2773], [0.4091], [0.8188], [0.2641], [0.0122], [0.8622], [0.8763], [0.4093], [0.2107], [0.8807], [0.8023], [0.5486], [0.9874], [0.8296]], [[0.6484], [0.9394], [0.9764], [0.5832], [0.3248], [0.6001], [0.0533], [0.0821], [0.322], [0.1718], [0.5847], [0.1367], [0.8663], [0.7355], [0.432], [0.6223], [0.898], [0.0528], [0.2382]], [[0.3995], [0.1421], [0.5892], [0.2364], [0.1327], [0.3288], [0.7231], [0.9298], [0.6772], [0.3111], [0.7397], [0.5163], [0.8565], [0.4271], [0.5724], [0.8558], [0.265], [0.9585], [0.7589]], [[0.1129], [0.1939], [0.9493], [0.756], [0.9444], [0.9006], [0.9637], [0.5763], [0.2495], [0.222], [0.5893], [0.694], [0.0505], [0.964], [0.6176], [0.3056], [0.0305], [0.5935], [0.8728]]]])
print (np.array2string(model.predict([in0Con35684,in0Sub39466,in1Sub39466,in0Con79263],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave36593.png')

LCon35684 = conv3D_transpose_layer([[[[[0.9194, 0.0249]], [[0.7551, 0.6156]]]]], 1, 1, 1,[[[[[0.5579, 0.1549], [0.8757, 0.1771], [0.5487, 0.8932]]]]],[0, 0, 0], 3, 5, 1, false, Con35684), 
LRes50968 = reshape_layer(Con35684, [3, 10, 3], Res50968), 
LZer89221 = zero_padding2D_layer(Res50968, 2, 0, 9, 0, Zer89221), 
LSub39466 = subtract_layer([[[0.5492, 0.4817, 0.9632], [0.446, 0.1893, 0.9327], [0.6376, 0.342, 0.2593]]], [[[0.0431, 0.8185, 0.4706], [0.9526, 0.9717, 0.6535], [0.9398, 0.8748, 0.4739]]], Sub39466), 
LGlo56674 = global_max_pool1D_layer(Sub39466, Glo56674), 
LRes76577 = reshape_layer(Glo56674, [3, 1], Res76577), 
LRes15083 = reshape_layer(Res76577, [3, 1, 1], Res15083), 
LCon38925 = conv2D_transpose_layer(Res15083, 3, 1,[[[[0.0032], [0.3152]]], [[[0.256], [0.9883]]], [[[0.4756], [0.9088]]]],[0, 0], 1, 1, false, Con38925), 
LZer80190 = zero_padding2D_layer(Con38925, 0, 0, 18, 0, Zer80190), 
LCon79263 = concatenate_layer([Zer80190,[[[[0.9248], [0.8892], [0.2381], [0.2895], [0.3724], [0.1695], [0.6437], [0.8535], [0.7856], [0.5145], [0.2198], [0.5983], [0.1282], [0.4862], [0.8861], [0.6514], [0.5241], [0.5744], [0.8291]], [[0.8971], [0.8833], [0.7341], [0.731], [0.9688], [0.2773], [0.4091], [0.8188], [0.2641], [0.0122], [0.8622], [0.8763], [0.4093], [0.2107], [0.8807], [0.8023], [0.5486], [0.9874], [0.8296]], [[0.6484], [0.9394], [0.9764], [0.5832], [0.3248], [0.6001], [0.0533], [0.0821], [0.322], [0.1718], [0.5847], [0.1367], [0.8663], [0.7355], [0.432], [0.6223], [0.898], [0.0528], [0.2382]], [[0.3995], [0.1421], [0.5892], [0.2364], [0.1327], [0.3288], [0.7231], [0.9298], [0.6772], [0.3111], [0.7397], [0.5163], [0.8565], [0.4271], [0.5724], [0.8558], [0.265], [0.9585], [0.7589]], [[0.1129], [0.1939], [0.9493], [0.756], [0.9444], [0.9006], [0.9637], [0.5763], [0.2495], [0.222], [0.5893], [0.694], [0.0505], [0.964], [0.6176], [0.3056], [0.0305], [0.5935], [0.8728]]]]], 3, Con79263), 
LAve36593 = average_layer([Zer89221,Con79263], Ave36593), 
exec_layers([LCon35684,LRes50968,LZer89221,LSub39466,LGlo56674,LRes76577,LRes15083,LCon38925,LZer80190,LCon79263,LAve36593],["Con35684","Res50968","Zer89221","Sub39466","Glo56674","Res76577","Res15083","Con38925","Zer80190","Con79263","Ave36593"],Ave36593,"Ave36593")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.4624000], [0.0000000, 0.0000000, 0.4446000], [0.0000000, 0.0000000, 0.1190500], [0.0000000, 0.0000000, 0.1447500], [0.0000000, 0.0000000, 0.1862000], [0.0000000, 0.0000000, 0.0847500], [0.0000000, 0.0000000, 0.3218500], [0.0000000, 0.0000000, 0.4267500], [0.0000000, 0.0000000, 0.3928000], [0.0000000, 0.0000000, 0.2572500], [0.0000000, 0.0000000, 0.1099000], [0.0000000, 0.0000000, 0.2991500], [0.0000000, 0.0000000, 0.0641000], [0.0000000, 0.0000000, 0.2431000], [0.0000000, 0.0000000, 0.4430500], [0.0000000, 0.0000000, 0.3257000], [0.0000000, 0.0000000, 0.2620500], [0.0000000, 0.0000000, 0.2872000], [0.0008098, 0.0797614, 0.4145500]], [[0.0000000, 0.0000000, 0.4485500], [0.0000000, 0.0000000, 0.4416500], [0.0000000, 0.0000000, 0.3670500], [0.0000000, 0.0000000, 0.3655000], [0.0000000, 0.0000000, 0.4844000], [0.0000000, 0.0000000, 0.1386500], [0.0000000, 0.0000000, 0.2045500], [0.0000000, 0.0000000, 0.4094000], [0.0000000, 0.0000000, 0.1320500], [0.0000000, 0.0000000, 0.0061000], [0.0000000, 0.0000000, 0.4311000], [0.0000000, 0.0000000, 0.4381500], [0.0000000, 0.0000000, 0.2046500], [0.0000000, 0.0000000, 0.1053500], [0.0000000, 0.0000000, 0.4403500], [0.0000000, 0.0000000, 0.4011500], [0.0000000, 0.0000000, 0.2743000], [0.0000000, 0.0000000, 0.4937000], [0.0642419, 0.1970096, 0.4148000]], [[0.0000000, 0.0000000, 0.3242000], [0.0000000, 0.0000000, 0.4697000], [0.0000000, 0.0000000, 0.4882000], [0.0000000, 0.0000000, 0.2916000], [0.0000000, 0.0000000, 0.1624000], [0.0000000, 0.0000000, 0.3000500], [0.0000000, 0.0000000, 0.0266500], [0.0000000, 0.0000000, 0.0410500], [0.0000000, 0.0000000, 0.1610000], [0.2583951, 0.4047642, 0.3492577], [0.0000000, 0.0000000, 0.2923500], [0.0000000, 0.0000000, 0.0683500], [0.0000000, 0.0000000, 0.4331500], [0.0000000, 0.0000000, 0.3677500], [0.2583134, 0.3851319, 0.6980886], [0.0000000, 0.0000000, 0.3111500], [0.0000000, 0.0000000, 0.4490000], [0.0000000, 0.0000000, 0.0264000], [0.0780283, 0.1411759, 0.1191000]], [[0.0000000, 0.0000000, 0.1997500], [0.0000000, 0.0000000, 0.0710500], [0.0000000, 0.0000000, 0.2946000], [0.0000000, 0.0000000, 0.1182000], [0.0000000, 0.0000000, 0.0663500], [0.0000000, 0.0000000, 0.1644000], [0.0000000, 0.0000000, 0.3615500], [0.0000000, 0.0000000, 0.4649000], [0.0000000, 0.0000000, 0.3386000], [0.0000000, 0.0000000, 0.1555500], [0.0000000, 0.0000000, 0.3698500], [0.0000000, 0.0000000, 0.2581500], [0.0000000, 0.0000000, 0.4282500], [0.0000000, 0.0000000, 0.2135500], [0.0000000, 0.0000000, 0.2862000], [0.0000000, 0.0000000, 0.4279000], [0.0000000, 0.0000000, 0.1325000], [0.0000000, 0.0000000, 0.4792500], [-0.0170382, 0.0903764, 0.3794500]], [[0.0000000, 0.0000000, 0.0564500], [0.0000000, 0.0000000, 0.0969500], [0.0000000, 0.0000000, 0.4746500], [0.0000000, 0.0000000, 0.3780000], [0.0000000, 0.0000000, 0.4722000], [0.0000000, 0.0000000, 0.4503000], [0.0000000, 0.0000000, 0.4818500], [0.0000000, 0.0000000, 0.2881500], [0.0000000, 0.0000000, 0.1247500], [0.0000000, 0.0000000, 0.1110000], [0.0000000, 0.0000000, 0.2946500], [0.0000000, 0.0000000, 0.3470000], [0.0000000, 0.0000000, 0.0252500], [0.0000000, 0.0000000, 0.4820000], [0.0000000, 0.0000000, 0.3088000], [0.0000000, 0.0000000, 0.1528000], [0.0000000, 0.0000000, 0.0152500], [0.0000000, 0.0000000, 0.2967500], [0.1171403, 0.2238374, 0.4364000]]]]

Expected (Unparsed): [[[[0,0,0.4624],[0,0,0.4446],[0,0,0.11905],[0,0,0.14475],[0,0,0.1862],[0,0,0.08475],[0,0,0.32185],[0,0,0.42675],[0,0,0.3928],[0,0,0.25725],[0,0,0.1099],[0,0,0.29915],[0,0,0.0641],[0,0,0.2431],[0,0,0.44305],[0,0,0.3257],[0,0,0.26205],[0,0,0.2872],[0.0008097600000000001,0.07976135999999999,0.41455]],[[0,0,0.44855],[0,0,0.44165],[0,0,0.36705],[0,0,0.3655],[0,0,0.4844],[0,0,0.13865],[0,0,0.20455],[0,0,0.4094],[0,0,0.13205],[0,0,0.0061],[0,0,0.4311],[0,0,0.43815],[0,0,0.20465],[0,0,0.10535],[0,0,0.44035],[0,0,0.40115],[0,0,0.2743],[0,0,0.4937],[0.06424192,0.197009635,0.4148]],[[0,0,0.3242],[0,0,0.4697],[0,0,0.4882],[0,0,0.2916],[0,0,0.1624],[0,0,0.30005],[0,0,0.02665],[0,0,0.04105],[0,0,0.161],[0.258395135,0.404764185,0.34925773000000004],[0,0,0.29235],[0,0,0.06835],[0,0,0.43315],[0,0,0.36775],[0.25831336499999996,0.385131915,0.698088645],[0,0,0.31115],[0,0,0.449],[0,0,0.0264],[0.07802833999999999,0.14117588000000003,0.1191]],[[0,0,0.19975],[0,0,0.07105],[0,0,0.2946],[0,0,0.1182],[0,0,0.06635],[0,0,0.1644],[0,0,0.36155],[0,0,0.4649],[0,0,0.3386],[0,0,0.15555],[0,0,0.36985],[0,0,0.25815],[0,0,0.42825],[0,0,0.21355],[0,0,0.2862],[0,0,0.4279],[0,0,0.1325],[0,0,0.47925],[-0.01703824000000001,0.09037636999999996,0.37945]],[[0,0,0.05645],[0,0,0.09695],[0,0,0.47465],[0,0,0.378],[0,0,0.4722],[0,0,0.4503],[0,0,0.48185],[0,0,0.28815],[0,0,0.12475],[0,0,0.111],[0,0,0.29465],[0,0,0.347],[0,0,0.02525],[0,0,0.482],[0,0,0.3088],[0,0,0.1528],[0,0,0.01525],[0,0,0.29675],[0.11714027999999999,0.22383743999999997,0.4364]]]]

Actual:   [[[[0, 0, 0.4624], [0, 0, 0.4446], [0, 0, 0.1191], [0, 0, 0.1448], [0, 0, 0.1862], [0, 0, 0.0848], [0, 0, 0.3219], [0, 0, 0.4268], [0, 0, 0.3928], [0, 0, 0.2573], [0, 0, 0.1099], [0, 0, 0.2992], [0, 0, 0.0641], [0, 0, 0.2431], [0, 0, 0.4431], [0, 0, 0.3257], [0, 0, 0.2621], [0, 0, 0.2872], [0.0009, 0.0798, 0.4146]], [[0, 0, 0.4486], [0, 0, 0.4417], [0, 0, 0.3671], [0, 0, 0.3655], [0, 0, 0.4844], [0, 0, 0.1387], [0, 0, 0.2046], [0, 0, 0.4094], [0, 0, 0.1321], [0, 0, 0.0061], [0, 0, 0.4311], [0, 0, 0.4382], [0, 0, 0.2047], [0, 0, 0.1054], [0, 0, 0.4404], [0, 0, 0.4012], [0, 0, 0.2743], [0, 0, 0.4937], [0.0643, 0.1971, 0.4148]], [[0, 0, 0.3242], [0, 0, 0.4697], [0, 0, 0.4882], [0, 0, 0.2916], [0, 0, 0.1624], [0, 0, 0.3001], [0, 0, 0.0267], [0, 0, 0.0411], [0, 0, 0.161], [0.2584, 0.4048, 0.3493], [0, 0, 0.2924], [0, 0, 0.0684], [0, 0, 0.4332], [0, 0, 0.3678], [0.2584, 0.3852, 0.6981], [0, 0, 0.3112], [0, 0, 0.449], [0, 0, 0.0264], [0.0781, 0.1412, 0.1191]], [[0, 0, 0.1998], [0, 0, 0.0711], [0, 0, 0.2946], [0, 0, 0.1182], [0, 0, 0.0664], [0, 0, 0.1644], [0, 0, 0.3616], [0, 0, 0.4649], [0, 0, 0.3386], [0, 0, 0.1556], [0, 0, 0.3699], [0, 0, 0.2582], [0, 0, 0.4283], [0, 0, 0.2136], [0, 0, 0.2862], [0, 0, 0.4279], [0, 0, 0.1325], [0, 0, 0.4793], [-0.017, 0.0904, 0.3795]], [[0, 0, 0.0565], [0, 0, 0.097], [0, 0, 0.4747], [0, 0, 0.378], [0, 0, 0.4722], [0, 0, 0.4503], [0, 0, 0.4819], [0, 0, 0.2882], [0, 0, 0.1248], [0, 0, 0.111], [0, 0, 0.2947], [0, 0, 0.347], [0, 0, 0.0253], [0, 0, 0.482], [0, 0, 0.3088], [0, 0, 0.1528], [0, 0, 0.0153], [0, 0, 0.2968], [0.1172, 0.2239, 0.4364]]]]

Expected: [[[[0, 0, 0.4624], [0, 0, 0.4446], [0, 0, 0.1191], [0, 0, 0.1448], [0, 0, 0.1862], [0, 0, 0.0848], [0, 0, 0.3219], [0, 0, 0.4268], [0, 0, 0.3928], [0, 0, 0.2573], [0, 0, 0.1099], [0, 0, 0.2992], [0, 0, 0.0641], [0, 0, 0.2431], [0, 0, 0.4431], [0, 0, 0.3257], [0, 0, 0.2621], [0, 0, 0.2872], [0.0009, 0.0798, 0.4146]], [[0, 0, 0.4486], [0, 0, 0.4417], [0, 0, 0.3671], [0, 0, 0.3655], [0, 0, 0.4844], [0, 0, 0.1387], [0, 0, 0.2046], [0, 0, 0.4094], [0, 0, 0.1321], [0, 0, 0.0061], [0, 0, 0.4311], [0, 0, 0.4382], [0, 0, 0.2047], [0, 0, 0.1054], [0, 0, 0.4404], [0, 0, 0.4012], [0, 0, 0.2743], [0, 0, 0.4937], [0.0643, 0.1971, 0.4148]], [[0, 0, 0.3242], [0, 0, 0.4697], [0, 0, 0.4882], [0, 0, 0.2916], [0, 0, 0.1624], [0, 0, 0.3001], [0, 0, 0.0267], [0, 0, 0.0411], [0, 0, 0.161], [0.2584, 0.4048, 0.3493], [0, 0, 0.2924], [0, 0, 0.0684], [0, 0, 0.4332], [0, 0, 0.3678], [0.2584, 0.3852, 0.6981], [0, 0, 0.3112], [0, 0, 0.449], [0, 0, 0.0264], [0.0781, 0.1412, 0.1191]], [[0, 0, 0.1998], [0, 0, 0.0711], [0, 0, 0.2946], [0, 0, 0.1182], [0, 0, 0.0664], [0, 0, 0.1644], [0, 0, 0.3616], [0, 0, 0.4649], [0, 0, 0.3386], [0, 0, 0.1556], [0, 0, 0.3699], [0, 0, 0.2582], [0, 0, 0.4283], [0, 0, 0.2136], [0, 0, 0.2862], [0, 0, 0.4279], [0, 0, 0.1325], [0, 0, 0.4793], [-0.017, 0.0904, 0.3795]], [[0, 0, 0.0565], [0, 0, 0.097], [0, 0, 0.4747], [0, 0, 0.378], [0, 0, 0.4722], [0, 0, 0.4503], [0, 0, 0.4819], [0, 0, 0.2882], [0, 0, 0.1248], [0, 0, 0.111], [0, 0, 0.2947], [0, 0, 0.347], [0, 0, 0.0253], [0, 0, 0.482], [0, 0, 0.3088], [0, 0, 0.1528], [0, 0, 0.0153], [0, 0, 0.2968], [0.1172, 0.2239, 0.4364]]]]