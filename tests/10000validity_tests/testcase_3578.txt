import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con36748 = tf.keras.layers.Input(shape=([1, 1]))
in0Min98947 = tf.keras.layers.Input(shape=([2, 2]))
in1Min98947 = tf.keras.layers.Input(shape=([2, 2]))
in0Max65442 = tf.keras.layers.Input(shape=([1, 1, 1]))

Con36748 = keras.layers.Conv1D(3, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con36748', )(in0Con36748)
Res498 = keras.layers.Reshape((1, 3, 1), name = 'Res498', )(Con36748)
Glo76042 = keras.layers.GlobalMaxPool2D(name = 'Glo76042', )(Res498)
Res87238 = keras.layers.Reshape((1, 1), name = 'Res87238', )(Glo76042)
Glo13622 = keras.layers.GlobalAveragePooling1D(name = 'Glo13622', )(Res87238)
Res463 = keras.layers.Reshape((1, 1), name = 'Res463', )(Glo13622)
Res48153 = keras.layers.Reshape((1, 1, 1), name = 'Res48153', )(Res463)
Zer18203 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer18203', )(Res48153)
Min98947 = keras.layers.Minimum(name = 'Min98947', )([in0Min98947,in1Min98947])
Res74058 = keras.layers.Reshape((2, 2, 1), name = 'Res74058', )(Min98947)
Max65442 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max65442', )(in0Max65442)
Zer81320 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer81320', )(Max65442)
Ave4236 = keras.layers.Average(name = 'Ave4236', )([Res74058,Zer81320])
Sub36243 = keras.layers.Subtract(name = 'Sub36243', )([Zer18203,Ave4236])
Max90649 = keras.layers.MaxPool2D(pool_size=(2, 1), name = 'Max90649', )(Sub36243)
model = tf.keras.models.Model(inputs=[in0Con36748,in0Min98947,in1Min98947,in0Max65442], outputs=Max90649)
w = model.get_layer('Con36748').get_weights() 
w[0] = np.array([[[0.1011, 0.9623, 0.6812]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con36748').set_weights(w) 
in0Con36748 = tf.constant([[[0.4919]]])
in0Min98947 = tf.constant([[[0.4204, 0.6427], [0.9815, 0.866]]])
in1Min98947 = tf.constant([[[0.818, 0.7804], [0.2667, 0.932]]])
in0Max65442 = tf.constant([[[[1.5122]]]])
print (np.array2string(model.predict([in0Con36748,in0Min98947,in1Min98947,in0Max65442],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max90649.png')

LCon36748 = conv1D_layer([[[0.4919]]], 1,[[[0.1011, 0.9623, 0.6812]]],[0, 0, 0], 1, false, 1, Con36748), 
LRes498 = reshape_layer(Con36748, [1, 3, 1], Res498), 
LGlo76042 = global_max_pool2D_layer(Res498, Glo76042), 
LRes87238 = reshape_layer(Glo76042, [1, 1], Res87238), 
LGlo13622 = global_average_pooling1D_layer(Res87238, Glo13622), 
LRes463 = reshape_layer(Glo13622, [1, 1], Res463), 
LRes48153 = reshape_layer(Res463, [1, 1, 1], Res48153), 
LZer18203 = zero_padding2D_layer(Res48153, 1, 0, 1, 0, Zer18203), 
LMin98947 = minimum_layer([[[[0.4204, 0.6427], [0.9815, 0.866]]], [[[0.818, 0.7804], [0.2667, 0.932]]]], Min98947), 
LRes74058 = reshape_layer(Min98947, [2, 2, 1], Res74058), 
LMax65442 = max_pool2D_layer([[[[1.5122]]]], 1, 1, Max65442), 
LZer81320 = zero_padding2D_layer(Max65442, 1, 0, 1, 0, Zer81320), 
LAve4236 = average_layer([Res74058,Zer81320], Ave4236), 
LSub36243 = subtract_layer(Zer18203,Ave4236, Sub36243), 
LMax90649 = max_pool2D_layer(Sub36243, 2, 1, Max90649), 
exec_layers([LCon36748,LRes498,LGlo76042,LRes87238,LGlo13622,LRes463,LRes48153,LZer18203,LMin98947,LRes74058,LMax65442,LZer81320,LAve4236,LSub36243,LMax90649],["Con36748","Res498","Glo76042","Res87238","Glo13622","Res463","Res48153","Zer18203","Min98947","Res74058","Max65442","Zer81320","Ave4236","Sub36243","Max90649"],Max90649,"Max90649")

Actual (Unparsed): [[[[-0.1333500], [-0.3213500]]]]

Expected (Unparsed): [[[[-0.13335],[-0.32135]]]]

Actual:   [[[[-0.1333], [-0.3213]]]]

Expected: [[[[-0.1333], [-0.3213]]]]