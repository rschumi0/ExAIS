import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot68824 = tf.keras.layers.Input(shape=([2]))
in1Dot68824 = tf.keras.layers.Input(shape=([2]))
in0Con6013 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Add69050 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Add69050 = tf.keras.layers.Input(shape=([1, 2, 2]))

Dot68824 = keras.layers.Dot(axes=(1, 1), name = 'Dot68824', )([in0Dot68824,in1Dot68824])
Res37918 = keras.layers.Reshape((1, 1), name = 'Res37918', )(Dot68824)
Loc88525 = keras.layers.LocallyConnected1D(3, (1),strides=(1), name = 'Loc88525', )(Res37918)
Fla1785 = keras.layers.Flatten(name = 'Fla1785', )(Loc88525)
Res4110 = keras.layers.Reshape((3, 1), name = 'Res4110', )(Fla1785)
Res10982 = keras.layers.Reshape((3, 1, 1), name = 'Res10982', )(Res4110)
Zer73730 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer73730', )(Res10982)
Con6013 = keras.layers.Concatenate(axis=3, name = 'Con6013', )([Zer73730,in0Con6013])
Add69050 = keras.layers.Add(name = 'Add69050', )([in0Add69050,in1Add69050])
Zer99035 = keras.layers.ZeroPadding2D(padding=((2, 0), (1, 0)), name = 'Zer99035', )(Add69050)
Add4391 = keras.layers.Add(name = 'Add4391', )([Con6013,Zer99035])
Res2498 = keras.layers.Reshape((3, 6), name = 'Res2498', )(Add4391)
GRU99454 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU99454', )(Res2498)
model = tf.keras.models.Model(inputs=[in0Dot68824,in1Dot68824,in0Con6013,in0Add69050,in1Add69050], outputs=GRU99454)
w = model.get_layer('Loc88525').get_weights() 
w[0] = np.array([[[0.3041, 0.0983, 0.5723]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc88525').set_weights(w) 
w = model.get_layer('GRU99454').get_weights() 
w[0] = np.array([[8, 7, 3, 5, 7, 4, 2, 5, 5], [3, 10, 2, 3, 4, 8, 5, 4, 5], [4, 1, 10, 1, 7, 10, 10, 10, 3], [6, 2, 5, 2, 5, 10, 5, 10, 10], [1, 1, 7, 2, 6, 7, 4, 1, 1], [2, 10, 10, 8, 2, 8, 4, 8, 1]])
w[1] = np.array([[4, 10, 8, 7, 7, 6, 3, 5, 9], [5, 10, 8, 5, 9, 1, 5, 5, 4], [8, 5, 1, 9, 9, 8, 2, 2, 1]])
w[2] = np.array([4, 4, 3, 9, 8, 7, 2, 2, 5])
model.get_layer('GRU99454').set_weights(w) 
in0Dot68824 = tf.constant([[0.5422, 0.6676]])
in1Dot68824 = tf.constant([[0.0366, 0.2163]])
in0Con6013 = tf.constant([[[[0.1128], [0.4807], [0.5791]], [[0.1208], [0.4136], [0.9848]], [[0.4963], [0.8653], [0.1824]]]])
in0Add69050 = tf.constant([[[[0.7162, 0.4718], [0.3858, 0.9487]]]])
in1Add69050 = tf.constant([[[[0.7529, 0.7254], [0.0327, 0.1345]]]])
print (np.array2string(model.predict([in0Dot68824,in1Dot68824,in0Con6013,in0Add69050,in1Add69050],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU99454.png')

LDot68824 = dot_layer([[0.5422, 0.6676]], [[0.0366, 0.2163]], 1, 1, Dot68824), 
LRes37918 = reshape_layer(Dot68824, [1, 1], Res37918), 
LLoc88525 = locally_connected1D_layer(Res37918, 1,[[[0.3041, 0.0983, 0.5723]]],[[0, 0, 0]], 1, Loc88525), 
LFla1785 = flatten_layer(Loc88525, Fla1785), 
LRes4110 = reshape_layer(Fla1785, [3, 1], Res4110), 
LRes10982 = reshape_layer(Res4110, [3, 1, 1], Res10982), 
LZer73730 = zero_padding2D_layer(Res10982, 0, 0, 2, 0, Zer73730), 
LCon6013 = concatenate_layer([Zer73730,[[[[0.1128], [0.4807], [0.5791]], [[0.1208], [0.4136], [0.9848]], [[0.4963], [0.8653], [0.1824]]]]], 3, Con6013), 
LAdd69050 = add_layer([[[[[0.7162, 0.4718], [0.3858, 0.9487]]]], [[[[0.7529, 0.7254], [0.0327, 0.1345]]]]], Add69050), 
LZer99035 = zero_padding2D_layer(Add69050, 2, 0, 1, 0, Zer99035), 
LAdd4391 = add_layer([Con6013,Zer99035], Add4391), 
LRes2498 = reshape_layer(Add4391, [3, 6], Res2498), 
LGRU99454 = gru_layer(Res2498,[[8, 7, 3, 5, 7, 4, 2, 5, 5], [3, 10, 2, 3, 4, 8, 5, 4, 5], [4, 1, 10, 1, 7, 10, 10, 10, 3], [6, 2, 5, 2, 5, 10, 5, 10, 10], [1, 1, 7, 2, 6, 7, 4, 1, 1], [2, 10, 10, 8, 2, 8, 4, 8, 1]],[[4, 10, 8, 7, 7, 6, 3, 5, 9], [5, 10, 8, 5, 9, 1, 5, 5, 4], [8, 5, 1, 9, 9, 8, 2, 2, 1]],[4, 4, 3, 9, 8, 7, 2, 2, 5], false, GRU99454), 
exec_layers([LDot68824,LRes37918,LLoc88525,LFla1785,LRes4110,LRes10982,LZer73730,LCon6013,LAdd69050,LZer99035,LAdd4391,LRes2498,LGRU99454],["Dot68824","Res37918","Loc88525","Fla1785","Res4110","Res10982","Zer73730","Con6013","Add69050","Zer99035","Add4391","Res2498","GRU99454"],GRU99454,"GRU99454")

Actual (Unparsed): [[0.0003641, 0.0000067, 0.0000080]]

Expected (Unparsed): [[0.0003641316432736455,6.711554317476762e-6,7.968076659572123e-6]]

Actual:   [[0.0004, 0, 0]]

Expected: [[0.0004, 0, 0]]