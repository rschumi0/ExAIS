import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave53510 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Ave53510 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Ave73480 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave73480 = tf.keras.layers.Input(shape=([2, 2]))
in0Con94448 = tf.keras.layers.Input(shape=([2, 2]))

Ave53510 = keras.layers.Average(name = 'Ave53510', )([in0Ave53510,in1Ave53510])
Res34541 = keras.layers.Reshape((2, 4), name = 'Res34541', )(Ave53510)
Ave73480 = keras.layers.Average(name = 'Ave73480', )([in0Ave73480,in1Ave73480])
Con94448 = keras.layers.Concatenate(axis=2, name = 'Con94448', )([Ave73480,in0Con94448])
Sub79369 = keras.layers.Subtract(name = 'Sub79369', )([Res34541,Con94448])
Per38901 = keras.layers.Permute((2,1), name = 'Per38901',)(Sub79369)
model = tf.keras.models.Model(inputs=[in0Ave53510,in1Ave53510,in0Ave73480,in1Ave73480,in0Con94448], outputs=Per38901)
in0Ave53510 = tf.constant([[[[0.368, 0.7127], [0.7015, 0.0186]], [[0.553, 0.8261], [0.0779, 0.7901]]]])
in1Ave53510 = tf.constant([[[[0.3299, 0.0503], [0.1676, 0.978]], [[0.187, 0.8122], [0.6877, 0.4476]]]])
in0Ave73480 = tf.constant([[[0.3591, 0.3751], [0.8847, 0.7775]]])
in1Ave73480 = tf.constant([[[0.0904, 0.1014], [0.9125, 0.4166]]])
in0Con94448 = tf.constant([[[0.2339, 0.2423], [0.9787, 0.0803]]])
print (np.array2string(model.predict([in0Ave53510,in1Ave53510,in0Ave73480,in1Ave73480,in0Con94448],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Per38901.png')

LAve53510 = average_layer([[[[[0.368, 0.7127], [0.7015, 0.0186]], [[0.553, 0.8261], [0.0779, 0.7901]]]], [[[[0.3299, 0.0503], [0.1676, 0.978]], [[0.187, 0.8122], [0.6877, 0.4476]]]]], Ave53510), 
LRes34541 = reshape_layer(Ave53510, [2, 4], Res34541), 
LAve73480 = average_layer([[[[0.3591, 0.3751], [0.8847, 0.7775]]], [[[0.0904, 0.1014], [0.9125, 0.4166]]]], Ave73480), 
LCon94448 = concatenate_layer([Ave73480,[[[0.2339, 0.2423], [0.9787, 0.0803]]]], 2, Con94448), 
LSub79369 = subtract_layer(Res34541,Con94448, Sub79369), 
LPer38901 = permute_layer(Sub79369, 2,1, Per38901), 
exec_layers([LAve53510,LRes34541,LAve73480,LCon94448,LSub79369,LPer38901],["Ave53510","Res34541","Ave73480","Con94448","Sub79369","Per38901"],Per38901,"Per38901")

Actual (Unparsed): [[[0.1242000, -0.5286000], [0.1432500, 0.2221000], [0.2006500, -0.5959000], [0.2560000, 0.5385500]]]

Expected (Unparsed): [[[0.1242,-0.5286000000000001],[0.14325000000000002,0.22210000000000008],[0.20065,-0.5959000000000001],[0.256,0.53855]]]

Actual:   [[[0.1242, -0.5286], [0.1433, 0.2221], [0.2007, -0.5959], [0.256, 0.5386]]]

Expected: [[[0.1242, -0.5286], [0.1433, 0.2222], [0.2007, -0.5959], [0.256, 0.5386]]]