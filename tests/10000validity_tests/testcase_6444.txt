import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min59709 = tf.keras.layers.Input(shape=([2, 2]))
in1Min59709 = tf.keras.layers.Input(shape=([2, 2]))
in0Sub88125 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub88125 = tf.keras.layers.Input(shape=([2, 2]))
in0Lay46517 = tf.keras.layers.Input(shape=([4, 1]))
in0Min28842 = tf.keras.layers.Input(shape=([2, 1]))
in1Min28842 = tf.keras.layers.Input(shape=([2, 1]))

Min59709 = keras.layers.Minimum(name = 'Min59709', )([in0Min59709,in1Min59709])
Zer23934 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer23934', )(Min59709)
Sub88125 = keras.layers.Subtract(name = 'Sub88125', )([in0Sub88125,in1Sub88125])
Up_51597 = keras.layers.UpSampling1D(size=(2), name = 'Up_51597', )(Sub88125)
Add86317 = keras.layers.Add(name = 'Add86317', )([Zer23934,Up_51597])
LST77316 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST77316', )(Add86317)
Res97672 = keras.layers.Reshape((2, 1), name = 'Res97672', )(LST77316)
Zer53725 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer53725', )(Res97672)
Lay46517 = keras.layers.LayerNormalization(axis=2, epsilon=2.973659365213053, name = 'Lay46517', )(in0Lay46517)
Min28842 = keras.layers.Minimum(name = 'Min28842', )([in0Min28842,in1Min28842])
Zer2582 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer2582', )(Min28842)
Sub35710 = keras.layers.Subtract(name = 'Sub35710', )([Lay46517,Zer2582])
Mul60717 = keras.layers.Multiply(name = 'Mul60717', )([Zer53725,Sub35710])
model = tf.keras.models.Model(inputs=[in0Min59709,in1Min59709,in0Sub88125,in1Sub88125,in0Lay46517,in0Min28842,in1Min28842], outputs=Mul60717)
w = model.get_layer('LST77316').get_weights() 
w[0] = np.array([[2, 5, 5, 4, 7, 8, 9, 8], [8, 3, 4, 3, 5, 9, 10, 5]])
w[1] = np.array([[9, 9, 7, 2, 8, 4, 7, 7], [1, 6, 6, 1, 2, 3, 8, 6]])
w[2] = np.array([2, 2, 9, 5, 3, 8, 3, 6])
model.get_layer('LST77316').set_weights(w) 
in0Min59709 = tf.constant([[[0.0001, 0.4492], [0.7131, 0.922]]])
in1Min59709 = tf.constant([[[0.7979, 0.2847], [0.547, 0.2736]]])
in0Sub88125 = tf.constant([[[0.7575, 0.3889], [0.3695, 0.7351]]])
in1Sub88125 = tf.constant([[[0.2938, 0.1035], [0.37, 0.8557]]])
in0Lay46517 = tf.constant([[[1.874], [1.2735], [1.7522], [1.1538]]])
in0Min28842 = tf.constant([[[0.3323], [0.794]]])
in1Min28842 = tf.constant([[[0.9291], [0.2331]]])
print (np.array2string(model.predict([in0Min59709,in1Min59709,in0Sub88125,in1Sub88125,in0Lay46517,in0Min28842,in1Min28842],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul60717.png')

LMin59709 = minimum_layer([[[[0.0001, 0.4492], [0.7131, 0.922]]], [[[0.7979, 0.2847], [0.547, 0.2736]]]], Min59709), 
LZer23934 = zero_padding1D_layer(Min59709, 2, 0, Zer23934), 
LSub88125 = subtract_layer([[[0.7575, 0.3889], [0.3695, 0.7351]]], [[[0.2938, 0.1035], [0.37, 0.8557]]], Sub88125), 
LUp_51597 = up_sampling1D_layer(Sub88125, 2, Up_51597), 
LAdd86317 = add_layer([Zer23934,Up_51597], Add86317), 
LLST77316 = lstm_layer(Add86317,[[2, 5, 5, 4, 7, 8, 9, 8], [8, 3, 4, 3, 5, 9, 10, 5]],[[9, 9, 7, 2, 8, 4, 7, 7], [1, 6, 6, 1, 2, 3, 8, 6]],[2, 2, 9, 5, 3, 8, 3, 6], LST77316), 
LRes97672 = reshape_layer(LST77316, [2, 1], Res97672), 
LZer53725 = zero_padding1D_layer(Res97672, 2, 0, Zer53725), 
LLay46517 = layer_normalization_layer([[[1.874], [1.2735], [1.7522], [1.1538]]], 2, 2.973659365213053, Lay46517), 
LMin28842 = minimum_layer([[[[0.3323], [0.794]]], [[[0.9291], [0.2331]]]], Min28842), 
LZer2582 = zero_padding1D_layer(Min28842, 2, 0, Zer2582), 
LSub35710 = subtract_layer(Lay46517,Zer2582, Sub35710), 
LMul60717 = multiply_layer([Zer53725,Sub35710], Mul60717), 
exec_layers([LMin59709,LZer23934,LSub88125,LUp_51597,LAdd86317,LLST77316,LRes97672,LZer53725,LLay46517,LMin28842,LZer2582,LSub35710,LMul60717],["Min59709","Zer23934","Sub88125","Up_51597","Add86317","LST77316","Res97672","Zer53725","Lay46517","Min28842","Zer2582","Sub35710","Mul60717"],Mul60717,"Mul60717")

Actual (Unparsed): [[[0.0000000], [0.0000000], [-0.3320747], [-0.2329417]]]

Expected (Unparsed): [[[0.0],[0.0],[-0.332074691284216],[-0.23294170944623285]]]

Actual:   [[[0], [0], [-0.332], [-0.2329]]]

Expected: [[[0], [0], [-0.332], [-0.2329]]]