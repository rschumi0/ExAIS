import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave40917 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Ave40917 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Mul98824 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul98824 = tf.keras.layers.Input(shape=([2, 1]))

Ave40917 = keras.layers.Average(name = 'Ave40917', )([in0Ave40917,in1Ave40917])
Res20749 = keras.layers.Reshape((2, 2), name = 'Res20749', )(Ave40917)
Sep57049 = keras.layers.SeparableConv1D(4, (1),strides=(1), padding='valid', name = 'Sep57049', )(Res20749)
Mul98824 = keras.layers.Multiply(name = 'Mul98824', )([in0Mul98824,in1Mul98824])
Dot34442 = keras.layers.Dot(axes=(1, 1), name = 'Dot34442', )([Sep57049,Mul98824])
Res48356 = keras.layers.Reshape((4, 1, 1), name = 'Res48356', )(Dot34442)
Cro72405 = keras.layers.Cropping2D(cropping=((0, 2), (0, 0)), name = 'Cro72405', )(Res48356)
Res93463 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res93463', )(Cro72405)
Con83571 = keras.layers.Conv3D(4, (2, 1, 1),strides=(5, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con83571', )(Res93463)
model = tf.keras.models.Model(inputs=[in0Ave40917,in1Ave40917,in0Mul98824,in1Mul98824], outputs=Con83571)
w = model.get_layer('Sep57049').get_weights() 
w[0] = np.array([[[0.0547], [0.069]]])
w[1] = np.array([[[0.8388, 0.4145, 0.847, 0.6796], [0.5973, 0.4307, 0.9975, 0.1707]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep57049').set_weights(w) 
w = model.get_layer('Con83571').get_weights() 
w[0] = np.array([[[[[0.2158, 0.7682, 0.2135, 0.1404]]]], [[[[0.7369, 0.9271, 0.5226, 0.3155]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con83571').set_weights(w) 
in0Ave40917 = tf.constant([[[[0.006, 0.0089]], [[0.8396, 0.6949]]]])
in1Ave40917 = tf.constant([[[[0.9655, 0.2398]], [[0.3688, 0.2816]]]])
in0Mul98824 = tf.constant([[[0.0978], [0.8803]]])
in1Mul98824 = tf.constant([[[0.8645], [0.1603]]])
print (np.array2string(model.predict([in0Ave40917,in1Ave40917,in0Mul98824,in1Mul98824],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con83571.png')

LAve40917 = average_layer([[[[[0.006, 0.0089]], [[0.8396, 0.6949]]]], [[[[0.9655, 0.2398]], [[0.3688, 0.2816]]]]], Ave40917), 
LRes20749 = reshape_layer(Ave40917, [2, 2], Res20749), 
LSep57049 = separable_conv1D_layer(Res20749, 1,[[[[0.0547], [0.069]]],[[[0.8388, 0.4145, 0.847, 0.6796], [0.5973, 0.4307, 0.9975, 0.1707]]]],[0, 0, 0, 0], 1, false, Sep57049), 
LMul98824 = multiply_layer([[[[0.0978], [0.8803]]], [[[0.8645], [0.1603]]]], Mul98824), 
LDot34442 = dot_layer(Sep57049,Mul98824, 1, 1, Dot34442), 
LRes48356 = reshape_layer(Dot34442, [4, 1, 1], Res48356), 
LCro72405 = cropping2D_layer(Res48356, 0, 2, 0, 0, Cro72405), 
LRes93463 = reshape_layer(Cro72405, [2, 1, 1, 1], Res93463), 
LCon83571 = conv3D_layer(Res93463, 2, 1, 1,[[[[[0.2158, 0.7682, 0.2135, 0.1404]]]], [[[[0.7369, 0.9271, 0.5226, 0.3155]]]]],[0, 0, 0, 0], 5, 1, 1, false, 1, 1, 1, Con83571), 
exec_layers([LAve40917,LRes20749,LSep57049,LMul98824,LDot34442,LRes48356,LCro72405,LRes93463,LCon83571],["Ave40917","Res20749","Sep57049","Mul98824","Dot34442","Res48356","Cro72405","Res93463","Con83571"],Con83571,"Con83571")

Actual (Unparsed): [[[[[0.0058069, 0.0118103, 0.0046665, 0.0029216]]]]]

Expected (Unparsed): [[[[[0.005806870982050359,0.011810308187054098,0.00466645396136965,0.0029215576503709905]]]]]

Actual:   [[[[[0.0059, 0.0119, 0.0047, 0.003]]]]]

Expected: [[[[[0.0059, 0.0119, 0.0047, 0.003]]]]]