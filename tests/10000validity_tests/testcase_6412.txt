import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub2568 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Sub2568 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Ave21830 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Ave21830 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in0Add13201 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Add13201 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Con4748 = tf.keras.layers.Input(shape=([1, 6]))

Sub2568 = keras.layers.Subtract(name = 'Sub2568', )([in0Sub2568,in1Sub2568])
Res60355 = keras.layers.Reshape((2, 4), name = 'Res60355', )(Sub2568)
Fla88922 = keras.layers.Flatten(name = 'Fla88922', )(Res60355)
Res33844 = keras.layers.Reshape((8, 1), name = 'Res33844', )(Fla88922)
Per40950 = keras.layers.Permute((2,1), name = 'Per40950',)(Res33844)
Ave21830 = keras.layers.Average(name = 'Ave21830', )([in0Ave21830,in1Ave21830])
Res38473 = keras.layers.Reshape((1, 1, 4), name = 'Res38473', )(Ave21830)
Res65994 = keras.layers.Reshape((1, 4), name = 'Res65994', )(Res38473)
Add13201 = keras.layers.Add(name = 'Add13201', )([in0Add13201,in1Add13201])
Res16644 = keras.layers.Reshape((2, 2, 2), name = 'Res16644', )(Add13201)
Res20362 = keras.layers.Reshape((2, 4), name = 'Res20362', )(Res16644)
Dot67331 = keras.layers.Dot(axes=(2, 2), name = 'Dot67331', )([Res65994,Res20362])
Con4748 = keras.layers.Concatenate(axis=2, name = 'Con4748', )([Dot67331,in0Con4748])
Sub53444 = keras.layers.Subtract(name = 'Sub53444', )([Per40950,Con4748])
model = tf.keras.models.Model(inputs=[in0Sub2568,in1Sub2568,in0Ave21830,in1Ave21830,in0Add13201,in1Add13201,in0Con4748], outputs=Sub53444)
in0Sub2568 = tf.constant([[[[0.926, 0.4508], [0.0584, 0.9814]], [[0.6024, 0.5572], [0.8992, 0.2495]]]])
in1Sub2568 = tf.constant([[[[0.7005, 0.4499], [0.0202, 0.0522]], [[0.1609, 0.9716], [0.3236, 0.0201]]]])
in0Ave21830 = tf.constant([[[[[0.8412, 0.4073], [0.509, 0.7318]]]]])
in1Ave21830 = tf.constant([[[[[0.6376, 0.0447], [0.7372, 0.5736]]]]])
in0Add13201 = tf.constant([[[[[0.2866], [0.0537]], [[0.2721], [0.0192]]], [[[0.2019], [0.7733]], [[0.9749], [0.1353]]]]])
in1Add13201 = tf.constant([[[[[0.1315], [0.6624]], [[0.9874], [0.8321]]], [[[0.3647], [0.3612]], [[0.1731], [0.4225]]]]])
in0Con4748 = tf.constant([[[0.4649, 0.7827, 0.6368, 0.9161, 0.9084, 0.5261]]])
print (np.array2string(model.predict([in0Sub2568,in1Sub2568,in0Ave21830,in1Ave21830,in0Add13201,in1Add13201,in0Con4748],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub53444.png')

LSub2568 = subtract_layer([[[[0.926, 0.4508], [0.0584, 0.9814]], [[0.6024, 0.5572], [0.8992, 0.2495]]]], [[[[0.7005, 0.4499], [0.0202, 0.0522]], [[0.1609, 0.9716], [0.3236, 0.0201]]]], Sub2568), 
LRes60355 = reshape_layer(Sub2568, [2, 4], Res60355), 
LFla88922 = flatten_layer(Res60355, Fla88922), 
LRes33844 = reshape_layer(Fla88922, [8, 1], Res33844), 
LPer40950 = permute_layer(Res33844, 2,1, Per40950), 
LAve21830 = average_layer([[[[[[0.8412, 0.4073], [0.509, 0.7318]]]]], [[[[[0.6376, 0.0447], [0.7372, 0.5736]]]]]], Ave21830), 
LRes38473 = reshape_layer(Ave21830, [1, 1, 4], Res38473), 
LRes65994 = reshape_layer(Res38473, [1, 4], Res65994), 
LAdd13201 = add_layer([[[[[[0.2866], [0.0537]], [[0.2721], [0.0192]]], [[[0.2019], [0.7733]], [[0.9749], [0.1353]]]]], [[[[[0.1315], [0.6624]], [[0.9874], [0.8321]]], [[[0.3647], [0.3612]], [[0.1731], [0.4225]]]]]], Add13201), 
LRes16644 = reshape_layer(Add13201, [2, 2, 2], Res16644), 
LRes20362 = reshape_layer(Res16644, [2, 4], Res20362), 
LDot67331 = dot_layer(Res65994,Res20362, 2, 2, Dot67331), 
LCon4748 = concatenate_layer([Dot67331,[[[0.4649, 0.7827, 0.6368, 0.9161, 0.9084, 0.5261]]]], 2, Con4748), 
LSub53444 = subtract_layer(Per40950,Con4748, Sub53444), 
exec_layers([LSub2568,LRes60355,LFla88922,LRes33844,LPer40950,LAve21830,LRes38473,LRes65994,LAdd13201,LRes16644,LRes20362,LDot67331,LCon4748,LSub53444],["Sub2568","Res60355","Fla88922","Res33844","Per40950","Ave21830","Res38473","Res65994","Add13201","Res16644","Res20362","Dot67331","Con4748","Sub53444"],Sub53444,"Sub53444")

Actual (Unparsed): [[[-1.5859197, -1.7538359, -0.4267000, 0.1465000, -0.1953000, -1.3305000, -0.3328000, -0.2967000]]]

Expected (Unparsed): [[[-1.5859197,-1.7538359000000001,-0.42669999999999997,0.14650000000000007,-0.19529999999999997,-1.3305,-0.3328,-0.2967]]]

Actual:   [[[-1.5859, -1.7538, -0.4267, 0.1465, -0.1953, -1.3305, -0.3328, -0.2967]]]

Expected: [[[-1.5859, -1.7538, -0.4266, 0.1466, -0.1952, -1.3305, -0.3328, -0.2967]]]