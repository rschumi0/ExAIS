import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave76959 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Ave76959 = tf.keras.layers.Input(shape=([2, 2, 2]))

Ave76959 = keras.layers.Average(name = 'Ave76959', )([in0Ave76959,in1Ave76959])
Res87904 = keras.layers.Reshape((2, 4), name = 'Res87904', )(Ave76959)
Loc89107 = keras.layers.LocallyConnected1D(3, (2),strides=(1), name = 'Loc89107', )(Res87904)
model = tf.keras.models.Model(inputs=[in0Ave76959,in1Ave76959], outputs=Loc89107)
w = model.get_layer('Loc89107').get_weights() 
w[0] = np.array([[[0.4086, 0.1, 0.511], [0.5135, 0.5439, 0.2412], [0.3905, 0.6439, 0.533], [0.2859, 0.5093, 0.0024], [0.0506, 0.24, 0.1069], [0.2014, 0.055, 0.6436], [0.8561, 0.8798, 0.0693], [0.1093, 0.7042, 0.7883]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc89107').set_weights(w) 
in0Ave76959 = tf.constant([[[[0.0901, 0.3591], [0.1577, 0.7216]], [[0.5891, 0.3191], [0.8302, 0.0759]]]])
in1Ave76959 = tf.constant([[[[0.3903, 0.0568], [0.5853, 0.0561]], [[0.1115, 0.2702], [0.73, 0.1186]]]])
print (np.array2string(model.predict([in0Ave76959,in1Ave76959],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc89107.png')

LAve76959 = average_layer([[[[[0.0901, 0.3591], [0.1577, 0.7216]], [[0.5891, 0.3191], [0.8302, 0.0759]]]], [[[[0.3903, 0.0568], [0.5853, 0.0561]], [[0.1115, 0.2702], [0.73, 0.1186]]]]], Ave76959), 
LRes87904 = reshape_layer(Ave76959, [2, 4], Res87904), 
LLoc89107 = locally_connected1D_layer(Res87904, 2,[[[0.4086, 0.1, 0.511], [0.5135, 0.5439, 0.2412], [0.3905, 0.6439, 0.533], [0.2859, 0.5093, 0.0024], [0.0506, 0.24, 0.1069], [0.2014, 0.055, 0.6436], [0.8561, 0.8798, 0.0693], [0.1093, 0.7042, 0.7883]]],[[0, 0, 0]], 1, Loc89107), 
exec_layers([LAve76959,LRes87904,LLoc89107],["Ave76959","Res87904","Loc89107"],Loc89107,"Loc89107")

Actual (Unparsed): [[[1.2167118, 1.4294674, 0.7296494]]]

Expected (Unparsed): [[[1.216711735,1.4294673400000002,0.729649395]]]

Actual:   [[[1.2168, 1.4295, 0.7297]]]

Expected: [[[1.2168, 1.4295, 0.7297]]]