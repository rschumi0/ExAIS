import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min54072 = tf.keras.layers.Input(shape=([2, 2]))
in1Min54072 = tf.keras.layers.Input(shape=([2, 2]))
in0Con16888 = tf.keras.layers.Input(shape=([4, 3]))
in0Cro3686 = tf.keras.layers.Input(shape=([2, 1]))
in0Con67419 = tf.keras.layers.Input(shape=([4, 3]))
in0Up_67497 = tf.keras.layers.Input(shape=([4, 4]))

Min54072 = keras.layers.Minimum(name = 'Min54072', )([in0Min54072,in1Min54072])
Sim52057 = keras.layers.SimpleRNN(2,name = 'Sim52057', )(Min54072)
Res86083 = keras.layers.Reshape((2, 1), name = 'Res86083', )(Sim52057)
Zer43272 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer43272', )(Res86083)
Con16888 = keras.layers.Concatenate(axis=2, name = 'Con16888', )([Zer43272,in0Con16888])
Cro3686 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro3686', )(in0Cro3686)
Zer19926 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer19926', )(Cro3686)
Con67419 = keras.layers.Concatenate(axis=2, name = 'Con67419', )([Zer19926,in0Con67419])
Up_67497 = keras.layers.UpSampling1D(size=(1), name = 'Up_67497', )(in0Up_67497)
Max34903 = keras.layers.Maximum(name = 'Max34903', )([Con67419,Up_67497])
Sub63530 = keras.layers.Subtract(name = 'Sub63530', )([Con16888,Max34903])
GRU85509 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU85509', )(Sub63530)
model = tf.keras.models.Model(inputs=[in0Min54072,in1Min54072,in0Con16888,in0Cro3686,in0Con67419,in0Up_67497], outputs=GRU85509)
w = model.get_layer('Sim52057').get_weights() 
w[0] = np.array([[2, 2], [8, 6]])
w[1] = np.array([[1, 9], [8, 8]])
w[2] = np.array([3, 9])
model.get_layer('Sim52057').set_weights(w) 
w = model.get_layer('GRU85509').get_weights() 
w[0] = np.array([[4, 8, 3], [2, 1, 7], [5, 7, 4], [7, 1, 10]])
w[1] = np.array([[10, 6, 2]])
w[2] = np.array([1, 7, 6])
model.get_layer('GRU85509').set_weights(w) 
in0Min54072 = tf.constant([[[0.1437, 0.5422], [0.7956, 0.649]]])
in1Min54072 = tf.constant([[[0.8445, 0.3181], [0.8725, 0.6702]]])
in0Con16888 = tf.constant([[[0.5158, 0.2617, 0.8659], [0.1127, 0.9856, 0.0622], [0.6142, 0.8165, 0.0672], [0.3261, 0.0223, 0.0942]]])
in0Cro3686 = tf.constant([[[1.5633], [1.5887]]])
in0Con67419 = tf.constant([[[0.902, 0.8475, 0.7904], [0.9697, 0.9404, 0.5719], [0.3273, 0.5376, 0.8087], [0.6096, 0.0211, 0.2014]]])
in0Up_67497 = tf.constant([[[1.4469, 1.0876, 1.9674, 1.0458], [1.9122, 1.9664, 1.2152, 1.6998], [1.1733, 1.0436, 1.021, 1.3677], [1.4455, 1.0965, 1.0918, 1.1036]]])
print (np.array2string(model.predict([in0Min54072,in1Min54072,in0Con16888,in0Cro3686,in0Con67419,in0Up_67497],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU85509.png')

LMin54072 = minimum_layer([[[[0.1437, 0.5422], [0.7956, 0.649]]], [[[0.8445, 0.3181], [0.8725, 0.6702]]]], Min54072), 
LSim52057 = simple_rnn_layer(Min54072,[[2, 2], [8, 6]],[[1, 9], [8, 8]],[3, 9], Sim52057), 
LRes86083 = reshape_layer(Sim52057, [2, 1], Res86083), 
LZer43272 = zero_padding1D_layer(Res86083, 2, 0, Zer43272), 
LCon16888 = concatenate_layer([Zer43272,[[[0.5158, 0.2617, 0.8659], [0.1127, 0.9856, 0.0622], [0.6142, 0.8165, 0.0672], [0.3261, 0.0223, 0.0942]]]], 2, Con16888), 
LCro3686 = cropping1D_layer([[[1.5633], [1.5887]]], 0, 0, Cro3686), 
LZer19926 = zero_padding1D_layer(Cro3686, 2, 0, Zer19926), 
LCon67419 = concatenate_layer([Zer19926,[[[0.902, 0.8475, 0.7904], [0.9697, 0.9404, 0.5719], [0.3273, 0.5376, 0.8087], [0.6096, 0.0211, 0.2014]]]], 2, Con67419), 
LUp_67497 = up_sampling1D_layer([[[1.4469, 1.0876, 1.9674, 1.0458], [1.9122, 1.9664, 1.2152, 1.6998], [1.1733, 1.0436, 1.021, 1.3677], [1.4455, 1.0965, 1.0918, 1.1036]]], 1, Up_67497), 
LMax34903 = maximum_layer([Con67419,Up_67497], Max34903), 
LSub63530 = subtract_layer(Con16888,Max34903, Sub63530), 
LGRU85509 = gru_layer(Sub63530,[[4, 8, 3], [2, 1, 7], [5, 7, 4], [7, 1, 10]],[[10, 6, 2]],[1, 7, 6], false, GRU85509), 
exec_layers([LMin54072,LSim52057,LRes86083,LZer43272,LCon16888,LCro3686,LZer19926,LCon67419,LUp_67497,LMax34903,LSub63530,LGRU85509],["Min54072","Sim52057","Res86083","Zer43272","Con16888","Cro3686","Zer19926","Con67419","Up_67497","Max34903","Sub63530","GRU85509"],GRU85509,"GRU85509")

Actual (Unparsed): [[-1.0000000]]

Expected (Unparsed): [[-0.9999999999999353]]

Actual:   [[-1]]

Expected: [[-0.9999]]