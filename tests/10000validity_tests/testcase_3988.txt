import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max18997 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Max18997 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Con44599 = tf.keras.layers.Input(shape=([3, 2]))
in0Mul73679 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Mul73679 = tf.keras.layers.Input(shape=([1, 2, 1]))

Max18997 = keras.layers.Maximum(name = 'Max18997', )([in0Max18997,in1Max18997])
Res95088 = keras.layers.Reshape((1, 2, 1), name = 'Res95088', )(Max18997)
Res32497 = keras.layers.Reshape((1, 2), name = 'Res32497', )(Res95088)
Zer59520 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer59520', )(Res32497)
Con44599 = keras.layers.Concatenate(axis=2, name = 'Con44599', )([Zer59520,in0Con44599])
Mul73679 = keras.layers.Multiply(name = 'Mul73679', )([in0Mul73679,in1Mul73679])
Res62423 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res62423', )(Mul73679)
Con59025 = keras.layers.Conv3D(2, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con59025', )(Res62423)
Res89463 = keras.layers.Reshape((1, 2, 2), name = 'Res89463', )(Con59025)
Res99165 = keras.layers.Reshape((1, 4), name = 'Res99165', )(Res89463)
Zer95854 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer95854', )(Res99165)
Sub21498 = keras.layers.Subtract(name = 'Sub21498', )([Con44599,Zer95854])
model = tf.keras.models.Model(inputs=[in0Max18997,in1Max18997,in0Con44599,in0Mul73679,in1Mul73679], outputs=Sub21498)
w = model.get_layer('Con59025').get_weights() 
w[0] = np.array([[[[[0.3099, 0.0764]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con59025').set_weights(w) 
in0Max18997 = tf.constant([[[[[0.8871]], [[0.6761]]]]])
in1Max18997 = tf.constant([[[[[0.5295]], [[0.5409]]]]])
in0Con44599 = tf.constant([[[0.987, 0.734], [0.4117, 0.7908], [0.517, 0.0934]]])
in0Mul73679 = tf.constant([[[[0.6293], [0.9138]]]])
in1Mul73679 = tf.constant([[[[0.5737], [0.0044]]]])
print (np.array2string(model.predict([in0Max18997,in1Max18997,in0Con44599,in0Mul73679,in1Mul73679],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub21498.png')

LMax18997 = maximum_layer([[[[[[0.8871]], [[0.6761]]]]], [[[[[0.5295]], [[0.5409]]]]]], Max18997), 
LRes95088 = reshape_layer(Max18997, [1, 2, 1], Res95088), 
LRes32497 = reshape_layer(Res95088, [1, 2], Res32497), 
LZer59520 = zero_padding1D_layer(Res32497, 2, 0, Zer59520), 
LCon44599 = concatenate_layer([Zer59520,[[[0.987, 0.734], [0.4117, 0.7908], [0.517, 0.0934]]]], 2, Con44599), 
LMul73679 = multiply_layer([[[[[0.6293], [0.9138]]]], [[[[0.5737], [0.0044]]]]], Mul73679), 
LRes62423 = reshape_layer(Mul73679, [1, 2, 1, 1], Res62423), 
LCon59025 = conv3D_layer(Res62423, 1, 1, 1,[[[[[0.3099, 0.0764]]]]],[0, 0], 1, 1, 1, true, 1, 1, 1, Con59025), 
LRes89463 = reshape_layer(Con59025, [1, 2, 2], Res89463), 
LRes99165 = reshape_layer(Res89463, [1, 4], Res99165), 
LZer95854 = zero_padding1D_layer(Res99165, 1, 1, Zer95854), 
LSub21498 = subtract_layer(Con44599,Zer95854, Sub21498), 
exec_layers([LMax18997,LRes95088,LRes32497,LZer59520,LCon44599,LMul73679,LRes62423,LCon59025,LRes89463,LRes99165,LZer95854,LSub21498],["Max18997","Res95088","Res32497","Zer59520","Con44599","Mul73679","Res62423","Con59025","Res89463","Res99165","Zer95854","Sub21498"],Sub21498,"Sub21498")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.9870000, 0.7340000], [-0.1118830, -0.0275826, 0.4104540, 0.7904928], [0.8871000, 0.6761000, 0.5170000, 0.0934000]]]

Expected (Unparsed): [[[0,0,0.987,0.734],[-0.111883014159,-0.027582646923999997,0.410453978872,0.7904928169919999],[0.8871,0.6761,0.517,0.0934]]]

Actual:   [[[0, 0, 0.987, 0.734], [-0.1118, -0.0275, 0.4105, 0.7905], [0.8871, 0.6761, 0.517, 0.0934]]]

Expected: [[[0, 0, 0.987, 0.734], [-0.1118, -0.0275, 0.4105, 0.7905], [0.8871, 0.6761, 0.517, 0.0934]]]