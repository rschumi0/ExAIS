import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Cro76187 = tf.keras.layers.Input(shape=([3, 4, 4]))
in0Sub91064 = tf.keras.layers.Input(shape=([3]))
in1Sub91064 = tf.keras.layers.Input(shape=([3]))
in0Con52970 = tf.keras.layers.Input(shape=([21]))

Cro76187 = keras.layers.Cropping2D(cropping=((0, 0), (1, 1)), name = 'Cro76187', )(in0Cro76187)
Res76229 = keras.layers.Reshape((3, 8), name = 'Res76229', )(Cro76187)
Fla5798 = keras.layers.Flatten(name = 'Fla5798', )(Res76229)
Sub91064 = keras.layers.Subtract(name = 'Sub91064', )([in0Sub91064,in1Sub91064])
Con52970 = keras.layers.Concatenate(axis=1, name = 'Con52970', )([Sub91064,in0Con52970])
Add36601 = keras.layers.Add(name = 'Add36601', )([Fla5798,Con52970])
model = tf.keras.models.Model(inputs=[in0Cro76187,in0Sub91064,in1Sub91064,in0Con52970], outputs=Add36601)
in0Cro76187 = tf.constant([[[[1.7977, 1.4153, 1.2273, 1.9916], [1.1273, 1.388, 1.1311, 1.5362], [1.6764, 1.0588, 1.4441, 1.3043], [1.0898, 1.7346, 1.7986, 1.2906]], [[1.8682, 1.5399, 1.7657, 1.2239], [1.4608, 1.2935, 1.3705, 1.8218], [1.7922, 1.8593, 1.0946, 1.5531], [1.2866, 1.769, 1.5326, 1.2655]], [[1.098, 1.7885, 1.521, 1.542], [1.175, 1.4942, 1.9989, 1.1925], [1.9946, 1.8595, 1.0803, 1.8544], [1.2833, 1.3122, 1.8169, 1.2835]]]])
in0Sub91064 = tf.constant([[0.8118, 0.7163, 0.9132]])
in1Sub91064 = tf.constant([[0.5456, 0.3973, 0.2583]])
in0Con52970 = tf.constant([[0.2616, 0.4787, 0.5326, 0.9591, 0.1856, 0.0424, 0.164, 0.6756, 0.2769, 0.9925, 0.2035, 0.4471, 0.4245, 0.7423, 0.863, 0.9685, 0.7742, 0.369, 0.8421, 0.6648, 0.2431]])
print (np.array2string(model.predict([in0Cro76187,in0Sub91064,in1Sub91064,in0Con52970],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add36601.png')

LCro76187 = cropping2D_layer([[[[1.7977, 1.4153, 1.2273, 1.9916], [1.1273, 1.388, 1.1311, 1.5362], [1.6764, 1.0588, 1.4441, 1.3043], [1.0898, 1.7346, 1.7986, 1.2906]], [[1.8682, 1.5399, 1.7657, 1.2239], [1.4608, 1.2935, 1.3705, 1.8218], [1.7922, 1.8593, 1.0946, 1.5531], [1.2866, 1.769, 1.5326, 1.2655]], [[1.098, 1.7885, 1.521, 1.542], [1.175, 1.4942, 1.9989, 1.1925], [1.9946, 1.8595, 1.0803, 1.8544], [1.2833, 1.3122, 1.8169, 1.2835]]]], 0, 0, 1, 1, Cro76187), 
LRes76229 = reshape_layer(Cro76187, [3, 8], Res76229), 
LFla5798 = flatten_layer(Res76229, Fla5798), 
LSub91064 = subtract_layer([[0.8118, 0.7163, 0.9132]], [[0.5456, 0.3973, 0.2583]], Sub91064), 
LCon52970 = concatenate_layer([Sub91064,[[0.2616, 0.4787, 0.5326, 0.9591, 0.1856, 0.0424, 0.164, 0.6756, 0.2769, 0.9925, 0.2035, 0.4471, 0.4245, 0.7423, 0.863, 0.9685, 0.7742, 0.369, 0.8421, 0.6648, 0.2431]]], 1, Con52970), 
LAdd36601 = add_layer([Fla5798,Con52970], Add36601), 
exec_layers([LCro76187,LRes76229,LFla5798,LSub91064,LCon52970,LAdd36601],["Cro76187","Res76229","Fla5798","Sub91064","Con52970","Add36601"],Add36601,"Add36601")

Actual (Unparsed): [[1.3935000, 1.7070000, 1.7860001, 1.7978000, 2.1551000, 1.5914000, 2.4032000, 1.4898999, 1.5032001, 1.4575000, 2.0461000, 2.0987000, 2.7847000, 2.0628000, 1.5417000, 1.9776000, 1.9172999, 2.3572000, 2.9674001, 1.9667000, 2.3636000, 2.7016001, 1.7451000, 2.0975000]]

Expected (Unparsed): [[1.3935,1.7069999999999999,1.786,1.7978,2.1551,1.5914,2.4032,1.4899,1.5032,1.4575,2.0461,2.0987,2.7847,2.0627999999999997,1.5417,1.9775999999999998,1.9173,2.3571999999999997,2.9674,1.9667,2.3636,2.7016,1.7450999999999999,2.0975]]

Actual:   [[1.3935, 1.707, 1.7861, 1.7978, 2.1551, 1.5914, 2.4032, 1.4899, 1.5033, 1.4575, 2.0461, 2.0987, 2.7847, 2.0628, 1.5417, 1.9776, 1.9173, 2.3572, 2.9675, 1.9667, 2.3636, 2.7017, 1.7451, 2.0975]]

Expected: [[1.3935, 1.707, 1.786, 1.7978, 2.1551, 1.5914, 2.4032, 1.4899, 1.5032, 1.4575, 2.0461, 2.0987, 2.7847, 2.0628, 1.5417, 1.9776, 1.9173, 2.3572, 2.9674, 1.9667, 2.3636, 2.7016, 1.7451, 2.0975]]