import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc29116 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Mul53733 = tf.keras.layers.Input(shape=([1, 2]))
in1Mul53733 = tf.keras.layers.Input(shape=([1, 2]))
in0Con93934 = tf.keras.layers.Input(shape=([1, 2]))

Loc29116 = keras.layers.LocallyConnected2D(4, (1, 1),strides=(1, 1), name = 'Loc29116', )(in0Loc29116)
Res81707 = keras.layers.Reshape((1, 4), name = 'Res81707', )(Loc29116)
Mul53733 = keras.layers.Multiply(name = 'Mul53733', )([in0Mul53733,in1Mul53733])
Con93934 = keras.layers.Concatenate(axis=2, name = 'Con93934', )([Mul53733,in0Con93934])
Max20265 = keras.layers.Maximum(name = 'Max20265', )([Res81707,Con93934])
Loc12572 = keras.layers.LocallyConnected1D(2, (1),strides=(1), name = 'Loc12572', )(Max20265)
Loc83018 = keras.layers.LocallyConnected1D(4, (1),strides=(3), name = 'Loc83018', )(Loc12572)
Res63375 = keras.layers.Reshape((1, 4, 1), name = 'Res63375', )(Loc83018)
Con59512 = keras.layers.Conv2DTranspose(4, (1, 1),strides=(1, 1), padding='same', name = 'Con59512', )(Res63375)
model = tf.keras.models.Model(inputs=[in0Loc29116,in0Mul53733,in1Mul53733,in0Con93934], outputs=Con59512)
w = model.get_layer('Loc29116').get_weights() 
w[0] = np.array([[[0.0415, 0.6497, 0.4479, 0.5526], [0.8706, 0.5768, 0.7419, 0.334]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc29116').set_weights(w) 
w = model.get_layer('Loc12572').get_weights() 
w[0] = np.array([[[0.3928, 0.1593], [0.2143, 0.7786], [0.1459, 0.5458], [0.7408, 0.3862]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc12572').set_weights(w) 
w = model.get_layer('Loc83018').get_weights() 
w[0] = np.array([[[0.7466, 0.1617, 0.4661, 0.3775], [0.3649, 0.4554, 0.0402, 0.2081]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc83018').set_weights(w) 
w = model.get_layer('Con59512').get_weights() 
w[0] = np.array([[[[0.9389], [0.7844], [0.3522], [0.7981]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con59512').set_weights(w) 
in0Loc29116 = tf.constant([[[[0.3039, 0.1492]]]])
in0Mul53733 = tf.constant([[[0.8068, 0.3911]]])
in1Mul53733 = tf.constant([[[0.8023, 0.9155]]])
in0Con93934 = tf.constant([[[0.0333, 0.6936]]])
print (np.array2string(model.predict([in0Loc29116,in0Mul53733,in1Mul53733,in0Con93934],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con59512.png')

LLoc29116 = locally_connected2D_layer([[[[0.3039, 0.1492]]]], 1, 1,[[[0.0415, 0.6497, 0.4479, 0.5526], [0.8706, 0.5768, 0.7419, 0.334]]],[[[0, 0, 0, 0]]], 1, 1, Loc29116), 
LRes81707 = reshape_layer(Loc29116, [1, 4], Res81707), 
LMul53733 = multiply_layer([[[[0.8068, 0.3911]]], [[[0.8023, 0.9155]]]], Mul53733), 
LCon93934 = concatenate_layer([Mul53733,[[[0.0333, 0.6936]]]], 2, Con93934), 
LMax20265 = maximum_layer([Res81707,Con93934], Max20265), 
LLoc12572 = locally_connected1D_layer(Max20265, 1,[[[0.3928, 0.1593], [0.2143, 0.7786], [0.1459, 0.5458], [0.7408, 0.3862]]],[[0, 0]], 1, Loc12572), 
LLoc83018 = locally_connected1D_layer(Loc12572, 1,[[[0.7466, 0.1617, 0.4661, 0.3775], [0.3649, 0.4554, 0.0402, 0.2081]]],[[0, 0, 0, 0]], 3, Loc83018), 
LRes63375 = reshape_layer(Loc83018, [1, 4, 1], Res63375), 
LCon59512 = conv2D_transpose_layer(Res63375, 1, 1,[[[[0.9389], [0.7844], [0.3522], [0.7981]]]],[0, 0, 0, 0], 1, 1, true, Con59512), 
exec_layers([LLoc29116,LRes81707,LMul53733,LCon93934,LMax20265,LLoc12572,LLoc83018,LRes63375,LCon59512],["Loc29116","Res81707","Mul53733","Con93934","Max20265","Loc12572","Loc83018","Res63375","Con59512"],Con59512,"Con59512")

Actual (Unparsed): [[[[0.8862001, 0.7403721, 0.3324312, 0.7533031], [0.4691454, 0.3919455, 0.1759857, 0.3987911], [0.4150729, 0.3467709, 0.1557021, 0.3528274], [0.4654657, 0.3888713, 0.1746054, 0.3956632]]]]

Expected (Unparsed): [[[[0.8862001294830328,0.7403721179747481,0.3324312340014104,0.7533031455324407],[0.46914539868437877,0.39194552213018075,0.17598573800898734,0.3987910775268961],[0.4150729049243658,0.34677088787162913,0.15570207382507367,0.3528274421345579],[0.4654656765599032,0.3888713139776207,0.17460540130407703,0.3956631765496419]]]]

Actual:   [[[[0.8863, 0.7404, 0.3325, 0.7534], [0.4692, 0.392, 0.176, 0.3988], [0.4151, 0.3468, 0.1558, 0.3529], [0.4655, 0.3889, 0.1747, 0.3957]]]]

Expected: [[[[0.8863, 0.7404, 0.3325, 0.7534], [0.4692, 0.392, 0.176, 0.3988], [0.4151, 0.3468, 0.1558, 0.3529], [0.4655, 0.3889, 0.1747, 0.3957]]]]