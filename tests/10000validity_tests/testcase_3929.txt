import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add9246 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Add9246 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con91106 = tf.keras.layers.Input(shape=([2, 1, 3]))
in0Dot76719 = tf.keras.layers.Input(shape=([3]))
in1Dot76719 = tf.keras.layers.Input(shape=([3]))

Add9246 = keras.layers.Add(name = 'Add9246', )([in0Add9246,in1Add9246])
Res94191 = keras.layers.Reshape((2, 2), name = 'Res94191', )(Add9246)
Glo75203 = keras.layers.GlobalMaxPool1D(name = 'Glo75203', )(Res94191)
Res34702 = keras.layers.Reshape((2, 1), name = 'Res34702', )(Glo75203)
Res72329 = keras.layers.Reshape((2, 1, 1), name = 'Res72329', )(Res34702)
Con91106 = keras.layers.Concatenate(axis=3, name = 'Con91106', )([Res72329,in0Con91106])
Dot76719 = keras.layers.Dot(axes=(1, 1), name = 'Dot76719', )([in0Dot76719,in1Dot76719])
Res82132 = keras.layers.Reshape((1, 1), name = 'Res82132', )(Dot76719)
LST15126 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST15126', )(Res82132)
Sof99192 = keras.layers.Softmax(axis=1, name = 'Sof99192', )(LST15126)
Res76945 = keras.layers.Reshape((2, 1), name = 'Res76945', )(Sof99192)
Res89056 = keras.layers.Reshape((2, 1, 1), name = 'Res89056', )(Res76945)
Loc50074 = keras.layers.LocallyConnected2D(4, (2, 1),strides=(1, 1), name = 'Loc50074', )(Res89056)
Zer79067 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer79067', )(Loc50074)
Min67889 = keras.layers.Minimum(name = 'Min67889', )([Con91106,Zer79067])
model = tf.keras.models.Model(inputs=[in0Add9246,in1Add9246,in0Con91106,in0Dot76719,in1Dot76719], outputs=Min67889)
w = model.get_layer('LST15126').get_weights() 
w[0] = np.array([[5, 10, 4, 6, 1, 10, 7, 6]])
w[1] = np.array([[1, 4, 6, 10, 8, 10, 10, 2], [1, 8, 4, 3, 8, 4, 1, 6]])
w[2] = np.array([6, 6, 10, 4, 1, 6, 6, 8])
model.get_layer('LST15126').set_weights(w) 
w = model.get_layer('Loc50074').get_weights() 
w[0] = np.array([[[0.4293, 0.4465, 0.4172, 0.9617], [0.9462, 0.4413, 0.9176, 0.5534]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc50074').set_weights(w) 
in0Add9246 = tf.constant([[[[0.5249], [0.385]], [[0.8166], [0.4469]]]])
in1Add9246 = tf.constant([[[[0.6811], [0.9045]], [[0.2372], [0.8211]]]])
in0Con91106 = tf.constant([[[[0.0473, 0.405, 0.6833]], [[0.5289, 0.6613, 0.5622]]]])
in0Dot76719 = tf.constant([[0.0761, 0.2666, 0.95]])
in1Dot76719 = tf.constant([[0.1901, 0.2526, 0.6887]])
print (np.array2string(model.predict([in0Add9246,in1Add9246,in0Con91106,in0Dot76719,in1Dot76719],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min67889.png')

LAdd9246 = add_layer([[[[[0.5249], [0.385]], [[0.8166], [0.4469]]]], [[[[0.6811], [0.9045]], [[0.2372], [0.8211]]]]], Add9246), 
LRes94191 = reshape_layer(Add9246, [2, 2], Res94191), 
LGlo75203 = global_max_pool1D_layer(Res94191, Glo75203), 
LRes34702 = reshape_layer(Glo75203, [2, 1], Res34702), 
LRes72329 = reshape_layer(Res34702, [2, 1, 1], Res72329), 
LCon91106 = concatenate_layer([Res72329,[[[[0.0473, 0.405, 0.6833]], [[0.5289, 0.6613, 0.5622]]]]], 3, Con91106), 
LDot76719 = dot_layer([[0.0761, 0.2666, 0.95]], [[0.1901, 0.2526, 0.6887]], 1, 1, Dot76719), 
LRes82132 = reshape_layer(Dot76719, [1, 1], Res82132), 
LLST15126 = lstm_layer(Res82132,[[5, 10, 4, 6, 1, 10, 7, 6]],[[1, 4, 6, 10, 8, 10, 10, 2], [1, 8, 4, 3, 8, 4, 1, 6]],[6, 6, 10, 4, 1, 6, 6, 8], LST15126), 
LSof99192 = softmax_layer(LST15126, 1, Sof99192), 
LRes76945 = reshape_layer(Sof99192, [2, 1], Res76945), 
LRes89056 = reshape_layer(Res76945, [2, 1, 1], Res89056), 
LLoc50074 = locally_connected2D_layer(Res89056, 2, 1,[[[0.4293, 0.4465, 0.4172, 0.9617], [0.9462, 0.4413, 0.9176, 0.5534]]],[[[0, 0, 0, 0]]], 1, 1, Loc50074), 
LZer79067 = zero_padding2D_layer(Loc50074, 1, 0, 0, 0, Zer79067), 
LMin67889 = minimum_layer([Con91106,Zer79067], Min67889), 
exec_layers([LAdd9246,LRes94191,LGlo75203,LRes34702,LRes72329,LCon91106,LDot76719,LRes82132,LLST15126,LSof99192,LRes76945,LRes89056,LLoc50074,LZer79067,LMin67889],["Add9246","Res94191","Glo75203","Res34702","Res72329","Con91106","Dot76719","Res82132","LST15126","Sof99192","Res76945","Res89056","Loc50074","Zer79067","Min67889"],Min67889,"Min67889")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.6911757, 0.4438655, 0.6613000, 0.5622000]]]]

Expected (Unparsed): [[[[0,0,0,0]],[[0.6911757484322683,0.4438655370635563,0.6613,0.5622]]]]

Actual:   [[[[0, 0, 0, 0]], [[0.6912, 0.4439, 0.6613, 0.5622]]]]

Expected: [[[[0, 0, 0, 0]], [[0.6912, 0.4439, 0.6613, 0.5622]]]]