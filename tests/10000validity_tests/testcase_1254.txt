import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub25883 = tf.keras.layers.Input(shape=([3]))
in1Sub25883 = tf.keras.layers.Input(shape=([3]))
in0LST26981 = tf.keras.layers.Input(shape=([3, 1]))
in0Con43844 = tf.keras.layers.Input(shape=([1, 3, 1]))

Sub25883 = keras.layers.Subtract(name = 'Sub25883', )([in0Sub25883,in1Sub25883])
Res23211 = keras.layers.Reshape((3, 1), name = 'Res23211', )(Sub25883)
Sep47796 = keras.layers.SeparableConv1D(3, (1),strides=(3), padding='same', name = 'Sep47796', )(Res23211)
Res83725 = keras.layers.Reshape((1, 3, 1), name = 'Res83725', )(Sep47796)
Loc67740 = keras.layers.LocallyConnected2D(2, (1, 1),strides=(1, 1), name = 'Loc67740', )(Res83725)
ReL90075 = keras.layers.ReLU(max_value=8.97045062210221, negative_slope=7.2359571451603735, threshold=4.357445970127526, name = 'ReL90075', )(Loc67740)
LST26981 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST26981', )(in0LST26981)
Res43954 = keras.layers.Reshape((1, 1), name = 'Res43954', )(LST26981)
Res76876 = keras.layers.Reshape((1, 1, 1), name = 'Res76876', )(Res43954)
Cro40125 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro40125', )(Res76876)
Zer23606 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer23606', )(Cro40125)
Con43844 = keras.layers.Concatenate(axis=3, name = 'Con43844', )([Zer23606,in0Con43844])
Ave47175 = keras.layers.Average(name = 'Ave47175', )([ReL90075,Con43844])
model = tf.keras.models.Model(inputs=[in0Sub25883,in1Sub25883,in0LST26981,in0Con43844], outputs=Ave47175)
w = model.get_layer('Sep47796').get_weights() 
w[0] = np.array([[[0.7201]]])
w[1] = np.array([[[0.5938, 0.4025, 0.2985]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep47796').set_weights(w) 
w = model.get_layer('Loc67740').get_weights() 
w[0] = np.array([[[0.1128, 0.3002]], [[0.9811, 0.6871]], [[0.8178, 0.3761]]])
w[1] = np.array([[[0, 0], [0, 0], [0, 0]]])
model.get_layer('Loc67740').set_weights(w) 
w = model.get_layer('LST26981').get_weights() 
w[0] = np.array([[3, 8, 2, 2]])
w[1] = np.array([[9, 4, 8, 9]])
w[2] = np.array([2, 5, 9, 6])
model.get_layer('LST26981').set_weights(w) 
in0Sub25883 = tf.constant([[0.601, 0.9537, 0.0888]])
in1Sub25883 = tf.constant([[0.9571, 0.1217, 0.4839]])
in0LST26981 = tf.constant([[[7], [10], [6]]])
in0Con43844 = tf.constant([[[[0.8266], [0.562], [0.0109]]]])
print (np.array2string(model.predict([in0Sub25883,in1Sub25883,in0LST26981,in0Con43844],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave47175.png')

LSub25883 = subtract_layer([[0.601, 0.9537, 0.0888]], [[0.9571, 0.1217, 0.4839]], Sub25883), 
LRes23211 = reshape_layer(Sub25883, [3, 1], Res23211), 
LSep47796 = separable_conv1D_layer(Res23211, 1,[[[[0.7201]]],[[[0.5938, 0.4025, 0.2985]]]],[0, 0, 0], 3, true, Sep47796), 
LRes83725 = reshape_layer(Sep47796, [1, 3, 1], Res83725), 
LLoc67740 = locally_connected2D_layer(Res83725, 1, 1,[[[0.1128, 0.3002]], [[0.9811, 0.6871]], [[0.8178, 0.3761]]],[[[0, 0], [0, 0], [0, 0]]], 1, 1, Loc67740), 
LReL90075 = relu_layer(Loc67740, 8.97045062210221, 7.2359571451603735, 4.357445970127526, ReL90075), 
LLST26981 = lstm_layer([[[7], [10], [6]]],[[3, 8, 2, 2]],[[9, 4, 8, 9]],[2, 5, 9, 6], LST26981), 
LRes43954 = reshape_layer(LST26981, [1, 1], Res43954), 
LRes76876 = reshape_layer(Res43954, [1, 1, 1], Res76876), 
LCro40125 = cropping2D_layer(Res76876, 0, 0, 0, 0, Cro40125), 
LZer23606 = zero_padding2D_layer(Cro40125, 0, 0, 2, 0, Zer23606), 
LCon43844 = concatenate_layer([Zer23606,[[[[0.8266], [0.562], [0.0109]]]]], 3, Con43844), 
LAve47175 = average_layer([ReL90075,Con43844], Ave47175), 
exec_layers([LSub25883,LRes23211,LSep47796,LRes83725,LLoc67740,LReL90075,LLST26981,LRes43954,LRes76876,LCro40125,LZer23606,LCon43844,LAve47175],["Sub25883","Res23211","Sep47796","Res83725","Loc67740","ReL90075","LST26981","Res43954","Res76876","Cro40125","Zer23606","Con43844","Ave47175"],Ave47175,"Ave47175")

Actual (Unparsed): [[[[-15.8272874, -15.5172256], [-16.1315077, -15.7407225], [-15.4940948, -15.8638507]]]]

Expected (Unparsed): [[[[-15.82728741295771,-15.51722564409819],[-16.131507741320036,-15.740722492593614],[-15.494094790294307,-15.863850748348577]]]]

Actual:   [[[[-15.8272, -15.5172], [-16.1315, -15.7407], [-15.494, -15.8638]]]]

Expected: [[[[-15.8272, -15.5172], [-16.1315, -15.7407], [-15.494, -15.8638]]]]