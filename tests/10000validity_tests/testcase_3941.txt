import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add3656 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Add3656 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con18071 = tf.keras.layers.Input(shape=([1, 3]))
in0Dep36905 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con80003 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Sim62609 = tf.keras.layers.Input(shape=([1, 3]))
in0Con25186 = tf.keras.layers.Input(shape=([1]))

Add3656 = keras.layers.Add(name = 'Add3656', )([in0Add3656,in1Add3656])
Res62050 = keras.layers.Reshape((1, 1), name = 'Res62050', )(Add3656)
Con18071 = keras.layers.Concatenate(axis=2, name = 'Con18071', )([Res62050,in0Con18071])
Dep36905 = keras.layers.DepthwiseConv2D((2, 2),strides=(2, 2), padding='valid', name = 'Dep36905', )(in0Dep36905)
Res3702 = keras.layers.Reshape((1, 1), name = 'Res3702', )(Dep36905)
Ave24472 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='same', name = 'Ave24472', )(Res3702)
Con80003 = keras.layers.Conv2D(4, (1, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con80003', )(in0Con80003)
Res44998 = keras.layers.Reshape((1, 4), name = 'Res44998', )(Con80003)
Dot76895 = keras.layers.Dot(axes=(1, 1), name = 'Dot76895', )([Ave24472,Res44998])
Mul16711 = keras.layers.Multiply(name = 'Mul16711', )([Con18071,Dot76895])
Fla39563 = keras.layers.Flatten(name = 'Fla39563', )(Mul16711)
Sim62609 = keras.layers.SimpleRNN(3,name = 'Sim62609', )(in0Sim62609)
Con25186 = keras.layers.Concatenate(axis=1, name = 'Con25186', )([Sim62609,in0Con25186])
Sub80008 = keras.layers.Subtract(name = 'Sub80008', )([Fla39563,Con25186])
Res26199 = keras.layers.Reshape((4, 1), name = 'Res26199', )(Sub80008)
Con38654 = keras.layers.Conv1D(4, (3),strides=(1), padding='valid', dilation_rate=(1), name = 'Con38654', )(Res26199)
model = tf.keras.models.Model(inputs=[in0Add3656,in1Add3656,in0Con18071,in0Dep36905,in0Con80003,in0Sim62609,in0Con25186], outputs=Con38654)
w = model.get_layer('Dep36905').get_weights() 
w[0] = np.array([[[[0.8102]], [[0.47]]], [[[0.9991]], [[0.4733]]]])
w[1] = np.array([0])
model.get_layer('Dep36905').set_weights(w) 
w = model.get_layer('Con80003').get_weights() 
w[0] = np.array([[[[0.0432, 0.7598, 0.6338, 0.5796]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con80003').set_weights(w) 
w = model.get_layer('Sim62609').get_weights() 
w[0] = np.array([[10, 2, 6], [9, 5, 5], [9, 6, 4]])
w[1] = np.array([[4, 1, 10], [10, 8, 10], [5, 9, 1]])
w[2] = np.array([4, 6, 8])
model.get_layer('Sim62609').set_weights(w) 
w = model.get_layer('Con38654').get_weights() 
w[0] = np.array([[[0.7837, 0.642, 0.0763, 0.558]], [[0.5641, 0.7402, 0.382, 0.9827]], [[0.7301, 0.1181, 0.5158, 0.836]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con38654').set_weights(w) 
in0Add3656 = tf.constant([[[[0.095]]]])
in1Add3656 = tf.constant([[[[0.4335]]]])
in0Con18071 = tf.constant([[[0.0361, 0.3065, 0.6999]]])
in0Dep36905 = tf.constant([[[[0.6433], [0.6562]], [[0.4319], [0.0614]]]])
in0Con80003 = tf.constant([[[[0.2898]]]])
in0Sim62609 = tf.constant([[[6, 7, 1]]])
in0Con25186 = tf.constant([[0.3864]])
print (np.array2string(model.predict([in0Add3656,in1Add3656,in0Con18071,in0Dep36905,in0Con80003,in0Sim62609,in0Con25186],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con38654.png')

LAdd3656 = add_layer([[[[[0.095]]]], [[[[0.4335]]]]], Add3656), 
LRes62050 = reshape_layer(Add3656, [1, 1], Res62050), 
LCon18071 = concatenate_layer([Res62050,[[[0.0361, 0.3065, 0.6999]]]], 2, Con18071), 
LDep36905 = depthwise_conv2D_layer([[[[0.6433], [0.6562]], [[0.4319], [0.0614]]]], 2, 2,[[[[0.8102]], [[0.47]]], [[[0.9991]], [[0.4733]]]],[0], 2, 2, false, Dep36905), 
LRes3702 = reshape_layer(Dep36905, [1, 1], Res3702), 
LAve24472 = average_pooling1D_layer(Res3702, 1, 1, true, Ave24472), 
LCon80003 = conv2D_layer([[[[0.2898]]]], 1, 1,[[[[0.0432, 0.7598, 0.6338, 0.5796]]]],[0, 0, 0, 0], 1, 1, false, 1, 1, Con80003), 
LRes44998 = reshape_layer(Con80003, [1, 4], Res44998), 
LDot76895 = dot_layer(Ave24472,Res44998, 1, 1, Dot76895), 
LMul16711 = multiply_layer([Con18071,Dot76895], Mul16711), 
LFla39563 = flatten_layer(Mul16711, Fla39563), 
LSim62609 = simple_rnn_layer([[[6, 7, 1]]],[[10, 2, 6], [9, 5, 5], [9, 6, 4]],[[4, 1, 10], [10, 8, 10], [5, 9, 1]],[4, 6, 8], Sim62609), 
LCon25186 = concatenate_layer([Sim62609,[[0.3864]]], 1, Con25186), 
LSub80008 = subtract_layer(Fla39563,Con25186, Sub80008), 
LRes26199 = reshape_layer(Sub80008, [4, 1], Res26199), 
LCon38654 = conv1D_layer(Res26199, 3,[[[0.7837, 0.642, 0.0763, 0.558]], [[0.5641, 0.7402, 0.382, 0.9827]], [[0.7301, 0.1181, 0.5158, 0.836]]],[0, 0, 0, 0], 1, false, 1, Con38654), 
exec_layers([LAdd3656,LRes62050,LCon18071,LDep36905,LRes3702,LAve24472,LCon80003,LRes44998,LDot76895,LMul16711,LFla39563,LSim62609,LCon25186,LSub80008,LRes26199,LCon38654],["Add3656","Res62050","Con18071","Dep36905","Res3702","Ave24472","Con80003","Res44998","Dot76895","Mul16711","Fla39563","Sim62609","Con25186","Sub80008","Res26199","Con38654"],Con38654,"Con38654")

Actual (Unparsed): [[[-2.0123955, -1.4786505, -0.9320670, -2.3011374], [-1.4701628, -1.3495740, -0.5508426, -1.6598306]]]

Expected (Unparsed): [[[-2.0123954544750005,-1.478650472153306,-0.9320669574009963,-2.301137347933144],[-1.4701627903503423,-1.3495739696321334,-0.5508425664715629,-1.6598306082905288]]]

Actual:   [[[-2.0123, -1.4786, -0.932, -2.3011], [-1.4701, -1.3495, -0.5508, -1.6598]]]

Expected: [[[-2.0123, -1.4786, -0.932, -2.3011], [-1.4701, -1.3495, -0.5508, -1.6598]]]