import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot96956 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot96956 = tf.keras.layers.Input(shape=([3, 3]))
in0Con16279 = tf.keras.layers.Input(shape=([3, 1, 2, 1]))
in0Con22103 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con89562 = tf.keras.layers.Input(shape=([3, 1, 2, 1]))
in0Mul92990 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in1Mul92990 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))

Dot96956 = keras.layers.Dot(axes=(1, 2), name = 'Dot96956', )([in0Dot96956,in1Dot96956])
Res18821 = keras.layers.Reshape((3, 3, 1), name = 'Res18821', )(Dot96956)
Cro23223 = keras.layers.Cropping2D(cropping=((1, 0), (0, 2)), name = 'Cro23223', )(Res18821)
Res93284 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res93284', )(Cro23223)
PRe41525 = keras.layers.PReLU(name = 'PRe41525', )(Res93284)
Zer39408 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (1, 0)), name = 'Zer39408', )(PRe41525)
Con16279 = keras.layers.Concatenate(axis=4, name = 'Con16279', )([Zer39408,in0Con16279])
Con22103 = keras.layers.Conv2DTranspose(2, (2, 1),strides=(1, 1), padding='valid', name = 'Con22103', )(in0Con22103)
Res16875 = keras.layers.Reshape((3, 1, 2, 1), name = 'Res16875', )(Con22103)
Con89562 = keras.layers.Concatenate(axis=4, name = 'Con89562', )([Res16875,in0Con89562])
Mul92990 = keras.layers.Multiply(name = 'Mul92990', )([in0Mul92990,in1Mul92990])
Zer20574 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (0, 0)), name = 'Zer20574', )(Mul92990)
Add24785 = keras.layers.Add(name = 'Add24785', )([Con89562,Zer20574])
Max1476 = keras.layers.Maximum(name = 'Max1476', )([Con16279,Add24785])
model = tf.keras.models.Model(inputs=[in0Dot96956,in1Dot96956,in0Con16279,in0Con22103,in0Con89562,in0Mul92990,in1Mul92990], outputs=Max1476)
w = model.get_layer('PRe41525').get_weights() 
w[0] = np.array([[[[0.0156]]], [[[0.8686]]]])
model.get_layer('PRe41525').set_weights(w) 
w = model.get_layer('Con22103').get_weights() 
w[0] = np.array([[[[0.0806], [0.3646]]], [[[0.2249], [0.694]]]])
w[1] = np.array([0, 0])
model.get_layer('Con22103').set_weights(w) 
in0Dot96956 = tf.constant([[[0.7327, 0.3064, 0.684], [0.2356, 0.3955, 0.3518], [0.0485, 0.0839, 0.1676]]])
in1Dot96956 = tf.constant([[[0.7838, 0.8984, 0.6628], [0.7877, 0.5857, 0.894], [0.1414, 0.7584, 0.7019]]])
in0Con16279 = tf.constant([[[[[0.0927], [0.084]]], [[[0.4286], [0.4199]]], [[[0.2869], [0.5524]]]]])
in0Con22103 = tf.constant([[[[0.7912]], [[0.7688]]]])
in0Con89562 = tf.constant([[[[[0.1677], [0.5151]]], [[[0.1257], [0.2815]]], [[[0.2861], [0.3608]]]]])
in0Mul92990 = tf.constant([[[[[0.3393, 0.2472], [0.4806, 0.0569]]], [[[0.2024, 0.8105], [0.367, 0.9773]]]]])
in1Mul92990 = tf.constant([[[[[0.8966, 0.7978], [0.1519, 0.1908]]], [[[0.0752, 0.4419], [0.46, 0.7113]]]]])
print (np.array2string(model.predict([in0Dot96956,in1Dot96956,in0Con16279,in0Con22103,in0Con89562,in0Mul92990,in1Mul92990],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max1476.png')

LDot96956 = dot_layer([[[0.7327, 0.3064, 0.684], [0.2356, 0.3955, 0.3518], [0.0485, 0.0839, 0.1676]]], [[[0.7838, 0.8984, 0.6628], [0.7877, 0.5857, 0.894], [0.1414, 0.7584, 0.7019]]], 1, 2, Dot96956), 
LRes18821 = reshape_layer(Dot96956, [3, 3, 1], Res18821), 
LCro23223 = cropping2D_layer(Res18821, 1, 0, 0, 2, Cro23223), 
LRes93284 = reshape_layer(Cro23223, [2, 1, 1, 1], Res93284), 
LPRe41525 = prelu_layer(Res93284, [[[[0.0156]]], [[[0.8686]]]], PRe41525), 
LZer39408 = zero_padding3D_layer(PRe41525, 1, 0, 0, 0, 1, 0, Zer39408), 
LCon16279 = concatenate_layer([Zer39408,[[[[[0.0927], [0.084]]], [[[0.4286], [0.4199]]], [[[0.2869], [0.5524]]]]]], 4, Con16279), 
LCon22103 = conv2D_transpose_layer([[[[0.7912]], [[0.7688]]]], 2, 1,[[[[0.0806], [0.3646]]], [[[0.2249], [0.694]]]],[0, 0], 1, 1, false, Con22103), 
LRes16875 = reshape_layer(Con22103, [3, 1, 2, 1], Res16875), 
LCon89562 = concatenate_layer([Res16875,[[[[[0.1677], [0.5151]]], [[[0.1257], [0.2815]]], [[[0.2861], [0.3608]]]]]], 4, Con89562), 
LMul92990 = multiply_layer([[[[[[0.3393, 0.2472], [0.4806, 0.0569]]], [[[0.2024, 0.8105], [0.367, 0.9773]]]]], [[[[[0.8966, 0.7978], [0.1519, 0.1908]]], [[[0.0752, 0.4419], [0.46, 0.7113]]]]]], Mul92990), 
LZer20574 = zero_padding3D_layer(Mul92990, 1, 0, 0, 0, 0, 0, Zer20574), 
LAdd24785 = add_layer([Con89562,Zer20574], Add24785), 
LMax1476 = maximum_layer([Con16279,Add24785], Max1476), 
exec_layers([LDot96956,LRes18821,LCro23223,LRes93284,LPRe41525,LZer39408,LCon16279,LCon22103,LRes16875,LCon89562,LMul92990,LZer20574,LAdd24785,LMax1476],["Dot96956","Res18821","Cro23223","Res93284","PRe41525","Zer39408","Con16279","Con22103","Res16875","Con89562","Mul92990","Zer20574","Add24785","Max1476"],Max1476,"Max1476")

Actual (Unparsed): [[[[[0.0637707, 0.1677000], [0.2884715, 0.5151000]]], [[[0.5441225, 0.4286000], [0.9024004, 0.4199000]]], [[[0.1881236, 0.6442600], [0.9632616, 1.0559535]]]]]

Expected (Unparsed): [[[[[0.06377072,0.1677],[0.28847152,0.5151]]],[[[0.5441225399999999,0.4286],[0.90240042,0.4199]]],[[[0.1881236,0.64425995],[0.9632616,1.05595349]]]]]

Actual:   [[[[[0.0638, 0.1677], [0.2885, 0.5151]]], [[[0.5442, 0.4286], [0.9025, 0.4199]]], [[[0.1882, 0.6443], [0.9633, 1.056]]]]]

Expected: [[[[[0.0638, 0.1677], [0.2885, 0.5151]]], [[[0.5442, 0.4286], [0.9025, 0.4199]]], [[[0.1882, 0.6443], [0.9633, 1.056]]]]]