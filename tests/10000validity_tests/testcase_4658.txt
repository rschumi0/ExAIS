import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max45655 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Max45655 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Dot66754 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot66754 = tf.keras.layers.Input(shape=([3, 2]))
in0Con1739 = tf.keras.layers.Input(shape=([2]))
in0Add31760 = tf.keras.layers.Input(shape=([1, 2]))
in1Add31760 = tf.keras.layers.Input(shape=([1, 2]))

Max45655 = keras.layers.Maximum(name = 'Max45655', )([in0Max45655,in1Max45655])
Res54101 = keras.layers.Reshape((2, 2), name = 'Res54101', )(Max45655)
Fla19678 = keras.layers.Flatten(name = 'Fla19678', )(Res54101)
Dot66754 = keras.layers.Dot(axes=(2, 2), name = 'Dot66754', )([in0Dot66754,in1Dot66754])
Zer41847 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer41847', )(Dot66754)
Sim6132 = keras.layers.SimpleRNN(2,name = 'Sim6132', )(Zer41847)
Con1739 = keras.layers.Concatenate(axis=1, name = 'Con1739', )([Sim6132,in0Con1739])
Ave71173 = keras.layers.Average(name = 'Ave71173', )([Fla19678,Con1739])
Res90037 = keras.layers.Reshape((4, 1), name = 'Res90037', )(Ave71173)
Res80234 = keras.layers.Reshape((4, 1, 1), name = 'Res80234', )(Res90037)
Res24985 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res24985', )(Res80234)
Zer10840 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer10840', )(Res24985)
Add31760 = keras.layers.Add(name = 'Add31760', )([in0Add31760,in1Add31760])
Res66296 = keras.layers.Reshape((1, 2, 1), name = 'Res66296', )(Add31760)
Res16943 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res16943', )(Res66296)
Cro26178 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro26178', )(Res16943)
Zer71162 = keras.layers.ZeroPadding3D(padding=((3, 0), (1, 0), (0, 0)), name = 'Zer71162', )(Cro26178)
Sub55534 = keras.layers.Subtract(name = 'Sub55534', )([Zer10840,Zer71162])
model = tf.keras.models.Model(inputs=[in0Max45655,in1Max45655,in0Dot66754,in1Dot66754,in0Con1739,in0Add31760,in1Add31760], outputs=Sub55534)
w = model.get_layer('Sim6132').get_weights() 
w[0] = np.array([[1, 8], [3, 7], [7, 7]])
w[1] = np.array([[10, 6], [5, 7]])
w[2] = np.array([3, 7])
model.get_layer('Sim6132').set_weights(w) 
in0Max45655 = tf.constant([[[[0.7508, 0.7789]], [[0.9882, 0.6308]]]])
in1Max45655 = tf.constant([[[[0.1862, 0.8803]], [[0.6848, 0.4526]]]])
in0Dot66754 = tf.constant([[[0.8812, 0.2916], [0.3934, 0.8945], [0.355, 0.4458]]])
in1Dot66754 = tf.constant([[[0.6932, 0.5404], [0.3057, 0.678], [0.9025, 0.6676]]])
in0Con1739 = tf.constant([[0.9964, 0.215]])
in0Add31760 = tf.constant([[[0.1562, 0.6241]]])
in1Add31760 = tf.constant([[[0.3917, 0.7289]]])
print (np.array2string(model.predict([in0Max45655,in1Max45655,in0Dot66754,in1Dot66754,in0Con1739,in0Add31760,in1Add31760],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub55534.png')

LMax45655 = maximum_layer([[[[[0.7508, 0.7789]], [[0.9882, 0.6308]]]], [[[[0.1862, 0.8803]], [[0.6848, 0.4526]]]]], Max45655), 
LRes54101 = reshape_layer(Max45655, [2, 2], Res54101), 
LFla19678 = flatten_layer(Res54101, Fla19678), 
LDot66754 = dot_layer([[[0.8812, 0.2916], [0.3934, 0.8945], [0.355, 0.4458]]], [[[0.6932, 0.5404], [0.3057, 0.678], [0.9025, 0.6676]]], 2, 2, Dot66754), 
LZer41847 = zero_padding1D_layer(Dot66754, 1, 1, Zer41847), 
LSim6132 = simple_rnn_layer(Zer41847,[[1, 8], [3, 7], [7, 7]],[[10, 6], [5, 7]],[3, 7], Sim6132), 
LCon1739 = concatenate_layer([Sim6132,[[0.9964, 0.215]]], 1, Con1739), 
LAve71173 = average_layer([Fla19678,Con1739], Ave71173), 
LRes90037 = reshape_layer(Ave71173, [4, 1], Res90037), 
LRes80234 = reshape_layer(Res90037, [4, 1, 1], Res80234), 
LRes24985 = reshape_layer(Res80234, [4, 1, 1, 1], Res24985), 
LZer10840 = zero_padding3D_layer(Res24985, 0, 0, 2, 0, 0, 0, Zer10840), 
LAdd31760 = add_layer([[[[0.1562, 0.6241]]], [[[0.3917, 0.7289]]]], Add31760), 
LRes66296 = reshape_layer(Add31760, [1, 2, 1], Res66296), 
LRes16943 = reshape_layer(Res66296, [1, 2, 1, 1], Res16943), 
LCro26178 = cropping3D_layer(Res16943, 0, 0, 0, 0, 0, 0, Cro26178), 
LZer71162 = zero_padding3D_layer(Cro26178, 3, 0, 1, 0, 0, 0, Zer71162), 
LSub55534 = subtract_layer(Zer10840,Zer71162, Sub55534), 
exec_layers([LMax45655,LRes54101,LFla19678,LDot66754,LZer41847,LSim6132,LCon1739,LAve71173,LRes90037,LRes80234,LRes24985,LZer10840,LAdd31760,LRes66296,LRes16943,LCro26178,LZer71162,LSub55534],["Max45655","Res54101","Fla19678","Dot66754","Zer41847","Sim6132","Con1739","Ave71173","Res90037","Res80234","Res24985","Zer10840","Add31760","Res66296","Res16943","Cro26178","Zer71162","Sub55534"],Sub55534,"Sub55534")

Actual (Unparsed): [[[[[0.0000000]], [[0.0000000]], [[0.8754000]]], [[[0.0000000]], [[0.0000000]], [[0.9401500]]], [[[0.0000000]], [[0.0000000]], [[0.9923000]]], [[[0.0000000]], [[-0.5479000]], [[-0.9301000]]]]]

Expected (Unparsed): [[[[[0]],[[0]],[[0.8753999999999997]]],[[[0]],[[0]],[[0.94015]]],[[[0]],[[0]],[[0.9923]]],[[[0]],[[-0.5479]],[[-0.9300999999999999]]]]]

Actual:   [[[[[0]], [[0]], [[0.8754]]], [[[0]], [[0]], [[0.9402]]], [[[0]], [[0]], [[0.9923]]], [[[0]], [[-0.5479]], [[-0.9301]]]]]

Expected: [[[[[0]], [[0]], [[0.8754]]], [[[0]], [[0]], [[0.9402]]], [[[0]], [[0]], [[0.9923]]], [[[0]], [[-0.5479]], [[-0.93]]]]]