import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave79385 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Ave79385 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Max44283 = tf.keras.layers.Input(shape=([2, 1]))
in1Max44283 = tf.keras.layers.Input(shape=([2, 1]))
in0Con47959 = tf.keras.layers.Input(shape=([2, 3]))

Ave79385 = keras.layers.Average(name = 'Ave79385', )([in0Ave79385,in1Ave79385])
Res88233 = keras.layers.Reshape((1, 2, 2), name = 'Res88233', )(Ave79385)
Res13052 = keras.layers.Reshape((1, 4), name = 'Res13052', )(Res88233)
Sof14729 = keras.layers.Softmax(axis=1, name = 'Sof14729', )(Res13052)
Mas46559 = keras.layers.Masking(mask_value=2, name = 'Mas46559', )(Sof14729)
Zer59864 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer59864', )(Mas46559)
Max44283 = keras.layers.Maximum(name = 'Max44283', )([in0Max44283,in1Max44283])
Con47959 = keras.layers.Concatenate(axis=2, name = 'Con47959', )([Max44283,in0Con47959])
Mul29632 = keras.layers.Multiply(name = 'Mul29632', )([Zer59864,Con47959])
model = tf.keras.models.Model(inputs=[in0Ave79385,in1Ave79385,in0Max44283,in1Max44283,in0Con47959], outputs=Mul29632)
in0Ave79385 = tf.constant([[[[[0.5325, 0.2137]], [[0.4597, 0.4811]]]]])
in1Ave79385 = tf.constant([[[[[0.8557, 0.7841]], [[0.5311, 0.9785]]]]])
in0Max44283 = tf.constant([[[0.7822], [0.4197]]])
in1Max44283 = tf.constant([[[0.3759], [0.0101]]])
in0Con47959 = tf.constant([[[0.1061, 0.5233, 0.9944], [0.2816, 0.0679, 0.8674]]])
print (np.array2string(model.predict([in0Ave79385,in1Ave79385,in0Max44283,in1Max44283,in0Con47959],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul29632.png')

LAve79385 = average_layer([[[[[[0.5325, 0.2137]], [[0.4597, 0.4811]]]]], [[[[[0.8557, 0.7841]], [[0.5311, 0.9785]]]]]], Ave79385), 
LRes88233 = reshape_layer(Ave79385, [1, 2, 2], Res88233), 
LRes13052 = reshape_layer(Res88233, [1, 4], Res13052), 
LSof14729 = softmax_layer(Res13052, 1, Sof14729), 
LMas46559 = masking_layer(Sof14729, 2, Mas46559), 
LZer59864 = zero_padding1D_layer(Mas46559, 1, 0, Zer59864), 
LMax44283 = maximum_layer([[[[0.7822], [0.4197]]], [[[0.3759], [0.0101]]]], Max44283), 
LCon47959 = concatenate_layer([Max44283,[[[0.1061, 0.5233, 0.9944], [0.2816, 0.0679, 0.8674]]]], 2, Con47959), 
LMul29632 = multiply_layer([Zer59864,Con47959], Mul29632), 
exec_layers([LAve79385,LRes88233,LRes13052,LSof14729,LMas46559,LZer59864,LMax44283,LCon47959,LMul29632],["Ave79385","Res88233","Res13052","Sof14729","Mas46559","Zer59864","Max44283","Con47959","Mul29632"],Mul29632,"Mul29632")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.4197000, 0.2816000, 0.0679000, 0.8674000]]]

Expected (Unparsed): [[[0.0,0.0,0.0,0.0],[0.4197,0.2816,0.0679,0.8674]]]

Actual:   [[[0, 0, 0, 0], [0.4197, 0.2816, 0.0679, 0.8674]]]

Expected: [[[0, 0, 0, 0], [0.4197, 0.2816, 0.0679, 0.8674]]]