import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max75844 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Max75844 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Fla14295 = tf.keras.layers.Input(shape=([1, 1]))
in0Con75425 = tf.keras.layers.Input(shape=([2, 1]))
in0Dot19766 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot19766 = tf.keras.layers.Input(shape=([3, 2]))

Max75844 = keras.layers.Maximum(name = 'Max75844', )([in0Max75844,in1Max75844])
Res22784 = keras.layers.Reshape((2, 2), name = 'Res22784', )(Max75844)
Fla14295 = keras.layers.Flatten(name = 'Fla14295', )(in0Fla14295)
Res13282 = keras.layers.Reshape((1, 1), name = 'Res13282', )(Fla14295)
Glo98069 = keras.layers.GlobalAveragePooling1D(name = 'Glo98069', )(Res13282)
Res84848 = keras.layers.Reshape((1, 1), name = 'Res84848', )(Glo98069)
Zer57420 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer57420', )(Res84848)
Con75425 = keras.layers.Concatenate(axis=2, name = 'Con75425', )([Zer57420,in0Con75425])
Dot19766 = keras.layers.Dot(axes=(1, 1), name = 'Dot19766', )([in0Dot19766,in1Dot19766])
Per58602 = keras.layers.Permute((2,1), name = 'Per58602',)(Dot19766)
Mul23566 = keras.layers.Multiply(name = 'Mul23566', )([Con75425,Per58602])
Ave99729 = keras.layers.Average(name = 'Ave99729', )([Res22784,Mul23566])
model = tf.keras.models.Model(inputs=[in0Max75844,in1Max75844,in0Fla14295,in0Con75425,in0Dot19766,in1Dot19766], outputs=Ave99729)
in0Max75844 = tf.constant([[[[0.5974], [0.8225]], [[0.5253], [0.7525]]]])
in1Max75844 = tf.constant([[[[0.4062], [0.6901]], [[0.9531], [0.692]]]])
in0Fla14295 = tf.constant([[[1.0473]]])
in0Con75425 = tf.constant([[[0.6836], [0.1314]]])
in0Dot19766 = tf.constant([[[0.5112, 0.5485], [0.5364, 0.7826], [0.2639, 0.2578]]])
in1Dot19766 = tf.constant([[[0.8411, 0.2635], [0.9367, 0.5486], [0.9655, 0.5718]]])
print (np.array2string(model.predict([in0Max75844,in1Max75844,in0Fla14295,in0Con75425,in0Dot19766,in1Dot19766],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave99729.png')

LMax75844 = maximum_layer([[[[[0.5974], [0.8225]], [[0.5253], [0.7525]]]], [[[[0.4062], [0.6901]], [[0.9531], [0.692]]]]], Max75844), 
LRes22784 = reshape_layer(Max75844, [2, 2], Res22784), 
LFla14295 = flatten_layer([[[1.0473]]], Fla14295), 
LRes13282 = reshape_layer(Fla14295, [1, 1], Res13282), 
LGlo98069 = global_average_pooling1D_layer(Res13282, Glo98069), 
LRes84848 = reshape_layer(Glo98069, [1, 1], Res84848), 
LZer57420 = zero_padding1D_layer(Res84848, 1, 0, Zer57420), 
LCon75425 = concatenate_layer([Zer57420,[[[0.6836], [0.1314]]]], 2, Con75425), 
LDot19766 = dot_layer([[[0.5112, 0.5485], [0.5364, 0.7826], [0.2639, 0.2578]]], [[[0.8411, 0.2635], [0.9367, 0.5486], [0.9655, 0.5718]]], 1, 1, Dot19766), 
LPer58602 = permute_layer(Dot19766, 2,1, Per58602), 
LMul23566 = multiply_layer([Con75425,Per58602], Mul23566), 
LAve99729 = average_layer([Res22784,Mul23566], Ave99729), 
exec_layers([LMax75844,LRes22784,LFla14295,LRes13282,LGlo98069,LRes84848,LZer57420,LCon75425,LDot19766,LPer58602,LMul23566,LAve99729],["Max75844","Res22784","Fla14295","Res13282","Glo98069","Res84848","Zer57420","Con75425","Dot19766","Per58602","Mul23566","Ave99729"],Ave99729,"Ave99729")

Actual (Unparsed): [[[0.2987000, 0.9045736], [0.7801980, 0.4236377]]]

Expected (Unparsed): [[[0.2987,0.904573587006],[0.7801980143489999,0.42363771165499997]]]

Actual:   [[[0.2987, 0.9046], [0.7802, 0.4237]]]

Expected: [[[0.2987, 0.9046], [0.7802, 0.4237]]]