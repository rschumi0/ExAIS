import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con86116 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Min99276 = tf.keras.layers.Input(shape=([1, 1]))
in1Min99276 = tf.keras.layers.Input(shape=([1, 1]))
in0Con12067 = tf.keras.layers.Input(shape=([17]))

Con86116 = keras.layers.Conv2DTranspose(3, (1, 2),strides=(1, 1), padding='valid', name = 'Con86116', )(in0Con86116)
Res39330 = keras.layers.Reshape((2, 9), name = 'Res39330', )(Con86116)
Fla92202 = keras.layers.Flatten(name = 'Fla92202', )(Res39330)
Min99276 = keras.layers.Minimum(name = 'Min99276', )([in0Min99276,in1Min99276])
LST46856 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST46856', )(Min99276)
Con12067 = keras.layers.Concatenate(axis=1, name = 'Con12067', )([LST46856,in0Con12067])
Mul15530 = keras.layers.Multiply(name = 'Mul15530', )([Fla92202,Con12067])
model = tf.keras.models.Model(inputs=[in0Con86116,in0Min99276,in1Min99276,in0Con12067], outputs=Mul15530)
w = model.get_layer('Con86116').get_weights() 
w[0] = np.array([[[[0.9726], [0.014], [0.5272]], [[0.5818], [0.3745], [0.5926]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con86116').set_weights(w) 
w = model.get_layer('LST46856').get_weights() 
w[0] = np.array([[8, 4, 2, 6]])
w[1] = np.array([[4, 5, 6, 2]])
w[2] = np.array([5, 3, 3, 1])
model.get_layer('LST46856').set_weights(w) 
in0Con86116 = tf.constant([[[[0.1413], [0.7285]], [[0.8343], [0.4799]]]])
in0Min99276 = tf.constant([[[0.9089]]])
in1Min99276 = tf.constant([[[0.9755]]])
in0Con12067 = tf.constant([[0.5542, 0.22, 0.6829, 0.8812, 0.4456, 0.1554, 0.791, 0.7161, 0.6921, 0.2385, 0.3436, 0.578, 0.1451, 0.4996, 0.854, 0.2081, 0.3163]])
print (np.array2string(model.predict([in0Con86116,in0Min99276,in1Min99276,in0Con12067],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul15530.png')

LCon86116 = conv2D_transpose_layer([[[[0.1413], [0.7285]], [[0.8343], [0.4799]]]], 1, 2,[[[[0.9726], [0.014], [0.5272]], [[0.5818], [0.3745], [0.5926]]]],[0, 0, 0], 1, 1, false, Con86116), 
LRes39330 = reshape_layer(Con86116, [2, 9], Res39330), 
LFla92202 = flatten_layer(Res39330, Fla92202), 
LMin99276 = minimum_layer([[[[0.9089]]], [[[0.9755]]]], Min99276), 
LLST46856 = lstm_layer(Min99276,[[8, 4, 2, 6]],[[4, 5, 6, 2]],[5, 3, 3, 1], LST46856), 
LCon12067 = concatenate_layer([LST46856,[[0.5542, 0.22, 0.6829, 0.8812, 0.4456, 0.1554, 0.791, 0.7161, 0.6921, 0.2385, 0.3436, 0.578, 0.1451, 0.4996, 0.854, 0.2081, 0.3163]]], 1, Con12067), 
LMul15530 = multiply_layer([Fla92202,Con12067], Mul15530), 
exec_layers([LCon86116,LRes39330,LFla92202,LMin99276,LLST46856,LCon12067,LMul15530],["Con86116","Res39330","Fla92202","Min99276","LST46856","Con12067","Mul15530"],Mul15530,"Mul15530")

Actual (Unparsed): [[0.1044922, 0.0010963, 0.0163885, 0.5400014, 0.0556177, 0.2084515, 0.0658649, 0.2158032, 0.3091469, 0.5615977, 0.0027857, 0.1511300, 0.5503407, 0.0463107, 0.3734058, 0.2384418, 0.0374003, 0.0899522]]

Expected (Unparsed): [[0.10449224397651273,0.0010963184400000002,0.016388539200000003,0.540001426776,0.05561768702,0.208451492848,0.06586493802000001,0.21580319075,0.30914688651,0.561597748578,0.0027857277000000002,0.151130041056,0.5503406654399999,0.04631068914500001,0.373405766216,0.23844177028,0.037400262655,0.08995215846200001]]

Actual:   [[0.1045, 0.0011, 0.0164, 0.5401, 0.0557, 0.2085, 0.0659, 0.2159, 0.3092, 0.5616, 0.0028, 0.1512, 0.5504, 0.0464, 0.3735, 0.2385, 0.0375, 0.09]]

Expected: [[0.1045, 0.0011, 0.0164, 0.5401, 0.0557, 0.2085, 0.0659, 0.2159, 0.3092, 0.5616, 0.0028, 0.1512, 0.5504, 0.0464, 0.3735, 0.2385, 0.0375, 0.09]]