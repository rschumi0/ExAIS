import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min64829 = tf.keras.layers.Input(shape=([2, 2]))
in1Min64829 = tf.keras.layers.Input(shape=([2, 2]))
in0Sub72404 = tf.keras.layers.Input(shape=([3]))
in1Sub72404 = tf.keras.layers.Input(shape=([3]))
in0Dot79702 = tf.keras.layers.Input(shape=([3]))
in1Dot79702 = tf.keras.layers.Input(shape=([3]))
in0Con72389 = tf.keras.layers.Input(shape=([2]))
in0Con92225 = tf.keras.layers.Input(shape=([1]))

Min64829 = keras.layers.Minimum(name = 'Min64829', )([in0Min64829,in1Min64829])
GRU62454 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU62454', )(Min64829)
Res82691 = keras.layers.Reshape((3, 1), name = 'Res82691', )(GRU62454)
Res71256 = keras.layers.Reshape((3, 1, 1), name = 'Res71256', )(Res82691)
Sep84686 = keras.layers.SeparableConv2D(2, (1, 1),strides=(2, 2), padding='same', name = 'Sep84686', )(Res71256)
Res81315 = keras.layers.Reshape((2, 2), name = 'Res81315', )(Sep84686)
Fla30634 = keras.layers.Flatten(name = 'Fla30634', )(Res81315)
Sub72404 = keras.layers.Subtract(name = 'Sub72404', )([in0Sub72404,in1Sub72404])
Dot79702 = keras.layers.Dot(axes=(1, 1), name = 'Dot79702', )([in0Dot79702,in1Dot79702])
Con72389 = keras.layers.Concatenate(axis=1, name = 'Con72389', )([Dot79702,in0Con72389])
Mul15048 = keras.layers.Multiply(name = 'Mul15048', )([Sub72404,Con72389])
Con92225 = keras.layers.Concatenate(axis=1, name = 'Con92225', )([Mul15048,in0Con92225])
Add56028 = keras.layers.Add(name = 'Add56028', )([Fla30634,Con92225])
model = tf.keras.models.Model(inputs=[in0Min64829,in1Min64829,in0Sub72404,in1Sub72404,in0Dot79702,in1Dot79702,in0Con72389,in0Con92225], outputs=Add56028)
w = model.get_layer('GRU62454').get_weights() 
w[0] = np.array([[6, 8, 3, 1, 4, 1, 5, 5, 3], [8, 5, 1, 10, 5, 4, 9, 7, 2]])
w[1] = np.array([[8, 4, 5, 2, 3, 4, 9, 7, 1], [2, 2, 6, 2, 10, 3, 3, 1, 5], [1, 8, 7, 9, 5, 10, 4, 7, 1]])
w[2] = np.array([9, 8, 1, 2, 3, 3, 8, 1, 7])
model.get_layer('GRU62454').set_weights(w) 
w = model.get_layer('Sep84686').get_weights() 
w[0] = np.array([[[[0.0666]]]])
w[1] = np.array([[[[0.3689, 0.2579]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep84686').set_weights(w) 
in0Min64829 = tf.constant([[[0.6568, 0.5077], [0.4788, 0.2953]]])
in1Min64829 = tf.constant([[[0.1923, 0.4559], [0.0332, 0.3312]]])
in0Sub72404 = tf.constant([[0.2969, 0.7574, 0.1592]])
in1Sub72404 = tf.constant([[0.1959, 0.2311, 0.2942]])
in0Dot79702 = tf.constant([[0.8114, 0.5961, 0.6458]])
in1Dot79702 = tf.constant([[0.2829, 0.6718, 0.4049]])
in0Con72389 = tf.constant([[0.1602, 0.1007]])
in0Con92225 = tf.constant([[0.487]])
print (np.array2string(model.predict([in0Min64829,in1Min64829,in0Sub72404,in1Sub72404,in0Dot79702,in1Dot79702,in0Con72389,in0Con92225],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add56028.png')

LMin64829 = minimum_layer([[[[0.6568, 0.5077], [0.4788, 0.2953]]], [[[0.1923, 0.4559], [0.0332, 0.3312]]]], Min64829), 
LGRU62454 = gru_layer(Min64829,[[6, 8, 3, 1, 4, 1, 5, 5, 3], [8, 5, 1, 10, 5, 4, 9, 7, 2]],[[8, 4, 5, 2, 3, 4, 9, 7, 1], [2, 2, 6, 2, 10, 3, 3, 1, 5], [1, 8, 7, 9, 5, 10, 4, 7, 1]],[9, 8, 1, 2, 3, 3, 8, 1, 7], false, GRU62454), 
LRes82691 = reshape_layer(GRU62454, [3, 1], Res82691), 
LRes71256 = reshape_layer(Res82691, [3, 1, 1], Res71256), 
LSep84686 = separable_conv2D_layer(Res71256, 1, 1,[[[[[0.0666]]]],[[[[0.3689, 0.2579]]]]],[0, 0], 2, 2, true, Sep84686), 
LRes81315 = reshape_layer(Sep84686, [2, 2], Res81315), 
LFla30634 = flatten_layer(Res81315, Fla30634), 
LSub72404 = subtract_layer([[0.2969, 0.7574, 0.1592]], [[0.1959, 0.2311, 0.2942]], Sub72404), 
LDot79702 = dot_layer([[0.8114, 0.5961, 0.6458]], [[0.2829, 0.6718, 0.4049]], 1, 1, Dot79702), 
LCon72389 = concatenate_layer([Dot79702,[[0.1602, 0.1007]]], 1, Con72389), 
LMul15048 = multiply_layer([Sub72404,Con72389], Mul15048), 
LCon92225 = concatenate_layer([Mul15048,[[0.487]]], 1, Con92225), 
LAdd56028 = add_layer([Fla30634,Con92225], Add56028), 
exec_layers([LMin64829,LGRU62454,LRes82691,LRes71256,LSep84686,LRes81315,LFla30634,LSub72404,LDot79702,LCon72389,LMul15048,LCon92225,LAdd56028],["Min64829","GRU62454","Res82691","Res71256","Sep84686","Res81315","Fla30634","Sub72404","Dot79702","Con72389","Mul15048","Con92225","Add56028"],Add56028,"Add56028")

Actual (Unparsed): [[0.0900407, 0.0843134, -0.0085933, 0.4904964]]

Expected (Unparsed): [[0.09004066880697026,0.08431342313413834,-0.008593278264963065,0.4904963813647764]]

Actual:   [[0.0901, 0.0844, -0.0085, 0.4905]]

Expected: [[0.0901, 0.0844, -0.0085, 0.4905]]