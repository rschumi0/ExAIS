import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave6886 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Ave6886 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con40291 = tf.keras.layers.Input(shape=([3, 2]))
in0Sub7501 = tf.keras.layers.Input(shape=([3, 3]))
in1Sub7501 = tf.keras.layers.Input(shape=([3, 3]))

Ave6886 = keras.layers.Average(name = 'Ave6886', )([in0Ave6886,in1Ave6886])
Res95225 = keras.layers.Reshape((1, 2), name = 'Res95225', )(Ave6886)
LST72177 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST72177', )(Res95225)
Res93792 = keras.layers.Reshape((3, 1), name = 'Res93792', )(LST72177)
GRU70747 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU70747', )(Res93792)
Res510 = keras.layers.Reshape((1, 1), name = 'Res510', )(GRU70747)
Zer4269 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer4269', )(Res510)
Con40291 = keras.layers.Concatenate(axis=2, name = 'Con40291', )([Zer4269,in0Con40291])
Sub7501 = keras.layers.Subtract(name = 'Sub7501', )([in0Sub7501,in1Sub7501])
Min39544 = keras.layers.Minimum(name = 'Min39544', )([Con40291,Sub7501])
Res86044 = keras.layers.Reshape((3, 3, 1), name = 'Res86044', )(Min39544)
Res58841 = keras.layers.Reshape((3, 3, 1, 1), name = 'Res58841', )(Res86044)
Glo2559 = keras.layers.GlobalAveragePooling3D(name = 'Glo2559', )(Res58841)
model = tf.keras.models.Model(inputs=[in0Ave6886,in1Ave6886,in0Con40291,in0Sub7501,in1Sub7501], outputs=Glo2559)
w = model.get_layer('LST72177').get_weights() 
w[0] = np.array([[4, 8, 7, 6, 10, 9, 1, 2, 5, 4, 9, 8], [5, 3, 4, 7, 4, 6, 10, 3, 9, 5, 8, 10]])
w[1] = np.array([[4, 7, 4, 5, 1, 3, 5, 7, 3, 7, 9, 8], [1, 7, 10, 6, 7, 3, 7, 6, 3, 5, 5, 9], [6, 6, 7, 2, 4, 3, 10, 2, 2, 8, 1, 10]])
w[2] = np.array([2, 9, 8, 1, 6, 3, 1, 3, 3, 2, 3, 6])
model.get_layer('LST72177').set_weights(w) 
w = model.get_layer('GRU70747').get_weights() 
w[0] = np.array([[10, 9, 3]])
w[1] = np.array([[9, 7, 10]])
w[2] = np.array([[2, 10, 1], [9, 7, 10]])
model.get_layer('GRU70747').set_weights(w) 
in0Ave6886 = tf.constant([[[[0.9223, 0.1868]]]])
in1Ave6886 = tf.constant([[[[0.3923, 0.1859]]]])
in0Con40291 = tf.constant([[[0.3455, 0.9346], [0.5982, 0.2593], [0.9953, 0.884]]])
in0Sub7501 = tf.constant([[[0.1752, 0.6616, 0.3129], [0.3697, 0.4849, 0.5361], [0.4495, 0.8891, 0.9973]]])
in1Sub7501 = tf.constant([[[0.3501, 0.7966, 0.8489], [0.13, 0.6875, 0.536], [0.4612, 0.9152, 0.5265]]])
print (np.array2string(model.predict([in0Ave6886,in1Ave6886,in0Con40291,in0Sub7501,in1Sub7501],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo2559.png')

LAve6886 = average_layer([[[[[0.9223, 0.1868]]]], [[[[0.3923, 0.1859]]]]], Ave6886), 
LRes95225 = reshape_layer(Ave6886, [1, 2], Res95225), 
LLST72177 = lstm_layer(Res95225,[[4, 8, 7, 6, 10, 9, 1, 2, 5, 4, 9, 8], [5, 3, 4, 7, 4, 6, 10, 3, 9, 5, 8, 10]],[[4, 7, 4, 5, 1, 3, 5, 7, 3, 7, 9, 8], [1, 7, 10, 6, 7, 3, 7, 6, 3, 5, 5, 9], [6, 6, 7, 2, 4, 3, 10, 2, 2, 8, 1, 10]],[2, 9, 8, 1, 6, 3, 1, 3, 3, 2, 3, 6], LST72177), 
LRes93792 = reshape_layer(LST72177, [3, 1], Res93792), 
LGRU70747 = gru_layer(Res93792,[[10, 9, 3]],[[9, 7, 10]],[[2, 10, 1], [9, 7, 10]], true, GRU70747), 
LRes510 = reshape_layer(GRU70747, [1, 1], Res510), 
LZer4269 = zero_padding1D_layer(Res510, 2, 0, Zer4269), 
LCon40291 = concatenate_layer([Zer4269,[[[0.3455, 0.9346], [0.5982, 0.2593], [0.9953, 0.884]]]], 2, Con40291), 
LSub7501 = subtract_layer([[[0.1752, 0.6616, 0.3129], [0.3697, 0.4849, 0.5361], [0.4495, 0.8891, 0.9973]]], [[[0.3501, 0.7966, 0.8489], [0.13, 0.6875, 0.536], [0.4612, 0.9152, 0.5265]]], Sub7501), 
LMin39544 = minimum_layer([Con40291,Sub7501], Min39544), 
LRes86044 = reshape_layer(Min39544, [3, 3, 1], Res86044), 
LRes58841 = reshape_layer(Res86044, [3, 3, 1, 1], Res58841), 
LGlo2559 = global_average_pooling3D_layer(Res58841, Glo2559), 
exec_layers([LAve6886,LRes95225,LLST72177,LRes93792,LGRU70747,LRes510,LZer4269,LCon40291,LSub7501,LMin39544,LRes86044,LRes58841,LGlo2559],["Ave6886","Res95225","LST72177","Res93792","GRU70747","Res510","Zer4269","Con40291","Sub7501","Min39544","Res86044","Res58841","Glo2559"],Glo2559,"Glo2559")

Actual (Unparsed): [[-0.0683778]]

Expected (Unparsed): [[-0.06837777777777779]]

Actual:   [[-0.0683]]

Expected: [[-0.0683]]