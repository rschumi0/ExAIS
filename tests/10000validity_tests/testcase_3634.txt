import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add26026 = tf.keras.layers.Input(shape=([1, 1]))
in1Add26026 = tf.keras.layers.Input(shape=([1, 1]))
in0Con11150 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Max26892 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Max26892 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))

Add26026 = keras.layers.Add(name = 'Add26026', )([in0Add26026,in1Add26026])
LST72620 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST72620', )(Add26026)
Res82944 = keras.layers.Reshape((2, 1), name = 'Res82944', )(LST72620)
Res83471 = keras.layers.Reshape((2, 1, 1), name = 'Res83471', )(Res82944)
Res65070 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res65070', )(Res83471)
Con11150 = keras.layers.Concatenate(axis=4, name = 'Con11150', )([Res65070,in0Con11150])
Max26892 = keras.layers.Maximum(name = 'Max26892', )([in0Max26892,in1Max26892])
Sub21032 = keras.layers.Subtract(name = 'Sub21032', )([Con11150,Max26892])
Res63307 = keras.layers.Reshape((2, 1, 2), name = 'Res63307', )(Sub21032)
Glo90360 = keras.layers.GlobalMaxPool2D(name = 'Glo90360', )(Res63307)
model = tf.keras.models.Model(inputs=[in0Add26026,in1Add26026,in0Con11150,in0Max26892,in1Max26892], outputs=Glo90360)
w = model.get_layer('LST72620').get_weights() 
w[0] = np.array([[4, 3, 5, 7, 3, 1, 10, 9]])
w[1] = np.array([[6, 3, 3, 4, 9, 1, 8, 10], [7, 1, 7, 10, 9, 10, 3, 3]])
w[2] = np.array([5, 10, 5, 4, 1, 4, 1, 4])
model.get_layer('LST72620').set_weights(w) 
in0Add26026 = tf.constant([[[0.9745]]])
in1Add26026 = tf.constant([[[0.8147]]])
in0Con11150 = tf.constant([[[[[0.8184]]], [[[0.2786]]]]])
in0Max26892 = tf.constant([[[[[0.5728, 0.4701]]], [[[0.843, 0.9913]]]]])
in1Max26892 = tf.constant([[[[[0.2319, 0.1489]]], [[[0.2003, 0.7842]]]]])
print (np.array2string(model.predict([in0Add26026,in1Add26026,in0Con11150,in0Max26892,in1Max26892],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo90360.png')

LAdd26026 = add_layer([[[[0.9745]]], [[[0.8147]]]], Add26026), 
LLST72620 = lstm_layer(Add26026,[[4, 3, 5, 7, 3, 1, 10, 9]],[[6, 3, 3, 4, 9, 1, 8, 10], [7, 1, 7, 10, 9, 10, 3, 3]],[5, 10, 5, 4, 1, 4, 1, 4], LST72620), 
LRes82944 = reshape_layer(LST72620, [2, 1], Res82944), 
LRes83471 = reshape_layer(Res82944, [2, 1, 1], Res83471), 
LRes65070 = reshape_layer(Res83471, [2, 1, 1, 1], Res65070), 
LCon11150 = concatenate_layer([Res65070,[[[[[0.8184]]], [[[0.2786]]]]]], 4, Con11150), 
LMax26892 = maximum_layer([[[[[[0.5728, 0.4701]]], [[[0.843, 0.9913]]]]], [[[[[0.2319, 0.1489]]], [[[0.2003, 0.7842]]]]]], Max26892), 
LSub21032 = subtract_layer(Con11150,Max26892, Sub21032), 
LRes63307 = reshape_layer(Sub21032, [2, 1, 2], Res63307), 
LGlo90360 = global_max_pool2D_layer(Res63307, Glo90360), 
exec_layers([LAdd26026,LLST72620,LRes82944,LRes83471,LRes65070,LCon11150,LMax26892,LSub21032,LRes63307,LGlo90360],["Add26026","LST72620","Res82944","Res83471","Res65070","Con11150","Max26892","Sub21032","Res63307","Glo90360"],Glo90360,"Glo90360")

Actual (Unparsed): [[0.1887895, 0.3483000]]

Expected (Unparsed): [[0.18878947111692423,0.3483]]

Actual:   [[0.1888, 0.3483]]

Expected: [[0.1888, 0.3483]]