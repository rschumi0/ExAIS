import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add90492 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Add90492 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Den39294 = tf.keras.layers.Input(shape=([4, 4]))
in0Con21323 = tf.keras.layers.Input(shape=([4, 1]))

Add90492 = keras.layers.Add(name = 'Add90492', )([in0Add90492,in1Add90492])
Res27109 = keras.layers.Reshape((2, 1, 2), name = 'Res27109', )(Add90492)
Loc47029 = keras.layers.LocallyConnected2D(4, (1, 1),strides=(1, 1), name = 'Loc47029', )(Res27109)
Res22525 = keras.layers.Reshape((2, 4), name = 'Res22525', )(Loc47029)
Cro80734 = keras.layers.Cropping1D(cropping=((1, 0)), name = 'Cro80734', )(Res22525)
Zer66010 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer66010', )(Cro80734)
Den39294 = keras.layers.Dense(3,name = 'Den39294', )(in0Den39294)
Con21323 = keras.layers.Concatenate(axis=2, name = 'Con21323', )([Den39294,in0Con21323])
Max99222 = keras.layers.Maximum(name = 'Max99222', )([Zer66010,Con21323])
model = tf.keras.models.Model(inputs=[in0Add90492,in1Add90492,in0Den39294,in0Con21323], outputs=Max99222)
w = model.get_layer('Loc47029').get_weights() 
w[0] = np.array([[[0.0713, 0.7775, 0.8731, 0.8907], [0.2394, 0.0608, 0.1443, 0.5815]], [[0.8429, 0.0431, 0.4073, 0.086], [0.7986, 0.7631, 0.9301, 0.8872]]])
w[1] = np.array([[[0, 0, 0, 0]], [[0, 0, 0, 0]]])
model.get_layer('Loc47029').set_weights(w) 
w = model.get_layer('Den39294').get_weights() 
w[0] = np.array([[0.2392, 0.8327, 0.5444], [0.3112, 0.26, 0.9164], [0.8481, 0.5539, 0.7622], [0.669, 0.3527, 0.4906]])
w[1] = np.array([0.1595, 0.9566, 0.6558])
model.get_layer('Den39294').set_weights(w) 
in0Add90492 = tf.constant([[[[[0.1941], [0.6245]]], [[[0.1508], [0.7334]]]]])
in1Add90492 = tf.constant([[[[[0.0428], [0.7238]]], [[[0.7187], [0.3633]]]]])
in0Den39294 = tf.constant([[[0.9814, 0.1927, 0.1211, 0.7482], [0.591, 0.3003, 0.3018, 0.8144], [0.9117, 0.4684, 0.807, 0.1955], [0.7874, 0.0577, 0.4483, 0.7266]]])
in0Con21323 = tf.constant([[[0.6431], [0.1524], [0.7919], [0.4088]]])
print (np.array2string(model.predict([in0Add90492,in1Add90492,in0Den39294,in0Con21323],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max99222.png')

LAdd90492 = add_layer([[[[[[0.1941], [0.6245]]], [[[0.1508], [0.7334]]]]], [[[[[0.0428], [0.7238]]], [[[0.7187], [0.3633]]]]]], Add90492), 
LRes27109 = reshape_layer(Add90492, [2, 1, 2], Res27109), 
LLoc47029 = locally_connected2D_layer(Res27109, 1, 1,[[[0.0713, 0.7775, 0.8731, 0.8907], [0.2394, 0.0608, 0.1443, 0.5815]], [[0.8429, 0.0431, 0.4073, 0.086], [0.7986, 0.7631, 0.9301, 0.8872]]],[[[0, 0, 0, 0]], [[0, 0, 0, 0]]], 1, 1, Loc47029), 
LRes22525 = reshape_layer(Loc47029, [2, 4], Res22525), 
LCro80734 = cropping1D_layer(Res22525, 1, 0, Cro80734), 
LZer66010 = zero_padding1D_layer(Cro80734, 3, 0, Zer66010), 
LDen39294 = dense_layer([[[0.9814, 0.1927, 0.1211, 0.7482], [0.591, 0.3003, 0.3018, 0.8144], [0.9117, 0.4684, 0.807, 0.1955], [0.7874, 0.0577, 0.4483, 0.7266]]], [[0.2392, 0.8327, 0.5444], [0.3112, 0.26, 0.9164], [0.8481, 0.5539, 0.7622], [0.669, 0.3527, 0.4906]],[0.1595, 0.9566, 0.6558], Den39294), 
LCon21323 = concatenate_layer([Den39294,[[[0.6431], [0.1524], [0.7919], [0.4088]]]], 2, Con21323), 
LMax99222 = maximum_layer([Zer66010,Con21323], Max99222), 
exec_layers([LAdd90492,LRes27109,LLoc47029,LRes22525,LCro80734,LZer66010,LDen39294,LCon21323,LMax99222],["Add90492","Res27109","Loc47029","Res22525","Cro80734","Zer66010","Den39294","Con21323","Max99222"],Max99222,"Max99222")

Actual (Unparsed): [[[1.0574698, 2.1548812, 1.8260338, 0.6431000], [1.1951108, 1.9812096, 1.8823120, 0.1524000], [1.3385509, 2.3535067, 2.2923789, 0.7919000], [1.6087262, 2.1318552, 1.8355011, 1.0477692]]]

Expected (Unparsed): [[[1.05746983,2.15488121,1.82603378,0.6431],[1.19511074,1.9812096000000001,1.8823119200000002,0.1524],[1.3385509199999999,2.35350674,2.2923789400000003,0.7919],[1.6087261699999997,2.1318551699999997,1.83550106,1.04776924]]]

Actual:   [[[1.0575, 2.1549, 1.8261, 0.6431], [1.1952, 1.9813, 1.8824, 0.1524], [1.3386, 2.3536, 2.2924, 0.7919], [1.6088, 2.1319, 1.8356, 1.0478]]]

Expected: [[[1.0575, 2.1549, 1.8261, 0.6431], [1.1952, 1.9813, 1.8824, 0.1524], [1.3386, 2.3536, 2.2924, 0.7919], [1.6088, 2.1319, 1.8356, 1.0478]]]