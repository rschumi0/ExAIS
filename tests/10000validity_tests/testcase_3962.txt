import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot80566 = tf.keras.layers.Input(shape=([2]))
in1Dot80566 = tf.keras.layers.Input(shape=([2]))
in0Con40225 = tf.keras.layers.Input(shape=([1, 3]))
in0Min90059 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in1Min90059 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in0Ave42037 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Ave42037 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))

Dot80566 = keras.layers.Dot(axes=(1, 1), name = 'Dot80566', )([in0Dot80566,in1Dot80566])
Res96386 = keras.layers.Reshape((1, 1), name = 'Res96386', )(Dot80566)
Con40225 = keras.layers.Concatenate(axis=2, name = 'Con40225', )([Res96386,in0Con40225])
Min90059 = keras.layers.Minimum(name = 'Min90059', )([in0Min90059,in1Min90059])
Res95220 = keras.layers.Reshape((2, 1, 4), name = 'Res95220', )(Min90059)
Res90986 = keras.layers.Reshape((2, 4), name = 'Res90986', )(Res95220)
Loc33780 = keras.layers.LocallyConnected1D(4, (2),strides=(2), name = 'Loc33780', )(Res90986)
Sub26226 = keras.layers.Subtract(name = 'Sub26226', )([Con40225,Loc33780])
Res32780 = keras.layers.Reshape((1, 4, 1), name = 'Res32780', )(Sub26226)
Ave42037 = keras.layers.Average(name = 'Ave42037', )([in0Ave42037,in1Ave42037])
Res28929 = keras.layers.Reshape((1, 4, 1), name = 'Res28929', )(Ave42037)
Min62967 = keras.layers.Minimum(name = 'Min62967', )([Res32780,Res28929])
model = tf.keras.models.Model(inputs=[in0Dot80566,in1Dot80566,in0Con40225,in0Min90059,in1Min90059,in0Ave42037,in1Ave42037], outputs=Min62967)
w = model.get_layer('Loc33780').get_weights() 
w[0] = np.array([[[0.8872, 0.3738, 0.0513, 0.3008], [0.3294, 0.5481, 0.3502, 0.1878], [0.6942, 0.7269, 0.7754, 0.6536], [0.0885, 0.6548, 0.0232, 0.3503], [0.9346, 0.3202, 0.1379, 0.2824], [0.0506, 0.5025, 0.7842, 0.3858], [0.2037, 0.9793, 0.3183, 0.077], [0.9636, 0.3309, 0.1271, 0.2813]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc33780').set_weights(w) 
in0Dot80566 = tf.constant([[0.9246, 0.924]])
in1Dot80566 = tf.constant([[0.8239, 0.6679]])
in0Con40225 = tf.constant([[[0.7465, 0.7311, 0.2385]]])
in0Min90059 = tf.constant([[[[[0.1947, 0.7764], [0.4358, 0.3262]]], [[[0.2691, 0.53], [0.2843, 0.0643]]]]])
in1Min90059 = tf.constant([[[[[0.5609, 0.9444], [0.8228, 0.6604]]], [[[0.2114, 0.5714], [0.6484, 0.359]]]]])
in0Ave42037 = tf.constant([[[[[0.5632, 0.9985], [0.5382, 0.5572]]]]])
in1Ave42037 = tf.constant([[[[[0.8709, 0.784], [0.762, 0.0475]]]]])
print (np.array2string(model.predict([in0Dot80566,in1Dot80566,in0Con40225,in0Min90059,in1Min90059,in0Ave42037,in1Ave42037],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min62967.png')

LDot80566 = dot_layer([[0.9246, 0.924]], [[0.8239, 0.6679]], 1, 1, Dot80566), 
LRes96386 = reshape_layer(Dot80566, [1, 1], Res96386), 
LCon40225 = concatenate_layer([Res96386,[[[0.7465, 0.7311, 0.2385]]]], 2, Con40225), 
LMin90059 = minimum_layer([[[[[[0.1947, 0.7764], [0.4358, 0.3262]]], [[[0.2691, 0.53], [0.2843, 0.0643]]]]], [[[[[0.5609, 0.9444], [0.8228, 0.6604]]], [[[0.2114, 0.5714], [0.6484, 0.359]]]]]], Min90059), 
LRes95220 = reshape_layer(Min90059, [2, 1, 4], Res95220), 
LRes90986 = reshape_layer(Res95220, [2, 4], Res90986), 
LLoc33780 = locally_connected1D_layer(Res90986, 2,[[[0.8872, 0.3738, 0.0513, 0.3008], [0.3294, 0.5481, 0.3502, 0.1878], [0.6942, 0.7269, 0.7754, 0.6536], [0.0885, 0.6548, 0.0232, 0.3503], [0.9346, 0.3202, 0.1379, 0.2824], [0.0506, 0.5025, 0.7842, 0.3858], [0.2037, 0.9793, 0.3183, 0.077], [0.9636, 0.3309, 0.1271, 0.2813]]],[[0, 0, 0, 0]], 2, Loc33780), 
LSub26226 = subtract_layer(Con40225,Loc33780, Sub26226), 
LRes32780 = reshape_layer(Sub26226, [1, 4, 1], Res32780), 
LAve42037 = average_layer([[[[[[0.5632, 0.9985], [0.5382, 0.5572]]]]], [[[[[0.8709, 0.784], [0.762, 0.0475]]]]]], Ave42037), 
LRes28929 = reshape_layer(Ave42037, [1, 4, 1], Res28929), 
LMin62967 = minimum_layer([Res32780,Res28929], Min62967), 
exec_layers([LDot80566,LRes96386,LCon40225,LMin90059,LRes95220,LRes90986,LLoc33780,LSub26226,LRes32780,LAve42037,LRes28929,LMin62967],["Dot80566","Res96386","Con40225","Min90059","Res95220","Res90986","Loc33780","Sub26226","Res32780","Ave42037","Res28929","Min62967"],Min62967,"Min62967")

Actual (Unparsed): [[[[0.2747687], [-0.9159096], [-0.4397138], [-0.6691325]]]]

Expected (Unparsed): [[[[0.27476864999999995],[-0.91590962],[-0.4397138300000002],[-0.6691324700000001]]]]

Actual:   [[[[0.2748], [-0.9159], [-0.4397], [-0.6691]]]]

Expected: [[[[0.2748], [-0.9159], [-0.4397], [-0.6691]]]]