import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con56673 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Sub87135 = tf.keras.layers.Input(shape=([3]))
in1Sub87135 = tf.keras.layers.Input(shape=([3]))
in0Mul95424 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul95424 = tf.keras.layers.Input(shape=([2, 1]))
in0Con19407 = tf.keras.layers.Input(shape=([3, 5]))

Con56673 = keras.layers.Conv3D(3, (2, 2, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con56673', )(in0Con56673)
Res36459 = keras.layers.Reshape((1, 1, 3), name = 'Res36459', )(Con56673)
Up_70353 = keras.layers.UpSampling2D(size=(2, 2), name = 'Up_70353', )(Res36459)
Res33824 = keras.layers.Reshape((2, 6), name = 'Res33824', )(Up_70353)
Zer96256 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer96256', )(Res33824)
Sub87135 = keras.layers.Subtract(name = 'Sub87135', )([in0Sub87135,in1Sub87135])
Res47474 = keras.layers.Reshape((3, 1), name = 'Res47474', )(Sub87135)
Mul95424 = keras.layers.Multiply(name = 'Mul95424', )([in0Mul95424,in1Mul95424])
Zer16104 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer16104', )(Mul95424)
Mul27378 = keras.layers.Multiply(name = 'Mul27378', )([Res47474,Zer16104])
Con19407 = keras.layers.Concatenate(axis=2, name = 'Con19407', )([Mul27378,in0Con19407])
Min84010 = keras.layers.Minimum(name = 'Min84010', )([Zer96256,Con19407])
model = tf.keras.models.Model(inputs=[in0Con56673,in0Sub87135,in1Sub87135,in0Mul95424,in1Mul95424,in0Con19407], outputs=Min84010)
w = model.get_layer('Con56673').get_weights() 
w[0] = np.array([[[[[0.9774, 0.2241, 0.5201], [0.1572, 0.8375, 0.9866]]], [[[0.4799, 0.1986, 0.3168], [0.0996, 0.4544, 0.0271]]]], [[[[0.2395, 0.7788, 0.3328], [0.6232, 0.3438, 0.7251]]], [[[0.6409, 0.0475, 0.5201], [0.343, 0.7719, 0.9117]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con56673').set_weights(w) 
in0Con56673 = tf.constant([[[[[0.1198, 0.1298]], [[0.4485, 0.7617]]], [[[0.6534, 0.9037]], [[0.0237, 0.5485]]]]])
in0Sub87135 = tf.constant([[0.6735, 0.4287, 0.0201]])
in1Sub87135 = tf.constant([[0.7851, 0.0005, 0.3171]])
in0Mul95424 = tf.constant([[[0.1953], [0.1298]]])
in1Mul95424 = tf.constant([[[0.9831], [0.6129]]])
in0Con19407 = tf.constant([[[0.6452, 0.6753, 0.0667, 0.7469, 0.0282], [0.5696, 0.9489, 0.9831, 0.794, 0.3062], [0.5763, 0.3547, 0.9743, 0.8011, 0.4585]]])
print (np.array2string(model.predict([in0Con56673,in0Sub87135,in1Sub87135,in0Mul95424,in1Mul95424,in0Con19407],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min84010.png')

LCon56673 = conv3D_layer([[[[[0.1198, 0.1298]], [[0.4485, 0.7617]]], [[[0.6534, 0.9037]], [[0.0237, 0.5485]]]]], 2, 2, 1,[[[[[0.9774, 0.2241, 0.5201], [0.1572, 0.8375, 0.9866]]], [[[0.4799, 0.1986, 0.3168], [0.0996, 0.4544, 0.0271]]]], [[[[0.2395, 0.7788, 0.3328], [0.6232, 0.3438, 0.7251]]], [[[0.6409, 0.0475, 0.5201], [0.343, 0.7719, 0.9117]]]]],[0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con56673), 
LRes36459 = reshape_layer(Con56673, [1, 1, 3], Res36459), 
LUp_70353 = up_sampling2D_layer(Res36459, 2, 2, Up_70353), 
LRes33824 = reshape_layer(Up_70353, [2, 6], Res33824), 
LZer96256 = zero_padding1D_layer(Res33824, 1, 0, Zer96256), 
LSub87135 = subtract_layer([[0.6735, 0.4287, 0.0201]], [[0.7851, 0.0005, 0.3171]], Sub87135), 
LRes47474 = reshape_layer(Sub87135, [3, 1], Res47474), 
LMul95424 = multiply_layer([[[[0.1953], [0.1298]]], [[[0.9831], [0.6129]]]], Mul95424), 
LZer16104 = zero_padding1D_layer(Mul95424, 1, 0, Zer16104), 
LMul27378 = multiply_layer([Res47474,Zer16104], Mul27378), 
LCon19407 = concatenate_layer([Mul27378,[[[0.6452, 0.6753, 0.0667, 0.7469, 0.0282], [0.5696, 0.9489, 0.9831, 0.794, 0.3062], [0.5763, 0.3547, 0.9743, 0.8011, 0.4585]]]], 2, Con19407), 
LMin84010 = minimum_layer([Zer96256,Con19407], Min84010), 
exec_layers([LCon56673,LRes36459,LUp_70353,LRes33824,LZer96256,LSub87135,LRes47474,LMul95424,LZer16104,LMul27378,LCon19407,LMin84010],["Con56673","Res36459","Up_70353","Res33824","Zer96256","Sub87135","Res47474","Mul95424","Zer16104","Mul27378","Con19407","Min84010"],Min84010,"Min84010")

Actual (Unparsed): [[[-0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0822142, 0.5696000, 0.9489000, 0.9831000, 0.7940000, 0.3062000], [-0.0236277, 0.5763000, 0.3547000, 0.9743000, 0.8011000, 0.4585000]]]

Expected (Unparsed): [[[0,0,0,0,0,0],[0.08221415592600001,0.5696,0.9489,0.9831,0.794,0.3062],[-0.02362766274,0.5763,0.3547,0.9743,0.8011,0.4585]]]

Actual:   [[[-0, 0, 0, 0, 0, 0], [0.0823, 0.5696, 0.9489, 0.9831, 0.794, 0.3062], [-0.0236, 0.5763, 0.3547, 0.9743, 0.8011, 0.4585]]]

Expected: [[[0, 0, 0, 0, 0, 0], [0.0823, 0.5696, 0.9489, 0.9831, 0.794, 0.3062], [-0.0236, 0.5763, 0.3547, 0.9743, 0.8011, 0.4585]]]