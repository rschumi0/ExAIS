import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave92289 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Ave92289 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con10353 = tf.keras.layers.Input(shape=([1]))
in0Sub86306 = tf.keras.layers.Input(shape=([2]))
in1Sub86306 = tf.keras.layers.Input(shape=([2]))

Ave92289 = keras.layers.Average(name = 'Ave92289', )([in0Ave92289,in1Ave92289])
Res8176 = keras.layers.Reshape((1, 1), name = 'Res8176', )(Ave92289)
Fla9703 = keras.layers.Flatten(name = 'Fla9703', )(Res8176)
Con10353 = keras.layers.Concatenate(axis=1, name = 'Con10353', )([Fla9703,in0Con10353])
Sub86306 = keras.layers.Subtract(name = 'Sub86306', )([in0Sub86306,in1Sub86306])
Bat30381 = keras.layers.BatchNormalization(axis=1, epsilon=0.5523518535985865,  name = 'Bat30381', )(Sub86306)
Sub18690 = keras.layers.Subtract(name = 'Sub18690', )([Con10353,Bat30381])
Res90860 = keras.layers.Reshape((2, 1), name = 'Res90860', )(Sub18690)
Glo42485 = keras.layers.GlobalMaxPool1D(name = 'Glo42485', )(Res90860)
model = tf.keras.models.Model(inputs=[in0Ave92289,in1Ave92289,in0Con10353,in0Sub86306,in1Sub86306], outputs=Glo42485)
w = model.get_layer('Bat30381').get_weights() 
w[0] = np.array([0.9562, 0.3818])
w[1] = np.array([0.1771, 0.9384])
w[2] = np.array([0.7153, 0.425])
w[3] = np.array([0.218, 0.2522])
model.get_layer('Bat30381').set_weights(w) 
in0Ave92289 = tf.constant([[[[0.4037]]]])
in1Ave92289 = tf.constant([[[[0.3945]]]])
in0Con10353 = tf.constant([[0.4502]])
in0Sub86306 = tf.constant([[0.1785, 0.9694]])
in1Sub86306 = tf.constant([[0.2711, 0.1314]])
print (np.array2string(model.predict([in0Ave92289,in1Ave92289,in0Con10353,in0Sub86306,in1Sub86306],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo42485.png')

LAve92289 = average_layer([[[[[0.4037]]]], [[[[0.3945]]]]], Ave92289), 
LRes8176 = reshape_layer(Ave92289, [1, 1], Res8176), 
LFla9703 = flatten_layer(Res8176, Fla9703), 
LCon10353 = concatenate_layer([Fla9703,[[0.4502]]], 1, Con10353), 
LSub86306 = subtract_layer([[0.1785, 0.9694]], [[0.2711, 0.1314]], Sub86306), 
LBat30381 = batch_normalization_layer(Sub86306, 1, 0.5523518535985865, [0.9562, 0.3818], [0.1771, 0.9384], [0.7153, 0.425], [0.218, 0.2522], Bat30381), 
LSub18690 = subtract_layer(Con10353,Bat30381, Sub18690), 
LRes90860 = reshape_layer(Sub18690, [2, 1], Res90860), 
LGlo42485 = global_max_pool1D_layer(Res90860, Glo42485), 
exec_layers([LAve92289,LRes8176,LFla9703,LCon10353,LSub86306,LBat30381,LSub18690,LRes90860,LGlo42485],["Ave92289","Res8176","Fla9703","Con10353","Sub86306","Bat30381","Sub18690","Res90860","Glo42485"],Glo42485,"Glo42485")

Actual (Unparsed): [[1.1021603]]

Expected (Unparsed): [[1.1021603119801762]]

Actual:   [[1.1022]]

Expected: [[1.1022]]