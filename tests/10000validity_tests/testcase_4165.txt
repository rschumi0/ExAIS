import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave87861 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave87861 = tf.keras.layers.Input(shape=([2, 1]))
in0Con65558 = tf.keras.layers.Input(shape=([3, 3, 1, 1]))
in0Sub91335 = tf.keras.layers.Input(shape=([3, 3]))
in1Sub91335 = tf.keras.layers.Input(shape=([3, 3]))
in0Con15871 = tf.keras.layers.Input(shape=([3, 3, 1, 1]))
in0Ave26775 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Ave26775 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

Ave87861 = keras.layers.Average(name = 'Ave87861', )([in0Ave87861,in1Ave87861])
Res59866 = keras.layers.Reshape((2, 1, 1), name = 'Res59866', )(Ave87861)
Res45680 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res45680', )(Res59866)
Zer85785 = keras.layers.ZeroPadding3D(padding=((1, 0), (2, 0), (0, 0)), name = 'Zer85785', )(Res45680)
Con65558 = keras.layers.Concatenate(axis=4, name = 'Con65558', )([Zer85785,in0Con65558])
Sub91335 = keras.layers.Subtract(name = 'Sub91335', )([in0Sub91335,in1Sub91335])
Res72455 = keras.layers.Reshape((3, 3, 1), name = 'Res72455', )(Sub91335)
Res24770 = keras.layers.Reshape((3, 3, 1, 1), name = 'Res24770', )(Res72455)
Con15871 = keras.layers.Concatenate(axis=4, name = 'Con15871', )([Res24770,in0Con15871])
Ave26775 = keras.layers.Average(name = 'Ave26775', )([in0Ave26775,in1Ave26775])
Zer45817 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (0, 0)), name = 'Zer45817', )(Ave26775)
Ave35945 = keras.layers.Average(name = 'Ave35945', )([Con15871,Zer45817])
Min44637 = keras.layers.Minimum(name = 'Min44637', )([Con65558,Ave35945])
model = tf.keras.models.Model(inputs=[in0Ave87861,in1Ave87861,in0Con65558,in0Sub91335,in1Sub91335,in0Con15871,in0Ave26775,in1Ave26775], outputs=Min44637)
in0Ave87861 = tf.constant([[[0.589], [0.5433]]])
in1Ave87861 = tf.constant([[[0.8134], [0.0856]]])
in0Con65558 = tf.constant([[[[[0.4224]], [[0.2713]], [[0.9981]]], [[[0.5546]], [[0.2799]], [[0.4632]]], [[[0.3077]], [[0.3243]], [[0.5259]]]]])
in0Sub91335 = tf.constant([[[0.9166, 0.5959, 0.8894], [0.8198, 0.2401, 0.3292], [0.3709, 0.8498, 0.3807]]])
in1Sub91335 = tf.constant([[[0.8857, 0.9335, 0.3496], [0.733, 0.6668, 0.5796], [0.9146, 0.1637, 0.5733]]])
in0Con15871 = tf.constant([[[[[0.1336]], [[0.5035]], [[0.4792]]], [[[0.1001]], [[0.6367]], [[0.667]]], [[[0.0091]], [[0.294]], [[0.6061]]]]])
in0Ave26775 = tf.constant([[[[[0.173, 0.8463]], [[0.9421, 0.8711]]], [[[0.5315, 0.4742]], [[0.5664, 0.0595]]]]])
in1Ave26775 = tf.constant([[[[[0.4402, 0.2838]], [[0.1617, 0.0334]]], [[[0.5217, 0.9212]], [[0.7227, 0.7766]]]]])
print (np.array2string(model.predict([in0Ave87861,in1Ave87861,in0Con65558,in0Sub91335,in1Sub91335,in0Con15871,in0Ave26775,in1Ave26775],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min44637.png')

LAve87861 = average_layer([[[[0.589], [0.5433]]], [[[0.8134], [0.0856]]]], Ave87861), 
LRes59866 = reshape_layer(Ave87861, [2, 1, 1], Res59866), 
LRes45680 = reshape_layer(Res59866, [2, 1, 1, 1], Res45680), 
LZer85785 = zero_padding3D_layer(Res45680, 1, 0, 2, 0, 0, 0, Zer85785), 
LCon65558 = concatenate_layer([Zer85785,[[[[[0.4224]], [[0.2713]], [[0.9981]]], [[[0.5546]], [[0.2799]], [[0.4632]]], [[[0.3077]], [[0.3243]], [[0.5259]]]]]], 4, Con65558), 
LSub91335 = subtract_layer([[[0.9166, 0.5959, 0.8894], [0.8198, 0.2401, 0.3292], [0.3709, 0.8498, 0.3807]]], [[[0.8857, 0.9335, 0.3496], [0.733, 0.6668, 0.5796], [0.9146, 0.1637, 0.5733]]], Sub91335), 
LRes72455 = reshape_layer(Sub91335, [3, 3, 1], Res72455), 
LRes24770 = reshape_layer(Res72455, [3, 3, 1, 1], Res24770), 
LCon15871 = concatenate_layer([Res24770,[[[[[0.1336]], [[0.5035]], [[0.4792]]], [[[0.1001]], [[0.6367]], [[0.667]]], [[[0.0091]], [[0.294]], [[0.6061]]]]]], 4, Con15871), 
LAve26775 = average_layer([[[[[[0.173, 0.8463]], [[0.9421, 0.8711]]], [[[0.5315, 0.4742]], [[0.5664, 0.0595]]]]], [[[[[0.4402, 0.2838]], [[0.1617, 0.0334]]], [[[0.5217, 0.9212]], [[0.7227, 0.7766]]]]]], Ave26775), 
LZer45817 = zero_padding3D_layer(Ave26775, 1, 0, 1, 0, 0, 0, Zer45817), 
LAve35945 = average_layer([Con15871,Zer45817], Ave35945), 
LMin44637 = minimum_layer([Con65558,Ave35945], Min44637), 
exec_layers([LAve87861,LRes59866,LRes45680,LZer85785,LCon65558,LSub91335,LRes72455,LRes24770,LCon15871,LAve26775,LZer45817,LAve35945,LMin44637],["Ave87861","Res59866","Res45680","Zer85785","Con65558","Sub91335","Res72455","Res24770","Con15871","Ave26775","Zer45817","Ave35945","Min44637"],Min44637,"Min44637")

Actual (Unparsed): [[[[[0.0000000, 0.0668000]], [[-0.1688000, 0.2517500]], [[0.0000000, 0.2396000]]], [[[0.0000000, 0.0500500]], [[-0.0600500, 0.2799000]], [[0.1507500, 0.4632000]]], [[[-0.2718500, 0.0045500]], [[0.0000000, 0.3243000]], [[0.2259750, 0.5120750]]]]]

Expected (Unparsed): [[[[[0,0.0668]],[[-0.1688,0.25175]],[[0,0.2396]]],[[[0,0.05005]],[[-0.06004999999999999,0.2799]],[[0.15075000000000002,0.4632]]],[[[-0.27185,0.00455]],[[0,0.3243]],[[0.22597499999999995,0.512075]]]]]

Actual:   [[[[[0, 0.0668]], [[-0.1688, 0.2518]], [[0, 0.2396]]], [[[0, 0.0501]], [[-0.06, 0.2799]], [[0.1508, 0.4632]]], [[[-0.2718, 0.0046]], [[0, 0.3243]], [[0.226, 0.5121]]]]]

Expected: [[[[[0, 0.0668]], [[-0.1688, 0.2518]], [[0, 0.2396]]], [[[0, 0.0501]], [[-0.06, 0.2799]], [[0.1508, 0.4632]]], [[[-0.2718, 0.0046]], [[0, 0.3243]], [[0.226, 0.5121]]]]]