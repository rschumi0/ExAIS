import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max91771 = tf.keras.layers.Input(shape=([1, 1]))
in1Max91771 = tf.keras.layers.Input(shape=([1, 1]))
in0Con21290 = tf.keras.layers.Input(shape=([2, 1]))
in0Sub6922 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub6922 = tf.keras.layers.Input(shape=([2, 3]))
in0Mul40606 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul40606 = tf.keras.layers.Input(shape=([2, 2]))
in0Con43859 = tf.keras.layers.Input(shape=([2, 1]))

Max91771 = keras.layers.Maximum(name = 'Max91771', )([in0Max91771,in1Max91771])
Res81721 = keras.layers.Reshape((1, 1, 1), name = 'Res81721', )(Max91771)
Loc43251 = keras.layers.LocallyConnected2D(2, (1, 1),strides=(1, 11), name = 'Loc43251', )(Res81721)
Res76061 = keras.layers.Reshape((1, 2), name = 'Res76061', )(Loc43251)
Zer18465 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer18465', )(Res76061)
Con21290 = keras.layers.Concatenate(axis=2, name = 'Con21290', )([Zer18465,in0Con21290])
Sub6922 = keras.layers.Subtract(name = 'Sub6922', )([in0Sub6922,in1Sub6922])
Ave82313 = keras.layers.Average(name = 'Ave82313', )([Con21290,Sub6922])
Mul40606 = keras.layers.Multiply(name = 'Mul40606', )([in0Mul40606,in1Mul40606])
Con43859 = keras.layers.Concatenate(axis=2, name = 'Con43859', )([Mul40606,in0Con43859])
Min16642 = keras.layers.Minimum(name = 'Min16642', )([Ave82313,Con43859])
model = tf.keras.models.Model(inputs=[in0Max91771,in1Max91771,in0Con21290,in0Sub6922,in1Sub6922,in0Mul40606,in1Mul40606,in0Con43859], outputs=Min16642)
w = model.get_layer('Loc43251').get_weights() 
w[0] = np.array([[[0.5384, 0.2115]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc43251').set_weights(w) 
in0Max91771 = tf.constant([[[0.7892]]])
in1Max91771 = tf.constant([[[0.2051]]])
in0Con21290 = tf.constant([[[0.6489], [0.3445]]])
in0Sub6922 = tf.constant([[[0.0484, 0.0587, 0.6413], [0.9542, 0.2871, 0.8977]]])
in1Sub6922 = tf.constant([[[0.742, 0.4538, 0.9199], [0.2041, 0.5749, 0.0916]]])
in0Mul40606 = tf.constant([[[0.3672, 0.7308], [0.557, 0.1172]]])
in1Mul40606 = tf.constant([[[0.6188, 0.8258], [0.5171, 0.5427]]])
in0Con43859 = tf.constant([[[0.0332], [0.1874]]])
print (np.array2string(model.predict([in0Max91771,in1Max91771,in0Con21290,in0Sub6922,in1Sub6922,in0Mul40606,in1Mul40606,in0Con43859],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min16642.png')

LMax91771 = maximum_layer([[[[0.7892]]], [[[0.2051]]]], Max91771), 
LRes81721 = reshape_layer(Max91771, [1, 1, 1], Res81721), 
LLoc43251 = locally_connected2D_layer(Res81721, 1, 1,[[[0.5384, 0.2115]]],[[[0, 0]]], 1, 11, Loc43251), 
LRes76061 = reshape_layer(Loc43251, [1, 2], Res76061), 
LZer18465 = zero_padding1D_layer(Res76061, 1, 0, Zer18465), 
LCon21290 = concatenate_layer([Zer18465,[[[0.6489], [0.3445]]]], 2, Con21290), 
LSub6922 = subtract_layer([[[0.0484, 0.0587, 0.6413], [0.9542, 0.2871, 0.8977]]], [[[0.742, 0.4538, 0.9199], [0.2041, 0.5749, 0.0916]]], Sub6922), 
LAve82313 = average_layer([Con21290,Sub6922], Ave82313), 
LMul40606 = multiply_layer([[[[0.3672, 0.7308], [0.557, 0.1172]]], [[[0.6188, 0.8258], [0.5171, 0.5427]]]], Mul40606), 
LCon43859 = concatenate_layer([Mul40606,[[[0.0332], [0.1874]]]], 2, Con43859), 
LMin16642 = minimum_layer([Ave82313,Con43859], Min16642), 
exec_layers([LMax91771,LRes81721,LLoc43251,LRes76061,LZer18465,LCon21290,LSub6922,LAve82313,LMul40606,LCon43859,LMin16642],["Max91771","Res81721","Loc43251","Res76061","Zer18465","Con21290","Sub6922","Ave82313","Mul40606","Con43859","Min16642"],Min16642,"Min16642")

Actual (Unparsed): [[[-0.3468000, -0.1975500, 0.0332000], [0.2880247, -0.0604421, 0.1874000]]]

Expected (Unparsed): [[[-0.3468,-0.19755,0.0332],[0.2880247,-0.06044209999999997,0.1874]]]

Actual:   [[[-0.3468, -0.1975, 0.0332], [0.2881, -0.0604, 0.1874]]]

Expected: [[[-0.3468, -0.1975, 0.0332], [0.2881, -0.0604, 0.1874]]]