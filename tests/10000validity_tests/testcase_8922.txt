import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo32130 = tf.keras.layers.Input(shape=([2, 1]))
in0Mul54022 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Mul54022 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con15278 = tf.keras.layers.Input(shape=([2, 1]))
in0Mul38485 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Mul38485 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Mul47931 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul47931 = tf.keras.layers.Input(shape=([2, 2]))
in0Con98036 = tf.keras.layers.Input(shape=([2, 2]))

Glo32130 = keras.layers.GlobalAveragePooling1D(name = 'Glo32130', )(in0Glo32130)
Res88899 = keras.layers.Reshape((1, 1), name = 'Res88899', )(Glo32130)
Res11755 = keras.layers.Reshape((1, 1, 1), name = 'Res11755', )(Res88899)
Zer81810 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer81810', )(Res11755)
Mul54022 = keras.layers.Multiply(name = 'Mul54022', )([in0Mul54022,in1Mul54022])
Sub18588 = keras.layers.Subtract(name = 'Sub18588', )([Zer81810,Mul54022])
Res29146 = keras.layers.Reshape((2, 1), name = 'Res29146', )(Sub18588)
Con15278 = keras.layers.Concatenate(axis=2, name = 'Con15278', )([Res29146,in0Con15278])
Mul38485 = keras.layers.Multiply(name = 'Mul38485', )([in0Mul38485,in1Mul38485])
Res91973 = keras.layers.Reshape((2, 2, 2), name = 'Res91973', )(Mul38485)
Res82660 = keras.layers.Reshape((2, 4), name = 'Res82660', )(Res91973)
Mul47931 = keras.layers.Multiply(name = 'Mul47931', )([in0Mul47931,in1Mul47931])
Con98036 = keras.layers.Concatenate(axis=2, name = 'Con98036', )([Mul47931,in0Con98036])
Ave32864 = keras.layers.Average(name = 'Ave32864', )([Res82660,Con98036])
Sep55056 = keras.layers.SeparableConv1D(2, (2),strides=(1), padding='valid', name = 'Sep55056', )(Ave32864)
Zer81166 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer81166', )(Sep55056)
Ave86975 = keras.layers.Average(name = 'Ave86975', )([Con15278,Zer81166])
model = tf.keras.models.Model(inputs=[in0Glo32130,in0Mul54022,in1Mul54022,in0Con15278,in0Mul38485,in1Mul38485,in0Mul47931,in1Mul47931,in0Con98036], outputs=Ave86975)
w = model.get_layer('Sep55056').get_weights() 
w[0] = np.array([[[0.6884], [0.203], [0.1641], [0.5578]], [[0.8417], [0.3956], [0.6728], [0.8791]]])
w[1] = np.array([[[0.1845, 0.3555], [0.954, 0.5112], [0.0332, 0.5972], [0.4539, 0.4351]]])
w[2] = np.array([0, 0])
model.get_layer('Sep55056').set_weights(w) 
in0Glo32130 = tf.constant([[[1.001], [1.4308]]])
in0Mul54022 = tf.constant([[[[0.3404]], [[0.201]]]])
in1Mul54022 = tf.constant([[[[0.5228]], [[0.3105]]]])
in0Con15278 = tf.constant([[[0.077], [0.5059]]])
in0Mul38485 = tf.constant([[[[[0.1951], [0.7941]], [[0.5953], [0.7963]]], [[[0.5549], [0.4246]], [[0.6735], [0.9482]]]]])
in1Mul38485 = tf.constant([[[[[0.4639], [0.6892]], [[0.4466], [0.9622]]], [[[0.9142], [0.0959]], [[0.2848], [0.4512]]]]])
in0Mul47931 = tf.constant([[[0.5908, 0.1557], [0.0094, 0.2024]]])
in1Mul47931 = tf.constant([[[0.3146, 0.482], [0.4173, 0.0936]]])
in0Con98036 = tf.constant([[[0.8336, 0.8492], [0.898, 0.869]]])
print (np.array2string(model.predict([in0Glo32130,in0Mul54022,in1Mul54022,in0Con15278,in0Mul38485,in1Mul38485,in0Mul47931,in1Mul47931,in0Con98036],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave86975.png')

LGlo32130 = global_average_pooling1D_layer([[[1.001], [1.4308]]], Glo32130), 
LRes88899 = reshape_layer(Glo32130, [1, 1], Res88899), 
LRes11755 = reshape_layer(Res88899, [1, 1, 1], Res11755), 
LZer81810 = zero_padding2D_layer(Res11755, 1, 0, 0, 0, Zer81810), 
LMul54022 = multiply_layer([[[[[0.3404]], [[0.201]]]], [[[[0.5228]], [[0.3105]]]]], Mul54022), 
LSub18588 = subtract_layer(Zer81810,Mul54022, Sub18588), 
LRes29146 = reshape_layer(Sub18588, [2, 1], Res29146), 
LCon15278 = concatenate_layer([Res29146,[[[0.077], [0.5059]]]], 2, Con15278), 
LMul38485 = multiply_layer([[[[[[0.1951], [0.7941]], [[0.5953], [0.7963]]], [[[0.5549], [0.4246]], [[0.6735], [0.9482]]]]], [[[[[0.4639], [0.6892]], [[0.4466], [0.9622]]], [[[0.9142], [0.0959]], [[0.2848], [0.4512]]]]]], Mul38485), 
LRes91973 = reshape_layer(Mul38485, [2, 2, 2], Res91973), 
LRes82660 = reshape_layer(Res91973, [2, 4], Res82660), 
LMul47931 = multiply_layer([[[[0.5908, 0.1557], [0.0094, 0.2024]]], [[[0.3146, 0.482], [0.4173, 0.0936]]]], Mul47931), 
LCon98036 = concatenate_layer([Mul47931,[[[0.8336, 0.8492], [0.898, 0.869]]]], 2, Con98036), 
LAve32864 = average_layer([Res82660,Con98036], Ave32864), 
LSep55056 = separable_conv1D_layer(Ave32864, 2,[[[[0.6884], [0.203], [0.1641], [0.5578]], [[0.8417], [0.3956], [0.6728], [0.8791]]],[[[0.1845, 0.3555], [0.954, 0.5112], [0.0332, 0.5972], [0.4539, 0.4351]]]],[0, 0], 1, false, Sep55056), 
LZer81166 = zero_padding1D_layer(Sep55056, 1, 0, Zer81166), 
LAve86975 = average_layer([Con15278,Zer81166], Ave86975), 
exec_layers([LGlo32130,LRes88899,LRes11755,LZer81810,LMul54022,LSub18588,LRes29146,LCon15278,LMul38485,LRes91973,LRes82660,LMul47931,LCon98036,LAve32864,LSep55056,LZer81166,LAve86975],["Glo32130","Res88899","Res11755","Zer81810","Mul54022","Sub18588","Res29146","Con15278","Mul38485","Res91973","Res82660","Mul47931","Con98036","Ave32864","Sep55056","Zer81166","Ave86975"],Ave86975,"Ave86975")

Actual (Unparsed): [[[-0.0889806, 0.0385000], [0.8803259, 0.6856923]]]

Expected (Unparsed): [[[-0.08898056,0.0385],[0.8803259189984192,0.6856922722689851]]]

Actual:   [[[-0.0889, 0.0385], [0.8804, 0.6857]]]

Expected: [[[-0.0889, 0.0385], [0.8804, 0.6857]]]