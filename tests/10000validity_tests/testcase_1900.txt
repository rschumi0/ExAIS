import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave18630 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave18630 = tf.keras.layers.Input(shape=([1, 2]))
in0Con26815 = tf.keras.layers.Input(shape=([1, 1]))
in0Cro99667 = tf.keras.layers.Input(shape=([1, 3, 1]))

Ave18630 = keras.layers.Average(name = 'Ave18630', )([in0Ave18630,in1Ave18630])
Con90060 = keras.layers.Conv1D(3, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con90060', )(Ave18630)
Con26815 = keras.layers.Conv1D(3, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con26815', )(in0Con26815)
Max15687 = keras.layers.Maximum(name = 'Max15687', )([Con90060,Con26815])
Cro99667 = keras.layers.Cropping2D(cropping=((0, 0), (2, 0)), name = 'Cro99667', )(in0Cro99667)
Res54945 = keras.layers.Reshape((1, 1), name = 'Res54945', )(Cro99667)
Dot48037 = keras.layers.Dot(axes=(1, 1), name = 'Dot48037', )([Max15687,Res54945])
Res89811 = keras.layers.Reshape((3, 1, 1), name = 'Res89811', )(Dot48037)
Sep61363 = keras.layers.SeparableConv2D(4, (3, 1),strides=(2, 2), padding='valid', name = 'Sep61363', )(Res89811)
model = tf.keras.models.Model(inputs=[in0Ave18630,in1Ave18630,in0Con26815,in0Cro99667], outputs=Sep61363)
w = model.get_layer('Con90060').get_weights() 
w[0] = np.array([[[0.2106, 0.8008, 0.62], [0.7203, 0.9228, 0.5786]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con90060').set_weights(w) 
w = model.get_layer('Con26815').get_weights() 
w[0] = np.array([[[0.7405, 0.769, 0.8859]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con26815').set_weights(w) 
w = model.get_layer('Sep61363').get_weights() 
w[0] = np.array([[[[0.0765]]], [[[0.2562]]], [[[0.48]]]])
w[1] = np.array([[[[0.1443, 0.1499, 0.5378, 0.3019]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep61363').set_weights(w) 
in0Ave18630 = tf.constant([[[0.6798, 0.778]]])
in1Ave18630 = tf.constant([[[0.9252, 0.4171]]])
in0Con26815 = tf.constant([[[0.3454]]])
in0Cro99667 = tf.constant([[[[1.9118], [1.4051], [1.0087]]]])
print (np.array2string(model.predict([in0Ave18630,in1Ave18630,in0Con26815,in0Cro99667],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sep61363.png')

LAve18630 = average_layer([[[[0.6798, 0.778]]], [[[0.9252, 0.4171]]]], Ave18630), 
LCon90060 = conv1D_layer(Ave18630, 1,[[[0.2106, 0.8008, 0.62], [0.7203, 0.9228, 0.5786]]],[0, 0, 0], 1, false, 1, Con90060), 
LCon26815 = conv1D_layer([[[0.3454]]], 1,[[[0.7405, 0.769, 0.8859]]],[0, 0, 0], 1, false, 1, Con26815), 
LMax15687 = maximum_layer([Con90060,Con26815], Max15687), 
LCro99667 = cropping2D_layer([[[[1.9118], [1.4051], [1.0087]]]], 0, 0, 2, 0, Cro99667), 
LRes54945 = reshape_layer(Cro99667, [1, 1], Res54945), 
LDot48037 = dot_layer(Max15687,Res54945, 1, 1, Dot48037), 
LRes89811 = reshape_layer(Dot48037, [3, 1, 1], Res89811), 
LSep61363 = separable_conv2D_layer(Res89811, 3, 1,[[[[[0.0765]]], [[[0.2562]]], [[[0.48]]]],[[[[0.1443, 0.1499, 0.5378, 0.3019]]]]],[0, 0, 0, 0], 2, 2, false, Sep61363), 
exec_layers([LAve18630,LCon90060,LCon26815,LMax15687,LCro99667,LRes54945,LDot48037,LRes89811,LSep61363],["Ave18630","Con90060","Con26815","Max15687","Cro99667","Res54945","Dot48037","Res89811","Sep61363"],Sep61363,"Sep61363")

Actual (Unparsed): [[[[0.1101206, 0.1143942, 0.4104149, 0.2303909]]]]

Expected (Unparsed): [[[[0.11012061433400389,0.11439417940864297,0.41041487448944747,0.23039094572027558]]]]

Actual:   [[[[0.1102, 0.1144, 0.4105, 0.2304]]]]

Expected: [[[[0.1102, 0.1144, 0.4105, 0.2304]]]]