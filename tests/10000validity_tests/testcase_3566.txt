import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave45691 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Ave45691 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in0Con80721 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Lay89647 = tf.keras.layers.Input(shape=([4]))
in0Max921 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con12927 = tf.keras.layers.Input(shape=([1, 2, 1]))

Ave45691 = keras.layers.Average(name = 'Ave45691', )([in0Ave45691,in1Ave45691])
Res62081 = keras.layers.Reshape((1, 1, 1), name = 'Res62081', )(Ave45691)
Dep2548 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='valid', name = 'Dep2548', )(Res62081)
Cro32795 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro32795', )(Dep2548)
Zer64011 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer64011', )(Cro32795)
Con80721 = keras.layers.Concatenate(axis=3, name = 'Con80721', )([Zer64011,in0Con80721])
Lay89647 = keras.layers.LayerNormalization(axis=1, epsilon=2.668636619693327, name = 'Lay89647', )(in0Lay89647)
Res41924 = keras.layers.Reshape((4, 1), name = 'Res41924', )(Lay89647)
Res43012 = keras.layers.Reshape((4, 1, 1), name = 'Res43012', )(Res41924)
Res45790 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res45790', )(Res43012)
Glo6871 = keras.layers.GlobalMaxPool3D(name = 'Glo6871', )(Res45790)
Res82306 = keras.layers.Reshape((1, 1), name = 'Res82306', )(Glo6871)
Res73846 = keras.layers.Reshape((1, 1, 1), name = 'Res73846', )(Res82306)
Sep60621 = keras.layers.SeparableConv2D(3, (1, 1),strides=(1, 1), padding='same', name = 'Sep60621', )(Res73846)
Zer83283 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer83283', )(Sep60621)
Max921 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 1), padding='same', name = 'Max921', )(in0Max921)
Thr29404 = keras.layers.ThresholdedReLU(theta=6.492587389226564, name = 'Thr29404', )(Max921)
Con12927 = keras.layers.Concatenate(axis=3, name = 'Con12927', )([Thr29404,in0Con12927])
Max70251 = keras.layers.Maximum(name = 'Max70251', )([Zer83283,Con12927])
Max47133 = keras.layers.Maximum(name = 'Max47133', )([Con80721,Max70251])
model = tf.keras.models.Model(inputs=[in0Ave45691,in1Ave45691,in0Con80721,in0Lay89647,in0Max921,in0Con12927], outputs=Max47133)
w = model.get_layer('Dep2548').get_weights() 
w[0] = np.array([[[[0.0502]]]])
w[1] = np.array([0])
model.get_layer('Dep2548').set_weights(w) 
w = model.get_layer('Sep60621').get_weights() 
w[0] = np.array([[[[0.8206]]]])
w[1] = np.array([[[[0.5786, 0.8574, 0.688]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep60621').set_weights(w) 
in0Ave45691 = tf.constant([[[[[0.6949]]]]])
in1Ave45691 = tf.constant([[[[[0.3325]]]]])
in0Con80721 = tf.constant([[[[0.7865, 0.0651], [0.7656, 0.38]]]])
in0Lay89647 = tf.constant([[1.7517, 1.2764, 1.991, 1.6196]])
in0Max921 = tf.constant([[[[1.7724, 1.4225], [1.2545, 1.6665]]]])
in0Con12927 = tf.constant([[[[0.8296], [0.8815]]]])
print (np.array2string(model.predict([in0Ave45691,in1Ave45691,in0Con80721,in0Lay89647,in0Max921,in0Con12927],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max47133.png')

LAve45691 = average_layer([[[[[[0.6949]]]]], [[[[[0.3325]]]]]], Ave45691), 
LRes62081 = reshape_layer(Ave45691, [1, 1, 1], Res62081), 
LDep2548 = depthwise_conv2D_layer(Res62081, 1, 1,[[[[0.0502]]]],[0], 1, 1, false, Dep2548), 
LCro32795 = cropping2D_layer(Dep2548, 0, 0, 0, 0, Cro32795), 
LZer64011 = zero_padding2D_layer(Cro32795, 0, 0, 1, 0, Zer64011), 
LCon80721 = concatenate_layer([Zer64011,[[[[0.7865, 0.0651], [0.7656, 0.38]]]]], 3, Con80721), 
LLay89647 = layer_normalization_layer([[1.7517, 1.2764, 1.991, 1.6196]], 1, 2.668636619693327, Lay89647), 
LRes41924 = reshape_layer(Lay89647, [4, 1], Res41924), 
LRes43012 = reshape_layer(Res41924, [4, 1, 1], Res43012), 
LRes45790 = reshape_layer(Res43012, [4, 1, 1, 1], Res45790), 
LGlo6871 = global_max_pool3D_layer(Res45790, Glo6871), 
LRes82306 = reshape_layer(Glo6871, [1, 1], Res82306), 
LRes73846 = reshape_layer(Res82306, [1, 1, 1], Res73846), 
LSep60621 = separable_conv2D_layer(Res73846, 1, 1,[[[[[0.8206]]]],[[[[0.5786, 0.8574, 0.688]]]]],[0, 0, 0], 1, 1, true, Sep60621), 
LZer83283 = zero_padding2D_layer(Sep60621, 0, 0, 1, 0, Zer83283), 
LMax921 = max_pool2D_layer([[[[1.7724, 1.4225], [1.2545, 1.6665]]]], 1, 1, 1, 1, true, Max921), 
LThr29404 = thresholded_relu_layer(Max921, 6.492587389226564, Thr29404), 
LCon12927 = concatenate_layer([Thr29404,[[[[0.8296], [0.8815]]]]], 3, Con12927), 
LMax70251 = maximum_layer([Zer83283,Con12927], Max70251), 
LMax47133 = maximum_layer([Con80721,Max70251], Max47133), 
exec_layers([LAve45691,LRes62081,LDep2548,LCro32795,LZer64011,LCon80721,LLay89647,LRes41924,LRes43012,LRes45790,LGlo6871,LRes82306,LRes73846,LSep60621,LZer83283,LMax921,LThr29404,LCon12927,LMax70251,LMax47133],["Ave45691","Res62081","Dep2548","Cro32795","Zer64011","Con80721","Lay89647","Res41924","Res43012","Res45790","Glo6871","Res82306","Res73846","Sep60621","Zer83283","Max921","Thr29404","Con12927","Max70251","Max47133"],Max47133,"Max47133")

Actual (Unparsed): [[[[0.0000000, 0.7865000, 0.8296000], [0.0951174, 0.7656000, 0.8815000]]]]

Expected (Unparsed): [[[[0,0.7865,0.8296],[0.09511734938864974,0.7656,0.8815]]]]

Actual:   [[[[0, 0.7865, 0.8296], [0.0952, 0.7656, 0.8815]]]]

Expected: [[[[0, 0.7865, 0.8296], [0.0952, 0.7656, 0.8815]]]]