import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min12117 = tf.keras.layers.Input(shape=([1, 2]))
in1Min12117 = tf.keras.layers.Input(shape=([1, 2]))
in0Max29403 = tf.keras.layers.Input(shape=([2, 2]))
in0Thr78090 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Con78271 = tf.keras.layers.Input(shape=([2, 1]))
in0Min23745 = tf.keras.layers.Input(shape=([2, 2]))
in1Min23745 = tf.keras.layers.Input(shape=([2, 2]))

Min12117 = keras.layers.Minimum(name = 'Min12117', )([in0Min12117,in1Min12117])
Max29403 = keras.layers.MaxPool1D(pool_size=(2), strides=(1), padding='valid', name = 'Max29403', )(in0Max29403)
Min67156 = keras.layers.Minimum(name = 'Min67156', )([Min12117,Max29403])
Res64485 = keras.layers.Reshape((1, 2, 1), name = 'Res64485', )(Min67156)
Loc47596 = keras.layers.LocallyConnected2D(2, (1, 2),strides=(1, 1), name = 'Loc47596', )(Res64485)
Res88187 = keras.layers.Reshape((1, 2), name = 'Res88187', )(Loc47596)
Zer53061 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer53061', )(Res88187)
Thr78090 = keras.layers.ThresholdedReLU(theta=4.322580544302064, name = 'Thr78090', input_shape=(2, 1, 1, 1))(in0Thr78090)
Res97036 = keras.layers.Reshape((2, 1, 1), name = 'Res97036', )(Thr78090)
Res39065 = keras.layers.Reshape((2, 1), name = 'Res39065', )(Res97036)
Con78271 = keras.layers.Concatenate(axis=2, name = 'Con78271', )([Res39065,in0Con78271])
Min23745 = keras.layers.Minimum(name = 'Min23745', )([in0Min23745,in1Min23745])
Sof17873 = keras.layers.Softmax(axis=1, name = 'Sof17873', )(Min23745)
Min59148 = keras.layers.Minimum(name = 'Min59148', )([Con78271,Sof17873])
Sub47288 = keras.layers.Subtract(name = 'Sub47288', )([Zer53061,Min59148])
model = tf.keras.models.Model(inputs=[in0Min12117,in1Min12117,in0Max29403,in0Thr78090,in0Con78271,in0Min23745,in1Min23745], outputs=Sub47288)
w = model.get_layer('Loc47596').get_weights() 
w[0] = np.array([[[0.2084, 0.7092], [0.4738, 0.9597]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc47596').set_weights(w) 
in0Min12117 = tf.constant([[[0.8645, 0.331]]])
in1Min12117 = tf.constant([[[0.2972, 0.6147]]])
in0Max29403 = tf.constant([[[1.1015, 1.9175], [1.2932, 1.9917]]])
in0Thr78090 = tf.constant([[[[[0.1161]]], [[[0.0152]]]]])
in0Con78271 = tf.constant([[[0.4301], [0.6771]]])
in0Min23745 = tf.constant([[[0.5166, 0.8361], [0.3247, 0.5161]]])
in1Min23745 = tf.constant([[[0.0606, 0.1387], [0.7614, 0.1384]]])
print (np.array2string(model.predict([in0Min12117,in1Min12117,in0Max29403,in0Thr78090,in0Con78271,in0Min23745,in1Min23745],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub47288.png')

LMin12117 = minimum_layer([[[[0.8645, 0.331]]], [[[0.2972, 0.6147]]]], Min12117), 
LMax29403 = max_pool1D_layer([[[1.1015, 1.9175], [1.2932, 1.9917]]], 2, 1, false, Max29403), 
LMin67156 = minimum_layer([Min12117,Max29403], Min67156), 
LRes64485 = reshape_layer(Min67156, [1, 2, 1], Res64485), 
LLoc47596 = locally_connected2D_layer(Res64485, 1, 2,[[[0.2084, 0.7092], [0.4738, 0.9597]]],[[[0, 0]]], 1, 1, Loc47596), 
LRes88187 = reshape_layer(Loc47596, [1, 2], Res88187), 
LZer53061 = zero_padding1D_layer(Res88187, 1, 0, Zer53061), 
LThr78090 = thresholded_relu_layer([[[[[0.1161]]], [[[0.0152]]]]], 4.322580544302064, Thr78090), 
LRes97036 = reshape_layer(Thr78090, [2, 1, 1], Res97036), 
LRes39065 = reshape_layer(Res97036, [2, 1], Res39065), 
LCon78271 = concatenate_layer([Res39065,[[[0.4301], [0.6771]]]], 2, Con78271), 
LMin23745 = minimum_layer([[[[0.5166, 0.8361], [0.3247, 0.5161]]], [[[0.0606, 0.1387], [0.7614, 0.1384]]]], Min23745), 
LSof17873 = softmax_layer(Min23745, 1, Sof17873), 
LMin59148 = minimum_layer([Con78271,Sof17873], Min59148), 
LSub47288 = subtract_layer(Zer53061,Min59148, Sub47288), 
exec_layers([LMin12117,LMax29403,LMin67156,LRes64485,LLoc47596,LRes88187,LZer53061,LThr78090,LRes97036,LRes39065,LCon78271,LMin23745,LSof17873,LMin59148,LSub47288],["Min12117","Max29403","Min67156","Res64485","Loc47596","Res88187","Zer53061","Thr78090","Res97036","Res39065","Con78271","Min23745","Sof17873","Min59148","Sub47288"],Sub47288,"Sub47288")

Actual (Unparsed): [[[0.0000000, -0.4301000], [0.2187643, 0.0285099]]]

Expected (Unparsed): [[[0,-0.4301],[0.21876428000000003,0.028509939999437572]]]

Actual:   [[[0, -0.4301], [0.2188, 0.0286]]]

Expected: [[[0, -0.4301], [0.2188, 0.0286]]]