import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave52990 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Ave52990 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Sub45607 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub45607 = tf.keras.layers.Input(shape=([2, 3]))

Ave52990 = keras.layers.Average(name = 'Ave52990', )([in0Ave52990,in1Ave52990])
ReL35346 = keras.layers.ReLU(max_value=5.100984067973698, negative_slope=1.2647486417187082, threshold=3.9390692032422567, name = 'ReL35346', )(Ave52990)
Res51265 = keras.layers.Reshape((1, 2), name = 'Res51265', )(ReL35346)
Zer73146 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer73146', )(Res51265)
Sub45607 = keras.layers.Subtract(name = 'Sub45607', )([in0Sub45607,in1Sub45607])
Sof83038 = keras.layers.Softmax(axis=1, name = 'Sof83038', )(Sub45607)
Per70326 = keras.layers.Permute((2,1), name = 'Per70326',)(Sof83038)
Max74844 = keras.layers.Maximum(name = 'Max74844', )([Zer73146,Per70326])
model = tf.keras.models.Model(inputs=[in0Ave52990,in1Ave52990,in0Sub45607,in1Sub45607], outputs=Max74844)
in0Ave52990 = tf.constant([[[[0.4486, 0.8479]]]])
in1Ave52990 = tf.constant([[[[0.9991, 0.007]]]])
in0Sub45607 = tf.constant([[[0.0096, 0.5687, 0.3983], [0.4075, 0.7207, 0.1205]]])
in1Sub45607 = tf.constant([[[0.3834, 0.1196, 0.4794], [0.7452, 0.7318, 0.3168]]])
print (np.array2string(model.predict([in0Ave52990,in1Ave52990,in0Sub45607,in1Sub45607],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max74844.png')

LAve52990 = average_layer([[[[[0.4486, 0.8479]]]], [[[[0.9991, 0.007]]]]], Ave52990), 
LReL35346 = relu_layer(Ave52990, 5.100984067973698, 1.2647486417187082, 3.9390692032422567, ReL35346), 
LRes51265 = reshape_layer(ReL35346, [1, 2], Res51265), 
LZer73146 = zero_padding1D_layer(Res51265, 2, 0, Zer73146), 
LSub45607 = subtract_layer([[[0.0096, 0.5687, 0.3983], [0.4075, 0.7207, 0.1205]]], [[[0.3834, 0.1196, 0.4794], [0.7452, 0.7318, 0.3168]]], Sub45607), 
LSof83038 = softmax_layer(Sub45607, 1, Sof83038), 
LPer70326 = permute_layer(Sof83038, 2,1, Per70326), 
LMax74844 = maximum_layer([Zer73146,Per70326], Max74844), 
exec_layers([LAve52990,LReL35346,LRes51265,LZer73146,LSub45607,LSof83038,LPer70326,LMax74844],["Ave52990","ReL35346","Res51265","Zer73146","Sub45607","Sof83038","Per70326","Max74844"],Max74844,"Max74844")

Actual (Unparsed): [[[0.4909760, 0.5090240], [0.6130616, 0.3869384], [0.5287682, 0.4712318]]]

Expected (Unparsed): [[[0.49097597999480713,0.5090240200051928],[0.6130616206259957,0.38693837937400427],[0.5287681917162338,0.4712318082837662]]]

Actual:   [[[0.491, 0.5091], [0.6131, 0.387], [0.5288, 0.4713]]]

Expected: [[[0.491, 0.5091], [0.6131, 0.387], [0.5288, 0.4713]]]