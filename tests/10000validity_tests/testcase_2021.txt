import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con16660 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Glo62840 = tf.keras.layers.Input(shape=([2, 1]))
in0Con7850 = tf.keras.layers.Input(shape=([3]))
in0Con1899 = tf.keras.layers.Input(shape=([8, 1]))
in0Con63627 = tf.keras.layers.Input(shape=([2, 2]))
in0Per75375 = tf.keras.layers.Input(shape=([3, 2]))
in0Con52080 = tf.keras.layers.Input(shape=([2, 1]))

Con16660 = keras.layers.Conv3D(2, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con16660', )(in0Con16660)
Res91667 = keras.layers.Reshape((2, 1, 2), name = 'Res91667', )(Con16660)
Res58989 = keras.layers.Reshape((2, 2), name = 'Res58989', )(Res91667)
Fla23311 = keras.layers.Flatten(name = 'Fla23311', )(Res58989)
Glo62840 = keras.layers.GlobalAveragePooling1D(name = 'Glo62840', )(in0Glo62840)
Con7850 = keras.layers.Concatenate(axis=1, name = 'Con7850', )([Glo62840,in0Con7850])
Sub57972 = keras.layers.Subtract(name = 'Sub57972', )([Fla23311,Con7850])
Res36531 = keras.layers.Reshape((4, 1), name = 'Res36531', )(Sub57972)
Res20095 = keras.layers.Reshape((4, 1, 1), name = 'Res20095', )(Res36531)
Up_18512 = keras.layers.UpSampling2D(size=(2, 1), name = 'Up_18512', )(Res20095)
Res78422 = keras.layers.Reshape((8, 1, 1, 1), name = 'Res78422', )(Up_18512)
Con98263 = keras.layers.Conv3D(3, (8, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con98263', )(Res78422)
Res3006 = keras.layers.Reshape((8, 1, 3), name = 'Res3006', )(Con98263)
Res79876 = keras.layers.Reshape((8, 3), name = 'Res79876', )(Res3006)
Con1899 = keras.layers.Concatenate(axis=2, name = 'Con1899', )([Res79876,in0Con1899])
Con63627 = keras.layers.Conv1D(4, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con63627', )(in0Con63627)
Per75375 = keras.layers.Permute((2,1), name = 'Per75375',)(in0Per75375)
Con52080 = keras.layers.Concatenate(axis=2, name = 'Con52080', )([Per75375,in0Con52080])
Max16296 = keras.layers.Maximum(name = 'Max16296', )([Con63627,Con52080])
Dot83762 = keras.layers.Dot(axes=(2, 2), name = 'Dot83762', )([Con1899,Max16296])
model = tf.keras.models.Model(inputs=[in0Con16660,in0Glo62840,in0Con7850,in0Con1899,in0Con63627,in0Per75375,in0Con52080], outputs=Dot83762)
w = model.get_layer('Con16660').get_weights() 
w[0] = np.array([[[[[0.7073, 0.8817], [0.803, 0.8942]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con16660').set_weights(w) 
w = model.get_layer('Con98263').get_weights() 
w[0] = np.array([[[[[0.467, 0.9737, 0.095]]]], [[[[0.075, 0.2068, 0.7581]]]], [[[[0.712, 0.0057, 0.8525]]]], [[[[0.6053, 0.3032, 0.0821]]]], [[[[0.0414, 0.874, 0.6476]]]], [[[[0.8114, 0.9527, 0.9734]]]], [[[[0.4882, 0.1355, 0.4024]]]], [[[[0.3392, 0.8705, 0.8265]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con98263').set_weights(w) 
w = model.get_layer('Con63627').get_weights() 
w[0] = np.array([[[0.0676, 0.9928, 0.9151, 0.5895], [0.0871, 0.2079, 0.8934, 0.8282]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con63627').set_weights(w) 
in0Con16660 = tf.constant([[[[[0.4261, 0.9125]]], [[[0.4028, 0.3504]]]]])
in0Glo62840 = tf.constant([[[1.1093], [1.5266]]])
in0Con7850 = tf.constant([[0.0453, 0.5853, 0.5526]])
in0Con1899 = tf.constant([[[0.5122], [0.0122], [0.2025], [0.7435], [0.6124], [0.8008], [0.821], [0.9788]]])
in0Con63627 = tf.constant([[[0.276, 0.8344], [0.5939, 0.0767]]])
in0Per75375 = tf.constant([[[1.6109, 1.0976], [1.2382, 1.6837], [1.561, 1.0297]]])
in0Con52080 = tf.constant([[[0.3563], [0.9301]]])
print (np.array2string(model.predict([in0Con16660,in0Glo62840,in0Con7850,in0Con1899,in0Con63627,in0Per75375,in0Con52080],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot83762.png')

LCon16660 = conv3D_layer([[[[[0.4261, 0.9125]]], [[[0.4028, 0.3504]]]]], 1, 1, 1,[[[[[0.7073, 0.8817], [0.803, 0.8942]]]]],[0, 0], 1, 1, 1, false, 1, 1, 1, Con16660), 
LRes91667 = reshape_layer(Con16660, [2, 1, 2], Res91667), 
LRes58989 = reshape_layer(Res91667, [2, 2], Res58989), 
LFla23311 = flatten_layer(Res58989, Fla23311), 
LGlo62840 = global_average_pooling1D_layer([[[1.1093], [1.5266]]], Glo62840), 
LCon7850 = concatenate_layer([Glo62840,[[0.0453, 0.5853, 0.5526]]], 1, Con7850), 
LSub57972 = subtract_layer(Fla23311,Con7850, Sub57972), 
LRes36531 = reshape_layer(Sub57972, [4, 1], Res36531), 
LRes20095 = reshape_layer(Res36531, [4, 1, 1], Res20095), 
LUp_18512 = up_sampling2D_layer(Res20095, 2, 1, Up_18512), 
LRes78422 = reshape_layer(Up_18512, [8, 1, 1, 1], Res78422), 
LCon98263 = conv3D_layer(Res78422, 8, 1, 1,[[[[[0.467, 0.9737, 0.095]]]], [[[[0.075, 0.2068, 0.7581]]]], [[[[0.712, 0.0057, 0.8525]]]], [[[[0.6053, 0.3032, 0.0821]]]], [[[[0.0414, 0.874, 0.6476]]]], [[[[0.8114, 0.9527, 0.9734]]]], [[[[0.4882, 0.1355, 0.4024]]]], [[[[0.3392, 0.8705, 0.8265]]]]],[0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con98263), 
LRes3006 = reshape_layer(Con98263, [8, 1, 3], Res3006), 
LRes79876 = reshape_layer(Res3006, [8, 3], Res79876), 
LCon1899 = concatenate_layer([Res79876,[[[0.5122], [0.0122], [0.2025], [0.7435], [0.6124], [0.8008], [0.821], [0.9788]]]], 2, Con1899), 
LCon63627 = conv1D_layer([[[0.276, 0.8344], [0.5939, 0.0767]]], 1,[[[0.0676, 0.9928, 0.9151, 0.5895], [0.0871, 0.2079, 0.8934, 0.8282]]],[0, 0, 0, 0], 1, true, 1, Con63627), 
LPer75375 = permute_layer([[[1.6109, 1.0976], [1.2382, 1.6837], [1.561, 1.0297]]], 2,1, Per75375), 
LCon52080 = concatenate_layer([Per75375,[[[0.3563], [0.9301]]]], 2, Con52080), 
LMax16296 = maximum_layer([Con63627,Con52080], Max16296), 
LDot83762 = dot_layer(Con1899,Max16296, 2, 2, Dot83762), 
exec_layers([LCon16660,LRes91667,LRes58989,LFla23311,LGlo62840,LCon7850,LSub57972,LRes36531,LRes20095,LUp_18512,LRes78422,LCon98263,LRes3006,LRes79876,LCon1899,LCon63627,LPer75375,LCon52080,LMax16296,LDot83762],["Con16660","Res91667","Res58989","Fla23311","Glo62840","Con7850","Sub57972","Res36531","Res20095","Up_18512","Res78422","Con98263","Res3006","Res79876","Con1899","Con63627","Per75375","Con52080","Max16296","Dot83762"],Dot83762,"Dot83762")

Actual (Unparsed): [[[5.7555728, 4.8074624], [5.8682673, 5.6187815], [3.4270706, 3.5406894], [4.5413181, 3.4061221], [5.1404073, 3.7087854], [5.5258408, 5.3148255], [3.4600349, 3.6868803], [1.2251530, 1.1838490]]]

Expected (Unparsed): [[[5.7555728498860095,4.807462410848923],[5.868267441410582,5.618781581487965],[3.4270708642317453,3.540689605293494],[4.54131835861316,3.4061223464992723],[5.140407592458251,3.70878559534778],[5.52584113782795,5.314825701973754],[3.460035139234872,3.6868805588665285],[1.2251532662851063,1.1838492054782903]]]

Actual:   [[[5.7556, 4.8075], [5.8683, 5.6188], [3.4271, 3.5407], [4.5414, 3.4062], [5.1405, 3.7088], [5.5259, 5.3149], [3.4601, 3.6869], [1.2252, 1.1839]]]

Expected: [[[5.7556, 4.8075], [5.8683, 5.6188], [3.4271, 3.5407], [4.5414, 3.4062], [5.1405, 3.7088], [5.5259, 5.3149], [3.4601, 3.6869], [1.2252, 1.1839]]]