import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max97553 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Max97553 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Con37311 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con87579 = tf.keras.layers.Input(shape=([1, 1, 1]))

Max97553 = keras.layers.Maximum(name = 'Max97553', )([in0Max97553,in1Max97553])
Res19250 = keras.layers.Reshape((1, 2, 2), name = 'Res19250', )(Max97553)
Con37311 = keras.layers.Concatenate(axis=3, name = 'Con37311', )([Res19250,in0Con37311])
Con87579 = keras.layers.Conv2DTranspose(4, (1, 1),strides=(1, 1), padding='same', name = 'Con87579', )(in0Con87579)
Zer63480 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer63480', )(Con87579)
Mul94149 = keras.layers.Multiply(name = 'Mul94149', )([Con37311,Zer63480])
Res56982 = keras.layers.Reshape((1, 8), name = 'Res56982', )(Mul94149)
LST32946 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST32946', )(Res56982)
model = tf.keras.models.Model(inputs=[in0Max97553,in1Max97553,in0Con37311,in0Con87579], outputs=LST32946)
w = model.get_layer('Con87579').get_weights() 
w[0] = np.array([[[[0.9551], [0.2534], [0.904], [0.9575]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con87579').set_weights(w) 
w = model.get_layer('LST32946').get_weights() 
w[0] = np.array([[10, 7, 7, 6], [7, 2, 2, 4], [9, 1, 3, 9], [9, 7, 8, 3], [8, 8, 5, 6], [5, 6, 9, 8], [5, 4, 8, 8], [6, 9, 7, 1]])
w[1] = np.array([[9, 6, 7, 4]])
w[2] = np.array([8, 1, 5, 4])
model.get_layer('LST32946').set_weights(w) 
in0Max97553 = tf.constant([[[[[0.4446, 0.8025]], [[0.8008, 0.8832]]]]])
in1Max97553 = tf.constant([[[[[0.7954, 0.9491]], [[0.1067, 0.6878]]]]])
in0Con37311 = tf.constant([[[[0.6745, 0.9792], [0.0925, 0.7566]]]])
in0Con87579 = tf.constant([[[[0.0813]]]])
print (np.array2string(model.predict([in0Max97553,in1Max97553,in0Con37311,in0Con87579],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST32946.png')

LMax97553 = maximum_layer([[[[[[0.4446, 0.8025]], [[0.8008, 0.8832]]]]], [[[[[0.7954, 0.9491]], [[0.1067, 0.6878]]]]]], Max97553), 
LRes19250 = reshape_layer(Max97553, [1, 2, 2], Res19250), 
LCon37311 = concatenate_layer([Res19250,[[[[0.6745, 0.9792], [0.0925, 0.7566]]]]], 3, Con37311), 
LCon87579 = conv2D_transpose_layer([[[[0.0813]]]], 1, 1,[[[[0.9551], [0.2534], [0.904], [0.9575]]]],[0, 0, 0, 0], 1, 1, true, Con87579), 
LZer63480 = zero_padding2D_layer(Con87579, 0, 0, 1, 0, Zer63480), 
LMul94149 = multiply_layer([Con37311,Zer63480], Mul94149), 
LRes56982 = reshape_layer(Mul94149, [1, 8], Res56982), 
LLST32946 = lstm_layer(Res56982,[[10, 7, 7, 6], [7, 2, 2, 4], [9, 1, 3, 9], [9, 7, 8, 3], [8, 8, 5, 6], [5, 6, 9, 8], [5, 4, 8, 8], [6, 9, 7, 1]],[[9, 6, 7, 4]],[8, 1, 5, 4], LST32946), 
exec_layers([LMax97553,LRes19250,LCon37311,LCon87579,LZer63480,LMul94149,LRes56982,LLST32946],["Max97553","Res19250","Con37311","Con87579","Zer63480","Mul94149","Res56982","LST32946"],LST32946,"LST32946")

Actual (Unparsed): [[0.7541925]]

Expected (Unparsed): [[0.754192519500083]]

Actual:   [[0.7542]]

Expected: [[0.7542]]