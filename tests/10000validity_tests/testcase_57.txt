import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo45756 = tf.keras.layers.Input(shape=([1, 2]))
in0Con59309 = tf.keras.layers.Input(shape=([2, 1]))
in0Mul47832 = tf.keras.layers.Input(shape=([1, 2]))
in1Mul47832 = tf.keras.layers.Input(shape=([1, 2]))
in0Mul43307 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul43307 = tf.keras.layers.Input(shape=([1, 1]))
in0Glo31477 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in0Con10506 = tf.keras.layers.Input(shape=([2]))

Glo45756 = keras.layers.GlobalMaxPool1D(name = 'Glo45756', )(in0Glo45756)
Res58169 = keras.layers.Reshape((2, 1), name = 'Res58169', )(Glo45756)
Con59309 = keras.layers.Concatenate(axis=2, name = 'Con59309', )([Res58169,in0Con59309])
Mul47832 = keras.layers.Multiply(name = 'Mul47832', )([in0Mul47832,in1Mul47832])
Zer67428 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer67428', )(Mul47832)
Add22131 = keras.layers.Add(name = 'Add22131', )([Con59309,Zer67428])
Res57054 = keras.layers.Reshape((2, 2, 1), name = 'Res57054', )(Add22131)
Glo17801 = keras.layers.GlobalMaxPool2D(name = 'Glo17801', )(Res57054)
Res44877 = keras.layers.Reshape((1, 1), name = 'Res44877', )(Glo17801)
LST25855 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST25855', )(Res44877)
Mul43307 = keras.layers.Multiply(name = 'Mul43307', )([in0Mul43307,in1Mul43307])
Fla45206 = keras.layers.Flatten(name = 'Fla45206', )(Mul43307)
Glo31477 = keras.layers.GlobalAveragePooling3D(name = 'Glo31477', )(in0Glo31477)
Mul52530 = keras.layers.Multiply(name = 'Mul52530', )([Fla45206,Glo31477])
Con10506 = keras.layers.Concatenate(axis=1, name = 'Con10506', )([Mul52530,in0Con10506])
Ave74845 = keras.layers.Average(name = 'Ave74845', )([LST25855,Con10506])
model = tf.keras.models.Model(inputs=[in0Glo45756,in0Con59309,in0Mul47832,in1Mul47832,in0Mul43307,in1Mul43307,in0Glo31477,in0Con10506], outputs=Ave74845)
w = model.get_layer('LST25855').get_weights() 
w[0] = np.array([[10, 9, 10, 10, 6, 10, 10, 6, 6, 4, 8, 2]])
w[1] = np.array([[5, 7, 8, 2, 9, 9, 8, 6, 2, 9, 3, 2], [7, 1, 8, 1, 9, 4, 7, 3, 1, 5, 9, 6], [2, 8, 10, 8, 6, 2, 9, 10, 1, 4, 10, 10]])
w[2] = np.array([5, 9, 2, 8, 3, 2, 2, 10, 9, 6, 10, 7])
model.get_layer('LST25855').set_weights(w) 
in0Glo45756 = tf.constant([[[1.6385, 1.0487]]])
in0Con59309 = tf.constant([[[0.3494], [0.002]]])
in0Mul47832 = tf.constant([[[0.5251, 0.8674]]])
in1Mul47832 = tf.constant([[[0.3631, 0.2064]]])
in0Mul43307 = tf.constant([[[0.9263]]])
in1Mul43307 = tf.constant([[[0.0939]]])
in0Glo31477 = tf.constant([[[[[1.5837]]]]])
in0Con10506 = tf.constant([[0.6253, 0.5094]])
print (np.array2string(model.predict([in0Glo45756,in0Con59309,in0Mul47832,in1Mul47832,in0Mul43307,in1Mul43307,in0Glo31477,in0Con10506],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave74845.png')

LGlo45756 = global_max_pool1D_layer([[[1.6385, 1.0487]]], Glo45756), 
LRes58169 = reshape_layer(Glo45756, [2, 1], Res58169), 
LCon59309 = concatenate_layer([Res58169,[[[0.3494], [0.002]]]], 2, Con59309), 
LMul47832 = multiply_layer([[[[0.5251, 0.8674]]], [[[0.3631, 0.2064]]]], Mul47832), 
LZer67428 = zero_padding1D_layer(Mul47832, 1, 0, Zer67428), 
LAdd22131 = add_layer([Con59309,Zer67428], Add22131), 
LRes57054 = reshape_layer(Add22131, [2, 2, 1], Res57054), 
LGlo17801 = global_max_pool2D_layer(Res57054, Glo17801), 
LRes44877 = reshape_layer(Glo17801, [1, 1], Res44877), 
LLST25855 = lstm_layer(Res44877,[[10, 9, 10, 10, 6, 10, 10, 6, 6, 4, 8, 2]],[[5, 7, 8, 2, 9, 9, 8, 6, 2, 9, 3, 2], [7, 1, 8, 1, 9, 4, 7, 3, 1, 5, 9, 6], [2, 8, 10, 8, 6, 2, 9, 10, 1, 4, 10, 10]],[5, 9, 2, 8, 3, 2, 2, 10, 9, 6, 10, 7], LST25855), 
LMul43307 = multiply_layer([[[[0.9263]]], [[[0.0939]]]], Mul43307), 
LFla45206 = flatten_layer(Mul43307, Fla45206), 
LGlo31477 = global_average_pooling3D_layer([[[[[1.5837]]]]], Glo31477), 
LMul52530 = multiply_layer([Fla45206,Glo31477], Mul52530), 
LCon10506 = concatenate_layer([Mul52530,[[0.6253, 0.5094]]], 1, Con10506), 
LAve74845 = average_layer([LST25855,Con10506], Ave74845), 
exec_layers([LGlo45756,LRes58169,LCon59309,LMul47832,LZer67428,LAdd22131,LRes57054,LGlo17801,LRes44877,LLST25855,LMul43307,LFla45206,LGlo31477,LMul52530,LCon10506,LAve74845],["Glo45756","Res58169","Con59309","Mul47832","Zer67428","Add22131","Res57054","Glo17801","Res44877","LST25855","Mul43307","Fla45206","Glo31477","Mul52530","Con10506","Ave74845"],Ave74845,"Ave74845")

Actual (Unparsed): [[0.4496705, 0.6934471, 0.6354840]]

Expected (Unparsed): [[0.44967050587917334,0.6934470779325914,0.6354839708849368]]

Actual:   [[0.4497, 0.6935, 0.6355]]

Expected: [[0.4497, 0.6935, 0.6355]]