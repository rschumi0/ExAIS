import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max55990 = tf.keras.layers.Input(shape=([2, 2]))
in1Max55990 = tf.keras.layers.Input(shape=([2, 2]))
in0Con90803 = tf.keras.layers.Input(shape=([8, 6, 2]))
in0Up_4964 = tf.keras.layers.Input(shape=([2, 1]))

Max55990 = keras.layers.Maximum(name = 'Max55990', )([in0Max55990,in1Max55990])
Res5149 = keras.layers.Reshape((2, 2, 1), name = 'Res5149', )(Max55990)
Zer43063 = keras.layers.ZeroPadding2D(padding=((6, 0), (4, 0)), name = 'Zer43063', )(Res5149)
Con90803 = keras.layers.Concatenate(axis=3, name = 'Con90803', )([Zer43063,in0Con90803])
Up_4964 = keras.layers.UpSampling1D(size=(1), name = 'Up_4964', )(in0Up_4964)
Res54342 = keras.layers.Reshape((2, 1, 1), name = 'Res54342', )(Up_4964)
Res17574 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res17574', )(Res54342)
Zer88755 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer88755', )(Res17574)
Res22073 = keras.layers.Reshape((4, 3, 3), name = 'Res22073', )(Zer88755)
Up_9941 = keras.layers.UpSampling2D(size=(2, 2), name = 'Up_9941', )(Res22073)
Ave76183 = keras.layers.Average(name = 'Ave76183', )([Con90803,Up_9941])
model = tf.keras.models.Model(inputs=[in0Max55990,in1Max55990,in0Con90803,in0Up_4964], outputs=Ave76183)
in0Max55990 = tf.constant([[[0.3556, 0.5091], [0.1637, 0.2725]]])
in1Max55990 = tf.constant([[[0.8476, 0.5161], [0.3864, 0.1188]]])
in0Con90803 = tf.constant([[[[0.6238, 0.5445], [0.6261, 0.7232], [0.6726, 0.7465], [0.4945, 0.4637], [0.2501, 0.0436], [0.1665, 0.5271]], [[0.4429, 0.148], [0.5505, 0.3646], [0.4313, 0.7852], [0.2641, 0.6215], [0.5597, 0.2534], [0.1864, 0.1137]], [[0.2946, 0.5947], [0.9855, 0.6181], [0.3886, 0.0071], [0.7125, 0.8237], [0.9055, 0.4131], [0.0996, 0.4055]], [[0.7633, 0.2921], [0.8985, 0.2002], [0.1012, 0.9836], [0.4515, 0.8941], [0.0886, 0.6728], [0.7017, 0.463]], [[0.7591, 0.1798], [0.0175, 0.8447], [0.0751, 0.4937], [0.5294, 0.9704], [0.7058, 0.7143], [0.1623, 0.3323]], [[0.9377, 0.6949], [0.1816, 0.7227], [0.7253, 0.2158], [0.8655, 0.6458], [0.1397, 0.96], [0.8675, 0.1707]], [[0.3722, 0.9126], [0.9385, 0.6746], [0.0146, 0.0578], [0.9403, 0.0052], [0.5478, 0.4116], [0.5018, 0.0822]], [[0.8481, 0.4928], [0.2454, 0.8528], [0.0453, 0.3105], [0.2399, 0.8181], [0.2513, 0.826], [0.2262, 0.0542]]]])
in0Up_4964 = tf.constant([[[1.269], [1.626]]])
print (np.array2string(model.predict([in0Max55990,in1Max55990,in0Con90803,in0Up_4964],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave76183.png')

LMax55990 = maximum_layer([[[[0.3556, 0.5091], [0.1637, 0.2725]]], [[[0.8476, 0.5161], [0.3864, 0.1188]]]], Max55990), 
LRes5149 = reshape_layer(Max55990, [2, 2, 1], Res5149), 
LZer43063 = zero_padding2D_layer(Res5149, 6, 0, 4, 0, Zer43063), 
LCon90803 = concatenate_layer([Zer43063,[[[[0.6238, 0.5445], [0.6261, 0.7232], [0.6726, 0.7465], [0.4945, 0.4637], [0.2501, 0.0436], [0.1665, 0.5271]], [[0.4429, 0.148], [0.5505, 0.3646], [0.4313, 0.7852], [0.2641, 0.6215], [0.5597, 0.2534], [0.1864, 0.1137]], [[0.2946, 0.5947], [0.9855, 0.6181], [0.3886, 0.0071], [0.7125, 0.8237], [0.9055, 0.4131], [0.0996, 0.4055]], [[0.7633, 0.2921], [0.8985, 0.2002], [0.1012, 0.9836], [0.4515, 0.8941], [0.0886, 0.6728], [0.7017, 0.463]], [[0.7591, 0.1798], [0.0175, 0.8447], [0.0751, 0.4937], [0.5294, 0.9704], [0.7058, 0.7143], [0.1623, 0.3323]], [[0.9377, 0.6949], [0.1816, 0.7227], [0.7253, 0.2158], [0.8655, 0.6458], [0.1397, 0.96], [0.8675, 0.1707]], [[0.3722, 0.9126], [0.9385, 0.6746], [0.0146, 0.0578], [0.9403, 0.0052], [0.5478, 0.4116], [0.5018, 0.0822]], [[0.8481, 0.4928], [0.2454, 0.8528], [0.0453, 0.3105], [0.2399, 0.8181], [0.2513, 0.826], [0.2262, 0.0542]]]]], 3, Con90803), 
LUp_4964 = up_sampling1D_layer([[[1.269], [1.626]]], 1, Up_4964), 
LRes54342 = reshape_layer(Up_4964, [2, 1, 1], Res54342), 
LRes17574 = reshape_layer(Res54342, [2, 1, 1, 1], Res17574), 
LZer88755 = zero_padding3D_layer(Res17574, 1, 1, 1, 1, 1, 1, Zer88755), 
LRes22073 = reshape_layer(Zer88755, [4, 3, 3], Res22073), 
LUp_9941 = up_sampling2D_layer(Res22073, 2, 2, Up_9941), 
LAve76183 = average_layer([Con90803,Up_9941], Ave76183), 
exec_layers([LMax55990,LRes5149,LZer43063,LCon90803,LUp_4964,LRes54342,LRes17574,LZer88755,LRes22073,LUp_9941,LAve76183],["Max55990","Res5149","Zer43063","Con90803","Up_4964","Res54342","Res17574","Zer88755","Res22073","Up_9941","Ave76183"],Ave76183,"Ave76183")

Actual (Unparsed): [[[[0.0000000, 0.3119000, 0.2722500], [0.0000000, 0.3130500, 0.3616000], [0.0000000, 0.3363000, 0.3732500], [0.0000000, 0.2472500, 0.2318500], [0.0000000, 0.1250500, 0.0218000], [0.0000000, 0.0832500, 0.2635500]], [[0.0000000, 0.2214500, 0.0740000], [0.0000000, 0.2752500, 0.1823000], [0.0000000, 0.2156500, 0.3926000], [0.0000000, 0.1320500, 0.3107500], [0.0000000, 0.2798500, 0.1267000], [0.0000000, 0.0932000, 0.0568500]], [[0.0000000, 0.1473000, 0.2973500], [0.0000000, 0.4927500, 0.3090500], [0.0000000, 0.8288000, 0.0035500], [0.0000000, 0.9907500, 0.4118500], [0.0000000, 0.4527500, 0.2065500], [0.0000000, 0.0498000, 0.2027500]], [[0.0000000, 0.3816500, 0.1460500], [0.0000000, 0.4492500, 0.1001000], [0.0000000, 0.6851000, 0.4918000], [0.0000000, 0.8602500, 0.4470500], [0.0000000, 0.0443000, 0.3364000], [0.0000000, 0.3508500, 0.2315000]], [[0.0000000, 0.3795500, 0.0899000], [0.0000000, 0.0087500, 0.4223500], [0.0000000, 0.8505500, 0.2468500], [0.0000000, 1.0777000, 0.4852000], [0.0000000, 0.3529000, 0.3571500], [0.0000000, 0.0811500, 0.1661500]], [[0.0000000, 0.4688500, 0.3474500], [0.0000000, 0.0908000, 0.3613500], [0.0000000, 1.1756500, 0.1079000], [0.0000000, 1.2457500, 0.3229000], [0.0000000, 0.0698500, 0.4800000], [0.0000000, 0.4337500, 0.0853500]], [[0.0000000, 0.1861000, 0.4563000], [0.0000000, 0.4692500, 0.3373000], [0.0000000, 0.0073000, 0.0289000], [0.0000000, 0.4701500, 0.0026000], [0.4238000, 0.2739000, 0.2058000], [0.2580500, 0.2509000, 0.0411000]], [[0.0000000, 0.4240500, 0.2464000], [0.0000000, 0.1227000, 0.4264000], [0.0000000, 0.0226500, 0.1552500], [0.0000000, 0.1199500, 0.4090500], [0.1932000, 0.1256500, 0.4130000], [0.1362500, 0.1131000, 0.0271000]]]]

Expected (Unparsed): [[[[0,0.3119,0.27225],[0,0.31305,0.3616],[0,0.3363,0.37325],[0,0.24725,0.23185],[0,0.12505,0.0218],[0,0.08325,0.26355]],[[0,0.22145,0.074],[0,0.27525,0.1823],[0,0.21565,0.3926],[0,0.13205,0.31075],[0,0.27985,0.1267],[0,0.0932,0.05685]],[[0,0.1473,0.29735],[0,0.49275,0.30905],[0,0.8288,0.00355],[0,0.99075,0.41185],[0,0.45275,0.20655],[0,0.0498,0.20275]],[[0,0.38165,0.14605],[0,0.44925,0.1001],[0,0.6850999999999999,0.4918],[0,0.86025,0.44705],[0,0.0443,0.3364],[0,0.35085,0.2315]],[[0,0.37955,0.0899],[0,0.00875,0.42235],[0,0.8505499999999999,0.24685],[0,1.0776999999999999,0.4852],[0,0.3529,0.35715],[0,0.08115,0.16615]],[[0,0.46885,0.34745],[0,0.0908,0.36135],[0,1.1756499999999999,0.1079],[0,1.24575,0.3229],[0,0.06985,0.48],[0,0.43375,0.08535]],[[0,0.1861,0.4563],[0,0.46925,0.3373],[0,0.0073,0.0289],[0,0.47015,0.0026],[0.4238,0.2739,0.2058],[0.25805,0.2509,0.0411]],[[0,0.42405,0.2464],[0,0.1227,0.4264],[0,0.02265,0.15525],[0,0.11995,0.40905],[0.1932,0.12565,0.413],[0.13625,0.1131,0.0271]]]]

Actual:   [[[[0, 0.3119, 0.2723], [0, 0.3131, 0.3616], [0, 0.3363, 0.3733], [0, 0.2473, 0.2319], [0, 0.1251, 0.0218], [0, 0.0833, 0.2636]], [[0, 0.2215, 0.074], [0, 0.2753, 0.1823], [0, 0.2157, 0.3926], [0, 0.1321, 0.3108], [0, 0.2799, 0.1267], [0, 0.0932, 0.0569]], [[0, 0.1473, 0.2974], [0, 0.4928, 0.3091], [0, 0.8288, 0.0036], [0, 0.9908, 0.4119], [0, 0.4528, 0.2066], [0, 0.0498, 0.2028]], [[0, 0.3817, 0.1461], [0, 0.4493, 0.1001], [0, 0.6851, 0.4918], [0, 0.8603, 0.4471], [0, 0.0443, 0.3364], [0, 0.3509, 0.2315]], [[0, 0.3796, 0.0899], [0, 0.0088, 0.4224], [0, 0.8506, 0.2469], [0, 1.0777, 0.4852], [0, 0.3529, 0.3572], [0, 0.0812, 0.1662]], [[0, 0.4689, 0.3475], [0, 0.0908, 0.3614], [0, 1.1757, 0.1079], [0, 1.2458, 0.3229], [0, 0.0699, 0.48], [0, 0.4338, 0.0854]], [[0, 0.1861, 0.4563], [0, 0.4693, 0.3373], [0, 0.0073, 0.0289], [0, 0.4702, 0.0026], [0.4238, 0.2739, 0.2058], [0.2581, 0.2509, 0.0411]], [[0, 0.4241, 0.2464], [0, 0.1227, 0.4264], [0, 0.0227, 0.1553], [0, 0.12, 0.4091], [0.1932, 0.1257, 0.413], [0.1363, 0.1131, 0.0271]]]]

Expected: [[[[0, 0.3119, 0.2723], [0, 0.3131, 0.3616], [0, 0.3363, 0.3733], [0, 0.2473, 0.2319], [0, 0.1251, 0.0218], [0, 0.0833, 0.2636]], [[0, 0.2215, 0.074], [0, 0.2753, 0.1823], [0, 0.2157, 0.3926], [0, 0.1321, 0.3108], [0, 0.2799, 0.1267], [0, 0.0932, 0.0569]], [[0, 0.1473, 0.2974], [0, 0.4928, 0.3091], [0, 0.8288, 0.0036], [0, 0.9908, 0.4119], [0, 0.4528, 0.2066], [0, 0.0498, 0.2028]], [[0, 0.3817, 0.1461], [0, 0.4493, 0.1001], [0, 0.6851, 0.4918], [0, 0.8603, 0.4471], [0, 0.0443, 0.3364], [0, 0.3509, 0.2315]], [[0, 0.3796, 0.0899], [0, 0.0088, 0.4224], [0, 0.8506, 0.2469], [0, 1.0777, 0.4852], [0, 0.3529, 0.3572], [0, 0.0812, 0.1662]], [[0, 0.4689, 0.3475], [0, 0.0908, 0.3614], [0, 1.1757, 0.1079], [0, 1.2458, 0.3229], [0, 0.0699, 0.48], [0, 0.4338, 0.0854]], [[0, 0.1861, 0.4563], [0, 0.4693, 0.3373], [0, 0.0073, 0.0289], [0, 0.4702, 0.0026], [0.4238, 0.2739, 0.2058], [0.2581, 0.2509, 0.0411]], [[0, 0.4241, 0.2464], [0, 0.1227, 0.4264], [0, 0.0227, 0.1553], [0, 0.12, 0.4091], [0.1932, 0.1257, 0.413], [0.1363, 0.1131, 0.0271]]]]