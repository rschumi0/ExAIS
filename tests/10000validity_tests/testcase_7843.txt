import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave30478 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave30478 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Dot15927 = tf.keras.layers.Input(shape=([3]))
in1Dot15927 = tf.keras.layers.Input(shape=([3]))
in0Con89122 = tf.keras.layers.Input(shape=([3]))

Ave30478 = keras.layers.Average(name = 'Ave30478', )([in0Ave30478,in1Ave30478])
Res53016 = keras.layers.Reshape((2, 2), name = 'Res53016', )(Ave30478)
Ave25502 = keras.layers.AveragePooling1D(pool_size=(2), strides=(1), padding='valid', name = 'Ave25502', )(Res53016)
Res96748 = keras.layers.Reshape((1, 2, 1), name = 'Res96748', )(Ave25502)
Up_34335 = keras.layers.UpSampling2D(size=(2, 1), name = 'Up_34335', )(Res96748)
Res66908 = keras.layers.Reshape((2, 2), name = 'Res66908', )(Up_34335)
Fla41292 = keras.layers.Flatten(name = 'Fla41292', )(Res66908)
Dot15927 = keras.layers.Dot(axes=(1, 1), name = 'Dot15927', )([in0Dot15927,in1Dot15927])
Con89122 = keras.layers.Concatenate(axis=1, name = 'Con89122', )([Dot15927,in0Con89122])
Ave89196 = keras.layers.Average(name = 'Ave89196', )([Fla41292,Con89122])
model = tf.keras.models.Model(inputs=[in0Ave30478,in1Ave30478,in0Dot15927,in1Dot15927,in0Con89122], outputs=Ave89196)
in0Ave30478 = tf.constant([[[[0.997], [0.6201]], [[0.4318], [0.8072]]]])
in1Ave30478 = tf.constant([[[[0.4677], [0.037]], [[0.3007], [0.998]]]])
in0Dot15927 = tf.constant([[0.3542, 0.8073, 0.669]])
in1Dot15927 = tf.constant([[0.8401, 0.9024, 0.9931]])
in0Con89122 = tf.constant([[0.4388, 0.0382, 0.6882]])
print (np.array2string(model.predict([in0Ave30478,in1Ave30478,in0Dot15927,in1Dot15927,in0Con89122],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave89196.png')

LAve30478 = average_layer([[[[[0.997], [0.6201]], [[0.4318], [0.8072]]]], [[[[0.4677], [0.037]], [[0.3007], [0.998]]]]], Ave30478), 
LRes53016 = reshape_layer(Ave30478, [2, 2], Res53016), 
LAve25502 = average_pooling1D_layer(Res53016, 2, 1, false, Ave25502), 
LRes96748 = reshape_layer(Ave25502, [1, 2, 1], Res96748), 
LUp_34335 = up_sampling2D_layer(Res96748, 2, 1, Up_34335), 
LRes66908 = reshape_layer(Up_34335, [2, 2], Res66908), 
LFla41292 = flatten_layer(Res66908, Fla41292), 
LDot15927 = dot_layer([[0.3542, 0.8073, 0.669]], [[0.8401, 0.9024, 0.9931]], 1, 1, Dot15927), 
LCon89122 = concatenate_layer([Dot15927,[[0.4388, 0.0382, 0.6882]]], 1, Con89122), 
LAve89196 = average_layer([Fla41292,Con89122], Ave89196), 
exec_layers([LAve30478,LRes53016,LAve25502,LRes96748,LUp_34335,LRes66908,LFla41292,LDot15927,LCon89122,LAve89196],["Ave30478","Res53016","Ave25502","Res96748","Up_34335","Res66908","Fla41292","Dot15927","Con89122","Ave89196"],Ave89196,"Ave89196")

Actual (Unparsed): [[1.1198774, 0.5271875, 0.2937500, 0.6518875]]

Expected (Unparsed): [[1.11987742,0.5271875,0.29375,0.6518875]]

Actual:   [[1.1199, 0.5272, 0.2938, 0.6519]]

Expected: [[1.1199, 0.5272, 0.2938, 0.6519]]