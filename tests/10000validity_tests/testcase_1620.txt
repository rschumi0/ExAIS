import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub83851 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub83851 = tf.keras.layers.Input(shape=([2, 2]))
in0Ave21353 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave21353 = tf.keras.layers.Input(shape=([2, 1]))
in0Con54574 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Ave94507 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Ave94507 = tf.keras.layers.Input(shape=([1, 2, 2]))

Sub83851 = keras.layers.Subtract(name = 'Sub83851', )([in0Sub83851,in1Sub83851])
Res40227 = keras.layers.Reshape((2, 2, 1), name = 'Res40227', )(Sub83851)
Res98448 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res98448', )(Res40227)
Zer22764 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (1, 0)), name = 'Zer22764', )(Res98448)
Ave21353 = keras.layers.Average(name = 'Ave21353', )([in0Ave21353,in1Ave21353])
Res28795 = keras.layers.Reshape((2, 1, 1), name = 'Res28795', )(Ave21353)
Res52721 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res52721', )(Res28795)
Up_44095 = keras.layers.UpSampling3D(size=(1, 2, 2), name = 'Up_44095', )(Res52721)
Sub84403 = keras.layers.Subtract(name = 'Sub84403', )([Zer22764,Up_44095])
Res65177 = keras.layers.Reshape((2, 2, 2), name = 'Res65177', )(Sub84403)
Con54574 = keras.layers.Concatenate(axis=3, name = 'Con54574', )([Res65177,in0Con54574])
Ave94507 = keras.layers.Average(name = 'Ave94507', )([in0Ave94507,in1Ave94507])
Con49628 = keras.layers.Conv2D(3, (1, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con49628', )(Ave94507)
Zer8227 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer8227', )(Con49628)
Sub94786 = keras.layers.Subtract(name = 'Sub94786', )([Con54574,Zer8227])
Res79680 = keras.layers.Reshape((2, 6), name = 'Res79680', )(Sub94786)
Cro66635 = keras.layers.Cropping1D(cropping=((0, 1)), name = 'Cro66635', )(Res79680)
model = tf.keras.models.Model(inputs=[in0Sub83851,in1Sub83851,in0Ave21353,in1Ave21353,in0Con54574,in0Ave94507,in1Ave94507], outputs=Cro66635)
w = model.get_layer('Con49628').get_weights() 
w[0] = np.array([[[[0.833, 0.2794, 0.3591], [0.6915, 0.7201, 0.2756]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con49628').set_weights(w) 
in0Sub83851 = tf.constant([[[0.218, 0.3317], [0.582, 0.3961]]])
in1Sub83851 = tf.constant([[[0.9698, 0.3436], [0.7268, 0.9152]]])
in0Ave21353 = tf.constant([[[0.4666], [0.2256]]])
in1Ave21353 = tf.constant([[[0.3147], [0.7885]]])
in0Con54574 = tf.constant([[[[0.1547], [0.1333]], [[0.4352], [0.5693]]]])
in0Ave94507 = tf.constant([[[[0.3894, 0.5691], [0.3508, 0.2445]]]])
in1Ave94507 = tf.constant([[[[0.1507, 0.024], [0.0374, 0.5499]]]])
print (np.array2string(model.predict([in0Sub83851,in1Sub83851,in0Ave21353,in1Ave21353,in0Con54574,in0Ave94507,in1Ave94507],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Cro66635.png')

LSub83851 = subtract_layer([[[0.218, 0.3317], [0.582, 0.3961]]], [[[0.9698, 0.3436], [0.7268, 0.9152]]], Sub83851), 
LRes40227 = reshape_layer(Sub83851, [2, 2, 1], Res40227), 
LRes98448 = reshape_layer(Res40227, [2, 2, 1, 1], Res98448), 
LZer22764 = zero_padding3D_layer(Res98448, 0, 0, 0, 0, 1, 0, Zer22764), 
LAve21353 = average_layer([[[[0.4666], [0.2256]]], [[[0.3147], [0.7885]]]], Ave21353), 
LRes28795 = reshape_layer(Ave21353, [2, 1, 1], Res28795), 
LRes52721 = reshape_layer(Res28795, [2, 1, 1, 1], Res52721), 
LUp_44095 = up_sampling3D_layer(Res52721, 1, 2, 2, Up_44095), 
LSub84403 = subtract_layer(Zer22764,Up_44095, Sub84403), 
LRes65177 = reshape_layer(Sub84403, [2, 2, 2], Res65177), 
LCon54574 = concatenate_layer([Res65177,[[[[0.1547], [0.1333]], [[0.4352], [0.5693]]]]], 3, Con54574), 
LAve94507 = average_layer([[[[[0.3894, 0.5691], [0.3508, 0.2445]]]], [[[[0.1507, 0.024], [0.0374, 0.5499]]]]], Ave94507), 
LCon49628 = conv2D_layer(Ave94507, 1, 1,[[[[0.833, 0.2794, 0.3591], [0.6915, 0.7201, 0.2756]]]],[0, 0, 0], 1, 1, true, 1, 1, Con49628), 
LZer8227 = zero_padding2D_layer(Con49628, 1, 0, 0, 0, Zer8227), 
LSub94786 = subtract_layer(Con54574,Zer8227, Sub94786), 
LRes79680 = reshape_layer(Sub94786, [2, 6], Res79680), 
LCro66635 = cropping1D_layer(Res79680, 0, 1, Cro66635), 
exec_layers([LSub83851,LRes40227,LRes98448,LZer22764,LAve21353,LRes28795,LRes52721,LUp_44095,LSub84403,LRes65177,LCon54574,LAve94507,LCon49628,LZer8227,LSub94786,LRes79680,LCro66635],["Sub83851","Res40227","Res98448","Zer22764","Ave21353","Res28795","Res52721","Up_44095","Sub84403","Res65177","Con54574","Ave94507","Con49628","Zer8227","Sub94786","Res79680","Cro66635"],Cro66635,"Cro66635")

Actual (Unparsed): [[[-0.3906500, -1.1424500, 0.1547000, -0.3906500, -0.4025500, 0.1333000]]]

Expected (Unparsed): [[[-0.39065,-1.14245,0.1547,-0.39065,-0.40255,0.1333]]]

Actual:   [[[-0.3906, -1.1424, 0.1547, -0.3906, -0.4025, 0.1333]]]

Expected: [[[-0.3906, -1.1424, 0.1547, -0.3906, -0.4025, 0.1333]]]