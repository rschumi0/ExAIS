import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0GRU45011 = tf.keras.layers.Input(shape=([3, 2]))

GRU45011 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU45011', )(in0GRU45011)
Res88028 = keras.layers.Reshape((3, 1), name = 'Res88028', )(GRU45011)
PRe20121 = keras.layers.PReLU(name = 'PRe20121', )(Res88028)
Res28912 = keras.layers.Reshape((3, 1, 1), name = 'Res28912', )(PRe20121)
Loc20657 = keras.layers.LocallyConnected2D(3, (1, 1),strides=(1, 1), name = 'Loc20657', )(Res28912)
model = tf.keras.models.Model(inputs=[in0GRU45011], outputs=Loc20657)
w = model.get_layer('GRU45011').get_weights() 
w[0] = np.array([[5, 2, 4, 9, 6, 7, 4, 3, 6], [1, 9, 7, 2, 1, 6, 10, 9, 4]])
w[1] = np.array([[9, 10, 1, 6, 1, 8, 9, 6, 6], [9, 5, 3, 6, 2, 7, 9, 1, 5], [5, 4, 2, 9, 3, 2, 3, 4, 4]])
w[2] = np.array([4, 8, 5, 1, 3, 6, 6, 7, 6])
model.get_layer('GRU45011').set_weights(w) 
w = model.get_layer('PRe20121').get_weights() 
w[0] = np.array([[0.5166], [0.229], [0.8448]])
model.get_layer('PRe20121').set_weights(w) 
w = model.get_layer('Loc20657').get_weights() 
w[0] = np.array([[[0.199, 0.9993, 0.5495]], [[0.5412, 0.5884, 0.0234]], [[0.3978, 0.0965, 0.8457]]])
w[1] = np.array([[[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]]])
model.get_layer('Loc20657').set_weights(w) 
in0GRU45011 = tf.constant([[[4, 2], [7, 8], [8, 3]]])
print (np.array2string(model.predict([in0GRU45011],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc20657.png')

LGRU45011 = gru_layer([[[4, 2], [7, 8], [8, 3]]],[[5, 2, 4, 9, 6, 7, 4, 3, 6], [1, 9, 7, 2, 1, 6, 10, 9, 4]],[[9, 10, 1, 6, 1, 8, 9, 6, 6], [9, 5, 3, 6, 2, 7, 9, 1, 5], [5, 4, 2, 9, 3, 2, 3, 4, 4]],[4, 8, 5, 1, 3, 6, 6, 7, 6], false, GRU45011), 
LRes88028 = reshape_layer(GRU45011, [3, 1], Res88028), 
LPRe20121 = prelu_layer(Res88028, [[0.5166], [0.229], [0.8448]], PRe20121), 
LRes28912 = reshape_layer(PRe20121, [3, 1, 1], Res28912), 
LLoc20657 = locally_connected2D_layer(Res28912, 1, 1,[[[0.199, 0.9993, 0.5495]], [[0.5412, 0.5884, 0.0234]], [[0.3978, 0.0965, 0.8457]]],[[[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]]], 1, 1, Loc20657), 
exec_layers([LGRU45011,LRes88028,LPRe20121,LRes28912,LLoc20657],["GRU45011","Res88028","PRe20121","Res28912","Loc20657"],Loc20657,"Loc20657")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000]]]]

Expected (Unparsed): [[[[1.016695838629289e-12,5.1054479976997415e-12,2.807408860938665e-12]],[[9.613643214834156e-16,1.0452083643031074e-15,4.156675004196586e-17]],[[2.6498803151753237e-16,6.428191312579656e-17,5.63349367155297e-16]]]]

Actual:   [[[[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]]]]

Expected: [[[[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]]]]