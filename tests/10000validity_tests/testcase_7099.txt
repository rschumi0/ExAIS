import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave53837 = tf.keras.layers.Input(shape=([1, 1]))
in1Ave53837 = tf.keras.layers.Input(shape=([1, 1]))
in0Con84551 = tf.keras.layers.Input(shape=([1, 1]))

Ave53837 = keras.layers.Average(name = 'Ave53837', )([in0Ave53837,in1Ave53837])
Con84551 = keras.layers.Conv1D(2, (1),strides=(4), padding='valid', dilation_rate=(1), name = 'Con84551', )(in0Con84551)
Res5768 = keras.layers.Reshape((1, 2, 1), name = 'Res5768', )(Con84551)
Res20892 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res20892', )(Res5768)
Con19990 = keras.layers.Conv3D(3, (1, 1, 1),strides=(1, 2, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con19990', )(Res20892)
Res74267 = keras.layers.Reshape((1, 1, 3), name = 'Res74267', )(Con19990)
Res72020 = keras.layers.Reshape((1, 3), name = 'Res72020', )(Res74267)
Dot32756 = keras.layers.Dot(axes=(1, 1), name = 'Dot32756', )([Ave53837,Res72020])
Res13718 = keras.layers.Reshape((1, 3, 1), name = 'Res13718', )(Dot32756)
Res45604 = keras.layers.Reshape((1, 3, 1, 1), name = 'Res45604', )(Res13718)
Glo51012 = keras.layers.GlobalMaxPool3D(name = 'Glo51012', )(Res45604)
model = tf.keras.models.Model(inputs=[in0Ave53837,in1Ave53837,in0Con84551], outputs=Glo51012)
w = model.get_layer('Con84551').get_weights() 
w[0] = np.array([[[0.4428, 0.1502]]])
w[1] = np.array([0, 0])
model.get_layer('Con84551').set_weights(w) 
w = model.get_layer('Con19990').get_weights() 
w[0] = np.array([[[[[0.0815, 0.6177, 0.7385]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con19990').set_weights(w) 
in0Ave53837 = tf.constant([[[0.7083]]])
in1Ave53837 = tf.constant([[[0.6692]]])
in0Con84551 = tf.constant([[[0.8751]]])
print (np.array2string(model.predict([in0Ave53837,in1Ave53837,in0Con84551],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo51012.png')

LAve53837 = average_layer([[[[0.7083]]], [[[0.6692]]]], Ave53837), 
LCon84551 = conv1D_layer([[[0.8751]]], 1,[[[0.4428, 0.1502]]],[0, 0], 4, false, 1, Con84551), 
LRes5768 = reshape_layer(Con84551, [1, 2, 1], Res5768), 
LRes20892 = reshape_layer(Res5768, [1, 2, 1, 1], Res20892), 
LCon19990 = conv3D_layer(Res20892, 1, 1, 1,[[[[[0.0815, 0.6177, 0.7385]]]]],[0, 0, 0], 1, 2, 1, true, 1, 1, 1, Con19990), 
LRes74267 = reshape_layer(Con19990, [1, 1, 3], Res74267), 
LRes72020 = reshape_layer(Res74267, [1, 3], Res72020), 
LDot32756 = dot_layer(Ave53837,Res72020, 1, 1, Dot32756), 
LRes13718 = reshape_layer(Dot32756, [1, 3, 1], Res13718), 
LRes45604 = reshape_layer(Res13718, [1, 3, 1, 1], Res45604), 
LGlo51012 = global_max_pool3D_layer(Res45604, Glo51012), 
exec_layers([LAve53837,LCon84551,LRes5768,LRes20892,LCon19990,LRes74267,LRes72020,LDot32756,LRes13718,LRes45604,LGlo51012],["Ave53837","Con84551","Res5768","Res20892","Con19990","Res74267","Res72020","Dot32756","Res13718","Res45604","Glo51012"],Glo51012,"Glo51012")

Actual (Unparsed): [[0.1970958]]

Expected (Unparsed): [[0.197095817130975]]

Actual:   [[0.1971]]

Expected: [[0.1971]]