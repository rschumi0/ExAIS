import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave39373 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Ave39373 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Lea53433 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con2377 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Add67884 = tf.keras.layers.Input(shape=([2, 1]))
in1Add67884 = tf.keras.layers.Input(shape=([2, 1]))
in0Con34227 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Mul94878 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Mul94878 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

Ave39373 = keras.layers.Average(name = 'Ave39373', )([in0Ave39373,in1Ave39373])
Res30425 = keras.layers.Reshape((2, 2, 2), name = 'Res30425', )(Ave39373)
Lea53433 = keras.layers.LeakyReLU(alpha=8.151660383169887, name = 'Lea53433', input_shape=(2, 1, 2))(in0Lea53433)
Zer87851 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer87851', )(Lea53433)
Max43640 = keras.layers.Maximum(name = 'Max43640', )([Res30425,Zer87851])
Res22631 = keras.layers.Reshape((2, 2, 2, 1), name = 'Res22631', )(Max43640)
Con2377 = keras.layers.Concatenate(axis=4, name = 'Con2377', )([Res22631,in0Con2377])
Add67884 = keras.layers.Add(name = 'Add67884', )([in0Add67884,in1Add67884])
Res81779 = keras.layers.Reshape((2, 1, 1), name = 'Res81779', )(Add67884)
Res13088 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res13088', )(Res81779)
Zer94256 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (0, 0)), name = 'Zer94256', )(Res13088)
Con34227 = keras.layers.Concatenate(axis=4, name = 'Con34227', )([Zer94256,in0Con34227])
Mul94878 = keras.layers.Multiply(name = 'Mul94878', )([in0Mul94878,in1Mul94878])
Mul6734 = keras.layers.Multiply(name = 'Mul6734', )([Con34227,Mul94878])
Zer35254 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (1, 0)), name = 'Zer35254', )(Mul6734)
Mul50180 = keras.layers.Multiply(name = 'Mul50180', )([Con2377,Zer35254])
PRe23653 = keras.layers.PReLU(name = 'PRe23653', )(Mul50180)
model = tf.keras.models.Model(inputs=[in0Ave39373,in1Ave39373,in0Lea53433,in0Con2377,in0Add67884,in1Add67884,in0Con34227,in0Mul94878,in1Mul94878], outputs=PRe23653)
w = model.get_layer('PRe23653').get_weights() 
w[0] = np.array([[[[0.9158, 0.7087], [0.9604, 0.118]], [[0.3971, 0.06], [0.2176, 0.531]]], [[[0.1791, 0.0556], [0.7638, 0.5685]], [[0.956, 0.3002], [0.5575, 0.6017]]]])
model.get_layer('PRe23653').set_weights(w) 
in0Ave39373 = tf.constant([[[[[0.9137], [0.9283]], [[0.0337], [0.0198]]], [[[0.2731], [0.7783]], [[0.3237], [0.8127]]]]])
in1Ave39373 = tf.constant([[[[[0.1114], [0.2387]], [[0.2203], [0.3951]]], [[[0.8477], [0.5486]], [[0.2587], [0.9787]]]]])
in0Lea53433 = tf.constant([[[[0.0598, 0.7879]], [[0.1232, 0.3983]]]])
in0Con2377 = tf.constant([[[[[0.0663], [0.5529]], [[0.3005], [0.2969]]], [[[0.1101], [0.7508]], [[0.4721], [0.5694]]]]])
in0Add67884 = tf.constant([[[0.9947], [0.8549]]])
in1Add67884 = tf.constant([[[0.5872], [0.394]]])
in0Con34227 = tf.constant([[[[[0.4322]], [[0.0436]]], [[[0.4226]], [[0.3438]]]]])
in0Mul94878 = tf.constant([[[[[0.7733, 0.9198]], [[0.6416, 0.9704]]], [[[0.0838, 0.9035]], [[0.5664, 0.5799]]]]])
in1Mul94878 = tf.constant([[[[[0.3387, 0.9973]], [[0.5251, 0.6137]]], [[[0.984, 0.4951]], [[0.1098, 0.6989]]]]])
print (np.array2string(model.predict([in0Ave39373,in1Ave39373,in0Lea53433,in0Con2377,in0Add67884,in1Add67884,in0Con34227,in0Mul94878,in1Mul94878],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='PRe23653.png')

LAve39373 = average_layer([[[[[[0.9137], [0.9283]], [[0.0337], [0.0198]]], [[[0.2731], [0.7783]], [[0.3237], [0.8127]]]]], [[[[[0.1114], [0.2387]], [[0.2203], [0.3951]]], [[[0.8477], [0.5486]], [[0.2587], [0.9787]]]]]], Ave39373), 
LRes30425 = reshape_layer(Ave39373, [2, 2, 2], Res30425), 
LLea53433 = leaky_relu_layer([[[[0.0598, 0.7879]], [[0.1232, 0.3983]]]], 8.151660383169887, Lea53433), 
LZer87851 = zero_padding2D_layer(Lea53433, 0, 0, 1, 0, Zer87851), 
LMax43640 = maximum_layer([Res30425,Zer87851], Max43640), 
LRes22631 = reshape_layer(Max43640, [2, 2, 2, 1], Res22631), 
LCon2377 = concatenate_layer([Res22631,[[[[[0.0663], [0.5529]], [[0.3005], [0.2969]]], [[[0.1101], [0.7508]], [[0.4721], [0.5694]]]]]], 4, Con2377), 
LAdd67884 = add_layer([[[[0.9947], [0.8549]]], [[[0.5872], [0.394]]]], Add67884), 
LRes81779 = reshape_layer(Add67884, [2, 1, 1], Res81779), 
LRes13088 = reshape_layer(Res81779, [2, 1, 1, 1], Res13088), 
LZer94256 = zero_padding3D_layer(Res13088, 0, 0, 1, 0, 0, 0, Zer94256), 
LCon34227 = concatenate_layer([Zer94256,[[[[[0.4322]], [[0.0436]]], [[[0.4226]], [[0.3438]]]]]], 4, Con34227), 
LMul94878 = multiply_layer([[[[[[0.7733, 0.9198]], [[0.6416, 0.9704]]], [[[0.0838, 0.9035]], [[0.5664, 0.5799]]]]], [[[[[0.3387, 0.9973]], [[0.5251, 0.6137]]], [[[0.984, 0.4951]], [[0.1098, 0.6989]]]]]], Mul94878), 
LMul6734 = multiply_layer([Con34227,Mul94878], Mul6734), 
LZer35254 = zero_padding3D_layer(Mul6734, 0, 0, 0, 0, 1, 0, Zer35254), 
LMul50180 = multiply_layer([Con2377,Zer35254], Mul50180), 
LPRe23653 = prelu_layer(Mul50180, [[[[0.9158, 0.7087], [0.9604, 0.118]], [[0.3971, 0.06], [0.2176, 0.531]]], [[[0.1791, 0.0556], [0.7638, 0.5685]], [[0.956, 0.3002], [0.5575, 0.6017]]]], PRe23653), 
exec_layers([LAve39373,LRes30425,LLea53433,LZer87851,LMax43640,LRes22631,LCon2377,LAdd67884,LRes81779,LRes13088,LZer94256,LCon34227,LMul94878,LMul6734,LZer35254,LMul50180,LPRe23653],["Ave39373","Res30425","Lea53433","Zer87851","Max43640","Res22631","Con2377","Add67884","Res81779","Res13088","Zer94256","Con34227","Mul94878","Mul6734","Zer35254","Mul50180","PRe23653"],PRe23653,"PRe23653")

Actual (Unparsed): [[[[[0.0000000, 0.0000000], [0.0000000, 0.2192051]], [[0.0000000, 0.0000000], [0.4199103, 0.0077091]]], [[[0.0000000, 0.0000000], [0.0000000, 0.1419302]], [[0.0000000, 0.0000000], [0.0695690, 0.0793399]]]]]

Expected (Unparsed): [[[[[0.0,0.0],[0.0,0.21920506092830516]],[[0.0,0.0],[0.4199102734056816,0.007709098558083201]]],[[[0.0,0.0],[0.0,0.141930208216628]],[[0.0,0.0],[0.06956901022930559,0.0793398699718092]]]]]

Actual:   [[[[[0, 0], [0, 0.2193]], [[0, 0], [0.42, 0.0078]]], [[[0, 0], [0, 0.142]], [[0, 0], [0.0696, 0.0794]]]]]

Expected: [[[[[0, 0], [0, 0.2193]], [[0, 0], [0.42, 0.0078]]], [[[0, 0], [0, 0.142]], [[0, 0], [0.0696, 0.0794]]]]]