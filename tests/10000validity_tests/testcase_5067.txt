import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul43078 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Mul43078 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0PRe78357 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con21715 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Mul2076 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Mul2076 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Con80466 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Max92033 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Max92033 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))

Mul43078 = keras.layers.Multiply(name = 'Mul43078', )([in0Mul43078,in1Mul43078])
Res86640 = keras.layers.Reshape((2, 1, 2), name = 'Res86640', )(Mul43078)
PRe78357 = keras.layers.PReLU(name = 'PRe78357', input_shape=(2, 1, 1))(in0PRe78357)
Con21715 = keras.layers.Concatenate(axis=3, name = 'Con21715', )([PRe78357,in0Con21715])
Max28480 = keras.layers.Maximum(name = 'Max28480', )([Res86640,Con21715])
Res55747 = keras.layers.Reshape((2, 2), name = 'Res55747', )(Max28480)
Mul2076 = keras.layers.Multiply(name = 'Mul2076', )([in0Mul2076,in1Mul2076])
Res47443 = keras.layers.Reshape((2, 2, 2), name = 'Res47443', )(Mul2076)
Glo48824 = keras.layers.GlobalAveragePooling2D(name = 'Glo48824', )(Res47443)
Res88703 = keras.layers.Reshape((2, 1), name = 'Res88703', )(Glo48824)
Res41140 = keras.layers.Reshape((2, 1, 1), name = 'Res41140', )(Res88703)
Con80466 = keras.layers.Concatenate(axis=3, name = 'Con80466', )([Res41140,in0Con80466])
Max92033 = keras.layers.Maximum(name = 'Max92033', )([in0Max92033,in1Max92033])
Res37128 = keras.layers.Reshape((2, 1, 2), name = 'Res37128', )(Max92033)
Cro52804 = keras.layers.Cropping2D(cropping=((0, 1), (0, 0)), name = 'Cro52804', )(Res37128)
Zer72292 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer72292', )(Cro52804)
Mul61102 = keras.layers.Multiply(name = 'Mul61102', )([Con80466,Zer72292])
Res17825 = keras.layers.Reshape((2, 2), name = 'Res17825', )(Mul61102)
Dot91569 = keras.layers.Dot(axes=(2, 2), name = 'Dot91569', )([Res55747,Res17825])
model = tf.keras.models.Model(inputs=[in0Mul43078,in1Mul43078,in0PRe78357,in0Con21715,in0Mul2076,in1Mul2076,in0Con80466,in0Max92033,in1Max92033], outputs=Dot91569)
w = model.get_layer('PRe78357').get_weights() 
w[0] = np.array([[[0.9586]], [[0.54]]])
model.get_layer('PRe78357').set_weights(w) 
in0Mul43078 = tf.constant([[[[[0.6155], [0.8555]]], [[[0.4628], [0.2615]]]]])
in1Mul43078 = tf.constant([[[[[0.2411], [0.8334]]], [[[0.1626], [0.0551]]]]])
in0PRe78357 = tf.constant([[[[0.0012]], [[0.5196]]]])
in0Con21715 = tf.constant([[[[0.1823]], [[0.6747]]]])
in0Mul2076 = tf.constant([[[[[0.5521, 0.3873]], [[0.2773, 0.9956]]], [[[0.5276, 0.1347]], [[0.1583, 0.4461]]]]])
in1Mul2076 = tf.constant([[[[[0.5042, 0.2213]], [[0.2424, 0.7877]]], [[[0.1613, 0.8148]], [[0.8819, 0.6139]]]]])
in0Con80466 = tf.constant([[[[0.9288]], [[0.6716]]]])
in0Max92033 = tf.constant([[[[[0.0603, 0.6516]]], [[[0.0451, 0.5565]]]]])
in1Max92033 = tf.constant([[[[[0.71, 0.3454]]], [[[0.627, 0.0894]]]]])
print (np.array2string(model.predict([in0Mul43078,in1Mul43078,in0PRe78357,in0Con21715,in0Mul2076,in1Mul2076,in0Con80466,in0Max92033,in1Max92033],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot91569.png')

LMul43078 = multiply_layer([[[[[[0.6155], [0.8555]]], [[[0.4628], [0.2615]]]]], [[[[[0.2411], [0.8334]]], [[[0.1626], [0.0551]]]]]], Mul43078), 
LRes86640 = reshape_layer(Mul43078, [2, 1, 2], Res86640), 
LPRe78357 = prelu_layer([[[[0.0012]], [[0.5196]]]], [[[0.9586]], [[0.54]]], PRe78357), 
LCon21715 = concatenate_layer([PRe78357,[[[[0.1823]], [[0.6747]]]]], 3, Con21715), 
LMax28480 = maximum_layer([Res86640,Con21715], Max28480), 
LRes55747 = reshape_layer(Max28480, [2, 2], Res55747), 
LMul2076 = multiply_layer([[[[[[0.5521, 0.3873]], [[0.2773, 0.9956]]], [[[0.5276, 0.1347]], [[0.1583, 0.4461]]]]], [[[[[0.5042, 0.2213]], [[0.2424, 0.7877]]], [[[0.1613, 0.8148]], [[0.8819, 0.6139]]]]]], Mul2076), 
LRes47443 = reshape_layer(Mul2076, [2, 2, 2], Res47443), 
LGlo48824 = global_average_pooling2D_layer(Res47443, Glo48824), 
LRes88703 = reshape_layer(Glo48824, [2, 1], Res88703), 
LRes41140 = reshape_layer(Res88703, [2, 1, 1], Res41140), 
LCon80466 = concatenate_layer([Res41140,[[[[0.9288]], [[0.6716]]]]], 3, Con80466), 
LMax92033 = maximum_layer([[[[[[0.0603, 0.6516]]], [[[0.0451, 0.5565]]]]], [[[[[0.71, 0.3454]]], [[[0.627, 0.0894]]]]]], Max92033), 
LRes37128 = reshape_layer(Max92033, [2, 1, 2], Res37128), 
LCro52804 = cropping2D_layer(Res37128, 0, 1, 0, 0, Cro52804), 
LZer72292 = zero_padding2D_layer(Cro52804, 1, 0, 0, 0, Zer72292), 
LMul61102 = multiply_layer([Con80466,Zer72292], Mul61102), 
LRes17825 = reshape_layer(Mul61102, [2, 2], Res17825), 
LDot91569 = dot_layer(Res55747,Res17825, 2, 2, Dot91569), 
exec_layers([LMul43078,LRes86640,LPRe78357,LCon21715,LMax28480,LRes55747,LMul2076,LRes47443,LGlo48824,LRes88703,LRes41140,LCon80466,LMax92033,LRes37128,LCro52804,LZer72292,LMul61102,LRes17825,LDot91569],["Mul43078","Res86640","PRe78357","Con21715","Max28480","Res55747","Mul2076","Res47443","Glo48824","Res88703","Res41140","Con80466","Max92033","Res37128","Cro52804","Zer72292","Mul61102","Res17825","Dot91569"],Dot91569,"Dot91569")

Actual (Unparsed): [[[0.0000000, 0.3450270], [0.0000000, 0.4108729]]]

Expected (Unparsed): [[[0.0,0.3450269858471452],[0.0,0.41087294072483993]]]

Actual:   [[[0, 0.3451], [0, 0.4109]]]

Expected: [[[0, 0.3451], [0, 0.4109]]]