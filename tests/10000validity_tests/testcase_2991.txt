import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul10617 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul10617 = tf.keras.layers.Input(shape=([1, 1]))
in0Dot36141 = tf.keras.layers.Input(shape=([3]))
in1Dot36141 = tf.keras.layers.Input(shape=([3]))
in0Con2328 = tf.keras.layers.Input(shape=([2]))
in0Add28013 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Add28013 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))

Mul10617 = keras.layers.Multiply(name = 'Mul10617', )([in0Mul10617,in1Mul10617])
Res33115 = keras.layers.Reshape((1, 1, 1), name = 'Res33115', )(Mul10617)
PRe5945 = keras.layers.PReLU(name = 'PRe5945', )(Res33115)
Res87632 = keras.layers.Reshape((1, 1), name = 'Res87632', )(PRe5945)
Dot36141 = keras.layers.Dot(axes=(1, 1), name = 'Dot36141', )([in0Dot36141,in1Dot36141])
Res96687 = keras.layers.Reshape((1, 1), name = 'Res96687', )(Dot36141)
Add30429 = keras.layers.Add(name = 'Add30429', )([Res87632,Res96687])
Fla9256 = keras.layers.Flatten(name = 'Fla9256', )(Add30429)
Con2328 = keras.layers.Concatenate(axis=1, name = 'Con2328', )([Fla9256,in0Con2328])
Add28013 = keras.layers.Add(name = 'Add28013', )([in0Add28013,in1Add28013])
Res12959 = keras.layers.Reshape((1, 1, 4), name = 'Res12959', )(Add28013)
Res42409 = keras.layers.Reshape((1, 4), name = 'Res42409', )(Res12959)
GRU66648 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU66648', )(Res42409)
Min62232 = keras.layers.Minimum(name = 'Min62232', )([Con2328,GRU66648])
model = tf.keras.models.Model(inputs=[in0Mul10617,in1Mul10617,in0Dot36141,in1Dot36141,in0Con2328,in0Add28013,in1Add28013], outputs=Min62232)
w = model.get_layer('PRe5945').get_weights() 
w[0] = np.array([[[0.8344]]])
model.get_layer('PRe5945').set_weights(w) 
w = model.get_layer('GRU66648').get_weights() 
w[0] = np.array([[5, 2, 6, 5, 6, 4, 10, 9, 10], [10, 1, 1, 3, 3, 1, 7, 9, 5], [7, 5, 7, 6, 2, 3, 3, 9, 3], [4, 8, 1, 8, 5, 8, 1, 1, 5]])
w[1] = np.array([[8, 6, 10, 1, 5, 5, 9, 9, 10], [4, 5, 10, 5, 4, 6, 9, 5, 9], [9, 8, 2, 6, 8, 7, 9, 3, 6]])
w[2] = np.array([[4, 2, 1, 6, 1, 1, 7, 7, 10], [4, 5, 5, 10, 5, 7, 6, 8, 2]])
model.get_layer('GRU66648').set_weights(w) 
in0Mul10617 = tf.constant([[[0.8579]]])
in1Mul10617 = tf.constant([[[0.3568]]])
in0Dot36141 = tf.constant([[0.2982, 0.7955, 0.0019]])
in1Dot36141 = tf.constant([[0.2704, 0.3197, 0.442]])
in0Con2328 = tf.constant([[0.8551, 0.1383]])
in0Add28013 = tf.constant([[[[[0.7716, 0.6648], [0.339, 0.4936]]]]])
in1Add28013 = tf.constant([[[[[0.9067, 0.2439], [0.6062, 0.7469]]]]])
print (np.array2string(model.predict([in0Mul10617,in1Mul10617,in0Dot36141,in1Dot36141,in0Con2328,in0Add28013,in1Add28013],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min62232.png')

LMul10617 = multiply_layer([[[[0.8579]]], [[[0.3568]]]], Mul10617), 
LRes33115 = reshape_layer(Mul10617, [1, 1, 1], Res33115), 
LPRe5945 = prelu_layer(Res33115, [[[0.8344]]], PRe5945), 
LRes87632 = reshape_layer(PRe5945, [1, 1], Res87632), 
LDot36141 = dot_layer([[0.2982, 0.7955, 0.0019]], [[0.2704, 0.3197, 0.442]], 1, 1, Dot36141), 
LRes96687 = reshape_layer(Dot36141, [1, 1], Res96687), 
LAdd30429 = add_layer([Res87632,Res96687], Add30429), 
LFla9256 = flatten_layer(Add30429, Fla9256), 
LCon2328 = concatenate_layer([Fla9256,[[0.8551, 0.1383]]], 1, Con2328), 
LAdd28013 = add_layer([[[[[[0.7716, 0.6648], [0.339, 0.4936]]]]], [[[[[0.9067, 0.2439], [0.6062, 0.7469]]]]]], Add28013), 
LRes12959 = reshape_layer(Add28013, [1, 1, 4], Res12959), 
LRes42409 = reshape_layer(Res12959, [1, 4], Res42409), 
LGRU66648 = gru_layer(Res42409,[[5, 2, 6, 5, 6, 4, 10, 9, 10], [10, 1, 1, 3, 3, 1, 7, 9, 5], [7, 5, 7, 6, 2, 3, 3, 9, 3], [4, 8, 1, 8, 5, 8, 1, 1, 5]],[[8, 6, 10, 1, 5, 5, 9, 9, 10], [4, 5, 10, 5, 4, 6, 9, 5, 9], [9, 8, 2, 6, 8, 7, 9, 3, 6]],[[4, 2, 1, 6, 1, 1, 7, 7, 10], [4, 5, 5, 10, 5, 7, 6, 8, 2]], true, GRU66648), 
LMin62232 = minimum_layer([Con2328,GRU66648], Min62232), 
exec_layers([LMul10617,LRes33115,LPRe5945,LRes87632,LDot36141,LRes96687,LAdd30429,LFla9256,LCon2328,LAdd28013,LRes12959,LRes42409,LGRU66648,LMin62232],["Mul10617","Res33115","PRe5945","Res87632","Dot36141","Res96687","Add30429","Fla9256","Con2328","Add28013","Res12959","Res42409","GRU66648","Min62232"],Min62232,"Min62232")

Actual (Unparsed): [[0.0000000, 0.0000000, 0.0000000]]

Expected (Unparsed): [[0.0,5.560663041137559e-12,1.6372903033357034e-11]]

Actual:   [[0, 0, 0]]

Expected: [[0, 0, 0]]