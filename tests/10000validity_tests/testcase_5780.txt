import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max11709 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con76640 = tf.keras.layers.Input(shape=([2, 2, 2]))

Max11709 = keras.layers.MaxPool2D(pool_size=(2, 1), name = 'Max11709', )(in0Max11709)
Zer78003 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer78003', )(Max11709)
Con76640 = keras.layers.Conv2DTranspose(2, (1, 2),strides=(1, 1), padding='valid', name = 'Con76640', )(in0Con76640)
Mas58388 = keras.layers.Masking(mask_value=1, name = 'Mas58388', )(Con76640)
Ave93284 = keras.layers.Average(name = 'Ave93284', )([Zer78003,Mas58388])
model = tf.keras.models.Model(inputs=[in0Max11709,in0Con76640], outputs=Ave93284)
w = model.get_layer('Con76640').get_weights() 
w[0] = np.array([[[[0.7974, 0.2386], [0.2963, 0.9967]], [[0.7589, 0.5847], [0.671, 0.2434]]]])
w[1] = np.array([0, 0])
model.get_layer('Con76640').set_weights(w) 
in0Max11709 = tf.constant([[[[1.3476, 1.3253]], [[1.0832, 1.9972]]]])
in0Con76640 = tf.constant([[[[0.9858, 0.7538], [0.1433, 0.4091]], [[0.6341, 0.5143], [0.5377, 0.4448]]]])
print (np.array2string(model.predict([in0Max11709,in0Con76640],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave93284.png')

LMax11709 = max_pool2D_layer([[[[1.3476, 1.3253]], [[1.0832, 1.9972]]]], 2, 1, Max11709), 
LZer78003 = zero_padding2D_layer(Max11709, 1, 0, 2, 0, Zer78003), 
LCon76640 = conv2D_transpose_layer([[[[0.9858, 0.7538], [0.1433, 0.4091]], [[0.6341, 0.5143], [0.5377, 0.4448]]]], 1, 2,[[[[0.7974, 0.2386], [0.2963, 0.9967]], [[0.7589, 0.5847], [0.671, 0.2434]]]],[0, 0], 1, 1, false, Con76640), 
LMas58388 = masking_layer(Con76640, 1, Mas58388), 
LAve93284 = average_layer([Zer78003,Mas58388], Ave93284), 
exec_layers([LMax11709,LZer78003,LCon76640,LMas58388,LAve93284],["Max11709","Zer78003","Con76640","Mas58388","Ave93284"],Ave93284,"Ave93284")

Actual (Unparsed): [[[[0.4829668, 0.5217025], [0.7003746, 0.6475782], [0.1739756, 0.0978646]], [[0.3141717, 0.3502433], [0.6584105, 0.5766572], [1.0078675, 1.2331305]]]]

Expected (Unparsed): [[[[0.4829668,0.5217025000000001],[0.7003745800000001,0.6475782400000001],[0.17397557000000002,0.09786462000000001]],[[0.31417165999999996,0.35024331999999997],[0.65841048,0.576657195],[1.0078675449999999,1.23313051]]]]

Actual:   [[[[0.483, 0.5218], [0.7004, 0.6476], [0.174, 0.0979]], [[0.3142, 0.3503], [0.6585, 0.5767], [1.0079, 1.2332]]]]

Expected: [[[[0.483, 0.5218], [0.7004, 0.6476], [0.174, 0.0979]], [[0.3142, 0.3503], [0.6585, 0.5767], [1.0079, 1.2332]]]]