import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con63280 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0GRU37829 = tf.keras.layers.Input(shape=([2, 1]))
in0Con25735 = tf.keras.layers.Input(shape=([2, 2, 3]))

Con63280 = keras.layers.Conv3D(2, (2, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con63280', )(in0Con63280)
Res67216 = keras.layers.Reshape((2, 2, 4), name = 'Res67216', )(Con63280)
GRU37829 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU37829', )(in0GRU37829)
Res59692 = keras.layers.Reshape((3, 1), name = 'Res59692', )(GRU37829)
Glo1384 = keras.layers.GlobalAveragePooling1D(name = 'Glo1384', )(Res59692)
Res44825 = keras.layers.Reshape((1, 1), name = 'Res44825', )(Glo1384)
Res78575 = keras.layers.Reshape((1, 1, 1), name = 'Res78575', )(Res44825)
Cro78195 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro78195', )(Res78575)
Zer83231 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer83231', )(Cro78195)
Con25735 = keras.layers.Concatenate(axis=3, name = 'Con25735', )([Zer83231,in0Con25735])
Add83731 = keras.layers.Add(name = 'Add83731', )([Res67216,Con25735])
model = tf.keras.models.Model(inputs=[in0Con63280,in0GRU37829,in0Con25735], outputs=Add83731)
w = model.get_layer('Con63280').get_weights() 
w[0] = np.array([[[[[0.4859, 0.8128], [0.671, 0.8401]]]], [[[[0.3576, 0.9261], [0.5576, 0.9473]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con63280').set_weights(w) 
w = model.get_layer('GRU37829').get_weights() 
w[0] = np.array([[7, 4, 8, 10, 7, 4, 5, 4, 10]])
w[1] = np.array([[2, 7, 5, 9, 9, 4, 7, 2, 1], [5, 1, 1, 6, 3, 7, 8, 1, 3], [2, 8, 2, 6, 10, 6, 6, 5, 10]])
w[2] = np.array([[4, 1, 5, 6, 6, 1, 4, 4, 10], [10, 2, 9, 5, 4, 3, 2, 1, 4]])
model.get_layer('GRU37829').set_weights(w) 
in0Con63280 = tf.constant([[[[[0.8252, 0.2947], [0.8266, 0.5699]], [[0.4251, 0.2599], [0.5429, 0.5723]]], [[[0.2397, 0.0116], [0.487, 0.8076]], [[0.4784, 0.1533], [0.7524, 0.0733]]]]])
in0GRU37829 = tf.constant([[[5], [10]]])
in0Con25735 = tf.constant([[[[0.7202, 0.8039, 0.8667], [0.5638, 0.563, 0.4042]], [[0.1861, 0.4862, 0.9883], [0.8814, 0.201, 0.064]]]])
print (np.array2string(model.predict([in0Con63280,in0GRU37829,in0Con25735],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add83731.png')

LCon63280 = conv3D_layer([[[[[0.8252, 0.2947], [0.8266, 0.5699]], [[0.4251, 0.2599], [0.5429, 0.5723]]], [[[0.2397, 0.0116], [0.487, 0.8076]], [[0.4784, 0.1533], [0.7524, 0.0733]]]]], 2, 1, 1,[[[[[0.4859, 0.8128], [0.671, 0.8401]]]], [[[[0.3576, 0.9261], [0.5576, 0.9473]]]]],[0, 0], 1, 1, 1, true, 1, 1, 1, Con63280), 
LRes67216 = reshape_layer(Con63280, [2, 2, 4], Res67216), 
LGRU37829 = gru_layer([[[5], [10]]],[[7, 4, 8, 10, 7, 4, 5, 4, 10]],[[2, 7, 5, 9, 9, 4, 7, 2, 1], [5, 1, 1, 6, 3, 7, 8, 1, 3], [2, 8, 2, 6, 10, 6, 6, 5, 10]],[[4, 1, 5, 6, 6, 1, 4, 4, 10], [10, 2, 9, 5, 4, 3, 2, 1, 4]], true, GRU37829), 
LRes59692 = reshape_layer(GRU37829, [3, 1], Res59692), 
LGlo1384 = global_average_pooling1D_layer(Res59692, Glo1384), 
LRes44825 = reshape_layer(Glo1384, [1, 1], Res44825), 
LRes78575 = reshape_layer(Res44825, [1, 1, 1], Res78575), 
LCro78195 = cropping2D_layer(Res78575, 0, 0, 0, 0, Cro78195), 
LZer83231 = zero_padding2D_layer(Cro78195, 1, 0, 1, 0, Zer83231), 
LCon25735 = concatenate_layer([Zer83231,[[[[0.7202, 0.8039, 0.8667], [0.5638, 0.563, 0.4042]], [[0.1861, 0.4862, 0.9883], [0.8814, 0.201, 0.064]]]]], 3, Con25735), 
LAdd83731 = add_layer([Res67216,Con25735], Add83731), 
exec_layers([LCon63280,LRes67216,LGRU37829,LRes59692,LGlo1384,LRes44825,LRes78575,LCro78195,LZer83231,LCon25735,LAdd83731],["Con63280","Res67216","GRU37829","Res59692","Glo1384","Res44825","Res78575","Cro78195","Zer83231","Con25735","Add83731"],Add83731,"Add83731")

Actual (Unparsed): [[[[0.6908933, 1.8714749, 2.2124168, 3.2333836], [0.6375049, 1.7159306, 1.5207388, 2.0924931]], [[0.1242538, 0.3906733, 1.2647329, 2.0625984], [0.3353189, 1.3990308, 0.6157755, 0.7371300]]]]

Expected (Unparsed): [[[[0.6908932600000001,1.87147488,2.2124167999999997,3.2333836499999995],[0.6375049099999999,1.7159306,1.52073873,2.09249308]],[[0.12425383,0.39067332,1.2647329,2.06259836],[0.33531886003420625,1.39903085,0.61577546,0.73713005]]]]

Actual:   [[[[0.6909, 1.8715, 2.2125, 3.2334], [0.6376, 1.716, 1.5208, 2.0925]], [[0.1243, 0.3907, 1.2648, 2.0626], [0.3354, 1.3991, 0.6158, 0.7372]]]]

Expected: [[[[0.6909, 1.8715, 2.2125, 3.2334], [0.6376, 1.716, 1.5208, 2.0925]], [[0.1243, 0.3907, 1.2648, 2.0626], [0.3354, 1.3991, 0.6158, 0.7372]]]]