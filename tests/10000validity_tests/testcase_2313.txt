import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave18212 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Ave18212 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Glo75603 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Con16186 = tf.keras.layers.Input(shape=([5, 17]))
in0Con88124 = tf.keras.layers.Input(shape=([2, 1]))
in0Con74713 = tf.keras.layers.Input(shape=([3, 3, 2, 2]))
in0Sub19391 = tf.keras.layers.Input(shape=([3, 3, 2, 3]))
in1Sub19391 = tf.keras.layers.Input(shape=([3, 3, 2, 3]))

Ave18212 = keras.layers.Average(name = 'Ave18212', )([in0Ave18212,in1Ave18212])
Res23320 = keras.layers.Reshape((1, 2), name = 'Res23320', )(Ave18212)
Glo75603 = keras.layers.GlobalMaxPool3D(name = 'Glo75603', )(in0Glo75603)
Res25517 = keras.layers.Reshape((1, 1), name = 'Res25517', )(Glo75603)
Cro19622 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro19622', )(Res25517)
Dot46106 = keras.layers.Dot(axes=(1, 1), name = 'Dot46106', )([Res23320,Cro19622])
Zer90270 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer90270', )(Dot46106)
Con16186 = keras.layers.Concatenate(axis=2, name = 'Con16186', )([Zer90270,in0Con16186])
Con88124 = keras.layers.Conv1D(2, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con88124', )(in0Con88124)
Res75754 = keras.layers.Reshape((2, 2, 1), name = 'Res75754', )(Con88124)
Res64898 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res64898', )(Res75754)
Zer37617 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (1, 0)), name = 'Zer37617', )(Res64898)
Con74713 = keras.layers.Concatenate(axis=4, name = 'Con74713', )([Zer37617,in0Con74713])
Sub19391 = keras.layers.Subtract(name = 'Sub19391', )([in0Sub19391,in1Sub19391])
Sub48031 = keras.layers.Subtract(name = 'Sub48031', )([Con74713,Sub19391])
Res93855 = keras.layers.Reshape((3, 3, 6), name = 'Res93855', )(Sub48031)
Res93988 = keras.layers.Reshape((3, 18), name = 'Res93988', )(Res93855)
Zer74324 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer74324', )(Res93988)
Sub84911 = keras.layers.Subtract(name = 'Sub84911', )([Con16186,Zer74324])
model = tf.keras.models.Model(inputs=[in0Ave18212,in1Ave18212,in0Glo75603,in0Con16186,in0Con88124,in0Con74713,in0Sub19391,in1Sub19391], outputs=Sub84911)
w = model.get_layer('Con88124').get_weights() 
w[0] = np.array([[[0.3238, 0.789]]])
w[1] = np.array([0, 0])
model.get_layer('Con88124').set_weights(w) 
in0Ave18212 = tf.constant([[[[0.371], [0.5125]]]])
in1Ave18212 = tf.constant([[[[0.0039], [0.4328]]]])
in0Glo75603 = tf.constant([[[[[1.2432], [1.9471]]], [[[1.6875], [1.5811]]]]])
in0Con16186 = tf.constant([[[0.0481, 0.2849, 0.1045, 0.882, 0.0843, 0.1139, 0.7578, 0.6948, 0.9225, 0.2995, 0.5409, 0.7096, 0.0466, 0.3884, 0.7951, 0.9056, 0.9354], [0.0535, 0.2196, 0.6235, 0.1137, 0.9838, 0.0815, 0.145, 0.7794, 0.5461, 0.7114, 0.4574, 0.3772, 0.5667, 0.2193, 0.9124, 0.5006, 0.003], [0.2643, 0.4311, 0.5406, 0.9798, 0.1435, 0.6223, 0.5754, 0.6493, 0.4268, 0.6873, 0.0936, 0.6029, 0.8561, 0.2606, 0.2791, 0.106, 0.2547], [0.4059, 0.7516, 0.2623, 0.7458, 0.8247, 0.8515, 0.3193, 0.6665, 0.968, 0.7861, 0.7208, 0.1836, 0.1422, 0.2129, 0.1842, 0.7639, 0.8929], [0.1264, 0.0359, 0.3353, 0.9188, 0.234, 0.2705, 0.1848, 0.5193, 0.3619, 0.32, 0.3835, 0.1098, 0.8139, 0.3134, 0.8039, 0.6554, 0.0219]]])
in0Con88124 = tf.constant([[[0.2582], [0.0207]]])
in0Con74713 = tf.constant([[[[[0.5972, 0.0327], [0.7828, 0.1676]], [[0.2944, 0.2375], [0.3669, 0.9783]], [[0.789, 0.3368], [0.9011, 0.446]]], [[[0.9511, 0.9248], [0.487, 0.0981]], [[0.6565, 0.1722], [0.4052, 0.5728]], [[0.8004, 0.4362], [0.9474, 0.3504]]], [[[0.0477, 0.6484], [0.1186, 0.989]], [[0.2476, 0.2999], [0.1959, 0.9333]], [[0.8427, 0.6908], [0.7322, 0.1395]]]]])
in0Sub19391 = tf.constant([[[[[0.1367, 0.2263, 0.1687], [0.359, 0.8135, 0.1947]], [[0.638, 0.0298, 0.1443], [0.7243, 0.0862, 0.734]], [[0.2264, 0.7714, 0.9552], [0.1354, 0.2204, 0.0616]]], [[[0.5754, 0.4826, 0.758], [0.9262, 0.3711, 0.5215]], [[0.8919, 0.0758, 0.228], [0.3234, 0.3437, 0.8524]], [[0.4668, 0.0587, 0.0608], [0.1778, 0.0134, 0.9372]]], [[[0.3879, 0.3653, 0.0384], [0.5056, 0.4756, 0.2021]], [[0.5513, 0.2401, 0.9045], [0.223, 0.1756, 0.9106]], [[0.8854, 0.8947, 0.6074], [0.5, 0.8109, 0.51]]]]])
in1Sub19391 = tf.constant([[[[[0.0659, 0.5613, 0.3816], [0.9505, 0.3786, 0.7689]], [[0.0055, 0.1182, 0.2156], [0.0792, 0.6804, 0.7598]], [[0.3845, 0.3523, 0.1064], [0.6108, 0.0281, 0.5083]]], [[[0.3499, 0.2732, 0.0311], [0.2909, 0.9805, 0.0045]], [[0.932, 0.4944, 0.2366], [0.6474, 0.1637, 0.0741]], [[0.4428, 0.2548, 0.5001], [0.9023, 0.5939, 0.5785]]], [[[0.1742, 0.0612, 0.7533], [0.479, 0.25, 0.4699]], [[0.6675, 0.4871, 0.4811], [0.33, 0.7918, 0.2043]], [[0.0692, 0.3463, 0.7418], [0.9613, 0.4469, 0.928]]]]])
print (np.array2string(model.predict([in0Ave18212,in1Ave18212,in0Glo75603,in0Con16186,in0Con88124,in0Con74713,in0Sub19391,in1Sub19391],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub84911.png')

LAve18212 = average_layer([[[[[0.371], [0.5125]]]], [[[[0.0039], [0.4328]]]]], Ave18212), 
LRes23320 = reshape_layer(Ave18212, [1, 2], Res23320), 
LGlo75603 = global_max_pool3D_layer([[[[[1.2432], [1.9471]]], [[[1.6875], [1.5811]]]]], Glo75603), 
LRes25517 = reshape_layer(Glo75603, [1, 1], Res25517), 
LCro19622 = cropping1D_layer(Res25517, 0, 0, Cro19622), 
LDot46106 = dot_layer(Res23320,Cro19622, 1, 1, Dot46106), 
LZer90270 = zero_padding1D_layer(Dot46106, 3, 0, Zer90270), 
LCon16186 = concatenate_layer([Zer90270,[[[0.0481, 0.2849, 0.1045, 0.882, 0.0843, 0.1139, 0.7578, 0.6948, 0.9225, 0.2995, 0.5409, 0.7096, 0.0466, 0.3884, 0.7951, 0.9056, 0.9354], [0.0535, 0.2196, 0.6235, 0.1137, 0.9838, 0.0815, 0.145, 0.7794, 0.5461, 0.7114, 0.4574, 0.3772, 0.5667, 0.2193, 0.9124, 0.5006, 0.003], [0.2643, 0.4311, 0.5406, 0.9798, 0.1435, 0.6223, 0.5754, 0.6493, 0.4268, 0.6873, 0.0936, 0.6029, 0.8561, 0.2606, 0.2791, 0.106, 0.2547], [0.4059, 0.7516, 0.2623, 0.7458, 0.8247, 0.8515, 0.3193, 0.6665, 0.968, 0.7861, 0.7208, 0.1836, 0.1422, 0.2129, 0.1842, 0.7639, 0.8929], [0.1264, 0.0359, 0.3353, 0.9188, 0.234, 0.2705, 0.1848, 0.5193, 0.3619, 0.32, 0.3835, 0.1098, 0.8139, 0.3134, 0.8039, 0.6554, 0.0219]]]], 2, Con16186), 
LCon88124 = conv1D_layer([[[0.2582], [0.0207]]], 1,[[[0.3238, 0.789]]],[0, 0], 1, true, 1, Con88124), 
LRes75754 = reshape_layer(Con88124, [2, 2, 1], Res75754), 
LRes64898 = reshape_layer(Res75754, [2, 2, 1, 1], Res64898), 
LZer37617 = zero_padding3D_layer(Res64898, 1, 0, 1, 0, 1, 0, Zer37617), 
LCon74713 = concatenate_layer([Zer37617,[[[[[0.5972, 0.0327], [0.7828, 0.1676]], [[0.2944, 0.2375], [0.3669, 0.9783]], [[0.789, 0.3368], [0.9011, 0.446]]], [[[0.9511, 0.9248], [0.487, 0.0981]], [[0.6565, 0.1722], [0.4052, 0.5728]], [[0.8004, 0.4362], [0.9474, 0.3504]]], [[[0.0477, 0.6484], [0.1186, 0.989]], [[0.2476, 0.2999], [0.1959, 0.9333]], [[0.8427, 0.6908], [0.7322, 0.1395]]]]]], 4, Con74713), 
LSub19391 = subtract_layer([[[[[0.1367, 0.2263, 0.1687], [0.359, 0.8135, 0.1947]], [[0.638, 0.0298, 0.1443], [0.7243, 0.0862, 0.734]], [[0.2264, 0.7714, 0.9552], [0.1354, 0.2204, 0.0616]]], [[[0.5754, 0.4826, 0.758], [0.9262, 0.3711, 0.5215]], [[0.8919, 0.0758, 0.228], [0.3234, 0.3437, 0.8524]], [[0.4668, 0.0587, 0.0608], [0.1778, 0.0134, 0.9372]]], [[[0.3879, 0.3653, 0.0384], [0.5056, 0.4756, 0.2021]], [[0.5513, 0.2401, 0.9045], [0.223, 0.1756, 0.9106]], [[0.8854, 0.8947, 0.6074], [0.5, 0.8109, 0.51]]]]], [[[[[0.0659, 0.5613, 0.3816], [0.9505, 0.3786, 0.7689]], [[0.0055, 0.1182, 0.2156], [0.0792, 0.6804, 0.7598]], [[0.3845, 0.3523, 0.1064], [0.6108, 0.0281, 0.5083]]], [[[0.3499, 0.2732, 0.0311], [0.2909, 0.9805, 0.0045]], [[0.932, 0.4944, 0.2366], [0.6474, 0.1637, 0.0741]], [[0.4428, 0.2548, 0.5001], [0.9023, 0.5939, 0.5785]]], [[[0.1742, 0.0612, 0.7533], [0.479, 0.25, 0.4699]], [[0.6675, 0.4871, 0.4811], [0.33, 0.7918, 0.2043]], [[0.0692, 0.3463, 0.7418], [0.9613, 0.4469, 0.928]]]]], Sub19391), 
LSub48031 = subtract_layer(Con74713,Sub19391, Sub48031), 
LRes93855 = reshape_layer(Sub48031, [3, 3, 6], Res93855), 
LRes93988 = reshape_layer(Res93855, [3, 18], Res93988), 
LZer74324 = zero_padding1D_layer(Res93988, 1, 1, Zer74324), 
LSub84911 = subtract_layer(Con16186,Zer74324, Sub84911), 
exec_layers([LAve18212,LRes23320,LGlo75603,LRes25517,LCro19622,LDot46106,LZer90270,LCon16186,LCon88124,LRes75754,LRes64898,LZer37617,LCon74713,LSub19391,LSub48031,LRes93855,LRes93988,LZer74324,LSub84911],["Ave18212","Res23320","Glo75603","Res25517","Cro19622","Dot46106","Zer90270","Con16186","Con88124","Res75754","Res64898","Zer37617","Con74713","Sub19391","Sub48031","Res93855","Res93988","Zer74324","Sub84911"],Sub84911,"Sub84911")

Actual (Unparsed): [[[0.0000000, 0.0481000, 0.2849000, 0.1045000, 0.8820000, 0.0843000, 0.1139000, 0.7578000, 0.6948000, 0.9225000, 0.2995000, 0.5409000, 0.7096000, 0.0466000, 0.3884000, 0.7951000, 0.9056000, 0.9354000], [0.0708000, -0.8787000, -0.0260000, 0.0320000, -0.2342000, 0.2420000, 0.7140000, -0.2378000, 0.4706000, 1.1912000, -0.2497000, -0.5467000, 0.2191000, 0.1968000, 0.7313000, 0.4370000, -0.2082000, -0.8897000], [0.2255000, -0.4774000, 0.2332000, 1.1759000, -0.1166000, 0.5624000, 0.5822001, -0.4997000, 0.4685000, 0.0191948, 0.4621000, 0.2991000, 0.6269000, -0.1404000, -0.6149000, -0.6491198, -1.4219000, 0.2630000], [0.5786839, 0.6623000, -0.6117000, 0.2889000, 0.8528000, -0.4321000, 0.7352999, -0.1753000, 0.7900000, 0.8542973, -0.0260000, 0.4938000, 0.9998000, -0.1521000, -0.6123000, -0.2934323, 0.3956999, 0.3354000], [0.9202968, 0.1264000, 0.0359000, 0.3353000, 0.9188000, 0.2340000, 0.2705000, 0.1848000, 0.5193000, 0.3619000, 0.3200000, 0.3835000, 0.1098000, 0.8139000, 0.3134000, 0.8039000, 0.6554000, 0.0219000]]]

Expected (Unparsed): [[[0,0.0481,0.2849,0.1045,0.882,0.0843,0.1139,0.7578,0.6948,0.9225,0.2995,0.5409,0.7096,0.0466,0.3884,0.7951,0.9056,0.9354],[0.07079999999999999,-0.8786999999999999,-0.026000000000000023,0.03200000000000003,-0.23420000000000005,0.242,0.7140000000000001,-0.23780000000000004,0.4706,1.1912,-0.24970000000000003,-0.5467,0.21909999999999996,0.19679999999999992,0.7313000000000001,0.43699999999999994,-0.20819999999999994,-0.8897],[0.22550000000000003,-0.47740000000000005,0.23320000000000002,1.1759,-0.11660000000000004,0.5624,0.5821999999999999,-0.4996999999999999,0.4685,0.019194840000000102,0.4621,0.29910000000000003,0.6269,-0.14040000000000008,-0.6149,-0.6491197999999999,-1.4219,0.263],[0.5786838950000001,0.6623,-0.6116999999999999,0.28890000000000005,0.8528,-0.43209999999999993,0.7353000000000001,-0.17529999999999996,0.7899999999999999,0.85429734,-0.025999999999999912,0.4937999999999999,0.9997999999999999,-0.1521,-0.6123,-0.2934323000000001,0.3957,0.3353999999999999],[0.920296815,0.1264,0.0359,0.3353,0.9188,0.234,0.2705,0.1848,0.5193,0.3619,0.32,0.3835,0.1098,0.8139,0.3134,0.8039,0.6554,0.0219]]]

Actual:   [[[0, 0.0481, 0.2849, 0.1045, 0.882, 0.0843, 0.1139, 0.7578, 0.6948, 0.9225, 0.2995, 0.5409, 0.7096, 0.0466, 0.3884, 0.7951, 0.9056, 0.9354], [0.0708, -0.8787, -0.026, 0.032, -0.2342, 0.242, 0.714, -0.2378, 0.4706, 1.1912, -0.2497, -0.5467, 0.2191, 0.1968, 0.7313, 0.437, -0.2082, -0.8897], [0.2255, -0.4774, 0.2332, 1.1759, -0.1166, 0.5624, 0.5823, -0.4997, 0.4685, 0.0192, 0.4621, 0.2991, 0.6269, -0.1404, -0.6149, -0.6491, -1.4219, 0.263], [0.5787, 0.6623, -0.6117, 0.2889, 0.8528, -0.4321, 0.7353, -0.1753, 0.79, 0.8543, -0.026, 0.4938, 0.9998, -0.1521, -0.6123, -0.2934, 0.3957, 0.3354], [0.9203, 0.1264, 0.0359, 0.3353, 0.9188, 0.234, 0.2705, 0.1848, 0.5193, 0.3619, 0.32, 0.3835, 0.1098, 0.8139, 0.3134, 0.8039, 0.6554, 0.0219]]]

Expected: [[[0, 0.0481, 0.2849, 0.1045, 0.882, 0.0843, 0.1139, 0.7578, 0.6948, 0.9225, 0.2995, 0.5409, 0.7096, 0.0466, 0.3884, 0.7951, 0.9056, 0.9354], [0.0708, -0.8786, -0.026, 0.0321, -0.2342, 0.242, 0.7141, -0.2378, 0.4706, 1.1912, -0.2497, -0.5467, 0.2191, 0.1968, 0.7314, 0.437, -0.2081, -0.8897], [0.2256, -0.4774, 0.2333, 1.1759, -0.1166, 0.5624, 0.5822, -0.4996, 0.4685, 0.0192, 0.4621, 0.2992, 0.6269, -0.1404, -0.6149, -0.6491, -1.4219, 0.263], [0.5787, 0.6623, -0.6116, 0.289, 0.8528, -0.432, 0.7354, -0.1752, 0.79, 0.8543, -0.0259, 0.4938, 0.9998, -0.1521, -0.6123, -0.2934, 0.3957, 0.3354], [0.9203, 0.1264, 0.0359, 0.3353, 0.9188, 0.234, 0.2705, 0.1848, 0.5193, 0.3619, 0.32, 0.3835, 0.1098, 0.8139, 0.3134, 0.8039, 0.6554, 0.0219]]]