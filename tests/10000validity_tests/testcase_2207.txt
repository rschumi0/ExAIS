import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave91895 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Ave91895 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Add98342 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Add98342 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Con37296 = tf.keras.layers.Input(shape=([4]))

Ave91895 = keras.layers.Average(name = 'Ave91895', )([in0Ave91895,in1Ave91895])
Res60203 = keras.layers.Reshape((2, 2, 2), name = 'Res60203', )(Ave91895)
Res68029 = keras.layers.Reshape((2, 4), name = 'Res68029', )(Res60203)
Fla28194 = keras.layers.Flatten(name = 'Fla28194', )(Res68029)
Add98342 = keras.layers.Add(name = 'Add98342', )([in0Add98342,in1Add98342])
Res2190 = keras.layers.Reshape((2, 2, 2), name = 'Res2190', )(Add98342)
Res61603 = keras.layers.Reshape((2, 4), name = 'Res61603', )(Res2190)
Glo81398 = keras.layers.GlobalAveragePooling1D(name = 'Glo81398', )(Res61603)
Con37296 = keras.layers.Concatenate(axis=1, name = 'Con37296', )([Glo81398,in0Con37296])
Sub6247 = keras.layers.Subtract(name = 'Sub6247', )([Fla28194,Con37296])
model = tf.keras.models.Model(inputs=[in0Ave91895,in1Ave91895,in0Add98342,in1Add98342,in0Con37296], outputs=Sub6247)
in0Ave91895 = tf.constant([[[[[0.0375], [0.9161]], [[0.9158], [0.5773]]], [[[0.049], [0.1443]], [[0.0887], [0.6623]]]]])
in1Ave91895 = tf.constant([[[[[0.5393], [0.3553]], [[0.4555], [0.451]]], [[[0.2143], [0.3876]], [[0.5891], [0.5539]]]]])
in0Add98342 = tf.constant([[[[[0.854], [0.5647]], [[0.1393], [0.2256]]], [[[0.7643], [0.6416]], [[0.7551], [0.2647]]]]])
in1Add98342 = tf.constant([[[[[0.3834], [0.3184]], [[0.9547], [0.7772]]], [[[0.5614], [0.5793]], [[0.3754], [0.7252]]]]])
in0Con37296 = tf.constant([[0.0283, 0.6692, 0.3088, 0.2886]])
print (np.array2string(model.predict([in0Ave91895,in1Ave91895,in0Add98342,in1Add98342,in0Con37296],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub6247.png')

LAve91895 = average_layer([[[[[[0.0375], [0.9161]], [[0.9158], [0.5773]]], [[[0.049], [0.1443]], [[0.0887], [0.6623]]]]], [[[[[0.5393], [0.3553]], [[0.4555], [0.451]]], [[[0.2143], [0.3876]], [[0.5891], [0.5539]]]]]], Ave91895), 
LRes60203 = reshape_layer(Ave91895, [2, 2, 2], Res60203), 
LRes68029 = reshape_layer(Res60203, [2, 4], Res68029), 
LFla28194 = flatten_layer(Res68029, Fla28194), 
LAdd98342 = add_layer([[[[[[0.854], [0.5647]], [[0.1393], [0.2256]]], [[[0.7643], [0.6416]], [[0.7551], [0.2647]]]]], [[[[[0.3834], [0.3184]], [[0.9547], [0.7772]]], [[[0.5614], [0.5793]], [[0.3754], [0.7252]]]]]], Add98342), 
LRes2190 = reshape_layer(Add98342, [2, 2, 2], Res2190), 
LRes61603 = reshape_layer(Res2190, [2, 4], Res61603), 
LGlo81398 = global_average_pooling1D_layer(Res61603, Glo81398), 
LCon37296 = concatenate_layer([Glo81398,[[0.0283, 0.6692, 0.3088, 0.2886]]], 1, Con37296), 
LSub6247 = subtract_layer(Fla28194,Con37296, Sub6247), 
exec_layers([LAve91895,LRes60203,LRes68029,LFla28194,LAdd98342,LRes2190,LRes61603,LGlo81398,LCon37296,LSub6247],["Ave91895","Res60203","Res68029","Fla28194","Add98342","Res2190","Res61603","Glo81398","Con37296","Sub6247"],Sub6247,"Sub6247")

Actual (Unparsed): [[-0.9931500, -0.4163000, -0.4266000, -0.4822000, 0.1033500, -0.4032500, 0.0301000, 0.3195000]]

Expected (Unparsed): [[-0.99315,-0.4163,-0.4266,-0.48219999999999996,0.10335,-0.40325,0.03009999999999996,0.31949999999999995]]

Actual:   [[-0.9931, -0.4163, -0.4266, -0.4822, 0.1034, -0.4032, 0.0301, 0.3195]]

Expected: [[-0.9931, -0.4163, -0.4266, -0.4821, 0.1034, -0.4032, 0.0301, 0.3195]]