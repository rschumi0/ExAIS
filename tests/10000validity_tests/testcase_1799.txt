import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave83637 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Ave83637 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Con982 = tf.keras.layers.Input(shape=([2, 2]))
in0Sub60586 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub60586 = tf.keras.layers.Input(shape=([2, 3]))

Ave83637 = keras.layers.Average(name = 'Ave83637', )([in0Ave83637,in1Ave83637])
Res1178 = keras.layers.Reshape((1, 2, 2), name = 'Res1178', )(Ave83637)
Res58805 = keras.layers.Reshape((1, 4), name = 'Res58805', )(Res1178)
LST25243 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST25243', )(Res58805)
Res45851 = keras.layers.Reshape((1, 1), name = 'Res45851', )(LST25243)
Zer96056 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer96056', )(Res45851)
Con982 = keras.layers.Concatenate(axis=2, name = 'Con982', )([Zer96056,in0Con982])
Sub60586 = keras.layers.Subtract(name = 'Sub60586', )([in0Sub60586,in1Sub60586])
Sub69398 = keras.layers.Subtract(name = 'Sub69398', )([Con982,Sub60586])
Res3636 = keras.layers.Reshape((2, 3, 1), name = 'Res3636', )(Sub69398)
Res75029 = keras.layers.Reshape((2, 3, 1, 1), name = 'Res75029', )(Res3636)
Glo53249 = keras.layers.GlobalMaxPool3D(name = 'Glo53249', )(Res75029)
model = tf.keras.models.Model(inputs=[in0Ave83637,in1Ave83637,in0Con982,in0Sub60586,in1Sub60586], outputs=Glo53249)
w = model.get_layer('LST25243').get_weights() 
w[0] = np.array([[3, 3, 3, 9], [8, 1, 1, 4], [8, 10, 1, 9], [10, 1, 8, 4]])
w[1] = np.array([[3, 1, 6, 4]])
w[2] = np.array([9, 1, 3, 1])
model.get_layer('LST25243').set_weights(w) 
in0Ave83637 = tf.constant([[[[[0.6649], [0.8232]], [[0.4364], [0.3681]]]]])
in1Ave83637 = tf.constant([[[[[0.6924], [0.8785]], [[0.6216], [0.7377]]]]])
in0Con982 = tf.constant([[[0.3546, 0.8198], [0.2909, 0.9562]]])
in0Sub60586 = tf.constant([[[0.9461, 0.7037, 0.964], [0.6806, 0.1884, 0.196]]])
in1Sub60586 = tf.constant([[[0.0027, 0.0398, 0.9118], [0.685, 0.3605, 0.3542]]])
print (np.array2string(model.predict([in0Ave83637,in1Ave83637,in0Con982,in0Sub60586,in1Sub60586],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo53249.png')

LAve83637 = average_layer([[[[[[0.6649], [0.8232]], [[0.4364], [0.3681]]]]], [[[[[0.6924], [0.8785]], [[0.6216], [0.7377]]]]]], Ave83637), 
LRes1178 = reshape_layer(Ave83637, [1, 2, 2], Res1178), 
LRes58805 = reshape_layer(Res1178, [1, 4], Res58805), 
LLST25243 = lstm_layer(Res58805,[[3, 3, 3, 9], [8, 1, 1, 4], [8, 10, 1, 9], [10, 1, 8, 4]],[[3, 1, 6, 4]],[9, 1, 3, 1], LST25243), 
LRes45851 = reshape_layer(LST25243, [1, 1], Res45851), 
LZer96056 = zero_padding1D_layer(Res45851, 1, 0, Zer96056), 
LCon982 = concatenate_layer([Zer96056,[[[0.3546, 0.8198], [0.2909, 0.9562]]]], 2, Con982), 
LSub60586 = subtract_layer([[[0.9461, 0.7037, 0.964], [0.6806, 0.1884, 0.196]]], [[[0.0027, 0.0398, 0.9118], [0.685, 0.3605, 0.3542]]], Sub60586), 
LSub69398 = subtract_layer(Con982,Sub60586, Sub69398), 
LRes3636 = reshape_layer(Sub69398, [2, 3, 1], Res3636), 
LRes75029 = reshape_layer(Res3636, [2, 3, 1, 1], Res75029), 
LGlo53249 = global_max_pool3D_layer(Res75029, Glo53249), 
exec_layers([LAve83637,LRes1178,LRes58805,LLST25243,LRes45851,LZer96056,LCon982,LSub60586,LSub69398,LRes3636,LRes75029,LGlo53249],["Ave83637","Res1178","Res58805","LST25243","Res45851","Zer96056","Con982","Sub60586","Sub69398","Res3636","Res75029","Glo53249"],Glo53249,"Glo53249")

Actual (Unparsed): [[1.1144000]]

Expected (Unparsed): [[1.1144]]

Actual:   [[1.1144]]

Expected: [[1.1144]]