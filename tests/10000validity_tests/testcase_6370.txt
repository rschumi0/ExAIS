import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add88142 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Add88142 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Mul41122 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Mul41122 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Dot7643 = tf.keras.layers.Input(shape=([3]))
in1Dot7643 = tf.keras.layers.Input(shape=([3]))

Add88142 = keras.layers.Add(name = 'Add88142', )([in0Add88142,in1Add88142])
Res77191 = keras.layers.Reshape((2, 1, 2), name = 'Res77191', )(Add88142)
Up_17454 = keras.layers.UpSampling2D(size=(1, 1), name = 'Up_17454', )(Res77191)
Res68335 = keras.layers.Reshape((2, 2), name = 'Res68335', )(Up_17454)
Mul41122 = keras.layers.Multiply(name = 'Mul41122', )([in0Mul41122,in1Mul41122])
Res13553 = keras.layers.Reshape((2, 1, 2), name = 'Res13553', )(Mul41122)
Res48854 = keras.layers.Reshape((2, 2), name = 'Res48854', )(Res13553)
Dot7643 = keras.layers.Dot(axes=(1, 1), name = 'Dot7643', )([in0Dot7643,in1Dot7643])
Mas86424 = keras.layers.Masking(mask_value=1, name = 'Mas86424', )(Dot7643)
Res33134 = keras.layers.Reshape((1, 1), name = 'Res33134', )(Mas86424)
Con18822 = keras.layers.Conv1D(2, (1),strides=(9), padding='same', dilation_rate=(1), name = 'Con18822', )(Res33134)
Zer4364 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer4364', )(Con18822)
Add18720 = keras.layers.Add(name = 'Add18720', )([Res48854,Zer4364])
Sub87298 = keras.layers.Subtract(name = 'Sub87298', )([Res68335,Add18720])
model = tf.keras.models.Model(inputs=[in0Add88142,in1Add88142,in0Mul41122,in1Mul41122,in0Dot7643,in1Dot7643], outputs=Sub87298)
w = model.get_layer('Con18822').get_weights() 
w[0] = np.array([[[0.0938, 0.7563]]])
w[1] = np.array([0, 0])
model.get_layer('Con18822').set_weights(w) 
in0Add88142 = tf.constant([[[[[0.0774, 0.1128]]], [[[0.2745, 0.3213]]]]])
in1Add88142 = tf.constant([[[[[0.0466, 0.0032]]], [[[0.7483, 0.7431]]]]])
in0Mul41122 = tf.constant([[[[[0.0863, 0.1957]]], [[[0.3856, 0.5853]]]]])
in1Mul41122 = tf.constant([[[[[0.3154, 0.9585]]], [[[0.484, 0.8486]]]]])
in0Dot7643 = tf.constant([[0.2397, 0.9377, 0.6733]])
in1Dot7643 = tf.constant([[0.0601, 0.7041, 0.2295]])
print (np.array2string(model.predict([in0Add88142,in1Add88142,in0Mul41122,in1Mul41122,in0Dot7643,in1Dot7643],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub87298.png')

LAdd88142 = add_layer([[[[[[0.0774, 0.1128]]], [[[0.2745, 0.3213]]]]], [[[[[0.0466, 0.0032]]], [[[0.7483, 0.7431]]]]]], Add88142), 
LRes77191 = reshape_layer(Add88142, [2, 1, 2], Res77191), 
LUp_17454 = up_sampling2D_layer(Res77191, 1, 1, Up_17454), 
LRes68335 = reshape_layer(Up_17454, [2, 2], Res68335), 
LMul41122 = multiply_layer([[[[[[0.0863, 0.1957]]], [[[0.3856, 0.5853]]]]], [[[[[0.3154, 0.9585]]], [[[0.484, 0.8486]]]]]], Mul41122), 
LRes13553 = reshape_layer(Mul41122, [2, 1, 2], Res13553), 
LRes48854 = reshape_layer(Res13553, [2, 2], Res48854), 
LDot7643 = dot_layer([[0.2397, 0.9377, 0.6733]], [[0.0601, 0.7041, 0.2295]], 1, 1, Dot7643), 
LMas86424 = masking_layer(Dot7643, 1, Mas86424), 
LRes33134 = reshape_layer(Mas86424, [1, 1], Res33134), 
LCon18822 = conv1D_layer(Res33134, 1,[[[0.0938, 0.7563]]],[0, 0], 9, true, 1, Con18822), 
LZer4364 = zero_padding1D_layer(Con18822, 1, 0, Zer4364), 
LAdd18720 = add_layer([Res48854,Zer4364], Add18720), 
LSub87298 = subtract_layer(Res68335,Add18720, Sub87298), 
exec_layers([LAdd88142,LRes77191,LUp_17454,LRes68335,LMul41122,LRes13553,LRes48854,LDot7643,LMas86424,LRes33134,LCon18822,LZer4364,LAdd18720,LSub87298],["Add88142","Res77191","Up_17454","Res68335","Mul41122","Res13553","Res48854","Dot7643","Mas86424","Res33134","Con18822","Zer4364","Add18720","Sub87298"],Sub87298,"Sub87298")

Actual (Unparsed): [[[0.0967810, -0.0715785], [0.7583942, -0.0593815]]]

Expected (Unparsed): [[[0.09678098,-0.07157845000000002],[0.758394120918,-0.059381473706999977]]]

Actual:   [[[0.0968, -0.0715], [0.7584, -0.0593]]]

Expected: [[[0.0968, -0.0715], [0.7584, -0.0593]]]