import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave60746 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Ave60746 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Max50957 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Max50957 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))

Ave60746 = keras.layers.Average(name = 'Ave60746', )([in0Ave60746,in1Ave60746])
Res53858 = keras.layers.Reshape((2, 1, 2), name = 'Res53858', )(Ave60746)
Res42513 = keras.layers.Reshape((2, 2), name = 'Res42513', )(Res53858)
GRU48882 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU48882', )(Res42513)
Res5947 = keras.layers.Reshape((2, 1), name = 'Res5947', )(GRU48882)
Ave10066 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave10066', )(Res5947)
Glo47898 = keras.layers.GlobalMaxPool1D(name = 'Glo47898', )(Ave10066)
Res29842 = keras.layers.Reshape((1, 1), name = 'Res29842', )(Glo47898)
Res51285 = keras.layers.Reshape((1, 1, 1), name = 'Res51285', )(Res29842)
Res81407 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res81407', )(Res51285)
Zer52345 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (0, 0)), name = 'Zer52345', )(Res81407)
Max50957 = keras.layers.Maximum(name = 'Max50957', )([in0Max50957,in1Max50957])
Sof43184 = keras.layers.Softmax(axis=1, name = 'Sof43184', )(Max50957)
Max37339 = keras.layers.Maximum(name = 'Max37339', )([Zer52345,Sof43184])
model = tf.keras.models.Model(inputs=[in0Ave60746,in1Ave60746,in0Max50957,in1Max50957], outputs=Max37339)
w = model.get_layer('GRU48882').get_weights() 
w[0] = np.array([[4, 6, 10, 9, 3, 10], [6, 3, 10, 10, 1, 4]])
w[1] = np.array([[4, 5, 7, 6, 2, 9], [3, 9, 10, 7, 1, 4]])
w[2] = np.array([4, 10, 8, 3, 2, 2])
model.get_layer('GRU48882').set_weights(w) 
in0Ave60746 = tf.constant([[[[[0.1298], [0.7603]]], [[[0.2113], [0.2936]]]]])
in1Ave60746 = tf.constant([[[[[0.3011], [0.8574]]], [[[0.8451], [0.52]]]]])
in0Max50957 = tf.constant([[[[[0.3344]], [[0.1603]]]]])
in1Max50957 = tf.constant([[[[[0.8593]], [[0.9283]]]]])
print (np.array2string(model.predict([in0Ave60746,in1Ave60746,in0Max50957,in1Max50957],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max37339.png')

LAve60746 = average_layer([[[[[[0.1298], [0.7603]]], [[[0.2113], [0.2936]]]]], [[[[[0.3011], [0.8574]]], [[[0.8451], [0.52]]]]]], Ave60746), 
LRes53858 = reshape_layer(Ave60746, [2, 1, 2], Res53858), 
LRes42513 = reshape_layer(Res53858, [2, 2], Res42513), 
LGRU48882 = gru_layer(Res42513,[[4, 6, 10, 9, 3, 10], [6, 3, 10, 10, 1, 4]],[[4, 5, 7, 6, 2, 9], [3, 9, 10, 7, 1, 4]],[4, 10, 8, 3, 2, 2], false, GRU48882), 
LRes5947 = reshape_layer(GRU48882, [2, 1], Res5947), 
LAve10066 = average_pooling1D_layer(Res5947, 1, Ave10066), 
LGlo47898 = global_max_pool1D_layer(Ave10066, Glo47898), 
LRes29842 = reshape_layer(Glo47898, [1, 1], Res29842), 
LRes51285 = reshape_layer(Res29842, [1, 1, 1], Res51285), 
LRes81407 = reshape_layer(Res51285, [1, 1, 1, 1], Res81407), 
LZer52345 = zero_padding3D_layer(Res81407, 0, 0, 1, 0, 0, 0, Zer52345), 
LMax50957 = maximum_layer([[[[[[0.3344]], [[0.1603]]]]], [[[[[0.8593]], [[0.9283]]]]]], Max50957), 
LSof43184 = softmax_layer(Max50957, 1, Sof43184), 
LMax37339 = maximum_layer([Zer52345,Sof43184], Max37339), 
exec_layers([LAve60746,LRes53858,LRes42513,LGRU48882,LRes5947,LAve10066,LGlo47898,LRes29842,LRes51285,LRes81407,LZer52345,LMax50957,LSof43184,LMax37339],["Ave60746","Res53858","Res42513","GRU48882","Res5947","Ave10066","Glo47898","Res29842","Res51285","Res81407","Zer52345","Max50957","Sof43184","Max37339"],Max37339,"Max37339")

Actual (Unparsed): [[[[[1.0000000]], [[1.0000000]]]]]

Expected (Unparsed): [[[[[1.0]],[[1.0]]]]]

Actual:   [[[[[1]], [[1]]]]]

Expected: [[[[[1]], [[1]]]]]