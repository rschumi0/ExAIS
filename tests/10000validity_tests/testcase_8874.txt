import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub75202 = tf.keras.layers.Input(shape=([3, 3, 3]))
in1Sub75202 = tf.keras.layers.Input(shape=([3, 3, 3]))

Sub75202 = keras.layers.Subtract(name = 'Sub75202', )([in0Sub75202,in1Sub75202])
Res23750 = keras.layers.Reshape((3, 9), name = 'Res23750', )(Sub75202)
Ave49507 = keras.layers.AveragePooling1D(pool_size=(3), name = 'Ave49507', )(Res23750)
Res47361 = keras.layers.Reshape((1, 9, 1), name = 'Res47361', )(Ave49507)
Loc71439 = keras.layers.LocallyConnected2D(3, (1, 8),strides=(1, 1), name = 'Loc71439', )(Res47361)
model = tf.keras.models.Model(inputs=[in0Sub75202,in1Sub75202], outputs=Loc71439)
w = model.get_layer('Loc71439').get_weights() 
w[0] = np.array([[[0.8602, 0.9234, 0.1789], [0.686, 0.6508, 0.2148], [0.7285, 0.1417, 0.4046], [0.3717, 0.681, 0.4934], [0.93, 0.4829, 0.3151], [0.5491, 0.8361, 0.0409], [0.019, 0.0812, 0.102], [0.0241, 0.7859, 0.7727]], [[0.1846, 0.3692, 0.6967], [0.2984, 0.7544, 0.4702], [0.0982, 0.4882, 0.6739], [0.3116, 0.9165, 0.8199], [0.0209, 0.7244, 0.4303], [0.1967, 0.797, 0.0409], [0.8774, 0.0808, 0.4623], [0.1144, 0.4639, 0.574]]])
w[1] = np.array([[[0, 0, 0], [0, 0, 0]]])
model.get_layer('Loc71439').set_weights(w) 
in0Sub75202 = tf.constant([[[[0.6866, 0.7197, 0.776], [0.495, 0.2053, 0.7337], [0.5362, 0.746, 0.4405]], [[0.1781, 0.0576, 0.7309], [0.9317, 0.5584, 0.6513], [0.8523, 0.638, 0.6002]], [[0.2573, 0.7576, 0.374], [0.6046, 0.1464, 0.1927], [0.7261, 0.9453, 0.2629]]]])
in1Sub75202 = tf.constant([[[[0.3927, 0.3361, 0.0144], [0.464, 0.3744, 0.4656], [0.3992, 0.1412, 0.3027]], [[0.4366, 0.448, 0.0966], [0.3078, 0.8902, 0.6737], [0.0937, 0.7456, 0.7963]], [[0.6336, 0.1985, 0.9134], [0.8051, 0.0221, 0.8861], [0.6609, 0.8378, 0.721]]]])
print (np.array2string(model.predict([in0Sub75202,in1Sub75202],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc71439.png')

LSub75202 = subtract_layer([[[[0.6866, 0.7197, 0.776], [0.495, 0.2053, 0.7337], [0.5362, 0.746, 0.4405]], [[0.1781, 0.0576, 0.7309], [0.9317, 0.5584, 0.6513], [0.8523, 0.638, 0.6002]], [[0.2573, 0.7576, 0.374], [0.6046, 0.1464, 0.1927], [0.7261, 0.9453, 0.2629]]]], [[[[0.3927, 0.3361, 0.0144], [0.464, 0.3744, 0.4656], [0.3992, 0.1412, 0.3027]], [[0.4366, 0.448, 0.0966], [0.3078, 0.8902, 0.6737], [0.0937, 0.7456, 0.7963]], [[0.6336, 0.1985, 0.9134], [0.8051, 0.0221, 0.8861], [0.6609, 0.8378, 0.721]]]], Sub75202), 
LRes23750 = reshape_layer(Sub75202, [3, 9], Res23750), 
LAve49507 = average_pooling1D_layer(Res23750, 3, Ave49507), 
LRes47361 = reshape_layer(Ave49507, [1, 9, 1], Res47361), 
LLoc71439 = locally_connected2D_layer(Res47361, 1, 8,[[[0.8602, 0.9234, 0.1789], [0.686, 0.6508, 0.2148], [0.7285, 0.1417, 0.4046], [0.3717, 0.681, 0.4934], [0.93, 0.4829, 0.3151], [0.5491, 0.8361, 0.0409], [0.019, 0.0812, 0.102], [0.0241, 0.7859, 0.7727]], [[0.1846, 0.3692, 0.6967], [0.2984, 0.7544, 0.4702], [0.0982, 0.4882, 0.6739], [0.3116, 0.9165, 0.8199], [0.0209, 0.7244, 0.4303], [0.1967, 0.797, 0.0409], [0.8774, 0.0808, 0.4623], [0.1144, 0.4639, 0.574]]],[[[0, 0, 0], [0, 0, 0]]], 1, 1, Loc71439), 
exec_layers([LSub75202,LRes23750,LAve49507,LRes47361,LLoc71439],["Sub75202","Res23750","Ave49507","Res47361","Loc71439"],Loc71439,"Loc71439")

Actual (Unparsed): [[[[0.1050849, 0.1575103, 0.3522212], [0.3119759, 0.3258275, 0.2049167]]]]

Expected (Unparsed): [[[[0.10508491666666668,0.15751027,0.3522211966666666],[0.3119759166666667,0.3258274866666666,0.20491671666666667]]]]

Actual:   [[[[0.1051, 0.1576, 0.3523], [0.312, 0.3259, 0.205]]]]

Expected: [[[[0.1051, 0.1576, 0.3523], [0.312, 0.3259, 0.205]]]]