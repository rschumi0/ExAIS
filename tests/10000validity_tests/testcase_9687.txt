import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0ReL15883 = tf.keras.layers.Input(shape=([1, 1]))
in0Mul93382 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Mul93382 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Sub90714 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub90714 = tf.keras.layers.Input(shape=([2, 3]))
in0Con30666 = tf.keras.layers.Input(shape=([2, 2, 1]))

ReL15883 = keras.layers.ReLU(max_value=0.503386025275702, negative_slope=8.608295135620782, threshold=8.634342480927739, name = 'ReL15883', input_shape=(1, 1))(in0ReL15883)
Res22554 = keras.layers.Reshape((1, 1, 1), name = 'Res22554', )(ReL15883)
Res78420 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res78420', )(Res22554)
Con62571 = keras.layers.Conv3DTranspose(4, (1, 1, 1),strides=(1, 1, 1), padding='same', name = 'Con62571', )(Res78420)
Con18787 = keras.layers.Conv3D(2, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con18787', )(Con62571)
Res13024 = keras.layers.Reshape((1, 1, 2), name = 'Res13024', )(Con18787)
Zer5153 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer5153', )(Res13024)
Mul93382 = keras.layers.Multiply(name = 'Mul93382', )([in0Mul93382,in1Mul93382])
Sub90714 = keras.layers.Subtract(name = 'Sub90714', )([in0Sub90714,in1Sub90714])
Loc50969 = keras.layers.LocallyConnected1D(4, (1),strides=(2), name = 'Loc50969', )(Sub90714)
Res74020 = keras.layers.Reshape((1, 4, 1), name = 'Res74020', )(Loc50969)
Cro35964 = keras.layers.Cropping2D(cropping=((0, 0), (1, 1)), name = 'Cro35964', )(Res74020)
Zer22836 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer22836', )(Cro35964)
Con30666 = keras.layers.Concatenate(axis=3, name = 'Con30666', )([Zer22836,in0Con30666])
Ave92478 = keras.layers.Average(name = 'Ave92478', )([Mul93382,Con30666])
Ave1399 = keras.layers.Average(name = 'Ave1399', )([Zer5153,Ave92478])
model = tf.keras.models.Model(inputs=[in0ReL15883,in0Mul93382,in1Mul93382,in0Sub90714,in1Sub90714,in0Con30666], outputs=Ave1399)
w = model.get_layer('Con62571').get_weights() 
w[0] = np.array([[[[[0.3483], [0.115], [0.1154], [0.795]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con62571').set_weights(w) 
w = model.get_layer('Con18787').get_weights() 
w[0] = np.array([[[[[0.1181, 0.5428], [0.5817, 0.6336], [0.6293, 0.6322], [0.8749, 0.7066]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con18787').set_weights(w) 
w = model.get_layer('Loc50969').get_weights() 
w[0] = np.array([[[0.1457, 0.2849, 0.9827, 0.285], [0.3221, 0.394, 0.0458, 0.7097], [0.1722, 0.3862, 0.6654, 0.7057]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc50969').set_weights(w) 
in0ReL15883 = tf.constant([[[0.7781]]])
in0Mul93382 = tf.constant([[[[0.3296, 0.3229], [0.8693, 0.0737]], [[0.859, 0.3601], [0.7084, 0.8089]]]])
in1Mul93382 = tf.constant([[[[0.8923, 0.6988], [0.2874, 0.5568]], [[0.2033, 0.942], [0.5217, 0.8292]]]])
in0Sub90714 = tf.constant([[[0.9281, 0.9685, 0.5918], [0.0693, 0.6679, 0.6097]]])
in1Sub90714 = tf.constant([[[0.5566, 0.6655, 0.2127], [0.0184, 0.7621, 0.2564]]])
in0Con30666 = tf.constant([[[[0.9355], [0.4294]], [[0.1749], [0.8808]]]])
print (np.array2string(model.predict([in0ReL15883,in0Mul93382,in1Mul93382,in0Sub90714,in1Sub90714,in0Con30666],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave1399.png')

LReL15883 = relu_layer([[[0.7781]]], 0.503386025275702, 8.608295135620782, 8.634342480927739, ReL15883), 
LRes22554 = reshape_layer(ReL15883, [1, 1, 1], Res22554), 
LRes78420 = reshape_layer(Res22554, [1, 1, 1, 1], Res78420), 
LCon62571 = conv3D_transpose_layer(Res78420, 1, 1, 1,[[[[[0.3483], [0.115], [0.1154], [0.795]]]]],[0, 0, 0, 0], 1, 1, 1, true, Con62571), 
LCon18787 = conv3D_layer(Con62571, 1, 1, 1,[[[[[0.1181, 0.5428], [0.5817, 0.6336], [0.6293, 0.6322], [0.8749, 0.7066]]]]],[0, 0], 1, 1, 1, true, 1, 1, 1, Con18787), 
LRes13024 = reshape_layer(Con18787, [1, 1, 2], Res13024), 
LZer5153 = zero_padding2D_layer(Res13024, 1, 0, 1, 0, Zer5153), 
LMul93382 = multiply_layer([[[[[0.3296, 0.3229], [0.8693, 0.0737]], [[0.859, 0.3601], [0.7084, 0.8089]]]], [[[[0.8923, 0.6988], [0.2874, 0.5568]], [[0.2033, 0.942], [0.5217, 0.8292]]]]], Mul93382), 
LSub90714 = subtract_layer([[[0.9281, 0.9685, 0.5918], [0.0693, 0.6679, 0.6097]]], [[[0.5566, 0.6655, 0.2127], [0.0184, 0.7621, 0.2564]]], Sub90714), 
LLoc50969 = locally_connected1D_layer(Sub90714, 1,[[[0.1457, 0.2849, 0.9827, 0.285], [0.3221, 0.394, 0.0458, 0.7097], [0.1722, 0.3862, 0.6654, 0.7057]]],[[0, 0, 0, 0]], 2, Loc50969), 
LRes74020 = reshape_layer(Loc50969, [1, 4, 1], Res74020), 
LCro35964 = cropping2D_layer(Res74020, 0, 0, 1, 1, Cro35964), 
LZer22836 = zero_padding2D_layer(Cro35964, 1, 0, 0, 0, Zer22836), 
LCon30666 = concatenate_layer([Zer22836,[[[[0.9355], [0.4294]], [[0.1749], [0.8808]]]]], 3, Con30666), 
LAve92478 = average_layer([Mul93382,Con30666], Ave92478), 
LAve1399 = average_layer([Zer5153,Ave92478], Ave1399), 
exec_layers([LReL15883,LRes22554,LRes78420,LCon62571,LCon18787,LRes13024,LZer5153,LMul93382,LSub90714,LLoc50969,LRes74020,LCro35964,LZer22836,LCon30666,LAve92478,LAve1399],["ReL15883","Res22554","Res78420","Con62571","Con18787","Res13024","Zer5153","Mul93382","Sub90714","Loc50969","Res74020","Cro35964","Zer22836","Con30666","Ave92478","Ave1399"],Ave1399,"Ave1399")

Actual (Unparsed): [[[[0.0735255, 0.2902856], [0.0624592, 0.1176090]], [[0.1365664, 0.1285285], [-29.3778868, -29.9309458]]]]

Expected (Unparsed): [[[[0.07352552,0.29028563],[0.062459205,0.11760904]],[[0.1365663675,0.12852855],[-29.37788689925604,-29.930945852065044]]]]

Actual:   [[[[0.0736, 0.2903], [0.0625, 0.1177]], [[0.1366, 0.1286], [-29.3778, -29.9309]]]]

Expected: [[[[0.0736, 0.2903], [0.0625, 0.1177]], [[0.1366, 0.1286], [-29.3778, -29.9309]]]]