import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0PRe10955 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Max21234 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Max21234 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))

PRe10955 = keras.layers.PReLU(name = 'PRe10955', input_shape=(2, 2, 2, 1))(in0PRe10955)
Res9840 = keras.layers.Reshape((2, 2, 2), name = 'Res9840', )(PRe10955)
Zer65082 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer65082', )(Res9840)
Res25741 = keras.layers.Reshape((4, 8), name = 'Res25741', )(Zer65082)
Con64732 = keras.layers.Conv1D(3, (2),strides=(1), padding='valid', dilation_rate=(1), name = 'Con64732', )(Res25741)
Ave24330 = keras.layers.AveragePooling1D(pool_size=(2), strides=(4), padding='same', name = 'Ave24330', )(Con64732)
Res23377 = keras.layers.Reshape((1, 3, 1), name = 'Res23377', )(Ave24330)
Res46437 = keras.layers.Reshape((1, 3, 1, 1), name = 'Res46437', )(Res23377)
Max21234 = keras.layers.Maximum(name = 'Max21234', )([in0Max21234,in1Max21234])
Zer60415 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (0, 0)), name = 'Zer60415', )(Max21234)
Ave99649 = keras.layers.Average(name = 'Ave99649', )([Res46437,Zer60415])
model = tf.keras.models.Model(inputs=[in0PRe10955,in0Max21234,in1Max21234], outputs=Ave99649)
w = model.get_layer('PRe10955').get_weights() 
w[0] = np.array([[[[0.915], [0.2446]], [[0.6692], [0.9552]]], [[[0.2377], [0.5671]], [[0.0674], [0.9742]]]])
model.get_layer('PRe10955').set_weights(w) 
w = model.get_layer('Con64732').get_weights() 
w[0] = np.array([[[0.4423, 0.1969, 0.0694], [0.3525, 0.0568, 0.5117], [0.2459, 0.521, 0.0463], [0.1577, 0.3604, 0.3391], [0.4384, 0.7859, 0.1443], [0.6989, 0.9044, 0.333], [0.1601, 0.5735, 0.4272], [0.6348, 0.2375, 0.062]], [[0.9285, 0.1333, 0.7813], [0.1779, 0.6623, 0.9744], [0.5796, 0.3172, 0.3609], [0.6725, 0.6259, 0.0487], [0.9635, 0.3033, 0.5133], [0.9846, 0.2545, 0.8807], [0.1599, 0.0096, 0.8891], [0.1711, 0.9791, 0.0736]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con64732').set_weights(w) 
in0PRe10955 = tf.constant([[[[[0.3449], [0.2723]], [[0.2035], [0.242]]], [[[0.5647], [0.3954]], [[0.7498], [0.1284]]]]])
in0Max21234 = tf.constant([[[[[0.2743]], [[0.4512]]]]])
in1Max21234 = tf.constant([[[[[0.7123]], [[0.0585]]]]])
print (np.array2string(model.predict([in0PRe10955,in0Max21234,in1Max21234],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave99649.png')

LPRe10955 = prelu_layer([[[[[0.3449], [0.2723]], [[0.2035], [0.242]]], [[[0.5647], [0.3954]], [[0.7498], [0.1284]]]]], [[[[0.915], [0.2446]], [[0.6692], [0.9552]]], [[[0.2377], [0.5671]], [[0.0674], [0.9742]]]], PRe10955), 
LRes9840 = reshape_layer(PRe10955, [2, 2, 2], Res9840), 
LZer65082 = zero_padding2D_layer(Res9840, 1, 1, 1, 1, Zer65082), 
LRes25741 = reshape_layer(Zer65082, [4, 8], Res25741), 
LCon64732 = conv1D_layer(Res25741, 2,[[[0.4423, 0.1969, 0.0694], [0.3525, 0.0568, 0.5117], [0.2459, 0.521, 0.0463], [0.1577, 0.3604, 0.3391], [0.4384, 0.7859, 0.1443], [0.6989, 0.9044, 0.333], [0.1601, 0.5735, 0.4272], [0.6348, 0.2375, 0.062]], [[0.9285, 0.1333, 0.7813], [0.1779, 0.6623, 0.9744], [0.5796, 0.3172, 0.3609], [0.6725, 0.6259, 0.0487], [0.9635, 0.3033, 0.5133], [0.9846, 0.2545, 0.8807], [0.1599, 0.0096, 0.8891], [0.1711, 0.9791, 0.0736]]],[0, 0, 0], 1, false, 1, Con64732), 
LAve24330 = average_pooling1D_layer(Con64732, 2, 4, true, Ave24330), 
LRes23377 = reshape_layer(Ave24330, [1, 3, 1], Res23377), 
LRes46437 = reshape_layer(Res23377, [1, 3, 1, 1], Res46437), 
LMax21234 = maximum_layer([[[[[[0.2743]], [[0.4512]]]]], [[[[[0.7123]], [[0.0585]]]]]], Max21234), 
LZer60415 = zero_padding3D_layer(Max21234, 0, 0, 1, 0, 0, 0, Zer60415), 
LAve99649 = average_layer([Res46437,Zer60415], Ave99649), 
exec_layers([LPRe10955,LRes9840,LZer65082,LRes25741,LCon64732,LAve24330,LRes23377,LRes46437,LMax21234,LZer60415,LAve99649],["PRe10955","Res9840","Zer65082","Res25741","Con64732","Ave24330","Res23377","Res46437","Max21234","Zer60415","Ave99649"],Ave99649,"Ave99649")

Actual (Unparsed): [[[[[0.6613834]], [[0.7927666]], [[0.5742472]]]]]

Expected (Unparsed): [[[[[0.661383405]],[[0.7927666275]],[[0.5742471625]]]]]

Actual:   [[[[[0.6614]], [[0.7928]], [[0.5743]]]]]

Expected: [[[[[0.6614]], [[0.7928]], [[0.5743]]]]]