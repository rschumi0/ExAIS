import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul21697 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Mul21697 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Mul17259 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Mul17259 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con73619 = tf.keras.layers.Input(shape=([2, 2, 1]))

Mul21697 = keras.layers.Multiply(name = 'Mul21697', )([in0Mul21697,in1Mul21697])
Res26449 = keras.layers.Reshape((2, 2, 1), name = 'Res26449', )(Mul21697)
Res77433 = keras.layers.Reshape((2, 2), name = 'Res77433', )(Res26449)
Glo14593 = keras.layers.GlobalMaxPool1D(name = 'Glo14593', )(Res77433)
Res62281 = keras.layers.Reshape((2, 1), name = 'Res62281', )(Glo14593)
Res17173 = keras.layers.Reshape((2, 1, 1), name = 'Res17173', )(Res62281)
Con55472 = keras.layers.Conv2D(2, (2, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con55472', )(Res17173)
Zer4911 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer4911', )(Con55472)
Mul17259 = keras.layers.Multiply(name = 'Mul17259', )([in0Mul17259,in1Mul17259])
Con73619 = keras.layers.Concatenate(axis=3, name = 'Con73619', )([Mul17259,in0Con73619])
Ave159 = keras.layers.Average(name = 'Ave159', )([Zer4911,Con73619])
model = tf.keras.models.Model(inputs=[in0Mul21697,in1Mul21697,in0Mul17259,in1Mul17259,in0Con73619], outputs=Ave159)
w = model.get_layer('Con55472').get_weights() 
w[0] = np.array([[[[0.8939, 0.487]]], [[[0.6528, 0.0459]]]])
w[1] = np.array([0, 0])
model.get_layer('Con55472').set_weights(w) 
in0Mul21697 = tf.constant([[[[[0.4438]], [[0.4177]]], [[[0.9392]], [[0.6272]]]]])
in1Mul21697 = tf.constant([[[[[0.9352]], [[0.3516]]], [[[0.0868]], [[0.0294]]]]])
in0Mul17259 = tf.constant([[[[0.2651], [0.0857]], [[0.0386], [0.4961]]]])
in1Mul17259 = tf.constant([[[[0.7], [0.1249]], [[0.6987], [0.1787]]]])
in0Con73619 = tf.constant([[[[0.198], [0.5945]], [[0.3597], [0.0799]]]])
print (np.array2string(model.predict([in0Mul21697,in1Mul21697,in0Mul17259,in1Mul17259,in0Con73619],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave159.png')

LMul21697 = multiply_layer([[[[[[0.4438]], [[0.4177]]], [[[0.9392]], [[0.6272]]]]], [[[[[0.9352]], [[0.3516]]], [[[0.0868]], [[0.0294]]]]]], Mul21697), 
LRes26449 = reshape_layer(Mul21697, [2, 2, 1], Res26449), 
LRes77433 = reshape_layer(Res26449, [2, 2], Res77433), 
LGlo14593 = global_max_pool1D_layer(Res77433, Glo14593), 
LRes62281 = reshape_layer(Glo14593, [2, 1], Res62281), 
LRes17173 = reshape_layer(Res62281, [2, 1, 1], Res17173), 
LCon55472 = conv2D_layer(Res17173, 2, 1,[[[[0.8939, 0.487]]], [[[0.6528, 0.0459]]]],[0, 0], 1, 1, false, 1, 1, Con55472), 
LZer4911 = zero_padding2D_layer(Con55472, 1, 0, 1, 0, Zer4911), 
LMul17259 = multiply_layer([[[[[0.2651], [0.0857]], [[0.0386], [0.4961]]]], [[[[0.7], [0.1249]], [[0.6987], [0.1787]]]]], Mul17259), 
LCon73619 = concatenate_layer([Mul17259,[[[[0.198], [0.5945]], [[0.3597], [0.0799]]]]], 3, Con73619), 
LAve159 = average_layer([Zer4911,Con73619], Ave159), 
exec_layers([LMul21697,LRes26449,LRes77433,LGlo14593,LRes62281,LRes17173,LCon55472,LZer4911,LMul17259,LCon73619,LAve159],["Mul21697","Res26449","Res77433","Glo14593","Res62281","Res17173","Con55472","Zer4911","Mul17259","Con73619","Ave159"],Ave159,"Ave159")

Actual (Unparsed): [[[[0.0927850, 0.0990000], [0.0053520, 0.2972500]], [[0.0134849, 0.1798500], [0.2777656, 0.1443832]]]]

Expected (Unparsed): [[[[0.09278499999999999,0.099],[0.005351965,0.29725]],[[0.013484910000000001,0.17985],[0.27776563728000003,0.144383181754]]]]

Actual:   [[[[0.0928, 0.099], [0.0054, 0.2973]], [[0.0135, 0.1799], [0.2778, 0.1444]]]]

Expected: [[[[0.0928, 0.099], [0.0054, 0.2973]], [[0.0135, 0.1799], [0.2778, 0.1444]]]]