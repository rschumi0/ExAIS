import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave84122 = tf.keras.layers.Input(shape=([1, 1]))
in1Ave84122 = tf.keras.layers.Input(shape=([1, 1]))
in0Con22622 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Sep31681 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Cro7166 = tf.keras.layers.Input(shape=([2, 3]))
in0Con53945 = tf.keras.layers.Input(shape=([1, 3]))

Ave84122 = keras.layers.Average(name = 'Ave84122', )([in0Ave84122,in1Ave84122])
Res25140 = keras.layers.Reshape((1, 1, 1), name = 'Res25140', )(Ave84122)
Zer56763 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer56763', )(Res25140)
Con22622 = keras.layers.Concatenate(axis=3, name = 'Con22622', )([Zer56763,in0Con22622])
Sep31681 = keras.layers.SeparableConv2D(3, (1, 1),strides=(1, 1), padding='same', name = 'Sep31681', )(in0Sep31681)
Max3677 = keras.layers.Maximum(name = 'Max3677', )([Con22622,Sep31681])
Res55989 = keras.layers.Reshape((1, 6), name = 'Res55989', )(Max3677)
Cro7166 = keras.layers.Cropping1D(cropping=((0, 1)), name = 'Cro7166', )(in0Cro7166)
Con53945 = keras.layers.Concatenate(axis=2, name = 'Con53945', )([Cro7166,in0Con53945])
Sub3142 = keras.layers.Subtract(name = 'Sub3142', )([Res55989,Con53945])
model = tf.keras.models.Model(inputs=[in0Ave84122,in1Ave84122,in0Con22622,in0Sep31681,in0Cro7166,in0Con53945], outputs=Sub3142)
w = model.get_layer('Sep31681').get_weights() 
w[0] = np.array([[[[0.5289], [0.4594]]]])
w[1] = np.array([[[[0.082, 0.8313, 0.2283], [0.3586, 0.9076, 0.9277]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep31681').set_weights(w) 
in0Ave84122 = tf.constant([[[0.5855]]])
in1Ave84122 = tf.constant([[[0.0483]]])
in0Con22622 = tf.constant([[[[0.6813, 0.4402], [0.1654, 0.8941]]]])
in0Sep31681 = tf.constant([[[[0.5024, 0.7177], [0.4744, 0.153]]]])
in0Cro7166 = tf.constant([[[1.9049, 1.3094, 1.7724], [1.8968, 1.901, 1.1769]]])
in0Con53945 = tf.constant([[[0.9251, 0.3879, 0.1106]]])
print (np.array2string(model.predict([in0Ave84122,in1Ave84122,in0Con22622,in0Sep31681,in0Cro7166,in0Con53945],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub3142.png')

LAve84122 = average_layer([[[[0.5855]]], [[[0.0483]]]], Ave84122), 
LRes25140 = reshape_layer(Ave84122, [1, 1, 1], Res25140), 
LZer56763 = zero_padding2D_layer(Res25140, 0, 0, 1, 0, Zer56763), 
LCon22622 = concatenate_layer([Zer56763,[[[[0.6813, 0.4402], [0.1654, 0.8941]]]]], 3, Con22622), 
LSep31681 = separable_conv2D_layer([[[[0.5024, 0.7177], [0.4744, 0.153]]]], 1, 1,[[[[[0.5289], [0.4594]]]],[[[[0.082, 0.8313, 0.2283], [0.3586, 0.9076, 0.9277]]]]],[0, 0, 0], 1, 1, true, Sep31681), 
LMax3677 = maximum_layer([Con22622,Sep31681], Max3677), 
LRes55989 = reshape_layer(Max3677, [1, 6], Res55989), 
LCro7166 = cropping1D_layer([[[1.9049, 1.3094, 1.7724], [1.8968, 1.901, 1.1769]]], 0, 1, Cro7166), 
LCon53945 = concatenate_layer([Cro7166,[[[0.9251, 0.3879, 0.1106]]]], 2, Con53945), 
LSub3142 = subtract_layer(Res55989,Con53945, Sub3142), 
exec_layers([LAve84122,LRes25140,LZer56763,LCon22622,LSep31681,LMax3677,LRes55989,LCro7166,LCon53945,LSub3142],["Ave84122","Res25140","Zer56763","Con22622","Sep31681","Max3677","Res55989","Cro7166","Con53945","Sub3142"],Sub3142,"Sub3142")

Actual (Unparsed): [[[-1.7648765, -0.6281000, -1.3322000, -0.6082000, -0.1155248, 0.7835000]]]

Expected (Unparsed): [[[-1.764876511612,-0.6280999999999999,-1.3322,-0.6082000000000001,-0.11552481367200002,0.7835]]]

Actual:   [[[-1.7648, -0.6281, -1.3322, -0.6082, -0.1155, 0.7835]]]

Expected: [[[-1.7648, -0.628, -1.3322, -0.6082, -0.1155, 0.7835]]]