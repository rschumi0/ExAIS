import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul92980 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Mul92980 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))

Mul92980 = keras.layers.Multiply(name = 'Mul92980', )([in0Mul92980,in1Mul92980])
Res60829 = keras.layers.Reshape((2, 2, 2), name = 'Res60829', )(Mul92980)
Res72465 = keras.layers.Reshape((2, 4), name = 'Res72465', )(Res60829)
Cro37603 = keras.layers.Cropping1D(cropping=((0, 1)), name = 'Cro37603', )(Res72465)
Con67416 = keras.layers.Conv1D(4, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con67416', )(Cro37603)
LST56240 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST56240', )(Con67416)
model = tf.keras.models.Model(inputs=[in0Mul92980,in1Mul92980], outputs=LST56240)
w = model.get_layer('Con67416').get_weights() 
w[0] = np.array([[[0.0327, 0.6199, 0.1248, 0.5205], [0.2893, 0.6154, 0.3186, 0.3783], [0.4543, 0.7676, 0.209, 0.8547], [0.4934, 0.8775, 0.8143, 0.2811]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con67416').set_weights(w) 
w = model.get_layer('LST56240').get_weights() 
w[0] = np.array([[1, 6, 3, 8, 9, 5, 6, 7], [1, 1, 9, 4, 1, 3, 5, 4], [3, 9, 6, 2, 2, 10, 4, 1], [10, 6, 1, 7, 10, 5, 2, 8]])
w[1] = np.array([[2, 8, 1, 7, 6, 3, 3, 3], [5, 4, 9, 9, 4, 9, 4, 3]])
w[2] = np.array([2, 3, 2, 8, 3, 1, 5, 6])
model.get_layer('LST56240').set_weights(w) 
in0Mul92980 = tf.constant([[[[[0.7045], [0.1579]], [[0.4072], [0.5266]]], [[[0.5073], [0.1784]], [[0.164], [0.4542]]]]])
in1Mul92980 = tf.constant([[[[[0.9197], [0.9103]], [[0.2251], [0.5835]]], [[[0.7486], [0.709]], [[0.5497], [0.8955]]]]])
print (np.array2string(model.predict([in0Mul92980,in1Mul92980],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST56240.png')

LMul92980 = multiply_layer([[[[[[0.7045], [0.1579]], [[0.4072], [0.5266]]], [[[0.5073], [0.1784]], [[0.164], [0.4542]]]]], [[[[[0.9197], [0.9103]], [[0.2251], [0.5835]]], [[[0.7486], [0.709]], [[0.5497], [0.8955]]]]]], Mul92980), 
LRes60829 = reshape_layer(Mul92980, [2, 2, 2], Res60829), 
LRes72465 = reshape_layer(Res60829, [2, 4], Res72465), 
LCro37603 = cropping1D_layer(Res72465, 0, 1, Cro37603), 
LCon67416 = conv1D_layer(Cro37603, 1,[[[0.0327, 0.6199, 0.1248, 0.5205], [0.2893, 0.6154, 0.3186, 0.3783], [0.4543, 0.7676, 0.209, 0.8547], [0.4934, 0.8775, 0.8143, 0.2811]]],[0, 0, 0, 0], 1, false, 1, Con67416), 
LLST56240 = lstm_layer(Con67416,[[1, 6, 3, 8, 9, 5, 6, 7], [1, 1, 9, 4, 1, 3, 5, 4], [3, 9, 6, 2, 2, 10, 4, 1], [10, 6, 1, 7, 10, 5, 2, 8]],[[2, 8, 1, 7, 6, 3, 3, 3], [5, 4, 9, 9, 4, 9, 4, 3]],[2, 3, 2, 8, 3, 1, 5, 6], LST56240), 
exec_layers([LMul92980,LRes60829,LRes72465,LCro37603,LCon67416,LLST56240],["Mul92980","Res60829","Res72465","Cro37603","Con67416","LST56240"],LST56240,"LST56240")

Actual (Unparsed): [[0.7615706, 0.7615921]]

Expected (Unparsed): [[0.7615705535072531,0.7615920937290636]]

Actual:   [[0.7616, 0.7616]]

Expected: [[0.7616, 0.7616]]