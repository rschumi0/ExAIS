import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave78846 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Ave78846 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))

Ave78846 = keras.layers.Average(name = 'Ave78846', )([in0Ave78846,in1Ave78846])
Res55978 = keras.layers.Reshape((1, 1, 2), name = 'Res55978', )(Ave78846)
Res79504 = keras.layers.Reshape((1, 2), name = 'Res79504', )(Res55978)
Loc20409 = keras.layers.LocallyConnected1D(4, (1),strides=(12), name = 'Loc20409', )(Res79504)
GRU19638 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU19638', )(Loc20409)
model = tf.keras.models.Model(inputs=[in0Ave78846,in1Ave78846], outputs=GRU19638)
w = model.get_layer('Loc20409').get_weights() 
w[0] = np.array([[[0.0711, 0.7209, 0.2628, 0.9182], [0.5142, 0.317, 0.2254, 0.8769]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc20409').set_weights(w) 
w = model.get_layer('GRU19638').get_weights() 
w[0] = np.array([[2, 6, 7, 6, 1, 7], [1, 1, 4, 2, 8, 8], [10, 4, 2, 8, 2, 9], [8, 8, 7, 7, 9, 1]])
w[1] = np.array([[5, 6, 9, 2, 7, 8], [7, 8, 1, 10, 9, 4]])
w[2] = np.array([[6, 10, 1, 1, 10, 2], [3, 9, 3, 1, 2, 3]])
model.get_layer('GRU19638').set_weights(w) 
in0Ave78846 = tf.constant([[[[[0.7071], [0.5341]]]]])
in1Ave78846 = tf.constant([[[[[0.4846], [0.584]]]]])
print (np.array2string(model.predict([in0Ave78846,in1Ave78846],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU19638.png')

LAve78846 = average_layer([[[[[[0.7071], [0.5341]]]]], [[[[[0.4846], [0.584]]]]]], Ave78846), 
LRes55978 = reshape_layer(Ave78846, [1, 1, 2], Res55978), 
LRes79504 = reshape_layer(Res55978, [1, 2], Res79504), 
LLoc20409 = locally_connected1D_layer(Res79504, 1,[[[0.0711, 0.7209, 0.2628, 0.9182], [0.5142, 0.317, 0.2254, 0.8769]]],[[0, 0, 0, 0]], 12, Loc20409), 
LGRU19638 = gru_layer(Loc20409,[[2, 6, 7, 6, 1, 7], [1, 1, 4, 2, 8, 8], [10, 4, 2, 8, 2, 9], [8, 8, 7, 7, 9, 1]],[[5, 6, 9, 2, 7, 8], [7, 8, 1, 10, 9, 4]],[[6, 10, 1, 1, 10, 2], [3, 9, 3, 1, 2, 3]], true, GRU19638), 
exec_layers([LAve78846,LRes55978,LRes79504,LLoc20409,LGRU19638],["Ave78846","Res55978","Res79504","Loc20409","GRU19638"],GRU19638,"GRU19638")

Actual (Unparsed): [[0.0000000, 0.0000000]]

Expected (Unparsed): [[5.127975821750397e-10,3.397282455352835e-14]]

Actual:   [[0, 0]]

Expected: [[0, 0]]