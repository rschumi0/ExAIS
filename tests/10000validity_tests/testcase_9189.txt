import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul40912 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Mul40912 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Sep11147 = tf.keras.layers.Input(shape=([1, 2]))
in0Con65507 = tf.keras.layers.Input(shape=([2, 4]))

Mul40912 = keras.layers.Multiply(name = 'Mul40912', )([in0Mul40912,in1Mul40912])
Res19263 = keras.layers.Reshape((2, 2, 4), name = 'Res19263', )(Mul40912)
Res9303 = keras.layers.Reshape((2, 8), name = 'Res9303', )(Res19263)
Sep11147 = keras.layers.SeparableConv1D(4, (1),strides=(1), padding='same', name = 'Sep11147', )(in0Sep11147)
Zer46007 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer46007', )(Sep11147)
Con65507 = keras.layers.Concatenate(axis=2, name = 'Con65507', )([Zer46007,in0Con65507])
Sub62971 = keras.layers.Subtract(name = 'Sub62971', )([Res9303,Con65507])
LST56317 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST56317', )(Sub62971)
Res88497 = keras.layers.Reshape((1, 1), name = 'Res88497', )(LST56317)
Sep92285 = keras.layers.SeparableConv1D(3, (1),strides=(1), padding='same', name = 'Sep92285', )(Res88497)
model = tf.keras.models.Model(inputs=[in0Mul40912,in1Mul40912,in0Sep11147,in0Con65507], outputs=Sep92285)
w = model.get_layer('Sep11147').get_weights() 
w[0] = np.array([[[0.9043], [0.8171]]])
w[1] = np.array([[[0.1861, 0.6302, 0.9937, 0.883], [0.1736, 0.3638, 0.2633, 0.251]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep11147').set_weights(w) 
w = model.get_layer('LST56317').get_weights() 
w[0] = np.array([[5, 7, 7, 5], [9, 9, 7, 3], [8, 1, 8, 9], [1, 7, 9, 4], [8, 10, 3, 9], [7, 5, 7, 5], [4, 7, 1, 7], [2, 8, 3, 2]])
w[1] = np.array([[3, 2, 3, 2]])
w[2] = np.array([10, 1, 7, 3])
model.get_layer('LST56317').set_weights(w) 
w = model.get_layer('Sep92285').get_weights() 
w[0] = np.array([[[0.5803]]])
w[1] = np.array([[[0.8135, 0.1915, 0.4915]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep92285').set_weights(w) 
in0Mul40912 = tf.constant([[[[[0.0384, 0.848], [0.1129, 0.7225]], [[0.9354, 0.4068], [0.9409, 0.4013]]], [[[0.9372, 0.7744], [0.3942, 0.6914]], [[0.6035, 0.5112], [0.4933, 0.9959]]]]])
in1Mul40912 = tf.constant([[[[[0.1638, 0.924], [0.2619, 0.4174]], [[0.653, 0.5133], [0.8684, 0.3707]]], [[[0.0521, 0.2051], [0.5278, 0.8075]], [[0.2319, 0.8186], [0.5695, 0.7898]]]]])
in0Sep11147 = tf.constant([[[0.3466, 0.2385]]])
in0Con65507 = tf.constant([[[0.1417, 0.9074, 0.8185, 0.0027], [0.8262, 0.3543, 0.3292, 0.2223]]])
print (np.array2string(model.predict([in0Mul40912,in1Mul40912,in0Sep11147,in0Con65507],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sep92285.png')

LMul40912 = multiply_layer([[[[[[0.0384, 0.848], [0.1129, 0.7225]], [[0.9354, 0.4068], [0.9409, 0.4013]]], [[[0.9372, 0.7744], [0.3942, 0.6914]], [[0.6035, 0.5112], [0.4933, 0.9959]]]]], [[[[[0.1638, 0.924], [0.2619, 0.4174]], [[0.653, 0.5133], [0.8684, 0.3707]]], [[[0.0521, 0.2051], [0.5278, 0.8075]], [[0.2319, 0.8186], [0.5695, 0.7898]]]]]], Mul40912), 
LRes19263 = reshape_layer(Mul40912, [2, 2, 4], Res19263), 
LRes9303 = reshape_layer(Res19263, [2, 8], Res9303), 
LSep11147 = separable_conv1D_layer([[[0.3466, 0.2385]]], 1,[[[[0.9043], [0.8171]]],[[[0.1861, 0.6302, 0.9937, 0.883], [0.1736, 0.3638, 0.2633, 0.251]]]],[0, 0, 0, 0], 1, true, Sep11147), 
LZer46007 = zero_padding1D_layer(Sep11147, 1, 0, Zer46007), 
LCon65507 = concatenate_layer([Zer46007,[[[0.1417, 0.9074, 0.8185, 0.0027], [0.8262, 0.3543, 0.3292, 0.2223]]]], 2, Con65507), 
LSub62971 = subtract_layer(Res9303,Con65507, Sub62971), 
LLST56317 = lstm_layer(Sub62971,[[5, 7, 7, 5], [9, 9, 7, 3], [8, 1, 8, 9], [1, 7, 9, 4], [8, 10, 3, 9], [7, 5, 7, 5], [4, 7, 1, 7], [2, 8, 3, 2]],[[3, 2, 3, 2]],[10, 1, 7, 3], LST56317), 
LRes88497 = reshape_layer(LST56317, [1, 1], Res88497), 
LSep92285 = separable_conv1D_layer(Res88497, 1,[[[[0.5803]]],[[[0.8135, 0.1915, 0.4915]]]],[0, 0, 0], 1, true, Sep92285), 
exec_layers([LMul40912,LRes19263,LRes9303,LSep11147,LZer46007,LCon65507,LSub62971,LLST56317,LRes88497,LSep92285],["Mul40912","Res19263","Res9303","Sep11147","Zer46007","Con65507","Sub62971","LST56317","Res88497","Sep92285"],Sep92285,"Sep92285")

Actual (Unparsed): [[[0.0759881, 0.0178878, 0.0459105]]]

Expected (Unparsed): [[[0.0759880932725869,0.017887793314935948,0.04591044602762934]]]

Actual:   [[[0.076, 0.0179, 0.046]]]

Expected: [[[0.076, 0.0179, 0.046]]]