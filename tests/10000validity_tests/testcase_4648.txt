import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0ReL95349 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con27794 = tf.keras.layers.Input(shape=([1, 3, 1]))
in0Add55655 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Add55655 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))

ReL95349 = keras.layers.ReLU(max_value=6.11113680697112, negative_slope=2.5745034392922297, threshold=7.7653933961006905, name = 'ReL95349', input_shape=(2, 1, 2))(in0ReL95349)
Res63843 = keras.layers.Reshape((2, 2), name = 'Res63843', )(ReL95349)
Sim87860 = keras.layers.SimpleRNN(1,name = 'Sim87860', )(Res63843)
Res99471 = keras.layers.Reshape((1, 1), name = 'Res99471', )(Sim87860)
Loc10501 = keras.layers.LocallyConnected1D(3, (1),strides=(1), name = 'Loc10501', )(Res99471)
Res89505 = keras.layers.Reshape((1, 3, 1), name = 'Res89505', )(Loc10501)
Con27794 = keras.layers.Concatenate(axis=3, name = 'Con27794', )([Res89505,in0Con27794])
Add55655 = keras.layers.Add(name = 'Add55655', )([in0Add55655,in1Add55655])
Res59767 = keras.layers.Reshape((1, 1, 2), name = 'Res59767', )(Add55655)
Up_31389 = keras.layers.UpSampling2D(size=(1, 1), name = 'Up_31389', )(Res59767)
Zer78485 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer78485', )(Up_31389)
Ave83426 = keras.layers.Average(name = 'Ave83426', )([Con27794,Zer78485])
model = tf.keras.models.Model(inputs=[in0ReL95349,in0Con27794,in0Add55655,in1Add55655], outputs=Ave83426)
w = model.get_layer('Sim87860').get_weights() 
w[0] = np.array([[4], [8]])
w[1] = np.array([[7]])
w[2] = np.array([8])
model.get_layer('Sim87860').set_weights(w) 
w = model.get_layer('Loc10501').get_weights() 
w[0] = np.array([[[0.4143, 0.1358, 0.9804]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc10501').set_weights(w) 
in0ReL95349 = tf.constant([[[[0.7032, 0.3805]], [[0.4417, 0.6061]]]])
in0Con27794 = tf.constant([[[[0.1351], [0.0179], [0.1138]]]])
in0Add55655 = tf.constant([[[[[0.6032, 0.1993]]]]])
in1Add55655 = tf.constant([[[[[0.9396, 0.1914]]]]])
print (np.array2string(model.predict([in0ReL95349,in0Con27794,in0Add55655,in1Add55655],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave83426.png')

LReL95349 = relu_layer([[[[0.7032, 0.3805]], [[0.4417, 0.6061]]]], 6.11113680697112, 2.5745034392922297, 7.7653933961006905, ReL95349), 
LRes63843 = reshape_layer(ReL95349, [2, 2], Res63843), 
LSim87860 = simple_rnn_layer(Res63843,[[4], [8]],[[7]],[8], Sim87860), 
LRes99471 = reshape_layer(Sim87860, [1, 1], Res99471), 
LLoc10501 = locally_connected1D_layer(Res99471, 1,[[[0.4143, 0.1358, 0.9804]]],[[0, 0, 0]], 1, Loc10501), 
LRes89505 = reshape_layer(Loc10501, [1, 3, 1], Res89505), 
LCon27794 = concatenate_layer([Res89505,[[[[0.1351], [0.0179], [0.1138]]]]], 3, Con27794), 
LAdd55655 = add_layer([[[[[[0.6032, 0.1993]]]]], [[[[[0.9396, 0.1914]]]]]], Add55655), 
LRes59767 = reshape_layer(Add55655, [1, 1, 2], Res59767), 
LUp_31389 = up_sampling2D_layer(Res59767, 1, 1, Up_31389), 
LZer78485 = zero_padding2D_layer(Up_31389, 0, 0, 2, 0, Zer78485), 
LAve83426 = average_layer([Con27794,Zer78485], Ave83426), 
exec_layers([LReL95349,LRes63843,LSim87860,LRes99471,LLoc10501,LRes89505,LCon27794,LAdd55655,LRes59767,LUp_31389,LZer78485,LAve83426],["ReL95349","Res63843","Sim87860","Res99471","Loc10501","Res89505","Con27794","Add55655","Res59767","Up_31389","Zer78485","Ave83426"],Ave83426,"Ave83426")

Actual (Unparsed): [[[[-0.2071500, 0.0675500], [-0.0679000, 0.0089500], [0.2812000, 0.2522500]]]]

Expected (Unparsed): [[[[-0.20715,0.06755],[-0.0679,0.00895],[0.28119999999999995,0.25225]]]]

Actual:   [[[[-0.2071, 0.0676], [-0.0679, 0.009], [0.2812, 0.2523]]]]

Expected: [[[[-0.2071, 0.0676], [-0.0679, 0.009], [0.2812, 0.2523]]]]