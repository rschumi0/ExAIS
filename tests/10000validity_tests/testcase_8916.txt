import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul19445 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Mul19445 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0ReL53490 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Min46640 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Min46640 = tf.keras.layers.Input(shape=([2, 2, 1]))

Mul19445 = keras.layers.Multiply(name = 'Mul19445', )([in0Mul19445,in1Mul19445])
Res76345 = keras.layers.Reshape((2, 2), name = 'Res76345', )(Mul19445)
ReL53490 = keras.layers.ReLU(max_value=1.0177405800835095, negative_slope=7.283480377304614, threshold=8.077210401706994, name = 'ReL53490', input_shape=(2, 1, 1, 2))(in0ReL53490)
Zer57282 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (0, 0)), name = 'Zer57282', )(ReL53490)
Min46640 = keras.layers.Minimum(name = 'Min46640', )([in0Min46640,in1Min46640])
Res22006 = keras.layers.Reshape((2, 2), name = 'Res22006', )(Min46640)
Sim66174 = keras.layers.SimpleRNN(3,name = 'Sim66174', )(Res22006)
Res36977 = keras.layers.Reshape((3, 1), name = 'Res36977', )(Sim66174)
Res11987 = keras.layers.Reshape((3, 1, 1), name = 'Res11987', )(Res36977)
Res3266 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res3266', )(Res11987)
Con66087 = keras.layers.Conv3D(2, (1, 1, 1),strides=(1, 9, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con66087', )(Res3266)
Sub87104 = keras.layers.Subtract(name = 'Sub87104', )([Zer57282,Con66087])
Res41830 = keras.layers.Reshape((3, 1, 2), name = 'Res41830', )(Sub87104)
Res58532 = keras.layers.Reshape((3, 2), name = 'Res58532', )(Res41830)
Dot94139 = keras.layers.Dot(axes=(2, 2), name = 'Dot94139', )([Res76345,Res58532])
model = tf.keras.models.Model(inputs=[in0Mul19445,in1Mul19445,in0ReL53490,in0Min46640,in1Min46640], outputs=Dot94139)
w = model.get_layer('Sim66174').get_weights() 
w[0] = np.array([[5, 2, 6], [7, 1, 9]])
w[1] = np.array([[8, 4, 7], [2, 5, 2], [2, 9, 6]])
w[2] = np.array([5, 2, 9])
model.get_layer('Sim66174').set_weights(w) 
w = model.get_layer('Con66087').get_weights() 
w[0] = np.array([[[[[0.3424, 0.8869]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con66087').set_weights(w) 
in0Mul19445 = tf.constant([[[[0.5615], [0.5191]], [[0.2324], [0.4981]]]])
in1Mul19445 = tf.constant([[[[0.9068], [0.5434]], [[0.6926], [0.8995]]]])
in0ReL53490 = tf.constant([[[[[0.8043, 0.7763]]], [[[0.1621, 0.7797]]]]])
in0Min46640 = tf.constant([[[[0.0918], [0.5453]], [[0.4802], [0.4492]]]])
in1Min46640 = tf.constant([[[[0.1705], [0.7396]], [[0.1576], [0.6419]]]])
print (np.array2string(model.predict([in0Mul19445,in1Mul19445,in0ReL53490,in0Min46640,in1Min46640],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot94139.png')

LMul19445 = multiply_layer([[[[[0.5615], [0.5191]], [[0.2324], [0.4981]]]], [[[[0.9068], [0.5434]], [[0.6926], [0.8995]]]]], Mul19445), 
LRes76345 = reshape_layer(Mul19445, [2, 2], Res76345), 
LReL53490 = relu_layer([[[[[0.8043, 0.7763]]], [[[0.1621, 0.7797]]]]], 1.0177405800835095, 7.283480377304614, 8.077210401706994, ReL53490), 
LZer57282 = zero_padding3D_layer(ReL53490, 1, 0, 0, 0, 0, 0, Zer57282), 
LMin46640 = minimum_layer([[[[[0.0918], [0.5453]], [[0.4802], [0.4492]]]], [[[[0.1705], [0.7396]], [[0.1576], [0.6419]]]]], Min46640), 
LRes22006 = reshape_layer(Min46640, [2, 2], Res22006), 
LSim66174 = simple_rnn_layer(Res22006,[[5, 2, 6], [7, 1, 9]],[[8, 4, 7], [2, 5, 2], [2, 9, 6]],[5, 2, 9], Sim66174), 
LRes36977 = reshape_layer(Sim66174, [3, 1], Res36977), 
LRes11987 = reshape_layer(Res36977, [3, 1, 1], Res11987), 
LRes3266 = reshape_layer(Res11987, [3, 1, 1, 1], Res3266), 
LCon66087 = conv3D_layer(Res3266, 1, 1, 1,[[[[[0.3424, 0.8869]]]]],[0, 0], 1, 9, 1, true, 1, 1, 1, Con66087), 
LSub87104 = subtract_layer(Zer57282,Con66087, Sub87104), 
LRes41830 = reshape_layer(Sub87104, [3, 1, 2], Res41830), 
LRes58532 = reshape_layer(Res41830, [3, 2], Res58532), 
LDot94139 = dot_layer(Res76345,Res58532, 2, 2, Dot94139), 
exec_layers([LMul19445,LRes76345,LReL53490,LZer57282,LMin46640,LRes22006,LSim66174,LRes36977,LRes11987,LRes3266,LCon66087,LSub87104,LRes41830,LRes58532,LDot94139],["Mul19445","Res76345","ReL53490","Zer57282","Min46640","Res22006","Sim66174","Res36977","Res11987","Res3266","Con66087","Sub87104","Res41830","Res58532","Dot94139"],Dot94139,"Dot94139")

Actual (Unparsed): [[[-0.4245150, -42.3960640, -44.7706881], [-0.4524803, -32.8039257, -33.5457143]]]

Expected (Unparsed): [[[-0.424515003566,-42.39606424390163,-44.77068824437086],[-0.45248030473100004,-32.803924690428794,-33.54571313041055]]]

Actual:   [[[-0.4245, -42.396, -44.7706], [-0.4524, -32.8039, -33.5457]]]

Expected: [[[-0.4245, -42.396, -44.7706], [-0.4524, -32.8039, -33.5457]]]