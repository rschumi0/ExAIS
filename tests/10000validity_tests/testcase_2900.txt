import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add22685 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Add22685 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Ave90398 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Ave90398 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Con75479 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Thr77085 = tf.keras.layers.Input(shape=([2, 1, 2]))

Add22685 = keras.layers.Add(name = 'Add22685', )([in0Add22685,in1Add22685])
Res53901 = keras.layers.Reshape((2, 2, 2), name = 'Res53901', )(Add22685)
Ave90398 = keras.layers.Average(name = 'Ave90398', )([in0Ave90398,in1Ave90398])
Glo8842 = keras.layers.GlobalAveragePooling3D(name = 'Glo8842', )(Ave90398)
Res12632 = keras.layers.Reshape((1, 1), name = 'Res12632', )(Glo8842)
Res42444 = keras.layers.Reshape((1, 1, 1), name = 'Res42444', )(Res12632)
Zer74068 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer74068', )(Res42444)
Con75479 = keras.layers.Concatenate(axis=3, name = 'Con75479', )([Zer74068,in0Con75479])
Thr77085 = keras.layers.ThresholdedReLU(theta=5.452895194254611, name = 'Thr77085', input_shape=(2, 1, 2))(in0Thr77085)
Add9745 = keras.layers.Add(name = 'Add9745', )([Con75479,Thr77085])
Zer73051 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer73051', )(Add9745)
Mul41772 = keras.layers.Multiply(name = 'Mul41772', )([Res53901,Zer73051])
Ave1678 = keras.layers.AveragePooling2D(pool_size=(2, 1), strides=(2, 1), padding='same', name = 'Ave1678', )(Mul41772)
model = tf.keras.models.Model(inputs=[in0Add22685,in1Add22685,in0Ave90398,in1Ave90398,in0Con75479,in0Thr77085], outputs=Ave1678)
in0Add22685 = tf.constant([[[[[0.7653], [0.82]], [[0.4634], [0.2792]]], [[[0.9938], [0.8317]], [[0.8944], [0.8997]]]]])
in1Add22685 = tf.constant([[[[[0.2282], [0.0216]], [[0.5184], [0.2581]]], [[[0.4092], [0.2428]], [[0.6175], [0.6003]]]]])
in0Ave90398 = tf.constant([[[[[0.1408]], [[0.9666]]]]])
in1Ave90398 = tf.constant([[[[[0.0092]], [[0.6411]]]]])
in0Con75479 = tf.constant([[[[0.2513]], [[0.1871]]]])
in0Thr77085 = tf.constant([[[[0.7321, 0.4339]], [[0.6001, 0.0905]]]])
print (np.array2string(model.predict([in0Add22685,in1Add22685,in0Ave90398,in1Ave90398,in0Con75479,in0Thr77085],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave1678.png')

LAdd22685 = add_layer([[[[[[0.7653], [0.82]], [[0.4634], [0.2792]]], [[[0.9938], [0.8317]], [[0.8944], [0.8997]]]]], [[[[[0.2282], [0.0216]], [[0.5184], [0.2581]]], [[[0.4092], [0.2428]], [[0.6175], [0.6003]]]]]], Add22685), 
LRes53901 = reshape_layer(Add22685, [2, 2, 2], Res53901), 
LAve90398 = average_layer([[[[[[0.1408]], [[0.9666]]]]], [[[[[0.0092]], [[0.6411]]]]]], Ave90398), 
LGlo8842 = global_average_pooling3D_layer(Ave90398, Glo8842), 
LRes12632 = reshape_layer(Glo8842, [1, 1], Res12632), 
LRes42444 = reshape_layer(Res12632, [1, 1, 1], Res42444), 
LZer74068 = zero_padding2D_layer(Res42444, 1, 0, 0, 0, Zer74068), 
LCon75479 = concatenate_layer([Zer74068,[[[[0.2513]], [[0.1871]]]]], 3, Con75479), 
LThr77085 = thresholded_relu_layer([[[[0.7321, 0.4339]], [[0.6001, 0.0905]]]], 5.452895194254611, Thr77085), 
LAdd9745 = add_layer([Con75479,Thr77085], Add9745), 
LZer73051 = zero_padding2D_layer(Add9745, 0, 0, 1, 0, Zer73051), 
LMul41772 = multiply_layer([Res53901,Zer73051], Mul41772), 
LAve1678 = average_pooling2D_layer(Mul41772, 2, 1, 2, 1, true, Ave1678), 
exec_layers([LAdd22685,LRes53901,LAve90398,LGlo8842,LRes12632,LRes42444,LZer74068,LCon75479,LThr77085,LAdd9745,LZer73051,LMul41772,LAve1678],["Add22685","Res53901","Ave90398","Glo8842","Res12632","Res42444","Zer74068","Con75479","Thr77085","Add9745","Zer73051","Mul41772","Ave1678"],Ave1678,"Ave1678")

Actual (Unparsed): [[[[0.0000000, 0.0000000], [0.3321833, 0.2078367]]]]

Expected (Unparsed): [[[[0.0,0.0],[0.33218332874999995,0.207836745]]]]

Actual:   [[[[0, 0], [0.3322, 0.2079]]]]

Expected: [[[[0, 0], [0.3322, 0.2079]]]]