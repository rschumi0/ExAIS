import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Lay29442 = tf.keras.layers.Input(shape=([4, 4]))
in0Ave89520 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Ave89520 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))

Lay29442 = keras.layers.LayerNormalization(axis=2, epsilon=2.522534455871359, name = 'Lay29442', )(in0Lay29442)
Res96861 = keras.layers.Reshape((4, 4, 1), name = 'Res96861', )(Lay29442)
Res80720 = keras.layers.Reshape((4, 4, 1, 1), name = 'Res80720', )(Res96861)
Zer28116 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer28116', )(Res80720)
Ave89520 = keras.layers.Average(name = 'Ave89520', )([in0Ave89520,in1Ave89520])
Zer40028 = keras.layers.ZeroPadding3D(padding=((2, 0), (3, 0), (1, 0)), name = 'Zer40028', )(Ave89520)
Ave63689 = keras.layers.Average(name = 'Ave63689', )([Zer28116,Zer40028])
Res75741 = keras.layers.Reshape((4, 4, 3), name = 'Res75741', )(Ave63689)
Loc28171 = keras.layers.LocallyConnected2D(4, (1, 4),strides=(1, 1), name = 'Loc28171', )(Res75741)
Fla66409 = keras.layers.Flatten(name = 'Fla66409', )(Loc28171)
model = tf.keras.models.Model(inputs=[in0Lay29442,in0Ave89520,in1Ave89520], outputs=Fla66409)
w = model.get_layer('Loc28171').get_weights() 
w[0] = np.array([[[0.345, 0.9449, 0.7142, 0.9033], [0.2071, 0.1783, 0.5928, 0.9357], [0.5693, 0.1088, 0.8239, 0.045], [0.7375, 0.9515, 0.0813, 0.4192], [0.365, 0.8057, 0.3798, 0.6742], [0.8522, 0.9807, 0.2291, 0.9088], [0.2584, 0.4788, 0.8704, 0.6057], [0.6143, 0.6058, 0.6247, 0.211], [0.4059, 0.5675, 0.0901, 0.0639], [0.7853, 0.9538, 0.0391, 0.8488], [0.7571, 0.2126, 0.3887, 0.8913], [0.1879, 0.572, 0.5414, 0.4314]], [[0.9897, 0.3832, 0.7292, 0.474], [0.2418, 0.5225, 0.731, 0.9357], [0.3305, 0.3199, 0.4808, 0.5887], [0.4112, 0.4597, 0.6348, 0.734], [0.6264, 0.4384, 0.1223, 0.6301], [0.5512, 0.4589, 0.0731, 0.4475], [0.2768, 0.0886, 0.2811, 0.9246], [0.3939, 0.6174, 0.5418, 0.9595], [0.8932, 0.8138, 0.7854, 0.0879], [0.6585, 0.695, 0.9146, 0.1696], [0.7973, 0.0038, 0.6532, 0.6339], [0.5281, 0.3157, 0.5133, 0.3204]], [[0.7213, 0.087, 0.1951, 0.2901], [0.4781, 0.4993, 0.35, 0.9801], [0.3246, 0.6561, 0.657, 0.7296], [0.6957, 0.5421, 0.5886, 0.0115], [0.3891, 0.1715, 0.0772, 0.6735], [0.58, 0.5167, 0.5293, 0.1107], [0.8068, 0.1374, 0.2848, 0.5732], [0.0578, 0.9102, 0.665, 0.7463], [0.7231, 0.8948, 0.2152, 0.328], [0.7077, 0.1709, 0.6113, 0.5829], [0.4491, 0.4257, 0.9671, 0.7461], [0.9262, 0.1817, 0.961, 0.7187]], [[0.0054, 0.8143, 0.2788, 0.7053], [0.6281, 0.9313, 0.3626, 0.3211], [0.4126, 0.2575, 0.3478, 0.2212], [0.2168, 0.9018, 0.3754, 0.4913], [0.0885, 0.7718, 0.1709, 0.8788], [0.8138, 0.9423, 0.9004, 0.4404], [0.9698, 0.9889, 0.8292, 0.3361], [0.9856, 0.6483, 0.2394, 0.3089], [0.2167, 0.6861, 0.395, 0.8548], [0.4566, 0.5161, 0.0805, 0.211], [0.6176, 0.9449, 0.386, 0.0668], [0.5456, 0.3927, 0.9644, 0.3376]]])
w[1] = np.array([[[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0, 0, 0, 0]]])
model.get_layer('Loc28171').set_weights(w) 
in0Lay29442 = tf.constant([[[1.8366, 1.6464, 1.1899, 1.8257], [1.0063, 1.3823, 1.7989, 1.8905], [1.3771, 1.5954, 1.8652, 1.5871], [1.9665, 1.2308, 1.4866, 1.5859]]])
in0Ave89520 = tf.constant([[[[[0.4915], [0.1175]]], [[[0.9071], [0.8701]]]]])
in1Ave89520 = tf.constant([[[[[0.6046], [0.7521]]], [[[0.2469], [0.5434]]]]])
print (np.array2string(model.predict([in0Lay29442,in0Ave89520,in1Ave89520],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Fla66409.png')

LLay29442 = layer_normalization_layer([[[1.8366, 1.6464, 1.1899, 1.8257], [1.0063, 1.3823, 1.7989, 1.8905], [1.3771, 1.5954, 1.8652, 1.5871], [1.9665, 1.2308, 1.4866, 1.5859]]], 2, 2.522534455871359, Lay29442), 
LRes96861 = reshape_layer(Lay29442, [4, 4, 1], Res96861), 
LRes80720 = reshape_layer(Res96861, [4, 4, 1, 1], Res80720), 
LZer28116 = zero_padding3D_layer(Res80720, 0, 0, 0, 0, 2, 0, Zer28116), 
LAve89520 = average_layer([[[[[[0.4915], [0.1175]]], [[[0.9071], [0.8701]]]]], [[[[[0.6046], [0.7521]]], [[[0.2469], [0.5434]]]]]], Ave89520), 
LZer40028 = zero_padding3D_layer(Ave89520, 2, 0, 3, 0, 1, 0, Zer40028), 
LAve63689 = average_layer([Zer28116,Zer40028], Ave63689), 
LRes75741 = reshape_layer(Ave63689, [4, 4, 3], Res75741), 
LLoc28171 = locally_connected2D_layer(Res75741, 1, 4,[[[0.345, 0.9449, 0.7142, 0.9033], [0.2071, 0.1783, 0.5928, 0.9357], [0.5693, 0.1088, 0.8239, 0.045], [0.7375, 0.9515, 0.0813, 0.4192], [0.365, 0.8057, 0.3798, 0.6742], [0.8522, 0.9807, 0.2291, 0.9088], [0.2584, 0.4788, 0.8704, 0.6057], [0.6143, 0.6058, 0.6247, 0.211], [0.4059, 0.5675, 0.0901, 0.0639], [0.7853, 0.9538, 0.0391, 0.8488], [0.7571, 0.2126, 0.3887, 0.8913], [0.1879, 0.572, 0.5414, 0.4314]], [[0.9897, 0.3832, 0.7292, 0.474], [0.2418, 0.5225, 0.731, 0.9357], [0.3305, 0.3199, 0.4808, 0.5887], [0.4112, 0.4597, 0.6348, 0.734], [0.6264, 0.4384, 0.1223, 0.6301], [0.5512, 0.4589, 0.0731, 0.4475], [0.2768, 0.0886, 0.2811, 0.9246], [0.3939, 0.6174, 0.5418, 0.9595], [0.8932, 0.8138, 0.7854, 0.0879], [0.6585, 0.695, 0.9146, 0.1696], [0.7973, 0.0038, 0.6532, 0.6339], [0.5281, 0.3157, 0.5133, 0.3204]], [[0.7213, 0.087, 0.1951, 0.2901], [0.4781, 0.4993, 0.35, 0.9801], [0.3246, 0.6561, 0.657, 0.7296], [0.6957, 0.5421, 0.5886, 0.0115], [0.3891, 0.1715, 0.0772, 0.6735], [0.58, 0.5167, 0.5293, 0.1107], [0.8068, 0.1374, 0.2848, 0.5732], [0.0578, 0.9102, 0.665, 0.7463], [0.7231, 0.8948, 0.2152, 0.328], [0.7077, 0.1709, 0.6113, 0.5829], [0.4491, 0.4257, 0.9671, 0.7461], [0.9262, 0.1817, 0.961, 0.7187]], [[0.0054, 0.8143, 0.2788, 0.7053], [0.6281, 0.9313, 0.3626, 0.3211], [0.4126, 0.2575, 0.3478, 0.2212], [0.2168, 0.9018, 0.3754, 0.4913], [0.0885, 0.7718, 0.1709, 0.8788], [0.8138, 0.9423, 0.9004, 0.4404], [0.9698, 0.9889, 0.8292, 0.3361], [0.9856, 0.6483, 0.2394, 0.3089], [0.2167, 0.6861, 0.395, 0.8548], [0.4566, 0.5161, 0.0805, 0.211], [0.6176, 0.9449, 0.386, 0.0668], [0.5456, 0.3927, 0.9644, 0.3376]]],[[[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0, 0, 0, 0]]], 1, 1, Loc28171), 
LFla66409 = flatten_layer(Loc28171, Fla66409), 
exec_layers([LLay29442,LRes96861,LRes80720,LZer28116,LAve89520,LZer40028,LAve63689,LRes75741,LLoc28171,LFla66409],["Lay29442","Res96861","Res80720","Zer28116","Ave89520","Zer40028","Ave63689","Res75741","Loc28171","Fla66409"],Fla66409,"Fla66409")

Actual (Unparsed): [[0.0001586, -0.0271255, 0.0774308, 0.0274134, 0.0615404, 0.0360692, 0.0470506, -0.0676383, 0.3522619, 0.1788089, 0.4367351, 0.3303005, 0.3347166, 0.3297962, 0.3967327, 0.1004142]]

Expected (Unparsed): [[0.00015864586694292783,-0.027125503318849345,0.07743085736389434,0.027413425276719736,0.06154039004699767,0.03606923514375906,0.0470505876518655,-0.06763832638035597,0.3522618847304203,0.1788088566305294,0.4367350916529654,0.33030050095350527,0.3347166025625527,0.3297961466622774,0.39673274222341876,0.10041417672755204]]

Actual:   [[0.0002, -0.0271, 0.0775, 0.0275, 0.0616, 0.0361, 0.0471, -0.0676, 0.3523, 0.1789, 0.4368, 0.3304, 0.3348, 0.3298, 0.3968, 0.1005]]

Expected: [[0.0002, -0.0271, 0.0775, 0.0275, 0.0616, 0.0361, 0.0471, -0.0676, 0.3523, 0.1789, 0.4368, 0.3304, 0.3348, 0.3298, 0.3968, 0.1005]]