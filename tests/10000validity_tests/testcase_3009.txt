import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub36925 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub36925 = tf.keras.layers.Input(shape=([3, 2]))
in0Add8031 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Add8031 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Con25139 = tf.keras.layers.Input(shape=([4]))

Sub36925 = keras.layers.Subtract(name = 'Sub36925', )([in0Sub36925,in1Sub36925])
Res7397 = keras.layers.Reshape((3, 2, 1), name = 'Res7397', )(Sub36925)
PRe84031 = keras.layers.PReLU(name = 'PRe84031', )(Res7397)
Lea55429 = keras.layers.LeakyReLU(alpha=9.68659847892501, name = 'Lea55429', )(PRe84031)
Res35009 = keras.layers.Reshape((3, 2), name = 'Res35009', )(Lea55429)
Fla18412 = keras.layers.Flatten(name = 'Fla18412', )(Res35009)
Add8031 = keras.layers.Add(name = 'Add8031', )([in0Add8031,in1Add8031])
Res81348 = keras.layers.Reshape((2, 2, 2), name = 'Res81348', )(Add8031)
Res45179 = keras.layers.Reshape((2, 4), name = 'Res45179', )(Res81348)
Sim31064 = keras.layers.SimpleRNN(2,name = 'Sim31064', )(Res45179)
Con25139 = keras.layers.Concatenate(axis=1, name = 'Con25139', )([Sim31064,in0Con25139])
Min20494 = keras.layers.Minimum(name = 'Min20494', )([Fla18412,Con25139])
model = tf.keras.models.Model(inputs=[in0Sub36925,in1Sub36925,in0Add8031,in1Add8031,in0Con25139], outputs=Min20494)
w = model.get_layer('PRe84031').get_weights() 
w[0] = np.array([[[0.688], [0.5757]], [[0.8894], [0.944]], [[0.5585], [0.5566]]])
model.get_layer('PRe84031').set_weights(w) 
w = model.get_layer('Sim31064').get_weights() 
w[0] = np.array([[5, 4], [2, 6], [1, 1], [7, 4]])
w[1] = np.array([[3, 3], [2, 3]])
w[2] = np.array([2, 8])
model.get_layer('Sim31064').set_weights(w) 
in0Sub36925 = tf.constant([[[0.5228, 0.4296], [0.6308, 0.6941], [0.3442, 0.716]]])
in1Sub36925 = tf.constant([[[0.2835, 0.2413], [0.23, 0.6626], [0.5064, 0.003]]])
in0Add8031 = tf.constant([[[[[0.7908, 0.6055]], [[0.994, 0.2751]]], [[[0.4055, 0.498]], [[0.0446, 0.6437]]]]])
in1Add8031 = tf.constant([[[[[0.6645, 0.3962]], [[0.6141, 0.6341]]], [[[0.294, 0.3898]], [[0.1183, 0.6114]]]]])
in0Con25139 = tf.constant([[0.5799, 0.3204, 0.2187, 0.853]])
print (np.array2string(model.predict([in0Sub36925,in1Sub36925,in0Add8031,in1Add8031,in0Con25139],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min20494.png')

LSub36925 = subtract_layer([[[0.5228, 0.4296], [0.6308, 0.6941], [0.3442, 0.716]]], [[[0.2835, 0.2413], [0.23, 0.6626], [0.5064, 0.003]]], Sub36925), 
LRes7397 = reshape_layer(Sub36925, [3, 2, 1], Res7397), 
LPRe84031 = prelu_layer(Res7397, [[[0.688], [0.5757]], [[0.8894], [0.944]], [[0.5585], [0.5566]]], PRe84031), 
LLea55429 = leaky_relu_layer(PRe84031, 9.68659847892501, Lea55429), 
LRes35009 = reshape_layer(Lea55429, [3, 2], Res35009), 
LFla18412 = flatten_layer(Res35009, Fla18412), 
LAdd8031 = add_layer([[[[[[0.7908, 0.6055]], [[0.994, 0.2751]]], [[[0.4055, 0.498]], [[0.0446, 0.6437]]]]], [[[[[0.6645, 0.3962]], [[0.6141, 0.6341]]], [[[0.294, 0.3898]], [[0.1183, 0.6114]]]]]], Add8031), 
LRes81348 = reshape_layer(Add8031, [2, 2, 2], Res81348), 
LRes45179 = reshape_layer(Res81348, [2, 4], Res45179), 
LSim31064 = simple_rnn_layer(Res45179,[[5, 4], [2, 6], [1, 1], [7, 4]],[[3, 3], [2, 3]],[2, 8], Sim31064), 
LCon25139 = concatenate_layer([Sim31064,[[0.5799, 0.3204, 0.2187, 0.853]]], 1, Con25139), 
LMin20494 = minimum_layer([Fla18412,Con25139], Min20494), 
exec_layers([LSub36925,LRes7397,LPRe84031,LLea55429,LRes35009,LFla18412,LAdd8031,LRes81348,LRes45179,LSim31064,LCon25139,LMin20494],["Sub36925","Res7397","PRe84031","Lea55429","Res35009","Fla18412","Add8031","Res81348","Res45179","Sim31064","Con25139","Min20494"],Min20494,"Min20494")

Actual (Unparsed): [[0.2393000, 0.1883000, 0.4008000, 0.0315000, -0.8774964, 0.7130000]]

Expected (Unparsed): [[0.23930000000000007,0.1883,0.40080000000000005,0.031500000000000083,-0.8774963636277938,0.713]]

Actual:   [[0.2393, 0.1883, 0.4008, 0.0315, -0.8774, 0.713]]

Expected: [[0.2394, 0.1883, 0.4009, 0.0316, -0.8774, 0.713]]