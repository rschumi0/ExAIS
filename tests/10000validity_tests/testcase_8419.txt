import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc39230 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con70511 = tf.keras.layers.Input(shape=([13]))
in0Dot13958 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot13958 = tf.keras.layers.Input(shape=([3, 3]))
in0Con84257 = tf.keras.layers.Input(shape=([7]))
in0Min7697 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Min7697 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Add47163 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Add47163 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Sub38673 = tf.keras.layers.Input(shape=([3]))
in1Sub38673 = tf.keras.layers.Input(shape=([3]))
in0Con18834 = tf.keras.layers.Input(shape=([13]))

Loc39230 = keras.layers.LocallyConnected2D(3, (1, 2),strides=(4, 1), name = 'Loc39230', )(in0Loc39230)
Res52625 = keras.layers.Reshape((1, 3), name = 'Res52625', )(Loc39230)
Fla80001 = keras.layers.Flatten(name = 'Fla80001', )(Res52625)
Con70511 = keras.layers.Concatenate(axis=1, name = 'Con70511', )([Fla80001,in0Con70511])
Dot13958 = keras.layers.Dot(axes=(1, 1), name = 'Dot13958', )([in0Dot13958,in1Dot13958])
Fla45731 = keras.layers.Flatten(name = 'Fla45731', )(Dot13958)
Con84257 = keras.layers.Concatenate(axis=1, name = 'Con84257', )([Fla45731,in0Con84257])
Min7697 = keras.layers.Minimum(name = 'Min7697', )([in0Min7697,in1Min7697])
Res88231 = keras.layers.Reshape((2, 1, 2), name = 'Res88231', )(Min7697)
Res75729 = keras.layers.Reshape((2, 2), name = 'Res75729', )(Res88231)
Zer54143 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer54143', )(Res75729)
Add47163 = keras.layers.Add(name = 'Add47163', )([in0Add47163,in1Add47163])
Con2717 = keras.layers.Conv3DTranspose(2, (2, 1, 2),strides=(1, 1, 2), padding='valid', name = 'Con2717', )(Add47163)
Res87734 = keras.layers.Reshape((3, 1, 8), name = 'Res87734', )(Con2717)
Res93433 = keras.layers.Reshape((3, 8), name = 'Res93433', )(Res87734)
Dot28241 = keras.layers.Dot(axes=(1, 1), name = 'Dot28241', )([Zer54143,Res93433])
Fla99190 = keras.layers.Flatten(name = 'Fla99190', )(Dot28241)
Sub38673 = keras.layers.Subtract(name = 'Sub38673', )([in0Sub38673,in1Sub38673])
Con18834 = keras.layers.Concatenate(axis=1, name = 'Con18834', )([Sub38673,in0Con18834])
Sub21575 = keras.layers.Subtract(name = 'Sub21575', )([Fla99190,Con18834])
Add24492 = keras.layers.Add(name = 'Add24492', )([Con84257,Sub21575])
Ave74729 = keras.layers.Average(name = 'Ave74729', )([Con70511,Add24492])
model = tf.keras.models.Model(inputs=[in0Loc39230,in0Con70511,in0Dot13958,in1Dot13958,in0Con84257,in0Min7697,in1Min7697,in0Add47163,in1Add47163,in0Sub38673,in1Sub38673,in0Con18834], outputs=Ave74729)
w = model.get_layer('Loc39230').get_weights() 
w[0] = np.array([[[0.1181, 0.9269, 0.5369], [0.725, 0.188, 0.5931]]])
w[1] = np.array([[[0, 0, 0]]])
model.get_layer('Loc39230').set_weights(w) 
w = model.get_layer('Con2717').get_weights() 
w[0] = np.array([[[[[0.8236], [0.5356]], [[0.0983], [0.8768]]]], [[[[0.6175], [0.7553]], [[0.7202], [0.1916]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con2717').set_weights(w) 
in0Loc39230 = tf.constant([[[[0.0533], [0.1762]], [[0.0247], [0.0935]]]])
in0Con70511 = tf.constant([[0.9196, 0.2045, 0.3573, 0.6797, 0.936, 0.5098, 0.8213, 0.2868, 0.2448, 0.5831, 0.1938, 0.8117, 0.9877]])
in0Dot13958 = tf.constant([[[0.2066, 0.6828, 0.3322], [0.1103, 0.1602, 0.9174], [0.8847, 0.5387, 0.294]]])
in1Dot13958 = tf.constant([[[0.6447, 0.6745, 0.5299], [0.616, 0.4018, 0.9908], [0.6981, 0.4177, 0.7914]]])
in0Con84257 = tf.constant([[0.9549, 0.0689, 0.34, 0.9714, 0.5081, 0.1182, 0.4916]])
in0Min7697 = tf.constant([[[[[0.7142], [0.8444]]], [[[0.9443], [0.5066]]]]])
in1Min7697 = tf.constant([[[[[0.1973], [0.3357]]], [[[0.7167], [0.6758]]]]])
in0Add47163 = tf.constant([[[[[0.2385], [0.4926]]], [[[0.7065], [0.7782]]]]])
in1Add47163 = tf.constant([[[[[0.9875], [0.3955]]], [[[0.9076], [0.0811]]]]])
in0Sub38673 = tf.constant([[0.2303, 0.1054, 0.9776]])
in1Sub38673 = tf.constant([[0.2736, 0.3935, 0.4125]])
in0Con18834 = tf.constant([[0.8977, 0.5466, 0.5891, 0.1644, 0.4304, 0.4881, 0.8777, 0.9568, 0.8302, 0.3807, 0.1599, 0.1724, 0.6456]])
print (np.array2string(model.predict([in0Loc39230,in0Con70511,in0Dot13958,in1Dot13958,in0Con84257,in0Min7697,in1Min7697,in0Add47163,in1Add47163,in0Sub38673,in1Sub38673,in0Con18834],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave74729.png')

LLoc39230 = locally_connected2D_layer([[[[0.0533], [0.1762]], [[0.0247], [0.0935]]]], 1, 2,[[[0.1181, 0.9269, 0.5369], [0.725, 0.188, 0.5931]]],[[[0, 0, 0]]], 4, 1, Loc39230), 
LRes52625 = reshape_layer(Loc39230, [1, 3], Res52625), 
LFla80001 = flatten_layer(Res52625, Fla80001), 
LCon70511 = concatenate_layer([Fla80001,[[0.9196, 0.2045, 0.3573, 0.6797, 0.936, 0.5098, 0.8213, 0.2868, 0.2448, 0.5831, 0.1938, 0.8117, 0.9877]]], 1, Con70511), 
LDot13958 = dot_layer([[[0.2066, 0.6828, 0.3322], [0.1103, 0.1602, 0.9174], [0.8847, 0.5387, 0.294]]], [[[0.6447, 0.6745, 0.5299], [0.616, 0.4018, 0.9908], [0.6981, 0.4177, 0.7914]]], 1, 1, Dot13958), 
LFla45731 = flatten_layer(Dot13958, Fla45731), 
LCon84257 = concatenate_layer([Fla45731,[[0.9549, 0.0689, 0.34, 0.9714, 0.5081, 0.1182, 0.4916]]], 1, Con84257), 
LMin7697 = minimum_layer([[[[[[0.7142], [0.8444]]], [[[0.9443], [0.5066]]]]], [[[[[0.1973], [0.3357]]], [[[0.7167], [0.6758]]]]]], Min7697), 
LRes88231 = reshape_layer(Min7697, [2, 1, 2], Res88231), 
LRes75729 = reshape_layer(Res88231, [2, 2], Res75729), 
LZer54143 = zero_padding1D_layer(Res75729, 1, 0, Zer54143), 
LAdd47163 = add_layer([[[[[[0.2385], [0.4926]]], [[[0.7065], [0.7782]]]]], [[[[[0.9875], [0.3955]]], [[[0.9076], [0.0811]]]]]], Add47163), 
LCon2717 = conv3D_transpose_layer(Add47163, 2, 1, 2,[[[[[0.8236], [0.5356]], [[0.0983], [0.8768]]]], [[[[0.6175], [0.7553]], [[0.7202], [0.1916]]]]],[0, 0], 1, 1, 2, false, Con2717), 
LRes87734 = reshape_layer(Con2717, [3, 1, 8], Res87734), 
LRes93433 = reshape_layer(Res87734, [3, 8], Res93433), 
LDot28241 = dot_layer(Zer54143,Res93433, 1, 1, Dot28241), 
LFla99190 = flatten_layer(Dot28241, Fla99190), 
LSub38673 = subtract_layer([[0.2303, 0.1054, 0.9776]], [[0.2736, 0.3935, 0.4125]], Sub38673), 
LCon18834 = concatenate_layer([Sub38673,[[0.8977, 0.5466, 0.5891, 0.1644, 0.4304, 0.4881, 0.8777, 0.9568, 0.8302, 0.3807, 0.1599, 0.1724, 0.6456]]], 1, Con18834), 
LSub21575 = subtract_layer(Fla99190,Con18834, Sub21575), 
LAdd24492 = add_layer([Con84257,Sub21575], Add24492), 
LAve74729 = average_layer([Con70511,Add24492], Ave74729), 
exec_layers([LLoc39230,LRes52625,LFla80001,LCon70511,LDot13958,LFla45731,LCon84257,LMin7697,LRes88231,LRes75729,LZer54143,LAdd47163,LCon2717,LRes87734,LRes93433,LDot28241,LFla99190,LSub38673,LCon18834,LSub21575,LAdd24492,LAve74729],["Loc39230","Res52625","Fla80001","Con70511","Dot13958","Fla45731","Con84257","Min7697","Res88231","Res75729","Zer54143","Add47163","Con2717","Res87734","Res93433","Dot28241","Fla99190","Sub38673","Con18834","Sub21575","Add24492","Ave74729"],Ave74729,"Ave74729")

Actual (Unparsed): [[1.0610403, 1.0754283, 0.7627974, 0.7420360, 0.5179792, 0.7016896, 1.0431162, 0.7606540, 1.2723549, 1.0585927, 0.1687427, 0.2326127, 0.9321455, 0.6252413, 0.6570459, 0.6135791]]

Expected (Unparsed): [[1.0610402723865002,1.0754283265695,0.7627973475865,0.7420360479779999,0.517979205052,0.7016895960080001,1.0431162422375,0.7606539955280001,1.272354869291,1.0585926238249999,0.1687426738615,0.232612704116,0.9321454245305,0.6252413313855,0.6570458571965,0.613579074674]]

Actual:   [[1.0611, 1.0755, 0.7628, 0.7421, 0.518, 0.7017, 1.0432, 0.7607, 1.2724, 1.0586, 0.1688, 0.2327, 0.9322, 0.6253, 0.6571, 0.6136]]

Expected: [[1.0611, 1.0755, 0.7628, 0.7421, 0.518, 0.7017, 1.0432, 0.7607, 1.2724, 1.0586, 0.1688, 0.2327, 0.9322, 0.6253, 0.6571, 0.6136]]