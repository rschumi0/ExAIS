import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul12149 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Mul12149 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Con61636 = tf.keras.layers.Input(shape=([3]))
in0Fla67475 = tf.keras.layers.Input(shape=([1, 1, 4]))
in0Sub22343 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub22343 = tf.keras.layers.Input(shape=([2, 3]))
in0Con12731 = tf.keras.layers.Input(shape=([4, 1]))

Mul12149 = keras.layers.Multiply(name = 'Mul12149', )([in0Mul12149,in1Mul12149])
Res75922 = keras.layers.Reshape((2, 1, 1), name = 'Res75922', )(Mul12149)
Res34340 = keras.layers.Reshape((2, 1), name = 'Res34340', )(Res75922)
Max70636 = keras.layers.MaxPool1D(pool_size=(1), strides=(2), padding='valid', name = 'Max70636', )(Res34340)
Res39139 = keras.layers.Reshape((1, 1, 1), name = 'Res39139', )(Max70636)
Res63832 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res63832', )(Res39139)
Cro56725 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro56725', )(Res63832)
Res15346 = keras.layers.Reshape((1, 1, 1), name = 'Res15346', )(Cro56725)
Res3108 = keras.layers.Reshape((1, 1), name = 'Res3108', )(Res15346)
Fla85281 = keras.layers.Flatten(name = 'Fla85281', )(Res3108)
Con61636 = keras.layers.Concatenate(axis=1, name = 'Con61636', )([Fla85281,in0Con61636])
Fla67475 = keras.layers.Flatten(name = 'Fla67475', )(in0Fla67475)
Res58273 = keras.layers.Reshape((4, 1), name = 'Res58273', )(Fla67475)
Res98363 = keras.layers.Reshape((4, 1, 1), name = 'Res98363', )(Res58273)
Res25070 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res25070', )(Res98363)
Con58681 = keras.layers.Conv3DTranspose(4, (4, 1, 1),strides=(1, 1, 1), padding='same', name = 'Con58681', )(Res25070)
Res60851 = keras.layers.Reshape((4, 1, 4), name = 'Res60851', )(Con58681)
Res6025 = keras.layers.Reshape((4, 4), name = 'Res6025', )(Res60851)
Sub22343 = keras.layers.Subtract(name = 'Sub22343', )([in0Sub22343,in1Sub22343])
Zer36412 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer36412', )(Sub22343)
Con12731 = keras.layers.Concatenate(axis=2, name = 'Con12731', )([Zer36412,in0Con12731])
Mul97982 = keras.layers.Multiply(name = 'Mul97982', )([Res6025,Con12731])
Glo41577 = keras.layers.GlobalAveragePooling1D(name = 'Glo41577', )(Mul97982)
Mul26436 = keras.layers.Multiply(name = 'Mul26436', )([Con61636,Glo41577])
model = tf.keras.models.Model(inputs=[in0Mul12149,in1Mul12149,in0Con61636,in0Fla67475,in0Sub22343,in1Sub22343,in0Con12731], outputs=Mul26436)
w = model.get_layer('Con58681').get_weights() 
w[0] = np.array([[[[[0.679], [0.3228], [0.2159], [0.3559]]]], [[[[0.5442], [0.1702], [0.4682], [0.052]]]], [[[[0.5388], [0.8592], [0.7883], [0.9499]]]], [[[[0.1181], [0.4287], [0.7021], [0.8628]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con58681').set_weights(w) 
in0Mul12149 = tf.constant([[[[[0.693]]], [[[0.1654]]]]])
in1Mul12149 = tf.constant([[[[[0.9742]]], [[[0.5187]]]]])
in0Con61636 = tf.constant([[0.8781, 0.4984, 0.5095]])
in0Fla67475 = tf.constant([[[[1.9608, 1.6752, 1.2173, 1.5531]]]])
in0Sub22343 = tf.constant([[[0.1343, 0.0862, 0.5866], [0.6838, 0.3488, 0.1509]]])
in1Sub22343 = tf.constant([[[0.5525, 0.851, 0.4649], [0.9592, 0.5871, 0.0068]]])
in0Con12731 = tf.constant([[[0.6508], [0.2022], [0.3076], [0.3183]]])
print (np.array2string(model.predict([in0Mul12149,in1Mul12149,in0Con61636,in0Fla67475,in0Sub22343,in1Sub22343,in0Con12731],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul26436.png')

LMul12149 = multiply_layer([[[[[[0.693]]], [[[0.1654]]]]], [[[[[0.9742]]], [[[0.5187]]]]]], Mul12149), 
LRes75922 = reshape_layer(Mul12149, [2, 1, 1], Res75922), 
LRes34340 = reshape_layer(Res75922, [2, 1], Res34340), 
LMax70636 = max_pool1D_layer(Res34340, 1, 2, false, Max70636), 
LRes39139 = reshape_layer(Max70636, [1, 1, 1], Res39139), 
LRes63832 = reshape_layer(Res39139, [1, 1, 1, 1], Res63832), 
LCro56725 = cropping3D_layer(Res63832, 0, 0, 0, 0, 0, 0, Cro56725), 
LRes15346 = reshape_layer(Cro56725, [1, 1, 1], Res15346), 
LRes3108 = reshape_layer(Res15346, [1, 1], Res3108), 
LFla85281 = flatten_layer(Res3108, Fla85281), 
LCon61636 = concatenate_layer([Fla85281,[[0.8781, 0.4984, 0.5095]]], 1, Con61636), 
LFla67475 = flatten_layer([[[[1.9608, 1.6752, 1.2173, 1.5531]]]], Fla67475), 
LRes58273 = reshape_layer(Fla67475, [4, 1], Res58273), 
LRes98363 = reshape_layer(Res58273, [4, 1, 1], Res98363), 
LRes25070 = reshape_layer(Res98363, [4, 1, 1, 1], Res25070), 
LCon58681 = conv3D_transpose_layer(Res25070, 4, 1, 1,[[[[[0.679], [0.3228], [0.2159], [0.3559]]]], [[[[0.5442], [0.1702], [0.4682], [0.052]]]], [[[[0.5388], [0.8592], [0.7883], [0.9499]]]], [[[[0.1181], [0.4287], [0.7021], [0.8628]]]]],[0, 0, 0, 0], 1, 1, 1, true, Con58681), 
LRes60851 = reshape_layer(Con58681, [4, 1, 4], Res60851), 
LRes6025 = reshape_layer(Res60851, [4, 4], Res6025), 
LSub22343 = subtract_layer([[[0.1343, 0.0862, 0.5866], [0.6838, 0.3488, 0.1509]]], [[[0.5525, 0.851, 0.4649], [0.9592, 0.5871, 0.0068]]], Sub22343), 
LZer36412 = zero_padding1D_layer(Sub22343, 2, 0, Zer36412), 
LCon12731 = concatenate_layer([Zer36412,[[[0.6508], [0.2022], [0.3076], [0.3183]]]], 2, Con12731), 
LMul97982 = multiply_layer([Res6025,Con12731], Mul97982), 
LGlo41577 = global_average_pooling1D_layer(Mul97982, Glo41577), 
LMul26436 = multiply_layer([Con61636,Glo41577], Mul26436), 
exec_layers([LMul12149,LRes75922,LRes34340,LMax70636,LRes39139,LRes63832,LCro56725,LRes15346,LRes3108,LFla85281,LCon61636,LFla67475,LRes58273,LRes98363,LRes25070,LCon58681,LRes60851,LRes6025,LSub22343,LZer36412,LCon12731,LMul97982,LGlo41577,LMul26436],["Mul12149","Res75922","Res34340","Max70636","Res39139","Res63832","Cro56725","Res15346","Res3108","Fla85281","Con61636","Fla67475","Res58273","Res98363","Res25070","Con58681","Res60851","Res6025","Sub22343","Zer36412","Con12731","Mul97982","Glo41577","Mul26436"],Mul26436,"Mul26436")

Actual (Unparsed): [[-0.2802164, -0.6078506, 0.1060308, 0.3807714]]

Expected (Unparsed): [[-0.2802163922398644,-0.607850624575133,0.10603081275758164,0.38077139687599665]]

Actual:   [[-0.2802, -0.6078, 0.1061, 0.3808]]

Expected: [[-0.2802, -0.6078, 0.1061, 0.3808]]