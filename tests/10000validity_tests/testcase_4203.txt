import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con18942 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Mul41899 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul41899 = tf.keras.layers.Input(shape=([2, 1]))
in0Con95302 = tf.keras.layers.Input(shape=([2, 3]))

Con18942 = keras.layers.Conv2D(4, (1, 2),strides=(1, 2), padding='valid', dilation_rate=(1, 1), name = 'Con18942', )(in0Con18942)
Res37723 = keras.layers.Reshape((2, 4), name = 'Res37723', )(Con18942)
Mul41899 = keras.layers.Multiply(name = 'Mul41899', )([in0Mul41899,in1Mul41899])
Con95302 = keras.layers.Concatenate(axis=2, name = 'Con95302', )([Mul41899,in0Con95302])
Ave37790 = keras.layers.Average(name = 'Ave37790', )([Res37723,Con95302])
Res11010 = keras.layers.Reshape((2, 4, 1), name = 'Res11010', )(Ave37790)
Loc57339 = keras.layers.LocallyConnected2D(4, (1, 1),strides=(1, 1), name = 'Loc57339', )(Res11010)
Res44233 = keras.layers.Reshape((2, 4, 4, 1), name = 'Res44233', )(Loc57339)
Zer45398 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer45398', )(Res44233)
model = tf.keras.models.Model(inputs=[in0Con18942,in0Mul41899,in1Mul41899,in0Con95302], outputs=Zer45398)
w = model.get_layer('Con18942').get_weights() 
w[0] = np.array([[[[0.9618, 0.1967, 0.2803, 0.5517], [0.262, 0.3487, 0.9174, 0.782]], [[0.9017, 0.4604, 0.0902, 0.0894], [0.3665, 0.5377, 0.5099, 0.1094]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con18942').set_weights(w) 
w = model.get_layer('Loc57339').get_weights() 
w[0] = np.array([[[0.4463, 0.2499, 0.9801, 0.7041]], [[0.3845, 0.0484, 0.1628, 0.3365]], [[0.0457, 0.8998, 0.7456, 0.8525]], [[0.848, 0.9548, 0.767, 0.1606]], [[0.3116, 0.566, 0.0296, 0.7255]], [[0.8794, 0.2085, 0.8517, 0.4171]], [[0.2229, 0.6735, 0.1177, 0.2636]], [[0.8276, 0.8799, 0.8521, 0.8716]]])
w[1] = np.array([[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]])
model.get_layer('Loc57339').set_weights(w) 
in0Con18942 = tf.constant([[[[0.6775, 0.4912], [0.8758, 0.6756]], [[0.4594, 0.618], [0.6825, 0.704]]]])
in0Mul41899 = tf.constant([[[0.2316], [0.0476]]])
in1Mul41899 = tf.constant([[[0.3177], [0.5293]]])
in0Con95302 = tf.constant([[[0.7614, 0.0531, 0.403], [0.2559, 0.9671, 0.7247]]])
print (np.array2string(model.predict([in0Con18942,in0Mul41899,in1Mul41899,in0Con95302],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Zer45398.png')

LCon18942 = conv2D_layer([[[[0.6775, 0.4912], [0.8758, 0.6756]], [[0.4594, 0.618], [0.6825, 0.704]]]], 1, 2,[[[[0.9618, 0.1967, 0.2803, 0.5517], [0.262, 0.3487, 0.9174, 0.782]], [[0.9017, 0.4604, 0.0902, 0.0894], [0.3665, 0.5377, 0.5099, 0.1094]]]],[0, 0, 0, 0], 1, 2, false, 1, 1, Con18942), 
LRes37723 = reshape_layer(Con18942, [2, 4], Res37723), 
LMul41899 = multiply_layer([[[[0.2316], [0.0476]]], [[[0.3177], [0.5293]]]], Mul41899), 
LCon95302 = concatenate_layer([Mul41899,[[[0.7614, 0.0531, 0.403], [0.2559, 0.9671, 0.7247]]]], 2, Con95302), 
LAve37790 = average_layer([Res37723,Con95302], Ave37790), 
LRes11010 = reshape_layer(Ave37790, [2, 4, 1], Res11010), 
LLoc57339 = locally_connected2D_layer(Res11010, 1, 1,[[[0.4463, 0.2499, 0.9801, 0.7041]], [[0.3845, 0.0484, 0.1628, 0.3365]], [[0.0457, 0.8998, 0.7456, 0.8525]], [[0.848, 0.9548, 0.767, 0.1606]], [[0.3116, 0.566, 0.0296, 0.7255]], [[0.8794, 0.2085, 0.8517, 0.4171]], [[0.2229, 0.6735, 0.1177, 0.2636]], [[0.8276, 0.8799, 0.8521, 0.8716]]],[[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]], 1, 1, Loc57339), 
LRes44233 = reshape_layer(Loc57339, [2, 4, 4, 1], Res44233), 
LZer45398 = zero_padding3D_layer(Res44233, 1, 1, 1, 1, 1, 1, Zer45398), 
exec_layers([LCon18942,LRes37723,LMul41899,LCon95302,LAve37790,LRes11010,LLoc57339,LRes44233,LZer45398],["Con18942","Res37723","Mul41899","Con95302","Ave37790","Res11010","Loc57339","Res44233","Zer45398"],Zer45398,"Zer45398")

Actual (Unparsed): [[[[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.4220234], [0.2363066], [0.9267872], [0.6658003], [0.0000000]], [[0.0000000], [0.3522855], [0.0443449], [0.1491601], [0.3083070], [0.0000000]], [[0.0000000], [0.0255261], [0.5025904], [0.4164607], [0.4761706], [0.0000000]], [[0.0000000], [0.5567554], [0.6268750], [0.5035747], [0.1054421], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.2340720], [0.4251758], [0.0222353], [0.5449912], [0.0000000]], [[0.0000000], [0.5516144], [0.1307842], [0.5342392], [0.2616311], [0.0000000]], [[0.0000000], [0.2321898], [0.7015695], [0.1226054], [0.2745861], [0.0000000]], [[0.0000000], [0.6618566], [0.7036824], [0.6814499], [0.6970447], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]]]]]

Expected (Unparsed): [[[[[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0]]],[[[0],[0],[0],[0],[0],[0]],[[0],[0.42202339546199996],[0.236306624526],[0.926787205674],[0.6658002974339999],[0]],[[0],[0.35228546149249995],[0.04434490594599999],[0.14916013818199997],[0.3083070423725],[0]],[[0],[0.025526094430499996],[0.502590366927],[0.416460744144],[0.47617057991249995],[0]],[[0],[0.55675537944],[0.6268750427940001],[0.503574735885],[0.105442115493],[0]],[[0],[0],[0],[0],[0],[0]]],[[[0],[0],[0],[0],[0],[0]],[[0],[0.23407202702999996],[0.4251757615499999],[0.02223534018],[0.5449911925875],[0]],[[0],[0.5516143698859999],[0.13078416661499997],[0.534239207223],[0.261631059449],[0]],[[0],[0.23218981667399996],[0.7015694999099998],[0.12260538996199997],[0.27458607301599997],[0]],[[0],[0.661856581104],[0.7036824621960001],[0.681449967084],[0.6970447028640001],[0]],[[0],[0],[0],[0],[0],[0]]],[[[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0]]]]]

Actual:   [[[[[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]]], [[[0], [0], [0], [0], [0], [0]], [[0], [0.4221], [0.2364], [0.9268], [0.6659], [0]], [[0], [0.3523], [0.0444], [0.1492], [0.3084], [0]], [[0], [0.0256], [0.5026], [0.4165], [0.4762], [0]], [[0], [0.5568], [0.6269], [0.5036], [0.1055], [0]], [[0], [0], [0], [0], [0], [0]]], [[[0], [0], [0], [0], [0], [0]], [[0], [0.2341], [0.4252], [0.0223], [0.545], [0]], [[0], [0.5517], [0.1308], [0.5343], [0.2617], [0]], [[0], [0.2322], [0.7016], [0.1227], [0.2746], [0]], [[0], [0.6619], [0.7037], [0.6815], [0.6971], [0]], [[0], [0], [0], [0], [0], [0]]], [[[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]]]]]

Expected: [[[[[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]]], [[[0], [0], [0], [0], [0], [0]], [[0], [0.4221], [0.2364], [0.9268], [0.6659], [0]], [[0], [0.3523], [0.0444], [0.1492], [0.3084], [0]], [[0], [0.0256], [0.5026], [0.4165], [0.4762], [0]], [[0], [0.5568], [0.6269], [0.5036], [0.1055], [0]], [[0], [0], [0], [0], [0], [0]]], [[[0], [0], [0], [0], [0], [0]], [[0], [0.2341], [0.4252], [0.0223], [0.545], [0]], [[0], [0.5517], [0.1308], [0.5343], [0.2617], [0]], [[0], [0.2322], [0.7016], [0.1227], [0.2746], [0]], [[0], [0.6619], [0.7037], [0.6815], [0.6971], [0]], [[0], [0], [0], [0], [0], [0]]], [[[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]]]]]