import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con80254 = tf.keras.layers.Input(shape=([2, 2]))
in0Dot13100 = tf.keras.layers.Input(shape=([3]))
in1Dot13100 = tf.keras.layers.Input(shape=([3]))
in0Con37209 = tf.keras.layers.Input(shape=([3]))
in0Con91100 = tf.keras.layers.Input(shape=([4, 5]))
in0Sub73381 = tf.keras.layers.Input(shape=([3, 2, 3]))
in1Sub73381 = tf.keras.layers.Input(shape=([3, 2, 3]))

Con80254 = keras.layers.Conv1D(2, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con80254', )(in0Con80254)
Fla55861 = keras.layers.Flatten(name = 'Fla55861', )(Con80254)
Dot13100 = keras.layers.Dot(axes=(1, 1), name = 'Dot13100', )([in0Dot13100,in1Dot13100])
Con37209 = keras.layers.Concatenate(axis=1, name = 'Con37209', )([Dot13100,in0Con37209])
Ave91493 = keras.layers.Average(name = 'Ave91493', )([Fla55861,Con37209])
Res6865 = keras.layers.Reshape((4, 1), name = 'Res6865', )(Ave91493)
Con91100 = keras.layers.Concatenate(axis=2, name = 'Con91100', )([Res6865,in0Con91100])
Sub73381 = keras.layers.Subtract(name = 'Sub73381', )([in0Sub73381,in1Sub73381])
Res39553 = keras.layers.Reshape((3, 6), name = 'Res39553', )(Sub73381)
Dot54184 = keras.layers.Dot(axes=(2, 2), name = 'Dot54184', )([Con91100,Res39553])
model = tf.keras.models.Model(inputs=[in0Con80254,in0Dot13100,in1Dot13100,in0Con37209,in0Con91100,in0Sub73381,in1Sub73381], outputs=Dot54184)
w = model.get_layer('Con80254').get_weights() 
w[0] = np.array([[[0.9203, 0.9043], [0.884, 0.5506]]])
w[1] = np.array([0, 0])
model.get_layer('Con80254').set_weights(w) 
in0Con80254 = tf.constant([[[0.9401, 0.8737], [0.8731, 0.5718]]])
in0Dot13100 = tf.constant([[0.0799, 0.6966, 0.0349]])
in1Dot13100 = tf.constant([[0.4278, 0.2595, 0.6164]])
in0Con37209 = tf.constant([[0.6782, 0.2946, 0.7877]])
in0Con91100 = tf.constant([[[0.6982, 0.1669, 0.7515, 0.4341, 0.0292], [0.9757, 0.1417, 0.3154, 0.0634, 0.7931], [0.5548, 0.0549, 0.4563, 0.89, 0.4336], [0.5217, 0.9239, 0.3826, 0.0063, 0.6555]]])
in0Sub73381 = tf.constant([[[[0.0895, 0.1499, 0.087], [0.3719, 0.0846, 0.8693]], [[0.3073, 0.4503, 0.7772], [0.8931, 0.1482, 0.3302]], [[0.014, 0.7734, 0.5041], [0.8497, 0.9281, 0.9123]]]])
in1Sub73381 = tf.constant([[[[0.2977, 0.1598, 0.5905], [0.6373, 0.5847, 0.1215]], [[0.3697, 0.0934, 0.2304], [0.6721, 0.4042, 0.4821]], [[0.27, 0.6453, 0.2736], [0.1522, 0.3929, 0.7607]]]])
print (np.array2string(model.predict([in0Con80254,in0Dot13100,in1Dot13100,in0Con37209,in0Con91100,in0Sub73381,in1Sub73381],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot54184.png')

LCon80254 = conv1D_layer([[[0.9401, 0.8737], [0.8731, 0.5718]]], 1,[[[0.9203, 0.9043], [0.884, 0.5506]]],[0, 0], 1, true, 1, Con80254), 
LFla55861 = flatten_layer(Con80254, Fla55861), 
LDot13100 = dot_layer([[0.0799, 0.6966, 0.0349]], [[0.4278, 0.2595, 0.6164]], 1, 1, Dot13100), 
LCon37209 = concatenate_layer([Dot13100,[[0.6782, 0.2946, 0.7877]]], 1, Con37209), 
LAve91493 = average_layer([Fla55861,Con37209], Ave91493), 
LRes6865 = reshape_layer(Ave91493, [4, 1], Res6865), 
LCon91100 = concatenate_layer([Res6865,[[[0.6982, 0.1669, 0.7515, 0.4341, 0.0292], [0.9757, 0.1417, 0.3154, 0.0634, 0.7931], [0.5548, 0.0549, 0.4563, 0.89, 0.4336], [0.5217, 0.9239, 0.3826, 0.0063, 0.6555]]]], 2, Con91100), 
LSub73381 = subtract_layer([[[[0.0895, 0.1499, 0.087], [0.3719, 0.0846, 0.8693]], [[0.3073, 0.4503, 0.7772], [0.8931, 0.1482, 0.3302]], [[0.014, 0.7734, 0.5041], [0.8497, 0.9281, 0.9123]]]], [[[[0.2977, 0.1598, 0.5905], [0.6373, 0.5847, 0.1215]], [[0.3697, 0.0934, 0.2304], [0.6721, 0.4042, 0.4821]], [[0.27, 0.6453, 0.2736], [0.1522, 0.3929, 0.7607]]]], Sub73381), 
LRes39553 = reshape_layer(Sub73381, [3, 6], Res39553), 
LDot54184 = dot_layer(Con91100,Res39553, 2, 2, Dot54184), 
exec_layers([LCon80254,LFla55861,LDot13100,LCon37209,LAve91493,LRes6865,LCon91100,LSub73381,LRes39553,LDot54184],["Con80254","Fla55861","Dot13100","Con37209","Ave91493","Res6865","Con91100","Sub73381","Res39553","Dot54184"],Dot54184,"Dot54184")

Actual (Unparsed): [[[-0.6807340, 0.3324966, 0.6489679], [0.1874836, 0.2960170, 0.2746041], [-0.4420128, -0.0148660, 0.7387964], [-0.2818235, 0.6157218, 0.4072119]]]

Expected (Unparsed): [[[-0.680734034051,0.332496553368,0.64896793792],[0.18748362923500006,0.2960169805200001,0.2746040287999999],[-0.44201282203299996,-0.01486595605600001,0.7387964433599999],[-0.28182350838100023,0.6157217848080001,0.4072118715199999]]]

Actual:   [[[-0.6807, 0.3325, 0.649], [0.1875, 0.2961, 0.2747], [-0.442, -0.0148, 0.7388], [-0.2818, 0.6158, 0.4073]]]

Expected: [[[-0.6807, 0.3325, 0.649], [0.1875, 0.2961, 0.2747], [-0.442, -0.0148, 0.7388], [-0.2818, 0.6158, 0.4073]]]