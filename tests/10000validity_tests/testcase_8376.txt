import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub42492 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub42492 = tf.keras.layers.Input(shape=([3, 2]))
in0Con11748 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0GRU68734 = tf.keras.layers.Input(shape=([3, 2]))
in0Con3278 = tf.keras.layers.Input(shape=([1]))
in0Con34970 = tf.keras.layers.Input(shape=([5]))

Sub42492 = keras.layers.Subtract(name = 'Sub42492', )([in0Sub42492,in1Sub42492])
Fla67594 = keras.layers.Flatten(name = 'Fla67594', )(Sub42492)
Con11748 = keras.layers.Conv2D(2, (1, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con11748', )(in0Con11748)
Max8535 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 1), padding='same', name = 'Max8535', )(Con11748)
Res39596 = keras.layers.Reshape((2, 2), name = 'Res39596', )(Max8535)
Fla97564 = keras.layers.Flatten(name = 'Fla97564', )(Res39596)
GRU68734 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU68734', )(in0GRU68734)
Con3278 = keras.layers.Concatenate(axis=1, name = 'Con3278', )([GRU68734,in0Con3278])
Min32031 = keras.layers.Minimum(name = 'Min32031', )([Fla97564,Con3278])
Res88450 = keras.layers.Reshape((4, 1), name = 'Res88450', )(Min32031)
LST73437 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST73437', )(Res88450)
Con34970 = keras.layers.Concatenate(axis=1, name = 'Con34970', )([LST73437,in0Con34970])
Sub95904 = keras.layers.Subtract(name = 'Sub95904', )([Fla67594,Con34970])
model = tf.keras.models.Model(inputs=[in0Sub42492,in1Sub42492,in0Con11748,in0GRU68734,in0Con3278,in0Con34970], outputs=Sub95904)
w = model.get_layer('Con11748').get_weights() 
w[0] = np.array([[[[0.8833, 0.5016], [0.9212, 0.1462]]]])
w[1] = np.array([0, 0])
model.get_layer('Con11748').set_weights(w) 
w = model.get_layer('GRU68734').get_weights() 
w[0] = np.array([[9, 4, 6, 2, 1, 5, 10, 3, 10], [3, 7, 5, 9, 6, 8, 1, 4, 4]])
w[1] = np.array([[6, 10, 6, 3, 4, 9, 10, 9, 6], [10, 5, 5, 7, 10, 7, 5, 2, 5], [8, 7, 5, 3, 6, 3, 3, 1, 10]])
w[2] = np.array([8, 4, 10, 2, 10, 4, 6, 9, 10])
model.get_layer('GRU68734').set_weights(w) 
w = model.get_layer('LST73437').get_weights() 
w[0] = np.array([[10, 10, 2, 6]])
w[1] = np.array([[8, 2, 6, 9]])
w[2] = np.array([1, 1, 10, 7])
model.get_layer('LST73437').set_weights(w) 
in0Sub42492 = tf.constant([[[0.1046, 0.1001], [0.0969, 0.6185], [0.413, 0.052]]])
in1Sub42492 = tf.constant([[[0.1583, 0.9361], [0.143, 0.7588], [0.798, 0.9208]]])
in0Con11748 = tf.constant([[[[0.6461, 0.8439]], [[0.6447, 0.1477]]]])
in0GRU68734 = tf.constant([[[7, 1], [9, 8], [2, 7]]])
in0Con3278 = tf.constant([[0.3869]])
in0Con34970 = tf.constant([[0.1384, 0.5507, 0.8955, 0.0758, 0.2709]])
print (np.array2string(model.predict([in0Sub42492,in1Sub42492,in0Con11748,in0GRU68734,in0Con3278,in0Con34970],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub95904.png')

LSub42492 = subtract_layer([[[0.1046, 0.1001], [0.0969, 0.6185], [0.413, 0.052]]], [[[0.1583, 0.9361], [0.143, 0.7588], [0.798, 0.9208]]], Sub42492), 
LFla67594 = flatten_layer(Sub42492, Fla67594), 
LCon11748 = conv2D_layer([[[[0.6461, 0.8439]], [[0.6447, 0.1477]]]], 1, 1,[[[[0.8833, 0.5016], [0.9212, 0.1462]]]],[0, 0], 1, 1, false, 1, 1, Con11748), 
LMax8535 = max_pool2D_layer(Con11748, 1, 1, 1, 1, true, Max8535), 
LRes39596 = reshape_layer(Max8535, [2, 2], Res39596), 
LFla97564 = flatten_layer(Res39596, Fla97564), 
LGRU68734 = gru_layer([[[7, 1], [9, 8], [2, 7]]],[[9, 4, 6, 2, 1, 5, 10, 3, 10], [3, 7, 5, 9, 6, 8, 1, 4, 4]],[[6, 10, 6, 3, 4, 9, 10, 9, 6], [10, 5, 5, 7, 10, 7, 5, 2, 5], [8, 7, 5, 3, 6, 3, 3, 1, 10]],[8, 4, 10, 2, 10, 4, 6, 9, 10], false, GRU68734), 
LCon3278 = concatenate_layer([GRU68734,[[0.3869]]], 1, Con3278), 
LMin32031 = minimum_layer([Fla97564,Con3278], Min32031), 
LRes88450 = reshape_layer(Min32031, [4, 1], Res88450), 
LLST73437 = lstm_layer(Res88450,[[10, 10, 2, 6]],[[8, 2, 6, 9]],[1, 1, 10, 7], LST73437), 
LCon34970 = concatenate_layer([LST73437,[[0.1384, 0.5507, 0.8955, 0.0758, 0.2709]]], 1, Con34970), 
LSub95904 = subtract_layer(Fla67594,Con34970, Sub95904), 
exec_layers([LSub42492,LFla67594,LCon11748,LMax8535,LRes39596,LFla97564,LGRU68734,LCon3278,LMin32031,LRes88450,LLST73437,LCon34970,LSub95904],["Sub42492","Fla67594","Con11748","Max8535","Res39596","Fla97564","GRU68734","Con3278","Min32031","Res88450","LST73437","Con34970","Sub95904"],Sub95904,"Sub95904")

Actual (Unparsed): [[-1.0520979, -0.9744000, -0.5968000, -1.0358000, -0.4608000, -1.1397000]]

Expected (Unparsed): [[-1.052097911987852,-0.9744,-0.5968,-1.0358,-0.4608000000000001,-1.1397]]

Actual:   [[-1.052, -0.9744, -0.5968, -1.0358, -0.4608, -1.1397]]

Expected: [[-1.052, -0.9744, -0.5968, -1.0358, -0.4608, -1.1397]]