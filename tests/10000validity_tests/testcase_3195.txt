import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul16355 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Mul16355 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Sim15101 = tf.keras.layers.Input(shape=([2, 3]))
in0Con52019 = tf.keras.layers.Input(shape=([3]))

Mul16355 = keras.layers.Multiply(name = 'Mul16355', )([in0Mul16355,in1Mul16355])
Res45357 = keras.layers.Reshape((1, 2, 2), name = 'Res45357', )(Mul16355)
Res23844 = keras.layers.Reshape((1, 4), name = 'Res23844', )(Res45357)
Fla37334 = keras.layers.Flatten(name = 'Fla37334', )(Res23844)
Sim15101 = keras.layers.SimpleRNN(1,name = 'Sim15101', )(in0Sim15101)
Con52019 = keras.layers.Concatenate(axis=1, name = 'Con52019', )([Sim15101,in0Con52019])
Ave29421 = keras.layers.Average(name = 'Ave29421', )([Fla37334,Con52019])
Res8853 = keras.layers.Reshape((4, 1), name = 'Res8853', )(Ave29421)
Glo69688 = keras.layers.GlobalMaxPool1D(name = 'Glo69688', )(Res8853)
model = tf.keras.models.Model(inputs=[in0Mul16355,in1Mul16355,in0Sim15101,in0Con52019], outputs=Glo69688)
w = model.get_layer('Sim15101').get_weights() 
w[0] = np.array([[3], [6], [1]])
w[1] = np.array([[1]])
w[2] = np.array([4])
model.get_layer('Sim15101').set_weights(w) 
in0Mul16355 = tf.constant([[[[[0.5449], [0.5304]], [[0.9031], [0.5643]]]]])
in1Mul16355 = tf.constant([[[[[0.029], [0.6316]], [[0.7769], [0.652]]]]])
in0Sim15101 = tf.constant([[[9, 7, 5], [4, 3, 10]]])
in0Con52019 = tf.constant([[0.4445, 0.4616, 0.097]])
print (np.array2string(model.predict([in0Mul16355,in1Mul16355,in0Sim15101,in0Con52019],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo69688.png')

LMul16355 = multiply_layer([[[[[[0.5449], [0.5304]], [[0.9031], [0.5643]]]]], [[[[[0.029], [0.6316]], [[0.7769], [0.652]]]]]], Mul16355), 
LRes45357 = reshape_layer(Mul16355, [1, 2, 2], Res45357), 
LRes23844 = reshape_layer(Res45357, [1, 4], Res23844), 
LFla37334 = flatten_layer(Res23844, Fla37334), 
LSim15101 = simple_rnn_layer([[[9, 7, 5], [4, 3, 10]]],[[3], [6], [1]],[[1]],[4], Sim15101), 
LCon52019 = concatenate_layer([Sim15101,[[0.4445, 0.4616, 0.097]]], 1, Con52019), 
LAve29421 = average_layer([Fla37334,Con52019], Ave29421), 
LRes8853 = reshape_layer(Ave29421, [4, 1], Res8853), 
LGlo69688 = global_max_pool1D_layer(Res8853, Glo69688), 
exec_layers([LMul16355,LRes45357,LRes23844,LFla37334,LSim15101,LCon52019,LAve29421,LRes8853,LGlo69688],["Mul16355","Res45357","Res23844","Fla37334","Sim15101","Con52019","Ave29421","Res8853","Glo69688"],Glo69688,"Glo69688")

Actual (Unparsed): [[0.5816092]]

Expected (Unparsed): [[0.581609195]]

Actual:   [[0.5817]]

Expected: [[0.5817]]