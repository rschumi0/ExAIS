import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0ELU9842 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Dot27203 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot27203 = tf.keras.layers.Input(shape=([3, 2]))
in0Ave19315 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Ave19315 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con9349 = tf.keras.layers.Input(shape=([2, 3, 3]))
in0Glo87201 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con43528 = tf.keras.layers.Input(shape=([2, 11]))

ELU9842 = keras.layers.ELU(alpha=-4.20303570937021, name = 'ELU9842', input_shape=(1, 2, 2, 2))(in0ELU9842)
Res99883 = keras.layers.Reshape((1, 2, 4), name = 'Res99883', )(ELU9842)
Zer32694 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer32694', )(Res99883)
Dot27203 = keras.layers.Dot(axes=(2, 2), name = 'Dot27203', )([in0Dot27203,in1Dot27203])
Res50947 = keras.layers.Reshape((3, 3, 1), name = 'Res50947', )(Dot27203)
Dep48130 = keras.layers.DepthwiseConv2D((1, 2),strides=(2, 2), padding='valid', name = 'Dep48130', )(Res50947)
Ave19315 = keras.layers.Average(name = 'Ave19315', )([in0Ave19315,in1Ave19315])
Zer70092 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer70092', )(Ave19315)
Mul33945 = keras.layers.Multiply(name = 'Mul33945', )([Dep48130,Zer70092])
Zer97455 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer97455', )(Mul33945)
Con9349 = keras.layers.Concatenate(axis=3, name = 'Con9349', )([Zer97455,in0Con9349])
Sub44657 = keras.layers.Subtract(name = 'Sub44657', )([Zer32694,Con9349])
Res11193 = keras.layers.Reshape((2, 12), name = 'Res11193', )(Sub44657)
Glo87201 = keras.layers.GlobalAveragePooling2D(name = 'Glo87201', )(in0Glo87201)
Res78895 = keras.layers.Reshape((1, 1), name = 'Res78895', )(Glo87201)
Per64057 = keras.layers.Permute((1,2), name = 'Per64057',)(Res78895)
Zer11316 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer11316', )(Per64057)
Con43528 = keras.layers.Concatenate(axis=2, name = 'Con43528', )([Zer11316,in0Con43528])
Ave65314 = keras.layers.Average(name = 'Ave65314', )([Res11193,Con43528])
model = tf.keras.models.Model(inputs=[in0ELU9842,in0Dot27203,in1Dot27203,in0Ave19315,in1Ave19315,in0Con9349,in0Glo87201,in0Con43528], outputs=Ave65314)
w = model.get_layer('Dep48130').get_weights() 
w[0] = np.array([[[[0.9487]], [[0.8226]]]])
w[1] = np.array([0])
model.get_layer('Dep48130').set_weights(w) 
in0ELU9842 = tf.constant([[[[[0.0236, 0.7668], [0.5661, 0.0933]], [[0.4346, 0.1721], [0.9503, 0.0826]]]]])
in0Dot27203 = tf.constant([[[0.1258, 0.8464], [0.5079, 0.7922], [0.5684, 0.4358]]])
in1Dot27203 = tf.constant([[[0.0834, 0.0669], [0.4385, 0.7946], [0.012, 0.6597]]])
in0Ave19315 = tf.constant([[[[0.4918]]]])
in1Ave19315 = tf.constant([[[[0.3392]]]])
in0Con9349 = tf.constant([[[[0.794, 0.0209, 0.3582], [0.6752, 0.2506, 0.5436], [0.6958, 0.9425, 0.0199]], [[0.6428, 0.8333, 0.2914], [0.6572, 0.6605, 0.2649], [0.1346, 0.2621, 0.9244]]]])
in0Glo87201 = tf.constant([[[[1.734]]]])
in0Con43528 = tf.constant([[[0.0224, 0.7151, 0.2305, 0.4464, 0.1092, 0.0886, 0.2565, 0.4131, 0.4615, 0.3978, 0.3731], [0.0876, 0.8986, 0.1601, 0.9716, 0.2456, 0.1336, 0.5796, 0.6802, 0.0384, 0.7974, 0.6298]]])
print (np.array2string(model.predict([in0ELU9842,in0Dot27203,in1Dot27203,in0Ave19315,in1Ave19315,in0Con9349,in0Glo87201,in0Con43528],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave65314.png')

LELU9842 = elu_layer([[[[[0.0236, 0.7668], [0.5661, 0.0933]], [[0.4346, 0.1721], [0.9503, 0.0826]]]]], -4.20303570937021, ELU9842), 
LRes99883 = reshape_layer(ELU9842, [1, 2, 4], Res99883), 
LZer32694 = zero_padding2D_layer(Res99883, 1, 0, 1, 0, Zer32694), 
LDot27203 = dot_layer([[[0.1258, 0.8464], [0.5079, 0.7922], [0.5684, 0.4358]]], [[[0.0834, 0.0669], [0.4385, 0.7946], [0.012, 0.6597]]], 2, 2, Dot27203), 
LRes50947 = reshape_layer(Dot27203, [3, 3, 1], Res50947), 
LDep48130 = depthwise_conv2D_layer(Res50947, 1, 2,[[[[0.9487]], [[0.8226]]]],[0], 2, 2, false, Dep48130), 
LAve19315 = average_layer([[[[[0.4918]]]], [[[[0.3392]]]]], Ave19315), 
LZer70092 = zero_padding2D_layer(Ave19315, 1, 0, 0, 0, Zer70092), 
LMul33945 = multiply_layer([Dep48130,Zer70092], Mul33945), 
LZer97455 = zero_padding2D_layer(Mul33945, 0, 0, 2, 0, Zer97455), 
LCon9349 = concatenate_layer([Zer97455,[[[[0.794, 0.0209, 0.3582], [0.6752, 0.2506, 0.5436], [0.6958, 0.9425, 0.0199]], [[0.6428, 0.8333, 0.2914], [0.6572, 0.6605, 0.2649], [0.1346, 0.2621, 0.9244]]]]], 3, Con9349), 
LSub44657 = subtract_layer(Zer32694,Con9349, Sub44657), 
LRes11193 = reshape_layer(Sub44657, [2, 12], Res11193), 
LGlo87201 = global_average_pooling2D_layer([[[[1.734]]]], Glo87201), 
LRes78895 = reshape_layer(Glo87201, [1, 1], Res78895), 
LPer64057 = permute_layer(Res78895, 1,2, Per64057), 
LZer11316 = zero_padding1D_layer(Per64057, 1, 0, Zer11316), 
LCon43528 = concatenate_layer([Zer11316,[[[0.0224, 0.7151, 0.2305, 0.4464, 0.1092, 0.0886, 0.2565, 0.4131, 0.4615, 0.3978, 0.3731], [0.0876, 0.8986, 0.1601, 0.9716, 0.2456, 0.1336, 0.5796, 0.6802, 0.0384, 0.7974, 0.6298]]]], 2, Con43528), 
LAve65314 = average_layer([Res11193,Con43528], Ave65314), 
exec_layers([LELU9842,LRes99883,LZer32694,LDot27203,LRes50947,LDep48130,LAve19315,LZer70092,LMul33945,LZer97455,LCon9349,LSub44657,LRes11193,LGlo87201,LRes78895,LPer64057,LZer11316,LCon43528,LAve65314],["ELU9842","Res99883","Zer32694","Dot27203","Res50947","Dep48130","Ave19315","Zer70092","Mul33945","Zer97455","Con9349","Sub44657","Res11193","Glo87201","Res78895","Per64057","Zer11316","Con43528","Ave65314"],Ave65314,"Ave65314")

Actual (Unparsed): [[[0.0000000, -0.3858000, 0.3471000, -0.0638500, 0.2232000, -0.2830000, -0.0810000, -0.1435500, 0.2065500, -0.1171500, -0.2723500, 0.1766000], [0.8670000, -0.2776000, 0.0326500, -0.0656500, 0.4976000, 0.1776000, 0.0196000, 0.2040000, 0.4405375, 0.0379500, 0.7428000, -0.1060000]]]

Expected (Unparsed): [[[0,-0.38580000000000003,0.34709999999999996,-0.06385,0.2232,-0.28300000000000003,-0.08099999999999999,-0.14354999999999998,0.20655,-0.11714999999999998,-0.27235,0.17659999999999998],[0.867,-0.2776,0.03264999999999996,-0.06565,0.4976,0.17760000000000004,0.019600000000000034,0.204,0.4405374843697065,0.03795,0.7428,-0.10599999999999998]]]

Actual:   [[[0, -0.3858, 0.3471, -0.0638, 0.2232, -0.283, -0.081, -0.1435, 0.2066, -0.1171, -0.2723, 0.1766], [0.867, -0.2776, 0.0327, -0.0656, 0.4976, 0.1776, 0.0196, 0.204, 0.4406, 0.038, 0.7428, -0.106]]]

Expected: [[[0, -0.3858, 0.3471, -0.0638, 0.2232, -0.283, -0.0809, -0.1435, 0.2066, -0.1171, -0.2723, 0.1766], [0.867, -0.2776, 0.0327, -0.0656, 0.4976, 0.1777, 0.0197, 0.204, 0.4406, 0.038, 0.7428, -0.1059]]]