import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub72041 = tf.keras.layers.Input(shape=([3]))
in1Sub72041 = tf.keras.layers.Input(shape=([3]))
in0Con99220 = tf.keras.layers.Input(shape=([2, 1]))
in0Up_51904 = tf.keras.layers.Input(shape=([2, 2]))
in0Dot21281 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot21281 = tf.keras.layers.Input(shape=([3, 2]))

Sub72041 = keras.layers.Subtract(name = 'Sub72041', )([in0Sub72041,in1Sub72041])
Res74620 = keras.layers.Reshape((3, 1), name = 'Res74620', )(Sub72041)
Con65748 = keras.layers.Conv1D(4, (3),strides=(1), padding='same', dilation_rate=(1), name = 'Con65748', )(Res74620)
Res50593 = keras.layers.Reshape((3, 4, 1), name = 'Res50593', )(Con65748)
Glo22187 = keras.layers.GlobalAveragePooling2D(name = 'Glo22187', )(Res50593)
Res18209 = keras.layers.Reshape((1, 1), name = 'Res18209', )(Glo22187)
Zer33447 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer33447', )(Res18209)
Con99220 = keras.layers.Concatenate(axis=2, name = 'Con99220', )([Zer33447,in0Con99220])
Up_51904 = keras.layers.UpSampling1D(size=(1), name = 'Up_51904', )(in0Up_51904)
Max43512 = keras.layers.Maximum(name = 'Max43512', )([Con99220,Up_51904])
Res56845 = keras.layers.Reshape((2, 2, 1), name = 'Res56845', )(Max43512)
Zer64093 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer64093', )(Res56845)
Dot21281 = keras.layers.Dot(axes=(2, 2), name = 'Dot21281', )([in0Dot21281,in1Dot21281])
Res53011 = keras.layers.Reshape((3, 3, 1), name = 'Res53011', )(Dot21281)
PRe55122 = keras.layers.PReLU(name = 'PRe55122', )(Res53011)
Sub13550 = keras.layers.Subtract(name = 'Sub13550', )([Zer64093,PRe55122])
model = tf.keras.models.Model(inputs=[in0Sub72041,in1Sub72041,in0Con99220,in0Up_51904,in0Dot21281,in1Dot21281], outputs=Sub13550)
w = model.get_layer('Con65748').get_weights() 
w[0] = np.array([[[0.924, 0.9641, 0.7544, 0.645]], [[0.8693, 0.6908, 0.4922, 0.9965]], [[0.905, 0.6042, 0.5548, 0.0051]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con65748').set_weights(w) 
w = model.get_layer('PRe55122').get_weights() 
w[0] = np.array([[[0.2588], [0.5011], [0.6344]], [[0.1123], [0.891], [0.4062]], [[0.4231], [0.0633], [0.1778]]])
model.get_layer('PRe55122').set_weights(w) 
in0Sub72041 = tf.constant([[0.0019, 0.2367, 0.7564]])
in1Sub72041 = tf.constant([[0.7057, 0.4606, 0.3708]])
in0Con99220 = tf.constant([[[0.2506], [0.8453]]])
in0Up_51904 = tf.constant([[[1.6392, 1.3518], [1.8722, 1.3122]]])
in0Dot21281 = tf.constant([[[0.7731, 0.7035], [0.3414, 0.6653], [0.1815, 0.2701]]])
in1Dot21281 = tf.constant([[[0.7739, 0.5579], [0.3875, 0.0131], [0.2998, 0.5225]]])
print (np.array2string(model.predict([in0Sub72041,in1Sub72041,in0Con99220,in0Up_51904,in0Dot21281,in1Dot21281],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub13550.png')

LSub72041 = subtract_layer([[0.0019, 0.2367, 0.7564]], [[0.7057, 0.4606, 0.3708]], Sub72041), 
LRes74620 = reshape_layer(Sub72041, [3, 1], Res74620), 
LCon65748 = conv1D_layer(Res74620, 3,[[[0.924, 0.9641, 0.7544, 0.645]], [[0.8693, 0.6908, 0.4922, 0.9965]], [[0.905, 0.6042, 0.5548, 0.0051]]],[0, 0, 0, 0], 1, true, 1, Con65748), 
LRes50593 = reshape_layer(Con65748, [3, 4, 1], Res50593), 
LGlo22187 = global_average_pooling2D_layer(Res50593, Glo22187), 
LRes18209 = reshape_layer(Glo22187, [1, 1], Res18209), 
LZer33447 = zero_padding1D_layer(Res18209, 1, 0, Zer33447), 
LCon99220 = concatenate_layer([Zer33447,[[[0.2506], [0.8453]]]], 2, Con99220), 
LUp_51904 = up_sampling1D_layer([[[1.6392, 1.3518], [1.8722, 1.3122]]], 1, Up_51904), 
LMax43512 = maximum_layer([Con99220,Up_51904], Max43512), 
LRes56845 = reshape_layer(Max43512, [2, 2, 1], Res56845), 
LZer64093 = zero_padding2D_layer(Res56845, 1, 0, 1, 0, Zer64093), 
LDot21281 = dot_layer([[[0.7731, 0.7035], [0.3414, 0.6653], [0.1815, 0.2701]]], [[[0.7739, 0.5579], [0.3875, 0.0131], [0.2998, 0.5225]]], 2, 2, Dot21281), 
LRes53011 = reshape_layer(Dot21281, [3, 3, 1], Res53011), 
LPRe55122 = prelu_layer(Res53011, [[[0.2588], [0.5011], [0.6344]], [[0.1123], [0.891], [0.4062]], [[0.4231], [0.0633], [0.1778]]], PRe55122), 
LSub13550 = subtract_layer(Zer64093,PRe55122, Sub13550), 
exec_layers([LSub72041,LRes74620,LCon65748,LRes50593,LGlo22187,LRes18209,LZer33447,LCon99220,LUp_51904,LMax43512,LRes56845,LZer64093,LDot21281,LRes53011,LPRe55122,LSub13550],["Sub72041","Res74620","Con65748","Res50593","Glo22187","Res18209","Zer33447","Con99220","Up_51904","Max43512","Res56845","Zer64093","Dot21281","Res53011","PRe55122","Sub13550"],Sub13550,"Sub13550")

Actual (Unparsed): [[[[-0.9907847], [-0.3087921], [-0.5993541]], [[-0.6353803], [1.4981920], [0.9018290]], [[-0.2911516], [1.7983305], [1.1166590]]]]

Expected (Unparsed): [[[[-0.99078474],[-0.3087921],[-0.59935413]],[[-0.63538033],[1.49819207],[0.9018290299999999]],[[-0.29115164],[1.79833044],[1.11665905]]]]

Actual:   [[[[-0.9907], [-0.3087], [-0.5993]], [[-0.6353], [1.4982], [0.9019]], [[-0.2911], [1.7984], [1.1167]]]]

Expected: [[[[-0.9907], [-0.3087], [-0.5993]], [[-0.6353], [1.4982], [0.9019]], [[-0.2911], [1.7984], [1.1167]]]]