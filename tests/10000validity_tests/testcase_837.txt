import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max71485 = tf.keras.layers.Input(shape=([1, 2]))
in1Max71485 = tf.keras.layers.Input(shape=([1, 2]))
in0Up_78051 = tf.keras.layers.Input(shape=([2, 1, 1, 4]))

Max71485 = keras.layers.Maximum(name = 'Max71485', )([in0Max71485,in1Max71485])
Res12047 = keras.layers.Reshape((1, 2, 1), name = 'Res12047', )(Max71485)
Zer25584 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer25584', )(Res12047)
Res20081 = keras.layers.Reshape((3, 4), name = 'Res20081', )(Zer25584)
Up_78051 = keras.layers.UpSampling3D(size=(1, 1, 2), name = 'Up_78051', )(in0Up_78051)
Den24175 = keras.layers.Dense(4,name = 'Den24175', )(Up_78051)
Res64329 = keras.layers.Reshape((2, 1, 8), name = 'Res64329', )(Den24175)
Max35029 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 1), padding='valid', name = 'Max35029', )(Res64329)
Res49032 = keras.layers.Reshape((2, 8), name = 'Res49032', )(Max35029)
Zer39384 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer39384', )(Res49032)
Dot38042 = keras.layers.Dot(axes=(1, 1), name = 'Dot38042', )([Res20081,Zer39384])
Sep72964 = keras.layers.SeparableConv1D(2, (4),strides=(4), padding='same', name = 'Sep72964', )(Dot38042)
model = tf.keras.models.Model(inputs=[in0Max71485,in1Max71485,in0Up_78051], outputs=Sep72964)
w = model.get_layer('Den24175').get_weights() 
w[0] = np.array([[0.0418, 0.6116, 0.2087, 0.1472], [0.6428, 0.0075, 0.8905, 0.335], [0.4694, 0.7069, 0.9611, 0.1343], [0.3588, 0.2517, 0.5421, 0.1758]])
w[1] = np.array([0.1798, 0.8554, 0.777, 0.6812])
model.get_layer('Den24175').set_weights(w) 
w = model.get_layer('Sep72964').get_weights() 
w[0] = np.array([[[0.3406], [0.964], [0.0894], [0.6882], [0.3108], [0.9279], [0.1092], [0.1441]], [[0.9825], [0.8587], [0.6295], [0.6998], [0.1797], [0.5693], [0.5428], [0.0368]], [[0.9383], [0.1956], [0.9362], [0.8612], [0.3759], [0.2985], [0.0783], [0.8487]], [[0.3344], [0.4531], [0.1589], [0.2543], [0.3851], [0.1702], [0.9366], [0.599]]])
w[1] = np.array([[[0.7757, 0.2859], [0.095, 0.2828], [0.4628, 0.86], [0.4521, 0.0121], [0.0412, 0.7778], [0.4446, 0.7779], [0.1564, 0.2213], [0.8199, 0.2618]]])
w[2] = np.array([0, 0])
model.get_layer('Sep72964').set_weights(w) 
in0Max71485 = tf.constant([[[0.6761, 0.6422]]])
in1Max71485 = tf.constant([[[0.1018, 0.5244]]])
in0Up_78051 = tf.constant([[[[[1.6915, 1.6152, 1.6434, 1.2341]]], [[[1.6426, 1.8628, 1.8571, 1.0914]]]]])
print (np.array2string(model.predict([in0Max71485,in1Max71485,in0Up_78051],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sep72964.png')

LMax71485 = maximum_layer([[[[0.6761, 0.6422]]], [[[0.1018, 0.5244]]]], Max71485), 
LRes12047 = reshape_layer(Max71485, [1, 2, 1], Res12047), 
LZer25584 = zero_padding2D_layer(Res12047, 1, 1, 1, 1, Zer25584), 
LRes20081 = reshape_layer(Zer25584, [3, 4], Res20081), 
LUp_78051 = up_sampling3D_layer([[[[[1.6915, 1.6152, 1.6434, 1.2341]]], [[[1.6426, 1.8628, 1.8571, 1.0914]]]]], 1, 1, 2, Up_78051), 
LDen24175 = dense_layer(Up_78051, [[0.0418, 0.6116, 0.2087, 0.1472], [0.6428, 0.0075, 0.8905, 0.335], [0.4694, 0.7069, 0.9611, 0.1343], [0.3588, 0.2517, 0.5421, 0.1758]],[0.1798, 0.8554, 0.777, 0.6812], Den24175), 
LRes64329 = reshape_layer(Den24175, [2, 1, 8], Res64329), 
LMax35029 = max_pool2D_layer(Res64329, 1, 1, 1, 1, false, Max35029), 
LRes49032 = reshape_layer(Max35029, [2, 8], Res49032), 
LZer39384 = zero_padding1D_layer(Res49032, 1, 0, Zer39384), 
LDot38042 = dot_layer(Res20081,Zer39384, 1, 1, Dot38042), 
LSep72964 = separable_conv1D_layer(Dot38042, 4,[[[[0.3406], [0.964], [0.0894], [0.6882], [0.3108], [0.9279], [0.1092], [0.1441]], [[0.9825], [0.8587], [0.6295], [0.6998], [0.1797], [0.5693], [0.5428], [0.0368]], [[0.9383], [0.1956], [0.9362], [0.8612], [0.3759], [0.2985], [0.0783], [0.8487]], [[0.3344], [0.4531], [0.1589], [0.2543], [0.3851], [0.1702], [0.9366], [0.599]]],[[[0.7757, 0.2859], [0.095, 0.2828], [0.4628, 0.86], [0.4521, 0.0121], [0.0412, 0.7778], [0.4446, 0.7779], [0.1564, 0.2213], [0.8199, 0.2618]]]],[0, 0], 4, true, Sep72964), 
exec_layers([LMax71485,LRes12047,LZer25584,LRes20081,LUp_78051,LDen24175,LRes64329,LMax35029,LRes49032,LZer39384,LDot38042,LSep72964],["Max71485","Res12047","Zer25584","Res20081","Up_78051","Den24175","Res64329","Max35029","Res49032","Zer39384","Dot38042","Sep72964"],Sep72964,"Sep72964")

Actual (Unparsed): [[[7.9695228, 8.8074149]]]

Expected (Unparsed): [[[7.969522800917978,8.807414942774106]]]

Actual:   [[[7.9696, 8.8075]]]

Expected: [[[7.9696, 8.8075]]]