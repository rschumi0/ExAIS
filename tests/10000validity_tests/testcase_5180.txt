import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul57187 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Mul57187 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Sub59686 = tf.keras.layers.Input(shape=([3, 2, 2]))
in1Sub59686 = tf.keras.layers.Input(shape=([3, 2, 2]))
in0Cro84247 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Con76714 = tf.keras.layers.Input(shape=([3, 2, 1]))
in0Con39708 = tf.keras.layers.Input(shape=([4, 9]))

Mul57187 = keras.layers.Multiply(name = 'Mul57187', )([in0Mul57187,in1Mul57187])
Dep21855 = keras.layers.DepthwiseConv2D((2, 1),strides=(2, 2), padding='same', name = 'Dep21855', )(Mul57187)
Res48886 = keras.layers.Reshape((1, 2), name = 'Res48886', )(Dep21855)
Up_71227 = keras.layers.UpSampling1D(size=(1), name = 'Up_71227', )(Res48886)
Res41945 = keras.layers.Reshape((1, 2, 1), name = 'Res41945', )(Up_71227)
Res46565 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res46565', )(Res41945)
Zer35580 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer35580', )(Res46565)
Res50229 = keras.layers.Reshape((3, 4, 3), name = 'Res50229', )(Zer35580)
Res18386 = keras.layers.Reshape((3, 12), name = 'Res18386', )(Res50229)
Zer73670 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer73670', )(Res18386)
Sub59686 = keras.layers.Subtract(name = 'Sub59686', )([in0Sub59686,in1Sub59686])
Cro84247 = keras.layers.Cropping2D(cropping=((2, 0), (0, 2)), name = 'Cro84247', )(in0Cro84247)
Mas79187 = keras.layers.Masking(mask_value=1, name = 'Mas79187', )(Cro84247)
Zer97295 = keras.layers.ZeroPadding2D(padding=((2, 0), (1, 0)), name = 'Zer97295', )(Mas79187)
Con76714 = keras.layers.Concatenate(axis=3, name = 'Con76714', )([Zer97295,in0Con76714])
Add90745 = keras.layers.Add(name = 'Add90745', )([Sub59686,Con76714])
Lay69148 = keras.layers.LayerNormalization(axis=2, epsilon=2.1733284474155905, name = 'Lay69148', )(Add90745)
Res91153 = keras.layers.Reshape((3, 4), name = 'Res91153', )(Lay69148)
Per75769 = keras.layers.Permute((2,1), name = 'Per75769',)(Res91153)
Con39708 = keras.layers.Concatenate(axis=2, name = 'Con39708', )([Per75769,in0Con39708])
Ave78768 = keras.layers.Average(name = 'Ave78768', )([Zer73670,Con39708])
model = tf.keras.models.Model(inputs=[in0Mul57187,in1Mul57187,in0Sub59686,in1Sub59686,in0Cro84247,in0Con76714,in0Con39708], outputs=Ave78768)
w = model.get_layer('Dep21855').get_weights() 
w[0] = np.array([[[[0.0488], [0.5976]]], [[[0.4817], [0.3206]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep21855').set_weights(w) 
in0Mul57187 = tf.constant([[[[0.1451, 0.0097]], [[0.7353, 0.7851]]]])
in1Mul57187 = tf.constant([[[[0.5499, 0.7233]], [[0.4109, 0.9583]]]])
in0Sub59686 = tf.constant([[[[0.1938, 0.14], [0.438, 0.4163]], [[0.8045, 0.0153], [0.155, 0.5044]], [[0.5015, 0.2157], [0.5817, 0.192]]]])
in1Sub59686 = tf.constant([[[[0.1699, 0.2453], [0.0244, 0.6393]], [[0.1741, 0.44], [0.9481, 0.584]], [[0.0976, 0.1491], [0.72, 0.5543]]]])
in0Cro84247 = tf.constant([[[[1.6029], [1.4793], [1.5039]], [[1.0622], [1.6946], [1.4658]], [[1.5362], [1.6122], [1.6369]]]])
in0Con76714 = tf.constant([[[[0.1703], [0.9645]], [[0.0246], [0.5402]], [[0.5455], [0.7357]]]])
in0Con39708 = tf.constant([[[0.4468, 0.047, 0.0442, 0.0267, 0.589, 0.752, 0.6871, 0.6481, 0.2177], [0.0704, 0.9448, 0.8972, 0.0298, 0.6078, 0.673, 0.5259, 0.7628, 0.0521], [0.3771, 0.7979, 0.4059, 0.5132, 0.5367, 0.6206, 0.6501, 0.3819, 0.0775], [0.1814, 0.6048, 0.8752, 0.9863, 0.4831, 0.6584, 0.8652, 0.3732, 0.1755]]])
print (np.array2string(model.predict([in0Mul57187,in1Mul57187,in0Sub59686,in1Sub59686,in0Cro84247,in0Con76714,in0Con39708],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave78768.png')

LMul57187 = multiply_layer([[[[[0.1451, 0.0097]], [[0.7353, 0.7851]]]], [[[[0.5499, 0.7233]], [[0.4109, 0.9583]]]]], Mul57187), 
LDep21855 = depthwise_conv2D_layer(Mul57187, 2, 1,[[[[0.0488], [0.5976]]], [[[0.4817], [0.3206]]]],[0, 0], 2, 2, true, Dep21855), 
LRes48886 = reshape_layer(Dep21855, [1, 2], Res48886), 
LUp_71227 = up_sampling1D_layer(Res48886, 1, Up_71227), 
LRes41945 = reshape_layer(Up_71227, [1, 2, 1], Res41945), 
LRes46565 = reshape_layer(Res41945, [1, 2, 1, 1], Res46565), 
LZer35580 = zero_padding3D_layer(Res46565, 1, 1, 1, 1, 1, 1, Zer35580), 
LRes50229 = reshape_layer(Zer35580, [3, 4, 3], Res50229), 
LRes18386 = reshape_layer(Res50229, [3, 12], Res18386), 
LZer73670 = zero_padding1D_layer(Res18386, 1, 0, Zer73670), 
LSub59686 = subtract_layer([[[[0.1938, 0.14], [0.438, 0.4163]], [[0.8045, 0.0153], [0.155, 0.5044]], [[0.5015, 0.2157], [0.5817, 0.192]]]], [[[[0.1699, 0.2453], [0.0244, 0.6393]], [[0.1741, 0.44], [0.9481, 0.584]], [[0.0976, 0.1491], [0.72, 0.5543]]]], Sub59686), 
LCro84247 = cropping2D_layer([[[[1.6029], [1.4793], [1.5039]], [[1.0622], [1.6946], [1.4658]], [[1.5362], [1.6122], [1.6369]]]], 2, 0, 0, 2, Cro84247), 
LMas79187 = masking_layer(Cro84247, 1, Mas79187), 
LZer97295 = zero_padding2D_layer(Mas79187, 2, 0, 1, 0, Zer97295), 
LCon76714 = concatenate_layer([Zer97295,[[[[0.1703], [0.9645]], [[0.0246], [0.5402]], [[0.5455], [0.7357]]]]], 3, Con76714), 
LAdd90745 = add_layer([Sub59686,Con76714], Add90745), 
LLay69148 = layer_normalization_layer(Add90745, 2, 2.1733284474155905, Lay69148), 
LRes91153 = reshape_layer(Lay69148, [3, 4], Res91153), 
LPer75769 = permute_layer(Res91153, 2,1, Per75769), 
LCon39708 = concatenate_layer([Per75769,[[[0.4468, 0.047, 0.0442, 0.0267, 0.589, 0.752, 0.6871, 0.6481, 0.2177], [0.0704, 0.9448, 0.8972, 0.0298, 0.6078, 0.673, 0.5259, 0.7628, 0.0521], [0.3771, 0.7979, 0.4059, 0.5132, 0.5367, 0.6206, 0.6501, 0.3819, 0.0775], [0.1814, 0.6048, 0.8752, 0.9863, 0.4831, 0.6584, 0.8652, 0.3732, 0.1755]]]], 2, Con39708), 
LAve78768 = average_layer([Zer73670,Con39708], Ave78768), 
exec_layers([LMul57187,LDep21855,LRes48886,LUp_71227,LRes41945,LRes46565,LZer35580,LRes50229,LRes18386,LZer73670,LSub59686,LCro84247,LMas79187,LZer97295,LCon76714,LAdd90745,LLay69148,LRes91153,LPer75769,LCon39708,LAve78768],["Mul57187","Dep21855","Res48886","Up_71227","Res41945","Res46565","Zer35580","Res50229","Res18386","Zer73670","Sub59686","Cro84247","Mas79187","Zer97295","Con76714","Add90745","Lay69148","Res91153","Per75769","Con39708","Ave78768"],Ave78768,"Ave78768")

Actual (Unparsed): [[[-0.0655160, 0.2173886, -0.1597307, 0.2234000, 0.0235000, 0.0221000, 0.0133500, 0.2945000, 0.3760000, 0.3435500, 0.3240500, 0.1088500], [-0.1118161, -0.1401107, 0.0403470, 0.0352000, 0.4724000, 0.4486000, 0.0149000, 0.3039000, 0.3365000, 0.2629500, 0.3814000, 0.0260500], [0.0655160, -0.2173886, 0.1597307, 0.1885500, 0.4736661, 0.2029500, 0.2566000, 0.3910499, 0.3103000, 0.3250500, 0.1909500, 0.0387500], [0.1118161, 0.1401107, -0.0403470, 0.0907000, 0.3024000, 0.4376000, 0.4931500, 0.2415500, 0.3292000, 0.4326000, 0.1866000, 0.0877500]]]

Expected (Unparsed): [[[-0.06551595492660857,0.21738864123384458,-0.1597307139900015,0.2234,0.0235,0.0221,0.01335,0.2945,0.376,0.34355,0.32405,0.10885],[-0.11181609816984818,-0.14011065032537748,0.040346992107613736,0.0352,0.4724,0.4486,0.0149,0.3039,0.3365,0.26295,0.3814,0.02605],[0.06551595492660857,-0.21738864123384458,0.1597307139900015,0.18855,0.4736660473105,0.20295,0.2566,0.391049904987,0.3103,0.32505,0.19095,0.03875],[0.11181609816984815,0.14011065032537748,-0.04034699210761375,0.0907,0.3024,0.4376,0.49315,0.24155,0.3292,0.4326,0.1866,0.08775]]]

Actual:   [[[-0.0655, 0.2174, -0.1597, 0.2234, 0.0235, 0.0221, 0.0134, 0.2945, 0.376, 0.3436, 0.3241, 0.1089], [-0.1118, -0.1401, 0.0404, 0.0352, 0.4724, 0.4486, 0.0149, 0.3039, 0.3365, 0.263, 0.3814, 0.0261], [0.0656, -0.2173, 0.1598, 0.1886, 0.4737, 0.203, 0.2566, 0.3911, 0.3103, 0.3251, 0.191, 0.0388], [0.1119, 0.1402, -0.0403, 0.0907, 0.3024, 0.4376, 0.4932, 0.2416, 0.3292, 0.4326, 0.1866, 0.0878]]]

Expected: [[[-0.0655, 0.2174, -0.1597, 0.2234, 0.0235, 0.0221, 0.0134, 0.2945, 0.376, 0.3436, 0.3241, 0.1089], [-0.1118, -0.1401, 0.0404, 0.0352, 0.4724, 0.4486, 0.0149, 0.3039, 0.3365, 0.263, 0.3814, 0.0261], [0.0656, -0.2173, 0.1598, 0.1886, 0.4737, 0.203, 0.2566, 0.3911, 0.3103, 0.3251, 0.191, 0.0388], [0.1119, 0.1402, -0.0403, 0.0907, 0.3024, 0.4376, 0.4932, 0.2416, 0.3292, 0.4326, 0.1866, 0.0878]]]