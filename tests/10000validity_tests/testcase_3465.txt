import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Fla84869 = tf.keras.layers.Input(shape=([1, 3, 2]))

Fla84869 = keras.layers.Flatten(name = 'Fla84869', )(in0Fla84869)
Res45927 = keras.layers.Reshape((6, 1), name = 'Res45927', )(Fla84869)
Res44657 = keras.layers.Reshape((6, 1, 1), name = 'Res44657', )(Res45927)
Glo18133 = keras.layers.GlobalMaxPool2D(name = 'Glo18133', )(Res44657)
Res86461 = keras.layers.Reshape((1, 1), name = 'Res86461', )(Glo18133)
Sim97715 = keras.layers.SimpleRNN(3,name = 'Sim97715', )(Res86461)
Res14434 = keras.layers.Reshape((3, 1), name = 'Res14434', )(Sim97715)
Res78105 = keras.layers.Reshape((3, 1, 1), name = 'Res78105', )(Res14434)
Res87367 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res87367', )(Res78105)
Up_2450 = keras.layers.UpSampling3D(size=(1, 1, 1), name = 'Up_2450', )(Res87367)
model = tf.keras.models.Model(inputs=[in0Fla84869], outputs=Up_2450)
w = model.get_layer('Sim97715').get_weights() 
w[0] = np.array([[5, 8, 7]])
w[1] = np.array([[10, 3, 1], [2, 3, 6], [5, 5, 10]])
w[2] = np.array([4, 4, 9])
model.get_layer('Sim97715').set_weights(w) 
in0Fla84869 = tf.constant([[[[1.0677, 1.0398], [1.3383, 1.2802], [1.1905, 1.2121]]]])
print (np.array2string(model.predict([in0Fla84869],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Up_2450.png')

LFla84869 = flatten_layer([[[[1.0677, 1.0398], [1.3383, 1.2802], [1.1905, 1.2121]]]], Fla84869), 
LRes45927 = reshape_layer(Fla84869, [6, 1], Res45927), 
LRes44657 = reshape_layer(Res45927, [6, 1, 1], Res44657), 
LGlo18133 = global_max_pool2D_layer(Res44657, Glo18133), 
LRes86461 = reshape_layer(Glo18133, [1, 1], Res86461), 
LSim97715 = simple_rnn_layer(Res86461,[[5, 8, 7]],[[10, 3, 1], [2, 3, 6], [5, 5, 10]],[4, 4, 9], Sim97715), 
LRes14434 = reshape_layer(Sim97715, [3, 1], Res14434), 
LRes78105 = reshape_layer(Res14434, [3, 1, 1], Res78105), 
LRes87367 = reshape_layer(Res78105, [3, 1, 1, 1], Res87367), 
LUp_2450 = up_sampling3D_layer(Res87367, 1, 1, 1, Up_2450), 
exec_layers([LFla84869,LRes45927,LRes44657,LGlo18133,LRes86461,LSim97715,LRes14434,LRes78105,LRes87367,LUp_2450],["Fla84869","Res45927","Res44657","Glo18133","Res86461","Sim97715","Res14434","Res78105","Res87367","Up_2450"],Up_2450,"Up_2450")

Actual (Unparsed): [[[[[1.0000000]]], [[[1.0000000]]], [[[1.0000000]]]]]

Expected (Unparsed): [[[[[0.9999999989660225]]],[[[0.9999999999996633]]],[[[0.9999999999999998]]]]]

Actual:   [[[[[1]]], [[[1]]], [[[1]]]]]

Expected: [[[[[1]]], [[[1]]], [[[1]]]]]