import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Cro30729 = tf.keras.layers.Input(shape=([3, 4, 4]))
in0Max38624 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Max38624 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Con58855 = tf.keras.layers.Input(shape=([2, 8]))
in0Mul20410 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul20410 = tf.keras.layers.Input(shape=([2, 2]))
in0Con65315 = tf.keras.layers.Input(shape=([2, 11]))
in0Den87506 = tf.keras.layers.Input(shape=([3, 3, 3]))

Cro30729 = keras.layers.Cropping2D(cropping=((1, 1), (2, 0)), name = 'Cro30729', )(in0Cro30729)
Res19693 = keras.layers.Reshape((1, 8), name = 'Res19693', )(Cro30729)
Res47417 = keras.layers.Reshape((1, 8, 1), name = 'Res47417', )(Res19693)
Cro2298 = keras.layers.Cropping2D(cropping=((0, 0), (6, 1)), name = 'Cro2298', )(Res47417)
Res53771 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res53771', )(Cro2298)
Zer46132 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (1, 0)), name = 'Zer46132', )(Res53771)
Max38624 = keras.layers.Maximum(name = 'Max38624', )([in0Max38624,in1Max38624])
Max60263 = keras.layers.Maximum(name = 'Max60263', )([Zer46132,Max38624])
Res11531 = keras.layers.Reshape((2, 2, 2), name = 'Res11531', )(Max60263)
Res98970 = keras.layers.Reshape((2, 4), name = 'Res98970', )(Res11531)
Con58855 = keras.layers.Concatenate(axis=2, name = 'Con58855', )([Res98970,in0Con58855])
Mul20410 = keras.layers.Multiply(name = 'Mul20410', )([in0Mul20410,in1Mul20410])
Res63393 = keras.layers.Reshape((2, 2, 1), name = 'Res63393', )(Mul20410)
Glo1278 = keras.layers.GlobalAveragePooling2D(name = 'Glo1278', )(Res63393)
Res61965 = keras.layers.Reshape((1, 1), name = 'Res61965', )(Glo1278)
Zer19377 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer19377', )(Res61965)
Con65315 = keras.layers.Concatenate(axis=2, name = 'Con65315', )([Zer19377,in0Con65315])
Den87506 = keras.layers.Dense(4,name = 'Den87506', )(in0Den87506)
Res84326 = keras.layers.Reshape((3, 12), name = 'Res84326', )(Den87506)
Max12096 = keras.layers.MaxPool1D(pool_size=(2), strides=(1), padding='valid', name = 'Max12096', )(Res84326)
Add91124 = keras.layers.Add(name = 'Add91124', )([Con65315,Max12096])
Mul83007 = keras.layers.Multiply(name = 'Mul83007', )([Con58855,Add91124])
model = tf.keras.models.Model(inputs=[in0Cro30729,in0Max38624,in1Max38624,in0Con58855,in0Mul20410,in1Mul20410,in0Con65315,in0Den87506], outputs=Mul83007)
w = model.get_layer('Den87506').get_weights() 
w[0] = np.array([[0.4741, 0.0668, 0.7834, 0.9561], [0.9221, 0.2486, 0.2536, 0.9226], [0.6688, 0.6646, 0.4074, 0.5678]])
w[1] = np.array([0.3719, 0.0197, 0.2549, 0.1379])
model.get_layer('Den87506').set_weights(w) 
in0Cro30729 = tf.constant([[[[1.2598, 1.4512, 1.338, 1.6258], [1.0765, 1.5559, 1.4707, 1.2385], [1.3044, 1.6255, 1.5925, 1.45], [1.9489, 1.788, 1.1556, 1.276]], [[1.6142, 1.3328, 1.9023, 1.0967], [1.9144, 1.7625, 1.3571, 1.6339], [1.0465, 1.2023, 1.122, 1.4935], [1.079, 1.5372, 1.3237, 1.211]], [[1.6666, 1.6586, 1.9813, 1.6318], [1.8417, 1.2391, 1.7699, 1.8913], [1.2518, 1.5295, 1.6398, 1.2225], [1.7123, 1.7704, 1.0179, 1.3098]]]])
in0Max38624 = tf.constant([[[[[0.7071], [0.7787]], [[0.6886], [0.2041]]], [[[0.3988], [0.0409]], [[0.7395], [0.7758]]]]])
in1Max38624 = tf.constant([[[[[0.7941], [0.5193]], [[0.9724], [0.04]]], [[[0.0298], [0.1914]], [[0.0729], [0.4566]]]]])
in0Con58855 = tf.constant([[[0.857, 0.3589, 0.5822, 0.9551, 0.3179, 0.1898, 0.5238, 0.3404], [0.375, 0.7985, 0.3724, 0.1332, 0.9406, 0.5429, 0.562, 0.3605]]])
in0Mul20410 = tf.constant([[[0.111, 0.4877], [0.7694, 0.8565]]])
in1Mul20410 = tf.constant([[[0.193, 0.8254], [0.9018, 0.7623]]])
in0Con65315 = tf.constant([[[0.017, 0.2046, 0.4236, 0.6773, 0.9886, 0.8803, 0.3436, 0.0698, 0.7659, 0.4092, 0.8229], [0.5749, 0.1165, 0.0848, 0.6998, 0.3056, 0.2981, 0.6906, 0.1487, 0.9581, 0.7795, 0.8911]]])
in0Den87506 = tf.constant([[[[0.9282, 0.953, 0.23], [0.5179, 0.4123, 0.0282], [0.7653, 0.2907, 0.5798]], [[0.7697, 0.4847, 0.8171], [0.9916, 0.4647, 0.6501], [0.098, 0.8348, 0.0974]], [[0.5957, 0.12, 0.6116], [0.3668, 0.7692, 0.0762], [0.4317, 0.9071, 0.0166]]]])
print (np.array2string(model.predict([in0Cro30729,in0Max38624,in1Max38624,in0Con58855,in0Mul20410,in1Mul20410,in0Con65315,in0Den87506],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul83007.png')

LCro30729 = cropping2D_layer([[[[1.2598, 1.4512, 1.338, 1.6258], [1.0765, 1.5559, 1.4707, 1.2385], [1.3044, 1.6255, 1.5925, 1.45], [1.9489, 1.788, 1.1556, 1.276]], [[1.6142, 1.3328, 1.9023, 1.0967], [1.9144, 1.7625, 1.3571, 1.6339], [1.0465, 1.2023, 1.122, 1.4935], [1.079, 1.5372, 1.3237, 1.211]], [[1.6666, 1.6586, 1.9813, 1.6318], [1.8417, 1.2391, 1.7699, 1.8913], [1.2518, 1.5295, 1.6398, 1.2225], [1.7123, 1.7704, 1.0179, 1.3098]]]], 1, 1, 2, 0, Cro30729), 
LRes19693 = reshape_layer(Cro30729, [1, 8], Res19693), 
LRes47417 = reshape_layer(Res19693, [1, 8, 1], Res47417), 
LCro2298 = cropping2D_layer(Res47417, 0, 0, 6, 1, Cro2298), 
LRes53771 = reshape_layer(Cro2298, [1, 1, 1, 1], Res53771), 
LZer46132 = zero_padding3D_layer(Res53771, 1, 0, 1, 0, 1, 0, Zer46132), 
LMax38624 = maximum_layer([[[[[[0.7071], [0.7787]], [[0.6886], [0.2041]]], [[[0.3988], [0.0409]], [[0.7395], [0.7758]]]]], [[[[[0.7941], [0.5193]], [[0.9724], [0.04]]], [[[0.0298], [0.1914]], [[0.0729], [0.4566]]]]]], Max38624), 
LMax60263 = maximum_layer([Zer46132,Max38624], Max60263), 
LRes11531 = reshape_layer(Max60263, [2, 2, 2], Res11531), 
LRes98970 = reshape_layer(Res11531, [2, 4], Res98970), 
LCon58855 = concatenate_layer([Res98970,[[[0.857, 0.3589, 0.5822, 0.9551, 0.3179, 0.1898, 0.5238, 0.3404], [0.375, 0.7985, 0.3724, 0.1332, 0.9406, 0.5429, 0.562, 0.3605]]]], 2, Con58855), 
LMul20410 = multiply_layer([[[[0.111, 0.4877], [0.7694, 0.8565]]], [[[0.193, 0.8254], [0.9018, 0.7623]]]], Mul20410), 
LRes63393 = reshape_layer(Mul20410, [2, 2, 1], Res63393), 
LGlo1278 = global_average_pooling2D_layer(Res63393, Glo1278), 
LRes61965 = reshape_layer(Glo1278, [1, 1], Res61965), 
LZer19377 = zero_padding1D_layer(Res61965, 1, 0, Zer19377), 
LCon65315 = concatenate_layer([Zer19377,[[[0.017, 0.2046, 0.4236, 0.6773, 0.9886, 0.8803, 0.3436, 0.0698, 0.7659, 0.4092, 0.8229], [0.5749, 0.1165, 0.0848, 0.6998, 0.3056, 0.2981, 0.6906, 0.1487, 0.9581, 0.7795, 0.8911]]]], 2, Con65315), 
LDen87506 = dense_layer([[[[0.9282, 0.953, 0.23], [0.5179, 0.4123, 0.0282], [0.7653, 0.2907, 0.5798]], [[0.7697, 0.4847, 0.8171], [0.9916, 0.4647, 0.6501], [0.098, 0.8348, 0.0974]], [[0.5957, 0.12, 0.6116], [0.3668, 0.7692, 0.0762], [0.4317, 0.9071, 0.0166]]]], [[0.4741, 0.0668, 0.7834, 0.9561], [0.9221, 0.2486, 0.2536, 0.9226], [0.6688, 0.6646, 0.4074, 0.5678]],[0.3719, 0.0197, 0.2549, 0.1379], Den87506), 
LRes84326 = reshape_layer(Den87506, [3, 12], Res84326), 
LMax12096 = max_pool1D_layer(Res84326, 2, 1, false, Max12096), 
LAdd91124 = add_layer([Con65315,Max12096], Add91124), 
LMul83007 = multiply_layer([Con58855,Add91124], Mul83007), 
exec_layers([LCro30729,LRes19693,LRes47417,LCro2298,LRes53771,LZer46132,LMax38624,LMax60263,LRes11531,LRes98970,LCon58855,LMul20410,LRes63393,LGlo1278,LRes61965,LZer19377,LCon65315,LDen87506,LRes84326,LMax12096,LAdd91124,LMul83007],["Cro30729","Res19693","Res47417","Cro2298","Res53771","Zer46132","Max38624","Max60263","Res11531","Res98970","Con58855","Mul20410","Res63393","Glo1278","Res61965","Zer19377","Con65315","Den87506","Res84326","Max12096","Add91124","Mul83007"],Mul83007,"Mul83007")

Actual (Unparsed): [[[1.4647531, 0.5853153, 1.4800266, 0.5018378, 2.0418919, 0.5821788, 1.3359848, 2.1274162, 0.4642464, 0.2456629, 0.8242350, 0.7794866], [0.8665583, 0.2506492, 1.0576251, 2.4749797, 0.9019141, 0.7498871, 0.6377417, 0.3429138, 1.4793831, 0.6822135, 0.9044812, 0.8248472]]]

Expected (Unparsed): [[[1.464753120972,0.585315337048,1.480026522832,0.501837777662,2.0418918936699995,0.582178781864,1.33598487782,2.127416253576,0.4642463585760001,0.245662911572,0.824234949828,0.7794865860360001],[0.8665582956210002,0.250649217456,1.0576250908800002,2.4749798283490003,0.9019141162499998,0.7498871283599999,0.63774174044,0.34291377763200004,1.479383167176,0.682213416988,0.9044812151600001,0.8248471837550001]]]

Actual:   [[[1.4648, 0.5854, 1.4801, 0.5019, 2.0419, 0.5822, 1.336, 2.1275, 0.4643, 0.2457, 0.8243, 0.7795], [0.8666, 0.2507, 1.0577, 2.475, 0.902, 0.7499, 0.6378, 0.343, 1.4794, 0.6823, 0.9045, 0.8249]]]

Expected: [[[1.4648, 0.5854, 1.4801, 0.5019, 2.0419, 0.5822, 1.336, 2.1275, 0.4643, 0.2457, 0.8243, 0.7795], [0.8666, 0.2507, 1.0577, 2.475, 0.902, 0.7499, 0.6378, 0.343, 1.4794, 0.6823, 0.9045, 0.8249]]]