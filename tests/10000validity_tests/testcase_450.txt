import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub85384 = tf.keras.layers.Input(shape=([2]))
in1Sub85384 = tf.keras.layers.Input(shape=([2]))
in0Con83092 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Dot53268 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot53268 = tf.keras.layers.Input(shape=([3, 3]))
in0Con68607 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Max93731 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Max93731 = tf.keras.layers.Input(shape=([2, 1, 2]))

Sub85384 = keras.layers.Subtract(name = 'Sub85384', )([in0Sub85384,in1Sub85384])
Res72430 = keras.layers.Reshape((2, 1), name = 'Res72430', )(Sub85384)
Res3230 = keras.layers.Reshape((2, 1, 1), name = 'Res3230', )(Res72430)
Glo46603 = keras.layers.GlobalAveragePooling2D(name = 'Glo46603', )(Res3230)
Res69006 = keras.layers.Reshape((1, 1), name = 'Res69006', )(Glo46603)
Res1880 = keras.layers.Reshape((1, 1, 1), name = 'Res1880', )(Res69006)
Zer89394 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer89394', )(Res1880)
Con83092 = keras.layers.Concatenate(axis=3, name = 'Con83092', )([Zer89394,in0Con83092])
Dot53268 = keras.layers.Dot(axes=(1, 1), name = 'Dot53268', )([in0Dot53268,in1Dot53268])
Res32312 = keras.layers.Reshape((3, 3, 1), name = 'Res32312', )(Dot53268)
Con68607 = keras.layers.Concatenate(axis=3, name = 'Con68607', )([Res32312,in0Con68607])
Max93731 = keras.layers.Maximum(name = 'Max93731', )([in0Max93731,in1Max93731])
Zer81907 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer81907', )(Max93731)
Sub95302 = keras.layers.Subtract(name = 'Sub95302', )([Con68607,Zer81907])
Mul84871 = keras.layers.Multiply(name = 'Mul84871', )([Con83092,Sub95302])
model = tf.keras.models.Model(inputs=[in0Sub85384,in1Sub85384,in0Con83092,in0Dot53268,in1Dot53268,in0Con68607,in0Max93731,in1Max93731], outputs=Mul84871)
in0Sub85384 = tf.constant([[0.6754, 0.2168]])
in1Sub85384 = tf.constant([[0.8308, 0.4051]])
in0Con83092 = tf.constant([[[[0.3544], [0.4282], [0.2638]], [[0.8664], [0.8048], [0.278]], [[0.1538], [0.8105], [0.8053]]]])
in0Dot53268 = tf.constant([[[0.3853, 0.2469, 0.8963], [0.7853, 0.4698, 0.1054], [0.2613, 0.4244, 0.8785]]])
in1Dot53268 = tf.constant([[[0.9978, 0.6597, 0.5936], [0.8807, 0.474, 0.9215], [0.0282, 0.4111, 0.6861]]])
in0Con68607 = tf.constant([[[[0.8909], [0.6538], [0.948]], [[0.2547], [0.9589], [0.4909]], [[0.2904], [0.6117], [0.9406]]]])
in0Max93731 = tf.constant([[[[0.864, 0.7972]], [[0.4427, 0.3283]]]])
in1Max93731 = tf.constant([[[[0.269, 0.578]], [[0.3173, 0.4617]]]])
print (np.array2string(model.predict([in0Sub85384,in1Sub85384,in0Con83092,in0Dot53268,in1Dot53268,in0Con68607,in0Max93731,in1Max93731],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul84871.png')

LSub85384 = subtract_layer([[0.6754, 0.2168]], [[0.8308, 0.4051]], Sub85384), 
LRes72430 = reshape_layer(Sub85384, [2, 1], Res72430), 
LRes3230 = reshape_layer(Res72430, [2, 1, 1], Res3230), 
LGlo46603 = global_average_pooling2D_layer(Res3230, Glo46603), 
LRes69006 = reshape_layer(Glo46603, [1, 1], Res69006), 
LRes1880 = reshape_layer(Res69006, [1, 1, 1], Res1880), 
LZer89394 = zero_padding2D_layer(Res1880, 2, 0, 2, 0, Zer89394), 
LCon83092 = concatenate_layer([Zer89394,[[[[0.3544], [0.4282], [0.2638]], [[0.8664], [0.8048], [0.278]], [[0.1538], [0.8105], [0.8053]]]]], 3, Con83092), 
LDot53268 = dot_layer([[[0.3853, 0.2469, 0.8963], [0.7853, 0.4698, 0.1054], [0.2613, 0.4244, 0.8785]]], [[[0.9978, 0.6597, 0.5936], [0.8807, 0.474, 0.9215], [0.0282, 0.4111, 0.6861]]], 1, 1, Dot53268), 
LRes32312 = reshape_layer(Dot53268, [3, 3, 1], Res32312), 
LCon68607 = concatenate_layer([Res32312,[[[[0.8909], [0.6538], [0.948]], [[0.2547], [0.9589], [0.4909]], [[0.2904], [0.6117], [0.9406]]]]], 3, Con68607), 
LMax93731 = maximum_layer([[[[[0.864, 0.7972]], [[0.4427, 0.3283]]]], [[[[0.269, 0.578]], [[0.3173, 0.4617]]]]], Max93731), 
LZer81907 = zero_padding2D_layer(Max93731, 1, 0, 2, 0, Zer81907), 
LSub95302 = subtract_layer(Con68607,Zer81907, Sub95302), 
LMul84871 = multiply_layer([Con83092,Sub95302], Mul84871), 
exec_layers([LSub85384,LRes72430,LRes3230,LGlo46603,LRes69006,LRes1880,LZer89394,LCon83092,LDot53268,LRes32312,LCon68607,LMax93731,LZer81907,LSub95302,LMul84871],["Sub85384","Res72430","Res3230","Glo46603","Res69006","Res1880","Zer89394","Con83092","Dot53268","Res32312","Con68607","Max93731","Zer81907","Sub95302","Mul84871"],Mul84871,"Mul84871")

Actual (Unparsed): [[[[0.0000000, 0.3157350], [0.0000000, 0.2799572], [0.0000000, 0.2500824]], [[0.0000000, 0.2206721], [0.0000000, 0.7717227], [0.0000000, -0.0851514]], [[0.0000000, 0.0446635], [0.0000000, 0.4957829], [-0.1356255, 0.3856582]]]]

Expected (Unparsed): [[[[0.0,0.31573496],[0.0,0.27995716000000004],[0.0,0.2500824]],[[0.0,0.22067207999999996],[0.0,0.77172272],[0.0,-0.08515140000000002]],[[0.0,0.04466352],[0.0,0.49578285],[-0.1356255030655,0.38565817]]]]

Actual:   [[[[0, 0.3158], [0, 0.28], [0, 0.2501]], [[0, 0.2207], [0, 0.7718], [0, -0.0851]], [[0, 0.0447], [0, 0.4958], [-0.1356, 0.3857]]]]

Expected: [[[[0, 0.3158], [0, 0.28], [0, 0.2501]], [[0, 0.2207], [0, 0.7718], [0, -0.0851]], [[0, 0.0447], [0, 0.4958], [-0.1356, 0.3857]]]]