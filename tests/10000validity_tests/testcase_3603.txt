import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave833 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave833 = tf.keras.layers.Input(shape=([1, 2]))
in0Con2764 = tf.keras.layers.Input(shape=([1, 22]))
in0Lay84568 = tf.keras.layers.Input(shape=([4, 4, 3]))
in0Con36170 = tf.keras.layers.Input(shape=([4, 4, 3, 1]))
in0ELU1978 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Loc74710 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con18956 = tf.keras.layers.Input(shape=([4, 4, 2]))

Ave833 = keras.layers.Average(name = 'Ave833', )([in0Ave833,in1Ave833])
Mas73896 = keras.layers.Masking(mask_value=2, name = 'Mas73896', )(Ave833)
Con2764 = keras.layers.Concatenate(axis=2, name = 'Con2764', )([Mas73896,in0Con2764])
Lay84568 = keras.layers.LayerNormalization(axis=3, epsilon=1.2873502638751209, name = 'Lay84568', )(in0Lay84568)
Res21532 = keras.layers.Reshape((4, 4, 3, 1), name = 'Res21532', )(Lay84568)
Con36170 = keras.layers.Concatenate(axis=4, name = 'Con36170', )([Res21532,in0Con36170])
ELU1978 = keras.layers.ELU(alpha=4.1009894528034, name = 'ELU1978', input_shape=(1, 2, 1, 2))(in0ELU1978)
Zer58607 = keras.layers.ZeroPadding3D(padding=((3, 0), (2, 0), (2, 0)), name = 'Zer58607', )(ELU1978)
Sub64353 = keras.layers.Subtract(name = 'Sub64353', )([Con36170,Zer58607])
Res49537 = keras.layers.Reshape((4, 4, 6), name = 'Res49537', )(Sub64353)
Loc74710 = keras.layers.LocallyConnected2D(4, (2, 1),strides=(1, 1), name = 'Loc74710', )(in0Loc74710)
Zer47503 = keras.layers.ZeroPadding2D(padding=((3, 0), (3, 0)), name = 'Zer47503', )(Loc74710)
Con18956 = keras.layers.Concatenate(axis=3, name = 'Con18956', )([Zer47503,in0Con18956])
Min54945 = keras.layers.Minimum(name = 'Min54945', )([Res49537,Con18956])
Res40248 = keras.layers.Reshape((4, 24), name = 'Res40248', )(Min54945)
Dot51522 = keras.layers.Dot(axes=(2, 2), name = 'Dot51522', )([Con2764,Res40248])
model = tf.keras.models.Model(inputs=[in0Ave833,in1Ave833,in0Con2764,in0Lay84568,in0Con36170,in0ELU1978,in0Loc74710,in0Con18956], outputs=Dot51522)
w = model.get_layer('Loc74710').get_weights() 
w[0] = np.array([[[0.1183, 0.556, 0.8264, 0.8046], [0.3526, 0.4851, 0.1649, 0.7621]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc74710').set_weights(w) 
in0Ave833 = tf.constant([[[0.1511, 0.9617]]])
in1Ave833 = tf.constant([[[0.0214, 0.5214]]])
in0Con2764 = tf.constant([[[0.2287, 0.1108, 0.7204, 0.1833, 0.2563, 0.2105, 0.4894, 0.0442, 0.9388, 0.7784, 0.5438, 0.9499, 0.2503, 0.372, 0.7967, 0.0701, 0.7663, 0.7502, 0.7121, 0.0476, 0.0795, 0.3475]]])
in0Lay84568 = tf.constant([[[[1.555, 1.365, 1.4239], [1.2118, 1.8888, 1.635], [1.8082, 1.2533, 1.8956], [1.1749, 1.1071, 1.4492]], [[1.1622, 1.9365, 1.182], [1.8428, 1.3045, 1.0126], [1.8598, 1.8552, 1.4304], [1.715, 1.5116, 1.4258]], [[1.837, 1.3376, 1.0382], [1.0138, 1.6311, 1.0983], [1.3143, 1.1999, 1.8504], [1.4697, 1.983, 1.4117]], [[1.7051, 1.2158, 1.9885], [1.9923, 1.7626, 1.9775], [1.3913, 1.4249, 1.2507], [1.1728, 1.8145, 1.0375]]]])
in0Con36170 = tf.constant([[[[[0.1593], [0.4465], [0.1904]], [[0.8178], [0.4176], [0.547]], [[0.1461], [0.4284], [0.3952]], [[0.2217], [0.8809], [0.8556]]], [[[0.1073], [0.5884], [0.2226]], [[0.4126], [0.3099], [0.443]], [[0.4431], [0.3177], [0.106]], [[0.0675], [0.6845], [0.7036]]], [[[0.451], [0.2721], [0.2786]], [[0.0815], [0.7913], [0.604]], [[0.5611], [0.4582], [0.6272]], [[0.3179], [0.1129], [0.3581]]], [[[0.1408], [0.4015], [0.9692]], [[0.5911], [0.1534], [0.6764]], [[0.231], [0.7235], [0.5847]], [[0.7511], [0.6839], [0.86]]]]])
in0ELU1978 = tf.constant([[[[[0.1707, 0.3137]], [[0.3422, 0.9161]]]]])
in0Loc74710 = tf.constant([[[[0.5791]], [[0.578]]]])
in0Con18956 = tf.constant([[[[0.1612, 0.759], [0.2476, 0.5535], [0.4348, 0.5108], [0.1891, 0.5159]], [[0.527, 0.8405], [0.9997, 0.6921], [0.8977, 0.2295], [0.9331, 0.6475]], [[0.6225, 0.4213], [0.9303, 0.4969], [0.3731, 0.9787], [0.5826, 0.0843]], [[0.2382, 0.9346], [0.6964, 0.3027], [0.5551, 0.1589], [0.7092, 0.6787]]]])
print (np.array2string(model.predict([in0Ave833,in1Ave833,in0Con2764,in0Lay84568,in0Con36170,in0ELU1978,in0Loc74710,in0Con18956],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot51522.png')

LAve833 = average_layer([[[[0.1511, 0.9617]]], [[[0.0214, 0.5214]]]], Ave833), 
LMas73896 = masking_layer(Ave833, 2, Mas73896), 
LCon2764 = concatenate_layer([Mas73896,[[[0.2287, 0.1108, 0.7204, 0.1833, 0.2563, 0.2105, 0.4894, 0.0442, 0.9388, 0.7784, 0.5438, 0.9499, 0.2503, 0.372, 0.7967, 0.0701, 0.7663, 0.7502, 0.7121, 0.0476, 0.0795, 0.3475]]]], 2, Con2764), 
LLay84568 = layer_normalization_layer([[[[1.555, 1.365, 1.4239], [1.2118, 1.8888, 1.635], [1.8082, 1.2533, 1.8956], [1.1749, 1.1071, 1.4492]], [[1.1622, 1.9365, 1.182], [1.8428, 1.3045, 1.0126], [1.8598, 1.8552, 1.4304], [1.715, 1.5116, 1.4258]], [[1.837, 1.3376, 1.0382], [1.0138, 1.6311, 1.0983], [1.3143, 1.1999, 1.8504], [1.4697, 1.983, 1.4117]], [[1.7051, 1.2158, 1.9885], [1.9923, 1.7626, 1.9775], [1.3913, 1.4249, 1.2507], [1.1728, 1.8145, 1.0375]]]], 3, 1.2873502638751209, Lay84568), 
LRes21532 = reshape_layer(Lay84568, [4, 4, 3, 1], Res21532), 
LCon36170 = concatenate_layer([Res21532,[[[[[0.1593], [0.4465], [0.1904]], [[0.8178], [0.4176], [0.547]], [[0.1461], [0.4284], [0.3952]], [[0.2217], [0.8809], [0.8556]]], [[[0.1073], [0.5884], [0.2226]], [[0.4126], [0.3099], [0.443]], [[0.4431], [0.3177], [0.106]], [[0.0675], [0.6845], [0.7036]]], [[[0.451], [0.2721], [0.2786]], [[0.0815], [0.7913], [0.604]], [[0.5611], [0.4582], [0.6272]], [[0.3179], [0.1129], [0.3581]]], [[[0.1408], [0.4015], [0.9692]], [[0.5911], [0.1534], [0.6764]], [[0.231], [0.7235], [0.5847]], [[0.7511], [0.6839], [0.86]]]]]], 4, Con36170), 
LELU1978 = elu_layer([[[[[0.1707, 0.3137]], [[0.3422, 0.9161]]]]], 4.1009894528034, ELU1978), 
LZer58607 = zero_padding3D_layer(ELU1978, 3, 0, 2, 0, 2, 0, Zer58607), 
LSub64353 = subtract_layer(Con36170,Zer58607, Sub64353), 
LRes49537 = reshape_layer(Sub64353, [4, 4, 6], Res49537), 
LLoc74710 = locally_connected2D_layer([[[[0.5791]], [[0.578]]]], 2, 1,[[[0.1183, 0.556, 0.8264, 0.8046], [0.3526, 0.4851, 0.1649, 0.7621]]],[[[0, 0, 0, 0]]], 1, 1, Loc74710), 
LZer47503 = zero_padding2D_layer(Loc74710, 3, 0, 3, 0, Zer47503), 
LCon18956 = concatenate_layer([Zer47503,[[[[0.1612, 0.759], [0.2476, 0.5535], [0.4348, 0.5108], [0.1891, 0.5159]], [[0.527, 0.8405], [0.9997, 0.6921], [0.8977, 0.2295], [0.9331, 0.6475]], [[0.6225, 0.4213], [0.9303, 0.4969], [0.3731, 0.9787], [0.5826, 0.0843]], [[0.2382, 0.9346], [0.6964, 0.3027], [0.5551, 0.1589], [0.7092, 0.6787]]]]], 3, Con18956), 
LMin54945 = minimum_layer([Res49537,Con18956], Min54945), 
LRes40248 = reshape_layer(Min54945, [4, 24], Res40248), 
LDot51522 = dot_layer(Con2764,Res40248, 2, 2, Dot51522), 
exec_layers([LAve833,LMas73896,LCon2764,LLay84568,LRes21532,LCon36170,LELU1978,LZer58607,LSub64353,LRes49537,LLoc74710,LZer47503,LCon18956,LMin54945,LRes40248,LDot51522],["Ave833","Mas73896","Con2764","Lay84568","Res21532","Con36170","ELU1978","Zer58607","Sub64353","Res49537","Loc74710","Zer47503","Con18956","Min54945","Res40248","Dot51522"],Dot51522,"Dot51522")

Actual (Unparsed): [[[0.5640810, -0.1094150, 0.1386341, 0.8823142]]]

Expected (Unparsed): [[[0.5640810257331639,-0.10941504845412625,0.1386341703634936,0.8823142355851165]]]

Actual:   [[[0.5641, -0.1094, 0.1387, 0.8824]]]

Expected: [[[0.5641, -0.1094, 0.1387, 0.8824]]]