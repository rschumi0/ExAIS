import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max32743 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Max32743 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Ave74607 = tf.keras.layers.Input(shape=([1, 1, 1]))

Max32743 = keras.layers.Maximum(name = 'Max32743', )([in0Max32743,in1Max32743])
Res43767 = keras.layers.Reshape((2, 2, 2), name = 'Res43767', )(Max32743)
Zer7497 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer7497', )(Res43767)
Ave74607 = keras.layers.AveragePooling2D(pool_size=(1, 1), strides=(3, 12), padding='valid', name = 'Ave74607', )(in0Ave74607)
Zer29127 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer29127', )(Ave74607)
Con31685 = keras.layers.Conv2D(2, (2, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con31685', )(Zer29127)
Mul14221 = keras.layers.Multiply(name = 'Mul14221', )([Zer7497,Con31685])
model = tf.keras.models.Model(inputs=[in0Max32743,in1Max32743,in0Ave74607], outputs=Mul14221)
w = model.get_layer('Con31685').get_weights() 
w[0] = np.array([[[[0.217, 0.1454]]], [[[0.303, 0.7039]]]])
w[1] = np.array([0, 0])
model.get_layer('Con31685').set_weights(w) 
in0Max32743 = tf.constant([[[[[0.3176], [0.5148]], [[0.5126], [0.8473]]], [[[0.4204], [0.5968]], [[0.4212], [0.7422]]]]])
in1Max32743 = tf.constant([[[[[0.0967], [0.8768]], [[0.7928], [0.1016]]], [[[0.4296], [0.7042]], [[0.0826], [0.1656]]]]])
in0Ave74607 = tf.constant([[[[1.929]]]])
print (np.array2string(model.predict([in0Max32743,in1Max32743,in0Ave74607],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul14221.png')

LMax32743 = maximum_layer([[[[[[0.3176], [0.5148]], [[0.5126], [0.8473]]], [[[0.4204], [0.5968]], [[0.4212], [0.7422]]]]], [[[[[0.0967], [0.8768]], [[0.7928], [0.1016]]], [[[0.4296], [0.7042]], [[0.0826], [0.1656]]]]]], Max32743), 
LRes43767 = reshape_layer(Max32743, [2, 2, 2], Res43767), 
LZer7497 = zero_padding2D_layer(Res43767, 0, 0, 1, 0, Zer7497), 
LAve74607 = average_pooling2D_layer([[[[1.929]]]], 1, 1, 3, 12, false, Ave74607), 
LZer29127 = zero_padding2D_layer(Ave74607, 1, 1, 1, 1, Zer29127), 
LCon31685 = conv2D_layer(Zer29127, 2, 1,[[[[0.217, 0.1454]]], [[[0.303, 0.7039]]]],[0, 0], 1, 1, false, 1, 1, Con31685), 
LMul14221 = multiply_layer([Zer7497,Con31685], Mul14221), 
exec_layers([LMax32743,LRes43767,LZer7497,LAve74607,LZer29127,LCon31685,LMul14221],["Max32743","Res43767","Zer7497","Ave74607","Zer29127","Con31685","Mul14221"],Mul14221,"Mul14221")

Actual (Unparsed): [[[[0.0000000, 0.0000000], [0.1856331, 1.1905393], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.1798276, 0.1975116], [0.0000000, 0.0000000]]]]

Expected (Unparsed): [[[[0.0,0.0],[0.1856330712,1.1905392940800001],[0.0,0.0]],[[0.0,0.0],[0.17982755279999998,0.19751162172000003],[0.0,0.0]]]]

Actual:   [[[[0, 0], [0.1857, 1.1906], [0, 0]], [[0, 0], [0.1799, 0.1976], [0, 0]]]]

Expected: [[[[0, 0], [0.1857, 1.1906], [0, 0]], [[0, 0], [0.1799, 0.1976], [0, 0]]]]