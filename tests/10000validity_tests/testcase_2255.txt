import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot76247 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot76247 = tf.keras.layers.Input(shape=([2, 3]))
in0Con48789 = tf.keras.layers.Input(shape=([2, 3, 3, 1]))
in0Mul90489 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Mul90489 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Dot52808 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot52808 = tf.keras.layers.Input(shape=([2, 3]))
in0Con46151 = tf.keras.layers.Input(shape=([2, 3, 5]))

Dot76247 = keras.layers.Dot(axes=(1, 1), name = 'Dot76247', )([in0Dot76247,in1Dot76247])
GRU51266 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU51266', )(Dot76247)
Res43728 = keras.layers.Reshape((2, 1), name = 'Res43728', )(GRU51266)
Res63568 = keras.layers.Reshape((2, 1, 1), name = 'Res63568', )(Res43728)
Res36152 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res36152', )(Res63568)
Zer19188 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (2, 0)), name = 'Zer19188', )(Res36152)
Con48789 = keras.layers.Concatenate(axis=4, name = 'Con48789', )([Zer19188,in0Con48789])
Mul90489 = keras.layers.Multiply(name = 'Mul90489', )([in0Mul90489,in1Mul90489])
Zer67438 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (1, 0)), name = 'Zer67438', )(Mul90489)
Ave65524 = keras.layers.Average(name = 'Ave65524', )([Con48789,Zer67438])
Res58631 = keras.layers.Reshape((2, 3, 6), name = 'Res58631', )(Ave65524)
Dot52808 = keras.layers.Dot(axes=(2, 2), name = 'Dot52808', )([in0Dot52808,in1Dot52808])
Res74818 = keras.layers.Reshape((2, 2, 1), name = 'Res74818', )(Dot52808)
Ave66849 = keras.layers.AveragePooling2D(pool_size=(1, 1), strides=(11, 2), padding='same', name = 'Ave66849', )(Res74818)
Zer44293 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer44293', )(Ave66849)
Con46151 = keras.layers.Concatenate(axis=3, name = 'Con46151', )([Zer44293,in0Con46151])
Sub53102 = keras.layers.Subtract(name = 'Sub53102', )([Res58631,Con46151])
Dep96765 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='valid', name = 'Dep96765', )(Sub53102)
model = tf.keras.models.Model(inputs=[in0Dot76247,in1Dot76247,in0Con48789,in0Mul90489,in1Mul90489,in0Dot52808,in1Dot52808,in0Con46151], outputs=Dep96765)
w = model.get_layer('GRU51266').get_weights() 
w[0] = np.array([[1, 2, 5, 10, 6, 4], [9, 9, 3, 6, 10, 6], [3, 1, 1, 9, 8, 5]])
w[1] = np.array([[5, 7, 2, 1, 2, 10], [8, 7, 3, 6, 3, 7]])
w[2] = np.array([2, 9, 7, 4, 9, 10])
model.get_layer('GRU51266').set_weights(w) 
w = model.get_layer('Dep96765').get_weights() 
w[0] = np.array([[[[0.7241], [0.5392], [0.7064], [0.0459], [0.861], [0.5235]]]])
w[1] = np.array([0, 0, 0, 0, 0, 0])
model.get_layer('Dep96765').set_weights(w) 
in0Dot76247 = tf.constant([[[0.5832, 0.6343, 0.6295], [0.9359, 0.743, 0.0063]]])
in1Dot76247 = tf.constant([[[0.3337, 0.7959, 0.9881], [0.5308, 0.2549, 0.0135]]])
in0Con48789 = tf.constant([[[[[0.9738], [0.5213], [0.633]], [[0.7277], [0.6944], [0.8282]], [[0.7487], [0.0769], [0.0898]]], [[[0.5461], [0.1012], [0.237]], [[0.8952], [0.492], [0.6565]], [[0.5844], [0.843], [0.0434]]]]])
in0Mul90489 = tf.constant([[[[[0.8272, 0.6306], [0.5122, 0.3161]], [[0.0694, 0.6729], [0.4554, 0.0913]]]]])
in1Mul90489 = tf.constant([[[[[0.661, 0.1581], [0.3019, 0.8751]], [[0.529, 0.2396], [0.9343, 0.9484]]]]])
in0Dot52808 = tf.constant([[[0.7117, 0.3088, 0.8204], [0.6509, 0.7072, 0.4773]]])
in1Dot52808 = tf.constant([[[0.8733, 0.4446, 0.2848], [0.7906, 0.0823, 0.5922]]])
in0Con46151 = tf.constant([[[[0.3704, 0.3408, 0.0505, 0.5166, 0.2323], [0.4081, 0.0504, 0.329, 0.2398, 0.2198], [0.8395, 0.4136, 0.2339, 0.888, 0.4418]], [[0.5366, 0.1882, 0.8581, 0.7595, 0.887], [0.4035, 0.3414, 0.5657, 0.6688, 0.2777], [0.6452, 0.799, 0.2704, 0.1583, 0.1522]]]])
print (np.array2string(model.predict([in0Dot76247,in1Dot76247,in0Con48789,in0Mul90489,in1Mul90489,in0Dot52808,in1Dot52808,in0Con46151],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dep96765.png')

LDot76247 = dot_layer([[[0.5832, 0.6343, 0.6295], [0.9359, 0.743, 0.0063]]], [[[0.3337, 0.7959, 0.9881], [0.5308, 0.2549, 0.0135]]], 1, 1, Dot76247), 
LGRU51266 = gru_layer(Dot76247,[[1, 2, 5, 10, 6, 4], [9, 9, 3, 6, 10, 6], [3, 1, 1, 9, 8, 5]],[[5, 7, 2, 1, 2, 10], [8, 7, 3, 6, 3, 7]],[2, 9, 7, 4, 9, 10], false, GRU51266), 
LRes43728 = reshape_layer(GRU51266, [2, 1], Res43728), 
LRes63568 = reshape_layer(Res43728, [2, 1, 1], Res63568), 
LRes36152 = reshape_layer(Res63568, [2, 1, 1, 1], Res36152), 
LZer19188 = zero_padding3D_layer(Res36152, 0, 0, 2, 0, 2, 0, Zer19188), 
LCon48789 = concatenate_layer([Zer19188,[[[[[0.9738], [0.5213], [0.633]], [[0.7277], [0.6944], [0.8282]], [[0.7487], [0.0769], [0.0898]]], [[[0.5461], [0.1012], [0.237]], [[0.8952], [0.492], [0.6565]], [[0.5844], [0.843], [0.0434]]]]]], 4, Con48789), 
LMul90489 = multiply_layer([[[[[[0.8272, 0.6306], [0.5122, 0.3161]], [[0.0694, 0.6729], [0.4554, 0.0913]]]]], [[[[[0.661, 0.1581], [0.3019, 0.8751]], [[0.529, 0.2396], [0.9343, 0.9484]]]]]], Mul90489), 
LZer67438 = zero_padding3D_layer(Mul90489, 1, 0, 1, 0, 1, 0, Zer67438), 
LAve65524 = average_layer([Con48789,Zer67438], Ave65524), 
LRes58631 = reshape_layer(Ave65524, [2, 3, 6], Res58631), 
LDot52808 = dot_layer([[[0.7117, 0.3088, 0.8204], [0.6509, 0.7072, 0.4773]]], [[[0.8733, 0.4446, 0.2848], [0.7906, 0.0823, 0.5922]]], 2, 2, Dot52808), 
LRes74818 = reshape_layer(Dot52808, [2, 2, 1], Res74818), 
LAve66849 = average_pooling2D_layer(Res74818, 1, 1, 11, 2, true, Ave66849), 
LZer44293 = zero_padding2D_layer(Ave66849, 1, 0, 2, 0, Zer44293), 
LCon46151 = concatenate_layer([Zer44293,[[[[0.3704, 0.3408, 0.0505, 0.5166, 0.2323], [0.4081, 0.0504, 0.329, 0.2398, 0.2198], [0.8395, 0.4136, 0.2339, 0.888, 0.4418]], [[0.5366, 0.1882, 0.8581, 0.7595, 0.887], [0.4035, 0.3414, 0.5657, 0.6688, 0.2777], [0.6452, 0.799, 0.2704, 0.1583, 0.1522]]]]], 3, Con46151), 
LSub53102 = subtract_layer(Res58631,Con46151, Sub53102), 
LDep96765 = depthwise_conv2D_layer(Sub53102, 1, 1,[[[[0.7241], [0.5392], [0.7064], [0.0459], [0.861], [0.5235]]]],[0, 0, 0, 0, 0, 0], 1, 1, false, Dep96765), 
exec_layers([LDot76247,LGRU51266,LRes43728,LRes63568,LRes36152,LZer19188,LCon48789,LMul90489,LZer67438,LAve65524,LRes58631,LDot52808,LRes74818,LAve66849,LZer44293,LCon46151,LSub53102,LDep96765],["Dot76247","GRU51266","Res43728","Res63568","Res36152","Zer19188","Con48789","Mul90489","Zer67438","Ave65524","Res58631","Dot52808","Res74818","Ave66849","Zer44293","Con46151","Sub53102","Dep96765"],Dep96765,"Dep96765")

Actual (Unparsed): [[[[0.0000000, 0.0628168, -0.2407411, 0.0096459, -0.4447926, 0.0440787], [0.0000000, -0.0238596, -0.0356026, 0.0008354, -0.2064678, 0.1017160], [0.0000000, -0.2508089, -0.2921670, -0.0089712, -0.7644710, -0.2077771]], [[0.0000000, -0.1421062, -0.1329445, -0.0370642, -0.6539295, -0.4023098], [0.0000000, 0.0237787, -0.0480425, -0.0123862, -0.5092672, 0.0988680], [-0.7186476, -0.1903376, -0.5514467, 0.0106356, 0.0468732, -0.0456521]]]]

Expected (Unparsed): [[[[0.0,0.06281679999999999,-0.24074112,0.009645885000000002,-0.4447925999999999,0.0440787],[0.0,-0.023859600000000005,-0.03560256,0.0008353799999999998,-0.2064678,0.10171605],[0.0,-0.25080888,-0.29216704000000004,-0.008971155000000001,-0.7644710052140709,-0.20777715]],[[0.0,-0.14210615999999998,-0.13294448,-0.03706425,-0.6539294999999999,-0.40230974999999997],[0.0,0.023778719999999986,-0.04804254655999998,-0.012386164113,-0.5092672160099999,0.0988679770425],[-0.7186475342409999,-0.1903376,-0.5514467096800001,0.010635645978000003,0.04687316600716532,-0.045652100189999996]]]]

Actual:   [[[[0, 0.0629, -0.2407, 0.0097, -0.4447, 0.0441], [0, -0.0238, -0.0356, 0.0009, -0.2064, 0.1018], [0, -0.2508, -0.2921, -0.0089, -0.7644, -0.2077]], [[0, -0.1421, -0.1329, -0.037, -0.6539, -0.4023], [0, 0.0238, -0.048, -0.0123, -0.5092, 0.0989], [-0.7186, -0.1903, -0.5514, 0.0107, 0.0469, -0.0456]]]]

Expected: [[[[0, 0.0629, -0.2407, 0.0097, -0.4447, 0.0441], [0, -0.0238, -0.0356, 0.0009, -0.2064, 0.1018], [0, -0.2508, -0.2921, -0.0089, -0.7644, -0.2077]], [[0, -0.1421, -0.1329, -0.037, -0.6539, -0.4023], [0, 0.0238, -0.048, -0.0123, -0.5092, 0.0989], [-0.7186, -0.1903, -0.5514, 0.0107, 0.0469, -0.0456]]]]