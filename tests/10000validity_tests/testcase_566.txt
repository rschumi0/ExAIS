import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc90969 = tf.keras.layers.Input(shape=([1, 1]))
in0Dot26719 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot26719 = tf.keras.layers.Input(shape=([3, 3]))
in0Con34659 = tf.keras.layers.Input(shape=([3, 1]))

Loc90969 = keras.layers.LocallyConnected1D(4, (1),strides=(9), name = 'Loc90969', )(in0Loc90969)
Zer43080 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer43080', )(Loc90969)
Dot26719 = keras.layers.Dot(axes=(2, 2), name = 'Dot26719', )([in0Dot26719,in1Dot26719])
Con34659 = keras.layers.Concatenate(axis=2, name = 'Con34659', )([Dot26719,in0Con34659])
Mul82291 = keras.layers.Multiply(name = 'Mul82291', )([Zer43080,Con34659])
Sim26638 = keras.layers.SimpleRNN(2,name = 'Sim26638', )(Mul82291)
model = tf.keras.models.Model(inputs=[in0Loc90969,in0Dot26719,in1Dot26719,in0Con34659], outputs=Sim26638)
w = model.get_layer('Loc90969').get_weights() 
w[0] = np.array([[[0.7266, 0.3213, 0.9289, 0.6882]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc90969').set_weights(w) 
w = model.get_layer('Sim26638').get_weights() 
w[0] = np.array([[10, 3], [6, 7], [8, 6], [10, 1]])
w[1] = np.array([[3, 3], [3, 10]])
w[2] = np.array([2, 7])
model.get_layer('Sim26638').set_weights(w) 
in0Loc90969 = tf.constant([[[0.6499]]])
in0Dot26719 = tf.constant([[[0.406, 0.9967, 0.7961], [0.3548, 0.4214, 0.9029], [0.6099, 0.2224, 0.7732]]])
in1Dot26719 = tf.constant([[[0.1997, 0.5372, 0.6527], [0.5968, 0.1469, 0.4109], [0.8988, 0.6147, 0.0393]]])
in0Con34659 = tf.constant([[[0.5262], [0.3776], [0.5774]]])
print (np.array2string(model.predict([in0Loc90969,in0Dot26719,in1Dot26719,in0Con34659],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sim26638.png')

LLoc90969 = locally_connected1D_layer([[[0.6499]]], 1,[[[0.7266, 0.3213, 0.9289, 0.6882]]],[[0, 0, 0, 0]], 9, Loc90969), 
LZer43080 = zero_padding1D_layer(Loc90969, 2, 0, Zer43080), 
LDot26719 = dot_layer([[[0.406, 0.9967, 0.7961], [0.3548, 0.4214, 0.9029], [0.6099, 0.2224, 0.7732]]], [[[0.1997, 0.5372, 0.6527], [0.5968, 0.1469, 0.4109], [0.8988, 0.6147, 0.0393]]], 2, 2, Dot26719), 
LCon34659 = concatenate_layer([Dot26719,[[[0.5262], [0.3776], [0.5774]]]], 2, Con34659), 
LMul82291 = multiply_layer([Zer43080,Con34659], Mul82291), 
LSim26638 = simple_rnn_layer(Mul82291,[[10, 3], [6, 7], [8, 6], [10, 1]],[[3, 3], [3, 10]],[2, 7], Sim26638), 
exec_layers([LLoc90969,LZer43080,LDot26719,LCon34659,LMul82291,LSim26638],["Loc90969","Zer43080","Dot26719","Con34659","Mul82291","Sim26638"],Sim26638,"Sim26638")

Actual (Unparsed): [[1.0000000, 1.0000000]]

Expected (Unparsed): [[0.9999999999999998,1.0]]

Actual:   [[1, 1]]

Expected: [[1, 1]]