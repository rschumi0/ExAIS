import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0GRU29336 = tf.keras.layers.Input(shape=([3, 1]))

GRU29336 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU29336', )(in0GRU29336)
Res64235 = keras.layers.Reshape((3, 1), name = 'Res64235', )(GRU29336)
Res58775 = keras.layers.Reshape((3, 1, 1), name = 'Res58775', )(Res64235)
Max26553 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max26553', )(Res58775)
Res30136 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res30136', )(Max26553)
Glo22327 = keras.layers.GlobalAveragePooling3D(name = 'Glo22327', )(Res30136)
model = tf.keras.models.Model(inputs=[in0GRU29336], outputs=Glo22327)
w = model.get_layer('GRU29336').get_weights() 
w[0] = np.array([[1, 3, 8, 6, 2, 7, 4, 9, 1]])
w[1] = np.array([[8, 1, 1, 5, 9, 10, 9, 6, 6], [2, 10, 4, 5, 3, 2, 9, 7, 10], [1, 1, 1, 6, 6, 3, 10, 10, 5]])
w[2] = np.array([4, 6, 5, 7, 2, 1, 5, 10, 10])
model.get_layer('GRU29336').set_weights(w) 
in0GRU29336 = tf.constant([[[10], [1], [10]]])
print (np.array2string(model.predict([in0GRU29336],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo22327.png')

LGRU29336 = gru_layer([[[10], [1], [10]]],[[1, 3, 8, 6, 2, 7, 4, 9, 1]],[[8, 1, 1, 5, 9, 10, 9, 6, 6], [2, 10, 4, 5, 3, 2, 9, 7, 10], [1, 1, 1, 6, 6, 3, 10, 10, 5]],[4, 6, 5, 7, 2, 1, 5, 10, 10], false, GRU29336), 
LRes64235 = reshape_layer(GRU29336, [3, 1], Res64235), 
LRes58775 = reshape_layer(Res64235, [3, 1, 1], Res58775), 
LMax26553 = max_pool2D_layer(Res58775, 1, 1, Max26553), 
LRes30136 = reshape_layer(Max26553, [3, 1, 1, 1], Res30136), 
LGlo22327 = global_average_pooling3D_layer(Res30136, Glo22327), 
exec_layers([LGRU29336,LRes64235,LRes58775,LMax26553,LRes30136,LGlo22327],["GRU29336","Res64235","Res58775","Max26553","Res30136","Glo22327"],Glo22327,"Glo22327")

Actual (Unparsed): [[0.0022734]]

Expected (Unparsed): [[0.0022733566519415947]]

Actual:   [[0.0023]]

Expected: [[0.0023]]