import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub25660 = tf.keras.layers.Input(shape=([2]))
in1Sub25660 = tf.keras.layers.Input(shape=([2]))
in0Min1289 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Min1289 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Max42478 = tf.keras.layers.Input(shape=([2, 2]))
in1Max42478 = tf.keras.layers.Input(shape=([2, 2]))

Sub25660 = keras.layers.Subtract(name = 'Sub25660', )([in0Sub25660,in1Sub25660])
Res72351 = keras.layers.Reshape((2, 1), name = 'Res72351', )(Sub25660)
Res87767 = keras.layers.Reshape((2, 1, 1), name = 'Res87767', )(Res72351)
Ave62015 = keras.layers.AveragePooling2D(pool_size=(1, 1), name = 'Ave62015', )(Res87767)
Res89162 = keras.layers.Reshape((2, 1), name = 'Res89162', )(Ave62015)
Min1289 = keras.layers.Minimum(name = 'Min1289', )([in0Min1289,in1Min1289])
Res78024 = keras.layers.Reshape((2, 1), name = 'Res78024', )(Min1289)
Dot50573 = keras.layers.Dot(axes=(2, 2), name = 'Dot50573', )([Res89162,Res78024])
Per40099 = keras.layers.Permute((1,2), name = 'Per40099',)(Dot50573)
Max42478 = keras.layers.Maximum(name = 'Max42478', )([in0Max42478,in1Max42478])
Ave90631 = keras.layers.Average(name = 'Ave90631', )([Per40099,Max42478])
model = tf.keras.models.Model(inputs=[in0Sub25660,in1Sub25660,in0Min1289,in1Min1289,in0Max42478,in1Max42478], outputs=Ave90631)
in0Sub25660 = tf.constant([[0.4331, 0.802]])
in1Sub25660 = tf.constant([[0.0303, 0.6655]])
in0Min1289 = tf.constant([[[[0.1453, 0.425]]]])
in1Min1289 = tf.constant([[[[0.2348, 0.2893]]]])
in0Max42478 = tf.constant([[[0.9633, 0.3987], [0.6196, 0.7029]]])
in1Max42478 = tf.constant([[[0.6646, 0.7552], [0.4633, 0.4205]]])
print (np.array2string(model.predict([in0Sub25660,in1Sub25660,in0Min1289,in1Min1289,in0Max42478,in1Max42478],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave90631.png')

LSub25660 = subtract_layer([[0.4331, 0.802]], [[0.0303, 0.6655]], Sub25660), 
LRes72351 = reshape_layer(Sub25660, [2, 1], Res72351), 
LRes87767 = reshape_layer(Res72351, [2, 1, 1], Res87767), 
LAve62015 = average_pooling2D_layer(Res87767, 1, 1, Ave62015), 
LRes89162 = reshape_layer(Ave62015, [2, 1], Res89162), 
LMin1289 = minimum_layer([[[[[0.1453, 0.425]]]], [[[[0.2348, 0.2893]]]]], Min1289), 
LRes78024 = reshape_layer(Min1289, [2, 1], Res78024), 
LDot50573 = dot_layer(Res89162,Res78024, 2, 2, Dot50573), 
LPer40099 = permute_layer(Dot50573, 1,2, Per40099), 
LMax42478 = maximum_layer([[[[0.9633, 0.3987], [0.6196, 0.7029]]], [[[0.6646, 0.7552], [0.4633, 0.4205]]]], Max42478), 
LAve90631 = average_layer([Per40099,Max42478], Ave90631), 
exec_layers([LSub25660,LRes72351,LRes87767,LAve62015,LRes89162,LMin1289,LRes78024,LDot50573,LPer40099,LMax42478,LAve90631],["Sub25660","Res72351","Res87767","Ave62015","Res89162","Min1289","Res78024","Dot50573","Per40099","Max42478","Ave90631"],Ave90631,"Ave90631")

Actual (Unparsed): [[[0.5109134, 0.4358650], [0.3197167, 0.3711947]]]

Expected (Unparsed): [[[0.5109134200000001,0.43586502],[0.31971672500000003,0.371194725]]]

Actual:   [[[0.511, 0.4359], [0.3198, 0.3712]]]

Expected: [[[0.511, 0.4359], [0.3198, 0.3712]]]