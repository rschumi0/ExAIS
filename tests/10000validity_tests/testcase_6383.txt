import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave77570 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave77570 = tf.keras.layers.Input(shape=([2, 1]))
in0Con34373 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Max92566 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Max92566 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Max92733 = tf.keras.layers.Input(shape=([1, 1]))
in1Max92733 = tf.keras.layers.Input(shape=([1, 1]))
in0Con70703 = tf.keras.layers.Input(shape=([2, 3]))

Ave77570 = keras.layers.Average(name = 'Ave77570', )([in0Ave77570,in1Ave77570])
Sim88831 = keras.layers.SimpleRNN(1,name = 'Sim88831', )(Ave77570)
Res65140 = keras.layers.Reshape((1, 1), name = 'Res65140', )(Sim88831)
Res87183 = keras.layers.Reshape((1, 1, 1), name = 'Res87183', )(Res65140)
Zer21443 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer21443', )(Res87183)
Con34373 = keras.layers.Concatenate(axis=3, name = 'Con34373', )([Zer21443,in0Con34373])
Max92566 = keras.layers.Maximum(name = 'Max92566', )([in0Max92566,in1Max92566])
Sub94950 = keras.layers.Subtract(name = 'Sub94950', )([Con34373,Max92566])
Res48322 = keras.layers.Reshape((2, 4), name = 'Res48322', )(Sub94950)
Max92733 = keras.layers.Maximum(name = 'Max92733', )([in0Max92733,in1Max92733])
Zer27632 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer27632', )(Max92733)
Con70703 = keras.layers.Concatenate(axis=2, name = 'Con70703', )([Zer27632,in0Con70703])
Mul10706 = keras.layers.Multiply(name = 'Mul10706', )([Res48322,Con70703])
model = tf.keras.models.Model(inputs=[in0Ave77570,in1Ave77570,in0Con34373,in0Max92566,in1Max92566,in0Max92733,in1Max92733,in0Con70703], outputs=Mul10706)
w = model.get_layer('Sim88831').get_weights() 
w[0] = np.array([[8]])
w[1] = np.array([[6]])
w[2] = np.array([4])
model.get_layer('Sim88831').set_weights(w) 
in0Ave77570 = tf.constant([[[0.5057], [0.3532]]])
in1Ave77570 = tf.constant([[[0.4335], [0.2623]]])
in0Con34373 = tf.constant([[[[0.3062], [0.5355]], [[0.7938], [0.9712]]]])
in0Max92566 = tf.constant([[[[0.9802, 0.8567], [0.1848, 0.9497]], [[0.7011, 0.3909], [0.8898, 0.191]]]])
in1Max92566 = tf.constant([[[[0.854, 0.5256], [0.8726, 0.5197]], [[0.0193, 0.5059], [0.4254, 0.9362]]]])
in0Max92733 = tf.constant([[[0.2212]]])
in1Max92733 = tf.constant([[[0.3722]]])
in0Con70703 = tf.constant([[[0.4327, 0.4545, 0.8618], [0.9216, 0.5039, 0.409]]])
print (np.array2string(model.predict([in0Ave77570,in1Ave77570,in0Con34373,in0Max92566,in1Max92566,in0Max92733,in1Max92733,in0Con70703],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul10706.png')

LAve77570 = average_layer([[[[0.5057], [0.3532]]], [[[0.4335], [0.2623]]]], Ave77570), 
LSim88831 = simple_rnn_layer(Ave77570,[[8]],[[6]],[4], Sim88831), 
LRes65140 = reshape_layer(Sim88831, [1, 1], Res65140), 
LRes87183 = reshape_layer(Res65140, [1, 1, 1], Res87183), 
LZer21443 = zero_padding2D_layer(Res87183, 1, 0, 1, 0, Zer21443), 
LCon34373 = concatenate_layer([Zer21443,[[[[0.3062], [0.5355]], [[0.7938], [0.9712]]]]], 3, Con34373), 
LMax92566 = maximum_layer([[[[[0.9802, 0.8567], [0.1848, 0.9497]], [[0.7011, 0.3909], [0.8898, 0.191]]]], [[[[0.854, 0.5256], [0.8726, 0.5197]], [[0.0193, 0.5059], [0.4254, 0.9362]]]]], Max92566), 
LSub94950 = subtract_layer(Con34373,Max92566, Sub94950), 
LRes48322 = reshape_layer(Sub94950, [2, 4], Res48322), 
LMax92733 = maximum_layer([[[[0.2212]]], [[[0.3722]]]], Max92733), 
LZer27632 = zero_padding1D_layer(Max92733, 1, 0, Zer27632), 
LCon70703 = concatenate_layer([Zer27632,[[[0.4327, 0.4545, 0.8618], [0.9216, 0.5039, 0.409]]]], 2, Con70703), 
LMul10706 = multiply_layer([Res48322,Con70703], Mul10706), 
exec_layers([LAve77570,LSim88831,LRes65140,LRes87183,LZer21443,LCon34373,LMax92566,LSub94950,LRes48322,LMax92733,LZer27632,LCon70703,LMul10706],["Ave77570","Sim88831","Res65140","Res87183","Zer21443","Con34373","Max92566","Sub94950","Res48322","Max92733","Zer27632","Con70703","Mul10706"],Mul10706,"Mul10706")

Actual (Unparsed): [[[-0.0000000, -0.2382014, -0.3965967, -0.3569576], [-0.2609494, 0.2653286, 0.0555298, 0.0143150]]]

Expected (Unparsed): [[[-0.0,-0.23820134999999998,-0.3965967,-0.35695756],[-0.26094942,0.26532863999999995,0.05552977998489848,0.014314999999999967]]]

Actual:   [[[-0, -0.2382, -0.3965, -0.3569], [-0.2609, 0.2654, 0.0556, 0.0144]]]

Expected: [[[-0, -0.2382, -0.3965, -0.3569], [-0.2609, 0.2654, 0.0556, 0.0144]]]