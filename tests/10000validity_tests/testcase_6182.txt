import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave8678 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Ave8678 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Sep99514 = tf.keras.layers.Input(shape=([1, 2]))

Ave8678 = keras.layers.Average(name = 'Ave8678', )([in0Ave8678,in1Ave8678])
Res86062 = keras.layers.Reshape((1, 2, 4), name = 'Res86062', )(Ave8678)
Res13265 = keras.layers.Reshape((1, 8), name = 'Res13265', )(Res86062)
Sep99514 = keras.layers.SeparableConv1D(3, (1),strides=(1), padding='same', name = 'Sep99514', )(in0Sep99514)
Dot71891 = keras.layers.Dot(axes=(1, 1), name = 'Dot71891', )([Res13265,Sep99514])
Sep3545 = keras.layers.SeparableConv1D(4, (3),strides=(6), padding='same', name = 'Sep3545', )(Dot71891)
model = tf.keras.models.Model(inputs=[in0Ave8678,in1Ave8678,in0Sep99514], outputs=Sep3545)
w = model.get_layer('Sep99514').get_weights() 
w[0] = np.array([[[0.7437], [0.1054]]])
w[1] = np.array([[[0.81, 0.8835, 0.6468], [0.6335, 0.1217, 0.732]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep99514').set_weights(w) 
w = model.get_layer('Sep3545').get_weights() 
w[0] = np.array([[[0.6252], [0.6392], [0.5523]], [[0.7704], [0.9572], [0.7988]], [[0.6499], [0.9329], [0.6174]]])
w[1] = np.array([[[0.6996, 0.98, 0.324, 0.7066], [0.644, 0.3414, 0.9064, 0.149], [0.3147, 0.6196, 0.8627, 0.6899]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep3545').set_weights(w) 
in0Ave8678 = tf.constant([[[[[0.3296, 0.8866], [0.8547, 0.5907]], [[0.784, 0.6585], [0.396, 0.3383]]]]])
in1Ave8678 = tf.constant([[[[[0.9278, 0.4821], [0.1752, 0.2411]], [[0.08, 0.8628], [0.0284, 0.1949]]]]])
in0Sep99514 = tf.constant([[[0.2367, 0.5076]]])
print (np.array2string(model.predict([in0Ave8678,in1Ave8678,in0Sep99514],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sep3545.png')

LAve8678 = average_layer([[[[[[0.3296, 0.8866], [0.8547, 0.5907]], [[0.784, 0.6585], [0.396, 0.3383]]]]], [[[[[0.9278, 0.4821], [0.1752, 0.2411]], [[0.08, 0.8628], [0.0284, 0.1949]]]]]], Ave8678), 
LRes86062 = reshape_layer(Ave8678, [1, 2, 4], Res86062), 
LRes13265 = reshape_layer(Res86062, [1, 8], Res13265), 
LSep99514 = separable_conv1D_layer([[[0.2367, 0.5076]]], 1,[[[[0.7437], [0.1054]]],[[[0.81, 0.8835, 0.6468], [0.6335, 0.1217, 0.732]]]],[0, 0, 0], 1, true, Sep99514), 
LDot71891 = dot_layer(Res13265,Sep99514, 1, 1, Dot71891), 
LSep3545 = separable_conv1D_layer(Dot71891, 3,[[[[0.6252], [0.6392], [0.5523]], [[0.7704], [0.9572], [0.7988]], [[0.6499], [0.9329], [0.6174]]],[[[0.6996, 0.98, 0.324, 0.7066], [0.644, 0.3414, 0.9064, 0.149], [0.3147, 0.6196, 0.8627, 0.6899]]]],[0, 0, 0, 0], 6, true, Sep3545), 
exec_layers([LAve8678,LRes86062,LRes13265,LSep99514,LDot71891,LSep3545],["Ave8678","Res86062","Res13265","Sep99514","Dot71891","Sep3545"],Sep3545,"Sep3545")

Actual (Unparsed): [[[0.3737219, 0.4169838, 0.4575188, 0.3215413], [0.0984209, 0.1113904, 0.1203156, 0.0864465]]]

Expected (Unparsed): [[[0.37372193317826,0.41698375890576156,0.4575188122540057,0.32154130981103746],[0.09842091385138674,0.1113903634835694,0.12031559131308733,0.08644649203746352]]]

Actual:   [[[0.3738, 0.417, 0.4576, 0.3216], [0.0985, 0.1114, 0.1204, 0.0865]]]

Expected: [[[0.3738, 0.417, 0.4576, 0.3216], [0.0985, 0.1114, 0.1204, 0.0865]]]