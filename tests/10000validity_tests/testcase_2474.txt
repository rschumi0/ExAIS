import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0PRe51081 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Cro7217 = tf.keras.layers.Input(shape=([1, 1]))
in0Con22545 = tf.keras.layers.Input(shape=([2, 7]))
in0Max67485 = tf.keras.layers.Input(shape=([1, 2]))
in0Con47625 = tf.keras.layers.Input(shape=([1, 6]))
in0Add31253 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Add31253 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Mul56561 = tf.keras.layers.Input(shape=([1, 2]))
in1Mul56561 = tf.keras.layers.Input(shape=([1, 2]))
in0Con83716 = tf.keras.layers.Input(shape=([1, 6]))

PRe51081 = keras.layers.PReLU(name = 'PRe51081', input_shape=(2, 1, 1))(in0PRe51081)
Res23737 = keras.layers.Reshape((2, 1), name = 'Res23737', )(PRe51081)
GRU828 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU828', )(Res23737)
Res82581 = keras.layers.Reshape((2, 1), name = 'Res82581', )(GRU828)
Cro7217 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro7217', )(in0Cro7217)
Bat3730 = keras.layers.BatchNormalization(axis=2, epsilon=0.8590012360131792,  name = 'Bat3730', )(Cro7217)
Zer26414 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer26414', )(Bat3730)
Add80874 = keras.layers.Add(name = 'Add80874', )([Res82581,Zer26414])
Con22545 = keras.layers.Concatenate(axis=2, name = 'Con22545', )([Add80874,in0Con22545])
Max67485 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max67485', )(in0Max67485)
Con47625 = keras.layers.Concatenate(axis=2, name = 'Con47625', )([Max67485,in0Con47625])
Add31253 = keras.layers.Add(name = 'Add31253', )([in0Add31253,in1Add31253])
Res94327 = keras.layers.Reshape((1, 2, 4), name = 'Res94327', )(Add31253)
Res42417 = keras.layers.Reshape((1, 8), name = 'Res42417', )(Res94327)
Mul56561 = keras.layers.Multiply(name = 'Mul56561', )([in0Mul56561,in1Mul56561])
Con83716 = keras.layers.Concatenate(axis=2, name = 'Con83716', )([Mul56561,in0Con83716])
Min84213 = keras.layers.Minimum(name = 'Min84213', )([Res42417,Con83716])
Min38746 = keras.layers.Minimum(name = 'Min38746', )([Con47625,Min84213])
Zer20481 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer20481', )(Min38746)
Mul63602 = keras.layers.Multiply(name = 'Mul63602', )([Con22545,Zer20481])
model = tf.keras.models.Model(inputs=[in0PRe51081,in0Cro7217,in0Con22545,in0Max67485,in0Con47625,in0Add31253,in1Add31253,in0Mul56561,in1Mul56561,in0Con83716], outputs=Mul63602)
w = model.get_layer('PRe51081').get_weights() 
w[0] = np.array([[[0.9051]], [[0.1163]]])
model.get_layer('PRe51081').set_weights(w) 
w = model.get_layer('GRU828').get_weights() 
w[0] = np.array([[6, 8, 6, 6, 3, 8]])
w[1] = np.array([[5, 6, 10, 10, 9, 3], [7, 6, 7, 7, 4, 5]])
w[2] = np.array([10, 4, 9, 5, 9, 8])
model.get_layer('GRU828').set_weights(w) 
w = model.get_layer('Bat3730').get_weights() 
w[0] = np.array([0.939])
w[1] = np.array([0.8671])
w[2] = np.array([0.5019])
w[3] = np.array([0.0002])
model.get_layer('Bat3730').set_weights(w) 
in0PRe51081 = tf.constant([[[[0.0857]], [[0.0763]]]])
in0Cro7217 = tf.constant([[[1.1087]]])
in0Con22545 = tf.constant([[[0.6536, 0.9098, 0.2238, 0.9011, 0.8664, 0.7583, 0.8418], [0.986, 0.3287, 0.1509, 0.7466, 0.6438, 0.8607, 0.8848]]])
in0Max67485 = tf.constant([[[1.3346, 1.6869]]])
in0Con47625 = tf.constant([[[0.1266, 0.7162, 0.6033, 0.8891, 0.0266, 0.6903]]])
in0Add31253 = tf.constant([[[[[0.8776, 0.606], [0.2791, 0.2302]], [[0.5955, 0.3958], [0.5723, 0.773]]]]])
in1Add31253 = tf.constant([[[[[0.2306, 0.8955], [0.19, 0.5659]], [[0.7748, 0.0668], [0.5531, 0.0644]]]]])
in0Mul56561 = tf.constant([[[0.5514, 0.5977]]])
in1Mul56561 = tf.constant([[[0.456, 0.7279]]])
in0Con83716 = tf.constant([[[0.4714, 0.9859, 0.8544, 0.4632, 0.6866, 0.2571]]])
print (np.array2string(model.predict([in0PRe51081,in0Cro7217,in0Con22545,in0Max67485,in0Con47625,in0Add31253,in1Add31253,in0Mul56561,in1Mul56561,in0Con83716],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul63602.png')

LPRe51081 = prelu_layer([[[[0.0857]], [[0.0763]]]], [[[0.9051]], [[0.1163]]], PRe51081), 
LRes23737 = reshape_layer(PRe51081, [2, 1], Res23737), 
LGRU828 = gru_layer(Res23737,[[6, 8, 6, 6, 3, 8]],[[5, 6, 10, 10, 9, 3], [7, 6, 7, 7, 4, 5]],[10, 4, 9, 5, 9, 8], false, GRU828), 
LRes82581 = reshape_layer(GRU828, [2, 1], Res82581), 
LCro7217 = cropping1D_layer([[[1.1087]]], 0, 0, Cro7217), 
LBat3730 = batch_normalization_layer(Cro7217, 2, 0.8590012360131792, [0.939], [0.8671], [0.5019], [0.0002], Bat3730), 
LZer26414 = zero_padding1D_layer(Bat3730, 1, 0, Zer26414), 
LAdd80874 = add_layer([Res82581,Zer26414], Add80874), 
LCon22545 = concatenate_layer([Add80874,[[[0.6536, 0.9098, 0.2238, 0.9011, 0.8664, 0.7583, 0.8418], [0.986, 0.3287, 0.1509, 0.7466, 0.6438, 0.8607, 0.8848]]]], 2, Con22545), 
LMax67485 = max_pool1D_layer([[[1.3346, 1.6869]]], 1, Max67485), 
LCon47625 = concatenate_layer([Max67485,[[[0.1266, 0.7162, 0.6033, 0.8891, 0.0266, 0.6903]]]], 2, Con47625), 
LAdd31253 = add_layer([[[[[[0.8776, 0.606], [0.2791, 0.2302]], [[0.5955, 0.3958], [0.5723, 0.773]]]]], [[[[[0.2306, 0.8955], [0.19, 0.5659]], [[0.7748, 0.0668], [0.5531, 0.0644]]]]]], Add31253), 
LRes94327 = reshape_layer(Add31253, [1, 2, 4], Res94327), 
LRes42417 = reshape_layer(Res94327, [1, 8], Res42417), 
LMul56561 = multiply_layer([[[[0.5514, 0.5977]]], [[[0.456, 0.7279]]]], Mul56561), 
LCon83716 = concatenate_layer([Mul56561,[[[0.4714, 0.9859, 0.8544, 0.4632, 0.6866, 0.2571]]]], 2, Con83716), 
LMin84213 = minimum_layer([Res42417,Con83716], Min84213), 
LMin38746 = minimum_layer([Con47625,Min84213], Min38746), 
LZer20481 = zero_padding1D_layer(Min38746, 1, 0, Zer20481), 
LMul63602 = multiply_layer([Con22545,Zer20481], Mul63602), 
exec_layers([LPRe51081,LRes23737,LGRU828,LRes82581,LCro7217,LBat3730,LZer26414,LAdd80874,LCon22545,LMax67485,LCon47625,LAdd31253,LRes94327,LRes42417,LMul56561,LCon83716,LMin84213,LMin38746,LZer20481,LMul63602],["PRe51081","Res23737","GRU828","Res82581","Cro7217","Bat3730","Zer26414","Add80874","Con22545","Max67485","Con47625","Add31253","Res94327","Res42417","Mul56561","Con83716","Min84213","Min38746","Zer20481","Mul63602"],Mul63602,"Mul63602")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.3772043, 0.4289749, 0.0416134, 0.1080746, 0.4504237, 0.2978219, 0.0228946, 0.2274821]]]

Expected (Unparsed): [[[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.37720430236752167,0.42897490837999996,0.04161342,0.10807458,0.45042378,0.29782188000000004,0.02289462,0.22748208]]]

Actual:   [[[0, 0, 0, 0, 0, 0, 0, 0], [0.3773, 0.429, 0.0417, 0.1081, 0.4505, 0.2979, 0.0229, 0.2275]]]

Expected: [[[0, 0, 0, 0, 0, 0, 0, 0], [0.3773, 0.429, 0.0417, 0.1081, 0.4505, 0.2979, 0.0229, 0.2275]]]