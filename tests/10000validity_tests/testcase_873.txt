import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul23197 = tf.keras.layers.Input(shape=([1, 2]))
in1Mul23197 = tf.keras.layers.Input(shape=([1, 2]))
in0Sub82512 = tf.keras.layers.Input(shape=([2]))
in1Sub82512 = tf.keras.layers.Input(shape=([2]))
in0Up_52178 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Con80522 = tf.keras.layers.Input(shape=([1]))

Mul23197 = keras.layers.Multiply(name = 'Mul23197', )([in0Mul23197,in1Mul23197])
Fla13351 = keras.layers.Flatten(name = 'Fla13351', )(Mul23197)
Sub82512 = keras.layers.Subtract(name = 'Sub82512', )([in0Sub82512,in1Sub82512])
Lay99050 = keras.layers.LayerNormalization(axis=1, epsilon=2.8009010901104614, name = 'Lay99050', )(Sub82512)
Up_52178 = keras.layers.UpSampling3D(size=(2, 2, 1), name = 'Up_52178', )(in0Up_52178)
Res95917 = keras.layers.Reshape((4, 4, 4), name = 'Res95917', )(Up_52178)
Res78563 = keras.layers.Reshape((4, 16), name = 'Res78563', )(Res95917)
GRU80114 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU80114', )(Res78563)
Con80522 = keras.layers.Concatenate(axis=1, name = 'Con80522', )([GRU80114,in0Con80522])
Add95417 = keras.layers.Add(name = 'Add95417', )([Lay99050,Con80522])
Max86248 = keras.layers.Maximum(name = 'Max86248', )([Fla13351,Add95417])
model = tf.keras.models.Model(inputs=[in0Mul23197,in1Mul23197,in0Sub82512,in1Sub82512,in0Up_52178,in0Con80522], outputs=Max86248)
w = model.get_layer('GRU80114').get_weights() 
w[0] = np.array([[10, 8, 9], [7, 10, 8], [6, 6, 6], [8, 2, 3], [1, 2, 1], [10, 5, 3], [3, 8, 8], [3, 4, 3], [8, 6, 3], [2, 8, 9], [3, 7, 8], [7, 5, 1], [1, 10, 9], [6, 3, 1], [3, 5, 1], [6, 5, 10]])
w[1] = np.array([[8, 5, 3]])
w[2] = np.array([1, 8, 10])
model.get_layer('GRU80114').set_weights(w) 
in0Mul23197 = tf.constant([[[0.6267, 0.44]]])
in1Mul23197 = tf.constant([[[0.8655, 0.0769]]])
in0Sub82512 = tf.constant([[0.8877, 0.0987]])
in1Sub82512 = tf.constant([[0.6862, 0.4619]])
in0Up_52178 = tf.constant([[[[[1.7603, 1.8242], [1.0197, 1.5527]], [[1.4255, 1.2694], [1.2785, 1.0266]]], [[[1.4089, 1.1437], [1.9714, 1.1211]], [[1.8134, 1.3032], [1.1776, 1.1601]]]]])
in0Con80522 = tf.constant([[0.0786]])
print (np.array2string(model.predict([in0Mul23197,in1Mul23197,in0Sub82512,in1Sub82512,in0Up_52178,in0Con80522],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max86248.png')

LMul23197 = multiply_layer([[[[0.6267, 0.44]]], [[[0.8655, 0.0769]]]], Mul23197), 
LFla13351 = flatten_layer(Mul23197, Fla13351), 
LSub82512 = subtract_layer([[0.8877, 0.0987]], [[0.6862, 0.4619]], Sub82512), 
LLay99050 = layer_normalization_layer(Sub82512, 1, 2.8009010901104614, Lay99050), 
LUp_52178 = up_sampling3D_layer([[[[[1.7603, 1.8242], [1.0197, 1.5527]], [[1.4255, 1.2694], [1.2785, 1.0266]]], [[[1.4089, 1.1437], [1.9714, 1.1211]], [[1.8134, 1.3032], [1.1776, 1.1601]]]]], 2, 2, 1, Up_52178), 
LRes95917 = reshape_layer(Up_52178, [4, 4, 4], Res95917), 
LRes78563 = reshape_layer(Res95917, [4, 16], Res78563), 
LGRU80114 = gru_layer(Res78563,[[10, 8, 9], [7, 10, 8], [6, 6, 6], [8, 2, 3], [1, 2, 1], [10, 5, 3], [3, 8, 8], [3, 4, 3], [8, 6, 3], [2, 8, 9], [3, 7, 8], [7, 5, 1], [1, 10, 9], [6, 3, 1], [3, 5, 1], [6, 5, 10]],[[8, 5, 3]],[1, 8, 10], false, GRU80114), 
LCon80522 = concatenate_layer([GRU80114,[[0.0786]]], 1, Con80522), 
LAdd95417 = add_layer([Lay99050,Con80522], Add95417), 
LMax86248 = maximum_layer([Fla13351,Add95417], Max86248), 
exec_layers([LMul23197,LFla13351,LSub82512,LLay99050,LUp_52178,LRes95917,LRes78563,LGRU80114,LCon80522,LAdd95417,LMax86248],["Mul23197","Fla13351","Sub82512","Lay99050","Up_52178","Res95917","Res78563","GRU80114","Con80522","Add95417","Max86248"],Max86248,"Max86248")

Actual (Unparsed): [[0.5424088, 0.0338360]]

Expected (Unparsed): [[0.54240885,0.033836]]

Actual:   [[0.5425, 0.0339]]

Expected: [[0.5425, 0.0339]]