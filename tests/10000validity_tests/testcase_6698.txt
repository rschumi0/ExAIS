import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot18126 = tf.keras.layers.Input(shape=([3]))
in1Dot18126 = tf.keras.layers.Input(shape=([3]))
in0Con21423 = tf.keras.layers.Input(shape=([2, 2, 3]))
in0Max1546 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Max1546 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Loc37099 = tf.keras.layers.Input(shape=([2, 2, 2]))

Dot18126 = keras.layers.Dot(axes=(1, 1), name = 'Dot18126', )([in0Dot18126,in1Dot18126])
Res73450 = keras.layers.Reshape((1, 1), name = 'Res73450', )(Dot18126)
Max59242 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max59242', )(Res73450)
Res17245 = keras.layers.Reshape((1, 1, 1), name = 'Res17245', )(Max59242)
Zer9698 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer9698', )(Res17245)
Con21423 = keras.layers.Concatenate(axis=3, name = 'Con21423', )([Zer9698,in0Con21423])
Max1546 = keras.layers.Maximum(name = 'Max1546', )([in0Max1546,in1Max1546])
Res85969 = keras.layers.Reshape((2, 2, 4), name = 'Res85969', )(Max1546)
Loc37099 = keras.layers.LocallyConnected2D(4, (1, 1),strides=(1, 1), name = 'Loc37099', )(in0Loc37099)
Max7115 = keras.layers.Maximum(name = 'Max7115', )([Res85969,Loc37099])
Ave76437 = keras.layers.Average(name = 'Ave76437', )([Con21423,Max7115])
Res97530 = keras.layers.Reshape((2, 8), name = 'Res97530', )(Ave76437)
Sim40887 = keras.layers.SimpleRNN(3,name = 'Sim40887', )(Res97530)
model = tf.keras.models.Model(inputs=[in0Dot18126,in1Dot18126,in0Con21423,in0Max1546,in1Max1546,in0Loc37099], outputs=Sim40887)
w = model.get_layer('Loc37099').get_weights() 
w[0] = np.array([[[0.4039, 0.4246, 0.8755, 0.929], [0.7655, 0.9485, 0.8838, 0.454]], [[0.2565, 0.824, 0.9333, 0.9012], [0.6036, 0.0707, 0.9917, 0.5566]], [[0.1381, 0.9767, 0.0659, 0.9709], [0.7096, 0.3204, 0.4669, 0.3026]], [[0.0725, 0.2599, 0.353, 0.1886], [0.5728, 0.0214, 0.7213, 0.6664]]])
w[1] = np.array([[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]]])
model.get_layer('Loc37099').set_weights(w) 
w = model.get_layer('Sim40887').get_weights() 
w[0] = np.array([[8, 1, 2], [10, 1, 8], [1, 9, 2], [5, 6, 8], [2, 1, 10], [5, 7, 8], [2, 8, 10], [5, 6, 9]])
w[1] = np.array([[4, 4, 9], [2, 4, 7], [5, 6, 7]])
w[2] = np.array([3, 10, 7])
model.get_layer('Sim40887').set_weights(w) 
in0Dot18126 = tf.constant([[0.5033, 0.9809, 0.1754]])
in1Dot18126 = tf.constant([[0.8307, 0.1774, 0.7338]])
in0Con21423 = tf.constant([[[[0.5106, 0.6184, 0.0392], [0.321, 0.8397, 0.8229]], [[0.7738, 0.5701, 0.7611], [0.4953, 0.8854, 0.6617]]]])
in0Max1546 = tf.constant([[[[[0.9459, 0.321], [0.2183, 0.4141]], [[0.148, 0.8764], [0.6205, 0.9911]]], [[[0.0185, 0.0641], [0.1731, 0.0296]], [[0.8067, 0.671], [0.5532, 0.0183]]]]])
in1Max1546 = tf.constant([[[[[0.7914, 0.5615], [0.4734, 0.028]], [[0.8077, 0.6395], [0.7706, 0.4385]]], [[[0.6902, 0.509], [0.5603, 0.69]], [[0.7944, 0.7785], [0.0977, 0.7536]]]]])
in0Loc37099 = tf.constant([[[[0.2864, 0.3382], [0.7826, 0.2924]], [[0.2071, 0.3562], [0.8262, 0.2888]]]])
print (np.array2string(model.predict([in0Dot18126,in1Dot18126,in0Con21423,in0Max1546,in1Max1546,in0Loc37099],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sim40887.png')

LDot18126 = dot_layer([[0.5033, 0.9809, 0.1754]], [[0.8307, 0.1774, 0.7338]], 1, 1, Dot18126), 
LRes73450 = reshape_layer(Dot18126, [1, 1], Res73450), 
LMax59242 = max_pool1D_layer(Res73450, 1, Max59242), 
LRes17245 = reshape_layer(Max59242, [1, 1, 1], Res17245), 
LZer9698 = zero_padding2D_layer(Res17245, 1, 0, 1, 0, Zer9698), 
LCon21423 = concatenate_layer([Zer9698,[[[[0.5106, 0.6184, 0.0392], [0.321, 0.8397, 0.8229]], [[0.7738, 0.5701, 0.7611], [0.4953, 0.8854, 0.6617]]]]], 3, Con21423), 
LMax1546 = maximum_layer([[[[[[0.9459, 0.321], [0.2183, 0.4141]], [[0.148, 0.8764], [0.6205, 0.9911]]], [[[0.0185, 0.0641], [0.1731, 0.0296]], [[0.8067, 0.671], [0.5532, 0.0183]]]]], [[[[[0.7914, 0.5615], [0.4734, 0.028]], [[0.8077, 0.6395], [0.7706, 0.4385]]], [[[0.6902, 0.509], [0.5603, 0.69]], [[0.7944, 0.7785], [0.0977, 0.7536]]]]]], Max1546), 
LRes85969 = reshape_layer(Max1546, [2, 2, 4], Res85969), 
LLoc37099 = locally_connected2D_layer([[[[0.2864, 0.3382], [0.7826, 0.2924]], [[0.2071, 0.3562], [0.8262, 0.2888]]]], 1, 1,[[[0.4039, 0.4246, 0.8755, 0.929], [0.7655, 0.9485, 0.8838, 0.454]], [[0.2565, 0.824, 0.9333, 0.9012], [0.6036, 0.0707, 0.9917, 0.5566]], [[0.1381, 0.9767, 0.0659, 0.9709], [0.7096, 0.3204, 0.4669, 0.3026]], [[0.0725, 0.2599, 0.353, 0.1886], [0.5728, 0.0214, 0.7213, 0.6664]]],[[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]]], 1, 1, Loc37099), 
LMax7115 = maximum_layer([Res85969,Loc37099], Max7115), 
LAve76437 = average_layer([Con21423,Max7115], Ave76437), 
LRes97530 = reshape_layer(Ave76437, [2, 8], Res97530), 
LSim40887 = simple_rnn_layer(Res97530,[[8, 1, 2], [10, 1, 8], [1, 9, 2], [5, 6, 8], [2, 1, 10], [5, 7, 8], [2, 8, 10], [5, 6, 9]],[[4, 4, 9], [2, 4, 7], [5, 6, 7]],[3, 10, 7], Sim40887), 
exec_layers([LDot18126,LRes73450,LMax59242,LRes17245,LZer9698,LCon21423,LMax1546,LRes85969,LLoc37099,LMax7115,LAve76437,LRes97530,LSim40887],["Dot18126","Res73450","Max59242","Res17245","Zer9698","Con21423","Max1546","Res85969","Loc37099","Max7115","Ave76437","Res97530","Sim40887"],Sim40887,"Sim40887")

Actual (Unparsed): [[1.0000000, 1.0000000, 1.0000000]]

Expected (Unparsed): [[1.0,1.0,1.0]]

Actual:   [[1, 1, 1]]

Expected: [[1, 1, 1]]