import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sof9987 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Add95608 = tf.keras.layers.Input(shape=([1, 2]))
in1Add95608 = tf.keras.layers.Input(shape=([1, 2]))
in0Con31890 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Ave52100 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Ave52100 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Mul56310 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Mul56310 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))

Sof9987 = keras.layers.Softmax(axis=1, name = 'Sof9987', input_shape=(1, 1, 2))(in0Sof9987)
Res38930 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res38930', )(Sof9987)
Zer60173 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (0, 0)), name = 'Zer60173', )(Res38930)
Add95608 = keras.layers.Add(name = 'Add95608', )([in0Add95608,in1Add95608])
Res60644 = keras.layers.Reshape((1, 2, 1), name = 'Res60644', )(Add95608)
Con31890 = keras.layers.Concatenate(axis=3, name = 'Con31890', )([Res60644,in0Con31890])
Ave52100 = keras.layers.Average(name = 'Ave52100', )([in0Ave52100,in1Ave52100])
Zer56357 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer56357', )(Ave52100)
Sub39138 = keras.layers.Subtract(name = 'Sub39138', )([Con31890,Zer56357])
Res48996 = keras.layers.Reshape((1, 2, 2, 1), name = 'Res48996', )(Sub39138)
Mul56310 = keras.layers.Multiply(name = 'Mul56310', )([in0Mul56310,in1Mul56310])
Zer4739 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (0, 0)), name = 'Zer4739', )(Mul56310)
Max56039 = keras.layers.Maximum(name = 'Max56039', )([Res48996,Zer4739])
Max77497 = keras.layers.Maximum(name = 'Max77497', )([Zer60173,Max56039])
Res62019 = keras.layers.Reshape((1, 2, 2), name = 'Res62019', )(Max77497)
Res31834 = keras.layers.Reshape((1, 4), name = 'Res31834', )(Res62019)
LST6824 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST6824', )(Res31834)
model = tf.keras.models.Model(inputs=[in0Sof9987,in0Add95608,in1Add95608,in0Con31890,in0Ave52100,in1Ave52100,in0Mul56310,in1Mul56310], outputs=LST6824)
w = model.get_layer('LST6824').get_weights() 
w[0] = np.array([[8, 9, 2, 2], [2, 3, 8, 2], [3, 2, 8, 7], [6, 4, 9, 7]])
w[1] = np.array([[10, 8, 1, 1]])
w[2] = np.array([8, 2, 2, 9])
model.get_layer('LST6824').set_weights(w) 
in0Sof9987 = tf.constant([[[[0.8274, 0.3993]]]])
in0Add95608 = tf.constant([[[0.2313, 0.6392]]])
in1Add95608 = tf.constant([[[0.0817, 0.5778]]])
in0Con31890 = tf.constant([[[[0.9529], [0.7656]]]])
in0Ave52100 = tf.constant([[[[0.7191, 0.2427]]]])
in1Ave52100 = tf.constant([[[[0.0843, 0.3133]]]])
in0Mul56310 = tf.constant([[[[[0.7136], [0.7052]]]]])
in1Mul56310 = tf.constant([[[[[0.8613], [0.6222]]]]])
print (np.array2string(model.predict([in0Sof9987,in0Add95608,in1Add95608,in0Con31890,in0Ave52100,in1Ave52100,in0Mul56310,in1Mul56310],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST6824.png')

LSof9987 = softmax_layer([[[[0.8274, 0.3993]]]], 1, Sof9987), 
LRes38930 = reshape_layer(Sof9987, [1, 1, 2, 1], Res38930), 
LZer60173 = zero_padding3D_layer(Res38930, 0, 0, 1, 0, 0, 0, Zer60173), 
LAdd95608 = add_layer([[[[0.2313, 0.6392]]], [[[0.0817, 0.5778]]]], Add95608), 
LRes60644 = reshape_layer(Add95608, [1, 2, 1], Res60644), 
LCon31890 = concatenate_layer([Res60644,[[[[0.9529], [0.7656]]]]], 3, Con31890), 
LAve52100 = average_layer([[[[[0.7191, 0.2427]]]], [[[[0.0843, 0.3133]]]]], Ave52100), 
LZer56357 = zero_padding2D_layer(Ave52100, 0, 0, 1, 0, Zer56357), 
LSub39138 = subtract_layer(Con31890,Zer56357, Sub39138), 
LRes48996 = reshape_layer(Sub39138, [1, 2, 2, 1], Res48996), 
LMul56310 = multiply_layer([[[[[[0.7136], [0.7052]]]]], [[[[[0.8613], [0.6222]]]]]], Mul56310), 
LZer4739 = zero_padding3D_layer(Mul56310, 0, 0, 1, 0, 0, 0, Zer4739), 
LMax56039 = maximum_layer([Res48996,Zer4739], Max56039), 
LMax77497 = maximum_layer([Zer60173,Max56039], Max77497), 
LRes62019 = reshape_layer(Max77497, [1, 2, 2], Res62019), 
LRes31834 = reshape_layer(Res62019, [1, 4], Res31834), 
LLST6824 = lstm_layer(Res31834,[[8, 9, 2, 2], [2, 3, 8, 2], [3, 2, 8, 7], [6, 4, 9, 7]],[[10, 8, 1, 1]],[8, 2, 2, 9], LST6824), 
exec_layers([LSof9987,LRes38930,LZer60173,LAdd95608,LRes60644,LCon31890,LAve52100,LZer56357,LSub39138,LRes48996,LMul56310,LZer4739,LMax56039,LMax77497,LRes62019,LRes31834,LLST6824],["Sof9987","Res38930","Zer60173","Add95608","Res60644","Con31890","Ave52100","Zer56357","Sub39138","Res48996","Mul56310","Zer4739","Max56039","Max77497","Res62019","Res31834","LST6824"],LST6824,"LST6824")

Actual (Unparsed): [[0.7615942]]

Expected (Unparsed): [[0.76159415573817]]

Actual:   [[0.7616]]

Expected: [[0.7616]]