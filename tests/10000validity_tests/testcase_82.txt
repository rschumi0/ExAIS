import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST44138 = tf.keras.layers.Input(shape=([2, 3]))
in0Mas87024 = tf.keras.layers.Input(shape=([4, 1]))
in0Sof22352 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in0Con22308 = tf.keras.layers.Input(shape=([1, 2]))
in0Sep76298 = tf.keras.layers.Input(shape=([2, 2]))

LST44138 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST44138', )(in0LST44138)
Res25636 = keras.layers.Reshape((2, 1), name = 'Res25636', )(LST44138)
Zer86094 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer86094', )(Res25636)
Mas87024 = keras.layers.Masking(mask_value=2, name = 'Mas87024', )(in0Mas87024)
Add13078 = keras.layers.Add(name = 'Add13078', )([Zer86094,Mas87024])
Fla49854 = keras.layers.Flatten(name = 'Fla49854', )(Add13078)
Sof22352 = keras.layers.Softmax(axis=1, name = 'Sof22352', input_shape=(1, 1, 1, 2))(in0Sof22352)
Res43856 = keras.layers.Reshape((1, 1, 2), name = 'Res43856', )(Sof22352)
Res69635 = keras.layers.Reshape((1, 2), name = 'Res69635', )(Res43856)
Con22308 = keras.layers.Concatenate(axis=2, name = 'Con22308', )([Res69635,in0Con22308])
Sep76298 = keras.layers.SeparableConv1D(4, (1),strides=(2), padding='same', name = 'Sep76298', )(in0Sep76298)
Add61496 = keras.layers.Add(name = 'Add61496', )([Con22308,Sep76298])
Glo7312 = keras.layers.GlobalMaxPool1D(name = 'Glo7312', )(Add61496)
Mul47205 = keras.layers.Multiply(name = 'Mul47205', )([Fla49854,Glo7312])
model = tf.keras.models.Model(inputs=[in0LST44138,in0Mas87024,in0Sof22352,in0Con22308,in0Sep76298], outputs=Mul47205)
w = model.get_layer('LST44138').get_weights() 
w[0] = np.array([[10, 2, 6, 4, 6, 9, 6, 6], [4, 3, 9, 6, 4, 2, 8, 4], [8, 1, 4, 7, 3, 8, 6, 1]])
w[1] = np.array([[5, 3, 6, 1, 4, 4, 6, 8], [9, 3, 10, 5, 3, 1, 2, 5]])
w[2] = np.array([10, 10, 1, 6, 1, 5, 10, 2])
model.get_layer('LST44138').set_weights(w) 
w = model.get_layer('Sep76298').get_weights() 
w[0] = np.array([[[0.1385], [0.1376]]])
w[1] = np.array([[[0.7617, 0.0428, 0.9142, 0.1236], [0.0444, 0.7306, 0.3444, 0.6636]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep76298').set_weights(w) 
in0LST44138 = tf.constant([[[1, 3, 1], [10, 9, 10]]])
in0Mas87024 = tf.constant([[[1.8405], [1.9412], [1.7649], [1.6327]]])
in0Sof22352 = tf.constant([[[[[0.8094, 0.8342]]]]])
in0Con22308 = tf.constant([[[0.2836, 0.4109]]])
in0Sep76298 = tf.constant([[[0.6942, 0.557], [0.2278, 0.9823]]])
print (np.array2string(model.predict([in0LST44138,in0Mas87024,in0Sof22352,in0Con22308,in0Sep76298],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul47205.png')

LLST44138 = lstm_layer([[[1, 3, 1], [10, 9, 10]]],[[10, 2, 6, 4, 6, 9, 6, 6], [4, 3, 9, 6, 4, 2, 8, 4], [8, 1, 4, 7, 3, 8, 6, 1]],[[5, 3, 6, 1, 4, 4, 6, 8], [9, 3, 10, 5, 3, 1, 2, 5]],[10, 10, 1, 6, 1, 5, 10, 2], LST44138), 
LRes25636 = reshape_layer(LST44138, [2, 1], Res25636), 
LZer86094 = zero_padding1D_layer(Res25636, 2, 0, Zer86094), 
LMas87024 = masking_layer([[[1.8405], [1.9412], [1.7649], [1.6327]]], 2, Mas87024), 
LAdd13078 = add_layer([Zer86094,Mas87024], Add13078), 
LFla49854 = flatten_layer(Add13078, Fla49854), 
LSof22352 = softmax_layer([[[[[0.8094, 0.8342]]]]], 1, Sof22352), 
LRes43856 = reshape_layer(Sof22352, [1, 1, 2], Res43856), 
LRes69635 = reshape_layer(Res43856, [1, 2], Res69635), 
LCon22308 = concatenate_layer([Res69635,[[[0.2836, 0.4109]]]], 2, Con22308), 
LSep76298 = separable_conv1D_layer([[[0.6942, 0.557], [0.2278, 0.9823]]], 1,[[[[0.1385], [0.1376]]],[[[0.7617, 0.0428, 0.9142, 0.1236], [0.0444, 0.7306, 0.3444, 0.6636]]]],[0, 0, 0, 0], 2, true, Sep76298), 
LAdd61496 = add_layer([Con22308,Sep76298], Add61496), 
LGlo7312 = global_max_pool1D_layer(Add61496, Glo7312), 
LMul47205 = multiply_layer([Fla49854,Glo7312], Mul47205), 
exec_layers([LLST44138,LRes25636,LZer86094,LMas87024,LAdd13078,LFla49854,LSof22352,LRes43856,LRes69635,LCon22308,LSep76298,LAdd61496,LGlo7312,LMul47205],["LST44138","Res25636","Zer86094","Mas87024","Add13078","Fla49854","Sof22352","Res43856","Res69635","Con22308","Sep76298","Add61496","Glo7312","Mul47205"],Mul47205,"Mul47205")

Actual (Unparsed): [[1.9815520, 2.0578867, 1.0858218, 1.2299248]]

Expected (Unparsed): [[1.9815520539745353,2.0578866980400163,1.085821812601742,1.2299248524696869]]

Actual:   [[1.9816, 2.0579, 1.0859, 1.23]]

Expected: [[1.9816, 2.0579, 1.0859, 1.23]]