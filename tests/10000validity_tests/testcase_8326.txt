import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max18929 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Max18929 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Con12395 = tf.keras.layers.Input(shape=([6, 2]))
in0Cro41513 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Cro53127 = tf.keras.layers.Input(shape=([4, 1, 3, 1]))

Max18929 = keras.layers.Maximum(name = 'Max18929', )([in0Max18929,in1Max18929])
Mas38759 = keras.layers.Masking(mask_value=1, name = 'Mas38759', )(Max18929)
Res35187 = keras.layers.Reshape((2, 2, 1), name = 'Res35187', )(Mas38759)
Res56796 = keras.layers.Reshape((2, 2), name = 'Res56796', )(Res35187)
Fla77236 = keras.layers.Flatten(name = 'Fla77236', )(Res56796)
Res45717 = keras.layers.Reshape((4, 1), name = 'Res45717', )(Fla77236)
Zer178 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer178', )(Res45717)
Con12395 = keras.layers.Concatenate(axis=2, name = 'Con12395', )([Zer178,in0Con12395])
Cro41513 = keras.layers.Cropping2D(cropping=((0, 1), (0, 0)), name = 'Cro41513', )(in0Cro41513)
Res70391 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res70391', )(Cro41513)
Zer84274 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (1, 0)), name = 'Zer84274', )(Res70391)
Cro53127 = keras.layers.Cropping3D(cropping=((2, 0), (0, 0), (2, 0)), name = 'Cro53127', )(in0Cro53127)
Zer32188 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer32188', )(Cro53127)
Max65755 = keras.layers.Maximum(name = 'Max65755', )([Zer84274,Zer32188])
Res52379 = keras.layers.Reshape((2, 1, 3), name = 'Res52379', )(Max65755)
Dep489 = keras.layers.DepthwiseConv2D((2, 1),strides=(1, 1), padding='valid', name = 'Dep489', )(Res52379)
Res17306 = keras.layers.Reshape((1, 3), name = 'Res17306', )(Dep489)
Zer37669 = keras.layers.ZeroPadding1D(padding=((5, 0)), name = 'Zer37669', )(Res17306)
Dot28998 = keras.layers.Dot(axes=(1, 1), name = 'Dot28998', )([Con12395,Zer37669])
model = tf.keras.models.Model(inputs=[in0Max18929,in1Max18929,in0Con12395,in0Cro41513,in0Cro53127], outputs=Dot28998)
w = model.get_layer('Dep489').get_weights() 
w[0] = np.array([[[[0.4762], [0.2024], [0.084]]], [[[0.8278], [0.5747], [0.1761]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Dep489').set_weights(w) 
in0Max18929 = tf.constant([[[[[0.4559]], [[0.6776]]], [[[0.6871]], [[0.3827]]]]])
in1Max18929 = tf.constant([[[[[0.1406]], [[0.8437]]], [[[0.2915]], [[0.1425]]]]])
in0Con12395 = tf.constant([[[0.1493, 0.9116], [0.5172, 0.2584], [0.7216, 0.8165], [0.7003, 0.7895], [0.4432, 0.7946], [0.8708, 0.8912]]])
in0Cro41513 = tf.constant([[[[1.3716, 1.7917]], [[1.4001, 1.6822]]]])
in0Cro53127 = tf.constant([[[[[1.8441], [1.7811], [1.6823]]], [[[1.4468], [1.5726], [1.0079]]], [[[1.7837], [1.5142], [1.1804]]], [[[1.0828], [1.4396], [1.0376]]]]])
print (np.array2string(model.predict([in0Max18929,in1Max18929,in0Con12395,in0Cro41513,in0Cro53127],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot28998.png')

LMax18929 = maximum_layer([[[[[[0.4559]], [[0.6776]]], [[[0.6871]], [[0.3827]]]]], [[[[[0.1406]], [[0.8437]]], [[[0.2915]], [[0.1425]]]]]], Max18929), 
LMas38759 = masking_layer(Max18929, 1, Mas38759), 
LRes35187 = reshape_layer(Mas38759, [2, 2, 1], Res35187), 
LRes56796 = reshape_layer(Res35187, [2, 2], Res56796), 
LFla77236 = flatten_layer(Res56796, Fla77236), 
LRes45717 = reshape_layer(Fla77236, [4, 1], Res45717), 
LZer178 = zero_padding1D_layer(Res45717, 1, 1, Zer178), 
LCon12395 = concatenate_layer([Zer178,[[[0.1493, 0.9116], [0.5172, 0.2584], [0.7216, 0.8165], [0.7003, 0.7895], [0.4432, 0.7946], [0.8708, 0.8912]]]], 2, Con12395), 
LCro41513 = cropping2D_layer([[[[1.3716, 1.7917]], [[1.4001, 1.6822]]]], 0, 1, 0, 0, Cro41513), 
LRes70391 = reshape_layer(Cro41513, [1, 1, 2, 1], Res70391), 
LZer84274 = zero_padding3D_layer(Res70391, 1, 0, 0, 0, 1, 0, Zer84274), 
LCro53127 = cropping3D_layer([[[[[1.8441], [1.7811], [1.6823]]], [[[1.4468], [1.5726], [1.0079]]], [[[1.7837], [1.5142], [1.1804]]], [[[1.0828], [1.4396], [1.0376]]]]], 2, 0, 0, 0, 2, 0, Cro53127), 
LZer32188 = zero_padding3D_layer(Cro53127, 0, 0, 0, 0, 2, 0, Zer32188), 
LMax65755 = maximum_layer([Zer84274,Zer32188], Max65755), 
LRes52379 = reshape_layer(Max65755, [2, 1, 3], Res52379), 
LDep489 = depthwise_conv2D_layer(Res52379, 2, 1,[[[[0.4762], [0.2024], [0.084]]], [[[0.8278], [0.5747], [0.1761]]]],[0, 0, 0], 1, 1, false, Dep489), 
LRes17306 = reshape_layer(Dep489, [1, 3], Res17306), 
LZer37669 = zero_padding1D_layer(Res17306, 5, 0, Zer37669), 
LDot28998 = dot_layer(Con12395,Zer37669, 1, 1, Dot28998), 
exec_layers([LMax18929,LMas38759,LRes35187,LRes56796,LFla77236,LRes45717,LZer178,LCon12395,LCro41513,LRes70391,LZer84274,LCro53127,LZer32188,LMax65755,LRes52379,LDep489,LRes17306,LZer37669,LDot28998],["Max18929","Mas38759","Res35187","Res56796","Fla77236","Res45717","Zer178","Con12395","Cro41513","Res70391","Zer84274","Cro53127","Zer32188","Max65755","Res52379","Dep489","Res17306","Zer37669","Dot28998"],Dot28998,"Dot28998")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.6864155, 0.3610964], [0.0000000, 0.7024960, 0.3695557]]]

Expected (Unparsed): [[[0.0,0.0,0.0],[0.0,0.686415519216,0.36109635147600005],[0.0,0.702495993024,0.36955565966400006]]]

Actual:   [[[0, 0, 0], [0, 0.6865, 0.3611], [0, 0.7025, 0.3696]]]

Expected: [[[0, 0, 0], [0, 0.6865, 0.3611], [0, 0.7025, 0.3696]]]