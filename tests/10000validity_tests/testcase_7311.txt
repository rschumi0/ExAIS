import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave68046 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Ave68046 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))

Ave68046 = keras.layers.Average(name = 'Ave68046', )([in0Ave68046,in1Ave68046])
Res58578 = keras.layers.Reshape((1, 2, 1), name = 'Res58578', )(Ave68046)
Res91326 = keras.layers.Reshape((1, 2), name = 'Res91326', )(Res58578)
Per70811 = keras.layers.Permute((2,1), name = 'Per70811',)(Res91326)
Sim87343 = keras.layers.SimpleRNN(2,name = 'Sim87343', )(Per70811)
Res56855 = keras.layers.Reshape((2, 1), name = 'Res56855', )(Sim87343)
Ave39107 = keras.layers.AveragePooling1D(pool_size=(2), strides=(1), padding='same', name = 'Ave39107', )(Res56855)
Res99970 = keras.layers.Reshape((2, 1, 1), name = 'Res99970', )(Ave39107)
Dep66121 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='same', name = 'Dep66121', )(Res99970)
model = tf.keras.models.Model(inputs=[in0Ave68046,in1Ave68046], outputs=Dep66121)
w = model.get_layer('Sim87343').get_weights() 
w[0] = np.array([[10, 1]])
w[1] = np.array([[2, 1], [3, 5]])
w[2] = np.array([9, 7])
model.get_layer('Sim87343').set_weights(w) 
w = model.get_layer('Dep66121').get_weights() 
w[0] = np.array([[[[0.0724]]]])
w[1] = np.array([0])
model.get_layer('Dep66121').set_weights(w) 
in0Ave68046 = tf.constant([[[[[0.9294]], [[0.4653]]]]])
in1Ave68046 = tf.constant([[[[[0.4309]], [[0.4197]]]]])
print (np.array2string(model.predict([in0Ave68046,in1Ave68046],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dep66121.png')

LAve68046 = average_layer([[[[[[0.9294]], [[0.4653]]]]], [[[[[0.4309]], [[0.4197]]]]]], Ave68046), 
LRes58578 = reshape_layer(Ave68046, [1, 2, 1], Res58578), 
LRes91326 = reshape_layer(Res58578, [1, 2], Res91326), 
LPer70811 = permute_layer(Res91326, 2,1, Per70811), 
LSim87343 = simple_rnn_layer(Per70811,[[10, 1]],[[2, 1], [3, 5]],[9, 7], Sim87343), 
LRes56855 = reshape_layer(Sim87343, [2, 1], Res56855), 
LAve39107 = average_pooling1D_layer(Res56855, 2, 1, true, Ave39107), 
LRes99970 = reshape_layer(Ave39107, [2, 1, 1], Res99970), 
LDep66121 = depthwise_conv2D_layer(Res99970, 1, 1,[[[[0.0724]]]],[0], 1, 1, true, Dep66121), 
exec_layers([LAve68046,LRes58578,LRes91326,LPer70811,LSim87343,LRes56855,LAve39107,LRes99970,LDep66121],["Ave68046","Res58578","Res91326","Per70811","Sim87343","Res56855","Ave39107","Res99970","Dep66121"],Dep66121,"Dep66121")

Actual (Unparsed): [[[[0.0724000]], [[0.0724000]]]]

Expected (Unparsed): [[[[0.07239999999984734]],[[0.07239999999969468]]]]

Actual:   [[[[0.0724]], [[0.0724]]]]

Expected: [[[[0.0724]], [[0.0724]]]]