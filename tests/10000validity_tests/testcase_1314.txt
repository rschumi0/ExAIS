import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub92269 = tf.keras.layers.Input(shape=([3, 2, 2, 2]))
in1Sub92269 = tf.keras.layers.Input(shape=([3, 2, 2, 2]))
in0Con16917 = tf.keras.layers.Input(shape=([2, 2]))
in0GRU86242 = tf.keras.layers.Input(shape=([2, 2]))
in0Con99599 = tf.keras.layers.Input(shape=([3]))
in0Con19059 = tf.keras.layers.Input(shape=([18]))

Sub92269 = keras.layers.Subtract(name = 'Sub92269', )([in0Sub92269,in1Sub92269])
Res19565 = keras.layers.Reshape((3, 2, 4), name = 'Res19565', )(Sub92269)
Res79620 = keras.layers.Reshape((3, 8), name = 'Res79620', )(Res19565)
Fla35432 = keras.layers.Flatten(name = 'Fla35432', )(Res79620)
Con16917 = keras.layers.Conv1D(3, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con16917', )(in0Con16917)
Fla47950 = keras.layers.Flatten(name = 'Fla47950', )(Con16917)
GRU86242 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU86242', )(in0GRU86242)
Con99599 = keras.layers.Concatenate(axis=1, name = 'Con99599', )([GRU86242,in0Con99599])
Ave28394 = keras.layers.Average(name = 'Ave28394', )([Fla47950,Con99599])
Con19059 = keras.layers.Concatenate(axis=1, name = 'Con19059', )([Ave28394,in0Con19059])
Add91755 = keras.layers.Add(name = 'Add91755', )([Fla35432,Con19059])
model = tf.keras.models.Model(inputs=[in0Sub92269,in1Sub92269,in0Con16917,in0GRU86242,in0Con99599,in0Con19059], outputs=Add91755)
w = model.get_layer('Con16917').get_weights() 
w[0] = np.array([[[0.3527, 0.1237, 0.4472], [0.6406, 0.2553, 0.2915]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con16917').set_weights(w) 
w = model.get_layer('GRU86242').get_weights() 
w[0] = np.array([[9, 4, 10, 8, 8, 1, 6, 1, 6], [6, 5, 8, 10, 8, 1, 2, 2, 10]])
w[1] = np.array([[5, 10, 3, 2, 5, 6, 7, 8, 1], [5, 1, 4, 2, 5, 6, 7, 1, 5], [9, 10, 2, 6, 8, 7, 5, 10, 5]])
w[2] = np.array([[1, 10, 6, 6, 8, 1, 4, 2, 2], [2, 4, 4, 5, 10, 1, 10, 2, 8]])
model.get_layer('GRU86242').set_weights(w) 
in0Sub92269 = tf.constant([[[[[0.7564, 0.287], [0.2148, 0.4333]], [[0.629, 0.8677], [0.0802, 0.5067]]], [[[0.3185, 0.9061], [0.0422, 0.1007]], [[0.8837, 0.2975], [0.8659, 0.4144]]], [[[0.7413, 0.8048], [0.1267, 0.5825]], [[0.3374, 0.2115], [0.8881, 0.9912]]]]])
in1Sub92269 = tf.constant([[[[[0.5665, 0.6142], [0.043, 0.5404]], [[0.1051, 0.79], [0.7043, 0.262]]], [[[0.18, 0.4982], [0.8413, 0.208]], [[0.8051, 0.9133], [0.8216, 0.9356]]], [[[0.1899, 0.1203], [0.6437, 0.2297]], [[0.8477, 0.7529], [0.4205, 0.9323]]]]])
in0Con16917 = tf.constant([[[0.9121, 0.404], [0.1107, 0.8732]]])
in0GRU86242 = tf.constant([[[6, 1], [6, 8]]])
in0Con99599 = tf.constant([[0.0345, 0.9397, 0.0928]])
in0Con19059 = tf.constant([[0.1132, 0.8827, 0.0417, 0.2993, 0.3391, 0.8077, 0.8252, 0.4888, 0.0663, 0.6463, 0.6043, 0.2398, 0.5844, 0.0587, 0.6278, 0.4318, 0.134, 0.6424]])
print (np.array2string(model.predict([in0Sub92269,in1Sub92269,in0Con16917,in0GRU86242,in0Con99599,in0Con19059],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add91755.png')

LSub92269 = subtract_layer([[[[[0.7564, 0.287], [0.2148, 0.4333]], [[0.629, 0.8677], [0.0802, 0.5067]]], [[[0.3185, 0.9061], [0.0422, 0.1007]], [[0.8837, 0.2975], [0.8659, 0.4144]]], [[[0.7413, 0.8048], [0.1267, 0.5825]], [[0.3374, 0.2115], [0.8881, 0.9912]]]]], [[[[[0.5665, 0.6142], [0.043, 0.5404]], [[0.1051, 0.79], [0.7043, 0.262]]], [[[0.18, 0.4982], [0.8413, 0.208]], [[0.8051, 0.9133], [0.8216, 0.9356]]], [[[0.1899, 0.1203], [0.6437, 0.2297]], [[0.8477, 0.7529], [0.4205, 0.9323]]]]], Sub92269), 
LRes19565 = reshape_layer(Sub92269, [3, 2, 4], Res19565), 
LRes79620 = reshape_layer(Res19565, [3, 8], Res79620), 
LFla35432 = flatten_layer(Res79620, Fla35432), 
LCon16917 = conv1D_layer([[[0.9121, 0.404], [0.1107, 0.8732]]], 1,[[[0.3527, 0.1237, 0.4472], [0.6406, 0.2553, 0.2915]]],[0, 0, 0], 1, false, 1, Con16917), 
LFla47950 = flatten_layer(Con16917, Fla47950), 
LGRU86242 = gru_layer([[[6, 1], [6, 8]]],[[9, 4, 10, 8, 8, 1, 6, 1, 6], [6, 5, 8, 10, 8, 1, 2, 2, 10]],[[5, 10, 3, 2, 5, 6, 7, 8, 1], [5, 1, 4, 2, 5, 6, 7, 1, 5], [9, 10, 2, 6, 8, 7, 5, 10, 5]],[[1, 10, 6, 6, 8, 1, 4, 2, 2], [2, 4, 4, 5, 10, 1, 10, 2, 8]], true, GRU86242), 
LCon99599 = concatenate_layer([GRU86242,[[0.0345, 0.9397, 0.0928]]], 1, Con99599), 
LAve28394 = average_layer([Fla47950,Con99599], Ave28394), 
LCon19059 = concatenate_layer([Ave28394,[[0.1132, 0.8827, 0.0417, 0.2993, 0.3391, 0.8077, 0.8252, 0.4888, 0.0663, 0.6463, 0.6043, 0.2398, 0.5844, 0.0587, 0.6278, 0.4318, 0.134, 0.6424]]], 1, Con19059), 
LAdd91755 = add_layer([Fla35432,Con19059], Add91755), 
exec_layers([LSub92269,LRes19565,LRes79620,LFla35432,LCon16917,LFla47950,LGRU86242,LCon99599,LAve28394,LCon19059,LAdd91755],["Sub92269","Res19565","Res79620","Fla35432","Con16917","Fla47950","GRU86242","Con99599","Ave28394","Con19059","Add91755"],Add91755,"Add91755")

Actual (Unparsed): [[0.4801500, -0.2192160, 0.4346286, 0.2093579, 1.1120608, 0.2761214, -0.5109000, 1.1274000, 0.1802000, 0.7072000, -0.4600000, 0.7004000, 0.9038000, -0.1270000, 0.1106000, 0.1251000, 1.1557000, 0.9243000, 0.0674000, 0.4115000, 0.1175000, -0.1096000, 0.6016000, 0.7013000]]

Expected (Unparsed): [[0.480150035,-0.219216015,0.43462856,0.20935790499999996,1.112060775,0.27612141999999995,-0.5109000000000001,1.1274000000000002,0.18020000000000003,0.7072,-0.46,0.7004,0.9038,-0.127,0.1106,0.1251,1.1557,0.9243,0.06740000000000002,0.4115,0.11750000000000005,-0.10959999999999998,0.6016,0.7012999999999999]]

Actual:   [[0.4802, -0.2192, 0.4347, 0.2094, 1.1121, 0.2762, -0.5109, 1.1274, 0.1802, 0.7072, -0.46, 0.7004, 0.9038, -0.127, 0.1106, 0.1251, 1.1557, 0.9243, 0.0674, 0.4115, 0.1175, -0.1096, 0.6016, 0.7013]]

Expected: [[0.4802, -0.2192, 0.4347, 0.2094, 1.1121, 0.2762, -0.5109, 1.1275, 0.1803, 0.7072, -0.46, 0.7004, 0.9038, -0.127, 0.1106, 0.1251, 1.1557, 0.9243, 0.0675, 0.4115, 0.1176, -0.1095, 0.6016, 0.7013]]