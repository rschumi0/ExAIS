import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST52600 = tf.keras.layers.Input(shape=([2, 3]))
in0Con25238 = tf.keras.layers.Input(shape=([4, 5, 3]))
in0Up_351 = tf.keras.layers.Input(shape=([2, 2]))

LST52600 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST52600', )(in0LST52600)
Res69359 = keras.layers.Reshape((3, 1), name = 'Res69359', )(LST52600)
Res40388 = keras.layers.Reshape((3, 1, 1), name = 'Res40388', )(Res69359)
Con43580 = keras.layers.Conv2D(4, (2, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con43580', )(Res40388)
Res50958 = keras.layers.Reshape((3, 4), name = 'Res50958', )(Con43580)
Glo30674 = keras.layers.GlobalAveragePooling1D(name = 'Glo30674', )(Res50958)
ELU56211 = keras.layers.ELU(alpha=5.226416384649344, name = 'ELU56211', )(Glo30674)
Res85218 = keras.layers.Reshape((4, 1), name = 'Res85218', )(ELU56211)
Res83061 = keras.layers.Reshape((4, 1, 1), name = 'Res83061', )(Res85218)
Zer86614 = keras.layers.ZeroPadding2D(padding=((0, 0), (4, 0)), name = 'Zer86614', )(Res83061)
Con25238 = keras.layers.Concatenate(axis=3, name = 'Con25238', )([Zer86614,in0Con25238])
Up_351 = keras.layers.UpSampling1D(size=(2), name = 'Up_351', )(in0Up_351)
Res40717 = keras.layers.Reshape((4, 2, 1), name = 'Res40717', )(Up_351)
Loc97136 = keras.layers.LocallyConnected2D(4, (4, 2),strides=(1, 1), name = 'Loc97136', )(Res40717)
Zer14415 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer14415', )(Loc97136)
Zer77384 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer77384', )(Zer14415)
Mul61293 = keras.layers.Multiply(name = 'Mul61293', )([Con25238,Zer77384])
model = tf.keras.models.Model(inputs=[in0LST52600,in0Con25238,in0Up_351], outputs=Mul61293)
w = model.get_layer('LST52600').get_weights() 
w[0] = np.array([[7, 5, 1, 4, 5, 4, 6, 3, 10, 2, 1, 6], [6, 1, 1, 4, 1, 7, 1, 9, 10, 1, 7, 2], [9, 6, 5, 2, 9, 2, 2, 1, 7, 9, 1, 2]])
w[1] = np.array([[4, 5, 7, 2, 8, 6, 8, 5, 6, 4, 7, 9], [4, 2, 1, 7, 6, 7, 9, 4, 10, 7, 4, 5], [5, 5, 8, 10, 9, 8, 3, 3, 4, 8, 1, 1]])
w[2] = np.array([1, 3, 3, 9, 5, 9, 1, 6, 7, 8, 7, 3])
model.get_layer('LST52600').set_weights(w) 
w = model.get_layer('Con43580').get_weights() 
w[0] = np.array([[[[0.007, 0.2288, 0.2899, 0.4176]]], [[[0.3816, 0.7696, 0.7727, 0.6104]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con43580').set_weights(w) 
w = model.get_layer('Loc97136').get_weights() 
w[0] = np.array([[[0.7924, 0.1622, 0.6495, 0.4237], [0.005, 0.3059, 0.891, 0.0912], [0.6806, 0.5441, 0.9796, 0.5484], [0.22, 0.2888, 0.9214, 0.2301], [0.5097, 0.9448, 0.0964, 0.5114], [0.275, 0.4262, 0.128, 0.7853], [0.5842, 0.6082, 0.6573, 0.1689], [0.0294, 0.8025, 0.8375, 0.9918]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc97136').set_weights(w) 
in0LST52600 = tf.constant([[[3, 4, 6], [3, 8, 7]]])
in0Con25238 = tf.constant([[[[0.2345, 0.1849, 0.6438], [0.0733, 0.4283, 0.9967], [0.9658, 0.8547, 0.2454], [0.7786, 0.2359, 0.7991], [0.9141, 0.4872, 0.9553]], [[0.6726, 0.8006, 0.0272], [0.3133, 0.2557, 0.0054], [0.7968, 0.2817, 0.7334], [0.8239, 0.2503, 0.0783], [0.6807, 0.3689, 0.432]], [[0.9066, 0.8819, 0.5032], [0.4486, 0.1198, 0.2531], [0.1148, 0.1474, 0.7355], [0.9515, 0.6838, 0.845], [0.527, 0.3488, 0.0337]], [[0.8127, 0.7609, 0.9241], [0.1389, 0.3668, 0.0141], [0.2854, 0.8696, 0.8321], [0.4037, 0.4719, 0.5942], [0.3555, 0.9965, 0.4041]]]])
in0Up_351 = tf.constant([[[1.4552, 1.0371], [1.391, 1.9243]]])
print (np.array2string(model.predict([in0LST52600,in0Con25238,in0Up_351],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul61293.png')

LLST52600 = lstm_layer([[[3, 4, 6], [3, 8, 7]]],[[7, 5, 1, 4, 5, 4, 6, 3, 10, 2, 1, 6], [6, 1, 1, 4, 1, 7, 1, 9, 10, 1, 7, 2], [9, 6, 5, 2, 9, 2, 2, 1, 7, 9, 1, 2]],[[4, 5, 7, 2, 8, 6, 8, 5, 6, 4, 7, 9], [4, 2, 1, 7, 6, 7, 9, 4, 10, 7, 4, 5], [5, 5, 8, 10, 9, 8, 3, 3, 4, 8, 1, 1]],[1, 3, 3, 9, 5, 9, 1, 6, 7, 8, 7, 3], LST52600), 
LRes69359 = reshape_layer(LST52600, [3, 1], Res69359), 
LRes40388 = reshape_layer(Res69359, [3, 1, 1], Res40388), 
LCon43580 = conv2D_layer(Res40388, 2, 1,[[[[0.007, 0.2288, 0.2899, 0.4176]]], [[[0.3816, 0.7696, 0.7727, 0.6104]]]],[0, 0, 0, 0], 1, 1, true, 1, 1, Con43580), 
LRes50958 = reshape_layer(Con43580, [3, 4], Res50958), 
LGlo30674 = global_average_pooling1D_layer(Res50958, Glo30674), 
LELU56211 = elu_layer(Glo30674, 5.226416384649344, ELU56211), 
LRes85218 = reshape_layer(ELU56211, [4, 1], Res85218), 
LRes83061 = reshape_layer(Res85218, [4, 1, 1], Res83061), 
LZer86614 = zero_padding2D_layer(Res83061, 0, 0, 4, 0, Zer86614), 
LCon25238 = concatenate_layer([Zer86614,[[[[0.2345, 0.1849, 0.6438], [0.0733, 0.4283, 0.9967], [0.9658, 0.8547, 0.2454], [0.7786, 0.2359, 0.7991], [0.9141, 0.4872, 0.9553]], [[0.6726, 0.8006, 0.0272], [0.3133, 0.2557, 0.0054], [0.7968, 0.2817, 0.7334], [0.8239, 0.2503, 0.0783], [0.6807, 0.3689, 0.432]], [[0.9066, 0.8819, 0.5032], [0.4486, 0.1198, 0.2531], [0.1148, 0.1474, 0.7355], [0.9515, 0.6838, 0.845], [0.527, 0.3488, 0.0337]], [[0.8127, 0.7609, 0.9241], [0.1389, 0.3668, 0.0141], [0.2854, 0.8696, 0.8321], [0.4037, 0.4719, 0.5942], [0.3555, 0.9965, 0.4041]]]]], 3, Con25238), 
LUp_351 = up_sampling1D_layer([[[1.4552, 1.0371], [1.391, 1.9243]]], 2, Up_351), 
LRes40717 = reshape_layer(Up_351, [4, 2, 1], Res40717), 
LLoc97136 = locally_connected2D_layer(Res40717, 4, 2,[[[0.7924, 0.1622, 0.6495, 0.4237], [0.005, 0.3059, 0.891, 0.0912], [0.6806, 0.5441, 0.9796, 0.5484], [0.22, 0.2888, 0.9214, 0.2301], [0.5097, 0.9448, 0.0964, 0.5114], [0.275, 0.4262, 0.128, 0.7853], [0.5842, 0.6082, 0.6573, 0.1689], [0.0294, 0.8025, 0.8375, 0.9918]]],[[[0, 0, 0, 0]]], 1, 1, Loc97136), 
LZer14415 = zero_padding2D_layer(Loc97136, 1, 1, 1, 1, Zer14415), 
LZer77384 = zero_padding2D_layer(Zer14415, 1, 0, 2, 0, Zer77384), 
LMul61293 = multiply_layer([Con25238,Zer77384], Mul61293), 
exec_layers([LLST52600,LRes69359,LRes40388,LCon43580,LRes50958,LGlo30674,LELU56211,LRes85218,LRes83061,LZer86614,LCon25238,LUp_351,LRes40717,LLoc97136,LZer14415,LZer77384,LMul61293],["LST52600","Res69359","Res40388","Con43580","Res50958","Glo30674","ELU56211","Res85218","Res83061","Zer86614","Con25238","Up_351","Res40717","Loc97136","Zer14415","Zer77384","Mul61293"],Mul61293,"Mul61293")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 5.8699762, 4.8936929, 5.1661535], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]]]]

Expected (Unparsed): [[[[0,0.0,0.0,0.0],[0,0.0,0.0,0.0],[0,0.0,0.0,0.0],[0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]],[[0,0.0,0.0,0.0],[0,0.0,0.0,0.0],[0,0.0,0.0,0.0],[0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]],[[0,0.0,0.0,0.0],[0,0.0,0.0,0.0],[0,0.0,0.0,0.0],[0.0,5.86997623531,4.893693138697999,5.1661533781],[0.0,0.0,0.0,0.0]],[[0,0.0,0.0,0.0],[0,0.0,0.0,0.0],[0,0.0,0.0,0.0],[0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]]]]

Actual:   [[[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 5.87, 4.8937, 5.1662], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]]]

Expected: [[[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 5.87, 4.8937, 5.1662], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]]]