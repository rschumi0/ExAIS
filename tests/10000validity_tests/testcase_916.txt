import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max27979 = tf.keras.layers.Input(shape=([2, 2]))
in1Max27979 = tf.keras.layers.Input(shape=([2, 2]))
in0Loc78495 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0GRU59234 = tf.keras.layers.Input(shape=([1, 3]))
in0Con40135 = tf.keras.layers.Input(shape=([1]))
in0Con40118 = tf.keras.layers.Input(shape=([1]))

Max27979 = keras.layers.Maximum(name = 'Max27979', )([in0Max27979,in1Max27979])
Fla61270 = keras.layers.Flatten(name = 'Fla61270', )(Max27979)
Loc78495 = keras.layers.LocallyConnected2D(3, (1, 1),strides=(5, 1), name = 'Loc78495', )(in0Loc78495)
Res92438 = keras.layers.Reshape((1, 3), name = 'Res92438', )(Loc78495)
Fla14011 = keras.layers.Flatten(name = 'Fla14011', )(Res92438)
GRU59234 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU59234', )(in0GRU59234)
Con40135 = keras.layers.Concatenate(axis=1, name = 'Con40135', )([GRU59234,in0Con40135])
Min47460 = keras.layers.Minimum(name = 'Min47460', )([Fla14011,Con40135])
Con40118 = keras.layers.Concatenate(axis=1, name = 'Con40118', )([Min47460,in0Con40118])
Sub58084 = keras.layers.Subtract(name = 'Sub58084', )([Fla61270,Con40118])
model = tf.keras.models.Model(inputs=[in0Max27979,in1Max27979,in0Loc78495,in0GRU59234,in0Con40135,in0Con40118], outputs=Sub58084)
w = model.get_layer('Loc78495').get_weights() 
w[0] = np.array([[[0.928, 0.5384, 0.4545]]])
w[1] = np.array([[[0, 0, 0]]])
model.get_layer('Loc78495').set_weights(w) 
w = model.get_layer('GRU59234').get_weights() 
w[0] = np.array([[10, 10, 1, 7, 10, 8], [4, 1, 1, 6, 8, 9], [10, 6, 7, 4, 10, 10]])
w[1] = np.array([[6, 3, 5, 10, 2, 3], [8, 9, 9, 1, 9, 4]])
w[2] = np.array([[1, 10, 10, 3, 9, 9], [5, 2, 2, 10, 10, 5]])
model.get_layer('GRU59234').set_weights(w) 
in0Max27979 = tf.constant([[[0.651, 0.5022], [0.8882, 0.9624]]])
in1Max27979 = tf.constant([[[0.4282, 0.7002], [0.9407, 0.2577]]])
in0Loc78495 = tf.constant([[[[0.1409]]]])
in0GRU59234 = tf.constant([[[1, 8, 10]]])
in0Con40135 = tf.constant([[0.7912]])
in0Con40118 = tf.constant([[0.6022]])
print (np.array2string(model.predict([in0Max27979,in1Max27979,in0Loc78495,in0GRU59234,in0Con40135,in0Con40118],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub58084.png')

LMax27979 = maximum_layer([[[[0.651, 0.5022], [0.8882, 0.9624]]], [[[0.4282, 0.7002], [0.9407, 0.2577]]]], Max27979), 
LFla61270 = flatten_layer(Max27979, Fla61270), 
LLoc78495 = locally_connected2D_layer([[[[0.1409]]]], 1, 1,[[[0.928, 0.5384, 0.4545]]],[[[0, 0, 0]]], 5, 1, Loc78495), 
LRes92438 = reshape_layer(Loc78495, [1, 3], Res92438), 
LFla14011 = flatten_layer(Res92438, Fla14011), 
LGRU59234 = gru_layer([[[1, 8, 10]]],[[10, 10, 1, 7, 10, 8], [4, 1, 1, 6, 8, 9], [10, 6, 7, 4, 10, 10]],[[6, 3, 5, 10, 2, 3], [8, 9, 9, 1, 9, 4]],[[1, 10, 10, 3, 9, 9], [5, 2, 2, 10, 10, 5]], true, GRU59234), 
LCon40135 = concatenate_layer([GRU59234,[[0.7912]]], 1, Con40135), 
LMin47460 = minimum_layer([Fla14011,Con40135], Min47460), 
LCon40118 = concatenate_layer([Min47460,[[0.6022]]], 1, Con40118), 
LSub58084 = subtract_layer(Fla61270,Con40118, Sub58084), 
exec_layers([LMax27979,LFla61270,LLoc78495,LRes92438,LFla14011,LGRU59234,LCon40135,LMin47460,LCon40118,LSub58084],["Max27979","Fla61270","Loc78495","Res92438","Fla14011","GRU59234","Con40135","Min47460","Con40118","Sub58084"],Sub58084,"Sub58084")

Actual (Unparsed): [[0.6510000, 0.7002000, 0.8766609, 0.3602000]]

Expected (Unparsed): [[0.651,0.7002,0.87666095,0.3602000000000001]]

Actual:   [[0.651, 0.7002, 0.8767, 0.3602]]

Expected: [[0.651, 0.7002, 0.8767, 0.3603]]