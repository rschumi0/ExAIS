import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave65108 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave65108 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Ave95881 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave95881 = tf.keras.layers.Input(shape=([2, 2]))

Ave65108 = keras.layers.Average(name = 'Ave65108', )([in0Ave65108,in1Ave65108])
Max5624 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 1), padding='valid', name = 'Max5624', )(Ave65108)
Res58170 = keras.layers.Reshape((2, 2), name = 'Res58170', )(Max5624)
Ave95881 = keras.layers.Average(name = 'Ave95881', )([in0Ave95881,in1Ave95881])
Max31669 = keras.layers.Maximum(name = 'Max31669', )([Res58170,Ave95881])
Res89979 = keras.layers.Reshape((2, 2, 1), name = 'Res89979', )(Max31669)
Res10365 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res10365', )(Res89979)
Up_77867 = keras.layers.UpSampling3D(size=(1, 1, 2), name = 'Up_77867', )(Res10365)
model = tf.keras.models.Model(inputs=[in0Ave65108,in1Ave65108,in0Ave95881,in1Ave95881], outputs=Up_77867)
in0Ave65108 = tf.constant([[[[0.244], [0.1793]], [[0.0591], [0.2495]]]])
in1Ave65108 = tf.constant([[[[0.2988], [0.9564]], [[0.2548], [0.6193]]]])
in0Ave95881 = tf.constant([[[0.5735, 0.3002], [0.7937, 0.1994]]])
in1Ave95881 = tf.constant([[[0.0962, 0.8342], [0.3639, 0.1606]]])
print (np.array2string(model.predict([in0Ave65108,in1Ave65108,in0Ave95881,in1Ave95881],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Up_77867.png')

LAve65108 = average_layer([[[[[0.244], [0.1793]], [[0.0591], [0.2495]]]], [[[[0.2988], [0.9564]], [[0.2548], [0.6193]]]]], Ave65108), 
LMax5624 = max_pool2D_layer(Ave65108, 1, 1, 1, 1, false, Max5624), 
LRes58170 = reshape_layer(Max5624, [2, 2], Res58170), 
LAve95881 = average_layer([[[[0.5735, 0.3002], [0.7937, 0.1994]]], [[[0.0962, 0.8342], [0.3639, 0.1606]]]], Ave95881), 
LMax31669 = maximum_layer([Res58170,Ave95881], Max31669), 
LRes89979 = reshape_layer(Max31669, [2, 2, 1], Res89979), 
LRes10365 = reshape_layer(Res89979, [2, 2, 1, 1], Res10365), 
LUp_77867 = up_sampling3D_layer(Res10365, 1, 1, 2, Up_77867), 
exec_layers([LAve65108,LMax5624,LRes58170,LAve95881,LMax31669,LRes89979,LRes10365,LUp_77867],["Ave65108","Max5624","Res58170","Ave95881","Max31669","Res89979","Res10365","Up_77867"],Up_77867,"Up_77867")

Actual (Unparsed): [[[[[0.3348500], [0.3348500]], [[0.5678500], [0.5678500]]], [[[0.5788000], [0.5788000]], [[0.4344000], [0.4344000]]]]]

Expected (Unparsed): [[[[[0.33485],[0.33485]],[[0.56785],[0.56785]]],[[[0.5788],[0.5788]],[[0.4344],[0.4344]]]]]

Actual:   [[[[[0.3349], [0.3349]], [[0.5679], [0.5679]]], [[[0.5788], [0.5788]], [[0.4344], [0.4344]]]]]

Expected: [[[[[0.3349], [0.3349]], [[0.5679], [0.5679]]], [[[0.5788], [0.5788]], [[0.4344], [0.4344]]]]]