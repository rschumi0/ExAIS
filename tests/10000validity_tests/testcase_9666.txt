import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max3941 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Max3941 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Max84959 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Max84959 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con77697 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Sub53032 = tf.keras.layers.Input(shape=([3, 3, 2]))
in1Sub53032 = tf.keras.layers.Input(shape=([3, 3, 2]))
in0Ave64062 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Ave64062 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con49701 = tf.keras.layers.Input(shape=([16]))

Max3941 = keras.layers.Maximum(name = 'Max3941', )([in0Max3941,in1Max3941])
Res37689 = keras.layers.Reshape((1, 2, 2), name = 'Res37689', )(Max3941)
Zer33386 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer33386', )(Res37689)
Max84959 = keras.layers.Maximum(name = 'Max84959', )([in0Max84959,in1Max84959])
Con77697 = keras.layers.Concatenate(axis=3, name = 'Con77697', )([Max84959,in0Con77697])
Max50983 = keras.layers.Maximum(name = 'Max50983', )([Zer33386,Con77697])
Zer97409 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer97409', )(Max50983)
Sub53032 = keras.layers.Subtract(name = 'Sub53032', )([in0Sub53032,in1Sub53032])
Add16819 = keras.layers.Add(name = 'Add16819', )([Zer97409,Sub53032])
Res36381 = keras.layers.Reshape((3, 6), name = 'Res36381', )(Add16819)
Fla8635 = keras.layers.Flatten(name = 'Fla8635', )(Res36381)
Ave64062 = keras.layers.Average(name = 'Ave64062', )([in0Ave64062,in1Ave64062])
Res77695 = keras.layers.Reshape((1, 1), name = 'Res77695', )(Ave64062)
Sim65048 = keras.layers.SimpleRNN(2,name = 'Sim65048', )(Res77695)
Con49701 = keras.layers.Concatenate(axis=1, name = 'Con49701', )([Sim65048,in0Con49701])
Sub77889 = keras.layers.Subtract(name = 'Sub77889', )([Fla8635,Con49701])
model = tf.keras.models.Model(inputs=[in0Max3941,in1Max3941,in0Max84959,in1Max84959,in0Con77697,in0Sub53032,in1Sub53032,in0Ave64062,in1Ave64062,in0Con49701], outputs=Sub77889)
w = model.get_layer('Sim65048').get_weights() 
w[0] = np.array([[6, 1]])
w[1] = np.array([[8, 1], [2, 1]])
w[2] = np.array([4, 6])
model.get_layer('Sim65048').set_weights(w) 
in0Max3941 = tf.constant([[[[[0.7863], [0.6392]], [[0.6645], [0.6917]]]]])
in1Max3941 = tf.constant([[[[[0.1878], [0.5002]], [[0.9713], [0.9047]]]]])
in0Max84959 = tf.constant([[[[0.771], [0.6455]], [[0.798], [0.6698]]]])
in1Max84959 = tf.constant([[[[0.5401], [0.5407]], [[0.0457], [0.1948]]]])
in0Con77697 = tf.constant([[[[0.3162], [0.0759]], [[0.3259], [0.6313]]]])
in0Sub53032 = tf.constant([[[[0.6628, 0.6071], [0.8399, 0.3454], [0.3985, 0.5187]], [[0.8696, 0.9558], [0.074, 0.231], [0.2078, 0.2548]], [[0.7122, 0.8696], [0.1468, 0.2433], [0.9986, 0.8166]]]])
in1Sub53032 = tf.constant([[[[0.7409, 0.2835], [0.7626, 0.2099], [0.8153, 0.73]], [[0.044, 0.5958], [0.1767, 0.1687], [0.1176, 0.661]], [[0.6388, 0.7144], [0.558, 0.811], [0.2611, 0.8632]]]])
in0Ave64062 = tf.constant([[[[0.5375]]]])
in1Ave64062 = tf.constant([[[[0.8587]]]])
in0Con49701 = tf.constant([[0.366, 0.3452, 0.3775, 0.619, 0.4135, 0.0465, 0.6461, 0.3516, 0.357, 0.9297, 0.566, 0.4694, 0.0888, 0.2852, 0.8721, 0.4904]])
print (np.array2string(model.predict([in0Max3941,in1Max3941,in0Max84959,in1Max84959,in0Con77697,in0Sub53032,in1Sub53032,in0Ave64062,in1Ave64062,in0Con49701],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub77889.png')

LMax3941 = maximum_layer([[[[[[0.7863], [0.6392]], [[0.6645], [0.6917]]]]], [[[[[0.1878], [0.5002]], [[0.9713], [0.9047]]]]]], Max3941), 
LRes37689 = reshape_layer(Max3941, [1, 2, 2], Res37689), 
LZer33386 = zero_padding2D_layer(Res37689, 1, 0, 0, 0, Zer33386), 
LMax84959 = maximum_layer([[[[[0.771], [0.6455]], [[0.798], [0.6698]]]], [[[[0.5401], [0.5407]], [[0.0457], [0.1948]]]]], Max84959), 
LCon77697 = concatenate_layer([Max84959,[[[[0.3162], [0.0759]], [[0.3259], [0.6313]]]]], 3, Con77697), 
LMax50983 = maximum_layer([Zer33386,Con77697], Max50983), 
LZer97409 = zero_padding2D_layer(Max50983, 1, 0, 1, 0, Zer97409), 
LSub53032 = subtract_layer([[[[0.6628, 0.6071], [0.8399, 0.3454], [0.3985, 0.5187]], [[0.8696, 0.9558], [0.074, 0.231], [0.2078, 0.2548]], [[0.7122, 0.8696], [0.1468, 0.2433], [0.9986, 0.8166]]]], [[[[0.7409, 0.2835], [0.7626, 0.2099], [0.8153, 0.73]], [[0.044, 0.5958], [0.1767, 0.1687], [0.1176, 0.661]], [[0.6388, 0.7144], [0.558, 0.811], [0.2611, 0.8632]]]], Sub53032), 
LAdd16819 = add_layer([Zer97409,Sub53032], Add16819), 
LRes36381 = reshape_layer(Add16819, [3, 6], Res36381), 
LFla8635 = flatten_layer(Res36381, Fla8635), 
LAve64062 = average_layer([[[[[0.5375]]]], [[[[0.8587]]]]], Ave64062), 
LRes77695 = reshape_layer(Ave64062, [1, 1], Res77695), 
LSim65048 = simple_rnn_layer(Res77695,[[6, 1]],[[8, 1], [2, 1]],[4, 6], Sim65048), 
LCon49701 = concatenate_layer([Sim65048,[[0.366, 0.3452, 0.3775, 0.619, 0.4135, 0.0465, 0.6461, 0.3516, 0.357, 0.9297, 0.566, 0.4694, 0.0888, 0.2852, 0.8721, 0.4904]]], 1, Con49701), 
LSub77889 = subtract_layer(Fla8635,Con49701, Sub77889), 
exec_layers([LMax3941,LRes37689,LZer33386,LMax84959,LCon77697,LMax50983,LZer97409,LSub53032,LAdd16819,LRes36381,LFla8635,LAve64062,LRes77695,LSim65048,LCon49701,LSub77889],["Max3941","Res37689","Zer33386","Max84959","Con77697","Max50983","Zer97409","Sub53032","Add16819","Res36381","Fla8635","Ave64062","Res77695","Sim65048","Con49701","Sub77889"],Sub77889,"Sub77889")

Actual (Unparsed): [[-1.0780998, -0.6763969, -0.2887000, -0.2097000, -0.7943000, -0.8303000, 0.4121000, 0.3135000, 0.0222000, 0.0269000, 0.3787000, -1.2600000, -0.4926000, -0.3142000, 0.2979999, -0.2137000, 0.8367000, 0.3677000]]

Expected (Unparsed): [[-1.0780998456515143,-0.6763969581794004,-0.28869999999999996,-0.20970000000000003,-0.7943,-0.8302999999999999,0.4121,0.3135,0.022199999999999998,0.02689999999999998,0.37870000000000004,-1.26,-0.4925999999999999,-0.3142,0.29800000000000004,-0.2137000000000001,0.8367000000000001,0.36769999999999997]]

Actual:   [[-1.078, -0.6763, -0.2887, -0.2097, -0.7943, -0.8303, 0.4121, 0.3135, 0.0222, 0.0269, 0.3787, -1.26, -0.4926, -0.3142, 0.298, -0.2137, 0.8367, 0.3677]]

Expected: [[-1.078, -0.6763, -0.2886, -0.2097, -0.7943, -0.8302, 0.4121, 0.3135, 0.0222, 0.0269, 0.3788, -1.26, -0.4925, -0.3142, 0.2981, -0.2137, 0.8368, 0.3677]]