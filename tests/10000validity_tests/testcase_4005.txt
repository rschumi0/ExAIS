import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con79428 = tf.keras.layers.Input(shape=([1, 1]))
in0Con82573 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Max88265 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Max88265 = tf.keras.layers.Input(shape=([1, 2, 2]))

Con79428 = keras.layers.Conv1D(3, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con79428', )(in0Con79428)
Res62277 = keras.layers.Reshape((1, 3, 1), name = 'Res62277', )(Con79428)
Res22767 = keras.layers.Reshape((1, 3, 1, 1), name = 'Res22767', )(Res62277)
Glo687 = keras.layers.GlobalMaxPool3D(name = 'Glo687', )(Res22767)
ReL18767 = keras.layers.ReLU(max_value=1.6202798414678241, negative_slope=2.0737285344152463, threshold=8.819056857121565, name = 'ReL18767', )(Glo687)
Res20392 = keras.layers.Reshape((1, 1), name = 'Res20392', )(ReL18767)
Res410 = keras.layers.Reshape((1, 1, 1), name = 'Res410', )(Res20392)
Zer77693 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer77693', )(Res410)
Con82573 = keras.layers.Concatenate(axis=3, name = 'Con82573', )([Zer77693,in0Con82573])
Max88265 = keras.layers.Maximum(name = 'Max88265', )([in0Max88265,in1Max88265])
Sub37407 = keras.layers.Subtract(name = 'Sub37407', )([Con82573,Max88265])
Res70266 = keras.layers.Reshape((1, 4), name = 'Res70266', )(Sub37407)
Ave69175 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='same', name = 'Ave69175', )(Res70266)
model = tf.keras.models.Model(inputs=[in0Con79428,in0Con82573,in0Max88265,in1Max88265], outputs=Ave69175)
w = model.get_layer('Con79428').get_weights() 
w[0] = np.array([[[0.5039, 0.1337, 0.7503]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con79428').set_weights(w) 
in0Con79428 = tf.constant([[[0.3716]]])
in0Con82573 = tf.constant([[[[0.402], [0.1916]]]])
in0Max88265 = tf.constant([[[[0.0891, 0.5963], [0.73, 0.4011]]]])
in1Max88265 = tf.constant([[[[0.8817, 0.3103], [0.8984, 0.3571]]]])
print (np.array2string(model.predict([in0Con79428,in0Con82573,in0Max88265,in1Max88265],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave69175.png')

LCon79428 = conv1D_layer([[[0.3716]]], 1,[[[0.5039, 0.1337, 0.7503]]],[0, 0, 0], 1, true, 1, Con79428), 
LRes62277 = reshape_layer(Con79428, [1, 3, 1], Res62277), 
LRes22767 = reshape_layer(Res62277, [1, 3, 1, 1], Res22767), 
LGlo687 = global_max_pool3D_layer(Res22767, Glo687), 
LReL18767 = relu_layer(Glo687, 1.6202798414678241, 2.0737285344152463, 8.819056857121565, ReL18767), 
LRes20392 = reshape_layer(ReL18767, [1, 1], Res20392), 
LRes410 = reshape_layer(Res20392, [1, 1, 1], Res410), 
LZer77693 = zero_padding2D_layer(Res410, 0, 0, 1, 0, Zer77693), 
LCon82573 = concatenate_layer([Zer77693,[[[[0.402], [0.1916]]]]], 3, Con82573), 
LMax88265 = maximum_layer([[[[[0.0891, 0.5963], [0.73, 0.4011]]]], [[[[0.8817, 0.3103], [0.8984, 0.3571]]]]], Max88265), 
LSub37407 = subtract_layer(Con82573,Max88265, Sub37407), 
LRes70266 = reshape_layer(Sub37407, [1, 4], Res70266), 
LAve69175 = average_pooling1D_layer(Res70266, 1, 1, true, Ave69175), 
exec_layers([LCon79428,LRes62277,LRes22767,LGlo687,LReL18767,LRes20392,LRes410,LZer77693,LCon82573,LMax88265,LSub37407,LRes70266,LAve69175],["Con79428","Res62277","Res22767","Glo687","ReL18767","Res20392","Res410","Zer77693","Con82573","Max88265","Sub37407","Res70266","Ave69175"],Ave69175,"Ave69175")

Actual (Unparsed): [[[-0.8817000, -0.1943000, -18.6085505, -0.2095000]]]

Expected (Unparsed): [[[-0.8817,-0.19430000000000003,-18.60855052944488,-0.20950000000000002]]]

Actual:   [[[-0.8817, -0.1943, -18.6085, -0.2095]]]

Expected: [[[-0.8817, -0.1943, -18.6085, -0.2095]]]