import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul96710 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Mul96710 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Thr64173 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con20842 = tf.keras.layers.Input(shape=([2, 3, 1]))
in0Con60097 = tf.keras.layers.Input(shape=([2, 3, 2, 1]))
in0Add18611 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in1Add18611 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))

Mul96710 = keras.layers.Multiply(name = 'Mul96710', )([in0Mul96710,in1Mul96710])
Res16904 = keras.layers.Reshape((1, 2, 2), name = 'Res16904', )(Mul96710)
Zer93355 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer93355', )(Res16904)
Thr64173 = keras.layers.ThresholdedReLU(theta=2.0539282496341387, name = 'Thr64173', input_shape=(2, 1, 1))(in0Thr64173)
Zer83043 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer83043', )(Thr64173)
Con20842 = keras.layers.Concatenate(axis=3, name = 'Con20842', )([Zer83043,in0Con20842])
Ave63443 = keras.layers.Average(name = 'Ave63443', )([Zer93355,Con20842])
Res221 = keras.layers.Reshape((2, 3, 2, 1), name = 'Res221', )(Ave63443)
Con60097 = keras.layers.Concatenate(axis=4, name = 'Con60097', )([Res221,in0Con60097])
Add18611 = keras.layers.Add(name = 'Add18611', )([in0Add18611,in1Add18611])
Zer2445 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer2445', )(Add18611)
Ave44699 = keras.layers.Average(name = 'Ave44699', )([Con60097,Zer2445])
Res69519 = keras.layers.Reshape((2, 3, 4), name = 'Res69519', )(Ave44699)
Res67736 = keras.layers.Reshape((2, 12), name = 'Res67736', )(Res69519)
LST7240 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST7240', )(Res67736)
model = tf.keras.models.Model(inputs=[in0Mul96710,in1Mul96710,in0Thr64173,in0Con20842,in0Con60097,in0Add18611,in1Add18611], outputs=LST7240)
w = model.get_layer('LST7240').get_weights() 
w[0] = np.array([[5, 2, 3, 8, 9, 7, 10, 5], [8, 7, 5, 4, 4, 8, 1, 4], [6, 6, 3, 7, 3, 5, 6, 9], [7, 6, 7, 10, 6, 3, 2, 7], [8, 2, 1, 2, 7, 9, 1, 2], [4, 1, 2, 3, 5, 10, 2, 10], [5, 5, 7, 2, 8, 6, 3, 8], [7, 9, 6, 5, 4, 9, 4, 9], [8, 1, 2, 9, 4, 9, 5, 1], [7, 8, 8, 9, 8, 9, 9, 4], [2, 10, 4, 6, 1, 10, 9, 5], [6, 8, 2, 8, 1, 2, 9, 5]])
w[1] = np.array([[4, 6, 2, 3, 4, 5, 10, 9], [8, 9, 9, 5, 8, 5, 8, 7]])
w[2] = np.array([3, 10, 3, 2, 6, 9, 1, 10])
model.get_layer('LST7240').set_weights(w) 
in0Mul96710 = tf.constant([[[[[0.0149, 0.4341]], [[0.0413, 0.7493]]]]])
in1Mul96710 = tf.constant([[[[[0.892, 0.3969]], [[0.5726, 0.2822]]]]])
in0Thr64173 = tf.constant([[[[0.9326]], [[0.9018]]]])
in0Con20842 = tf.constant([[[[0.8183], [0.9683], [0.0402]], [[0.5768], [0.1975], [0.3659]]]])
in0Con60097 = tf.constant([[[[[0.8544], [0.451]], [[0.1708], [0.7221]], [[0.6426], [0.3643]]], [[[0.1284], [0.6415]], [[0.948], [0.9036]], [[0.875], [0.3956]]]]])
in0Add18611 = tf.constant([[[[[0.3758, 0.3448], [0.8903, 0.3547]]], [[[0.9864, 0.3924], [0.5835, 0.9355]]]]])
in1Add18611 = tf.constant([[[[[0.2802, 0.0495], [0.908, 0.1192]]], [[[0.8316, 0.5949], [0.2825, 0.52]]]]])
print (np.array2string(model.predict([in0Mul96710,in1Mul96710,in0Thr64173,in0Con20842,in0Con60097,in0Add18611,in1Add18611],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST7240.png')

LMul96710 = multiply_layer([[[[[[0.0149, 0.4341]], [[0.0413, 0.7493]]]]], [[[[[0.892, 0.3969]], [[0.5726, 0.2822]]]]]], Mul96710), 
LRes16904 = reshape_layer(Mul96710, [1, 2, 2], Res16904), 
LZer93355 = zero_padding2D_layer(Res16904, 1, 0, 1, 0, Zer93355), 
LThr64173 = thresholded_relu_layer([[[[0.9326]], [[0.9018]]]], 2.0539282496341387, Thr64173), 
LZer83043 = zero_padding2D_layer(Thr64173, 0, 0, 2, 0, Zer83043), 
LCon20842 = concatenate_layer([Zer83043,[[[[0.8183], [0.9683], [0.0402]], [[0.5768], [0.1975], [0.3659]]]]], 3, Con20842), 
LAve63443 = average_layer([Zer93355,Con20842], Ave63443), 
LRes221 = reshape_layer(Ave63443, [2, 3, 2, 1], Res221), 
LCon60097 = concatenate_layer([Res221,[[[[[0.8544], [0.451]], [[0.1708], [0.7221]], [[0.6426], [0.3643]]], [[[0.1284], [0.6415]], [[0.948], [0.9036]], [[0.875], [0.3956]]]]]], 4, Con60097), 
LAdd18611 = add_layer([[[[[[0.3758, 0.3448], [0.8903, 0.3547]]], [[[0.9864, 0.3924], [0.5835, 0.9355]]]]], [[[[[0.2802, 0.0495], [0.908, 0.1192]]], [[[0.8316, 0.5949], [0.2825, 0.52]]]]]], Add18611), 
LZer2445 = zero_padding3D_layer(Add18611, 0, 0, 2, 0, 0, 0, Zer2445), 
LAve44699 = average_layer([Con60097,Zer2445], Ave44699), 
LRes69519 = reshape_layer(Ave44699, [2, 3, 4], Res69519), 
LRes67736 = reshape_layer(Res69519, [2, 12], Res67736), 
LLST7240 = lstm_layer(Res67736,[[5, 2, 3, 8, 9, 7, 10, 5], [8, 7, 5, 4, 4, 8, 1, 4], [6, 6, 3, 7, 3, 5, 6, 9], [7, 6, 7, 10, 6, 3, 2, 7], [8, 2, 1, 2, 7, 9, 1, 2], [4, 1, 2, 3, 5, 10, 2, 10], [5, 5, 7, 2, 8, 6, 3, 8], [7, 9, 6, 5, 4, 9, 4, 9], [8, 1, 2, 9, 4, 9, 5, 1], [7, 8, 8, 9, 8, 9, 9, 4], [2, 10, 4, 6, 1, 10, 9, 5], [6, 8, 2, 8, 1, 2, 9, 5]],[[4, 6, 2, 3, 4, 5, 10, 9], [8, 9, 9, 5, 8, 5, 8, 7]],[3, 10, 3, 2, 6, 9, 1, 10], LST7240), 
exec_layers([LMul96710,LRes16904,LZer93355,LThr64173,LZer83043,LCon20842,LAve63443,LRes221,LCon60097,LAdd18611,LZer2445,LAve44699,LRes69519,LRes67736,LLST7240],["Mul96710","Res16904","Zer93355","Thr64173","Zer83043","Con20842","Ave63443","Res221","Con60097","Add18611","Zer2445","Ave44699","Res69519","Res67736","LST7240"],LST7240,"LST7240")

Actual (Unparsed): [[0.9640276, 0.9640276]]

Expected (Unparsed): [[0.964027580072836,0.9640275800758169]]

Actual:   [[0.9641, 0.9641]]

Expected: [[0.9641, 0.9641]]