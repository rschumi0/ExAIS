import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave94177 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Ave94177 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

Ave94177 = keras.layers.Average(name = 'Ave94177', )([in0Ave94177,in1Ave94177])
Res43644 = keras.layers.Reshape((2, 2, 2), name = 'Res43644', )(Ave94177)
Dep72654 = keras.layers.DepthwiseConv2D((2, 2),strides=(1, 1), padding='same', name = 'Dep72654', )(Res43644)
Den18419 = keras.layers.Dense(4,name = 'Den18419', )(Dep72654)
model = tf.keras.models.Model(inputs=[in0Ave94177,in1Ave94177], outputs=Den18419)
w = model.get_layer('Dep72654').get_weights() 
w[0] = np.array([[[[0.0328], [0.6369]], [[0.6684], [0.4477]]], [[[0.4886], [0.4985]], [[0.3494], [0.8429]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep72654').set_weights(w) 
w = model.get_layer('Den18419').get_weights() 
w[0] = np.array([[0.487, 0.5125, 0.3225, 0.2186], [0.4591, 0.7743, 0.8693, 0.9525]])
w[1] = np.array([0.5201, 0.0978, 0.1924, 0.6172])
model.get_layer('Den18419').set_weights(w) 
in0Ave94177 = tf.constant([[[[[0.9938, 0.1067]], [[0.3012, 0.7856]]], [[[0.3182, 0.5506]], [[0.6663, 0.439]]]]])
in1Ave94177 = tf.constant([[[[[0.4929, 0.5189]], [[0.7806, 0.4339]]], [[[0.7129, 0.0911]], [[0.7154, 0.0558]]]]])
print (np.array2string(model.predict([in0Ave94177,in1Ave94177],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Den18419.png')

LAve94177 = average_layer([[[[[[0.9938, 0.1067]], [[0.3012, 0.7856]]], [[[0.3182, 0.5506]], [[0.6663, 0.439]]]]], [[[[[0.4929, 0.5189]], [[0.7806, 0.4339]]], [[[0.7129, 0.0911]], [[0.7154, 0.0558]]]]]], Ave94177), 
LRes43644 = reshape_layer(Ave94177, [2, 2, 2], Res43644), 
LDep72654 = depthwise_conv2D_layer(Res43644, 2, 2,[[[[0.0328], [0.6369]], [[0.6684], [0.4477]]], [[[0.4886], [0.4985]], [[0.3494], [0.8429]]]],[0, 0], 1, 1, true, Dep72654), 
LDen18419 = dense_layer(Dep72654, [[0.487, 0.5125, 0.3225, 0.2186], [0.4591, 0.7743, 0.8693, 0.9525]],[0.5201, 0.0978, 0.1924, 0.6172], Den18419), 
exec_layers([LAve94177,LRes43644,LDep72654,LDen18419],["Ave94177","Res43644","Dep72654","Den18419"],Den18419,"Den18419")

Actual (Unparsed): [[[[1.3342288, 1.1993321, 1.2067492, 1.6101452], [0.9280383, 0.6760793, 0.7517836, 1.1822405]], [[0.8978815, 0.5871105, 0.6206978, 1.0219808], [0.6034753, 0.2314189, 0.3366826, 0.7722380]]]]

Expected (Unparsed): [[[[1.3342287685979999,1.1993321522939997,1.2067491569939999,1.610145217426],[0.9280383139024999,0.6760793484275,0.7517835648525,1.1822405133755]],[[0.8978814850495,0.5871104573835,0.6206978459585,1.0219807793604998],[0.603475317006,0.231418911658,0.336682595158,0.7722379794180001]]]]

Actual:   [[[[1.3343, 1.1994, 1.2068, 1.6102], [0.9281, 0.6761, 0.7518, 1.1823]], [[0.8979, 0.5872, 0.6207, 1.022], [0.6035, 0.2315, 0.3367, 0.7723]]]]

Expected: [[[[1.3343, 1.1994, 1.2068, 1.6102], [0.9281, 0.6761, 0.7518, 1.1823]], [[0.8979, 0.5872, 0.6207, 1.022], [0.6035, 0.2315, 0.3367, 0.7723]]]]