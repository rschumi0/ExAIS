import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave24322 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Ave24322 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Sub17010 = tf.keras.layers.Input(shape=([3, 3]))
in1Sub17010 = tf.keras.layers.Input(shape=([3, 3]))

Ave24322 = keras.layers.Average(name = 'Ave24322', )([in0Ave24322,in1Ave24322])
Zer70874 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer70874', )(Ave24322)
Sub17010 = keras.layers.Subtract(name = 'Sub17010', )([in0Sub17010,in1Sub17010])
Ave4886 = keras.layers.AveragePooling1D(pool_size=(2), strides=(1), padding='same', name = 'Ave4886', )(Sub17010)
Res88707 = keras.layers.Reshape((3, 3, 1), name = 'Res88707', )(Ave4886)
PRe57911 = keras.layers.PReLU(name = 'PRe57911', )(Res88707)
Ave50414 = keras.layers.Average(name = 'Ave50414', )([Zer70874,PRe57911])
model = tf.keras.models.Model(inputs=[in0Ave24322,in1Ave24322,in0Sub17010,in1Sub17010], outputs=Ave50414)
w = model.get_layer('PRe57911').get_weights() 
w[0] = np.array([[[0.1967], [0.8745], [0.4642]], [[0.5089], [0.0358], [0.5565]], [[0.34], [0.1217], [0.6516]]])
model.get_layer('PRe57911').set_weights(w) 
in0Ave24322 = tf.constant([[[[0.5713]], [[0.566]]]])
in1Ave24322 = tf.constant([[[[0.4441]], [[0.0477]]]])
in0Sub17010 = tf.constant([[[0.9031, 0.0952, 0.76], [0.9933, 0.3233, 0.7034], [0.5091, 0.678, 0.9941]]])
in1Sub17010 = tf.constant([[[0.9226, 0.4874, 0.7318], [0.0881, 0.643, 0.4104], [0.9141, 0.1996, 0.9564]]])
print (np.array2string(model.predict([in0Ave24322,in1Ave24322,in0Sub17010,in1Sub17010],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave50414.png')

LAve24322 = average_layer([[[[[0.5713]], [[0.566]]]], [[[[0.4441]], [[0.0477]]]]], Ave24322), 
LZer70874 = zero_padding2D_layer(Ave24322, 1, 0, 2, 0, Zer70874), 
LSub17010 = subtract_layer([[[0.9031, 0.0952, 0.76], [0.9933, 0.3233, 0.7034], [0.5091, 0.678, 0.9941]]], [[[0.9226, 0.4874, 0.7318], [0.0881, 0.643, 0.4104], [0.9141, 0.1996, 0.9564]]], Sub17010), 
LAve4886 = average_pooling1D_layer(Sub17010, 2, 1, true, Ave4886), 
LRes88707 = reshape_layer(Ave4886, [3, 3, 1], Res88707), 
LPRe57911 = prelu_layer(Res88707, [[[0.1967], [0.8745], [0.4642]], [[0.5089], [0.0358], [0.5565]], [[0.34], [0.1217], [0.6516]]], PRe57911), 
LAve50414 = average_layer([Zer70874,PRe57911], Ave50414), 
exec_layers([LAve24322,LZer70874,LSub17010,LAve4886,LRes88707,LPRe57911,LAve50414],["Ave24322","Zer70874","Sub17010","Ave4886","Res88707","PRe57911","Ave50414"],Ave50414,"Ave50414")

Actual (Unparsed): [[[[0.2214250], [-0.1556391], [0.0803000]], [[0.1250500], [0.0396750], [0.3365250]], [[-0.0688500], [0.2392000], [0.1722750]]]]

Expected (Unparsed): [[[[0.221425],[-0.1556391375],[0.08030000000000001]],[[0.12505],[0.039675],[0.336525]],[[-0.06885000000000001],[0.23920000000000002],[0.17227499999999996]]]]

Actual:   [[[[0.2215], [-0.1556], [0.0803]], [[0.1251], [0.0397], [0.3366]], [[-0.0688], [0.2392], [0.1723]]]]

Expected: [[[[0.2215], [-0.1556], [0.0804]], [[0.1251], [0.0397], [0.3366]], [[-0.0688], [0.2393], [0.1723]]]]