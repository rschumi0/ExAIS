import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub93874 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub93874 = tf.keras.layers.Input(shape=([2, 3]))
in0Ave54689 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Ave54689 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Con68567 = tf.keras.layers.Input(shape=([4]))

Sub93874 = keras.layers.Subtract(name = 'Sub93874', )([in0Sub93874,in1Sub93874])
Fla68793 = keras.layers.Flatten(name = 'Fla68793', )(Sub93874)
Ave54689 = keras.layers.Average(name = 'Ave54689', )([in0Ave54689,in1Ave54689])
Res24022 = keras.layers.Reshape((2, 1, 2), name = 'Res24022', )(Ave54689)
Res77533 = keras.layers.Reshape((2, 2), name = 'Res77533', )(Res24022)
Glo61644 = keras.layers.GlobalMaxPool1D(name = 'Glo61644', )(Res77533)
Con68567 = keras.layers.Concatenate(axis=1, name = 'Con68567', )([Glo61644,in0Con68567])
Min59079 = keras.layers.Minimum(name = 'Min59079', )([Fla68793,Con68567])
Res17385 = keras.layers.Reshape((6, 1), name = 'Res17385', )(Min59079)
PRe7158 = keras.layers.PReLU(name = 'PRe7158', )(Res17385)
model = tf.keras.models.Model(inputs=[in0Sub93874,in1Sub93874,in0Ave54689,in1Ave54689,in0Con68567], outputs=PRe7158)
w = model.get_layer('PRe7158').get_weights() 
w[0] = np.array([[0.1053], [0.6757], [0.1924], [0.1588], [0.7016], [0.7985]])
model.get_layer('PRe7158').set_weights(w) 
in0Sub93874 = tf.constant([[[0.7316, 0.6311, 0.71], [0.0746, 0.5525, 0.8639]]])
in1Sub93874 = tf.constant([[[0.5134, 0.0844, 0.4465], [0.1904, 0.7668, 0.4083]]])
in0Ave54689 = tf.constant([[[[[0.406, 0.2207]]], [[[0.2166, 0.2969]]]]])
in1Ave54689 = tf.constant([[[[[0.3359, 0.4014]]], [[[0.9139, 0.6684]]]]])
in0Con68567 = tf.constant([[0.5565, 0.1846, 0.642, 0.5056]])
print (np.array2string(model.predict([in0Sub93874,in1Sub93874,in0Ave54689,in1Ave54689,in0Con68567],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='PRe7158.png')

LSub93874 = subtract_layer([[[0.7316, 0.6311, 0.71], [0.0746, 0.5525, 0.8639]]], [[[0.5134, 0.0844, 0.4465], [0.1904, 0.7668, 0.4083]]], Sub93874), 
LFla68793 = flatten_layer(Sub93874, Fla68793), 
LAve54689 = average_layer([[[[[[0.406, 0.2207]]], [[[0.2166, 0.2969]]]]], [[[[[0.3359, 0.4014]]], [[[0.9139, 0.6684]]]]]], Ave54689), 
LRes24022 = reshape_layer(Ave54689, [2, 1, 2], Res24022), 
LRes77533 = reshape_layer(Res24022, [2, 2], Res77533), 
LGlo61644 = global_max_pool1D_layer(Res77533, Glo61644), 
LCon68567 = concatenate_layer([Glo61644,[[0.5565, 0.1846, 0.642, 0.5056]]], 1, Con68567), 
LMin59079 = minimum_layer([Fla68793,Con68567], Min59079), 
LRes17385 = reshape_layer(Min59079, [6, 1], Res17385), 
LPRe7158 = prelu_layer(Res17385, [[0.1053], [0.6757], [0.1924], [0.1588], [0.7016], [0.7985]], PRe7158), 
exec_layers([LSub93874,LFla68793,LAve54689,LRes24022,LRes77533,LGlo61644,LCon68567,LMin59079,LRes17385,LPRe7158],["Sub93874","Fla68793","Ave54689","Res24022","Res77533","Glo61644","Con68567","Min59079","Res17385","PRe7158"],PRe7158,"PRe7158")

Actual (Unparsed): [[[0.2182000], [0.4826500], [0.2635000], [-0.0183890], [-0.1503529], [0.4556000]]]

Expected (Unparsed): [[[0.21820000000000006],[0.48265],[0.26349999999999996],[-0.018389040000000002],[-0.15035288000000002],[0.4556]]]

Actual:   [[[0.2182], [0.4827], [0.2635], [-0.0183], [-0.1503], [0.4556]]]

Expected: [[[0.2183], [0.4827], [0.2635], [-0.0183], [-0.1503], [0.4556]]]