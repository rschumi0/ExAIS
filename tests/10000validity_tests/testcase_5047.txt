import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub19199 = tf.keras.layers.Input(shape=([2, 3, 3]))
in1Sub19199 = tf.keras.layers.Input(shape=([2, 3, 3]))

Sub19199 = keras.layers.Subtract(name = 'Sub19199', )([in0Sub19199,in1Sub19199])
Bat79045 = keras.layers.BatchNormalization(axis=3, epsilon=0.4049505799780839,  name = 'Bat79045', )(Sub19199)
model = tf.keras.models.Model(inputs=[in0Sub19199,in1Sub19199], outputs=Bat79045)
w = model.get_layer('Bat79045').get_weights() 
w[0] = np.array([0.1775, 0.4253, 0.4761])
w[1] = np.array([0.0432, 0.5728, 0.9257])
w[2] = np.array([0.8735, 0.1371, 0.1888])
w[3] = np.array([0.7551, 0.3972, 0.7268])
model.get_layer('Bat79045').set_weights(w) 
in0Sub19199 = tf.constant([[[[0.6208, 0.6281, 0.0519], [0.9102, 0.3136, 0.3578], [0.5408, 0.529, 0.4753]], [[0.5508, 0.2038, 0.8223], [0.0301, 0.2868, 0.583], [0.8925, 0.3413, 0.1248]]]])
in1Sub19199 = tf.constant([[[[0.3166, 0.7409, 0.4173], [0.7615, 0.9214, 0.3322], [0.8958, 0.8559, 0.3856]], [[0.1899, 0.7881, 0.183], [0.2531, 0.1994, 0.9026], [0.9111, 0.5185, 0.7558]]]])
print (np.array2string(model.predict([in0Sub19199,in1Sub19199],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Bat79045.png')

LSub19199 = subtract_layer([[[[0.6208, 0.6281, 0.0519], [0.9102, 0.3136, 0.3578], [0.5408, 0.529, 0.4753]], [[0.5508, 0.2038, 0.8223], [0.0301, 0.2868, 0.583], [0.8925, 0.3413, 0.1248]]]], [[[[0.3166, 0.7409, 0.4173], [0.7615, 0.9214, 0.3322], [0.8958, 0.8559, 0.3856]], [[0.1899, 0.7881, 0.183], [0.2531, 0.1994, 0.9026], [0.9111, 0.5185, 0.7558]]]], Sub19199), 
LBat79045 = batch_normalization_layer(Sub19199, 3, 0.4049505799780839, [0.1775, 0.4253, 0.4761], [0.0432, 0.5728, 0.9257], [0.8735, 0.1371, 0.1888], [0.7551, 0.3972, 0.7268], Bat79045), 
exec_layers([LSub19199,LBat79045],["Sub19199","Bat79045"],Bat79045,"Bat79045")

Actual (Unparsed): [[[[-0.0506212, 0.4541320, 0.6776785], [-0.0762478, 0.2190753, 0.8526630], [-0.1592581, 0.3524640, 0.8813497]], [[-0.0412770, 0.2302345, 1.1273126], [-0.1375043, 0.5491994, 0.6981754], [-0.1038190, 0.4235509, 0.5588143]]]]

Expected (Unparsed): [[[[-0.05062122053028846,0.45413198224484164,0.6776784940985862],[-0.07624777909775701,0.21907528441049434,0.852662992127191],[-0.15925805273398802,0.35246402465628857,0.8813497090674303]],[[-0.041277002711796726,0.23023454178242797,1.1273125738155665],[-0.13750431813009184,0.5491993578133999,0.6981753994942642],[-0.10381898969799815,0.42355086842558515,0.5588143440310736]]]]

Actual:   [[[[-0.0506, 0.4542, 0.6777], [-0.0762, 0.2191, 0.8527], [-0.1592, 0.3525, 0.8814]], [[-0.0412, 0.2303, 1.1274], [-0.1375, 0.5492, 0.6982], [-0.1038, 0.4236, 0.5589]]]]

Expected: [[[[-0.0506, 0.4542, 0.6777], [-0.0762, 0.2191, 0.8527], [-0.1592, 0.3525, 0.8814]], [[-0.0412, 0.2303, 1.1274], [-0.1375, 0.5492, 0.6982], [-0.1038, 0.4236, 0.5589]]]]