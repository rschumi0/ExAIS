import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0ELU30541 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Con29475 = tf.keras.layers.Input(shape=([3, 3, 2]))
in0Dot24446 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot24446 = tf.keras.layers.Input(shape=([3, 3]))
in0Con53484 = tf.keras.layers.Input(shape=([3, 3, 2]))
in0Mul36858 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Mul36858 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

ELU30541 = keras.layers.ELU(alpha=-5.910064043335392, name = 'ELU30541', input_shape=(1, 2, 1, 1))(in0ELU30541)
Res46592 = keras.layers.Reshape((1, 2, 1), name = 'Res46592', )(ELU30541)
Zer82076 = keras.layers.ZeroPadding2D(padding=((2, 0), (1, 0)), name = 'Zer82076', )(Res46592)
Con29475 = keras.layers.Concatenate(axis=3, name = 'Con29475', )([Zer82076,in0Con29475])
Dot24446 = keras.layers.Dot(axes=(1, 1), name = 'Dot24446', )([in0Dot24446,in1Dot24446])
Res20732 = keras.layers.Reshape((3, 3, 1), name = 'Res20732', )(Dot24446)
Con53484 = keras.layers.Concatenate(axis=3, name = 'Con53484', )([Res20732,in0Con53484])
Mul36858 = keras.layers.Multiply(name = 'Mul36858', )([in0Mul36858,in1Mul36858])
Res71032 = keras.layers.Reshape((2, 2, 2), name = 'Res71032', )(Mul36858)
Sep39306 = keras.layers.SeparableConv2D(3, (2, 2),strides=(2, 2), padding='same', name = 'Sep39306', )(Res71032)
Zer81610 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer81610', )(Sep39306)
Mul39103 = keras.layers.Multiply(name = 'Mul39103', )([Con53484,Zer81610])
Sub22266 = keras.layers.Subtract(name = 'Sub22266', )([Con29475,Mul39103])
model = tf.keras.models.Model(inputs=[in0ELU30541,in0Con29475,in0Dot24446,in1Dot24446,in0Con53484,in0Mul36858,in1Mul36858], outputs=Sub22266)
w = model.get_layer('Sep39306').get_weights() 
w[0] = np.array([[[[0.2819], [0.9489]], [[0.0684], [0.5427]]], [[[0.5008], [0.8326]], [[0.4825], [0.7453]]]])
w[1] = np.array([[[[0.2147, 0.9263, 0.9531], [0.744, 0.2844, 0.4076]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep39306').set_weights(w) 
in0ELU30541 = tf.constant([[[[[0.6922]], [[0.3968]]]]])
in0Con29475 = tf.constant([[[[0.6781, 0.3993], [0.5969, 0.6044], [0.0419, 0.2422]], [[0.0715, 0.6553], [0.7199, 0.3167], [0.7571, 0.3333]], [[0.6154, 0.4207], [0.5727, 0.0646], [0.3062, 0.6285]]]])
in0Dot24446 = tf.constant([[[0.7883, 0.6625, 0.3743], [0.5151, 0.3996, 0.4034], [0.1152, 0.9409, 0.0373]]])
in1Dot24446 = tf.constant([[[0.4481, 0.3616, 0.7643], [0.2728, 0.2487, 0.0584], [0.7773, 0.0701, 0.3147]]])
in0Con53484 = tf.constant([[[[0.2158, 0.0594], [0.7483, 0.0888], [0.9082, 0.8929]], [[0.7054, 0.4946], [0.7468, 0.2996], [0.0225, 0.0579]], [[0.5229, 0.4154], [0.3582, 0.7759], [0.1406, 0.2081]]]])
in0Mul36858 = tf.constant([[[[[0.4778, 0.3924]], [[0.0682, 0.776]]], [[[0.4377, 0.3855]], [[0.2245, 0.383]]]]])
in1Mul36858 = tf.constant([[[[[0.1957, 0.4344]], [[0.2337, 0.7554]]], [[[0.5089, 0.3602]], [[0.3588, 0.262]]]]])
print (np.array2string(model.predict([in0ELU30541,in0Con29475,in0Dot24446,in1Dot24446,in0Con53484,in0Mul36858,in1Mul36858],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub22266.png')

LELU30541 = elu_layer([[[[[0.6922]], [[0.3968]]]]], -5.910064043335392, ELU30541), 
LRes46592 = reshape_layer(ELU30541, [1, 2, 1], Res46592), 
LZer82076 = zero_padding2D_layer(Res46592, 2, 0, 1, 0, Zer82076), 
LCon29475 = concatenate_layer([Zer82076,[[[[0.6781, 0.3993], [0.5969, 0.6044], [0.0419, 0.2422]], [[0.0715, 0.6553], [0.7199, 0.3167], [0.7571, 0.3333]], [[0.6154, 0.4207], [0.5727, 0.0646], [0.3062, 0.6285]]]]], 3, Con29475), 
LDot24446 = dot_layer([[[0.7883, 0.6625, 0.3743], [0.5151, 0.3996, 0.4034], [0.1152, 0.9409, 0.0373]]], [[[0.4481, 0.3616, 0.7643], [0.2728, 0.2487, 0.0584], [0.7773, 0.0701, 0.3147]]], 1, 1, Dot24446), 
LRes20732 = reshape_layer(Dot24446, [3, 3, 1], Res20732), 
LCon53484 = concatenate_layer([Res20732,[[[[0.2158, 0.0594], [0.7483, 0.0888], [0.9082, 0.8929]], [[0.7054, 0.4946], [0.7468, 0.2996], [0.0225, 0.0579]], [[0.5229, 0.4154], [0.3582, 0.7759], [0.1406, 0.2081]]]]], 3, Con53484), 
LMul36858 = multiply_layer([[[[[[0.4778, 0.3924]], [[0.0682, 0.776]]], [[[0.4377, 0.3855]], [[0.2245, 0.383]]]]], [[[[[0.1957, 0.4344]], [[0.2337, 0.7554]]], [[[0.5089, 0.3602]], [[0.3588, 0.262]]]]]], Mul36858), 
LRes71032 = reshape_layer(Mul36858, [2, 2, 2], Res71032), 
LSep39306 = separable_conv2D_layer(Res71032, 2, 2,[[[[[0.2819], [0.9489]], [[0.0684], [0.5427]]], [[[0.5008], [0.8326]], [[0.4825], [0.7453]]]],[[[[0.2147, 0.9263, 0.9531], [0.744, 0.2844, 0.4076]]]]],[0, 0, 0], 2, 2, true, Sep39306), 
LZer81610 = zero_padding2D_layer(Sep39306, 2, 0, 2, 0, Zer81610), 
LMul39103 = multiply_layer([Con53484,Zer81610], Mul39103), 
LSub22266 = subtract_layer(Con29475,Mul39103, Sub22266), 
exec_layers([LELU30541,LRes46592,LZer82076,LCon29475,LDot24446,LRes20732,LCon53484,LMul36858,LRes71032,LSep39306,LZer81610,LMul39103,LSub22266],["ELU30541","Res46592","Zer82076","Con29475","Dot24446","Res20732","Con53484","Mul36858","Res71032","Sep39306","Zer81610","Mul39103","Sub22266"],Sub22266,"Sub22266")

Actual (Unparsed): [[[[0.0000000, 0.6781000, 0.3993000], [0.0000000, 0.5969000, 0.6044000], [0.0000000, 0.0419000, 0.2422000]], [[0.0000000, 0.0715000, 0.6553000], [0.0000000, 0.7199000, 0.3167000], [0.0000000, 0.7571000, 0.3333000]], [[0.0000000, 0.6154000, 0.4207000], [0.6922000, 0.5727000, 0.0646000], [0.2242632, 0.2562331, 0.5363683]]]]

Expected (Unparsed): [[[[0.0,0.6781,0.3993],[0.0,0.5969,0.6044],[0.0,0.0419,0.2422]],[[0.0,0.0715,0.6553],[0.0,0.7199,0.3167],[0.0,0.7571,0.3333]],[[0.0,0.6154,0.4207],[0.6922,0.5727,0.0646],[0.22426321687011633,0.2562331240841327,0.5363683561654996]]]]

Actual:   [[[[0, 0.6781, 0.3993], [0, 0.5969, 0.6044], [0, 0.0419, 0.2422]], [[0, 0.0715, 0.6553], [0, 0.7199, 0.3167], [0, 0.7571, 0.3333]], [[0, 0.6154, 0.4207], [0.6922, 0.5727, 0.0646], [0.2243, 0.2563, 0.5364]]]]

Expected: [[[[0, 0.6781, 0.3993], [0, 0.5969, 0.6044], [0, 0.0419, 0.2422]], [[0, 0.0715, 0.6553], [0, 0.7199, 0.3167], [0, 0.7571, 0.3333]], [[0, 0.6154, 0.4207], [0.6922, 0.5727, 0.0646], [0.2243, 0.2563, 0.5364]]]]