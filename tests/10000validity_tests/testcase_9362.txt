import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave46322 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Ave46322 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Min59617 = tf.keras.layers.Input(shape=([1, 2]))
in1Min59617 = tf.keras.layers.Input(shape=([1, 2]))
in0Con73055 = tf.keras.layers.Input(shape=([2, 1, 3]))
in0Mul6654 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul6654 = tf.keras.layers.Input(shape=([2, 1]))
in0Con35908 = tf.keras.layers.Input(shape=([2, 1, 3]))
in0Loc77173 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Ave12071 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Ave12071 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con43519 = tf.keras.layers.Input(shape=([2, 1, 2]))

Ave46322 = keras.layers.Average(name = 'Ave46322', )([in0Ave46322,in1Ave46322])
Res60596 = keras.layers.Reshape((2, 2), name = 'Res60596', )(Ave46322)
Min59617 = keras.layers.Minimum(name = 'Min59617', )([in0Min59617,in1Min59617])
Dot74464 = keras.layers.Dot(axes=(2, 2), name = 'Dot74464', )([Res60596,Min59617])
Res49148 = keras.layers.Reshape((2, 1, 1), name = 'Res49148', )(Dot74464)
Con73055 = keras.layers.Concatenate(axis=3, name = 'Con73055', )([Res49148,in0Con73055])
Mul6654 = keras.layers.Multiply(name = 'Mul6654', )([in0Mul6654,in1Mul6654])
Res65364 = keras.layers.Reshape((2, 1, 1), name = 'Res65364', )(Mul6654)
Con35908 = keras.layers.Concatenate(axis=3, name = 'Con35908', )([Res65364,in0Con35908])
Loc77173 = keras.layers.LocallyConnected2D(4, (2, 1),strides=(1, 1), name = 'Loc77173', )(in0Loc77173)
Zer22038 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer22038', )(Loc77173)
Sub99226 = keras.layers.Subtract(name = 'Sub99226', )([Con35908,Zer22038])
Ave83876 = keras.layers.Average(name = 'Ave83876', )([Con73055,Sub99226])
Ave12071 = keras.layers.Average(name = 'Ave12071', )([in0Ave12071,in1Ave12071])
Con43519 = keras.layers.Concatenate(axis=3, name = 'Con43519', )([Ave12071,in0Con43519])
Max32164 = keras.layers.Maximum(name = 'Max32164', )([Ave83876,Con43519])
Dep54455 = keras.layers.DepthwiseConv2D((1, 1),strides=(2, 2), padding='valid', name = 'Dep54455', )(Max32164)
model = tf.keras.models.Model(inputs=[in0Ave46322,in1Ave46322,in0Min59617,in1Min59617,in0Con73055,in0Mul6654,in1Mul6654,in0Con35908,in0Loc77173,in0Ave12071,in1Ave12071,in0Con43519], outputs=Dep54455)
w = model.get_layer('Loc77173').get_weights() 
w[0] = np.array([[[0.6555, 0.7597, 0.9637, 0.1333], [0.0322, 0.1598, 0.9281, 0.3614], [0.9392, 0.2946, 0.6212, 0.0359], [0.5191, 0.6155, 0.1106, 0.1924]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc77173').set_weights(w) 
w = model.get_layer('Dep54455').get_weights() 
w[0] = np.array([[[[0.4216], [0.6173], [0.7603], [0.6261]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Dep54455').set_weights(w) 
in0Ave46322 = tf.constant([[[[0.704, 0.9828]], [[0.7153, 0.7329]]]])
in1Ave46322 = tf.constant([[[[0.5239, 0.2448]], [[0.3421, 0.144]]]])
in0Min59617 = tf.constant([[[0.4248, 0.0018]]])
in1Min59617 = tf.constant([[[0.7968, 0.6808]]])
in0Con73055 = tf.constant([[[[0.6934, 0.2536, 0.4488]], [[0.5313, 0.2234, 0.1036]]]])
in0Mul6654 = tf.constant([[[0.2417], [0.1456]]])
in1Mul6654 = tf.constant([[[0.7931], [0.3343]]])
in0Con35908 = tf.constant([[[[0.0744, 0.4778, 0.6433]], [[0.55, 0.6501, 0.4473]]]])
in0Loc77173 = tf.constant([[[[0.4434, 0.9585]], [[0.2462, 0.008]]]])
in0Ave12071 = tf.constant([[[[0.8571, 0.3516]], [[0.6257, 0.2431]]]])
in1Ave12071 = tf.constant([[[[0.0865, 0.1324]], [[0.4117, 0.8034]]]])
in0Con43519 = tf.constant([[[[0.6762, 0.2158]], [[0.2676, 0.0207]]]])
print (np.array2string(model.predict([in0Ave46322,in1Ave46322,in0Min59617,in1Min59617,in0Con73055,in0Mul6654,in1Mul6654,in0Con35908,in0Loc77173,in0Ave12071,in1Ave12071,in0Con43519],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dep54455.png')

LAve46322 = average_layer([[[[[0.704, 0.9828]], [[0.7153, 0.7329]]]], [[[[0.5239, 0.2448]], [[0.3421, 0.144]]]]], Ave46322), 
LRes60596 = reshape_layer(Ave46322, [2, 2], Res60596), 
LMin59617 = minimum_layer([[[[0.4248, 0.0018]]], [[[0.7968, 0.6808]]]], Min59617), 
LDot74464 = dot_layer(Res60596,Min59617, 2, 2, Dot74464), 
LRes49148 = reshape_layer(Dot74464, [2, 1, 1], Res49148), 
LCon73055 = concatenate_layer([Res49148,[[[[0.6934, 0.2536, 0.4488]], [[0.5313, 0.2234, 0.1036]]]]], 3, Con73055), 
LMul6654 = multiply_layer([[[[0.2417], [0.1456]]], [[[0.7931], [0.3343]]]], Mul6654), 
LRes65364 = reshape_layer(Mul6654, [2, 1, 1], Res65364), 
LCon35908 = concatenate_layer([Res65364,[[[[0.0744, 0.4778, 0.6433]], [[0.55, 0.6501, 0.4473]]]]], 3, Con35908), 
LLoc77173 = locally_connected2D_layer([[[[0.4434, 0.9585]], [[0.2462, 0.008]]]], 2, 1,[[[0.6555, 0.7597, 0.9637, 0.1333], [0.0322, 0.1598, 0.9281, 0.3614], [0.9392, 0.2946, 0.6212, 0.0359], [0.5191, 0.6155, 0.1106, 0.1924]]],[[[0, 0, 0, 0]]], 1, 1, Loc77173), 
LZer22038 = zero_padding2D_layer(Loc77173, 1, 0, 0, 0, Zer22038), 
LSub99226 = subtract_layer(Con35908,Zer22038, Sub99226), 
LAve83876 = average_layer([Con73055,Sub99226], Ave83876), 
LAve12071 = average_layer([[[[[0.8571, 0.3516]], [[0.6257, 0.2431]]]], [[[[0.0865, 0.1324]], [[0.4117, 0.8034]]]]], Ave12071), 
LCon43519 = concatenate_layer([Ave12071,[[[[0.6762, 0.2158]], [[0.2676, 0.0207]]]]], 3, Con43519), 
LMax32164 = maximum_layer([Ave83876,Con43519], Max32164), 
LDep54455 = depthwise_conv2D_layer(Max32164, 1, 1,[[[[0.4216], [0.6173], [0.7603], [0.6261]]]],[0, 0, 0, 0], 2, 2, false, Dep54455), 
exec_layers([LAve46322,LRes60596,LMin59617,LDot74464,LRes49148,LCon73055,LMul6654,LRes65364,LCon35908,LLoc77173,LZer22038,LSub99226,LAve83876,LAve12071,LCon43519,LMax32164,LDep54455],["Ave46322","Res60596","Min59617","Dot74464","Res49148","Con73055","Mul6654","Res65364","Con35908","Loc77173","Zer22038","Sub99226","Ave83876","Ave12071","Con43519","Max32164","Dep54455"],Dep54455,"Dep54455")

Actual (Unparsed): [[[[0.1989109, 0.2369815, 0.5141148, 0.3418819]]]]

Expected (Unparsed): [[[[0.19891087999999998,0.23698147,0.51411486,0.34188190499999993]]]]

Actual:   [[[[0.199, 0.237, 0.5142, 0.3419]]]]

Expected: [[[[0.199, 0.237, 0.5142, 0.3419]]]]