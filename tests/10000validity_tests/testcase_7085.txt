import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc99875 = tf.keras.layers.Input(shape=([1, 1]))
in0Con75094 = tf.keras.layers.Input(shape=([4, 3, 1, 2]))
in0Con89070 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

Loc99875 = keras.layers.LocallyConnected1D(4, (1),strides=(1), name = 'Loc99875', )(in0Loc99875)
Res75351 = keras.layers.Reshape((1, 4, 1), name = 'Res75351', )(Loc99875)
Max49136 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 1), padding='valid', name = 'Max49136', )(Res75351)
Sep53123 = keras.layers.SeparableConv2D(2, (1, 3),strides=(1, 1), padding='valid', name = 'Sep53123', )(Max49136)
Fla97 = keras.layers.Flatten(name = 'Fla97', )(Sep53123)
Res11066 = keras.layers.Reshape((4, 1), name = 'Res11066', )(Fla97)
Res12382 = keras.layers.Reshape((4, 1, 1), name = 'Res12382', )(Res11066)
Res71528 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res71528', )(Res12382)
Zer58028 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer58028', )(Res71528)
Con75094 = keras.layers.Concatenate(axis=4, name = 'Con75094', )([Zer58028,in0Con75094])
Con89070 = keras.layers.Conv3DTranspose(3, (2, 1, 1),strides=(1, 1, 1), padding='same', name = 'Con89070', )(in0Con89070)
Zer54697 = keras.layers.ZeroPadding3D(padding=((2, 0), (1, 0), (0, 0)), name = 'Zer54697', )(Con89070)
Max270 = keras.layers.Maximum(name = 'Max270', )([Con75094,Zer54697])
model = tf.keras.models.Model(inputs=[in0Loc99875,in0Con75094,in0Con89070], outputs=Max270)
w = model.get_layer('Loc99875').get_weights() 
w[0] = np.array([[[0.9376, 0.1637, 0.7935, 0.2857]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc99875').set_weights(w) 
w = model.get_layer('Sep53123').get_weights() 
w[0] = np.array([[[[0.7839]], [[0.7204]], [[0.7972]]]])
w[1] = np.array([[[[0.1483, 0.8714]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep53123').set_weights(w) 
w = model.get_layer('Con89070').get_weights() 
w[0] = np.array([[[[[0.4935, 0.4185], [0.2502, 0.1558], [0.6479, 0.1693]]]], [[[[0.2814, 0.322], [0.9891, 0.4148], [0.0852, 0.9184]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con89070').set_weights(w) 
in0Loc99875 = tf.constant([[[0.9117]]])
in0Con75094 = tf.constant([[[[[0.6098, 0.3904]], [[0.824, 0.6606]], [[0.6452, 0.0357]]], [[[0.2268, 0.2873]], [[0.212, 0.6917]], [[0.1866, 0.1358]]], [[[0.9239, 0.6154]], [[0.1064, 0.8151]], [[0.4874, 0.0452]]], [[[0.1481, 0.3473]], [[0.4474, 0.8136]], [[0.1477, 0.3255]]]]])
in0Con89070 = tf.constant([[[[[0.3231, 0.4127]], [[0.0809, 0.571]]], [[[0.9493, 0.2005]], [[0.8383, 0.2255]]]]])
print (np.array2string(model.predict([in0Loc99875,in0Con75094,in0Con89070],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max270.png')

LLoc99875 = locally_connected1D_layer([[[0.9117]]], 1,[[[0.9376, 0.1637, 0.7935, 0.2857]]],[[0, 0, 0, 0]], 1, Loc99875), 
LRes75351 = reshape_layer(Loc99875, [1, 4, 1], Res75351), 
LMax49136 = max_pool2D_layer(Res75351, 1, 1, 1, 1, false, Max49136), 
LSep53123 = separable_conv2D_layer(Max49136, 1, 3,[[[[[0.7839]], [[0.7204]], [[0.7972]]]],[[[[0.1483, 0.8714]]]]],[0, 0], 1, 1, false, Sep53123), 
LFla97 = flatten_layer(Sep53123, Fla97), 
LRes11066 = reshape_layer(Fla97, [4, 1], Res11066), 
LRes12382 = reshape_layer(Res11066, [4, 1, 1], Res12382), 
LRes71528 = reshape_layer(Res12382, [4, 1, 1, 1], Res71528), 
LZer58028 = zero_padding3D_layer(Res71528, 0, 0, 2, 0, 0, 0, Zer58028), 
LCon75094 = concatenate_layer([Zer58028,[[[[[0.6098, 0.3904]], [[0.824, 0.6606]], [[0.6452, 0.0357]]], [[[0.2268, 0.2873]], [[0.212, 0.6917]], [[0.1866, 0.1358]]], [[[0.9239, 0.6154]], [[0.1064, 0.8151]], [[0.4874, 0.0452]]], [[[0.1481, 0.3473]], [[0.4474, 0.8136]], [[0.1477, 0.3255]]]]]], 4, Con75094), 
LCon89070 = conv3D_transpose_layer([[[[[0.3231, 0.4127]], [[0.0809, 0.571]]], [[[0.9493, 0.2005]], [[0.8383, 0.2255]]]]], 2, 1, 1,[[[[[0.4935, 0.4185], [0.2502, 0.1558], [0.6479, 0.1693]]]], [[[[0.2814, 0.322], [0.9891, 0.4148], [0.0852, 0.9184]]]]],[0, 0, 0], 1, 1, 1, true, Con89070), 
LZer54697 = zero_padding3D_layer(Con89070, 2, 0, 1, 0, 0, 0, Zer54697), 
LMax270 = maximum_layer([Con75094,Zer54697], Max270), 
exec_layers([LLoc99875,LRes75351,LMax49136,LSep53123,LFla97,LRes11066,LRes12382,LRes71528,LZer58028,LCon75094,LCon89070,LZer54697,LMax270],["Loc99875","Res75351","Max49136","Sep53123","Fla97","Res11066","Res12382","Res71528","Zer58028","Con75094","Con89070","Zer54697","Max270"],Max270,"Max270")

Actual (Unparsed): [[[[[0.0000000, 0.6098000, 0.3904000]], [[0.0000000, 0.8240000, 0.6606000]], [[0.2008462, 0.6452000, 0.0357000]]], [[[0.0000000, 0.2268000, 0.2873000]], [[0.0000000, 0.2120000, 0.6917000]], [[1.1801574, 0.1866000, 0.1358000]]], [[[0.0000000, 0.9239000, 0.6154000]], [[0.3321648, 0.1451383, 0.8151000]], [[0.2788876, 0.4874000, 0.1490854]]], [[[0.0000000, 0.1481000, 0.3473000]], [[0.7761985, 0.7595189, 1.0555479]], [[0.7370336, 0.5617445, 1.1126108]]]]]

Expected (Unparsed): [[[[[0,0.6098,0.3904]],[[0,0.824,0.6606]],[[0.2008461525297552,0.6452,0.0357]]],[[[0,0.2268,0.2873]],[[0,0.212,0.6917]],[[1.1801573655726818,0.1866,0.1358]]],[[[0,0.9239,0.6154]],[[0.33216480000000004,0.14513827999999998,0.8151]],[[0.27888765,0.4874,0.14908541]]],[[[0,0.1481,0.3473]],[[0.7761985400000001,0.75951893,1.05554792]],[[0.7370336307651606,0.56174455,1.1126108000000001]]]]]

Actual:   [[[[[0, 0.6098, 0.3904]], [[0, 0.824, 0.6606]], [[0.2009, 0.6452, 0.0357]]], [[[0, 0.2268, 0.2873]], [[0, 0.212, 0.6917]], [[1.1802, 0.1866, 0.1358]]], [[[0, 0.9239, 0.6154]], [[0.3322, 0.1452, 0.8151]], [[0.2789, 0.4874, 0.1491]]], [[[0, 0.1481, 0.3473]], [[0.7762, 0.7596, 1.0556]], [[0.7371, 0.5618, 1.1127]]]]]

Expected: [[[[[0, 0.6098, 0.3904]], [[0, 0.824, 0.6606]], [[0.2009, 0.6452, 0.0357]]], [[[0, 0.2268, 0.2873]], [[0, 0.212, 0.6917]], [[1.1802, 0.1866, 0.1358]]], [[[0, 0.9239, 0.6154]], [[0.3322, 0.1452, 0.8151]], [[0.2789, 0.4874, 0.1491]]], [[[0, 0.1481, 0.3473]], [[0.7762, 0.7596, 1.0556]], [[0.7371, 0.5618, 1.1127]]]]]