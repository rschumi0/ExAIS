import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max18690 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Max18690 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Con80901 = tf.keras.layers.Input(shape=([3, 3, 2, 2]))
in0Sub31558 = tf.keras.layers.Input(shape=([3, 3, 2, 3]))
in1Sub31558 = tf.keras.layers.Input(shape=([3, 3, 2, 3]))

Max18690 = keras.layers.Maximum(name = 'Max18690', )([in0Max18690,in1Max18690])
Zer70438 = keras.layers.ZeroPadding3D(padding=((1, 0), (2, 0), (0, 0)), name = 'Zer70438', )(Max18690)
Con80901 = keras.layers.Concatenate(axis=4, name = 'Con80901', )([Zer70438,in0Con80901])
Sub31558 = keras.layers.Subtract(name = 'Sub31558', )([in0Sub31558,in1Sub31558])
Min99621 = keras.layers.Minimum(name = 'Min99621', )([Con80901,Sub31558])
Res77119 = keras.layers.Reshape((3, 3, 6), name = 'Res77119', )(Min99621)
Res917 = keras.layers.Reshape((3, 18), name = 'Res917', )(Res77119)
Loc99601 = keras.layers.LocallyConnected1D(2, (2),strides=(1), name = 'Loc99601', )(Res917)
model = tf.keras.models.Model(inputs=[in0Max18690,in1Max18690,in0Con80901,in0Sub31558,in1Sub31558], outputs=Loc99601)
w = model.get_layer('Loc99601').get_weights() 
w[0] = np.array([[[0.4637, 0.0798], [0.0984, 0.407], [0.3828, 0.4318], [0.9803, 0.5507], [0.0583, 0.3914], [0.2942, 0.3152], [0.8765, 0.0159], [0.3847, 0.5082], [0.7262, 0.3087], [0.0971, 0.9015], [0.5662, 0.5817], [0.1649, 0.9801], [0.8207, 0.3326], [0.5544, 0.2709], [0.7509, 0.3284], [0.1202, 0.7742], [0.0273, 0.9816], [0.9544, 0.5002], [0.9549, 0.9082], [0.4946, 0.4883], [0.1972, 0.7633], [0.7998, 0.9748], [0.3818, 0.0665], [0.3973, 0.567], [0.6771, 0.7468], [0.7588, 0.3803], [0.281, 0.5665], [0.7734, 0.0992], [0.7791, 0.4139], [0.55, 0.8352], [0.4954, 0.6972], [0.5053, 0.471], [0.2862, 0.7127], [0.9692, 0.9045], [0.7096, 0.9174], [0.4786, 0.2366]], [[0.1364, 0.4909], [0.5146, 0.4811], [0.1696, 0.435], [0.6935, 0.8201], [0.6816, 0.7343], [0.3171, 0.7741], [0.8918, 0.7726], [0.7538, 0.9128], [0.1648, 0.2859], [0.3337, 0.893], [0.6317, 0.6218], [0.3156, 0.6777], [0.3102, 0.9707], [0.0099, 0.7636], [0.1319, 0.5339], [0.3282, 0.1251], [0.1715, 0.3048], [0.8691, 0.3669], [0.4187, 0.2514], [0.1485, 0.2735], [0.6315, 0.2103], [0.7352, 0.5374], [0.1669, 0.7276], [0.8615, 0.9578], [0.1993, 0.416], [0.5463, 0.8091], [0.4021, 0.138], [0.3883, 0.3979], [0.9979, 0.4668], [0.9656, 0.0489], [0.0602, 0.4327], [0.2145, 0.893], [0.0884, 0.5184], [0.2473, 0.8637], [0.1743, 0.2301], [0.8205, 0.2524]]])
w[1] = np.array([[0, 0], [0, 0]])
model.get_layer('Loc99601').set_weights(w) 
in0Max18690 = tf.constant([[[[[0.6844], [0.3197]]], [[[0.9389], [0.3527]]]]])
in1Max18690 = tf.constant([[[[[0.4447], [0.398]]], [[[0.8379], [0.7575]]]]])
in0Con80901 = tf.constant([[[[[0.0982, 0.1754], [0.069, 0.5811]], [[0.7247, 0.4037], [0.7805, 0.7585]], [[0.9937, 0.3921], [0.6536, 0.2888]]], [[[0.4769, 0.4149], [0.3226, 0.6014]], [[0.0946, 0.9563], [0.7036, 0.2282]], [[0.2495, 0.8445], [0.4921, 0.2412]]], [[[0.8255, 0.8647], [0.109, 0.3412]], [[0.8613, 0.716], [0.1471, 0.9884]], [[0.4177, 0.0156], [0.1548, 0.008]]]]])
in0Sub31558 = tf.constant([[[[[0.3858, 0.7314, 0.9085], [0.5933, 0.6228, 0.2679]], [[0.3708, 0.4791, 0.5873], [0.8344, 0.558, 0.6682]], [[0.8051, 0.3012, 0.7084], [0.2618, 0.0546, 0.5482]]], [[[0.0322, 0.0572, 0.1061], [0.2336, 0.1792, 0.9505]], [[0.8597, 0.7706, 0.4982], [0.4835, 0.8477, 0.1071]], [[0.7649, 0.0788, 0.75], [0.8731, 0.3783, 0.7446]]], [[[0.781, 0.2124, 0.3777], [0.545, 0.5514, 0.1449]], [[0.0161, 0.9303, 0.2813], [0.6227, 0.0411, 0.1014]], [[0.0471, 0.5351, 0.2799], [0.9412, 0.0828, 0.794]]]]])
in1Sub31558 = tf.constant([[[[[0.6041, 0.6905, 0.0219], [0.2913, 0.8567, 0.4647]], [[0.3687, 0.953, 0.8663], [0.9149, 0.4153, 0.3405]], [[0.2413, 0.8216, 0.2848], [0.2456, 0.2442, 0.1744]]], [[[0.7739, 0.5111, 0.6741], [0.3411, 0.1909, 0.87]], [[0.3567, 0.2569, 0.4442], [0.9439, 0.5317, 0.1758]], [[0.2182, 0.6643, 0.1594], [0.4175, 0.1979, 0.2887]]], [[[0.9242, 0.7161, 0.9475], [0.8741, 0.5053, 0.2309]], [[0.2309, 0.5351, 0.5025], [0.0146, 0.2765, 0.0711]], [[0.2628, 0.7525, 0.7266], [0.5744, 0.7308, 0.8804]]]]])
print (np.array2string(model.predict([in0Max18690,in1Max18690,in0Con80901,in0Sub31558,in1Sub31558],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc99601.png')

LMax18690 = maximum_layer([[[[[[0.6844], [0.3197]]], [[[0.9389], [0.3527]]]]], [[[[[0.4447], [0.398]]], [[[0.8379], [0.7575]]]]]], Max18690), 
LZer70438 = zero_padding3D_layer(Max18690, 1, 0, 2, 0, 0, 0, Zer70438), 
LCon80901 = concatenate_layer([Zer70438,[[[[[0.0982, 0.1754], [0.069, 0.5811]], [[0.7247, 0.4037], [0.7805, 0.7585]], [[0.9937, 0.3921], [0.6536, 0.2888]]], [[[0.4769, 0.4149], [0.3226, 0.6014]], [[0.0946, 0.9563], [0.7036, 0.2282]], [[0.2495, 0.8445], [0.4921, 0.2412]]], [[[0.8255, 0.8647], [0.109, 0.3412]], [[0.8613, 0.716], [0.1471, 0.9884]], [[0.4177, 0.0156], [0.1548, 0.008]]]]]], 4, Con80901), 
LSub31558 = subtract_layer([[[[[0.3858, 0.7314, 0.9085], [0.5933, 0.6228, 0.2679]], [[0.3708, 0.4791, 0.5873], [0.8344, 0.558, 0.6682]], [[0.8051, 0.3012, 0.7084], [0.2618, 0.0546, 0.5482]]], [[[0.0322, 0.0572, 0.1061], [0.2336, 0.1792, 0.9505]], [[0.8597, 0.7706, 0.4982], [0.4835, 0.8477, 0.1071]], [[0.7649, 0.0788, 0.75], [0.8731, 0.3783, 0.7446]]], [[[0.781, 0.2124, 0.3777], [0.545, 0.5514, 0.1449]], [[0.0161, 0.9303, 0.2813], [0.6227, 0.0411, 0.1014]], [[0.0471, 0.5351, 0.2799], [0.9412, 0.0828, 0.794]]]]], [[[[[0.6041, 0.6905, 0.0219], [0.2913, 0.8567, 0.4647]], [[0.3687, 0.953, 0.8663], [0.9149, 0.4153, 0.3405]], [[0.2413, 0.8216, 0.2848], [0.2456, 0.2442, 0.1744]]], [[[0.7739, 0.5111, 0.6741], [0.3411, 0.1909, 0.87]], [[0.3567, 0.2569, 0.4442], [0.9439, 0.5317, 0.1758]], [[0.2182, 0.6643, 0.1594], [0.4175, 0.1979, 0.2887]]], [[[0.9242, 0.7161, 0.9475], [0.8741, 0.5053, 0.2309]], [[0.2309, 0.5351, 0.5025], [0.0146, 0.2765, 0.0711]], [[0.2628, 0.7525, 0.7266], [0.5744, 0.7308, 0.8804]]]]], Sub31558), 
LMin99621 = minimum_layer([Con80901,Sub31558], Min99621), 
LRes77119 = reshape_layer(Min99621, [3, 3, 6], Res77119), 
LRes917 = reshape_layer(Res77119, [3, 18], Res917), 
LLoc99601 = locally_connected1D_layer(Res917, 2,[[[0.4637, 0.0798], [0.0984, 0.407], [0.3828, 0.4318], [0.9803, 0.5507], [0.0583, 0.3914], [0.2942, 0.3152], [0.8765, 0.0159], [0.3847, 0.5082], [0.7262, 0.3087], [0.0971, 0.9015], [0.5662, 0.5817], [0.1649, 0.9801], [0.8207, 0.3326], [0.5544, 0.2709], [0.7509, 0.3284], [0.1202, 0.7742], [0.0273, 0.9816], [0.9544, 0.5002], [0.9549, 0.9082], [0.4946, 0.4883], [0.1972, 0.7633], [0.7998, 0.9748], [0.3818, 0.0665], [0.3973, 0.567], [0.6771, 0.7468], [0.7588, 0.3803], [0.281, 0.5665], [0.7734, 0.0992], [0.7791, 0.4139], [0.55, 0.8352], [0.4954, 0.6972], [0.5053, 0.471], [0.2862, 0.7127], [0.9692, 0.9045], [0.7096, 0.9174], [0.4786, 0.2366]], [[0.1364, 0.4909], [0.5146, 0.4811], [0.1696, 0.435], [0.6935, 0.8201], [0.6816, 0.7343], [0.3171, 0.7741], [0.8918, 0.7726], [0.7538, 0.9128], [0.1648, 0.2859], [0.3337, 0.893], [0.6317, 0.6218], [0.3156, 0.6777], [0.3102, 0.9707], [0.0099, 0.7636], [0.1319, 0.5339], [0.3282, 0.1251], [0.1715, 0.3048], [0.8691, 0.3669], [0.4187, 0.2514], [0.1485, 0.2735], [0.6315, 0.2103], [0.7352, 0.5374], [0.1669, 0.7276], [0.8615, 0.9578], [0.1993, 0.416], [0.5463, 0.8091], [0.4021, 0.138], [0.3883, 0.3979], [0.9979, 0.4668], [0.9656, 0.0489], [0.0602, 0.4327], [0.2145, 0.893], [0.0884, 0.5184], [0.2473, 0.8637], [0.1743, 0.2301], [0.8205, 0.2524]]],[[0, 0], [0, 0]], 1, Loc99601), 
exec_layers([LMax18690,LZer70438,LCon80901,LSub31558,LMin99621,LRes77119,LRes917,LLoc99601],["Max18690","Zer70438","Con80901","Sub31558","Min99621","Res77119","Res917","Loc99601"],Loc99601,"Loc99601")

Actual (Unparsed): [[[-0.4738449, -0.3133812], [-0.8873624, -1.2321736]]]

Expected (Unparsed): [[[-0.47384494999999993,-0.3133812900000004],[-0.8873624899999999,-1.2321736599999997]]]

Actual:   [[[-0.4738, -0.3133], [-0.8873, -1.2321]]]

Expected: [[[-0.4738, -0.3133], [-0.8873, -1.2321]]]