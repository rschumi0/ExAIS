import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max37826 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Max37826 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Add63279 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in1Add63279 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))

Max37826 = keras.layers.Maximum(name = 'Max37826', )([in0Max37826,in1Max37826])
Res75367 = keras.layers.Reshape((2, 2), name = 'Res75367', )(Max37826)
Add63279 = keras.layers.Add(name = 'Add63279', )([in0Add63279,in1Add63279])
Res60401 = keras.layers.Reshape((2, 1, 4), name = 'Res60401', )(Add63279)
Res3878 = keras.layers.Reshape((2, 4), name = 'Res3878', )(Res60401)
Dot43604 = keras.layers.Dot(axes=(1, 1), name = 'Dot43604', )([Res75367,Res3878])
Res86086 = keras.layers.Reshape((2, 4, 1), name = 'Res86086', )(Dot43604)
Res2284 = keras.layers.Reshape((2, 4, 1, 1), name = 'Res2284', )(Res86086)
Con16996 = keras.layers.Conv3D(2, (2, 4, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con16996', )(Res2284)
model = tf.keras.models.Model(inputs=[in0Max37826,in1Max37826,in0Add63279,in1Add63279], outputs=Con16996)
w = model.get_layer('Con16996').get_weights() 
w[0] = np.array([[[[[0.4574, 0.7525]]], [[[0.1161, 0.3241]]], [[[0.3157, 0.0426]]], [[[0.9364, 0.7013]]]], [[[[0.6021, 0.7071]]], [[[0.6934, 0.1071]]], [[[0.4139, 0.0401]]], [[[0.4038, 0.2646]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con16996').set_weights(w) 
in0Max37826 = tf.constant([[[[0.0682, 0.7592]], [[0.8925, 0.4091]]]])
in1Max37826 = tf.constant([[[[0.5819, 0.0055]], [[0.4776, 0.6292]]]])
in0Add63279 = tf.constant([[[[[0.9215, 0.2554], [0.1425, 0.1419]]], [[[0.4327, 0.4478], [0.9362, 0.0921]]]]])
in1Add63279 = tf.constant([[[[[0.5274, 0.78], [0.7146, 0.6051]]], [[[0.6937, 0.579], [0.5421, 0.8923]]]]])
print (np.array2string(model.predict([in0Max37826,in1Max37826,in0Add63279,in1Add63279],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con16996.png')

LMax37826 = maximum_layer([[[[[0.0682, 0.7592]], [[0.8925, 0.4091]]]], [[[[0.5819, 0.0055]], [[0.4776, 0.6292]]]]], Max37826), 
LRes75367 = reshape_layer(Max37826, [2, 2], Res75367), 
LAdd63279 = add_layer([[[[[[0.9215, 0.2554], [0.1425, 0.1419]]], [[[0.4327, 0.4478], [0.9362, 0.0921]]]]], [[[[[0.5274, 0.78], [0.7146, 0.6051]]], [[[0.6937, 0.579], [0.5421, 0.8923]]]]]], Add63279), 
LRes60401 = reshape_layer(Add63279, [2, 1, 4], Res60401), 
LRes3878 = reshape_layer(Res60401, [2, 4], Res3878), 
LDot43604 = dot_layer(Res75367,Res3878, 1, 1, Dot43604), 
LRes86086 = reshape_layer(Dot43604, [2, 4, 1], Res86086), 
LRes2284 = reshape_layer(Res86086, [2, 4, 1, 1], Res2284), 
LCon16996 = conv3D_layer(Res2284, 2, 4, 1,[[[[[0.4574, 0.7525]]], [[[0.1161, 0.3241]]], [[[0.3157, 0.0426]]], [[[0.9364, 0.7013]]]], [[[[0.6021, 0.7071]]], [[[0.6934, 0.1071]]], [[[0.4139, 0.0401]]], [[[0.4038, 0.2646]]]]],[0, 0], 1, 1, 1, false, 1, 1, 1, Con16996), 
exec_layers([LMax37826,LRes75367,LAdd63279,LRes60401,LRes3878,LDot43604,LRes86086,LRes2284,LCon16996],["Max37826","Res75367","Add63279","Res60401","Res3878","Dot43604","Res86086","Res2284","Con16996"],Con16996,"Con16996")

Actual (Unparsed): [[[[[6.0410459, 4.6913427]]]]]

Expected (Unparsed): [[[[[6.041045993715999,4.691342741371]]]]]

Actual:   [[[[[6.0411, 4.6914]]]]]

Expected: [[[[[6.0411, 4.6914]]]]]