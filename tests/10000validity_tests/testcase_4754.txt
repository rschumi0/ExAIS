import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave63852 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave63852 = tf.keras.layers.Input(shape=([2, 2]))

Ave63852 = keras.layers.Average(name = 'Ave63852', )([in0Ave63852,in1Ave63852])
Loc19075 = keras.layers.LocallyConnected1D(3, (2),strides=(1), name = 'Loc19075', )(Ave63852)
Res2185 = keras.layers.Reshape((1, 3, 1), name = 'Res2185', )(Loc19075)
Res39636 = keras.layers.Reshape((1, 3, 1, 1), name = 'Res39636', )(Res2185)
Up_66259 = keras.layers.UpSampling3D(size=(2, 2, 2), name = 'Up_66259', )(Res39636)
Res79226 = keras.layers.Reshape((2, 6, 2), name = 'Res79226', )(Up_66259)
Con45701 = keras.layers.Conv2D(2, (2, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con45701', )(Res79226)
model = tf.keras.models.Model(inputs=[in0Ave63852,in1Ave63852], outputs=Con45701)
w = model.get_layer('Loc19075').get_weights() 
w[0] = np.array([[[0.1341, 0.6518, 0.857], [0.1112, 0.7772, 0.5821], [0.4827, 0.2234, 0.2354], [0.6159, 0.1761, 0.1751]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc19075').set_weights(w) 
w = model.get_layer('Con45701').get_weights() 
w[0] = np.array([[[[0.6802, 0.1324], [0.6505, 0.9311]]], [[[0.1945, 0.5165], [0.1874, 0.2767]]]])
w[1] = np.array([0, 0])
model.get_layer('Con45701').set_weights(w) 
in0Ave63852 = tf.constant([[[0.5342, 0.5454], [0.7616, 0.2293]]])
in1Ave63852 = tf.constant([[[0.9468, 0.1232], [0.2799, 0.0478]]])
print (np.array2string(model.predict([in0Ave63852,in1Ave63852],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con45701.png')

LAve63852 = average_layer([[[[0.5342, 0.5454], [0.7616, 0.2293]]], [[[0.9468, 0.1232], [0.2799, 0.0478]]]], Ave63852), 
LLoc19075 = locally_connected1D_layer(Ave63852, 2,[[[0.1341, 0.6518, 0.857], [0.1112, 0.7772, 0.5821], [0.4827, 0.2234, 0.2354], [0.6159, 0.1761, 0.1751]]],[[0, 0, 0]], 1, Loc19075), 
LRes2185 = reshape_layer(Loc19075, [1, 3, 1], Res2185), 
LRes39636 = reshape_layer(Res2185, [1, 3, 1, 1], Res39636), 
LUp_66259 = up_sampling3D_layer(Res39636, 2, 2, 2, Up_66259), 
LRes79226 = reshape_layer(Up_66259, [2, 6, 2], Res79226), 
LCon45701 = conv2D_layer(Res79226, 2, 1,[[[[0.6802, 0.1324], [0.6505, 0.9311]]], [[[0.1945, 0.5165], [0.1874, 0.2767]]]],[0, 0], 1, 1, false, 1, 1, Con45701), 
exec_layers([LAve63852,LLoc19075,LRes2185,LRes39636,LUp_66259,LRes79226,LCon45701],["Ave63852","Loc19075","Res2185","Res39636","Up_66259","Res79226","Con45701"],Con45701,"Con45701")

Actual (Unparsed): [[[[0.8103581, 0.8785425], [0.8103581, 0.8785425], [1.5125856, 1.6398562], [1.5125856, 1.6398562], [1.6715819, 1.8122305], [1.6715819, 1.8122305]]]]

Expected (Unparsed): [[[[0.8103581006680002,0.8785425000060001],[0.8103581006680002,0.8785425000060001],[1.5125855573190004,1.6398561276855002],[1.5125855573190004,1.6398561276855002],[1.6715818342309998,1.8122305217894998],[1.6715818342309998,1.8122305217894998]]]]

Actual:   [[[[0.8104, 0.8786], [0.8104, 0.8786], [1.5126, 1.6399], [1.5126, 1.6399], [1.6716, 1.8123], [1.6716, 1.8123]]]]

Expected: [[[[0.8104, 0.8786], [0.8104, 0.8786], [1.5126, 1.6399], [1.5126, 1.6399], [1.6716, 1.8123], [1.6716, 1.8123]]]]