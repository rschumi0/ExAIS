import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave81360 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Ave81360 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Sub1522 = tf.keras.layers.Input(shape=([3]))
in1Sub1522 = tf.keras.layers.Input(shape=([3]))
in0Con64397 = tf.keras.layers.Input(shape=([13]))

Ave81360 = keras.layers.Average(name = 'Ave81360', )([in0Ave81360,in1Ave81360])
Lay91007 = keras.layers.LayerNormalization(axis=3, epsilon=2.1297362027749625, name = 'Lay91007', )(Ave81360)
Res17938 = keras.layers.Reshape((2, 2, 4), name = 'Res17938', )(Lay91007)
Res80447 = keras.layers.Reshape((2, 8), name = 'Res80447', )(Res17938)
Fla39929 = keras.layers.Flatten(name = 'Fla39929', )(Res80447)
Sub1522 = keras.layers.Subtract(name = 'Sub1522', )([in0Sub1522,in1Sub1522])
Con64397 = keras.layers.Concatenate(axis=1, name = 'Con64397', )([Sub1522,in0Con64397])
Add93331 = keras.layers.Add(name = 'Add93331', )([Fla39929,Con64397])
model = tf.keras.models.Model(inputs=[in0Ave81360,in1Ave81360,in0Sub1522,in1Sub1522,in0Con64397], outputs=Add93331)
in0Ave81360 = tf.constant([[[[[0.7794, 0.5838], [0.3855, 0.7564]], [[0.0318, 0.0332], [0.399, 0.4201]]], [[[0.2888, 0.1755], [0.5973, 0.5549]], [[0.8094, 0.131], [0.0164, 0.284]]]]])
in1Ave81360 = tf.constant([[[[[0.5646, 0.872], [0.2974, 0.0112]], [[0.2147, 0.1936], [0.2479, 0.8674]]], [[[0.7795, 0.0095], [0.811, 0.8825]], [[0.1231, 0.0216], [0.9517, 0.8391]]]]])
in0Sub1522 = tf.constant([[0.2203, 0.0094, 0.0805]])
in1Sub1522 = tf.constant([[0.8498, 0.7986, 0.2122]])
in0Con64397 = tf.constant([[0.8971, 0.3792, 0.5904, 0.2321, 0.2114, 0.1825, 0.6012, 0.1247, 0.9412, 0.4562, 0.6535, 0.6934, 0.8118]])
print (np.array2string(model.predict([in0Ave81360,in1Ave81360,in0Sub1522,in1Sub1522,in0Con64397],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add93331.png')

LAve81360 = average_layer([[[[[[0.7794, 0.5838], [0.3855, 0.7564]], [[0.0318, 0.0332], [0.399, 0.4201]]], [[[0.2888, 0.1755], [0.5973, 0.5549]], [[0.8094, 0.131], [0.0164, 0.284]]]]], [[[[[0.5646, 0.872], [0.2974, 0.0112]], [[0.2147, 0.1936], [0.2479, 0.8674]]], [[[0.7795, 0.0095], [0.811, 0.8825]], [[0.1231, 0.0216], [0.9517, 0.8391]]]]]], Ave81360), 
LLay91007 = layer_normalization_layer(Ave81360, 3, 2.1297362027749625, Lay91007), 
LRes17938 = reshape_layer(Lay91007, [2, 2, 4], Res17938), 
LRes80447 = reshape_layer(Res17938, [2, 8], Res80447), 
LFla39929 = flatten_layer(Res80447, Fla39929), 
LSub1522 = subtract_layer([[0.2203, 0.0094, 0.0805]], [[0.8498, 0.7986, 0.2122]], Sub1522), 
LCon64397 = concatenate_layer([Sub1522,[[0.8971, 0.3792, 0.5904, 0.2321, 0.2114, 0.1825, 0.6012, 0.1247, 0.9412, 0.4562, 0.6535, 0.6934, 0.8118]]], 1, Con64397), 
LAdd93331 = add_layer([Fla39929,Con64397], Add93331), 
exec_layers([LAve81360,LLay91007,LRes17938,LRes80447,LFla39929,LSub1522,LCon64397,LAdd93331],["Ave81360","Lay91007","Res17938","Res80447","Fla39929","Sub1522","Con64397","Add93331"],Add93331,"Add93331")

Actual (Unparsed): [[-0.5169678, -0.6721169, -0.2442322, 0.7800168, 0.3107692, 0.4116212, 0.3005308, 0.3901788, 0.1243539, 0.3914277, 0.1828461, 1.1509723, 0.4501016, 0.4894969, 0.6994985, 0.9758031]]

Expected (Unparsed): [[-0.516967788028031,-0.6721168433038442,-0.24423221197196895,0.7800168433038444,0.31076915079782713,0.4116212448862731,0.3005308492021729,0.3901787551137269,0.12435389784195766,0.3914277167978684,0.18284610215804226,1.1509722832021316,0.45010155622920117,0.4894969049698643,0.6994984437707988,0.9758030950301355]]

Actual:   [[-0.5169, -0.6721, -0.2442, 0.7801, 0.3108, 0.4117, 0.3006, 0.3902, 0.1244, 0.3915, 0.1829, 1.151, 0.4502, 0.4895, 0.6995, 0.9759]]

Expected: [[-0.5169, -0.6721, -0.2442, 0.7801, 0.3108, 0.4117, 0.3006, 0.3902, 0.1244, 0.3915, 0.1829, 1.151, 0.4502, 0.4895, 0.6995, 0.9759]]