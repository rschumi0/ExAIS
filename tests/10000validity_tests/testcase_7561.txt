import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add71302 = tf.keras.layers.Input(shape=([1, 1]))
in1Add71302 = tf.keras.layers.Input(shape=([1, 1]))
in0Mul48277 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in1Mul48277 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))

Add71302 = keras.layers.Add(name = 'Add71302', )([in0Add71302,in1Add71302])
Res10482 = keras.layers.Reshape((1, 1, 1), name = 'Res10482', )(Add71302)
PRe54003 = keras.layers.PReLU(name = 'PRe54003', )(Res10482)
Con31072 = keras.layers.Conv2D(4, (1, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con31072', )(PRe54003)
Res37338 = keras.layers.Reshape((1, 4), name = 'Res37338', )(Con31072)
Mul48277 = keras.layers.Multiply(name = 'Mul48277', )([in0Mul48277,in1Mul48277])
Res84578 = keras.layers.Reshape((2, 1, 4), name = 'Res84578', )(Mul48277)
Res95505 = keras.layers.Reshape((2, 4), name = 'Res95505', )(Res84578)
Max6753 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max6753', )(Res95505)
Dot75523 = keras.layers.Dot(axes=(2, 2), name = 'Dot75523', )([Res37338,Max6753])
model = tf.keras.models.Model(inputs=[in0Add71302,in1Add71302,in0Mul48277,in1Mul48277], outputs=Dot75523)
w = model.get_layer('PRe54003').get_weights() 
w[0] = np.array([[[0.0796]]])
model.get_layer('PRe54003').set_weights(w) 
w = model.get_layer('Con31072').get_weights() 
w[0] = np.array([[[[0.9281, 0.0798, 0.7318, 0.7691]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con31072').set_weights(w) 
in0Add71302 = tf.constant([[[0.2312]]])
in1Add71302 = tf.constant([[[0.9419]]])
in0Mul48277 = tf.constant([[[[[0.9835, 0.6358], [0.5851, 0.3452]]], [[[0.6044, 0.4306], [0.9604, 0.7703]]]]])
in1Mul48277 = tf.constant([[[[[0.603, 0.4788], [0.348, 0.0475]]], [[[0.523, 0.8993], [0.4007, 0.2896]]]]])
print (np.array2string(model.predict([in0Add71302,in1Add71302,in0Mul48277,in1Mul48277],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot75523.png')

LAdd71302 = add_layer([[[[0.2312]]], [[[0.9419]]]], Add71302), 
LRes10482 = reshape_layer(Add71302, [1, 1, 1], Res10482), 
LPRe54003 = prelu_layer(Res10482, [[[0.0796]]], PRe54003), 
LCon31072 = conv2D_layer(PRe54003, 1, 1,[[[[0.9281, 0.0798, 0.7318, 0.7691]]]],[0, 0, 0, 0], 1, 1, true, 1, 1, Con31072), 
LRes37338 = reshape_layer(Con31072, [1, 4], Res37338), 
LMul48277 = multiply_layer([[[[[[0.9835, 0.6358], [0.5851, 0.3452]]], [[[0.6044, 0.4306], [0.9604, 0.7703]]]]], [[[[[0.603, 0.4788], [0.348, 0.0475]]], [[[0.523, 0.8993], [0.4007, 0.2896]]]]]], Mul48277), 
LRes84578 = reshape_layer(Mul48277, [2, 1, 4], Res84578), 
LRes95505 = reshape_layer(Res84578, [2, 4], Res95505), 
LMax6753 = max_pool1D_layer(Res95505, 1, Max6753), 
LDot75523 = dot_layer(Res37338,Max6753, 2, 2, Dot75523), 
exec_layers([LAdd71302,LRes10482,LPRe54003,LCon31072,LRes37338,LMul48277,LRes84578,LRes95505,LMax6753,LDot75523],["Add71302","Res10482","PRe54003","Con31072","Res37338","Mul48277","Res84578","Res95505","Max6753","Dot75523"],Dot75523,"Dot75523")

Actual (Unparsed): [[[0.8637761, 0.9120446]]]

Expected (Unparsed): [[[0.8637760668722242,0.9120446507874196]]]

Actual:   [[[0.8638, 0.9121]]]

Expected: [[[0.8638, 0.9121]]]