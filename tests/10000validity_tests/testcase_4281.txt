import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con77366 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Ave28170 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Ave28170 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Loc76253 = tf.keras.layers.Input(shape=([2, 1]))
in0Max84508 = tf.keras.layers.Input(shape=([1, 1]))
in1Max84508 = tf.keras.layers.Input(shape=([1, 1]))
in0Con60006 = tf.keras.layers.Input(shape=([1, 3]))

Con77366 = keras.layers.Conv2DTranspose(3, (1, 1),strides=(1, 1), padding='same', name = 'Con77366', )(in0Con77366)
Res73302 = keras.layers.Reshape((1, 3), name = 'Res73302', )(Con77366)
Con97748 = keras.layers.Conv1D(4, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con97748', )(Res73302)
Zer16142 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer16142', )(Con97748)
Zer98028 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer98028', )(Zer16142)
Ave28170 = keras.layers.Average(name = 'Ave28170', )([in0Ave28170,in1Ave28170])
Res29299 = keras.layers.Reshape((2, 2, 2), name = 'Res29299', )(Ave28170)
Res12731 = keras.layers.Reshape((2, 4), name = 'Res12731', )(Res29299)
Loc76253 = keras.layers.LocallyConnected1D(4, (1),strides=(2), name = 'Loc76253', )(in0Loc76253)
Max84508 = keras.layers.Maximum(name = 'Max84508', )([in0Max84508,in1Max84508])
Con60006 = keras.layers.Concatenate(axis=2, name = 'Con60006', )([Max84508,in0Con60006])
Min18425 = keras.layers.Minimum(name = 'Min18425', )([Loc76253,Con60006])
Zer15314 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer15314', )(Min18425)
Ave16581 = keras.layers.Average(name = 'Ave16581', )([Res12731,Zer15314])
Dot45250 = keras.layers.Dot(axes=(2, 2), name = 'Dot45250', )([Zer98028,Ave16581])
Max34670 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='valid', name = 'Max34670', )(Dot45250)
model = tf.keras.models.Model(inputs=[in0Con77366,in0Ave28170,in1Ave28170,in0Loc76253,in0Max84508,in1Max84508,in0Con60006], outputs=Max34670)
w = model.get_layer('Con77366').get_weights() 
w[0] = np.array([[[[0.7604, 0.7965], [0.5182, 0.7707], [0.8515, 0.1788]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con77366').set_weights(w) 
w = model.get_layer('Con97748').get_weights() 
w[0] = np.array([[[0.2504, 0.3533, 0.3648, 0.2919], [0.5074, 0.4224, 0.7581, 0.8724], [0.1988, 0.7708, 0.0808, 0.8942]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con97748').set_weights(w) 
w = model.get_layer('Loc76253').get_weights() 
w[0] = np.array([[[0.7523, 0.7385, 0.0819, 0.8342]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc76253').set_weights(w) 
in0Con77366 = tf.constant([[[[0.9952, 0.0391]]]])
in0Ave28170 = tf.constant([[[[[0.1447, 0.6209]], [[0.3948, 0.4747]]], [[[0.0181, 0.3654]], [[0.886, 0.7677]]]]])
in1Ave28170 = tf.constant([[[[[0.0967, 0.4576]], [[0.0066, 0.64]]], [[[0.4587, 0.0866]], [[0.1404, 0.1845]]]]])
in0Loc76253 = tf.constant([[[0.8772], [0.1639]]])
in0Max84508 = tf.constant([[[0.2896]]])
in1Max84508 = tf.constant([[[0.0873]]])
in0Con60006 = tf.constant([[[0.8863, 0.7454, 0.9261]]])
print (np.array2string(model.predict([in0Con77366,in0Ave28170,in1Ave28170,in0Loc76253,in0Max84508,in1Max84508,in0Con60006],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max34670.png')

LCon77366 = conv2D_transpose_layer([[[[0.9952, 0.0391]]]], 1, 1,[[[[0.7604, 0.7965], [0.5182, 0.7707], [0.8515, 0.1788]]]],[0, 0, 0], 1, 1, true, Con77366), 
LRes73302 = reshape_layer(Con77366, [1, 3], Res73302), 
LCon97748 = conv1D_layer(Res73302, 1,[[[0.2504, 0.3533, 0.3648, 0.2919], [0.5074, 0.4224, 0.7581, 0.8724], [0.1988, 0.7708, 0.0808, 0.8942]]],[0, 0, 0, 0], 1, false, 1, Con97748), 
LZer16142 = zero_padding1D_layer(Con97748, 3, 0, Zer16142), 
LZer98028 = zero_padding1D_layer(Zer16142, 2, 0, Zer98028), 
LAve28170 = average_layer([[[[[[0.1447, 0.6209]], [[0.3948, 0.4747]]], [[[0.0181, 0.3654]], [[0.886, 0.7677]]]]], [[[[[0.0967, 0.4576]], [[0.0066, 0.64]]], [[[0.4587, 0.0866]], [[0.1404, 0.1845]]]]]], Ave28170), 
LRes29299 = reshape_layer(Ave28170, [2, 2, 2], Res29299), 
LRes12731 = reshape_layer(Res29299, [2, 4], Res12731), 
LLoc76253 = locally_connected1D_layer([[[0.8772], [0.1639]]], 1,[[[0.7523, 0.7385, 0.0819, 0.8342]]],[[0, 0, 0, 0]], 2, Loc76253), 
LMax84508 = maximum_layer([[[[0.2896]]], [[[0.0873]]]], Max84508), 
LCon60006 = concatenate_layer([Max84508,[[[0.8863, 0.7454, 0.9261]]]], 2, Con60006), 
LMin18425 = minimum_layer([Loc76253,Con60006], Min18425), 
LZer15314 = zero_padding1D_layer(Min18425, 1, 0, Zer15314), 
LAve16581 = average_layer([Res12731,Zer15314], Ave16581), 
LDot45250 = dot_layer(Zer98028,Ave16581, 2, 2, Dot45250), 
LMax34670 = max_pool1D_layer(Dot45250, 1, 1, false, Max34670), 
exec_layers([LCon77366,LRes73302,LCon97748,LZer16142,LZer98028,LAve28170,LRes29299,LRes12731,LLoc76253,LMax84508,LCon60006,LMin18425,LZer15314,LAve16581,LDot45250,LMax34670],["Con77366","Res73302","Con97748","Zer16142","Zer98028","Ave28170","Res29299","Res12731","Loc76253","Max84508","Con60006","Min18425","Zer15314","Ave16581","Dot45250","Max34670"],Max34670,"Max34670")

Actual (Unparsed): [[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.8406614, 1.7933451]]]

Expected (Unparsed): [[[0.0,0.0],[0.0,0.0],[0.0,0.0],[0.0,0.0],[0.0,0.0],[0.8406614647454415,1.793345133490643]]]

Actual:   [[[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0.8407, 1.7934]]]

Expected: [[[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0.8407, 1.7934]]]