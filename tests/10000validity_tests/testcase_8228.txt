import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub65276 = tf.keras.layers.Input(shape=([2, 3, 2]))
in1Sub65276 = tf.keras.layers.Input(shape=([2, 3, 2]))
in0Add89114 = tf.keras.layers.Input(shape=([2, 2]))
in1Add89114 = tf.keras.layers.Input(shape=([2, 2]))
in0Con95842 = tf.keras.layers.Input(shape=([2, 4]))
in0Dot55792 = tf.keras.layers.Input(shape=([2]))
in1Dot55792 = tf.keras.layers.Input(shape=([2]))
in0Con42761 = tf.keras.layers.Input(shape=([2]))
in0GRU35364 = tf.keras.layers.Input(shape=([1, 1]))
in0Glo17990 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con68482 = tf.keras.layers.Input(shape=([2]))
in0Con62877 = tf.keras.layers.Input(shape=([9]))

Sub65276 = keras.layers.Subtract(name = 'Sub65276', )([in0Sub65276,in1Sub65276])
Res79054 = keras.layers.Reshape((2, 6), name = 'Res79054', )(Sub65276)
Add89114 = keras.layers.Add(name = 'Add89114', )([in0Add89114,in1Add89114])
Con95842 = keras.layers.Concatenate(axis=2, name = 'Con95842', )([Add89114,in0Con95842])
Max91275 = keras.layers.Maximum(name = 'Max91275', )([Res79054,Con95842])
Fla95430 = keras.layers.Flatten(name = 'Fla95430', )(Max91275)
Dot55792 = keras.layers.Dot(axes=(1, 1), name = 'Dot55792', )([in0Dot55792,in1Dot55792])
Res68060 = keras.layers.Reshape((1, 1), name = 'Res68060', )(Dot55792)
Res12558 = keras.layers.Reshape((1, 1, 1), name = 'Res12558', )(Res68060)
Max77600 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 3), padding='valid', name = 'Max77600', )(Res12558)
Res32745 = keras.layers.Reshape((1, 1), name = 'Res32745', )(Max77600)
Fla28408 = keras.layers.Flatten(name = 'Fla28408', )(Res32745)
Con42761 = keras.layers.Concatenate(axis=1, name = 'Con42761', )([Fla28408,in0Con42761])
GRU35364 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU35364', )(in0GRU35364)
Glo17990 = keras.layers.GlobalMaxPool2D(name = 'Glo17990', )(in0Glo17990)
Con68482 = keras.layers.Concatenate(axis=1, name = 'Con68482', )([Glo17990,in0Con68482])
Mul87396 = keras.layers.Multiply(name = 'Mul87396', )([GRU35364,Con68482])
Mul76207 = keras.layers.Multiply(name = 'Mul76207', )([Con42761,Mul87396])
Con62877 = keras.layers.Concatenate(axis=1, name = 'Con62877', )([Mul76207,in0Con62877])
Mul75446 = keras.layers.Multiply(name = 'Mul75446', )([Fla95430,Con62877])
model = tf.keras.models.Model(inputs=[in0Sub65276,in1Sub65276,in0Add89114,in1Add89114,in0Con95842,in0Dot55792,in1Dot55792,in0Con42761,in0GRU35364,in0Glo17990,in0Con68482,in0Con62877], outputs=Mul75446)
w = model.get_layer('GRU35364').get_weights() 
w[0] = np.array([[2, 4, 7, 2, 7, 7, 2, 5, 9]])
w[1] = np.array([[10, 9, 1, 10, 8, 9, 10, 10, 4], [5, 1, 5, 9, 6, 2, 1, 10, 5], [9, 7, 6, 1, 2, 6, 2, 5, 2]])
w[2] = np.array([[9, 3, 5, 4, 9, 10, 1, 2, 10], [6, 4, 7, 4, 3, 4, 7, 8, 2]])
model.get_layer('GRU35364').set_weights(w) 
in0Sub65276 = tf.constant([[[[0.556, 0.796], [0.7054, 0.6394], [0.2893, 0.7391]], [[0.9271, 0.7262], [0.296, 0.8604], [0.1808, 0.5257]]]])
in1Sub65276 = tf.constant([[[[0.3994, 0.1577], [0.9911, 0.8846], [0.0945, 0.4952]], [[0.4803, 0.7613], [0.1401, 0.6149], [0.783, 0.5939]]]])
in0Add89114 = tf.constant([[[0.735, 0.3133], [0.9796, 0.4083]]])
in1Add89114 = tf.constant([[[0.8717, 0.4628], [0.0933, 0.3135]]])
in0Con95842 = tf.constant([[[0.4249, 0.3184, 0.4226, 0.7114], [0.6107, 0.2573, 0.7953, 0.0148]]])
in0Dot55792 = tf.constant([[0.4332, 0.8759]])
in1Dot55792 = tf.constant([[0.9313, 0.2449]])
in0Con42761 = tf.constant([[0.0327, 0.2825]])
in0GRU35364 = tf.constant([[[8]]])
in0Glo17990 = tf.constant([[[[1.229]], [[1.0087]]]])
in0Con68482 = tf.constant([[0.7196, 0.0479]])
in0Con62877 = tf.constant([[0.939, 0.293, 0.2125, 0.1348, 0.7958, 0.3285, 0.0577, 0.8729, 0.0783]])
print (np.array2string(model.predict([in0Sub65276,in1Sub65276,in0Add89114,in1Add89114,in0Con95842,in0Dot55792,in1Dot55792,in0Con42761,in0GRU35364,in0Glo17990,in0Con68482,in0Con62877],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul75446.png')

LSub65276 = subtract_layer([[[[0.556, 0.796], [0.7054, 0.6394], [0.2893, 0.7391]], [[0.9271, 0.7262], [0.296, 0.8604], [0.1808, 0.5257]]]], [[[[0.3994, 0.1577], [0.9911, 0.8846], [0.0945, 0.4952]], [[0.4803, 0.7613], [0.1401, 0.6149], [0.783, 0.5939]]]], Sub65276), 
LRes79054 = reshape_layer(Sub65276, [2, 6], Res79054), 
LAdd89114 = add_layer([[[[0.735, 0.3133], [0.9796, 0.4083]]], [[[0.8717, 0.4628], [0.0933, 0.3135]]]], Add89114), 
LCon95842 = concatenate_layer([Add89114,[[[0.4249, 0.3184, 0.4226, 0.7114], [0.6107, 0.2573, 0.7953, 0.0148]]]], 2, Con95842), 
LMax91275 = maximum_layer([Res79054,Con95842], Max91275), 
LFla95430 = flatten_layer(Max91275, Fla95430), 
LDot55792 = dot_layer([[0.4332, 0.8759]], [[0.9313, 0.2449]], 1, 1, Dot55792), 
LRes68060 = reshape_layer(Dot55792, [1, 1], Res68060), 
LRes12558 = reshape_layer(Res68060, [1, 1, 1], Res12558), 
LMax77600 = max_pool2D_layer(Res12558, 1, 1, 1, 3, false, Max77600), 
LRes32745 = reshape_layer(Max77600, [1, 1], Res32745), 
LFla28408 = flatten_layer(Res32745, Fla28408), 
LCon42761 = concatenate_layer([Fla28408,[[0.0327, 0.2825]]], 1, Con42761), 
LGRU35364 = gru_layer([[[8]]],[[2, 4, 7, 2, 7, 7, 2, 5, 9]],[[10, 9, 1, 10, 8, 9, 10, 10, 4], [5, 1, 5, 9, 6, 2, 1, 10, 5], [9, 7, 6, 1, 2, 6, 2, 5, 2]],[[9, 3, 5, 4, 9, 10, 1, 2, 10], [6, 4, 7, 4, 3, 4, 7, 8, 2]], true, GRU35364), 
LGlo17990 = global_max_pool2D_layer([[[[1.229]], [[1.0087]]]], Glo17990), 
LCon68482 = concatenate_layer([Glo17990,[[0.7196, 0.0479]]], 1, Con68482), 
LMul87396 = multiply_layer([GRU35364,Con68482], Mul87396), 
LMul76207 = multiply_layer([Con42761,Mul87396], Mul76207), 
LCon62877 = concatenate_layer([Mul76207,[[0.939, 0.293, 0.2125, 0.1348, 0.7958, 0.3285, 0.0577, 0.8729, 0.0783]]], 1, Con62877), 
LMul75446 = multiply_layer([Fla95430,Con62877], Mul75446), 
exec_layers([LSub65276,LRes79054,LAdd89114,LCon95842,LMax91275,LFla95430,LDot55792,LRes68060,LRes12558,LMax77600,LRes32745,LFla28408,LCon42761,LGRU35364,LGlo17990,LCon68482,LMul87396,LMul76207,LCon62877,LMul75446],["Sub65276","Res79054","Add89114","Con95842","Max91275","Fla95430","Dot55792","Res68060","Res12558","Max77600","Res32745","Fla28408","Con42761","GRU35364","Glo17990","Con68482","Mul87396","Mul76207","Con62877","Mul75446"],Mul75446,"Mul75446")

Actual (Unparsed): [[0.0000000, 0.0000000, 0.0000000, 0.2989776, 0.1238218, 0.1511725, 0.1446269, 0.5744084, 0.2006150, 0.0148462, 0.6942174, 0.0011588]]

Expected (Unparsed): [[4.1996188615779947e-14,0.0,0.0,0.2989776,0.12382179999999998,0.15117250000000002,0.14462692,0.5744084399999999,0.20061495000000001,0.014846209999999999,0.6942173700000001,0.00115884]]

Actual:   [[0, 0, 0, 0.299, 0.1239, 0.1512, 0.1447, 0.5745, 0.2007, 0.0149, 0.6943, 0.0012]]

Expected: [[0, 0, 0, 0.299, 0.1239, 0.1512, 0.1447, 0.5745, 0.2007, 0.0149, 0.6943, 0.0012]]