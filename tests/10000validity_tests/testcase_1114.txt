import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0ELU58134 = tf.keras.layers.Input(shape=([2, 1]))
in0Sub9276 = tf.keras.layers.Input(shape=([3]))
in1Sub9276 = tf.keras.layers.Input(shape=([3]))
in0Add15042 = tf.keras.layers.Input(shape=([1, 1]))
in1Add15042 = tf.keras.layers.Input(shape=([1, 1]))
in0Con5239 = tf.keras.layers.Input(shape=([3, 1]))
in0Min98673 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Min98673 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0LST9730 = tf.keras.layers.Input(shape=([3, 2]))
in0Con76241 = tf.keras.layers.Input(shape=([3, 1]))
in0Min20154 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Min20154 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Con7541 = tf.keras.layers.Input(shape=([3, 3]))

ELU58134 = keras.layers.ELU(alpha=9.206581548733247, name = 'ELU58134', input_shape=(2, 1))(in0ELU58134)
Zer63457 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer63457', )(ELU58134)
Sub9276 = keras.layers.Subtract(name = 'Sub9276', )([in0Sub9276,in1Sub9276])
Res57856 = keras.layers.Reshape((3, 1), name = 'Res57856', )(Sub9276)
Add15042 = keras.layers.Add(name = 'Add15042', )([in0Add15042,in1Add15042])
Zer3059 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer3059', )(Add15042)
Min86256 = keras.layers.Minimum(name = 'Min86256', )([Res57856,Zer3059])
Dot44282 = keras.layers.Dot(axes=(2, 2), name = 'Dot44282', )([Zer63457,Min86256])
Con5239 = keras.layers.Concatenate(axis=2, name = 'Con5239', )([Dot44282,in0Con5239])
Min98673 = keras.layers.Minimum(name = 'Min98673', )([in0Min98673,in1Min98673])
Res50918 = keras.layers.Reshape((1, 4), name = 'Res50918', )(Min98673)
Zer83655 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer83655', )(Res50918)
LST9730 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST9730', )(in0LST9730)
Res82781 = keras.layers.Reshape((2, 1), name = 'Res82781', )(LST9730)
Res13447 = keras.layers.Reshape((2, 1, 1), name = 'Res13447', )(Res82781)
Res43615 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res43615', )(Res13447)
Con14197 = keras.layers.Conv3DTranspose(3, (2, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con14197', )(Res43615)
Res53014 = keras.layers.Reshape((3, 1, 3), name = 'Res53014', )(Con14197)
Res5031 = keras.layers.Reshape((3, 3), name = 'Res5031', )(Res53014)
Con76241 = keras.layers.Concatenate(axis=2, name = 'Con76241', )([Res5031,in0Con76241])
Min20154 = keras.layers.Minimum(name = 'Min20154', )([in0Min20154,in1Min20154])
Sof34463 = keras.layers.Softmax(axis=1, name = 'Sof34463', )(Min20154)
Res94522 = keras.layers.Reshape((1, 2, 2), name = 'Res94522', )(Sof34463)
Res29807 = keras.layers.Reshape((1, 4), name = 'Res29807', )(Res94522)
Dot51664 = keras.layers.Dot(axes=(2, 2), name = 'Dot51664', )([Con76241,Res29807])
Con7541 = keras.layers.Concatenate(axis=2, name = 'Con7541', )([Dot51664,in0Con7541])
Min78431 = keras.layers.Minimum(name = 'Min78431', )([Zer83655,Con7541])
Min20588 = keras.layers.Minimum(name = 'Min20588', )([Con5239,Min78431])
model = tf.keras.models.Model(inputs=[in0ELU58134,in0Sub9276,in1Sub9276,in0Add15042,in1Add15042,in0Con5239,in0Min98673,in1Min98673,in0LST9730,in0Con76241,in0Min20154,in1Min20154,in0Con7541], outputs=Min20588)
w = model.get_layer('LST9730').get_weights() 
w[0] = np.array([[5, 7, 4, 1, 10, 4, 4, 7], [6, 3, 8, 7, 8, 4, 7, 3]])
w[1] = np.array([[5, 5, 10, 3, 1, 6, 4, 10], [4, 3, 8, 10, 3, 3, 8, 6]])
w[2] = np.array([6, 6, 4, 3, 4, 7, 3, 5])
model.get_layer('LST9730').set_weights(w) 
w = model.get_layer('Con14197').get_weights() 
w[0] = np.array([[[[[0.5129], [0.2019], [0.1158]]]], [[[[0.3236], [0.1231], [0.7499]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con14197').set_weights(w) 
in0ELU58134 = tf.constant([[[0.8724], [0.7896]]])
in0Sub9276 = tf.constant([[0.8517, 0.0466, 0.2717]])
in1Sub9276 = tf.constant([[0.567, 0.2866, 0.0788]])
in0Add15042 = tf.constant([[[0.1399]]])
in1Add15042 = tf.constant([[[0.6886]]])
in0Con5239 = tf.constant([[[0.8978], [0.7095], [0.5031]]])
in0Min98673 = tf.constant([[[[0.6307, 0.5313], [0.3355, 0.573]]]])
in1Min98673 = tf.constant([[[[0.7925, 0.2811], [0.969, 0.6821]]]])
in0LST9730 = tf.constant([[[7, 5], [8, 1], [2, 7]]])
in0Con76241 = tf.constant([[[0.5133], [0.9079], [0.7053]]])
in0Min20154 = tf.constant([[[[[0.6609], [0.4579]], [[0.6505], [0.917]]]]])
in1Min20154 = tf.constant([[[[[0.0871], [0.5271]], [[0.2932], [0.4816]]]]])
in0Con7541 = tf.constant([[[0.5235, 0.0623, 0.9615], [0.947, 0.4916, 0.7591], [0.9165, 0.5575, 0.9547]]])
print (np.array2string(model.predict([in0ELU58134,in0Sub9276,in1Sub9276,in0Add15042,in1Add15042,in0Con5239,in0Min98673,in1Min98673,in0LST9730,in0Con76241,in0Min20154,in1Min20154,in0Con7541],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min20588.png')

LELU58134 = elu_layer([[[0.8724], [0.7896]]], 9.206581548733247, ELU58134), 
LZer63457 = zero_padding1D_layer(ELU58134, 1, 0, Zer63457), 
LSub9276 = subtract_layer([[0.8517, 0.0466, 0.2717]], [[0.567, 0.2866, 0.0788]], Sub9276), 
LRes57856 = reshape_layer(Sub9276, [3, 1], Res57856), 
LAdd15042 = add_layer([[[[0.1399]]], [[[0.6886]]]], Add15042), 
LZer3059 = zero_padding1D_layer(Add15042, 2, 0, Zer3059), 
LMin86256 = minimum_layer([Res57856,Zer3059], Min86256), 
LDot44282 = dot_layer(Zer63457,Min86256, 2, 2, Dot44282), 
LCon5239 = concatenate_layer([Dot44282,[[[0.8978], [0.7095], [0.5031]]]], 2, Con5239), 
LMin98673 = minimum_layer([[[[[0.6307, 0.5313], [0.3355, 0.573]]]], [[[[0.7925, 0.2811], [0.969, 0.6821]]]]], Min98673), 
LRes50918 = reshape_layer(Min98673, [1, 4], Res50918), 
LZer83655 = zero_padding1D_layer(Res50918, 2, 0, Zer83655), 
LLST9730 = lstm_layer([[[7, 5], [8, 1], [2, 7]]],[[5, 7, 4, 1, 10, 4, 4, 7], [6, 3, 8, 7, 8, 4, 7, 3]],[[5, 5, 10, 3, 1, 6, 4, 10], [4, 3, 8, 10, 3, 3, 8, 6]],[6, 6, 4, 3, 4, 7, 3, 5], LST9730), 
LRes82781 = reshape_layer(LST9730, [2, 1], Res82781), 
LRes13447 = reshape_layer(Res82781, [2, 1, 1], Res13447), 
LRes43615 = reshape_layer(Res13447, [2, 1, 1, 1], Res43615), 
LCon14197 = conv3D_transpose_layer(Res43615, 2, 1, 1,[[[[[0.5129], [0.2019], [0.1158]]]], [[[[0.3236], [0.1231], [0.7499]]]]],[0, 0, 0], 1, 1, 1, false, Con14197), 
LRes53014 = reshape_layer(Con14197, [3, 1, 3], Res53014), 
LRes5031 = reshape_layer(Res53014, [3, 3], Res5031), 
LCon76241 = concatenate_layer([Res5031,[[[0.5133], [0.9079], [0.7053]]]], 2, Con76241), 
LMin20154 = minimum_layer([[[[[[0.6609], [0.4579]], [[0.6505], [0.917]]]]], [[[[[0.0871], [0.5271]], [[0.2932], [0.4816]]]]]], Min20154), 
LSof34463 = softmax_layer(Min20154, 1, Sof34463), 
LRes94522 = reshape_layer(Sof34463, [1, 2, 2], Res94522), 
LRes29807 = reshape_layer(Res94522, [1, 4], Res29807), 
LDot51664 = dot_layer(Con76241,Res29807, 2, 2, Dot51664), 
LCon7541 = concatenate_layer([Dot51664,[[[0.5235, 0.0623, 0.9615], [0.947, 0.4916, 0.7591], [0.9165, 0.5575, 0.9547]]]], 2, Con7541), 
LMin78431 = minimum_layer([Zer83655,Con7541], Min78431), 
LMin20588 = minimum_layer([Con5239,Min78431], Min20588), 
exec_layers([LELU58134,LZer63457,LSub9276,LRes57856,LAdd15042,LZer3059,LMin86256,LDot44282,LCon5239,LMin98673,LRes50918,LZer83655,LLST9730,LRes82781,LRes13447,LRes43615,LCon14197,LRes53014,LRes5031,LCon76241,LMin20154,LSof34463,LRes94522,LRes29807,LDot51664,LCon7541,LMin78431,LMin20588],["ELU58134","Zer63457","Sub9276","Res57856","Add15042","Zer3059","Min86256","Dot44282","Con5239","Min98673","Res50918","Zer83655","LST9730","Res82781","Res13447","Res43615","Con14197","Res53014","Res5031","Con76241","Min20154","Sof34463","Res94522","Res29807","Dot51664","Con7541","Min78431","Min20588"],Min20588,"Min20588")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, -0.2093760, 0.0000000, 0.0000000], [0.0000000, -0.1895040, 0.1523138, 0.5031000]]]

Expected (Unparsed): [[[0,0.0,0.0,0],[0.0,-0.209376,0,0],[0.0,-0.189504,0.15231384,0.5031]]]

Actual:   [[[0, 0, 0, 0], [0, -0.2093, 0, 0], [0, -0.1895, 0.1524, 0.5031]]]

Expected: [[[0, 0, 0, 0], [0, -0.2093, 0, 0], [0, -0.1895, 0.1524, 0.5031]]]