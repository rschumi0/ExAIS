import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul61095 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Mul61095 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Add22189 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Add22189 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Max64552 = tf.keras.layers.Input(shape=([2, 1]))
in0Con99800 = tf.keras.layers.Input(shape=([2, 3]))
in0Con18402 = tf.keras.layers.Input(shape=([2, 4]))
in0Mul51853 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Mul51853 = tf.keras.layers.Input(shape=([2, 1, 1]))

Mul61095 = keras.layers.Multiply(name = 'Mul61095', )([in0Mul61095,in1Mul61095])
Den59369 = keras.layers.Dense(4,name = 'Den59369', )(Mul61095)
Lay63361 = keras.layers.LayerNormalization(axis=2, epsilon=2.9495572166106965, name = 'Lay63361', )(Den59369)
Res6197 = keras.layers.Reshape((2, 8), name = 'Res6197', )(Lay63361)
Add22189 = keras.layers.Add(name = 'Add22189', )([in0Add22189,in1Add22189])
Res44935 = keras.layers.Reshape((1, 4), name = 'Res44935', )(Add22189)
Zer75120 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer75120', )(Res44935)
Max64552 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max64552', )(in0Max64552)
Con99800 = keras.layers.Concatenate(axis=2, name = 'Con99800', )([Max64552,in0Con99800])
Ave25054 = keras.layers.Average(name = 'Ave25054', )([Zer75120,Con99800])
Con18402 = keras.layers.Concatenate(axis=2, name = 'Con18402', )([Ave25054,in0Con18402])
Add39185 = keras.layers.Add(name = 'Add39185', )([Res6197,Con18402])
Res53155 = keras.layers.Reshape((2, 8, 1), name = 'Res53155', )(Add39185)
Mul51853 = keras.layers.Multiply(name = 'Mul51853', )([in0Mul51853,in1Mul51853])
Zer91612 = keras.layers.ZeroPadding2D(padding=((0, 0), (7, 0)), name = 'Zer91612', )(Mul51853)
Min70796 = keras.layers.Minimum(name = 'Min70796', )([Res53155,Zer91612])
model = tf.keras.models.Model(inputs=[in0Mul61095,in1Mul61095,in0Add22189,in1Add22189,in0Max64552,in0Con99800,in0Con18402,in0Mul51853,in1Mul51853], outputs=Min70796)
w = model.get_layer('Den59369').get_weights() 
w[0] = np.array([[0.5971, 0.8858, 0.1383, 0.1265]])
w[1] = np.array([0.2918, 0.4099, 0.9594, 0.689])
model.get_layer('Den59369').set_weights(w) 
in0Mul61095 = tf.constant([[[[0.233], [0.36]], [[0.8942], [0.9743]]]])
in1Mul61095 = tf.constant([[[[0.4851], [0.2927]], [[0.8258], [0.3531]]]])
in0Add22189 = tf.constant([[[[0.6596, 0.7035], [0.1589, 0.0013]]]])
in1Add22189 = tf.constant([[[[0.1398, 0.8771], [0.6192, 0.1101]]]])
in0Max64552 = tf.constant([[[1.9971], [1.0788]]])
in0Con99800 = tf.constant([[[0.9401, 0.6316, 0.9613], [0.8144, 0.9632, 0.2113]]])
in0Con18402 = tf.constant([[[0.4979, 0.4788, 0.3496, 0.7137], [0.6734, 0.7018, 0.3663, 0.6104]]])
in0Mul51853 = tf.constant([[[[0.4951]], [[0.2971]]]])
in1Mul51853 = tf.constant([[[[0.2564]], [[0.9254]]]])
print (np.array2string(model.predict([in0Mul61095,in1Mul61095,in0Add22189,in1Add22189,in0Max64552,in0Con99800,in0Con18402,in0Mul51853,in1Mul51853],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min70796.png')

LMul61095 = multiply_layer([[[[[0.233], [0.36]], [[0.8942], [0.9743]]]], [[[[0.4851], [0.2927]], [[0.8258], [0.3531]]]]], Mul61095), 
LDen59369 = dense_layer(Mul61095, [[0.5971, 0.8858, 0.1383, 0.1265]],[0.2918, 0.4099, 0.9594, 0.689], Den59369), 
LLay63361 = layer_normalization_layer(Den59369, 2, 2.9495572166106965, Lay63361), 
LRes6197 = reshape_layer(Lay63361, [2, 8], Res6197), 
LAdd22189 = add_layer([[[[[0.6596, 0.7035], [0.1589, 0.0013]]]], [[[[0.1398, 0.8771], [0.6192, 0.1101]]]]], Add22189), 
LRes44935 = reshape_layer(Add22189, [1, 4], Res44935), 
LZer75120 = zero_padding1D_layer(Res44935, 1, 0, Zer75120), 
LMax64552 = max_pool1D_layer([[[1.9971], [1.0788]]], 1, Max64552), 
LCon99800 = concatenate_layer([Max64552,[[[0.9401, 0.6316, 0.9613], [0.8144, 0.9632, 0.2113]]]], 2, Con99800), 
LAve25054 = average_layer([Zer75120,Con99800], Ave25054), 
LCon18402 = concatenate_layer([Ave25054,[[[0.4979, 0.4788, 0.3496, 0.7137], [0.6734, 0.7018, 0.3663, 0.6104]]]], 2, Con18402), 
LAdd39185 = add_layer([Res6197,Con18402], Add39185), 
LRes53155 = reshape_layer(Add39185, [2, 8, 1], Res53155), 
LMul51853 = multiply_layer([[[[[0.4951]], [[0.2971]]]], [[[[0.2564]], [[0.9254]]]]], Mul51853), 
LZer91612 = zero_padding2D_layer(Mul51853, 0, 0, 7, 0, Zer91612), 
LMin70796 = minimum_layer([Res53155,Zer91612], Min70796), 
exec_layers([LMul61095,LDen59369,LLay63361,LRes6197,LAdd22189,LRes44935,LZer75120,LMax64552,LCon99800,LAve25054,LCon18402,LAdd39185,LRes53155,LMul51853,LZer91612,LMin70796],["Mul61095","Den59369","Lay63361","Res6197","Add22189","Res44935","Zer75120","Max64552","Con99800","Ave25054","Con18402","Add39185","Res53155","Mul51853","Zer91612","Min70796"],Min70796,"Min70796")

Actual (Unparsed): [[[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.1269436]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.2749364]]]]

Expected (Unparsed): [[[[0],[0],[0],[0],[0],[0],[0],[0.12694364]],[[0],[0],[0],[0],[0],[0],[0],[0.27493634]]]]

Actual:   [[[[0], [0], [0], [0], [0], [0], [0], [0.127]], [[0], [0], [0], [0], [0], [0], [0], [0.275]]]]

Expected: [[[[0], [0], [0], [0], [0], [0], [0], [0.127]], [[0], [0], [0], [0], [0], [0], [0], [0.275]]]]