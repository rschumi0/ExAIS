import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub43734 = tf.keras.layers.Input(shape=([3, 2, 2, 2]))
in1Sub43734 = tf.keras.layers.Input(shape=([3, 2, 2, 2]))

Sub43734 = keras.layers.Subtract(name = 'Sub43734', )([in0Sub43734,in1Sub43734])
Res66663 = keras.layers.Reshape((3, 2, 4), name = 'Res66663', )(Sub43734)
Max53518 = keras.layers.MaxPool2D(pool_size=(3, 2), name = 'Max53518', )(Res66663)
Lea57014 = keras.layers.LeakyReLU(alpha=7.645611971474299, name = 'Lea57014', )(Max53518)
Res99160 = keras.layers.Reshape((1, 4), name = 'Res99160', )(Lea57014)
LST95676 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST95676', )(Res99160)
model = tf.keras.models.Model(inputs=[in0Sub43734,in1Sub43734], outputs=LST95676)
w = model.get_layer('LST95676').get_weights() 
w[0] = np.array([[3, 2, 1, 7, 7, 5, 9, 4, 1, 9, 6, 3], [9, 3, 6, 7, 1, 9, 10, 10, 10, 2, 9, 3], [3, 6, 9, 7, 7, 7, 7, 2, 9, 4, 9, 6], [5, 1, 4, 5, 8, 4, 5, 10, 8, 3, 1, 9]])
w[1] = np.array([[1, 10, 3, 7, 9, 6, 3, 3, 2, 2, 3, 6], [6, 8, 3, 1, 9, 7, 9, 1, 1, 5, 1, 10], [7, 6, 9, 1, 3, 3, 9, 3, 5, 10, 5, 2]])
w[2] = np.array([5, 5, 6, 3, 1, 1, 2, 6, 10, 1, 9, 7])
model.get_layer('LST95676').set_weights(w) 
in0Sub43734 = tf.constant([[[[[0.4503, 0.801], [0.5063, 0.2298]], [[0.8948, 0.3762], [0.6072, 0.4901]]], [[[0.08, 0.0684], [0.7787, 0.7763]], [[0.3788, 0.4009], [0.3167, 0.9641]]], [[[0.4884, 0.5319], [0.7468, 0.2328]], [[0.8453, 0.0088], [0.5365, 0.9166]]]]])
in1Sub43734 = tf.constant([[[[[0.5739, 0.7365], [0.4757, 0.8999]], [[0.6657, 0.5774], [0.2612, 0.2525]]], [[[0.5475, 0.4048], [0.4867, 0.5371]], [[0.326, 0.756], [0.0665, 0.3689]]], [[[0.7661, 0.4492], [0.1026, 0.3568]], [[0.5029, 0.6628], [0.3427, 0.517]]]]])
print (np.array2string(model.predict([in0Sub43734,in1Sub43734],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST95676.png')

LSub43734 = subtract_layer([[[[[0.4503, 0.801], [0.5063, 0.2298]], [[0.8948, 0.3762], [0.6072, 0.4901]]], [[[0.08, 0.0684], [0.7787, 0.7763]], [[0.3788, 0.4009], [0.3167, 0.9641]]], [[[0.4884, 0.5319], [0.7468, 0.2328]], [[0.8453, 0.0088], [0.5365, 0.9166]]]]], [[[[[0.5739, 0.7365], [0.4757, 0.8999]], [[0.6657, 0.5774], [0.2612, 0.2525]]], [[[0.5475, 0.4048], [0.4867, 0.5371]], [[0.326, 0.756], [0.0665, 0.3689]]], [[[0.7661, 0.4492], [0.1026, 0.3568]], [[0.5029, 0.6628], [0.3427, 0.517]]]]], Sub43734), 
LRes66663 = reshape_layer(Sub43734, [3, 2, 4], Res66663), 
LMax53518 = max_pool2D_layer(Res66663, 3, 2, Max53518), 
LLea57014 = leaky_relu_layer(Max53518, 7.645611971474299, Lea57014), 
LRes99160 = reshape_layer(Lea57014, [1, 4], Res99160), 
LLST95676 = lstm_layer(Res99160,[[3, 2, 1, 7, 7, 5, 9, 4, 1, 9, 6, 3], [9, 3, 6, 7, 1, 9, 10, 10, 10, 2, 9, 3], [3, 6, 9, 7, 7, 7, 7, 2, 9, 4, 9, 6], [5, 1, 4, 5, 8, 4, 5, 10, 8, 3, 1, 9]],[[1, 10, 3, 7, 9, 6, 3, 3, 2, 2, 3, 6], [6, 8, 3, 1, 9, 7, 9, 1, 1, 5, 1, 10], [7, 6, 9, 1, 3, 3, 9, 3, 5, 10, 5, 2]],[5, 5, 6, 3, 1, 1, 2, 6, 10, 1, 9, 7], LST95676), 
exec_layers([LSub43734,LRes66663,LMax53518,LLea57014,LRes99160,LLST95676],["Sub43734","Res66663","Max53518","Lea57014","Res99160","LST95676"],LST95676,"LST95676")

Actual (Unparsed): [[0.7614517, 0.7615813, 0.7615940]]

Expected (Unparsed): [[0.7614517266754763,0.761581279692919,0.761594010500134]]

Actual:   [[0.7615, 0.7616, 0.7616]]

Expected: [[0.7615, 0.7616, 0.7616]]