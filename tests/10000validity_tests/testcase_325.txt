import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Bat18382 = tf.keras.layers.Input(shape=([4, 2, 2]))
in0Ave45810 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Sim40354 = tf.keras.layers.Input(shape=([1, 3]))
in0Cro59694 = tf.keras.layers.Input(shape=([3, 1]))

Bat18382 = keras.layers.BatchNormalization(axis=2, epsilon=0.35242264544373925,  name = 'Bat18382', )(in0Bat18382)
Glo42788 = keras.layers.GlobalMaxPool2D(name = 'Glo42788', )(Bat18382)
Res54544 = keras.layers.Reshape((2, 1), name = 'Res54544', )(Glo42788)
Zer47422 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer47422', )(Res54544)
Ave45810 = keras.layers.AveragePooling2D(pool_size=(2, 1), strides=(1, 1), padding='valid', name = 'Ave45810', )(in0Ave45810)
Res23992 = keras.layers.Reshape((1, 1), name = 'Res23992', )(Ave45810)
Zer21678 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer21678', )(Res23992)
Sim40354 = keras.layers.SimpleRNN(2,name = 'Sim40354', )(in0Sim40354)
Res95821 = keras.layers.Reshape((2, 1), name = 'Res95821', )(Sim40354)
GRU6541 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU6541', )(Res95821)
Res26384 = keras.layers.Reshape((3, 1), name = 'Res26384', )(GRU6541)
Cro59694 = keras.layers.Cropping1D(cropping=((2, 0)), name = 'Cro59694', )(in0Cro59694)
Zer92167 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer92167', )(Cro59694)
Min74040 = keras.layers.Minimum(name = 'Min74040', )([Res26384,Zer92167])
Min82984 = keras.layers.Minimum(name = 'Min82984', )([Zer21678,Min74040])
Zer39120 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer39120', )(Min82984)
Max47746 = keras.layers.Maximum(name = 'Max47746', )([Zer47422,Zer39120])
Bat57767 = keras.layers.BatchNormalization(axis=2, epsilon=0.6245505160568501,  name = 'Bat57767', )(Max47746)
model = tf.keras.models.Model(inputs=[in0Bat18382,in0Ave45810,in0Sim40354,in0Cro59694], outputs=Bat57767)
w = model.get_layer('Bat18382').get_weights() 
w[0] = np.array([0.5217, 0.0443])
w[1] = np.array([0.9483, 0.9208])
w[2] = np.array([0.7354, 0.0129])
w[3] = np.array([0.7126, 0.3147])
model.get_layer('Bat18382').set_weights(w) 
w = model.get_layer('Sim40354').get_weights() 
w[0] = np.array([[10, 7], [9, 1], [1, 2]])
w[1] = np.array([[5, 6], [5, 7]])
w[2] = np.array([4, 1])
model.get_layer('Sim40354').set_weights(w) 
w = model.get_layer('GRU6541').get_weights() 
w[0] = np.array([[7, 9, 5, 6, 8, 2, 2, 1, 5]])
w[1] = np.array([[3, 8, 6, 7, 1, 5, 7, 5, 7], [9, 1, 9, 1, 6, 3, 5, 1, 3], [10, 7, 8, 5, 7, 4, 1, 1, 8]])
w[2] = np.array([2, 3, 3, 6, 7, 8, 4, 1, 9])
model.get_layer('GRU6541').set_weights(w) 
w = model.get_layer('Bat57767').get_weights() 
w[0] = np.array([0.7207])
w[1] = np.array([0.0609])
w[2] = np.array([0.8024])
w[3] = np.array([0.9687])
model.get_layer('Bat57767').set_weights(w) 
in0Bat18382 = tf.constant([[[[1.6613, 1.1777], [1.0989, 1.8775]], [[1.3983, 1.209], [1.3471, 1.029]], [[1.3557, 1.8115], [1.9666, 1.2668]], [[1.7691, 1.6749], [1.1837, 1.36]]]])
in0Ave45810 = tf.constant([[[[1.5076]], [[1.3577]]]])
in0Sim40354 = tf.constant([[[10, 9, 4]]])
in0Cro59694 = tf.constant([[[1.8931], [1.1731], [1.9942]]])
print (np.array2string(model.predict([in0Bat18382,in0Ave45810,in0Sim40354,in0Cro59694],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Bat57767.png')

LBat18382 = batch_normalization_layer([[[[1.6613, 1.1777], [1.0989, 1.8775]], [[1.3983, 1.209], [1.3471, 1.029]], [[1.3557, 1.8115], [1.9666, 1.2668]], [[1.7691, 1.6749], [1.1837, 1.36]]]], 2, 0.35242264544373925, [0.5217, 0.0443], [0.9483, 0.9208], [0.7354, 0.0129], [0.7126, 0.3147], Bat18382), 
LGlo42788 = global_max_pool2D_layer(Bat18382, Glo42788), 
LRes54544 = reshape_layer(Glo42788, [2, 1], Res54544), 
LZer47422 = zero_padding1D_layer(Res54544, 1, 1, Zer47422), 
LAve45810 = average_pooling2D_layer([[[[1.5076]], [[1.3577]]]], 2, 1, 1, 1, false, Ave45810), 
LRes23992 = reshape_layer(Ave45810, [1, 1], Res23992), 
LZer21678 = zero_padding1D_layer(Res23992, 2, 0, Zer21678), 
LSim40354 = simple_rnn_layer([[[10, 9, 4]]],[[10, 7], [9, 1], [1, 2]],[[5, 6], [5, 7]],[4, 1], Sim40354), 
LRes95821 = reshape_layer(Sim40354, [2, 1], Res95821), 
LGRU6541 = gru_layer(Res95821,[[7, 9, 5, 6, 8, 2, 2, 1, 5]],[[3, 8, 6, 7, 1, 5, 7, 5, 7], [9, 1, 9, 1, 6, 3, 5, 1, 3], [10, 7, 8, 5, 7, 4, 1, 1, 8]],[2, 3, 3, 6, 7, 8, 4, 1, 9], false, GRU6541), 
LRes26384 = reshape_layer(GRU6541, [3, 1], Res26384), 
LCro59694 = cropping1D_layer([[[1.8931], [1.1731], [1.9942]]], 2, 0, Cro59694), 
LZer92167 = zero_padding1D_layer(Cro59694, 2, 0, Zer92167), 
LMin74040 = minimum_layer([Res26384,Zer92167], Min74040), 
LMin82984 = minimum_layer([Zer21678,Min74040], Min82984), 
LZer39120 = zero_padding1D_layer(Min82984, 1, 0, Zer39120), 
LMax47746 = maximum_layer([Zer47422,Zer39120], Max47746), 
LBat57767 = batch_normalization_layer(Max47746, 2, 0.6245505160568501, [0.7207], [0.0609], [0.8024], [0.9687], Bat57767), 
exec_layers([LBat18382,LGlo42788,LRes54544,LZer47422,LAve45810,LRes23992,LZer21678,LSim40354,LRes95821,LGRU6541,LRes26384,LCro59694,LZer92167,LMin74040,LMin82984,LZer39120,LMax47746,LBat57767],["Bat18382","Glo42788","Res54544","Zer47422","Ave45810","Res23992","Zer21678","Sim40354","Res95821","GRU6541","Res26384","Cro59694","Zer92167","Min74040","Min82984","Zer39120","Max47746","Bat57767"],Bat57767,"Bat57767")

Actual (Unparsed): [[[-0.3972455], [0.4425697], [0.4548080], [-0.3968633]]]

Expected (Unparsed): [[[-0.39724548203453836],[0.4425697426288744],[0.45480800502056984],[-0.39686326127908206]]]

Actual:   [[[-0.3972], [0.4426], [0.4549], [-0.3968]]]

Expected: [[[-0.3972], [0.4426], [0.4549], [-0.3968]]]