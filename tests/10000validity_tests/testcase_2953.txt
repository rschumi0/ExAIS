import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave59532 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Ave59532 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))

Ave59532 = keras.layers.Average(name = 'Ave59532', )([in0Ave59532,in1Ave59532])
Res63329 = keras.layers.Reshape((1, 1, 4), name = 'Res63329', )(Ave59532)
Res50106 = keras.layers.Reshape((1, 4), name = 'Res50106', )(Res63329)
LST61657 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST61657', )(Res50106)
model = tf.keras.models.Model(inputs=[in0Ave59532,in1Ave59532], outputs=LST61657)
w = model.get_layer('LST61657').get_weights() 
w[0] = np.array([[1, 1, 7, 5, 10, 3, 7, 7], [6, 4, 8, 2, 1, 2, 3, 10], [1, 2, 4, 2, 8, 7, 1, 8], [3, 2, 3, 7, 2, 7, 4, 6]])
w[1] = np.array([[5, 8, 7, 5, 6, 10, 8, 5], [8, 9, 5, 1, 3, 3, 4, 2]])
w[2] = np.array([5, 4, 2, 7, 3, 6, 9, 9])
model.get_layer('LST61657').set_weights(w) 
in0Ave59532 = tf.constant([[[[[0.3167, 0.164], [0.0555, 0.6869]]]]])
in1Ave59532 = tf.constant([[[[[0.3802, 0.5575], [0.0867, 0.0121]]]]])
print (np.array2string(model.predict([in0Ave59532,in1Ave59532],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST61657.png')

LAve59532 = average_layer([[[[[[0.3167, 0.164], [0.0555, 0.6869]]]]], [[[[[0.3802, 0.5575], [0.0867, 0.0121]]]]]], Ave59532), 
LRes63329 = reshape_layer(Ave59532, [1, 1, 4], Res63329), 
LRes50106 = reshape_layer(Res63329, [1, 4], Res50106), 
LLST61657 = lstm_layer(Res50106,[[1, 1, 7, 5, 10, 3, 7, 7], [6, 4, 8, 2, 1, 2, 3, 10], [1, 2, 4, 2, 8, 7, 1, 8], [3, 2, 3, 7, 2, 7, 4, 6]],[[5, 8, 7, 5, 6, 10, 8, 5], [8, 9, 5, 1, 3, 3, 4, 2]],[5, 4, 2, 7, 3, 6, 9, 9], LST61657), 
exec_layers([LAve59532,LRes63329,LRes50106,LLST61657],["Ave59532","Res63329","Res50106","LST61657"],LST61657,"LST61657")

Actual (Unparsed): [[0.7615186, 0.7610413]]

Expected (Unparsed): [[0.7615186009922119,0.7610413466113791]]

Actual:   [[0.7616, 0.7611]]

Expected: [[0.7616, 0.7611]]