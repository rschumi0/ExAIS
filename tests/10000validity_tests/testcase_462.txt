import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sep47491 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Add78208 = tf.keras.layers.Input(shape=([2, 2]))
in1Add78208 = tf.keras.layers.Input(shape=([2, 2]))
in0Con5328 = tf.keras.layers.Input(shape=([4, 4, 1]))

Sep47491 = keras.layers.SeparableConv2D(2, (1, 1),strides=(1, 1), padding='same', name = 'Sep47491', )(in0Sep47491)
Zer9304 = keras.layers.ZeroPadding2D(padding=((3, 0), (3, 0)), name = 'Zer9304', )(Sep47491)
Add78208 = keras.layers.Add(name = 'Add78208', )([in0Add78208,in1Add78208])
Res20740 = keras.layers.Reshape((2, 2, 1), name = 'Res20740', )(Add78208)
Zer91400 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer91400', )(Res20740)
Con5328 = keras.layers.Concatenate(axis=3, name = 'Con5328', )([Zer91400,in0Con5328])
Ave28740 = keras.layers.Average(name = 'Ave28740', )([Zer9304,Con5328])
model = tf.keras.models.Model(inputs=[in0Sep47491,in0Add78208,in1Add78208,in0Con5328], outputs=Ave28740)
w = model.get_layer('Sep47491').get_weights() 
w[0] = np.array([[[[0.5832], [0.8464]]]])
w[1] = np.array([[[[0.8927, 0.5977], [0.2307, 0.4553]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep47491').set_weights(w) 
in0Sep47491 = tf.constant([[[[0.7177, 0.0108]]]])
in0Add78208 = tf.constant([[[0.8846, 0.1388], [0.7744, 0.172]]])
in1Add78208 = tf.constant([[[0.7558, 0.6658], [0.5488, 0.6606]]])
in0Con5328 = tf.constant([[[[0.4237], [0.7215], [0.5255], [0.787]], [[0.4834], [0.7874], [0.4464], [0.9438]], [[0.3179], [0.8799], [0.806], [0.2534]], [[0.8554], [0.8457], [0.3787], [0.8645]]]])
print (np.array2string(model.predict([in0Sep47491,in0Add78208,in1Add78208,in0Con5328],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave28740.png')

LSep47491 = separable_conv2D_layer([[[[0.7177, 0.0108]]]], 1, 1,[[[[[0.5832], [0.8464]]]],[[[[0.8927, 0.5977], [0.2307, 0.4553]]]]],[0, 0], 1, 1, true, Sep47491), 
LZer9304 = zero_padding2D_layer(Sep47491, 3, 0, 3, 0, Zer9304), 
LAdd78208 = add_layer([[[[0.8846, 0.1388], [0.7744, 0.172]]], [[[0.7558, 0.6658], [0.5488, 0.6606]]]], Add78208), 
LRes20740 = reshape_layer(Add78208, [2, 2, 1], Res20740), 
LZer91400 = zero_padding2D_layer(Res20740, 1, 1, 1, 1, Zer91400), 
LCon5328 = concatenate_layer([Zer91400,[[[[0.4237], [0.7215], [0.5255], [0.787]], [[0.4834], [0.7874], [0.4464], [0.9438]], [[0.3179], [0.8799], [0.806], [0.2534]], [[0.8554], [0.8457], [0.3787], [0.8645]]]]], 3, Con5328), 
LAve28740 = average_layer([Zer9304,Con5328], Ave28740), 
exec_layers([LSep47491,LZer9304,LAdd78208,LRes20740,LZer91400,LCon5328,LAve28740],["Sep47491","Zer9304","Add78208","Res20740","Zer91400","Con5328","Ave28740"],Ave28740,"Ave28740")

Actual (Unparsed): [[[[0.0000000, 0.2118500], [0.0000000, 0.3607500], [0.0000000, 0.2627500], [0.0000000, 0.3935000]], [[0.0000000, 0.2417000], [0.8202000, 0.3937000], [0.4023000, 0.2232000], [0.0000000, 0.4719000]], [[0.0000000, 0.1589500], [0.6616000, 0.4399500], [0.4163000, 0.4030000], [0.0000000, 0.1267000]], [[0.0000000, 0.4277000], [0.0000000, 0.4228500], [0.0000000, 0.1893500], [0.1878799, 0.5594184]]]]

Expected (Unparsed): [[[[0,0.21185],[0,0.36075],[0,0.26275],[0,0.3935]],[[0,0.2417],[0.8202,0.3937],[0.4023,0.2232],[0,0.4719]],[[0,0.15895],[0.6616,0.43995],[0.4163,0.403],[0,0.1267]],[[0,0.4277],[0,0.42285],[0,0.18935],[0.18787986255600003,0.559418420932]]]]

Actual:   [[[[0, 0.2119], [0, 0.3608], [0, 0.2628], [0, 0.3935]], [[0, 0.2417], [0.8202, 0.3937], [0.4023, 0.2232], [0, 0.4719]], [[0, 0.159], [0.6616, 0.44], [0.4163, 0.403], [0, 0.1267]], [[0, 0.4277], [0, 0.4229], [0, 0.1894], [0.1879, 0.5595]]]]

Expected: [[[[0, 0.2119], [0, 0.3608], [0, 0.2628], [0, 0.3935]], [[0, 0.2417], [0.8202, 0.3937], [0.4023, 0.2232], [0, 0.4719]], [[0, 0.159], [0.6616, 0.44], [0.4163, 0.403], [0, 0.1267]], [[0, 0.4277], [0, 0.4229], [0, 0.1894], [0.1879, 0.5595]]]]