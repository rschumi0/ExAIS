import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo9875 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con67389 = tf.keras.layers.Input(shape=([3, 3]))
in0Zer80904 = tf.keras.layers.Input(shape=([1, 4]))
in0Dot49745 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot49745 = tf.keras.layers.Input(shape=([3, 3]))
in0Con78846 = tf.keras.layers.Input(shape=([3, 1]))

Glo9875 = keras.layers.GlobalAveragePooling2D(name = 'Glo9875', )(in0Glo9875)
Lay51869 = keras.layers.LayerNormalization(axis=1, epsilon=2.139206104241294, name = 'Lay51869', )(Glo9875)
Res94674 = keras.layers.Reshape((2, 1), name = 'Res94674', )(Lay51869)
Zer88502 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer88502', )(Res94674)
Con67389 = keras.layers.Concatenate(axis=2, name = 'Con67389', )([Zer88502,in0Con67389])
Zer80904 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer80904', )(in0Zer80904)
Res86431 = keras.layers.Reshape((3, 4, 1), name = 'Res86431', )(Zer80904)
Loc28886 = keras.layers.LocallyConnected2D(2, (1, 3),strides=(1, 1), name = 'Loc28886', )(Res86431)
Res10635 = keras.layers.Reshape((3, 4), name = 'Res10635', )(Loc28886)
Dot49745 = keras.layers.Dot(axes=(1, 1), name = 'Dot49745', )([in0Dot49745,in1Dot49745])
Con78846 = keras.layers.Concatenate(axis=2, name = 'Con78846', )([Dot49745,in0Con78846])
Sub97153 = keras.layers.Subtract(name = 'Sub97153', )([Res10635,Con78846])
Mul50246 = keras.layers.Multiply(name = 'Mul50246', )([Con67389,Sub97153])
Res31264 = keras.layers.Reshape((3, 4, 1), name = 'Res31264', )(Mul50246)
Loc21549 = keras.layers.LocallyConnected2D(2, (3, 2),strides=(1, 1), name = 'Loc21549', )(Res31264)
model = tf.keras.models.Model(inputs=[in0Glo9875,in0Con67389,in0Zer80904,in0Dot49745,in1Dot49745,in0Con78846], outputs=Loc21549)
w = model.get_layer('Loc28886').get_weights() 
w[0] = np.array([[[0.6703, 0.6093], [0.0639, 0.4461], [0.8011, 0.2128]], [[0.0045, 0.3382], [0.0552, 0.1385], [0.1501, 0.328]], [[0.3639, 0.641], [0.6779, 0.3062], [0.1154, 0.7643]], [[0.5344, 0.3059], [0.9046, 0.5362], [0.8588, 0.9107]], [[0.7319, 0.2347], [0.1757, 0.5457], [0.1885, 0.3244]], [[0.1711, 0.4684], [0.5018, 0.9456], [0.4038, 0.8876]]])
w[1] = np.array([[[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0], [0, 0]]])
model.get_layer('Loc28886').set_weights(w) 
w = model.get_layer('Loc21549').get_weights() 
w[0] = np.array([[[0.8318, 0.725], [0.965, 0.5256], [0.2013, 0.5855], [0.7685, 0.643], [0.9891, 0.7523], [0.9649, 0.0439]], [[0.8605, 0.4739], [0.1772, 0.9767], [0.3598, 0.3222], [0.2892, 0.1723], [0.1392, 0.2829], [0.9757, 0.4047]], [[0.7108, 0.3167], [0.2576, 0.127], [0.2299, 0.765], [0.3697, 0.6893], [0.2285, 0.6503], [0.9673, 0.7644]]])
w[1] = np.array([[[0, 0], [0, 0], [0, 0]]])
model.get_layer('Loc21549').set_weights(w) 
in0Glo9875 = tf.constant([[[[1.4898, 1.1267], [1.416, 1.6476]], [[1.788, 1.4617], [1.9226, 1.6871]]]])
in0Con67389 = tf.constant([[[0.1265, 0.5005, 0.4477], [0.4578, 0.8337, 0.6658], [0.7288, 0.2068, 0.9416]]])
in0Zer80904 = tf.constant([[[1.7464, 1.8154, 1.1519, 1.61]]])
in0Dot49745 = tf.constant([[[0.351, 0.1338, 0.5331], [0.6604, 0.5344, 0.317], [0.3176, 0.8674, 0.3464]]])
in1Dot49745 = tf.constant([[[0.3579, 0.5451, 0.9701], [0.4861, 0.404, 0.915], [0.2934, 0.2558, 0.374]]])
in0Con78846 = tf.constant([[[0.7825], [0.138], [0.6686]]])
print (np.array2string(model.predict([in0Glo9875,in0Con67389,in0Zer80904,in0Dot49745,in1Dot49745,in0Con78846],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc21549.png')

LGlo9875 = global_average_pooling2D_layer([[[[1.4898, 1.1267], [1.416, 1.6476]], [[1.788, 1.4617], [1.9226, 1.6871]]]], Glo9875), 
LLay51869 = layer_normalization_layer(Glo9875, 1, 2.139206104241294, Lay51869), 
LRes94674 = reshape_layer(Lay51869, [2, 1], Res94674), 
LZer88502 = zero_padding1D_layer(Res94674, 1, 0, Zer88502), 
LCon67389 = concatenate_layer([Zer88502,[[[0.1265, 0.5005, 0.4477], [0.4578, 0.8337, 0.6658], [0.7288, 0.2068, 0.9416]]]], 2, Con67389), 
LZer80904 = zero_padding1D_layer([[[1.7464, 1.8154, 1.1519, 1.61]]], 1, 1, Zer80904), 
LRes86431 = reshape_layer(Zer80904, [3, 4, 1], Res86431), 
LLoc28886 = locally_connected2D_layer(Res86431, 1, 3,[[[0.6703, 0.6093], [0.0639, 0.4461], [0.8011, 0.2128]], [[0.0045, 0.3382], [0.0552, 0.1385], [0.1501, 0.328]], [[0.3639, 0.641], [0.6779, 0.3062], [0.1154, 0.7643]], [[0.5344, 0.3059], [0.9046, 0.5362], [0.8588, 0.9107]], [[0.7319, 0.2347], [0.1757, 0.5457], [0.1885, 0.3244]], [[0.1711, 0.4684], [0.5018, 0.9456], [0.4038, 0.8876]]],[[[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0], [0, 0]]], 1, 1, Loc28886), 
LRes10635 = reshape_layer(Loc28886, [3, 4], Res10635), 
LDot49745 = dot_layer([[[0.351, 0.1338, 0.5331], [0.6604, 0.5344, 0.317], [0.3176, 0.8674, 0.3464]]], [[[0.3579, 0.5451, 0.9701], [0.4861, 0.404, 0.915], [0.2934, 0.2558, 0.374]]], 1, 1, Dot49745), 
LCon78846 = concatenate_layer([Dot49745,[[[0.7825], [0.138], [0.6686]]]], 2, Con78846), 
LSub97153 = subtract_layer(Res10635,Con78846, Sub97153), 
LMul50246 = multiply_layer([Con67389,Sub97153], Mul50246), 
LRes31264 = reshape_layer(Mul50246, [3, 4, 1], Res31264), 
LLoc21549 = locally_connected2D_layer(Res31264, 3, 2,[[[0.8318, 0.725], [0.965, 0.5256], [0.2013, 0.5855], [0.7685, 0.643], [0.9891, 0.7523], [0.9649, 0.0439]], [[0.8605, 0.4739], [0.1772, 0.9767], [0.3598, 0.3222], [0.2892, 0.1723], [0.1392, 0.2829], [0.9757, 0.4047]], [[0.7108, 0.3167], [0.2576, 0.127], [0.2299, 0.765], [0.3697, 0.6893], [0.2285, 0.6503], [0.9673, 0.7644]]],[[[0, 0], [0, 0], [0, 0]]], 1, 1, Loc21549), 
exec_layers([LGlo9875,LLay51869,LRes94674,LZer88502,LCon67389,LZer80904,LRes86431,LLoc28886,LRes10635,LDot49745,LCon78846,LSub97153,LMul50246,LRes31264,LLoc21549],["Glo9875","Lay51869","Res94674","Zer88502","Con67389","Zer80904","Res86431","Loc28886","Res10635","Dot49745","Con78846","Sub97153","Mul50246","Res31264","Loc21549"],Loc21549,"Loc21549")

Actual (Unparsed): [[[[0.3401391, 0.6195189], [0.5344356, -0.0814137], [-0.0362786, 1.8912211]]]]

Expected (Unparsed): [[[[0.3401391351985702,0.61951885559538],[0.5344355458528373,-0.08141367376001589],[-0.03627856497483406,1.8912211451289]]]]

Actual:   [[[[0.3402, 0.6196], [0.5345, -0.0814], [-0.0362, 1.8913]]]]

Expected: [[[[0.3402, 0.6196], [0.5345, -0.0814], [-0.0362, 1.8913]]]]