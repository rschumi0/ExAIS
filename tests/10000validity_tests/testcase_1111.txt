import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave7406 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave7406 = tf.keras.layers.Input(shape=([2, 1]))
in0Ave31574 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Ave31574 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Mul5082 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Mul5082 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con98177 = tf.keras.layers.Input(shape=([1, 1]))
in0Mas7394 = tf.keras.layers.Input(shape=([1, 3]))

Ave7406 = keras.layers.Average(name = 'Ave7406', )([in0Ave7406,in1Ave7406])
Lay52797 = keras.layers.LayerNormalization(axis=1, epsilon=1.9867208899790239, name = 'Lay52797', )(Ave7406)
Max86246 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='valid', name = 'Max86246', )(Lay52797)
Res58331 = keras.layers.Reshape((2, 1, 1), name = 'Res58331', )(Max86246)
Res67192 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res67192', )(Res58331)
Zer46285 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer46285', )(Res67192)
Ave31574 = keras.layers.Average(name = 'Ave31574', )([in0Ave31574,in1Ave31574])
Zer33185 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (0, 0)), name = 'Zer33185', )(Ave31574)
Mul369 = keras.layers.Multiply(name = 'Mul369', )([Zer46285,Zer33185])
Res68927 = keras.layers.Reshape((2, 3, 1), name = 'Res68927', )(Mul369)
Res15132 = keras.layers.Reshape((2, 3), name = 'Res15132', )(Res68927)
Mul5082 = keras.layers.Multiply(name = 'Mul5082', )([in0Mul5082,in1Mul5082])
Res23238 = keras.layers.Reshape((1, 2), name = 'Res23238', )(Mul5082)
Con98177 = keras.layers.Concatenate(axis=2, name = 'Con98177', )([Res23238,in0Con98177])
Mas7394 = keras.layers.Masking(mask_value=2, name = 'Mas7394', )(in0Mas7394)
Max9286 = keras.layers.Maximum(name = 'Max9286', )([Con98177,Mas7394])
Zer16802 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer16802', )(Max9286)
Max77136 = keras.layers.Maximum(name = 'Max77136', )([Res15132,Zer16802])
model = tf.keras.models.Model(inputs=[in0Ave7406,in1Ave7406,in0Ave31574,in1Ave31574,in0Mul5082,in1Mul5082,in0Con98177,in0Mas7394], outputs=Max77136)
in0Ave7406 = tf.constant([[[0.4036], [0.3626]]])
in1Ave7406 = tf.constant([[[0.2506], [0.5089]]])
in0Ave31574 = tf.constant([[[[[0.8334]], [[0.6355]]]]])
in1Ave31574 = tf.constant([[[[[0.417]], [[0.9108]]]]])
in0Mul5082 = tf.constant([[[[0.2867], [0.9291]]]])
in1Mul5082 = tf.constant([[[[0.6282], [0.0187]]]])
in0Con98177 = tf.constant([[[0.0556]]])
in0Mas7394 = tf.constant([[[1.2938, 1.8059, 1.9423]]])
print (np.array2string(model.predict([in0Ave7406,in1Ave7406,in0Ave31574,in1Ave31574,in0Mul5082,in1Mul5082,in0Con98177,in0Mas7394],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max77136.png')

LAve7406 = average_layer([[[[0.4036], [0.3626]]], [[[0.2506], [0.5089]]]], Ave7406), 
LLay52797 = layer_normalization_layer(Ave7406, 1, 1.9867208899790239, Lay52797), 
LMax86246 = max_pool1D_layer(Lay52797, 1, 1, false, Max86246), 
LRes58331 = reshape_layer(Max86246, [2, 1, 1], Res58331), 
LRes67192 = reshape_layer(Res58331, [2, 1, 1, 1], Res67192), 
LZer46285 = zero_padding3D_layer(Res67192, 0, 0, 2, 0, 0, 0, Zer46285), 
LAve31574 = average_layer([[[[[[0.8334]], [[0.6355]]]]], [[[[[0.417]], [[0.9108]]]]]], Ave31574), 
LZer33185 = zero_padding3D_layer(Ave31574, 1, 0, 1, 0, 0, 0, Zer33185), 
LMul369 = multiply_layer([Zer46285,Zer33185], Mul369), 
LRes68927 = reshape_layer(Mul369, [2, 3, 1], Res68927), 
LRes15132 = reshape_layer(Res68927, [2, 3], Res15132), 
LMul5082 = multiply_layer([[[[[0.2867], [0.9291]]]], [[[[0.6282], [0.0187]]]]], Mul5082), 
LRes23238 = reshape_layer(Mul5082, [1, 2], Res23238), 
LCon98177 = concatenate_layer([Res23238,[[[0.0556]]]], 2, Con98177), 
LMas7394 = masking_layer([[[1.2938, 1.8059, 1.9423]]], 2, Mas7394), 
LMax9286 = maximum_layer([Con98177,Mas7394], Max9286), 
LZer16802 = zero_padding1D_layer(Max9286, 1, 0, Zer16802), 
LMax77136 = maximum_layer([Res15132,Zer16802], Max77136), 
exec_layers([LAve7406,LLay52797,LMax86246,LRes58331,LRes67192,LZer46285,LAve31574,LZer33185,LMul369,LRes68927,LRes15132,LMul5082,LRes23238,LCon98177,LMas7394,LMax9286,LZer16802,LMax77136],["Ave7406","Lay52797","Max86246","Res58331","Res67192","Zer46285","Ave31574","Zer33185","Mul369","Res68927","Res15132","Mul5082","Res23238","Con98177","Mas7394","Max9286","Zer16802","Max77136"],Max77136,"Max77136")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000], [1.2938000, 1.8059000, 1.9423000]]]

Expected (Unparsed): [[[0,0,-0.0],[1.2938,1.8059,1.9423]]]

Actual:   [[[0, 0, 0], [1.2938, 1.8059, 1.9423]]]

Expected: [[[0, 0, -0], [1.2938, 1.8059, 1.9423]]]