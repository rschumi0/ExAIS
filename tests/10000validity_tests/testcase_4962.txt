import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sep14381 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Cro72693 = tf.keras.layers.Input(shape=([4, 2, 1]))
in0Ave68973 = tf.keras.layers.Input(shape=([1, 1]))
in1Ave68973 = tf.keras.layers.Input(shape=([1, 1]))
in0Mul96749 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Mul96749 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Con66974 = tf.keras.layers.Input(shape=([1, 3]))

Sep14381 = keras.layers.SeparableConv2D(3, (2, 1),strides=(1, 1), padding='valid', name = 'Sep14381', )(in0Sep14381)
Ave5798 = keras.layers.AveragePooling2D(pool_size=(1, 1), name = 'Ave5798', )(Sep14381)
Res64258 = keras.layers.Reshape((1, 6), name = 'Res64258', )(Ave5798)
Cro72693 = keras.layers.Cropping2D(cropping=((2, 1), (1, 0)), name = 'Cro72693', )(in0Cro72693)
Loc10820 = keras.layers.LocallyConnected2D(3, (1, 1),strides=(1, 1), name = 'Loc10820', )(Cro72693)
Res79933 = keras.layers.Reshape((1, 3), name = 'Res79933', )(Loc10820)
Ave68973 = keras.layers.Average(name = 'Ave68973', )([in0Ave68973,in1Ave68973])
Res30147 = keras.layers.Reshape((1, 1, 1), name = 'Res30147', )(Ave68973)
Res10487 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res10487', )(Res30147)
Zer31275 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (1, 0)), name = 'Zer31275', )(Res10487)
Mul96749 = keras.layers.Multiply(name = 'Mul96749', )([in0Mul96749,in1Mul96749])
Min99750 = keras.layers.Minimum(name = 'Min99750', )([Zer31275,Mul96749])
Res40 = keras.layers.Reshape((1, 1, 2), name = 'Res40', )(Min99750)
Res38037 = keras.layers.Reshape((1, 2), name = 'Res38037', )(Res40)
Sep3267 = keras.layers.SeparableConv1D(3, (1),strides=(1), padding='valid', name = 'Sep3267', )(Res38037)
Sub52357 = keras.layers.Subtract(name = 'Sub52357', )([Res79933,Sep3267])
Con66974 = keras.layers.Concatenate(axis=2, name = 'Con66974', )([Sub52357,in0Con66974])
Ave6370 = keras.layers.Average(name = 'Ave6370', )([Res64258,Con66974])
model = tf.keras.models.Model(inputs=[in0Sep14381,in0Cro72693,in0Ave68973,in1Ave68973,in0Mul96749,in1Mul96749,in0Con66974], outputs=Ave6370)
w = model.get_layer('Sep14381').get_weights() 
w[0] = np.array([[[[0.5812], [0.5016]]], [[[0.1397], [0.9602]]]])
w[1] = np.array([[[[0.8454, 0.536, 0.1262], [0.8248, 0.7289, 0.2662]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep14381').set_weights(w) 
w = model.get_layer('Loc10820').get_weights() 
w[0] = np.array([[[0.995, 0.1243, 0.2439]]])
w[1] = np.array([[[0, 0, 0]]])
model.get_layer('Loc10820').set_weights(w) 
w = model.get_layer('Sep3267').get_weights() 
w[0] = np.array([[[0.1968], [0.8294]]])
w[1] = np.array([[[0.3831, 0.6766, 0.973], [0.1869, 0.3823, 0.7243]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep3267').set_weights(w) 
in0Sep14381 = tf.constant([[[[0.8764, 0.487], [0.2489, 0.8638]], [[0.1079, 0.7384], [0.68, 0.0197]]]])
in0Cro72693 = tf.constant([[[[1.1583], [1.6935]], [[1.622], [1.8894]], [[1.6521], [1.5561]], [[1.4453], [1.2317]]]])
in0Ave68973 = tf.constant([[[0.3814]]])
in1Ave68973 = tf.constant([[[0.4446]]])
in0Mul96749 = tf.constant([[[[[0.7329], [0.989]]]]])
in1Mul96749 = tf.constant([[[[[0.7136], [0.6208]]]]])
in0Con66974 = tf.constant([[[0.3451, 0.169, 0.2747]]])
print (np.array2string(model.predict([in0Sep14381,in0Cro72693,in0Ave68973,in1Ave68973,in0Mul96749,in1Mul96749,in0Con66974],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave6370.png')

LSep14381 = separable_conv2D_layer([[[[0.8764, 0.487], [0.2489, 0.8638]], [[0.1079, 0.7384], [0.68, 0.0197]]]], 2, 1,[[[[[0.5812], [0.5016]]], [[[0.1397], [0.9602]]]],[[[[0.8454, 0.536, 0.1262], [0.8248, 0.7289, 0.2662]]]]],[0, 0, 0], 1, 1, false, Sep14381), 
LAve5798 = average_pooling2D_layer(Sep14381, 1, 1, Ave5798), 
LRes64258 = reshape_layer(Ave5798, [1, 6], Res64258), 
LCro72693 = cropping2D_layer([[[[1.1583], [1.6935]], [[1.622], [1.8894]], [[1.6521], [1.5561]], [[1.4453], [1.2317]]]], 2, 1, 1, 0, Cro72693), 
LLoc10820 = locally_connected2D_layer(Cro72693, 1, 1,[[[0.995, 0.1243, 0.2439]]],[[[0, 0, 0]]], 1, 1, Loc10820), 
LRes79933 = reshape_layer(Loc10820, [1, 3], Res79933), 
LAve68973 = average_layer([[[[0.3814]]], [[[0.4446]]]], Ave68973), 
LRes30147 = reshape_layer(Ave68973, [1, 1, 1], Res30147), 
LRes10487 = reshape_layer(Res30147, [1, 1, 1, 1], Res10487), 
LZer31275 = zero_padding3D_layer(Res10487, 0, 0, 0, 0, 1, 0, Zer31275), 
LMul96749 = multiply_layer([[[[[[0.7329], [0.989]]]]], [[[[[0.7136], [0.6208]]]]]], Mul96749), 
LMin99750 = minimum_layer([Zer31275,Mul96749], Min99750), 
LRes40 = reshape_layer(Min99750, [1, 1, 2], Res40), 
LRes38037 = reshape_layer(Res40, [1, 2], Res38037), 
LSep3267 = separable_conv1D_layer(Res38037, 1,[[[[0.1968], [0.8294]]],[[[0.3831, 0.6766, 0.973], [0.1869, 0.3823, 0.7243]]]],[0, 0, 0], 1, false, Sep3267), 
LSub52357 = subtract_layer(Res79933,Sep3267, Sub52357), 
LCon66974 = concatenate_layer([Sub52357,[[[0.3451, 0.169, 0.2747]]]], 2, Con66974), 
LAve6370 = average_layer([Res64258,Con66974], Ave6370), 
exec_layers([LSep14381,LAve5798,LRes64258,LCro72693,LLoc10820,LRes79933,LAve68973,LRes30147,LRes10487,LZer31275,LMul96749,LMin99750,LRes40,LRes38037,LSep3267,LSub52357,LCon66974,LAve6370],["Sep14381","Ave5798","Res64258","Cro72693","Loc10820","Res79933","Ave68973","Res30147","Res10487","Zer31275","Mul96749","Min99750","Res40","Res38037","Sep3267","Sub52357","Con66974","Ave6370"],Ave6370,"Ave6370")

Actual (Unparsed): [[[1.3569660, 0.5192107, 0.2256897, 0.4603393, 0.3135316, 0.2126599]]]

Expected (Unparsed): [[[1.3569659912590002,0.519210733766,0.225689747659,0.46033934208400007,0.313531558629,0.21265989297]]]

Actual:   [[[1.357, 0.5193, 0.2257, 0.4604, 0.3136, 0.2127]]]

Expected: [[[1.357, 0.5193, 0.2257, 0.4604, 0.3136, 0.2127]]]