import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max50963 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Max50963 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in0Con1985 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Min85521 = tf.keras.layers.Input(shape=([1, 1]))
in1Min85521 = tf.keras.layers.Input(shape=([1, 1]))
in0Con72598 = tf.keras.layers.Input(shape=([2, 1]))
in0Con8649 = tf.keras.layers.Input(shape=([2, 2]))
in0Sep53194 = tf.keras.layers.Input(shape=([1, 1]))

Max50963 = keras.layers.Maximum(name = 'Max50963', )([in0Max50963,in1Max50963])
Res11459 = keras.layers.Reshape((1, 1, 2), name = 'Res11459', )(Max50963)
Res7005 = keras.layers.Reshape((1, 2), name = 'Res7005', )(Res11459)
LST80606 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST80606', )(Res7005)
Res77540 = keras.layers.Reshape((2, 1), name = 'Res77540', )(LST80606)
Con1985 = keras.layers.Conv2D(2, (2, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con1985', )(in0Con1985)
Res75053 = keras.layers.Reshape((2, 2), name = 'Res75053', )(Con1985)
Min85521 = keras.layers.Minimum(name = 'Min85521', )([in0Min85521,in1Min85521])
Zer13375 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer13375', )(Min85521)
Con72598 = keras.layers.Concatenate(axis=2, name = 'Con72598', )([Zer13375,in0Con72598])
Sub42189 = keras.layers.Subtract(name = 'Sub42189', )([Res75053,Con72598])
Con8649 = keras.layers.Concatenate(axis=2, name = 'Con8649', )([Sub42189,in0Con8649])
Sep53194 = keras.layers.SeparableConv1D(4, (1),strides=(1), padding='valid', name = 'Sep53194', )(in0Sep53194)
Zer49866 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer49866', )(Sep53194)
Add37660 = keras.layers.Add(name = 'Add37660', )([Con8649,Zer49866])
Dot15039 = keras.layers.Dot(axes=(1, 1), name = 'Dot15039', )([Res77540,Add37660])
model = tf.keras.models.Model(inputs=[in0Max50963,in1Max50963,in0Con1985,in0Min85521,in1Min85521,in0Con72598,in0Con8649,in0Sep53194], outputs=Dot15039)
w = model.get_layer('LST80606').get_weights() 
w[0] = np.array([[8, 5, 3, 2, 5, 1, 2, 4], [8, 8, 1, 4, 6, 6, 3, 5]])
w[1] = np.array([[1, 8, 10, 7, 10, 2, 4, 5], [1, 8, 10, 2, 8, 4, 7, 1]])
w[2] = np.array([2, 6, 8, 5, 9, 2, 4, 1])
model.get_layer('LST80606').set_weights(w) 
w = model.get_layer('Con1985').get_weights() 
w[0] = np.array([[[[0.9118, 0.3863]]], [[[0.368, 0.0513]]]])
w[1] = np.array([0, 0])
model.get_layer('Con1985').set_weights(w) 
w = model.get_layer('Sep53194').get_weights() 
w[0] = np.array([[[0.0496]]])
w[1] = np.array([[[0.72, 0.0208, 0.9169, 0.8712]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep53194').set_weights(w) 
in0Max50963 = tf.constant([[[[[0.0789, 0.1494]]]]])
in1Max50963 = tf.constant([[[[[0.1077, 0.1542]]]]])
in0Con1985 = tf.constant([[[[0.2547]], [[0.4087]]]])
in0Min85521 = tf.constant([[[0.4193]]])
in1Min85521 = tf.constant([[[0.3143]]])
in0Con72598 = tf.constant([[[0.8338], [0.4614]]])
in0Con8649 = tf.constant([[[0.692, 0.683], [0.8541, 0.5407]]])
in0Sep53194 = tf.constant([[[0.3931]]])
print (np.array2string(model.predict([in0Max50963,in1Max50963,in0Con1985,in0Min85521,in1Min85521,in0Con72598,in0Con8649,in0Sep53194],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot15039.png')

LMax50963 = maximum_layer([[[[[[0.0789, 0.1494]]]]], [[[[[0.1077, 0.1542]]]]]], Max50963), 
LRes11459 = reshape_layer(Max50963, [1, 1, 2], Res11459), 
LRes7005 = reshape_layer(Res11459, [1, 2], Res7005), 
LLST80606 = lstm_layer(Res7005,[[8, 5, 3, 2, 5, 1, 2, 4], [8, 8, 1, 4, 6, 6, 3, 5]],[[1, 8, 10, 7, 10, 2, 4, 5], [1, 8, 10, 2, 8, 4, 7, 1]],[2, 6, 8, 5, 9, 2, 4, 1], LST80606), 
LRes77540 = reshape_layer(LST80606, [2, 1], Res77540), 
LCon1985 = conv2D_layer([[[[0.2547]], [[0.4087]]]], 2, 1,[[[[0.9118, 0.3863]]], [[[0.368, 0.0513]]]],[0, 0], 1, 1, true, 1, 1, Con1985), 
LRes75053 = reshape_layer(Con1985, [2, 2], Res75053), 
LMin85521 = minimum_layer([[[[0.4193]]], [[[0.3143]]]], Min85521), 
LZer13375 = zero_padding1D_layer(Min85521, 1, 0, Zer13375), 
LCon72598 = concatenate_layer([Zer13375,[[[0.8338], [0.4614]]]], 2, Con72598), 
LSub42189 = subtract_layer(Res75053,Con72598, Sub42189), 
LCon8649 = concatenate_layer([Sub42189,[[[0.692, 0.683], [0.8541, 0.5407]]]], 2, Con8649), 
LSep53194 = separable_conv1D_layer([[[0.3931]]], 1,[[[[0.0496]]],[[[0.72, 0.0208, 0.9169, 0.8712]]]],[0, 0, 0, 0], 1, false, Sep53194), 
LZer49866 = zero_padding1D_layer(Sep53194, 1, 0, Zer49866), 
LAdd37660 = add_layer([Con8649,Zer49866], Add37660), 
LDot15039 = dot_layer(Res77540,Add37660, 1, 1, Dot15039), 
exec_layers([LMax50963,LRes11459,LRes7005,LLST80606,LRes77540,LCon1985,LRes75053,LMin85521,LZer13375,LCon72598,LSub42189,LCon8649,LSep53194,LZer49866,LAdd37660,LDot15039],["Max50963","Res11459","Res7005","LST80606","Res77540","Con1985","Res75053","Min85521","Zer13375","Con72598","Sub42189","Con8649","Sep53194","Zer49866","Add37660","Dot15039"],Dot15039,"Dot15039")

Actual (Unparsed): [[[0.3355922, -0.7414513, 1.1136776, 0.8920267]]]

Expected (Unparsed): [[[0.33559224600391163,-0.7414512447067336,1.1136776208388857,0.8920266665210348]]]

Actual:   [[[0.3356, -0.7414, 1.1137, 0.8921]]]

Expected: [[[0.3356, -0.7414, 1.1137, 0.8921]]]