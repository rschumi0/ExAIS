import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max7304 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Max7304 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Sep939 = tf.keras.layers.Input(shape=([2, 1]))
in0Add43102 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Add43102 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Add17087 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Add17087 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))

Max7304 = keras.layers.Maximum(name = 'Max7304', )([in0Max7304,in1Max7304])
Zer81952 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer81952', )(Max7304)
Sep939 = keras.layers.SeparableConv1D(4, (1),strides=(1), padding='valid', name = 'Sep939', )(in0Sep939)
Res72662 = keras.layers.Reshape((2, 4, 1), name = 'Res72662', )(Sep939)
Add43102 = keras.layers.Add(name = 'Add43102', )([in0Add43102,in1Add43102])
Zer72631 = keras.layers.ZeroPadding2D(padding=((0, 0), (3, 0)), name = 'Zer72631', )(Add43102)
Sub44497 = keras.layers.Subtract(name = 'Sub44497', )([Res72662,Zer72631])
Max63625 = keras.layers.Maximum(name = 'Max63625', )([Zer81952,Sub44497])
Res32140 = keras.layers.Reshape((2, 4), name = 'Res32140', )(Max63625)
Zer32372 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer32372', )(Res32140)
Add17087 = keras.layers.Add(name = 'Add17087', )([in0Add17087,in1Add17087])
Res88001 = keras.layers.Reshape((1, 2, 2), name = 'Res88001', )(Add17087)
Res51630 = keras.layers.Reshape((1, 4), name = 'Res51630', )(Res88001)
Zer43236 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer43236', )(Res51630)
Min93179 = keras.layers.Minimum(name = 'Min93179', )([Zer32372,Zer43236])
model = tf.keras.models.Model(inputs=[in0Max7304,in1Max7304,in0Sep939,in0Add43102,in1Add43102,in0Add17087,in1Add17087], outputs=Min93179)
w = model.get_layer('Sep939').get_weights() 
w[0] = np.array([[[0.1185]]])
w[1] = np.array([[[0.0364, 0.5636, 0.7883, 0.0767]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep939').set_weights(w) 
in0Max7304 = tf.constant([[[[0.8875], [0.1506]], [[0.2173], [0.7431]]]])
in1Max7304 = tf.constant([[[[0.164], [0.4789]], [[0.5144], [0.8895]]]])
in0Sep939 = tf.constant([[[0.1707], [0.6404]]])
in0Add43102 = tf.constant([[[[0.085]], [[0.7649]]]])
in1Add43102 = tf.constant([[[[0.3921]], [[0.7996]]]])
in0Add17087 = tf.constant([[[[[0.8097, 0.182]], [[0.0422, 0.0667]]]]])
in1Add17087 = tf.constant([[[[[0.6375, 0.2496]], [[0.6844, 0.2105]]]]])
print (np.array2string(model.predict([in0Max7304,in1Max7304,in0Sep939,in0Add43102,in1Add43102,in0Add17087,in1Add17087],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min93179.png')

LMax7304 = maximum_layer([[[[[0.8875], [0.1506]], [[0.2173], [0.7431]]]], [[[[0.164], [0.4789]], [[0.5144], [0.8895]]]]], Max7304), 
LZer81952 = zero_padding2D_layer(Max7304, 0, 0, 2, 0, Zer81952), 
LSep939 = separable_conv1D_layer([[[0.1707], [0.6404]]], 1,[[[[0.1185]]],[[[0.0364, 0.5636, 0.7883, 0.0767]]]],[0, 0, 0, 0], 1, false, Sep939), 
LRes72662 = reshape_layer(Sep939, [2, 4, 1], Res72662), 
LAdd43102 = add_layer([[[[[0.085]], [[0.7649]]]], [[[[0.3921]], [[0.7996]]]]], Add43102), 
LZer72631 = zero_padding2D_layer(Add43102, 0, 0, 3, 0, Zer72631), 
LSub44497 = subtract_layer(Res72662,Zer72631, Sub44497), 
LMax63625 = maximum_layer([Zer81952,Sub44497], Max63625), 
LRes32140 = reshape_layer(Max63625, [2, 4], Res32140), 
LZer32372 = zero_padding1D_layer(Res32140, 1, 0, Zer32372), 
LAdd17087 = add_layer([[[[[[0.8097, 0.182]], [[0.0422, 0.0667]]]]], [[[[[0.6375, 0.2496]], [[0.6844, 0.2105]]]]]], Add17087), 
LRes88001 = reshape_layer(Add17087, [1, 2, 2], Res88001), 
LRes51630 = reshape_layer(Res88001, [1, 4], Res51630), 
LZer43236 = zero_padding1D_layer(Res51630, 1, 1, Zer43236), 
LMin93179 = minimum_layer([Zer32372,Zer43236], Min93179), 
exec_layers([LMax7304,LZer81952,LSep939,LRes72662,LAdd43102,LZer72631,LSub44497,LMax63625,LRes32140,LZer32372,LAdd17087,LRes88001,LRes51630,LZer43236,LMin93179],["Max7304","Zer81952","Sep939","Res72662","Add43102","Zer72631","Sub44497","Max63625","Res32140","Zer32372","Add17087","Res88001","Res51630","Zer43236","Min93179"],Min93179,"Min93179")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0007363, 0.0114005, 0.7266000, 0.2772000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]]]

Expected (Unparsed): [[[0,0,0,0],[0.00073629738,0.01140047262,0.7266,0.2772],[0,0,0,0]]]

Actual:   [[[0, 0, 0, 0], [0.0008, 0.0115, 0.7266, 0.2772], [0, 0, 0, 0]]]

Expected: [[[0, 0, 0, 0], [0.0008, 0.0115, 0.7266, 0.2772], [0, 0, 0, 0]]]