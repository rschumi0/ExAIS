import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Lay31560 = tf.keras.layers.Input(shape=([4]))
in0Con30357 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Glo83293 = tf.keras.layers.Input(shape=([2, 1, 1]))

Lay31560 = keras.layers.LayerNormalization(axis=1, epsilon=1.6282721189971843, name = 'Lay31560', )(in0Lay31560)
Res19523 = keras.layers.Reshape((4, 1), name = 'Res19523', )(Lay31560)
Max86072 = keras.layers.MaxPool1D(pool_size=(2), name = 'Max86072', )(Res19523)
Up_38972 = keras.layers.UpSampling1D(size=(1), name = 'Up_38972', )(Max86072)
Res63903 = keras.layers.Reshape((2, 1, 1), name = 'Res63903', )(Up_38972)
Con30357 = keras.layers.Concatenate(axis=3, name = 'Con30357', )([Res63903,in0Con30357])
Glo83293 = keras.layers.GlobalMaxPool2D(name = 'Glo83293', )(in0Glo83293)
Res25300 = keras.layers.Reshape((1, 1), name = 'Res25300', )(Glo83293)
Res92617 = keras.layers.Reshape((1, 1, 1), name = 'Res92617', )(Res25300)
Loc15687 = keras.layers.LocallyConnected2D(2, (1, 1),strides=(1, 1), name = 'Loc15687', )(Res92617)
Zer90126 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer90126', )(Loc15687)
Ave62298 = keras.layers.Average(name = 'Ave62298', )([Con30357,Zer90126])
model = tf.keras.models.Model(inputs=[in0Lay31560,in0Con30357,in0Glo83293], outputs=Ave62298)
w = model.get_layer('Loc15687').get_weights() 
w[0] = np.array([[[0.7047, 0.1735]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc15687').set_weights(w) 
in0Lay31560 = tf.constant([[1.7408, 1.5634, 1.7859, 1.7886]])
in0Con30357 = tf.constant([[[[0.1812]], [[0.4976]]]])
in0Glo83293 = tf.constant([[[[1.3982]], [[1.7244]]]])
print (np.array2string(model.predict([in0Lay31560,in0Con30357,in0Glo83293],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave62298.png')

LLay31560 = layer_normalization_layer([[1.7408, 1.5634, 1.7859, 1.7886]], 1, 1.6282721189971843, Lay31560), 
LRes19523 = reshape_layer(Lay31560, [4, 1], Res19523), 
LMax86072 = max_pool1D_layer(Res19523, 2, Max86072), 
LUp_38972 = up_sampling1D_layer(Max86072, 1, Up_38972), 
LRes63903 = reshape_layer(Up_38972, [2, 1, 1], Res63903), 
LCon30357 = concatenate_layer([Res63903,[[[[0.1812]], [[0.4976]]]]], 3, Con30357), 
LGlo83293 = global_max_pool2D_layer([[[[1.3982]], [[1.7244]]]], Glo83293), 
LRes25300 = reshape_layer(Glo83293, [1, 1], Res25300), 
LRes92617 = reshape_layer(Res25300, [1, 1, 1], Res92617), 
LLoc15687 = locally_connected2D_layer(Res92617, 1, 1,[[[0.7047, 0.1735]]],[[[0, 0]]], 1, 1, Loc15687), 
LZer90126 = zero_padding2D_layer(Loc15687, 1, 0, 0, 0, Zer90126), 
LAve62298 = average_layer([Con30357,Zer90126], Ave62298), 
exec_layers([LLay31560,LRes19523,LMax86072,LUp_38972,LRes63903,LCon30357,LGlo83293,LRes25300,LRes92617,LLoc15687,LZer90126,LAve62298],["Lay31560","Res19523","Max86072","Up_38972","Res63903","Con30357","Glo83293","Res25300","Res92617","Loc15687","Zer90126","Ave62298"],Ave62298,"Ave62298")

Actual (Unparsed): [[[[0.0082561, 0.0906000]], [[0.6345295, 0.3983917]]]]

Expected (Unparsed): [[[[0.008256052801759322,0.0906]],[[0.6345295442301188,0.3983917]]]]

Actual:   [[[[0.0083, 0.0906]], [[0.6346, 0.3984]]]]

Expected: [[[[0.0083, 0.0906]], [[0.6346, 0.3984]]]]