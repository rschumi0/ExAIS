import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add72367 = tf.keras.layers.Input(shape=([2, 1]))
in1Add72367 = tf.keras.layers.Input(shape=([2, 1]))
in0Con72978 = tf.keras.layers.Input(shape=([2, 1]))
in0Add45818 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Add45818 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Con42870 = tf.keras.layers.Input(shape=([2, 1]))
in0Dot59548 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot59548 = tf.keras.layers.Input(shape=([3, 2]))

Add72367 = keras.layers.Add(name = 'Add72367', )([in0Add72367,in1Add72367])
Res84717 = keras.layers.Reshape((2, 1, 1), name = 'Res84717', )(Add72367)
Dep97680 = keras.layers.DepthwiseConv2D((2, 1),strides=(2, 2), padding='valid', name = 'Dep97680', )(Res84717)
Res64884 = keras.layers.Reshape((1, 1), name = 'Res64884', )(Dep97680)
Zer28144 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer28144', )(Res64884)
Con72978 = keras.layers.Concatenate(axis=2, name = 'Con72978', )([Zer28144,in0Con72978])
Add45818 = keras.layers.Add(name = 'Add45818', )([in0Add45818,in1Add45818])
Res24844 = keras.layers.Reshape((1, 2, 2), name = 'Res24844', )(Add45818)
Res72796 = keras.layers.Reshape((1, 4), name = 'Res72796', )(Res24844)
LST99532 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST99532', )(Res72796)
Res60194 = keras.layers.Reshape((3, 1), name = 'Res60194', )(LST99532)
PRe43241 = keras.layers.PReLU(name = 'PRe43241', )(Res60194)
Res60405 = keras.layers.Reshape((3, 1, 1), name = 'Res60405', )(PRe43241)
Dep61622 = keras.layers.DepthwiseConv2D((3, 1),strides=(3, 3), padding='valid', name = 'Dep61622', )(Res60405)
Res14880 = keras.layers.Reshape((1, 1), name = 'Res14880', )(Dep61622)
Zer18043 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer18043', )(Res14880)
Con42870 = keras.layers.Concatenate(axis=2, name = 'Con42870', )([Zer18043,in0Con42870])
Dot59548 = keras.layers.Dot(axes=(1, 1), name = 'Dot59548', )([in0Dot59548,in1Dot59548])
Min61460 = keras.layers.Minimum(name = 'Min61460', )([Con42870,Dot59548])
Ave87007 = keras.layers.Average(name = 'Ave87007', )([Con72978,Min61460])
model = tf.keras.models.Model(inputs=[in0Add72367,in1Add72367,in0Con72978,in0Add45818,in1Add45818,in0Con42870,in0Dot59548,in1Dot59548], outputs=Ave87007)
w = model.get_layer('Dep97680').get_weights() 
w[0] = np.array([[[[0.5073]]], [[[0.3621]]]])
w[1] = np.array([0])
model.get_layer('Dep97680').set_weights(w) 
w = model.get_layer('LST99532').get_weights() 
w[0] = np.array([[4, 8, 8, 6, 9, 10, 3, 1, 9, 8, 1, 6], [10, 3, 10, 6, 1, 6, 3, 6, 8, 10, 6, 10], [10, 9, 1, 8, 9, 10, 10, 9, 3, 5, 9, 7], [7, 1, 4, 1, 7, 2, 7, 4, 6, 9, 1, 4]])
w[1] = np.array([[3, 2, 10, 1, 5, 7, 2, 9, 1, 10, 1, 10], [10, 6, 6, 7, 8, 8, 1, 7, 1, 9, 2, 9], [9, 9, 10, 1, 2, 8, 5, 6, 1, 10, 5, 9]])
w[2] = np.array([4, 9, 4, 6, 8, 8, 7, 2, 2, 4, 7, 5])
model.get_layer('LST99532').set_weights(w) 
w = model.get_layer('PRe43241').get_weights() 
w[0] = np.array([[0.1424], [0.8195], [0.3571]])
model.get_layer('PRe43241').set_weights(w) 
w = model.get_layer('Dep61622').get_weights() 
w[0] = np.array([[[[0.0437]]], [[[0.4482]]], [[[0.9612]]]])
w[1] = np.array([0])
model.get_layer('Dep61622').set_weights(w) 
in0Add72367 = tf.constant([[[0.6388], [0.9701]]])
in1Add72367 = tf.constant([[[0.8505], [0.6212]]])
in0Con72978 = tf.constant([[[0.0637], [0.0488]]])
in0Add45818 = tf.constant([[[[[0.0411], [0.6467]], [[0.9743], [0.6345]]]]])
in1Add45818 = tf.constant([[[[[0.1662], [0.3572]], [[0.3984], [0.7429]]]]])
in0Con42870 = tf.constant([[[0.1617], [0.0304]]])
in0Dot59548 = tf.constant([[[0.6334, 0.9556], [0.4626, 0.5925], [0.4981, 0.5331]]])
in1Dot59548 = tf.constant([[[0.7111, 0.0134], [0.863, 0.5016], [0.8325, 0.1813]]])
print (np.array2string(model.predict([in0Add72367,in1Add72367,in0Con72978,in0Add45818,in1Add45818,in0Con42870,in0Dot59548,in1Dot59548],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave87007.png')

LAdd72367 = add_layer([[[[0.6388], [0.9701]]], [[[0.8505], [0.6212]]]], Add72367), 
LRes84717 = reshape_layer(Add72367, [2, 1, 1], Res84717), 
LDep97680 = depthwise_conv2D_layer(Res84717, 2, 1,[[[[0.5073]]], [[[0.3621]]]],[0], 2, 2, false, Dep97680), 
LRes64884 = reshape_layer(Dep97680, [1, 1], Res64884), 
LZer28144 = zero_padding1D_layer(Res64884, 1, 0, Zer28144), 
LCon72978 = concatenate_layer([Zer28144,[[[0.0637], [0.0488]]]], 2, Con72978), 
LAdd45818 = add_layer([[[[[[0.0411], [0.6467]], [[0.9743], [0.6345]]]]], [[[[[0.1662], [0.3572]], [[0.3984], [0.7429]]]]]], Add45818), 
LRes24844 = reshape_layer(Add45818, [1, 2, 2], Res24844), 
LRes72796 = reshape_layer(Res24844, [1, 4], Res72796), 
LLST99532 = lstm_layer(Res72796,[[4, 8, 8, 6, 9, 10, 3, 1, 9, 8, 1, 6], [10, 3, 10, 6, 1, 6, 3, 6, 8, 10, 6, 10], [10, 9, 1, 8, 9, 10, 10, 9, 3, 5, 9, 7], [7, 1, 4, 1, 7, 2, 7, 4, 6, 9, 1, 4]],[[3, 2, 10, 1, 5, 7, 2, 9, 1, 10, 1, 10], [10, 6, 6, 7, 8, 8, 1, 7, 1, 9, 2, 9], [9, 9, 10, 1, 2, 8, 5, 6, 1, 10, 5, 9]],[4, 9, 4, 6, 8, 8, 7, 2, 2, 4, 7, 5], LST99532), 
LRes60194 = reshape_layer(LST99532, [3, 1], Res60194), 
LPRe43241 = prelu_layer(Res60194, [[0.1424], [0.8195], [0.3571]], PRe43241), 
LRes60405 = reshape_layer(PRe43241, [3, 1, 1], Res60405), 
LDep61622 = depthwise_conv2D_layer(Res60405, 3, 1,[[[[0.0437]]], [[[0.4482]]], [[[0.9612]]]],[0], 3, 3, false, Dep61622), 
LRes14880 = reshape_layer(Dep61622, [1, 1], Res14880), 
LZer18043 = zero_padding1D_layer(Res14880, 1, 0, Zer18043), 
LCon42870 = concatenate_layer([Zer18043,[[[0.1617], [0.0304]]]], 2, Con42870), 
LDot59548 = dot_layer([[[0.6334, 0.9556], [0.4626, 0.5925], [0.4981, 0.5331]]], [[[0.7111, 0.0134], [0.863, 0.5016], [0.8325, 0.1813]]], 1, 1, Dot59548), 
LMin61460 = minimum_layer([Con42870,Dot59548], Min61460), 
LAve87007 = average_layer([Con72978,Min61460], Ave87007), 
exec_layers([LAdd72367,LRes84717,LDep97680,LRes64884,LZer28144,LCon72978,LAdd45818,LRes24844,LRes72796,LLST99532,LRes60194,LPRe43241,LRes60405,LDep61622,LRes14880,LZer18043,LCon42870,LDot59548,LMin61460,LAve87007],["Add72367","Res84717","Dep97680","Res64884","Zer28144","Con72978","Add45818","Res24844","Res72796","LST99532","Res60194","PRe43241","Res60405","Dep61622","Res14880","Zer18043","Con42870","Dot59548","Min61460","Ave87007"],Ave87007,"Ave87007")

Actual (Unparsed): [[[0.0000000, 0.1127000], [1.2192020, 0.0396000]]]

Expected (Unparsed): [[[0,0.11270000000000001],[1.2192020439776678,0.0396]]]

Actual:   [[[0, 0.1127], [1.2193, 0.0396]]]

Expected: [[[0, 0.1128], [1.2193, 0.0396]]]