import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0ReL46168 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

ReL46168 = keras.layers.ReLU(max_value=8.074144181277244, negative_slope=9.1698759184805, threshold=7.885452531415217, name = 'ReL46168', input_shape=(2, 2, 1, 2))(in0ReL46168)
Con49271 = keras.layers.Conv3D(4, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con49271', )(ReL46168)
Res16335 = keras.layers.Reshape((2, 2, 4), name = 'Res16335', )(Con49271)
Res95636 = keras.layers.Reshape((2, 8), name = 'Res95636', )(Res16335)
Ave62828 = keras.layers.AveragePooling1D(pool_size=(2), strides=(1), padding='same', name = 'Ave62828', )(Res95636)
model = tf.keras.models.Model(inputs=[in0ReL46168], outputs=Ave62828)
w = model.get_layer('Con49271').get_weights() 
w[0] = np.array([[[[[0.9239, 0.152, 0.3482, 0.4895], [0.2773, 0.2154, 0.8978, 0.3316]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con49271').set_weights(w) 
in0ReL46168 = tf.constant([[[[[0.2469, 0.9215]], [[0.8964, 0.1904]]], [[[0.6138, 0.2663]], [[0.0939, 0.3705]]]]])
print (np.array2string(model.predict([in0ReL46168],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave62828.png')

LReL46168 = relu_layer([[[[[0.2469, 0.9215]], [[0.8964, 0.1904]]], [[[0.6138, 0.2663]], [[0.0939, 0.3705]]]]], 8.074144181277244, 9.1698759184805, 7.885452531415217, ReL46168), 
LCon49271 = conv3D_layer(ReL46168, 1, 1, 1,[[[[[0.9239, 0.152, 0.3482, 0.4895], [0.2773, 0.2154, 0.8978, 0.3316]]]]],[0, 0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con49271), 
LRes16335 = reshape_layer(Con49271, [2, 2, 4], Res16335), 
LRes95636 = reshape_layer(Res16335, [2, 8], Res95636), 
LAve62828 = average_pooling1D_layer(Res95636, 2, 1, true, Ave62828), 
exec_layers([LReL46168,LCon49271,LRes16335,LRes95636,LAve62828],["ReL46168","Con49271","Res16335","Res95636","Ave62828"],Ave62828,"Ave62828")

Actual (Unparsed): [[[-81.7009970, -24.7932904, -83.8330465, -55.6350265, -81.9490511, -25.3220945, -86.2066877, -56.2972788], [-80.9798233, -25.1846666, -85.9443371, -55.8077264, -85.1194807, -25.7034993, -86.7465033, -57.8245335]]]

Expected (Unparsed): [[[-81.70099702720661,-24.793290431750215,-83.83304653232724,-55.635026511979746,-81.94905101973177,-25.32209452637547,-86.20668771207156,-56.29727880216029],[-80.97982319496869,-25.18466660467155,-85.94433701185127,-55.80772631555472,-85.11948069098966,-25.70349928452429,-86.746503268796,-57.824533511372536]]]

Actual:   [[[-81.7009, -24.7932, -83.833, -55.635, -81.949, -25.322, -86.2066, -56.2972], [-80.9798, -25.1846, -85.9443, -55.8077, -85.1194, -25.7034, -86.7465, -57.8245]]]

Expected: [[[-81.7009, -24.7932, -83.833, -55.635, -81.949, -25.322, -86.2066, -56.2972], [-80.9798, -25.1846, -85.9443, -55.8077, -85.1194, -25.7034, -86.7465, -57.8245]]]