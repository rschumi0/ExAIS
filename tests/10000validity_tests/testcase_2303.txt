import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave72938 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Ave72938 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Con23495 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Con43491 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))

Ave72938 = keras.layers.Average(name = 'Ave72938', )([in0Ave72938,in1Ave72938])
Zer37664 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (1, 0)), name = 'Zer37664', )(Ave72938)
Con23495 = keras.layers.Concatenate(axis=4, name = 'Con23495', )([Zer37664,in0Con23495])
Con43491 = keras.layers.Conv3D(2, (2, 2, 2),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con43491', )(in0Con43491)
Max35285 = keras.layers.Maximum(name = 'Max35285', )([Con23495,Con43491])
Res79289 = keras.layers.Reshape((2, 2, 4), name = 'Res79289', )(Max35285)
PRe81576 = keras.layers.PReLU(name = 'PRe81576', )(Res79289)
model = tf.keras.models.Model(inputs=[in0Ave72938,in1Ave72938,in0Con23495,in0Con43491], outputs=PRe81576)
w = model.get_layer('Con43491').get_weights() 
w[0] = np.array([[[[[0.1578, 0.035], [0.5246, 0.1795]], [[0.2254, 0.3423], [0.1874, 0.0192]]], [[[0.7628, 0.6247], [0.7037, 0.5746]], [[0.5969, 0.7307], [0.9728, 0.3117]]]], [[[[0.9679, 0.3165], [0.7835, 0.6962]], [[0.6962, 0.8964], [0.3071, 0.8719]]], [[[0.4115, 0.3598], [0.0104, 0.6489]], [[0.8191, 0.554], [0.249, 0.0252]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con43491').set_weights(w) 
w = model.get_layer('PRe81576').get_weights() 
w[0] = np.array([[[0.4866, 0.3052, 0.757, 0.2086], [0.8175, 0.6293, 0.1988, 0.8354]], [[0.3586, 0.5615, 0.1328, 0.6027], [0.8663, 0.7121, 0.7272, 0.5875]]])
model.get_layer('PRe81576').set_weights(w) 
in0Ave72938 = tf.constant([[[[[0.1959]]], [[[0.5338]]]]])
in1Ave72938 = tf.constant([[[[[0.5872]]], [[[0.1965]]]]])
in0Con23495 = tf.constant([[[[[0.6147], [0.6957]], [[0.7626], [0.14]]], [[[0.2933], [0.4573]], [[0.4362], [0.5777]]]]])
in0Con43491 = tf.constant([[[[[0.2041, 0.6148], [0.9141, 0.7736]], [[0.5236, 0.0734], [0.5436, 0.1465]]], [[[0.6509, 0.0761], [0.1506, 0.0374]], [[0.3665, 0.3038], [0.3329, 0.3396]]]]])
print (np.array2string(model.predict([in0Ave72938,in1Ave72938,in0Con23495,in0Con43491],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='PRe81576.png')

LAve72938 = average_layer([[[[[[0.1959]]], [[[0.5338]]]]], [[[[[0.5872]]], [[[0.1965]]]]]], Ave72938), 
LZer37664 = zero_padding3D_layer(Ave72938, 0, 0, 1, 0, 1, 0, Zer37664), 
LCon23495 = concatenate_layer([Zer37664,[[[[[0.6147], [0.6957]], [[0.7626], [0.14]]], [[[0.2933], [0.4573]], [[0.4362], [0.5777]]]]]], 4, Con23495), 
LCon43491 = conv3D_layer([[[[[0.2041, 0.6148], [0.9141, 0.7736]], [[0.5236, 0.0734], [0.5436, 0.1465]]], [[[0.6509, 0.0761], [0.1506, 0.0374]], [[0.3665, 0.3038], [0.3329, 0.3396]]]]], 2, 2, 2,[[[[[0.1578, 0.035], [0.5246, 0.1795]], [[0.2254, 0.3423], [0.1874, 0.0192]]], [[[0.7628, 0.6247], [0.7037, 0.5746]], [[0.5969, 0.7307], [0.9728, 0.3117]]]], [[[[0.9679, 0.3165], [0.7835, 0.6962]], [[0.6962, 0.8964], [0.3071, 0.8719]]], [[[0.4115, 0.3598], [0.0104, 0.6489]], [[0.8191, 0.554], [0.249, 0.0252]]]]],[0, 0], 1, 1, 1, true, 1, 1, 1, Con43491), 
LMax35285 = maximum_layer([Con23495,Con43491], Max35285), 
LRes79289 = reshape_layer(Max35285, [2, 2, 4], Res79289), 
LPRe81576 = prelu_layer(Res79289, [[[0.4866, 0.3052, 0.757, 0.2086], [0.8175, 0.6293, 0.1988, 0.8354]], [[0.3586, 0.5615, 0.1328, 0.6027], [0.8663, 0.7121, 0.7272, 0.5875]]], PRe81576), 
exec_layers([LAve72938,LZer37664,LCon23495,LCon43491,LMax35285,LRes79289,LPRe81576],["Ave72938","Zer37664","Con23495","Con43491","Max35285","Res79289","PRe81576"],PRe81576,"PRe81576")

Actual (Unparsed): [[[[2.9409623, 2.2059754, 1.3834145, 1.0084672], [1.1999300, 1.1424000, 0.7509245, 0.3871151]], [[1.2060092, 0.8413293, 0.5362973, 0.4573000], [0.3558839, 0.4362000, 0.3651500, 0.5777000]]]]

Expected (Unparsed): [[[[2.94096232,2.2059753900000003,1.3834144999999998,1.0084671600000001],[1.1999300499999999,1.14239999,0.75092449,0.38711512000000003]],[[1.2060092299999998,0.8413292899999999,0.53629736,0.4573],[0.35588388000000004,0.4362,0.36515000000000003,0.5777]]]]

Actual:   [[[[2.941, 2.206, 1.3835, 1.0085], [1.2, 1.1424, 0.751, 0.3872]], [[1.2061, 0.8414, 0.5363, 0.4573], [0.3559, 0.4362, 0.3652, 0.5777]]]]

Expected: [[[[2.941, 2.206, 1.3835, 1.0085], [1.2, 1.1424, 0.751, 0.3872]], [[1.2061, 0.8414, 0.5363, 0.4573], [0.3559, 0.4362, 0.3652, 0.5777]]]]