import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con41986 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Ave82227 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Ave82227 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Con35965 = tf.keras.layers.Input(shape=([4, 2]))
in0Up_96292 = tf.keras.layers.Input(shape=([1, 3]))
in0Con88946 = tf.keras.layers.Input(shape=([4, 5]))

Con41986 = keras.layers.Conv3D(4, (1, 1, 2),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con41986', )(in0Con41986)
Res31078 = keras.layers.Reshape((1, 2, 4), name = 'Res31078', )(Con41986)
Res16818 = keras.layers.Reshape((1, 8), name = 'Res16818', )(Res31078)
Zer41672 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer41672', )(Res16818)
Ave82227 = keras.layers.Average(name = 'Ave82227', )([in0Ave82227,in1Ave82227])
Res77581 = keras.layers.Reshape((2, 1, 1), name = 'Res77581', )(Ave82227)
Res45347 = keras.layers.Reshape((2, 1), name = 'Res45347', )(Res77581)
Zer25417 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer25417', )(Res45347)
Con35965 = keras.layers.Concatenate(axis=2, name = 'Con35965', )([Zer25417,in0Con35965])
Up_96292 = keras.layers.UpSampling1D(size=(2), name = 'Up_96292', )(in0Up_96292)
Up_70598 = keras.layers.UpSampling1D(size=(2), name = 'Up_70598', )(Up_96292)
Ave54326 = keras.layers.Average(name = 'Ave54326', )([Con35965,Up_70598])
Con88946 = keras.layers.Concatenate(axis=2, name = 'Con88946', )([Ave54326,in0Con88946])
Sub99826 = keras.layers.Subtract(name = 'Sub99826', )([Zer41672,Con88946])
model = tf.keras.models.Model(inputs=[in0Con41986,in0Ave82227,in1Ave82227,in0Con35965,in0Up_96292,in0Con88946], outputs=Sub99826)
w = model.get_layer('Con41986').get_weights() 
w[0] = np.array([[[[[0.4533, 0.6039, 0.864, 0.4291]], [[0.2273, 0.9396, 0.474, 0.7701]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con41986').set_weights(w) 
in0Con41986 = tf.constant([[[[[0.0802], [0.3858]], [[0.5469], [0.4576]]]]])
in0Ave82227 = tf.constant([[[[[0.6582]]], [[[0.8265]]]]])
in1Ave82227 = tf.constant([[[[[0.888]]], [[[0.9139]]]]])
in0Con35965 = tf.constant([[[0.9402, 0.7623], [0.3468, 0.3635], [0.8707, 0.5263], [0.7118, 0.8619]]])
in0Up_96292 = tf.constant([[[1.3559, 1.353, 1.3348]]])
in0Con88946 = tf.constant([[[0.0641, 0.5561, 0.4216, 0.1005, 0.573], [0.7849, 0.1038, 0.9736, 0.6834, 0.0809], [0.1823, 0.0941, 0.8198, 0.7403, 0.8189], [0.2349, 0.7567, 0.1781, 0.0881, 0.5009]]])
print (np.array2string(model.predict([in0Con41986,in0Ave82227,in1Ave82227,in0Con35965,in0Up_96292,in0Con88946],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub99826.png')

LCon41986 = conv3D_layer([[[[[0.0802], [0.3858]], [[0.5469], [0.4576]]]]], 1, 1, 2,[[[[[0.4533, 0.6039, 0.864, 0.4291]], [[0.2273, 0.9396, 0.474, 0.7701]]]]],[0, 0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con41986), 
LRes31078 = reshape_layer(Con41986, [1, 2, 4], Res31078), 
LRes16818 = reshape_layer(Res31078, [1, 8], Res16818), 
LZer41672 = zero_padding1D_layer(Res16818, 3, 0, Zer41672), 
LAve82227 = average_layer([[[[[[0.6582]]], [[[0.8265]]]]], [[[[[0.888]]], [[[0.9139]]]]]], Ave82227), 
LRes77581 = reshape_layer(Ave82227, [2, 1, 1], Res77581), 
LRes45347 = reshape_layer(Res77581, [2, 1], Res45347), 
LZer25417 = zero_padding1D_layer(Res45347, 2, 0, Zer25417), 
LCon35965 = concatenate_layer([Zer25417,[[[0.9402, 0.7623], [0.3468, 0.3635], [0.8707, 0.5263], [0.7118, 0.8619]]]], 2, Con35965), 
LUp_96292 = up_sampling1D_layer([[[1.3559, 1.353, 1.3348]]], 2, Up_96292), 
LUp_70598 = up_sampling1D_layer(Up_96292, 2, Up_70598), 
LAve54326 = average_layer([Con35965,Up_70598], Ave54326), 
LCon88946 = concatenate_layer([Ave54326,[[[0.0641, 0.5561, 0.4216, 0.1005, 0.573], [0.7849, 0.1038, 0.9736, 0.6834, 0.0809], [0.1823, 0.0941, 0.8198, 0.7403, 0.8189], [0.2349, 0.7567, 0.1781, 0.0881, 0.5009]]]], 2, Con88946), 
LSub99826 = subtract_layer(Zer41672,Con88946, Sub99826), 
exec_layers([LCon41986,LRes31078,LRes16818,LZer41672,LAve82227,LRes77581,LRes45347,LZer25417,LCon35965,LUp_96292,LUp_70598,LAve54326,LCon88946,LSub99826],["Con41986","Res31078","Res16818","Zer41672","Ave82227","Res77581","Res45347","Zer25417","Con35965","Up_96292","Up_70598","Ave54326","Con88946","Sub99826"],Sub99826,"Sub99826")

Actual (Unparsed): [[[-0.6779500, -1.1466000, -1.0485500, -0.0641000, -0.5561000, -0.4216000, -0.1005000, -0.5730000], [-0.6779500, -0.8499000, -0.8491500, -0.7849000, -0.1038000, -0.9736000, -0.6834000, -0.0809000], [-1.0645000, -1.1118500, -0.9305500, -0.1823000, -0.0941000, -0.8198000, -0.7403000, -0.8189000], [-0.9890030, -0.6214695, -0.8461880, 0.0966184, -0.4047777, 0.5821338, 0.6013240, 0.0861726]]]

Expected (Unparsed): [[[-0.67795,-1.1466,-1.04855,-0.0641,-0.5561,-0.4216,-0.1005,-0.573],[-0.67795,-0.8499,-0.84915,-0.7849,-0.1038,-0.9736,-0.6834,-0.0809],[-1.0645,-1.11185,-0.93055,-0.1823,-0.0941,-0.8198,-0.7403,-0.8189],[-0.9890030000000001,-0.62146954,-0.8461879999999999,0.0966184,-0.40477775000000005,0.5821338699999999,0.6013240000000001,0.08617255000000001]]]

Actual:   [[[-0.6779, -1.1466, -1.0485, -0.0641, -0.5561, -0.4216, -0.1005, -0.573], [-0.6779, -0.8499, -0.8491, -0.7849, -0.1038, -0.9736, -0.6834, -0.0809], [-1.0645, -1.1118, -0.9305, -0.1823, -0.0941, -0.8198, -0.7403, -0.8189], [-0.989, -0.6214, -0.8461, 0.0967, -0.4047, 0.5822, 0.6014, 0.0862]]]

Expected: [[[-0.6779, -1.1466, -1.0485, -0.0641, -0.5561, -0.4216, -0.1005, -0.573], [-0.6779, -0.8499, -0.8491, -0.7849, -0.1038, -0.9736, -0.6834, -0.0809], [-1.0645, -1.1118, -0.9305, -0.1823, -0.0941, -0.8198, -0.7403, -0.8189], [-0.989, -0.6214, -0.8461, 0.0967, -0.4047, 0.5822, 0.6014, 0.0862]]]