import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave45248 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Ave45248 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))

Ave45248 = keras.layers.Average(name = 'Ave45248', )([in0Ave45248,in1Ave45248])
Res48672 = keras.layers.Reshape((1, 2, 4), name = 'Res48672', )(Ave45248)
Glo38597 = keras.layers.GlobalMaxPool2D(name = 'Glo38597', )(Res48672)
Res9480 = keras.layers.Reshape((4, 1), name = 'Res9480', )(Glo38597)
Loc22991 = keras.layers.LocallyConnected1D(3, (1),strides=(1), name = 'Loc22991', )(Res9480)
model = tf.keras.models.Model(inputs=[in0Ave45248,in1Ave45248], outputs=Loc22991)
w = model.get_layer('Loc22991').get_weights() 
w[0] = np.array([[[0.79, 0.3126, 0.146]], [[0.232, 0.1068, 0.8335]], [[0.1265, 0.5414, 0.7737]], [[0.1106, 0.8549, 0.452]]])
w[1] = np.array([[0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]])
model.get_layer('Loc22991').set_weights(w) 
in0Ave45248 = tf.constant([[[[[0.4012, 0.1819], [0.0319, 0.4911]], [[0.4163, 0.7211], [0.6549, 0.9922]]]]])
in1Ave45248 = tf.constant([[[[[0.5816, 0.6731], [0.8906, 0.9856]], [[0.1811, 0.2283], [0.2864, 0.3585]]]]])
print (np.array2string(model.predict([in0Ave45248,in1Ave45248],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc22991.png')

LAve45248 = average_layer([[[[[[0.4012, 0.1819], [0.0319, 0.4911]], [[0.4163, 0.7211], [0.6549, 0.9922]]]]], [[[[[0.5816, 0.6731], [0.8906, 0.9856]], [[0.1811, 0.2283], [0.2864, 0.3585]]]]]], Ave45248), 
LRes48672 = reshape_layer(Ave45248, [1, 2, 4], Res48672), 
LGlo38597 = global_max_pool2D_layer(Res48672, Glo38597), 
LRes9480 = reshape_layer(Glo38597, [4, 1], Res9480), 
LLoc22991 = locally_connected1D_layer(Res9480, 1,[[[0.79, 0.3126, 0.146]], [[0.232, 0.1068, 0.8335]], [[0.1265, 0.5414, 0.7737]], [[0.1106, 0.8549, 0.452]]],[[0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]], 1, Loc22991), 
exec_layers([LAve45248,LRes48672,LGlo38597,LRes9480,LLoc22991],["Ave45248","Res48672","Glo38597","Res9480","Loc22991"],Loc22991,"Loc22991")

Actual (Unparsed): [[[0.3882060, 0.1536116, 0.0717444], [0.1101304, 0.0506980, 0.3956624], [0.0595372, 0.2548099, 0.3641419], [0.0816615, 0.6312154, 0.3337342]]]

Expected (Unparsed): [[[0.388206,0.15361164,0.0717444],[0.1101304,0.05069796000000001,0.39566245],[0.059537225,0.25480991000000003,0.36414190500000004],[0.08166151,0.631215415,0.33373420000000004]]]

Actual:   [[[0.3883, 0.1537, 0.0718], [0.1102, 0.0507, 0.3957], [0.0596, 0.2549, 0.3642], [0.0817, 0.6313, 0.3338]]]

Expected: [[[0.3883, 0.1537, 0.0718], [0.1102, 0.0507, 0.3957], [0.0596, 0.2549, 0.3642], [0.0817, 0.6313, 0.3338]]]