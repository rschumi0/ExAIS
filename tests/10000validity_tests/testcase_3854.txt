import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul99584 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Mul99584 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Con66409 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Cro36174 = tf.keras.layers.Input(shape=([4, 4, 4]))

Mul99584 = keras.layers.Multiply(name = 'Mul99584', )([in0Mul99584,in1Mul99584])
Res21352 = keras.layers.Reshape((2, 1, 2), name = 'Res21352', )(Mul99584)
Con66409 = keras.layers.Concatenate(axis=3, name = 'Con66409', )([Res21352,in0Con66409])
Cro36174 = keras.layers.Cropping2D(cropping=((3, 0), (3, 0)), name = 'Cro36174', )(in0Cro36174)
Zer64165 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer64165', )(Cro36174)
Max63188 = keras.layers.Maximum(name = 'Max63188', )([Con66409,Zer64165])
Sep29903 = keras.layers.SeparableConv2D(3, (2, 1),strides=(1, 1), padding='valid', name = 'Sep29903', )(Max63188)
Fla65560 = keras.layers.Flatten(name = 'Fla65560', )(Sep29903)
Res54082 = keras.layers.Reshape((3, 1), name = 'Res54082', )(Fla65560)
Res80227 = keras.layers.Reshape((3, 1, 1), name = 'Res80227', )(Res54082)
Max66640 = keras.layers.MaxPool2D(pool_size=(3, 1), name = 'Max66640', )(Res80227)
model = tf.keras.models.Model(inputs=[in0Mul99584,in1Mul99584,in0Con66409,in0Cro36174], outputs=Max66640)
w = model.get_layer('Sep29903').get_weights() 
w[0] = np.array([[[[0.6323], [0.6453], [0.5296], [0.2493]]], [[[0.1082], [0.0975], [0.6154], [0.0461]]]])
w[1] = np.array([[[[0.0041, 0.2245, 0.8287], [0.976, 0.2439, 0.717], [0.8083, 0.2848, 0.1591], [0.9805, 0.6149, 0.3638]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep29903').set_weights(w) 
in0Mul99584 = tf.constant([[[[[0.7638], [0.9047]]], [[[0.079], [0.8124]]]]])
in1Mul99584 = tf.constant([[[[[0.0599], [0.3649]]], [[[0.079], [0.4228]]]]])
in0Con66409 = tf.constant([[[[0.1673, 0.9278]], [[0.9516, 0.6864]]]])
in0Cro36174 = tf.constant([[[[1.3985, 1.8754, 1.301, 1.8643], [1.4007, 1.1591, 1.058, 1.9442], [1.3121, 1.1194, 1.3352, 1.4037], [1.6372, 1.6068, 1.7596, 1.7394]], [[1.066, 1.5064, 1.1407, 1.7844], [1.8536, 1.0438, 1.0468, 1.2406], [1.1806, 1.3639, 1.8919, 1.7748], [1.9219, 1.3771, 1.0465, 1.9994]], [[1.6833, 1.585, 1.5584, 1.6382], [1.9252, 1.1006, 1.1716, 1.4497], [1.4872, 1.3588, 1.4642, 1.0246], [1.8519, 1.077, 1.0936, 1.4051]], [[1.0413, 1.8709, 1.3309, 1.5829], [1.1257, 1.5559, 1.2954, 1.3258], [1.9448, 1.5711, 1.5594, 1.4538], [1.7885, 1.1531, 1.082, 1.6408]]]])
print (np.array2string(model.predict([in0Mul99584,in1Mul99584,in0Con66409,in0Cro36174],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max66640.png')

LMul99584 = multiply_layer([[[[[[0.7638], [0.9047]]], [[[0.079], [0.8124]]]]], [[[[[0.0599], [0.3649]]], [[[0.079], [0.4228]]]]]], Mul99584), 
LRes21352 = reshape_layer(Mul99584, [2, 1, 2], Res21352), 
LCon66409 = concatenate_layer([Res21352,[[[[0.1673, 0.9278]], [[0.9516, 0.6864]]]]], 3, Con66409), 
LCro36174 = cropping2D_layer([[[[1.3985, 1.8754, 1.301, 1.8643], [1.4007, 1.1591, 1.058, 1.9442], [1.3121, 1.1194, 1.3352, 1.4037], [1.6372, 1.6068, 1.7596, 1.7394]], [[1.066, 1.5064, 1.1407, 1.7844], [1.8536, 1.0438, 1.0468, 1.2406], [1.1806, 1.3639, 1.8919, 1.7748], [1.9219, 1.3771, 1.0465, 1.9994]], [[1.6833, 1.585, 1.5584, 1.6382], [1.9252, 1.1006, 1.1716, 1.4497], [1.4872, 1.3588, 1.4642, 1.0246], [1.8519, 1.077, 1.0936, 1.4051]], [[1.0413, 1.8709, 1.3309, 1.5829], [1.1257, 1.5559, 1.2954, 1.3258], [1.9448, 1.5711, 1.5594, 1.4538], [1.7885, 1.1531, 1.082, 1.6408]]]], 3, 0, 3, 0, Cro36174), 
LZer64165 = zero_padding2D_layer(Cro36174, 1, 0, 0, 0, Zer64165), 
LMax63188 = maximum_layer([Con66409,Zer64165], Max63188), 
LSep29903 = separable_conv2D_layer(Max63188, 2, 1,[[[[[0.6323], [0.6453], [0.5296], [0.2493]]], [[[0.1082], [0.0975], [0.6154], [0.0461]]]],[[[[0.0041, 0.2245, 0.8287], [0.976, 0.2439, 0.717], [0.8083, 0.2848, 0.1591], [0.9805, 0.6149, 0.3638]]]]],[0, 0, 0], 1, 1, false, Sep29903), 
LFla65560 = flatten_layer(Sep29903, Fla65560), 
LRes54082 = reshape_layer(Fla65560, [3, 1], Res54082), 
LRes80227 = reshape_layer(Res54082, [3, 1, 1], Res80227), 
LMax66640 = max_pool2D_layer(Res80227, 3, 1, Max66640), 
exec_layers([LMul99584,LRes21352,LCon66409,LCro36174,LZer64165,LMax63188,LSep29903,LFla65560,LRes54082,LRes80227,LMax66640],["Mul99584","Res21352","Con66409","Cro36174","Zer64165","Max63188","Sep29903","Fla65560","Res54082","Res80227","Max66640"],Max66640,"Max66640")

Actual (Unparsed): [[[[1.2293480]]]]

Expected (Unparsed): [[[[1.2293480125506207]]]]

Actual:   [[[[1.2294]]]]

Expected: [[[[1.2294]]]]