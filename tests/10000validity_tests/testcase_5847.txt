import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add77442 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Add77442 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con25196 = tf.keras.layers.Input(shape=([2]))
in0Max76030 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Max76030 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con32988 = tf.keras.layers.Input(shape=([2, 1]))
in0Dot44425 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot44425 = tf.keras.layers.Input(shape=([2, 2]))
in0Min83458 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Min83458 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con80601 = tf.keras.layers.Input(shape=([2]))

Add77442 = keras.layers.Add(name = 'Add77442', )([in0Add77442,in1Add77442])
Res63991 = keras.layers.Reshape((2, 1), name = 'Res63991', )(Add77442)
Fla46484 = keras.layers.Flatten(name = 'Fla46484', )(Res63991)
Con25196 = keras.layers.Concatenate(axis=1, name = 'Con25196', )([Fla46484,in0Con25196])
Max76030 = keras.layers.Maximum(name = 'Max76030', )([in0Max76030,in1Max76030])
Res32832 = keras.layers.Reshape((2, 1), name = 'Res32832', )(Max76030)
Con32988 = keras.layers.Concatenate(axis=2, name = 'Con32988', )([Res32832,in0Con32988])
Dot44425 = keras.layers.Dot(axes=(2, 1), name = 'Dot44425', )([in0Dot44425,in1Dot44425])
Dot9736 = keras.layers.Dot(axes=(1, 2), name = 'Dot9736', )([Con32988,Dot44425])
Fla32292 = keras.layers.Flatten(name = 'Fla32292', )(Dot9736)
Min83458 = keras.layers.Minimum(name = 'Min83458', )([in0Min83458,in1Min83458])
Res12125 = keras.layers.Reshape((2, 2), name = 'Res12125', )(Min83458)
GRU73305 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU73305', )(Res12125)
Con80601 = keras.layers.Concatenate(axis=1, name = 'Con80601', )([GRU73305,in0Con80601])
Min64182 = keras.layers.Minimum(name = 'Min64182', )([Fla32292,Con80601])
Min45361 = keras.layers.Minimum(name = 'Min45361', )([Con25196,Min64182])
model = tf.keras.models.Model(inputs=[in0Add77442,in1Add77442,in0Con25196,in0Max76030,in1Max76030,in0Con32988,in0Dot44425,in1Dot44425,in0Min83458,in1Min83458,in0Con80601], outputs=Min45361)
w = model.get_layer('GRU73305').get_weights() 
w[0] = np.array([[3, 6, 4, 2, 1, 9], [1, 1, 1, 5, 1, 1]])
w[1] = np.array([[9, 7, 7, 4, 5, 8], [6, 9, 4, 9, 9, 5]])
w[2] = np.array([2, 10, 4, 8, 6, 3])
model.get_layer('GRU73305').set_weights(w) 
in0Add77442 = tf.constant([[[[0.4497]], [[0.0907]]]])
in1Add77442 = tf.constant([[[[0.2813]], [[0.2755]]]])
in0Con25196 = tf.constant([[0.9484, 0.7473]])
in0Max76030 = tf.constant([[[[0.6499]], [[0.1773]]]])
in1Max76030 = tf.constant([[[[0.2787]], [[0.1929]]]])
in0Con32988 = tf.constant([[[0.4626], [0.3662]]])
in0Dot44425 = tf.constant([[[0.4703, 0.1028], [0.7658, 0.5281]]])
in1Dot44425 = tf.constant([[[0.4859, 0.1816], [0.5941, 0.1481]]])
in0Min83458 = tf.constant([[[[0.3516, 0.3442]], [[0.4828, 0.484]]]])
in1Min83458 = tf.constant([[[[0.0463, 0.0851]], [[0.5296, 0.3395]]]])
in0Con80601 = tf.constant([[0.4731, 0.5416]])
print (np.array2string(model.predict([in0Add77442,in1Add77442,in0Con25196,in0Max76030,in1Max76030,in0Con32988,in0Dot44425,in1Dot44425,in0Min83458,in1Min83458,in0Con80601],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min45361.png')

LAdd77442 = add_layer([[[[[0.4497]], [[0.0907]]]], [[[[0.2813]], [[0.2755]]]]], Add77442), 
LRes63991 = reshape_layer(Add77442, [2, 1], Res63991), 
LFla46484 = flatten_layer(Res63991, Fla46484), 
LCon25196 = concatenate_layer([Fla46484,[[0.9484, 0.7473]]], 1, Con25196), 
LMax76030 = maximum_layer([[[[[0.6499]], [[0.1773]]]], [[[[0.2787]], [[0.1929]]]]], Max76030), 
LRes32832 = reshape_layer(Max76030, [2, 1], Res32832), 
LCon32988 = concatenate_layer([Res32832,[[[0.4626], [0.3662]]]], 2, Con32988), 
LDot44425 = dot_layer([[[0.4703, 0.1028], [0.7658, 0.5281]]], [[[0.4859, 0.1816], [0.5941, 0.1481]]], 2, 1, Dot44425), 
LDot9736 = dot_layer(Con32988,Dot44425, 1, 2, Dot9736), 
LFla32292 = flatten_layer(Dot9736, Fla32292), 
LMin83458 = minimum_layer([[[[[0.3516, 0.3442]], [[0.4828, 0.484]]]], [[[[0.0463, 0.0851]], [[0.5296, 0.3395]]]]], Min83458), 
LRes12125 = reshape_layer(Min83458, [2, 2], Res12125), 
LGRU73305 = gru_layer(Res12125,[[3, 6, 4, 2, 1, 9], [1, 1, 1, 5, 1, 1]],[[9, 7, 7, 4, 5, 8], [6, 9, 4, 9, 9, 5]],[2, 10, 4, 8, 6, 3], false, GRU73305), 
LCon80601 = concatenate_layer([GRU73305,[[0.4731, 0.5416]]], 1, Con80601), 
LMin64182 = minimum_layer([Fla32292,Con80601], Min64182), 
LMin45361 = minimum_layer([Con25196,Min64182], Min45361), 
exec_layers([LAdd77442,LRes63991,LFla46484,LCon25196,LMax76030,LRes32832,LCon32988,LDot44425,LDot9736,LFla32292,LMin83458,LRes12125,LGRU73305,LCon80601,LMin64182,LMin45361],["Add77442","Res63991","Fla46484","Con25196","Max76030","Res32832","Con32988","Dot44425","Dot9736","Fla32292","Min83458","Res12125","GRU73305","Con80601","Min64182","Min45361"],Min45361,"Min45361")

Actual (Unparsed): [[0.1060219, 0.0000324, 0.1708165, 0.3968408]]

Expected (Unparsed): [[0.10602189691786823,3.242525282237059e-5,0.17081650564200002,0.396840820436]]

Actual:   [[0.1061, 0.0001, 0.1709, 0.3969]]

Expected: [[0.1061, 0.0001, 0.1709, 0.3969]]