import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave82301 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Ave82301 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Mul72329 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Mul72329 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Sim34842 = tf.keras.layers.Input(shape=([2, 2]))
in0Con99142 = tf.keras.layers.Input(shape=([3, 1]))
in0Min61772 = tf.keras.layers.Input(shape=([2, 2]))
in1Min61772 = tf.keras.layers.Input(shape=([2, 2]))

Ave82301 = keras.layers.Average(name = 'Ave82301', )([in0Ave82301,in1Ave82301])
Res65926 = keras.layers.Reshape((2, 2, 2), name = 'Res65926', )(Ave82301)
Res72469 = keras.layers.Reshape((2, 4), name = 'Res72469', )(Res65926)
Mul72329 = keras.layers.Multiply(name = 'Mul72329', )([in0Mul72329,in1Mul72329])
Res74473 = keras.layers.Reshape((2, 2, 2), name = 'Res74473', )(Mul72329)
Res63005 = keras.layers.Reshape((2, 4), name = 'Res63005', )(Res74473)
Dot75640 = keras.layers.Dot(axes=(2, 2), name = 'Dot75640', )([Res72469,Res63005])
Zer83524 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer83524', )(Dot75640)
Sim34842 = keras.layers.SimpleRNN(3,name = 'Sim34842', )(in0Sim34842)
Res11223 = keras.layers.Reshape((3, 1), name = 'Res11223', )(Sim34842)
Con99142 = keras.layers.Concatenate(axis=2, name = 'Con99142', )([Res11223,in0Con99142])
Min61772 = keras.layers.Minimum(name = 'Min61772', )([in0Min61772,in1Min61772])
ELU51929 = keras.layers.ELU(alpha=6.109854405812342, name = 'ELU51929', )(Min61772)
Zer38829 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer38829', )(ELU51929)
Sub99300 = keras.layers.Subtract(name = 'Sub99300', )([Con99142,Zer38829])
Max91033 = keras.layers.Maximum(name = 'Max91033', )([Zer83524,Sub99300])
model = tf.keras.models.Model(inputs=[in0Ave82301,in1Ave82301,in0Mul72329,in1Mul72329,in0Sim34842,in0Con99142,in0Min61772,in1Min61772], outputs=Max91033)
w = model.get_layer('Sim34842').get_weights() 
w[0] = np.array([[4, 3, 3], [1, 8, 7]])
w[1] = np.array([[7, 9, 1], [3, 1, 8], [2, 1, 1]])
w[2] = np.array([9, 1, 6])
model.get_layer('Sim34842').set_weights(w) 
in0Ave82301 = tf.constant([[[[[0.388], [0.1432]], [[0.3348], [0.7219]]], [[[0.6231], [0.1278]], [[0.0784], [0.1112]]]]])
in1Ave82301 = tf.constant([[[[[0.5908], [0.7112]], [[0.6002], [0.5942]]], [[[0.8256], [0.2117]], [[0.3923], [0.6799]]]]])
in0Mul72329 = tf.constant([[[[[0.2624, 0.8034]], [[0.7352, 0.1844]]], [[[0.3865, 0.6232]], [[0.1303, 0.8186]]]]])
in1Mul72329 = tf.constant([[[[[0.7563, 0.7618]], [[0.8464, 0.7501]]], [[[0.0675, 0.9525]], [[0.5272, 0.2875]]]]])
in0Sim34842 = tf.constant([[[5, 9], [9, 7]]])
in0Con99142 = tf.constant([[[0.2883], [0.1995], [0.329]]])
in0Min61772 = tf.constant([[[0.6469, 0.2075], [0.0187, 0.2012]]])
in1Min61772 = tf.constant([[[0.9658, 0.4076], [0.9913, 0.6853]]])
print (np.array2string(model.predict([in0Ave82301,in1Ave82301,in0Mul72329,in1Mul72329,in0Sim34842,in0Con99142,in0Min61772,in1Min61772],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max91033.png')

LAve82301 = average_layer([[[[[[0.388], [0.1432]], [[0.3348], [0.7219]]], [[[0.6231], [0.1278]], [[0.0784], [0.1112]]]]], [[[[[0.5908], [0.7112]], [[0.6002], [0.5942]]], [[[0.8256], [0.2117]], [[0.3923], [0.6799]]]]]], Ave82301), 
LRes65926 = reshape_layer(Ave82301, [2, 2, 2], Res65926), 
LRes72469 = reshape_layer(Res65926, [2, 4], Res72469), 
LMul72329 = multiply_layer([[[[[[0.2624, 0.8034]], [[0.7352, 0.1844]]], [[[0.3865, 0.6232]], [[0.1303, 0.8186]]]]], [[[[[0.7563, 0.7618]], [[0.8464, 0.7501]]], [[[0.0675, 0.9525]], [[0.5272, 0.2875]]]]]], Mul72329), 
LRes74473 = reshape_layer(Mul72329, [2, 2, 2], Res74473), 
LRes63005 = reshape_layer(Res74473, [2, 4], Res63005), 
LDot75640 = dot_layer(Res72469,Res63005, 2, 2, Dot75640), 
LZer83524 = zero_padding1D_layer(Dot75640, 1, 0, Zer83524), 
LSim34842 = simple_rnn_layer([[[5, 9], [9, 7]]],[[4, 3, 3], [1, 8, 7]],[[7, 9, 1], [3, 1, 8], [2, 1, 1]],[9, 1, 6], Sim34842), 
LRes11223 = reshape_layer(Sim34842, [3, 1], Res11223), 
LCon99142 = concatenate_layer([Res11223,[[[0.2883], [0.1995], [0.329]]]], 2, Con99142), 
LMin61772 = minimum_layer([[[[0.6469, 0.2075], [0.0187, 0.2012]]], [[[0.9658, 0.4076], [0.9913, 0.6853]]]], Min61772), 
LELU51929 = elu_layer(Min61772, 6.109854405812342, ELU51929), 
LZer38829 = zero_padding1D_layer(ELU51929, 1, 0, Zer38829), 
LSub99300 = subtract_layer(Con99142,Zer38829, Sub99300), 
LMax91033 = maximum_layer([Zer83524,Sub99300], Max91033), 
exec_layers([LAve82301,LRes65926,LRes72469,LMul72329,LRes74473,LRes63005,LDot75640,LZer83524,LSim34842,LRes11223,LCon99142,LMin61772,LELU51929,LZer38829,LSub99300,LMax91033],["Ave82301","Res65926","Res72469","Mul72329","Res74473","Res63005","Dot75640","Zer83524","Sim34842","Res11223","Con99142","Min61772","ELU51929","Zer38829","Sub99300","Max91033"],Max91033,"Max91033")

Actual (Unparsed): [[[1.0000000, 0.2883000], [0.7405154, 0.4533378], [0.9813000, 0.2289195]]]

Expected (Unparsed): [[[1.0,0.2883],[0.740515432034,0.45333784202500005],[0.9813,0.22891952074349997]]]

Actual:   [[[1, 0.2883], [0.7406, 0.4534], [0.9813, 0.229]]]

Expected: [[[1, 0.2883], [0.7406, 0.4534], [0.9813, 0.229]]]