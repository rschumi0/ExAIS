import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max41754 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Max41754 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Glo17314 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Mul99051 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Mul99051 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Con58169 = tf.keras.layers.Input(shape=([2, 3, 5]))

Max41754 = keras.layers.Maximum(name = 'Max41754', )([in0Max41754,in1Max41754])
Con43575 = keras.layers.Conv3DTranspose(3, (1, 1, 2),strides=(1, 1, 1), padding='valid', name = 'Con43575', )(Max41754)
Res22228 = keras.layers.Reshape((1, 2, 9), name = 'Res22228', )(Con43575)
Zer43331 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer43331', )(Res22228)
Glo17314 = keras.layers.GlobalMaxPool2D(name = 'Glo17314', )(in0Glo17314)
Res44139 = keras.layers.Reshape((2, 1), name = 'Res44139', )(Glo17314)
Mul99051 = keras.layers.Multiply(name = 'Mul99051', )([in0Mul99051,in1Mul99051])
Res78123 = keras.layers.Reshape((2, 1), name = 'Res78123', )(Mul99051)
Sub5898 = keras.layers.Subtract(name = 'Sub5898', )([Res44139,Res78123])
Res81970 = keras.layers.Reshape((2, 1, 1), name = 'Res81970', )(Sub5898)
Sep34945 = keras.layers.SeparableConv2D(4, (1, 1),strides=(1, 1), padding='valid', name = 'Sep34945', )(Res81970)
Zer37169 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer37169', )(Sep34945)
Con58169 = keras.layers.Concatenate(axis=3, name = 'Con58169', )([Zer37169,in0Con58169])
Max1504 = keras.layers.Maximum(name = 'Max1504', )([Zer43331,Con58169])
Res54801 = keras.layers.Reshape((2, 27), name = 'Res54801', )(Max1504)
Max32645 = keras.layers.MaxPool1D(pool_size=(2), name = 'Max32645', )(Res54801)
model = tf.keras.models.Model(inputs=[in0Max41754,in1Max41754,in0Glo17314,in0Mul99051,in1Mul99051,in0Con58169], outputs=Max32645)
w = model.get_layer('Con43575').get_weights() 
w[0] = np.array([[[[[0.5232], [0.1211], [0.3626]], [[0.7627], [0.4879], [0.3458]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con43575').set_weights(w) 
w = model.get_layer('Sep34945').get_weights() 
w[0] = np.array([[[[0.5646]]]])
w[1] = np.array([[[[0.3028, 0.4602, 0.0724, 0.7668]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep34945').set_weights(w) 
in0Max41754 = tf.constant([[[[[0.2897], [0.1054]], [[0.9996], [0.5631]]]]])
in1Max41754 = tf.constant([[[[[0.5533], [0.8816]], [[0.1909], [0.1079]]]]])
in0Glo17314 = tf.constant([[[[1.758, 1.2996], [1.5516, 1.7378]], [[1.3032, 1.7452], [1.9479, 1.815]]]])
in0Mul99051 = tf.constant([[[[[0.013]]], [[[0.308]]]]])
in1Mul99051 = tf.constant([[[[[0.3096]]], [[[0.5882]]]]])
in0Con58169 = tf.constant([[[[0.5017, 0.5073, 0.6937, 0.5439, 0.7456], [0.2538, 0.624, 0.8922, 0.2876, 0.8192], [0.3767, 0.0355, 0.3401, 0.4587, 0.6165]], [[0.0735, 0.3775, 0.1739, 0.1685, 0.5816], [0.1951, 0.4872, 0.9324, 0.8238, 0.6125], [0.3749, 0.1801, 0.0815, 0.7155, 0.8126]]]])
print (np.array2string(model.predict([in0Max41754,in1Max41754,in0Glo17314,in0Mul99051,in1Mul99051,in0Con58169],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max32645.png')

LMax41754 = maximum_layer([[[[[[0.2897], [0.1054]], [[0.9996], [0.5631]]]]], [[[[[0.5533], [0.8816]], [[0.1909], [0.1079]]]]]], Max41754), 
LCon43575 = conv3D_transpose_layer(Max41754, 1, 1, 2,[[[[[0.5232], [0.1211], [0.3626]], [[0.7627], [0.4879], [0.3458]]]]],[0, 0, 0], 1, 1, 1, false, Con43575), 
LRes22228 = reshape_layer(Con43575, [1, 2, 9], Res22228), 
LZer43331 = zero_padding2D_layer(Res22228, 1, 0, 1, 0, Zer43331), 
LGlo17314 = global_max_pool2D_layer([[[[1.758, 1.2996], [1.5516, 1.7378]], [[1.3032, 1.7452], [1.9479, 1.815]]]], Glo17314), 
LRes44139 = reshape_layer(Glo17314, [2, 1], Res44139), 
LMul99051 = multiply_layer([[[[[[0.013]]], [[[0.308]]]]], [[[[[0.3096]]], [[[0.5882]]]]]], Mul99051), 
LRes78123 = reshape_layer(Mul99051, [2, 1], Res78123), 
LSub5898 = subtract_layer(Res44139,Res78123, Sub5898), 
LRes81970 = reshape_layer(Sub5898, [2, 1, 1], Res81970), 
LSep34945 = separable_conv2D_layer(Res81970, 1, 1,[[[[[0.5646]]]],[[[[0.3028, 0.4602, 0.0724, 0.7668]]]]],[0, 0, 0, 0], 1, 1, false, Sep34945), 
LZer37169 = zero_padding2D_layer(Sep34945, 0, 0, 2, 0, Zer37169), 
LCon58169 = concatenate_layer([Zer37169,[[[[0.5017, 0.5073, 0.6937, 0.5439, 0.7456], [0.2538, 0.624, 0.8922, 0.2876, 0.8192], [0.3767, 0.0355, 0.3401, 0.4587, 0.6165]], [[0.0735, 0.3775, 0.1739, 0.1685, 0.5816], [0.1951, 0.4872, 0.9324, 0.8238, 0.6125], [0.3749, 0.1801, 0.0815, 0.7155, 0.8126]]]]], 3, Con58169), 
LMax1504 = maximum_layer([Zer43331,Con58169], Max1504), 
LRes54801 = reshape_layer(Max1504, [2, 27], Res54801), 
LMax32645 = max_pool1D_layer(Res54801, 2, Max32645), 
exec_layers([LMax41754,LCon43575,LRes22228,LZer43331,LGlo17314,LRes44139,LMul99051,LRes78123,LSub5898,LRes81970,LSep34945,LZer37169,LCon58169,LMax1504,LRes54801,LMax32645],["Max41754","Con43575","Res22228","Zer43331","Glo17314","Res44139","Mul99051","Res78123","Sub5898","Res81970","Sep34945","Zer37169","Con58169","Max1504","Res54801","Max32645"],Max32645,"Max32645")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.5017000, 0.5073000, 0.6937000, 0.5439000, 0.7456000, 0.2894866, 0.0670046, 0.2006266, 0.8832551, 0.3767168, 0.6240000, 0.9324000, 0.8238000, 0.8192000, 0.5229907, 0.5050750, 0.3624550, 1.0570088, 0.5558962, 0.5498417, 0.4294764, 0.7155000, 0.8126000]]]

Expected (Unparsed): [[[0,0,0,0,0.5017,0.5073,0.6937,0.5439,0.7456,0.28948656,0.06700463,0.20062658,0.88325503,0.37671683,0.624,0.9324,0.8238,0.8192,0.52299072,0.505074993830784,0.36245496,1.0570088400000002,0.55589625,0.54984174,0.42947637000000005,0.7155,0.8126]]]

Actual:   [[[0, 0, 0, 0, 0.5017, 0.5073, 0.6937, 0.5439, 0.7456, 0.2895, 0.0671, 0.2007, 0.8833, 0.3768, 0.624, 0.9324, 0.8238, 0.8192, 0.523, 0.5051, 0.3625, 1.0571, 0.5559, 0.5499, 0.4295, 0.7155, 0.8126]]]

Expected: [[[0, 0, 0, 0, 0.5017, 0.5073, 0.6937, 0.5439, 0.7456, 0.2895, 0.0671, 0.2007, 0.8833, 0.3768, 0.624, 0.9324, 0.8238, 0.8192, 0.523, 0.5051, 0.3625, 1.0571, 0.5559, 0.5499, 0.4295, 0.7155, 0.8126]]]