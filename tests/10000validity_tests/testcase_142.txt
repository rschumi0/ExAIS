import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max13197 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Max13197 = tf.keras.layers.Input(shape=([1, 2, 2]))

Max13197 = keras.layers.Maximum(name = 'Max13197', )([in0Max13197,in1Max13197])
Res73092 = keras.layers.Reshape((1, 4), name = 'Res73092', )(Max13197)
LST16604 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST16604', )(Res73092)
Res86403 = keras.layers.Reshape((2, 1), name = 'Res86403', )(LST16604)
Res99895 = keras.layers.Reshape((2, 1, 1), name = 'Res99895', )(Res86403)
Con69357 = keras.layers.Conv2DTranspose(4, (2, 1),strides=(1, 1), padding='same', name = 'Con69357', )(Res99895)
model = tf.keras.models.Model(inputs=[in0Max13197,in1Max13197], outputs=Con69357)
w = model.get_layer('LST16604').get_weights() 
w[0] = np.array([[2, 1, 5, 8, 8, 5, 2, 2], [8, 3, 10, 7, 2, 7, 4, 4], [1, 4, 6, 10, 5, 1, 6, 9], [6, 1, 5, 8, 8, 10, 4, 6]])
w[1] = np.array([[1, 1, 10, 8, 5, 8, 4, 1], [5, 9, 9, 10, 10, 4, 2, 9]])
w[2] = np.array([5, 6, 7, 10, 4, 9, 3, 9])
model.get_layer('LST16604').set_weights(w) 
w = model.get_layer('Con69357').get_weights() 
w[0] = np.array([[[[0.6663], [0.4539], [0.563], [0.3623]]], [[[0.4913], [0.7478], [0.3434], [0.5959]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con69357').set_weights(w) 
in0Max13197 = tf.constant([[[[0.6265, 0.971], [0.4114, 0.7657]]]])
in1Max13197 = tf.constant([[[[0.1015, 0.6449], [0.0895, 0.3602]]]])
print (np.array2string(model.predict([in0Max13197,in1Max13197],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con69357.png')

LMax13197 = maximum_layer([[[[[0.6265, 0.971], [0.4114, 0.7657]]]], [[[[0.1015, 0.6449], [0.0895, 0.3602]]]]], Max13197), 
LRes73092 = reshape_layer(Max13197, [1, 4], Res73092), 
LLST16604 = lstm_layer(Res73092,[[2, 1, 5, 8, 8, 5, 2, 2], [8, 3, 10, 7, 2, 7, 4, 4], [1, 4, 6, 10, 5, 1, 6, 9], [6, 1, 5, 8, 8, 10, 4, 6]],[[1, 1, 10, 8, 5, 8, 4, 1], [5, 9, 9, 10, 10, 4, 2, 9]],[5, 6, 7, 10, 4, 9, 3, 9], LST16604), 
LRes86403 = reshape_layer(LST16604, [2, 1], Res86403), 
LRes99895 = reshape_layer(Res86403, [2, 1, 1], Res99895), 
LCon69357 = conv2D_transpose_layer(Res99895, 2, 1,[[[[0.6663], [0.4539], [0.563], [0.3623]]], [[[0.4913], [0.7478], [0.3434], [0.5959]]]],[0, 0, 0, 0], 1, 1, true, Con69357), 
exec_layers([LMax13197,LRes73092,LLST16604,LRes86403,LRes99895,LCon69357],["Max13197","Res73092","LST16604","Res86403","Res99895","Con69357"],Con69357,"Con69357")

Actual (Unparsed): [[[[0.5074496, 0.3456872, 0.4287770, 0.2759252]], [[0.8816192, 0.9152058, 0.6903071, 0.7297580]]]]

Expected (Unparsed): [[[[0.5074495965978286,0.34568718579581936,0.4287770116832921,0.27592524215427483]],[[0.8816191541282761,0.915205805212659,0.6903071130210301,0.7297580109303996]]]]

Actual:   [[[[0.5075, 0.3457, 0.4288, 0.276]], [[0.8817, 0.9153, 0.6904, 0.7298]]]]

Expected: [[[[0.5075, 0.3457, 0.4288, 0.276]], [[0.8817, 0.9153, 0.6904, 0.7298]]]]