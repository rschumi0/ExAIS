import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul91529 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Mul91529 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con1756 = tf.keras.layers.Input(shape=([3, 3]))
in0Sub87650 = tf.keras.layers.Input(shape=([2, 3, 3]))
in1Sub87650 = tf.keras.layers.Input(shape=([2, 3, 3]))

Mul91529 = keras.layers.Multiply(name = 'Mul91529', )([in0Mul91529,in1Mul91529])
Res9108 = keras.layers.Reshape((1, 1), name = 'Res9108', )(Mul91529)
LST27364 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST27364', )(Res9108)
Res52622 = keras.layers.Reshape((3, 1), name = 'Res52622', )(LST27364)
Con1756 = keras.layers.Concatenate(axis=2, name = 'Con1756', )([Res52622,in0Con1756])
Sub87650 = keras.layers.Subtract(name = 'Sub87650', )([in0Sub87650,in1Sub87650])
Res64909 = keras.layers.Reshape((2, 9), name = 'Res64909', )(Sub87650)
Sep15783 = keras.layers.SeparableConv1D(4, (2),strides=(2), padding='same', name = 'Sep15783', )(Res64909)
Zer75355 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer75355', )(Sep15783)
Max3542 = keras.layers.Maximum(name = 'Max3542', )([Con1756,Zer75355])
model = tf.keras.models.Model(inputs=[in0Mul91529,in1Mul91529,in0Con1756,in0Sub87650,in1Sub87650], outputs=Max3542)
w = model.get_layer('LST27364').get_weights() 
w[0] = np.array([[5, 4, 4, 10, 10, 7, 8, 4, 10, 4, 7, 4]])
w[1] = np.array([[7, 9, 5, 2, 10, 5, 6, 6, 8, 6, 4, 9], [4, 1, 8, 6, 8, 5, 2, 2, 7, 2, 5, 9], [5, 2, 10, 7, 8, 9, 7, 9, 10, 2, 8, 3]])
w[2] = np.array([1, 6, 10, 3, 10, 8, 5, 8, 10, 6, 7, 1])
model.get_layer('LST27364').set_weights(w) 
w = model.get_layer('Sep15783').get_weights() 
w[0] = np.array([[[0.3437], [0.9125], [0.0672], [0.3219], [0.2901], [0.1239], [0.1644], [0.1866], [0.873]], [[0.3887], [0.0248], [0.0573], [0.9655], [0.687], [0.6082], [0.6652], [0.5849], [0.5936]]])
w[1] = np.array([[[0.4592, 0.823, 0.4684, 0.5935], [0.645, 0.9346, 0.6924, 0.3229], [0.5327, 0.1295, 0.8105, 0.9333], [0.4863, 0.9673, 0.1406, 0.2631], [0.0096, 0.8309, 0.698, 0.3712], [0.3702, 0.5997, 0.4691, 0.4887], [0.4658, 0.2952, 0.1729, 0.5301], [0.9782, 0.3647, 0.2455, 0.9302], [0.7189, 0.515, 0.2254, 0.528]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep15783').set_weights(w) 
in0Mul91529 = tf.constant([[[[0.6815]]]])
in1Mul91529 = tf.constant([[[[0.9554]]]])
in0Con1756 = tf.constant([[[0.0056, 0.3393, 0.5074], [0.5149, 0.0043, 0.9042], [0.8836, 0.6153, 0.3939]]])
in0Sub87650 = tf.constant([[[[0.9301, 0.6951, 0.5772], [0.7425, 0.4989, 0.937], [0.6454, 0.5408, 0.1654]], [[0.2368, 0.8634, 0.7909], [0.567, 0.4997, 0.0218], [0.4714, 0.7936, 0.7572]]]])
in1Sub87650 = tf.constant([[[[0.2378, 0.7085, 0.0107], [0.366, 0.3962, 0.4342], [0.1713, 0.5517, 0.0564]], [[0.2923, 0.3962, 0.1052], [0.4823, 0.3111, 0.4245], [0.1864, 0.232, 0.0833]]]])
print (np.array2string(model.predict([in0Mul91529,in1Mul91529,in0Con1756,in0Sub87650,in1Sub87650],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max3542.png')

LMul91529 = multiply_layer([[[[[0.6815]]]], [[[[0.9554]]]]], Mul91529), 
LRes9108 = reshape_layer(Mul91529, [1, 1], Res9108), 
LLST27364 = lstm_layer(Res9108,[[5, 4, 4, 10, 10, 7, 8, 4, 10, 4, 7, 4]],[[7, 9, 5, 2, 10, 5, 6, 6, 8, 6, 4, 9], [4, 1, 8, 6, 8, 5, 2, 2, 7, 2, 5, 9], [5, 2, 10, 7, 8, 9, 7, 9, 10, 2, 8, 3]],[1, 6, 10, 3, 10, 8, 5, 8, 10, 6, 7, 1], LST27364), 
LRes52622 = reshape_layer(LST27364, [3, 1], Res52622), 
LCon1756 = concatenate_layer([Res52622,[[[0.0056, 0.3393, 0.5074], [0.5149, 0.0043, 0.9042], [0.8836, 0.6153, 0.3939]]]], 2, Con1756), 
LSub87650 = subtract_layer([[[[0.9301, 0.6951, 0.5772], [0.7425, 0.4989, 0.937], [0.6454, 0.5408, 0.1654]], [[0.2368, 0.8634, 0.7909], [0.567, 0.4997, 0.0218], [0.4714, 0.7936, 0.7572]]]], [[[[0.2378, 0.7085, 0.0107], [0.366, 0.3962, 0.4342], [0.1713, 0.5517, 0.0564]], [[0.2923, 0.3962, 0.1052], [0.4823, 0.3111, 0.4245], [0.1864, 0.232, 0.0833]]]], Sub87650), 
LRes64909 = reshape_layer(Sub87650, [2, 9], Res64909), 
LSep15783 = separable_conv1D_layer(Res64909, 2,[[[[0.3437], [0.9125], [0.0672], [0.3219], [0.2901], [0.1239], [0.1644], [0.1866], [0.873]], [[0.3887], [0.0248], [0.0573], [0.9655], [0.687], [0.6082], [0.6652], [0.5849], [0.5936]]],[[[0.4592, 0.823, 0.4684, 0.5935], [0.645, 0.9346, 0.6924, 0.3229], [0.5327, 0.1295, 0.8105, 0.9333], [0.4863, 0.9673, 0.1406, 0.2631], [0.0096, 0.8309, 0.698, 0.3712], [0.3702, 0.5997, 0.4691, 0.4887], [0.4658, 0.2952, 0.1729, 0.5301], [0.9782, 0.3647, 0.2455, 0.9302], [0.7189, 0.515, 0.2254, 0.528]]]],[0, 0, 0, 0], 2, true, Sep15783), 
LZer75355 = zero_padding1D_layer(Sep15783, 2, 0, Zer75355), 
LMax3542 = maximum_layer([Con1756,Zer75355], Max3542), 
exec_layers([LMul91529,LRes9108,LLST27364,LRes52622,LCon1756,LSub87650,LRes64909,LSep15783,LZer75355,LMax3542],["Mul91529","Res9108","LST27364","Res52622","Con1756","Sub87650","Res64909","Sep15783","Zer75355","Max3542"],Max3542,"Max3542")

Actual (Unparsed): [[[0.7555185, 0.0056000, 0.3393000, 0.5074000], [0.7615099, 0.5149000, 0.0043000, 0.9042000], [0.9727111, 0.8836000, 0.6153000, 0.9306485]]]

Expected (Unparsed): [[[0.755518542248569,0.0056,0.3393,0.5074],[0.761509898726594,0.5149,0.0043,0.9042],[0.9727111228750001,0.8836,0.6153,0.9306484890110001]]]

Actual:   [[[0.7556, 0.0056, 0.3393, 0.5074], [0.7616, 0.5149, 0.0043, 0.9042], [0.9728, 0.8836, 0.6153, 0.9307]]]

Expected: [[[0.7556, 0.0056, 0.3393, 0.5074], [0.7616, 0.5149, 0.0043, 0.9042], [0.9728, 0.8836, 0.6153, 0.9307]]]