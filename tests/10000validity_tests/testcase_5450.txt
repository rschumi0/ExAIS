import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min51011 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Min51011 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Add89491 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Add89491 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Glo90230 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con47217 = tf.keras.layers.Input(shape=([4, 3]))
in0Dot37970 = tf.keras.layers.Input(shape=([3]))
in1Dot37970 = tf.keras.layers.Input(shape=([3]))
in0Con13438 = tf.keras.layers.Input(shape=([15]))

Min51011 = keras.layers.Minimum(name = 'Min51011', )([in0Min51011,in1Min51011])
Res25458 = keras.layers.Reshape((2, 4), name = 'Res25458', )(Min51011)
Zer287 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer287', )(Res25458)
Add89491 = keras.layers.Add(name = 'Add89491', )([in0Add89491,in1Add89491])
Fla8729 = keras.layers.Flatten(name = 'Fla8729', )(Add89491)
Res89261 = keras.layers.Reshape((4, 1), name = 'Res89261', )(Fla8729)
Glo90230 = keras.layers.GlobalAveragePooling2D(name = 'Glo90230', )(in0Glo90230)
Res76019 = keras.layers.Reshape((1, 1), name = 'Res76019', )(Glo90230)
Per19693 = keras.layers.Permute((2,1), name = 'Per19693',)(Res76019)
Zer73196 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer73196', )(Per19693)
Add13646 = keras.layers.Add(name = 'Add13646', )([Res89261,Zer73196])
Con47217 = keras.layers.Concatenate(axis=2, name = 'Con47217', )([Add13646,in0Con47217])
Ave78754 = keras.layers.Average(name = 'Ave78754', )([Zer287,Con47217])
Fla37919 = keras.layers.Flatten(name = 'Fla37919', )(Ave78754)
Dot37970 = keras.layers.Dot(axes=(1, 1), name = 'Dot37970', )([in0Dot37970,in1Dot37970])
Con13438 = keras.layers.Concatenate(axis=1, name = 'Con13438', )([Dot37970,in0Con13438])
Min55565 = keras.layers.Minimum(name = 'Min55565', )([Fla37919,Con13438])
model = tf.keras.models.Model(inputs=[in0Min51011,in1Min51011,in0Add89491,in1Add89491,in0Glo90230,in0Con47217,in0Dot37970,in1Dot37970,in0Con13438], outputs=Min55565)
in0Min51011 = tf.constant([[[[0.6319, 0.4235], [0.3753, 0.6643]], [[0.1202, 0.8403], [0.4599, 0.616]]]])
in1Min51011 = tf.constant([[[[0.3828, 0.6655], [0.2347, 0.3264]], [[0.0032, 0.5993], [0.1338, 0.5616]]]])
in0Add89491 = tf.constant([[[[0.4771], [0.1306]], [[0.2161], [0.1641]]]])
in1Add89491 = tf.constant([[[[0.4312], [0.5651]], [[0.052], [0.4288]]]])
in0Glo90230 = tf.constant([[[[1.3008]], [[1.2975]]]])
in0Con47217 = tf.constant([[[0.2776, 0.0215, 0.3631], [0.1803, 0.7411, 0.6742], [0.1595, 0.4088, 0.1543], [0.1128, 0.3419, 0.2334]]])
in0Dot37970 = tf.constant([[0.8624, 0.3744, 0.1677]])
in1Dot37970 = tf.constant([[0.5861, 0.6617, 0.8029]])
in0Con13438 = tf.constant([[0.9065, 0.3637, 0.194, 0.7242, 0.0587, 0.3049, 0.5818, 0.2453, 0.6904, 0.2476, 0.2813, 0.9127, 0.6161, 0.9556, 0.3271]])
print (np.array2string(model.predict([in0Min51011,in1Min51011,in0Add89491,in1Add89491,in0Glo90230,in0Con47217,in0Dot37970,in1Dot37970,in0Con13438],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min55565.png')

LMin51011 = minimum_layer([[[[[0.6319, 0.4235], [0.3753, 0.6643]], [[0.1202, 0.8403], [0.4599, 0.616]]]], [[[[0.3828, 0.6655], [0.2347, 0.3264]], [[0.0032, 0.5993], [0.1338, 0.5616]]]]], Min51011), 
LRes25458 = reshape_layer(Min51011, [2, 4], Res25458), 
LZer287 = zero_padding1D_layer(Res25458, 2, 0, Zer287), 
LAdd89491 = add_layer([[[[[0.4771], [0.1306]], [[0.2161], [0.1641]]]], [[[[0.4312], [0.5651]], [[0.052], [0.4288]]]]], Add89491), 
LFla8729 = flatten_layer(Add89491, Fla8729), 
LRes89261 = reshape_layer(Fla8729, [4, 1], Res89261), 
LGlo90230 = global_average_pooling2D_layer([[[[1.3008]], [[1.2975]]]], Glo90230), 
LRes76019 = reshape_layer(Glo90230, [1, 1], Res76019), 
LPer19693 = permute_layer(Res76019, 2,1, Per19693), 
LZer73196 = zero_padding1D_layer(Per19693, 3, 0, Zer73196), 
LAdd13646 = add_layer([Res89261,Zer73196], Add13646), 
LCon47217 = concatenate_layer([Add13646,[[[0.2776, 0.0215, 0.3631], [0.1803, 0.7411, 0.6742], [0.1595, 0.4088, 0.1543], [0.1128, 0.3419, 0.2334]]]], 2, Con47217), 
LAve78754 = average_layer([Zer287,Con47217], Ave78754), 
LFla37919 = flatten_layer(Ave78754, Fla37919), 
LDot37970 = dot_layer([[0.8624, 0.3744, 0.1677]], [[0.5861, 0.6617, 0.8029]], 1, 1, Dot37970), 
LCon13438 = concatenate_layer([Dot37970,[[0.9065, 0.3637, 0.194, 0.7242, 0.0587, 0.3049, 0.5818, 0.2453, 0.6904, 0.2476, 0.2813, 0.9127, 0.6161, 0.9556, 0.3271]]], 1, Con13438), 
LMin55565 = minimum_layer([Fla37919,Con13438], Min55565), 
exec_layers([LMin51011,LRes25458,LZer287,LAdd89491,LFla8729,LRes89261,LGlo90230,LRes76019,LPer19693,LZer73196,LAdd13646,LCon47217,LAve78754,LFla37919,LDot37970,LCon13438,LMin55565],["Min51011","Res25458","Zer287","Add89491","Fla8729","Res89261","Glo90230","Res76019","Per19693","Zer73196","Add13646","Con47217","Ave78754","Fla37919","Dot37970","Con13438","Min55565"],Min55565,"Min55565")

Actual (Unparsed): [[0.4541500, 0.1388000, 0.0107500, 0.1815500, 0.3478500, 0.0587000, 0.3049000, 0.3371000, 0.2453000, 0.2915000, 0.2476000, 0.2403500, 0.9127000, 0.3560500, 0.2378500, 0.3271000]]

Expected (Unparsed): [[0.45415000000000005,0.1388,0.01075,0.18155,0.34785,0.0587,0.3049,0.3371,0.2453,0.2915,0.2476,0.24035,0.9127,0.35605000000000003,0.23785,0.3271]]

Actual:   [[0.4542, 0.1388, 0.0108, 0.1816, 0.3479, 0.0587, 0.3049, 0.3371, 0.2453, 0.2915, 0.2476, 0.2404, 0.9127, 0.3561, 0.2379, 0.3271]]

Expected: [[0.4542, 0.1388, 0.0108, 0.1816, 0.3479, 0.0587, 0.3049, 0.3371, 0.2453, 0.2915, 0.2476, 0.2404, 0.9127, 0.3561, 0.2379, 0.3271]]