import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Up_73757 = tf.keras.layers.Input(shape=([1, 3]))
in0Con72412 = tf.keras.layers.Input(shape=([3, 5]))
in0Up_10823 = tf.keras.layers.Input(shape=([4, 3, 1, 1]))

Up_73757 = keras.layers.UpSampling1D(size=(1), name = 'Up_73757', )(in0Up_73757)
Sim26740 = keras.layers.SimpleRNN(3,name = 'Sim26740', )(Up_73757)
Res79372 = keras.layers.Reshape((3, 1), name = 'Res79372', )(Sim26740)
Con72412 = keras.layers.Concatenate(axis=2, name = 'Con72412', )([Res79372,in0Con72412])
Up_10823 = keras.layers.UpSampling3D(size=(2, 2, 1), name = 'Up_10823', )(in0Up_10823)
Res78712 = keras.layers.Reshape((8, 6, 1), name = 'Res78712', )(Up_10823)
Res41644 = keras.layers.Reshape((8, 6), name = 'Res41644', )(Res78712)
Dot12517 = keras.layers.Dot(axes=(2, 2), name = 'Dot12517', )([Con72412,Res41644])
Res9536 = keras.layers.Reshape((3, 8, 1), name = 'Res9536', )(Dot12517)
Con39907 = keras.layers.Conv2DTranspose(3, (3, 5),strides=(1, 1), padding='valid', name = 'Con39907', )(Res9536)
Res6925 = keras.layers.Reshape((5, 36), name = 'Res6925', )(Con39907)
Ave58445 = keras.layers.AveragePooling1D(pool_size=(2), name = 'Ave58445', )(Res6925)
model = tf.keras.models.Model(inputs=[in0Up_73757,in0Con72412,in0Up_10823], outputs=Ave58445)
w = model.get_layer('Sim26740').get_weights() 
w[0] = np.array([[3, 3, 4], [5, 3, 8], [7, 4, 10]])
w[1] = np.array([[9, 10, 9], [4, 8, 10], [10, 1, 4]])
w[2] = np.array([8, 9, 9])
model.get_layer('Sim26740').set_weights(w) 
w = model.get_layer('Con39907').get_weights() 
w[0] = np.array([[[[0.7993], [0.3062], [0.6898]], [[0.9193], [0.8715], [0.1589]], [[0.2594], [0.3154], [0.2412]], [[0.7751], [0.2506], [0.4008]], [[0.9569], [0.7657], [0.2055]]], [[[0.7759], [0.3672], [0.8101]], [[0.7959], [0.6474], [0.0952]], [[0.1113], [0.1255], [0.4191]], [[0.4933], [0.8075], [0.3254]], [[0.6582], [0.7113], [0.3449]]], [[[0.3567], [0.5699], [0.9216]], [[0.4813], [0.6726], [0.2304]], [[0.5639], [0.4174], [0.5367]], [[0.6093], [0.6939], [0.5357]], [[0.3488], [0.8472], [0.6528]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con39907').set_weights(w) 
in0Up_73757 = tf.constant([[[1.7544, 1.5412, 1.0068]]])
in0Con72412 = tf.constant([[[0.4437, 0.8415, 0.0292, 0.759, 0.2787], [0.0474, 0.7969, 0.9742, 0.1141, 0.05], [0.6968, 0.1238, 0.6366, 0.7415, 0.853]]])
in0Up_10823 = tf.constant([[[[[1.542]], [[1.0873]], [[1.0204]]], [[[1.3851]], [[1.675]], [[1.8808]]], [[[1.4792]], [[1.3186]], [[1.8496]]], [[[1.2123]], [[1.8744]], [[1.8142]]]]])
print (np.array2string(model.predict([in0Up_73757,in0Con72412,in0Up_10823],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave58445.png')

LUp_73757 = up_sampling1D_layer([[[1.7544, 1.5412, 1.0068]]], 1, Up_73757), 
LSim26740 = simple_rnn_layer(Up_73757,[[3, 3, 4], [5, 3, 8], [7, 4, 10]],[[9, 10, 9], [4, 8, 10], [10, 1, 4]],[8, 9, 9], Sim26740), 
LRes79372 = reshape_layer(Sim26740, [3, 1], Res79372), 
LCon72412 = concatenate_layer([Res79372,[[[0.4437, 0.8415, 0.0292, 0.759, 0.2787], [0.0474, 0.7969, 0.9742, 0.1141, 0.05], [0.6968, 0.1238, 0.6366, 0.7415, 0.853]]]], 2, Con72412), 
LUp_10823 = up_sampling3D_layer([[[[[1.542]], [[1.0873]], [[1.0204]]], [[[1.3851]], [[1.675]], [[1.8808]]], [[[1.4792]], [[1.3186]], [[1.8496]]], [[[1.2123]], [[1.8744]], [[1.8142]]]]], 2, 2, 1, Up_10823), 
LRes78712 = reshape_layer(Up_10823, [8, 6, 1], Res78712), 
LRes41644 = reshape_layer(Res78712, [8, 6], Res41644), 
LDot12517 = dot_layer(Con72412,Res41644, 2, 2, Dot12517), 
LRes9536 = reshape_layer(Dot12517, [3, 8, 1], Res9536), 
LCon39907 = conv2D_transpose_layer(Res9536, 3, 5,[[[[0.7993], [0.3062], [0.6898]], [[0.9193], [0.8715], [0.1589]], [[0.2594], [0.3154], [0.2412]], [[0.7751], [0.2506], [0.4008]], [[0.9569], [0.7657], [0.2055]]], [[[0.7759], [0.3672], [0.8101]], [[0.7959], [0.6474], [0.0952]], [[0.1113], [0.1255], [0.4191]], [[0.4933], [0.8075], [0.3254]], [[0.6582], [0.7113], [0.3449]]], [[[0.3567], [0.5699], [0.9216]], [[0.4813], [0.6726], [0.2304]], [[0.5639], [0.4174], [0.5367]], [[0.6093], [0.6939], [0.5357]], [[0.3488], [0.8472], [0.6528]]]],[0, 0, 0], 1, 1, false, Con39907), 
LRes6925 = reshape_layer(Con39907, [5, 36], Res6925), 
LAve58445 = average_pooling1D_layer(Res6925, 2, Ave58445), 
exec_layers([LUp_73757,LSim26740,LRes79372,LCon72412,LUp_10823,LRes78712,LRes41644,LDot12517,LRes9536,LCon39907,LRes6925,LAve58445],["Up_73757","Sim26740","Res79372","Con72412","Up_10823","Res78712","Res41644","Dot12517","Res9536","Con39907","Res6925","Ave58445"],Ave58445,"Ave58445")

Actual (Unparsed): [[[4.8149437, 1.9925697, 4.4525907, 10.1486063, 6.8222572, 5.2848575, 12.7484779, 8.8923995, 8.3636702, 18.3474775, 12.9339914, 10.8738865, 23.5115711, 17.7470720, 12.5905561, 24.2285219, 18.1064076, 13.1532464, 25.8867820, 19.3634687, 13.7363629, 25.9215555, 19.5382445, 13.6168861, 19.4995905, 16.7825759, 7.9754720, 13.0482041, 10.7749140, 7.0808356, 11.8229079, 9.1568813, 4.8421045, 6.5899076, 5.7591524, 1.9510442], [6.8480704, 4.6505071, 8.9632449, 14.5828060, 12.3717202, 10.6986270, 19.9768793, 16.7145248, 17.8687342, 28.7909144, 25.8959238, 22.9384689, 35.9857365, 34.8217848, 28.1982431, 37.3589862, 36.2690660, 29.3838547, 39.3995180, 38.7990245, 30.9063746, 39.3248020, 38.6546503, 30.6708550, 30.3976184, 32.2759491, 19.1741656, 20.8916384, 22.9386310, 17.2481228, 16.8684129, 19.6147392, 11.7400169, 8.5270885, 10.7465382, 5.9108509]]]

Expected (Unparsed): [[[4.814943664869499,1.99256972331,4.452590665773499,10.148606319238999,6.822257181137999,5.2848575081244995,12.748477973980998,8.892399501675499,8.363670255193,18.347477704383998,12.9339914931765,10.8738865836095,23.511571236060995,17.747072066482,12.5905561462305,24.2285220234735,18.106407625991505,13.153246472828,25.8867822552935,19.3634688583755,13.736363034283501,25.921555771659502,19.5382447358245,13.616886213079,19.4995905201065,16.782576005467,7.975472013369,13.048204180415501,10.774914032720002,7.080835679323501,11.8229080641075,9.156881388523502,4.842104535921001,6.5899077152475005,5.759152474983001,1.9510441938060001],[6.848070273619499,4.650507027232999,8.963244769555498,14.582805818676999,12.371720092873998,10.6986268776955,19.9768792544715,16.714524768995002,17.8687342708795,28.790914409406998,25.8959238717145,22.9384689251075,35.985736362656496,34.821784778379005,28.198243024131997,37.358986124577,36.269065925814004,29.3838546924545,39.399517999800004,38.799024648312,30.906374757860505,39.32480196847601,38.65465037426151,30.670855020353002,30.397618346138003,32.275949038040004,19.174165585352505,20.891638399137,22.938630973529502,17.248122863094004,16.868412957925504,19.614739254022503,11.7400169184945,8.527088474337,10.746538276788002,5.910850947570001]]]

Actual:   [[[4.815, 1.9926, 4.4526, 10.1487, 6.8223, 5.2849, 12.7485, 8.8924, 8.3637, 18.3475, 12.934, 10.8739, 23.5116, 17.7471, 12.5906, 24.2286, 18.1065, 13.1533, 25.8868, 19.3635, 13.7364, 25.9216, 19.5383, 13.6169, 19.4996, 16.7826, 7.9755, 13.0483, 10.775, 7.0809, 11.823, 9.1569, 4.8422, 6.59, 5.7592, 1.9511], [6.8481, 4.6506, 8.9633, 14.5829, 12.3718, 10.6987, 19.9769, 16.7146, 17.8688, 28.791, 25.896, 22.9385, 35.9858, 34.8218, 28.1983, 37.359, 36.2691, 29.3839, 39.3996, 38.7991, 30.9064, 39.3249, 38.6547, 30.6709, 30.3977, 32.276, 19.1742, 20.8917, 22.9387, 17.2482, 16.8685, 19.6148, 11.7401, 8.5271, 10.7466, 5.9109]]]

Expected: [[[4.815, 1.9926, 4.4526, 10.1487, 6.8223, 5.2849, 12.7485, 8.8924, 8.3637, 18.3475, 12.934, 10.8739, 23.5116, 17.7471, 12.5906, 24.2286, 18.1065, 13.1533, 25.8868, 19.3635, 13.7364, 25.9216, 19.5383, 13.6169, 19.4996, 16.7826, 7.9755, 13.0483, 10.775, 7.0809, 11.823, 9.1569, 4.8422, 6.59, 5.7592, 1.9511], [6.8481, 4.6506, 8.9633, 14.5829, 12.3718, 10.6987, 19.9769, 16.7146, 17.8688, 28.791, 25.896, 22.9385, 35.9858, 34.8218, 28.1983, 37.359, 36.2691, 29.3839, 39.3996, 38.7991, 30.9064, 39.3249, 38.6547, 30.6709, 30.3977, 32.276, 19.1742, 20.8917, 22.9387, 17.2482, 16.8685, 19.6148, 11.7401, 8.5271, 10.7466, 5.9109]]]