import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot38121 = tf.keras.layers.Input(shape=([3]))
in1Dot38121 = tf.keras.layers.Input(shape=([3]))
in0Con77551 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Ave14946 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Ave14946 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Sep29643 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con88980 = tf.keras.layers.Input(shape=([1]))

Dot38121 = keras.layers.Dot(axes=(1, 1), name = 'Dot38121', )([in0Dot38121,in1Dot38121])
Res71300 = keras.layers.Reshape((1, 1), name = 'Res71300', )(Dot38121)
Res18412 = keras.layers.Reshape((1, 1, 1), name = 'Res18412', )(Res71300)
Con77551 = keras.layers.Concatenate(axis=3, name = 'Con77551', )([Res18412,in0Con77551])
Ave14946 = keras.layers.Average(name = 'Ave14946', )([in0Ave14946,in1Ave14946])
Res97330 = keras.layers.Reshape((2, 1, 1), name = 'Res97330', )(Ave14946)
Loc99685 = keras.layers.LocallyConnected2D(3, (2, 1),strides=(1, 1), name = 'Loc99685', )(Res97330)
Add82051 = keras.layers.Add(name = 'Add82051', )([Con77551,Loc99685])
Res86207 = keras.layers.Reshape((1, 3), name = 'Res86207', )(Add82051)
Fla81067 = keras.layers.Flatten(name = 'Fla81067', )(Res86207)
Sep29643 = keras.layers.SeparableConv2D(4, (1, 1),strides=(1, 1), padding='valid', name = 'Sep29643', )(in0Sep29643)
Res66878 = keras.layers.Reshape((2, 4), name = 'Res66878', )(Sep29643)
Sof32929 = keras.layers.Softmax(axis=1, name = 'Sof32929', )(Res66878)
Sim30710 = keras.layers.SimpleRNN(2,name = 'Sim30710', )(Sof32929)
Con88980 = keras.layers.Concatenate(axis=1, name = 'Con88980', )([Sim30710,in0Con88980])
Ave26162 = keras.layers.Average(name = 'Ave26162', )([Fla81067,Con88980])
model = tf.keras.models.Model(inputs=[in0Dot38121,in1Dot38121,in0Con77551,in0Ave14946,in1Ave14946,in0Sep29643,in0Con88980], outputs=Ave26162)
w = model.get_layer('Loc99685').get_weights() 
w[0] = np.array([[[0.8292, 0.121, 0.0987], [0.1634, 0.457, 0.775]]])
w[1] = np.array([[[0, 0, 0]]])
model.get_layer('Loc99685').set_weights(w) 
w = model.get_layer('Sep29643').get_weights() 
w[0] = np.array([[[[0.343]]]])
w[1] = np.array([[[[0.4794, 0.1158, 0.817, 0.7597]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep29643').set_weights(w) 
w = model.get_layer('Sim30710').get_weights() 
w[0] = np.array([[7, 7], [9, 8], [9, 7], [4, 7]])
w[1] = np.array([[4, 2], [6, 5]])
w[2] = np.array([6, 1])
model.get_layer('Sim30710').set_weights(w) 
in0Dot38121 = tf.constant([[0.7647, 0.2742, 0.8176]])
in1Dot38121 = tf.constant([[0.8887, 0.6588, 0.4864]])
in0Con77551 = tf.constant([[[[0.2159, 0.4065]]]])
in0Ave14946 = tf.constant([[[[[0.8239]]], [[[0.493]]]]])
in1Ave14946 = tf.constant([[[[[0.0026]]], [[[0.7356]]]]])
in0Sep29643 = tf.constant([[[[0.9741]], [[0.3266]]]])
in0Con88980 = tf.constant([[0.718]])
print (np.array2string(model.predict([in0Dot38121,in1Dot38121,in0Con77551,in0Ave14946,in1Ave14946,in0Sep29643,in0Con88980],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave26162.png')

LDot38121 = dot_layer([[0.7647, 0.2742, 0.8176]], [[0.8887, 0.6588, 0.4864]], 1, 1, Dot38121), 
LRes71300 = reshape_layer(Dot38121, [1, 1], Res71300), 
LRes18412 = reshape_layer(Res71300, [1, 1, 1], Res18412), 
LCon77551 = concatenate_layer([Res18412,[[[[0.2159, 0.4065]]]]], 3, Con77551), 
LAve14946 = average_layer([[[[[[0.8239]]], [[[0.493]]]]], [[[[[0.0026]]], [[[0.7356]]]]]], Ave14946), 
LRes97330 = reshape_layer(Ave14946, [2, 1, 1], Res97330), 
LLoc99685 = locally_connected2D_layer(Res97330, 2, 1,[[[0.8292, 0.121, 0.0987], [0.1634, 0.457, 0.775]]],[[[0, 0, 0]]], 1, 1, Loc99685), 
LAdd82051 = add_layer([Con77551,Loc99685], Add82051), 
LRes86207 = reshape_layer(Add82051, [1, 3], Res86207), 
LFla81067 = flatten_layer(Res86207, Fla81067), 
LSep29643 = separable_conv2D_layer([[[[0.9741]], [[0.3266]]]], 1, 1,[[[[[0.343]]]],[[[[0.4794, 0.1158, 0.817, 0.7597]]]]],[0, 0, 0, 0], 1, 1, false, Sep29643), 
LRes66878 = reshape_layer(Sep29643, [2, 4], Res66878), 
LSof32929 = softmax_layer(Res66878, 1, Sof32929), 
LSim30710 = simple_rnn_layer(Sof32929,[[7, 7], [9, 8], [9, 7], [4, 7]],[[4, 2], [6, 5]],[6, 1], Sim30710), 
LCon88980 = concatenate_layer([Sim30710,[[0.718]]], 1, Con88980), 
LAve26162 = average_layer([Fla81067,Con88980], Ave26162), 
exec_layers([LDot38121,LRes71300,LRes18412,LCon77551,LAve14946,LRes97330,LLoc99685,LAdd82051,LRes86207,LFla81067,LSep29643,LRes66878,LSof32929,LSim30710,LCon88980,LAve26162],["Dot38121","Res71300","Res18412","Con77551","Ave14946","Res97330","Loc99685","Add82051","Res86207","Fla81067","Sep29643","Res66878","Sof32929","Sim30710","Con88980","Ave26162"],Ave26162,"Ave26162")

Actual (Unparsed): [[1.3504780, 0.7733192, 0.8206851]]

Expected (Unparsed): [[1.350478005,0.773319175,0.8206851374999999]]

Actual:   [[1.3505, 0.7734, 0.8207]]

Expected: [[1.3505, 0.7734, 0.8207]]