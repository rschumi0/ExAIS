import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Per26958 = tf.keras.layers.Input(shape=([1, 4]))
in0Min71551 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Min71551 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))

Per26958 = keras.layers.Permute((2,1), name = 'Per26958',)(in0Per26958)
Res90662 = keras.layers.Reshape((4, 1, 1), name = 'Res90662', )(Per26958)
Res36966 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res36966', )(Res90662)
Zer45681 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer45681', )(Res36966)
Min71551 = keras.layers.Minimum(name = 'Min71551', )([in0Min71551,in1Min71551])
Res36860 = keras.layers.Reshape((1, 2, 2), name = 'Res36860', )(Min71551)
Max18332 = keras.layers.MaxPool2D(pool_size=(1, 2), strides=(1, 2), padding='same', name = 'Max18332', )(Res36860)
Res27229 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res27229', )(Max18332)
Up_4018 = keras.layers.UpSampling3D(size=(1, 1, 1), name = 'Up_4018', )(Res27229)
Zer48560 = keras.layers.ZeroPadding3D(padding=((3, 0), (0, 0), (1, 0)), name = 'Zer48560', )(Up_4018)
Sub75556 = keras.layers.Subtract(name = 'Sub75556', )([Zer45681,Zer48560])
model = tf.keras.models.Model(inputs=[in0Per26958,in0Min71551,in1Min71551], outputs=Sub75556)
in0Per26958 = tf.constant([[[1.0713, 1.1364, 1.2493, 1.8874]]])
in0Min71551 = tf.constant([[[[[0.622, 0.8028]], [[0.5187, 0.6205]]]]])
in1Min71551 = tf.constant([[[[[0.6851, 0.4036]], [[0.48, 0.933]]]]])
print (np.array2string(model.predict([in0Per26958,in0Min71551,in1Min71551],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub75556.png')

LPer26958 = permute_layer([[[1.0713, 1.1364, 1.2493, 1.8874]]], 2,1, Per26958), 
LRes90662 = reshape_layer(Per26958, [4, 1, 1], Res90662), 
LRes36966 = reshape_layer(Res90662, [4, 1, 1, 1], Res36966), 
LZer45681 = zero_padding3D_layer(Res36966, 0, 0, 0, 0, 2, 0, Zer45681), 
LMin71551 = minimum_layer([[[[[[0.622, 0.8028]], [[0.5187, 0.6205]]]]], [[[[[0.6851, 0.4036]], [[0.48, 0.933]]]]]], Min71551), 
LRes36860 = reshape_layer(Min71551, [1, 2, 2], Res36860), 
LMax18332 = max_pool2D_layer(Res36860, 1, 2, 1, 2, true, Max18332), 
LRes27229 = reshape_layer(Max18332, [1, 1, 2, 1], Res27229), 
LUp_4018 = up_sampling3D_layer(Res27229, 1, 1, 1, Up_4018), 
LZer48560 = zero_padding3D_layer(Up_4018, 3, 0, 0, 0, 1, 0, Zer48560), 
LSub75556 = subtract_layer(Zer45681,Zer48560, Sub75556), 
exec_layers([LPer26958,LRes90662,LRes36966,LZer45681,LMin71551,LRes36860,LMax18332,LRes27229,LUp_4018,LZer48560,LSub75556],["Per26958","Res90662","Res36966","Zer45681","Min71551","Res36860","Max18332","Res27229","Up_4018","Zer48560","Sub75556"],Sub75556,"Sub75556")

Actual (Unparsed): [[[[[0.0000000], [0.0000000], [1.0713000]]], [[[0.0000000], [0.0000000], [1.1364000]]], [[[0.0000000], [0.0000000], [1.2493000]]], [[[0.0000000], [-0.6220000], [1.2669000]]]]]

Expected (Unparsed): [[[[[0],[0],[1.0713]]],[[[0],[0],[1.1364]]],[[[0],[0],[1.2493]]],[[[0],[-0.622],[1.2669]]]]]

Actual:   [[[[[0], [0], [1.0713]]], [[[0], [0], [1.1364]]], [[[0], [0], [1.2493]]], [[[0], [-0.622], [1.2669]]]]]

Expected: [[[[[0], [0], [1.0713]]], [[[0], [0], [1.1364]]], [[[0], [0], [1.2493]]], [[[0], [-0.622], [1.2669]]]]]