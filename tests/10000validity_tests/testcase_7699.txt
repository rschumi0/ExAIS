import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min7830 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Min7830 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Mul69248 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Mul69248 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con47875 = tf.keras.layers.Input(shape=([3, 4, 1]))

Min7830 = keras.layers.Minimum(name = 'Min7830', )([in0Min7830,in1Min7830])
Lea54881 = keras.layers.LeakyReLU(alpha=8.565320470400655, name = 'Lea54881', )(Min7830)
Res54878 = keras.layers.Reshape((1, 2, 2), name = 'Res54878', )(Lea54881)
Zer51113 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer51113', )(Res54878)
Mul69248 = keras.layers.Multiply(name = 'Mul69248', )([in0Mul69248,in1Mul69248])
Zer41015 = keras.layers.ZeroPadding2D(padding=((1, 0), (3, 0)), name = 'Zer41015', )(Mul69248)
Con47875 = keras.layers.Concatenate(axis=3, name = 'Con47875', )([Zer41015,in0Con47875])
Sub67759 = keras.layers.Subtract(name = 'Sub67759', )([Zer51113,Con47875])
Res594 = keras.layers.Reshape((3, 8), name = 'Res594', )(Sub67759)
Zer34457 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer34457', )(Res594)
LST66574 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST66574', )(Zer34457)
model = tf.keras.models.Model(inputs=[in0Min7830,in1Min7830,in0Mul69248,in1Mul69248,in0Con47875], outputs=LST66574)
w = model.get_layer('LST66574').get_weights() 
w[0] = np.array([[6, 3, 10, 10, 6, 7, 9, 5, 3, 9, 2, 10], [10, 10, 10, 7, 5, 4, 7, 3, 7, 6, 1, 8], [4, 6, 6, 6, 10, 8, 5, 9, 8, 1, 3, 1], [1, 10, 9, 10, 1, 6, 1, 2, 2, 4, 4, 3], [1, 8, 10, 2, 10, 2, 3, 5, 5, 9, 10, 7], [10, 8, 4, 4, 4, 10, 6, 5, 7, 8, 6, 7], [9, 3, 5, 1, 9, 1, 6, 10, 1, 10, 6, 3], [7, 5, 1, 4, 5, 10, 4, 2, 10, 3, 2, 7]])
w[1] = np.array([[9, 2, 5, 2, 8, 4, 9, 8, 3, 3, 3, 8], [5, 1, 2, 9, 7, 2, 2, 2, 4, 5, 6, 10], [9, 7, 4, 3, 3, 4, 4, 7, 4, 4, 8, 8]])
w[2] = np.array([4, 5, 4, 6, 4, 4, 2, 10, 3, 1, 9, 8])
model.get_layer('LST66574').set_weights(w) 
in0Min7830 = tf.constant([[[[[0.1696, 0.4922]], [[0.4779, 0.4367]]]]])
in1Min7830 = tf.constant([[[[[0.1454, 0.1756]], [[0.0198, 0.5761]]]]])
in0Mul69248 = tf.constant([[[[0.3026]], [[0.0307]]]])
in1Mul69248 = tf.constant([[[[0.4862]], [[0.1895]]]])
in0Con47875 = tf.constant([[[[0.4651], [0.6764], [0.2375], [0.1661]], [[0.7348], [0.5852], [0.0289], [0.5444]], [[0.5819], [0.0804], [0.1812], [0.2669]]]])
print (np.array2string(model.predict([in0Min7830,in1Min7830,in0Mul69248,in1Mul69248,in0Con47875],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST66574.png')

LMin7830 = minimum_layer([[[[[[0.1696, 0.4922]], [[0.4779, 0.4367]]]]], [[[[[0.1454, 0.1756]], [[0.0198, 0.5761]]]]]], Min7830), 
LLea54881 = leaky_relu_layer(Min7830, 8.565320470400655, Lea54881), 
LRes54878 = reshape_layer(Lea54881, [1, 2, 2], Res54878), 
LZer51113 = zero_padding2D_layer(Res54878, 1, 1, 1, 1, Zer51113), 
LMul69248 = multiply_layer([[[[[0.3026]], [[0.0307]]]], [[[[0.4862]], [[0.1895]]]]], Mul69248), 
LZer41015 = zero_padding2D_layer(Mul69248, 1, 0, 3, 0, Zer41015), 
LCon47875 = concatenate_layer([Zer41015,[[[[0.4651], [0.6764], [0.2375], [0.1661]], [[0.7348], [0.5852], [0.0289], [0.5444]], [[0.5819], [0.0804], [0.1812], [0.2669]]]]], 3, Con47875), 
LSub67759 = subtract_layer(Zer51113,Con47875, Sub67759), 
LRes594 = reshape_layer(Sub67759, [3, 8], Res594), 
LZer34457 = zero_padding1D_layer(Res594, 2, 0, Zer34457), 
LLST66574 = lstm_layer(Zer34457,[[6, 3, 10, 10, 6, 7, 9, 5, 3, 9, 2, 10], [10, 10, 10, 7, 5, 4, 7, 3, 7, 6, 1, 8], [4, 6, 6, 6, 10, 8, 5, 9, 8, 1, 3, 1], [1, 10, 9, 10, 1, 6, 1, 2, 2, 4, 4, 3], [1, 8, 10, 2, 10, 2, 3, 5, 5, 9, 10, 7], [10, 8, 4, 4, 4, 10, 6, 5, 7, 8, 6, 7], [9, 3, 5, 1, 9, 1, 6, 10, 1, 10, 6, 3], [7, 5, 1, 4, 5, 10, 4, 2, 10, 3, 2, 7]],[[9, 2, 5, 2, 8, 4, 9, 8, 3, 3, 3, 8], [5, 1, 2, 9, 7, 2, 2, 2, 4, 5, 6, 10], [9, 7, 4, 3, 3, 4, 4, 7, 4, 4, 8, 8]],[4, 5, 4, 6, 4, 4, 2, 10, 3, 1, 9, 8], LST66574), 
exec_layers([LMin7830,LLea54881,LRes54878,LZer51113,LMul69248,LZer41015,LCon47875,LSub67759,LRes594,LZer34457,LLST66574],["Min7830","Lea54881","Res54878","Zer51113","Mul69248","Zer41015","Con47875","Sub67759","Res594","Zer34457","LST66574"],LST66574,"LST66574")

Actual (Unparsed): [[0.9988545, 0.9997963, 0.9998785]]

Expected (Unparsed): [[0.9988545247176784,0.9997963253794919,0.9998785474274741]]

Actual:   [[0.9989, 0.9998, 0.9999]]

Expected: [[0.9989, 0.9998, 0.9999]]