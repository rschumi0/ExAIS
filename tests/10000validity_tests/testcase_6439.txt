import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max95418 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Dot64602 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot64602 = tf.keras.layers.Input(shape=([2, 3]))
in0Con48689 = tf.keras.layers.Input(shape=([2, 1]))

Max95418 = keras.layers.MaxPool2D(pool_size=(2, 1), strides=(1, 1), padding='same', name = 'Max95418', )(in0Max95418)
Sep3836 = keras.layers.SeparableConv2D(3, (1, 1),strides=(2, 2), padding='valid', name = 'Sep3836', )(Max95418)
Res50914 = keras.layers.Reshape((1, 3), name = 'Res50914', )(Sep3836)
Zer60110 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer60110', )(Res50914)
Dot64602 = keras.layers.Dot(axes=(2, 2), name = 'Dot64602', )([in0Dot64602,in1Dot64602])
Mas74361 = keras.layers.Masking(mask_value=1, name = 'Mas74361', )(Dot64602)
Con48689 = keras.layers.Concatenate(axis=2, name = 'Con48689', )([Mas74361,in0Con48689])
Ave68148 = keras.layers.Average(name = 'Ave68148', )([Zer60110,Con48689])
Ave91605 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='same', name = 'Ave91605', )(Ave68148)
Zer43290 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer43290', )(Ave91605)
model = tf.keras.models.Model(inputs=[in0Max95418,in0Dot64602,in1Dot64602,in0Con48689], outputs=Zer43290)
w = model.get_layer('Sep3836').get_weights() 
w[0] = np.array([[[[0.7541], [0.1109]]]])
w[1] = np.array([[[[0.1063, 0.0742, 0.8141], [0.0824, 0.2093, 0.7028]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep3836').set_weights(w) 
in0Max95418 = tf.constant([[[[1.5897, 1.2051]], [[1.0695, 1.1088]]]])
in0Dot64602 = tf.constant([[[0.4556, 0.0905, 0.1303], [0.9099, 0.2668, 0.9276]]])
in1Dot64602 = tf.constant([[[0.0995, 0.7014, 0.9604], [0.2123, 0.4463, 0.4932]]])
in0Con48689 = tf.constant([[[0.3893], [0.6855]]])
print (np.array2string(model.predict([in0Max95418,in0Dot64602,in1Dot64602,in0Con48689],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Zer43290.png')

LMax95418 = max_pool2D_layer([[[[1.5897, 1.2051]], [[1.0695, 1.1088]]]], 2, 1, 1, 1, true, Max95418), 
LSep3836 = separable_conv2D_layer(Max95418, 1, 1,[[[[[0.7541], [0.1109]]]],[[[[0.1063, 0.0742, 0.8141], [0.0824, 0.2093, 0.7028]]]]],[0, 0, 0], 2, 2, false, Sep3836), 
LRes50914 = reshape_layer(Sep3836, [1, 3], Res50914), 
LZer60110 = zero_padding1D_layer(Res50914, 1, 0, Zer60110), 
LDot64602 = dot_layer([[[0.4556, 0.0905, 0.1303], [0.9099, 0.2668, 0.9276]]], [[[0.0995, 0.7014, 0.9604], [0.2123, 0.4463, 0.4932]]], 2, 2, Dot64602), 
LMas74361 = masking_layer(Dot64602, 1, Mas74361), 
LCon48689 = concatenate_layer([Mas74361,[[[0.3893], [0.6855]]]], 2, Con48689), 
LAve68148 = average_layer([Zer60110,Con48689], Ave68148), 
LAve91605 = average_pooling1D_layer(Ave68148, 1, 1, true, Ave91605), 
LZer43290 = zero_padding1D_layer(Ave91605, 1, 1, Zer43290), 
exec_layers([LMax95418,LSep3836,LRes50914,LZer60110,LDot64602,LMas74361,LCon48689,LAve68148,LAve91605,LZer43290],["Max95418","Sep3836","Res50914","Zer60110","Dot64602","Mas74361","Con48689","Ave68148","Ave91605","Zer43290"],Zer43290,"Zer43290")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000], [0.1169745, 0.1006890, 0.1946500], [0.6534898, 0.4433297, 0.8776817], [0.0000000, 0.0000000, 0.0000000]]]

Expected (Unparsed): [[[0,0,0],[0.11697451,0.100688995,0.19465],[0.6534898390335001,0.44332968776049997,0.8776816573545],[0,0,0]]]

Actual:   [[[0, 0, 0], [0.117, 0.1007, 0.1947], [0.6535, 0.4434, 0.8777], [0, 0, 0]]]

Expected: [[[0, 0, 0], [0.117, 0.1007, 0.1947], [0.6535, 0.4434, 0.8777], [0, 0, 0]]]