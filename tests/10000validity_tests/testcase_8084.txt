import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo59696 = tf.keras.layers.Input(shape=([2, 2]))
in0PRe24211 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))

Glo59696 = keras.layers.GlobalMaxPool1D(name = 'Glo59696', )(in0Glo59696)
Res49044 = keras.layers.Reshape((2, 1), name = 'Res49044', )(Glo59696)
Res66936 = keras.layers.Reshape((2, 1, 1), name = 'Res66936', )(Res49044)
Glo30507 = keras.layers.GlobalAveragePooling2D(name = 'Glo30507', )(Res66936)
Res85591 = keras.layers.Reshape((1, 1), name = 'Res85591', )(Glo30507)
Res49297 = keras.layers.Reshape((1, 1, 1), name = 'Res49297', )(Res85591)
Res2150 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res2150', )(Res49297)
Zer60998 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (1, 0)), name = 'Zer60998', )(Res2150)
PRe24211 = keras.layers.PReLU(name = 'PRe24211', input_shape=(1, 2, 2, 1))(in0PRe24211)
Max534 = keras.layers.Maximum(name = 'Max534', )([Zer60998,PRe24211])
Con90936 = keras.layers.Conv3D(2, (1, 2, 1),strides=(1, 2, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con90936', )(Max534)
Con66499 = keras.layers.Conv3D(4, (1, 2, 2),strides=(1, 2, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con66499', )(Con90936)
Res70973 = keras.layers.Reshape((1, 1, 8), name = 'Res70973', )(Con66499)
Res65933 = keras.layers.Reshape((1, 8), name = 'Res65933', )(Res70973)
Per14704 = keras.layers.Permute((2,1), name = 'Per14704',)(Res65933)
model = tf.keras.models.Model(inputs=[in0Glo59696,in0PRe24211], outputs=Per14704)
w = model.get_layer('PRe24211').get_weights() 
w[0] = np.array([[[[0.5581], [0.7904]], [[0.1776], [0.0357]]]])
model.get_layer('PRe24211').set_weights(w) 
w = model.get_layer('Con90936').get_weights() 
w[0] = np.array([[[[[0.4248, 0.9866]]], [[[0.3238, 0.4173]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con90936').set_weights(w) 
w = model.get_layer('Con66499').get_weights() 
w[0] = np.array([[[[[0.8624, 0.5228, 0.5709, 0.1861], [0.8446, 0.817, 0.1446, 0.8397]], [[0.2713, 0.7216, 0.2499, 0.5807], [0.307, 0.3006, 0.6381, 0.2852]]], [[[0.7553, 0.1228, 0.2626, 0.5124], [0.9324, 0.2052, 0.504, 0.4964]], [[0.1078, 0.011, 0.0903, 0.3778], [0.095, 0.5766, 0.9095, 0.6482]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con66499').set_weights(w) 
in0Glo59696 = tf.constant([[[1.7477, 1.1738], [1.8499, 1.8108]]])
in0PRe24211 = tf.constant([[[[[0.5407], [0.6625]], [[0.5285], [0.555]]]]])
print (np.array2string(model.predict([in0Glo59696,in0PRe24211],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Per14704.png')

LGlo59696 = global_max_pool1D_layer([[[1.7477, 1.1738], [1.8499, 1.8108]]], Glo59696), 
LRes49044 = reshape_layer(Glo59696, [2, 1], Res49044), 
LRes66936 = reshape_layer(Res49044, [2, 1, 1], Res66936), 
LGlo30507 = global_average_pooling2D_layer(Res66936, Glo30507), 
LRes85591 = reshape_layer(Glo30507, [1, 1], Res85591), 
LRes49297 = reshape_layer(Res85591, [1, 1, 1], Res49297), 
LRes2150 = reshape_layer(Res49297, [1, 1, 1, 1], Res2150), 
LZer60998 = zero_padding3D_layer(Res2150, 0, 0, 1, 0, 1, 0, Zer60998), 
LPRe24211 = prelu_layer([[[[[0.5407], [0.6625]], [[0.5285], [0.555]]]]], [[[[0.5581], [0.7904]], [[0.1776], [0.0357]]]], PRe24211), 
LMax534 = maximum_layer([Zer60998,PRe24211], Max534), 
LCon90936 = conv3D_layer(Max534, 1, 2, 1,[[[[[0.4248, 0.9866]]], [[[0.3238, 0.4173]]]]],[0, 0], 1, 2, 1, false, 1, 1, 1, Con90936), 
LCon66499 = conv3D_layer(Con90936, 1, 2, 2,[[[[[0.8624, 0.5228, 0.5709, 0.1861], [0.8446, 0.817, 0.1446, 0.8397]], [[0.2713, 0.7216, 0.2499, 0.5807], [0.307, 0.3006, 0.6381, 0.2852]]], [[[0.7553, 0.1228, 0.2626, 0.5124], [0.9324, 0.2052, 0.504, 0.4964]], [[0.1078, 0.011, 0.0903, 0.3778], [0.095, 0.5766, 0.9095, 0.6482]]]]],[0, 0, 0, 0], 1, 2, 1, true, 1, 1, 1, Con66499), 
LRes70973 = reshape_layer(Con66499, [1, 1, 8], Res70973), 
LRes65933 = reshape_layer(Res70973, [1, 8], Res65933), 
LPer14704 = permute_layer(Res65933, 2,1, Per14704), 
exec_layers([LGlo59696,LRes49044,LRes66936,LGlo30507,LRes85591,LRes49297,LRes2150,LZer60998,LPRe24211,LMax534,LCon90936,LCon66499,LRes70973,LRes65933,LPer14704],["Glo59696","Res49044","Res66936","Glo30507","Res85591","Res49297","Res2150","Zer60998","PRe24211","Max534","Con90936","Con66499","Res70973","Res65933","Per14704"],Per14704,"Per14704")

Actual (Unparsed): [[[1.6547845], [1.8823910], [1.4607523], [1.6195627], [1.9509809], [1.6150164], [0.7039822], [1.3528834]]]

Expected (Unparsed): [[[1.6547844470800002],[1.882390925399],[1.4607523107885],[1.6195626682420001],[1.9509808503450006],[1.615016396559],[0.7039821901500001],[1.3528834310465]]]

Actual:   [[[1.6548], [1.8824], [1.4608], [1.6196], [1.951], [1.6151], [0.704], [1.3529]]]

Expected: [[[1.6548], [1.8824], [1.4608], [1.6196], [1.951], [1.6151], [0.704], [1.3529]]]