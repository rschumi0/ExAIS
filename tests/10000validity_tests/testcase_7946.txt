import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max86795 = tf.keras.layers.Input(shape=([1, 1]))
in0Con95383 = tf.keras.layers.Input(shape=([2]))
in0Max43732 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Max43732 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))

Max86795 = keras.layers.MaxPool1D(pool_size=(1), strides=(8), padding='same', name = 'Max86795', )(in0Max86795)
Res21237 = keras.layers.Reshape((1, 1, 1), name = 'Res21237', )(Max86795)
Max59242 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 6), padding='same', name = 'Max59242', )(Res21237)
Res96756 = keras.layers.Reshape((1, 1), name = 'Res96756', )(Max59242)
Fla29936 = keras.layers.Flatten(name = 'Fla29936', )(Res96756)
Con95383 = keras.layers.Concatenate(axis=1, name = 'Con95383', )([Fla29936,in0Con95383])
Max43732 = keras.layers.Maximum(name = 'Max43732', )([in0Max43732,in1Max43732])
Res85583 = keras.layers.Reshape((1, 2, 1), name = 'Res85583', )(Max43732)
Res66569 = keras.layers.Reshape((1, 2), name = 'Res66569', )(Res85583)
Ave54072 = keras.layers.AveragePooling1D(pool_size=(1), strides=(8), padding='valid', name = 'Ave54072', )(Res66569)
GRU95290 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU95290', )(Ave54072)
Add67345 = keras.layers.Add(name = 'Add67345', )([Con95383,GRU95290])
Res46570 = keras.layers.Reshape((3, 1), name = 'Res46570', )(Add67345)
Ave27334 = keras.layers.AveragePooling1D(pool_size=(3), name = 'Ave27334', )(Res46570)
model = tf.keras.models.Model(inputs=[in0Max86795,in0Con95383,in0Max43732,in1Max43732], outputs=Ave27334)
w = model.get_layer('GRU95290').get_weights() 
w[0] = np.array([[1, 4, 7, 3, 5, 4, 9, 2, 5], [7, 10, 10, 1, 7, 9, 8, 4, 6]])
w[1] = np.array([[1, 4, 8, 10, 4, 2, 2, 1, 3], [10, 5, 6, 6, 1, 7, 1, 10, 8], [10, 7, 7, 3, 3, 4, 9, 4, 10]])
w[2] = np.array([[2, 2, 8, 1, 3, 3, 10, 4, 9], [5, 8, 5, 7, 2, 2, 6, 8, 6]])
model.get_layer('GRU95290').set_weights(w) 
in0Max86795 = tf.constant([[[1.6682]]])
in0Con95383 = tf.constant([[0.5215, 0.2407]])
in0Max43732 = tf.constant([[[[[0.734]], [[0.2462]]]]])
in1Max43732 = tf.constant([[[[[0.4533]], [[0.2295]]]]])
print (np.array2string(model.predict([in0Max86795,in0Con95383,in0Max43732,in1Max43732],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave27334.png')

LMax86795 = max_pool1D_layer([[[1.6682]]], 1, 8, true, Max86795), 
LRes21237 = reshape_layer(Max86795, [1, 1, 1], Res21237), 
LMax59242 = max_pool2D_layer(Res21237, 1, 1, 1, 6, true, Max59242), 
LRes96756 = reshape_layer(Max59242, [1, 1], Res96756), 
LFla29936 = flatten_layer(Res96756, Fla29936), 
LCon95383 = concatenate_layer([Fla29936,[[0.5215, 0.2407]]], 1, Con95383), 
LMax43732 = maximum_layer([[[[[[0.734]], [[0.2462]]]]], [[[[[0.4533]], [[0.2295]]]]]], Max43732), 
LRes85583 = reshape_layer(Max43732, [1, 2, 1], Res85583), 
LRes66569 = reshape_layer(Res85583, [1, 2], Res66569), 
LAve54072 = average_pooling1D_layer(Res66569, 1, 8, false, Ave54072), 
LGRU95290 = gru_layer(Ave54072,[[1, 4, 7, 3, 5, 4, 9, 2, 5], [7, 10, 10, 1, 7, 9, 8, 4, 6]],[[1, 4, 8, 10, 4, 2, 2, 1, 3], [10, 5, 6, 6, 1, 7, 1, 10, 8], [10, 7, 7, 3, 3, 4, 9, 4, 10]],[[2, 2, 8, 1, 3, 3, 10, 4, 9], [5, 8, 5, 7, 2, 2, 6, 8, 6]], true, GRU95290), 
LAdd67345 = add_layer([Con95383,GRU95290], Add67345), 
LRes46570 = reshape_layer(Add67345, [3, 1], Res46570), 
LAve27334 = average_pooling1D_layer(Res46570, 3, Ave27334), 
exec_layers([LMax86795,LRes21237,LMax59242,LRes96756,LFla29936,LCon95383,LMax43732,LRes85583,LRes66569,LAve54072,LGRU95290,LAdd67345,LRes46570,LAve27334],["Max86795","Res21237","Max59242","Res96756","Fla29936","Con95383","Max43732","Res85583","Res66569","Ave54072","GRU95290","Add67345","Res46570","Ave27334"],Ave27334,"Ave27334")

Actual (Unparsed): [[[0.8101594]]]

Expected (Unparsed): [[[0.8101594366350722]]]

Actual:   [[[0.8102]]]

Expected: [[[0.8102]]]