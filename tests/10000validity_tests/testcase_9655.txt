import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub18378 = tf.keras.layers.Input(shape=([3, 3, 2, 3]))
in1Sub18378 = tf.keras.layers.Input(shape=([3, 3, 2, 3]))

Sub18378 = keras.layers.Subtract(name = 'Sub18378', )([in0Sub18378,in1Sub18378])
Res21419 = keras.layers.Reshape((3, 3, 6), name = 'Res21419', )(Sub18378)
Res34330 = keras.layers.Reshape((3, 18), name = 'Res34330', )(Res21419)
Max99763 = keras.layers.MaxPool1D(pool_size=(3), name = 'Max99763', )(Res34330)
model = tf.keras.models.Model(inputs=[in0Sub18378,in1Sub18378], outputs=Max99763)
in0Sub18378 = tf.constant([[[[[0.4707, 0.802, 0.5644], [0.2219, 0.3045, 0.1621]], [[0.2335, 0.1165, 0.763], [0.3437, 0.0002, 0.3256]], [[0.4896, 0.1825, 0.5256], [0.2766, 0.6282, 0.8175]]], [[[0.0808, 0.3613, 0.0854], [0.2816, 0.8864, 0.5612]], [[0.9091, 0.2683, 0.624], [0.3338, 0.0219, 0.4288]], [[0.6202, 0.8949, 0.145], [0.4988, 0.0656, 0.8691]]], [[[0.1218, 0.5341, 0.7725], [0.6502, 0.0088, 0.5413]], [[0.3986, 0.7106, 0.2407], [0.8293, 0.7655, 0.5327]], [[0.8937, 0.4816, 0.8899], [0.7923, 0.5752, 0.4473]]]]])
in1Sub18378 = tf.constant([[[[[0.609, 0.9229, 0.7475], [0.8876, 0.2308, 0.2086]], [[0.3595, 0.576, 0.4695], [0.1144, 0.5009, 0.3468]], [[0.0342, 0.6445, 0.4253], [0.8179, 0.6349, 0.141]]], [[[0.689, 0.8665, 0.8375], [0.0841, 0.3467, 0.6325]], [[0.1584, 0.1331, 0.1121], [0.141, 0.0214, 0.8637]], [[0.1419, 0.9912, 0.7174], [0.396, 0.6355, 0.9396]]], [[[0.3055, 0.385, 0.7564], [0.6242, 0.4725, 0.6502]], [[0.4732, 0.1188, 0.7292], [0.0559, 0.7983, 0.487]], [[0.9618, 0.1264, 0.5556], [0.0131, 0.2808, 0.2745]]]]])
print (np.array2string(model.predict([in0Sub18378,in1Sub18378],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max99763.png')

LSub18378 = subtract_layer([[[[[0.4707, 0.802, 0.5644], [0.2219, 0.3045, 0.1621]], [[0.2335, 0.1165, 0.763], [0.3437, 0.0002, 0.3256]], [[0.4896, 0.1825, 0.5256], [0.2766, 0.6282, 0.8175]]], [[[0.0808, 0.3613, 0.0854], [0.2816, 0.8864, 0.5612]], [[0.9091, 0.2683, 0.624], [0.3338, 0.0219, 0.4288]], [[0.6202, 0.8949, 0.145], [0.4988, 0.0656, 0.8691]]], [[[0.1218, 0.5341, 0.7725], [0.6502, 0.0088, 0.5413]], [[0.3986, 0.7106, 0.2407], [0.8293, 0.7655, 0.5327]], [[0.8937, 0.4816, 0.8899], [0.7923, 0.5752, 0.4473]]]]], [[[[[0.609, 0.9229, 0.7475], [0.8876, 0.2308, 0.2086]], [[0.3595, 0.576, 0.4695], [0.1144, 0.5009, 0.3468]], [[0.0342, 0.6445, 0.4253], [0.8179, 0.6349, 0.141]]], [[[0.689, 0.8665, 0.8375], [0.0841, 0.3467, 0.6325]], [[0.1584, 0.1331, 0.1121], [0.141, 0.0214, 0.8637]], [[0.1419, 0.9912, 0.7174], [0.396, 0.6355, 0.9396]]], [[[0.3055, 0.385, 0.7564], [0.6242, 0.4725, 0.6502]], [[0.4732, 0.1188, 0.7292], [0.0559, 0.7983, 0.487]], [[0.9618, 0.1264, 0.5556], [0.0131, 0.2808, 0.2745]]]]], Sub18378), 
LRes21419 = reshape_layer(Sub18378, [3, 3, 6], Res21419), 
LRes34330 = reshape_layer(Res21419, [3, 18], Res34330), 
LMax99763 = max_pool1D_layer(Res34330, 3, Max99763), 
exec_layers([LSub18378,LRes21419,LRes34330,LMax99763],["Sub18378","Res21419","Res34330","Max99763"],Max99763,"Max99763")

Actual (Unparsed): [[[-0.1383000, 0.1491000, 0.0161000, 0.1975000, 0.5397000, -0.0465000, 0.7507000, 0.5918000, 0.5119000, 0.7734000, 0.0005000, 0.0457000, 0.4783000, 0.3552000, 0.3343000, 0.7792000, 0.2944000, 0.6765000]]]

Expected (Unparsed): [[[-0.13829999999999998,0.1491,0.016100000000000003,0.1975,0.5397,-0.046500000000000014,0.7507,0.5918,0.5119,0.7734000000000001,0.0005000000000000004,0.04569999999999996,0.47829999999999995,0.35519999999999996,0.33430000000000004,0.7792,0.29440000000000005,0.6765]]]

Actual:   [[[-0.1383, 0.1491, 0.0161, 0.1975, 0.5397, -0.0465, 0.7507, 0.5918, 0.5119, 0.7734, 0.0005, 0.0457, 0.4783, 0.3552, 0.3343, 0.7792, 0.2944, 0.6765]]]

Expected: [[[-0.1382, 0.1491, 0.0162, 0.1975, 0.5397, -0.0465, 0.7507, 0.5918, 0.5119, 0.7735, 0.0006, 0.0457, 0.4783, 0.3552, 0.3344, 0.7792, 0.2945, 0.6765]]]