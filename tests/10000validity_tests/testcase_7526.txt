import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max81007 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Max81007 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Max87459 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Max87459 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con52238 = tf.keras.layers.Input(shape=([2, 1, 1]))

Max81007 = keras.layers.Maximum(name = 'Max81007', )([in0Max81007,in1Max81007])
Res70674 = keras.layers.Reshape((2, 1, 2), name = 'Res70674', )(Max81007)
Max87459 = keras.layers.Maximum(name = 'Max87459', )([in0Max87459,in1Max87459])
Con52238 = keras.layers.Concatenate(axis=3, name = 'Con52238', )([Max87459,in0Con52238])
Max96426 = keras.layers.Maximum(name = 'Max96426', )([Res70674,Con52238])
Res58601 = keras.layers.Reshape((2, 2), name = 'Res58601', )(Max96426)
LST68393 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST68393', )(Res58601)
Res53137 = keras.layers.Reshape((2, 1), name = 'Res53137', )(LST68393)
LST60041 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST60041', )(Res53137)
model = tf.keras.models.Model(inputs=[in0Max81007,in1Max81007,in0Max87459,in1Max87459,in0Con52238], outputs=LST60041)
w = model.get_layer('LST68393').get_weights() 
w[0] = np.array([[1, 3, 9, 6, 8, 3, 1, 2], [6, 7, 1, 9, 5, 5, 5, 6]])
w[1] = np.array([[8, 5, 5, 8, 2, 9, 3, 3], [9, 3, 2, 6, 7, 7, 9, 8]])
w[2] = np.array([6, 7, 9, 10, 9, 3, 1, 5])
model.get_layer('LST68393').set_weights(w) 
w = model.get_layer('LST60041').get_weights() 
w[0] = np.array([[5, 1, 2, 6]])
w[1] = np.array([[1, 9, 4, 7]])
w[2] = np.array([10, 10, 2, 3])
model.get_layer('LST60041').set_weights(w) 
in0Max81007 = tf.constant([[[[[0.4988, 0.7528]]], [[[0.5515, 0.4739]]]]])
in1Max81007 = tf.constant([[[[[0.3234, 0.6924]]], [[[0.5998, 0.643]]]]])
in0Max87459 = tf.constant([[[[0.1267]], [[0.594]]]])
in1Max87459 = tf.constant([[[[0.6812]], [[0.6333]]]])
in0Con52238 = tf.constant([[[[0.424]], [[0.4541]]]])
print (np.array2string(model.predict([in0Max81007,in1Max81007,in0Max87459,in1Max87459,in0Con52238],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST60041.png')

LMax81007 = maximum_layer([[[[[[0.4988, 0.7528]]], [[[0.5515, 0.4739]]]]], [[[[[0.3234, 0.6924]]], [[[0.5998, 0.643]]]]]], Max81007), 
LRes70674 = reshape_layer(Max81007, [2, 1, 2], Res70674), 
LMax87459 = maximum_layer([[[[[0.1267]], [[0.594]]]], [[[[0.6812]], [[0.6333]]]]], Max87459), 
LCon52238 = concatenate_layer([Max87459,[[[[0.424]], [[0.4541]]]]], 3, Con52238), 
LMax96426 = maximum_layer([Res70674,Con52238], Max96426), 
LRes58601 = reshape_layer(Max96426, [2, 2], Res58601), 
LLST68393 = lstm_layer(Res58601,[[1, 3, 9, 6, 8, 3, 1, 2], [6, 7, 1, 9, 5, 5, 5, 6]],[[8, 5, 5, 8, 2, 9, 3, 3], [9, 3, 2, 6, 7, 7, 9, 8]],[6, 7, 9, 10, 9, 3, 1, 5], LST68393), 
LRes53137 = reshape_layer(LST68393, [2, 1], Res53137), 
LLST60041 = lstm_layer(Res53137,[[5, 1, 2, 6]],[[1, 9, 4, 7]],[10, 10, 2, 3], LST60041), 
exec_layers([LMax81007,LRes70674,LMax87459,LCon52238,LMax96426,LRes58601,LLST68393,LRes53137,LLST60041],["Max81007","Res70674","Max87459","Con52238","Max96426","Res58601","LST68393","Res53137","LST60041"],LST60041,"LST60041")

Actual (Unparsed): [[0.9639719]]

Expected (Unparsed): [[0.9639719428491836]]

Actual:   [[0.964]]

Expected: [[0.964]]