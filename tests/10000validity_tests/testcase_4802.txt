import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min42777 = tf.keras.layers.Input(shape=([2, 1]))
in1Min42777 = tf.keras.layers.Input(shape=([2, 1]))
in0Mul24684 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul24684 = tf.keras.layers.Input(shape=([2, 2]))

Min42777 = keras.layers.Minimum(name = 'Min42777', )([in0Min42777,in1Min42777])
Res23725 = keras.layers.Reshape((2, 1, 1), name = 'Res23725', )(Min42777)
Res17240 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res17240', )(Res23725)
Glo896 = keras.layers.GlobalAveragePooling3D(name = 'Glo896', )(Res17240)
Res36435 = keras.layers.Reshape((1, 1), name = 'Res36435', )(Glo896)
Mul24684 = keras.layers.Multiply(name = 'Mul24684', )([in0Mul24684,in1Mul24684])
Res23235 = keras.layers.Reshape((2, 2, 1), name = 'Res23235', )(Mul24684)
Dep12436 = keras.layers.DepthwiseConv2D((2, 1),strides=(2, 2), padding='valid', name = 'Dep12436', )(Res23235)
Res34047 = keras.layers.Reshape((1, 1), name = 'Res34047', )(Dep12436)
Ave11804 = keras.layers.Average(name = 'Ave11804', )([Res36435,Res34047])
model = tf.keras.models.Model(inputs=[in0Min42777,in1Min42777,in0Mul24684,in1Mul24684], outputs=Ave11804)
w = model.get_layer('Dep12436').get_weights() 
w[0] = np.array([[[[0.9697]]], [[[0.9903]]]])
w[1] = np.array([0])
model.get_layer('Dep12436').set_weights(w) 
in0Min42777 = tf.constant([[[0.2647], [0.7018]]])
in1Min42777 = tf.constant([[[0.9561], [0.7205]]])
in0Mul24684 = tf.constant([[[0.2525, 0.4833], [0.012, 0.7982]]])
in1Mul24684 = tf.constant([[[0.0365, 0.3494], [0.8685, 0.5024]]])
print (np.array2string(model.predict([in0Min42777,in1Min42777,in0Mul24684,in1Mul24684],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave11804.png')

LMin42777 = minimum_layer([[[[0.2647], [0.7018]]], [[[0.9561], [0.7205]]]], Min42777), 
LRes23725 = reshape_layer(Min42777, [2, 1, 1], Res23725), 
LRes17240 = reshape_layer(Res23725, [2, 1, 1, 1], Res17240), 
LGlo896 = global_average_pooling3D_layer(Res17240, Glo896), 
LRes36435 = reshape_layer(Glo896, [1, 1], Res36435), 
LMul24684 = multiply_layer([[[[0.2525, 0.4833], [0.012, 0.7982]]], [[[0.0365, 0.3494], [0.8685, 0.5024]]]], Mul24684), 
LRes23235 = reshape_layer(Mul24684, [2, 2, 1], Res23235), 
LDep12436 = depthwise_conv2D_layer(Res23235, 2, 1,[[[[0.9697]]], [[[0.9903]]]],[0], 2, 2, false, Dep12436), 
LRes34047 = reshape_layer(Dep12436, [1, 1], Res34047), 
LAve11804 = average_layer([Res36435,Res34047], Ave11804), 
exec_layers([LMin42777,LRes23725,LRes17240,LGlo896,LRes36435,LMul24684,LRes23235,LDep12436,LRes34047,LAve11804],["Min42777","Res23725","Res17240","Glo896","Res36435","Mul24684","Res23235","Dep12436","Res34047","Ave11804"],Ave11804,"Ave11804")

Actual (Unparsed): [[[0.2512539]]]

Expected (Unparsed): [[[0.25125395211249996]]]

Actual:   [[[0.2513]]]

Expected: [[[0.2513]]]