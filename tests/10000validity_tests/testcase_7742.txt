import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add58155 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Add58155 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Sep4546 = tf.keras.layers.Input(shape=([2, 2, 1]))

Add58155 = keras.layers.Add(name = 'Add58155', )([in0Add58155,in1Add58155])
Den23002 = keras.layers.Dense(2,name = 'Den23002', )(Add58155)
Res34180 = keras.layers.Reshape((1, 2), name = 'Res34180', )(Den23002)
Fla81976 = keras.layers.Flatten(name = 'Fla81976', )(Res34180)
Sep4546 = keras.layers.SeparableConv2D(2, (1, 1),strides=(1, 1), padding='valid', name = 'Sep4546', )(in0Sep4546)
Res33148 = keras.layers.Reshape((2, 4), name = 'Res33148', )(Sep4546)
Glo41453 = keras.layers.GlobalMaxPool1D(name = 'Glo41453', )(Res33148)
Res94157 = keras.layers.Reshape((4, 1), name = 'Res94157', )(Glo41453)
Res45097 = keras.layers.Reshape((4, 1, 1), name = 'Res45097', )(Res94157)
Con18947 = keras.layers.Conv2D(2, (3, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con18947', )(Res45097)
Res90801 = keras.layers.Reshape((2, 2), name = 'Res90801', )(Con18947)
Glo33226 = keras.layers.GlobalMaxPool1D(name = 'Glo33226', )(Res90801)
Max23109 = keras.layers.Maximum(name = 'Max23109', )([Fla81976,Glo33226])
model = tf.keras.models.Model(inputs=[in0Add58155,in1Add58155,in0Sep4546], outputs=Max23109)
w = model.get_layer('Den23002').get_weights() 
w[0] = np.array([[0.8087, 0.3421], [0.9352, 0.6543]])
w[1] = np.array([0.6454, 0.5583])
model.get_layer('Den23002').set_weights(w) 
w = model.get_layer('Sep4546').get_weights() 
w[0] = np.array([[[[0.4612]]]])
w[1] = np.array([[[[0.33, 0.9989]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep4546').set_weights(w) 
w = model.get_layer('Con18947').get_weights() 
w[0] = np.array([[[[0.8765, 0.0185]]], [[[0, 0.0913]]], [[[0.1141, 0.7077]]]])
w[1] = np.array([0, 0])
model.get_layer('Con18947').set_weights(w) 
in0Add58155 = tf.constant([[[[0.625, 0.722]]]])
in1Add58155 = tf.constant([[[[0.9666, 0.2641]]]])
in0Sep4546 = tf.constant([[[[0.3216], [0.2286]], [[0.0661], [0.6754]]]])
print (np.array2string(model.predict([in0Add58155,in1Add58155,in0Sep4546],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max23109.png')

LAdd58155 = add_layer([[[[[0.625, 0.722]]]], [[[[0.9666, 0.2641]]]]], Add58155), 
LDen23002 = dense_layer(Add58155, [[0.8087, 0.3421], [0.9352, 0.6543]],[0.6454, 0.5583], Den23002), 
LRes34180 = reshape_layer(Den23002, [1, 2], Res34180), 
LFla81976 = flatten_layer(Res34180, Fla81976), 
LSep4546 = separable_conv2D_layer([[[[0.3216], [0.2286]], [[0.0661], [0.6754]]]], 1, 1,[[[[[0.4612]]]],[[[[0.33, 0.9989]]]]],[0, 0], 1, 1, false, Sep4546), 
LRes33148 = reshape_layer(Sep4546, [2, 4], Res33148), 
LGlo41453 = global_max_pool1D_layer(Res33148, Glo41453), 
LRes94157 = reshape_layer(Glo41453, [4, 1], Res94157), 
LRes45097 = reshape_layer(Res94157, [4, 1, 1], Res45097), 
LCon18947 = conv2D_layer(Res45097, 3, 1,[[[[0.8765, 0.0185]]], [[[0, 0.0913]]], [[[0.1141, 0.7077]]]],[0, 0], 1, 1, false, 1, 1, Con18947), 
LRes90801 = reshape_layer(Con18947, [2, 2], Res90801), 
LGlo33226 = global_max_pool1D_layer(Res90801, Glo33226), 
LMax23109 = maximum_layer([Fla81976,Glo33226], Max23109), 
exec_layers([LAdd58155,LDen23002,LRes34180,LFla81976,LSep4546,LRes33148,LGlo41453,LRes94157,LRes45097,LCon18947,LRes90801,LGlo33226,LMax23109],["Add58155","Den23002","Res34180","Fla81976","Sep4546","Res33148","Glo41453","Res94157","Res45097","Con18947","Res90801","Glo33226","Max23109"],Max23109,"Max23109")

Actual (Unparsed): [[2.8547276, 1.7479916]]

Expected (Unparsed): [[2.85472764,1.74799159]]

Actual:   [[2.8548, 1.748]]

Expected: [[2.8548, 1.748]]