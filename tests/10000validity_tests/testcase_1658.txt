import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub59216 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub59216 = tf.keras.layers.Input(shape=([2, 3]))
in0Con2015 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Max99268 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Max99268 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Min58027 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Min58027 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Con85197 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))

Sub59216 = keras.layers.Subtract(name = 'Sub59216', )([in0Sub59216,in1Sub59216])
Res5029 = keras.layers.Reshape((2, 3, 1), name = 'Res5029', )(Sub59216)
Res49205 = keras.layers.Reshape((2, 3, 1, 1), name = 'Res49205', )(Res5029)
Cro69222 = keras.layers.Cropping3D(cropping=((1, 0), (1, 0), (0, 0)), name = 'Cro69222', )(Res49205)
ReL69781 = keras.layers.ReLU(max_value=4.428137171730572, negative_slope=6.404730965956456, threshold=9.474320110560996, name = 'ReL69781', )(Cro69222)
Zer6362 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (1, 0)), name = 'Zer6362', )(ReL69781)
Con2015 = keras.layers.Concatenate(axis=4, name = 'Con2015', )([Zer6362,in0Con2015])
Max99268 = keras.layers.Maximum(name = 'Max99268', )([in0Max99268,in1Max99268])
Res89072 = keras.layers.Reshape((2, 1, 1), name = 'Res89072', )(Max99268)
Dep59248 = keras.layers.DepthwiseConv2D((1, 1),strides=(2, 2), padding='valid', name = 'Dep59248', )(Res89072)
Res22705 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res22705', )(Dep59248)
Con36011 = keras.layers.Conv3DTranspose(3, (1, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con36011', )(Res22705)
Zer2313 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (1, 0)), name = 'Zer2313', )(Con36011)
Min58027 = keras.layers.Minimum(name = 'Min58027', )([in0Min58027,in1Min58027])
Con85197 = keras.layers.Concatenate(axis=4, name = 'Con85197', )([Min58027,in0Con85197])
Ave78505 = keras.layers.Average(name = 'Ave78505', )([Zer2313,Con85197])
Min85137 = keras.layers.Minimum(name = 'Min85137', )([Con2015,Ave78505])
model = tf.keras.models.Model(inputs=[in0Sub59216,in1Sub59216,in0Con2015,in0Max99268,in1Max99268,in0Min58027,in1Min58027,in0Con85197], outputs=Min85137)
w = model.get_layer('Dep59248').get_weights() 
w[0] = np.array([[[[0.12]]]])
w[1] = np.array([0])
model.get_layer('Dep59248').set_weights(w) 
w = model.get_layer('Con36011').get_weights() 
w[0] = np.array([[[[[0.3018], [0.6082], [0.7354]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con36011').set_weights(w) 
in0Sub59216 = tf.constant([[[0.3581, 0.3379, 0.1188], [0.1809, 0.1692, 0.5191]]])
in1Sub59216 = tf.constant([[[0.0271, 0.0588, 0.0616], [0.4796, 0.8328, 0.9293]]])
in0Con2015 = tf.constant([[[[[0.6745, 0.9356], [0.2311, 0.7425]], [[0.1062, 0.9422], [0.7419, 0.4055]]]]])
in0Max99268 = tf.constant([[[[[0.837]]], [[[0.7901]]]]])
in1Max99268 = tf.constant([[[[[0.9769]]], [[[0.1042]]]]])
in0Min58027 = tf.constant([[[[[0.763], [0.9313]], [[0.8979], [0.2284]]]]])
in1Min58027 = tf.constant([[[[[0.9269], [0.136]], [[0.2595], [0.747]]]]])
in0Con85197 = tf.constant([[[[[0.4151, 0.5633], [0.6358, 0.228]], [[0.3169, 0.7568], [0.585, 0.116]]]]])
print (np.array2string(model.predict([in0Sub59216,in1Sub59216,in0Con2015,in0Max99268,in1Max99268,in0Min58027,in1Min58027,in0Con85197],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min85137.png')

LSub59216 = subtract_layer([[[0.3581, 0.3379, 0.1188], [0.1809, 0.1692, 0.5191]]], [[[0.0271, 0.0588, 0.0616], [0.4796, 0.8328, 0.9293]]], Sub59216), 
LRes5029 = reshape_layer(Sub59216, [2, 3, 1], Res5029), 
LRes49205 = reshape_layer(Res5029, [2, 3, 1, 1], Res49205), 
LCro69222 = cropping3D_layer(Res49205, 1, 0, 1, 0, 0, 0, Cro69222), 
LReL69781 = relu_layer(Cro69222, 4.428137171730572, 6.404730965956456, 9.474320110560996, ReL69781), 
LZer6362 = zero_padding3D_layer(ReL69781, 0, 0, 0, 0, 1, 0, Zer6362), 
LCon2015 = concatenate_layer([Zer6362,[[[[[0.6745, 0.9356], [0.2311, 0.7425]], [[0.1062, 0.9422], [0.7419, 0.4055]]]]]], 4, Con2015), 
LMax99268 = maximum_layer([[[[[[0.837]]], [[[0.7901]]]]], [[[[[0.9769]]], [[[0.1042]]]]]], Max99268), 
LRes89072 = reshape_layer(Max99268, [2, 1, 1], Res89072), 
LDep59248 = depthwise_conv2D_layer(Res89072, 1, 1,[[[[0.12]]]],[0], 2, 2, false, Dep59248), 
LRes22705 = reshape_layer(Dep59248, [1, 1, 1, 1], Res22705), 
LCon36011 = conv3D_transpose_layer(Res22705, 1, 1, 1,[[[[[0.3018], [0.6082], [0.7354]]]]],[0, 0, 0], 1, 1, 1, false, Con36011), 
LZer2313 = zero_padding3D_layer(Con36011, 0, 0, 1, 0, 1, 0, Zer2313), 
LMin58027 = minimum_layer([[[[[[0.763], [0.9313]], [[0.8979], [0.2284]]]]], [[[[[0.9269], [0.136]], [[0.2595], [0.747]]]]]], Min58027), 
LCon85197 = concatenate_layer([Min58027,[[[[[0.4151, 0.5633], [0.6358, 0.228]], [[0.3169, 0.7568], [0.585, 0.116]]]]]], 4, Con85197), 
LAve78505 = average_layer([Zer2313,Con85197], Ave78505), 
LMin85137 = minimum_layer([Con2015,Ave78505], Min85137), 
exec_layers([LSub59216,LRes5029,LRes49205,LCro69222,LReL69781,LZer6362,LCon2015,LMax99268,LRes89072,LDep59248,LRes22705,LCon36011,LZer2313,LMin58027,LCon85197,LAve78505,LMin85137],["Sub59216","Res5029","Res49205","Cro69222","ReL69781","Zer6362","Con2015","Max99268","Res89072","Dep59248","Res22705","Con36011","Zer2313","Min58027","Con85197","Ave78505","Min85137"],Min85137,"Min85137")

Actual (Unparsed): [[[[[0.0000000, 0.2075500, 0.2816500], [-64.9306507, 0.2311000, 0.1140000]], [[0.0000000, 0.1062000, 0.3784000], [-63.3076920, 0.3281490, 0.1011047]]]]]

Expected (Unparsed): [[[[[0,0.20755,0.28165],[-64.9306508625027,0.2311,0.114]],[[0,0.1062,0.3784],[-63.30769203572934,0.32814903479999996,0.1011047356]]]]]

Actual:   [[[[[0, 0.2076, 0.2817], [-64.9306, 0.2311, 0.114]], [[0, 0.1062, 0.3784], [-63.3076, 0.3282, 0.1012]]]]]

Expected: [[[[[0, 0.2076, 0.2817], [-64.9306, 0.2311, 0.114]], [[0, 0.1062, 0.3784], [-63.3076, 0.3282, 0.1012]]]]]