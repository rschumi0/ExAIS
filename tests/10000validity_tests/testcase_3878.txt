import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add25106 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Add25106 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Max11531 = tf.keras.layers.Input(shape=([2, 1]))
in1Max11531 = tf.keras.layers.Input(shape=([2, 1]))
in0Con89699 = tf.keras.layers.Input(shape=([2, 2]))
in0Con30330 = tf.keras.layers.Input(shape=([2, 3, 1]))
in0Ave15719 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Ave15719 = tf.keras.layers.Input(shape=([1, 2, 2]))

Add25106 = keras.layers.Add(name = 'Add25106', )([in0Add25106,in1Add25106])
Res49729 = keras.layers.Reshape((1, 2, 2), name = 'Res49729', )(Add25106)
Res89382 = keras.layers.Reshape((1, 4), name = 'Res89382', )(Res49729)
Con71636 = keras.layers.Conv1D(3, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con71636', )(Res89382)
Zer46157 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer46157', )(Con71636)
Max11531 = keras.layers.Maximum(name = 'Max11531', )([in0Max11531,in1Max11531])
Con89699 = keras.layers.Concatenate(axis=2, name = 'Con89699', )([Max11531,in0Con89699])
Sub98259 = keras.layers.Subtract(name = 'Sub98259', )([Zer46157,Con89699])
Res23078 = keras.layers.Reshape((2, 3, 1), name = 'Res23078', )(Sub98259)
Con30330 = keras.layers.Concatenate(axis=3, name = 'Con30330', )([Res23078,in0Con30330])
Ave15719 = keras.layers.Average(name = 'Ave15719', )([in0Ave15719,in1Ave15719])
Zer69836 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer69836', )(Ave15719)
Ave60891 = keras.layers.Average(name = 'Ave60891', )([Con30330,Zer69836])
model = tf.keras.models.Model(inputs=[in0Add25106,in1Add25106,in0Max11531,in1Max11531,in0Con89699,in0Con30330,in0Ave15719,in1Ave15719], outputs=Ave60891)
w = model.get_layer('Con71636').get_weights() 
w[0] = np.array([[[0.3937, 0.6795, 0.8915], [0.0617, 0.1562, 0.3719], [0.0375, 0.0597, 0.7957], [0.7662, 0.3794, 0.796]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con71636').set_weights(w) 
in0Add25106 = tf.constant([[[[[0.1883], [0.0973]], [[0.8814], [0.9654]]]]])
in1Add25106 = tf.constant([[[[[0.8008], [0.1823]], [[0.0737], [0.8322]]]]])
in0Max11531 = tf.constant([[[0.8366], [0.9989]]])
in1Max11531 = tf.constant([[[0.9379], [0.3738]]])
in0Con89699 = tf.constant([[[0.9987, 0.3314], [0.0795, 0.5621]]])
in0Con30330 = tf.constant([[[[0.1086], [0.7891], [0.9272]], [[0.8183], [0.932], [0.8204]]]])
in0Ave15719 = tf.constant([[[[0.5993, 0.2754], [0.3911, 0.2638]]]])
in1Ave15719 = tf.constant([[[[0.4743, 0.5779], [0.5926, 0.1572]]]])
print (np.array2string(model.predict([in0Add25106,in1Add25106,in0Max11531,in1Max11531,in0Con89699,in0Con30330,in0Ave15719,in1Ave15719],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave60891.png')

LAdd25106 = add_layer([[[[[[0.1883], [0.0973]], [[0.8814], [0.9654]]]]], [[[[[0.8008], [0.1823]], [[0.0737], [0.8322]]]]]], Add25106), 
LRes49729 = reshape_layer(Add25106, [1, 2, 2], Res49729), 
LRes89382 = reshape_layer(Res49729, [1, 4], Res89382), 
LCon71636 = conv1D_layer(Res89382, 1,[[[0.3937, 0.6795, 0.8915], [0.0617, 0.1562, 0.3719], [0.0375, 0.0597, 0.7957], [0.7662, 0.3794, 0.796]]],[0, 0, 0], 1, false, 1, Con71636), 
LZer46157 = zero_padding1D_layer(Con71636, 1, 0, Zer46157), 
LMax11531 = maximum_layer([[[[0.8366], [0.9989]]], [[[0.9379], [0.3738]]]], Max11531), 
LCon89699 = concatenate_layer([Max11531,[[[0.9987, 0.3314], [0.0795, 0.5621]]]], 2, Con89699), 
LSub98259 = subtract_layer(Zer46157,Con89699, Sub98259), 
LRes23078 = reshape_layer(Sub98259, [2, 3, 1], Res23078), 
LCon30330 = concatenate_layer([Res23078,[[[[0.1086], [0.7891], [0.9272]], [[0.8183], [0.932], [0.8204]]]]], 3, Con30330), 
LAve15719 = average_layer([[[[[0.5993, 0.2754], [0.3911, 0.2638]]]], [[[[0.4743, 0.5779], [0.5926, 0.1572]]]]], Ave15719), 
LZer69836 = zero_padding2D_layer(Ave15719, 1, 0, 1, 0, Zer69836), 
LAve60891 = average_layer([Con30330,Zer69836], Ave60891), 
exec_layers([LAdd25106,LRes49729,LRes89382,LCon71636,LZer46157,LMax11531,LCon89699,LSub98259,LRes23078,LCon30330,LAve15719,LZer69836,LAve60891],["Add25106","Res49729","Res89382","Con71636","Zer46157","Max11531","Con89699","Sub98259","Res23078","Con30330","Ave15719","Zer69836","Ave60891"],Ave60891,"Ave60891")

Actual (Unparsed): [[[[-0.4689500, 0.0543000], [-0.4993500, 0.3945500], [-0.1657000, 0.4636000]], [[0.4104487, 0.4091500], [0.9560480, 0.6793250], [1.5531893, 0.5154500]]]]

Expected (Unparsed): [[[[-0.46895,0.0543],[-0.49935,0.39455],[-0.1657,0.4636]],[[0.41044867999999995,0.40915],[0.9560479400000002,0.679325],[1.55318928,0.51545]]]]

Actual:   [[[[-0.4689, 0.0543], [-0.4993, 0.3946], [-0.1657, 0.4636]], [[0.4105, 0.4092], [0.9561, 0.6794], [1.5532, 0.5155]]]]

Expected: [[[[-0.4689, 0.0543], [-0.4993, 0.3946], [-0.1657, 0.4636]], [[0.4105, 0.4092], [0.9561, 0.6794], [1.5532, 0.5155]]]]