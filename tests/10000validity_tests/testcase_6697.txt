import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot10388 = tf.keras.layers.Input(shape=([2]))
in1Dot10388 = tf.keras.layers.Input(shape=([2]))
in0Con44052 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Sub45974 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Sub45974 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con61667 = tf.keras.layers.Input(shape=([2, 6, 4, 2]))
in0Con36965 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))

Dot10388 = keras.layers.Dot(axes=(1, 1), name = 'Dot10388', )([in0Dot10388,in1Dot10388])
Res95851 = keras.layers.Reshape((1, 1), name = 'Res95851', )(Dot10388)
Res63769 = keras.layers.Reshape((1, 1, 1), name = 'Res63769', )(Res95851)
Zer59652 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer59652', )(Res63769)
Con44052 = keras.layers.Concatenate(axis=3, name = 'Con44052', )([Zer59652,in0Con44052])
Sub45974 = keras.layers.Subtract(name = 'Sub45974', )([in0Sub45974,in1Sub45974])
Min20673 = keras.layers.Minimum(name = 'Min20673', )([Con44052,Sub45974])
Res40983 = keras.layers.Reshape((2, 2, 2, 1), name = 'Res40983', )(Min20673)
Zer92429 = keras.layers.ZeroPadding3D(padding=((0, 0), (4, 0), (2, 0)), name = 'Zer92429', )(Res40983)
Con61667 = keras.layers.Concatenate(axis=4, name = 'Con61667', )([Zer92429,in0Con61667])
Con36965 = keras.layers.Conv3DTranspose(3, (2, 1, 1),strides=(1, 3, 2), padding='same', name = 'Con36965', )(in0Con36965)
Ave56144 = keras.layers.Average(name = 'Ave56144', )([Con61667,Con36965])
model = tf.keras.models.Model(inputs=[in0Dot10388,in1Dot10388,in0Con44052,in0Sub45974,in1Sub45974,in0Con61667,in0Con36965], outputs=Ave56144)
w = model.get_layer('Con36965').get_weights() 
w[0] = np.array([[[[[0.1233, 0.3142], [0.4722, 0.5035], [0.8258, 0.4449]]]], [[[[0.1767, 0.7013], [0.5759, 0.1956], [0.4459, 0.384]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con36965').set_weights(w) 
in0Dot10388 = tf.constant([[0.6301, 0.0127]])
in1Dot10388 = tf.constant([[0.3873, 0.9085]])
in0Con44052 = tf.constant([[[[0.5786], [0.432]], [[0.1665], [0.2148]]]])
in0Sub45974 = tf.constant([[[[0.6205, 0.7787], [0.1089, 0.2998]], [[0.9116, 0.0235], [0.6406, 0.4744]]]])
in1Sub45974 = tf.constant([[[[0.0846, 0.8062], [0.7456, 0.9972]], [[0.5738, 0.4936], [0.4888, 0.7822]]]])
in0Con61667 = tf.constant([[[[[0.1429, 0.0458], [0.7625, 0.8948], [0.2116, 0.6699], [0.1563, 0.3644]], [[0.9929, 0.8013], [0.5226, 0.4289], [0.7682, 0.0129], [0.2066, 0.3478]], [[0.3402, 0.8865], [0.354, 0.513], [0.8913, 0.9437], [0.4822, 0.3579]], [[0.3202, 0.6171], [0.315, 0.6739], [0.2483, 0.6701], [0.4952, 0.5472]], [[0.9034, 0.3067], [0.7608, 0.0369], [0.254, 0.4521], [0.7888, 0.5348]], [[0.0951, 0.328], [0.1901, 0.4713], [0.2652, 0.5037], [0.0738, 0.6592]]], [[[0.816, 0.0543], [0.1907, 0.1055], [0.7449, 0.3301], [0.9099, 0.5641]], [[0.8558, 0.1051], [0.1905, 0.4477], [0.4167, 0.5516], [0.2652, 0.9774]], [[0.5458, 0.5734], [0.971, 0.6026], [0.6792, 0.5144], [0.5354, 0.7992]], [[0.0443, 0.159], [0.1499, 0.3205], [0.799, 0.2408], [0.8546, 0.8602]], [[0.3802, 0.384], [0.0907, 0.8693], [0.6528, 0.517], [0.7805, 0.9651]], [[0.648, 0.3167], [0.946, 0.9647], [0.0371, 0.1715], [0.6847, 0.0836]]]]])
in0Con36965 = tf.constant([[[[[0.5177, 0.5729], [0.7176, 0.4659]], [[0.6305, 0.1716], [0.2667, 0.4525]]], [[[0.4735, 0.9917], [0.7122, 0.8079]], [[0.4683, 0.6907], [0.7358, 0.3937]]]]])
print (np.array2string(model.predict([in0Dot10388,in1Dot10388,in0Con44052,in0Sub45974,in1Sub45974,in0Con61667,in0Con36965],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave56144.png')

LDot10388 = dot_layer([[0.6301, 0.0127]], [[0.3873, 0.9085]], 1, 1, Dot10388), 
LRes95851 = reshape_layer(Dot10388, [1, 1], Res95851), 
LRes63769 = reshape_layer(Res95851, [1, 1, 1], Res63769), 
LZer59652 = zero_padding2D_layer(Res63769, 1, 0, 1, 0, Zer59652), 
LCon44052 = concatenate_layer([Zer59652,[[[[0.5786], [0.432]], [[0.1665], [0.2148]]]]], 3, Con44052), 
LSub45974 = subtract_layer([[[[0.6205, 0.7787], [0.1089, 0.2998]], [[0.9116, 0.0235], [0.6406, 0.4744]]]], [[[[0.0846, 0.8062], [0.7456, 0.9972]], [[0.5738, 0.4936], [0.4888, 0.7822]]]], Sub45974), 
LMin20673 = minimum_layer([Con44052,Sub45974], Min20673), 
LRes40983 = reshape_layer(Min20673, [2, 2, 2, 1], Res40983), 
LZer92429 = zero_padding3D_layer(Res40983, 0, 0, 4, 0, 2, 0, Zer92429), 
LCon61667 = concatenate_layer([Zer92429,[[[[[0.1429, 0.0458], [0.7625, 0.8948], [0.2116, 0.6699], [0.1563, 0.3644]], [[0.9929, 0.8013], [0.5226, 0.4289], [0.7682, 0.0129], [0.2066, 0.3478]], [[0.3402, 0.8865], [0.354, 0.513], [0.8913, 0.9437], [0.4822, 0.3579]], [[0.3202, 0.6171], [0.315, 0.6739], [0.2483, 0.6701], [0.4952, 0.5472]], [[0.9034, 0.3067], [0.7608, 0.0369], [0.254, 0.4521], [0.7888, 0.5348]], [[0.0951, 0.328], [0.1901, 0.4713], [0.2652, 0.5037], [0.0738, 0.6592]]], [[[0.816, 0.0543], [0.1907, 0.1055], [0.7449, 0.3301], [0.9099, 0.5641]], [[0.8558, 0.1051], [0.1905, 0.4477], [0.4167, 0.5516], [0.2652, 0.9774]], [[0.5458, 0.5734], [0.971, 0.6026], [0.6792, 0.5144], [0.5354, 0.7992]], [[0.0443, 0.159], [0.1499, 0.3205], [0.799, 0.2408], [0.8546, 0.8602]], [[0.3802, 0.384], [0.0907, 0.8693], [0.6528, 0.517], [0.7805, 0.9651]], [[0.648, 0.3167], [0.946, 0.9647], [0.0371, 0.1715], [0.6847, 0.0836]]]]]], 4, Con61667), 
LCon36965 = conv3D_transpose_layer([[[[[0.5177, 0.5729], [0.7176, 0.4659]], [[0.6305, 0.1716], [0.2667, 0.4525]]], [[[0.4735, 0.9917], [0.7122, 0.8079]], [[0.4683, 0.6907], [0.7358, 0.3937]]]]], 2, 1, 1,[[[[[0.1233, 0.3142], [0.4722, 0.5035], [0.8258, 0.4449]]]], [[[[0.1767, 0.7013], [0.5759, 0.1956], [0.4459, 0.384]]]]],[0, 0, 0], 1, 3, 2, true, Con36965), 
LAve56144 = average_layer([Con61667,Con36965], Ave56144), 
exec_layers([LDot10388,LRes95851,LRes63769,LZer59652,LCon44052,LSub45974,LMin20673,LRes40983,LZer92429,LCon61667,LCon36965,LAve56144],["Dot10388","Res95851","Res63769","Zer59652","Con44052","Sub45974","Min20673","Res40983","Zer92429","Con61667","Con36965","Ave56144"],Ave56144,"Ave56144")

Actual (Unparsed): [[[[[0.1219188, 0.3379066, 0.3640999], [0.0000000, 0.3812500, 0.4474000], [0.1174329, 0.3925157, 0.7348865], [0.0000000, 0.0781500, 0.1822000]], [[0.0000000, 0.4964500, 0.4006500], [0.0000000, 0.2613000, 0.2144500], [0.0000000, 0.3841000, 0.0064500], [0.0000000, 0.1033000, 0.1739000]], [[0.0000000, 0.1701000, 0.4432500], [0.0000000, 0.1770000, 0.2565000], [0.0000000, 0.4456500, 0.4718500], [0.0000000, 0.2411000, 0.1789500]], [[0.0658287, 0.3521614, 0.6070559], [0.0000000, 0.1575000, 0.3369500], [0.0875298, 0.3010347, 0.5458290], [0.0000000, 0.2476000, 0.2736000]], [[0.0000000, 0.4517000, 0.1533500], [0.0000000, 0.3804000, 0.0184500], [0.0000000, 0.1270000, 0.2260500], [-0.0137500, 0.3944000, 0.2674000]], [[0.0000000, 0.0475500, 0.1640000], [0.0000000, 0.0950500, 0.2356500], [-0.3183500, 0.1326000, 0.2518500], [-0.3487000, 0.0369000, 0.3296000]]], [[[0.4316135, 0.9745552, 0.6686798], [0.0000000, 0.0953500, 0.0527500], [0.3975960, 0.9961872, 0.8882764], [0.0000000, 0.4549500, 0.2820500]], [[0.0000000, 0.4279000, 0.0525500], [0.0000000, 0.0952500, 0.2238500], [0.0000000, 0.2083500, 0.2758000], [0.0000000, 0.1326000, 0.4887000]], [[0.0000000, 0.2729000, 0.2867000], [0.0000000, 0.4855000, 0.3013000], [0.0000000, 0.3396000, 0.2572000], [0.0000000, 0.2677000, 0.3996000]], [[0.2532559, 0.5049343, 0.6000245], [0.0000000, 0.0749500, 0.1602500], [0.2894444, 0.7933871, 0.6581312], [0.0000000, 0.4273000, 0.4301000]], [[0.0000000, 0.1901000, 0.1920000], [0.0000000, 0.0453500, 0.4346500], [0.0000000, 0.3264000, 0.2585000], [-0.2350500, 0.3902500, 0.4825500]], [[0.0000000, 0.3240000, 0.1583500], [0.0000000, 0.4730000, 0.4823500], [0.0759000, 0.0185500, 0.0857500], [-0.1539000, 0.3423500, 0.0418000]]]]]

Expected (Unparsed): [[[[[0.121918795,0.337906545,0.364099935],[0,0.38125,0.4474],[0.11743292999999999,0.392515685,0.734886495],[0,0.07815,0.1822]],[[0,0.49645,0.40065],[0,0.2613,0.21445],[0,0.3841,0.00645],[0,0.1033,0.1739]],[[0,0.1701,0.44325],[0,0.177,0.2565],[0,0.44565,0.47185],[0,0.2411,0.17895]],[[0.065828685,0.35216135,0.6070558699999999],[0,0.1575,0.33695],[0.08752980499999999,0.301034745,0.545829055],[0,0.2476,0.2736]],[[0,0.4517,0.15335],[0,0.3804,0.01845],[0,0.127,0.22605],[-0.01375000000000004,0.3944,0.2674]],[[0,0.04755,0.164],[0,0.09505,0.23565],[-0.31835,0.1326,0.25185],[-0.3487,0.0369,0.3296]]],[[[0.43161352499999994,0.97455516,0.6686798300000001],[0,0.09535,0.05275],[0.39759601499999997,0.9961871849999999,0.888276455],[0,0.45495,0.28205]],[[0,0.4279,0.05255],[0,0.09525,0.22385],[0,0.20835,0.2758],[0,0.1326,0.4887]],[[0,0.2729,0.2867],[0,0.4855,0.3013],[0,0.3396,0.2572],[0,0.2677,0.3996]],[[0.25325588,0.5049343099999999,0.60002446],[0,0.07495,0.16025],[0.28944441000000004,0.79338712,0.6581311499999999],[0,0.4273,0.4301]],[[0,0.1901,0.192],[0,0.04535,0.43465],[0,0.3264,0.2585],[-0.23504999999999998,0.39025,0.48255]],[[0,0.324,0.15835],[0,0.473,0.48235],[0.07589999999999997,0.01855,0.08575],[-0.1539,0.34235,0.0418]]]]]

Actual:   [[[[[0.122, 0.338, 0.3641], [0, 0.3813, 0.4474], [0.1175, 0.3926, 0.7349], [0, 0.0782, 0.1822]], [[0, 0.4965, 0.4007], [0, 0.2613, 0.2145], [0, 0.3841, 0.0065], [0, 0.1033, 0.1739]], [[0, 0.1701, 0.4433], [0, 0.177, 0.2565], [0, 0.4457, 0.4719], [0, 0.2411, 0.179]], [[0.0659, 0.3522, 0.6071], [0, 0.1575, 0.337], [0.0876, 0.3011, 0.5459], [0, 0.2476, 0.2736]], [[0, 0.4517, 0.1534], [0, 0.3804, 0.0185], [0, 0.127, 0.2261], [-0.0137, 0.3944, 0.2674]], [[0, 0.0476, 0.164], [0, 0.0951, 0.2357], [-0.3183, 0.1326, 0.2519], [-0.3487, 0.0369, 0.3296]]], [[[0.4317, 0.9746, 0.6687], [0, 0.0954, 0.0528], [0.3976, 0.9962, 0.8883], [0, 0.455, 0.2821]], [[0, 0.4279, 0.0526], [0, 0.0953, 0.2239], [0, 0.2084, 0.2758], [0, 0.1326, 0.4887]], [[0, 0.2729, 0.2867], [0, 0.4855, 0.3013], [0, 0.3396, 0.2572], [0, 0.2677, 0.3996]], [[0.2533, 0.505, 0.6001], [0, 0.075, 0.1603], [0.2895, 0.7934, 0.6582], [0, 0.4273, 0.4301]], [[0, 0.1901, 0.192], [0, 0.0454, 0.4347], [0, 0.3264, 0.2585], [-0.235, 0.3903, 0.4826]], [[0, 0.324, 0.1584], [0, 0.473, 0.4824], [0.0759, 0.0186, 0.0858], [-0.1539, 0.3424, 0.0418]]]]]

Expected: [[[[[0.122, 0.338, 0.3641], [0, 0.3813, 0.4474], [0.1175, 0.3926, 0.7349], [0, 0.0782, 0.1822]], [[0, 0.4965, 0.4007], [0, 0.2613, 0.2145], [0, 0.3841, 0.0065], [0, 0.1033, 0.1739]], [[0, 0.1701, 0.4433], [0, 0.177, 0.2565], [0, 0.4457, 0.4719], [0, 0.2411, 0.179]], [[0.0659, 0.3522, 0.6071], [0, 0.1575, 0.337], [0.0876, 0.3011, 0.5459], [0, 0.2476, 0.2736]], [[0, 0.4517, 0.1534], [0, 0.3804, 0.0185], [0, 0.127, 0.2261], [-0.0137, 0.3944, 0.2674]], [[0, 0.0476, 0.164], [0, 0.0951, 0.2357], [-0.3183, 0.1326, 0.2519], [-0.3487, 0.0369, 0.3296]]], [[[0.4317, 0.9746, 0.6687], [0, 0.0954, 0.0528], [0.3976, 0.9962, 0.8883], [0, 0.455, 0.2821]], [[0, 0.4279, 0.0526], [0, 0.0953, 0.2239], [0, 0.2084, 0.2758], [0, 0.1326, 0.4887]], [[0, 0.2729, 0.2867], [0, 0.4855, 0.3013], [0, 0.3396, 0.2572], [0, 0.2677, 0.3996]], [[0.2533, 0.505, 0.6001], [0, 0.075, 0.1603], [0.2895, 0.7934, 0.6582], [0, 0.4273, 0.4301]], [[0, 0.1901, 0.192], [0, 0.0454, 0.4347], [0, 0.3264, 0.2585], [-0.235, 0.3903, 0.4826]], [[0, 0.324, 0.1584], [0, 0.473, 0.4824], [0.0759, 0.0186, 0.0858], [-0.1539, 0.3424, 0.0418]]]]]