import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min77906 = tf.keras.layers.Input(shape=([1, 2]))
in1Min77906 = tf.keras.layers.Input(shape=([1, 2]))
in0Con57481 = tf.keras.layers.Input(shape=([1, 2, 1, 3]))
in0Fla32157 = tf.keras.layers.Input(shape=([1, 1, 1]))

Min77906 = keras.layers.Minimum(name = 'Min77906', )([in0Min77906,in1Min77906])
Con69138 = keras.layers.Conv1D(2, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con69138', )(Min77906)
Res34664 = keras.layers.Reshape((1, 2, 1), name = 'Res34664', )(Con69138)
Res40062 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res40062', )(Res34664)
Con57481 = keras.layers.Concatenate(axis=4, name = 'Con57481', )([Res40062,in0Con57481])
Fla32157 = keras.layers.Flatten(name = 'Fla32157', )(in0Fla32157)
Res46287 = keras.layers.Reshape((1, 1), name = 'Res46287', )(Fla32157)
Res99513 = keras.layers.Reshape((1, 1, 1), name = 'Res99513', )(Res46287)
Res87117 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res87117', )(Res99513)
Con95149 = keras.layers.Conv3D(4, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con95149', )(Res87117)
Sof42472 = keras.layers.Softmax(axis=1, name = 'Sof42472', )(Con95149)
Zer71539 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (0, 0)), name = 'Zer71539', )(Sof42472)
Ave83396 = keras.layers.Average(name = 'Ave83396', )([Con57481,Zer71539])
model = tf.keras.models.Model(inputs=[in0Min77906,in1Min77906,in0Con57481,in0Fla32157], outputs=Ave83396)
w = model.get_layer('Con69138').get_weights() 
w[0] = np.array([[[0.9865, 0.0379], [0.4297, 0.6976]]])
w[1] = np.array([0, 0])
model.get_layer('Con69138').set_weights(w) 
w = model.get_layer('Con95149').get_weights() 
w[0] = np.array([[[[[0.9388, 0.1268, 0.3919, 0.9309]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con95149').set_weights(w) 
in0Min77906 = tf.constant([[[0.6437, 0.8335]]])
in1Min77906 = tf.constant([[[0.1679, 0.1349]]])
in0Con57481 = tf.constant([[[[[0.6187, 0.6392, 0.6221]], [[0.1114, 0.8633, 0.2241]]]]])
in0Fla32157 = tf.constant([[[[1.1676]]]])
print (np.array2string(model.predict([in0Min77906,in1Min77906,in0Con57481,in0Fla32157],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave83396.png')

LMin77906 = minimum_layer([[[[0.6437, 0.8335]]], [[[0.1679, 0.1349]]]], Min77906), 
LCon69138 = conv1D_layer(Min77906, 1,[[[0.9865, 0.0379], [0.4297, 0.6976]]],[0, 0], 1, true, 1, Con69138), 
LRes34664 = reshape_layer(Con69138, [1, 2, 1], Res34664), 
LRes40062 = reshape_layer(Res34664, [1, 2, 1, 1], Res40062), 
LCon57481 = concatenate_layer([Res40062,[[[[[0.6187, 0.6392, 0.6221]], [[0.1114, 0.8633, 0.2241]]]]]], 4, Con57481), 
LFla32157 = flatten_layer([[[[1.1676]]]], Fla32157), 
LRes46287 = reshape_layer(Fla32157, [1, 1], Res46287), 
LRes99513 = reshape_layer(Res46287, [1, 1, 1], Res99513), 
LRes87117 = reshape_layer(Res99513, [1, 1, 1, 1], Res87117), 
LCon95149 = conv3D_layer(Res87117, 1, 1, 1,[[[[[0.9388, 0.1268, 0.3919, 0.9309]]]]],[0, 0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con95149), 
LSof42472 = softmax_layer(Con95149, 1, Sof42472), 
LZer71539 = zero_padding3D_layer(Sof42472, 0, 0, 1, 0, 0, 0, Zer71539), 
LAve83396 = average_layer([Con57481,Zer71539], Ave83396), 
exec_layers([LMin77906,LCon69138,LRes34664,LRes40062,LCon57481,LFla32157,LRes46287,LRes99513,LRes87117,LCon95149,LSof42472,LZer71539,LAve83396],["Min77906","Con69138","Res34664","Res40062","Con57481","Fla32157","Res46287","Res99513","Res87117","Con95149","Sof42472","Zer71539","Ave83396"],Ave83396,"Ave83396")

Actual (Unparsed): [[[[[0.1117999, 0.3093500, 0.3196000, 0.3110500]], [[0.5502348, 0.5557000, 0.9316500, 0.6120500]]]]]

Expected (Unparsed): [[[[[0.11179994000000001,0.30935,0.3196,0.31105]],[[0.550234825,0.5557,0.93165,0.61205]]]]]

Actual:   [[[[[0.1118, 0.3094, 0.3196, 0.3111]], [[0.5503, 0.5557, 0.9317, 0.6121]]]]]

Expected: [[[[[0.1118, 0.3094, 0.3196, 0.3111]], [[0.5503, 0.5557, 0.9317, 0.6121]]]]]