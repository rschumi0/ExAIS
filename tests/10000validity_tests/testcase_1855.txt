import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul87438 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Mul87438 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in0Con64021 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Sub45600 = tf.keras.layers.Input(shape=([2, 2, 3, 2]))
in1Sub45600 = tf.keras.layers.Input(shape=([2, 2, 3, 2]))

Mul87438 = keras.layers.Multiply(name = 'Mul87438', )([in0Mul87438,in1Mul87438])
Res36591 = keras.layers.Reshape((1, 1, 1), name = 'Res36591', )(Mul87438)
Res58503 = keras.layers.Reshape((1, 1), name = 'Res58503', )(Res36591)
GRU15559 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU15559', )(Res58503)
Res84379 = keras.layers.Reshape((2, 1), name = 'Res84379', )(GRU15559)
Res22905 = keras.layers.Reshape((2, 1, 1), name = 'Res22905', )(Res84379)
Glo94001 = keras.layers.GlobalAveragePooling2D(name = 'Glo94001', )(Res22905)
Res69702 = keras.layers.Reshape((1, 1), name = 'Res69702', )(Glo94001)
Res75992 = keras.layers.Reshape((1, 1, 1), name = 'Res75992', )(Res69702)
Con64021 = keras.layers.Concatenate(axis=3, name = 'Con64021', )([Res75992,in0Con64021])
Sub45600 = keras.layers.Subtract(name = 'Sub45600', )([in0Sub45600,in1Sub45600])
Res28852 = keras.layers.Reshape((2, 2, 6), name = 'Res28852', )(Sub45600)
Sep56462 = keras.layers.SeparableConv2D(2, (2, 2),strides=(2, 2), padding='same', name = 'Sep56462', )(Res28852)
Mul373 = keras.layers.Multiply(name = 'Mul373', )([Con64021,Sep56462])
model = tf.keras.models.Model(inputs=[in0Mul87438,in1Mul87438,in0Con64021,in0Sub45600,in1Sub45600], outputs=Mul373)
w = model.get_layer('GRU15559').get_weights() 
w[0] = np.array([[6, 9, 10, 7, 3, 5]])
w[1] = np.array([[8, 9, 6, 7, 5, 1], [6, 6, 3, 8, 7, 8]])
w[2] = np.array([[6, 9, 7, 10, 8, 8], [6, 7, 6, 2, 5, 3]])
model.get_layer('GRU15559').set_weights(w) 
w = model.get_layer('Sep56462').get_weights() 
w[0] = np.array([[[[0.6581], [0.409], [0.1985], [0.6462], [0.1337], [0.9293]], [[0.626], [0.5493], [0.6147], [0.0077], [0.0649], [0.8117]]], [[[0.0182], [0.3165], [0.2723], [0.2801], [0.994], [0.7913]], [[0.9101], [0.1019], [0.2357], [0.8135], [0.0598], [0.728]]]])
w[1] = np.array([[[[0.5039, 0.2248], [0.3411, 0.5773], [0.6473, 0.9353], [0.1028, 0.317], [0.727, 0.3799], [0.4335, 0.5903]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep56462').set_weights(w) 
in0Mul87438 = tf.constant([[[[[0.1241]]]]])
in1Mul87438 = tf.constant([[[[[0.3256]]]]])
in0Con64021 = tf.constant([[[[0.194]]]])
in0Sub45600 = tf.constant([[[[[0.3761, 0.1293], [0.0615, 0.3762], [0.4493, 0.4666]], [[0.0198, 0.3475], [0.5966, 0.7086], [0.3519, 0.5938]]], [[[0.8993, 0.8758], [0.2197, 0.1501], [0.5831, 0.8488]], [[0.0832, 0.5117], [0.1115, 0.1802], [0.6194, 0.2181]]]]])
in1Sub45600 = tf.constant([[[[[0.4784, 0.6674], [0.6041, 0.5866], [0.805, 0.0098]], [[0.9067, 0.9369], [0.5327, 0.5741], [0.765, 0.3029]]], [[[0.6105, 0.149], [0.9369, 0.9359], [0.0712, 0.5824]], [[0.1572, 0.8691], [0.3103, 0.3627], [0.5673, 0.4385]]]]])
print (np.array2string(model.predict([in0Mul87438,in1Mul87438,in0Con64021,in0Sub45600,in1Sub45600],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul373.png')

LMul87438 = multiply_layer([[[[[[0.1241]]]]], [[[[[0.3256]]]]]], Mul87438), 
LRes36591 = reshape_layer(Mul87438, [1, 1, 1], Res36591), 
LRes58503 = reshape_layer(Res36591, [1, 1], Res58503), 
LGRU15559 = gru_layer(Res58503,[[6, 9, 10, 7, 3, 5]],[[8, 9, 6, 7, 5, 1], [6, 6, 3, 8, 7, 8]],[[6, 9, 7, 10, 8, 8], [6, 7, 6, 2, 5, 3]], true, GRU15559), 
LRes84379 = reshape_layer(GRU15559, [2, 1], Res84379), 
LRes22905 = reshape_layer(Res84379, [2, 1, 1], Res22905), 
LGlo94001 = global_average_pooling2D_layer(Res22905, Glo94001), 
LRes69702 = reshape_layer(Glo94001, [1, 1], Res69702), 
LRes75992 = reshape_layer(Res69702, [1, 1, 1], Res75992), 
LCon64021 = concatenate_layer([Res75992,[[[[0.194]]]]], 3, Con64021), 
LSub45600 = subtract_layer([[[[[0.3761, 0.1293], [0.0615, 0.3762], [0.4493, 0.4666]], [[0.0198, 0.3475], [0.5966, 0.7086], [0.3519, 0.5938]]], [[[0.8993, 0.8758], [0.2197, 0.1501], [0.5831, 0.8488]], [[0.0832, 0.5117], [0.1115, 0.1802], [0.6194, 0.2181]]]]], [[[[[0.4784, 0.6674], [0.6041, 0.5866], [0.805, 0.0098]], [[0.9067, 0.9369], [0.5327, 0.5741], [0.765, 0.3029]]], [[[0.6105, 0.149], [0.9369, 0.9359], [0.0712, 0.5824]], [[0.1572, 0.8691], [0.3103, 0.3627], [0.5673, 0.4385]]]]], Sub45600), 
LRes28852 = reshape_layer(Sub45600, [2, 2, 6], Res28852), 
LSep56462 = separable_conv2D_layer(Res28852, 2, 2,[[[[[0.6581], [0.409], [0.1985], [0.6462], [0.1337], [0.9293]], [[0.626], [0.5493], [0.6147], [0.0077], [0.0649], [0.8117]]], [[[0.0182], [0.3165], [0.2723], [0.2801], [0.994], [0.7913]], [[0.9101], [0.1019], [0.2357], [0.8135], [0.0598], [0.728]]]],[[[[0.5039, 0.2248], [0.3411, 0.5773], [0.6473, 0.9353], [0.1028, 0.317], [0.727, 0.3799], [0.4335, 0.5903]]]]],[0, 0], 2, 2, true, Sep56462), 
LMul373 = multiply_layer([Con64021,Sep56462], Mul373), 
exec_layers([LMul87438,LRes36591,LRes58503,LGRU15559,LRes84379,LRes22905,LGlo94001,LRes69702,LRes75992,LCon64021,LSub45600,LRes28852,LSep56462,LMul373],["Mul87438","Res36591","Res58503","GRU15559","Res84379","Res22905","Glo94001","Res69702","Res75992","Con64021","Sub45600","Res28852","Sep56462","Mul373"],Mul373,"Mul373")

Actual (Unparsed): [[[[-0.0000002, -0.0427287]]]]

Expected (Unparsed): [[[[-2.2270646338515464e-7,-0.04272868623030001]]]]

Actual:   [[[[-0, -0.0427]]]]

Expected: [[[[-0, -0.0427]]]]