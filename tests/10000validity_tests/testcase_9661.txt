import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sim90442 = tf.keras.layers.Input(shape=([3, 2]))
in0Dot10534 = tf.keras.layers.Input(shape=([2]))
in1Dot10534 = tf.keras.layers.Input(shape=([2]))
in0Con10389 = tf.keras.layers.Input(shape=([2]))

Sim90442 = keras.layers.SimpleRNN(2,name = 'Sim90442', )(in0Sim90442)
Res57532 = keras.layers.Reshape((2, 1), name = 'Res57532', )(Sim90442)
LST71550 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST71550', )(Res57532)
Dot10534 = keras.layers.Dot(axes=(1, 1), name = 'Dot10534', )([in0Dot10534,in1Dot10534])
Con10389 = keras.layers.Concatenate(axis=1, name = 'Con10389', )([Dot10534,in0Con10389])
Min45134 = keras.layers.Minimum(name = 'Min45134', )([LST71550,Con10389])
Res703 = keras.layers.Reshape((3, 1), name = 'Res703', )(Min45134)
Per37151 = keras.layers.Permute((2,1), name = 'Per37151',)(Res703)
model = tf.keras.models.Model(inputs=[in0Sim90442,in0Dot10534,in1Dot10534,in0Con10389], outputs=Per37151)
w = model.get_layer('Sim90442').get_weights() 
w[0] = np.array([[3, 5], [5, 5]])
w[1] = np.array([[9, 10], [9, 1]])
w[2] = np.array([2, 6])
model.get_layer('Sim90442').set_weights(w) 
w = model.get_layer('LST71550').get_weights() 
w[0] = np.array([[9, 5, 10, 7, 4, 4, 8, 1, 10, 2, 5, 10]])
w[1] = np.array([[6, 4, 8, 9, 9, 9, 8, 5, 8, 2, 2, 2], [1, 2, 5, 4, 10, 2, 2, 7, 4, 1, 8, 1], [6, 2, 10, 10, 5, 3, 4, 8, 6, 10, 10, 6]])
w[2] = np.array([3, 5, 4, 3, 5, 4, 10, 8, 9, 7, 9, 10])
model.get_layer('LST71550').set_weights(w) 
in0Sim90442 = tf.constant([[[1, 5], [5, 5], [9, 1]]])
in0Dot10534 = tf.constant([[0.1361, 0.1738]])
in1Dot10534 = tf.constant([[0.1422, 0.7696]])
in0Con10389 = tf.constant([[0.6025, 0.1808]])
print (np.array2string(model.predict([in0Sim90442,in0Dot10534,in1Dot10534,in0Con10389],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Per37151.png')

LSim90442 = simple_rnn_layer([[[1, 5], [5, 5], [9, 1]]],[[3, 5], [5, 5]],[[9, 10], [9, 1]],[2, 6], Sim90442), 
LRes57532 = reshape_layer(Sim90442, [2, 1], Res57532), 
LLST71550 = lstm_layer(Res57532,[[9, 5, 10, 7, 4, 4, 8, 1, 10, 2, 5, 10]],[[6, 4, 8, 9, 9, 9, 8, 5, 8, 2, 2, 2], [1, 2, 5, 4, 10, 2, 2, 7, 4, 1, 8, 1], [6, 2, 10, 10, 5, 3, 4, 8, 6, 10, 10, 6]],[3, 5, 4, 3, 5, 4, 10, 8, 9, 7, 9, 10], LST71550), 
LDot10534 = dot_layer([[0.1361, 0.1738]], [[0.1422, 0.7696]], 1, 1, Dot10534), 
LCon10389 = concatenate_layer([Dot10534,[[0.6025, 0.1808]]], 1, Con10389), 
LMin45134 = minimum_layer([LST71550,Con10389], Min45134), 
LRes703 = reshape_layer(Min45134, [3, 1], Res703), 
LPer37151 = permute_layer(Res703, 2,1, Per37151), 
exec_layers([LSim90442,LRes57532,LLST71550,LDot10534,LCon10389,LMin45134,LRes703,LPer37151],["Sim90442","Res57532","LST71550","Dot10534","Con10389","Min45134","Res703","Per37151"],Per37151,"Per37151")

Actual (Unparsed): [[[0.1531099, 0.6025000, 0.1808000]]]

Expected (Unparsed): [[[0.15310990000000002,0.6025,0.1808]]]

Actual:   [[[0.1532, 0.6025, 0.1808]]]

Expected: [[[0.1532, 0.6025, 0.1808]]]