import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot773 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot773 = tf.keras.layers.Input(shape=([3, 2]))
in0GRU80791 = tf.keras.layers.Input(shape=([1, 3]))

Dot773 = keras.layers.Dot(axes=(1, 1), name = 'Dot773', )([in0Dot773,in1Dot773])
Lea38244 = keras.layers.LeakyReLU(alpha=5.621193179901094, name = 'Lea38244', )(Dot773)
Max22420 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max22420', )(Lea38244)
Res43307 = keras.layers.Reshape((2, 2, 1), name = 'Res43307', )(Max22420)
GRU80791 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU80791', )(in0GRU80791)
Res18960 = keras.layers.Reshape((2, 1), name = 'Res18960', )(GRU80791)
Res92257 = keras.layers.Reshape((2, 1, 1), name = 'Res92257', )(Res18960)
Ave53272 = keras.layers.AveragePooling2D(pool_size=(1, 1), strides=(10, 1), padding='same', name = 'Ave53272', )(Res92257)
Zer61855 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer61855', )(Ave53272)
Ave36171 = keras.layers.Average(name = 'Ave36171', )([Res43307,Zer61855])
model = tf.keras.models.Model(inputs=[in0Dot773,in1Dot773,in0GRU80791], outputs=Ave36171)
w = model.get_layer('GRU80791').get_weights() 
w[0] = np.array([[3, 3, 6, 5, 8, 1], [6, 5, 10, 10, 5, 5], [3, 4, 4, 5, 10, 2]])
w[1] = np.array([[7, 3, 5, 1, 8, 10], [2, 1, 5, 1, 4, 5]])
w[2] = np.array([[5, 1, 7, 1, 10, 1], [8, 4, 1, 8, 8, 9]])
model.get_layer('GRU80791').set_weights(w) 
in0Dot773 = tf.constant([[[0.0864, 0.4639], [0.7863, 0.7821], [0.5163, 0.9088]]])
in1Dot773 = tf.constant([[[0.3407, 0.3278], [0.9568, 0.6591], [0.411, 0.032]]])
in0GRU80791 = tf.constant([[[5, 9, 10]]])
print (np.array2string(model.predict([in0Dot773,in1Dot773,in0GRU80791],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave36171.png')

LDot773 = dot_layer([[[0.0864, 0.4639], [0.7863, 0.7821], [0.5163, 0.9088]]], [[[0.3407, 0.3278], [0.9568, 0.6591], [0.411, 0.032]]], 1, 1, Dot773), 
LLea38244 = leaky_relu_layer(Dot773, 5.621193179901094, Lea38244), 
LMax22420 = max_pool1D_layer(Lea38244, 1, Max22420), 
LRes43307 = reshape_layer(Max22420, [2, 2, 1], Res43307), 
LGRU80791 = gru_layer([[[5, 9, 10]]],[[3, 3, 6, 5, 8, 1], [6, 5, 10, 10, 5, 5], [3, 4, 4, 5, 10, 2]],[[7, 3, 5, 1, 8, 10], [2, 1, 5, 1, 4, 5]],[[5, 1, 7, 1, 10, 1], [8, 4, 1, 8, 8, 9]], true, GRU80791), 
LRes18960 = reshape_layer(GRU80791, [2, 1], Res18960), 
LRes92257 = reshape_layer(Res18960, [2, 1, 1], Res92257), 
LAve53272 = average_pooling2D_layer(Res92257, 1, 1, 10, 1, true, Ave53272), 
LZer61855 = zero_padding2D_layer(Ave53272, 1, 0, 1, 0, Zer61855), 
LAve36171 = average_layer([Res43307,Zer61855], Ave36171), 
exec_layers([LDot773,LLea38244,LMax22420,LRes43307,LGRU80791,LRes18960,LRes92257,LAve53272,LZer61855,LAve36171],["Dot773","Lea38244","Max22420","Res43307","GRU80791","Res18960","Res92257","Ave53272","Zer61855","Ave36171"],Ave36171,"Ave36171")

Actual (Unparsed): [[[[0.4969838], [0.2815469]], [[0.6399404], [0.3483151]]]]

Expected (Unparsed): [[[[0.49698380999999997],[0.281546925]],[[0.6399404049999999],[0.348315065]]]]

Actual:   [[[[0.497], [0.2816]], [[0.64], [0.3484]]]]

Expected: [[[[0.497], [0.2816]], [[0.64], [0.3484]]]]