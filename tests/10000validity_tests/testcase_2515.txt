import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max52994 = tf.keras.layers.Input(shape=([1, 2]))
in1Max52994 = tf.keras.layers.Input(shape=([1, 2]))
in0Dot57364 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot57364 = tf.keras.layers.Input(shape=([3, 2]))

Max52994 = keras.layers.Maximum(name = 'Max52994', )([in0Max52994,in1Max52994])
LST26640 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST26640', )(Max52994)
Res87731 = keras.layers.Reshape((1, 1), name = 'Res87731', )(LST26640)
Dot57364 = keras.layers.Dot(axes=(2, 2), name = 'Dot57364', )([in0Dot57364,in1Dot57364])
Res69721 = keras.layers.Reshape((3, 3, 1), name = 'Res69721', )(Dot57364)
Max61313 = keras.layers.MaxPool2D(pool_size=(2, 3), name = 'Max61313', )(Res69721)
Res92280 = keras.layers.Reshape((1, 1), name = 'Res92280', )(Max61313)
Ave13449 = keras.layers.Average(name = 'Ave13449', )([Res87731,Res92280])
model = tf.keras.models.Model(inputs=[in0Max52994,in1Max52994,in0Dot57364,in1Dot57364], outputs=Ave13449)
w = model.get_layer('LST26640').get_weights() 
w[0] = np.array([[7, 6, 7, 7], [8, 9, 3, 8]])
w[1] = np.array([[1, 5, 3, 9]])
w[2] = np.array([5, 10, 9, 9])
model.get_layer('LST26640').set_weights(w) 
in0Max52994 = tf.constant([[[0.1229, 0.9739]]])
in1Max52994 = tf.constant([[[0.97, 0.769]]])
in0Dot57364 = tf.constant([[[0.1518, 0.2653], [0.6312, 0.0914], [0.634, 0.1439]]])
in1Dot57364 = tf.constant([[[0.9312, 0.336], [0.2671, 0.9348], [0.479, 0.632]]])
print (np.array2string(model.predict([in0Max52994,in1Max52994,in0Dot57364,in1Dot57364],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave13449.png')

LMax52994 = maximum_layer([[[[0.1229, 0.9739]]], [[[0.97, 0.769]]]], Max52994), 
LLST26640 = lstm_layer(Max52994,[[7, 6, 7, 7], [8, 9, 3, 8]],[[1, 5, 3, 9]],[5, 10, 9, 9], LST26640), 
LRes87731 = reshape_layer(LST26640, [1, 1], Res87731), 
LDot57364 = dot_layer([[[0.1518, 0.2653], [0.6312, 0.0914], [0.634, 0.1439]]], [[[0.9312, 0.336], [0.2671, 0.9348], [0.479, 0.632]]], 2, 2, Dot57364), 
LRes69721 = reshape_layer(Dot57364, [3, 3, 1], Res69721), 
LMax61313 = max_pool2D_layer(Res69721, 2, 3, Max61313), 
LRes92280 = reshape_layer(Max61313, [1, 1], Res92280), 
LAve13449 = average_layer([Res87731,Res92280], Ave13449), 
exec_layers([LMax52994,LLST26640,LRes87731,LDot57364,LRes69721,LMax61313,LRes92280,LAve13449],["Max52994","LST26640","Res87731","Dot57364","Res69721","Max61313","Res92280","Ave13449"],Ave13449,"Ave13449")

Actual (Unparsed): [[[0.6900390]]]

Expected (Unparsed): [[[0.6900389972980905]]]

Actual:   [[[0.6901]]]

Expected: [[[0.6901]]]