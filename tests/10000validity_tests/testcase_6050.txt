import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub51837 = tf.keras.layers.Input(shape=([2]))
in1Sub51837 = tf.keras.layers.Input(shape=([2]))
in0Zer54165 = tf.keras.layers.Input(shape=([1, 2]))

Sub51837 = keras.layers.Subtract(name = 'Sub51837', )([in0Sub51837,in1Sub51837])
Res31988 = keras.layers.Reshape((2, 1), name = 'Res31988', )(Sub51837)
Res58927 = keras.layers.Reshape((2, 1, 1), name = 'Res58927', )(Res31988)
Zer73122 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer73122', )(Res58927)
Zer54165 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer54165', )(in0Zer54165)
Mas57757 = keras.layers.Masking(mask_value=2, name = 'Mas57757', )(Zer54165)
Res7324 = keras.layers.Reshape((3, 2, 1), name = 'Res7324', )(Mas57757)
Max36879 = keras.layers.MaxPool2D(pool_size=(3, 1), strides=(1, 1), padding='same', name = 'Max36879', )(Res7324)
Sub65283 = keras.layers.Subtract(name = 'Sub65283', )([Zer73122,Max36879])
Res64667 = keras.layers.Reshape((3, 2), name = 'Res64667', )(Sub65283)
LST80118 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST80118', )(Res64667)
model = tf.keras.models.Model(inputs=[in0Sub51837,in1Sub51837,in0Zer54165], outputs=LST80118)
w = model.get_layer('LST80118').get_weights() 
w[0] = np.array([[10, 9, 2, 3], [4, 5, 8, 4]])
w[1] = np.array([[3, 2, 4, 8]])
w[2] = np.array([1, 9, 2, 7])
model.get_layer('LST80118').set_weights(w) 
in0Sub51837 = tf.constant([[0.8338, 0.5656]])
in1Sub51837 = tf.constant([[0.7953, 0.2019]])
in0Zer54165 = tf.constant([[[1.3105, 1.185]]])
print (np.array2string(model.predict([in0Sub51837,in1Sub51837,in0Zer54165],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST80118.png')

LSub51837 = subtract_layer([[0.8338, 0.5656]], [[0.7953, 0.2019]], Sub51837), 
LRes31988 = reshape_layer(Sub51837, [2, 1], Res31988), 
LRes58927 = reshape_layer(Res31988, [2, 1, 1], Res58927), 
LZer73122 = zero_padding2D_layer(Res58927, 1, 0, 1, 0, Zer73122), 
LZer54165 = zero_padding1D_layer([[[1.3105, 1.185]]], 1, 1, Zer54165), 
LMas57757 = masking_layer(Zer54165, 2, Mas57757), 
LRes7324 = reshape_layer(Mas57757, [3, 2, 1], Res7324), 
LMax36879 = max_pool2D_layer(Res7324, 3, 1, 1, 1, true, Max36879), 
LSub65283 = subtract_layer(Zer73122,Max36879, Sub65283), 
LRes64667 = reshape_layer(Sub65283, [3, 2], Res64667), 
LLST80118 = lstm_layer(Res64667,[[10, 9, 2, 3], [4, 5, 8, 4]],[[3, 2, 4, 8]],[1, 9, 2, 7], LST80118), 
exec_layers([LSub51837,LRes31988,LRes58927,LZer73122,LZer54165,LMas57757,LRes7324,LMax36879,LSub65283,LRes64667,LLST80118],["Sub51837","Res31988","Res58927","Zer73122","Zer54165","Mas57757","Res7324","Max36879","Sub65283","Res64667","LST80118"],LST80118,"LST80118")

Actual (Unparsed): [[-0.0000001]]

Expected (Unparsed): [[-9.238667156005412e-8]]

Actual:   [[-0]]

Expected: [[-0]]