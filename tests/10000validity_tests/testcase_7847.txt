import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub25686 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Sub25686 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0LST88482 = tf.keras.layers.Input(shape=([2, 1]))
in0Con11459 = tf.keras.layers.Input(shape=([2, 1]))
in0Ave34121 = tf.keras.layers.Input(shape=([2, 2]))
in0Con70419 = tf.keras.layers.Input(shape=([4, 2, 1]))
in0Add8056 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Add8056 = tf.keras.layers.Input(shape=([2, 2, 2]))

Sub25686 = keras.layers.Subtract(name = 'Sub25686', )([in0Sub25686,in1Sub25686])
Res19807 = keras.layers.Reshape((2, 4), name = 'Res19807', )(Sub25686)
LST88482 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST88482', )(in0LST88482)
Res94700 = keras.layers.Reshape((2, 1), name = 'Res94700', )(LST88482)
Con11459 = keras.layers.Concatenate(axis=2, name = 'Con11459', )([Res94700,in0Con11459])
Ave34121 = keras.layers.AveragePooling1D(pool_size=(2), strides=(1), padding='valid', name = 'Ave34121', )(in0Ave34121)
Zer53457 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer53457', )(Ave34121)
Min24177 = keras.layers.Minimum(name = 'Min24177', )([Con11459,Zer53457])
Dot12470 = keras.layers.Dot(axes=(1, 1), name = 'Dot12470', )([Res19807,Min24177])
Res83845 = keras.layers.Reshape((4, 2, 1), name = 'Res83845', )(Dot12470)
Con70419 = keras.layers.Concatenate(axis=3, name = 'Con70419', )([Res83845,in0Con70419])
Add8056 = keras.layers.Add(name = 'Add8056', )([in0Add8056,in1Add8056])
Zer81092 = keras.layers.ZeroPadding2D(padding=((2, 0), (0, 0)), name = 'Zer81092', )(Add8056)
Ave28251 = keras.layers.Average(name = 'Ave28251', )([Con70419,Zer81092])
model = tf.keras.models.Model(inputs=[in0Sub25686,in1Sub25686,in0LST88482,in0Con11459,in0Ave34121,in0Con70419,in0Add8056,in1Add8056], outputs=Ave28251)
w = model.get_layer('LST88482').get_weights() 
w[0] = np.array([[9, 4, 1, 6, 1, 7, 10, 6]])
w[1] = np.array([[7, 1, 2, 9, 3, 6, 8, 7], [6, 1, 10, 2, 4, 9, 2, 1]])
w[2] = np.array([5, 3, 8, 3, 8, 8, 6, 1])
model.get_layer('LST88482').set_weights(w) 
in0Sub25686 = tf.constant([[[[0.1582, 0.0627], [0.9336, 0.8151]], [[0.0478, 0.7241], [0.867, 0.8489]]]])
in1Sub25686 = tf.constant([[[[0.2618, 0.8668], [0.0839, 0.9305]], [[0.128, 0.9209], [0.5463, 0.3619]]]])
in0LST88482 = tf.constant([[[2], [1]]])
in0Con11459 = tf.constant([[[0.4384], [0.876]]])
in0Ave34121 = tf.constant([[[1.8744, 1.6451], [1.2472, 1.1364]]])
in0Con70419 = tf.constant([[[[0.6726], [0.426]], [[0.1414], [0.2455]], [[0.1803], [0.1904]], [[0.5277], [0.7445]]]])
in0Add8056 = tf.constant([[[[0.9413, 0.9055], [0.6749, 0.134]], [[0.1368, 0.7671], [0.4334, 0.9677]]]])
in1Add8056 = tf.constant([[[[0.5959, 0.8935], [0.9835, 0.1951]], [[0.2468, 0.2852], [0.3198, 0.4951]]]])
print (np.array2string(model.predict([in0Sub25686,in1Sub25686,in0LST88482,in0Con11459,in0Ave34121,in0Con70419,in0Add8056,in1Add8056],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave28251.png')

LSub25686 = subtract_layer([[[[0.1582, 0.0627], [0.9336, 0.8151]], [[0.0478, 0.7241], [0.867, 0.8489]]]], [[[[0.2618, 0.8668], [0.0839, 0.9305]], [[0.128, 0.9209], [0.5463, 0.3619]]]], Sub25686), 
LRes19807 = reshape_layer(Sub25686, [2, 4], Res19807), 
LLST88482 = lstm_layer([[[2], [1]]],[[9, 4, 1, 6, 1, 7, 10, 6]],[[7, 1, 2, 9, 3, 6, 8, 7], [6, 1, 10, 2, 4, 9, 2, 1]],[5, 3, 8, 3, 8, 8, 6, 1], LST88482), 
LRes94700 = reshape_layer(LST88482, [2, 1], Res94700), 
LCon11459 = concatenate_layer([Res94700,[[[0.4384], [0.876]]]], 2, Con11459), 
LAve34121 = average_pooling1D_layer([[[1.8744, 1.6451], [1.2472, 1.1364]]], 2, 1, false, Ave34121), 
LZer53457 = zero_padding1D_layer(Ave34121, 1, 0, Zer53457), 
LMin24177 = minimum_layer([Con11459,Zer53457], Min24177), 
LDot12470 = dot_layer(Res19807,Min24177, 1, 1, Dot12470), 
LRes83845 = reshape_layer(Dot12470, [4, 2, 1], Res83845), 
LCon70419 = concatenate_layer([Res83845,[[[[0.6726], [0.426]], [[0.1414], [0.2455]], [[0.1803], [0.1904]], [[0.5277], [0.7445]]]]], 3, Con70419), 
LAdd8056 = add_layer([[[[[0.9413, 0.9055], [0.6749, 0.134]], [[0.1368, 0.7671], [0.4334, 0.9677]]]], [[[[0.5959, 0.8935], [0.9835, 0.1951]], [[0.2468, 0.2852], [0.3198, 0.4951]]]]], Add8056), 
LZer81092 = zero_padding2D_layer(Add8056, 2, 0, 0, 0, Zer81092), 
LAve28251 = average_layer([Con70419,Zer81092], Ave28251), 
exec_layers([LSub25686,LRes19807,LLST88482,LRes94700,LCon11459,LAve34121,LZer53457,LMin24177,LDot12470,LRes83845,LCon70419,LAdd8056,LZer81092,LAve28251],["Sub25686","Res19807","LST88482","Res94700","Con11459","Ave34121","Zer53457","Min24177","Dot12470","Res83845","Con70419","Add8056","Zer81092","Ave28251"],Ave28251,"Ave28251")

Actual (Unparsed): [[[[-0.0386568, 0.3363000], [-0.0351276, 0.2130000]], [[-0.0948586, 0.0707000], [-0.0861984, 0.1227500]], [[0.9231790, 0.9896500], [0.9696666, 0.2597500]], [[0.4265365, 0.7900000], [0.5899060, 1.1036500]]]]

Expected (Unparsed): [[[[-0.038656815673399875,0.3363],[-0.035127599999999995,0.213]],[[-0.09485862000654738,0.0707],[-0.08619840000000004,0.12275]],[[0.9231790621753034,0.9896499999999999],[0.9696666,0.25975000000000004]],[[0.42653652410156784,0.79],[0.589906,1.10365]]]]

Actual:   [[[[-0.0386, 0.3363], [-0.0351, 0.213]], [[-0.0948, 0.0707], [-0.0861, 0.1228]], [[0.9232, 0.9897], [0.9697, 0.2598]], [[0.4266, 0.79], [0.59, 1.1037]]]]

Expected: [[[[-0.0386, 0.3363], [-0.0351, 0.213]], [[-0.0948, 0.0707], [-0.0861, 0.1228]], [[0.9232, 0.9897], [0.9697, 0.2598]], [[0.4266, 0.79], [0.59, 1.1037]]]]