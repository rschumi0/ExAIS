import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add1714 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Add1714 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Sof75138 = tf.keras.layers.Input(shape=([2, 1]))
in0Con67432 = tf.keras.layers.Input(shape=([2]))
in0Con99342 = tf.keras.layers.Input(shape=([4, 3, 3]))
in0Con99036 = tf.keras.layers.Input(shape=([2, 2, 1]))

Add1714 = keras.layers.Add(name = 'Add1714', )([in0Add1714,in1Add1714])
Res23477 = keras.layers.Reshape((2, 2), name = 'Res23477', )(Add1714)
Fla32218 = keras.layers.Flatten(name = 'Fla32218', )(Res23477)
Sof75138 = keras.layers.Softmax(axis=1, name = 'Sof75138', input_shape=(2, 1))(in0Sof75138)
GRU35257 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU35257', )(Sof75138)
Con67432 = keras.layers.Concatenate(axis=1, name = 'Con67432', )([GRU35257,in0Con67432])
Add70569 = keras.layers.Add(name = 'Add70569', )([Fla32218,Con67432])
Res70272 = keras.layers.Reshape((4, 1), name = 'Res70272', )(Add70569)
Res23513 = keras.layers.Reshape((4, 1, 1), name = 'Res23513', )(Res70272)
Zer16538 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer16538', )(Res23513)
Con99342 = keras.layers.Concatenate(axis=3, name = 'Con99342', )([Zer16538,in0Con99342])
Con99036 = keras.layers.Conv2DTranspose(3, (2, 2),strides=(1, 1), padding='valid', name = 'Con99036', )(in0Con99036)
Sep55132 = keras.layers.SeparableConv2D(4, (3, 1),strides=(2, 2), padding='valid', name = 'Sep55132', )(Con99036)
Zer13583 = keras.layers.ZeroPadding2D(padding=((3, 0), (1, 0)), name = 'Zer13583', )(Sep55132)
Sub54379 = keras.layers.Subtract(name = 'Sub54379', )([Con99342,Zer13583])
Res23130 = keras.layers.Reshape((4, 3, 4, 1), name = 'Res23130', )(Sub54379)
Con43591 = keras.layers.Conv3D(3, (3, 2, 3),strides=(2, 1, 7), padding='valid', dilation_rate=(1, 1, 1), name = 'Con43591', )(Res23130)
model = tf.keras.models.Model(inputs=[in0Add1714,in1Add1714,in0Sof75138,in0Con67432,in0Con99342,in0Con99036], outputs=Con43591)
w = model.get_layer('GRU35257').get_weights() 
w[0] = np.array([[8, 3, 6, 7, 6, 7]])
w[1] = np.array([[3, 7, 1, 9, 5, 8], [8, 3, 4, 8, 6, 2]])
w[2] = np.array([6, 2, 5, 2, 9, 5])
model.get_layer('GRU35257').set_weights(w) 
w = model.get_layer('Con99036').get_weights() 
w[0] = np.array([[[[0.0227], [0.6837], [0.412]], [[0.078], [0.9482], [0.4656]]], [[[0.3293], [0.4009], [0.5106]], [[0.1206], [0.5902], [0.2251]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con99036').set_weights(w) 
w = model.get_layer('Sep55132').get_weights() 
w[0] = np.array([[[[0.0887], [0.5165], [0.2632]]], [[[0.9071], [0.8411], [0.4635]]], [[[0.3], [0.9473], [0.9483]]]])
w[1] = np.array([[[[0.6294, 0.8811, 0.1059, 0.6453], [0.0341, 0.2654, 0.3934, 0.3703], [0.1788, 0.2209, 0.4822, 0.5896]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep55132').set_weights(w) 
w = model.get_layer('Con43591').get_weights() 
w[0] = np.array([[[[[0.0087, 0.7236, 0.4067]], [[0.509, 0.6638, 0.0356]], [[0.539, 0.3047, 0.4107]]], [[[0.0679, 0.0653, 0.0476]], [[0.2832, 0.4074, 0.6934]], [[0.727, 0.8695, 0.111]]]], [[[[0.6349, 0.4569, 0.5917]], [[0.9199, 0.9666, 0.4523]], [[0.695, 0.9675, 0.8808]]], [[[0.2927, 0.2403, 0.0523]], [[0.1672, 0.9707, 0.659]], [[0.6307, 0.4874, 0.3907]]]], [[[[0.8441, 0.1753, 0.8725]], [[0.0434, 0.3314, 0.4375]], [[0.4046, 0.5604, 0.8514]]], [[[0.4568, 0.2275, 0.7314]], [[0.4242, 0.8664, 0.8703]], [[0.3509, 0.2113, 0.1582]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con43591').set_weights(w) 
in0Add1714 = tf.constant([[[[0.0628], [0.1208]], [[0.7471], [0.752]]]])
in1Add1714 = tf.constant([[[[0.4198], [0.1165]], [[0.6447], [0.1818]]]])
in0Sof75138 = tf.constant([[[0.7887], [0.0082]]])
in0Con67432 = tf.constant([[0.4162, 0.1137]])
in0Con99342 = tf.constant([[[[0.3883, 0.7151, 0.7646], [0.906, 0.9277, 0.86], [0.5166, 0.5239, 0.4658]], [[0.7168, 0.1674, 0.8433], [0.2887, 0.4904, 0.5049], [0.4957, 0.8277, 0.5299]], [[0.7102, 0.0363, 0.7503], [0.3163, 0.7, 0.0846], [0.9764, 0.2856, 0.8361]], [[0.8354, 0.4622, 0.1028], [0.0776, 0.8722, 0.7607], [0.65, 0.345, 0.0106]]]])
in0Con99036 = tf.constant([[[[0.4014], [0.2788]], [[0.0906], [0.2999]]]])
print (np.array2string(model.predict([in0Add1714,in1Add1714,in0Sof75138,in0Con67432,in0Con99342,in0Con99036],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con43591.png')

LAdd1714 = add_layer([[[[[0.0628], [0.1208]], [[0.7471], [0.752]]]], [[[[0.4198], [0.1165]], [[0.6447], [0.1818]]]]], Add1714), 
LRes23477 = reshape_layer(Add1714, [2, 2], Res23477), 
LFla32218 = flatten_layer(Res23477, Fla32218), 
LSof75138 = softmax_layer([[[0.7887], [0.0082]]], 1, Sof75138), 
LGRU35257 = gru_layer(Sof75138,[[8, 3, 6, 7, 6, 7]],[[3, 7, 1, 9, 5, 8], [8, 3, 4, 8, 6, 2]],[6, 2, 5, 2, 9, 5], false, GRU35257), 
LCon67432 = concatenate_layer([GRU35257,[[0.4162, 0.1137]]], 1, Con67432), 
LAdd70569 = add_layer([Fla32218,Con67432], Add70569), 
LRes70272 = reshape_layer(Add70569, [4, 1], Res70272), 
LRes23513 = reshape_layer(Res70272, [4, 1, 1], Res23513), 
LZer16538 = zero_padding2D_layer(Res23513, 0, 0, 2, 0, Zer16538), 
LCon99342 = concatenate_layer([Zer16538,[[[[0.3883, 0.7151, 0.7646], [0.906, 0.9277, 0.86], [0.5166, 0.5239, 0.4658]], [[0.7168, 0.1674, 0.8433], [0.2887, 0.4904, 0.5049], [0.4957, 0.8277, 0.5299]], [[0.7102, 0.0363, 0.7503], [0.3163, 0.7, 0.0846], [0.9764, 0.2856, 0.8361]], [[0.8354, 0.4622, 0.1028], [0.0776, 0.8722, 0.7607], [0.65, 0.345, 0.0106]]]]], 3, Con99342), 
LCon99036 = conv2D_transpose_layer([[[[0.4014], [0.2788]], [[0.0906], [0.2999]]]], 2, 2,[[[[0.0227], [0.6837], [0.412]], [[0.078], [0.9482], [0.4656]]], [[[0.3293], [0.4009], [0.5106]], [[0.1206], [0.5902], [0.2251]]]],[0, 0, 0], 1, 1, false, Con99036), 
LSep55132 = separable_conv2D_layer(Con99036, 3, 1,[[[[[0.0887], [0.5165], [0.2632]]], [[[0.9071], [0.8411], [0.4635]]], [[[0.3], [0.9473], [0.9483]]]],[[[[0.6294, 0.8811, 0.1059, 0.6453], [0.0341, 0.2654, 0.3934, 0.3703], [0.1788, 0.2209, 0.4822, 0.5896]]]]],[0, 0, 0, 0], 2, 2, false, Sep55132), 
LZer13583 = zero_padding2D_layer(Sep55132, 3, 0, 1, 0, Zer13583), 
LSub54379 = subtract_layer(Con99342,Zer13583, Sub54379), 
LRes23130 = reshape_layer(Sub54379, [4, 3, 4, 1], Res23130), 
LCon43591 = conv3D_layer(Res23130, 3, 2, 3,[[[[[0.0087, 0.7236, 0.4067]], [[0.509, 0.6638, 0.0356]], [[0.539, 0.3047, 0.4107]]], [[[0.0679, 0.0653, 0.0476]], [[0.2832, 0.4074, 0.6934]], [[0.727, 0.8695, 0.111]]]], [[[[0.6349, 0.4569, 0.5917]], [[0.9199, 0.9666, 0.4523]], [[0.695, 0.9675, 0.8808]]], [[[0.2927, 0.2403, 0.0523]], [[0.1672, 0.9707, 0.659]], [[0.6307, 0.4874, 0.3907]]]], [[[[0.8441, 0.1753, 0.8725]], [[0.0434, 0.3314, 0.4375]], [[0.4046, 0.5604, 0.8514]]], [[[0.4568, 0.2275, 0.7314]], [[0.4242, 0.8664, 0.8703]], [[0.3509, 0.2113, 0.1582]]]]],[0, 0, 0], 2, 1, 7, false, 1, 1, 1, Con43591), 
exec_layers([LAdd1714,LRes23477,LFla32218,LSof75138,LGRU35257,LCon67432,LAdd70569,LRes70272,LRes23513,LZer16538,LCon99342,LCon99036,LSep55132,LZer13583,LSub54379,LRes23130,LCon43591],["Add1714","Res23477","Fla32218","Sof75138","GRU35257","Con67432","Add70569","Res70272","Res23513","Zer16538","Con99342","Con99036","Sep55132","Zer13583","Sub54379","Res23130","Con43591"],Con43591,"Con43591")

Actual (Unparsed): [[[[[3.0727080, 3.7031196, 2.6198515]], [[4.4578655, 5.1068096, 5.0326040]]]]]

Expected (Unparsed): [[[[[3.07270806,3.70311961,2.6198515]],[[4.457865455784484,5.106809631832507,5.0326039974230286]]]]]

Actual:   [[[[[3.0728, 3.7032, 2.6199]], [[4.4579, 5.1069, 5.0327]]]]]

Expected: [[[[[3.0728, 3.7032, 2.6199]], [[4.4579, 5.1069, 5.0327]]]]]