import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max37565 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Max37565 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Dot47244 = tf.keras.layers.Input(shape=([3]))
in1Dot47244 = tf.keras.layers.Input(shape=([3]))
in0Con75525 = tf.keras.layers.Input(shape=([7]))
in0LST95160 = tf.keras.layers.Input(shape=([2, 1]))
in0Con78491 = tf.keras.layers.Input(shape=([2, 3, 1]))
in0Con80208 = tf.keras.layers.Input(shape=([2, 2, 1]))

Max37565 = keras.layers.Maximum(name = 'Max37565', )([in0Max37565,in1Max37565])
Res88150 = keras.layers.Reshape((2, 4), name = 'Res88150', )(Max37565)
Fla94387 = keras.layers.Flatten(name = 'Fla94387', )(Res88150)
Dot47244 = keras.layers.Dot(axes=(1, 1), name = 'Dot47244', )([in0Dot47244,in1Dot47244])
Con75525 = keras.layers.Concatenate(axis=1, name = 'Con75525', )([Dot47244,in0Con75525])
Max18309 = keras.layers.Maximum(name = 'Max18309', )([Fla94387,Con75525])
Res47532 = keras.layers.Reshape((8, 1), name = 'Res47532', )(Max18309)
Res27141 = keras.layers.Reshape((8, 1, 1), name = 'Res27141', )(Res47532)
Con42695 = keras.layers.Conv2D(2, (4, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con42695', )(Res27141)
Zer54765 = keras.layers.ZeroPadding2D(padding=((0, 0), (4, 0)), name = 'Zer54765', )(Con42695)
LST95160 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST95160', )(in0LST95160)
Res84071 = keras.layers.Reshape((1, 1), name = 'Res84071', )(LST95160)
Res27768 = keras.layers.Reshape((1, 1, 1), name = 'Res27768', )(Res84071)
Zer78845 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer78845', )(Res27768)
Con78491 = keras.layers.Concatenate(axis=3, name = 'Con78491', )([Zer78845,in0Con78491])
Con80208 = keras.layers.Conv2DTranspose(2, (1, 2),strides=(1, 1), padding='valid', name = 'Con80208', )(in0Con80208)
Ave94920 = keras.layers.Average(name = 'Ave94920', )([Con78491,Con80208])
Zer94338 = keras.layers.ZeroPadding2D(padding=((3, 0), (2, 0)), name = 'Zer94338', )(Ave94920)
Mul70199 = keras.layers.Multiply(name = 'Mul70199', )([Zer54765,Zer94338])
model = tf.keras.models.Model(inputs=[in0Max37565,in1Max37565,in0Dot47244,in1Dot47244,in0Con75525,in0LST95160,in0Con78491,in0Con80208], outputs=Mul70199)
w = model.get_layer('Con42695').get_weights() 
w[0] = np.array([[[[0.741, 0.8698]]], [[[0.1134, 0.8167]]], [[[0.9882, 0.9665]]], [[[0.3969, 0.1102]]]])
w[1] = np.array([0, 0])
model.get_layer('Con42695').set_weights(w) 
w = model.get_layer('LST95160').get_weights() 
w[0] = np.array([[5, 2, 8, 10]])
w[1] = np.array([[10, 9, 10, 10]])
w[2] = np.array([7, 4, 7, 4])
model.get_layer('LST95160').set_weights(w) 
w = model.get_layer('Con80208').get_weights() 
w[0] = np.array([[[[0.9104], [0.1302]], [[0.8934], [0.1294]]]])
w[1] = np.array([0, 0])
model.get_layer('Con80208').set_weights(w) 
in0Max37565 = tf.constant([[[[0.9649, 0.4687], [0.0369, 0.9192]], [[0.6975, 0.8184], [0.85, 0.3517]]]])
in1Max37565 = tf.constant([[[[0.7395, 0.2717], [0.9302, 0.8391]], [[0.2632, 0.155], [0.6859, 0.6198]]]])
in0Dot47244 = tf.constant([[0.2492, 0.0112, 0.115]])
in1Dot47244 = tf.constant([[0.4042, 0.0138, 0.0359]])
in0Con75525 = tf.constant([[0.484, 0.9671, 0.3021, 0.3403, 0.312, 0.3922, 0.8575]])
in0LST95160 = tf.constant([[[10], [1]]])
in0Con78491 = tf.constant([[[[0.958], [0.707], [0.9623]], [[0.2526], [0.0619], [0.2713]]]])
in0Con80208 = tf.constant([[[[0.8561], [0.1619]], [[0.2495], [0.3496]]]])
print (np.array2string(model.predict([in0Max37565,in1Max37565,in0Dot47244,in1Dot47244,in0Con75525,in0LST95160,in0Con78491,in0Con80208],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul70199.png')

LMax37565 = maximum_layer([[[[[0.9649, 0.4687], [0.0369, 0.9192]], [[0.6975, 0.8184], [0.85, 0.3517]]]], [[[[0.7395, 0.2717], [0.9302, 0.8391]], [[0.2632, 0.155], [0.6859, 0.6198]]]]], Max37565), 
LRes88150 = reshape_layer(Max37565, [2, 4], Res88150), 
LFla94387 = flatten_layer(Res88150, Fla94387), 
LDot47244 = dot_layer([[0.2492, 0.0112, 0.115]], [[0.4042, 0.0138, 0.0359]], 1, 1, Dot47244), 
LCon75525 = concatenate_layer([Dot47244,[[0.484, 0.9671, 0.3021, 0.3403, 0.312, 0.3922, 0.8575]]], 1, Con75525), 
LMax18309 = maximum_layer([Fla94387,Con75525], Max18309), 
LRes47532 = reshape_layer(Max18309, [8, 1], Res47532), 
LRes27141 = reshape_layer(Res47532, [8, 1, 1], Res27141), 
LCon42695 = conv2D_layer(Res27141, 4, 1,[[[[0.741, 0.8698]]], [[[0.1134, 0.8167]]], [[[0.9882, 0.9665]]], [[[0.3969, 0.1102]]]],[0, 0], 1, 1, false, 1, 1, Con42695), 
LZer54765 = zero_padding2D_layer(Con42695, 0, 0, 4, 0, Zer54765), 
LLST95160 = lstm_layer([[[10], [1]]],[[5, 2, 8, 10]],[[10, 9, 10, 10]],[7, 4, 7, 4], LST95160), 
LRes84071 = reshape_layer(LST95160, [1, 1], Res84071), 
LRes27768 = reshape_layer(Res84071, [1, 1, 1], Res27768), 
LZer78845 = zero_padding2D_layer(Res27768, 1, 0, 2, 0, Zer78845), 
LCon78491 = concatenate_layer([Zer78845,[[[[0.958], [0.707], [0.9623]], [[0.2526], [0.0619], [0.2713]]]]], 3, Con78491), 
LCon80208 = conv2D_transpose_layer([[[[0.8561], [0.1619]], [[0.2495], [0.3496]]]], 1, 2,[[[[0.9104], [0.1302]], [[0.8934], [0.1294]]]],[0, 0], 1, 1, false, Con80208), 
LAve94920 = average_layer([Con78491,Con80208], Ave94920), 
LZer94338 = zero_padding2D_layer(Ave94920, 3, 0, 2, 0, Zer94338), 
LMul70199 = multiply_layer([Zer54765,Zer94338], Mul70199), 
exec_layers([LMax37565,LRes88150,LFla94387,LDot47244,LCon75525,LMax18309,LRes47532,LRes27141,LCon42695,LZer54765,LLST95160,LRes84071,LRes27768,LZer78845,LCon78491,LCon80208,LAve94920,LZer94338,LMul70199],["Max37565","Res88150","Fla94387","Dot47244","Con75525","Max18309","Res47532","Res27141","Con42695","Zer54765","LST95160","Res84071","Res27768","Zer78845","Con78491","Con80208","Ave94920","Zer94338","Mul70199"],Mul70199,"Mul70199")

Actual (Unparsed): [[[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.1378673, 1.1080351]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [1.1423204, 0.3467826]]]]

Expected (Unparsed): [[[[0,0],[0,0],[0,0],[0,0],[0.0,0.0]],[[0,0],[0,0],[0,0],[0,0],[0.0,0.0]],[[0,0],[0,0],[0,0],[0,0],[0.0,0.0]],[[0,0],[0,0],[0.0,0.0],[0.0,0.0],[0.13786729148765337,1.1080350878987093]],[[0,0],[0,0],[0.0,0.0],[0.0,0.0],[1.1423204117120844,0.34678256353263354]]]]

Actual:   [[[[0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0.1379, 1.1081]], [[0, 0], [0, 0], [0, 0], [0, 0], [1.1424, 0.3468]]]]

Expected: [[[[0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0.1379, 1.1081]], [[0, 0], [0, 0], [0, 0], [0, 0], [1.1424, 0.3468]]]]