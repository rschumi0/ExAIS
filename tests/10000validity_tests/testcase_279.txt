import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul52878 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Mul52878 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Max36932 = tf.keras.layers.Input(shape=([1, 2]))
in0Con5026 = tf.keras.layers.Input(shape=([6]))
in0Glo86773 = tf.keras.layers.Input(shape=([1, 2]))
in0Con41129 = tf.keras.layers.Input(shape=([7]))

Mul52878 = keras.layers.Multiply(name = 'Mul52878', )([in0Mul52878,in1Mul52878])
Res21943 = keras.layers.Reshape((2, 2, 2), name = 'Res21943', )(Mul52878)
Res28870 = keras.layers.Reshape((2, 4), name = 'Res28870', )(Res21943)
Fla69432 = keras.layers.Flatten(name = 'Fla69432', )(Res28870)
Max36932 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max36932', )(in0Max36932)
Glo42440 = keras.layers.GlobalMaxPool1D(name = 'Glo42440', )(Max36932)
Con5026 = keras.layers.Concatenate(axis=1, name = 'Con5026', )([Glo42440,in0Con5026])
Add13156 = keras.layers.Add(name = 'Add13156', )([Fla69432,Con5026])
Glo86773 = keras.layers.GlobalMaxPool1D(name = 'Glo86773', )(in0Glo86773)
Res9011 = keras.layers.Reshape((2, 1), name = 'Res9011', )(Glo86773)
Res26890 = keras.layers.Reshape((2, 1, 1), name = 'Res26890', )(Res9011)
Dep22013 = keras.layers.DepthwiseConv2D((2, 1),strides=(1, 1), padding='same', name = 'Dep22013', )(Res26890)
Cro2746 = keras.layers.Cropping2D(cropping=((1, 0), (0, 0)), name = 'Cro2746', )(Dep22013)
Res5074 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res5074', )(Cro2746)
Glo90644 = keras.layers.GlobalAveragePooling3D(name = 'Glo90644', )(Res5074)
Con41129 = keras.layers.Concatenate(axis=1, name = 'Con41129', )([Glo90644,in0Con41129])
Mul77991 = keras.layers.Multiply(name = 'Mul77991', )([Add13156,Con41129])
model = tf.keras.models.Model(inputs=[in0Mul52878,in1Mul52878,in0Max36932,in0Con5026,in0Glo86773,in0Con41129], outputs=Mul77991)
w = model.get_layer('Dep22013').get_weights() 
w[0] = np.array([[[[0.0847]]], [[[0.5041]]]])
w[1] = np.array([0])
model.get_layer('Dep22013').set_weights(w) 
in0Mul52878 = tf.constant([[[[[0.6918], [0.1581]], [[0.2144], [0.5688]]], [[[0.0536], [0.5408]], [[0.6812], [0.6666]]]]])
in1Mul52878 = tf.constant([[[[[0.7919], [0.7883]], [[0.0354], [0.8447]]], [[[0.1765], [0.3537]], [[0.8278], [0.771]]]]])
in0Max36932 = tf.constant([[[1.7808, 1.5637]]])
in0Con5026 = tf.constant([[0.8658, 0.6906, 0.4887, 0.4143, 0.4499, 0.3213]])
in0Glo86773 = tf.constant([[[1.1084, 1.3604]]])
in0Con41129 = tf.constant([[0.6829, 0.3009, 0.5454, 0.5153, 0.767, 0.3762, 0.474]])
print (np.array2string(model.predict([in0Mul52878,in1Mul52878,in0Max36932,in0Con5026,in0Glo86773,in0Con41129],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul77991.png')

LMul52878 = multiply_layer([[[[[[0.6918], [0.1581]], [[0.2144], [0.5688]]], [[[0.0536], [0.5408]], [[0.6812], [0.6666]]]]], [[[[[0.7919], [0.7883]], [[0.0354], [0.8447]]], [[[0.1765], [0.3537]], [[0.8278], [0.771]]]]]], Mul52878), 
LRes21943 = reshape_layer(Mul52878, [2, 2, 2], Res21943), 
LRes28870 = reshape_layer(Res21943, [2, 4], Res28870), 
LFla69432 = flatten_layer(Res28870, Fla69432), 
LMax36932 = max_pool1D_layer([[[1.7808, 1.5637]]], 1, Max36932), 
LGlo42440 = global_max_pool1D_layer(Max36932, Glo42440), 
LCon5026 = concatenate_layer([Glo42440,[[0.8658, 0.6906, 0.4887, 0.4143, 0.4499, 0.3213]]], 1, Con5026), 
LAdd13156 = add_layer([Fla69432,Con5026], Add13156), 
LGlo86773 = global_max_pool1D_layer([[[1.1084, 1.3604]]], Glo86773), 
LRes9011 = reshape_layer(Glo86773, [2, 1], Res9011), 
LRes26890 = reshape_layer(Res9011, [2, 1, 1], Res26890), 
LDep22013 = depthwise_conv2D_layer(Res26890, 2, 1,[[[[0.0847]]], [[[0.5041]]]],[0], 1, 1, true, Dep22013), 
LCro2746 = cropping2D_layer(Dep22013, 1, 0, 0, 0, Cro2746), 
LRes5074 = reshape_layer(Cro2746, [1, 1, 1, 1], Res5074), 
LGlo90644 = global_average_pooling3D_layer(Res5074, Glo90644), 
LCon41129 = concatenate_layer([Glo90644,[[0.6829, 0.3009, 0.5454, 0.5153, 0.767, 0.3762, 0.474]]], 1, Con41129), 
LMul77991 = multiply_layer([Add13156,Con41129], Mul77991), 
exec_layers([LMul52878,LRes21943,LRes28870,LFla69432,LMax36932,LGlo42440,LCon5026,LAdd13156,LGlo86773,LRes9011,LRes26890,LDep22013,LCro2746,LRes5074,LGlo90644,LCon41129,LMul77991],["Mul52878","Res21943","Res28870","Fla69432","Max36932","Glo42440","Con5026","Add13156","Glo86773","Res9011","Res26890","Dep22013","Cro2746","Res5074","Glo90644","Con41129","Mul77991"],Mul77991,"Mul77991")

Actual (Unparsed): [[0.2683192, 1.1529607, 0.2628030, 0.6386990, 0.2567020, 0.4644806, 0.3813906, 0.3959078]]

Expected (Unparsed): [[0.26831918069454963,1.152960714067,0.262802978784,0.6386990473440001,0.25670205411999997,0.46448059632,0.381390566832,0.39590783639999994]]

Actual:   [[0.2684, 1.153, 0.2629, 0.6387, 0.2568, 0.4645, 0.3814, 0.396]]

Expected: [[0.2684, 1.153, 0.2629, 0.6387, 0.2568, 0.4645, 0.3814, 0.396]]