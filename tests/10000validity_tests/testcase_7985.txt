import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min80150 = tf.keras.layers.Input(shape=([2, 1]))
in1Min80150 = tf.keras.layers.Input(shape=([2, 1]))
in0Con65230 = tf.keras.layers.Input(shape=([2, 1, 3]))
in0Max57033 = tf.keras.layers.Input(shape=([2, 1]))
in1Max57033 = tf.keras.layers.Input(shape=([2, 1]))
in0Con9668 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Max43954 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Max43954 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con17628 = tf.keras.layers.Input(shape=([8]))
in0Fla95241 = tf.keras.layers.Input(shape=([3, 2, 2]))

Min80150 = keras.layers.Minimum(name = 'Min80150', )([in0Min80150,in1Min80150])
Res75212 = keras.layers.Reshape((2, 1, 1), name = 'Res75212', )(Min80150)
Con65230 = keras.layers.Concatenate(axis=3, name = 'Con65230', )([Res75212,in0Con65230])
Max57033 = keras.layers.Maximum(name = 'Max57033', )([in0Max57033,in1Max57033])
Res49428 = keras.layers.Reshape((2, 1, 1), name = 'Res49428', )(Max57033)
Con9668 = keras.layers.Concatenate(axis=3, name = 'Con9668', )([Res49428,in0Con9668])
Max43954 = keras.layers.Maximum(name = 'Max43954', )([in0Max43954,in1Max43954])
Zer96508 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer96508', )(Max43954)
Min64768 = keras.layers.Minimum(name = 'Min64768', )([Con9668,Zer96508])
Res85602 = keras.layers.Reshape((2, 2), name = 'Res85602', )(Min64768)
Fla92737 = keras.layers.Flatten(name = 'Fla92737', )(Res85602)
Con17628 = keras.layers.Concatenate(axis=1, name = 'Con17628', )([Fla92737,in0Con17628])
Fla95241 = keras.layers.Flatten(name = 'Fla95241', )(in0Fla95241)
Mul94884 = keras.layers.Multiply(name = 'Mul94884', )([Con17628,Fla95241])
Res14223 = keras.layers.Reshape((12, 1), name = 'Res14223', )(Mul94884)
Res67070 = keras.layers.Reshape((12, 1, 1), name = 'Res67070', )(Res14223)
Loc20633 = keras.layers.LocallyConnected2D(4, (12, 1),strides=(1, 1), name = 'Loc20633', )(Res67070)
Zer61925 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer61925', )(Loc20633)
Sub17763 = keras.layers.Subtract(name = 'Sub17763', )([Con65230,Zer61925])
model = tf.keras.models.Model(inputs=[in0Min80150,in1Min80150,in0Con65230,in0Max57033,in1Max57033,in0Con9668,in0Max43954,in1Max43954,in0Con17628,in0Fla95241], outputs=Sub17763)
w = model.get_layer('Loc20633').get_weights() 
w[0] = np.array([[[0.5629, 0.6716, 0.9882, 0.0397], [0.1534, 0.1707, 0.1155, 0.8075], [0.3687, 0.6369, 0.9944, 0.4184], [0.7972, 0.4511, 0.9529, 0.6465], [0.8985, 0.928, 0.7297, 0.498], [0.2551, 0.1648, 0.3373, 0.2139], [0.8897, 0.6171, 0.3101, 0.9094], [0.5321, 0.1081, 0.8251, 0.2259], [0.9664, 0.418, 0.1332, 0.6387], [0.4936, 0.9479, 0.8468, 0.7454], [0.1018, 0.211, 0.8896, 0.9375], [0.1563, 0.0591, 0.3357, 0.352]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc20633').set_weights(w) 
in0Min80150 = tf.constant([[[0.633], [0.3877]]])
in1Min80150 = tf.constant([[[0.1837], [0.7466]]])
in0Con65230 = tf.constant([[[[0.9352, 0.5787, 0.3901]], [[0.9799, 0.8788, 0.8736]]]])
in0Max57033 = tf.constant([[[0.779], [0.5767]]])
in1Max57033 = tf.constant([[[0.6748], [0.9391]]])
in0Con9668 = tf.constant([[[[0.8548]], [[0.9877]]]])
in0Max43954 = tf.constant([[[[0.2478, 0.1784]]]])
in1Max43954 = tf.constant([[[[0.5397, 0.2735]]]])
in0Con17628 = tf.constant([[0.0366, 0.8422, 0.6095, 0.9554, 0.6876, 0.8366, 0.9786, 0.4914]])
in0Fla95241 = tf.constant([[[[1.028, 1.4635], [1.1245, 1.989]], [[1.656, 1.1843], [1.6295, 1.9744]], [[1.5203, 1.2074], [1.8612, 1.0825]]]])
print (np.array2string(model.predict([in0Min80150,in1Min80150,in0Con65230,in0Max57033,in1Max57033,in0Con9668,in0Max43954,in1Max43954,in0Con17628,in0Fla95241],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub17763.png')

LMin80150 = minimum_layer([[[[0.633], [0.3877]]], [[[0.1837], [0.7466]]]], Min80150), 
LRes75212 = reshape_layer(Min80150, [2, 1, 1], Res75212), 
LCon65230 = concatenate_layer([Res75212,[[[[0.9352, 0.5787, 0.3901]], [[0.9799, 0.8788, 0.8736]]]]], 3, Con65230), 
LMax57033 = maximum_layer([[[[0.779], [0.5767]]], [[[0.6748], [0.9391]]]], Max57033), 
LRes49428 = reshape_layer(Max57033, [2, 1, 1], Res49428), 
LCon9668 = concatenate_layer([Res49428,[[[[0.8548]], [[0.9877]]]]], 3, Con9668), 
LMax43954 = maximum_layer([[[[[0.2478, 0.1784]]]], [[[[0.5397, 0.2735]]]]], Max43954), 
LZer96508 = zero_padding2D_layer(Max43954, 1, 0, 0, 0, Zer96508), 
LMin64768 = minimum_layer([Con9668,Zer96508], Min64768), 
LRes85602 = reshape_layer(Min64768, [2, 2], Res85602), 
LFla92737 = flatten_layer(Res85602, Fla92737), 
LCon17628 = concatenate_layer([Fla92737,[[0.0366, 0.8422, 0.6095, 0.9554, 0.6876, 0.8366, 0.9786, 0.4914]]], 1, Con17628), 
LFla95241 = flatten_layer([[[[1.028, 1.4635], [1.1245, 1.989]], [[1.656, 1.1843], [1.6295, 1.9744]], [[1.5203, 1.2074], [1.8612, 1.0825]]]], Fla95241), 
LMul94884 = multiply_layer([Con17628,Fla95241], Mul94884), 
LRes14223 = reshape_layer(Mul94884, [12, 1], Res14223), 
LRes67070 = reshape_layer(Res14223, [12, 1, 1], Res67070), 
LLoc20633 = locally_connected2D_layer(Res67070, 12, 1,[[[0.5629, 0.6716, 0.9882, 0.0397], [0.1534, 0.1707, 0.1155, 0.8075], [0.3687, 0.6369, 0.9944, 0.4184], [0.7972, 0.4511, 0.9529, 0.6465], [0.8985, 0.928, 0.7297, 0.498], [0.2551, 0.1648, 0.3373, 0.2139], [0.8897, 0.6171, 0.3101, 0.9094], [0.5321, 0.1081, 0.8251, 0.2259], [0.9664, 0.418, 0.1332, 0.6387], [0.4936, 0.9479, 0.8468, 0.7454], [0.1018, 0.211, 0.8896, 0.9375], [0.1563, 0.0591, 0.3357, 0.352]]],[[[0, 0, 0, 0]]], 1, 1, Loc20633), 
LZer61925 = zero_padding2D_layer(Loc20633, 1, 0, 0, 0, Zer61925), 
LSub17763 = subtract_layer(Con65230,Zer61925, Sub17763), 
exec_layers([LMin80150,LRes75212,LCon65230,LMax57033,LRes49428,LCon9668,LMax43954,LZer96508,LMin64768,LRes85602,LFla92737,LCon17628,LFla95241,LMul94884,LRes14223,LRes67070,LLoc20633,LZer61925,LSub17763],["Min80150","Res75212","Con65230","Max57033","Res49428","Con9668","Max43954","Zer96508","Min64768","Res85602","Fla92737","Con17628","Fla95241","Mul94884","Res14223","Res67070","Loc20633","Zer61925","Sub17763"],Sub17763,"Sub17763")

Actual (Unparsed): [[[[0.1837000, 0.9352000, 0.5787000, 0.3901000]], [[-4.2433680, -2.4996403, -5.2815921, -4.6202530]]]]

Expected (Unparsed): [[[[0.1837,0.9352,0.5787,0.3901]],[[-4.2433679335639996,-2.4996403245200005,-5.281592112318999,-4.6202529725099994]]]]

Actual:   [[[[0.1837, 0.9352, 0.5787, 0.3901]], [[-4.2433, -2.4996, -5.2815, -4.6202]]]]

Expected: [[[[0.1837, 0.9352, 0.5787, 0.3901]], [[-4.2433, -2.4996, -5.2815, -4.6202]]]]