import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc47179 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Mul11244 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul11244 = tf.keras.layers.Input(shape=([2, 1]))
in0Min50341 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Min50341 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Mul43865 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Mul43865 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Cro87157 = tf.keras.layers.Input(shape=([2, 1]))
in0Min47679 = tf.keras.layers.Input(shape=([1, 1]))
in1Min47679 = tf.keras.layers.Input(shape=([1, 1]))
in0Con87141 = tf.keras.layers.Input(shape=([2, 3]))

Loc47179 = keras.layers.LocallyConnected2D(2, (1, 1),strides=(1, 1), name = 'Loc47179', )(in0Loc47179)
Res82643 = keras.layers.Reshape((1, 2), name = 'Res82643', )(Loc47179)
Sep13649 = keras.layers.SeparableConv1D(3, (1),strides=(1), padding='same', name = 'Sep13649', )(Res82643)
Res36020 = keras.layers.Reshape((1, 3, 1), name = 'Res36020', )(Sep13649)
Sep38055 = keras.layers.SeparableConv2D(2, (1, 2),strides=(1, 1), padding='valid', name = 'Sep38055', )(Res36020)
Fla51963 = keras.layers.Flatten(name = 'Fla51963', )(Sep38055)
Res85801 = keras.layers.Reshape((4, 1), name = 'Res85801', )(Fla51963)
Mul11244 = keras.layers.Multiply(name = 'Mul11244', )([in0Mul11244,in1Mul11244])
ELU26312 = keras.layers.ELU(alpha=-2.971738551583023, name = 'ELU26312', )(Mul11244)
Zer25271 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer25271', )(ELU26312)
Dot23771 = keras.layers.Dot(axes=(2, 2), name = 'Dot23771', )([Res85801,Zer25271])
Min50341 = keras.layers.Minimum(name = 'Min50341', )([in0Min50341,in1Min50341])
Res83592 = keras.layers.Reshape((2, 1), name = 'Res83592', )(Min50341)
Mul43865 = keras.layers.Multiply(name = 'Mul43865', )([in0Mul43865,in1Mul43865])
Res58763 = keras.layers.Reshape((2, 2, 2), name = 'Res58763', )(Mul43865)
Res94740 = keras.layers.Reshape((2, 4), name = 'Res94740', )(Res58763)
Cro87157 = keras.layers.Cropping1D(cropping=((0, 1)), name = 'Cro87157', )(in0Cro87157)
Min47679 = keras.layers.Minimum(name = 'Min47679', )([in0Min47679,in1Min47679])
Lay94309 = keras.layers.LayerNormalization(axis=2, epsilon=2.0572531440331003, name = 'Lay94309', )(Min47679)
Dot62306 = keras.layers.Dot(axes=(1, 1), name = 'Dot62306', )([Cro87157,Lay94309])
Zer21463 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer21463', )(Dot62306)
Con87141 = keras.layers.Concatenate(axis=2, name = 'Con87141', )([Zer21463,in0Con87141])
Ave79056 = keras.layers.Average(name = 'Ave79056', )([Res94740,Con87141])
Dot4097 = keras.layers.Dot(axes=(1, 1), name = 'Dot4097', )([Res83592,Ave79056])
Zer97357 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer97357', )(Dot4097)
Max96695 = keras.layers.Maximum(name = 'Max96695', )([Dot23771,Zer97357])
model = tf.keras.models.Model(inputs=[in0Loc47179,in0Mul11244,in1Mul11244,in0Min50341,in1Min50341,in0Mul43865,in1Mul43865,in0Cro87157,in0Min47679,in1Min47679,in0Con87141], outputs=Max96695)
w = model.get_layer('Loc47179').get_weights() 
w[0] = np.array([[[0.6049, 0.2301]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc47179').set_weights(w) 
w = model.get_layer('Sep13649').get_weights() 
w[0] = np.array([[[0.098], [0.5344]]])
w[1] = np.array([[[0.0925, 0.8533, 0.508], [0.8896, 0.2655, 0.5847]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep13649').set_weights(w) 
w = model.get_layer('Sep38055').get_weights() 
w[0] = np.array([[[[0.6028]], [[0.5495]]]])
w[1] = np.array([[[[0.7684, 0.1525]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep38055').set_weights(w) 
in0Loc47179 = tf.constant([[[[0.6519]]]])
in0Mul11244 = tf.constant([[[0.1844], [0.8808]]])
in1Mul11244 = tf.constant([[[0.1014], [0.8448]]])
in0Min50341 = tf.constant([[[[0.2992]], [[0.2811]]]])
in1Min50341 = tf.constant([[[[0.5108]], [[0.0381]]]])
in0Mul43865 = tf.constant([[[[[0.1473], [0.8885]], [[0.3226], [0.9082]]], [[[0.125], [0.7444]], [[0.4758], [0.5721]]]]])
in1Mul43865 = tf.constant([[[[[0.2915], [0.3819]], [[0.6967], [0.8024]]], [[[0.655], [0.7504]], [[0.0851], [0.3351]]]]])
in0Cro87157 = tf.constant([[[1.6588], [1.0814]]])
in0Min47679 = tf.constant([[[0.4326]]])
in1Min47679 = tf.constant([[[0.3549]]])
in0Con87141 = tf.constant([[[0.7443, 0.3888, 0.7068], [0.9071, 0.2752, 0.7261]]])
print (np.array2string(model.predict([in0Loc47179,in0Mul11244,in1Mul11244,in0Min50341,in1Min50341,in0Mul43865,in1Mul43865,in0Cro87157,in0Min47679,in1Min47679,in0Con87141],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max96695.png')

LLoc47179 = locally_connected2D_layer([[[[0.6519]]]], 1, 1,[[[0.6049, 0.2301]]],[[[0, 0]]], 1, 1, Loc47179), 
LRes82643 = reshape_layer(Loc47179, [1, 2], Res82643), 
LSep13649 = separable_conv1D_layer(Res82643, 1,[[[[0.098], [0.5344]]],[[[0.0925, 0.8533, 0.508], [0.8896, 0.2655, 0.5847]]]],[0, 0, 0], 1, true, Sep13649), 
LRes36020 = reshape_layer(Sep13649, [1, 3, 1], Res36020), 
LSep38055 = separable_conv2D_layer(Res36020, 1, 2,[[[[[0.6028]], [[0.5495]]]],[[[[0.7684, 0.1525]]]]],[0, 0], 1, 1, false, Sep38055), 
LFla51963 = flatten_layer(Sep38055, Fla51963), 
LRes85801 = reshape_layer(Fla51963, [4, 1], Res85801), 
LMul11244 = multiply_layer([[[[0.1844], [0.8808]]], [[[0.1014], [0.8448]]]], Mul11244), 
LELU26312 = elu_layer(Mul11244, -2.971738551583023, ELU26312), 
LZer25271 = zero_padding1D_layer(ELU26312, 2, 0, Zer25271), 
LDot23771 = dot_layer(Res85801,Zer25271, 2, 2, Dot23771), 
LMin50341 = minimum_layer([[[[[0.2992]], [[0.2811]]]], [[[[0.5108]], [[0.0381]]]]], Min50341), 
LRes83592 = reshape_layer(Min50341, [2, 1], Res83592), 
LMul43865 = multiply_layer([[[[[[0.1473], [0.8885]], [[0.3226], [0.9082]]], [[[0.125], [0.7444]], [[0.4758], [0.5721]]]]], [[[[[0.2915], [0.3819]], [[0.6967], [0.8024]]], [[[0.655], [0.7504]], [[0.0851], [0.3351]]]]]], Mul43865), 
LRes58763 = reshape_layer(Mul43865, [2, 2, 2], Res58763), 
LRes94740 = reshape_layer(Res58763, [2, 4], Res94740), 
LCro87157 = cropping1D_layer([[[1.6588], [1.0814]]], 0, 1, Cro87157), 
LMin47679 = minimum_layer([[[[0.4326]]], [[[0.3549]]]], Min47679), 
LLay94309 = layer_normalization_layer(Min47679, 2, 2.0572531440331003, Lay94309), 
LDot62306 = dot_layer(Cro87157,Lay94309, 1, 1, Dot62306), 
LZer21463 = zero_padding1D_layer(Dot62306, 1, 0, Zer21463), 
LCon87141 = concatenate_layer([Zer21463,[[[0.7443, 0.3888, 0.7068], [0.9071, 0.2752, 0.7261]]]], 2, Con87141), 
LAve79056 = average_layer([Res94740,Con87141], Ave79056), 
LDot4097 = dot_layer(Res83592,Ave79056, 1, 1, Dot4097), 
LZer97357 = zero_padding1D_layer(Dot4097, 3, 0, Zer97357), 
LMax96695 = maximum_layer([Dot23771,Zer97357], Max96695), 
exec_layers([LLoc47179,LRes82643,LSep13649,LRes36020,LSep38055,LFla51963,LRes85801,LMul11244,LELU26312,LZer25271,LDot23771,LMin50341,LRes83592,LMul43865,LRes58763,LRes94740,LCro87157,LMin47679,LLay94309,LDot62306,LZer21463,LCon87141,LAve79056,LDot4097,LZer97357,LMax96695],["Loc47179","Res82643","Sep13649","Res36020","Sep38055","Fla51963","Res85801","Mul11244","ELU26312","Zer25271","Dot23771","Min50341","Res83592","Mul43865","Res58763","Res94740","Cro87157","Min47679","Lay94309","Dot62306","Zer21463","Con87141","Ave79056","Dot4097","Zer97357","Max96695"],Max96695,"Max96695")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0010769, 0.0428575], [0.0000000, 0.0000000, 0.0002137, 0.0085057], [0.0000000, 0.0000000, 0.0009950, 0.0395946], [0.0079832, 0.1900308, 0.0978018, 0.2322410]]]

Expected (Unparsed): [[[0.0,0.0,0.0010769465738453485,0.04285746689978436],[0.0,0.0,0.0002137354925968449,0.008505678946144084],[0.0,0.0,0.0009949561245965782,0.039594628194396346],[0.00798323607,0.19003081756800003,0.097801796381,0.2322410301535]]]

Actual:   [[[0, 0, 0.0011, 0.0429], [0, 0, 0.0003, 0.0086], [0, 0, 0.001, 0.0396], [0.008, 0.1901, 0.0979, 0.2323]]]

Expected: [[[0, 0, 0.0011, 0.0429], [0, 0, 0.0003, 0.0086], [0, 0, 0.001, 0.0396], [0.008, 0.1901, 0.0979, 0.2323]]]