import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add59529 = tf.keras.layers.Input(shape=([1, 1]))
in1Add59529 = tf.keras.layers.Input(shape=([1, 1]))
in0Con22238 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Sub82331 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Sub82331 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Cro94078 = tf.keras.layers.Input(shape=([2, 1, 3, 1]))
in0Con10420 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))

Add59529 = keras.layers.Add(name = 'Add59529', )([in0Add59529,in1Add59529])
Sim63109 = keras.layers.SimpleRNN(2,name = 'Sim63109', )(Add59529)
Res23177 = keras.layers.Reshape((2, 1), name = 'Res23177', )(Sim63109)
PRe22619 = keras.layers.PReLU(name = 'PRe22619', )(Res23177)
Res76655 = keras.layers.Reshape((2, 1, 1), name = 'Res76655', )(PRe22619)
Res15978 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res15978', )(Res76655)
Zer97264 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (1, 0)), name = 'Zer97264', )(Res15978)
Con22238 = keras.layers.Concatenate(axis=4, name = 'Con22238', )([Zer97264,in0Con22238])
Sub82331 = keras.layers.Subtract(name = 'Sub82331', )([in0Sub82331,in1Sub82331])
Cro94078 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (1, 1)), name = 'Cro94078', )(in0Cro94078)
Zer43259 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (1, 0)), name = 'Zer43259', )(Cro94078)
Con10420 = keras.layers.Concatenate(axis=4, name = 'Con10420', )([Zer43259,in0Con10420])
Sub38044 = keras.layers.Subtract(name = 'Sub38044', )([Sub82331,Con10420])
Max1902 = keras.layers.Maximum(name = 'Max1902', )([Con22238,Sub38044])
model = tf.keras.models.Model(inputs=[in0Add59529,in1Add59529,in0Con22238,in0Sub82331,in1Sub82331,in0Cro94078,in0Con10420], outputs=Max1902)
w = model.get_layer('Sim63109').get_weights() 
w[0] = np.array([[8, 8]])
w[1] = np.array([[2, 7], [8, 1]])
w[2] = np.array([1, 6])
model.get_layer('Sim63109').set_weights(w) 
w = model.get_layer('PRe22619').get_weights() 
w[0] = np.array([[0.4339], [0.3136]])
model.get_layer('PRe22619').set_weights(w) 
in0Add59529 = tf.constant([[[0.3831]]])
in1Add59529 = tf.constant([[[0.0954]]])
in0Con22238 = tf.constant([[[[[0.3812], [0.5858]], [[0.4285], [0.8162]]], [[[0.331], [0.8604]], [[0.7044], [0.751]]]]])
in0Sub82331 = tf.constant([[[[[0.8912, 0.8515], [0.0887, 0.1559]], [[0.9943, 0.9069], [0.7179, 0.9513]]], [[[0.0015, 0.8052], [0.1413, 0.8484]], [[0.1129, 0.2217], [0.2401, 0.6613]]]]])
in1Sub82331 = tf.constant([[[[[0.6354, 0.3543], [0.937, 0.3563]], [[0.3567, 0.7524], [0.4335, 0.2351]]], [[[0.0867, 0.0988], [0.9554, 0.3813]], [[0.6613, 0.4178], [0.5807, 0.8766]]]]])
in0Cro94078 = tf.constant([[[[[1.1822], [1.2265], [1.6643]]], [[[1.9249], [1.9071], [1.6127]]]]])
in0Con10420 = tf.constant([[[[[0.3891], [0.8823]], [[0.4038], [0.2063]]], [[[0.3288], [0.7322]], [[0.8749], [0.0356]]]]])
print (np.array2string(model.predict([in0Add59529,in1Add59529,in0Con22238,in0Sub82331,in1Sub82331,in0Cro94078,in0Con10420],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max1902.png')

LAdd59529 = add_layer([[[[0.3831]]], [[[0.0954]]]], Add59529), 
LSim63109 = simple_rnn_layer(Add59529,[[8, 8]],[[2, 7], [8, 1]],[1, 6], Sim63109), 
LRes23177 = reshape_layer(Sim63109, [2, 1], Res23177), 
LPRe22619 = prelu_layer(Res23177, [[0.4339], [0.3136]], PRe22619), 
LRes76655 = reshape_layer(PRe22619, [2, 1, 1], Res76655), 
LRes15978 = reshape_layer(Res76655, [2, 1, 1, 1], Res15978), 
LZer97264 = zero_padding3D_layer(Res15978, 0, 0, 1, 0, 1, 0, Zer97264), 
LCon22238 = concatenate_layer([Zer97264,[[[[[0.3812], [0.5858]], [[0.4285], [0.8162]]], [[[0.331], [0.8604]], [[0.7044], [0.751]]]]]], 4, Con22238), 
LSub82331 = subtract_layer([[[[[0.8912, 0.8515], [0.0887, 0.1559]], [[0.9943, 0.9069], [0.7179, 0.9513]]], [[[0.0015, 0.8052], [0.1413, 0.8484]], [[0.1129, 0.2217], [0.2401, 0.6613]]]]], [[[[[0.6354, 0.3543], [0.937, 0.3563]], [[0.3567, 0.7524], [0.4335, 0.2351]]], [[[0.0867, 0.0988], [0.9554, 0.3813]], [[0.6613, 0.4178], [0.5807, 0.8766]]]]], Sub82331), 
LCro94078 = cropping3D_layer([[[[[1.1822], [1.2265], [1.6643]]], [[[1.9249], [1.9071], [1.6127]]]]], 0, 0, 0, 0, 1, 1, Cro94078), 
LZer43259 = zero_padding3D_layer(Cro94078, 0, 0, 1, 0, 1, 0, Zer43259), 
LCon10420 = concatenate_layer([Zer43259,[[[[[0.3891], [0.8823]], [[0.4038], [0.2063]]], [[[0.3288], [0.7322]], [[0.8749], [0.0356]]]]]], 4, Con10420), 
LSub38044 = subtract_layer(Sub82331,Con10420, Sub38044), 
LMax1902 = maximum_layer([Con22238,Sub38044], Max1902), 
exec_layers([LAdd59529,LSim63109,LRes23177,LPRe22619,LRes76655,LRes15978,LZer97264,LCon22238,LSub82331,LCro94078,LZer43259,LCon10420,LSub38044,LMax1902],["Add59529","Sim63109","Res23177","PRe22619","Res76655","Res15978","Zer97264","Con22238","Sub82331","Cro94078","Zer43259","Con10420","Sub38044","Max1902"],Max1902,"Max1902")

Actual (Unparsed): [[[[[0.2558000, 0.3812000], [0.0000000, 0.5858000]], [[0.6376000, 0.4285000], [0.9998719, 0.8162000]]], [[[0.0000000, 0.3776000], [0.0000000, 0.8604000]], [[0.0000000, 0.7044000], [1.0000000, 0.7510000]]]]]

Expected (Unparsed): [[[[[0.2558,0.3812],[0,0.5858]],[[0.6376,0.4285],[0.9998719278598087,0.8162]]],[[[0,0.37760000000000005],[0,0.8604]],[[0,0.7044],[0.9999999941851615,0.751]]]]]

Actual:   [[[[[0.2558, 0.3812], [0, 0.5858]], [[0.6376, 0.4285], [0.9999, 0.8162]]], [[[0, 0.3776], [0, 0.8604]], [[0, 0.7044], [1, 0.751]]]]]

Expected: [[[[[0.2558, 0.3812], [0, 0.5858]], [[0.6376, 0.4285], [0.9999, 0.8162]]], [[[0, 0.3777], [0, 0.8604]], [[0, 0.7044], [1, 0.751]]]]]