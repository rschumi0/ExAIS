import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max5571 = tf.keras.layers.Input(shape=([2, 1]))
in1Max5571 = tf.keras.layers.Input(shape=([2, 1]))

Max5571 = keras.layers.Maximum(name = 'Max5571', )([in0Max5571,in1Max5571])
Loc21107 = keras.layers.LocallyConnected1D(4, (1),strides=(7), name = 'Loc21107', )(Max5571)
Sim3 = keras.layers.SimpleRNN(3,name = 'Sim3', )(Loc21107)
model = tf.keras.models.Model(inputs=[in0Max5571,in1Max5571], outputs=Sim3)
w = model.get_layer('Loc21107').get_weights() 
w[0] = np.array([[[0.0857, 0.1568, 0.6732, 0.1999]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc21107').set_weights(w) 
w = model.get_layer('Sim3').get_weights() 
w[0] = np.array([[9, 9, 3], [9, 4, 9], [9, 1, 2], [7, 10, 10]])
w[1] = np.array([[4, 7, 2], [3, 1, 3], [5, 6, 1]])
w[2] = np.array([1, 7, 7])
model.get_layer('Sim3').set_weights(w) 
in0Max5571 = tf.constant([[[0.6124], [0.6779]]])
in1Max5571 = tf.constant([[[0.7657], [0.2488]]])
print (np.array2string(model.predict([in0Max5571,in1Max5571],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sim3.png')

LMax5571 = maximum_layer([[[[0.6124], [0.6779]]], [[[0.7657], [0.2488]]]], Max5571), 
LLoc21107 = locally_connected1D_layer(Max5571, 1,[[[0.0857, 0.1568, 0.6732, 0.1999]]],[[0, 0, 0, 0]], 7, Loc21107), 
LSim3 = simple_rnn_layer(Loc21107,[[9, 9, 3], [9, 4, 9], [9, 1, 2], [7, 10, 10]],[[4, 7, 2], [3, 1, 3], [5, 6, 1]],[1, 7, 7], Sim3), 
exec_layers([LMax5571,LLoc21107,LSim3],["Max5571","Loc21107","Sim3"],Sim3,"Sim3")

Actual (Unparsed): [[0.9999999, 1.0000000, 1.0000000]]

Expected (Unparsed): [[0.9999998951219627,0.9999999967373393,0.9999999992301558]]

Actual:   [[1, 1, 1]]

Expected: [[1, 1, 1]]