import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min7340 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Min7340 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Ave3684 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Ave3684 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con22341 = tf.keras.layers.Input(shape=([4, 2]))
in0Dot93919 = tf.keras.layers.Input(shape=([2]))
in1Dot93919 = tf.keras.layers.Input(shape=([2]))
in0Con2376 = tf.keras.layers.Input(shape=([4, 3]))
in0Ave60307 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in1Ave60307 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in0Ave55346 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave55346 = tf.keras.layers.Input(shape=([2, 2]))
in0Con87121 = tf.keras.layers.Input(shape=([2, 2]))

Min7340 = keras.layers.Minimum(name = 'Min7340', )([in0Min7340,in1Min7340])
Res15444 = keras.layers.Reshape((2, 2), name = 'Res15444', )(Min7340)
Ave3684 = keras.layers.Average(name = 'Ave3684', )([in0Ave3684,in1Ave3684])
Res78411 = keras.layers.Reshape((1, 2), name = 'Res78411', )(Ave3684)
Ave65562 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='same', name = 'Ave65562', )(Res78411)
Zer95783 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer95783', )(Ave65562)
Min70863 = keras.layers.Minimum(name = 'Min70863', )([Res15444,Zer95783])
Zer55889 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer55889', )(Min70863)
Con22341 = keras.layers.Concatenate(axis=2, name = 'Con22341', )([Zer55889,in0Con22341])
Dot93919 = keras.layers.Dot(axes=(1, 1), name = 'Dot93919', )([in0Dot93919,in1Dot93919])
Res48472 = keras.layers.Reshape((1, 1), name = 'Res48472', )(Dot93919)
Zer68963 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer68963', )(Res48472)
Con2376 = keras.layers.Concatenate(axis=2, name = 'Con2376', )([Zer68963,in0Con2376])
Ave60307 = keras.layers.Average(name = 'Ave60307', )([in0Ave60307,in1Ave60307])
Res65815 = keras.layers.Reshape((2, 1, 4), name = 'Res65815', )(Ave60307)
Res85903 = keras.layers.Reshape((2, 4), name = 'Res85903', )(Res65815)
Ave55346 = keras.layers.Average(name = 'Ave55346', )([in0Ave55346,in1Ave55346])
Con87121 = keras.layers.Concatenate(axis=2, name = 'Con87121', )([Ave55346,in0Con87121])
Mul44666 = keras.layers.Multiply(name = 'Mul44666', )([Res85903,Con87121])
Zer5421 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer5421', )(Mul44666)
Max87415 = keras.layers.Maximum(name = 'Max87415', )([Con2376,Zer5421])
Ave55796 = keras.layers.Average(name = 'Ave55796', )([Con22341,Max87415])
model = tf.keras.models.Model(inputs=[in0Min7340,in1Min7340,in0Ave3684,in1Ave3684,in0Con22341,in0Dot93919,in1Dot93919,in0Con2376,in0Ave60307,in1Ave60307,in0Ave55346,in1Ave55346,in0Con87121], outputs=Ave55796)
in0Min7340 = tf.constant([[[[0.7074, 0.8105]], [[0.4432, 0.3701]]]])
in1Min7340 = tf.constant([[[[0.4269, 0.077]], [[0.2633, 0.9532]]]])
in0Ave3684 = tf.constant([[[[0.1048], [0.5883]]]])
in1Ave3684 = tf.constant([[[[0.9364], [0.877]]]])
in0Con22341 = tf.constant([[[0.9397, 0.8855], [0.7861, 0.6601], [0.1931, 0.8665], [0.5346, 0.0445]]])
in0Dot93919 = tf.constant([[0.559, 0.4549]])
in1Dot93919 = tf.constant([[0.7013, 0.6694]])
in0Con2376 = tf.constant([[[0.8009, 0.9408, 0.4084], [0.5924, 0.2863, 0.8015], [0.3537, 0.35, 0.1379], [0.2689, 0.523, 0.4117]]])
in0Ave60307 = tf.constant([[[[[0.2379, 0.167], [0.9847, 0.5968]]], [[[0.8837, 0.8573], [0.6835, 0.4372]]]]])
in1Ave60307 = tf.constant([[[[[0.0315, 0.9727], [0.4747, 0.2425]]], [[[0.4455, 0.6181], [0.2958, 0.9572]]]]])
in0Ave55346 = tf.constant([[[0.7101, 0.1526], [0.9603, 0.9135]]])
in1Ave55346 = tf.constant([[[0.9782, 0.8423], [0.8545, 0.7679]]])
in0Con87121 = tf.constant([[[0.8583, 0.2387], [0.5779, 0.4588]]])
print (np.array2string(model.predict([in0Min7340,in1Min7340,in0Ave3684,in1Ave3684,in0Con22341,in0Dot93919,in1Dot93919,in0Con2376,in0Ave60307,in1Ave60307,in0Ave55346,in1Ave55346,in0Con87121],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave55796.png')

LMin7340 = minimum_layer([[[[[0.7074, 0.8105]], [[0.4432, 0.3701]]]], [[[[0.4269, 0.077]], [[0.2633, 0.9532]]]]], Min7340), 
LRes15444 = reshape_layer(Min7340, [2, 2], Res15444), 
LAve3684 = average_layer([[[[[0.1048], [0.5883]]]], [[[[0.9364], [0.877]]]]], Ave3684), 
LRes78411 = reshape_layer(Ave3684, [1, 2], Res78411), 
LAve65562 = average_pooling1D_layer(Res78411, 1, 1, true, Ave65562), 
LZer95783 = zero_padding1D_layer(Ave65562, 1, 0, Zer95783), 
LMin70863 = minimum_layer([Res15444,Zer95783], Min70863), 
LZer55889 = zero_padding1D_layer(Min70863, 2, 0, Zer55889), 
LCon22341 = concatenate_layer([Zer55889,[[[0.9397, 0.8855], [0.7861, 0.6601], [0.1931, 0.8665], [0.5346, 0.0445]]]], 2, Con22341), 
LDot93919 = dot_layer([[0.559, 0.4549]], [[0.7013, 0.6694]], 1, 1, Dot93919), 
LRes48472 = reshape_layer(Dot93919, [1, 1], Res48472), 
LZer68963 = zero_padding1D_layer(Res48472, 3, 0, Zer68963), 
LCon2376 = concatenate_layer([Zer68963,[[[0.8009, 0.9408, 0.4084], [0.5924, 0.2863, 0.8015], [0.3537, 0.35, 0.1379], [0.2689, 0.523, 0.4117]]]], 2, Con2376), 
LAve60307 = average_layer([[[[[[0.2379, 0.167], [0.9847, 0.5968]]], [[[0.8837, 0.8573], [0.6835, 0.4372]]]]], [[[[[0.0315, 0.9727], [0.4747, 0.2425]]], [[[0.4455, 0.6181], [0.2958, 0.9572]]]]]], Ave60307), 
LRes65815 = reshape_layer(Ave60307, [2, 1, 4], Res65815), 
LRes85903 = reshape_layer(Res65815, [2, 4], Res85903), 
LAve55346 = average_layer([[[[0.7101, 0.1526], [0.9603, 0.9135]]], [[[0.9782, 0.8423], [0.8545, 0.7679]]]], Ave55346), 
LCon87121 = concatenate_layer([Ave55346,[[[0.8583, 0.2387], [0.5779, 0.4588]]]], 2, Con87121), 
LMul44666 = multiply_layer([Res85903,Con87121], Mul44666), 
LZer5421 = zero_padding1D_layer(Mul44666, 1, 1, Zer5421), 
LMax87415 = maximum_layer([Con2376,Zer5421], Max87415), 
LAve55796 = average_layer([Con22341,Max87415], Ave55796), 
exec_layers([LMin7340,LRes15444,LAve3684,LRes78411,LAve65562,LZer95783,LMin70863,LZer55889,LCon22341,LDot93919,LRes48472,LZer68963,LCon2376,LAve60307,LRes65815,LRes85903,LAve55346,LCon87121,LMul44666,LZer5421,LMax87415,LAve55796],["Min7340","Res15444","Ave3684","Res78411","Ave65562","Zer95783","Min70863","Zer55889","Con22341","Dot93919","Res48472","Zer68963","Con2376","Ave60307","Res65815","Res85903","Ave55346","Con87121","Mul44666","Zer5421","Max87415","Ave55796"],Ave55796,"Ave55796")

Actual (Unparsed): [[[0.0000000, 0.4004500, 0.9402500, 0.6469500], [0.0568535, 0.2962000, 0.7062007, 0.7308000], [0.3015290, 0.3100922, 0.2715500, 0.5931877], [0.4799184, 0.3195000, 0.5288000, 0.2281000]]]

Expected (Unparsed): [[[0,0.40045,0.94025,0.6469499999999999],[0.05685350249999999,0.2962,0.706200755,0.7308],[0.30152902000000004,0.310092195,0.27154999999999996,0.59318768],[0.47991838000000003,0.3195,0.5287999999999999,0.2281]]]

Actual:   [[[0, 0.4005, 0.9403, 0.647], [0.0569, 0.2962, 0.7063, 0.7308], [0.3016, 0.3101, 0.2716, 0.5932], [0.48, 0.3195, 0.5288, 0.2281]]]

Expected: [[[0, 0.4005, 0.9403, 0.647], [0.0569, 0.2962, 0.7063, 0.7308], [0.3016, 0.3101, 0.2716, 0.5932], [0.48, 0.3195, 0.5288, 0.2281]]]