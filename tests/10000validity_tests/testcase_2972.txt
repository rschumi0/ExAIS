import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max21918 = tf.keras.layers.Input(shape=([1, 2]))
in1Max21918 = tf.keras.layers.Input(shape=([1, 2]))
in0Con86138 = tf.keras.layers.Input(shape=([1]))
in0Max7314 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Max7314 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Con82389 = tf.keras.layers.Input(shape=([3, 1]))
in0Ave62526 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave62526 = tf.keras.layers.Input(shape=([1, 2]))

Max21918 = keras.layers.Maximum(name = 'Max21918', )([in0Max21918,in1Max21918])
Fla8405 = keras.layers.Flatten(name = 'Fla8405', )(Max21918)
Con86138 = keras.layers.Concatenate(axis=1, name = 'Con86138', )([Fla8405,in0Con86138])
Max7314 = keras.layers.Maximum(name = 'Max7314', )([in0Max7314,in1Max7314])
Res85775 = keras.layers.Reshape((2, 1, 2), name = 'Res85775', )(Max7314)
Res20712 = keras.layers.Reshape((2, 2), name = 'Res20712', )(Res85775)
LST85647 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST85647', )(Res20712)
Add97491 = keras.layers.Add(name = 'Add97491', )([Con86138,LST85647])
Res10128 = keras.layers.Reshape((3, 1), name = 'Res10128', )(Add97491)
Con82389 = keras.layers.Concatenate(axis=2, name = 'Con82389', )([Res10128,in0Con82389])
Ave62526 = keras.layers.Average(name = 'Ave62526', )([in0Ave62526,in1Ave62526])
Zer54273 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer54273', )(Ave62526)
Mul17495 = keras.layers.Multiply(name = 'Mul17495', )([Con82389,Zer54273])
model = tf.keras.models.Model(inputs=[in0Max21918,in1Max21918,in0Con86138,in0Max7314,in1Max7314,in0Con82389,in0Ave62526,in1Ave62526], outputs=Mul17495)
w = model.get_layer('LST85647').get_weights() 
w[0] = np.array([[6, 10, 2, 6, 9, 10, 3, 4, 10, 1, 10, 9], [2, 8, 2, 7, 8, 6, 1, 6, 1, 6, 2, 10]])
w[1] = np.array([[10, 6, 3, 1, 2, 5, 10, 6, 4, 10, 4, 5], [2, 1, 6, 8, 7, 8, 9, 10, 4, 9, 1, 4], [3, 8, 5, 9, 2, 10, 9, 8, 10, 1, 1, 2]])
w[2] = np.array([7, 4, 5, 4, 5, 3, 4, 6, 8, 5, 7, 5])
model.get_layer('LST85647').set_weights(w) 
in0Max21918 = tf.constant([[[0.7473, 0.0508]]])
in1Max21918 = tf.constant([[[0.2243, 0.3528]]])
in0Con86138 = tf.constant([[0.3321]])
in0Max7314 = tf.constant([[[[[0.2672, 0.8191]]], [[[0.7422, 0.1185]]]]])
in1Max7314 = tf.constant([[[[[0.3152, 0.089]]], [[[0.5837, 0.0275]]]]])
in0Con82389 = tf.constant([[[0.9897], [0.6114], [0.4776]]])
in0Ave62526 = tf.constant([[[0.8606, 0.8589]]])
in1Ave62526 = tf.constant([[[0.5832, 0.1782]]])
print (np.array2string(model.predict([in0Max21918,in1Max21918,in0Con86138,in0Max7314,in1Max7314,in0Con82389,in0Ave62526,in1Ave62526],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul17495.png')

LMax21918 = maximum_layer([[[[0.7473, 0.0508]]], [[[0.2243, 0.3528]]]], Max21918), 
LFla8405 = flatten_layer(Max21918, Fla8405), 
LCon86138 = concatenate_layer([Fla8405,[[0.3321]]], 1, Con86138), 
LMax7314 = maximum_layer([[[[[[0.2672, 0.8191]]], [[[0.7422, 0.1185]]]]], [[[[[0.3152, 0.089]]], [[[0.5837, 0.0275]]]]]], Max7314), 
LRes85775 = reshape_layer(Max7314, [2, 1, 2], Res85775), 
LRes20712 = reshape_layer(Res85775, [2, 2], Res20712), 
LLST85647 = lstm_layer(Res20712,[[6, 10, 2, 6, 9, 10, 3, 4, 10, 1, 10, 9], [2, 8, 2, 7, 8, 6, 1, 6, 1, 6, 2, 10]],[[10, 6, 3, 1, 2, 5, 10, 6, 4, 10, 4, 5], [2, 1, 6, 8, 7, 8, 9, 10, 4, 9, 1, 4], [3, 8, 5, 9, 2, 10, 9, 8, 10, 1, 1, 2]],[7, 4, 5, 4, 5, 3, 4, 6, 8, 5, 7, 5], LST85647), 
LAdd97491 = add_layer([Con86138,LST85647], Add97491), 
LRes10128 = reshape_layer(Add97491, [3, 1], Res10128), 
LCon82389 = concatenate_layer([Res10128,[[[0.9897], [0.6114], [0.4776]]]], 2, Con82389), 
LAve62526 = average_layer([[[[0.8606, 0.8589]]], [[[0.5832, 0.1782]]]], Ave62526), 
LZer54273 = zero_padding1D_layer(Ave62526, 2, 0, Zer54273), 
LMul17495 = multiply_layer([Con82389,Zer54273], Mul17495), 
exec_layers([LMax21918,LFla8405,LCon86138,LMax7314,LRes85775,LRes20712,LLST85647,LAdd97491,LRes10128,LCon82389,LAve62526,LZer54273,LMul17495],["Max21918","Fla8405","Con86138","Max7314","Res85775","Res20712","LST85647","Add97491","Res10128","Con82389","Ave62526","Zer54273","Mul17495"],Mul17495,"Mul17495")

Actual (Unparsed): [[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.9356389, 0.2476595]]]

Expected (Unparsed): [[[0.0,0.0],[0.0,0.0],[0.9356389456705679,0.24765948]]]

Actual:   [[[0, 0], [0, 0], [0.9357, 0.2477]]]

Expected: [[[0, 0], [0, 0], [0.9357, 0.2477]]]