import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave5002 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Ave5002 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in0Con55951 = tf.keras.layers.Input(shape=([3, 3, 4]))
in0Sub27460 = tf.keras.layers.Input(shape=([3, 3, 2, 3]))
in1Sub27460 = tf.keras.layers.Input(shape=([3, 3, 2, 3]))
in0Sep64430 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con6000 = tf.keras.layers.Input(shape=([3, 3, 3]))

Ave5002 = keras.layers.Average(name = 'Ave5002', )([in0Ave5002,in1Ave5002])
Res89250 = keras.layers.Reshape((1, 1, 2), name = 'Res89250', )(Ave5002)
Zer71115 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer71115', )(Res89250)
Con55951 = keras.layers.Concatenate(axis=3, name = 'Con55951', )([Zer71115,in0Con55951])
Sub27460 = keras.layers.Subtract(name = 'Sub27460', )([in0Sub27460,in1Sub27460])
Res64114 = keras.layers.Reshape((3, 3, 6), name = 'Res64114', )(Sub27460)
Sep64430 = keras.layers.SeparableConv2D(3, (1, 1),strides=(1, 1), padding='valid', name = 'Sep64430', )(in0Sep64430)
Zer17392 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer17392', )(Sep64430)
Con6000 = keras.layers.Concatenate(axis=3, name = 'Con6000', )([Zer17392,in0Con6000])
Min36165 = keras.layers.Minimum(name = 'Min36165', )([Res64114,Con6000])
Max11564 = keras.layers.Maximum(name = 'Max11564', )([Con55951,Min36165])
model = tf.keras.models.Model(inputs=[in0Ave5002,in1Ave5002,in0Con55951,in0Sub27460,in1Sub27460,in0Sep64430,in0Con6000], outputs=Max11564)
w = model.get_layer('Sep64430').get_weights() 
w[0] = np.array([[[[0.9511], [0.6674]]]])
w[1] = np.array([[[[0.1463, 0.926, 0.2956], [0.8079, 0.4128, 0.2396]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep64430').set_weights(w) 
in0Ave5002 = tf.constant([[[[[0.087, 0.9772]]]]])
in1Ave5002 = tf.constant([[[[[0.9571, 0.5792]]]]])
in0Con55951 = tf.constant([[[[0.3768, 0.6811, 0.0408, 0.1859], [0.2296, 0.4886, 0.1945, 0.2901], [0.955, 0.9922, 0.5953, 0.7178]], [[0.2722, 0.8962, 0.9894, 0.9387], [0.2326, 0.5465, 0.2885, 0.6131], [0.984, 0.3969, 0.7405, 0.1992]], [[0.1427, 0.7413, 0.6403, 0.5011], [0.8443, 0.6435, 0.0161, 0.7432], [0.4968, 0.0916, 0.7607, 0.049]]]])
in0Sub27460 = tf.constant([[[[[0.5433, 0.7491, 0.2544], [0.7551, 0.2476, 0.8103]], [[0.2562, 0.2301, 0.658], [0.9413, 0.8471, 0.7061]], [[0.0661, 0.7349, 0.7503], [0.4746, 0.8605, 0.9581]]], [[[0.5454, 0.148, 0.1498], [0.7954, 0.1569, 0.841]], [[0.1359, 0.7944, 0.4017], [0.6343, 0.5623, 0.9618]], [[0.8212, 0.614, 0.1508], [0.9977, 0.8167, 0.6426]]], [[[0.1907, 0.094, 0.0576], [0.2879, 0.3453, 0.0756]], [[0.2384, 0.0131, 0.301], [0.9145, 0.5225, 0.8149]], [[0.0996, 0.8108, 0.4319], [0.9858, 0.8677, 0.1001]]]]])
in1Sub27460 = tf.constant([[[[[0.5124, 0.5705, 0.1831], [0.2215, 0.8423, 0.3902]], [[0.5063, 0.8587, 0.3325], [0.2156, 0.9416, 0.1566]], [[0.8175, 0.7845, 0.0931], [0.6019, 0.1298, 0.8778]]], [[[0.932, 0.7627, 0.7127], [0.5989, 0.4026, 0.5787]], [[0.8353, 0.3299, 0.9587], [0.3122, 0.1439, 0.5806]], [[0.3459, 0.5821, 0.1098], [0.0902, 0.7214, 0.1297]]], [[[0.9126, 0.0933, 0.641], [0.0933, 0.4389, 0.6211]], [[0.5291, 0.6063, 0.3684], [0.071, 0.9985, 0.4749]], [[0.769, 0.0508, 0.7891], [0.5392, 0.2313, 0.6774]]]]])
in0Sep64430 = tf.constant([[[[0.1524, 0.0791]]]])
in0Con6000 = tf.constant([[[[0.5395, 0.5906, 0.9169], [0.2796, 0.622, 0.6545], [0.1851, 0.1204, 0.8473]], [[0.2845, 0.3162, 0.8998], [0.7661, 0.4381, 0.4612], [0.0239, 0.7704, 0.3309]], [[0.0398, 0.5351, 0.2276], [0.8456, 0.3887, 0.5109], [0.8572, 0.4902, 0.2237]]]])
print (np.array2string(model.predict([in0Ave5002,in1Ave5002,in0Con55951,in0Sub27460,in1Sub27460,in0Sep64430,in0Con6000],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max11564.png')

LAve5002 = average_layer([[[[[[0.087, 0.9772]]]]], [[[[[0.9571, 0.5792]]]]]], Ave5002), 
LRes89250 = reshape_layer(Ave5002, [1, 1, 2], Res89250), 
LZer71115 = zero_padding2D_layer(Res89250, 2, 0, 2, 0, Zer71115), 
LCon55951 = concatenate_layer([Zer71115,[[[[0.3768, 0.6811, 0.0408, 0.1859], [0.2296, 0.4886, 0.1945, 0.2901], [0.955, 0.9922, 0.5953, 0.7178]], [[0.2722, 0.8962, 0.9894, 0.9387], [0.2326, 0.5465, 0.2885, 0.6131], [0.984, 0.3969, 0.7405, 0.1992]], [[0.1427, 0.7413, 0.6403, 0.5011], [0.8443, 0.6435, 0.0161, 0.7432], [0.4968, 0.0916, 0.7607, 0.049]]]]], 3, Con55951), 
LSub27460 = subtract_layer([[[[[0.5433, 0.7491, 0.2544], [0.7551, 0.2476, 0.8103]], [[0.2562, 0.2301, 0.658], [0.9413, 0.8471, 0.7061]], [[0.0661, 0.7349, 0.7503], [0.4746, 0.8605, 0.9581]]], [[[0.5454, 0.148, 0.1498], [0.7954, 0.1569, 0.841]], [[0.1359, 0.7944, 0.4017], [0.6343, 0.5623, 0.9618]], [[0.8212, 0.614, 0.1508], [0.9977, 0.8167, 0.6426]]], [[[0.1907, 0.094, 0.0576], [0.2879, 0.3453, 0.0756]], [[0.2384, 0.0131, 0.301], [0.9145, 0.5225, 0.8149]], [[0.0996, 0.8108, 0.4319], [0.9858, 0.8677, 0.1001]]]]], [[[[[0.5124, 0.5705, 0.1831], [0.2215, 0.8423, 0.3902]], [[0.5063, 0.8587, 0.3325], [0.2156, 0.9416, 0.1566]], [[0.8175, 0.7845, 0.0931], [0.6019, 0.1298, 0.8778]]], [[[0.932, 0.7627, 0.7127], [0.5989, 0.4026, 0.5787]], [[0.8353, 0.3299, 0.9587], [0.3122, 0.1439, 0.5806]], [[0.3459, 0.5821, 0.1098], [0.0902, 0.7214, 0.1297]]], [[[0.9126, 0.0933, 0.641], [0.0933, 0.4389, 0.6211]], [[0.5291, 0.6063, 0.3684], [0.071, 0.9985, 0.4749]], [[0.769, 0.0508, 0.7891], [0.5392, 0.2313, 0.6774]]]]], Sub27460), 
LRes64114 = reshape_layer(Sub27460, [3, 3, 6], Res64114), 
LSep64430 = separable_conv2D_layer([[[[0.1524, 0.0791]]]], 1, 1,[[[[[0.9511], [0.6674]]]],[[[[0.1463, 0.926, 0.2956], [0.8079, 0.4128, 0.2396]]]]],[0, 0, 0], 1, 1, false, Sep64430), 
LZer17392 = zero_padding2D_layer(Sep64430, 2, 0, 2, 0, Zer17392), 
LCon6000 = concatenate_layer([Zer17392,[[[[0.5395, 0.5906, 0.9169], [0.2796, 0.622, 0.6545], [0.1851, 0.1204, 0.8473]], [[0.2845, 0.3162, 0.8998], [0.7661, 0.4381, 0.4612], [0.0239, 0.7704, 0.3309]], [[0.0398, 0.5351, 0.2276], [0.8456, 0.3887, 0.5109], [0.8572, 0.4902, 0.2237]]]]], 3, Con6000), 
LMin36165 = minimum_layer([Res64114,Con6000], Min36165), 
LMax11564 = maximum_layer([Con55951,Min36165], Max11564), 
exec_layers([LAve5002,LRes89250,LZer71115,LCon55951,LSub27460,LRes64114,LSep64430,LZer17392,LCon6000,LMin36165,LMax11564],["Ave5002","Res89250","Zer71115","Con55951","Sub27460","Res64114","Sep64430","Zer17392","Con6000","Min36165","Max11564"],Max11564,"Max11564")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.3768000, 0.6811000, 0.0408000, 0.4201000], [0.0000000, 0.0000000, 0.2296000, 0.4886000, 0.1945000, 0.5495000], [0.0000000, 0.0000000, 0.9550000, 0.9922000, 0.5953000, 0.7178000]], [[0.0000000, 0.0000000, 0.2722000, 0.8962000, 0.9894000, 0.9387000], [0.0000000, 0.0000000, 0.2326000, 0.5465000, 0.4184000, 0.6131000], [0.0000000, 0.0000000, 0.9840000, 0.3969000, 0.7405000, 0.3309000]], [[0.0000000, 0.0000000, 0.1427000, 0.7413000, 0.6403000, 0.5011000], [0.0000000, 0.0000000, 0.8443000, 0.8435000, 0.0161000, 0.7432000], [0.5220500, 0.7782000, 0.4968000, 0.4466000, 0.7607000, 0.0490000]]]]

Expected (Unparsed): [[[[0,0,0.3768,0.6811,0.0408,0.42010000000000003],[0,0,0.2296,0.4886,0.1945,0.5495],[0,0,0.955,0.9922,0.5953,0.7178]],[[0,0,0.2722,0.8962,0.9894,0.9387],[0,0,0.2326,0.5465,0.4184,0.6131],[0,0,0.984,0.3969,0.7405,0.3309]],[[0,0,0.1427,0.7413,0.6403,0.5011],[0,0,0.8443,0.8435,0.0161,0.7432],[0.52205,0.7782,0.4968,0.4466,0.7607,0.049]]]]

Actual:   [[[[0, 0, 0.3768, 0.6811, 0.0408, 0.4201], [0, 0, 0.2296, 0.4886, 0.1945, 0.5495], [0, 0, 0.955, 0.9922, 0.5953, 0.7178]], [[0, 0, 0.2722, 0.8962, 0.9894, 0.9387], [0, 0, 0.2326, 0.5465, 0.4184, 0.6131], [0, 0, 0.984, 0.3969, 0.7405, 0.3309]], [[0, 0, 0.1427, 0.7413, 0.6403, 0.5011], [0, 0, 0.8443, 0.8435, 0.0161, 0.7432], [0.5221, 0.7782, 0.4968, 0.4466, 0.7607, 0.049]]]]

Expected: [[[[0, 0, 0.3768, 0.6811, 0.0408, 0.4202], [0, 0, 0.2296, 0.4886, 0.1945, 0.5495], [0, 0, 0.955, 0.9922, 0.5953, 0.7178]], [[0, 0, 0.2722, 0.8962, 0.9894, 0.9387], [0, 0, 0.2326, 0.5465, 0.4184, 0.6131], [0, 0, 0.984, 0.3969, 0.7405, 0.3309]], [[0, 0, 0.1427, 0.7413, 0.6403, 0.5011], [0, 0, 0.8443, 0.8435, 0.0161, 0.7432], [0.5221, 0.7782, 0.4968, 0.4466, 0.7607, 0.049]]]]