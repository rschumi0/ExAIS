import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot36235 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot36235 = tf.keras.layers.Input(shape=([2, 3]))
in0Mas68030 = tf.keras.layers.Input(shape=([2]))
in0Con43159 = tf.keras.layers.Input(shape=([14]))

Dot36235 = keras.layers.Dot(axes=(2, 2), name = 'Dot36235', )([in0Dot36235,in1Dot36235])
Res8382 = keras.layers.Reshape((2, 2, 1), name = 'Res8382', )(Dot36235)
Res55971 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res55971', )(Res8382)
Up_38359 = keras.layers.UpSampling3D(size=(2, 1, 2), name = 'Up_38359', )(Res55971)
Res37153 = keras.layers.Reshape((4, 2, 2), name = 'Res37153', )(Up_38359)
Res48361 = keras.layers.Reshape((4, 4), name = 'Res48361', )(Res37153)
Fla62416 = keras.layers.Flatten(name = 'Fla62416', )(Res48361)
Mas68030 = keras.layers.Masking(mask_value=1, name = 'Mas68030', )(in0Mas68030)
Con43159 = keras.layers.Concatenate(axis=1, name = 'Con43159', )([Mas68030,in0Con43159])
Max58236 = keras.layers.Maximum(name = 'Max58236', )([Fla62416,Con43159])
Res64440 = keras.layers.Reshape((16, 1), name = 'Res64440', )(Max58236)
Res10317 = keras.layers.Reshape((16, 1, 1), name = 'Res10317', )(Res64440)
Max54013 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max54013', )(Res10317)
model = tf.keras.models.Model(inputs=[in0Dot36235,in1Dot36235,in0Mas68030,in0Con43159], outputs=Max54013)
in0Dot36235 = tf.constant([[[0.2719, 0.2317, 0.4053], [0.3547, 0.8094, 0.3346]]])
in1Dot36235 = tf.constant([[[0.5819, 0.1497, 0.4364], [0.3126, 0.5216, 0.8884]]])
in0Mas68030 = tf.constant([[1.377, 1.9242]])
in0Con43159 = tf.constant([[0.2098, 0.9892, 0.2025, 0.1824, 0.5794, 0.9049, 0.4232, 0.7522, 0.2162, 0.385, 0.2786, 0.1894, 0.1766, 0.9651]])
print (np.array2string(model.predict([in0Dot36235,in1Dot36235,in0Mas68030,in0Con43159],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max54013.png')

LDot36235 = dot_layer([[[0.2719, 0.2317, 0.4053], [0.3547, 0.8094, 0.3346]]], [[[0.5819, 0.1497, 0.4364], [0.3126, 0.5216, 0.8884]]], 2, 2, Dot36235), 
LRes8382 = reshape_layer(Dot36235, [2, 2, 1], Res8382), 
LRes55971 = reshape_layer(Res8382, [2, 2, 1, 1], Res55971), 
LUp_38359 = up_sampling3D_layer(Res55971, 2, 1, 2, Up_38359), 
LRes37153 = reshape_layer(Up_38359, [4, 2, 2], Res37153), 
LRes48361 = reshape_layer(Res37153, [4, 4], Res48361), 
LFla62416 = flatten_layer(Res48361, Fla62416), 
LMas68030 = masking_layer([[1.377, 1.9242]], 1, Mas68030), 
LCon43159 = concatenate_layer([Mas68030,[[0.2098, 0.9892, 0.2025, 0.1824, 0.5794, 0.9049, 0.4232, 0.7522, 0.2162, 0.385, 0.2786, 0.1894, 0.1766, 0.9651]]], 1, Con43159), 
LMax58236 = maximum_layer([Fla62416,Con43159], Max58236), 
LRes64440 = reshape_layer(Max58236, [16, 1], Res64440), 
LRes10317 = reshape_layer(Res64440, [16, 1, 1], Res10317), 
LMax54013 = max_pool2D_layer(Res10317, 1, 1, Max54013), 
exec_layers([LDot36235,LRes8382,LRes55971,LUp_38359,LRes37153,LRes48361,LFla62416,LMas68030,LCon43159,LMax58236,LRes64440,LRes10317,LMax54013],["Dot36235","Res8382","Res55971","Up_38359","Res37153","Res48361","Fla62416","Mas68030","Con43159","Max58236","Res64440","Res10317","Max54013"],Max54013,"Max54013")

Actual (Unparsed): [[[[1.3770000]], [[1.9242001]], [[0.5659192]], [[0.9892000]], [[0.3697770]], [[0.3697770]], [[0.5794000]], [[0.9049000]], [[0.4735866]], [[0.7522000]], [[0.8303209]], [[0.8303209]], [[0.4735866]], [[0.4735866]], [[0.8303209]], [[0.9651000]]]]

Expected (Unparsed): [[[[1.377]],[[1.9242]],[[0.56591918]],[[0.9892]],[[0.36977701999999996]],[[0.36977701999999996]],[[0.5794]],[[0.9049]],[[0.47358655]],[[0.7522]],[[0.8303208999999999]],[[0.8303208999999999]],[[0.47358655]],[[0.47358655]],[[0.8303208999999999]],[[0.9651]]]]

Actual:   [[[[1.377]], [[1.9243]], [[0.566]], [[0.9892]], [[0.3698]], [[0.3698]], [[0.5794]], [[0.9049]], [[0.4736]], [[0.7522]], [[0.8304]], [[0.8304]], [[0.4736]], [[0.4736]], [[0.8304]], [[0.9651]]]]

Expected: [[[[1.377]], [[1.9242]], [[0.566]], [[0.9892]], [[0.3698]], [[0.3698]], [[0.5794]], [[0.9049]], [[0.4736]], [[0.7522]], [[0.8304]], [[0.8304]], [[0.4736]], [[0.4736]], [[0.8304]], [[0.9651]]]]