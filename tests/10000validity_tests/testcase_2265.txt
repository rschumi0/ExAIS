import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max46326 = tf.keras.layers.Input(shape=([1, 1]))
in1Max46326 = tf.keras.layers.Input(shape=([1, 1]))
in0Con62487 = tf.keras.layers.Input(shape=([2, 1]))
in0Min36453 = tf.keras.layers.Input(shape=([2, 2]))
in1Min36453 = tf.keras.layers.Input(shape=([2, 2]))
in0Mul94850 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul94850 = tf.keras.layers.Input(shape=([2, 1]))
in0Con113 = tf.keras.layers.Input(shape=([1, 1, 2]))

Max46326 = keras.layers.Maximum(name = 'Max46326', )([in0Max46326,in1Max46326])
Zer85354 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer85354', )(Max46326)
Con62487 = keras.layers.Concatenate(axis=2, name = 'Con62487', )([Zer85354,in0Con62487])
Min36453 = keras.layers.Minimum(name = 'Min36453', )([in0Min36453,in1Min36453])
Ave67885 = keras.layers.Average(name = 'Ave67885', )([Con62487,Min36453])
Res59085 = keras.layers.Reshape((2, 2, 1), name = 'Res59085', )(Ave67885)
Res48802 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res48802', )(Res59085)
Zer74255 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (6, 0)), name = 'Zer74255', )(Res48802)
Mul94850 = keras.layers.Multiply(name = 'Mul94850', )([in0Mul94850,in1Mul94850])
Res89467 = keras.layers.Reshape((2, 1, 1), name = 'Res89467', )(Mul94850)
Res44105 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res44105', )(Res89467)
Zer28009 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (6, 0)), name = 'Zer28009', )(Res44105)
Con113 = keras.layers.Conv2D(4, (1, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con113', )(in0Con113)
Res61882 = keras.layers.Reshape((1, 1, 4, 1), name = 'Res61882', )(Con113)
Up_33204 = keras.layers.UpSampling3D(size=(1, 2, 1), name = 'Up_33204', )(Res61882)
Zer32631 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (3, 0)), name = 'Zer32631', )(Up_33204)
Sub59799 = keras.layers.Subtract(name = 'Sub59799', )([Zer28009,Zer32631])
Min11893 = keras.layers.Minimum(name = 'Min11893', )([Zer74255,Sub59799])
Res23943 = keras.layers.Reshape((2, 3, 7), name = 'Res23943', )(Min11893)
Dep5070 = keras.layers.DepthwiseConv2D((2, 3),strides=(1, 1), padding='valid', name = 'Dep5070', )(Res23943)
model = tf.keras.models.Model(inputs=[in0Max46326,in1Max46326,in0Con62487,in0Min36453,in1Min36453,in0Mul94850,in1Mul94850,in0Con113], outputs=Dep5070)
w = model.get_layer('Con113').get_weights() 
w[0] = np.array([[[[0.7589, 0.4069, 0.1901, 0.1813], [0.1082, 0.9782, 0.7155, 0.116]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con113').set_weights(w) 
w = model.get_layer('Dep5070').get_weights() 
w[0] = np.array([[[[0.4114], [0.2254], [0.6194], [0.5235], [0.949], [0.7914], [0.7146]], [[0.425], [0.3776], [0.644], [0.4634], [0.2657], [0.5302], [0.3087]], [[0.6639], [0.1063], [0.8175], [0.0653], [0.4578], [0.4669], [0.5641]]], [[[0.5999], [0.6183], [0.8824], [0.0191], [0.5867], [0.4347], [0.9488]], [[0.2099], [0.2188], [0.6728], [0.9919], [0.3163], [0.6308], [0.495]], [[0.9321], [0.7828], [0.3595], [0.1483], [0.1347], [0.9562], [0.4734]]]])
w[1] = np.array([0, 0, 0, 0, 0, 0, 0])
model.get_layer('Dep5070').set_weights(w) 
in0Max46326 = tf.constant([[[0.579]]])
in1Max46326 = tf.constant([[[0.9143]]])
in0Con62487 = tf.constant([[[0.9868], [0.6172]]])
in0Min36453 = tf.constant([[[0.7912, 0.7244], [0.854, 0.5153]]])
in1Min36453 = tf.constant([[[0.7366, 0.1194], [0.0611, 0.0587]]])
in0Mul94850 = tf.constant([[[0.2691], [0.249]]])
in1Mul94850 = tf.constant([[[0.4322], [0.8544]]])
in0Con113 = tf.constant([[[[0.53, 0.3956]]]])
print (np.array2string(model.predict([in0Max46326,in1Max46326,in0Con62487,in0Min36453,in1Min36453,in0Mul94850,in1Mul94850,in0Con113],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dep5070.png')

LMax46326 = maximum_layer([[[[0.579]]], [[[0.9143]]]], Max46326), 
LZer85354 = zero_padding1D_layer(Max46326, 1, 0, Zer85354), 
LCon62487 = concatenate_layer([Zer85354,[[[0.9868], [0.6172]]]], 2, Con62487), 
LMin36453 = minimum_layer([[[[0.7912, 0.7244], [0.854, 0.5153]]], [[[0.7366, 0.1194], [0.0611, 0.0587]]]], Min36453), 
LAve67885 = average_layer([Con62487,Min36453], Ave67885), 
LRes59085 = reshape_layer(Ave67885, [2, 2, 1], Res59085), 
LRes48802 = reshape_layer(Res59085, [2, 2, 1, 1], Res48802), 
LZer74255 = zero_padding3D_layer(Res48802, 0, 0, 1, 0, 6, 0, Zer74255), 
LMul94850 = multiply_layer([[[[0.2691], [0.249]]], [[[0.4322], [0.8544]]]], Mul94850), 
LRes89467 = reshape_layer(Mul94850, [2, 1, 1], Res89467), 
LRes44105 = reshape_layer(Res89467, [2, 1, 1, 1], Res44105), 
LZer28009 = zero_padding3D_layer(Res44105, 0, 0, 2, 0, 6, 0, Zer28009), 
LCon113 = conv2D_layer([[[[0.53, 0.3956]]]], 1, 1,[[[[0.7589, 0.4069, 0.1901, 0.1813], [0.1082, 0.9782, 0.7155, 0.116]]]],[0, 0, 0, 0], 1, 1, false, 1, 1, Con113), 
LRes61882 = reshape_layer(Con113, [1, 1, 4, 1], Res61882), 
LUp_33204 = up_sampling3D_layer(Res61882, 1, 2, 1, Up_33204), 
LZer32631 = zero_padding3D_layer(Up_33204, 1, 0, 1, 0, 3, 0, Zer32631), 
LSub59799 = subtract_layer(Zer28009,Zer32631, Sub59799), 
LMin11893 = minimum_layer([Zer74255,Sub59799], Min11893), 
LRes23943 = reshape_layer(Min11893, [2, 3, 7], Res23943), 
LDep5070 = depthwise_conv2D_layer(Res23943, 2, 3,[[[[0.4114], [0.2254], [0.6194], [0.5235], [0.949], [0.7914], [0.7146]], [[0.425], [0.3776], [0.644], [0.4634], [0.2657], [0.5302], [0.3087]], [[0.6639], [0.1063], [0.8175], [0.0653], [0.4578], [0.4669], [0.5641]]], [[[0.5999], [0.6183], [0.8824], [0.0191], [0.5867], [0.4347], [0.9488]], [[0.2099], [0.2188], [0.6728], [0.9919], [0.3163], [0.6308], [0.495]], [[0.9321], [0.7828], [0.3595], [0.1483], [0.1347], [0.9562], [0.4734]]]],[0, 0, 0, 0, 0, 0, 0], 1, 1, false, Dep5070), 
exec_layers([LMax46326,LZer85354,LCon62487,LMin36453,LAve67885,LRes59085,LRes48802,LZer74255,LMul94850,LRes89467,LRes44105,LZer28009,LCon113,LRes61882,LUp_33204,LZer32631,LSub59799,LMin11893,LRes23943,LDep5070],["Max46326","Zer85354","Con62487","Min36453","Ave67885","Res59085","Res48802","Zer74255","Mul94850","Res89467","Res44105","Zer28009","Con113","Res61882","Up_33204","Zer32631","Sub59799","Min11893","Res23943","Dep5070"],Dep5070,"Dep5070")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000000, -0.5074128, -0.2717874, -0.6090982, 0.0288294]]]]

Expected (Unparsed): [[[[0.0,0.0,0.0,-0.5074128529840001,-0.27178744692,-0.6090982176,0.028829352582]]]]

Actual:   [[[[0, 0, 0, -0.5074, -0.2717, -0.609, 0.0289]]]]

Expected: [[[[0, 0, 0, -0.5074, -0.2717, -0.609, 0.0289]]]]