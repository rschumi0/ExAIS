import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Zer87121 = tf.keras.layers.Input(shape=([4, 4, 2, 4]))

Zer87121 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer87121', )(in0Zer87121)
Res61605 = keras.layers.Reshape((6, 6, 16), name = 'Res61605', )(Zer87121)
Res93726 = keras.layers.Reshape((6, 96), name = 'Res93726', )(Res61605)
LST81365 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST81365', )(Res93726)
model = tf.keras.models.Model(inputs=[in0Zer87121], outputs=LST81365)
w = model.get_layer('LST81365').get_weights() 
w[0] = np.array([[2, 4, 4, 5], [6, 1, 9, 10], [1, 6, 1, 9], [5, 2, 10, 10], [7, 8, 6, 7], [1, 9, 8, 3], [6, 9, 10, 6], [7, 4, 9, 9], [3, 5, 1, 10], [6, 5, 3, 3], [3, 8, 3, 9], [6, 8, 9, 9], [5, 3, 3, 1], [8, 9, 4, 6], [9, 3, 9, 4], [4, 1, 5, 7], [6, 5, 9, 3], [4, 5, 8, 3], [10, 10, 9, 8], [7, 2, 6, 1], [4, 7, 7, 3], [5, 6, 7, 8], [7, 9, 6, 6], [4, 10, 4, 10], [5, 9, 2, 7], [1, 2, 7, 4], [9, 3, 9, 1], [9, 9, 5, 6], [2, 7, 9, 9], [4, 10, 3, 7], [7, 3, 9, 2], [7, 9, 10, 7], [4, 6, 7, 10], [5, 2, 1, 8], [4, 3, 6, 4], [6, 5, 6, 5], [2, 4, 8, 1], [9, 1, 6, 3], [5, 3, 4, 10], [6, 9, 5, 2], [9, 8, 1, 5], [5, 4, 2, 6], [2, 5, 3, 3], [10, 10, 3, 4], [7, 3, 8, 2], [9, 7, 1, 9], [10, 7, 8, 4], [4, 10, 6, 3], [2, 4, 2, 5], [3, 3, 4, 6], [5, 7, 2, 4], [10, 8, 10, 5], [9, 1, 9, 3], [9, 10, 5, 4], [5, 10, 9, 2], [4, 2, 8, 5], [6, 7, 7, 6], [2, 9, 2, 6], [4, 2, 6, 6], [3, 1, 8, 9], [3, 8, 10, 3], [10, 9, 4, 5], [4, 10, 4, 10], [8, 5, 9, 2], [5, 6, 7, 9], [6, 3, 6, 9], [9, 3, 10, 3], [2, 5, 7, 2], [2, 5, 2, 5], [7, 2, 4, 6], [10, 9, 2, 6], [3, 8, 9, 10], [4, 2, 10, 1], [6, 8, 10, 1], [8, 4, 4, 4], [4, 2, 3, 8], [6, 5, 1, 5], [9, 1, 6, 3], [10, 1, 9, 6], [3, 3, 6, 5], [1, 7, 6, 3], [8, 6, 5, 6], [9, 8, 4, 5], [7, 7, 7, 4], [8, 1, 4, 2], [9, 8, 10, 10], [4, 2, 8, 2], [8, 3, 7, 3], [7, 2, 8, 5], [7, 9, 8, 9], [9, 6, 9, 5], [1, 6, 9, 8], [2, 2, 10, 8], [5, 1, 7, 10], [4, 7, 7, 8], [7, 5, 3, 3]])
w[1] = np.array([[8, 10, 7, 10]])
w[2] = np.array([7, 7, 5, 2])
model.get_layer('LST81365').set_weights(w) 
in0Zer87121 = tf.constant([[[[[1.3263, 1.5699, 1.9741, 1.248], [1.2857, 1.6373, 1.4598, 1.3739]], [[1.0763, 1.9502, 1.6857, 1.1574], [1.3077, 1.9704, 1.0535, 1.3603]], [[1.5064, 1.2123, 1.1548, 1.0263], [1.812, 1.4644, 1.5392, 1.0329]], [[1.6369, 1.3613, 1.0292, 1.1497], [1.1401, 1.0445, 1.6766, 1.4785]]], [[[1.6739, 1.061, 1.5339, 1.9598], [1.4621, 1.0983, 1.7746, 1.9635]], [[1.6401, 1.6293, 1.3384, 1.8523], [1.4462, 1.0517, 1.1991, 1.8055]], [[1.7941, 1.4447, 1.5579, 1.1199], [1.6707, 1.6386, 1.7507, 1.6679]], [[1.8109, 1.8936, 1.422, 1.1865], [1.8779, 1.1203, 1.5708, 1.5928]]], [[[1.9449, 1.2372, 1.3963, 1.581], [1.4157, 1.9575, 1.4882, 1.3392]], [[1.65, 1.0268, 1.793, 1.3442], [1.4656, 1.6883, 1.9641, 1.8431]], [[1.3777, 1.9463, 1.1545, 1.8082], [1.9052, 1.0173, 1.0486, 1.8657]], [[1.5271, 1.2111, 1.9459, 1.9421], [1.9008, 1.3692, 1.0055, 1.1453]]], [[[1.7692, 1.9016, 1.3415, 1.7032], [1.5808, 1.4098, 1.5186, 1.6213]], [[1.217, 1.8614, 1.1395, 1.0863], [1.3847, 1.2906, 1.6372, 1.5444]], [[1.1658, 1.0383, 1.0918, 1.8121], [1.9372, 1.6183, 1.8731, 1.5408]], [[1.3757, 1.3965, 1.1823, 1.8467], [1.5441, 1.4053, 1.1071, 1.9468]]]]])
print (np.array2string(model.predict([in0Zer87121],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST81365.png')

LZer87121 = zero_padding3D_layer([[[[[1.3263, 1.5699, 1.9741, 1.248], [1.2857, 1.6373, 1.4598, 1.3739]], [[1.0763, 1.9502, 1.6857, 1.1574], [1.3077, 1.9704, 1.0535, 1.3603]], [[1.5064, 1.2123, 1.1548, 1.0263], [1.812, 1.4644, 1.5392, 1.0329]], [[1.6369, 1.3613, 1.0292, 1.1497], [1.1401, 1.0445, 1.6766, 1.4785]]], [[[1.6739, 1.061, 1.5339, 1.9598], [1.4621, 1.0983, 1.7746, 1.9635]], [[1.6401, 1.6293, 1.3384, 1.8523], [1.4462, 1.0517, 1.1991, 1.8055]], [[1.7941, 1.4447, 1.5579, 1.1199], [1.6707, 1.6386, 1.7507, 1.6679]], [[1.8109, 1.8936, 1.422, 1.1865], [1.8779, 1.1203, 1.5708, 1.5928]]], [[[1.9449, 1.2372, 1.3963, 1.581], [1.4157, 1.9575, 1.4882, 1.3392]], [[1.65, 1.0268, 1.793, 1.3442], [1.4656, 1.6883, 1.9641, 1.8431]], [[1.3777, 1.9463, 1.1545, 1.8082], [1.9052, 1.0173, 1.0486, 1.8657]], [[1.5271, 1.2111, 1.9459, 1.9421], [1.9008, 1.3692, 1.0055, 1.1453]]], [[[1.7692, 1.9016, 1.3415, 1.7032], [1.5808, 1.4098, 1.5186, 1.6213]], [[1.217, 1.8614, 1.1395, 1.0863], [1.3847, 1.2906, 1.6372, 1.5444]], [[1.1658, 1.0383, 1.0918, 1.8121], [1.9372, 1.6183, 1.8731, 1.5408]], [[1.3757, 1.3965, 1.1823, 1.8467], [1.5441, 1.4053, 1.1071, 1.9468]]]]], 1, 1, 1, 1, 1, 1, Zer87121), 
LRes61605 = reshape_layer(Zer87121, [6, 6, 16], Res61605), 
LRes93726 = reshape_layer(Res61605, [6, 96], Res93726), 
LLST81365 = lstm_layer(Res93726,[[2, 4, 4, 5], [6, 1, 9, 10], [1, 6, 1, 9], [5, 2, 10, 10], [7, 8, 6, 7], [1, 9, 8, 3], [6, 9, 10, 6], [7, 4, 9, 9], [3, 5, 1, 10], [6, 5, 3, 3], [3, 8, 3, 9], [6, 8, 9, 9], [5, 3, 3, 1], [8, 9, 4, 6], [9, 3, 9, 4], [4, 1, 5, 7], [6, 5, 9, 3], [4, 5, 8, 3], [10, 10, 9, 8], [7, 2, 6, 1], [4, 7, 7, 3], [5, 6, 7, 8], [7, 9, 6, 6], [4, 10, 4, 10], [5, 9, 2, 7], [1, 2, 7, 4], [9, 3, 9, 1], [9, 9, 5, 6], [2, 7, 9, 9], [4, 10, 3, 7], [7, 3, 9, 2], [7, 9, 10, 7], [4, 6, 7, 10], [5, 2, 1, 8], [4, 3, 6, 4], [6, 5, 6, 5], [2, 4, 8, 1], [9, 1, 6, 3], [5, 3, 4, 10], [6, 9, 5, 2], [9, 8, 1, 5], [5, 4, 2, 6], [2, 5, 3, 3], [10, 10, 3, 4], [7, 3, 8, 2], [9, 7, 1, 9], [10, 7, 8, 4], [4, 10, 6, 3], [2, 4, 2, 5], [3, 3, 4, 6], [5, 7, 2, 4], [10, 8, 10, 5], [9, 1, 9, 3], [9, 10, 5, 4], [5, 10, 9, 2], [4, 2, 8, 5], [6, 7, 7, 6], [2, 9, 2, 6], [4, 2, 6, 6], [3, 1, 8, 9], [3, 8, 10, 3], [10, 9, 4, 5], [4, 10, 4, 10], [8, 5, 9, 2], [5, 6, 7, 9], [6, 3, 6, 9], [9, 3, 10, 3], [2, 5, 7, 2], [2, 5, 2, 5], [7, 2, 4, 6], [10, 9, 2, 6], [3, 8, 9, 10], [4, 2, 10, 1], [6, 8, 10, 1], [8, 4, 4, 4], [4, 2, 3, 8], [6, 5, 1, 5], [9, 1, 6, 3], [10, 1, 9, 6], [3, 3, 6, 5], [1, 7, 6, 3], [8, 6, 5, 6], [9, 8, 4, 5], [7, 7, 7, 4], [8, 1, 4, 2], [9, 8, 10, 10], [4, 2, 8, 2], [8, 3, 7, 3], [7, 2, 8, 5], [7, 9, 8, 9], [9, 6, 9, 5], [1, 6, 9, 8], [2, 2, 10, 8], [5, 1, 7, 10], [4, 7, 7, 8], [7, 5, 3, 3]],[[8, 10, 7, 10]],[7, 7, 5, 2], LST81365), 
exec_layers([LZer87121,LRes61605,LRes93726,LLST81365],["Zer87121","Res61605","Res93726","LST81365"],LST81365,"LST81365")

Actual (Unparsed): [[0.9999815]]

Expected (Unparsed): [[0.9999815373023434]]

Actual:   [[1]]

Expected: [[1]]