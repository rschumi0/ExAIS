import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max23828 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Max23828 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con62531 = tf.keras.layers.Input(shape=([2, 2, 3, 1]))
in0Add23864 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Add23864 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

Max23828 = keras.layers.Maximum(name = 'Max23828', )([in0Max23828,in1Max23828])
Res19181 = keras.layers.Reshape((2, 1, 2, 1), name = 'Res19181', )(Max23828)
Zer30130 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (1, 0)), name = 'Zer30130', )(Res19181)
Con62531 = keras.layers.Concatenate(axis=4, name = 'Con62531', )([Zer30130,in0Con62531])
Add23864 = keras.layers.Add(name = 'Add23864', )([in0Add23864,in1Add23864])
Zer5650 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer5650', )(Add23864)
Max41278 = keras.layers.Maximum(name = 'Max41278', )([Con62531,Zer5650])
Con70141 = keras.layers.Conv3D(4, (2, 1, 3),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con70141', )(Max41278)
model = tf.keras.models.Model(inputs=[in0Max23828,in1Max23828,in0Con62531,in0Add23864,in1Add23864], outputs=Con70141)
w = model.get_layer('Con70141').get_weights() 
w[0] = np.array([[[[[0.7423, 0.9975, 0.3857, 0.0964], [0.4362, 0.7089, 0.8729, 0.1827]], [[0.7302, 0.8499, 0.3971, 0.7666], [0.9247, 0.6516, 0.1117, 0.2766]], [[0.2293, 0.8874, 0.8753, 0.1925], [0.0426, 0.7211, 0.7713, 0.0364]]]], [[[[0.0558, 0.222, 0.14, 0.0252], [0.1776, 0.0048, 0.01, 0.4514]], [[0.6631, 0.8341, 0.027, 0.2002], [0.1076, 0.5815, 0.5905, 0.8059]], [[0.1674, 0.6209, 0.9291, 0.1071], [0.9609, 0.6062, 0.2732, 0.8673]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con70141').set_weights(w) 
in0Max23828 = tf.constant([[[[0.5496, 0.1477]], [[0.4857, 0.5514]]]])
in1Max23828 = tf.constant([[[[0.8038, 0.4374]], [[0.0232, 0.9775]]]])
in0Con62531 = tf.constant([[[[[0.6049], [0.528], [0.5991]], [[0.956], [0.3279], [0.6673]]], [[[0.6244], [0.888], [0.9396]], [[0.5339], [0.597], [0.6225]]]]])
in0Add23864 = tf.constant([[[[[0.8375, 0.369]], [[0.8844, 0.9341]]], [[[0.9045, 0.6978]], [[0.559, 0.9523]]]]])
in1Add23864 = tf.constant([[[[[0.9718, 0.1016]], [[0.2099, 0.19]]], [[[0.4006, 0.3102]], [[0.5679, 0.6512]]]]])
print (np.array2string(model.predict([in0Max23828,in1Max23828,in0Con62531,in0Add23864,in1Add23864],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con70141.png')

LMax23828 = maximum_layer([[[[[0.5496, 0.1477]], [[0.4857, 0.5514]]]], [[[[0.8038, 0.4374]], [[0.0232, 0.9775]]]]], Max23828), 
LRes19181 = reshape_layer(Max23828, [2, 1, 2, 1], Res19181), 
LZer30130 = zero_padding3D_layer(Res19181, 0, 0, 1, 0, 1, 0, Zer30130), 
LCon62531 = concatenate_layer([Zer30130,[[[[[0.6049], [0.528], [0.5991]], [[0.956], [0.3279], [0.6673]]], [[[0.6244], [0.888], [0.9396]], [[0.5339], [0.597], [0.6225]]]]]], 4, Con62531), 
LAdd23864 = add_layer([[[[[[0.8375, 0.369]], [[0.8844, 0.9341]]], [[[0.9045, 0.6978]], [[0.559, 0.9523]]]]], [[[[[0.9718, 0.1016]], [[0.2099, 0.19]]], [[[0.4006, 0.3102]], [[0.5679, 0.6512]]]]]], Add23864), 
LZer5650 = zero_padding3D_layer(Add23864, 0, 0, 0, 0, 2, 0, Zer5650), 
LMax41278 = maximum_layer([Con62531,Zer5650], Max41278), 
LCon70141 = conv3D_layer(Max41278, 2, 1, 3,[[[[[0.7423, 0.9975, 0.3857, 0.0964], [0.4362, 0.7089, 0.8729, 0.1827]], [[0.7302, 0.8499, 0.3971, 0.7666], [0.9247, 0.6516, 0.1117, 0.2766]], [[0.2293, 0.8874, 0.8753, 0.1925], [0.0426, 0.7211, 0.7713, 0.0364]]]], [[[[0.0558, 0.222, 0.14, 0.0252], [0.1776, 0.0048, 0.01, 0.4514]], [[0.6631, 0.8341, 0.027, 0.2002], [0.1076, 0.5815, 0.5905, 0.8059]], [[0.1674, 0.6209, 0.9291, 0.1071], [0.9609, 0.6062, 0.2732, 0.8673]]]]],[0, 0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con70141), 
exec_layers([LMax23828,LRes19181,LZer30130,LCon62531,LAdd23864,LZer5650,LMax41278,LCon70141],["Max23828","Res19181","Zer30130","Con62531","Add23864","Zer5650","Max41278","Con70141"],Con70141,"Con70141")

Actual (Unparsed): [[[[[2.5859963, 4.7511975, 4.6513229, 2.6381655]], [[3.8165325, 5.7827625, 4.8712273, 3.4638899]]]]]

Expected (Unparsed): [[[[[2.5859963099999996,4.75119755,4.65132294,2.63816549]],[[3.81653246,5.7827624900000005,4.87122732,3.46388985]]]]]

Actual:   [[[[[2.586, 4.7512, 4.6514, 2.6382]], [[3.8166, 5.7828, 4.8713, 3.4639]]]]]

Expected: [[[[[2.586, 4.7512, 4.6514, 2.6382]], [[3.8166, 5.7828, 4.8713, 3.4639]]]]]