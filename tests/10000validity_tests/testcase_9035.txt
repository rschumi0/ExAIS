import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min83258 = tf.keras.layers.Input(shape=([1, 1]))
in1Min83258 = tf.keras.layers.Input(shape=([1, 1]))
in0Con11454 = tf.keras.layers.Input(shape=([1, 7]))
in0Up_7528 = tf.keras.layers.Input(shape=([1, 2]))

Min83258 = keras.layers.Minimum(name = 'Min83258', )([in0Min83258,in1Min83258])
Con11454 = keras.layers.Concatenate(axis=2, name = 'Con11454', )([Min83258,in0Con11454])
Up_7528 = keras.layers.UpSampling1D(size=(1), name = 'Up_7528', )(in0Up_7528)
Ave92853 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='valid', name = 'Ave92853', )(Up_7528)
Res88165 = keras.layers.Reshape((1, 2, 1), name = 'Res88165', )(Ave92853)
Res14271 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res14271', )(Res88165)
Con23642 = keras.layers.Conv3DTranspose(4, (1, 1, 1),strides=(1, 1, 1), padding='same', name = 'Con23642', )(Res14271)
Res22709 = keras.layers.Reshape((1, 2, 4), name = 'Res22709', )(Con23642)
Res56641 = keras.layers.Reshape((1, 8), name = 'Res56641', )(Res22709)
Max60709 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max60709', )(Res56641)
Mul27775 = keras.layers.Multiply(name = 'Mul27775', )([Con11454,Max60709])
model = tf.keras.models.Model(inputs=[in0Min83258,in1Min83258,in0Con11454,in0Up_7528], outputs=Mul27775)
w = model.get_layer('Con23642').get_weights() 
w[0] = np.array([[[[[0.0676], [0.3966], [0.9196], [0.7637]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con23642').set_weights(w) 
in0Min83258 = tf.constant([[[0.357]]])
in1Min83258 = tf.constant([[[0.5824]]])
in0Con11454 = tf.constant([[[0.6962, 0.8942, 0.1172, 0.0611, 0.1552, 0.9777, 0.9573]]])
in0Up_7528 = tf.constant([[[1.5769, 1.2471]]])
print (np.array2string(model.predict([in0Min83258,in1Min83258,in0Con11454,in0Up_7528],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul27775.png')

LMin83258 = minimum_layer([[[[0.357]]], [[[0.5824]]]], Min83258), 
LCon11454 = concatenate_layer([Min83258,[[[0.6962, 0.8942, 0.1172, 0.0611, 0.1552, 0.9777, 0.9573]]]], 2, Con11454), 
LUp_7528 = up_sampling1D_layer([[[1.5769, 1.2471]]], 1, Up_7528), 
LAve92853 = average_pooling1D_layer(Up_7528, 1, 1, false, Ave92853), 
LRes88165 = reshape_layer(Ave92853, [1, 2, 1], Res88165), 
LRes14271 = reshape_layer(Res88165, [1, 2, 1, 1], Res14271), 
LCon23642 = conv3D_transpose_layer(Res14271, 1, 1, 1,[[[[[0.0676], [0.3966], [0.9196], [0.7637]]]]],[0, 0, 0, 0], 1, 1, 1, true, Con23642), 
LRes22709 = reshape_layer(Con23642, [1, 2, 4], Res22709), 
LRes56641 = reshape_layer(Res22709, [1, 8], Res56641), 
LMax60709 = max_pool1D_layer(Res56641, 1, Max60709), 
LMul27775 = multiply_layer([Con11454,Max60709], Mul27775), 
exec_layers([LMin83258,LCon11454,LUp_7528,LAve92853,LRes88165,LRes14271,LCon23642,LRes22709,LRes56641,LMax60709,LMul27775],["Min83258","Con11454","Up_7528","Ave92853","Res88165","Res14271","Con23642","Res22709","Res56641","Max60709","Mul27775"],Mul27775,"Mul27775")

Actual (Unparsed): [[[0.0380556, 0.4354025, 1.2966949, 0.1411414, 0.0051510, 0.0767619, 1.1212588, 0.9117424]]]

Expected (Unparsed): [[[0.03805564307999999,0.435402463548,1.296694836008,0.14114144371600001,0.005150971956,0.07676189827200001,1.1212587805320002,0.9117423514710001]]]

Actual:   [[[0.0381, 0.4355, 1.2967, 0.1412, 0.0052, 0.0768, 1.1213, 0.9118]]]

Expected: [[[0.0381, 0.4355, 1.2967, 0.1412, 0.0052, 0.0768, 1.1213, 0.9118]]]