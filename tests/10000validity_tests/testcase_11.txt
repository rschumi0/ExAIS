import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max38245 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Max38245 = tf.keras.layers.Input(shape=([2, 2, 2]))

Max38245 = keras.layers.Maximum(name = 'Max38245', )([in0Max38245,in1Max38245])
Dep72896 = keras.layers.DepthwiseConv2D((2, 1),strides=(2, 2), padding='same', name = 'Dep72896', )(Max38245)
Res29072 = keras.layers.Reshape((1, 2), name = 'Res29072', )(Dep72896)
Sep2108 = keras.layers.SeparableConv1D(4, (1),strides=(1), padding='valid', name = 'Sep2108', )(Res29072)
Res16012 = keras.layers.Reshape((1, 4, 1), name = 'Res16012', )(Sep2108)
Ave50415 = keras.layers.AveragePooling2D(pool_size=(1, 4), strides=(1, 1), padding='same', name = 'Ave50415', )(Res16012)
model = tf.keras.models.Model(inputs=[in0Max38245,in1Max38245], outputs=Ave50415)
w = model.get_layer('Dep72896').get_weights() 
w[0] = np.array([[[[0.9048], [0.2242]]], [[[0.1702], [0.9821]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep72896').set_weights(w) 
w = model.get_layer('Sep2108').get_weights() 
w[0] = np.array([[[0.0717], [0.9131]]])
w[1] = np.array([[[0.3315, 0.1647, 0.1068, 0.6312], [0.682, 0.7464, 0.6106, 0.4772]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep2108').set_weights(w) 
in0Max38245 = tf.constant([[[[0.8193, 0.7622], [0.3081, 0.0303]], [[0.5557, 0.2373], [0.7963, 0.7817]]]])
in1Max38245 = tf.constant([[[[0.9928, 0.7903], [0.6058, 0.1507]], [[0.1153, 0.6211], [0.1228, 0.1365]]]])
print (np.array2string(model.predict([in0Max38245,in1Max38245],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave50415.png')

LMax38245 = maximum_layer([[[[[0.8193, 0.7622], [0.3081, 0.0303]], [[0.5557, 0.2373], [0.7963, 0.7817]]]], [[[[0.9928, 0.7903], [0.6058, 0.1507]], [[0.1153, 0.6211], [0.1228, 0.1365]]]]], Max38245), 
LDep72896 = depthwise_conv2D_layer(Max38245, 2, 1,[[[[0.9048], [0.2242]]], [[[0.1702], [0.9821]]]],[0, 0], 2, 2, true, Dep72896), 
LRes29072 = reshape_layer(Dep72896, [1, 2], Res29072), 
LSep2108 = separable_conv1D_layer(Res29072, 1,[[[[0.0717], [0.9131]]],[[[0.3315, 0.1647, 0.1068, 0.6312], [0.682, 0.7464, 0.6106, 0.4772]]]],[0, 0, 0, 0], 1, false, Sep2108), 
LRes16012 = reshape_layer(Sep2108, [1, 4, 1], Res16012), 
LAve50415 = average_pooling2D_layer(Res16012, 1, 4, 1, 1, true, Ave50415), 
exec_layers([LMax38245,LDep72896,LRes29072,LSep2108,LRes16012,LAve50415],["Max38245","Dep72896","Res29072","Sep2108","Res16012","Ave50415"],Ave50415,"Ave50415")

Actual (Unparsed): [[[[0.5028279], [0.4741029], [0.4608721], [0.4172036]]]]

Expected (Unparsed): [[[[0.5028279348634569],[0.4741028815490866],[0.4608721280149812],[0.4172035794817653]]]]

Actual:   [[[[0.5029], [0.4742], [0.4609], [0.4173]]]]

Expected: [[[[0.5029], [0.4742], [0.4609], [0.4173]]]]