import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul9835 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Mul9835 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Bat36412 = tf.keras.layers.Input(shape=([4, 2, 1]))

Mul9835 = keras.layers.Multiply(name = 'Mul9835', )([in0Mul9835,in1Mul9835])
Mas45877 = keras.layers.Masking(mask_value=2, name = 'Mas45877', )(Mul9835)
Dep91594 = keras.layers.DepthwiseConv2D((1, 1),strides=(2, 2), padding='same', name = 'Dep91594', )(Mas45877)
Res11504 = keras.layers.Reshape((1, 2), name = 'Res11504', )(Dep91594)
Glo88380 = keras.layers.GlobalMaxPool1D(name = 'Glo88380', )(Res11504)
Bat36412 = keras.layers.BatchNormalization(axis=3, epsilon=0.17758861401774326,  name = 'Bat36412', )(in0Bat36412)
Res83402 = keras.layers.Reshape((4, 2), name = 'Res83402', )(Bat36412)
Glo876 = keras.layers.GlobalAveragePooling1D(name = 'Glo876', )(Res83402)
Sub36918 = keras.layers.Subtract(name = 'Sub36918', )([Glo88380,Glo876])
model = tf.keras.models.Model(inputs=[in0Mul9835,in1Mul9835,in0Bat36412], outputs=Sub36918)
w = model.get_layer('Dep91594').get_weights() 
w[0] = np.array([[[[0.158], [0.5046]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep91594').set_weights(w) 
w = model.get_layer('Bat36412').get_weights() 
w[0] = np.array([0.2249])
w[1] = np.array([0.519])
w[2] = np.array([0.9663])
w[3] = np.array([0.0747])
model.get_layer('Bat36412').set_weights(w) 
in0Mul9835 = tf.constant([[[[0.0042, 0.4806]], [[0.4772, 0.2604]]]])
in1Mul9835 = tf.constant([[[[0.9823, 0.9708]], [[0.1886, 0.8178]]]])
in0Bat36412 = tf.constant([[[[1.0657], [1.7444]], [[1.6684], [1.3371]], [[1.5746], [1.1927]], [[1.0547], [1.2259]]]])
print (np.array2string(model.predict([in0Mul9835,in1Mul9835,in0Bat36412],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub36918.png')

LMul9835 = multiply_layer([[[[[0.0042, 0.4806]], [[0.4772, 0.2604]]]], [[[[0.9823, 0.9708]], [[0.1886, 0.8178]]]]], Mul9835), 
LMas45877 = masking_layer(Mul9835, 2, Mas45877), 
LDep91594 = depthwise_conv2D_layer(Mas45877, 1, 1,[[[[0.158], [0.5046]]]],[0, 0], 2, 2, true, Dep91594), 
LRes11504 = reshape_layer(Dep91594, [1, 2], Res11504), 
LGlo88380 = global_max_pool1D_layer(Res11504, Glo88380), 
LBat36412 = batch_normalization_layer([[[[1.0657], [1.7444]], [[1.6684], [1.3371]], [[1.5746], [1.1927]], [[1.0547], [1.2259]]]], 3, 0.17758861401774326, [0.2249], [0.519], [0.9663], [0.0747], Bat36412), 
LRes83402 = reshape_layer(Bat36412, [4, 2], Res83402), 
LGlo876 = global_average_pooling1D_layer(Res83402, Glo876), 
LSub36918 = subtract_layer(Glo88380,Glo876, Sub36918), 
exec_layers([LMul9835,LMas45877,LDep91594,LRes11504,LGlo88380,LBat36412,LRes83402,LGlo876,LSub36918],["Mul9835","Mas45877","Dep91594","Res11504","Glo88380","Bat36412","Res83402","Glo876","Sub36918"],Sub36918,"Sub36918")

Actual (Unparsed): [[-0.6860549, -0.4665793]]

Expected (Unparsed): [[-0.686054852696462,-0.46657929483798705]]

Actual:   [[-0.686, -0.4665]]

Expected: [[-0.686, -0.4665]]