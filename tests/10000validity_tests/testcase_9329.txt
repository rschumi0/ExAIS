import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot23437 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot23437 = tf.keras.layers.Input(shape=([3, 2]))

Dot23437 = keras.layers.Dot(axes=(1, 1), name = 'Dot23437', )([in0Dot23437,in1Dot23437])
Res9341 = keras.layers.Reshape((2, 2, 1), name = 'Res9341', )(Dot23437)
Glo27350 = keras.layers.GlobalAveragePooling2D(name = 'Glo27350', )(Res9341)
Res2736 = keras.layers.Reshape((1, 1), name = 'Res2736', )(Glo27350)
Glo6400 = keras.layers.GlobalMaxPool1D(name = 'Glo6400', )(Res2736)
Res78406 = keras.layers.Reshape((1, 1), name = 'Res78406', )(Glo6400)
GRU7071 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU7071', )(Res78406)
model = tf.keras.models.Model(inputs=[in0Dot23437,in1Dot23437], outputs=GRU7071)
w = model.get_layer('GRU7071').get_weights() 
w[0] = np.array([[1, 3, 10, 10, 3, 1, 8, 3, 10]])
w[1] = np.array([[4, 3, 2, 4, 3, 3, 1, 8, 1], [2, 4, 7, 8, 7, 2, 8, 9, 8], [9, 8, 1, 2, 10, 5, 5, 1, 9]])
w[2] = np.array([[3, 4, 8, 2, 4, 1, 10, 2, 9], [1, 8, 1, 6, 7, 2, 1, 9, 2]])
model.get_layer('GRU7071').set_weights(w) 
in0Dot23437 = tf.constant([[[0.3247, 0.7717], [0.9522, 0.3085], [0.7959, 0.8764]]])
in1Dot23437 = tf.constant([[[0.0609, 0.631], [0.7325, 0.8688], [0.3581, 0.9894]]])
print (np.array2string(model.predict([in0Dot23437,in1Dot23437],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU7071.png')

LDot23437 = dot_layer([[[0.3247, 0.7717], [0.9522, 0.3085], [0.7959, 0.8764]]], [[[0.0609, 0.631], [0.7325, 0.8688], [0.3581, 0.9894]]], 1, 1, Dot23437), 
LRes9341 = reshape_layer(Dot23437, [2, 2, 1], Res9341), 
LGlo27350 = global_average_pooling2D_layer(Res9341, Glo27350), 
LRes2736 = reshape_layer(Glo27350, [1, 1], Res2736), 
LGlo6400 = global_max_pool1D_layer(Res2736, Glo6400), 
LRes78406 = reshape_layer(Glo6400, [1, 1], Res78406), 
LGRU7071 = gru_layer(Res78406,[[1, 3, 10, 10, 3, 1, 8, 3, 10]],[[4, 3, 2, 4, 3, 3, 1, 8, 1], [2, 4, 7, 8, 7, 2, 8, 9, 8], [9, 8, 1, 2, 10, 5, 5, 1, 9]],[[3, 4, 8, 2, 4, 1, 10, 2, 9], [1, 8, 1, 6, 7, 2, 1, 9, 2]], true, GRU7071), 
exec_layers([LDot23437,LRes9341,LGlo27350,LRes2736,LGlo6400,LRes78406,LGRU7071],["Dot23437","Res9341","Glo27350","Res2736","Glo6400","Res78406","GRU7071"],GRU7071,"GRU7071")

Actual (Unparsed): [[0.0051803, 0.0000001, 0.0000000]]

Expected (Unparsed): [[0.005180315280335024,1.4120023017479002e-7,4.2584069603890384e-10]]

Actual:   [[0.0052, 0, 0]]

Expected: [[0.0052, 0, 0]]