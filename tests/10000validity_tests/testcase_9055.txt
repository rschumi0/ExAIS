import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add20706 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Add20706 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Dot63123 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot63123 = tf.keras.layers.Input(shape=([2, 3]))
in0Con24421 = tf.keras.layers.Input(shape=([3, 1]))
in0Max48266 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con52613 = tf.keras.layers.Input(shape=([2, 3]))
in0Ave45243 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Ave45243 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Con21145 = tf.keras.layers.Input(shape=([3, 3]))

Add20706 = keras.layers.Add(name = 'Add20706', )([in0Add20706,in1Add20706])
Res76839 = keras.layers.Reshape((2, 4), name = 'Res76839', )(Add20706)
Zer52480 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer52480', )(Res76839)
Dot63123 = keras.layers.Dot(axes=(1, 1), name = 'Dot63123', )([in0Dot63123,in1Dot63123])
Con24421 = keras.layers.Concatenate(axis=2, name = 'Con24421', )([Dot63123,in0Con24421])
Min95364 = keras.layers.Minimum(name = 'Min95364', )([Zer52480,Con24421])
Max48266 = keras.layers.MaxPool2D(pool_size=(2, 1), strides=(1, 1), padding='same', name = 'Max48266', )(in0Max48266)
Fla68996 = keras.layers.Flatten(name = 'Fla68996', )(Max48266)
Res94514 = keras.layers.Reshape((2, 1), name = 'Res94514', )(Fla68996)
Con52613 = keras.layers.Concatenate(axis=2, name = 'Con52613', )([Res94514,in0Con52613])
Ave45243 = keras.layers.Average(name = 'Ave45243', )([in0Ave45243,in1Ave45243])
Res53901 = keras.layers.Reshape((1, 2, 2), name = 'Res53901', )(Ave45243)
Res76566 = keras.layers.Reshape((1, 4), name = 'Res76566', )(Res53901)
Dot50472 = keras.layers.Dot(axes=(2, 2), name = 'Dot50472', )([Con52613,Res76566])
Zer9334 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer9334', )(Dot50472)
Con21145 = keras.layers.Concatenate(axis=2, name = 'Con21145', )([Zer9334,in0Con21145])
Max7071 = keras.layers.Maximum(name = 'Max7071', )([Min95364,Con21145])
model = tf.keras.models.Model(inputs=[in0Add20706,in1Add20706,in0Dot63123,in1Dot63123,in0Con24421,in0Max48266,in0Con52613,in0Ave45243,in1Ave45243,in0Con21145], outputs=Max7071)
in0Add20706 = tf.constant([[[[0.0985, 0.1359], [0.1203, 0.9616]], [[0.3718, 0.5412], [0.2732, 0.0742]]]])
in1Add20706 = tf.constant([[[[0.865, 0.2427], [0.2592, 0.5546]], [[0.0056, 0.5362], [0.0491, 0.2963]]]])
in0Dot63123 = tf.constant([[[0.7896, 0.9685, 0.9172], [0.3856, 0.7943, 0.0305]]])
in1Dot63123 = tf.constant([[[0.3865, 0.5652, 0.1267], [0.6891, 0.7303, 0.6051]]])
in0Con24421 = tf.constant([[[0.8973], [0.1995], [0.8176]]])
in0Max48266 = tf.constant([[[[1.2854]], [[1.2581]]]])
in0Con52613 = tf.constant([[[0.9353, 0.1555, 0.6008], [0.2265, 0.1638, 0.7877]]])
in0Ave45243 = tf.constant([[[[[0.9383, 0.795]], [[0.9978, 0.3228]]]]])
in1Ave45243 = tf.constant([[[[[0.2131, 0.189]], [[0.5838, 0.3083]]]]])
in0Con21145 = tf.constant([[[0.337, 0.2903, 0.6683], [0.6176, 0.5437, 0.7587], [0.1731, 0.6908, 0.5454]]])
print (np.array2string(model.predict([in0Add20706,in1Add20706,in0Dot63123,in1Dot63123,in0Con24421,in0Max48266,in0Con52613,in0Ave45243,in1Ave45243,in0Con21145],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max7071.png')

LAdd20706 = add_layer([[[[[0.0985, 0.1359], [0.1203, 0.9616]], [[0.3718, 0.5412], [0.2732, 0.0742]]]], [[[[0.865, 0.2427], [0.2592, 0.5546]], [[0.0056, 0.5362], [0.0491, 0.2963]]]]], Add20706), 
LRes76839 = reshape_layer(Add20706, [2, 4], Res76839), 
LZer52480 = zero_padding1D_layer(Res76839, 1, 0, Zer52480), 
LDot63123 = dot_layer([[[0.7896, 0.9685, 0.9172], [0.3856, 0.7943, 0.0305]]], [[[0.3865, 0.5652, 0.1267], [0.6891, 0.7303, 0.6051]]], 1, 1, Dot63123), 
LCon24421 = concatenate_layer([Dot63123,[[[0.8973], [0.1995], [0.8176]]]], 2, Con24421), 
LMin95364 = minimum_layer([Zer52480,Con24421], Min95364), 
LMax48266 = max_pool2D_layer([[[[1.2854]], [[1.2581]]]], 2, 1, 1, 1, true, Max48266), 
LFla68996 = flatten_layer(Max48266, Fla68996), 
LRes94514 = reshape_layer(Fla68996, [2, 1], Res94514), 
LCon52613 = concatenate_layer([Res94514,[[[0.9353, 0.1555, 0.6008], [0.2265, 0.1638, 0.7877]]]], 2, Con52613), 
LAve45243 = average_layer([[[[[[0.9383, 0.795]], [[0.9978, 0.3228]]]]], [[[[[0.2131, 0.189]], [[0.5838, 0.3083]]]]]], Ave45243), 
LRes53901 = reshape_layer(Ave45243, [1, 2, 2], Res53901), 
LRes76566 = reshape_layer(Res53901, [1, 4], Res76566), 
LDot50472 = dot_layer(Con52613,Res76566, 2, 2, Dot50472), 
LZer9334 = zero_padding1D_layer(Dot50472, 1, 0, Zer9334), 
LCon21145 = concatenate_layer([Zer9334,[[[0.337, 0.2903, 0.6683], [0.6176, 0.5437, 0.7587], [0.1731, 0.6908, 0.5454]]]], 2, Con21145), 
LMax7071 = maximum_layer([Min95364,Con21145], Max7071), 
exec_layers([LAdd20706,LRes76839,LZer52480,LDot63123,LCon24421,LMin95364,LMax48266,LFla68996,LRes94514,LCon52613,LAve45243,LRes53901,LRes76566,LDot50472,LZer9334,LCon21145,LMax7071],["Add20706","Res76839","Zer52480","Dot63123","Con24421","Min95364","Max48266","Fla68996","Res94514","Con52613","Ave45243","Res53901","Res76566","Dot50472","Zer9334","Con21145","Max7071"],Max7071,"Max7071")

Actual (Unparsed): [[[0.0000000, 0.3370000, 0.2903000, 0.6683000], [1.5127242, 0.6176000, 0.5437000, 0.7587000], [1.2138180, 0.5406756, 0.6908000, 0.5454000]]]

Expected (Unparsed): [[[0,0.337,0.2903,0.6683],[1.51272422,0.6176,0.5437,0.7587],[1.213817945,0.54067559,0.6908,0.5454]]]

Actual:   [[[0, 0.337, 0.2903, 0.6683], [1.5128, 0.6176, 0.5437, 0.7587], [1.2139, 0.5407, 0.6908, 0.5454]]]

Expected: [[[0, 0.337, 0.2903, 0.6683], [1.5128, 0.6176, 0.5437, 0.7587], [1.2139, 0.5407, 0.6908, 0.5454]]]