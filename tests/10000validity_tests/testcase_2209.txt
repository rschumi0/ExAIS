import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave56510 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Ave56510 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))

Ave56510 = keras.layers.Average(name = 'Ave56510', )([in0Ave56510,in1Ave56510])
Sof55020 = keras.layers.Softmax(axis=1, name = 'Sof55020', )(Ave56510)
Bat23698 = keras.layers.BatchNormalization(axis=3, epsilon=0.22454879511906828,  name = 'Bat23698', )(Sof55020)
model = tf.keras.models.Model(inputs=[in0Ave56510,in1Ave56510], outputs=Bat23698)
w = model.get_layer('Bat23698').get_weights() 
w[0] = np.array([0.3111, 0.5203])
w[1] = np.array([0.8918, 0.8379])
w[2] = np.array([0.58, 0.5924])
w[3] = np.array([0.7045, 0.9815])
model.get_layer('Bat23698').set_weights(w) 
in0Ave56510 = tf.constant([[[[[0.9081, 0.5986], [0.4518, 0.3422]], [[0.5044, 0.5234], [0.5838, 0.3642]]], [[[0.8357, 0.5079], [0.8427, 0.0601]], [[0.8461, 0.4937], [0.3209, 0.2481]]]]])
in1Ave56510 = tf.constant([[[[[0.6058, 0.1503], [0.896, 0.5653]], [[0.7918, 0.2333], [0.1821, 0.9022]]], [[[0.1138, 0.3069], [0.5422, 0.5299]], [[0.2046, 0.8844], [0.0577, 0.8528]]]]])
print (np.array2string(model.predict([in0Ave56510,in1Ave56510],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Bat23698.png')

LAve56510 = average_layer([[[[[[0.9081, 0.5986], [0.4518, 0.3422]], [[0.5044, 0.5234], [0.5838, 0.3642]]], [[[0.8357, 0.5079], [0.8427, 0.0601]], [[0.8461, 0.4937], [0.3209, 0.2481]]]]], [[[[[0.6058, 0.1503], [0.896, 0.5653]], [[0.7918, 0.2333], [0.1821, 0.9022]]], [[[0.1138, 0.3069], [0.5422, 0.5299]], [[0.2046, 0.8844], [0.0577, 0.8528]]]]]], Ave56510), 
LSof55020 = softmax_layer(Ave56510, 1, Sof55020), 
LBat23698 = batch_normalization_layer(Sof55020, 3, 0.22454879511906828, [0.3111, 0.5203], [0.8918, 0.8379], [0.58, 0.5924], [0.7045, 0.9815], Bat23698), 
exec_layers([LAve56510,LSof55020,LBat23698],["Ave56510","Sof55020","Bat23698"],Bat23698,"Bat23698")

Actual (Unparsed): [[[[[0.8886000, 0.8633206], [0.7919262, 0.8128868]], [[0.8758714, 0.8411084], [0.8169884, 0.8039189]]], [[[0.8433583, 0.8686376], [0.7963203, 0.7753597]], [[0.8560868, 0.8908498], [0.7712581, 0.7843277]]]]]

Expected (Unparsed): [[[[[0.8885999884698297,0.8633206366867227],[0.7919262012513617,0.812886789367621]],[[0.8758714413521674,0.8411084470133495],[0.8169884486761544,0.8039188802601447]]],[[[0.8433582876148028,0.8686376393979097],[0.7963203307458573,0.775359742629598]],[[0.856086834732465,0.890849829071283],[0.7712580833210646,0.7843276517370743]]]]]

Actual:   [[[[[0.8886, 0.8634], [0.792, 0.8129]], [[0.8759, 0.8412], [0.817, 0.804]]], [[[0.8434, 0.8687], [0.7964, 0.7754]], [[0.8561, 0.8909], [0.7713, 0.7844]]]]]

Expected: [[[[[0.8886, 0.8634], [0.792, 0.8129]], [[0.8759, 0.8412], [0.817, 0.804]]], [[[0.8434, 0.8687], [0.7964, 0.7754]], [[0.8561, 0.8909], [0.7713, 0.7844]]]]]