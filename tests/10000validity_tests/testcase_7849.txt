import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min58202 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Min58202 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con62061 = tf.keras.layers.Input(shape=([4, 3, 3]))
in0Ave77376 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave77376 = tf.keras.layers.Input(shape=([2, 1]))
in0Con97032 = tf.keras.layers.Input(shape=([4, 3, 1]))
in0Ave36823 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Ave36823 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))

Min58202 = keras.layers.Minimum(name = 'Min58202', )([in0Min58202,in1Min58202])
Zer33084 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer33084', )(Min58202)
Con62061 = keras.layers.Concatenate(axis=3, name = 'Con62061', )([Zer33084,in0Con62061])
Ave77376 = keras.layers.Average(name = 'Ave77376', )([in0Ave77376,in1Ave77376])
Res1623 = keras.layers.Reshape((2, 1, 1), name = 'Res1623', )(Ave77376)
Res39314 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res39314', )(Res1623)
Zer86036 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer86036', )(Res39314)
Res48200 = keras.layers.Reshape((4, 3, 3), name = 'Res48200', )(Zer86036)
Con97032 = keras.layers.Concatenate(axis=3, name = 'Con97032', )([Res48200,in0Con97032])
Ave36823 = keras.layers.Average(name = 'Ave36823', )([in0Ave36823,in1Ave36823])
Res36684 = keras.layers.Reshape((2, 2, 2), name = 'Res36684', )(Ave36823)
Res5186 = keras.layers.Reshape((2, 4), name = 'Res5186', )(Res36684)
Glo12792 = keras.layers.GlobalMaxPool1D(name = 'Glo12792', )(Res5186)
Res42506 = keras.layers.Reshape((4, 1), name = 'Res42506', )(Glo12792)
Res15342 = keras.layers.Reshape((4, 1, 1), name = 'Res15342', )(Res42506)
Con77154 = keras.layers.Conv2DTranspose(3, (4, 1),strides=(1, 1), padding='same', name = 'Con77154', )(Res15342)
Loc68465 = keras.layers.LocallyConnected2D(4, (3, 1),strides=(1, 1), name = 'Loc68465', )(Con77154)
Zer82875 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer82875', )(Loc68465)
Sub20248 = keras.layers.Subtract(name = 'Sub20248', )([Con97032,Zer82875])
Sub21916 = keras.layers.Subtract(name = 'Sub21916', )([Con62061,Sub20248])
model = tf.keras.models.Model(inputs=[in0Min58202,in1Min58202,in0Con62061,in0Ave77376,in1Ave77376,in0Con97032,in0Ave36823,in1Ave36823], outputs=Sub21916)
w = model.get_layer('Con77154').get_weights() 
w[0] = np.array([[[[0.306], [0.425], [0.041]]], [[[0.8781], [0.992], [0.2675]]], [[[0.8732], [0.4659], [0.8148]]], [[[0.3634], [0.6202], [0.0865]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con77154').set_weights(w) 
w = model.get_layer('Loc68465').get_weights() 
w[0] = np.array([[[0.8327, 0.3757, 0.2219, 0.2835], [0.8665, 0.0716, 0.2582, 0.5807], [0.1924, 0.1538, 0.5178, 0.9024], [0.185, 0.3029, 0.1103, 0.2442], [0.2559, 0.6602, 0.3114, 0.1091], [0.7894, 0.8116, 0.8353, 0.3224], [0.7166, 0.8998, 0.6967, 0.887], [0.721, 0.776, 0.2139, 0.7465], [0.0047, 0.1421, 0.4083, 0.7503]], [[0.2679, 0.7083, 0.0421, 0.0801], [0.0521, 0.4885, 0.8009, 0.8865], [0.8808, 0.4967, 0.6772, 0.9145], [0.6964, 0.2649, 0.4389, 0.4452], [0.9335, 0.8062, 0.1788, 0.9751], [0.1979, 0.8692, 0.3298, 0.6662], [0.9265, 0.5919, 0.2069, 0.7554], [0.591, 0.9519, 0.0883, 0.7866], [0.9802, 0.7299, 0.085, 0.7459]]])
w[1] = np.array([[[0, 0, 0, 0]], [[0, 0, 0, 0]]])
model.get_layer('Loc68465').set_weights(w) 
in0Min58202 = tf.constant([[[[0.2082]], [[0.0643]]]])
in1Min58202 = tf.constant([[[[0.7541]], [[0.0043]]]])
in0Con62061 = tf.constant([[[[0.1502, 0.7193, 0.387], [0.3257, 0.4293, 0.5012], [0.0517, 0.468, 0.5185]], [[0.6124, 0.2798, 0.0462], [0.2841, 0.1356, 0.8159], [0.1455, 0.7347, 0.1683]], [[0.9583, 0.5812, 0.2977], [0.9982, 0.2676, 0.9171], [0.1001, 0.3767, 0.8485]], [[0.084, 0.5681, 0.7981], [0.0946, 0.69, 0.814], [0.8783, 0.0749, 0.0654]]]])
in0Ave77376 = tf.constant([[[0.6698], [0.7368]]])
in1Ave77376 = tf.constant([[[0.6632], [0.0357]]])
in0Con97032 = tf.constant([[[[0.0464], [0.8861], [0.695]], [[0.3674], [0.5621], [0.4123]], [[0.0811], [0.4276], [0.2254]], [[0.7341], [0.999], [0.7309]]]])
in0Ave36823 = tf.constant([[[[[0.6045], [0.4943]], [[0.0234], [0.1832]]], [[[0.5026], [0.6924]], [[0.9348], [0.9899]]]]])
in1Ave36823 = tf.constant([[[[[0.2055], [0.2773]], [[0.8367], [0.8479]]], [[[0.7103], [0.303]], [[0.1518], [0.6236]]]]])
print (np.array2string(model.predict([in0Min58202,in1Min58202,in0Con62061,in0Ave77376,in1Ave77376,in0Con97032,in0Ave36823,in1Ave36823],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub21916.png')

LMin58202 = minimum_layer([[[[[0.2082]], [[0.0643]]]], [[[[0.7541]], [[0.0043]]]]], Min58202), 
LZer33084 = zero_padding2D_layer(Min58202, 2, 0, 2, 0, Zer33084), 
LCon62061 = concatenate_layer([Zer33084,[[[[0.1502, 0.7193, 0.387], [0.3257, 0.4293, 0.5012], [0.0517, 0.468, 0.5185]], [[0.6124, 0.2798, 0.0462], [0.2841, 0.1356, 0.8159], [0.1455, 0.7347, 0.1683]], [[0.9583, 0.5812, 0.2977], [0.9982, 0.2676, 0.9171], [0.1001, 0.3767, 0.8485]], [[0.084, 0.5681, 0.7981], [0.0946, 0.69, 0.814], [0.8783, 0.0749, 0.0654]]]]], 3, Con62061), 
LAve77376 = average_layer([[[[0.6698], [0.7368]]], [[[0.6632], [0.0357]]]], Ave77376), 
LRes1623 = reshape_layer(Ave77376, [2, 1, 1], Res1623), 
LRes39314 = reshape_layer(Res1623, [2, 1, 1, 1], Res39314), 
LZer86036 = zero_padding3D_layer(Res39314, 1, 1, 1, 1, 1, 1, Zer86036), 
LRes48200 = reshape_layer(Zer86036, [4, 3, 3], Res48200), 
LCon97032 = concatenate_layer([Res48200,[[[[0.0464], [0.8861], [0.695]], [[0.3674], [0.5621], [0.4123]], [[0.0811], [0.4276], [0.2254]], [[0.7341], [0.999], [0.7309]]]]], 3, Con97032), 
LAve36823 = average_layer([[[[[[0.6045], [0.4943]], [[0.0234], [0.1832]]], [[[0.5026], [0.6924]], [[0.9348], [0.9899]]]]], [[[[[0.2055], [0.2773]], [[0.8367], [0.8479]]], [[[0.7103], [0.303]], [[0.1518], [0.6236]]]]]], Ave36823), 
LRes36684 = reshape_layer(Ave36823, [2, 2, 2], Res36684), 
LRes5186 = reshape_layer(Res36684, [2, 4], Res5186), 
LGlo12792 = global_max_pool1D_layer(Res5186, Glo12792), 
LRes42506 = reshape_layer(Glo12792, [4, 1], Res42506), 
LRes15342 = reshape_layer(Res42506, [4, 1, 1], Res15342), 
LCon77154 = conv2D_transpose_layer(Res15342, 4, 1,[[[[0.306], [0.425], [0.041]]], [[[0.8781], [0.992], [0.2675]]], [[[0.8732], [0.4659], [0.8148]]], [[[0.3634], [0.6202], [0.0865]]]],[0, 0, 0], 1, 1, true, Con77154), 
LLoc68465 = locally_connected2D_layer(Con77154, 3, 1,[[[0.8327, 0.3757, 0.2219, 0.2835], [0.8665, 0.0716, 0.2582, 0.5807], [0.1924, 0.1538, 0.5178, 0.9024], [0.185, 0.3029, 0.1103, 0.2442], [0.2559, 0.6602, 0.3114, 0.1091], [0.7894, 0.8116, 0.8353, 0.3224], [0.7166, 0.8998, 0.6967, 0.887], [0.721, 0.776, 0.2139, 0.7465], [0.0047, 0.1421, 0.4083, 0.7503]], [[0.2679, 0.7083, 0.0421, 0.0801], [0.0521, 0.4885, 0.8009, 0.8865], [0.8808, 0.4967, 0.6772, 0.9145], [0.6964, 0.2649, 0.4389, 0.4452], [0.9335, 0.8062, 0.1788, 0.9751], [0.1979, 0.8692, 0.3298, 0.6662], [0.9265, 0.5919, 0.2069, 0.7554], [0.591, 0.9519, 0.0883, 0.7866], [0.9802, 0.7299, 0.085, 0.7459]]],[[[0, 0, 0, 0]], [[0, 0, 0, 0]]], 1, 1, Loc68465), 
LZer82875 = zero_padding2D_layer(Loc68465, 2, 0, 2, 0, Zer82875), 
LSub20248 = subtract_layer(Con97032,Zer82875, Sub20248), 
LSub21916 = subtract_layer(Con62061,Sub20248, Sub21916), 
exec_layers([LMin58202,LZer33084,LCon62061,LAve77376,LRes1623,LRes39314,LZer86036,LRes48200,LCon97032,LAve36823,LRes36684,LRes5186,LGlo12792,LRes42506,LRes15342,LCon77154,LLoc68465,LZer82875,LSub20248,LSub21916],["Min58202","Zer33084","Con62061","Ave77376","Res1623","Res39314","Zer86036","Res48200","Con97032","Ave36823","Res36684","Res5186","Glo12792","Res42506","Res15342","Con77154","Loc68465","Zer82875","Sub20248","Sub21916"],Sub21916,"Sub21916")

Actual (Unparsed): [[[[0.0000000, 0.1502000, 0.7193000, 0.3406000], [0.0000000, 0.3257000, 0.4293000, -0.3849000], [0.0000000, 0.0517000, 0.4680000, -0.1765000]], [[0.0000000, 0.6124000, 0.2798000, -0.3212000], [0.0000000, -0.3824000, 0.1356000, 0.2538000], [0.0000000, 0.1455000, 0.7347000, -0.2440000]], [[0.0000000, 0.9583000, 0.5812000, 0.2166000], [0.0000000, 0.6119500, 0.2676000, 0.4895000], [4.5634970, 4.4662104, 3.3535247, 4.8628981]], [[0.0000000, 0.0840000, 0.5681000, 0.0640000], [0.0000000, 0.0946000, 0.6900000, -0.1850000], [6.1654384, 7.2306272, 2.9126202, 6.0275075]]]]

Expected (Unparsed): [[[[0,0.1502,0.7193,0.3406],[0,0.3257,0.4293,-0.3849],[0,0.0517,0.468,-0.1765]],[[0,0.6124,0.2798,-0.3212],[0,-0.38239999999999996,0.1356,0.2537999999999999],[0,0.1455,0.7347,-0.244]],[[0,0.9583,0.5812,0.21660000000000001],[0,0.61195,0.2676,0.48950000000000005],[4.5634969705695,4.466210362986001,3.3535246732219997,4.862898010454501]],[[0,0.084,0.5681,0.06400000000000006],[0,0.0946,0.69,-0.18500000000000005],[6.1654383098295,7.230627128609502,2.912620129463,6.027507390333001]]]]

Actual:   [[[[0, 0.1502, 0.7193, 0.3406], [0, 0.3257, 0.4293, -0.3849], [0, 0.0517, 0.468, -0.1765]], [[0, 0.6124, 0.2798, -0.3212], [0, -0.3824, 0.1356, 0.2538], [0, 0.1455, 0.7347, -0.244]], [[0, 0.9583, 0.5812, 0.2166], [0, 0.612, 0.2676, 0.4895], [4.5635, 4.4663, 3.3536, 4.8629]], [[0, 0.084, 0.5681, 0.064], [0, 0.0946, 0.69, -0.185], [6.1655, 7.2307, 2.9127, 6.0276]]]]

Expected: [[[[0, 0.1502, 0.7193, 0.3406], [0, 0.3257, 0.4293, -0.3849], [0, 0.0517, 0.468, -0.1765]], [[0, 0.6124, 0.2798, -0.3212], [0, -0.3823, 0.1356, 0.2538], [0, 0.1455, 0.7347, -0.244]], [[0, 0.9583, 0.5812, 0.2167], [0, 0.612, 0.2676, 0.4896], [4.5635, 4.4663, 3.3536, 4.8629]], [[0, 0.084, 0.5681, 0.0641], [0, 0.0946, 0.69, -0.185], [6.1655, 7.2307, 2.9127, 6.0276]]]]