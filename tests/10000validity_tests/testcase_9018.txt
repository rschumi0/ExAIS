import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Bat35622 = tf.keras.layers.Input(shape=([1]))
in0Con31970 = tf.keras.layers.Input(shape=([1, 1]))
in0Mul93300 = tf.keras.layers.Input(shape=([1, 2]))
in1Mul93300 = tf.keras.layers.Input(shape=([1, 2]))

Bat35622 = keras.layers.BatchNormalization(axis=1, epsilon=0.6821143943550609,  name = 'Bat35622', )(in0Bat35622)
Res12574 = keras.layers.Reshape((1, 1), name = 'Res12574', )(Bat35622)
Con31970 = keras.layers.Concatenate(axis=2, name = 'Con31970', )([Res12574,in0Con31970])
Mul93300 = keras.layers.Multiply(name = 'Mul93300', )([in0Mul93300,in1Mul93300])
Res53054 = keras.layers.Reshape((1, 2, 1), name = 'Res53054', )(Mul93300)
Res51236 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res51236', )(Res53054)
Up_13863 = keras.layers.UpSampling3D(size=(2, 1, 1), name = 'Up_13863', )(Res51236)
Res5308 = keras.layers.Reshape((2, 2, 1), name = 'Res5308', )(Up_13863)
Res31439 = keras.layers.Reshape((2, 2), name = 'Res31439', )(Res5308)
Dot99646 = keras.layers.Dot(axes=(2, 2), name = 'Dot99646', )([Con31970,Res31439])
Mas15051 = keras.layers.Masking(mask_value=2, name = 'Mas15051', )(Dot99646)
model = tf.keras.models.Model(inputs=[in0Bat35622,in0Con31970,in0Mul93300,in1Mul93300], outputs=Mas15051)
w = model.get_layer('Bat35622').get_weights() 
w[0] = np.array([0.1419])
w[1] = np.array([0.9071])
w[2] = np.array([0.7345])
w[3] = np.array([0.3898])
model.get_layer('Bat35622').set_weights(w) 
in0Bat35622 = tf.constant([[1.3769]])
in0Con31970 = tf.constant([[[0.8018]]])
in0Mul93300 = tf.constant([[[0.2957, 0.5021]]])
in1Mul93300 = tf.constant([[[0.1403, 0.3279]]])
print (np.array2string(model.predict([in0Bat35622,in0Con31970,in0Mul93300,in1Mul93300],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mas15051.png')

LBat35622 = batch_normalization_layer([[1.3769]], 1, 0.6821143943550609, [0.1419], [0.9071], [0.7345], [0.3898], Bat35622), 
LRes12574 = reshape_layer(Bat35622, [1, 1], Res12574), 
LCon31970 = concatenate_layer([Res12574,[[[0.8018]]]], 2, Con31970), 
LMul93300 = multiply_layer([[[[0.2957, 0.5021]]], [[[0.1403, 0.3279]]]], Mul93300), 
LRes53054 = reshape_layer(Mul93300, [1, 2, 1], Res53054), 
LRes51236 = reshape_layer(Res53054, [1, 2, 1, 1], Res51236), 
LUp_13863 = up_sampling3D_layer(Res51236, 2, 1, 1, Up_13863), 
LRes5308 = reshape_layer(Up_13863, [2, 2, 1], Res5308), 
LRes31439 = reshape_layer(Res5308, [2, 2], Res31439), 
LDot99646 = dot_layer(Con31970,Res31439, 2, 2, Dot99646), 
LMas15051 = masking_layer(Dot99646, 2, Mas15051), 
exec_layers([LBat35622,LRes12574,LCon31970,LMul93300,LRes53054,LRes51236,LUp_13863,LRes5308,LRes31439,LDot99646,LMas15051],["Bat35622","Res12574","Con31970","Mul93300","Res53054","Res51236","Up_13863","Res5308","Res31439","Dot99646","Mas15051"],Mas15051,"Mas15051")

Actual (Unparsed): [[[0.1732925, 0.1732925]]]

Expected (Unparsed): [[[0.17329254021797014,0.17329254021797014]]]

Actual:   [[[0.1733, 0.1733]]]

Expected: [[[0.1733, 0.1733]]]