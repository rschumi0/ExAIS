import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc66450 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Max81046 = tf.keras.layers.Input(shape=([2, 1]))
in1Max81046 = tf.keras.layers.Input(shape=([2, 1]))
in0Con86666 = tf.keras.layers.Input(shape=([1, 1]))

Loc66450 = keras.layers.LocallyConnected2D(3, (1, 2),strides=(3, 1), name = 'Loc66450', )(in0Loc66450)
Res59208 = keras.layers.Reshape((1, 3), name = 'Res59208', )(Loc66450)
Max81046 = keras.layers.Maximum(name = 'Max81046', )([in0Max81046,in1Max81046])
Per14234 = keras.layers.Permute((2,1), name = 'Per14234',)(Max81046)
Con86666 = keras.layers.Concatenate(axis=2, name = 'Con86666', )([Per14234,in0Con86666])
Sub19541 = keras.layers.Subtract(name = 'Sub19541', )([Res59208,Con86666])
model = tf.keras.models.Model(inputs=[in0Loc66450,in0Max81046,in1Max81046,in0Con86666], outputs=Sub19541)
w = model.get_layer('Loc66450').get_weights() 
w[0] = np.array([[[0.0214, 0.2883, 0.1821], [0.3283, 0.5773, 0.4767], [0.5673, 0.4759, 0.2588], [0.0773, 0.0205, 0.7483]]])
w[1] = np.array([[[0, 0, 0]]])
model.get_layer('Loc66450').set_weights(w) 
in0Loc66450 = tf.constant([[[[0.8177, 0.1482], [0.0788, 0.9956]]]])
in0Max81046 = tf.constant([[[0.8722], [0.2454]]])
in1Max81046 = tf.constant([[[0.8951], [0.7095]]])
in0Con86666 = tf.constant([[[0.2647]]])
print (np.array2string(model.predict([in0Loc66450,in0Max81046,in1Max81046,in0Con86666],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub19541.png')

LLoc66450 = locally_connected2D_layer([[[[0.8177, 0.1482], [0.0788, 0.9956]]]], 1, 2,[[[0.0214, 0.2883, 0.1821], [0.3283, 0.5773, 0.4767], [0.5673, 0.4759, 0.2588], [0.0773, 0.0205, 0.7483]]],[[[0, 0, 0]]], 3, 1, Loc66450), 
LRes59208 = reshape_layer(Loc66450, [1, 3], Res59208), 
LMax81046 = maximum_layer([[[[0.8722], [0.2454]]], [[[0.8951], [0.7095]]]], Max81046), 
LPer14234 = permute_layer(Max81046, 2,1, Per14234), 
LCon86666 = concatenate_layer([Per14234,[[[0.2647]]]], 2, Con86666), 
LSub19541 = subtract_layer(Res59208,Con86666, Sub19541), 
exec_layers([LLoc66450,LRes59208,LMax81046,LPer14234,LCon86666,LSub19541],["Loc66450","Res59208","Max81046","Per14234","Con86666","Sub19541"],Sub19541,"Sub19541")

Actual (Unparsed): [[[-0.7072840, -0.3302905, 0.7202510]]]

Expected (Unparsed): [[[-0.70728404,-0.33029051000000004,0.72025103]]]

Actual:   [[[-0.7072, -0.3302, 0.7203]]]

Expected: [[[-0.7072, -0.3302, 0.7203]]]