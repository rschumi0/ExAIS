import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot2983 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot2983 = tf.keras.layers.Input(shape=([3, 3]))
in0Mul85814 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Mul85814 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Con54298 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0GRU27660 = tf.keras.layers.Input(shape=([1, 3]))
in0Con54594 = tf.keras.layers.Input(shape=([3, 1, 1]))
in0Max18663 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Max18663 = tf.keras.layers.Input(shape=([1, 1, 2]))

Dot2983 = keras.layers.Dot(axes=(1, 1), name = 'Dot2983', )([in0Dot2983,in1Dot2983])
Res41886 = keras.layers.Reshape((3, 3, 1), name = 'Res41886', )(Dot2983)
Res28594 = keras.layers.Reshape((3, 3, 1, 1), name = 'Res28594', )(Res41886)
Mul85814 = keras.layers.Multiply(name = 'Mul85814', )([in0Mul85814,in1Mul85814])
Zer29022 = keras.layers.ZeroPadding3D(padding=((2, 0), (1, 0), (0, 0)), name = 'Zer29022', )(Mul85814)
Ave50338 = keras.layers.Average(name = 'Ave50338', )([Res28594,Zer29022])
Res62644 = keras.layers.Reshape((3, 3, 1), name = 'Res62644', )(Ave50338)
Con54298 = keras.layers.Concatenate(axis=3, name = 'Con54298', )([Res62644,in0Con54298])
GRU27660 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU27660', )(in0GRU27660)
Res94790 = keras.layers.Reshape((3, 1), name = 'Res94790', )(GRU27660)
Res92867 = keras.layers.Reshape((3, 1, 1), name = 'Res92867', )(Res94790)
Con54594 = keras.layers.Concatenate(axis=3, name = 'Con54594', )([Res92867,in0Con54594])
Max18663 = keras.layers.Maximum(name = 'Max18663', )([in0Max18663,in1Max18663])
Zer8974 = keras.layers.ZeroPadding2D(padding=((2, 0), (0, 0)), name = 'Zer8974', )(Max18663)
Add11752 = keras.layers.Add(name = 'Add11752', )([Con54594,Zer8974])
Zer25339 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer25339', )(Add11752)
Mul15274 = keras.layers.Multiply(name = 'Mul15274', )([Con54298,Zer25339])
Glo75232 = keras.layers.GlobalMaxPool2D(name = 'Glo75232', )(Mul15274)
Res29926 = keras.layers.Reshape((2, 1), name = 'Res29926', )(Glo75232)
Glo79579 = keras.layers.GlobalAveragePooling1D(name = 'Glo79579', )(Res29926)
model = tf.keras.models.Model(inputs=[in0Dot2983,in1Dot2983,in0Mul85814,in1Mul85814,in0Con54298,in0GRU27660,in0Con54594,in0Max18663,in1Max18663], outputs=Glo79579)
w = model.get_layer('GRU27660').get_weights() 
w[0] = np.array([[7, 4, 1, 3, 1, 8, 4, 3, 10], [5, 7, 10, 2, 3, 6, 10, 4, 5], [5, 5, 4, 2, 8, 9, 5, 1, 5]])
w[1] = np.array([[8, 7, 10, 4, 8, 4, 5, 1, 5], [8, 3, 3, 10, 6, 10, 4, 1, 8], [9, 10, 4, 5, 6, 6, 2, 5, 2]])
w[2] = np.array([[6, 2, 5, 4, 1, 6, 1, 8, 5], [4, 9, 1, 5, 6, 2, 3, 2, 7]])
model.get_layer('GRU27660').set_weights(w) 
in0Dot2983 = tf.constant([[[0.9659, 0.1858, 0.8597], [0.6022, 0.1892, 0.0925], [0.7034, 0.1323, 0.4981]]])
in1Dot2983 = tf.constant([[[0.4633, 0.7293, 0.233], [0.9869, 0.3299, 0.2237], [0.6524, 0.2438, 0.433]]])
in0Mul85814 = tf.constant([[[[[0.0745]], [[0.9724]]]]])
in1Mul85814 = tf.constant([[[[[0.6938]], [[0.0447]]]]])
in0Con54298 = tf.constant([[[[0.4618], [0.295], [0.4317]], [[0.2665], [0.2597], [0.1872]], [[0.4767], [0.6032], [0.2792]]]])
in0GRU27660 = tf.constant([[[1, 6, 9]]])
in0Con54594 = tf.constant([[[[0.8854]], [[0.818]], [[0.5325]]]])
in0Max18663 = tf.constant([[[[0.1615, 0.1217]]]])
in1Max18663 = tf.constant([[[[0.4962, 0.1317]]]])
print (np.array2string(model.predict([in0Dot2983,in1Dot2983,in0Mul85814,in1Mul85814,in0Con54298,in0GRU27660,in0Con54594,in0Max18663,in1Max18663],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo79579.png')

LDot2983 = dot_layer([[[0.9659, 0.1858, 0.8597], [0.6022, 0.1892, 0.0925], [0.7034, 0.1323, 0.4981]]], [[[0.4633, 0.7293, 0.233], [0.9869, 0.3299, 0.2237], [0.6524, 0.2438, 0.433]]], 1, 1, Dot2983), 
LRes41886 = reshape_layer(Dot2983, [3, 3, 1], Res41886), 
LRes28594 = reshape_layer(Res41886, [3, 3, 1, 1], Res28594), 
LMul85814 = multiply_layer([[[[[[0.0745]], [[0.9724]]]]], [[[[[0.6938]], [[0.0447]]]]]], Mul85814), 
LZer29022 = zero_padding3D_layer(Mul85814, 2, 0, 1, 0, 0, 0, Zer29022), 
LAve50338 = average_layer([Res28594,Zer29022], Ave50338), 
LRes62644 = reshape_layer(Ave50338, [3, 3, 1], Res62644), 
LCon54298 = concatenate_layer([Res62644,[[[[0.4618], [0.295], [0.4317]], [[0.2665], [0.2597], [0.1872]], [[0.4767], [0.6032], [0.2792]]]]], 3, Con54298), 
LGRU27660 = gru_layer([[[1, 6, 9]]],[[7, 4, 1, 3, 1, 8, 4, 3, 10], [5, 7, 10, 2, 3, 6, 10, 4, 5], [5, 5, 4, 2, 8, 9, 5, 1, 5]],[[8, 7, 10, 4, 8, 4, 5, 1, 5], [8, 3, 3, 10, 6, 10, 4, 1, 8], [9, 10, 4, 5, 6, 6, 2, 5, 2]],[[6, 2, 5, 4, 1, 6, 1, 8, 5], [4, 9, 1, 5, 6, 2, 3, 2, 7]], true, GRU27660), 
LRes94790 = reshape_layer(GRU27660, [3, 1], Res94790), 
LRes92867 = reshape_layer(Res94790, [3, 1, 1], Res92867), 
LCon54594 = concatenate_layer([Res92867,[[[[0.8854]], [[0.818]], [[0.5325]]]]], 3, Con54594), 
LMax18663 = maximum_layer([[[[[0.1615, 0.1217]]]], [[[[0.4962, 0.1317]]]]], Max18663), 
LZer8974 = zero_padding2D_layer(Max18663, 2, 0, 0, 0, Zer8974), 
LAdd11752 = add_layer([Con54594,Zer8974], Add11752), 
LZer25339 = zero_padding2D_layer(Add11752, 0, 0, 2, 0, Zer25339), 
LMul15274 = multiply_layer([Con54298,Zer25339], Mul15274), 
LGlo75232 = global_max_pool2D_layer(Mul15274, Glo75232), 
LRes29926 = reshape_layer(Glo75232, [2, 1], Res29926), 
LGlo79579 = global_average_pooling1D_layer(Res29926, Glo79579), 
exec_layers([LDot2983,LRes41886,LRes28594,LMul85814,LZer29022,LAve50338,LRes62644,LCon54298,LGRU27660,LRes94790,LRes92867,LCon54594,LMax18663,LZer8974,LAdd11752,LZer25339,LMul15274,LGlo75232,LRes29926,LGlo79579],["Dot2983","Res41886","Res28594","Mul85814","Zer29022","Ave50338","Res62644","Con54298","GRU27660","Res94790","Res92867","Con54594","Max18663","Zer8974","Add11752","Zer25339","Mul15274","Glo75232","Res29926","Glo79579"],Glo79579,"Glo79579")

Actual (Unparsed): [[0.2506757]]

Expected (Unparsed): [[0.25067569261649997]]

Actual:   [[0.2507]]

Expected: [[0.2507]]