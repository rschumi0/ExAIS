import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul51803 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Mul51803 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0PRe21015 = tf.keras.layers.Input(shape=([2, 2]))

Mul51803 = keras.layers.Multiply(name = 'Mul51803', )([in0Mul51803,in1Mul51803])
Res25222 = keras.layers.Reshape((2, 2), name = 'Res25222', )(Mul51803)
PRe21015 = keras.layers.PReLU(name = 'PRe21015', input_shape=(2, 2))(in0PRe21015)
Dot1776 = keras.layers.Dot(axes=(2, 1), name = 'Dot1776', )([Res25222,PRe21015])
GRU53141 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU53141', )(Dot1776)
model = tf.keras.models.Model(inputs=[in0Mul51803,in1Mul51803,in0PRe21015], outputs=GRU53141)
w = model.get_layer('PRe21015').get_weights() 
w[0] = np.array([[0.4405, 0.9277], [0.8725, 0.8006]])
model.get_layer('PRe21015').set_weights(w) 
w = model.get_layer('GRU53141').get_weights() 
w[0] = np.array([[9, 4, 8], [8, 5, 8]])
w[1] = np.array([[1, 6, 9]])
w[2] = np.array([[4, 7, 2], [9, 4, 9]])
model.get_layer('GRU53141').set_weights(w) 
in0Mul51803 = tf.constant([[[[0.853, 0.8695]], [[0.0868, 0.1002]]]])
in1Mul51803 = tf.constant([[[[0.0372, 0.3388]], [[0.7051, 0.9869]]]])
in0PRe21015 = tf.constant([[[0.0709, 0.4274], [0.2437, 0.2954]]])
print (np.array2string(model.predict([in0Mul51803,in1Mul51803,in0PRe21015],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU53141.png')

LMul51803 = multiply_layer([[[[[0.853, 0.8695]], [[0.0868, 0.1002]]]], [[[[0.0372, 0.3388]], [[0.7051, 0.9869]]]]], Mul51803), 
LRes25222 = reshape_layer(Mul51803, [2, 2], Res25222), 
LPRe21015 = prelu_layer([[[0.0709, 0.4274], [0.2437, 0.2954]]], [[0.4405, 0.9277], [0.8725, 0.8006]], PRe21015), 
LDot1776 = dot_layer(Res25222,PRe21015, 2, 1, Dot1776), 
LGRU53141 = gru_layer(Dot1776,[[9, 4, 8], [8, 5, 8]],[[1, 6, 9]],[[4, 7, 2], [9, 4, 9]], true, GRU53141), 
exec_layers([LMul51803,LRes25222,LPRe21015,LDot1776,LGRU53141],["Mul51803","Res25222","PRe21015","Dot1776","GRU53141"],GRU53141,"GRU53141")

Actual (Unparsed): [[0.0000016]]

Expected (Unparsed): [[1.642854415917047e-6]]

Actual:   [[0]]

Expected: [[0]]