import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Per92574 = tf.keras.layers.Input(shape=([1, 1]))
in0Con39890 = tf.keras.layers.Input(shape=([2, 3]))
in0Ave18367 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave18367 = tf.keras.layers.Input(shape=([1, 2]))
in0Ave81160 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Ave81160 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Max4578 = tf.keras.layers.Input(shape=([2, 1]))
in1Max4578 = tf.keras.layers.Input(shape=([2, 1]))
in0Con61309 = tf.keras.layers.Input(shape=([2, 3]))

Per92574 = keras.layers.Permute((2,1), name = 'Per92574',)(in0Per92574)
Res27173 = keras.layers.Reshape((1, 1, 1), name = 'Res27173', )(Per92574)
Res85642 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res85642', )(Res27173)
Glo1680 = keras.layers.GlobalMaxPool3D(name = 'Glo1680', )(Res85642)
Res45237 = keras.layers.Reshape((1, 1), name = 'Res45237', )(Glo1680)
Zer1978 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer1978', )(Res45237)
Con39890 = keras.layers.Concatenate(axis=2, name = 'Con39890', )([Zer1978,in0Con39890])
Ave18367 = keras.layers.Average(name = 'Ave18367', )([in0Ave18367,in1Ave18367])
Fla20331 = keras.layers.Flatten(name = 'Fla20331', )(Ave18367)
Res28448 = keras.layers.Reshape((2, 1), name = 'Res28448', )(Fla20331)
Ave81160 = keras.layers.Average(name = 'Ave81160', )([in0Ave81160,in1Ave81160])
Res56407 = keras.layers.Reshape((2, 4), name = 'Res56407', )(Ave81160)
Dot37803 = keras.layers.Dot(axes=(1, 1), name = 'Dot37803', )([Res28448,Res56407])
Zer74202 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer74202', )(Dot37803)
Max4578 = keras.layers.Maximum(name = 'Max4578', )([in0Max4578,in1Max4578])
Con61309 = keras.layers.Concatenate(axis=2, name = 'Con61309', )([Max4578,in0Con61309])
Sub33457 = keras.layers.Subtract(name = 'Sub33457', )([Zer74202,Con61309])
Max42798 = keras.layers.Maximum(name = 'Max42798', )([Con39890,Sub33457])
model = tf.keras.models.Model(inputs=[in0Per92574,in0Con39890,in0Ave18367,in1Ave18367,in0Ave81160,in1Ave81160,in0Max4578,in1Max4578,in0Con61309], outputs=Max42798)
in0Per92574 = tf.constant([[[1.6625]]])
in0Con39890 = tf.constant([[[0.3234, 0.5712, 0.0544], [0.5294, 0.5913, 0.9628]]])
in0Ave18367 = tf.constant([[[0.6892, 0.1472]]])
in1Ave18367 = tf.constant([[[0.9672, 0.1988]]])
in0Ave81160 = tf.constant([[[[0.1609, 0.4556], [0.364, 0.6997]], [[0.1411, 0.7757], [0.5881, 0.7917]]]])
in1Ave81160 = tf.constant([[[[0.2779, 0.4272], [0.8317, 0.3961]], [[0.8968, 0.6086], [0.3719, 0.7333]]]])
in0Max4578 = tf.constant([[[0.0053], [0.0128]]])
in1Max4578 = tf.constant([[[0.2894], [0.8863]]])
in0Con61309 = tf.constant([[[0.0848, 0.0913, 0.1103], [0.0233, 0.9548, 0.3551]]])
print (np.array2string(model.predict([in0Per92574,in0Con39890,in0Ave18367,in1Ave18367,in0Ave81160,in1Ave81160,in0Max4578,in1Max4578,in0Con61309],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max42798.png')

LPer92574 = permute_layer([[[1.6625]]], 2,1, Per92574), 
LRes27173 = reshape_layer(Per92574, [1, 1, 1], Res27173), 
LRes85642 = reshape_layer(Res27173, [1, 1, 1, 1], Res85642), 
LGlo1680 = global_max_pool3D_layer(Res85642, Glo1680), 
LRes45237 = reshape_layer(Glo1680, [1, 1], Res45237), 
LZer1978 = zero_padding1D_layer(Res45237, 1, 0, Zer1978), 
LCon39890 = concatenate_layer([Zer1978,[[[0.3234, 0.5712, 0.0544], [0.5294, 0.5913, 0.9628]]]], 2, Con39890), 
LAve18367 = average_layer([[[[0.6892, 0.1472]]], [[[0.9672, 0.1988]]]], Ave18367), 
LFla20331 = flatten_layer(Ave18367, Fla20331), 
LRes28448 = reshape_layer(Fla20331, [2, 1], Res28448), 
LAve81160 = average_layer([[[[[0.1609, 0.4556], [0.364, 0.6997]], [[0.1411, 0.7757], [0.5881, 0.7917]]]], [[[[0.2779, 0.4272], [0.8317, 0.3961]], [[0.8968, 0.6086], [0.3719, 0.7333]]]]], Ave81160), 
LRes56407 = reshape_layer(Ave81160, [2, 4], Res56407), 
LDot37803 = dot_layer(Res28448,Res56407, 1, 1, Dot37803), 
LZer74202 = zero_padding1D_layer(Dot37803, 1, 0, Zer74202), 
LMax4578 = maximum_layer([[[[0.0053], [0.0128]]], [[[0.2894], [0.8863]]]], Max4578), 
LCon61309 = concatenate_layer([Max4578,[[[0.0848, 0.0913, 0.1103], [0.0233, 0.9548, 0.3551]]]], 2, Con61309), 
LSub33457 = subtract_layer(Zer74202,Con61309, Sub33457), 
LMax42798 = maximum_layer([Con39890,Sub33457], Max42798), 
exec_layers([LPer92574,LRes27173,LRes85642,LGlo1680,LRes45237,LZer1978,LCon39890,LAve18367,LFla20331,LRes28448,LAve81160,LRes56407,LDot37803,LZer74202,LMax4578,LCon61309,LSub33457,LMax42798],["Per92574","Res27173","Res85642","Glo1680","Res45237","Zer1978","Con39890","Ave18367","Fla20331","Res28448","Ave81160","Res56407","Dot37803","Zer74202","Max4578","Con61309","Sub33457","Max42798"],Max42798,"Max42798")

Actual (Unparsed): [[[0.0000000, 0.3234000, 0.5712000, 0.0544000], [1.6625000, 0.5294000, 0.5913000, 0.9628000]]]

Expected (Unparsed): [[[0,0.3234,0.5712,0.0544],[1.6625,0.5294,0.5913,0.9628]]]

Actual:   [[[0, 0.3234, 0.5712, 0.0544], [1.6625, 0.5294, 0.5913, 0.9628]]]

Expected: [[[0, 0.3234, 0.5712, 0.0544], [1.6625, 0.5294, 0.5913, 0.9628]]]