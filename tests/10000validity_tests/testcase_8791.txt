import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con11607 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Max46344 = tf.keras.layers.Input(shape=([1, 1]))
in1Max46344 = tf.keras.layers.Input(shape=([1, 1]))
in0Con666 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))

Con11607 = keras.layers.Conv3D(2, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con11607', )(in0Con11607)
Max46344 = keras.layers.Maximum(name = 'Max46344', )([in0Max46344,in1Max46344])
Res97819 = keras.layers.Reshape((1, 1, 1), name = 'Res97819', )(Max46344)
Ave58247 = keras.layers.AveragePooling2D(pool_size=(1, 1), name = 'Ave58247', )(Res97819)
Res24316 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res24316', )(Ave58247)
Cro87677 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro87677', )(Res24316)
Zer97681 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (0, 0)), name = 'Zer97681', )(Cro87677)
Con666 = keras.layers.Concatenate(axis=4, name = 'Con666', )([Zer97681,in0Con666])
Sub86901 = keras.layers.Subtract(name = 'Sub86901', )([Con11607,Con666])
model = tf.keras.models.Model(inputs=[in0Con11607,in0Max46344,in1Max46344,in0Con666], outputs=Sub86901)
w = model.get_layer('Con11607').get_weights() 
w[0] = np.array([[[[[0.1356, 0.3301], [0.316, 0.8414]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con11607').set_weights(w) 
in0Con11607 = tf.constant([[[[[0.0651, 0.8268]], [[0.7782, 0.0747]]], [[[0.7622, 0.1151]], [[0.7474, 0.3679]]]]])
in0Max46344 = tf.constant([[[0.3636]]])
in1Max46344 = tf.constant([[[0.5199]]])
in0Con666 = tf.constant([[[[[0.9328]], [[0.7391]]], [[[0.2503]], [[0.6994]]]]])
print (np.array2string(model.predict([in0Con11607,in0Max46344,in1Max46344,in0Con666],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub86901.png')

LCon11607 = conv3D_layer([[[[[0.0651, 0.8268]], [[0.7782, 0.0747]]], [[[0.7622, 0.1151]], [[0.7474, 0.3679]]]]], 1, 1, 1,[[[[[0.1356, 0.3301], [0.316, 0.8414]]]]],[0, 0], 1, 1, 1, false, 1, 1, 1, Con11607), 
LMax46344 = maximum_layer([[[[0.3636]]], [[[0.5199]]]], Max46344), 
LRes97819 = reshape_layer(Max46344, [1, 1, 1], Res97819), 
LAve58247 = average_pooling2D_layer(Res97819, 1, 1, Ave58247), 
LRes24316 = reshape_layer(Ave58247, [1, 1, 1, 1], Res24316), 
LCro87677 = cropping3D_layer(Res24316, 0, 0, 0, 0, 0, 0, Cro87677), 
LZer97681 = zero_padding3D_layer(Cro87677, 1, 0, 1, 0, 0, 0, Zer97681), 
LCon666 = concatenate_layer([Zer97681,[[[[[0.9328]], [[0.7391]]], [[[0.2503]], [[0.6994]]]]]], 4, Con666), 
LSub86901 = subtract_layer(Con11607,Con666, Sub86901), 
exec_layers([LCon11607,LMax46344,LRes97819,LAve58247,LRes24316,LCro87677,LZer97681,LCon666,LSub86901],["Con11607","Max46344","Res97819","Ave58247","Res24316","Cro87677","Zer97681","Con666","Sub86901"],Sub86901,"Sub86901")

Actual (Unparsed): [[[[[0.2700964, -0.2156410]], [[0.1291291, -0.4193636]]], [[[0.1397259, 0.0981474]], [[-0.3022962, -0.1431322]]]]]

Expected (Unparsed): [[[[[0.27009636000000004,-0.21564096999999993]],[[0.12912912,-0.4193636]]],[[[0.13972592,0.09814735999999996]],[[-0.30229616000000004,-0.14313219999999993]]]]]

Actual:   [[[[[0.2701, -0.2156]], [[0.1292, -0.4193]]], [[[0.1398, 0.0982]], [[-0.3022, -0.1431]]]]]

Expected: [[[[[0.2701, -0.2156]], [[0.1292, -0.4193]]], [[[0.1398, 0.0982]], [[-0.3022, -0.1431]]]]]