import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Den95319 = tf.keras.layers.Input(shape=([4, 5]))
in0Sim85638 = tf.keras.layers.Input(shape=([1, 1]))
in0Con29492 = tf.keras.layers.Input(shape=([6]))
in0Sub86562 = tf.keras.layers.Input(shape=([3]))
in1Sub86562 = tf.keras.layers.Input(shape=([3]))
in0Ave99785 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Ave99785 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con32444 = tf.keras.layers.Input(shape=([2]))

Den95319 = keras.layers.Dense(2,name = 'Den95319', )(in0Den95319)
Fla73115 = keras.layers.Flatten(name = 'Fla73115', )(Den95319)
Sim85638 = keras.layers.SimpleRNN(2,name = 'Sim85638', )(in0Sim85638)
Con29492 = keras.layers.Concatenate(axis=1, name = 'Con29492', )([Sim85638,in0Con29492])
Sub26143 = keras.layers.Subtract(name = 'Sub26143', )([Fla73115,Con29492])
Res18392 = keras.layers.Reshape((8, 1), name = 'Res18392', )(Sub26143)
Res71198 = keras.layers.Reshape((8, 1, 1), name = 'Res71198', )(Res18392)
Zer88673 = keras.layers.ZeroPadding2D(padding=((0, 0), (4, 0)), name = 'Zer88673', )(Res71198)
Sub86562 = keras.layers.Subtract(name = 'Sub86562', )([in0Sub86562,in1Sub86562])
Res92730 = keras.layers.Reshape((3, 1), name = 'Res92730', )(Sub86562)
PRe60559 = keras.layers.PReLU(name = 'PRe60559', )(Res92730)
Fla90216 = keras.layers.Flatten(name = 'Fla90216', )(PRe60559)
Ave99785 = keras.layers.Average(name = 'Ave99785', )([in0Ave99785,in1Ave99785])
Glo1899 = keras.layers.GlobalAveragePooling2D(name = 'Glo1899', )(Ave99785)
Sof49883 = keras.layers.Softmax(axis=1, name = 'Sof49883', )(Glo1899)
Con32444 = keras.layers.Concatenate(axis=1, name = 'Con32444', )([Sof49883,in0Con32444])
Ave21511 = keras.layers.Average(name = 'Ave21511', )([Fla90216,Con32444])
Res58948 = keras.layers.Reshape((3, 1), name = 'Res58948', )(Ave21511)
Res61274 = keras.layers.Reshape((3, 1, 1), name = 'Res61274', )(Res58948)
Zer68770 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer68770', )(Res61274)
Zer97418 = keras.layers.ZeroPadding2D(padding=((3, 0), (2, 0)), name = 'Zer97418', )(Zer68770)
Add2359 = keras.layers.Add(name = 'Add2359', )([Zer88673,Zer97418])
model = tf.keras.models.Model(inputs=[in0Den95319,in0Sim85638,in0Con29492,in0Sub86562,in1Sub86562,in0Ave99785,in1Ave99785,in0Con32444], outputs=Add2359)
w = model.get_layer('Den95319').get_weights() 
w[0] = np.array([[0.7072, 0.7571], [0.1527, 0.3679], [0.7514, 0.4841], [0.4739, 0.5592], [0.8842, 0.2601]])
w[1] = np.array([0.9989, 0.4682])
model.get_layer('Den95319').set_weights(w) 
w = model.get_layer('Sim85638').get_weights() 
w[0] = np.array([[10, 9]])
w[1] = np.array([[5, 7], [6, 6]])
w[2] = np.array([3, 7])
model.get_layer('Sim85638').set_weights(w) 
w = model.get_layer('PRe60559').get_weights() 
w[0] = np.array([[0.6445], [0.1091], [0.4697]])
model.get_layer('PRe60559').set_weights(w) 
in0Den95319 = tf.constant([[[0.964, 0.7199, 0.4185, 0.3207, 0.7063], [0.1303, 0.1633, 0.4882, 0.3864, 0.3649], [0.1165, 0.6418, 0.3832, 0.4404, 0.1042], [0.9348, 0.2456, 0.6194, 0.392, 0.9472]]])
in0Sim85638 = tf.constant([[[10]]])
in0Con29492 = tf.constant([[0.718, 0.9197, 0.148, 0.9487, 0.2047, 0.627]])
in0Sub86562 = tf.constant([[0.8236, 0.0455, 0.495]])
in1Sub86562 = tf.constant([[0.1045, 0.1402, 0.55]])
in0Ave99785 = tf.constant([[[[0.5045], [0.688]]]])
in1Ave99785 = tf.constant([[[[0.6894], [0.0405]]]])
in0Con32444 = tf.constant([[0.4663, 0.6282]])
print (np.array2string(model.predict([in0Den95319,in0Sim85638,in0Con29492,in0Sub86562,in1Sub86562,in0Ave99785,in1Ave99785,in0Con32444],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add2359.png')

LDen95319 = dense_layer([[[0.964, 0.7199, 0.4185, 0.3207, 0.7063], [0.1303, 0.1633, 0.4882, 0.3864, 0.3649], [0.1165, 0.6418, 0.3832, 0.4404, 0.1042], [0.9348, 0.2456, 0.6194, 0.392, 0.9472]]], [[0.7072, 0.7571], [0.1527, 0.3679], [0.7514, 0.4841], [0.4739, 0.5592], [0.8842, 0.2601]],[0.9989, 0.4682], Den95319), 
LFla73115 = flatten_layer(Den95319, Fla73115), 
LSim85638 = simple_rnn_layer([[[10]]],[[10, 9]],[[5, 7], [6, 6]],[3, 7], Sim85638), 
LCon29492 = concatenate_layer([Sim85638,[[0.718, 0.9197, 0.148, 0.9487, 0.2047, 0.627]]], 1, Con29492), 
LSub26143 = subtract_layer(Fla73115,Con29492, Sub26143), 
LRes18392 = reshape_layer(Sub26143, [8, 1], Res18392), 
LRes71198 = reshape_layer(Res18392, [8, 1, 1], Res71198), 
LZer88673 = zero_padding2D_layer(Res71198, 0, 0, 4, 0, Zer88673), 
LSub86562 = subtract_layer([[0.8236, 0.0455, 0.495]], [[0.1045, 0.1402, 0.55]], Sub86562), 
LRes92730 = reshape_layer(Sub86562, [3, 1], Res92730), 
LPRe60559 = prelu_layer(Res92730, [[0.6445], [0.1091], [0.4697]], PRe60559), 
LFla90216 = flatten_layer(PRe60559, Fla90216), 
LAve99785 = average_layer([[[[[0.5045], [0.688]]]], [[[[0.6894], [0.0405]]]]], Ave99785), 
LGlo1899 = global_average_pooling2D_layer(Ave99785, Glo1899), 
LSof49883 = softmax_layer(Glo1899, 1, Sof49883), 
LCon32444 = concatenate_layer([Sof49883,[[0.4663, 0.6282]]], 1, Con32444), 
LAve21511 = average_layer([Fla90216,Con32444], Ave21511), 
LRes58948 = reshape_layer(Ave21511, [3, 1], Res58948), 
LRes61274 = reshape_layer(Res58948, [3, 1, 1], Res61274), 
LZer68770 = zero_padding2D_layer(Res61274, 1, 1, 1, 1, Zer68770), 
LZer97418 = zero_padding2D_layer(Zer68770, 3, 0, 2, 0, Zer97418), 
LAdd2359 = add_layer([Zer88673,Zer97418], Add2359), 
exec_layers([LDen95319,LFla73115,LSim85638,LCon29492,LSub26143,LRes18392,LRes71198,LZer88673,LSub86562,LRes92730,LPRe60559,LFla90216,LAve99785,LGlo1899,LSof49883,LCon32444,LAve21511,LRes58948,LRes61274,LZer68770,LZer97418,LAdd2359],["Den95319","Fla73115","Sim85638","Con29492","Sub26143","Res18392","Res71198","Zer88673","Sub86562","Res92730","PRe60559","Fla90216","Ave99785","Glo1899","Sof49883","Con32444","Ave21511","Res58948","Res61274","Zer68770","Zer97418","Add2359"],Add2359,"Add2359")

Actual (Unparsed): [[[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [1.8815206]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [1.0285355]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [1.2705771]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.2545512]], [[0.0000000], [0.0000000], [0.0000000], [0.8595500], [1.6200673]], [[0.0000000], [0.0000000], [0.0000000], [0.2279841], [0.3027016]], [[0.0000000], [0.0000000], [0.0000000], [0.3011832], [2.9814939]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [1.4047180]]]]

Expected (Unparsed): [[[[0],[0],[0],[0],[1.8815206199999999]],[[0],[0],[0],[0],[1.02853553]],[[0],[0],[0],[0],[1.2705770899999997]],[[0],[0],[0],[0],[0.2545511899999999]],[[0],[0],[0],[0.85955],[1.62006734]],[[0],[0],[0],[0.227984115],[0.3027015900000002]],[[0],[0],[0],[0.30118324999999996],[2.98149388]],[[0],[0],[0],[0],[1.4047179799999998]]]]

Actual:   [[[[0], [0], [0], [0], [1.8816]], [[0], [0], [0], [0], [1.0286]], [[0], [0], [0], [0], [1.2706]], [[0], [0], [0], [0], [0.2546]], [[0], [0], [0], [0.8596], [1.6201]], [[0], [0], [0], [0.228], [0.3028]], [[0], [0], [0], [0.3012], [2.9815]], [[0], [0], [0], [0], [1.4048]]]]

Expected: [[[[0], [0], [0], [0], [1.8816]], [[0], [0], [0], [0], [1.0286]], [[0], [0], [0], [0], [1.2706]], [[0], [0], [0], [0], [0.2546]], [[0], [0], [0], [0.8596], [1.6201]], [[0], [0], [0], [0.228], [0.3028]], [[0], [0], [0], [0.3012], [2.9815]], [[0], [0], [0], [0], [1.4048]]]]