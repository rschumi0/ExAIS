import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub85381 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub85381 = tf.keras.layers.Input(shape=([2, 2]))
in0Con44499 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Ave22537 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Ave22537 = tf.keras.layers.Input(shape=([2, 1, 2]))

Sub85381 = keras.layers.Subtract(name = 'Sub85381', )([in0Sub85381,in1Sub85381])
Res49474 = keras.layers.Reshape((2, 2, 1), name = 'Res49474', )(Sub85381)
Con44499 = keras.layers.Concatenate(axis=3, name = 'Con44499', )([Res49474,in0Con44499])
Ave22537 = keras.layers.Average(name = 'Ave22537', )([in0Ave22537,in1Ave22537])
Dep13718 = keras.layers.DepthwiseConv2D((2, 1),strides=(2, 2), padding='valid', name = 'Dep13718', )(Ave22537)
Zer27627 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer27627', )(Dep13718)
Max25140 = keras.layers.Maximum(name = 'Max25140', )([Con44499,Zer27627])
model = tf.keras.models.Model(inputs=[in0Sub85381,in1Sub85381,in0Con44499,in0Ave22537,in1Ave22537], outputs=Max25140)
w = model.get_layer('Dep13718').get_weights() 
w[0] = np.array([[[[0.258], [0.4614]]], [[[0.3337], [0.6631]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep13718').set_weights(w) 
in0Sub85381 = tf.constant([[[0.4829, 0.3218], [0.4025, 0.4737]]])
in1Sub85381 = tf.constant([[[0.8856, 0.3207], [0.5501, 0.8744]]])
in0Con44499 = tf.constant([[[[0.432], [0.4843]], [[0.7071], [0.1729]]]])
in0Ave22537 = tf.constant([[[[0.4398, 0.438]], [[0.1963, 0.3073]]]])
in1Ave22537 = tf.constant([[[[0.9884, 0.0461]], [[0.2764, 0.1619]]]])
print (np.array2string(model.predict([in0Sub85381,in1Sub85381,in0Con44499,in0Ave22537,in1Ave22537],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max25140.png')

LSub85381 = subtract_layer([[[0.4829, 0.3218], [0.4025, 0.4737]]], [[[0.8856, 0.3207], [0.5501, 0.8744]]], Sub85381), 
LRes49474 = reshape_layer(Sub85381, [2, 2, 1], Res49474), 
LCon44499 = concatenate_layer([Res49474,[[[[0.432], [0.4843]], [[0.7071], [0.1729]]]]], 3, Con44499), 
LAve22537 = average_layer([[[[[0.4398, 0.438]], [[0.1963, 0.3073]]]], [[[[0.9884, 0.0461]], [[0.2764, 0.1619]]]]], Ave22537), 
LDep13718 = depthwise_conv2D_layer(Ave22537, 2, 1,[[[[0.258], [0.4614]]], [[[0.3337], [0.6631]]]],[0, 0], 2, 2, false, Dep13718), 
LZer27627 = zero_padding2D_layer(Dep13718, 1, 0, 1, 0, Zer27627), 
LMax25140 = maximum_layer([Con44499,Zer27627], Max25140), 
exec_layers([LSub85381,LRes49474,LCon44499,LAve22537,LDep13718,LZer27627,LMax25140],["Sub85381","Res49474","Con44499","Ave22537","Dep13718","Zer27627","Max25140"],Max25140,"Max25140")

Actual (Unparsed): [[[[0.0000000, 0.4320000], [0.0011000, 0.4843000]], [[0.0000000, 0.7071000], [0.2631078, 0.2672451]]]]

Expected (Unparsed): [[[[0,0.432],[0.0010999999999999899,0.4843]],[[0,0.7071],[0.26310779500000003,0.26724513]]]]

Actual:   [[[[0, 0.432], [0.0011, 0.4843]], [[0, 0.7071], [0.2632, 0.2673]]]]

Expected: [[[[0, 0.432], [0.0011, 0.4843]], [[0, 0.7071], [0.2632, 0.2673]]]]