import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mas52798 = tf.keras.layers.Input(shape=([4, 1]))
in0Dot90984 = tf.keras.layers.Input(shape=([2]))
in1Dot90984 = tf.keras.layers.Input(shape=([2]))
in0Con17566 = tf.keras.layers.Input(shape=([3]))
in0Glo90796 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Add4373 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Add4373 = tf.keras.layers.Input(shape=([1, 1, 1]))

Mas52798 = keras.layers.Masking(mask_value=2, name = 'Mas52798', )(in0Mas52798)
Fla98898 = keras.layers.Flatten(name = 'Fla98898', )(Mas52798)
Dot90984 = keras.layers.Dot(axes=(1, 1), name = 'Dot90984', )([in0Dot90984,in1Dot90984])
Con17566 = keras.layers.Concatenate(axis=1, name = 'Con17566', )([Dot90984,in0Con17566])
Max90453 = keras.layers.Maximum(name = 'Max90453', )([Fla98898,Con17566])
Bat19266 = keras.layers.BatchNormalization(axis=1, epsilon=0.38718142825674107,  name = 'Bat19266', )(Max90453)
Res59676 = keras.layers.Reshape((4, 1), name = 'Res59676', )(Bat19266)
Res78272 = keras.layers.Reshape((4, 1, 1), name = 'Res78272', )(Res59676)
Glo90796 = keras.layers.GlobalMaxPool3D(name = 'Glo90796', )(in0Glo90796)
Res40347 = keras.layers.Reshape((2, 1), name = 'Res40347', )(Glo90796)
Res30196 = keras.layers.Reshape((2, 1, 1), name = 'Res30196', )(Res40347)
Ave35457 = keras.layers.AveragePooling2D(pool_size=(2, 1), strides=(5, 6), padding='valid', name = 'Ave35457', )(Res30196)
Add4373 = keras.layers.Add(name = 'Add4373', )([in0Add4373,in1Add4373])
Max58566 = keras.layers.Maximum(name = 'Max58566', )([Ave35457,Add4373])
Zer72723 = keras.layers.ZeroPadding2D(padding=((3, 0), (0, 0)), name = 'Zer72723', )(Max58566)
Ave93510 = keras.layers.Average(name = 'Ave93510', )([Res78272,Zer72723])
model = tf.keras.models.Model(inputs=[in0Mas52798,in0Dot90984,in1Dot90984,in0Con17566,in0Glo90796,in0Add4373,in1Add4373], outputs=Ave93510)
w = model.get_layer('Bat19266').get_weights() 
w[0] = np.array([0.1571, 0.5942, 0.2301, 0.5271])
w[1] = np.array([0.6575, 0.3959, 0.3988, 0.0176])
w[2] = np.array([0.6126, 0.0915, 0.1291, 0.4984])
w[3] = np.array([0.2687, 0.5127, 0.2186, 0.2545])
model.get_layer('Bat19266').set_weights(w) 
in0Mas52798 = tf.constant([[[1.3509], [1.2041], [1.9674], [1.3709]]])
in0Dot90984 = tf.constant([[0.6098, 0.7469]])
in1Dot90984 = tf.constant([[0.4544, 0.4989]])
in0Con17566 = tf.constant([[0.0073, 0.9802, 0.8312]])
in0Glo90796 = tf.constant([[[[[1.6526, 1.2684], [1.2715, 1.3107]], [[1.6219, 1.687], [1.3087, 1.7392]]]]])
in0Add4373 = tf.constant([[[[0.9403]]]])
in1Add4373 = tf.constant([[[[0.4974]]]])
print (np.array2string(model.predict([in0Mas52798,in0Dot90984,in1Dot90984,in0Con17566,in0Glo90796,in0Add4373,in1Add4373],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave93510.png')

LMas52798 = masking_layer([[[1.3509], [1.2041], [1.9674], [1.3709]]], 2, Mas52798), 
LFla98898 = flatten_layer(Mas52798, Fla98898), 
LDot90984 = dot_layer([[0.6098, 0.7469]], [[0.4544, 0.4989]], 1, 1, Dot90984), 
LCon17566 = concatenate_layer([Dot90984,[[0.0073, 0.9802, 0.8312]]], 1, Con17566), 
LMax90453 = maximum_layer([Fla98898,Con17566], Max90453), 
LBat19266 = batch_normalization_layer(Max90453, 1, 0.38718142825674107, [0.1571, 0.5942, 0.2301, 0.5271], [0.6575, 0.3959, 0.3988, 0.0176], [0.6126, 0.0915, 0.1291, 0.4984], [0.2687, 0.5127, 0.2186, 0.2545], Bat19266), 
LRes59676 = reshape_layer(Bat19266, [4, 1], Res59676), 
LRes78272 = reshape_layer(Res59676, [4, 1, 1], Res78272), 
LGlo90796 = global_max_pool3D_layer([[[[[1.6526, 1.2684], [1.2715, 1.3107]], [[1.6219, 1.687], [1.3087, 1.7392]]]]], Glo90796), 
LRes40347 = reshape_layer(Glo90796, [2, 1], Res40347), 
LRes30196 = reshape_layer(Res40347, [2, 1, 1], Res30196), 
LAve35457 = average_pooling2D_layer(Res30196, 2, 1, 5, 6, false, Ave35457), 
LAdd4373 = add_layer([[[[[0.9403]]]], [[[[0.4974]]]]], Add4373), 
LMax58566 = maximum_layer([Ave35457,Add4373], Max58566), 
LZer72723 = zero_padding2D_layer(Max58566, 3, 0, 0, 0, Zer72723), 
LAve93510 = average_layer([Res78272,Zer72723], Ave93510), 
exec_layers([LMas52798,LFla98898,LDot90984,LCon17566,LMax90453,LBat19266,LRes59676,LRes78272,LGlo90796,LRes40347,LRes30196,LAve35457,LAdd4373,LMax58566,LZer72723,LAve93510],["Mas52798","Fla98898","Dot90984","Con17566","Max90453","Bat19266","Res59676","Res78272","Glo90796","Res40347","Res30196","Ave35457","Add4373","Max58566","Zer72723","Ave93510"],Ave93510,"Ave93510")

Actual (Unparsed): [[[[0.4003588]], [[0.5464069]], [[0.4711347]], [[1.1438074]]]]

Expected (Unparsed): [[[[0.4003587991646268]],[[0.5464068954067176]],[[0.47113465761713125]],[[1.1438073829752406]]]]

Actual:   [[[[0.4004]], [[0.5465]], [[0.4712]], [[1.1439]]]]

Expected: [[[[0.4004]], [[0.5465]], [[0.4712]], [[1.1439]]]]