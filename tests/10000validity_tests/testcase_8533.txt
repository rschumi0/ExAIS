import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max43183 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Max43183 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

Max43183 = keras.layers.Maximum(name = 'Max43183', )([in0Max43183,in1Max43183])
Res82516 = keras.layers.Reshape((2, 2, 2), name = 'Res82516', )(Max43183)
Con38637 = keras.layers.Conv2D(3, (1, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con38637', )(Res82516)
Ave23869 = keras.layers.AveragePooling2D(pool_size=(1, 1), name = 'Ave23869', )(Con38637)
Res82201 = keras.layers.Reshape((2, 6), name = 'Res82201', )(Ave23869)
Per12112 = keras.layers.Permute((2,1), name = 'Per12112',)(Res82201)
model = tf.keras.models.Model(inputs=[in0Max43183,in1Max43183], outputs=Per12112)
w = model.get_layer('Con38637').get_weights() 
w[0] = np.array([[[[0.4468, 0.1388, 0.3103], [0.4134, 0.1794, 0.0988]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con38637').set_weights(w) 
in0Max43183 = tf.constant([[[[[0.9934, 0.8661]], [[0.2757, 0.4267]]], [[[0.7283, 0.6748]], [[0.1975, 0.5268]]]]])
in1Max43183 = tf.constant([[[[[0.9783, 0.0072]], [[0.0246, 0.5933]]], [[[0.9715, 0.6189]], [[0.9589, 0.4007]]]]])
print (np.array2string(model.predict([in0Max43183,in1Max43183],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Per12112.png')

LMax43183 = maximum_layer([[[[[[0.9934, 0.8661]], [[0.2757, 0.4267]]], [[[0.7283, 0.6748]], [[0.1975, 0.5268]]]]], [[[[[0.9783, 0.0072]], [[0.0246, 0.5933]]], [[[0.9715, 0.6189]], [[0.9589, 0.4007]]]]]], Max43183), 
LRes82516 = reshape_layer(Max43183, [2, 2, 2], Res82516), 
LCon38637 = conv2D_layer(Res82516, 1, 1,[[[[0.4468, 0.1388, 0.3103], [0.4134, 0.1794, 0.0988]]]],[0, 0, 0], 1, 1, true, 1, 1, Con38637), 
LAve23869 = average_pooling2D_layer(Con38637, 1, 1, Ave23869), 
LRes82201 = reshape_layer(Ave23869, [2, 6], Res82201), 
LPer12112 = permute_layer(Res82201, 2,1, Per12112), 
exec_layers([LMax43183,LRes82516,LCon38637,LAve23869,LRes82201,LPer12112],["Max43183","Res82516","Con38637","Ave23869","Res82201","Per12112"],Per12112,"Per12112")

Actual (Unparsed): [[[0.8018969, 0.7130285], [0.2932623, 0.2559033], [0.3938227, 0.3681267], [0.3684530, 0.6462156], [0.1447052, 0.2276032], [0.1441677, 0.3495945]]]

Expected (Unparsed): [[[0.8018968599999999,0.7130285199999999],[0.29326226,0.25590332],[0.3938227,0.36812669000000003],[0.36845298,0.64621564],[0.14470518000000002,0.22760323999999998],[0.14416775,0.34959451]]]

Actual:   [[[0.8019, 0.7131], [0.2933, 0.256], [0.3939, 0.3682], [0.3685, 0.6463], [0.1448, 0.2277], [0.1442, 0.3496]]]

Expected: [[[0.8019, 0.7131], [0.2933, 0.256], [0.3939, 0.3682], [0.3685, 0.6463], [0.1448, 0.2277], [0.1442, 0.3496]]]