import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add3538 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Add3538 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0LST72101 = tf.keras.layers.Input(shape=([3, 1]))
in0Con90016 = tf.keras.layers.Input(shape=([2, 1]))
in0Mul81507 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul81507 = tf.keras.layers.Input(shape=([2, 2]))
in0Con34054 = tf.keras.layers.Input(shape=([2, 2]))
in0Den16360 = tf.keras.layers.Input(shape=([3, 4]))
in0Add65485 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Add65485 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con23866 = tf.keras.layers.Input(shape=([1]))
in0Glo53349 = tf.keras.layers.Input(shape=([1, 2, 2]))

Add3538 = keras.layers.Add(name = 'Add3538', )([in0Add3538,in1Add3538])
Res32178 = keras.layers.Reshape((2, 4), name = 'Res32178', )(Add3538)
LST72101 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST72101', )(in0LST72101)
Res36213 = keras.layers.Reshape((2, 1), name = 'Res36213', )(LST72101)
Con90016 = keras.layers.Concatenate(axis=2, name = 'Con90016', )([Res36213,in0Con90016])
Mul81507 = keras.layers.Multiply(name = 'Mul81507', )([in0Mul81507,in1Mul81507])
Ave46570 = keras.layers.Average(name = 'Ave46570', )([Con90016,Mul81507])
Con34054 = keras.layers.Concatenate(axis=2, name = 'Con34054', )([Ave46570,in0Con34054])
Sub18457 = keras.layers.Subtract(name = 'Sub18457', )([Res32178,Con34054])
Zer93042 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer93042', )(Sub18457)
Den16360 = keras.layers.Dense(2,name = 'Den16360', )(in0Den16360)
Dot92055 = keras.layers.Dot(axes=(1, 1), name = 'Dot92055', )([Zer93042,Den16360])
Add65485 = keras.layers.Add(name = 'Add65485', )([in0Add65485,in1Add65485])
Res53011 = keras.layers.Reshape((1, 1), name = 'Res53011', )(Add65485)
Fla69501 = keras.layers.Flatten(name = 'Fla69501', )(Res53011)
Con23866 = keras.layers.Concatenate(axis=1, name = 'Con23866', )([Fla69501,in0Con23866])
Glo53349 = keras.layers.GlobalAveragePooling2D(name = 'Glo53349', )(in0Glo53349)
Mul7984 = keras.layers.Multiply(name = 'Mul7984', )([Con23866,Glo53349])
Res76703 = keras.layers.Reshape((2, 1), name = 'Res76703', )(Mul7984)
Zer5282 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer5282', )(Res76703)
GRU41961 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU41961', )(Zer5282)
Res28639 = keras.layers.Reshape((3, 1), name = 'Res28639', )(GRU41961)
Loc63517 = keras.layers.LocallyConnected1D(2, (2),strides=(1), name = 'Loc63517', )(Res28639)
Zer15339 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer15339', )(Loc63517)
Mul17413 = keras.layers.Multiply(name = 'Mul17413', )([Dot92055,Zer15339])
model = tf.keras.models.Model(inputs=[in0Add3538,in1Add3538,in0LST72101,in0Con90016,in0Mul81507,in1Mul81507,in0Con34054,in0Den16360,in0Add65485,in1Add65485,in0Con23866,in0Glo53349], outputs=Mul17413)
w = model.get_layer('LST72101').get_weights() 
w[0] = np.array([[2, 5, 9, 4, 5, 1, 9, 1]])
w[1] = np.array([[10, 6, 9, 6, 10, 8, 4, 6], [2, 8, 3, 5, 7, 9, 6, 6]])
w[2] = np.array([6, 10, 4, 5, 3, 9, 7, 6])
model.get_layer('LST72101').set_weights(w) 
w = model.get_layer('Den16360').get_weights() 
w[0] = np.array([[0.3413, 0.6182], [0.1309, 0.0436], [0.7063, 0.7225], [0.7406, 0.4136]])
w[1] = np.array([0.4393, 0.8536])
model.get_layer('Den16360').set_weights(w) 
w = model.get_layer('GRU41961').get_weights() 
w[0] = np.array([[10, 5, 2, 5, 5, 1, 9, 4, 1]])
w[1] = np.array([[10, 7, 8, 5, 3, 4, 5, 6, 10], [4, 3, 5, 8, 5, 6, 2, 10, 10], [8, 3, 10, 7, 3, 1, 6, 4, 4]])
w[2] = np.array([[10, 9, 1, 7, 1, 1, 6, 3, 1], [1, 6, 10, 8, 2, 5, 10, 10, 2]])
model.get_layer('GRU41961').set_weights(w) 
w = model.get_layer('Loc63517').get_weights() 
w[0] = np.array([[[0.6176, 0.3902], [0.3815, 0.6857]], [[0.1895, 0.2655], [0.0573, 0.8451]]])
w[1] = np.array([[0, 0], [0, 0]])
model.get_layer('Loc63517').set_weights(w) 
in0Add3538 = tf.constant([[[[0.868, 0.8859], [0.318, 0.9618]], [[0.1965, 0.5797], [0.254, 0.4579]]]])
in1Add3538 = tf.constant([[[[0.038, 0.276], [0.4518, 0.6103]], [[0.7345, 0.6003], [0.0016, 0.3111]]]])
in0LST72101 = tf.constant([[[5], [5], [6]]])
in0Con90016 = tf.constant([[[0.6997], [0.1031]]])
in0Mul81507 = tf.constant([[[0.5152, 0.6476], [0.7139, 0.9231]]])
in1Mul81507 = tf.constant([[[0.8148, 0.7366], [0.5393, 0.3604]]])
in0Con34054 = tf.constant([[[0.6417, 0.4176], [0.3031, 0.1576]]])
in0Den16360 = tf.constant([[[0.3573, 0.8065, 0.2762, 0.5494], [0.103, 0.384, 0.952, 0.7591], [0.4036, 0.3249, 0.5899, 0.0666]]])
in0Add65485 = tf.constant([[[[0.0693]]]])
in1Add65485 = tf.constant([[[[0.4837]]]])
in0Con23866 = tf.constant([[0.6441]])
in0Glo53349 = tf.constant([[[[1.4456, 1.5185], [1.6773, 1.7028]]]])
print (np.array2string(model.predict([in0Add3538,in1Add3538,in0LST72101,in0Con90016,in0Mul81507,in1Mul81507,in0Con34054,in0Den16360,in0Add65485,in1Add65485,in0Con23866,in0Glo53349],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul17413.png')

LAdd3538 = add_layer([[[[[0.868, 0.8859], [0.318, 0.9618]], [[0.1965, 0.5797], [0.254, 0.4579]]]], [[[[0.038, 0.276], [0.4518, 0.6103]], [[0.7345, 0.6003], [0.0016, 0.3111]]]]], Add3538), 
LRes32178 = reshape_layer(Add3538, [2, 4], Res32178), 
LLST72101 = lstm_layer([[[5], [5], [6]]],[[2, 5, 9, 4, 5, 1, 9, 1]],[[10, 6, 9, 6, 10, 8, 4, 6], [2, 8, 3, 5, 7, 9, 6, 6]],[6, 10, 4, 5, 3, 9, 7, 6], LST72101), 
LRes36213 = reshape_layer(LST72101, [2, 1], Res36213), 
LCon90016 = concatenate_layer([Res36213,[[[0.6997], [0.1031]]]], 2, Con90016), 
LMul81507 = multiply_layer([[[[0.5152, 0.6476], [0.7139, 0.9231]]], [[[0.8148, 0.7366], [0.5393, 0.3604]]]], Mul81507), 
LAve46570 = average_layer([Con90016,Mul81507], Ave46570), 
LCon34054 = concatenate_layer([Ave46570,[[[0.6417, 0.4176], [0.3031, 0.1576]]]], 2, Con34054), 
LSub18457 = subtract_layer(Res32178,Con34054, Sub18457), 
LZer93042 = zero_padding1D_layer(Sub18457, 1, 0, Zer93042), 
LDen16360 = dense_layer([[[0.3573, 0.8065, 0.2762, 0.5494], [0.103, 0.384, 0.952, 0.7591], [0.4036, 0.3249, 0.5899, 0.0666]]], [[0.3413, 0.6182], [0.1309, 0.0436], [0.7063, 0.7225], [0.7406, 0.4136]],[0.4393, 0.8536], Den16360), 
LDot92055 = dot_layer(Zer93042,Den16360, 1, 1, Dot92055), 
LAdd65485 = add_layer([[[[[0.0693]]]], [[[[0.4837]]]]], Add65485), 
LRes53011 = reshape_layer(Add65485, [1, 1], Res53011), 
LFla69501 = flatten_layer(Res53011, Fla69501), 
LCon23866 = concatenate_layer([Fla69501,[[0.6441]]], 1, Con23866), 
LGlo53349 = global_average_pooling2D_layer([[[[1.4456, 1.5185], [1.6773, 1.7028]]]], Glo53349), 
LMul7984 = multiply_layer([Con23866,Glo53349], Mul7984), 
LRes76703 = reshape_layer(Mul7984, [2, 1], Res76703), 
LZer5282 = zero_padding1D_layer(Res76703, 1, 1, Zer5282), 
LGRU41961 = gru_layer(Zer5282,[[10, 5, 2, 5, 5, 1, 9, 4, 1]],[[10, 7, 8, 5, 3, 4, 5, 6, 10], [4, 3, 5, 8, 5, 6, 2, 10, 10], [8, 3, 10, 7, 3, 1, 6, 4, 4]],[[10, 9, 1, 7, 1, 1, 6, 3, 1], [1, 6, 10, 8, 2, 5, 10, 10, 2]], true, GRU41961), 
LRes28639 = reshape_layer(GRU41961, [3, 1], Res28639), 
LLoc63517 = locally_connected1D_layer(Res28639, 2,[[[0.6176, 0.3902], [0.3815, 0.6857]], [[0.1895, 0.2655], [0.0573, 0.8451]]],[[0, 0], [0, 0]], 1, Loc63517), 
LZer15339 = zero_padding1D_layer(Loc63517, 2, 0, Zer15339), 
LMul17413 = multiply_layer([Dot92055,Zer15339], Mul17413), 
exec_layers([LAdd3538,LRes32178,LLST72101,LRes36213,LCon90016,LMul81507,LAve46570,LCon34054,LSub18457,LZer93042,LDen16360,LDot92055,LAdd65485,LRes53011,LFla69501,LCon23866,LGlo53349,LMul7984,LRes76703,LZer5282,LGRU41961,LRes28639,LLoc63517,LZer15339,LMul17413],["Add3538","Res32178","LST72101","Res36213","Con90016","Mul81507","Ave46570","Con34054","Sub18457","Zer93042","Den16360","Dot92055","Add65485","Res53011","Fla69501","Con23866","Glo53349","Mul7984","Res76703","Zer5282","GRU41961","Res28639","Loc63517","Zer15339","Mul17413"],Mul17413,"Mul17413")

Actual (Unparsed): [[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000036, 0.0000023], [0.0000062, 0.0001039]]]

Expected (Unparsed): [[[0.0,0.0],[0.0,0.0],[3.626177057053233e-6,2.3326782900559338e-6],[6.228335999095941e-6,0.00010393215386678919]]]

Actual:   [[[0, 0], [0, 0], [0, 0], [0, 0.0002]]]

Expected: [[[0, 0], [0, 0], [0, 0], [0, 0.0002]]]