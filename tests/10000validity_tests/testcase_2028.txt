import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max4170 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Max4170 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con52160 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Sub49569 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Sub49569 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Max50782 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Max50782 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Min62267 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Min62267 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con60486 = tf.keras.layers.Input(shape=([2, 2, 1]))

Max4170 = keras.layers.Maximum(name = 'Max4170', )([in0Max4170,in1Max4170])
Con52160 = keras.layers.Concatenate(axis=3, name = 'Con52160', )([Max4170,in0Con52160])
Sub49569 = keras.layers.Subtract(name = 'Sub49569', )([in0Sub49569,in1Sub49569])
Ave29975 = keras.layers.Average(name = 'Ave29975', )([Con52160,Sub49569])
Max50782 = keras.layers.Maximum(name = 'Max50782', )([in0Max50782,in1Max50782])
Res71568 = keras.layers.Reshape((1, 2, 2), name = 'Res71568', )(Max50782)
Zer58068 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer58068', )(Res71568)
Min62267 = keras.layers.Minimum(name = 'Min62267', )([in0Min62267,in1Min62267])
Con60486 = keras.layers.Concatenate(axis=3, name = 'Con60486', )([Min62267,in0Con60486])
Ave88384 = keras.layers.Average(name = 'Ave88384', )([Zer58068,Con60486])
Mul36649 = keras.layers.Multiply(name = 'Mul36649', )([Ave29975,Ave88384])
model = tf.keras.models.Model(inputs=[in0Max4170,in1Max4170,in0Con52160,in0Sub49569,in1Sub49569,in0Max50782,in1Max50782,in0Min62267,in1Min62267,in0Con60486], outputs=Mul36649)
in0Max4170 = tf.constant([[[[0.0943], [0.3916]], [[0.589], [0.7733]]]])
in1Max4170 = tf.constant([[[[0.807], [0.2603]], [[0.6965], [0.8224]]]])
in0Con52160 = tf.constant([[[[0.2523], [0.2729]], [[0.1153], [0.647]]]])
in0Sub49569 = tf.constant([[[[0.3753, 0.8283], [0.5252, 0.2374]], [[0.488, 0.9144], [0.8008, 0.83]]]])
in1Sub49569 = tf.constant([[[[0.2886, 0.2523], [0.1534, 0.4357]], [[0.4878, 0.2551], [0.3413, 0.6443]]]])
in0Max50782 = tf.constant([[[[[0.5177, 0.2312]], [[0.1333, 0.7853]]]]])
in1Max50782 = tf.constant([[[[[0.1601, 0.8267]], [[0.5737, 0.2109]]]]])
in0Min62267 = tf.constant([[[[0.7704], [0.6733]], [[0.8792], [0.0768]]]])
in1Min62267 = tf.constant([[[[0.8213], [0.5743]], [[0.14], [0.627]]]])
in0Con60486 = tf.constant([[[[0.1536], [0.7104]], [[0.5116], [0.9445]]]])
print (np.array2string(model.predict([in0Max4170,in1Max4170,in0Con52160,in0Sub49569,in1Sub49569,in0Max50782,in1Max50782,in0Min62267,in1Min62267,in0Con60486],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul36649.png')

LMax4170 = maximum_layer([[[[[0.0943], [0.3916]], [[0.589], [0.7733]]]], [[[[0.807], [0.2603]], [[0.6965], [0.8224]]]]], Max4170), 
LCon52160 = concatenate_layer([Max4170,[[[[0.2523], [0.2729]], [[0.1153], [0.647]]]]], 3, Con52160), 
LSub49569 = subtract_layer([[[[0.3753, 0.8283], [0.5252, 0.2374]], [[0.488, 0.9144], [0.8008, 0.83]]]], [[[[0.2886, 0.2523], [0.1534, 0.4357]], [[0.4878, 0.2551], [0.3413, 0.6443]]]], Sub49569), 
LAve29975 = average_layer([Con52160,Sub49569], Ave29975), 
LMax50782 = maximum_layer([[[[[[0.5177, 0.2312]], [[0.1333, 0.7853]]]]], [[[[[0.1601, 0.8267]], [[0.5737, 0.2109]]]]]], Max50782), 
LRes71568 = reshape_layer(Max50782, [1, 2, 2], Res71568), 
LZer58068 = zero_padding2D_layer(Res71568, 1, 0, 0, 0, Zer58068), 
LMin62267 = minimum_layer([[[[[0.7704], [0.6733]], [[0.8792], [0.0768]]]], [[[[0.8213], [0.5743]], [[0.14], [0.627]]]]], Min62267), 
LCon60486 = concatenate_layer([Min62267,[[[[0.1536], [0.7104]], [[0.5116], [0.9445]]]]], 3, Con60486), 
LAve88384 = average_layer([Zer58068,Con60486], Ave88384), 
LMul36649 = multiply_layer([Ave29975,Ave88384], Mul36649), 
exec_layers([LMax4170,LCon52160,LSub49569,LAve29975,LMax50782,LRes71568,LZer58068,LMin62267,LCon60486,LAve88384,LMul36649],["Max4170","Con52160","Sub49569","Ave29975","Max50782","Res71568","Zer58068","Min62267","Con60486","Ave88384","Mul36649"],Mul36649,"Mul36649")

Actual (Unparsed): [[[[0.1721266, 0.0318067], [0.1096052, 0.0132490]], [[0.1145549, 0.2591618], [0.2084690, 0.3601011]]]]

Expected (Unparsed): [[[[0.17212662,0.03180672],[0.10960515500000002,0.01324896]],[[0.1145548975,0.259161795],[0.2084689875,0.36010111499999997]]]]

Actual:   [[[[0.1722, 0.0319], [0.1097, 0.0133]], [[0.1146, 0.2592], [0.2085, 0.3602]]]]

Expected: [[[[0.1722, 0.0319], [0.1097, 0.0133]], [[0.1146, 0.2592], [0.2085, 0.3602]]]]