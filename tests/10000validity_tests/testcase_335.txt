import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add99231 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Add99231 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Dot22625 = tf.keras.layers.Input(shape=([3]))
in1Dot22625 = tf.keras.layers.Input(shape=([3]))
in0Con15812 = tf.keras.layers.Input(shape=([1, 7]))

Add99231 = keras.layers.Add(name = 'Add99231', )([in0Add99231,in1Add99231])
Res72847 = keras.layers.Reshape((1, 2, 4), name = 'Res72847', )(Add99231)
Res35110 = keras.layers.Reshape((1, 8), name = 'Res35110', )(Res72847)
Dot22625 = keras.layers.Dot(axes=(1, 1), name = 'Dot22625', )([in0Dot22625,in1Dot22625])
Res75326 = keras.layers.Reshape((1, 1), name = 'Res75326', )(Dot22625)
Per53407 = keras.layers.Permute((1,2), name = 'Per53407',)(Res75326)
Con15812 = keras.layers.Concatenate(axis=2, name = 'Con15812', )([Per53407,in0Con15812])
Ave81432 = keras.layers.Average(name = 'Ave81432', )([Res35110,Con15812])
model = tf.keras.models.Model(inputs=[in0Add99231,in1Add99231,in0Dot22625,in1Dot22625,in0Con15812], outputs=Ave81432)
in0Add99231 = tf.constant([[[[[0.9228, 0.6164], [0.2508, 0.9278]], [[0.4266, 0.8869], [0.3692, 0.5838]]]]])
in1Add99231 = tf.constant([[[[[0.4388, 0.768], [0.7739, 0.9175]], [[0.5352, 0.6752], [0.6955, 0.519]]]]])
in0Dot22625 = tf.constant([[0.0486, 0.021, 0.8205]])
in1Dot22625 = tf.constant([[0.798, 0.6376, 0.4415]])
in0Con15812 = tf.constant([[[0.8235, 0.0529, 0.3451, 0.0441, 0.7008, 0.2939, 0.5877]]])
print (np.array2string(model.predict([in0Add99231,in1Add99231,in0Dot22625,in1Dot22625,in0Con15812],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave81432.png')

LAdd99231 = add_layer([[[[[[0.9228, 0.6164], [0.2508, 0.9278]], [[0.4266, 0.8869], [0.3692, 0.5838]]]]], [[[[[0.4388, 0.768], [0.7739, 0.9175]], [[0.5352, 0.6752], [0.6955, 0.519]]]]]], Add99231), 
LRes72847 = reshape_layer(Add99231, [1, 2, 4], Res72847), 
LRes35110 = reshape_layer(Res72847, [1, 8], Res35110), 
LDot22625 = dot_layer([[0.0486, 0.021, 0.8205]], [[0.798, 0.6376, 0.4415]], 1, 1, Dot22625), 
LRes75326 = reshape_layer(Dot22625, [1, 1], Res75326), 
LPer53407 = permute_layer(Res75326, 1,2, Per53407), 
LCon15812 = concatenate_layer([Per53407,[[[0.8235, 0.0529, 0.3451, 0.0441, 0.7008, 0.2939, 0.5877]]]], 2, Con15812), 
LAve81432 = average_layer([Res35110,Con15812], Ave81432), 
exec_layers([LAdd99231,LRes72847,LRes35110,LDot22625,LRes75326,LPer53407,LCon15812,LAve81432],["Add99231","Res72847","Res35110","Dot22625","Res75326","Per53407","Con15812","Ave81432"],Ave81432,"Ave81432")

Actual (Unparsed): [[[0.8880116, 1.1039500, 0.5388000, 1.0952000, 0.5029500, 1.1314500, 0.6793000, 0.8452500]]]

Expected (Unparsed): [[[0.8880115749999999,1.10395,0.5388000000000001,1.0952,0.50295,1.13145,0.6793,0.8452500000000001]]]

Actual:   [[[0.8881, 1.104, 0.5388, 1.0952, 0.503, 1.1315, 0.6793, 0.8453]]]

Expected: [[[0.8881, 1.104, 0.5389, 1.0952, 0.503, 1.1315, 0.6793, 0.8453]]]