import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot82241 = tf.keras.layers.Input(shape=([3]))
in1Dot82241 = tf.keras.layers.Input(shape=([3]))
in0Con78536 = tf.keras.layers.Input(shape=([1]))
in0Bat46092 = tf.keras.layers.Input(shape=([2]))
in0Dep16939 = tf.keras.layers.Input(shape=([2, 1, 2]))

Dot82241 = keras.layers.Dot(axes=(1, 1), name = 'Dot82241', )([in0Dot82241,in1Dot82241])
Con78536 = keras.layers.Concatenate(axis=1, name = 'Con78536', )([Dot82241,in0Con78536])
Bat46092 = keras.layers.BatchNormalization(axis=1, epsilon=0.6757752668773213,  name = 'Bat46092', )(in0Bat46092)
Ave74791 = keras.layers.Average(name = 'Ave74791', )([Con78536,Bat46092])
Res29435 = keras.layers.Reshape((2, 1), name = 'Res29435', )(Ave74791)
Dep16939 = keras.layers.DepthwiseConv2D((2, 1),strides=(1, 1), padding='valid', name = 'Dep16939', )(in0Dep16939)
Res33160 = keras.layers.Reshape((2, 1), name = 'Res33160', )(Dep16939)
Ave58009 = keras.layers.Average(name = 'Ave58009', )([Res29435,Res33160])
model = tf.keras.models.Model(inputs=[in0Dot82241,in1Dot82241,in0Con78536,in0Bat46092,in0Dep16939], outputs=Ave58009)
w = model.get_layer('Bat46092').get_weights() 
w[0] = np.array([0.1123, 0.2051])
w[1] = np.array([0.3137, 0.0557])
w[2] = np.array([0.6342, 0.4655])
w[3] = np.array([0.095, 0.9153])
model.get_layer('Bat46092').set_weights(w) 
w = model.get_layer('Dep16939').get_weights() 
w[0] = np.array([[[[0.6199], [0.6482]]], [[[0.8338], [0.0885]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep16939').set_weights(w) 
in0Dot82241 = tf.constant([[0.6673, 0.6164, 0.1526]])
in1Dot82241 = tf.constant([[0.1519, 0.9476, 0.7259]])
in0Con78536 = tf.constant([[0.7751]])
in0Bat46092 = tf.constant([[1.5368, 1.4567]])
in0Dep16939 = tf.constant([[[[0.1701, 0.0509]], [[0.2279, 0.4339]]]])
print (np.array2string(model.predict([in0Dot82241,in1Dot82241,in0Con78536,in0Bat46092,in0Dep16939],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave58009.png')

LDot82241 = dot_layer([[0.6673, 0.6164, 0.1526]], [[0.1519, 0.9476, 0.7259]], 1, 1, Dot82241), 
LCon78536 = concatenate_layer([Dot82241,[[0.7751]]], 1, Con78536), 
LBat46092 = batch_normalization_layer([[1.5368, 1.4567]], 1, 0.6757752668773213, [0.1123, 0.2051], [0.3137, 0.0557], [0.6342, 0.4655], [0.095, 0.9153], Bat46092), 
LAve74791 = average_layer([Con78536,Bat46092], Ave74791), 
LRes29435 = reshape_layer(Ave74791, [2, 1], Res29435), 
LDep16939 = depthwise_conv2D_layer([[[[0.1701, 0.0509]], [[0.2279, 0.4339]]]], 2, 1,[[[[0.6199], [0.6482]]], [[[0.8338], [0.0885]]]],[0, 0], 1, 1, false, Dep16939), 
LRes33160 = reshape_layer(Dep16939, [2, 1], Res33160), 
LAve58009 = average_layer([Res29435,Res33160], Ave58009), 
exec_layers([LDot82241,LCon78536,LBat46092,LAve74791,LRes29435,LDep16939,LRes33160,LAve58009],["Dot82241","Con78536","Bat46092","Ave74791","Res29435","Dep16939","Res33160","Ave58009"],Ave58009,"Ave58009")

Actual (Unparsed): [[[0.4540816], [0.2836890]]]

Expected (Unparsed): [[[0.45408161479659664],[0.28368902243204425]]]

Actual:   [[[0.4541], [0.2837]]]

Expected: [[[0.4541], [0.2837]]]