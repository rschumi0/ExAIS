import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Zer37266 = tf.keras.layers.Input(shape=([4, 3, 1]))
in0Loc87676 = tf.keras.layers.Input(shape=([2, 1]))
in0Con89316 = tf.keras.layers.Input(shape=([8, 1]))

Zer37266 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer37266', )(in0Zer37266)
Res83879 = keras.layers.Reshape((6, 5), name = 'Res83879', )(Zer37266)
Zer56162 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer56162', )(Res83879)
Mas52731 = keras.layers.Masking(mask_value=2, name = 'Mas52731', )(Zer56162)
Loc87676 = keras.layers.LocallyConnected1D(4, (1),strides=(1), name = 'Loc87676', )(in0Loc87676)
Zer67651 = keras.layers.ZeroPadding1D(padding=((6, 0)), name = 'Zer67651', )(Loc87676)
Con89316 = keras.layers.Concatenate(axis=2, name = 'Con89316', )([Zer67651,in0Con89316])
Ave86940 = keras.layers.Average(name = 'Ave86940', )([Mas52731,Con89316])
model = tf.keras.models.Model(inputs=[in0Zer37266,in0Loc87676,in0Con89316], outputs=Ave86940)
w = model.get_layer('Loc87676').get_weights() 
w[0] = np.array([[[0.8541, 0.2261, 0.565, 0.2043]], [[0.5472, 0.7216, 0.0239, 0.8014]]])
w[1] = np.array([[0, 0, 0, 0], [0, 0, 0, 0]])
model.get_layer('Loc87676').set_weights(w) 
in0Zer37266 = tf.constant([[[[1.0565], [1.1707], [1.3661]], [[1.5033], [1.8507], [1.5875]], [[1.9987], [1.1944], [1.6559]], [[1.9579], [1.6171], [1.4931]]]])
in0Loc87676 = tf.constant([[[0.1113], [0.0841]]])
in0Con89316 = tf.constant([[[0.6367], [0.4947], [0.4726], [0.7288], [0.2865], [0.2233], [0.4108], [0.4489]]])
print (np.array2string(model.predict([in0Zer37266,in0Loc87676,in0Con89316],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave86940.png')

LZer37266 = zero_padding2D_layer([[[[1.0565], [1.1707], [1.3661]], [[1.5033], [1.8507], [1.5875]], [[1.9987], [1.1944], [1.6559]], [[1.9579], [1.6171], [1.4931]]]], 1, 1, 1, 1, Zer37266), 
LRes83879 = reshape_layer(Zer37266, [6, 5], Res83879), 
LZer56162 = zero_padding1D_layer(Res83879, 1, 1, Zer56162), 
LMas52731 = masking_layer(Zer56162, 2, Mas52731), 
LLoc87676 = locally_connected1D_layer([[[0.1113], [0.0841]]], 1,[[[0.8541, 0.2261, 0.565, 0.2043]], [[0.5472, 0.7216, 0.0239, 0.8014]]],[[0, 0, 0, 0], [0, 0, 0, 0]], 1, Loc87676), 
LZer67651 = zero_padding1D_layer(Loc87676, 6, 0, Zer67651), 
LCon89316 = concatenate_layer([Zer67651,[[[0.6367], [0.4947], [0.4726], [0.7288], [0.2865], [0.2233], [0.4108], [0.4489]]]], 2, Con89316), 
LAve86940 = average_layer([Mas52731,Con89316], Ave86940), 
exec_layers([LZer37266,LRes83879,LZer56162,LMas52731,LLoc87676,LZer67651,LCon89316,LAve86940],["Zer37266","Res83879","Zer56162","Mas52731","Loc87676","Zer67651","Con89316","Ave86940"],Ave86940,"Ave86940")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.3183500], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.2473500], [0.0000000, 0.5282500, 0.5853500, 0.6830500, 0.2363000], [0.0000000, 0.7516500, 0.9253500, 0.7937500, 0.3644000], [0.0000000, 0.9993500, 0.5972000, 0.8279500, 0.1432500], [0.0000000, 0.9789500, 0.8085500, 0.7465500, 0.1116500], [0.0475307, 0.0125825, 0.0314422, 0.0113693, 0.2054000], [0.0230098, 0.0303433, 0.0010050, 0.0336989, 0.2244500]]]

Expected (Unparsed): [[[0,0,0,0,0.31835],[0,0,0,0,0.24735],[0,0.52825,0.58535,0.68305,0.2363],[0,0.75165,0.92535,0.79375,0.3644],[0,0.99935,0.5972,0.82795,0.14325],[0,0.97895,0.80855,0.74655,0.11165],[0.047530665,0.012582465,0.03144225,0.011369295,0.2054],[0.02300976,0.03034328,0.001004995,0.03369887,0.22445]]]

Actual:   [[[0, 0, 0, 0, 0.3184], [0, 0, 0, 0, 0.2474], [0, 0.5283, 0.5854, 0.6831, 0.2363], [0, 0.7517, 0.9254, 0.7938, 0.3644], [0, 0.9994, 0.5972, 0.828, 0.1433], [0, 0.979, 0.8086, 0.7466, 0.1117], [0.0476, 0.0126, 0.0315, 0.0114, 0.2054], [0.0231, 0.0304, 0.0011, 0.0337, 0.2245]]]

Expected: [[[0, 0, 0, 0, 0.3184], [0, 0, 0, 0, 0.2474], [0, 0.5283, 0.5854, 0.6831, 0.2363], [0, 0.7517, 0.9254, 0.7938, 0.3644], [0, 0.9994, 0.5972, 0.828, 0.1433], [0, 0.979, 0.8086, 0.7466, 0.1117], [0.0476, 0.0126, 0.0315, 0.0114, 0.2054], [0.0231, 0.0304, 0.0011, 0.0337, 0.2245]]]