import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave61940 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Ave61940 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Dot33995 = tf.keras.layers.Input(shape=([2]))
in1Dot33995 = tf.keras.layers.Input(shape=([2]))
in0Con98782 = tf.keras.layers.Input(shape=([1]))

Ave61940 = keras.layers.Average(name = 'Ave61940', )([in0Ave61940,in1Ave61940])
Res11938 = keras.layers.Reshape((1, 1, 2), name = 'Res11938', )(Ave61940)
Res33482 = keras.layers.Reshape((1, 2), name = 'Res33482', )(Res11938)
Fla6813 = keras.layers.Flatten(name = 'Fla6813', )(Res33482)
Dot33995 = keras.layers.Dot(axes=(1, 1), name = 'Dot33995', )([in0Dot33995,in1Dot33995])
Con98782 = keras.layers.Concatenate(axis=1, name = 'Con98782', )([Dot33995,in0Con98782])
Ave35845 = keras.layers.Average(name = 'Ave35845', )([Fla6813,Con98782])
Res62661 = keras.layers.Reshape((2, 1), name = 'Res62661', )(Ave35845)
Res50662 = keras.layers.Reshape((2, 1, 1), name = 'Res50662', )(Res62661)
Res8554 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res8554', )(Res50662)
Con4551 = keras.layers.Conv3D(3, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con4551', )(Res8554)
model = tf.keras.models.Model(inputs=[in0Ave61940,in1Ave61940,in0Dot33995,in1Dot33995,in0Con98782], outputs=Con4551)
w = model.get_layer('Con4551').get_weights() 
w[0] = np.array([[[[[0.8226, 0.0208, 0.162]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con4551').set_weights(w) 
in0Ave61940 = tf.constant([[[[[0.7431], [0.7443]]]]])
in1Ave61940 = tf.constant([[[[[0.0783], [0.567]]]]])
in0Dot33995 = tf.constant([[0.0674, 0.3702]])
in1Dot33995 = tf.constant([[0.3442, 0.7119]])
in0Con98782 = tf.constant([[0.087]])
print (np.array2string(model.predict([in0Ave61940,in1Ave61940,in0Dot33995,in1Dot33995,in0Con98782],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con4551.png')

LAve61940 = average_layer([[[[[[0.7431], [0.7443]]]]], [[[[[0.0783], [0.567]]]]]], Ave61940), 
LRes11938 = reshape_layer(Ave61940, [1, 1, 2], Res11938), 
LRes33482 = reshape_layer(Res11938, [1, 2], Res33482), 
LFla6813 = flatten_layer(Res33482, Fla6813), 
LDot33995 = dot_layer([[0.0674, 0.3702]], [[0.3442, 0.7119]], 1, 1, Dot33995), 
LCon98782 = concatenate_layer([Dot33995,[[0.087]]], 1, Con98782), 
LAve35845 = average_layer([Fla6813,Con98782], Ave35845), 
LRes62661 = reshape_layer(Ave35845, [2, 1], Res62661), 
LRes50662 = reshape_layer(Res62661, [2, 1, 1], Res50662), 
LRes8554 = reshape_layer(Res50662, [2, 1, 1, 1], Res8554), 
LCon4551 = conv3D_layer(Res8554, 1, 1, 1,[[[[[0.8226, 0.0208, 0.162]]]]],[0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con4551), 
exec_layers([LAve61940,LRes11938,LRes33482,LFla6813,LDot33995,LCon98782,LAve35845,LRes62661,LRes50662,LRes8554,LCon4551],["Ave61940","Res11938","Res33482","Fla6813","Dot33995","Con98782","Ave35845","Res62661","Res50662","Res8554","Con4551"],Con4551,"Con4551")

Actual (Unparsed): [[[[[0.2868589, 0.0072534, 0.0564930]]], [[[0.3054519, 0.0077236, 0.0601546]]]]]

Expected (Unparsed): [[[[[0.286858906398,0.007253422384,0.05649300126000001]]],[[[0.30545194499999995,0.007723559999999999,0.06015465]]]]]

Actual:   [[[[[0.2869, 0.0073, 0.0565]]], [[[0.3055, 0.0078, 0.0602]]]]]

Expected: [[[[[0.2869, 0.0073, 0.0565]]], [[[0.3055, 0.0078, 0.0602]]]]]