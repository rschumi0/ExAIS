import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0GRU55472 = tf.keras.layers.Input(shape=([2, 1]))
in0Con60968 = tf.keras.layers.Input(shape=([3]))
in0Loc32326 = tf.keras.layers.Input(shape=([1, 2]))
in0Max68172 = tf.keras.layers.Input(shape=([2, 1]))
in1Max68172 = tf.keras.layers.Input(shape=([2, 1]))
in0Con14452 = tf.keras.layers.Input(shape=([2, 2]))

GRU55472 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU55472', )(in0GRU55472)
Con60968 = keras.layers.Concatenate(axis=1, name = 'Con60968', )([GRU55472,in0Con60968])
Loc32326 = keras.layers.LocallyConnected1D(3, (1),strides=(1), name = 'Loc32326', )(in0Loc32326)
Zer10749 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer10749', )(Loc32326)
Max68172 = keras.layers.Maximum(name = 'Max68172', )([in0Max68172,in1Max68172])
Ave22942 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave22942', )(Max68172)
Max47373 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max47373', )(Ave22942)
Con14452 = keras.layers.Concatenate(axis=2, name = 'Con14452', )([Max47373,in0Con14452])
Mul40511 = keras.layers.Multiply(name = 'Mul40511', )([Zer10749,Con14452])
Fla748 = keras.layers.Flatten(name = 'Fla748', )(Mul40511)
Mul35308 = keras.layers.Multiply(name = 'Mul35308', )([Con60968,Fla748])
model = tf.keras.models.Model(inputs=[in0GRU55472,in0Con60968,in0Loc32326,in0Max68172,in1Max68172,in0Con14452], outputs=Mul35308)
w = model.get_layer('GRU55472').get_weights() 
w[0] = np.array([[7, 9, 4, 8, 2, 1, 8, 7, 10]])
w[1] = np.array([[6, 7, 1, 6, 5, 5, 6, 3, 5], [9, 4, 10, 6, 7, 2, 3, 2, 4], [7, 8, 6, 10, 9, 2, 9, 5, 4]])
w[2] = np.array([1, 2, 7, 10, 5, 9, 7, 8, 5])
model.get_layer('GRU55472').set_weights(w) 
w = model.get_layer('Loc32326').get_weights() 
w[0] = np.array([[[0.4105, 0.5398, 0.7013], [0.6045, 0.3326, 0.1451]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc32326').set_weights(w) 
in0GRU55472 = tf.constant([[[9], [2]]])
in0Con60968 = tf.constant([[0.111, 0.1206, 0.2911]])
in0Loc32326 = tf.constant([[[0.4086, 0.3533]]])
in0Max68172 = tf.constant([[[0.9249], [0.5229]]])
in1Max68172 = tf.constant([[[0.1591], [0.1155]]])
in0Con14452 = tf.constant([[[0.7281, 0.5611], [0.7882, 0.5801]]])
print (np.array2string(model.predict([in0GRU55472,in0Con60968,in0Loc32326,in0Max68172,in1Max68172,in0Con14452],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul35308.png')

LGRU55472 = gru_layer([[[9], [2]]],[[7, 9, 4, 8, 2, 1, 8, 7, 10]],[[6, 7, 1, 6, 5, 5, 6, 3, 5], [9, 4, 10, 6, 7, 2, 3, 2, 4], [7, 8, 6, 10, 9, 2, 9, 5, 4]],[1, 2, 7, 10, 5, 9, 7, 8, 5], false, GRU55472), 
LCon60968 = concatenate_layer([GRU55472,[[0.111, 0.1206, 0.2911]]], 1, Con60968), 
LLoc32326 = locally_connected1D_layer([[[0.4086, 0.3533]]], 1,[[[0.4105, 0.5398, 0.7013], [0.6045, 0.3326, 0.1451]]],[[0, 0, 0]], 1, Loc32326), 
LZer10749 = zero_padding1D_layer(Loc32326, 1, 0, Zer10749), 
LMax68172 = maximum_layer([[[[0.9249], [0.5229]]], [[[0.1591], [0.1155]]]], Max68172), 
LAve22942 = average_pooling1D_layer(Max68172, 1, Ave22942), 
LMax47373 = max_pool1D_layer(Ave22942, 1, Max47373), 
LCon14452 = concatenate_layer([Max47373,[[[0.7281, 0.5611], [0.7882, 0.5801]]]], 2, Con14452), 
LMul40511 = multiply_layer([Zer10749,Con14452], Mul40511), 
LFla748 = flatten_layer(Mul40511, Fla748), 
LMul35308 = multiply_layer([Con60968,Fla748], Mul35308), 
exec_layers([LGRU55472,LCon60968,LLoc32326,LZer10749,LMax68172,LAve22942,LMax47373,LCon14452,LMul40511,LFla748,LMul35308],["GRU55472","Con60968","Loc32326","Zer10749","Max68172","Ave22942","Max47373","Con14452","Mul40511","Fla748","Mul35308"],Mul35308,"Mul35308")

Actual (Unparsed): [[0.0000000, 0.0000000, 0.0000000, 0.0221314, 0.0321359, 0.0570458]]

Expected (Unparsed): [[0.0,0.0,0.0,0.022131385176285,0.0321358796364312,0.0570458444533211]]

Actual:   [[0, 0, 0, 0.0222, 0.0322, 0.0571]]

Expected: [[0, 0, 0, 0.0222, 0.0322, 0.0571]]