import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sim25699 = tf.keras.layers.Input(shape=([2, 3]))
in0Con6974 = tf.keras.layers.Input(shape=([6]))
in0Add16278 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Add16278 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con41247 = tf.keras.layers.Input(shape=([4]))
in0Mul30141 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Mul30141 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Sim71548 = tf.keras.layers.Input(shape=([1, 3]))
in0Con55638 = tf.keras.layers.Input(shape=([7]))

Sim25699 = keras.layers.SimpleRNN(2,name = 'Sim25699', )(in0Sim25699)
Con6974 = keras.layers.Concatenate(axis=1, name = 'Con6974', )([Sim25699,in0Con6974])
Add16278 = keras.layers.Add(name = 'Add16278', )([in0Add16278,in1Add16278])
Res96969 = keras.layers.Reshape((2, 2), name = 'Res96969', )(Add16278)
Fla35884 = keras.layers.Flatten(name = 'Fla35884', )(Res96969)
Con41247 = keras.layers.Concatenate(axis=1, name = 'Con41247', )([Fla35884,in0Con41247])
Mul30141 = keras.layers.Multiply(name = 'Mul30141', )([in0Mul30141,in1Mul30141])
Res774 = keras.layers.Reshape((2, 4), name = 'Res774', )(Mul30141)
Fla68513 = keras.layers.Flatten(name = 'Fla68513', )(Res774)
Sim71548 = keras.layers.SimpleRNN(1,name = 'Sim71548', )(in0Sim71548)
Con55638 = keras.layers.Concatenate(axis=1, name = 'Con55638', )([Sim71548,in0Con55638])
Min45787 = keras.layers.Minimum(name = 'Min45787', )([Fla68513,Con55638])
Sub80004 = keras.layers.Subtract(name = 'Sub80004', )([Con41247,Min45787])
Max15323 = keras.layers.Maximum(name = 'Max15323', )([Con6974,Sub80004])
model = tf.keras.models.Model(inputs=[in0Sim25699,in0Con6974,in0Add16278,in1Add16278,in0Con41247,in0Mul30141,in1Mul30141,in0Sim71548,in0Con55638], outputs=Max15323)
w = model.get_layer('Sim25699').get_weights() 
w[0] = np.array([[8, 3], [8, 7], [2, 8]])
w[1] = np.array([[4, 5], [1, 1]])
w[2] = np.array([7, 9])
model.get_layer('Sim25699').set_weights(w) 
w = model.get_layer('Sim71548').get_weights() 
w[0] = np.array([[6], [10], [9]])
w[1] = np.array([[3]])
w[2] = np.array([10])
model.get_layer('Sim71548').set_weights(w) 
in0Sim25699 = tf.constant([[[2, 1, 2], [3, 8, 6]]])
in0Con6974 = tf.constant([[0.5304, 0.7261, 0.8886, 0.0392, 0.5725, 0.3526]])
in0Add16278 = tf.constant([[[[0.586], [0.0766]], [[0.355], [0.6151]]]])
in1Add16278 = tf.constant([[[[0.0113], [0.7189]], [[0.945], [0.1474]]]])
in0Con41247 = tf.constant([[0.1782, 0.991, 0.4261, 0.554]])
in0Mul30141 = tf.constant([[[[0.7324, 0.5446], [0.5269, 0.3918]], [[0.4113, 0.0213], [0.6558, 0.7329]]]])
in1Mul30141 = tf.constant([[[[0.0504, 0.4728], [0.4793, 0.7586]], [[0.105, 0.5167], [0.2176, 0.1397]]]])
in0Sim71548 = tf.constant([[[9, 2, 3]]])
in0Con55638 = tf.constant([[0.0076, 0.8657, 0.5762, 0.1981, 0.2902, 0.9624, 0.916]])
print (np.array2string(model.predict([in0Sim25699,in0Con6974,in0Add16278,in1Add16278,in0Con41247,in0Mul30141,in1Mul30141,in0Sim71548,in0Con55638],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max15323.png')

LSim25699 = simple_rnn_layer([[[2, 1, 2], [3, 8, 6]]],[[8, 3], [8, 7], [2, 8]],[[4, 5], [1, 1]],[7, 9], Sim25699), 
LCon6974 = concatenate_layer([Sim25699,[[0.5304, 0.7261, 0.8886, 0.0392, 0.5725, 0.3526]]], 1, Con6974), 
LAdd16278 = add_layer([[[[[0.586], [0.0766]], [[0.355], [0.6151]]]], [[[[0.0113], [0.7189]], [[0.945], [0.1474]]]]], Add16278), 
LRes96969 = reshape_layer(Add16278, [2, 2], Res96969), 
LFla35884 = flatten_layer(Res96969, Fla35884), 
LCon41247 = concatenate_layer([Fla35884,[[0.1782, 0.991, 0.4261, 0.554]]], 1, Con41247), 
LMul30141 = multiply_layer([[[[[0.7324, 0.5446], [0.5269, 0.3918]], [[0.4113, 0.0213], [0.6558, 0.7329]]]], [[[[0.0504, 0.4728], [0.4793, 0.7586]], [[0.105, 0.5167], [0.2176, 0.1397]]]]], Mul30141), 
LRes774 = reshape_layer(Mul30141, [2, 4], Res774), 
LFla68513 = flatten_layer(Res774, Fla68513), 
LSim71548 = simple_rnn_layer([[[9, 2, 3]]],[[6], [10], [9]],[[3]],[10], Sim71548), 
LCon55638 = concatenate_layer([Sim71548,[[0.0076, 0.8657, 0.5762, 0.1981, 0.2902, 0.9624, 0.916]]], 1, Con55638), 
LMin45787 = minimum_layer([Fla68513,Con55638], Min45787), 
LSub80004 = subtract_layer(Con41247,Min45787, Sub80004), 
LMax15323 = maximum_layer([Con6974,Sub80004], Max15323), 
exec_layers([LSim25699,LCon6974,LAdd16278,LRes96969,LFla35884,LCon41247,LMul30141,LRes774,LFla68513,LSim71548,LCon55638,LMin45787,LSub80004,LMax15323],["Sim25699","Con6974","Add16278","Res96969","Fla35884","Con41247","Mul30141","Res774","Fla68513","Sim71548","Con55638","Min45787","Sub80004","Max15323"],Max15323,"Max15323")

Actual (Unparsed): [[1.0000000, 1.0000000, 1.0474568, 0.7261000, 0.8886000, 0.9799943, 0.5725000, 0.4516139]]

Expected (Unparsed): [[1.0,1.0,1.0474568299999998,0.7261,0.8886,0.97999429,0.5725,0.4516138700000001]]

Actual:   [[1, 1, 1.0475, 0.7261, 0.8886, 0.98, 0.5725, 0.4517]]

Expected: [[1, 1, 1.0475, 0.7261, 0.8886, 0.98, 0.5725, 0.4517]]