import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave84113 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave84113 = tf.keras.layers.Input(shape=([1, 2]))
in0Mul5755 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul5755 = tf.keras.layers.Input(shape=([1, 1]))
in0Con51544 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Sub68347 = tf.keras.layers.Input(shape=([2, 2, 3]))
in1Sub68347 = tf.keras.layers.Input(shape=([2, 2, 3]))

Ave84113 = keras.layers.Average(name = 'Ave84113', )([in0Ave84113,in1Ave84113])
Mul5755 = keras.layers.Multiply(name = 'Mul5755', )([in0Mul5755,in1Mul5755])
Dot29217 = keras.layers.Dot(axes=(1, 1), name = 'Dot29217', )([Ave84113,Mul5755])
Res24283 = keras.layers.Reshape((2, 1, 1), name = 'Res24283', )(Dot29217)
Zer89374 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer89374', )(Res24283)
Con51544 = keras.layers.Concatenate(axis=3, name = 'Con51544', )([Zer89374,in0Con51544])
Sub68347 = keras.layers.Subtract(name = 'Sub68347', )([in0Sub68347,in1Sub68347])
Sof31773 = keras.layers.Softmax(axis=1, name = 'Sof31773', )(Sub68347)
Sub38898 = keras.layers.Subtract(name = 'Sub38898', )([Con51544,Sof31773])
model = tf.keras.models.Model(inputs=[in0Ave84113,in1Ave84113,in0Mul5755,in1Mul5755,in0Con51544,in0Sub68347,in1Sub68347], outputs=Sub38898)
in0Ave84113 = tf.constant([[[0.4103, 0.9142]]])
in1Ave84113 = tf.constant([[[0.2516, 0.5529]]])
in0Mul5755 = tf.constant([[[0.6709]]])
in1Mul5755 = tf.constant([[[0.9872]]])
in0Con51544 = tf.constant([[[[0.4624, 0.6333], [0.7272, 0.784]], [[0.4414, 0.3233], [0.4278, 0.0458]]]])
in0Sub68347 = tf.constant([[[[0.6505, 0.3335, 0.2068], [0.6577, 0.7996, 0.3105]], [[0.3011, 0.4222, 0.7783], [0.6603, 0.8656, 0.627]]]])
in1Sub68347 = tf.constant([[[[0.1467, 0.7535, 0.7145], [0.7299, 0.0081, 0.6675]], [[0.6609, 0.5979, 0.5372], [0.1254, 0.4366, 0.1264]]]])
print (np.array2string(model.predict([in0Ave84113,in1Ave84113,in0Mul5755,in1Mul5755,in0Con51544,in0Sub68347,in1Sub68347],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub38898.png')

LAve84113 = average_layer([[[[0.4103, 0.9142]]], [[[0.2516, 0.5529]]]], Ave84113), 
LMul5755 = multiply_layer([[[[0.6709]]], [[[0.9872]]]], Mul5755), 
LDot29217 = dot_layer(Ave84113,Mul5755, 1, 1, Dot29217), 
LRes24283 = reshape_layer(Dot29217, [2, 1, 1], Res24283), 
LZer89374 = zero_padding2D_layer(Res24283, 0, 0, 1, 0, Zer89374), 
LCon51544 = concatenate_layer([Zer89374,[[[[0.4624, 0.6333], [0.7272, 0.784]], [[0.4414, 0.3233], [0.4278, 0.0458]]]]], 3, Con51544), 
LSub68347 = subtract_layer([[[[0.6505, 0.3335, 0.2068], [0.6577, 0.7996, 0.3105]], [[0.3011, 0.4222, 0.7783], [0.6603, 0.8656, 0.627]]]], [[[[0.1467, 0.7535, 0.7145], [0.7299, 0.0081, 0.6675]], [[0.6609, 0.5979, 0.5372], [0.1254, 0.4366, 0.1264]]]], Sub68347), 
LSof31773 = softmax_layer(Sub68347, 1, Sof31773), 
LSub38898 = subtract_layer(Con51544,Sof31773, Sub38898), 
exec_layers([LAve84113,LMul5755,LDot29217,LRes24283,LZer89374,LCon51544,LSub68347,LSof31773,LSub38898],["Ave84113","Mul5755","Dot29217","Res24283","Zer89374","Con51544","Sub68347","Sof31773","Sub38898"],Sub38898,"Sub38898")

Actual (Unparsed): [[[[-0.7034123, 0.0231730, 0.3122172], [-0.1335287, 0.1375545, 0.4861590]], [[-0.2965877, -0.1193731, -0.3556172], [-0.1614397, 0.0174455, -0.6563590]]]]

Expected (Unparsed): [[[[-0.7034122483593349,0.023173043020088213,0.31221716898149443],[-0.133528695341246,0.13755452143726876,0.4861589817972128]],[[-0.2965877516406651,-0.11937304302008833,-0.3556171689814946],[-0.161439669698754,0.01744547856273121,-0.6563589817972127]]]]

Actual:   [[[[-0.7034, 0.0232, 0.3123], [-0.1335, 0.1376, 0.4862]], [[-0.2965, -0.1193, -0.3556], [-0.1614, 0.0175, -0.6563]]]]

Expected: [[[[-0.7034, 0.0232, 0.3123], [-0.1335, 0.1376, 0.4862]], [[-0.2965, -0.1193, -0.3556], [-0.1614, 0.0175, -0.6563]]]]