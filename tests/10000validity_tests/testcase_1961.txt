import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub33201 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Sub33201 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Add91160 = tf.keras.layers.Input(shape=([2, 1]))
in1Add91160 = tf.keras.layers.Input(shape=([2, 1]))
in0Dot10586 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot10586 = tf.keras.layers.Input(shape=([3, 2]))
in0Con71719 = tf.keras.layers.Input(shape=([6]))

Sub33201 = keras.layers.Subtract(name = 'Sub33201', )([in0Sub33201,in1Sub33201])
Res50594 = keras.layers.Reshape((2, 4), name = 'Res50594', )(Sub33201)
Fla95414 = keras.layers.Flatten(name = 'Fla95414', )(Res50594)
Add91160 = keras.layers.Add(name = 'Add91160', )([in0Add91160,in1Add91160])
Fla35763 = keras.layers.Flatten(name = 'Fla35763', )(Add91160)
Dot10586 = keras.layers.Dot(axes=(2, 2), name = 'Dot10586', )([in0Dot10586,in1Dot10586])
LST59891 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST59891', )(Dot10586)
Mul36300 = keras.layers.Multiply(name = 'Mul36300', )([Fla35763,LST59891])
Con71719 = keras.layers.Concatenate(axis=1, name = 'Con71719', )([Mul36300,in0Con71719])
Max73791 = keras.layers.Maximum(name = 'Max73791', )([Fla95414,Con71719])
model = tf.keras.models.Model(inputs=[in0Sub33201,in1Sub33201,in0Add91160,in1Add91160,in0Dot10586,in1Dot10586,in0Con71719], outputs=Max73791)
w = model.get_layer('LST59891').get_weights() 
w[0] = np.array([[8, 10, 4, 4, 1, 6, 9, 7], [4, 7, 8, 9, 8, 6, 4, 3], [1, 7, 7, 5, 4, 8, 2, 8]])
w[1] = np.array([[9, 7, 7, 3, 3, 2, 6, 6], [4, 6, 10, 10, 1, 8, 2, 4]])
w[2] = np.array([9, 10, 1, 7, 6, 6, 2, 5])
model.get_layer('LST59891').set_weights(w) 
in0Sub33201 = tf.constant([[[[0.6944, 0.734], [0.1966, 0.5063]], [[0.7039, 0.2817], [0.7316, 0.1795]]]])
in1Sub33201 = tf.constant([[[[0.1757, 0.1033], [0.8923, 0.3512]], [[0.0748, 0.7448], [0.1474, 0.0869]]]])
in0Add91160 = tf.constant([[[0.8266], [0.1622]]])
in1Add91160 = tf.constant([[[0.9846], [0.983]]])
in0Dot10586 = tf.constant([[[0.2142, 0.772], [0.2937, 0.6057], [0.5958, 0.4715]]])
in1Dot10586 = tf.constant([[[0.4175, 0.0948], [0.0156, 0.5447], [0.1368, 0.7474]]])
in0Con71719 = tf.constant([[0.4499, 0.8583, 0.7966, 0.0056, 0.5975, 0.3864]])
print (np.array2string(model.predict([in0Sub33201,in1Sub33201,in0Add91160,in1Add91160,in0Dot10586,in1Dot10586,in0Con71719],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max73791.png')

LSub33201 = subtract_layer([[[[0.6944, 0.734], [0.1966, 0.5063]], [[0.7039, 0.2817], [0.7316, 0.1795]]]], [[[[0.1757, 0.1033], [0.8923, 0.3512]], [[0.0748, 0.7448], [0.1474, 0.0869]]]], Sub33201), 
LRes50594 = reshape_layer(Sub33201, [2, 4], Res50594), 
LFla95414 = flatten_layer(Res50594, Fla95414), 
LAdd91160 = add_layer([[[[0.8266], [0.1622]]], [[[0.9846], [0.983]]]], Add91160), 
LFla35763 = flatten_layer(Add91160, Fla35763), 
LDot10586 = dot_layer([[[0.2142, 0.772], [0.2937, 0.6057], [0.5958, 0.4715]]], [[[0.4175, 0.0948], [0.0156, 0.5447], [0.1368, 0.7474]]], 2, 2, Dot10586), 
LLST59891 = lstm_layer(Dot10586,[[8, 10, 4, 4, 1, 6, 9, 7], [4, 7, 8, 9, 8, 6, 4, 3], [1, 7, 7, 5, 4, 8, 2, 8]],[[9, 7, 7, 3, 3, 2, 6, 6], [4, 6, 10, 10, 1, 8, 2, 4]],[9, 10, 1, 7, 6, 6, 2, 5], LST59891), 
LMul36300 = multiply_layer([Fla35763,LST59891], Mul36300), 
LCon71719 = concatenate_layer([Mul36300,[[0.4499, 0.8583, 0.7966, 0.0056, 0.5975, 0.3864]]], 1, Con71719), 
LMax73791 = maximum_layer([Fla95414,Con71719], Max73791), 
exec_layers([LSub33201,LRes50594,LFla95414,LAdd91160,LFla35763,LDot10586,LLST59891,LMul36300,LCon71719,LMax73791],["Sub33201","Res50594","Fla95414","Add91160","Fla35763","Dot10586","LST59891","Mul36300","Con71719","Max73791"],Max73791,"Max73791")

Actual (Unparsed): [[1.8022420, 1.1395367, 0.4499000, 0.8583000, 0.7966000, 0.0056000, 0.5975000, 0.3864000]]

Expected (Unparsed): [[1.802241983312303,1.1395367029504486,0.4499,0.8583,0.7966,0.0056,0.5975,0.3864]]

Actual:   [[1.8023, 1.1396, 0.4499, 0.8583, 0.7966, 0.0056, 0.5975, 0.3864]]

Expected: [[1.8023, 1.1396, 0.4499, 0.8583, 0.7966, 0.0056, 0.5975, 0.3864]]