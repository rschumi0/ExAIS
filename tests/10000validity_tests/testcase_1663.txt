import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con63134 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con18408 = tf.keras.layers.Input(shape=([2, 2, 4, 1]))
in0Glo10940 = tf.keras.layers.Input(shape=([2, 1]))
in0ReL15229 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con66517 = tf.keras.layers.Input(shape=([2, 2, 6]))

Con63134 = keras.layers.Conv2DTranspose(4, (1, 1),strides=(1, 1), padding='valid', name = 'Con63134', )(in0Con63134)
Res55688 = keras.layers.Reshape((2, 2, 4, 1), name = 'Res55688', )(Con63134)
Con18408 = keras.layers.Concatenate(axis=4, name = 'Con18408', )([Res55688,in0Con18408])
Glo10940 = keras.layers.GlobalMaxPool1D(name = 'Glo10940', )(in0Glo10940)
Res90349 = keras.layers.Reshape((1, 1), name = 'Res90349', )(Glo10940)
Res81311 = keras.layers.Reshape((1, 1, 1), name = 'Res81311', )(Res90349)
Res23098 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res23098', )(Res81311)
Con12697 = keras.layers.Conv3D(2, (1, 1, 1),strides=(1, 5, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con12697', )(Res23098)
Zer15415 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (3, 0)), name = 'Zer15415', )(Con12697)
Mul84419 = keras.layers.Multiply(name = 'Mul84419', )([Con18408,Zer15415])
Res72496 = keras.layers.Reshape((2, 2, 8), name = 'Res72496', )(Mul84419)
ReL15229 = keras.layers.ReLU(max_value=9.689832009198648, negative_slope=9.996775789173382, threshold=9.185837905492873, name = 'ReL15229', input_shape=(1, 1, 2))(in0ReL15229)
Zer3384 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer3384', )(ReL15229)
Con66517 = keras.layers.Concatenate(axis=3, name = 'Con66517', )([Zer3384,in0Con66517])
Ave81276 = keras.layers.Average(name = 'Ave81276', )([Res72496,Con66517])
model = tf.keras.models.Model(inputs=[in0Con63134,in0Con18408,in0Glo10940,in0ReL15229,in0Con66517], outputs=Ave81276)
w = model.get_layer('Con63134').get_weights() 
w[0] = np.array([[[[0.974], [0.6814], [0.7356], [0.1318]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con63134').set_weights(w) 
w = model.get_layer('Con12697').get_weights() 
w[0] = np.array([[[[[0.2631, 0.1948]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con12697').set_weights(w) 
in0Con63134 = tf.constant([[[[0.5642], [0.3082]], [[0.4721], [0.6938]]]])
in0Con18408 = tf.constant([[[[[0.4449], [0.9373], [0.1702], [0.9998]], [[0.4102], [0.7266], [0.8529], [0.8271]]], [[[0.2877], [0.6948], [0.7036], [0.3725]], [[0.9552], [0.2495], [0.8869], [0.8383]]]]])
in0Glo10940 = tf.constant([[[1.7054], [1.501]]])
in0ReL15229 = tf.constant([[[[0.6056, 0.0059]]]])
in0Con66517 = tf.constant([[[[0.9374, 0.5092, 0.3835, 0.4559, 0.958, 0.9056], [0.3884, 0.1806, 0.0798, 0.778, 0.144, 0.8868]], [[0.048, 0.3495, 0.9538, 0.0146, 0.7089, 0.582], [0.343, 0.3226, 0.1234, 0.4424, 0.7494, 0.2124]]]])
print (np.array2string(model.predict([in0Con63134,in0Con18408,in0Glo10940,in0ReL15229,in0Con66517],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave81276.png')

LCon63134 = conv2D_transpose_layer([[[[0.5642], [0.3082]], [[0.4721], [0.6938]]]], 1, 1,[[[[0.974], [0.6814], [0.7356], [0.1318]]]],[0, 0, 0, 0], 1, 1, false, Con63134), 
LRes55688 = reshape_layer(Con63134, [2, 2, 4, 1], Res55688), 
LCon18408 = concatenate_layer([Res55688,[[[[[0.4449], [0.9373], [0.1702], [0.9998]], [[0.4102], [0.7266], [0.8529], [0.8271]]], [[[0.2877], [0.6948], [0.7036], [0.3725]], [[0.9552], [0.2495], [0.8869], [0.8383]]]]]], 4, Con18408), 
LGlo10940 = global_max_pool1D_layer([[[1.7054], [1.501]]], Glo10940), 
LRes90349 = reshape_layer(Glo10940, [1, 1], Res90349), 
LRes81311 = reshape_layer(Res90349, [1, 1, 1], Res81311), 
LRes23098 = reshape_layer(Res81311, [1, 1, 1, 1], Res23098), 
LCon12697 = conv3D_layer(Res23098, 1, 1, 1,[[[[[0.2631, 0.1948]]]]],[0, 0], 1, 5, 1, false, 1, 1, 1, Con12697), 
LZer15415 = zero_padding3D_layer(Con12697, 1, 0, 1, 0, 3, 0, Zer15415), 
LMul84419 = multiply_layer([Con18408,Zer15415], Mul84419), 
LRes72496 = reshape_layer(Mul84419, [2, 2, 8], Res72496), 
LReL15229 = relu_layer([[[[0.6056, 0.0059]]]], 9.689832009198648, 9.996775789173382, 9.185837905492873, ReL15229), 
LZer3384 = zero_padding2D_layer(ReL15229, 1, 0, 1, 0, Zer3384), 
LCon66517 = concatenate_layer([Zer3384,[[[[0.9374, 0.5092, 0.3835, 0.4559, 0.958, 0.9056], [0.3884, 0.1806, 0.0798, 0.778, 0.144, 0.8868]], [[0.048, 0.3495, 0.9538, 0.0146, 0.7089, 0.582], [0.343, 0.3226, 0.1234, 0.4424, 0.7494, 0.2124]]]]], 3, Con66517), 
LAve81276 = average_layer([Res72496,Con66517], Ave81276), 
exec_layers([LCon63134,LRes55688,LCon18408,LGlo10940,LRes90349,LRes81311,LRes23098,LCon12697,LZer15415,LMul84419,LRes72496,LReL15229,LZer3384,LCon66517,LAve81276],["Con63134","Res55688","Con18408","Glo10940","Res90349","Res81311","Res23098","Con12697","Zer15415","Mul84419","Res72496","ReL15229","Zer3384","Con66517","Ave81276"],Ave81276,"Ave81276")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.4687000, 0.2546000, 0.1917500, 0.2279500, 0.4790000, 0.4528000], [0.0000000, 0.0000000, 0.1942000, 0.0903000, 0.0399000, 0.3890000, 0.0720000, 0.4434000]], [[0.0000000, 0.0000000, 0.0240000, 0.1747500, 0.4769000, 0.0073000, 0.3544500, 0.2910000], [-42.8873573, -45.8848905, 0.1715000, 0.1613000, 0.0617000, 0.2212000, 0.3952148, 0.2454466]]]]

Expected (Unparsed): [[[[0.0,0.0,0.4687,0.2546,0.19175,0.22795,0.479,0.4528],[0.0,0.0,0.1942,0.0903,0.0399,0.389,0.072,0.4434]],[[0.0,0.0,0.024,0.17475,0.4769,0.0073,0.35445,0.291],[-42.88735727948944,-45.88489049987308,0.1715,0.1613,0.0617,0.2212,0.39521477777365077,0.245446626268]]]]

Actual:   [[[[0, 0, 0.4687, 0.2546, 0.1918, 0.228, 0.479, 0.4528], [0, 0, 0.1942, 0.0903, 0.0399, 0.389, 0.072, 0.4434]], [[0, 0, 0.024, 0.1748, 0.4769, 0.0073, 0.3545, 0.291], [-42.8873, -45.8848, 0.1715, 0.1613, 0.0617, 0.2212, 0.3953, 0.2455]]]]

Expected: [[[[0, 0, 0.4687, 0.2546, 0.1918, 0.228, 0.479, 0.4528], [0, 0, 0.1942, 0.0903, 0.0399, 0.389, 0.072, 0.4434]], [[0, 0, 0.024, 0.1748, 0.4769, 0.0073, 0.3545, 0.291], [-42.8873, -45.8848, 0.1715, 0.1613, 0.0617, 0.2212, 0.3953, 0.2455]]]]