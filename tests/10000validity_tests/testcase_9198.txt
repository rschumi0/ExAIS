import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con3354 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in0Ave39634 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Ave39634 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Add26673 = tf.keras.layers.Input(shape=([2, 2]))
in1Add26673 = tf.keras.layers.Input(shape=([2, 2]))
in0Con43172 = tf.keras.layers.Input(shape=([2, 2]))
in0Up_79342 = tf.keras.layers.Input(shape=([1, 1, 3, 1]))

Con3354 = keras.layers.Conv3D(4, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con3354', )(in0Con3354)
Res3778 = keras.layers.Reshape((1, 1, 4), name = 'Res3778', )(Con3354)
Res71538 = keras.layers.Reshape((1, 4), name = 'Res71538', )(Res3778)
Ave39634 = keras.layers.Average(name = 'Ave39634', )([in0Ave39634,in1Ave39634])
Res93977 = keras.layers.Reshape((1, 4), name = 'Res93977', )(Ave39634)
Zer95286 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer95286', )(Res93977)
Add26673 = keras.layers.Add(name = 'Add26673', )([in0Add26673,in1Add26673])
Con43172 = keras.layers.Concatenate(axis=2, name = 'Con43172', )([Add26673,in0Con43172])
Ave83457 = keras.layers.Average(name = 'Ave83457', )([Zer95286,Con43172])
Dot92065 = keras.layers.Dot(axes=(2, 2), name = 'Dot92065', )([Res71538,Ave83457])
Res53206 = keras.layers.Reshape((1, 2, 1), name = 'Res53206', )(Dot92065)
Res53238 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res53238', )(Res53206)
Glo62357 = keras.layers.GlobalMaxPool3D(name = 'Glo62357', )(Res53238)
Res47384 = keras.layers.Reshape((1, 1), name = 'Res47384', )(Glo62357)
Res43066 = keras.layers.Reshape((1, 1, 1), name = 'Res43066', )(Res47384)
Res58661 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res58661', )(Res43066)
Zer11544 = keras.layers.ZeroPadding3D(padding=((2, 0), (3, 0), (7, 0)), name = 'Zer11544', )(Res58661)
Up_79342 = keras.layers.UpSampling3D(size=(1, 2, 2), name = 'Up_79342', )(in0Up_79342)
Zer93423 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer93423', )(Up_79342)
Max72286 = keras.layers.Maximum(name = 'Max72286', )([Zer11544,Zer93423])
model = tf.keras.models.Model(inputs=[in0Con3354,in0Ave39634,in1Ave39634,in0Add26673,in1Add26673,in0Con43172,in0Up_79342], outputs=Max72286)
w = model.get_layer('Con3354').get_weights() 
w[0] = np.array([[[[[0.0667, 0.4411, 0.3797, 0.4358], [0.3723, 0.1234, 0.7145, 0.4585]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con3354').set_weights(w) 
in0Con3354 = tf.constant([[[[[0.0406, 0.2904]]]]])
in0Ave39634 = tf.constant([[[[0.1045, 0.805], [0.6312, 0.0132]]]])
in1Ave39634 = tf.constant([[[[0.3205, 0.1973], [0.7948, 0.5198]]]])
in0Add26673 = tf.constant([[[0.7773, 0.2902], [0.0728, 0.0412]]])
in1Add26673 = tf.constant([[[0.4067, 0.7907], [0.4683, 0.6007]]])
in0Con43172 = tf.constant([[[0.263, 0.5231], [0.557, 0.8706]]])
in0Up_79342 = tf.constant([[[[[1.3329], [1.3969], [1.9762]]]]])
print (np.array2string(model.predict([in0Con3354,in0Ave39634,in1Ave39634,in0Add26673,in1Add26673,in0Con43172,in0Up_79342],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max72286.png')

LCon3354 = conv3D_layer([[[[[0.0406, 0.2904]]]]], 1, 1, 1,[[[[[0.0667, 0.4411, 0.3797, 0.4358], [0.3723, 0.1234, 0.7145, 0.4585]]]]],[0, 0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con3354), 
LRes3778 = reshape_layer(Con3354, [1, 1, 4], Res3778), 
LRes71538 = reshape_layer(Res3778, [1, 4], Res71538), 
LAve39634 = average_layer([[[[[0.1045, 0.805], [0.6312, 0.0132]]]], [[[[0.3205, 0.1973], [0.7948, 0.5198]]]]], Ave39634), 
LRes93977 = reshape_layer(Ave39634, [1, 4], Res93977), 
LZer95286 = zero_padding1D_layer(Res93977, 1, 0, Zer95286), 
LAdd26673 = add_layer([[[[0.7773, 0.2902], [0.0728, 0.0412]]], [[[0.4067, 0.7907], [0.4683, 0.6007]]]], Add26673), 
LCon43172 = concatenate_layer([Add26673,[[[0.263, 0.5231], [0.557, 0.8706]]]], 2, Con43172), 
LAve83457 = average_layer([Zer95286,Con43172], Ave83457), 
LDot92065 = dot_layer(Res71538,Ave83457, 2, 2, Dot92065), 
LRes53206 = reshape_layer(Dot92065, [1, 2, 1], Res53206), 
LRes53238 = reshape_layer(Res53206, [1, 2, 1, 1], Res53238), 
LGlo62357 = global_max_pool3D_layer(Res53238, Glo62357), 
LRes47384 = reshape_layer(Glo62357, [1, 1], Res47384), 
LRes43066 = reshape_layer(Res47384, [1, 1, 1], Res43066), 
LRes58661 = reshape_layer(Res43066, [1, 1, 1, 1], Res58661), 
LZer11544 = zero_padding3D_layer(Res58661, 2, 0, 3, 0, 7, 0, Zer11544), 
LUp_79342 = up_sampling3D_layer([[[[[1.3329], [1.3969], [1.9762]]]]], 1, 2, 2, Up_79342), 
LZer93423 = zero_padding3D_layer(Up_79342, 1, 1, 1, 1, 1, 1, Zer93423), 
LMax72286 = maximum_layer([Zer11544,Zer93423], Max72286), 
exec_layers([LCon3354,LRes3778,LRes71538,LAve39634,LRes93977,LZer95286,LAdd26673,LCon43172,LAve83457,LDot92065,LRes53206,LRes53238,LGlo62357,LRes47384,LRes43066,LRes58661,LZer11544,LUp_79342,LZer93423,LMax72286],["Con3354","Res3778","Res71538","Ave39634","Res93977","Zer95286","Add26673","Con43172","Ave83457","Dot92065","Res53206","Res53238","Glo62357","Res47384","Res43066","Res58661","Zer11544","Up_79342","Zer93423","Max72286"],Max72286,"Max72286")

Actual (Unparsed): [[[[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [1.3329000], [1.3329000], [1.3969001], [1.3969001], [1.9762000], [1.9762000], [0.0000000]], [[0.0000000], [1.3329000], [1.3329000], [1.3969001], [1.3969001], [1.9762000], [1.9762000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.2997814]]]]]

Expected (Unparsed): [[[[[0],[0],[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0],[0],[0]]],[[[0],[0],[0],[0],[0],[0],[0],[0]],[[0],[1.3329],[1.3329],[1.3969],[1.3969],[1.9762],[1.9762],[0]],[[0],[1.3329],[1.3329],[1.3969],[1.3969],[1.9762],[1.9762],[0]],[[0],[0],[0],[0],[0],[0],[0],[0]]],[[[0],[0],[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0],[0],[0.29978136619650003]]]]]

Actual:   [[[[[0], [0], [0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0], [0], [0]]], [[[0], [0], [0], [0], [0], [0], [0], [0]], [[0], [1.3329], [1.3329], [1.397], [1.397], [1.9762], [1.9762], [0]], [[0], [1.3329], [1.3329], [1.397], [1.397], [1.9762], [1.9762], [0]], [[0], [0], [0], [0], [0], [0], [0], [0]]], [[[0], [0], [0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0], [0], [0.2998]]]]]

Expected: [[[[[0], [0], [0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0], [0], [0]]], [[[0], [0], [0], [0], [0], [0], [0], [0]], [[0], [1.3329], [1.3329], [1.3969], [1.3969], [1.9762], [1.9762], [0]], [[0], [1.3329], [1.3329], [1.3969], [1.3969], [1.9762], [1.9762], [0]], [[0], [0], [0], [0], [0], [0], [0], [0]]], [[[0], [0], [0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0], [0], [0.2998]]]]]