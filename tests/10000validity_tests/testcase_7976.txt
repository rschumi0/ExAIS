import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max46655 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Max46655 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Max73062 = tf.keras.layers.Input(shape=([2, 2]))
in1Max73062 = tf.keras.layers.Input(shape=([2, 2]))
in0Sub78674 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub78674 = tf.keras.layers.Input(shape=([2, 2]))

Max46655 = keras.layers.Maximum(name = 'Max46655', )([in0Max46655,in1Max46655])
Res33513 = keras.layers.Reshape((2, 2), name = 'Res33513', )(Max46655)
Max73062 = keras.layers.Maximum(name = 'Max73062', )([in0Max73062,in1Max73062])
Mul95053 = keras.layers.Multiply(name = 'Mul95053', )([Res33513,Max73062])
Res59155 = keras.layers.Reshape((2, 2, 1), name = 'Res59155', )(Mul95053)
Res86812 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res86812', )(Res59155)
Sub78674 = keras.layers.Subtract(name = 'Sub78674', )([in0Sub78674,in1Sub78674])
Res32069 = keras.layers.Reshape((2, 2, 1), name = 'Res32069', )(Sub78674)
Res73625 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res73625', )(Res32069)
Cro72706 = keras.layers.Cropping3D(cropping=((1, 0), (0, 1), (0, 0)), name = 'Cro72706', )(Res73625)
Zer792 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (0, 0)), name = 'Zer792', )(Cro72706)
Ave61385 = keras.layers.Average(name = 'Ave61385', )([Res86812,Zer792])
model = tf.keras.models.Model(inputs=[in0Max46655,in1Max46655,in0Max73062,in1Max73062,in0Sub78674,in1Sub78674], outputs=Ave61385)
in0Max46655 = tf.constant([[[[0.2858], [0.5257]], [[0.0451], [0.4005]]]])
in1Max46655 = tf.constant([[[[0.1026], [0.1571]], [[0.3784], [0.5463]]]])
in0Max73062 = tf.constant([[[0.8176, 0.6786], [0.3375, 0.3334]]])
in1Max73062 = tf.constant([[[0.5633, 0.0572], [0.2984, 0.3002]]])
in0Sub78674 = tf.constant([[[0.3047, 0.4098], [0.5463, 0.7243]]])
in1Sub78674 = tf.constant([[[0.9241, 0.3475], [0.0292, 0.1271]]])
print (np.array2string(model.predict([in0Max46655,in1Max46655,in0Max73062,in1Max73062,in0Sub78674,in1Sub78674],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave61385.png')

LMax46655 = maximum_layer([[[[[0.2858], [0.5257]], [[0.0451], [0.4005]]]], [[[[0.1026], [0.1571]], [[0.3784], [0.5463]]]]], Max46655), 
LRes33513 = reshape_layer(Max46655, [2, 2], Res33513), 
LMax73062 = maximum_layer([[[[0.8176, 0.6786], [0.3375, 0.3334]]], [[[0.5633, 0.0572], [0.2984, 0.3002]]]], Max73062), 
LMul95053 = multiply_layer([Res33513,Max73062], Mul95053), 
LRes59155 = reshape_layer(Mul95053, [2, 2, 1], Res59155), 
LRes86812 = reshape_layer(Res59155, [2, 2, 1, 1], Res86812), 
LSub78674 = subtract_layer([[[0.3047, 0.4098], [0.5463, 0.7243]]], [[[0.9241, 0.3475], [0.0292, 0.1271]]], Sub78674), 
LRes32069 = reshape_layer(Sub78674, [2, 2, 1], Res32069), 
LRes73625 = reshape_layer(Res32069, [2, 2, 1, 1], Res73625), 
LCro72706 = cropping3D_layer(Res73625, 1, 0, 0, 1, 0, 0, Cro72706), 
LZer792 = zero_padding3D_layer(Cro72706, 1, 0, 1, 0, 0, 0, Zer792), 
LAve61385 = average_layer([Res86812,Zer792], Ave61385), 
exec_layers([LMax46655,LRes33513,LMax73062,LMul95053,LRes59155,LRes86812,LSub78674,LRes32069,LRes73625,LCro72706,LZer792,LAve61385],["Max46655","Res33513","Max73062","Mul95053","Res59155","Res86812","Sub78674","Res32069","Res73625","Cro72706","Zer792","Ave61385"],Ave61385,"Ave61385")

Actual (Unparsed): [[[[[0.1168350]], [[0.1783700]]], [[[0.0638550]], [[0.3496182]]]]]

Expected (Unparsed): [[[[[0.11683504]],[[0.17837000999999997]]],[[[0.06385500000000001]],[[0.34961821]]]]]

Actual:   [[[[[0.1169]], [[0.1784]]], [[[0.0639]], [[0.3497]]]]]

Expected: [[[[[0.1169]], [[0.1784]]], [[[0.0639]], [[0.3497]]]]]