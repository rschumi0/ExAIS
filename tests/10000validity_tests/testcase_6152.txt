import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub22580 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Sub22580 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Con17982 = tf.keras.layers.Input(shape=([8, 1]))
in0Min13671 = tf.keras.layers.Input(shape=([1, 2]))
in1Min13671 = tf.keras.layers.Input(shape=([1, 2]))

Sub22580 = keras.layers.Subtract(name = 'Sub22580', )([in0Sub22580,in1Sub22580])
Res8642 = keras.layers.Reshape((2, 2, 4), name = 'Res8642', )(Sub22580)
Res47391 = keras.layers.Reshape((2, 8), name = 'Res47391', )(Res8642)
Glo71426 = keras.layers.GlobalMaxPool1D(name = 'Glo71426', )(Res47391)
Res55211 = keras.layers.Reshape((8, 1), name = 'Res55211', )(Glo71426)
Con17982 = keras.layers.Concatenate(axis=2, name = 'Con17982', )([Res55211,in0Con17982])
Min13671 = keras.layers.Minimum(name = 'Min13671', )([in0Min13671,in1Min13671])
Dot99452 = keras.layers.Dot(axes=(2, 2), name = 'Dot99452', )([Con17982,Min13671])
model = tf.keras.models.Model(inputs=[in0Sub22580,in1Sub22580,in0Con17982,in0Min13671,in1Min13671], outputs=Dot99452)
in0Sub22580 = tf.constant([[[[[0.9956, 0.7378], [0.9528, 0.668]], [[0.9525, 0.7356], [0.6644, 0.5387]]], [[[0.5499, 0.8309], [0.5679, 0.9671]], [[0.6928, 0.7185], [0.5745, 0.378]]]]])
in1Sub22580 = tf.constant([[[[[0.4596, 0.5932], [0.4946, 0.3069]], [[0.2917, 0.8404], [0.4233, 0.581]]], [[[0.5452, 0.1057], [0.5337, 0.3779]], [[0.2491, 0.9499], [0.8683, 0.8035]]]]])
in0Con17982 = tf.constant([[[0.4855], [0.7445], [0.0997], [0.2725], [0.8416], [0.3581], [0.7361], [0.0321]]])
in0Min13671 = tf.constant([[[0.6957, 0.5169]]])
in1Min13671 = tf.constant([[[0.7014, 0.1824]]])
print (np.array2string(model.predict([in0Sub22580,in1Sub22580,in0Con17982,in0Min13671,in1Min13671],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot99452.png')

LSub22580 = subtract_layer([[[[[0.9956, 0.7378], [0.9528, 0.668]], [[0.9525, 0.7356], [0.6644, 0.5387]]], [[[0.5499, 0.8309], [0.5679, 0.9671]], [[0.6928, 0.7185], [0.5745, 0.378]]]]], [[[[[0.4596, 0.5932], [0.4946, 0.3069]], [[0.2917, 0.8404], [0.4233, 0.581]]], [[[0.5452, 0.1057], [0.5337, 0.3779]], [[0.2491, 0.9499], [0.8683, 0.8035]]]]], Sub22580), 
LRes8642 = reshape_layer(Sub22580, [2, 2, 4], Res8642), 
LRes47391 = reshape_layer(Res8642, [2, 8], Res47391), 
LGlo71426 = global_max_pool1D_layer(Res47391, Glo71426), 
LRes55211 = reshape_layer(Glo71426, [8, 1], Res55211), 
LCon17982 = concatenate_layer([Res55211,[[[0.4855], [0.7445], [0.0997], [0.2725], [0.8416], [0.3581], [0.7361], [0.0321]]]], 2, Con17982), 
LMin13671 = minimum_layer([[[[0.6957, 0.5169]]], [[[0.7014, 0.1824]]]], Min13671), 
LDot99452 = dot_layer(Con17982,Min13671, 2, 2, Dot99452), 
exec_layers([LSub22580,LRes8642,LRes47391,LGlo71426,LRes55211,LCon17982,LMin13671,LDot99452],["Sub22580","Res8642","Res47391","Glo71426","Res55211","Con17982","Min13671","Dot99452"],Dot99452,"Dot99452")

Actual (Unparsed): [[[0.4614504], [0.6403184], [0.3369550], [0.4596105], [0.6132264], [-0.0075919], [0.3019979], [-0.0235731]]]

Expected (Unparsed): [[[0.46145040000000004],[0.64031844],[0.33695502],[0.45961043999999995],[0.6132264000000001],[-0.007591920000000002],[0.30199791],[-0.023573070000000005]]]

Actual:   [[[0.4615], [0.6404], [0.337], [0.4597], [0.6133], [-0.0075], [0.302], [-0.0235]]]

Expected: [[[0.4615], [0.6404], [0.337], [0.4597], [0.6133], [-0.0075], [0.302], [-0.0235]]]