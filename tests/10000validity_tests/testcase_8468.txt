import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul57358 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Mul57358 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Loc32611 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Sub42061 = tf.keras.layers.Input(shape=([2]))
in1Sub42061 = tf.keras.layers.Input(shape=([2]))
in0Con83141 = tf.keras.layers.Input(shape=([6]))
in0Min99737 = tf.keras.layers.Input(shape=([2, 1]))
in1Min99737 = tf.keras.layers.Input(shape=([2, 1]))

Mul57358 = keras.layers.Multiply(name = 'Mul57358', )([in0Mul57358,in1Mul57358])
Res56942 = keras.layers.Reshape((2, 2, 2), name = 'Res56942', )(Mul57358)
Loc32611 = keras.layers.LocallyConnected2D(2, (1, 1),strides=(1, 1), name = 'Loc32611', )(in0Loc32611)
Zer86241 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer86241', )(Loc32611)
Ave1458 = keras.layers.Average(name = 'Ave1458', )([Res56942,Zer86241])
Res99443 = keras.layers.Reshape((2, 4), name = 'Res99443', )(Ave1458)
Fla8157 = keras.layers.Flatten(name = 'Fla8157', )(Res99443)
Sub42061 = keras.layers.Subtract(name = 'Sub42061', )([in0Sub42061,in1Sub42061])
Con83141 = keras.layers.Concatenate(axis=1, name = 'Con83141', )([Sub42061,in0Con83141])
Mul90355 = keras.layers.Multiply(name = 'Mul90355', )([Fla8157,Con83141])
Res35586 = keras.layers.Reshape((8, 1), name = 'Res35586', )(Mul90355)
Min99737 = keras.layers.Minimum(name = 'Min99737', )([in0Min99737,in1Min99737])
Zer66349 = keras.layers.ZeroPadding1D(padding=((6, 0)), name = 'Zer66349', )(Min99737)
Ave1863 = keras.layers.Average(name = 'Ave1863', )([Res35586,Zer66349])
model = tf.keras.models.Model(inputs=[in0Mul57358,in1Mul57358,in0Loc32611,in0Sub42061,in1Sub42061,in0Con83141,in0Min99737,in1Min99737], outputs=Ave1863)
w = model.get_layer('Loc32611').get_weights() 
w[0] = np.array([[[0.9025, 0.856], [0.837, 0.5352]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc32611').set_weights(w) 
in0Mul57358 = tf.constant([[[[[0.446, 0.9009]], [[0.6239, 0.0587]]], [[[0.9754, 0.0694]], [[0.6862, 0.9879]]]]])
in1Mul57358 = tf.constant([[[[[0.3916, 0.781]], [[0.3498, 0.446]]], [[[0.6365, 0.892]], [[0.129, 0.6012]]]]])
in0Loc32611 = tf.constant([[[[0.0677, 0.1017]]]])
in0Sub42061 = tf.constant([[0.2333, 0.0525]])
in1Sub42061 = tf.constant([[0.6661, 0.5369]])
in0Con83141 = tf.constant([[0.6702, 0.2989, 0.5356, 0.5795, 0.0561, 0.5775]])
in0Min99737 = tf.constant([[[0.0469], [0.112]]])
in1Min99737 = tf.constant([[[0.5562], [0.5831]]])
print (np.array2string(model.predict([in0Mul57358,in1Mul57358,in0Loc32611,in0Sub42061,in1Sub42061,in0Con83141,in0Min99737,in1Min99737],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave1863.png')

LMul57358 = multiply_layer([[[[[[0.446, 0.9009]], [[0.6239, 0.0587]]], [[[0.9754, 0.0694]], [[0.6862, 0.9879]]]]], [[[[[0.3916, 0.781]], [[0.3498, 0.446]]], [[[0.6365, 0.892]], [[0.129, 0.6012]]]]]], Mul57358), 
LRes56942 = reshape_layer(Mul57358, [2, 2, 2], Res56942), 
LLoc32611 = locally_connected2D_layer([[[[0.0677, 0.1017]]]], 1, 1,[[[0.9025, 0.856], [0.837, 0.5352]]],[[[0, 0]]], 1, 1, Loc32611), 
LZer86241 = zero_padding2D_layer(Loc32611, 1, 0, 1, 0, Zer86241), 
LAve1458 = average_layer([Res56942,Zer86241], Ave1458), 
LRes99443 = reshape_layer(Ave1458, [2, 4], Res99443), 
LFla8157 = flatten_layer(Res99443, Fla8157), 
LSub42061 = subtract_layer([[0.2333, 0.0525]], [[0.6661, 0.5369]], Sub42061), 
LCon83141 = concatenate_layer([Sub42061,[[0.6702, 0.2989, 0.5356, 0.5795, 0.0561, 0.5775]]], 1, Con83141), 
LMul90355 = multiply_layer([Fla8157,Con83141], Mul90355), 
LRes35586 = reshape_layer(Mul90355, [8, 1], Res35586), 
LMin99737 = minimum_layer([[[[0.0469], [0.112]]], [[[0.5562], [0.5831]]]], Min99737), 
LZer66349 = zero_padding1D_layer(Min99737, 6, 0, Zer66349), 
LAve1863 = average_layer([Res35586,Zer66349], Ave1863), 
exec_layers([LMul57358,LRes56942,LLoc32611,LZer86241,LAve1458,LRes99443,LFla8157,LSub42061,LCon83141,LMul90355,LRes35586,LMin99737,LZer66349,LAve1863],["Mul57358","Res56942","Loc32611","Zer86241","Ave1458","Res99443","Fla8157","Sub42061","Con83141","Mul90355","Res35586","Min99737","Zer66349","Ave1863"],Ave1863,"Ave1863")

Actual (Unparsed): [[[-0.0188975], [-0.0852063], [0.0365661], [0.0019563], [0.0831308], [0.0089685], [0.0267423], [0.1579730]]]

Expected (Unparsed): [[[-0.01889751952],[-0.08520631119000001],[0.036566148861],[0.001956315445],[0.08313075718999999],[0.0089684579],[0.02674225584875],[0.157973003825]]]

Actual:   [[[-0.0188], [-0.0852], [0.0366], [0.002], [0.0832], [0.009], [0.0268], [0.158]]]

Expected: [[[-0.0188], [-0.0852], [0.0366], [0.002], [0.0832], [0.009], [0.0268], [0.158]]]