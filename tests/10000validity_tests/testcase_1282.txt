import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul27029 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul27029 = tf.keras.layers.Input(shape=([1, 1]))
in0Thr31874 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Ave12769 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Ave12769 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Mul35522 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Mul35522 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Glo96250 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Con78176 = tf.keras.layers.Input(shape=([3]))
in0Max1833 = tf.keras.layers.Input(shape=([2, 1]))
in1Max1833 = tf.keras.layers.Input(shape=([2, 1]))

Mul27029 = keras.layers.Multiply(name = 'Mul27029', )([in0Mul27029,in1Mul27029])
Res52402 = keras.layers.Reshape((1, 1, 1), name = 'Res52402', )(Mul27029)
Res53903 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res53903', )(Res52402)
Zer60676 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (0, 0)), name = 'Zer60676', )(Res53903)
Thr31874 = keras.layers.ThresholdedReLU(theta=7.608835436798843, name = 'Thr31874', input_shape=(2, 1, 1, 1))(in0Thr31874)
Max25048 = keras.layers.Maximum(name = 'Max25048', )([Zer60676,Thr31874])
Res80242 = keras.layers.Reshape((2, 1, 1), name = 'Res80242', )(Max25048)
Res90353 = keras.layers.Reshape((2, 1), name = 'Res90353', )(Res80242)
Ave12769 = keras.layers.Average(name = 'Ave12769', )([in0Ave12769,in1Ave12769])
Glo29617 = keras.layers.GlobalAveragePooling2D(name = 'Glo29617', )(Ave12769)
Res83005 = keras.layers.Reshape((2, 1), name = 'Res83005', )(Glo29617)
Zer75531 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer75531', )(Res83005)
Mul35522 = keras.layers.Multiply(name = 'Mul35522', )([in0Mul35522,in1Mul35522])
Res49294 = keras.layers.Reshape((1, 2, 2), name = 'Res49294', )(Mul35522)
Loc28988 = keras.layers.LocallyConnected2D(4, (1, 2),strides=(1, 1), name = 'Loc28988', )(Res49294)
Res53 = keras.layers.Reshape((1, 4), name = 'Res53', )(Loc28988)
Fla79352 = keras.layers.Flatten(name = 'Fla79352', )(Res53)
Glo96250 = keras.layers.GlobalAveragePooling3D(name = 'Glo96250', )(in0Glo96250)
Con78176 = keras.layers.Concatenate(axis=1, name = 'Con78176', )([Glo96250,in0Con78176])
Mul59764 = keras.layers.Multiply(name = 'Mul59764', )([Fla79352,Con78176])
Res46966 = keras.layers.Reshape((4, 1), name = 'Res46966', )(Mul59764)
Max1833 = keras.layers.Maximum(name = 'Max1833', )([in0Max1833,in1Max1833])
Zer31755 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer31755', )(Max1833)
Max97000 = keras.layers.Maximum(name = 'Max97000', )([Res46966,Zer31755])
Sub6058 = keras.layers.Subtract(name = 'Sub6058', )([Zer75531,Max97000])
Zer82792 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer82792', )(Sub6058)
Dot62787 = keras.layers.Dot(axes=(2, 2), name = 'Dot62787', )([Res90353,Zer82792])
model = tf.keras.models.Model(inputs=[in0Mul27029,in1Mul27029,in0Thr31874,in0Ave12769,in1Ave12769,in0Mul35522,in1Mul35522,in0Glo96250,in0Con78176,in0Max1833,in1Max1833], outputs=Dot62787)
w = model.get_layer('Loc28988').get_weights() 
w[0] = np.array([[[0.3152, 0.1087, 0.3953, 0.6086], [0.359, 0.3762, 0.1846, 0.1968], [0.7377, 0.1722, 0.6547, 0.3071], [0.3451, 0.0898, 0.7094, 0.2947]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc28988').set_weights(w) 
in0Mul27029 = tf.constant([[[0.9764]]])
in1Mul27029 = tf.constant([[[0.3133]]])
in0Thr31874 = tf.constant([[[[[0.0936]]], [[[0.6972]]]]])
in0Ave12769 = tf.constant([[[[0.2621, 0.0906]], [[0.7981, 0.1734]]]])
in1Ave12769 = tf.constant([[[[0.6066, 0.894]], [[0.0215, 0.7596]]]])
in0Mul35522 = tf.constant([[[[[0.2361], [0.5456]], [[0.365], [0.769]]]]])
in1Mul35522 = tf.constant([[[[[0.5959], [0.192]], [[0.6248], [0.8028]]]]])
in0Glo96250 = tf.constant([[[[[1.4762], [1.7591]], [[1.0696], [1.737]]], [[[1.2531], [1.7705]], [[1.0751], [1.7056]]]]])
in0Con78176 = tf.constant([[0.3741, 0.6627, 0.4308]])
in0Max1833 = tf.constant([[[0.4599], [0.7477]]])
in1Max1833 = tf.constant([[[0.1888], [0.6299]]])
print (np.array2string(model.predict([in0Mul27029,in1Mul27029,in0Thr31874,in0Ave12769,in1Ave12769,in0Mul35522,in1Mul35522,in0Glo96250,in0Con78176,in0Max1833,in1Max1833],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot62787.png')

LMul27029 = multiply_layer([[[[0.9764]]], [[[0.3133]]]], Mul27029), 
LRes52402 = reshape_layer(Mul27029, [1, 1, 1], Res52402), 
LRes53903 = reshape_layer(Res52402, [1, 1, 1, 1], Res53903), 
LZer60676 = zero_padding3D_layer(Res53903, 1, 0, 0, 0, 0, 0, Zer60676), 
LThr31874 = thresholded_relu_layer([[[[[0.0936]]], [[[0.6972]]]]], 7.608835436798843, Thr31874), 
LMax25048 = maximum_layer([Zer60676,Thr31874], Max25048), 
LRes80242 = reshape_layer(Max25048, [2, 1, 1], Res80242), 
LRes90353 = reshape_layer(Res80242, [2, 1], Res90353), 
LAve12769 = average_layer([[[[[0.2621, 0.0906]], [[0.7981, 0.1734]]]], [[[[0.6066, 0.894]], [[0.0215, 0.7596]]]]], Ave12769), 
LGlo29617 = global_average_pooling2D_layer(Ave12769, Glo29617), 
LRes83005 = reshape_layer(Glo29617, [2, 1], Res83005), 
LZer75531 = zero_padding1D_layer(Res83005, 2, 0, Zer75531), 
LMul35522 = multiply_layer([[[[[[0.2361], [0.5456]], [[0.365], [0.769]]]]], [[[[[0.5959], [0.192]], [[0.6248], [0.8028]]]]]], Mul35522), 
LRes49294 = reshape_layer(Mul35522, [1, 2, 2], Res49294), 
LLoc28988 = locally_connected2D_layer(Res49294, 1, 2,[[[0.3152, 0.1087, 0.3953, 0.6086], [0.359, 0.3762, 0.1846, 0.1968], [0.7377, 0.1722, 0.6547, 0.3071], [0.3451, 0.0898, 0.7094, 0.2947]]],[[[0, 0, 0, 0]]], 1, 1, Loc28988), 
LRes53 = reshape_layer(Loc28988, [1, 4], Res53), 
LFla79352 = flatten_layer(Res53, Fla79352), 
LGlo96250 = global_average_pooling3D_layer([[[[[1.4762], [1.7591]], [[1.0696], [1.737]]], [[[1.2531], [1.7705]], [[1.0751], [1.7056]]]]], Glo96250), 
LCon78176 = concatenate_layer([Glo96250,[[0.3741, 0.6627, 0.4308]]], 1, Con78176), 
LMul59764 = multiply_layer([Fla79352,Con78176], Mul59764), 
LRes46966 = reshape_layer(Mul59764, [4, 1], Res46966), 
LMax1833 = maximum_layer([[[[0.4599], [0.7477]]], [[[0.1888], [0.6299]]]], Max1833), 
LZer31755 = zero_padding1D_layer(Max1833, 2, 0, Zer31755), 
LMax97000 = maximum_layer([Res46966,Zer31755], Max97000), 
LSub6058 = subtract_layer(Zer75531,Max97000, Sub6058), 
LZer82792 = zero_padding1D_layer(Sub6058, 2, 0, Zer82792), 
LDot62787 = dot_layer(Res90353,Zer82792, 2, 2, Dot62787), 
exec_layers([LMul27029,LRes52402,LRes53903,LZer60676,LThr31874,LMax25048,LRes80242,LRes90353,LAve12769,LGlo29617,LRes83005,LZer75531,LMul35522,LRes49294,LLoc28988,LRes53,LFla79352,LGlo96250,LCon78176,LMul59764,LRes46966,LMax1833,LZer31755,LMax97000,LSub6058,LZer82792,LDot62787],["Mul27029","Res52402","Res53903","Zer60676","Thr31874","Max25048","Res80242","Res90353","Ave12769","Glo29617","Res83005","Zer75531","Mul35522","Res49294","Loc28988","Res53","Fla79352","Glo96250","Con78176","Mul59764","Res46966","Max1833","Zer31755","Max97000","Sub6058","Zer82792","Dot62787"],Dot62787,"Dot62787")

Actual (Unparsed): [[[0.0000000, 0.0000000, -0.0000000, -0.0000000, -0.0000000, -0.0000000], [0.0000000, 0.0000000, -0.2098357, -0.0170985, -0.0115709, -0.0820746]]]

Expected (Unparsed): [[[0,0,0.0,0.0,0.0,0.0],[0.0,0.0,-0.2098356804178077,-0.01709851676288033,-0.011570898989000001,-0.08207461199600001]]]

Actual:   [[[0, 0, -0, -0, -0, -0], [0, 0, -0.2098, -0.017, -0.0115, -0.082]]]

Expected: [[[0, 0, 0, 0, 0, 0], [0, 0, -0.2098, -0.017, -0.0115, -0.082]]]