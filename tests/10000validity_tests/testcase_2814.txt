import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc67120 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Add29873 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Add29873 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Ave60072 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con35875 = tf.keras.layers.Input(shape=([2, 2, 2]))

Loc67120 = keras.layers.LocallyConnected2D(4, (1, 1),strides=(1, 1), name = 'Loc67120', )(in0Loc67120)
Add29873 = keras.layers.Add(name = 'Add29873', )([in0Add29873,in1Add29873])
Res58117 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res58117', )(Add29873)
PRe74750 = keras.layers.PReLU(name = 'PRe74750', )(Res58117)
Res94002 = keras.layers.Reshape((1, 1, 2), name = 'Res94002', )(PRe74750)
Ave60072 = keras.layers.AveragePooling2D(pool_size=(2, 1), strides=(3, 4), padding='valid', name = 'Ave60072', )(in0Ave60072)
Ave87630 = keras.layers.Average(name = 'Ave87630', )([Res94002,Ave60072])
Zer17475 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer17475', )(Ave87630)
Con35875 = keras.layers.Concatenate(axis=3, name = 'Con35875', )([Zer17475,in0Con35875])
Sub7383 = keras.layers.Subtract(name = 'Sub7383', )([Loc67120,Con35875])
Zer29587 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer29587', )(Sub7383)
model = tf.keras.models.Model(inputs=[in0Loc67120,in0Add29873,in1Add29873,in0Ave60072,in0Con35875], outputs=Zer29587)
w = model.get_layer('Loc67120').get_weights() 
w[0] = np.array([[[0.9954, 0.6428, 0.3795, 0.0826]], [[0.1915, 0.4053, 0.0642, 0.2815]], [[0.5935, 0.0546, 0.9436, 0.7616]], [[0.8466, 0.5661, 0.8588, 0.8502]]])
w[1] = np.array([[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]]])
model.get_layer('Loc67120').set_weights(w) 
w = model.get_layer('PRe74750').get_weights() 
w[0] = np.array([[[[0.4245], [0.8869]]]])
model.get_layer('PRe74750').set_weights(w) 
in0Loc67120 = tf.constant([[[[0.4806], [0.4978]], [[0.9181], [0.0938]]]])
in0Add29873 = tf.constant([[[[0.6783, 0.5957]]]])
in1Add29873 = tf.constant([[[[0.1919, 0.2846]]]])
in0Ave60072 = tf.constant([[[[1.0781, 1.0981]], [[1.6894, 1.5105]]]])
in0Con35875 = tf.constant([[[[0.7229, 0.0644], [0.3646, 0.949]], [[0.3167, 0.8682], [0.9658, 0.1637]]]])
print (np.array2string(model.predict([in0Loc67120,in0Add29873,in1Add29873,in0Ave60072,in0Con35875],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Zer29587.png')

LLoc67120 = locally_connected2D_layer([[[[0.4806], [0.4978]], [[0.9181], [0.0938]]]], 1, 1,[[[0.9954, 0.6428, 0.3795, 0.0826]], [[0.1915, 0.4053, 0.0642, 0.2815]], [[0.5935, 0.0546, 0.9436, 0.7616]], [[0.8466, 0.5661, 0.8588, 0.8502]]],[[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]]], 1, 1, Loc67120), 
LAdd29873 = add_layer([[[[[0.6783, 0.5957]]]], [[[[0.1919, 0.2846]]]]], Add29873), 
LRes58117 = reshape_layer(Add29873, [1, 1, 2, 1], Res58117), 
LPRe74750 = prelu_layer(Res58117, [[[[0.4245], [0.8869]]]], PRe74750), 
LRes94002 = reshape_layer(PRe74750, [1, 1, 2], Res94002), 
LAve60072 = average_pooling2D_layer([[[[1.0781, 1.0981]], [[1.6894, 1.5105]]]], 2, 1, 3, 4, false, Ave60072), 
LAve87630 = average_layer([Res94002,Ave60072], Ave87630), 
LZer17475 = zero_padding2D_layer(Ave87630, 1, 0, 1, 0, Zer17475), 
LCon35875 = concatenate_layer([Zer17475,[[[[0.7229, 0.0644], [0.3646, 0.949]], [[0.3167, 0.8682], [0.9658, 0.1637]]]]], 3, Con35875), 
LSub7383 = subtract_layer(Loc67120,Con35875, Sub7383), 
LZer29587 = zero_padding2D_layer(Sub7383, 1, 1, 1, 1, Zer29587), 
exec_layers([LLoc67120,LAdd29873,LRes58117,LPRe74750,LRes94002,LAve60072,LAve87630,LZer17475,LCon35875,LSub7383,LZer29587],["Loc67120","Add29873","Res58117","PRe74750","Res94002","Ave60072","Ave87630","Zer17475","Con35875","Sub7383","Zer29587"],Zer29587,"Zer29587")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.4783892, 0.3089297, -0.5405123, -0.0247024], [0.0953287, 0.2017583, -0.3326412, -0.8088693], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.5448923, 0.0501283, 0.5496191, -0.1689750], [-1.0475639, -1.0391998, -0.8852445, -0.0839512], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]]]]

Expected (Unparsed): [[[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],[[0,0,0,0],[0.47838924,0.30892968000000004,-0.5405123,-0.024702439999999992],[0.0953287,0.20175834,-0.33264124,-0.8088693],[0,0,0,0]],[[0,0,0,0],[0.54489235,0.05012826,0.54961916,-0.16897503999999985],[-1.04756392,-1.03919982,-0.88524456,-0.08395124000000002],[0,0,0,0]],[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]]]

Actual:   [[[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0.4784, 0.309, -0.5405, -0.0247], [0.0954, 0.2018, -0.3326, -0.8088], [0, 0, 0, 0]], [[0, 0, 0, 0], [0.5449, 0.0502, 0.5497, -0.1689], [-1.0475, -1.0391, -0.8852, -0.0839], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]]]

Expected: [[[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0.4784, 0.309, -0.5405, -0.0247], [0.0954, 0.2018, -0.3326, -0.8088], [0, 0, 0, 0]], [[0, 0, 0, 0], [0.5449, 0.0502, 0.5497, -0.1689], [-1.0475, -1.0391, -0.8852, -0.0839], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]]]