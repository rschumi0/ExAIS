import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max34618 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Max34618 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con59786 = tf.keras.layers.Input(shape=([2, 4, 2]))
in0Max59177 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Max59177 = tf.keras.layers.Input(shape=([1, 2, 1]))

Max34618 = keras.layers.Maximum(name = 'Max34618', )([in0Max34618,in1Max34618])
Zer50808 = keras.layers.ZeroPadding2D(padding=((0, 0), (3, 0)), name = 'Zer50808', )(Max34618)
Con59786 = keras.layers.Concatenate(axis=3, name = 'Con59786', )([Zer50808,in0Con59786])
Max59177 = keras.layers.Maximum(name = 'Max59177', )([in0Max59177,in1Max59177])
Zer95215 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer95215', )(Max59177)
Con51502 = keras.layers.Conv2D(4, (2, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con51502', )(Zer95215)
Sub5177 = keras.layers.Subtract(name = 'Sub5177', )([Con59786,Con51502])
Res83024 = keras.layers.Reshape((2, 16), name = 'Res83024', )(Sub5177)
Glo91 = keras.layers.GlobalAveragePooling1D(name = 'Glo91', )(Res83024)
model = tf.keras.models.Model(inputs=[in0Max34618,in1Max34618,in0Con59786,in0Max59177,in1Max59177], outputs=Glo91)
w = model.get_layer('Con51502').get_weights() 
w[0] = np.array([[[[0.2952, 0.7894, 0.2652, 0.7424]]], [[[0.5811, 0.1564, 0.2409, 0.2594]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con51502').set_weights(w) 
in0Max34618 = tf.constant([[[[0.0963, 0.3428]], [[0.8613, 0.0446]]]])
in1Max34618 = tf.constant([[[[0.6793, 0.6713]], [[0.1377, 0.0904]]]])
in0Con59786 = tf.constant([[[[0.5654, 0.9381], [0.4646, 0.9954], [0.4126, 0.9948], [0.3811, 0.9127]], [[0.4611, 0.8848], [0.199, 0.8813], [0.507, 0.6702], [0.9558, 0.1651]]]])
in0Max59177 = tf.constant([[[[0.171], [0.4873]]]])
in1Max59177 = tf.constant([[[[0.2839], [0.571]]]])
print (np.array2string(model.predict([in0Max34618,in1Max34618,in0Con59786,in0Max59177,in1Max59177],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo91.png')

LMax34618 = maximum_layer([[[[[0.0963, 0.3428]], [[0.8613, 0.0446]]]], [[[[0.6793, 0.6713]], [[0.1377, 0.0904]]]]], Max34618), 
LZer50808 = zero_padding2D_layer(Max34618, 0, 0, 3, 0, Zer50808), 
LCon59786 = concatenate_layer([Zer50808,[[[[0.5654, 0.9381], [0.4646, 0.9954], [0.4126, 0.9948], [0.3811, 0.9127]], [[0.4611, 0.8848], [0.199, 0.8813], [0.507, 0.6702], [0.9558, 0.1651]]]]], 3, Con59786), 
LMax59177 = maximum_layer([[[[[0.171], [0.4873]]]], [[[[0.2839], [0.571]]]]], Max59177), 
LZer95215 = zero_padding2D_layer(Max59177, 1, 1, 1, 1, Zer95215), 
LCon51502 = conv2D_layer(Zer95215, 2, 1,[[[[0.2952, 0.7894, 0.2652, 0.7424]]], [[[0.5811, 0.1564, 0.2409, 0.2594]]]],[0, 0, 0, 0], 1, 1, false, 1, 1, Con51502), 
LSub5177 = subtract_layer(Con59786,Con51502, Sub5177), 
LRes83024 = reshape_layer(Sub5177, [2, 16], Res83024), 
LGlo91 = global_average_pooling1D_layer(Res83024, Glo91), 
exec_layers([LMax34618,LZer50808,LCon59786,LMax59177,LZer95215,LCon51502,LSub5177,LRes83024,LGlo91],["Max34618","Zer50808","Con59786","Max59177","Zer95215","Con51502","Sub5177","Res83024","Glo91"],Glo91,"Glo91")

Actual (Unparsed): [[0.0000000, 0.0000000, 0.5132500, 0.9114500, -0.1243908, -0.1342563, 0.2599591, 0.7961445, -0.2501836, -0.2700259, 0.3153085, 0.5464861, 0.7703000, 0.3808500, 0.6684500, 0.5389000]]

Expected (Unparsed): [[0.0,0.0,0.51325,0.9114500000000001,-0.12439078499999998,-0.13425631,0.259959105,0.79614449,-0.25018365,-0.2700259,0.3153084500000001,0.5464861000000001,0.7703,0.38085,0.66845,0.5388999999999999]]

Actual:   [[0, 0, 0.5133, 0.9115, -0.1243, -0.1342, 0.26, 0.7962, -0.2501, -0.27, 0.3154, 0.5465, 0.7703, 0.3809, 0.6685, 0.5389]]

Expected: [[0, 0, 0.5133, 0.9115, -0.1243, -0.1342, 0.26, 0.7962, -0.2501, -0.27, 0.3154, 0.5465, 0.7703, 0.3809, 0.6685, 0.5389]]