import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave6941 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Ave6941 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Dot31505 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot31505 = tf.keras.layers.Input(shape=([3, 2]))
in0Con72658 = tf.keras.layers.Input(shape=([3]))

Ave6941 = keras.layers.Average(name = 'Ave6941', )([in0Ave6941,in1Ave6941])
Res51643 = keras.layers.Reshape((2, 2), name = 'Res51643', )(Ave6941)
Fla9426 = keras.layers.Flatten(name = 'Fla9426', )(Res51643)
Dot31505 = keras.layers.Dot(axes=(1, 1), name = 'Dot31505', )([in0Dot31505,in1Dot31505])
Den4831 = keras.layers.Dense(1,name = 'Den4831', )(Dot31505)
Res52515 = keras.layers.Reshape((2, 1, 1), name = 'Res52515', )(Den4831)
Glo47287 = keras.layers.GlobalAveragePooling2D(name = 'Glo47287', )(Res52515)
Con72658 = keras.layers.Concatenate(axis=1, name = 'Con72658', )([Glo47287,in0Con72658])
Sub71839 = keras.layers.Subtract(name = 'Sub71839', )([Fla9426,Con72658])
Res5997 = keras.layers.Reshape((4, 1), name = 'Res5997', )(Sub71839)
PRe16162 = keras.layers.PReLU(name = 'PRe16162', )(Res5997)
model = tf.keras.models.Model(inputs=[in0Ave6941,in1Ave6941,in0Dot31505,in1Dot31505,in0Con72658], outputs=PRe16162)
w = model.get_layer('Den4831').get_weights() 
w[0] = np.array([[0.181], [0.8585]])
w[1] = np.array([0.225])
model.get_layer('Den4831').set_weights(w) 
w = model.get_layer('PRe16162').get_weights() 
w[0] = np.array([[0.9515], [0.1972], [0.7154], [0.5705]])
model.get_layer('PRe16162').set_weights(w) 
in0Ave6941 = tf.constant([[[[0.0722, 0.1466]], [[0.516, 0.4371]]]])
in1Ave6941 = tf.constant([[[[0.534, 0.4034]], [[0.173, 0.4711]]]])
in0Dot31505 = tf.constant([[[0.5041, 0.3365], [0.7494, 0.2196], [0.1984, 0.372]]])
in1Dot31505 = tf.constant([[[0.2762, 0.2093], [0.1267, 0.497], [0.3415, 0.9394]]])
in0Con72658 = tf.constant([[0.9639, 0.1557, 0.0365]])
print (np.array2string(model.predict([in0Ave6941,in1Ave6941,in0Dot31505,in1Dot31505,in0Con72658],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='PRe16162.png')

LAve6941 = average_layer([[[[[0.0722, 0.1466]], [[0.516, 0.4371]]]], [[[[0.534, 0.4034]], [[0.173, 0.4711]]]]], Ave6941), 
LRes51643 = reshape_layer(Ave6941, [2, 2], Res51643), 
LFla9426 = flatten_layer(Res51643, Fla9426), 
LDot31505 = dot_layer([[[0.5041, 0.3365], [0.7494, 0.2196], [0.1984, 0.372]]], [[[0.2762, 0.2093], [0.1267, 0.497], [0.3415, 0.9394]]], 1, 1, Dot31505), 
LDen4831 = dense_layer(Dot31505, [[0.181], [0.8585]],[0.225], Den4831), 
LRes52515 = reshape_layer(Den4831, [2, 1, 1], Res52515), 
LGlo47287 = global_average_pooling2D_layer(Res52515, Glo47287), 
LCon72658 = concatenate_layer([Glo47287,[[0.9639, 0.1557, 0.0365]]], 1, Con72658), 
LSub71839 = subtract_layer(Fla9426,Con72658, Sub71839), 
LRes5997 = reshape_layer(Sub71839, [4, 1], Res5997), 
LPRe16162 = prelu_layer(Res5997, [[0.9515], [0.1972], [0.7154], [0.5705]], PRe16162), 
exec_layers([LAve6941,LRes51643,LFla9426,LDot31505,LDen4831,LRes52515,LGlo47287,LCon72658,LSub71839,LRes5997,LPRe16162],["Ave6941","Res51643","Fla9426","Dot31505","Den4831","Res52515","Glo47287","Con72658","Sub71839","Res5997","PRe16162"],PRe16162,"PRe16162")

Actual (Unparsed): [[[-0.4604336], [-0.1358511], [0.1888000], [0.4176000]]]

Expected (Unparsed): [[[-0.46043360702358255],[-0.13585107999999999],[0.18880000000000002],[0.4176]]]

Actual:   [[[-0.4604], [-0.1358], [0.1888], [0.4176]]]

Expected: [[[-0.4604], [-0.1358], [0.1889], [0.4176]]]