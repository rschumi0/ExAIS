import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Zer13823 = tf.keras.layers.Input(shape=([4, 2]))
in0Con91098 = tf.keras.layers.Input(shape=([6, 2, 1, 1]))
in0Max84352 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Max84352 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in0Dot89489 = tf.keras.layers.Input(shape=([2]))
in1Dot89489 = tf.keras.layers.Input(shape=([2]))

Zer13823 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer13823', )(in0Zer13823)
Res99400 = keras.layers.Reshape((6, 2, 1), name = 'Res99400', )(Zer13823)
Res45184 = keras.layers.Reshape((6, 2, 1, 1), name = 'Res45184', )(Res99400)
Con91098 = keras.layers.Concatenate(axis=4, name = 'Con91098', )([Res45184,in0Con91098])
Max84352 = keras.layers.Maximum(name = 'Max84352', )([in0Max84352,in1Max84352])
Zer41618 = keras.layers.ZeroPadding3D(padding=((5, 0), (1, 0), (0, 0)), name = 'Zer41618', )(Max84352)
Min94969 = keras.layers.Minimum(name = 'Min94969', )([Con91098,Zer41618])
Res8818 = keras.layers.Reshape((6, 2, 2), name = 'Res8818', )(Min94969)
Loc55082 = keras.layers.LocallyConnected2D(4, (5, 1),strides=(1, 1), name = 'Loc55082', )(Res8818)
Res83344 = keras.layers.Reshape((2, 2, 4, 1), name = 'Res83344', )(Loc55082)
Glo70434 = keras.layers.GlobalMaxPool3D(name = 'Glo70434', )(Res83344)
Dot89489 = keras.layers.Dot(axes=(1, 1), name = 'Dot89489', )([in0Dot89489,in1Dot89489])
Max65417 = keras.layers.Maximum(name = 'Max65417', )([Glo70434,Dot89489])
model = tf.keras.models.Model(inputs=[in0Zer13823,in0Con91098,in0Max84352,in1Max84352,in0Dot89489,in1Dot89489], outputs=Max65417)
w = model.get_layer('Loc55082').get_weights() 
w[0] = np.array([[[0.2962, 0.2435, 0.8821, 0.3568], [0.1977, 0.0474, 0.3641, 0.6943], [0.1671, 0.4565, 0.9318, 0.8179], [0.995, 0.5556, 0.7258, 0.6477], [0.3074, 0.2952, 0.9674, 0.8745], [0.5048, 0.8637, 0.3303, 0.3741], [0.6931, 0.1373, 0.7357, 0.5757], [0.7899, 0.8434, 0.2289, 0.5533], [0.9182, 0.8835, 0.1039, 0.1251], [0.5309, 0.7265, 0.8498, 0.9141]], [[0.4514, 0.9055, 0.8126, 0.146], [0.1564, 0.4308, 0.6896, 0.9464], [0.1847, 0.3639, 0.1022, 0.0324], [0.5091, 0.891, 0.5295, 0.9901], [0.0738, 0.9786, 0.8286, 0.7805], [0.4735, 0.1006, 0.4145, 0.7198], [0.9212, 0.5822, 0.9283, 0.9451], [0.2404, 0.8238, 0.8836, 0.296], [0.6034, 0.0408, 0.3481, 0.6146], [0.1337, 0.1816, 0.1902, 0.7016]], [[0.2923, 0.3715, 0.8029, 0.551], [0.1765, 0.5722, 0.4997, 0.0326], [0.4718, 0.141, 0.9733, 0.8874], [0.8214, 0.6305, 0.3035, 0.764], [0.8006, 0.4757, 0.0078, 0.0289], [0.5207, 0.1844, 0.5375, 0.2596], [0.1215, 0.2661, 0.4419, 0.6507], [0.0625, 0.4154, 0.1431, 0.0445], [0.1684, 0.3978, 0.8983, 0.9385], [0.8491, 0.68, 0.0591, 0.6116]], [[0.772, 0.09, 0.1806, 0.4654], [0.542, 0.6991, 0.8835, 0.7802], [0.6138, 0.6748, 0.624, 0.3495], [0.7511, 0.0721, 0.6916, 0.8764], [0.8311, 0.3987, 0.8169, 0.5875], [0.6922, 0.3237, 0.7513, 0.2558], [0.0216, 0.078, 0.0555, 0.7081], [0.9896, 0.9393, 0.1216, 0.937], [0.4504, 0.691, 0.1466, 0.1407], [0.0498, 0.0962, 0.3734, 0.3654]]])
w[1] = np.array([[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]]])
model.get_layer('Loc55082').set_weights(w) 
in0Zer13823 = tf.constant([[[1.3474, 1.9371], [1.1939, 1.9667], [1.5966, 1.9692], [1.5593, 1.8283]]])
in0Con91098 = tf.constant([[[[[0.5251]], [[0.4111]]], [[[0.9883]], [[0.1674]]], [[[0.828]], [[0.2456]]], [[[0.8806]], [[0.09]]], [[[0.7212]], [[0.5529]]], [[[0.8884]], [[0.292]]]]])
in0Max84352 = tf.constant([[[[[0.323, 0.1043]]]]])
in1Max84352 = tf.constant([[[[[0.3702, 0.8104]]]]])
in0Dot89489 = tf.constant([[0.4499, 0.6945]])
in1Dot89489 = tf.constant([[0.6775, 0.5469]])
print (np.array2string(model.predict([in0Zer13823,in0Con91098,in0Max84352,in1Max84352,in0Dot89489,in1Dot89489],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max65417.png')

LZer13823 = zero_padding1D_layer([[[1.3474, 1.9371], [1.1939, 1.9667], [1.5966, 1.9692], [1.5593, 1.8283]]], 1, 1, Zer13823), 
LRes99400 = reshape_layer(Zer13823, [6, 2, 1], Res99400), 
LRes45184 = reshape_layer(Res99400, [6, 2, 1, 1], Res45184), 
LCon91098 = concatenate_layer([Res45184,[[[[[0.5251]], [[0.4111]]], [[[0.9883]], [[0.1674]]], [[[0.828]], [[0.2456]]], [[[0.8806]], [[0.09]]], [[[0.7212]], [[0.5529]]], [[[0.8884]], [[0.292]]]]]], 4, Con91098), 
LMax84352 = maximum_layer([[[[[[0.323, 0.1043]]]]], [[[[[0.3702, 0.8104]]]]]], Max84352), 
LZer41618 = zero_padding3D_layer(Max84352, 5, 0, 1, 0, 0, 0, Zer41618), 
LMin94969 = minimum_layer([Con91098,Zer41618], Min94969), 
LRes8818 = reshape_layer(Min94969, [6, 2, 2], Res8818), 
LLoc55082 = locally_connected2D_layer(Res8818, 5, 1,[[[0.2962, 0.2435, 0.8821, 0.3568], [0.1977, 0.0474, 0.3641, 0.6943], [0.1671, 0.4565, 0.9318, 0.8179], [0.995, 0.5556, 0.7258, 0.6477], [0.3074, 0.2952, 0.9674, 0.8745], [0.5048, 0.8637, 0.3303, 0.3741], [0.6931, 0.1373, 0.7357, 0.5757], [0.7899, 0.8434, 0.2289, 0.5533], [0.9182, 0.8835, 0.1039, 0.1251], [0.5309, 0.7265, 0.8498, 0.9141]], [[0.4514, 0.9055, 0.8126, 0.146], [0.1564, 0.4308, 0.6896, 0.9464], [0.1847, 0.3639, 0.1022, 0.0324], [0.5091, 0.891, 0.5295, 0.9901], [0.0738, 0.9786, 0.8286, 0.7805], [0.4735, 0.1006, 0.4145, 0.7198], [0.9212, 0.5822, 0.9283, 0.9451], [0.2404, 0.8238, 0.8836, 0.296], [0.6034, 0.0408, 0.3481, 0.6146], [0.1337, 0.1816, 0.1902, 0.7016]], [[0.2923, 0.3715, 0.8029, 0.551], [0.1765, 0.5722, 0.4997, 0.0326], [0.4718, 0.141, 0.9733, 0.8874], [0.8214, 0.6305, 0.3035, 0.764], [0.8006, 0.4757, 0.0078, 0.0289], [0.5207, 0.1844, 0.5375, 0.2596], [0.1215, 0.2661, 0.4419, 0.6507], [0.0625, 0.4154, 0.1431, 0.0445], [0.1684, 0.3978, 0.8983, 0.9385], [0.8491, 0.68, 0.0591, 0.6116]], [[0.772, 0.09, 0.1806, 0.4654], [0.542, 0.6991, 0.8835, 0.7802], [0.6138, 0.6748, 0.624, 0.3495], [0.7511, 0.0721, 0.6916, 0.8764], [0.8311, 0.3987, 0.8169, 0.5875], [0.6922, 0.3237, 0.7513, 0.2558], [0.0216, 0.078, 0.0555, 0.7081], [0.9896, 0.9393, 0.1216, 0.937], [0.4504, 0.691, 0.1466, 0.1407], [0.0498, 0.0962, 0.3734, 0.3654]]],[[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]]], 1, 1, Loc55082), 
LRes83344 = reshape_layer(Loc55082, [2, 2, 4, 1], Res83344), 
LGlo70434 = global_max_pool3D_layer(Res83344, Glo70434), 
LDot89489 = dot_layer([[0.4499, 0.6945]], [[0.6775, 0.5469]], 1, 1, Dot89489), 
LMax65417 = maximum_layer([Glo70434,Dot89489], Max65417), 
exec_layers([LZer13823,LRes99400,LRes45184,LCon91098,LMax84352,LZer41618,LMin94969,LRes8818,LLoc55082,LRes83344,LGlo70434,LDot89489,LMax65417],["Zer13823","Res99400","Res45184","Con91098","Max84352","Zer41618","Min94969","Res8818","Loc55082","Res83344","Glo70434","Dot89489","Max65417"],Max65417,"Max65417")

Actual (Unparsed): [[0.6846293]]

Expected (Unparsed): [[0.6846293000000001]]

Actual:   [[0.6847]]

Expected: [[0.6847]]