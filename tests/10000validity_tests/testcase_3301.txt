import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo55401 = tf.keras.layers.Input(shape=([1, 2]))
in0Con85092 = tf.keras.layers.Input(shape=([10, 1]))
in0ReL42109 = tf.keras.layers.Input(shape=([2, 2, 2]))

Glo55401 = keras.layers.GlobalMaxPool1D(name = 'Glo55401', )(in0Glo55401)
Res91827 = keras.layers.Reshape((2, 1), name = 'Res91827', )(Glo55401)
Per58844 = keras.layers.Permute((2,1), name = 'Per58844',)(Res91827)
Zer63038 = keras.layers.ZeroPadding1D(padding=((9, 0)), name = 'Zer63038', )(Per58844)
Con85092 = keras.layers.Concatenate(axis=2, name = 'Con85092', )([Zer63038,in0Con85092])
ReL42109 = keras.layers.ReLU(max_value=1.5813263558455255, negative_slope=5.04290811273517, threshold=9.914318133451268, name = 'ReL42109', input_shape=(2, 2, 2))(in0ReL42109)
Fla27621 = keras.layers.Flatten(name = 'Fla27621', )(ReL42109)
Res43244 = keras.layers.Reshape((8, 1), name = 'Res43244', )(Fla27621)
Zer84217 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer84217', )(Res43244)
Con91501 = keras.layers.Conv1D(3, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con91501', )(Zer84217)
Min32849 = keras.layers.Minimum(name = 'Min32849', )([Con85092,Con91501])
Res56685 = keras.layers.Reshape((10, 3, 1), name = 'Res56685', )(Min32849)
Loc38919 = keras.layers.LocallyConnected2D(2, (9, 3),strides=(1, 1), name = 'Loc38919', )(Res56685)
model = tf.keras.models.Model(inputs=[in0Glo55401,in0Con85092,in0ReL42109], outputs=Loc38919)
w = model.get_layer('Con91501').get_weights() 
w[0] = np.array([[[0.9438, 0.6488, 0.0085]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con91501').set_weights(w) 
w = model.get_layer('Loc38919').get_weights() 
w[0] = np.array([[[0.5221, 0.6734], [0.5358, 0.9537], [0.4047, 0.7753], [0.5721, 0.4873], [0.1044, 0.3678], [0.6852, 0.3548], [0.6046, 0.0761], [0.4387, 0.1355], [0.6626, 0.9382], [0.0005, 0.3616], [0.4409, 0.1353], [0.7403, 0.0059], [0.9787, 0.2454], [0.5532, 0.2168], [0.514, 0.933], [0.6197, 0.5238], [0.0704, 0.429], [0.8487, 0.9412], [0.6492, 0.373], [0.825, 0.8832], [0.8336, 0.5909], [0.6832, 0.5689], [0.6021, 0.1649], [0.9636, 0.6455], [0.6727, 0.7132], [0.1717, 0.0857], [0.7565, 0.1453]], [[0.4595, 0.0261], [0.6866, 0.2814], [0.5724, 0.1054], [0.5028, 0.6341], [0.9666, 0.0323], [0.2268, 0.3371], [0.7901, 0.5706], [0.2407, 0.6763], [0.243, 0.8599], [0.8923, 0.9314], [0.6847, 0.0111], [0.1974, 0.2635], [0.7392, 0.2103], [0.2804, 0.2032], [0.5654, 0.1466], [0.5015, 0.8857], [0.4051, 0.4376], [0.0572, 0.5535], [0.4988, 0.8686], [0.2048, 0.01], [0.4691, 0.686], [0.1663, 0.6394], [0.3099, 0.8858], [0.1935, 0.3329], [0.1931, 0.4278], [0.2404, 0.1601], [0.4047, 0.5694]]])
w[1] = np.array([[[0, 0]], [[0, 0]]])
model.get_layer('Loc38919').set_weights(w) 
in0Glo55401 = tf.constant([[[1.0186, 1.4876]]])
in0Con85092 = tf.constant([[[0.5292], [0.6777], [0.8646], [0.0983], [0.0296], [0.0168], [0.2759], [0.1882], [0.3229], [0.4349]]])
in0ReL42109 = tf.constant([[[[0.3244, 0.2806], [0.7921, 0.2205]], [[0.3705, 0.3691], [0.1225, 0.8175]]]])
print (np.array2string(model.predict([in0Glo55401,in0Con85092,in0ReL42109],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc38919.png')

LGlo55401 = global_max_pool1D_layer([[[1.0186, 1.4876]]], Glo55401), 
LRes91827 = reshape_layer(Glo55401, [2, 1], Res91827), 
LPer58844 = permute_layer(Res91827, 2,1, Per58844), 
LZer63038 = zero_padding1D_layer(Per58844, 9, 0, Zer63038), 
LCon85092 = concatenate_layer([Zer63038,[[[0.5292], [0.6777], [0.8646], [0.0983], [0.0296], [0.0168], [0.2759], [0.1882], [0.3229], [0.4349]]]], 2, Con85092), 
LReL42109 = relu_layer([[[[0.3244, 0.2806], [0.7921, 0.2205]], [[0.3705, 0.3691], [0.1225, 0.8175]]]], 1.5813263558455255, 5.04290811273517, 9.914318133451268, ReL42109), 
LFla27621 = flatten_layer(ReL42109, Fla27621), 
LRes43244 = reshape_layer(Fla27621, [8, 1], Res43244), 
LZer84217 = zero_padding1D_layer(Res43244, 1, 1, Zer84217), 
LCon91501 = conv1D_layer(Zer84217, 1,[[[0.9438, 0.6488, 0.0085]]],[0, 0, 0], 1, true, 1, Con91501), 
LMin32849 = minimum_layer([Con85092,Con91501], Min32849), 
LRes56685 = reshape_layer(Min32849, [10, 3, 1], Res56685), 
LLoc38919 = locally_connected2D_layer(Res56685, 9, 3,[[[0.5221, 0.6734], [0.5358, 0.9537], [0.4047, 0.7753], [0.5721, 0.4873], [0.1044, 0.3678], [0.6852, 0.3548], [0.6046, 0.0761], [0.4387, 0.1355], [0.6626, 0.9382], [0.0005, 0.3616], [0.4409, 0.1353], [0.7403, 0.0059], [0.9787, 0.2454], [0.5532, 0.2168], [0.514, 0.933], [0.6197, 0.5238], [0.0704, 0.429], [0.8487, 0.9412], [0.6492, 0.373], [0.825, 0.8832], [0.8336, 0.5909], [0.6832, 0.5689], [0.6021, 0.1649], [0.9636, 0.6455], [0.6727, 0.7132], [0.1717, 0.0857], [0.7565, 0.1453]], [[0.4595, 0.0261], [0.6866, 0.2814], [0.5724, 0.1054], [0.5028, 0.6341], [0.9666, 0.0323], [0.2268, 0.3371], [0.7901, 0.5706], [0.2407, 0.6763], [0.243, 0.8599], [0.8923, 0.9314], [0.6847, 0.0111], [0.1974, 0.2635], [0.7392, 0.2103], [0.2804, 0.2032], [0.5654, 0.1466], [0.5015, 0.8857], [0.4051, 0.4376], [0.0572, 0.5535], [0.4988, 0.8686], [0.2048, 0.01], [0.4691, 0.686], [0.1663, 0.6394], [0.3099, 0.8858], [0.1935, 0.3329], [0.1931, 0.4278], [0.2404, 0.1601], [0.4047, 0.5694]]],[[[0, 0]], [[0, 0]]], 1, 1, Loc38919), 
exec_layers([LGlo55401,LRes91827,LPer58844,LZer63038,LCon85092,LReL42109,LFla27621,LRes43244,LZer84217,LCon91501,LMin32849,LRes56685,LLoc38919],["Glo55401","Res91827","Per58844","Zer63038","Con85092","ReL42109","Fla27621","Res43244","Zer84217","Con91501","Min32849","Res56685","Loc38919"],Loc38919,"Loc38919")

Actual (Unparsed): [[[[-320.2368031, -228.2991664]], [[-325.4426571, -294.3800025]]]]

Expected (Unparsed): [[[[-320.23680320700583,-228.29916650573384]],[[-325.44265729242164,-294.3800026403892]]]]

Actual:   [[[[-320.2368, -228.2991]], [[-325.4426, -294.38]]]]

Expected: [[[[-320.2368, -228.2991]], [[-325.4426, -294.38]]]]