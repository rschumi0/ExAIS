import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con75567 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0PRe9052 = tf.keras.layers.Input(shape=([1, 1]))
in0Con23476 = tf.keras.layers.Input(shape=([3]))
in0Glo49360 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con22307 = tf.keras.layers.Input(shape=([3]))

Con75567 = keras.layers.Conv3D(2, (1, 2, 2),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con75567', )(in0Con75567)
Res43071 = keras.layers.Reshape((2, 1, 2), name = 'Res43071', )(Con75567)
Res28821 = keras.layers.Reshape((2, 2), name = 'Res28821', )(Res43071)
Fla99744 = keras.layers.Flatten(name = 'Fla99744', )(Res28821)
PRe9052 = keras.layers.PReLU(name = 'PRe9052', input_shape=(1, 1))(in0PRe9052)
Res96527 = keras.layers.Reshape((1, 1, 1), name = 'Res96527', )(PRe9052)
Res18037 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res18037', )(Res96527)
Glo45661 = keras.layers.GlobalAveragePooling3D(name = 'Glo45661', )(Res18037)
Con23476 = keras.layers.Concatenate(axis=1, name = 'Con23476', )([Glo45661,in0Con23476])
Sub78771 = keras.layers.Subtract(name = 'Sub78771', )([Fla99744,Con23476])
Glo49360 = keras.layers.GlobalMaxPool2D(name = 'Glo49360', )(in0Glo49360)
Con22307 = keras.layers.Concatenate(axis=1, name = 'Con22307', )([Glo49360,in0Con22307])
Max66542 = keras.layers.Maximum(name = 'Max66542', )([Sub78771,Con22307])
model = tf.keras.models.Model(inputs=[in0Con75567,in0PRe9052,in0Con23476,in0Glo49360,in0Con22307], outputs=Max66542)
w = model.get_layer('Con75567').get_weights() 
w[0] = np.array([[[[[0.6257, 0.2375], [0.9477, 0.5637]], [[0.9784, 0.8686], [0.9478, 0.8515]]], [[[0.2224, 0.7876], [0.5806, 0.617]], [[0.342, 0.1942], [0.3753, 0.6626]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con75567').set_weights(w) 
w = model.get_layer('PRe9052').get_weights() 
w[0] = np.array([[0.4494]])
model.get_layer('PRe9052').set_weights(w) 
in0Con75567 = tf.constant([[[[[0.9425, 0.4591], [0.7249, 0.9152]], [[0.1174, 0.5129], [0.1366, 0.8614]]], [[[0.6069, 0.2492], [0.8829, 0.2591]], [[0.7836, 0.8726], [0.9159, 0.4]]]]])
in0PRe9052 = tf.constant([[[0.4362]]])
in0Con23476 = tf.constant([[0.5291, 0.0104, 0.8057]])
in0Glo49360 = tf.constant([[[[1.8238]]]])
in0Con22307 = tf.constant([[0.1858, 0.7211, 0.5527]])
print (np.array2string(model.predict([in0Con75567,in0PRe9052,in0Con23476,in0Glo49360,in0Con22307],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max66542.png')

LCon75567 = conv3D_layer([[[[[0.9425, 0.4591], [0.7249, 0.9152]], [[0.1174, 0.5129], [0.1366, 0.8614]]], [[[0.6069, 0.2492], [0.8829, 0.2591]], [[0.7836, 0.8726], [0.9159, 0.4]]]]], 1, 2, 2,[[[[[0.6257, 0.2375], [0.9477, 0.5637]], [[0.9784, 0.8686], [0.9478, 0.8515]]], [[[0.2224, 0.7876], [0.5806, 0.617]], [[0.342, 0.1942], [0.3753, 0.6626]]]]],[0, 0], 1, 1, 1, false, 1, 1, 1, Con75567), 
LRes43071 = reshape_layer(Con75567, [2, 1, 2], Res43071), 
LRes28821 = reshape_layer(Res43071, [2, 2], Res28821), 
LFla99744 = flatten_layer(Res28821, Fla99744), 
LPRe9052 = prelu_layer([[[0.4362]]], [[0.4494]], PRe9052), 
LRes96527 = reshape_layer(PRe9052, [1, 1, 1], Res96527), 
LRes18037 = reshape_layer(Res96527, [1, 1, 1, 1], Res18037), 
LGlo45661 = global_average_pooling3D_layer(Res18037, Glo45661), 
LCon23476 = concatenate_layer([Glo45661,[[0.5291, 0.0104, 0.8057]]], 1, Con23476), 
LSub78771 = subtract_layer(Fla99744,Con23476, Sub78771), 
LGlo49360 = global_max_pool2D_layer([[[[1.8238]]]], Glo49360), 
LCon22307 = concatenate_layer([Glo49360,[[0.1858, 0.7211, 0.5527]]], 1, Con22307), 
LMax66542 = maximum_layer([Sub78771,Con22307], Max66542), 
exec_layers([LCon75567,LRes43071,LRes28821,LFla99744,LPRe9052,LRes96527,LRes18037,LGlo45661,LCon23476,LSub78771,LGlo49360,LCon22307,LMax66542],["Con75567","Res43071","Res28821","Fla99744","PRe9052","Res96527","Res18037","Glo45661","Con23476","Sub78771","Glo49360","Con22307","Max66542"],Max66542,"Max66542")

Actual (Unparsed): [[2.8591802, 2.3686943, 2.8591705, 2.0648887]]

Expected (Unparsed): [[2.8591801600000006,2.36869426,2.8591705099999998,2.06488872]]

Actual:   [[2.8592, 2.3687, 2.8592, 2.0649]]

Expected: [[2.8592, 2.3687, 2.8592, 2.0649]]