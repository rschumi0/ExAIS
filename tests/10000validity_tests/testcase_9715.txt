import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST99747 = tf.keras.layers.Input(shape=([2, 3]))
in0Con93837 = tf.keras.layers.Input(shape=([2, 1]))
in0Sub53166 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub53166 = tf.keras.layers.Input(shape=([2, 2]))
in0Dot33065 = tf.keras.layers.Input(shape=([3]))
in1Dot33065 = tf.keras.layers.Input(shape=([3]))

LST99747 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST99747', )(in0LST99747)
Res43564 = keras.layers.Reshape((2, 1), name = 'Res43564', )(LST99747)
Con93837 = keras.layers.Concatenate(axis=2, name = 'Con93837', )([Res43564,in0Con93837])
Sub53166 = keras.layers.Subtract(name = 'Sub53166', )([in0Sub53166,in1Sub53166])
Sub18563 = keras.layers.Subtract(name = 'Sub18563', )([Con93837,Sub53166])
Res75572 = keras.layers.Reshape((2, 2, 1), name = 'Res75572', )(Sub18563)
Dot33065 = keras.layers.Dot(axes=(1, 1), name = 'Dot33065', )([in0Dot33065,in1Dot33065])
Res37897 = keras.layers.Reshape((1, 1), name = 'Res37897', )(Dot33065)
Res68986 = keras.layers.Reshape((1, 1, 1), name = 'Res68986', )(Res37897)
Ave98018 = keras.layers.AveragePooling2D(pool_size=(1, 1), name = 'Ave98018', )(Res68986)
Zer57519 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer57519', )(Ave98018)
Ave99793 = keras.layers.Average(name = 'Ave99793', )([Res75572,Zer57519])
Res40578 = keras.layers.Reshape((2, 2), name = 'Res40578', )(Ave99793)
LST31981 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST31981', )(Res40578)
model = tf.keras.models.Model(inputs=[in0LST99747,in0Con93837,in0Sub53166,in1Sub53166,in0Dot33065,in1Dot33065], outputs=LST31981)
w = model.get_layer('LST99747').get_weights() 
w[0] = np.array([[8, 10, 2, 5, 6, 4, 4, 10], [1, 6, 2, 3, 8, 7, 6, 8], [3, 1, 1, 8, 3, 4, 10, 7]])
w[1] = np.array([[5, 8, 3, 2, 5, 9, 9, 2], [6, 9, 7, 5, 5, 6, 10, 1]])
w[2] = np.array([5, 10, 2, 8, 5, 3, 3, 6])
model.get_layer('LST99747').set_weights(w) 
w = model.get_layer('LST31981').get_weights() 
w[0] = np.array([[9, 2, 8, 9], [4, 8, 1, 7]])
w[1] = np.array([[5, 8, 1, 10]])
w[2] = np.array([5, 9, 2, 9])
model.get_layer('LST31981').set_weights(w) 
in0LST99747 = tf.constant([[[9, 7, 5], [10, 10, 9]]])
in0Con93837 = tf.constant([[[0.5562], [0.4386]]])
in0Sub53166 = tf.constant([[[0.937, 0.5365], [0.3571, 0.806]]])
in1Sub53166 = tf.constant([[[0.1612, 0.8752], [0.2759, 0.2551]]])
in0Dot33065 = tf.constant([[0.6166, 0.4701, 0.7347]])
in1Dot33065 = tf.constant([[0.2341, 0.8046, 0.3794]])
print (np.array2string(model.predict([in0LST99747,in0Con93837,in0Sub53166,in1Sub53166,in0Dot33065,in1Dot33065],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST31981.png')

LLST99747 = lstm_layer([[[9, 7, 5], [10, 10, 9]]],[[8, 10, 2, 5, 6, 4, 4, 10], [1, 6, 2, 3, 8, 7, 6, 8], [3, 1, 1, 8, 3, 4, 10, 7]],[[5, 8, 3, 2, 5, 9, 9, 2], [6, 9, 7, 5, 5, 6, 10, 1]],[5, 10, 2, 8, 5, 3, 3, 6], LST99747), 
LRes43564 = reshape_layer(LST99747, [2, 1], Res43564), 
LCon93837 = concatenate_layer([Res43564,[[[0.5562], [0.4386]]]], 2, Con93837), 
LSub53166 = subtract_layer([[[0.937, 0.5365], [0.3571, 0.806]]], [[[0.1612, 0.8752], [0.2759, 0.2551]]], Sub53166), 
LSub18563 = subtract_layer(Con93837,Sub53166, Sub18563), 
LRes75572 = reshape_layer(Sub18563, [2, 2, 1], Res75572), 
LDot33065 = dot_layer([[0.6166, 0.4701, 0.7347]], [[0.2341, 0.8046, 0.3794]], 1, 1, Dot33065), 
LRes37897 = reshape_layer(Dot33065, [1, 1], Res37897), 
LRes68986 = reshape_layer(Res37897, [1, 1, 1], Res68986), 
LAve98018 = average_pooling2D_layer(Res68986, 1, 1, Ave98018), 
LZer57519 = zero_padding2D_layer(Ave98018, 1, 0, 1, 0, Zer57519), 
LAve99793 = average_layer([Res75572,Zer57519], Ave99793), 
LRes40578 = reshape_layer(Ave99793, [2, 2], Res40578), 
LLST31981 = lstm_layer(Res40578,[[9, 2, 8, 9], [4, 8, 1, 7]],[[5, 8, 1, 10]],[5, 9, 2, 9], LST31981), 
exec_layers([LLST99747,LRes43564,LCon93837,LSub53166,LSub18563,LRes75572,LDot33065,LRes37897,LRes68986,LAve98018,LZer57519,LAve99793,LRes40578,LLST31981],["LST99747","Res43564","Con93837","Sub53166","Sub18563","Res75572","Dot33065","Res37897","Res68986","Ave98018","Zer57519","Ave99793","Res40578","LST31981"],LST31981,"LST31981")

Actual (Unparsed): [[0.9637581]]

Expected (Unparsed): [[0.9637581273563526]]

Actual:   [[0.9638]]

Expected: [[0.9638]]