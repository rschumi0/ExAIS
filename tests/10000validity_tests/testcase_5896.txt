import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave42961 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave42961 = tf.keras.layers.Input(shape=([1, 2]))
in0Min96660 = tf.keras.layers.Input(shape=([1, 1]))
in1Min96660 = tf.keras.layers.Input(shape=([1, 1]))
in0Con57574 = tf.keras.layers.Input(shape=([1, 1]))
in0Mul97864 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul97864 = tf.keras.layers.Input(shape=([1, 1]))
in0Con7314 = tf.keras.layers.Input(shape=([1, 1]))
in0Bat19909 = tf.keras.layers.Input(shape=([3, 2, 4]))
in0Add9675 = tf.keras.layers.Input(shape=([1, 1]))
in1Add9675 = tf.keras.layers.Input(shape=([1, 1]))
in0Con23370 = tf.keras.layers.Input(shape=([1, 1]))

Ave42961 = keras.layers.Average(name = 'Ave42961', )([in0Ave42961,in1Ave42961])
Min96660 = keras.layers.Minimum(name = 'Min96660', )([in0Min96660,in1Min96660])
Con57574 = keras.layers.Concatenate(axis=2, name = 'Con57574', )([Min96660,in0Con57574])
Max84117 = keras.layers.Maximum(name = 'Max84117', )([Ave42961,Con57574])
Mul97864 = keras.layers.Multiply(name = 'Mul97864', )([in0Mul97864,in1Mul97864])
Con7314 = keras.layers.Concatenate(axis=2, name = 'Con7314', )([Mul97864,in0Con7314])
Max82219 = keras.layers.Maximum(name = 'Max82219', )([Max84117,Con7314])
Bat19909 = keras.layers.BatchNormalization(axis=1, epsilon=0.6825253999848907,  name = 'Bat19909', )(in0Bat19909)
Res95555 = keras.layers.Reshape((3, 8), name = 'Res95555', )(Bat19909)
LST48836 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST48836', )(Res95555)
Res42642 = keras.layers.Reshape((1, 1), name = 'Res42642', )(LST48836)
Add9675 = keras.layers.Add(name = 'Add9675', )([in0Add9675,in1Add9675])
Mas24684 = keras.layers.Masking(mask_value=1, name = 'Mas24684', )(Add9675)
Add76466 = keras.layers.Add(name = 'Add76466', )([Res42642,Mas24684])
Con23370 = keras.layers.Concatenate(axis=2, name = 'Con23370', )([Add76466,in0Con23370])
Ave78910 = keras.layers.Average(name = 'Ave78910', )([Max82219,Con23370])
LST64133 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST64133', )(Ave78910)
model = tf.keras.models.Model(inputs=[in0Ave42961,in1Ave42961,in0Min96660,in1Min96660,in0Con57574,in0Mul97864,in1Mul97864,in0Con7314,in0Bat19909,in0Add9675,in1Add9675,in0Con23370], outputs=LST64133)
w = model.get_layer('Bat19909').get_weights() 
w[0] = np.array([0.0211, 0.7438, 0.0225])
w[1] = np.array([0.4521, 0.5556, 0.5768])
w[2] = np.array([0.7941, 0.6494, 0.5782])
w[3] = np.array([0.3877, 0.2619, 0.274])
model.get_layer('Bat19909').set_weights(w) 
w = model.get_layer('LST48836').get_weights() 
w[0] = np.array([[8, 8, 9, 6], [1, 10, 4, 5], [2, 10, 1, 3], [10, 2, 6, 3], [4, 7, 5, 1], [7, 4, 9, 9], [3, 5, 10, 2], [7, 3, 2, 5]])
w[1] = np.array([[8, 5, 5, 4]])
w[2] = np.array([5, 5, 9, 8])
model.get_layer('LST48836').set_weights(w) 
w = model.get_layer('LST64133').get_weights() 
w[0] = np.array([[1, 5, 1, 2, 3, 10, 1, 5], [3, 5, 4, 5, 10, 10, 9, 4]])
w[1] = np.array([[9, 10, 10, 6, 9, 2, 6, 2], [3, 4, 3, 6, 2, 8, 4, 5]])
w[2] = np.array([7, 1, 2, 3, 1, 1, 1, 1])
model.get_layer('LST64133').set_weights(w) 
in0Ave42961 = tf.constant([[[0.6605, 0.9075]]])
in1Ave42961 = tf.constant([[[0.7548, 0.3764]]])
in0Min96660 = tf.constant([[[0.6667]]])
in1Min96660 = tf.constant([[[0.5856]]])
in0Con57574 = tf.constant([[[0.2051]]])
in0Mul97864 = tf.constant([[[0.5514]]])
in1Mul97864 = tf.constant([[[0.6019]]])
in0Con7314 = tf.constant([[[0.632]]])
in0Bat19909 = tf.constant([[[[1.3921, 1.2376, 1.4794, 1.1462], [1.8317, 1.4792, 1.9063, 1.3454]], [[1.3386, 1.5087, 1.4396, 1.7931], [1.1334, 1.0653, 1.6812, 1.9555]], [[1.2811, 1.4665, 1.7468, 1.6084], [1.3558, 1.2784, 1.4296, 1.8563]]]])
in0Add9675 = tf.constant([[[0.711]]])
in1Add9675 = tf.constant([[[0.7862]]])
in0Con23370 = tf.constant([[[0.1589]]])
print (np.array2string(model.predict([in0Ave42961,in1Ave42961,in0Min96660,in1Min96660,in0Con57574,in0Mul97864,in1Mul97864,in0Con7314,in0Bat19909,in0Add9675,in1Add9675,in0Con23370],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST64133.png')

LAve42961 = average_layer([[[[0.6605, 0.9075]]], [[[0.7548, 0.3764]]]], Ave42961), 
LMin96660 = minimum_layer([[[[0.6667]]], [[[0.5856]]]], Min96660), 
LCon57574 = concatenate_layer([Min96660,[[[0.2051]]]], 2, Con57574), 
LMax84117 = maximum_layer([Ave42961,Con57574], Max84117), 
LMul97864 = multiply_layer([[[[0.5514]]], [[[0.6019]]]], Mul97864), 
LCon7314 = concatenate_layer([Mul97864,[[[0.632]]]], 2, Con7314), 
LMax82219 = maximum_layer([Max84117,Con7314], Max82219), 
LBat19909 = batch_normalization_layer([[[[1.3921, 1.2376, 1.4794, 1.1462], [1.8317, 1.4792, 1.9063, 1.3454]], [[1.3386, 1.5087, 1.4396, 1.7931], [1.1334, 1.0653, 1.6812, 1.9555]], [[1.2811, 1.4665, 1.7468, 1.6084], [1.3558, 1.2784, 1.4296, 1.8563]]]], 1, 0.6825253999848907, [0.0211, 0.7438, 0.0225], [0.4521, 0.5556, 0.5768], [0.7941, 0.6494, 0.5782], [0.3877, 0.2619, 0.274], Bat19909), 
LRes95555 = reshape_layer(Bat19909, [3, 8], Res95555), 
LLST48836 = lstm_layer(Res95555,[[8, 8, 9, 6], [1, 10, 4, 5], [2, 10, 1, 3], [10, 2, 6, 3], [4, 7, 5, 1], [7, 4, 9, 9], [3, 5, 10, 2], [7, 3, 2, 5]],[[8, 5, 5, 4]],[5, 5, 9, 8], LST48836), 
LRes42642 = reshape_layer(LST48836, [1, 1], Res42642), 
LAdd9675 = add_layer([[[[0.711]]], [[[0.7862]]]], Add9675), 
LMas24684 = masking_layer(Add9675, 1, Mas24684), 
LAdd76466 = add_layer([Res42642,Mas24684], Add76466), 
LCon23370 = concatenate_layer([Add76466,[[[0.1589]]]], 2, Con23370), 
LAve78910 = average_layer([Max82219,Con23370], Ave78910), 
LLST64133 = lstm_layer(Ave78910,[[1, 5, 1, 2, 3, 10, 1, 5], [3, 5, 4, 5, 10, 10, 9, 4]],[[9, 10, 10, 6, 9, 2, 6, 2], [3, 4, 3, 6, 2, 8, 4, 5]],[7, 1, 2, 3, 1, 1, 1, 1], LST64133), 
exec_layers([LAve42961,LMin96660,LCon57574,LMax84117,LMul97864,LCon7314,LMax82219,LBat19909,LRes95555,LLST48836,LRes42642,LAdd9675,LMas24684,LAdd76466,LCon23370,LAve78910,LLST64133],["Ave42961","Min96660","Con57574","Max84117","Mul97864","Con7314","Max82219","Bat19909","Res95555","LST48836","Res42642","Add9675","Mas24684","Add76466","Con23370","Ave78910","LST64133"],LST64133,"LST64133")

Actual (Unparsed): [[0.7600343, 0.7615682]]

Expected (Unparsed): [[0.7600342725556598,0.7615682073989349]]

Actual:   [[0.7601, 0.7616]]

Expected: [[0.7601, 0.7616]]