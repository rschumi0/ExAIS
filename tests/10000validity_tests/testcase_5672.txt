import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Thr69226 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Ave97278 = tf.keras.layers.Input(shape=([1, 2]))
in0Con3058 = tf.keras.layers.Input(shape=([1]))
in0Dot64325 = tf.keras.layers.Input(shape=([2]))
in1Dot64325 = tf.keras.layers.Input(shape=([2]))
in0Con82485 = tf.keras.layers.Input(shape=([2]))
in0Fla2653 = tf.keras.layers.Input(shape=([3, 1]))
in0Con50923 = tf.keras.layers.Input(shape=([1]))
in0Min23730 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Min23730 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Loc83364 = tf.keras.layers.Input(shape=([2, 2, 2]))

Thr69226 = keras.layers.ThresholdedReLU(theta=2.9089306846031215, name = 'Thr69226', input_shape=(1, 2, 2, 1))(in0Thr69226)
ELU87261 = keras.layers.ELU(alpha=-5.290370564486109, name = 'ELU87261', )(Thr69226)
Res95935 = keras.layers.Reshape((1, 2, 2), name = 'Res95935', )(ELU87261)
Res39648 = keras.layers.Reshape((1, 4), name = 'Res39648', )(Res95935)
Fla89232 = keras.layers.Flatten(name = 'Fla89232', )(Res39648)
Ave97278 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave97278', )(in0Ave97278)
Fla32126 = keras.layers.Flatten(name = 'Fla32126', )(Ave97278)
Con3058 = keras.layers.Concatenate(axis=1, name = 'Con3058', )([Fla32126,in0Con3058])
Dot64325 = keras.layers.Dot(axes=(1, 1), name = 'Dot64325', )([in0Dot64325,in1Dot64325])
Con82485 = keras.layers.Concatenate(axis=1, name = 'Con82485', )([Dot64325,in0Con82485])
Fla2653 = keras.layers.Flatten(name = 'Fla2653', )(in0Fla2653)
Sub90347 = keras.layers.Subtract(name = 'Sub90347', )([Con82485,Fla2653])
Add57964 = keras.layers.Add(name = 'Add57964', )([Con3058,Sub90347])
Con50923 = keras.layers.Concatenate(axis=1, name = 'Con50923', )([Add57964,in0Con50923])
Min75317 = keras.layers.Minimum(name = 'Min75317', )([Fla89232,Con50923])
Res35822 = keras.layers.Reshape((4, 1), name = 'Res35822', )(Min75317)
Min23730 = keras.layers.Minimum(name = 'Min23730', )([in0Min23730,in1Min23730])
Zer7099 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer7099', )(Min23730)
Loc83364 = keras.layers.LocallyConnected2D(2, (1, 2),strides=(1, 1), name = 'Loc83364', )(in0Loc83364)
Ave60237 = keras.layers.Average(name = 'Ave60237', )([Zer7099,Loc83364])
Res67347 = keras.layers.Reshape((4, 1), name = 'Res67347', )(Ave60237)
Ave68062 = keras.layers.Average(name = 'Ave68062', )([Res35822,Res67347])
model = tf.keras.models.Model(inputs=[in0Thr69226,in0Ave97278,in0Con3058,in0Dot64325,in1Dot64325,in0Con82485,in0Fla2653,in0Con50923,in0Min23730,in1Min23730,in0Loc83364], outputs=Ave68062)
w = model.get_layer('Loc83364').get_weights() 
w[0] = np.array([[[0.269, 0.8687], [0.6412, 0.4003], [0.9456, 0.6606], [0.685, 0.1184]], [[0.3223, 0.3232], [0.1635, 0.8677], [0.3009, 0.9152], [0.1485, 0.3812]]])
w[1] = np.array([[[0, 0]], [[0, 0]]])
model.get_layer('Loc83364').set_weights(w) 
in0Thr69226 = tf.constant([[[[[0.3986], [0.2975]], [[0.9992], [0.6826]]]]])
in0Ave97278 = tf.constant([[[1.2186, 1.4222]]])
in0Con3058 = tf.constant([[0.7622]])
in0Dot64325 = tf.constant([[0.2903, 0.3831]])
in1Dot64325 = tf.constant([[0.7298, 0.4125]])
in0Con82485 = tf.constant([[0.3241, 0.0572]])
in0Fla2653 = tf.constant([[[1.9125], [1.72], [1.0018]]])
in0Con50923 = tf.constant([[0.5655]])
in0Min23730 = tf.constant([[[[0.7282, 0.5491]]]])
in1Min23730 = tf.constant([[[[0.7149, 0.8314]]]])
in0Loc83364 = tf.constant([[[[0.4451, 0.5645], [0.5929, 0.3705]], [[0.1471, 0.62], [0.8661, 0.6379]]]])
print (np.array2string(model.predict([in0Thr69226,in0Ave97278,in0Con3058,in0Dot64325,in1Dot64325,in0Con82485,in0Fla2653,in0Con50923,in0Min23730,in1Min23730,in0Loc83364],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave68062.png')

LThr69226 = thresholded_relu_layer([[[[[0.3986], [0.2975]], [[0.9992], [0.6826]]]]], 2.9089306846031215, Thr69226), 
LELU87261 = elu_layer(Thr69226, -5.290370564486109, ELU87261), 
LRes95935 = reshape_layer(ELU87261, [1, 2, 2], Res95935), 
LRes39648 = reshape_layer(Res95935, [1, 4], Res39648), 
LFla89232 = flatten_layer(Res39648, Fla89232), 
LAve97278 = average_pooling1D_layer([[[1.2186, 1.4222]]], 1, Ave97278), 
LFla32126 = flatten_layer(Ave97278, Fla32126), 
LCon3058 = concatenate_layer([Fla32126,[[0.7622]]], 1, Con3058), 
LDot64325 = dot_layer([[0.2903, 0.3831]], [[0.7298, 0.4125]], 1, 1, Dot64325), 
LCon82485 = concatenate_layer([Dot64325,[[0.3241, 0.0572]]], 1, Con82485), 
LFla2653 = flatten_layer([[[1.9125], [1.72], [1.0018]]], Fla2653), 
LSub90347 = subtract_layer(Con82485,Fla2653, Sub90347), 
LAdd57964 = add_layer([Con3058,Sub90347], Add57964), 
LCon50923 = concatenate_layer([Add57964,[[0.5655]]], 1, Con50923), 
LMin75317 = minimum_layer([Fla89232,Con50923], Min75317), 
LRes35822 = reshape_layer(Min75317, [4, 1], Res35822), 
LMin23730 = minimum_layer([[[[[0.7282, 0.5491]]]], [[[[0.7149, 0.8314]]]]], Min23730), 
LZer7099 = zero_padding2D_layer(Min23730, 1, 0, 0, 0, Zer7099), 
LLoc83364 = locally_connected2D_layer([[[[0.4451, 0.5645], [0.5929, 0.3705]], [[0.1471, 0.62], [0.8661, 0.6379]]]], 1, 2,[[[0.269, 0.8687], [0.6412, 0.4003], [0.9456, 0.6606], [0.685, 0.1184]], [[0.3223, 0.3232], [0.1635, 0.8677], [0.3009, 0.9152], [0.1485, 0.3812]]],[[[0, 0]], [[0, 0]]], 1, 1, Loc83364), 
LAve60237 = average_layer([Zer7099,Loc83364], Ave60237), 
LRes67347 = reshape_layer(Ave60237, [4, 1], Res67347), 
LAve68062 = average_layer([Res35822,Res67347], Ave68062), 
exec_layers([LThr69226,LELU87261,LRes95935,LRes39648,LFla89232,LAve97278,LFla32126,LCon3058,LDot64325,LCon82485,LFla2653,LSub90347,LAdd57964,LCon50923,LMin75317,LRes35822,LMin23730,LZer7099,LLoc83364,LAve60237,LRes67347,LAve68062],["Thr69226","ELU87261","Res95935","Res39648","Fla89232","Ave97278","Fla32126","Con3058","Dot64325","Con82485","Fla2653","Sub90347","Add57964","Con50923","Min75317","Res35822","Min23730","Zer7099","Loc83364","Ave60237","Res67347","Ave68062"],Ave68062,"Ave68062")

Actual (Unparsed): [[[0.1620269], [0.2620412], [0.2135545], [0.5426097]]]

Expected (Unparsed): [[[0.16202685499999986],[0.262041165],[0.21355449249999997],[0.54260973]]]

Actual:   [[[0.1621], [0.2621], [0.2136], [0.5427]]]

Expected: [[[0.1621], [0.2621], [0.2136], [0.5427]]]