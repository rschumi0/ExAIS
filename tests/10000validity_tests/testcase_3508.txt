import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add4278 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Add4278 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Sof33884 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con27063 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Add16557 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Add16557 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))

Add4278 = keras.layers.Add(name = 'Add4278', )([in0Add4278,in1Add4278])
Dep55042 = keras.layers.DepthwiseConv2D((2, 1),strides=(2, 2), padding='valid', name = 'Dep55042', )(Add4278)
Res57946 = keras.layers.Reshape((1, 2), name = 'Res57946', )(Dep55042)
Sof33884 = keras.layers.Softmax(axis=1, name = 'Sof33884', input_shape=(1, 2, 1))(in0Sof33884)
Lea33670 = keras.layers.LeakyReLU(alpha=9.685607111511981, name = 'Lea33670', )(Sof33884)
Res2493 = keras.layers.Reshape((1, 2), name = 'Res2493', )(Lea33670)
Dot67993 = keras.layers.Dot(axes=(2, 2), name = 'Dot67993', )([Res57946,Res2493])
Ave47318 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='same', name = 'Ave47318', )(Dot67993)
Res23537 = keras.layers.Reshape((1, 1, 1), name = 'Res23537', )(Ave47318)
Res32995 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res32995', )(Res23537)
Zer95792 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (1, 0)), name = 'Zer95792', )(Res32995)
Con27063 = keras.layers.Concatenate(axis=4, name = 'Con27063', )([Zer95792,in0Con27063])
Add16557 = keras.layers.Add(name = 'Add16557', )([in0Add16557,in1Add16557])
Mul42192 = keras.layers.Multiply(name = 'Mul42192', )([Con27063,Add16557])
model = tf.keras.models.Model(inputs=[in0Add4278,in1Add4278,in0Sof33884,in0Con27063,in0Add16557,in1Add16557], outputs=Mul42192)
w = model.get_layer('Dep55042').get_weights() 
w[0] = np.array([[[[0.79], [0.8157]]], [[[0.8557], [0.8033]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep55042').set_weights(w) 
in0Add4278 = tf.constant([[[[0.8652, 0.0908]], [[0.7997, 0.0775]]]])
in1Add4278 = tf.constant([[[[0.1768, 0.153]], [[0.3045, 0.7972]]]])
in0Sof33884 = tf.constant([[[[0.5688], [0.1125]]]])
in0Con27063 = tf.constant([[[[[0.1222], [0.4176]], [[0.846], [0.8622]]]]])
in0Add16557 = tf.constant([[[[[0.1472, 0.0772], [0.9818, 0.3312]], [[0.3238, 0.2378], [0.0082, 0.5408]]]]])
in1Add16557 = tf.constant([[[[[0.3915, 0.6072], [0.3383, 0.6083]], [[0.4929, 0.7004], [0.2414, 0.3113]]]]])
print (np.array2string(model.predict([in0Add4278,in1Add4278,in0Sof33884,in0Con27063,in0Add16557,in1Add16557],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul42192.png')

LAdd4278 = add_layer([[[[[0.8652, 0.0908]], [[0.7997, 0.0775]]]], [[[[0.1768, 0.153]], [[0.3045, 0.7972]]]]], Add4278), 
LDep55042 = depthwise_conv2D_layer(Add4278, 2, 1,[[[[0.79], [0.8157]]], [[[0.8557], [0.8033]]]],[0, 0], 2, 2, false, Dep55042), 
LRes57946 = reshape_layer(Dep55042, [1, 2], Res57946), 
LSof33884 = softmax_layer([[[[0.5688], [0.1125]]]], 1, Sof33884), 
LLea33670 = leaky_relu_layer(Sof33884, 9.685607111511981, Lea33670), 
LRes2493 = reshape_layer(Lea33670, [1, 2], Res2493), 
LDot67993 = dot_layer(Res57946,Res2493, 2, 2, Dot67993), 
LAve47318 = average_pooling1D_layer(Dot67993, 1, 1, true, Ave47318), 
LRes23537 = reshape_layer(Ave47318, [1, 1, 1], Res23537), 
LRes32995 = reshape_layer(Res23537, [1, 1, 1, 1], Res32995), 
LZer95792 = zero_padding3D_layer(Res32995, 0, 0, 1, 0, 1, 0, Zer95792), 
LCon27063 = concatenate_layer([Zer95792,[[[[[0.1222], [0.4176]], [[0.846], [0.8622]]]]]], 4, Con27063), 
LAdd16557 = add_layer([[[[[[0.1472, 0.0772], [0.9818, 0.3312]], [[0.3238, 0.2378], [0.0082, 0.5408]]]]], [[[[[0.3915, 0.6072], [0.3383, 0.6083]], [[0.4929, 0.7004], [0.2414, 0.3113]]]]]], Add16557), 
LMul42192 = multiply_layer([Con27063,Add16557], Mul42192), 
exec_layers([LAdd4278,LDep55042,LRes57946,LSof33884,LLea33670,LRes2493,LDot67993,LAve47318,LRes23537,LRes32995,LZer95792,LCon27063,LAdd16557,LMul42192],["Add4278","Dep55042","Res57946","Sof33884","Lea33670","Res2493","Dot67993","Ave47318","Res23537","Res32995","Zer95792","Con27063","Add16557","Mul42192"],Mul42192,"Mul42192")

Actual (Unparsed): [[[[[0.0000000, 0.0836337], [0.0000000, 0.3923352]], [[0.0000000, 0.7937172], [0.6663217, 0.7346806]]]]]

Expected (Unparsed): [[[[[0.0,0.08363368],[0.0,0.39233520000000005]],[[0.0,0.7937172],[0.666321704256,0.7346806199999999]]]]]

Actual:   [[[[[0, 0.0837], [0, 0.3924]], [[0, 0.7938], [0.6664, 0.7347]]]]]

Expected: [[[[[0, 0.0837], [0, 0.3924]], [[0, 0.7938], [0.6664, 0.7347]]]]]