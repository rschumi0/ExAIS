import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add4585 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Add4585 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Sub28691 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub28691 = tf.keras.layers.Input(shape=([2, 2]))
in0Con69342 = tf.keras.layers.Input(shape=([2, 2]))
in0Con74525 = tf.keras.layers.Input(shape=([2, 4, 3, 1]))
in0Ave67187 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Ave67187 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))

Add4585 = keras.layers.Add(name = 'Add4585', )([in0Add4585,in1Add4585])
Res39918 = keras.layers.Reshape((1, 4), name = 'Res39918', )(Add4585)
Zer29201 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer29201', )(Res39918)
Sub28691 = keras.layers.Subtract(name = 'Sub28691', )([in0Sub28691,in1Sub28691])
Con69342 = keras.layers.Concatenate(axis=2, name = 'Con69342', )([Sub28691,in0Con69342])
Add97174 = keras.layers.Add(name = 'Add97174', )([Zer29201,Con69342])
Cro17506 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro17506', )(Add97174)
Res92713 = keras.layers.Reshape((2, 4, 1), name = 'Res92713', )(Cro17506)
Res63735 = keras.layers.Reshape((2, 4, 1, 1), name = 'Res63735', )(Res92713)
Zer7411 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer7411', )(Res63735)
Con74525 = keras.layers.Concatenate(axis=4, name = 'Con74525', )([Zer7411,in0Con74525])
Ave67187 = keras.layers.Average(name = 'Ave67187', )([in0Ave67187,in1Ave67187])
Zer82679 = keras.layers.ZeroPadding3D(padding=((1, 0), (3, 0), (1, 0)), name = 'Zer82679', )(Ave67187)
Mul97442 = keras.layers.Multiply(name = 'Mul97442', )([Con74525,Zer82679])
model = tf.keras.models.Model(inputs=[in0Add4585,in1Add4585,in0Sub28691,in1Sub28691,in0Con69342,in0Con74525,in0Ave67187,in1Ave67187], outputs=Mul97442)
in0Add4585 = tf.constant([[[[0.1485, 0.0252], [0.0939, 0.0268]]]])
in1Add4585 = tf.constant([[[[0.6167, 0.7386], [0.1984, 0.0941]]]])
in0Sub28691 = tf.constant([[[0.835, 0.8815], [0.0991, 0.251]]])
in1Sub28691 = tf.constant([[[0.1247, 0.4905], [0.2861, 0.525]]])
in0Con69342 = tf.constant([[[0.9518, 0.6376], [0.5177, 0.6636]]])
in0Con74525 = tf.constant([[[[[0.7684], [0.442], [0.2176]], [[0.7674], [0.3708], [0.1786]], [[0.555], [0.6667], [0.7443]], [[0.66], [0.4183], [0.8494]]], [[[0.3704], [0.2336], [0.998]], [[0.784], [0.9152], [0.807]], [[0.7066], [0.8197], [0.5832]], [[0.9163], [0.3591], [0.1272]]]]])
in0Ave67187 = tf.constant([[[[[0.2532, 0.0762], [0.0008, 0.1552]]]]])
in1Ave67187 = tf.constant([[[[[0.9158, 0.58], [0.0524, 0.5957]]]]])
print (np.array2string(model.predict([in0Add4585,in1Add4585,in0Sub28691,in1Sub28691,in0Con69342,in0Con74525,in0Ave67187,in1Ave67187],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul97442.png')

LAdd4585 = add_layer([[[[[0.1485, 0.0252], [0.0939, 0.0268]]]], [[[[0.6167, 0.7386], [0.1984, 0.0941]]]]], Add4585), 
LRes39918 = reshape_layer(Add4585, [1, 4], Res39918), 
LZer29201 = zero_padding1D_layer(Res39918, 1, 0, Zer29201), 
LSub28691 = subtract_layer([[[0.835, 0.8815], [0.0991, 0.251]]], [[[0.1247, 0.4905], [0.2861, 0.525]]], Sub28691), 
LCon69342 = concatenate_layer([Sub28691,[[[0.9518, 0.6376], [0.5177, 0.6636]]]], 2, Con69342), 
LAdd97174 = add_layer([Zer29201,Con69342], Add97174), 
LCro17506 = cropping1D_layer(Add97174, 0, 0, Cro17506), 
LRes92713 = reshape_layer(Cro17506, [2, 4, 1], Res92713), 
LRes63735 = reshape_layer(Res92713, [2, 4, 1, 1], Res63735), 
LZer7411 = zero_padding3D_layer(Res63735, 0, 0, 0, 0, 2, 0, Zer7411), 
LCon74525 = concatenate_layer([Zer7411,[[[[[0.7684], [0.442], [0.2176]], [[0.7674], [0.3708], [0.1786]], [[0.555], [0.6667], [0.7443]], [[0.66], [0.4183], [0.8494]]], [[[0.3704], [0.2336], [0.998]], [[0.784], [0.9152], [0.807]], [[0.7066], [0.8197], [0.5832]], [[0.9163], [0.3591], [0.1272]]]]]], 4, Con74525), 
LAve67187 = average_layer([[[[[[0.2532, 0.0762], [0.0008, 0.1552]]]]], [[[[[0.9158, 0.58], [0.0524, 0.5957]]]]]], Ave67187), 
LZer82679 = zero_padding3D_layer(Ave67187, 1, 0, 3, 0, 1, 0, Zer82679), 
LMul97442 = multiply_layer([Con74525,Zer82679], Mul97442), 
exec_layers([LAdd4585,LRes39918,LZer29201,LSub28691,LCon69342,LAdd97174,LCro17506,LRes92713,LRes63735,LZer7411,LCon74525,LAve67187,LZer82679,LMul97442],["Add4585","Res39918","Zer29201","Sub28691","Con69342","Add97174","Cro17506","Res92713","Res63735","Zer7411","Con74525","Ave67187","Zer82679","Mul97442"],Mul97442,"Mul97442")

Actual (Unparsed): [[[[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.1178207], [0.0208677, 0.0477572]]]]]

Expected (Unparsed): [[[[[0,0.0],[0,0.0],[0.0,0.0]],[[0,0.0],[0,0.0],[0.0,0.0]],[[0,0.0],[0,0.0],[0.0,0.0]],[[0,0.0],[0,0.0],[0.0,0.0]]],[[[0,0.0],[0,0.0],[0.0,0.0]],[[0,0.0],[0,0.0],[0.0,0.0]],[[0,0.0],[0,0.0],[0.0,0.0]],[[0,0.0],[0.0,0.11782071],[0.0208677,0.047757240000000006]]]]]

Actual:   [[[[[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0]]], [[[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0.1179], [0.0209, 0.0478]]]]]

Expected: [[[[[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0]]], [[[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0.1179], [0.0209, 0.0478]]]]]