import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0ReL34011 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Con20063 = tf.keras.layers.Input(shape=([2, 3]))
in0Max6173 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Max6173 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con56633 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Ave90009 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Ave90009 = tf.keras.layers.Input(shape=([1, 2, 2]))

ReL34011 = keras.layers.ReLU(max_value=7.5472782494790485, negative_slope=4.502207508742937, threshold=9.763693974622834, name = 'ReL34011', input_shape=(2, 2, 2, 1))(in0ReL34011)
Res83254 = keras.layers.Reshape((2, 2, 2), name = 'Res83254', )(ReL34011)
Res55331 = keras.layers.Reshape((2, 4), name = 'Res55331', )(Res83254)
Con20063 = keras.layers.Concatenate(axis=2, name = 'Con20063', )([Res55331,in0Con20063])
Max6173 = keras.layers.Maximum(name = 'Max6173', )([in0Max6173,in1Max6173])
Res53661 = keras.layers.Reshape((1, 1), name = 'Res53661', )(Max6173)
Zer13250 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer13250', )(Res53661)
Dot66689 = keras.layers.Dot(axes=(1, 1), name = 'Dot66689', )([Con20063,Zer13250])
LST24545 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST24545', )(Dot66689)
Lay52607 = keras.layers.LayerNormalization(axis=1, epsilon=2.449452795769809, name = 'Lay52607', )(LST24545)
Res92777 = keras.layers.Reshape((3, 1), name = 'Res92777', )(Lay52607)
Res72474 = keras.layers.Reshape((3, 1, 1), name = 'Res72474', )(Res92777)
Zer14147 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer14147', )(Res72474)
Con56633 = keras.layers.Concatenate(axis=3, name = 'Con56633', )([Zer14147,in0Con56633])
Ave90009 = keras.layers.Average(name = 'Ave90009', )([in0Ave90009,in1Ave90009])
Zer19726 = keras.layers.ZeroPadding2D(padding=((2, 0), (1, 0)), name = 'Zer19726', )(Ave90009)
Max47868 = keras.layers.Maximum(name = 'Max47868', )([Con56633,Zer19726])
model = tf.keras.models.Model(inputs=[in0ReL34011,in0Con20063,in0Max6173,in1Max6173,in0Con56633,in0Ave90009,in1Ave90009], outputs=Max47868)
w = model.get_layer('LST24545').get_weights() 
w[0] = np.array([[5, 6, 1, 8, 7, 10, 6, 10, 7, 9, 1, 7]])
w[1] = np.array([[8, 7, 6, 9, 4, 1, 5, 2, 3, 7, 3, 4], [6, 3, 10, 2, 2, 10, 2, 2, 9, 10, 8, 2], [8, 5, 1, 6, 6, 4, 1, 6, 6, 6, 9, 6]])
w[2] = np.array([2, 4, 3, 6, 9, 5, 1, 5, 5, 7, 6, 3])
model.get_layer('LST24545').set_weights(w) 
in0ReL34011 = tf.constant([[[[[0.3408], [0.5085]], [[0.1987], [0.8405]]], [[[0.8015], [0.1245]], [[0.9051], [0.7828]]]]])
in0Con20063 = tf.constant([[[0.8035, 0.1363, 0.5344], [0.2198, 0.3791, 0.4362]]])
in0Max6173 = tf.constant([[[[0.1411]]]])
in1Max6173 = tf.constant([[[[0.5469]]]])
in0Con56633 = tf.constant([[[[0.6614], [0.7511], [0.0738]], [[0.8299], [0.6847], [0.4335]], [[0.4315], [0.282], [0.1971]]]])
in0Ave90009 = tf.constant([[[[0.2354, 0.5454], [0.1236, 0.6232]]]])
in1Ave90009 = tf.constant([[[[0.5539, 0.148], [0.2558, 0.1181]]]])
print (np.array2string(model.predict([in0ReL34011,in0Con20063,in0Max6173,in1Max6173,in0Con56633,in0Ave90009,in1Ave90009],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max47868.png')

LReL34011 = relu_layer([[[[[0.3408], [0.5085]], [[0.1987], [0.8405]]], [[[0.8015], [0.1245]], [[0.9051], [0.7828]]]]], 7.5472782494790485, 4.502207508742937, 9.763693974622834, ReL34011), 
LRes83254 = reshape_layer(ReL34011, [2, 2, 2], Res83254), 
LRes55331 = reshape_layer(Res83254, [2, 4], Res55331), 
LCon20063 = concatenate_layer([Res55331,[[[0.8035, 0.1363, 0.5344], [0.2198, 0.3791, 0.4362]]]], 2, Con20063), 
LMax6173 = maximum_layer([[[[[0.1411]]]], [[[[0.5469]]]]], Max6173), 
LRes53661 = reshape_layer(Max6173, [1, 1], Res53661), 
LZer13250 = zero_padding1D_layer(Res53661, 1, 0, Zer13250), 
LDot66689 = dot_layer(Con20063,Zer13250, 1, 1, Dot66689), 
LLST24545 = lstm_layer(Dot66689,[[5, 6, 1, 8, 7, 10, 6, 10, 7, 9, 1, 7]],[[8, 7, 6, 9, 4, 1, 5, 2, 3, 7, 3, 4], [6, 3, 10, 2, 2, 10, 2, 2, 9, 10, 8, 2], [8, 5, 1, 6, 6, 4, 1, 6, 6, 6, 9, 6]],[2, 4, 3, 6, 9, 5, 1, 5, 5, 7, 6, 3], LST24545), 
LLay52607 = layer_normalization_layer(LST24545, 1, 2.449452795769809, Lay52607), 
LRes92777 = reshape_layer(Lay52607, [3, 1], Res92777), 
LRes72474 = reshape_layer(Res92777, [3, 1, 1], Res72474), 
LZer14147 = zero_padding2D_layer(Res72474, 0, 0, 2, 0, Zer14147), 
LCon56633 = concatenate_layer([Zer14147,[[[[0.6614], [0.7511], [0.0738]], [[0.8299], [0.6847], [0.4335]], [[0.4315], [0.282], [0.1971]]]]], 3, Con56633), 
LAve90009 = average_layer([[[[[0.2354, 0.5454], [0.1236, 0.6232]]]], [[[[0.5539, 0.148], [0.2558, 0.1181]]]]], Ave90009), 
LZer19726 = zero_padding2D_layer(Ave90009, 2, 0, 1, 0, Zer19726), 
LMax47868 = maximum_layer([Con56633,Zer19726], Max47868), 
exec_layers([LReL34011,LRes83254,LRes55331,LCon20063,LMax6173,LRes53661,LZer13250,LDot66689,LLST24545,LLay52607,LRes92777,LRes72474,LZer14147,LCon56633,LAve90009,LZer19726,LMax47868],["ReL34011","Res83254","Res55331","Con20063","Max6173","Res53661","Zer13250","Dot66689","LST24545","Lay52607","Res92777","Res72474","Zer14147","Con56633","Ave90009","Zer19726","Max47868"],Max47868,"Max47868")

Actual (Unparsed): [[[[0.0000000, 0.6614000], [0.0000000, 0.7511000], [0.0000000, 0.0738000]], [[0.0000000, 0.8299000], [0.0000000, 0.6847000], [0.0003583, 0.4335000]], [[0.0000000, 0.4315000], [0.3946500, 0.3467000], [0.1897000, 0.3706500]]]]

Expected (Unparsed): [[[[0,0.6614],[0,0.7511],[0,0.0738]],[[0,0.8299],[0,0.6847],[0.00035829066688710623,0.4335]],[[0,0.4315],[0.39464999999999995,0.3467],[0.1897,0.37065]]]]

Actual:   [[[[0, 0.6614], [0, 0.7511], [0, 0.0738]], [[0, 0.8299], [0, 0.6847], [0.0004, 0.4335]], [[0, 0.4315], [0.3947, 0.3467], [0.1897, 0.3707]]]]

Expected: [[[[0, 0.6614], [0, 0.7511], [0, 0.0738]], [[0, 0.8299], [0, 0.6847], [0.0004, 0.4335]], [[0, 0.4315], [0.3947, 0.3467], [0.1897, 0.3707]]]]