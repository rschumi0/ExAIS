import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave26356 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Ave26356 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Con48441 = tf.keras.layers.Input(shape=([4, 1, 1, 1]))
in0Dot39336 = tf.keras.layers.Input(shape=([3]))
in1Dot39336 = tf.keras.layers.Input(shape=([3]))
in0Con46401 = tf.keras.layers.Input(shape=([4, 1]))
in0Dot30080 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot30080 = tf.keras.layers.Input(shape=([2, 3]))

Ave26356 = keras.layers.Average(name = 'Ave26356', )([in0Ave26356,in1Ave26356])
Res87053 = keras.layers.Reshape((1, 2, 4), name = 'Res87053', )(Ave26356)
Glo14297 = keras.layers.GlobalAveragePooling2D(name = 'Glo14297', )(Res87053)
Res86605 = keras.layers.Reshape((4, 1), name = 'Res86605', )(Glo14297)
Res41855 = keras.layers.Reshape((4, 1, 1), name = 'Res41855', )(Res86605)
Res22845 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res22845', )(Res41855)
Con48441 = keras.layers.Concatenate(axis=4, name = 'Con48441', )([Res22845,in0Con48441])
Dot39336 = keras.layers.Dot(axes=(1, 1), name = 'Dot39336', )([in0Dot39336,in1Dot39336])
Res48339 = keras.layers.Reshape((1, 1), name = 'Res48339', )(Dot39336)
Res8044 = keras.layers.Reshape((1, 1, 1), name = 'Res8044', )(Res48339)
Res77431 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res77431', )(Res8044)
Con11599 = keras.layers.Conv3DTranspose(3, (1, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con11599', )(Res77431)
Con49183 = keras.layers.Conv3D(2, (1, 1, 1),strides=(1, 9, 7), padding='valid', dilation_rate=(1, 1, 1), name = 'Con49183', )(Con11599)
Zer68804 = keras.layers.ZeroPadding3D(padding=((3, 0), (0, 0), (0, 0)), name = 'Zer68804', )(Con49183)
Mul71263 = keras.layers.Multiply(name = 'Mul71263', )([Con48441,Zer68804])
Res35923 = keras.layers.Reshape((4, 1, 2), name = 'Res35923', )(Mul71263)
Res52510 = keras.layers.Reshape((4, 2), name = 'Res52510', )(Res35923)
Con46401 = keras.layers.Concatenate(axis=2, name = 'Con46401', )([Res52510,in0Con46401])
Dot30080 = keras.layers.Dot(axes=(1, 1), name = 'Dot30080', )([in0Dot30080,in1Dot30080])
Zer23685 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer23685', )(Dot30080)
Ave23733 = keras.layers.Average(name = 'Ave23733', )([Con46401,Zer23685])
model = tf.keras.models.Model(inputs=[in0Ave26356,in1Ave26356,in0Con48441,in0Dot39336,in1Dot39336,in0Con46401,in0Dot30080,in1Dot30080], outputs=Ave23733)
w = model.get_layer('Con11599').get_weights() 
w[0] = np.array([[[[[0.181], [0.6867], [0.648]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con11599').set_weights(w) 
w = model.get_layer('Con49183').get_weights() 
w[0] = np.array([[[[[0.9388, 0.6607], [0.6474, 0.9792], [0.8859, 0.5142]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con49183').set_weights(w) 
in0Ave26356 = tf.constant([[[[[0.2767, 0.3709], [0.8799, 0.0061]], [[0.8312, 0.6377], [0.3697, 0.0453]]]]])
in1Ave26356 = tf.constant([[[[[0.4543, 0.3717], [0.2804, 0.2748]], [[0.7053, 0.1298], [0.9899, 0.6403]]]]])
in0Con48441 = tf.constant([[[[[0.7394]]], [[[0.9066]]], [[[0.3481]]], [[[0.8375]]]]])
in0Dot39336 = tf.constant([[0.0569, 0.8036, 0.5264]])
in1Dot39336 = tf.constant([[0.7347, 0.3427, 0.1297]])
in0Con46401 = tf.constant([[[0.8824], [0.664], [0.3557], [0.0397]]])
in0Dot30080 = tf.constant([[[0.1841, 0.6692, 0.8192], [0.9426, 0.4935, 0.3324]]])
in1Dot30080 = tf.constant([[[0.6005, 0.0273, 0.707], [0.0301, 0.2814, 0.7723]]])
print (np.array2string(model.predict([in0Ave26356,in1Ave26356,in0Con48441,in0Dot39336,in1Dot39336,in0Con46401,in0Dot30080,in1Dot30080],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave23733.png')

LAve26356 = average_layer([[[[[[0.2767, 0.3709], [0.8799, 0.0061]], [[0.8312, 0.6377], [0.3697, 0.0453]]]]], [[[[[0.4543, 0.3717], [0.2804, 0.2748]], [[0.7053, 0.1298], [0.9899, 0.6403]]]]]], Ave26356), 
LRes87053 = reshape_layer(Ave26356, [1, 2, 4], Res87053), 
LGlo14297 = global_average_pooling2D_layer(Res87053, Glo14297), 
LRes86605 = reshape_layer(Glo14297, [4, 1], Res86605), 
LRes41855 = reshape_layer(Res86605, [4, 1, 1], Res41855), 
LRes22845 = reshape_layer(Res41855, [4, 1, 1, 1], Res22845), 
LCon48441 = concatenate_layer([Res22845,[[[[[0.7394]]], [[[0.9066]]], [[[0.3481]]], [[[0.8375]]]]]], 4, Con48441), 
LDot39336 = dot_layer([[0.0569, 0.8036, 0.5264]], [[0.7347, 0.3427, 0.1297]], 1, 1, Dot39336), 
LRes48339 = reshape_layer(Dot39336, [1, 1], Res48339), 
LRes8044 = reshape_layer(Res48339, [1, 1, 1], Res8044), 
LRes77431 = reshape_layer(Res8044, [1, 1, 1, 1], Res77431), 
LCon11599 = conv3D_transpose_layer(Res77431, 1, 1, 1,[[[[[0.181], [0.6867], [0.648]]]]],[0, 0, 0], 1, 1, 1, false, Con11599), 
LCon49183 = conv3D_layer(Con11599, 1, 1, 1,[[[[[0.9388, 0.6607], [0.6474, 0.9792], [0.8859, 0.5142]]]]],[0, 0], 1, 9, 7, false, 1, 1, 1, Con49183), 
LZer68804 = zero_padding3D_layer(Con49183, 3, 0, 0, 0, 0, 0, Zer68804), 
LMul71263 = multiply_layer([Con48441,Zer68804], Mul71263), 
LRes35923 = reshape_layer(Mul71263, [4, 1, 2], Res35923), 
LRes52510 = reshape_layer(Res35923, [4, 2], Res52510), 
LCon46401 = concatenate_layer([Res52510,[[[0.8824], [0.664], [0.3557], [0.0397]]]], 2, Con46401), 
LDot30080 = dot_layer([[[0.1841, 0.6692, 0.8192], [0.9426, 0.4935, 0.3324]]], [[[0.6005, 0.0273, 0.707], [0.0301, 0.2814, 0.7723]]], 1, 1, Dot30080), 
LZer23685 = zero_padding1D_layer(Dot30080, 1, 0, Zer23685), 
LAve23733 = average_layer([Con46401,Zer23685], Ave23733), 
exec_layers([LAve26356,LRes87053,LGlo14297,LRes86605,LRes41855,LRes22845,LCon48441,LDot39336,LRes48339,LRes8044,LRes77431,LCon11599,LCon49183,LZer68804,LMul71263,LRes35923,LRes52510,LCon46401,LDot30080,LZer23685,LAve23733],["Ave26356","Res87053","Glo14297","Res86605","Res41855","Res22845","Con48441","Dot39336","Res48339","Res8044","Res77431","Con11599","Con49183","Zer68804","Mul71263","Res35923","Res52510","Con46401","Dot30080","Zer23685","Ave23733"],Ave23733,"Ave23733")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.4412000], [0.0694622, 0.1351368, 0.7610643], [0.2083545, 0.0785700, 0.6049772], [0.3063183, 0.2395774, 0.4377935]]]

Expected (Unparsed): [[[0.0,0.0,0.4412],[0.06946215500000001,0.135136785,0.7610643400000001],[0.208354475,0.07857003,0.6049772250000001],[0.30631829146373024,0.23957739904831676,0.43779345999999997]]]

Actual:   [[[0, 0, 0.4412], [0.0695, 0.1352, 0.7611], [0.2084, 0.0786, 0.605], [0.3064, 0.2396, 0.4378]]]

Expected: [[[0, 0, 0.4412], [0.0695, 0.1352, 0.7611], [0.2084, 0.0786, 0.605], [0.3064, 0.2396, 0.4378]]]