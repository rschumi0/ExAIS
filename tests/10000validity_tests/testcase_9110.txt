import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot6347 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot6347 = tf.keras.layers.Input(shape=([2, 2]))
in0Con26958 = tf.keras.layers.Input(shape=([2, 1]))
in0Dot34751 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot34751 = tf.keras.layers.Input(shape=([3, 3]))
in0Con58864 = tf.keras.layers.Input(shape=([1, 23]))
in0Dot43408 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot43408 = tf.keras.layers.Input(shape=([2, 3]))
in0Con71559 = tf.keras.layers.Input(shape=([2, 1]))
in0Sub63850 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub63850 = tf.keras.layers.Input(shape=([2, 3]))
in0Con17271 = tf.keras.layers.Input(shape=([5, 4, 3, 1]))
in0Zer4580 = tf.keras.layers.Input(shape=([3, 2, 3]))
in0Con93811 = tf.keras.layers.Input(shape=([5, 4, 3, 1]))
in0Max18201 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Max18201 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

Dot6347 = keras.layers.Dot(axes=(1, 1), name = 'Dot6347', )([in0Dot6347,in1Dot6347])
Con26958 = keras.layers.Concatenate(axis=2, name = 'Con26958', )([Dot6347,in0Con26958])
Dot34751 = keras.layers.Dot(axes=(2, 2), name = 'Dot34751', )([in0Dot34751,in1Dot34751])
Dot36387 = keras.layers.Dot(axes=(2, 2), name = 'Dot36387', )([Con26958,Dot34751])
Res93241 = keras.layers.Reshape((2, 3, 1), name = 'Res93241', )(Dot36387)
Glo22356 = keras.layers.GlobalMaxPool2D(name = 'Glo22356', )(Res93241)
Res85391 = keras.layers.Reshape((1, 1), name = 'Res85391', )(Glo22356)
Con58864 = keras.layers.Concatenate(axis=2, name = 'Con58864', )([Res85391,in0Con58864])
Dot43408 = keras.layers.Dot(axes=(2, 2), name = 'Dot43408', )([in0Dot43408,in1Dot43408])
Bat86769 = keras.layers.BatchNormalization(axis=1, epsilon=0.1760050097355801,  name = 'Bat86769', )(Dot43408)
Con71559 = keras.layers.Concatenate(axis=2, name = 'Con71559', )([Bat86769,in0Con71559])
Sub63850 = keras.layers.Subtract(name = 'Sub63850', )([in0Sub63850,in1Sub63850])
Max15441 = keras.layers.Maximum(name = 'Max15441', )([Con71559,Sub63850])
Res59694 = keras.layers.Reshape((2, 3, 1), name = 'Res59694', )(Max15441)
Res44766 = keras.layers.Reshape((2, 3, 1, 1), name = 'Res44766', )(Res59694)
Zer56142 = keras.layers.ZeroPadding3D(padding=((3, 0), (1, 0), (2, 0)), name = 'Zer56142', )(Res44766)
Con17271 = keras.layers.Concatenate(axis=4, name = 'Con17271', )([Zer56142,in0Con17271])
Zer4580 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer4580', )(in0Zer4580)
Res10949 = keras.layers.Reshape((5, 4, 3, 1), name = 'Res10949', )(Zer4580)
Con93811 = keras.layers.Concatenate(axis=4, name = 'Con93811', )([Res10949,in0Con93811])
Max18201 = keras.layers.Maximum(name = 'Max18201', )([in0Max18201,in1Max18201])
Zer58728 = keras.layers.ZeroPadding3D(padding=((3, 0), (2, 0), (2, 0)), name = 'Zer58728', )(Max18201)
Sub94717 = keras.layers.Subtract(name = 'Sub94717', )([Con93811,Zer58728])
Sub76146 = keras.layers.Subtract(name = 'Sub76146', )([Con17271,Sub94717])
Res91609 = keras.layers.Reshape((5, 4, 6), name = 'Res91609', )(Sub76146)
Res3980 = keras.layers.Reshape((5, 24), name = 'Res3980', )(Res91609)
Dot13413 = keras.layers.Dot(axes=(2, 2), name = 'Dot13413', )([Con58864,Res3980])
model = tf.keras.models.Model(inputs=[in0Dot6347,in1Dot6347,in0Con26958,in0Dot34751,in1Dot34751,in0Con58864,in0Dot43408,in1Dot43408,in0Con71559,in0Sub63850,in1Sub63850,in0Con17271,in0Zer4580,in0Con93811,in0Max18201,in1Max18201], outputs=Dot13413)
w = model.get_layer('Bat86769').get_weights() 
w[0] = np.array([0.5607, 0.2859])
w[1] = np.array([0.4053, 0.3692])
w[2] = np.array([0.3383, 0.6231])
w[3] = np.array([0.2303, 0.5777])
model.get_layer('Bat86769').set_weights(w) 
in0Dot6347 = tf.constant([[[0.722, 0.3227], [0.9845, 0.9232]]])
in1Dot6347 = tf.constant([[[0.738, 0.4241], [0.9671, 0.2293]]])
in0Con26958 = tf.constant([[[0.4175], [0.4406]]])
in0Dot34751 = tf.constant([[[0.2663, 0.1303, 0.0936], [0.1381, 0.6353, 0.0899], [0.2231, 0.1184, 0.843]]])
in1Dot34751 = tf.constant([[[0.4208, 0.6901, 0.2912], [0.5482, 0.8471, 0.0089], [0.0679, 0.8205, 0.7233]]])
in0Con58864 = tf.constant([[[0.6061, 0.8404, 0.1565, 0.4609, 0.4773, 0.6845, 0.3427, 0.2068, 0.5284, 0.0451, 0.5508, 0.9397, 0.6609, 0.2941, 0.8744, 0.0329, 0.7484, 0.6709, 0.1119, 0.3856, 0.3946, 0.5375, 0.6481]]])
in0Dot43408 = tf.constant([[[0.4995, 0.064, 0.4098], [0.1027, 0.8767, 0.2769]]])
in1Dot43408 = tf.constant([[[0.2415, 0.8706, 0.6813], [0.8958, 0.8216, 0.0994]]])
in0Con71559 = tf.constant([[[0.4536], [0.4745]]])
in0Sub63850 = tf.constant([[[0.8012, 0.2662, 0.2452], [0.2104, 0.2276, 0.4727]]])
in1Sub63850 = tf.constant([[[0.5408, 0.2286, 0.625], [0.7199, 0.1539, 0.403]]])
in0Con17271 = tf.constant([[[[[0.1641], [0.7843], [0.0329]], [[0.4859], [0.6384], [0.7332]], [[0.3185], [0.5993], [0.5092]], [[0.5035], [0.5083], [0.6132]]], [[[0.839], [0.9633], [0.6793]], [[0.6056], [0.2388], [0.5758]], [[0.0405], [0.8409], [0.4221]], [[0.3207], [0.67], [0.1481]]], [[[0.5743], [0.335], [0.714]], [[0.1985], [0.8809], [0.2184]], [[0.0116], [0.3494], [0.1541]], [[0.3059], [0.0397], [0.531]]], [[[0.0047], [0.7219], [0.4023]], [[0.1183], [0.4156], [0.7014]], [[0.8297], [0.8539], [0.8906]], [[0.4865], [0.7973], [0.6633]]], [[[0.5774], [0.0884], [0.4265]], [[0.641], [0.8918], [0.3447]], [[0.2873], [0.5752], [0.2074]], [[0.9931], [0.0868], [0.1269]]]]])
in0Zer4580 = tf.constant([[[[1.2529, 1.1965, 1.4788], [1.7301, 1.272, 1.3864]], [[1.4765, 1.4691, 1.4917], [1.8554, 1.5866, 1.5632]], [[1.1705, 1.3876, 1.3337], [1.9938, 1.5698, 1.9699]]]])
in0Con93811 = tf.constant([[[[[0.5201], [0.3471], [0.1844]], [[0.2476], [0.278], [0.5209]], [[0.1402], [0.2871], [0.1865]], [[0.3495], [0.5393], [0.3266]]], [[[0.2045], [0.8564], [0.5415]], [[0.304], [0.1762], [0.0537]], [[0.6715], [0.0749], [0.1705]], [[0.323], [0.0987], [0.9026]]], [[[0.6005], [0.1112], [0.2178]], [[0.264], [0.9114], [0.935]], [[0.6951], [0.2324], [0.1979]], [[0.3528], [0.4746], [0.7516]]], [[[0.4494], [0.2584], [0.8486]], [[0.7043], [0.2522], [0.5808]], [[0.5876], [0.7957], [0.6829]], [[0.2285], [0.2996], [0.921]]], [[[0.8153], [0.9134], [0.6405]], [[0.8684], [0.7351], [0.3032]], [[0.7345], [0.9206], [0.2052]], [[0.8105], [0.1784], [0.1587]]]]])
in0Max18201 = tf.constant([[[[[0.258, 0.4854]], [[0.577, 0.5319]]], [[[0.0588, 0.6508]], [[0.8661, 0.5358]]]]])
in1Max18201 = tf.constant([[[[[0.1286, 0.6234]], [[0.7425, 0.4808]]], [[[0.9775, 0.4538]], [[0.0313, 0.1382]]]]])
print (np.array2string(model.predict([in0Dot6347,in1Dot6347,in0Con26958,in0Dot34751,in1Dot34751,in0Con58864,in0Dot43408,in1Dot43408,in0Con71559,in0Sub63850,in1Sub63850,in0Con17271,in0Zer4580,in0Con93811,in0Max18201,in1Max18201],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot13413.png')

LDot6347 = dot_layer([[[0.722, 0.3227], [0.9845, 0.9232]]], [[[0.738, 0.4241], [0.9671, 0.2293]]], 1, 1, Dot6347), 
LCon26958 = concatenate_layer([Dot6347,[[[0.4175], [0.4406]]]], 2, Con26958), 
LDot34751 = dot_layer([[[0.2663, 0.1303, 0.0936], [0.1381, 0.6353, 0.0899], [0.2231, 0.1184, 0.843]]], [[[0.4208, 0.6901, 0.2912], [0.5482, 0.8471, 0.0089], [0.0679, 0.8205, 0.7233]]], 2, 2, Dot34751), 
LDot36387 = dot_layer(Con26958,Dot34751, 2, 2, Dot36387), 
LRes93241 = reshape_layer(Dot36387, [2, 3, 1], Res93241), 
LGlo22356 = global_max_pool2D_layer(Res93241, Glo22356), 
LRes85391 = reshape_layer(Glo22356, [1, 1], Res85391), 
LCon58864 = concatenate_layer([Res85391,[[[0.6061, 0.8404, 0.1565, 0.4609, 0.4773, 0.6845, 0.3427, 0.2068, 0.5284, 0.0451, 0.5508, 0.9397, 0.6609, 0.2941, 0.8744, 0.0329, 0.7484, 0.6709, 0.1119, 0.3856, 0.3946, 0.5375, 0.6481]]]], 2, Con58864), 
LDot43408 = dot_layer([[[0.4995, 0.064, 0.4098], [0.1027, 0.8767, 0.2769]]], [[[0.2415, 0.8706, 0.6813], [0.8958, 0.8216, 0.0994]]], 2, 2, Dot43408), 
LBat86769 = batch_normalization_layer(Dot43408, 1, 0.1760050097355801, [0.5607, 0.2859], [0.4053, 0.3692], [0.3383, 0.6231], [0.2303, 0.5777], Bat86769), 
LCon71559 = concatenate_layer([Bat86769,[[[0.4536], [0.4745]]]], 2, Con71559), 
LSub63850 = subtract_layer([[[0.8012, 0.2662, 0.2452], [0.2104, 0.2276, 0.4727]]], [[[0.5408, 0.2286, 0.625], [0.7199, 0.1539, 0.403]]], Sub63850), 
LMax15441 = maximum_layer([Con71559,Sub63850], Max15441), 
LRes59694 = reshape_layer(Max15441, [2, 3, 1], Res59694), 
LRes44766 = reshape_layer(Res59694, [2, 3, 1, 1], Res44766), 
LZer56142 = zero_padding3D_layer(Res44766, 3, 0, 1, 0, 2, 0, Zer56142), 
LCon17271 = concatenate_layer([Zer56142,[[[[[0.1641], [0.7843], [0.0329]], [[0.4859], [0.6384], [0.7332]], [[0.3185], [0.5993], [0.5092]], [[0.5035], [0.5083], [0.6132]]], [[[0.839], [0.9633], [0.6793]], [[0.6056], [0.2388], [0.5758]], [[0.0405], [0.8409], [0.4221]], [[0.3207], [0.67], [0.1481]]], [[[0.5743], [0.335], [0.714]], [[0.1985], [0.8809], [0.2184]], [[0.0116], [0.3494], [0.1541]], [[0.3059], [0.0397], [0.531]]], [[[0.0047], [0.7219], [0.4023]], [[0.1183], [0.4156], [0.7014]], [[0.8297], [0.8539], [0.8906]], [[0.4865], [0.7973], [0.6633]]], [[[0.5774], [0.0884], [0.4265]], [[0.641], [0.8918], [0.3447]], [[0.2873], [0.5752], [0.2074]], [[0.9931], [0.0868], [0.1269]]]]]], 4, Con17271), 
LZer4580 = zero_padding2D_layer([[[[1.2529, 1.1965, 1.4788], [1.7301, 1.272, 1.3864]], [[1.4765, 1.4691, 1.4917], [1.8554, 1.5866, 1.5632]], [[1.1705, 1.3876, 1.3337], [1.9938, 1.5698, 1.9699]]]], 1, 1, 1, 1, Zer4580), 
LRes10949 = reshape_layer(Zer4580, [5, 4, 3, 1], Res10949), 
LCon93811 = concatenate_layer([Res10949,[[[[[0.5201], [0.3471], [0.1844]], [[0.2476], [0.278], [0.5209]], [[0.1402], [0.2871], [0.1865]], [[0.3495], [0.5393], [0.3266]]], [[[0.2045], [0.8564], [0.5415]], [[0.304], [0.1762], [0.0537]], [[0.6715], [0.0749], [0.1705]], [[0.323], [0.0987], [0.9026]]], [[[0.6005], [0.1112], [0.2178]], [[0.264], [0.9114], [0.935]], [[0.6951], [0.2324], [0.1979]], [[0.3528], [0.4746], [0.7516]]], [[[0.4494], [0.2584], [0.8486]], [[0.7043], [0.2522], [0.5808]], [[0.5876], [0.7957], [0.6829]], [[0.2285], [0.2996], [0.921]]], [[[0.8153], [0.9134], [0.6405]], [[0.8684], [0.7351], [0.3032]], [[0.7345], [0.9206], [0.2052]], [[0.8105], [0.1784], [0.1587]]]]]], 4, Con93811), 
LMax18201 = maximum_layer([[[[[[0.258, 0.4854]], [[0.577, 0.5319]]], [[[0.0588, 0.6508]], [[0.8661, 0.5358]]]]], [[[[[0.1286, 0.6234]], [[0.7425, 0.4808]]], [[[0.9775, 0.4538]], [[0.0313, 0.1382]]]]]], Max18201), 
LZer58728 = zero_padding3D_layer(Max18201, 3, 0, 2, 0, 2, 0, Zer58728), 
LSub94717 = subtract_layer(Con93811,Zer58728, Sub94717), 
LSub76146 = subtract_layer(Con17271,Sub94717, Sub76146), 
LRes91609 = reshape_layer(Sub76146, [5, 4, 6], Res91609), 
LRes3980 = reshape_layer(Res91609, [5, 24], Res3980), 
LDot13413 = dot_layer(Con58864,Res3980, 2, 2, Dot13413), 
exec_layers([LDot6347,LCon26958,LDot34751,LDot36387,LRes93241,LGlo22356,LRes85391,LCon58864,LDot43408,LBat86769,LCon71559,LSub63850,LMax15441,LRes59694,LRes44766,LZer56142,LCon17271,LZer4580,LRes10949,LCon93811,LMax18201,LZer58728,LSub94717,LSub76146,LRes91609,LRes3980,LDot13413],["Dot6347","Con26958","Dot34751","Dot36387","Res93241","Glo22356","Res85391","Con58864","Dot43408","Bat86769","Con71559","Sub63850","Max15441","Res59694","Res44766","Zer56142","Con17271","Zer4580","Res10949","Con93811","Max18201","Zer58728","Sub94717","Sub76146","Res91609","Res3980","Dot13413"],Dot13413,"Dot13413")

Actual (Unparsed): [[[0.9924552, -2.1488956, -4.5226334, -2.0770667, 0.6434754]]]

Expected (Unparsed): [[[0.9924551500000001,-2.14889568,-4.5226334900000005,-2.0770666669402265,0.6434753097920138]]]

Actual:   [[[0.9925, -2.1488, -4.5226, -2.077, 0.6435]]]

Expected: [[[0.9925, -2.1488, -4.5226, -2.077, 0.6435]]]