import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub17002 = tf.keras.layers.Input(shape=([2, 3, 3]))
in1Sub17002 = tf.keras.layers.Input(shape=([2, 3, 3]))
in0Add16430 = tf.keras.layers.Input(shape=([2, 2]))
in1Add16430 = tf.keras.layers.Input(shape=([2, 2]))
in0Con59807 = tf.keras.layers.Input(shape=([2, 7]))

Sub17002 = keras.layers.Subtract(name = 'Sub17002', )([in0Sub17002,in1Sub17002])
Res49063 = keras.layers.Reshape((2, 9), name = 'Res49063', )(Sub17002)
Add16430 = keras.layers.Add(name = 'Add16430', )([in0Add16430,in1Add16430])
Con59807 = keras.layers.Concatenate(axis=2, name = 'Con59807', )([Add16430,in0Con59807])
Ave94268 = keras.layers.Average(name = 'Ave94268', )([Res49063,Con59807])
model = tf.keras.models.Model(inputs=[in0Sub17002,in1Sub17002,in0Add16430,in1Add16430,in0Con59807], outputs=Ave94268)
in0Sub17002 = tf.constant([[[[0.5526, 0.8405, 0.6344], [0.6649, 0.9581, 0.5183], [0.7104, 0.7011, 0.0327]], [[0.0891, 0.7466, 0.1232], [0.5267, 0.5457, 0.885], [0.1893, 0.3857, 0.2997]]]])
in1Sub17002 = tf.constant([[[[0.5305, 0.8712, 0.72], [0.8408, 0.0418, 0.8582], [0.5045, 0.6815, 0.8073]], [[0.0741, 0.1142, 0.7659], [0.3297, 0.5373, 0.4998], [0.543, 0.5939, 0.4858]]]])
in0Add16430 = tf.constant([[[0.6664, 0.3316], [0.3064, 0.6998]]])
in1Add16430 = tf.constant([[[0.1295, 0.4374], [0.5574, 0.8621]]])
in0Con59807 = tf.constant([[[0.8727, 0.41, 0.7938, 0.1165, 0.07, 0.3212, 0.5157], [0.9767, 0.6721, 0.0222, 0.5349, 0.8699, 0.434, 0.4608]]])
print (np.array2string(model.predict([in0Sub17002,in1Sub17002,in0Add16430,in1Add16430,in0Con59807],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave94268.png')

LSub17002 = subtract_layer([[[[0.5526, 0.8405, 0.6344], [0.6649, 0.9581, 0.5183], [0.7104, 0.7011, 0.0327]], [[0.0891, 0.7466, 0.1232], [0.5267, 0.5457, 0.885], [0.1893, 0.3857, 0.2997]]]], [[[[0.5305, 0.8712, 0.72], [0.8408, 0.0418, 0.8582], [0.5045, 0.6815, 0.8073]], [[0.0741, 0.1142, 0.7659], [0.3297, 0.5373, 0.4998], [0.543, 0.5939, 0.4858]]]], Sub17002), 
LRes49063 = reshape_layer(Sub17002, [2, 9], Res49063), 
LAdd16430 = add_layer([[[[0.6664, 0.3316], [0.3064, 0.6998]]], [[[0.1295, 0.4374], [0.5574, 0.8621]]]], Add16430), 
LCon59807 = concatenate_layer([Add16430,[[[0.8727, 0.41, 0.7938, 0.1165, 0.07, 0.3212, 0.5157], [0.9767, 0.6721, 0.0222, 0.5349, 0.8699, 0.434, 0.4608]]]], 2, Con59807), 
LAve94268 = average_layer([Res49063,Con59807], Ave94268), 
exec_layers([LSub17002,LRes49063,LAdd16430,LCon59807,LAve94268],["Sub17002","Res49063","Add16430","Con59807","Ave94268"],Ave94268,"Ave94268")

Actual (Unparsed): [[[0.4090000, 0.3691500, 0.3935500, 0.1170500, 0.8550500, -0.1117000, 0.1379500, 0.1704000, -0.1294500], [0.4394000, 1.0971500, 0.1670000, 0.4345500, 0.0153000, 0.4600500, 0.2581000, 0.1129000, 0.1373500]]]

Expected (Unparsed): [[[0.40900000000000003,0.36915000000000003,0.39355,0.11705000000000002,0.85505,-0.1117,0.13795000000000004,0.17039999999999997,-0.12945],[0.4394,1.09715,0.16699999999999998,0.43455,0.015299999999999982,0.46005,0.2581,0.1129,0.13735]]]

Actual:   [[[0.409, 0.3692, 0.3936, 0.1171, 0.8551, -0.1117, 0.138, 0.1704, -0.1294], [0.4394, 1.0972, 0.167, 0.4346, 0.0153, 0.4601, 0.2581, 0.1129, 0.1374]]]

Expected: [[[0.4091, 0.3692, 0.3936, 0.1171, 0.8551, -0.1117, 0.138, 0.1704, -0.1294], [0.4394, 1.0972, 0.167, 0.4346, 0.0153, 0.4601, 0.2581, 0.1129, 0.1374]]]