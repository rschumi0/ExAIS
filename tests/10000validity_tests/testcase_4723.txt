import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con61503 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0GRU31498 = tf.keras.layers.Input(shape=([2, 2]))
in0Con46901 = tf.keras.layers.Input(shape=([1, 1]))
in0Max79631 = tf.keras.layers.Input(shape=([1, 2]))
in1Max79631 = tf.keras.layers.Input(shape=([1, 2]))
in0Con6001 = tf.keras.layers.Input(shape=([1, 6]))
in0Dot32635 = tf.keras.layers.Input(shape=([2]))
in1Dot32635 = tf.keras.layers.Input(shape=([2]))
in0Con82450 = tf.keras.layers.Input(shape=([7]))

Con61503 = keras.layers.Conv3DTranspose(4, (1, 1, 1),strides=(1, 1, 1), padding='same', name = 'Con61503', )(in0Con61503)
Lea54373 = keras.layers.LeakyReLU(alpha=7.426439126193115, name = 'Lea54373', )(Con61503)
Res76640 = keras.layers.Reshape((1, 1, 8), name = 'Res76640', )(Lea54373)
Res89363 = keras.layers.Reshape((1, 8), name = 'Res89363', )(Res76640)
GRU31498 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU31498', )(in0GRU31498)
Res52247 = keras.layers.Reshape((1, 1), name = 'Res52247', )(GRU31498)
Con46901 = keras.layers.Concatenate(axis=2, name = 'Con46901', )([Res52247,in0Con46901])
Max79631 = keras.layers.Maximum(name = 'Max79631', )([in0Max79631,in1Max79631])
Add77962 = keras.layers.Add(name = 'Add77962', )([Con46901,Max79631])
Con6001 = keras.layers.Concatenate(axis=2, name = 'Con6001', )([Add77962,in0Con6001])
Mul36492 = keras.layers.Multiply(name = 'Mul36492', )([Res89363,Con6001])
Fla17965 = keras.layers.Flatten(name = 'Fla17965', )(Mul36492)
Dot32635 = keras.layers.Dot(axes=(1, 1), name = 'Dot32635', )([in0Dot32635,in1Dot32635])
Con82450 = keras.layers.Concatenate(axis=1, name = 'Con82450', )([Dot32635,in0Con82450])
Sub33724 = keras.layers.Subtract(name = 'Sub33724', )([Fla17965,Con82450])
model = tf.keras.models.Model(inputs=[in0Con61503,in0GRU31498,in0Con46901,in0Max79631,in1Max79631,in0Con6001,in0Dot32635,in1Dot32635,in0Con82450], outputs=Sub33724)
w = model.get_layer('Con61503').get_weights() 
w[0] = np.array([[[[[0.0266], [0.1781], [0.3583], [0.3529]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con61503').set_weights(w) 
w = model.get_layer('GRU31498').get_weights() 
w[0] = np.array([[10, 6, 1], [2, 4, 2]])
w[1] = np.array([[4, 5, 10]])
w[2] = np.array([9, 5, 2])
model.get_layer('GRU31498').set_weights(w) 
in0Con61503 = tf.constant([[[[[0.6872], [0.4382]]]]])
in0GRU31498 = tf.constant([[[4, 10], [5, 10]]])
in0Con46901 = tf.constant([[[0.5195]]])
in0Max79631 = tf.constant([[[0.4864, 0.5333]]])
in1Max79631 = tf.constant([[[0.9585, 0.7684]]])
in0Con6001 = tf.constant([[[0.5624, 0.6276, 0.274, 0.0652, 0.7155, 0.5791]]])
in0Dot32635 = tf.constant([[0.089, 0.9497]])
in1Dot32635 = tf.constant([[0.3868, 0.0625]])
in0Con82450 = tf.constant([[0.5602, 0.101, 0.1402, 0.7834, 0.7356, 0.0424, 0.3068]])
print (np.array2string(model.predict([in0Con61503,in0GRU31498,in0Con46901,in0Max79631,in1Max79631,in0Con6001,in0Dot32635,in1Dot32635,in0Con82450],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub33724.png')

LCon61503 = conv3D_transpose_layer([[[[[0.6872], [0.4382]]]]], 1, 1, 1,[[[[[0.0266], [0.1781], [0.3583], [0.3529]]]]],[0, 0, 0, 0], 1, 1, 1, true, Con61503), 
LLea54373 = leaky_relu_layer(Con61503, 7.426439126193115, Lea54373), 
LRes76640 = reshape_layer(Lea54373, [1, 1, 8], Res76640), 
LRes89363 = reshape_layer(Res76640, [1, 8], Res89363), 
LGRU31498 = gru_layer([[[4, 10], [5, 10]]],[[10, 6, 1], [2, 4, 2]],[[4, 5, 10]],[9, 5, 2], false, GRU31498), 
LRes52247 = reshape_layer(GRU31498, [1, 1], Res52247), 
LCon46901 = concatenate_layer([Res52247,[[[0.5195]]]], 2, Con46901), 
LMax79631 = maximum_layer([[[[0.4864, 0.5333]]], [[[0.9585, 0.7684]]]], Max79631), 
LAdd77962 = add_layer([Con46901,Max79631], Add77962), 
LCon6001 = concatenate_layer([Add77962,[[[0.5624, 0.6276, 0.274, 0.0652, 0.7155, 0.5791]]]], 2, Con6001), 
LMul36492 = multiply_layer([Res89363,Con6001], Mul36492), 
LFla17965 = flatten_layer(Mul36492, Fla17965), 
LDot32635 = dot_layer([[0.089, 0.9497]], [[0.3868, 0.0625]], 1, 1, Dot32635), 
LCon82450 = concatenate_layer([Dot32635,[[0.5602, 0.101, 0.1402, 0.7834, 0.7356, 0.0424, 0.3068]]], 1, Con82450), 
LSub33724 = subtract_layer(Fla17965,Con82450, Sub33724), 
exec_layers([LCon61503,LLea54373,LRes76640,LRes89363,LGRU31498,LRes52247,LCon46901,LMax79631,LAdd77962,LCon6001,LMul36492,LFla17965,LDot32635,LCon82450,LSub33724],["Con61503","Lea54373","Res76640","Res89363","GRU31498","Res52247","Con46901","Max79631","Add77962","Con6001","Mul36492","Fla17965","Dot32635","Con82450","Sub33724"],Sub33724,"Sub33724")

Actual (Unparsed): [[-0.0762605, -0.4025735, 0.0374762, 0.0120011, -0.7802062, -0.7305116, 0.0699386, -0.2172475]]

Expected (Unparsed): [[-0.07626053007999999,-0.402573506872,0.03747624262400001,0.012001083488000025,-0.78020622312,-0.730511569016,0.06993855143,-0.21724752430200003]]

Actual:   [[-0.0762, -0.4025, 0.0375, 0.0121, -0.7802, -0.7305, 0.07, -0.2172]]

Expected: [[-0.0762, -0.4025, 0.0375, 0.0121, -0.7802, -0.7305, 0.07, -0.2172]]