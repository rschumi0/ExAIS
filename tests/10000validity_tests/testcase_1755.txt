import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max87906 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Max77232 = tf.keras.layers.Input(shape=([2, 2]))
in1Max77232 = tf.keras.layers.Input(shape=([2, 2]))
in0Ave25370 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Ave25370 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))

Max87906 = keras.layers.MaxPool2D(pool_size=(2, 1), strides=(2, 1), padding='valid', name = 'Max87906', )(in0Max87906)
Zer68762 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer68762', )(Max87906)
Max77232 = keras.layers.Maximum(name = 'Max77232', )([in0Max77232,in1Max77232])
Res48052 = keras.layers.Reshape((2, 2, 1), name = 'Res48052', )(Max77232)
Ave25370 = keras.layers.Average(name = 'Ave25370', )([in0Ave25370,in1Ave25370])
Res44612 = keras.layers.Reshape((2, 2, 1), name = 'Res44612', )(Ave25370)
Mul23852 = keras.layers.Multiply(name = 'Mul23852', )([Res48052,Res44612])
Sub43146 = keras.layers.Subtract(name = 'Sub43146', )([Zer68762,Mul23852])
model = tf.keras.models.Model(inputs=[in0Max87906,in0Max77232,in1Max77232,in0Ave25370,in1Ave25370], outputs=Sub43146)
in0Max87906 = tf.constant([[[[1.4179]], [[1.5862]]]])
in0Max77232 = tf.constant([[[0.2941, 0.1994], [0.5648, 0.3481]]])
in1Max77232 = tf.constant([[[0.8008, 0.8366], [0.1334, 0.2425]]])
in0Ave25370 = tf.constant([[[[[0.3679], [0.4448]], [[0.2501], [0.8765]]]]])
in1Ave25370 = tf.constant([[[[[0.3104], [0.0196]], [[0.2575], [0.7009]]]]])
print (np.array2string(model.predict([in0Max87906,in0Max77232,in1Max77232,in0Ave25370,in1Ave25370],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub43146.png')

LMax87906 = max_pool2D_layer([[[[1.4179]], [[1.5862]]]], 2, 1, 2, 1, false, Max87906), 
LZer68762 = zero_padding2D_layer(Max87906, 1, 0, 1, 0, Zer68762), 
LMax77232 = maximum_layer([[[[0.2941, 0.1994], [0.5648, 0.3481]]], [[[0.8008, 0.8366], [0.1334, 0.2425]]]], Max77232), 
LRes48052 = reshape_layer(Max77232, [2, 2, 1], Res48052), 
LAve25370 = average_layer([[[[[[0.3679], [0.4448]], [[0.2501], [0.8765]]]]], [[[[[0.3104], [0.0196]], [[0.2575], [0.7009]]]]]], Ave25370), 
LRes44612 = reshape_layer(Ave25370, [2, 2, 1], Res44612), 
LMul23852 = multiply_layer([Res48052,Res44612], Mul23852), 
LSub43146 = subtract_layer(Zer68762,Mul23852, Sub43146), 
exec_layers([LMax87906,LZer68762,LMax77232,LRes48052,LAve25370,LRes44612,LMul23852,LSub43146],["Max87906","Zer68762","Max77232","Res48052","Ave25370","Res44612","Mul23852","Sub43146"],Sub43146,"Sub43146")

Actual (Unparsed): [[[[-0.2715913], [-0.1942585]], [[-0.1433462], [1.3116535]]]]

Expected (Unparsed): [[[[-0.27159131999999997],[-0.19425852]],[[-0.14334624],[1.31165353]]]]

Actual:   [[[[-0.2715], [-0.1942]], [[-0.1433], [1.3117]]]]

Expected: [[[[-0.2715], [-0.1942]], [[-0.1433], [1.3117]]]]