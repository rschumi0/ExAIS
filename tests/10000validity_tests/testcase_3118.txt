import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min56398 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Min56398 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0PRe95749 = tf.keras.layers.Input(shape=([2, 1]))
in0Sub63180 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub63180 = tf.keras.layers.Input(shape=([3, 2]))

Min56398 = keras.layers.Minimum(name = 'Min56398', )([in0Min56398,in1Min56398])
Res19954 = keras.layers.Reshape((1, 2, 4), name = 'Res19954', )(Min56398)
Cro56212 = keras.layers.Cropping2D(cropping=((0, 0), (0, 1)), name = 'Cro56212', )(Res19954)
Res53416 = keras.layers.Reshape((1, 4), name = 'Res53416', )(Cro56212)
GRU83624 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU83624', )(Res53416)
Res48925 = keras.layers.Reshape((2, 1), name = 'Res48925', )(GRU83624)
Res51860 = keras.layers.Reshape((2, 1, 1), name = 'Res51860', )(Res48925)
Res74359 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res74359', )(Res51860)
Glo71257 = keras.layers.GlobalAveragePooling3D(name = 'Glo71257', )(Res74359)
Res71944 = keras.layers.Reshape((1, 1), name = 'Res71944', )(Glo71257)
Zer19436 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer19436', )(Res71944)
PRe95749 = keras.layers.PReLU(name = 'PRe95749', input_shape=(2, 1))(in0PRe95749)
Ave48247 = keras.layers.Average(name = 'Ave48247', )([Zer19436,PRe95749])
Fla58968 = keras.layers.Flatten(name = 'Fla58968', )(Ave48247)
Sub63180 = keras.layers.Subtract(name = 'Sub63180', )([in0Sub63180,in1Sub63180])
Sim58683 = keras.layers.SimpleRNN(2,name = 'Sim58683', )(Sub63180)
Ave26215 = keras.layers.Average(name = 'Ave26215', )([Fla58968,Sim58683])
model = tf.keras.models.Model(inputs=[in0Min56398,in1Min56398,in0PRe95749,in0Sub63180,in1Sub63180], outputs=Ave26215)
w = model.get_layer('GRU83624').get_weights() 
w[0] = np.array([[4, 8, 1, 1, 9, 5], [10, 2, 10, 9, 8, 10], [6, 1, 9, 5, 7, 6], [10, 10, 10, 9, 3, 4]])
w[1] = np.array([[5, 1, 3, 4, 2, 2], [3, 7, 2, 10, 9, 1]])
w[2] = np.array([3, 5, 8, 2, 10, 2])
model.get_layer('GRU83624').set_weights(w) 
w = model.get_layer('PRe95749').get_weights() 
w[0] = np.array([[0.7885], [0.0783]])
model.get_layer('PRe95749').set_weights(w) 
w = model.get_layer('Sim58683').get_weights() 
w[0] = np.array([[5, 2], [3, 10]])
w[1] = np.array([[2, 2], [8, 10]])
w[2] = np.array([5, 1])
model.get_layer('Sim58683').set_weights(w) 
in0Min56398 = tf.constant([[[[[0.1305, 0.3117], [0.4441, 0.6262]], [[0.1455, 0.2927], [0.0739, 0.2128]]]]])
in1Min56398 = tf.constant([[[[[0.8736, 0.505], [0.4625, 0.9199]], [[0.3792, 0.8328], [0.4003, 0.5363]]]]])
in0PRe95749 = tf.constant([[[0.5861], [0.8032]]])
in0Sub63180 = tf.constant([[[0.6601, 0.2584], [0.8986, 0.3895], [0.2949, 0.2992]]])
in1Sub63180 = tf.constant([[[0.9802, 0.9795], [0.8113, 0.7749], [0.7678, 0.2422]]])
print (np.array2string(model.predict([in0Min56398,in1Min56398,in0PRe95749,in0Sub63180,in1Sub63180],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave26215.png')

LMin56398 = minimum_layer([[[[[[0.1305, 0.3117], [0.4441, 0.6262]], [[0.1455, 0.2927], [0.0739, 0.2128]]]]], [[[[[0.8736, 0.505], [0.4625, 0.9199]], [[0.3792, 0.8328], [0.4003, 0.5363]]]]]], Min56398), 
LRes19954 = reshape_layer(Min56398, [1, 2, 4], Res19954), 
LCro56212 = cropping2D_layer(Res19954, 0, 0, 0, 1, Cro56212), 
LRes53416 = reshape_layer(Cro56212, [1, 4], Res53416), 
LGRU83624 = gru_layer(Res53416,[[4, 8, 1, 1, 9, 5], [10, 2, 10, 9, 8, 10], [6, 1, 9, 5, 7, 6], [10, 10, 10, 9, 3, 4]],[[5, 1, 3, 4, 2, 2], [3, 7, 2, 10, 9, 1]],[3, 5, 8, 2, 10, 2], false, GRU83624), 
LRes48925 = reshape_layer(GRU83624, [2, 1], Res48925), 
LRes51860 = reshape_layer(Res48925, [2, 1, 1], Res51860), 
LRes74359 = reshape_layer(Res51860, [2, 1, 1, 1], Res74359), 
LGlo71257 = global_average_pooling3D_layer(Res74359, Glo71257), 
LRes71944 = reshape_layer(Glo71257, [1, 1], Res71944), 
LZer19436 = zero_padding1D_layer(Res71944, 1, 0, Zer19436), 
LPRe95749 = prelu_layer([[[0.5861], [0.8032]]], [[0.7885], [0.0783]], PRe95749), 
LAve48247 = average_layer([Zer19436,PRe95749], Ave48247), 
LFla58968 = flatten_layer(Ave48247, Fla58968), 
LSub63180 = subtract_layer([[[0.6601, 0.2584], [0.8986, 0.3895], [0.2949, 0.2992]]], [[[0.9802, 0.9795], [0.8113, 0.7749], [0.7678, 0.2422]]], Sub63180), 
LSim58683 = simple_rnn_layer(Sub63180,[[5, 2], [3, 10]],[[2, 2], [8, 10]],[5, 1], Sim58683), 
LAve26215 = average_layer([Fla58968,Sim58683], Ave26215), 
exec_layers([LMin56398,LRes19954,LCro56212,LRes53416,LGRU83624,LRes48925,LRes51860,LRes74359,LGlo71257,LRes71944,LZer19436,LPRe95749,LAve48247,LFla58968,LSub63180,LSim58683,LAve26215],["Min56398","Res19954","Cro56212","Res53416","GRU83624","Res48925","Res51860","Res74359","Glo71257","Res71944","Zer19436","PRe95749","Ave48247","Fla58968","Sub63180","Sim58683","Ave26215"],Ave26215,"Ave26215")

Actual (Unparsed): [[-0.3534744, -0.2991998]]

Expected (Unparsed): [[-0.3534743534402821,-0.2991997836508562]]

Actual:   [[-0.3534, -0.2991]]

Expected: [[-0.3534, -0.2991]]