import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min36080 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Min36080 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Dot80115 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot80115 = tf.keras.layers.Input(shape=([2, 2]))
in0Zer81375 = tf.keras.layers.Input(shape=([3, 2]))

Min36080 = keras.layers.Minimum(name = 'Min36080', )([in0Min36080,in1Min36080])
Res13167 = keras.layers.Reshape((2, 2, 1), name = 'Res13167', )(Min36080)
Res44589 = keras.layers.Reshape((2, 2), name = 'Res44589', )(Res13167)
Dot80115 = keras.layers.Dot(axes=(1, 1), name = 'Dot80115', )([in0Dot80115,in1Dot80115])
Dot34828 = keras.layers.Dot(axes=(2, 1), name = 'Dot34828', )([Res44589,Dot80115])
GRU34454 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU34454', )(Dot34828)
Zer81375 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer81375', )(in0Zer81375)
Res44290 = keras.layers.Reshape((5, 2, 1), name = 'Res44290', )(Zer81375)
Res57787 = keras.layers.Reshape((5, 2, 1, 1), name = 'Res57787', )(Res44290)
Glo99190 = keras.layers.GlobalMaxPool3D(name = 'Glo99190', )(Res57787)
Add27703 = keras.layers.Add(name = 'Add27703', )([GRU34454,Glo99190])
model = tf.keras.models.Model(inputs=[in0Min36080,in1Min36080,in0Dot80115,in1Dot80115,in0Zer81375], outputs=Add27703)
w = model.get_layer('GRU34454').get_weights() 
w[0] = np.array([[5, 7, 2], [10, 6, 10]])
w[1] = np.array([[4, 2, 1]])
w[2] = np.array([2, 10, 10])
model.get_layer('GRU34454').set_weights(w) 
in0Min36080 = tf.constant([[[[[0.6445]], [[0.3988]]], [[[0.4369]], [[0.0619]]]]])
in1Min36080 = tf.constant([[[[[0.4607]], [[0.0142]]], [[[0.3984]], [[0.962]]]]])
in0Dot80115 = tf.constant([[[0.9406, 0.3473], [0.2411, 0.6616]]])
in1Dot80115 = tf.constant([[[0.5728, 0.8304], [0.7085, 0.8564]]])
in0Zer81375 = tf.constant([[[1.3061, 1.6976], [1.1803, 1.4756], [1.0411, 1.3733]]])
print (np.array2string(model.predict([in0Min36080,in1Min36080,in0Dot80115,in1Dot80115,in0Zer81375],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add27703.png')

LMin36080 = minimum_layer([[[[[[0.6445]], [[0.3988]]], [[[0.4369]], [[0.0619]]]]], [[[[[0.4607]], [[0.0142]]], [[[0.3984]], [[0.962]]]]]], Min36080), 
LRes13167 = reshape_layer(Min36080, [2, 2, 1], Res13167), 
LRes44589 = reshape_layer(Res13167, [2, 2], Res44589), 
LDot80115 = dot_layer([[[0.9406, 0.3473], [0.2411, 0.6616]]], [[[0.5728, 0.8304], [0.7085, 0.8564]]], 1, 1, Dot80115), 
LDot34828 = dot_layer(Res44589,Dot80115, 2, 1, Dot34828), 
LGRU34454 = gru_layer(Dot34828,[[5, 7, 2], [10, 6, 10]],[[4, 2, 1]],[2, 10, 10], false, GRU34454), 
LZer81375 = zero_padding1D_layer([[[1.3061, 1.6976], [1.1803, 1.4756], [1.0411, 1.3733]]], 1, 1, Zer81375), 
LRes44290 = reshape_layer(Zer81375, [5, 2, 1], Res44290), 
LRes57787 = reshape_layer(Res44290, [5, 2, 1, 1], Res57787), 
LGlo99190 = global_max_pool3D_layer(Res57787, Glo99190), 
LAdd27703 = add_layer([GRU34454,Glo99190], Add27703), 
exec_layers([LMin36080,LRes13167,LRes44589,LDot80115,LDot34828,LGRU34454,LZer81375,LRes44290,LRes57787,LGlo99190,LAdd27703],["Min36080","Res13167","Res44589","Dot80115","Dot34828","GRU34454","Zer81375","Res44290","Res57787","Glo99190","Add27703"],Add27703,"Add27703")

Actual (Unparsed): [[1.6981437]]

Expected (Unparsed): [[1.6981436642090746]]

Actual:   [[1.6982]]

Expected: [[1.6982]]