import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub67983 = tf.keras.layers.Input(shape=([3]))
in1Sub67983 = tf.keras.layers.Input(shape=([3]))
in0PRe82251 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Min26426 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Min26426 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Sub66331 = tf.keras.layers.Input(shape=([2, 2, 3, 2]))
in1Sub66331 = tf.keras.layers.Input(shape=([2, 2, 3, 2]))
in0Con65065 = tf.keras.layers.Input(shape=([4]))

Sub67983 = keras.layers.Subtract(name = 'Sub67983', )([in0Sub67983,in1Sub67983])
Res64908 = keras.layers.Reshape((3, 1), name = 'Res64908', )(Sub67983)
LST20426 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST20426', )(Res64908)
Res3528 = keras.layers.Reshape((1, 1), name = 'Res3528', )(LST20426)
Res50653 = keras.layers.Reshape((1, 1, 1), name = 'Res50653', )(Res3528)
Res6652 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res6652', )(Res50653)
Zer19354 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (2, 0)), name = 'Zer19354', )(Res6652)
PRe82251 = keras.layers.PReLU(name = 'PRe82251', input_shape=(2, 2, 2))(in0PRe82251)
Res53284 = keras.layers.Reshape((2, 4), name = 'Res53284', )(PRe82251)
LST36290 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST36290', )(Res53284)
Res56839 = keras.layers.Reshape((2, 1), name = 'Res56839', )(LST36290)
Res47872 = keras.layers.Reshape((2, 1, 1), name = 'Res47872', )(Res56839)
Res68936 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res68936', )(Res47872)
Zer71449 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer71449', )(Res68936)
Min26426 = keras.layers.Minimum(name = 'Min26426', )([in0Min26426,in1Min26426])
Zer89761 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (1, 0)), name = 'Zer89761', )(Min26426)
Ave62699 = keras.layers.Average(name = 'Ave62699', )([Zer71449,Zer89761])
Min19157 = keras.layers.Minimum(name = 'Min19157', )([Zer19354,Ave62699])
Res87412 = keras.layers.Reshape((2, 1, 3), name = 'Res87412', )(Min19157)
Res52393 = keras.layers.Reshape((2, 3), name = 'Res52393', )(Res87412)
Fla43656 = keras.layers.Flatten(name = 'Fla43656', )(Res52393)
Sub66331 = keras.layers.Subtract(name = 'Sub66331', )([in0Sub66331,in1Sub66331])
Glo68691 = keras.layers.GlobalMaxPool3D(name = 'Glo68691', )(Sub66331)
Con65065 = keras.layers.Concatenate(axis=1, name = 'Con65065', )([Glo68691,in0Con65065])
Add10910 = keras.layers.Add(name = 'Add10910', )([Fla43656,Con65065])
model = tf.keras.models.Model(inputs=[in0Sub67983,in1Sub67983,in0PRe82251,in0Min26426,in1Min26426,in0Sub66331,in1Sub66331,in0Con65065], outputs=Add10910)
w = model.get_layer('LST20426').get_weights() 
w[0] = np.array([[6, 10, 8, 5]])
w[1] = np.array([[10, 6, 2, 3]])
w[2] = np.array([8, 3, 5, 9])
model.get_layer('LST20426').set_weights(w) 
w = model.get_layer('PRe82251').get_weights() 
w[0] = np.array([[[0.8048, 0.5748], [0.3016, 0.9972]], [[0.0138, 0.02], [0.509, 0.766]]])
model.get_layer('PRe82251').set_weights(w) 
w = model.get_layer('LST36290').get_weights() 
w[0] = np.array([[4, 1, 2, 8, 6, 3, 1, 8], [5, 10, 1, 3, 4, 10, 9, 7], [10, 6, 3, 10, 10, 9, 9, 1], [9, 1, 10, 1, 8, 7, 9, 3]])
w[1] = np.array([[2, 2, 7, 10, 4, 8, 6, 3], [3, 8, 2, 8, 8, 8, 6, 9]])
w[2] = np.array([1, 4, 3, 5, 3, 4, 1, 4])
model.get_layer('LST36290').set_weights(w) 
in0Sub67983 = tf.constant([[0.2601, 0.0141, 0.3047]])
in1Sub67983 = tf.constant([[0.1065, 0.0151, 0.9345]])
in0PRe82251 = tf.constant([[[[0.9402, 0.6364], [0.3392, 0.932]], [[0.9661, 0.4953], [0.4122, 0.1572]]]])
in0Min26426 = tf.constant([[[[[0.6136], [0.7038]]]]])
in1Min26426 = tf.constant([[[[[0.3379], [0.2996]]]]])
in0Sub66331 = tf.constant([[[[[0.2985, 0.3595], [0.7787, 0.252], [0.2674, 0.0755]], [[0.0417, 0.0603], [0.0288, 0.8442], [0.7134, 0.0128]]], [[[0.6414, 0.2236], [0.9341, 0.9127], [0.6352, 0.7654]], [[0.0578, 0.6795], [0.1941, 0.0311], [0.7509, 0.4267]]]]])
in1Sub66331 = tf.constant([[[[[0.2453, 0.3729], [0.5533, 0.0767], [0.2655, 0.9001]], [[0.541, 0.3897], [0.9436, 0.6913], [0.0143, 0.0079]]], [[[0.316, 0.3701], [0.0658, 0.7456], [0.634, 0.6156]], [[0.4745, 0.8928], [0.0108, 0.0467], [0.6202, 0.7406]]]]])
in0Con65065 = tf.constant([[0.2077, 0.2814, 0.8012, 0.7635]])
print (np.array2string(model.predict([in0Sub67983,in1Sub67983,in0PRe82251,in0Min26426,in1Min26426,in0Sub66331,in1Sub66331,in0Con65065],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add10910.png')

LSub67983 = subtract_layer([[0.2601, 0.0141, 0.3047]], [[0.1065, 0.0151, 0.9345]], Sub67983), 
LRes64908 = reshape_layer(Sub67983, [3, 1], Res64908), 
LLST20426 = lstm_layer(Res64908,[[6, 10, 8, 5]],[[10, 6, 2, 3]],[8, 3, 5, 9], LST20426), 
LRes3528 = reshape_layer(LST20426, [1, 1], Res3528), 
LRes50653 = reshape_layer(Res3528, [1, 1, 1], Res50653), 
LRes6652 = reshape_layer(Res50653, [1, 1, 1, 1], Res6652), 
LZer19354 = zero_padding3D_layer(Res6652, 1, 0, 0, 0, 2, 0, Zer19354), 
LPRe82251 = prelu_layer([[[[0.9402, 0.6364], [0.3392, 0.932]], [[0.9661, 0.4953], [0.4122, 0.1572]]]], [[[0.8048, 0.5748], [0.3016, 0.9972]], [[0.0138, 0.02], [0.509, 0.766]]], PRe82251), 
LRes53284 = reshape_layer(PRe82251, [2, 4], Res53284), 
LLST36290 = lstm_layer(Res53284,[[4, 1, 2, 8, 6, 3, 1, 8], [5, 10, 1, 3, 4, 10, 9, 7], [10, 6, 3, 10, 10, 9, 9, 1], [9, 1, 10, 1, 8, 7, 9, 3]],[[2, 2, 7, 10, 4, 8, 6, 3], [3, 8, 2, 8, 8, 8, 6, 9]],[1, 4, 3, 5, 3, 4, 1, 4], LST36290), 
LRes56839 = reshape_layer(LST36290, [2, 1], Res56839), 
LRes47872 = reshape_layer(Res56839, [2, 1, 1], Res47872), 
LRes68936 = reshape_layer(Res47872, [2, 1, 1, 1], Res68936), 
LZer71449 = zero_padding3D_layer(Res68936, 0, 0, 0, 0, 2, 0, Zer71449), 
LMin26426 = minimum_layer([[[[[[0.6136], [0.7038]]]]], [[[[[0.3379], [0.2996]]]]]], Min26426), 
LZer89761 = zero_padding3D_layer(Min26426, 1, 0, 0, 0, 1, 0, Zer89761), 
LAve62699 = average_layer([Zer71449,Zer89761], Ave62699), 
LMin19157 = minimum_layer([Zer19354,Ave62699], Min19157), 
LRes87412 = reshape_layer(Min19157, [2, 1, 3], Res87412), 
LRes52393 = reshape_layer(Res87412, [2, 3], Res52393), 
LFla43656 = flatten_layer(Res52393, Fla43656), 
LSub66331 = subtract_layer([[[[[0.2985, 0.3595], [0.7787, 0.252], [0.2674, 0.0755]], [[0.0417, 0.0603], [0.0288, 0.8442], [0.7134, 0.0128]]], [[[0.6414, 0.2236], [0.9341, 0.9127], [0.6352, 0.7654]], [[0.0578, 0.6795], [0.1941, 0.0311], [0.7509, 0.4267]]]]], [[[[[0.2453, 0.3729], [0.5533, 0.0767], [0.2655, 0.9001]], [[0.541, 0.3897], [0.9436, 0.6913], [0.0143, 0.0079]]], [[[0.316, 0.3701], [0.0658, 0.7456], [0.634, 0.6156]], [[0.4745, 0.8928], [0.0108, 0.0467], [0.6202, 0.7406]]]]], Sub66331), 
LGlo68691 = global_max_pool3D_layer(Sub66331, Glo68691), 
LCon65065 = concatenate_layer([Glo68691,[[0.2077, 0.2814, 0.8012, 0.7635]]], 1, Con65065), 
LAdd10910 = add_layer([Fla43656,Con65065], Add10910), 
exec_layers([LSub67983,LRes64908,LLST20426,LRes3528,LRes50653,LRes6652,LZer19354,LPRe82251,LRes53284,LLST36290,LRes56839,LRes47872,LRes68936,LZer71449,LMin26426,LZer89761,LAve62699,LMin19157,LRes87412,LRes52393,LFla43656,LSub66331,LGlo68691,LCon65065,LAdd10910],["Sub67983","Res64908","LST20426","Res3528","Res50653","Res6652","Zer19354","PRe82251","Res53284","LST36290","Res56839","Res47872","Res68936","Zer71449","Min26426","Zer89761","Ave62699","Min19157","Res87412","Res52393","Fla43656","Sub66331","Glo68691","Con65065","Add10910"],Add10910,"Add10910")

Actual (Unparsed): [[0.8683000, 0.1753000, 0.2077000, 0.2814000, 0.8012000, 1.3953137]]

Expected (Unparsed): [[0.8683000000000001,0.1753,0.2077,0.2814,0.8012,1.3953137675786103]]

Actual:   [[0.8683, 0.1753, 0.2077, 0.2814, 0.8012, 1.3954]]

Expected: [[0.8684, 0.1753, 0.2077, 0.2814, 0.8012, 1.3954]]