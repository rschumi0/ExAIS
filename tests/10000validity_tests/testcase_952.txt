import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave55341 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Ave55341 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Dot87841 = tf.keras.layers.Input(shape=([2]))
in1Dot87841 = tf.keras.layers.Input(shape=([2]))
in0Con66511 = tf.keras.layers.Input(shape=([2, 1]))
in0Add98396 = tf.keras.layers.Input(shape=([2, 2]))
in1Add98396 = tf.keras.layers.Input(shape=([2, 2]))

Ave55341 = keras.layers.Average(name = 'Ave55341', )([in0Ave55341,in1Ave55341])
Res73117 = keras.layers.Reshape((2, 2), name = 'Res73117', )(Ave55341)
Dot87841 = keras.layers.Dot(axes=(1, 1), name = 'Dot87841', )([in0Dot87841,in1Dot87841])
Res55258 = keras.layers.Reshape((1, 1), name = 'Res55258', )(Dot87841)
Zer65835 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer65835', )(Res55258)
Con66511 = keras.layers.Concatenate(axis=2, name = 'Con66511', )([Zer65835,in0Con66511])
Add98396 = keras.layers.Add(name = 'Add98396', )([in0Add98396,in1Add98396])
Min33542 = keras.layers.Minimum(name = 'Min33542', )([Con66511,Add98396])
Max69942 = keras.layers.Maximum(name = 'Max69942', )([Res73117,Min33542])
GRU99262 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU99262', )(Max69942)
model = tf.keras.models.Model(inputs=[in0Ave55341,in1Ave55341,in0Dot87841,in1Dot87841,in0Con66511,in0Add98396,in1Add98396], outputs=GRU99262)
w = model.get_layer('GRU99262').get_weights() 
w[0] = np.array([[7, 1, 5, 6, 1, 6, 1, 5, 2], [10, 1, 7, 8, 4, 5, 2, 6, 5]])
w[1] = np.array([[5, 6, 8, 7, 7, 7, 3, 8, 9], [2, 8, 8, 3, 10, 2, 3, 9, 3], [3, 7, 10, 7, 6, 10, 5, 7, 8]])
w[2] = np.array([[2, 6, 3, 1, 7, 4, 4, 4, 5], [6, 8, 8, 1, 6, 6, 1, 4, 1]])
model.get_layer('GRU99262').set_weights(w) 
in0Ave55341 = tf.constant([[[[0.8985, 0.668]], [[0.4289, 0.5172]]]])
in1Ave55341 = tf.constant([[[[0.0986, 0.9249]], [[0.4277, 0.6458]]]])
in0Dot87841 = tf.constant([[0.5644, 0.1324]])
in1Dot87841 = tf.constant([[0.6799, 0.2563]])
in0Con66511 = tf.constant([[[0.4131], [0.0392]]])
in0Add98396 = tf.constant([[[0.7448, 0.2924], [0.4927, 0.2598]]])
in1Add98396 = tf.constant([[[0.7098, 0.5324], [0.1049, 0.7825]]])
print (np.array2string(model.predict([in0Ave55341,in1Ave55341,in0Dot87841,in1Dot87841,in0Con66511,in0Add98396,in1Add98396],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU99262.png')

LAve55341 = average_layer([[[[[0.8985, 0.668]], [[0.4289, 0.5172]]]], [[[[0.0986, 0.9249]], [[0.4277, 0.6458]]]]], Ave55341), 
LRes73117 = reshape_layer(Ave55341, [2, 2], Res73117), 
LDot87841 = dot_layer([[0.5644, 0.1324]], [[0.6799, 0.2563]], 1, 1, Dot87841), 
LRes55258 = reshape_layer(Dot87841, [1, 1], Res55258), 
LZer65835 = zero_padding1D_layer(Res55258, 1, 0, Zer65835), 
LCon66511 = concatenate_layer([Zer65835,[[[0.4131], [0.0392]]]], 2, Con66511), 
LAdd98396 = add_layer([[[[0.7448, 0.2924], [0.4927, 0.2598]]], [[[0.7098, 0.5324], [0.1049, 0.7825]]]], Add98396), 
LMin33542 = minimum_layer([Con66511,Add98396], Min33542), 
LMax69942 = maximum_layer([Res73117,Min33542], Max69942), 
LGRU99262 = gru_layer(Max69942,[[7, 1, 5, 6, 1, 6, 1, 5, 2], [10, 1, 7, 8, 4, 5, 2, 6, 5]],[[5, 6, 8, 7, 7, 7, 3, 8, 9], [2, 8, 8, 3, 10, 2, 3, 9, 3], [3, 7, 10, 7, 6, 10, 5, 7, 8]],[[2, 6, 3, 1, 7, 4, 4, 4, 5], [6, 8, 8, 1, 6, 6, 1, 4, 1]], true, GRU99262), 
exec_layers([LAve55341,LRes73117,LDot87841,LRes55258,LZer65835,LCon66511,LAdd98396,LMin33542,LMax69942,LGRU99262],["Ave55341","Res73117","Dot87841","Res55258","Zer65835","Con66511","Add98396","Min33542","Max69942","GRU99262"],GRU99262,"GRU99262")

Actual (Unparsed): [[0.0000001, 0.0000005, 0.0000000]]

Expected (Unparsed): [[5.346400178662633e-8,5.306722776296494e-7,3.872556413322515e-8]]

Actual:   [[0, 0, 0]]

Expected: [[0, 0, 0]]