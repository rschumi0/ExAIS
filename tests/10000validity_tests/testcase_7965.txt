import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot71599 = tf.keras.layers.Input(shape=([2]))
in1Dot71599 = tf.keras.layers.Input(shape=([2]))
in0Con34611 = tf.keras.layers.Input(shape=([4, 4, 2, 1]))
in0Ave48515 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Ave48515 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con84253 = tf.keras.layers.Input(shape=([4, 4, 2, 1]))
in0Con64298 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))

Dot71599 = keras.layers.Dot(axes=(1, 1), name = 'Dot71599', )([in0Dot71599,in1Dot71599])
Res50219 = keras.layers.Reshape((1, 1), name = 'Res50219', )(Dot71599)
Res30115 = keras.layers.Reshape((1, 1, 1), name = 'Res30115', )(Res50219)
Res53089 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res53089', )(Res30115)
Zer6934 = keras.layers.ZeroPadding3D(padding=((3, 0), (3, 0), (1, 0)), name = 'Zer6934', )(Res53089)
Con34611 = keras.layers.Concatenate(axis=4, name = 'Con34611', )([Zer6934,in0Con34611])
Ave48515 = keras.layers.Average(name = 'Ave48515', )([in0Ave48515,in1Ave48515])
Zer70866 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer70866', )(Ave48515)
Res84192 = keras.layers.Reshape((4, 4, 2, 1), name = 'Res84192', )(Zer70866)
Con84253 = keras.layers.Concatenate(axis=4, name = 'Con84253', )([Res84192,in0Con84253])
Con64298 = keras.layers.Conv3D(2, (1, 2, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con64298', )(in0Con64298)
Zer48294 = keras.layers.ZeroPadding3D(padding=((3, 0), (3, 0), (0, 0)), name = 'Zer48294', )(Con64298)
Mul21152 = keras.layers.Multiply(name = 'Mul21152', )([Con84253,Zer48294])
Mul21439 = keras.layers.Multiply(name = 'Mul21439', )([Con34611,Mul21152])
model = tf.keras.models.Model(inputs=[in0Dot71599,in1Dot71599,in0Con34611,in0Ave48515,in1Ave48515,in0Con84253,in0Con64298], outputs=Mul21439)
w = model.get_layer('Con64298').get_weights() 
w[0] = np.array([[[[[0.5033, 0.3412]]], [[[0.9444, 0.4787]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con64298').set_weights(w) 
in0Dot71599 = tf.constant([[0.5389, 0.816]])
in1Dot71599 = tf.constant([[0.7885, 0.185]])
in0Con34611 = tf.constant([[[[[0.6478], [0.1319]], [[0.8663], [0.0043]], [[0.5257], [0.409]], [[0.1625], [0.7988]]], [[[0.7102], [0.9862]], [[0.042], [0.9869]], [[0.9704], [0.284]], [[0.1397], [0.9592]]], [[[0.6137], [0.132]], [[0.9743], [0.6591]], [[0.477], [0.7113]], [[0.5022], [0.0538]]], [[[0.7982], [0.0101]], [[0.1051], [0.8691]], [[0.819], [0.0827]], [[0.697], [0.9564]]]]])
in0Ave48515 = tf.constant([[[[0.9151, 0.3241], [0.9021, 0.2426]], [[0.1974, 0.6931], [0.2098, 0.3938]]]])
in1Ave48515 = tf.constant([[[[0.7849, 0.915], [0.5464, 0.4611]], [[0.4362, 0.1731], [0.3018, 0.1168]]]])
in0Con84253 = tf.constant([[[[[0.9785], [0.777]], [[0.4973], [0.213]], [[0.4868], [0.7797]], [[0.7346], [0.0134]]], [[[0.0419], [0.203]], [[0.7583], [0.3445]], [[0.4923], [0.3162]], [[0.3385], [0.2813]]], [[[0.2606], [0.0854]], [[0.5337], [0.9332]], [[0.6856], [0.4348]], [[0.782], [0.2121]]], [[[0.3775], [0.3461]], [[0.0212], [0.6782]], [[0.9577], [0.2159]], [[0.0339], [0.9363]]]]])
in0Con64298 = tf.constant([[[[[0.3468], [0.7942]], [[0.8117], [0.1731]]]]])
print (np.array2string(model.predict([in0Dot71599,in1Dot71599,in0Con34611,in0Ave48515,in1Ave48515,in0Con84253,in0Con64298],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul21439.png')

LDot71599 = dot_layer([[0.5389, 0.816]], [[0.7885, 0.185]], 1, 1, Dot71599), 
LRes50219 = reshape_layer(Dot71599, [1, 1], Res50219), 
LRes30115 = reshape_layer(Res50219, [1, 1, 1], Res30115), 
LRes53089 = reshape_layer(Res30115, [1, 1, 1, 1], Res53089), 
LZer6934 = zero_padding3D_layer(Res53089, 3, 0, 3, 0, 1, 0, Zer6934), 
LCon34611 = concatenate_layer([Zer6934,[[[[[0.6478], [0.1319]], [[0.8663], [0.0043]], [[0.5257], [0.409]], [[0.1625], [0.7988]]], [[[0.7102], [0.9862]], [[0.042], [0.9869]], [[0.9704], [0.284]], [[0.1397], [0.9592]]], [[[0.6137], [0.132]], [[0.9743], [0.6591]], [[0.477], [0.7113]], [[0.5022], [0.0538]]], [[[0.7982], [0.0101]], [[0.1051], [0.8691]], [[0.819], [0.0827]], [[0.697], [0.9564]]]]]], 4, Con34611), 
LAve48515 = average_layer([[[[[0.9151, 0.3241], [0.9021, 0.2426]], [[0.1974, 0.6931], [0.2098, 0.3938]]]], [[[[0.7849, 0.915], [0.5464, 0.4611]], [[0.4362, 0.1731], [0.3018, 0.1168]]]]], Ave48515), 
LZer70866 = zero_padding2D_layer(Ave48515, 1, 1, 1, 1, Zer70866), 
LRes84192 = reshape_layer(Zer70866, [4, 4, 2, 1], Res84192), 
LCon84253 = concatenate_layer([Res84192,[[[[[0.9785], [0.777]], [[0.4973], [0.213]], [[0.4868], [0.7797]], [[0.7346], [0.0134]]], [[[0.0419], [0.203]], [[0.7583], [0.3445]], [[0.4923], [0.3162]], [[0.3385], [0.2813]]], [[[0.2606], [0.0854]], [[0.5337], [0.9332]], [[0.6856], [0.4348]], [[0.782], [0.2121]]], [[[0.3775], [0.3461]], [[0.0212], [0.6782]], [[0.9577], [0.2159]], [[0.0339], [0.9363]]]]]], 4, Con84253), 
LCon64298 = conv3D_layer([[[[[0.3468], [0.7942]], [[0.8117], [0.1731]]]]], 1, 2, 1,[[[[[0.5033, 0.3412]]], [[[0.9444, 0.4787]]]]],[0, 0], 1, 1, 1, false, 1, 1, 1, Con64298), 
LZer48294 = zero_padding3D_layer(Con64298, 3, 0, 3, 0, 0, 0, Zer48294), 
LMul21152 = multiply_layer([Con84253,Zer48294], Mul21152), 
LMul21439 = multiply_layer([Con34611,Mul21152], Mul21439), 
exec_layers([LDot71599,LRes50219,LRes30115,LRes53089,LZer6934,LCon34611,LAve48515,LZer70866,LRes84192,LCon84253,LCon64298,LZer48294,LMul21152,LMul21439],["Dot71599","Res50219","Res30115","Res53089","Zer6934","Con34611","Ave48515","Zer70866","Res84192","Con84253","Con64298","Zer48294","Mul21152","Mul21439"],Mul21439,"Mul21439")

Actual (Unparsed): [[[[[0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0119769], [0.0000000, 0.3168593]]]]]

Expected (Unparsed): [[[[[0,0.0],[0,0.0]],[[0,0.0],[0,0.0]],[[0,0.0],[0,0.0]],[[0,0.0],[0,0.0]]],[[[0,0.0],[0,0.0]],[[0.0,0.0],[0.0,0.0]],[[0.0,0.0],[0.0,0.0]],[[0,0.0],[0,0.0]]],[[[0,0.0],[0,0.0]],[[0.0,0.0],[0.0,0.0]],[[0.0,0.0],[0.0,0.0]],[[0,0.0],[0,0.0]]],[[[0,0.0],[0,0.0]],[[0,0.0],[0,0.0]],[[0,0.0],[0,0.0]],[[0.0,0.011976924177284997],[0.0,0.3168592857728532]]]]]

Actual:   [[[[[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0], [0, 0]]], [[[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0], [0, 0]]], [[[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0], [0, 0]]], [[[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0.012], [0, 0.3169]]]]]

Expected: [[[[[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0], [0, 0]]], [[[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0], [0, 0]]], [[[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0], [0, 0]]], [[[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0], [0, 0]], [[0, 0.012], [0, 0.3169]]]]]