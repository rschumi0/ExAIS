import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot67929 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot67929 = tf.keras.layers.Input(shape=([2, 2]))
in0Con58085 = tf.keras.layers.Input(shape=([2]))
in0Up_51060 = tf.keras.layers.Input(shape=([4, 2]))

Dot67929 = keras.layers.Dot(axes=(1, 2), name = 'Dot67929', )([in0Dot67929,in1Dot67929])
Fla42718 = keras.layers.Flatten(name = 'Fla42718', )(Dot67929)
Res51648 = keras.layers.Reshape((4, 1), name = 'Res51648', )(Fla42718)
Res21992 = keras.layers.Reshape((4, 1, 1), name = 'Res21992', )(Res51648)
Glo25007 = keras.layers.GlobalAveragePooling2D(name = 'Glo25007', )(Res21992)
Con58085 = keras.layers.Concatenate(axis=1, name = 'Con58085', )([Glo25007,in0Con58085])
Up_51060 = keras.layers.UpSampling1D(size=(2), name = 'Up_51060', )(in0Up_51060)
Res19262 = keras.layers.Reshape((8, 2, 1), name = 'Res19262', )(Up_51060)
Res7714 = keras.layers.Reshape((8, 2, 1, 1), name = 'Res7714', )(Res19262)
Cro44301 = keras.layers.Cropping3D(cropping=((5, 0), (1, 0), (0, 0)), name = 'Cro44301', )(Res7714)
Fla85498 = keras.layers.Flatten(name = 'Fla85498', )(Cro44301)
Ave93987 = keras.layers.Average(name = 'Ave93987', )([Con58085,Fla85498])
model = tf.keras.models.Model(inputs=[in0Dot67929,in1Dot67929,in0Con58085,in0Up_51060], outputs=Ave93987)
in0Dot67929 = tf.constant([[[0.5746, 0.72], [0.0342, 0.0791]]])
in1Dot67929 = tf.constant([[[0.0507, 0.0966], [0.4165, 0.3307]]])
in0Con58085 = tf.constant([[0.8633, 0.9335]])
in0Up_51060 = tf.constant([[[1.9183, 1.4625], [1.1205, 1.8807], [1.6445, 1.1848], [1.6, 1.5217]]])
print (np.array2string(model.predict([in0Dot67929,in1Dot67929,in0Con58085,in0Up_51060],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave93987.png')

LDot67929 = dot_layer([[[0.5746, 0.72], [0.0342, 0.0791]]], [[[0.0507, 0.0966], [0.4165, 0.3307]]], 1, 2, Dot67929), 
LFla42718 = flatten_layer(Dot67929, Fla42718), 
LRes51648 = reshape_layer(Fla42718, [4, 1], Res51648), 
LRes21992 = reshape_layer(Res51648, [4, 1, 1], Res21992), 
LGlo25007 = global_average_pooling2D_layer(Res21992, Glo25007), 
LCon58085 = concatenate_layer([Glo25007,[[0.8633, 0.9335]]], 1, Con58085), 
LUp_51060 = up_sampling1D_layer([[[1.9183, 1.4625], [1.1205, 1.8807], [1.6445, 1.1848], [1.6, 1.5217]]], 2, Up_51060), 
LRes19262 = reshape_layer(Up_51060, [8, 2, 1], Res19262), 
LRes7714 = reshape_layer(Res19262, [8, 2, 1, 1], Res7714), 
LCro44301 = cropping3D_layer(Res7714, 5, 0, 1, 0, 0, 0, Cro44301), 
LFla85498 = flatten_layer(Cro44301, Fla85498), 
LAve93987 = average_layer([Con58085,Fla85498], Ave93987), 
exec_layers([LDot67929,LFla42718,LRes51648,LRes21992,LGlo25007,LCon58085,LUp_51060,LRes19262,LRes7714,LCro44301,LFla85498,LAve93987],["Dot67929","Fla42718","Res51648","Res21992","Glo25007","Con58085","Up_51060","Res19262","Res7714","Cro44301","Fla85498","Ave93987"],Ave93987,"Ave93987")

Actual (Unparsed): [[0.6740563, 1.1925000, 1.2276000]]

Expected (Unparsed): [[0.67405627625,1.1925,1.2276]]

Actual:   [[0.6741, 1.1925, 1.2276]]

Expected: [[0.6741, 1.1925, 1.2276]]