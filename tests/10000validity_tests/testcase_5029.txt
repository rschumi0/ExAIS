import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Zer7038 = tf.keras.layers.Input(shape=([1, 4, 3]))
in0Max53664 = tf.keras.layers.Input(shape=([1, 1]))

Zer7038 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer7038', )(in0Zer7038)
Res10972 = keras.layers.Reshape((3, 18), name = 'Res10972', )(Zer7038)
Glo40553 = keras.layers.GlobalMaxPool1D(name = 'Glo40553', )(Res10972)
Res34188 = keras.layers.Reshape((18, 1), name = 'Res34188', )(Glo40553)
Max53664 = keras.layers.MaxPool1D(pool_size=(1), strides=(12), padding='same', name = 'Max53664', )(in0Max53664)
Ave64184 = keras.layers.AveragePooling1D(pool_size=(2), strides=(9), padding='same', name = 'Ave64184', )(Max53664)
Zer95805 = keras.layers.ZeroPadding1D(padding=((17, 0)), name = 'Zer95805', )(Ave64184)
Ave13005 = keras.layers.Average(name = 'Ave13005', )([Res34188,Zer95805])
GRU33102 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU33102', )(Ave13005)
model = tf.keras.models.Model(inputs=[in0Zer7038,in0Max53664], outputs=GRU33102)
w = model.get_layer('GRU33102').get_weights() 
w[0] = np.array([[2, 4, 7]])
w[1] = np.array([[10, 6, 10]])
w[2] = np.array([5, 10, 5])
model.get_layer('GRU33102').set_weights(w) 
in0Zer7038 = tf.constant([[[[1.6062, 1.6398, 1.218], [1.5238, 1.3935, 1.8912], [1.7729, 1.3181, 1.5426], [1.9907, 1.0863, 1.8853]]]])
in0Max53664 = tf.constant([[[1.3098]]])
print (np.array2string(model.predict([in0Zer7038,in0Max53664],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU33102.png')

LZer7038 = zero_padding2D_layer([[[[1.6062, 1.6398, 1.218], [1.5238, 1.3935, 1.8912], [1.7729, 1.3181, 1.5426], [1.9907, 1.0863, 1.8853]]]], 1, 1, 1, 1, Zer7038), 
LRes10972 = reshape_layer(Zer7038, [3, 18], Res10972), 
LGlo40553 = global_max_pool1D_layer(Res10972, Glo40553), 
LRes34188 = reshape_layer(Glo40553, [18, 1], Res34188), 
LMax53664 = max_pool1D_layer([[[1.3098]]], 1, 12, true, Max53664), 
LAve64184 = average_pooling1D_layer(Max53664, 2, 9, true, Ave64184), 
LZer95805 = zero_padding1D_layer(Ave64184, 17, 0, Zer95805), 
LAve13005 = average_layer([Res34188,Zer95805], Ave13005), 
LGRU33102 = gru_layer(Ave13005,[[2, 4, 7]],[[10, 6, 10]],[5, 10, 5], false, GRU33102), 
exec_layers([LZer7038,LRes10972,LGlo40553,LRes34188,LMax53664,LAve64184,LZer95805,LAve13005,LGRU33102],["Zer7038","Res10972","Glo40553","Res34188","Max53664","Ave64184","Zer95805","Ave13005","GRU33102"],GRU33102,"GRU33102")

Actual (Unparsed): [[0.0423019]]

Expected (Unparsed): [[0.042301948343529114]]

Actual:   [[0.0424]]

Expected: [[0.0424]]