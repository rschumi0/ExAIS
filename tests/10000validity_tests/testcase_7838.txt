import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add95524 = tf.keras.layers.Input(shape=([2, 2]))
in1Add95524 = tf.keras.layers.Input(shape=([2, 2]))
in0GRU22117 = tf.keras.layers.Input(shape=([1, 1]))
in0Con84753 = tf.keras.layers.Input(shape=([2]))

Add95524 = keras.layers.Add(name = 'Add95524', )([in0Add95524,in1Add95524])
Fla63486 = keras.layers.Flatten(name = 'Fla63486', )(Add95524)
GRU22117 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU22117', )(in0GRU22117)
Con84753 = keras.layers.Concatenate(axis=1, name = 'Con84753', )([GRU22117,in0Con84753])
Min22897 = keras.layers.Minimum(name = 'Min22897', )([Fla63486,Con84753])
Res29609 = keras.layers.Reshape((4, 1), name = 'Res29609', )(Min22897)
LST76661 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST76661', )(Res29609)
model = tf.keras.models.Model(inputs=[in0Add95524,in1Add95524,in0GRU22117,in0Con84753], outputs=LST76661)
w = model.get_layer('GRU22117').get_weights() 
w[0] = np.array([[10, 4, 5, 9, 2, 9]])
w[1] = np.array([[2, 1, 1, 3, 2, 6], [6, 7, 8, 1, 5, 2]])
w[2] = np.array([[6, 9, 8, 7, 1, 3], [1, 4, 10, 7, 3, 3]])
model.get_layer('GRU22117').set_weights(w) 
w = model.get_layer('LST76661').get_weights() 
w[0] = np.array([[8, 5, 10, 6]])
w[1] = np.array([[2, 5, 7, 2]])
w[2] = np.array([8, 8, 1, 1])
model.get_layer('LST76661').set_weights(w) 
in0Add95524 = tf.constant([[[0.6432, 0.2535], [0.6957, 0.9665]]])
in1Add95524 = tf.constant([[[0.6269, 0.9895], [0.3934, 0.1118]]])
in0GRU22117 = tf.constant([[[4]]])
in0Con84753 = tf.constant([[0.5553, 0.6598]])
print (np.array2string(model.predict([in0Add95524,in1Add95524,in0GRU22117,in0Con84753],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST76661.png')

LAdd95524 = add_layer([[[[0.6432, 0.2535], [0.6957, 0.9665]]], [[[0.6269, 0.9895], [0.3934, 0.1118]]]], Add95524), 
LFla63486 = flatten_layer(Add95524, Fla63486), 
LGRU22117 = gru_layer([[[4]]],[[10, 4, 5, 9, 2, 9]],[[2, 1, 1, 3, 2, 6], [6, 7, 8, 1, 5, 2]],[[6, 9, 8, 7, 1, 3], [1, 4, 10, 7, 3, 3]], true, GRU22117), 
LCon84753 = concatenate_layer([GRU22117,[[0.5553, 0.6598]]], 1, Con84753), 
LMin22897 = minimum_layer([Fla63486,Con84753], Min22897), 
LRes29609 = reshape_layer(Min22897, [4, 1], Res29609), 
LLST76661 = lstm_layer(Res29609,[[8, 5, 10, 6]],[[2, 5, 7, 2]],[8, 8, 1, 1], LST76661), 
exec_layers([LAdd95524,LFla63486,LGRU22117,LCon84753,LMin22897,LRes29609,LLST76661],["Add95524","Fla63486","GRU22117","Con84753","Min22897","Res29609","LST76661"],LST76661,"LST76661")

Actual (Unparsed): [[0.9979497]]

Expected (Unparsed): [[0.9979497035092694]]

Actual:   [[0.998]]

Expected: [[0.998]]