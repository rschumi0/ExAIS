import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave50553 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Ave50553 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Con46341 = tf.keras.layers.Input(shape=([4]))
in0Cro6386 = tf.keras.layers.Input(shape=([4, 2, 4]))
in0Dot27132 = tf.keras.layers.Input(shape=([3]))
in1Dot27132 = tf.keras.layers.Input(shape=([3]))
in0Con73290 = tf.keras.layers.Input(shape=([7]))

Ave50553 = keras.layers.Average(name = 'Ave50553', )([in0Ave50553,in1Ave50553])
Res24622 = keras.layers.Reshape((2, 2, 1), name = 'Res24622', )(Ave50553)
Res3327 = keras.layers.Reshape((2, 2), name = 'Res3327', )(Res24622)
Fla60739 = keras.layers.Flatten(name = 'Fla60739', )(Res3327)
Con46341 = keras.layers.Concatenate(axis=1, name = 'Con46341', )([Fla60739,in0Con46341])
Cro6386 = keras.layers.Cropping2D(cropping=((2, 1), (0, 0)), name = 'Cro6386', )(in0Cro6386)
Res41575 = keras.layers.Reshape((1, 8), name = 'Res41575', )(Cro6386)
Fla5509 = keras.layers.Flatten(name = 'Fla5509', )(Res41575)
Dot27132 = keras.layers.Dot(axes=(1, 1), name = 'Dot27132', )([in0Dot27132,in1Dot27132])
Con73290 = keras.layers.Concatenate(axis=1, name = 'Con73290', )([Dot27132,in0Con73290])
Min31483 = keras.layers.Minimum(name = 'Min31483', )([Fla5509,Con73290])
Dot45160 = keras.layers.Dot(axes=(1, 1), name = 'Dot45160', )([Con46341,Min31483])
Res88053 = keras.layers.Reshape((1, 1), name = 'Res88053', )(Dot45160)
Res5694 = keras.layers.Reshape((1, 1, 1), name = 'Res5694', )(Res88053)
Sep48694 = keras.layers.SeparableConv2D(3, (1, 1),strides=(1, 1), padding='same', name = 'Sep48694', )(Res5694)
model = tf.keras.models.Model(inputs=[in0Ave50553,in1Ave50553,in0Con46341,in0Cro6386,in0Dot27132,in1Dot27132,in0Con73290], outputs=Sep48694)
w = model.get_layer('Sep48694').get_weights() 
w[0] = np.array([[[[0.5575]]]])
w[1] = np.array([[[[0.4719, 0.7623, 0.4497]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep48694').set_weights(w) 
in0Ave50553 = tf.constant([[[[[0.4569]], [[0.1414]]], [[[0.8041]], [[0.8692]]]]])
in1Ave50553 = tf.constant([[[[[0.5025]], [[0.9638]]], [[[0.2872]], [[0.0536]]]]])
in0Con46341 = tf.constant([[0.7521, 0.8705, 0.348, 0.3207]])
in0Cro6386 = tf.constant([[[[1.1016, 1.8078, 1.6326, 1.31], [1.9895, 1.8885, 1.3439, 1.3956]], [[1.2232, 1.491, 1.5028, 1.9349], [1.3613, 1.6757, 1.0943, 1.8227]], [[1.6562, 1.6528, 1.6831, 1.0941], [1.0103, 1.6574, 1.9357, 1.3208]], [[1.6871, 1.1883, 1.3616, 1.8966], [1.5474, 1.2885, 1.569, 1.1491]]]])
in0Dot27132 = tf.constant([[0.8819, 0.1378, 0.2691]])
in1Dot27132 = tf.constant([[0.0796, 0.7516, 0.6065]])
in0Con73290 = tf.constant([[0.2631, 0.0719, 0.7255, 0.906, 0.2199, 0.8175, 0.4216]])
print (np.array2string(model.predict([in0Ave50553,in1Ave50553,in0Con46341,in0Cro6386,in0Dot27132,in1Dot27132,in0Con73290],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sep48694.png')

LAve50553 = average_layer([[[[[[0.4569]], [[0.1414]]], [[[0.8041]], [[0.8692]]]]], [[[[[0.5025]], [[0.9638]]], [[[0.2872]], [[0.0536]]]]]], Ave50553), 
LRes24622 = reshape_layer(Ave50553, [2, 2, 1], Res24622), 
LRes3327 = reshape_layer(Res24622, [2, 2], Res3327), 
LFla60739 = flatten_layer(Res3327, Fla60739), 
LCon46341 = concatenate_layer([Fla60739,[[0.7521, 0.8705, 0.348, 0.3207]]], 1, Con46341), 
LCro6386 = cropping2D_layer([[[[1.1016, 1.8078, 1.6326, 1.31], [1.9895, 1.8885, 1.3439, 1.3956]], [[1.2232, 1.491, 1.5028, 1.9349], [1.3613, 1.6757, 1.0943, 1.8227]], [[1.6562, 1.6528, 1.6831, 1.0941], [1.0103, 1.6574, 1.9357, 1.3208]], [[1.6871, 1.1883, 1.3616, 1.8966], [1.5474, 1.2885, 1.569, 1.1491]]]], 2, 1, 0, 0, Cro6386), 
LRes41575 = reshape_layer(Cro6386, [1, 8], Res41575), 
LFla5509 = flatten_layer(Res41575, Fla5509), 
LDot27132 = dot_layer([[0.8819, 0.1378, 0.2691]], [[0.0796, 0.7516, 0.6065]], 1, 1, Dot27132), 
LCon73290 = concatenate_layer([Dot27132,[[0.2631, 0.0719, 0.7255, 0.906, 0.2199, 0.8175, 0.4216]]], 1, Con73290), 
LMin31483 = minimum_layer([Fla5509,Con73290], Min31483), 
LDot45160 = dot_layer(Con46341,Min31483, 1, 1, Dot45160), 
LRes88053 = reshape_layer(Dot45160, [1, 1], Res88053), 
LRes5694 = reshape_layer(Res88053, [1, 1, 1], Res5694), 
LSep48694 = separable_conv2D_layer(Res5694, 1, 1,[[[[[0.5575]]]],[[[[0.4719, 0.7623, 0.4497]]]]],[0, 0, 0], 1, 1, true, Sep48694), 
exec_layers([LAve50553,LRes24622,LRes3327,LFla60739,LCon46341,LCro6386,LRes41575,LFla5509,LDot27132,LCon73290,LMin31483,LDot45160,LRes88053,LRes5694,LSep48694],["Ave50553","Res24622","Res3327","Fla60739","Con46341","Cro6386","Res41575","Fla5509","Dot27132","Con73290","Min31483","Dot45160","Res88053","Res5694","Sep48694"],Sep48694,"Sep48694")

Actual (Unparsed): [[[[0.5192069, 0.8387188, 0.4947814]]]]

Expected (Unparsed): [[[[0.5192068774235951,0.8387188019919611,0.4947813790578315]]]]

Actual:   [[[[0.5193, 0.8388, 0.4948]]]]

Expected: [[[[0.5193, 0.8388, 0.4948]]]]