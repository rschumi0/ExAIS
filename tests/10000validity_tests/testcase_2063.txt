import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min40035 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Min40035 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Con85781 = tf.keras.layers.Input(shape=([2, 2]))

Min40035 = keras.layers.Minimum(name = 'Min40035', )([in0Min40035,in1Min40035])
Res58693 = keras.layers.Reshape((1, 2, 1), name = 'Res58693', )(Min40035)
Res61985 = keras.layers.Reshape((1, 2), name = 'Res61985', )(Res58693)
Sim28428 = keras.layers.SimpleRNN(1,name = 'Sim28428', )(Res61985)
Con85781 = keras.layers.Conv1D(2, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con85781', )(in0Con85781)
Res68838 = keras.layers.Reshape((2, 2, 1), name = 'Res68838', )(Con85781)
Res95433 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res95433', )(Res68838)
Glo81676 = keras.layers.GlobalMaxPool3D(name = 'Glo81676', )(Res95433)
Ave41198 = keras.layers.Average(name = 'Ave41198', )([Sim28428,Glo81676])
model = tf.keras.models.Model(inputs=[in0Min40035,in1Min40035,in0Con85781], outputs=Ave41198)
w = model.get_layer('Sim28428').get_weights() 
w[0] = np.array([[4], [6]])
w[1] = np.array([[3]])
w[2] = np.array([7])
model.get_layer('Sim28428').set_weights(w) 
w = model.get_layer('Con85781').get_weights() 
w[0] = np.array([[[0.0036, 0.4945], [0.0418, 0.633]]])
w[1] = np.array([0, 0])
model.get_layer('Con85781').set_weights(w) 
in0Min40035 = tf.constant([[[[[0.5003]], [[0.8168]]]]])
in1Min40035 = tf.constant([[[[[0.1532]], [[0.7075]]]]])
in0Con85781 = tf.constant([[[0.295, 0.6943], [0.7904, 0.3473]]])
print (np.array2string(model.predict([in0Min40035,in1Min40035,in0Con85781],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave41198.png')

LMin40035 = minimum_layer([[[[[[0.5003]], [[0.8168]]]]], [[[[[0.1532]], [[0.7075]]]]]], Min40035), 
LRes58693 = reshape_layer(Min40035, [1, 2, 1], Res58693), 
LRes61985 = reshape_layer(Res58693, [1, 2], Res61985), 
LSim28428 = simple_rnn_layer(Res61985,[[4], [6]],[[3]],[7], Sim28428), 
LCon85781 = conv1D_layer([[[0.295, 0.6943], [0.7904, 0.3473]]], 1,[[[0.0036, 0.4945], [0.0418, 0.633]]],[0, 0], 1, false, 1, Con85781), 
LRes68838 = reshape_layer(Con85781, [2, 2, 1], Res68838), 
LRes95433 = reshape_layer(Res68838, [2, 2, 1, 1], Res95433), 
LGlo81676 = global_max_pool3D_layer(Res95433, Glo81676), 
LAve41198 = average_layer([Sim28428,Glo81676], Ave41198), 
exec_layers([LMin40035,LRes58693,LRes61985,LSim28428,LCon85781,LRes68838,LRes95433,LGlo81676,LAve41198],["Min40035","Res58693","Res61985","Sim28428","Con85781","Res68838","Res95433","Glo81676","Ave41198"],Ave41198,"Ave41198")

Actual (Unparsed): [[0.8053469]]

Expected (Unparsed): [[0.8053468499498297]]

Actual:   [[0.8054]]

Expected: [[0.8054]]