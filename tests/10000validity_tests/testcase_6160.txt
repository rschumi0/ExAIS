import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Per82282 = tf.keras.layers.Input(shape=([1, 3]))
in0Mul78876 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Mul78876 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con50825 = tf.keras.layers.Input(shape=([3, 1]))
in0Mul7614 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Mul7614 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in0Con23453 = tf.keras.layers.Input(shape=([3, 1]))
in0Loc73757 = tf.keras.layers.Input(shape=([1, 1]))

Per82282 = keras.layers.Permute((2,1), name = 'Per82282',)(in0Per82282)
Res38441 = keras.layers.Reshape((3, 1, 1), name = 'Res38441', )(Per82282)
Zer3908 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer3908', )(Res38441)
Mul78876 = keras.layers.Multiply(name = 'Mul78876', )([in0Mul78876,in1Mul78876])
Zer97862 = keras.layers.ZeroPadding2D(padding=((2, 0), (1, 0)), name = 'Zer97862', )(Mul78876)
Mul86268 = keras.layers.Multiply(name = 'Mul86268', )([Zer3908,Zer97862])
Res52123 = keras.layers.Reshape((3, 3), name = 'Res52123', )(Mul86268)
Con50825 = keras.layers.Concatenate(axis=2, name = 'Con50825', )([Res52123,in0Con50825])
Mul7614 = keras.layers.Multiply(name = 'Mul7614', )([in0Mul7614,in1Mul7614])
Res7224 = keras.layers.Reshape((1, 1, 4), name = 'Res7224', )(Mul7614)
Res81374 = keras.layers.Reshape((1, 4), name = 'Res81374', )(Res7224)
Dot11427 = keras.layers.Dot(axes=(2, 2), name = 'Dot11427', )([Con50825,Res81374])
Con23453 = keras.layers.Concatenate(axis=2, name = 'Con23453', )([Dot11427,in0Con23453])
Loc73757 = keras.layers.LocallyConnected1D(2, (1),strides=(1), name = 'Loc73757', )(in0Loc73757)
ELU87896 = keras.layers.ELU(alpha=-5.0384694290419985, name = 'ELU87896', )(Loc73757)
Zer76667 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer76667', )(ELU87896)
Add62013 = keras.layers.Add(name = 'Add62013', )([Con23453,Zer76667])
model = tf.keras.models.Model(inputs=[in0Per82282,in0Mul78876,in1Mul78876,in0Con50825,in0Mul7614,in1Mul7614,in0Con23453,in0Loc73757], outputs=Add62013)
w = model.get_layer('Loc73757').get_weights() 
w[0] = np.array([[[0.3232, 0.4811]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc73757').set_weights(w) 
in0Per82282 = tf.constant([[[1.6225, 1.8887, 1.1973]]])
in0Mul78876 = tf.constant([[[[0.4069], [0.5614]]]])
in1Mul78876 = tf.constant([[[[0.9381], [0.0326]]]])
in0Con50825 = tf.constant([[[0.815], [0.1172], [0.192]]])
in0Mul7614 = tf.constant([[[[[0.0161, 0.3375], [0.8707, 0.6865]]]]])
in1Mul7614 = tf.constant([[[[[0.4056, 0.9271], [0.9126, 0.7007]]]]])
in0Con23453 = tf.constant([[[0.7067], [0.3521], [0.2757]]])
in0Loc73757 = tf.constant([[[0.6351]]])
print (np.array2string(model.predict([in0Per82282,in0Mul78876,in1Mul78876,in0Con50825,in0Mul7614,in1Mul7614,in0Con23453,in0Loc73757],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add62013.png')

LPer82282 = permute_layer([[[1.6225, 1.8887, 1.1973]]], 2,1, Per82282), 
LRes38441 = reshape_layer(Per82282, [3, 1, 1], Res38441), 
LZer3908 = zero_padding2D_layer(Res38441, 0, 0, 2, 0, Zer3908), 
LMul78876 = multiply_layer([[[[[0.4069], [0.5614]]]], [[[[0.9381], [0.0326]]]]], Mul78876), 
LZer97862 = zero_padding2D_layer(Mul78876, 2, 0, 1, 0, Zer97862), 
LMul86268 = multiply_layer([Zer3908,Zer97862], Mul86268), 
LRes52123 = reshape_layer(Mul86268, [3, 3], Res52123), 
LCon50825 = concatenate_layer([Res52123,[[[0.815], [0.1172], [0.192]]]], 2, Con50825), 
LMul7614 = multiply_layer([[[[[[0.0161, 0.3375], [0.8707, 0.6865]]]]], [[[[[0.4056, 0.9271], [0.9126, 0.7007]]]]]], Mul7614), 
LRes7224 = reshape_layer(Mul7614, [1, 1, 4], Res7224), 
LRes81374 = reshape_layer(Res7224, [1, 4], Res81374), 
LDot11427 = dot_layer(Con50825,Res81374, 2, 2, Dot11427), 
LCon23453 = concatenate_layer([Dot11427,[[[0.7067], [0.3521], [0.2757]]]], 2, Con23453), 
LLoc73757 = locally_connected1D_layer([[[0.6351]]], 1,[[[0.3232, 0.4811]]],[[0, 0]], 1, Loc73757), 
LELU87896 = elu_layer(Loc73757, -5.0384694290419985, ELU87896), 
LZer76667 = zero_padding1D_layer(ELU87896, 2, 0, Zer76667), 
LAdd62013 = add_layer([Con23453,Zer76667], Add62013), 
exec_layers([LPer82282,LRes38441,LZer3908,LMul78876,LZer97862,LMul86268,LRes52123,LCon50825,LMul7614,LRes7224,LRes81374,LDot11427,LCon23453,LLoc73757,LELU87896,LZer76667,LAdd62013],["Per82282","Res38441","Zer3908","Mul78876","Zer97862","Mul86268","Res52123","Con50825","Mul7614","Res7224","Res81374","Dot11427","Con23453","Loc73757","ELU87896","Zer76667","Add62013"],Add62013,"Add62013")

Actual (Unparsed): [[[0.3920399, 0.7067000], [0.0563768, 0.3521000], [0.3150339, 0.5812466]]]

Expected (Unparsed): [[[0.39203989824999996,0.7067],[0.05637678046,0.3521],[0.3150339186366051,0.58124661]]]

Actual:   [[[0.3921, 0.7067], [0.0564, 0.3521], [0.3151, 0.5813]]]

Expected: [[[0.3921, 0.7067], [0.0564, 0.3521], [0.3151, 0.5813]]]