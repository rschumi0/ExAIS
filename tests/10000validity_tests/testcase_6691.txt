import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con89313 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con1917 = tf.keras.layers.Input(shape=([4]))
in0Max45426 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Max45426 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Glo17269 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con63320 = tf.keras.layers.Input(shape=([7]))

Con89313 = keras.layers.Conv2D(4, (1, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con89313', )(in0Con89313)
Res84441 = keras.layers.Reshape((1, 4), name = 'Res84441', )(Con89313)
Fla80028 = keras.layers.Flatten(name = 'Fla80028', )(Res84441)
Con1917 = keras.layers.Concatenate(axis=1, name = 'Con1917', )([Fla80028,in0Con1917])
Max45426 = keras.layers.Maximum(name = 'Max45426', )([in0Max45426,in1Max45426])
Res92911 = keras.layers.Reshape((1, 2, 4), name = 'Res92911', )(Max45426)
Res81799 = keras.layers.Reshape((1, 8), name = 'Res81799', )(Res92911)
Fla51932 = keras.layers.Flatten(name = 'Fla51932', )(Res81799)
Glo17269 = keras.layers.GlobalAveragePooling2D(name = 'Glo17269', )(in0Glo17269)
Res71171 = keras.layers.Reshape((1, 1), name = 'Res71171', )(Glo17269)
Res62289 = keras.layers.Reshape((1, 1, 1), name = 'Res62289', )(Res71171)
Res76951 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res76951', )(Res62289)
Glo32306 = keras.layers.GlobalAveragePooling3D(name = 'Glo32306', )(Res76951)
Con63320 = keras.layers.Concatenate(axis=1, name = 'Con63320', )([Glo32306,in0Con63320])
Sub46590 = keras.layers.Subtract(name = 'Sub46590', )([Fla51932,Con63320])
Sub7217 = keras.layers.Subtract(name = 'Sub7217', )([Con1917,Sub46590])
model = tf.keras.models.Model(inputs=[in0Con89313,in0Con1917,in0Max45426,in1Max45426,in0Glo17269,in0Con63320], outputs=Sub7217)
w = model.get_layer('Con89313').get_weights() 
w[0] = np.array([[[[0.8488, 0.7453, 0.8128, 0.2007], [0.0928, 0.962, 0.193, 0.0858]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con89313').set_weights(w) 
in0Con89313 = tf.constant([[[[0.7684, 0.2434]]]])
in0Con1917 = tf.constant([[0.4225, 0.6495, 0.5205, 0.477]])
in0Max45426 = tf.constant([[[[[0.2738, 0.1339], [0.402, 0.2016]], [[0.3812, 0.8901], [0.5684, 0.3984]]]]])
in1Max45426 = tf.constant([[[[[0.6233, 0.6838], [0.407, 0.8291]], [[0.0652, 0.0369], [0.8785, 0.5151]]]]])
in0Glo17269 = tf.constant([[[[1.4089]], [[1.8284]]]])
in0Con63320 = tf.constant([[0.3776, 0.9542, 0.5328, 0.0524, 0.9905, 0.0309, 0.1506]])
print (np.array2string(model.predict([in0Con89313,in0Con1917,in0Max45426,in1Max45426,in0Glo17269,in0Con63320],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub7217.png')

LCon89313 = conv2D_layer([[[[0.7684, 0.2434]]]], 1, 1,[[[[0.8488, 0.7453, 0.8128, 0.2007], [0.0928, 0.962, 0.193, 0.0858]]]],[0, 0, 0, 0], 1, 1, true, 1, 1, Con89313), 
LRes84441 = reshape_layer(Con89313, [1, 4], Res84441), 
LFla80028 = flatten_layer(Res84441, Fla80028), 
LCon1917 = concatenate_layer([Fla80028,[[0.4225, 0.6495, 0.5205, 0.477]]], 1, Con1917), 
LMax45426 = maximum_layer([[[[[[0.2738, 0.1339], [0.402, 0.2016]], [[0.3812, 0.8901], [0.5684, 0.3984]]]]], [[[[[0.6233, 0.6838], [0.407, 0.8291]], [[0.0652, 0.0369], [0.8785, 0.5151]]]]]], Max45426), 
LRes92911 = reshape_layer(Max45426, [1, 2, 4], Res92911), 
LRes81799 = reshape_layer(Res92911, [1, 8], Res81799), 
LFla51932 = flatten_layer(Res81799, Fla51932), 
LGlo17269 = global_average_pooling2D_layer([[[[1.4089]], [[1.8284]]]], Glo17269), 
LRes71171 = reshape_layer(Glo17269, [1, 1], Res71171), 
LRes62289 = reshape_layer(Res71171, [1, 1, 1], Res62289), 
LRes76951 = reshape_layer(Res62289, [1, 1, 1, 1], Res76951), 
LGlo32306 = global_average_pooling3D_layer(Res76951, Glo32306), 
LCon63320 = concatenate_layer([Glo32306,[[0.3776, 0.9542, 0.5328, 0.0524, 0.9905, 0.0309, 0.1506]]], 1, Con63320), 
LSub46590 = subtract_layer(Fla51932,Con63320, Sub46590), 
LSub7217 = subtract_layer(Con1917,Sub46590, Sub7217), 
exec_layers([LCon89313,LRes84441,LFla80028,LCon1917,LMax45426,LRes92911,LRes81799,LFla51932,LGlo17269,LRes71171,LRes62289,LRes76951,LGlo32306,LCon63320,LSub46590,LSub7217],["Con89313","Res84441","Fla80028","Con1917","Max45426","Res92911","Res81799","Fla51932","Glo17269","Res71171","Res62289","Res76951","Glo32306","Con63320","Sub46590","Sub7217"],Sub7217,"Sub7217")

Actual (Unparsed): [[1.6701555, 0.5006394, 1.2187318, -0.1211984, 0.0937000, 0.7499000, -0.3271000, 0.1125000]]

Expected (Unparsed): [[1.6701554400000003,0.5006393199999999,1.21873172,-0.12119839999999993,0.0937,0.7499,-0.32709999999999995,0.11249999999999999]]

Actual:   [[1.6702, 0.5007, 1.2188, -0.1211, 0.0937, 0.7499, -0.3271, 0.1125]]

Expected: [[1.6702, 0.5007, 1.2188, -0.1211, 0.0937, 0.7499, -0.327, 0.1125]]