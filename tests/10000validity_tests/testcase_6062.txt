import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub20845 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Sub20845 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Dot11103 = tf.keras.layers.Input(shape=([2]))
in1Dot11103 = tf.keras.layers.Input(shape=([2]))
in0Con46778 = tf.keras.layers.Input(shape=([1, 2, 3]))
in0Zer30188 = tf.keras.layers.Input(shape=([2, 4, 4]))
in0Max26967 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con86185 = tf.keras.layers.Input(shape=([1, 2, 3]))
in0Max75352 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Max75352 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Dot96495 = tf.keras.layers.Input(shape=([2]))
in1Dot96495 = tf.keras.layers.Input(shape=([2]))
in0Con48230 = tf.keras.layers.Input(shape=([2, 7]))

Sub20845 = keras.layers.Subtract(name = 'Sub20845', )([in0Sub20845,in1Sub20845])
Res23407 = keras.layers.Reshape((2, 2, 4), name = 'Res23407', )(Sub20845)
Res16931 = keras.layers.Reshape((2, 8), name = 'Res16931', )(Res23407)
Dot11103 = keras.layers.Dot(axes=(1, 1), name = 'Dot11103', )([in0Dot11103,in1Dot11103])
Res53791 = keras.layers.Reshape((1, 1), name = 'Res53791', )(Dot11103)
Res2248 = keras.layers.Reshape((1, 1, 1), name = 'Res2248', )(Res53791)
Dep27539 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='valid', name = 'Dep27539', )(Res2248)
Zer94146 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer94146', )(Dep27539)
Con46778 = keras.layers.Concatenate(axis=3, name = 'Con46778', )([Zer94146,in0Con46778])
Zer30188 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer30188', )(in0Zer30188)
Dep32743 = keras.layers.DepthwiseConv2D((4, 3),strides=(2, 2), padding='valid', name = 'Dep32743', )(Zer30188)
Max26967 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max26967', )(in0Max26967)
Zer30104 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer30104', )(Max26967)
Con86185 = keras.layers.Concatenate(axis=3, name = 'Con86185', )([Zer30104,in0Con86185])
Mul91090 = keras.layers.Multiply(name = 'Mul91090', )([Dep32743,Con86185])
Ave80980 = keras.layers.Average(name = 'Ave80980', )([Con46778,Mul91090])
Res74902 = keras.layers.Reshape((1, 8), name = 'Res74902', )(Ave80980)
Zer66872 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer66872', )(Res74902)
Max75352 = keras.layers.Maximum(name = 'Max75352', )([in0Max75352,in1Max75352])
Res29902 = keras.layers.Reshape((2, 1, 1), name = 'Res29902', )(Max75352)
Res34675 = keras.layers.Reshape((2, 1), name = 'Res34675', )(Res29902)
Dot96495 = keras.layers.Dot(axes=(1, 1), name = 'Dot96495', )([in0Dot96495,in1Dot96495])
Res25008 = keras.layers.Reshape((1, 1), name = 'Res25008', )(Dot96495)
PRe49009 = keras.layers.PReLU(name = 'PRe49009', )(Res25008)
Zer68544 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer68544', )(PRe49009)
Add52248 = keras.layers.Add(name = 'Add52248', )([Res34675,Zer68544])
Con48230 = keras.layers.Concatenate(axis=2, name = 'Con48230', )([Add52248,in0Con48230])
Add26410 = keras.layers.Add(name = 'Add26410', )([Zer66872,Con48230])
Mul22278 = keras.layers.Multiply(name = 'Mul22278', )([Res16931,Add26410])
model = tf.keras.models.Model(inputs=[in0Sub20845,in1Sub20845,in0Dot11103,in1Dot11103,in0Con46778,in0Zer30188,in0Max26967,in0Con86185,in0Max75352,in1Max75352,in0Dot96495,in1Dot96495,in0Con48230], outputs=Mul22278)
w = model.get_layer('Dep27539').get_weights() 
w[0] = np.array([[[[0.7036]]]])
w[1] = np.array([0])
model.get_layer('Dep27539').set_weights(w) 
w = model.get_layer('Dep32743').get_weights() 
w[0] = np.array([[[[0.3634], [0.4315], [0.7819], [0.3915]], [[0.3526], [0.4868], [0.6935], [0.4497]], [[0.2142], [0.305], [0.8224], [0.5521]]], [[[0.0968], [0.4939], [0.7661], [0.8219]], [[0.6231], [0.4374], [0.8773], [0.3024]], [[0.9762], [0.9378], [0.5074], [0.0549]]], [[[0.3932], [0.9508], [0.0199], [0.3968]], [[0.577], [0.2004], [0.9269], [0.7546]], [[0.0755], [0.2548], [0.3695], [0.8597]]], [[[0.1187], [0.5964], [0.429], [0.9122]], [[0.753], [0.324], [0.4368], [0.9029]], [[0.3657], [0.3873], [0.5307], [0.4946]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Dep32743').set_weights(w) 
w = model.get_layer('PRe49009').get_weights() 
w[0] = np.array([[0.4563]])
model.get_layer('PRe49009').set_weights(w) 
in0Sub20845 = tf.constant([[[[[0.8534, 0.8309], [0.6038, 0.6643]], [[0.2932, 0.5371], [0.0528, 0.9935]]], [[[0.6789, 0.6684], [0.8026, 0.6086]], [[0.6098, 0.8921], [0.2183, 0.1853]]]]])
in1Sub20845 = tf.constant([[[[[0.7225, 0.4062], [0.725, 0.5191]], [[0.7143, 0.5934], [0.4844, 0.9143]]], [[[0.5344, 0.0926], [0.8829, 0.6101]], [[0.3628, 0.0423], [0.3741, 0.6879]]]]])
in0Dot11103 = tf.constant([[0.4123, 0.5087]])
in1Dot11103 = tf.constant([[0.8912, 0.0497]])
in0Con46778 = tf.constant([[[[0.4095, 0.98, 0.8055], [0.0324, 0.56, 0.9645]]]])
in0Zer30188 = tf.constant([[[[1.7713, 1.4037, 1.9994, 1.7419], [1.4775, 1.5142, 1.1925, 1.1074], [1.7642, 1.6223, 1.2569, 1.9947], [1.9512, 1.0768, 1.4202, 1.525]], [[1.7662, 1.5909, 1.0861, 1.726], [1.9797, 1.4892, 1.311, 1.6765], [1.1085, 1.1035, 1.826, 1.6732], [1.6036, 1.526, 1.326, 1.335]]]])
in0Max26967 = tf.constant([[[[1.3743]]]])
in0Con86185 = tf.constant([[[[0.8309, 0.6932, 0.7147], [0.4378, 0.2298, 0.4387]]]])
in0Max75352 = tf.constant([[[[[0.4685]]], [[[0.9536]]]]])
in1Max75352 = tf.constant([[[[[0.4841]]], [[[0.7218]]]]])
in0Dot96495 = tf.constant([[0.5466, 0.3913]])
in1Dot96495 = tf.constant([[0.1111, 0.7549]])
in0Con48230 = tf.constant([[[0.4179, 0.1523, 0.2974, 0.2997, 0.8308, 0.353, 0.263], [0.099, 0.5074, 0.5314, 0.5872, 0.3676, 0.1184, 0.0472]]])
print (np.array2string(model.predict([in0Sub20845,in1Sub20845,in0Dot11103,in1Dot11103,in0Con46778,in0Zer30188,in0Max26967,in0Con86185,in0Max75352,in1Max75352,in0Dot96495,in1Dot96495,in0Con48230],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul22278.png')

LSub20845 = subtract_layer([[[[[0.8534, 0.8309], [0.6038, 0.6643]], [[0.2932, 0.5371], [0.0528, 0.9935]]], [[[0.6789, 0.6684], [0.8026, 0.6086]], [[0.6098, 0.8921], [0.2183, 0.1853]]]]], [[[[[0.7225, 0.4062], [0.725, 0.5191]], [[0.7143, 0.5934], [0.4844, 0.9143]]], [[[0.5344, 0.0926], [0.8829, 0.6101]], [[0.3628, 0.0423], [0.3741, 0.6879]]]]], Sub20845), 
LRes23407 = reshape_layer(Sub20845, [2, 2, 4], Res23407), 
LRes16931 = reshape_layer(Res23407, [2, 8], Res16931), 
LDot11103 = dot_layer([[0.4123, 0.5087]], [[0.8912, 0.0497]], 1, 1, Dot11103), 
LRes53791 = reshape_layer(Dot11103, [1, 1], Res53791), 
LRes2248 = reshape_layer(Res53791, [1, 1, 1], Res2248), 
LDep27539 = depthwise_conv2D_layer(Res2248, 1, 1,[[[[0.7036]]]],[0], 1, 1, false, Dep27539), 
LZer94146 = zero_padding2D_layer(Dep27539, 0, 0, 1, 0, Zer94146), 
LCon46778 = concatenate_layer([Zer94146,[[[[0.4095, 0.98, 0.8055], [0.0324, 0.56, 0.9645]]]]], 3, Con46778), 
LZer30188 = zero_padding2D_layer([[[[1.7713, 1.4037, 1.9994, 1.7419], [1.4775, 1.5142, 1.1925, 1.1074], [1.7642, 1.6223, 1.2569, 1.9947], [1.9512, 1.0768, 1.4202, 1.525]], [[1.7662, 1.5909, 1.0861, 1.726], [1.9797, 1.4892, 1.311, 1.6765], [1.1085, 1.1035, 1.826, 1.6732], [1.6036, 1.526, 1.326, 1.335]]]], 1, 1, 1, 1, Zer30188), 
LDep32743 = depthwise_conv2D_layer(Zer30188, 4, 3,[[[[0.3634], [0.4315], [0.7819], [0.3915]], [[0.3526], [0.4868], [0.6935], [0.4497]], [[0.2142], [0.305], [0.8224], [0.5521]]], [[[0.0968], [0.4939], [0.7661], [0.8219]], [[0.6231], [0.4374], [0.8773], [0.3024]], [[0.9762], [0.9378], [0.5074], [0.0549]]], [[[0.3932], [0.9508], [0.0199], [0.3968]], [[0.577], [0.2004], [0.9269], [0.7546]], [[0.0755], [0.2548], [0.3695], [0.8597]]], [[[0.1187], [0.5964], [0.429], [0.9122]], [[0.753], [0.324], [0.4368], [0.9029]], [[0.3657], [0.3873], [0.5307], [0.4946]]]],[0, 0, 0, 0], 2, 2, false, Dep32743), 
LMax26967 = max_pool2D_layer([[[[1.3743]]]], 1, 1, Max26967), 
LZer30104 = zero_padding2D_layer(Max26967, 0, 0, 1, 0, Zer30104), 
LCon86185 = concatenate_layer([Zer30104,[[[[0.8309, 0.6932, 0.7147], [0.4378, 0.2298, 0.4387]]]]], 3, Con86185), 
LMul91090 = multiply_layer([Dep32743,Con86185], Mul91090), 
LAve80980 = average_layer([Con46778,Mul91090], Ave80980), 
LRes74902 = reshape_layer(Ave80980, [1, 8], Res74902), 
LZer66872 = zero_padding1D_layer(Res74902, 1, 0, Zer66872), 
LMax75352 = maximum_layer([[[[[[0.4685]]], [[[0.9536]]]]], [[[[[0.4841]]], [[[0.7218]]]]]], Max75352), 
LRes29902 = reshape_layer(Max75352, [2, 1, 1], Res29902), 
LRes34675 = reshape_layer(Res29902, [2, 1], Res34675), 
LDot96495 = dot_layer([[0.5466, 0.3913]], [[0.1111, 0.7549]], 1, 1, Dot96495), 
LRes25008 = reshape_layer(Dot96495, [1, 1], Res25008), 
LPRe49009 = prelu_layer(Res25008, [[0.4563]], PRe49009), 
LZer68544 = zero_padding1D_layer(PRe49009, 1, 0, Zer68544), 
LAdd52248 = add_layer([Res34675,Zer68544], Add52248), 
LCon48230 = concatenate_layer([Add52248,[[[0.4179, 0.1523, 0.2974, 0.2997, 0.8308, 0.353, 0.263], [0.099, 0.5074, 0.5314, 0.5872, 0.3676, 0.1184, 0.0472]]]], 2, Con48230), 
LAdd26410 = add_layer([Zer66872,Con48230], Add26410), 
LMul22278 = multiply_layer([Res16931,Add26410], Mul22278), 
exec_layers([LSub20845,LRes23407,LRes16931,LDot11103,LRes53791,LRes2248,LDep27539,LZer94146,LCon46778,LZer30188,LDep32743,LMax26967,LZer30104,LCon86185,LMul91090,LAve80980,LRes74902,LZer66872,LMax75352,LRes29902,LRes34675,LDot96495,LRes25008,LPRe49009,LZer68544,LAdd52248,LCon48230,LAdd26410,LMul22278],["Sub20845","Res23407","Res16931","Dot11103","Res53791","Res2248","Dep27539","Zer94146","Con46778","Zer30188","Dep32743","Max26967","Zer30104","Con86185","Mul91090","Ave80980","Res74902","Zer66872","Max75352","Res29902","Res34675","Dot96495","Res25008","PRe49009","Zer68544","Add52248","Con48230","Add26410","Mul22278"],Mul22278,"Mul22278")

Actual (Unparsed): [[[0.0633687, 0.1774821, -0.0184588, 0.0431825, -0.1262037, -0.0467740, -0.1523548, 0.0208296], [0.1892545, 0.8284998, -0.1872518, -0.0031868, 0.9745258, 1.1619796, -0.1506009, -0.7812364]]]

Expected (Unparsed): [[[0.06336869,0.17748213,-0.018458759999999994,0.043182479999999995,-0.12620367000000002,-0.04677404000000001,-0.15235479999999998,0.020829600000000014],[0.18925448653499996,0.8284997773751226,-0.1872518217313459,-0.003186870861756635,0.9745258729129301,1.1619796932371602,-0.150600892966908,-0.7812363698119105]]]

Actual:   [[[0.0634, 0.1775, -0.0184, 0.0432, -0.1262, -0.0467, -0.1523, 0.0209], [0.1893, 0.8285, -0.1872, -0.0031, 0.9746, 1.162, -0.1506, -0.7812]]]

Expected: [[[0.0634, 0.1775, -0.0184, 0.0432, -0.1262, -0.0467, -0.1523, 0.0209], [0.1893, 0.8285, -0.1872, -0.0031, 0.9746, 1.162, -0.1506, -0.7812]]]