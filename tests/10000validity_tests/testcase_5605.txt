import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sep74700 = tf.keras.layers.Input(shape=([1, 1]))
in0Dot98375 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot98375 = tf.keras.layers.Input(shape=([3, 2]))
in0LST22556 = tf.keras.layers.Input(shape=([1, 3]))

Sep74700 = keras.layers.SeparableConv1D(4, (1),strides=(1), padding='same', name = 'Sep74700', )(in0Sep74700)
Per80071 = keras.layers.Permute((2,1), name = 'Per80071',)(Sep74700)
Res96743 = keras.layers.Reshape((4, 1, 1), name = 'Res96743', )(Per80071)
Zer14388 = keras.layers.ZeroPadding2D(padding=((0, 0), (4, 0)), name = 'Zer14388', )(Res96743)
Dot98375 = keras.layers.Dot(axes=(2, 2), name = 'Dot98375', )([in0Dot98375,in1Dot98375])
Res95799 = keras.layers.Reshape((3, 3, 1), name = 'Res95799', )(Dot98375)
LST22556 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST22556', )(in0LST22556)
Res79491 = keras.layers.Reshape((2, 1), name = 'Res79491', )(LST22556)
Res53321 = keras.layers.Reshape((2, 1, 1), name = 'Res53321', )(Res79491)
Up_75372 = keras.layers.UpSampling2D(size=(1, 2), name = 'Up_75372', )(Res53321)
Zer90846 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer90846', )(Up_75372)
Min26252 = keras.layers.Minimum(name = 'Min26252', )([Res95799,Zer90846])
Zer56184 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer56184', )(Min26252)
Sub46958 = keras.layers.Subtract(name = 'Sub46958', )([Zer14388,Zer56184])
model = tf.keras.models.Model(inputs=[in0Sep74700,in0Dot98375,in1Dot98375,in0LST22556], outputs=Sub46958)
w = model.get_layer('Sep74700').get_weights() 
w[0] = np.array([[[0.6722]]])
w[1] = np.array([[[0.675, 0.9647, 0.0564, 0.6098]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep74700').set_weights(w) 
w = model.get_layer('LST22556').get_weights() 
w[0] = np.array([[1, 8, 8, 5, 2, 1, 10, 9], [1, 7, 8, 10, 2, 9, 1, 3], [5, 9, 6, 4, 3, 8, 3, 6]])
w[1] = np.array([[2, 3, 3, 3, 5, 8, 4, 10], [4, 3, 1, 3, 10, 2, 6, 9]])
w[2] = np.array([6, 5, 3, 9, 5, 10, 2, 1])
model.get_layer('LST22556').set_weights(w) 
in0Sep74700 = tf.constant([[[0.2383]]])
in0Dot98375 = tf.constant([[[0.9121, 0.3392], [0.4842, 0.5725], [0.2632, 0.7779]]])
in1Dot98375 = tf.constant([[[0.4076, 0.5324], [0.0326, 0.416], [0.9153, 0.9834]]])
in0LST22556 = tf.constant([[[4, 9, 9]]])
print (np.array2string(model.predict([in0Sep74700,in0Dot98375,in1Dot98375,in0LST22556],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub46958.png')

LSep74700 = separable_conv1D_layer([[[0.2383]]], 1,[[[[0.6722]]],[[[0.675, 0.9647, 0.0564, 0.6098]]]],[0, 0, 0, 0], 1, true, Sep74700), 
LPer80071 = permute_layer(Sep74700, 2,1, Per80071), 
LRes96743 = reshape_layer(Per80071, [4, 1, 1], Res96743), 
LZer14388 = zero_padding2D_layer(Res96743, 0, 0, 4, 0, Zer14388), 
LDot98375 = dot_layer([[[0.9121, 0.3392], [0.4842, 0.5725], [0.2632, 0.7779]]], [[[0.4076, 0.5324], [0.0326, 0.416], [0.9153, 0.9834]]], 2, 2, Dot98375), 
LRes95799 = reshape_layer(Dot98375, [3, 3, 1], Res95799), 
LLST22556 = lstm_layer([[[4, 9, 9]]],[[1, 8, 8, 5, 2, 1, 10, 9], [1, 7, 8, 10, 2, 9, 1, 3], [5, 9, 6, 4, 3, 8, 3, 6]],[[2, 3, 3, 3, 5, 8, 4, 10], [4, 3, 1, 3, 10, 2, 6, 9]],[6, 5, 3, 9, 5, 10, 2, 1], LST22556), 
LRes79491 = reshape_layer(LST22556, [2, 1], Res79491), 
LRes53321 = reshape_layer(Res79491, [2, 1, 1], Res53321), 
LUp_75372 = up_sampling2D_layer(Res53321, 1, 2, Up_75372), 
LZer90846 = zero_padding2D_layer(Up_75372, 1, 0, 1, 0, Zer90846), 
LMin26252 = minimum_layer([Res95799,Zer90846], Min26252), 
LZer56184 = zero_padding2D_layer(Min26252, 1, 0, 2, 0, Zer56184), 
LSub46958 = subtract_layer(Zer14388,Zer56184, Sub46958), 
exec_layers([LSep74700,LPer80071,LRes96743,LZer14388,LDot98375,LRes95799,LLST22556,LRes79491,LRes53321,LUp_75372,LZer90846,LMin26252,LZer56184,LSub46958],["Sep74700","Per80071","Res96743","Zer14388","Dot98375","Res95799","LST22556","Res79491","Res53321","Up_75372","Zer90846","Min26252","Zer56184","Sub46958"],Sub46958,"Sub46958")

Actual (Unparsed): [[[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.1081250]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.1545307]], [[0.0000000], [0.0000000], [0.0000000], [-0.2539449], [-0.7525597]], [[0.0000000], [0.0000000], [0.0000000], [-0.3321867], [-0.6639132]]]]

Expected (Unparsed): [[[[0],[0],[0],[0],[0.10812505050000003]],[[0],[0],[0],[0],[0.15453072032200002]],[[0],[0],[0],[-0.25394491999999996],[-0.7525597072917648]],[[0],[0],[0],[-0.33218672],[-0.6639131844077648]]]]

Actual:   [[[[0], [0], [0], [0], [0.1082]], [[0], [0], [0], [0], [0.1546]], [[0], [0], [0], [-0.2539], [-0.7525]], [[0], [0], [0], [-0.3321], [-0.6639]]]]

Expected: [[[[0], [0], [0], [0], [0.1082]], [[0], [0], [0], [0], [0.1546]], [[0], [0], [0], [-0.2539], [-0.7525]], [[0], [0], [0], [-0.3321], [-0.6639]]]]