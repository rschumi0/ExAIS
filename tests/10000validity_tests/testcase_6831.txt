import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub82747 = tf.keras.layers.Input(shape=([3, 3, 3, 2]))
in1Sub82747 = tf.keras.layers.Input(shape=([3, 3, 3, 2]))
in0Con24422 = tf.keras.layers.Input(shape=([1, 4]))
in0Add61152 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Add61152 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con21930 = tf.keras.layers.Input(shape=([1, 7]))
in0Add63401 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Add63401 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Per92812 = tf.keras.layers.Input(shape=([3, 1]))
in0Con88902 = tf.keras.layers.Input(shape=([1, 5]))
in0Loc20290 = tf.keras.layers.Input(shape=([1, 2]))
in0Con60429 = tf.keras.layers.Input(shape=([1, 6]))

Sub82747 = keras.layers.Subtract(name = 'Sub82747', )([in0Sub82747,in1Sub82747])
Res71985 = keras.layers.Reshape((3, 3, 6), name = 'Res71985', )(Sub82747)
Res9502 = keras.layers.Reshape((3, 18), name = 'Res9502', )(Res71985)
GRU36440 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU36440', )(Res9502)
Res66122 = keras.layers.Reshape((1, 1), name = 'Res66122', )(GRU36440)
Res77679 = keras.layers.Reshape((1, 1, 1), name = 'Res77679', )(Res66122)
Con57051 = keras.layers.Conv2D(4, (1, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con57051', )(Res77679)
Res12096 = keras.layers.Reshape((1, 4), name = 'Res12096', )(Con57051)
Con24422 = keras.layers.Concatenate(axis=2, name = 'Con24422', )([Res12096,in0Con24422])
Add61152 = keras.layers.Add(name = 'Add61152', )([in0Add61152,in1Add61152])
Res97008 = keras.layers.Reshape((1, 1), name = 'Res97008', )(Add61152)
Con21930 = keras.layers.Concatenate(axis=2, name = 'Con21930', )([Res97008,in0Con21930])
Add63401 = keras.layers.Add(name = 'Add63401', )([in0Add63401,in1Add63401])
Bat20957 = keras.layers.BatchNormalization(axis=3, epsilon=0.9162392227052997,  name = 'Bat20957', )(Add63401)
Res67063 = keras.layers.Reshape((1, 2, 4), name = 'Res67063', )(Bat20957)
Res76819 = keras.layers.Reshape((1, 8), name = 'Res76819', )(Res67063)
Per92812 = keras.layers.Permute((2,1), name = 'Per92812',)(in0Per92812)
Con88902 = keras.layers.Concatenate(axis=2, name = 'Con88902', )([Per92812,in0Con88902])
Sub20381 = keras.layers.Subtract(name = 'Sub20381', )([Res76819,Con88902])
Mul71056 = keras.layers.Multiply(name = 'Mul71056', )([Con21930,Sub20381])
Loc20290 = keras.layers.LocallyConnected1D(2, (1),strides=(1), name = 'Loc20290', )(in0Loc20290)
Con60429 = keras.layers.Concatenate(axis=2, name = 'Con60429', )([Loc20290,in0Con60429])
Sub25236 = keras.layers.Subtract(name = 'Sub25236', )([Mul71056,Con60429])
Dot17308 = keras.layers.Dot(axes=(1, 1), name = 'Dot17308', )([Con24422,Sub25236])
model = tf.keras.models.Model(inputs=[in0Sub82747,in1Sub82747,in0Con24422,in0Add61152,in1Add61152,in0Con21930,in0Add63401,in1Add63401,in0Per92812,in0Con88902,in0Loc20290,in0Con60429], outputs=Dot17308)
w = model.get_layer('GRU36440').get_weights() 
w[0] = np.array([[10, 10, 5], [6, 7, 3], [3, 6, 10], [3, 7, 2], [8, 4, 10], [2, 9, 1], [10, 8, 3], [8, 4, 10], [1, 3, 2], [6, 9, 6], [2, 7, 8], [1, 9, 6], [10, 7, 9], [1, 7, 10], [2, 5, 4], [4, 7, 5], [5, 1, 8], [2, 10, 10]])
w[1] = np.array([[1, 10, 2]])
w[2] = np.array([[3, 6, 9], [7, 6, 7]])
model.get_layer('GRU36440').set_weights(w) 
w = model.get_layer('Con57051').get_weights() 
w[0] = np.array([[[[0.5344, 0.1032, 0.9605, 0.0592]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con57051').set_weights(w) 
w = model.get_layer('Bat20957').get_weights() 
w[0] = np.array([0.9859, 0.9558])
w[1] = np.array([0.2854, 0.2112])
w[2] = np.array([0.1666, 0.6996])
w[3] = np.array([0.7066, 0.5626])
model.get_layer('Bat20957').set_weights(w) 
w = model.get_layer('Loc20290').get_weights() 
w[0] = np.array([[[0.653, 0.3459], [0.885, 0.0426]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc20290').set_weights(w) 
in0Sub82747 = tf.constant([[[[[0.97, 0.8403], [0.5499, 0.2084], [0.7674, 0.4468]], [[0.2177, 0.5461], [0.4395, 0.6272], [0.2287, 0.056]], [[0.288, 0.8713], [0.6364, 0.9887], [0.6101, 0.6372]]], [[[0.6125, 0.7174], [0.4664, 0.2375], [0.8964, 0.4504]], [[0.3139, 0.5744], [0.3269, 0.0663], [0.7726, 0.8992]], [[0.2442, 0.5114], [0.0984, 0.37], [0.5028, 0.0574]]], [[[0.7725, 0.5541], [0.8089, 0.8621], [0.9864, 0.1799]], [[0.1068, 0.6962], [0.6991, 0.3826], [0.7792, 0.4053]], [[0.3756, 0.4066], [0.4964, 0.6589], [0.4776, 0.2281]]]]])
in1Sub82747 = tf.constant([[[[[0.6517, 0.8088], [0.2684, 0.8447], [0.4566, 0.2227]], [[0.5213, 0.0425], [0.9304, 0.2914], [0.2745, 0.294]], [[0.2197, 0.417], [0.8628, 0.0686], [0.9058, 0.6794]]], [[[0.0758, 0.2422], [0.2228, 0.5559], [0.4389, 0.4833]], [[0.3923, 0.0171], [0.2975, 0.461], [0.608, 0.5615]], [[0.5944, 0.4722], [0.5531, 0.2676], [0.9741, 0.6161]]], [[[0.7168, 0.7378], [0.1222, 0.9609], [0.1923, 0.889]], [[0.0542, 0.237], [0.0856, 0.9072], [0.4044, 0.4734]], [[0.1405, 0.3198], [0.6335, 0.645], [0.6936, 0.0678]]]]])
in0Con24422 = tf.constant([[[0.2133, 0.1473, 0.925, 0.7727]]])
in0Add61152 = tf.constant([[[[0.4733]]]])
in1Add61152 = tf.constant([[[[0.8417]]]])
in0Con21930 = tf.constant([[[0.5814, 0.7507, 0.9603, 0.8317, 0.8934, 0.9536, 0.3307]]])
in0Add63401 = tf.constant([[[[[0.6165, 0.6607], [0.8588, 0.6871]], [[0.4686, 0.9825], [0.0563, 0.7378]]]]])
in1Add63401 = tf.constant([[[[[0.6911, 0.0863], [0.694, 0.3732]], [[0.3039, 0.3596], [0.9223, 0.2533]]]]])
in0Per92812 = tf.constant([[[1.2327], [1.7731], [1.9884]]])
in0Con88902 = tf.constant([[[0.206, 0.6612, 0.7907, 0.7106, 0.3308]]])
in0Loc20290 = tf.constant([[[0.764, 0.0905]]])
in0Con60429 = tf.constant([[[0.7053, 0.9788, 0.4917, 0.1198, 0.5375, 0.5791]]])
print (np.array2string(model.predict([in0Sub82747,in1Sub82747,in0Con24422,in0Add61152,in1Add61152,in0Con21930,in0Add63401,in1Add63401,in0Per92812,in0Con88902,in0Loc20290,in0Con60429],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot17308.png')

LSub82747 = subtract_layer([[[[[0.97, 0.8403], [0.5499, 0.2084], [0.7674, 0.4468]], [[0.2177, 0.5461], [0.4395, 0.6272], [0.2287, 0.056]], [[0.288, 0.8713], [0.6364, 0.9887], [0.6101, 0.6372]]], [[[0.6125, 0.7174], [0.4664, 0.2375], [0.8964, 0.4504]], [[0.3139, 0.5744], [0.3269, 0.0663], [0.7726, 0.8992]], [[0.2442, 0.5114], [0.0984, 0.37], [0.5028, 0.0574]]], [[[0.7725, 0.5541], [0.8089, 0.8621], [0.9864, 0.1799]], [[0.1068, 0.6962], [0.6991, 0.3826], [0.7792, 0.4053]], [[0.3756, 0.4066], [0.4964, 0.6589], [0.4776, 0.2281]]]]], [[[[[0.6517, 0.8088], [0.2684, 0.8447], [0.4566, 0.2227]], [[0.5213, 0.0425], [0.9304, 0.2914], [0.2745, 0.294]], [[0.2197, 0.417], [0.8628, 0.0686], [0.9058, 0.6794]]], [[[0.0758, 0.2422], [0.2228, 0.5559], [0.4389, 0.4833]], [[0.3923, 0.0171], [0.2975, 0.461], [0.608, 0.5615]], [[0.5944, 0.4722], [0.5531, 0.2676], [0.9741, 0.6161]]], [[[0.7168, 0.7378], [0.1222, 0.9609], [0.1923, 0.889]], [[0.0542, 0.237], [0.0856, 0.9072], [0.4044, 0.4734]], [[0.1405, 0.3198], [0.6335, 0.645], [0.6936, 0.0678]]]]], Sub82747), 
LRes71985 = reshape_layer(Sub82747, [3, 3, 6], Res71985), 
LRes9502 = reshape_layer(Res71985, [3, 18], Res9502), 
LGRU36440 = gru_layer(Res9502,[[10, 10, 5], [6, 7, 3], [3, 6, 10], [3, 7, 2], [8, 4, 10], [2, 9, 1], [10, 8, 3], [8, 4, 10], [1, 3, 2], [6, 9, 6], [2, 7, 8], [1, 9, 6], [10, 7, 9], [1, 7, 10], [2, 5, 4], [4, 7, 5], [5, 1, 8], [2, 10, 10]],[[1, 10, 2]],[[3, 6, 9], [7, 6, 7]], true, GRU36440), 
LRes66122 = reshape_layer(GRU36440, [1, 1], Res66122), 
LRes77679 = reshape_layer(Res66122, [1, 1, 1], Res77679), 
LCon57051 = conv2D_layer(Res77679, 1, 1,[[[[0.5344, 0.1032, 0.9605, 0.0592]]]],[0, 0, 0, 0], 1, 1, false, 1, 1, Con57051), 
LRes12096 = reshape_layer(Con57051, [1, 4], Res12096), 
LCon24422 = concatenate_layer([Res12096,[[[0.2133, 0.1473, 0.925, 0.7727]]]], 2, Con24422), 
LAdd61152 = add_layer([[[[[0.4733]]]], [[[[0.8417]]]]], Add61152), 
LRes97008 = reshape_layer(Add61152, [1, 1], Res97008), 
LCon21930 = concatenate_layer([Res97008,[[[0.5814, 0.7507, 0.9603, 0.8317, 0.8934, 0.9536, 0.3307]]]], 2, Con21930), 
LAdd63401 = add_layer([[[[[[0.6165, 0.6607], [0.8588, 0.6871]], [[0.4686, 0.9825], [0.0563, 0.7378]]]]], [[[[[0.6911, 0.0863], [0.694, 0.3732]], [[0.3039, 0.3596], [0.9223, 0.2533]]]]]], Add63401), 
LBat20957 = batch_normalization_layer(Add63401, 3, 0.9162392227052997, [0.9859, 0.9558], [0.2854, 0.2112], [0.1666, 0.6996], [0.7066, 0.5626], Bat20957), 
LRes67063 = reshape_layer(Bat20957, [1, 2, 4], Res67063), 
LRes76819 = reshape_layer(Res67063, [1, 8], Res76819), 
LPer92812 = permute_layer([[[1.2327], [1.7731], [1.9884]]], 2,1, Per92812), 
LCon88902 = concatenate_layer([Per92812,[[[0.206, 0.6612, 0.7907, 0.7106, 0.3308]]]], 2, Con88902), 
LSub20381 = subtract_layer(Res76819,Con88902, Sub20381), 
LMul71056 = multiply_layer([Con21930,Sub20381], Mul71056), 
LLoc20290 = locally_connected1D_layer([[[0.764, 0.0905]]], 1,[[[0.653, 0.3459], [0.885, 0.0426]]],[[0, 0]], 1, Loc20290), 
LCon60429 = concatenate_layer([Loc20290,[[[0.7053, 0.9788, 0.4917, 0.1198, 0.5375, 0.5791]]]], 2, Con60429), 
LSub25236 = subtract_layer(Mul71056,Con60429, Sub25236), 
LDot17308 = dot_layer(Con24422,Sub25236, 1, 1, Dot17308), 
exec_layers([LSub82747,LRes71985,LRes9502,LGRU36440,LRes66122,LRes77679,LCon57051,LRes12096,LCon24422,LAdd61152,LRes97008,LCon21930,LAdd63401,LBat20957,LRes67063,LRes76819,LPer92812,LCon88902,LSub20381,LMul71056,LLoc20290,LCon60429,LSub25236,LDot17308],["Sub82747","Res71985","Res9502","GRU36440","Res66122","Res77679","Con57051","Res12096","Con24422","Add61152","Res97008","Con21930","Add63401","Bat20957","Res67063","Res76819","Per92812","Con88902","Sub20381","Mul71056","Loc20290","Con60429","Sub25236","Dot17308"],Dot17308,"Dot17308")

Actual (Unparsed): [[[-0.0000000, -0.0000000, -0.0000001, -0.0000000, -0.0000000, 0.0000000, -0.0000000, -0.0000000], [-0.0000000, -0.0000000, -0.0000000, -0.0000000, -0.0000000, 0.0000000, -0.0000000, -0.0000000], [-0.0000001, -0.0000001, -0.0000001, -0.0000001, -0.0000000, 0.0000000, -0.0000001, -0.0000001], [-0.0000000, -0.0000000, -0.0000000, -0.0000000, -0.0000000, 0.0000000, -0.0000000, -0.0000000], [-0.1415214, -0.1859799, -0.3276356, -0.1496431, -0.0883605, 0.0515178, -0.1716248, -0.1157973], [-0.0977314, -0.1284334, -0.2262575, -0.1033400, -0.0610197, 0.0355770, -0.1185201, -0.0799669], [-0.6137239, -0.8065234, -1.4208294, -0.6489445, -0.3831854, 0.2234130, -0.7442706, -0.5021685], [-0.5126751, -0.6737304, -1.1868917, -0.5420967, -0.3200944, 0.1866284, -0.6217274, -0.4194871]]]

Expected (Unparsed): [[[-3.554681012377334e-8,-4.671372605977297e-8,-8.229424781068744e-8,-3.7586779045568735e-8,-2.2194048353341262e-8,1.2940050756583832e-8,-4.310804961447043e-8,-2.908553216071939e-8],[-6.8645786017466475e-9,-9.021063864836397e-9,-1.589215264607587e-8,-7.258524695925699e-9,-4.285976403564406e-9,2.498902017364243e-9,-8.324758084231564e-9,-5.616816839420361e-9],[-6.388980374978348e-8,-8.39605798660403e-8,-1.4791097496662666e-7,-6.755632723291312e-8,-3.989031332968615e-8,2.3257707244945307e-8,-7.747994321612807e-8,-5.2276672231233106e-8],[-3.937820283172495e-9,-5.17487384494491e-9,-9.116428649686933e-9,-4.1638048643294705e-9,-2.45862212297493e-9,1.4334786766275503e-9,-4.775442621962292e-9,-3.2220499699000523e-9],[-0.14152142871756607,-0.1859799298356368,-0.3276355736240009,-0.1496430946377055,-0.08836048638555549,0.05151782858639164,-0.1716247604053643,-0.1157973402413072],[-0.09773139451522495,-0.12843339739704313,-0.22625747770658852,-0.10334002737990633,-0.061019688910418764,0.03557700961451237,-0.11852005254435144,-0.07996693960405321],[-0.6137239641994778,-0.8065233712984718,-1.420829374600098,-0.6489445032343066,-0.38318541915911314,0.22341299316648977,-0.7442705268399531,-0.5021684937796961],[-0.5126751428507422,-0.6737303881106261,-1.1868917381118873,-0.5420966677288095,-0.3200944577126992,0.18662834575107748,-0.6217273903667371,-0.4194871298849418]]]

Actual:   [[[-0, -0, -0, -0, -0, 0, -0, -0], [-0, -0, -0, -0, -0, 0, -0, -0], [-0, -0, -0, -0, -0, 0, -0, -0], [-0, -0, -0, -0, -0, 0, -0, -0], [-0.1415, -0.1859, -0.3276, -0.1496, -0.0883, 0.0516, -0.1716, -0.1157], [-0.0977, -0.1284, -0.2262, -0.1033, -0.061, 0.0356, -0.1185, -0.0799], [-0.6137, -0.8065, -1.4208, -0.6489, -0.3831, 0.2235, -0.7442, -0.5021], [-0.5126, -0.6737, -1.1868, -0.542, -0.32, 0.1867, -0.6217, -0.4194]]]

Expected: [[[-0, -0, -0, -0, -0, 0, -0, -0], [-0, -0, -0, -0, -0, 0, -0, -0], [-0, -0, -0, -0, -0, 0, -0, -0], [-0, -0, -0, -0, -0, 0, -0, -0], [-0.1415, -0.1859, -0.3276, -0.1496, -0.0883, 0.0516, -0.1716, -0.1157], [-0.0977, -0.1284, -0.2262, -0.1033, -0.061, 0.0356, -0.1185, -0.0799], [-0.6137, -0.8065, -1.4208, -0.6489, -0.3831, 0.2235, -0.7442, -0.5021], [-0.5126, -0.6737, -1.1868, -0.542, -0.32, 0.1867, -0.6217, -0.4194]]]