import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave77974 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Mul89345 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul89345 = tf.keras.layers.Input(shape=([2, 1]))
in0Con77739 = tf.keras.layers.Input(shape=([2, 1]))

Ave77974 = keras.layers.AveragePooling2D(pool_size=(1, 2), name = 'Ave77974', )(in0Ave77974)
Res35054 = keras.layers.Reshape((1, 2), name = 'Res35054', )(Ave77974)
Zer31571 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer31571', )(Res35054)
Mul89345 = keras.layers.Multiply(name = 'Mul89345', )([in0Mul89345,in1Mul89345])
Con77739 = keras.layers.Concatenate(axis=2, name = 'Con77739', )([Mul89345,in0Con77739])
Min95518 = keras.layers.Minimum(name = 'Min95518', )([Zer31571,Con77739])
Per88908 = keras.layers.Permute((2,1), name = 'Per88908',)(Min95518)
Res4531 = keras.layers.Reshape((2, 2, 1), name = 'Res4531', )(Per88908)
Res99870 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res99870', )(Res4531)
Con87186 = keras.layers.Conv3D(2, (1, 1, 1),strides=(7, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con87186', )(Res99870)
model = tf.keras.models.Model(inputs=[in0Ave77974,in0Mul89345,in1Mul89345,in0Con77739], outputs=Con87186)
w = model.get_layer('Con87186').get_weights() 
w[0] = np.array([[[[[0.9875, 0.9056]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con87186').set_weights(w) 
in0Ave77974 = tf.constant([[[[1.7821, 1.2966], [1.3126, 1.3431]]]])
in0Mul89345 = tf.constant([[[0.4339], [0.9698]]])
in1Mul89345 = tf.constant([[[0.9775], [0.2293]]])
in0Con77739 = tf.constant([[[0.518], [0.5192]]])
print (np.array2string(model.predict([in0Ave77974,in0Mul89345,in1Mul89345,in0Con77739],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con87186.png')

LAve77974 = average_pooling2D_layer([[[[1.7821, 1.2966], [1.3126, 1.3431]]]], 1, 2, Ave77974), 
LRes35054 = reshape_layer(Ave77974, [1, 2], Res35054), 
LZer31571 = zero_padding1D_layer(Res35054, 1, 0, Zer31571), 
LMul89345 = multiply_layer([[[[0.4339], [0.9698]]], [[[0.9775], [0.2293]]]], Mul89345), 
LCon77739 = concatenate_layer([Mul89345,[[[0.518], [0.5192]]]], 2, Con77739), 
LMin95518 = minimum_layer([Zer31571,Con77739], Min95518), 
LPer88908 = permute_layer(Min95518, 2,1, Per88908), 
LRes4531 = reshape_layer(Per88908, [2, 2, 1], Res4531), 
LRes99870 = reshape_layer(Res4531, [2, 2, 1, 1], Res99870), 
LCon87186 = conv3D_layer(Res99870, 1, 1, 1,[[[[[0.9875, 0.9056]]]]],[0, 0], 7, 1, 1, true, 1, 1, 1, Con87186), 
exec_layers([LAve77974,LRes35054,LZer31571,LMul89345,LCon77739,LMin95518,LPer88908,LRes4531,LRes99870,LCon87186],["Ave77974","Res35054","Zer31571","Mul89345","Con77739","Min95518","Per88908","Res4531","Res99870","Con87186"],Con87186,"Con87186")

Actual (Unparsed): [[[[[0.0000000, 0.0000000]], [[0.2195955, 0.2013829]]]]]

Expected (Unparsed): [[[[[0.0,0.0]],[[0.21959545075,0.201382926784]]]]]

Actual:   [[[[[0, 0]], [[0.2196, 0.2014]]]]]

Expected: [[[[[0, 0]], [[0.2196, 0.2014]]]]]