import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST2013 = tf.keras.layers.Input(shape=([3, 2]))
in0Sub89084 = tf.keras.layers.Input(shape=([3]))
in1Sub89084 = tf.keras.layers.Input(shape=([3]))

LST2013 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST2013', )(in0LST2013)
Res60194 = keras.layers.Reshape((3, 1), name = 'Res60194', )(LST2013)
Sub89084 = keras.layers.Subtract(name = 'Sub89084', )([in0Sub89084,in1Sub89084])
Res60502 = keras.layers.Reshape((3, 1), name = 'Res60502', )(Sub89084)
Cro54130 = keras.layers.Cropping1D(cropping=((2, 0)), name = 'Cro54130', )(Res60502)
Zer67857 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer67857', )(Cro54130)
Min40049 = keras.layers.Minimum(name = 'Min40049', )([Res60194,Zer67857])
Mas77989 = keras.layers.Masking(mask_value=2, name = 'Mas77989', )(Min40049)
model = tf.keras.models.Model(inputs=[in0LST2013,in0Sub89084,in1Sub89084], outputs=Mas77989)
w = model.get_layer('LST2013').get_weights() 
w[0] = np.array([[9, 10, 1, 10, 3, 3, 5, 6, 10, 3, 3, 7], [4, 3, 1, 9, 4, 7, 4, 10, 3, 8, 7, 2]])
w[1] = np.array([[8, 2, 8, 10, 1, 6, 1, 7, 6, 8, 7, 7], [1, 8, 6, 1, 2, 4, 1, 8, 1, 2, 2, 2], [6, 7, 4, 3, 1, 5, 9, 3, 1, 5, 3, 2]])
w[2] = np.array([3, 8, 6, 3, 8, 7, 9, 3, 1, 10, 2, 8])
model.get_layer('LST2013').set_weights(w) 
in0LST2013 = tf.constant([[[6, 4], [4, 9], [3, 8]]])
in0Sub89084 = tf.constant([[0.4098, 0.0341, 0.4962]])
in1Sub89084 = tf.constant([[0.2507, 0.8088, 0.9855]])
print (np.array2string(model.predict([in0LST2013,in0Sub89084,in1Sub89084],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mas77989.png')

LLST2013 = lstm_layer([[[6, 4], [4, 9], [3, 8]]],[[9, 10, 1, 10, 3, 3, 5, 6, 10, 3, 3, 7], [4, 3, 1, 9, 4, 7, 4, 10, 3, 8, 7, 2]],[[8, 2, 8, 10, 1, 6, 1, 7, 6, 8, 7, 7], [1, 8, 6, 1, 2, 4, 1, 8, 1, 2, 2, 2], [6, 7, 4, 3, 1, 5, 9, 3, 1, 5, 3, 2]],[3, 8, 6, 3, 8, 7, 9, 3, 1, 10, 2, 8], LST2013), 
LRes60194 = reshape_layer(LST2013, [3, 1], Res60194), 
LSub89084 = subtract_layer([[0.4098, 0.0341, 0.4962]], [[0.2507, 0.8088, 0.9855]], Sub89084), 
LRes60502 = reshape_layer(Sub89084, [3, 1], Res60502), 
LCro54130 = cropping1D_layer(Res60502, 2, 0, Cro54130), 
LZer67857 = zero_padding1D_layer(Cro54130, 2, 0, Zer67857), 
LMin40049 = minimum_layer([Res60194,Zer67857], Min40049), 
LMas77989 = masking_layer(Min40049, 2, Mas77989), 
exec_layers([LLST2013,LRes60194,LSub89084,LRes60502,LCro54130,LZer67857,LMin40049,LMas77989],["LST2013","Res60194","Sub89084","Res60502","Cro54130","Zer67857","Min40049","Mas77989"],Mas77989,"Mas77989")

Actual (Unparsed): [[[0.0000000], [0.0000000], [-0.4893000]]]

Expected (Unparsed): [[[0],[0],[-0.48930000000000007]]]

Actual:   [[[0], [0], [-0.4893]]]

Expected: [[[0], [0], [-0.4893]]]