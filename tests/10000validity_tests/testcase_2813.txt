import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Fla34281 = tf.keras.layers.Input(shape=([4, 4]))
in0Dot90644 = tf.keras.layers.Input(shape=([3]))
in1Dot90644 = tf.keras.layers.Input(shape=([3]))
in0Con86331 = tf.keras.layers.Input(shape=([15]))

Fla34281 = keras.layers.Flatten(name = 'Fla34281', )(in0Fla34281)
Dot90644 = keras.layers.Dot(axes=(1, 1), name = 'Dot90644', )([in0Dot90644,in1Dot90644])
Res62724 = keras.layers.Reshape((1, 1), name = 'Res62724', )(Dot90644)
Glo1162 = keras.layers.GlobalMaxPool1D(name = 'Glo1162', )(Res62724)
Con86331 = keras.layers.Concatenate(axis=1, name = 'Con86331', )([Glo1162,in0Con86331])
Sub23200 = keras.layers.Subtract(name = 'Sub23200', )([Fla34281,Con86331])
model = tf.keras.models.Model(inputs=[in0Fla34281,in0Dot90644,in1Dot90644,in0Con86331], outputs=Sub23200)
in0Fla34281 = tf.constant([[[1.0676, 1.7172, 1.0282, 1.5653], [1.0368, 1.4806, 1.6392, 1.6211], [1.4908, 1.6518, 1.9697, 1.345], [1.4083, 1.8786, 1.9226, 1.0391]]])
in0Dot90644 = tf.constant([[0.8422, 0.1816, 0.2]])
in1Dot90644 = tf.constant([[0.2303, 0.4069, 0.0259]])
in0Con86331 = tf.constant([[0.2469, 0.4963, 0.4021, 0.2633, 0.4941, 0.8685, 0.489, 0.6919, 0.8415, 0.1393, 0.2333, 0.2247, 0.7236, 0.5003, 0.0289]])
print (np.array2string(model.predict([in0Fla34281,in0Dot90644,in1Dot90644,in0Con86331],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub23200.png')

LFla34281 = flatten_layer([[[1.0676, 1.7172, 1.0282, 1.5653], [1.0368, 1.4806, 1.6392, 1.6211], [1.4908, 1.6518, 1.9697, 1.345], [1.4083, 1.8786, 1.9226, 1.0391]]], Fla34281), 
LDot90644 = dot_layer([[0.8422, 0.1816, 0.2]], [[0.2303, 0.4069, 0.0259]], 1, 1, Dot90644), 
LRes62724 = reshape_layer(Dot90644, [1, 1], Res62724), 
LGlo1162 = global_max_pool1D_layer(Res62724, Glo1162), 
LCon86331 = concatenate_layer([Glo1162,[[0.2469, 0.4963, 0.4021, 0.2633, 0.4941, 0.8685, 0.489, 0.6919, 0.8415, 0.1393, 0.2333, 0.2247, 0.7236, 0.5003, 0.0289]]], 1, Con86331), 
LSub23200 = subtract_layer(Fla34281,Con86331, Sub23200), 
exec_layers([LFla34281,LDot90644,LRes62724,LGlo1162,LCon86331,LSub23200],["Fla34281","Dot90644","Res62724","Glo1162","Con86331","Sub23200"],Sub23200,"Sub23200")

Actual (Unparsed): [[0.7945683, 1.4703000, 0.5319000, 1.1632000, 0.7735000, 0.9865000, 0.7707000, 1.1321000, 0.7989000, 0.8103001, 1.8304000, 1.1117000, 1.1836000, 1.1550000, 1.4223000, 1.0102001]]

Expected (Unparsed): [[0.7945683000000001,1.4703,0.5319,1.1631999999999998,0.7735,0.9864999999999999,0.7706999999999999,1.1320999999999999,0.7988999999999999,0.8102999999999999,1.8304,1.1117,1.1836000000000002,1.155,1.4223000000000001,1.0102]]

Actual:   [[0.7946, 1.4703, 0.5319, 1.1632, 0.7735, 0.9865, 0.7707, 1.1321, 0.7989, 0.8104, 1.8304, 1.1117, 1.1836, 1.155, 1.4223, 1.0103]]

Expected: [[0.7946, 1.4703, 0.5319, 1.1632, 0.7735, 0.9865, 0.7707, 1.1321, 0.7989, 0.8103, 1.8304, 1.1117, 1.1837, 1.155, 1.4224, 1.0102]]