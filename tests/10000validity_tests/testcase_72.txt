import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave10822 = tf.keras.layers.Input(shape=([1, 1]))
in1Ave10822 = tf.keras.layers.Input(shape=([1, 1]))
in0Con18258 = tf.keras.layers.Input(shape=([4, 1]))
in0Con90061 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Sep26360 = tf.keras.layers.Input(shape=([1, 2, 2]))

Ave10822 = keras.layers.Average(name = 'Ave10822', )([in0Ave10822,in1Ave10822])
Res47431 = keras.layers.Reshape((1, 1, 1), name = 'Res47431', )(Ave10822)
Sep92457 = keras.layers.SeparableConv2D(3, (1, 1),strides=(1, 1), padding='valid', name = 'Sep92457', )(Res47431)
Thr48558 = keras.layers.ThresholdedReLU(theta=9.049417857493358, name = 'Thr48558', )(Sep92457)
Res487 = keras.layers.Reshape((1, 3), name = 'Res487', )(Thr48558)
Zer42493 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer42493', )(Res487)
Con18258 = keras.layers.Concatenate(axis=2, name = 'Con18258', )([Zer42493,in0Con18258])
Con90061 = keras.layers.Conv3D(2, (2, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con90061', )(in0Con90061)
Res35240 = keras.layers.Reshape((1, 1, 4), name = 'Res35240', )(Con90061)
Res8291 = keras.layers.Reshape((1, 4), name = 'Res8291', )(Res35240)
Sep26360 = keras.layers.SeparableConv2D(2, (1, 2),strides=(1, 1), padding='same', name = 'Sep26360', )(in0Sep26360)
Res80082 = keras.layers.Reshape((1, 4), name = 'Res80082', )(Sep26360)
Dot47083 = keras.layers.Dot(axes=(1, 1), name = 'Dot47083', )([Res8291,Res80082])
Lea58436 = keras.layers.LeakyReLU(alpha=1.9538526529172746, name = 'Lea58436', )(Dot47083)
Min15976 = keras.layers.Minimum(name = 'Min15976', )([Con18258,Lea58436])
model = tf.keras.models.Model(inputs=[in0Ave10822,in1Ave10822,in0Con18258,in0Con90061,in0Sep26360], outputs=Min15976)
w = model.get_layer('Sep92457').get_weights() 
w[0] = np.array([[[[0.2867]]]])
w[1] = np.array([[[[0.9571, 0.2052, 0.9094]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep92457').set_weights(w) 
w = model.get_layer('Con90061').get_weights() 
w[0] = np.array([[[[[0.1081, 0.3301]]]], [[[[0.7944, 0.7144]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con90061').set_weights(w) 
w = model.get_layer('Sep26360').get_weights() 
w[0] = np.array([[[[0.1264], [0.106]], [[0.2618], [0.8762]]]])
w[1] = np.array([[[[0.5693, 0.9435], [0.9529, 0.7098]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep26360').set_weights(w) 
in0Ave10822 = tf.constant([[[0.3413]]])
in1Ave10822 = tf.constant([[[0.4986]]])
in0Con18258 = tf.constant([[[0.928], [0.7399], [0.3114], [0.0726]]])
in0Con90061 = tf.constant([[[[[0.9386], [0.5607]]], [[[0.6865], [0.9841]]]]])
in0Sep26360 = tf.constant([[[[0.73, 0.9054], [0.1099, 0.315]]]])
print (np.array2string(model.predict([in0Ave10822,in1Ave10822,in0Con18258,in0Con90061,in0Sep26360],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min15976.png')

LAve10822 = average_layer([[[[0.3413]]], [[[0.4986]]]], Ave10822), 
LRes47431 = reshape_layer(Ave10822, [1, 1, 1], Res47431), 
LSep92457 = separable_conv2D_layer(Res47431, 1, 1,[[[[[0.2867]]]],[[[[0.9571, 0.2052, 0.9094]]]]],[0, 0, 0], 1, 1, false, Sep92457), 
LThr48558 = thresholded_relu_layer(Sep92457, 9.049417857493358, Thr48558), 
LRes487 = reshape_layer(Thr48558, [1, 3], Res487), 
LZer42493 = zero_padding1D_layer(Res487, 3, 0, Zer42493), 
LCon18258 = concatenate_layer([Zer42493,[[[0.928], [0.7399], [0.3114], [0.0726]]]], 2, Con18258), 
LCon90061 = conv3D_layer([[[[[0.9386], [0.5607]]], [[[0.6865], [0.9841]]]]], 2, 1, 1,[[[[[0.1081, 0.3301]]]], [[[[0.7944, 0.7144]]]]],[0, 0], 1, 1, 1, false, 1, 1, 1, Con90061), 
LRes35240 = reshape_layer(Con90061, [1, 1, 4], Res35240), 
LRes8291 = reshape_layer(Res35240, [1, 4], Res8291), 
LSep26360 = separable_conv2D_layer([[[[0.73, 0.9054], [0.1099, 0.315]]]], 1, 2,[[[[[0.1264], [0.106]], [[0.2618], [0.8762]]]],[[[[0.5693, 0.9435], [0.9529, 0.7098]]]]],[0, 0], 1, 1, true, Sep26360), 
LRes80082 = reshape_layer(Sep26360, [1, 4], Res80082), 
LDot47083 = dot_layer(Res8291,Res80082, 1, 1, Dot47083), 
LLea58436 = leaky_relu_layer(Dot47083, 1.9538526529172746, Lea58436), 
LMin15976 = minimum_layer([Con18258,Lea58436], Min15976), 
exec_layers([LAve10822,LRes47431,LSep92457,LThr48558,LRes487,LZer42493,LCon18258,LCon90061,LRes35240,LRes8291,LSep26360,LRes80082,LDot47083,LLea58436,LMin15976],["Ave10822","Res47431","Sep92457","Thr48558","Res487","Zer42493","Con18258","Con90061","Res35240","Res8291","Sep26360","Res80082","Dot47083","Lea58436","Min15976"],Min15976,"Min15976")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0238073], [0.0000000, 0.0000000, 0.0000000, 0.0294552], [0.0000000, 0.0000000, 0.0000000, 0.0310053], [0.0000000, 0.0000000, 0.0000000, 0.0326891]]]

Expected (Unparsed): [[[0,0,0,0.023807258690198122],[0,0,0,0.029455220453373995],[0,0,0,0.031005271061152116],[0,0,0,0.0326890828109997]]]

Actual:   [[[0, 0, 0, 0.0239], [0, 0, 0, 0.0295], [0, 0, 0, 0.0311], [0, 0, 0, 0.0327]]]

Expected: [[[0, 0, 0, 0.0239], [0, 0, 0, 0.0295], [0, 0, 0, 0.0311], [0, 0, 0, 0.0327]]]