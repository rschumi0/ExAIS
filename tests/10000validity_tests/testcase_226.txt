import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con68481 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Glo96240 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Ave69738 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave69738 = tf.keras.layers.Input(shape=([2, 1]))
in0Con74285 = tf.keras.layers.Input(shape=([2, 1]))
in0Con4123 = tf.keras.layers.Input(shape=([2, 3, 1]))
in0Ave46646 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Ave46646 = tf.keras.layers.Input(shape=([2, 1, 2]))

Con68481 = keras.layers.Conv2D(4, (1, 1),strides=(1, 5), padding='valid', dilation_rate=(1, 1), name = 'Con68481', )(in0Con68481)
Res17191 = keras.layers.Reshape((2, 1, 4, 1), name = 'Res17191', )(Con68481)
Cro94542 = keras.layers.Cropping3D(cropping=((1, 0), (0, 0), (0, 1)), name = 'Cro94542', )(Res17191)
Res37815 = keras.layers.Reshape((1, 1, 3), name = 'Res37815', )(Cro94542)
Res59999 = keras.layers.Reshape((1, 3), name = 'Res59999', )(Res37815)
Zer60970 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer60970', )(Res59999)
Glo96240 = keras.layers.GlobalMaxPool2D(name = 'Glo96240', )(in0Glo96240)
Res38421 = keras.layers.Reshape((2, 1), name = 'Res38421', )(Glo96240)
Ave69738 = keras.layers.Average(name = 'Ave69738', )([in0Ave69738,in1Ave69738])
Dot59094 = keras.layers.Dot(axes=(2, 2), name = 'Dot59094', )([Res38421,Ave69738])
Max12369 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='same', name = 'Max12369', )(Dot59094)
Con74285 = keras.layers.Concatenate(axis=2, name = 'Con74285', )([Max12369,in0Con74285])
Max18452 = keras.layers.Maximum(name = 'Max18452', )([Zer60970,Con74285])
Res94915 = keras.layers.Reshape((2, 3, 1), name = 'Res94915', )(Max18452)
Con4123 = keras.layers.Concatenate(axis=3, name = 'Con4123', )([Res94915,in0Con4123])
Ave46646 = keras.layers.Average(name = 'Ave46646', )([in0Ave46646,in1Ave46646])
Zer47176 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer47176', )(Ave46646)
Sub94878 = keras.layers.Subtract(name = 'Sub94878', )([Con4123,Zer47176])
model = tf.keras.models.Model(inputs=[in0Con68481,in0Glo96240,in0Ave69738,in1Ave69738,in0Con74285,in0Con4123,in0Ave46646,in1Ave46646], outputs=Sub94878)
w = model.get_layer('Con68481').get_weights() 
w[0] = np.array([[[[0.9719, 0.6681, 0.1964, 0.6908], [0.2879, 0.4801, 0.0127, 0.1981]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con68481').set_weights(w) 
in0Con68481 = tf.constant([[[[0.2467, 0.9882]], [[0.6711, 0.0965]]]])
in0Glo96240 = tf.constant([[[[1.6506, 1.5843]], [[1.2357, 1.4168]]]])
in0Ave69738 = tf.constant([[[0.0532], [0.5505]]])
in1Ave69738 = tf.constant([[[0.4709], [0.2651]]])
in0Con74285 = tf.constant([[[0.1712], [0.1777]]])
in0Con4123 = tf.constant([[[[0.7879], [0.5959], [0.2879]], [[0.0144], [0.5678], [0.7053]]]])
in0Ave46646 = tf.constant([[[[0.9837, 0.0743]], [[0.4826, 0.7257]]]])
in1Ave46646 = tf.constant([[[[0.4435, 0.1756]], [[0.1855, 0.8054]]]])
print (np.array2string(model.predict([in0Con68481,in0Glo96240,in0Ave69738,in1Ave69738,in0Con74285,in0Con4123,in0Ave46646,in1Ave46646],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub94878.png')

LCon68481 = conv2D_layer([[[[0.2467, 0.9882]], [[0.6711, 0.0965]]]], 1, 1,[[[[0.9719, 0.6681, 0.1964, 0.6908], [0.2879, 0.4801, 0.0127, 0.1981]]]],[0, 0, 0, 0], 1, 5, false, 1, 1, Con68481), 
LRes17191 = reshape_layer(Con68481, [2, 1, 4, 1], Res17191), 
LCro94542 = cropping3D_layer(Res17191, 1, 0, 0, 0, 0, 1, Cro94542), 
LRes37815 = reshape_layer(Cro94542, [1, 1, 3], Res37815), 
LRes59999 = reshape_layer(Res37815, [1, 3], Res59999), 
LZer60970 = zero_padding1D_layer(Res59999, 1, 0, Zer60970), 
LGlo96240 = global_max_pool2D_layer([[[[1.6506, 1.5843]], [[1.2357, 1.4168]]]], Glo96240), 
LRes38421 = reshape_layer(Glo96240, [2, 1], Res38421), 
LAve69738 = average_layer([[[[0.0532], [0.5505]]], [[[0.4709], [0.2651]]]], Ave69738), 
LDot59094 = dot_layer(Res38421,Ave69738, 2, 2, Dot59094), 
LMax12369 = max_pool1D_layer(Dot59094, 1, 1, true, Max12369), 
LCon74285 = concatenate_layer([Max12369,[[[0.1712], [0.1777]]]], 2, Con74285), 
LMax18452 = maximum_layer([Zer60970,Con74285], Max18452), 
LRes94915 = reshape_layer(Max18452, [2, 3, 1], Res94915), 
LCon4123 = concatenate_layer([Res94915,[[[[0.7879], [0.5959], [0.2879]], [[0.0144], [0.5678], [0.7053]]]]], 3, Con4123), 
LAve46646 = average_layer([[[[[0.9837, 0.0743]], [[0.4826, 0.7257]]]], [[[[0.4435, 0.1756]], [[0.1855, 0.8054]]]]], Ave46646), 
LZer47176 = zero_padding2D_layer(Ave46646, 0, 0, 2, 0, Zer47176), 
LSub94878 = subtract_layer(Con4123,Zer47176, Sub94878), 
exec_layers([LCon68481,LRes17191,LCro94542,LRes37815,LRes59999,LZer60970,LGlo96240,LRes38421,LAve69738,LDot59094,LMax12369,LCon74285,LMax18452,LRes94915,LCon4123,LAve46646,LZer47176,LSub94878],["Con68481","Res17191","Cro94542","Res37815","Res59999","Zer60970","Glo96240","Res38421","Ave69738","Dot59094","Max12369","Con74285","Max18452","Res94915","Con4123","Ave46646","Zer47176","Sub94878"],Sub94878,"Sub94878")

Actual (Unparsed): [[[[0.4325397, 0.7879000], [0.6731146, 0.5959000], [-0.5424000, 0.1629500]], [[0.6800245, 0.0144000], [0.6460775, 0.5678000], [-0.1563500, -0.0602500]]]]

Expected (Unparsed): [[[[0.43253973,0.7879],[0.67311468,0.5959],[-0.5424,0.16294999999999998]],[[0.68002444,0.0144],[0.6460775400000001,0.5678],[-0.15634999999999996,-0.060249999999999915]]]]

Actual:   [[[[0.4326, 0.7879], [0.6732, 0.5959], [-0.5424, 0.163]], [[0.6801, 0.0144], [0.6461, 0.5678], [-0.1563, -0.0602]]]]

Expected: [[[[0.4326, 0.7879], [0.6732, 0.5959], [-0.5424, 0.163]], [[0.6801, 0.0144], [0.6461, 0.5678], [-0.1563, -0.0602]]]]