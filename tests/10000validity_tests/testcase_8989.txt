import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sep85625 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Max15235 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Max15235 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Lay79189 = tf.keras.layers.Input(shape=([2]))
in0Con46425 = tf.keras.layers.Input(shape=([2]))
in0Con62466 = tf.keras.layers.Input(shape=([12]))

Sep85625 = keras.layers.SeparableConv2D(4, (2, 2),strides=(1, 1), padding='same', name = 'Sep85625', )(in0Sep85625)
Cro2513 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro2513', )(Sep85625)
Res30075 = keras.layers.Reshape((2, 8), name = 'Res30075', )(Cro2513)
Fla98811 = keras.layers.Flatten(name = 'Fla98811', )(Res30075)
Max15235 = keras.layers.Maximum(name = 'Max15235', )([in0Max15235,in1Max15235])
Res65742 = keras.layers.Reshape((1, 4), name = 'Res65742', )(Max15235)
Fla38333 = keras.layers.Flatten(name = 'Fla38333', )(Res65742)
Lay79189 = keras.layers.LayerNormalization(axis=1, epsilon=2.750832466870723, name = 'Lay79189', )(in0Lay79189)
Con46425 = keras.layers.Concatenate(axis=1, name = 'Con46425', )([Lay79189,in0Con46425])
Ave70182 = keras.layers.Average(name = 'Ave70182', )([Fla38333,Con46425])
Con62466 = keras.layers.Concatenate(axis=1, name = 'Con62466', )([Ave70182,in0Con62466])
Ave4905 = keras.layers.Average(name = 'Ave4905', )([Fla98811,Con62466])
model = tf.keras.models.Model(inputs=[in0Sep85625,in0Max15235,in1Max15235,in0Lay79189,in0Con46425,in0Con62466], outputs=Ave4905)
w = model.get_layer('Sep85625').get_weights() 
w[0] = np.array([[[[0.4559]], [[0.7271]]], [[[0.3774]], [[0.8881]]]])
w[1] = np.array([[[[0.7178, 0.5564, 0.8007, 0.9726]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep85625').set_weights(w) 
in0Sep85625 = tf.constant([[[[0.6556], [0.165]], [[0.7484], [0.2706]]]])
in0Max15235 = tf.constant([[[[0.3261, 0.6189], [0.6891, 0.1461]]]])
in1Max15235 = tf.constant([[[[0.6278, 0.1491], [0.6628, 0.7283]]]])
in0Lay79189 = tf.constant([[1.164, 1.293]])
in0Con46425 = tf.constant([[0.6237, 0.7187]])
in0Con62466 = tf.constant([[0.7387, 0.8071, 0.0241, 0.3344, 0.6415, 0.0322, 0.1592, 0.6103, 0.6836, 0.5173, 0.1801, 0.6414]])
print (np.array2string(model.predict([in0Sep85625,in0Max15235,in1Max15235,in0Lay79189,in0Con46425,in0Con62466],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave4905.png')

LSep85625 = separable_conv2D_layer([[[[0.6556], [0.165]], [[0.7484], [0.2706]]]], 2, 2,[[[[[0.4559]], [[0.7271]]], [[[0.3774]], [[0.8881]]]],[[[[0.7178, 0.5564, 0.8007, 0.9726]]]]],[0, 0, 0, 0], 1, 1, true, Sep85625), 
LCro2513 = cropping2D_layer(Sep85625, 0, 0, 0, 0, Cro2513), 
LRes30075 = reshape_layer(Cro2513, [2, 8], Res30075), 
LFla98811 = flatten_layer(Res30075, Fla98811), 
LMax15235 = maximum_layer([[[[[0.3261, 0.6189], [0.6891, 0.1461]]]], [[[[0.6278, 0.1491], [0.6628, 0.7283]]]]], Max15235), 
LRes65742 = reshape_layer(Max15235, [1, 4], Res65742), 
LFla38333 = flatten_layer(Res65742, Fla38333), 
LLay79189 = layer_normalization_layer([[1.164, 1.293]], 1, 2.750832466870723, Lay79189), 
LCon46425 = concatenate_layer([Lay79189,[[0.6237, 0.7187]]], 1, Con46425), 
LAve70182 = average_layer([Fla38333,Con46425], Ave70182), 
LCon62466 = concatenate_layer([Ave70182,[[0.7387, 0.8071, 0.0241, 0.3344, 0.6415, 0.0322, 0.1592, 0.6103, 0.6836, 0.5173, 0.1801, 0.6414]]], 1, Con62466), 
LAve4905 = average_layer([Fla98811,Con62466], Ave4905), 
exec_layers([LSep85625,LCro2513,LRes30075,LFla98811,LMax15235,LRes65742,LFla38333,LLay79189,LCon46425,LAve70182,LCon62466,LAve4905],["Sep85625","Cro2513","Res30075","Fla98811","Max15235","Res65742","Fla38333","Lay79189","Con46425","Ave70182","Con62466","Ave4905"],Ave4905,"Ave4905")

Actual (Unparsed): [[0.4851845, 0.4264002, 0.7051798, 0.8196625, 0.4330002, 0.4528882, 0.0830512, 0.2534443, 0.5138198, 0.1657574, 0.2949678, 0.5667545, 0.3860763, 0.2929706, 0.1394398, 0.3806931]]

Expected (Unparsed): [[0.4851844875085809,0.4264001567674191,0.7051797929460001,0.819662509828,0.433000175666,0.45288819690800003,0.08305124777900001,0.253444303222,0.513819831498,0.165757361724,0.294967810087,0.566754511166,0.386076251206,0.292970571428,0.139439794289,0.38069314840199997]]

Actual:   [[0.4852, 0.4265, 0.7052, 0.8197, 0.4331, 0.4529, 0.0831, 0.2535, 0.5139, 0.1658, 0.295, 0.5668, 0.3861, 0.293, 0.1395, 0.3807]]

Expected: [[0.4852, 0.4265, 0.7052, 0.8197, 0.4331, 0.4529, 0.0831, 0.2535, 0.5139, 0.1658, 0.295, 0.5668, 0.3861, 0.293, 0.1395, 0.3807]]