import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave10127 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave10127 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Max98683 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con98227 = tf.keras.layers.Input(shape=([6]))
in0PRe37745 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Glo46856 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con10964 = tf.keras.layers.Input(shape=([1]))
in0Glo98353 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Con63676 = tf.keras.layers.Input(shape=([6]))

Ave10127 = keras.layers.Average(name = 'Ave10127', )([in0Ave10127,in1Ave10127])
Res58751 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res58751', )(Ave10127)
Glo30426 = keras.layers.GlobalMaxPool3D(name = 'Glo30426', )(Res58751)
Res40055 = keras.layers.Reshape((1, 1), name = 'Res40055', )(Glo30426)
PRe79376 = keras.layers.PReLU(name = 'PRe79376', )(Res40055)
Res1938 = keras.layers.Reshape((1, 1, 1), name = 'Res1938', )(PRe79376)
Zer53584 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer53584', )(Res1938)
Max98683 = keras.layers.MaxPool2D(pool_size=(1, 2), name = 'Max98683', )(in0Max98683)
Sub80906 = keras.layers.Subtract(name = 'Sub80906', )([Zer53584,Max98683])
Res67974 = keras.layers.Reshape((2, 1), name = 'Res67974', )(Sub80906)
Fla34458 = keras.layers.Flatten(name = 'Fla34458', )(Res67974)
Con98227 = keras.layers.Concatenate(axis=1, name = 'Con98227', )([Fla34458,in0Con98227])
PRe37745 = keras.layers.PReLU(name = 'PRe37745', input_shape=(2, 2, 2))(in0PRe37745)
Res76315 = keras.layers.Reshape((2, 4), name = 'Res76315', )(PRe37745)
Fla64288 = keras.layers.Flatten(name = 'Fla64288', )(Res76315)
Glo46856 = keras.layers.GlobalMaxPool2D(name = 'Glo46856', )(in0Glo46856)
Con10964 = keras.layers.Concatenate(axis=1, name = 'Con10964', )([Glo46856,in0Con10964])
Glo98353 = keras.layers.GlobalAveragePooling3D(name = 'Glo98353', )(in0Glo98353)
Min94102 = keras.layers.Minimum(name = 'Min94102', )([Con10964,Glo98353])
Con63676 = keras.layers.Concatenate(axis=1, name = 'Con63676', )([Min94102,in0Con63676])
Sub41873 = keras.layers.Subtract(name = 'Sub41873', )([Fla64288,Con63676])
Ave12135 = keras.layers.Average(name = 'Ave12135', )([Con98227,Sub41873])
model = tf.keras.models.Model(inputs=[in0Ave10127,in1Ave10127,in0Max98683,in0Con98227,in0PRe37745,in0Glo46856,in0Con10964,in0Glo98353,in0Con63676], outputs=Ave12135)
w = model.get_layer('PRe79376').get_weights() 
w[0] = np.array([[0.8059]])
model.get_layer('PRe79376').set_weights(w) 
w = model.get_layer('PRe37745').get_weights() 
w[0] = np.array([[[0.9171, 0.6754], [0.2818, 0.3969]], [[0.6657, 0.3222], [0.9889, 0.499]]])
model.get_layer('PRe37745').set_weights(w) 
in0Ave10127 = tf.constant([[[[0.4147], [0.3695]], [[0.6885], [0.9331]]]])
in1Ave10127 = tf.constant([[[[0.4859], [0.3897]], [[0.4798], [0.004]]]])
in0Max98683 = tf.constant([[[[1.9526], [1.3822]], [[1.7015], [1.7036]]]])
in0Con98227 = tf.constant([[0.5463, 0.4331, 0.2874, 0.8463, 0.4773, 0.0156]])
in0PRe37745 = tf.constant([[[[0.8201, 0.8444], [0.2545, 0.9895]], [[0.9676, 0.5532], [0.1152, 0.1056]]]])
in0Glo46856 = tf.constant([[[[1.7852]], [[1.6069]]]])
in0Con10964 = tf.constant([[0.307]])
in0Glo98353 = tf.constant([[[[[1.6261, 1.8882]], [[1.4506, 1.7261]]]]])
in0Con63676 = tf.constant([[0.8828, 0.1678, 0.2896, 0.2798, 0.4617, 0.7809]])
print (np.array2string(model.predict([in0Ave10127,in1Ave10127,in0Max98683,in0Con98227,in0PRe37745,in0Glo46856,in0Con10964,in0Glo98353,in0Con63676],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave12135.png')

LAve10127 = average_layer([[[[[0.4147], [0.3695]], [[0.6885], [0.9331]]]], [[[[0.4859], [0.3897]], [[0.4798], [0.004]]]]], Ave10127), 
LRes58751 = reshape_layer(Ave10127, [2, 2, 1, 1], Res58751), 
LGlo30426 = global_max_pool3D_layer(Res58751, Glo30426), 
LRes40055 = reshape_layer(Glo30426, [1, 1], Res40055), 
LPRe79376 = prelu_layer(Res40055, [[0.8059]], PRe79376), 
LRes1938 = reshape_layer(PRe79376, [1, 1, 1], Res1938), 
LZer53584 = zero_padding2D_layer(Res1938, 1, 0, 0, 0, Zer53584), 
LMax98683 = max_pool2D_layer([[[[1.9526], [1.3822]], [[1.7015], [1.7036]]]], 1, 2, Max98683), 
LSub80906 = subtract_layer(Zer53584,Max98683, Sub80906), 
LRes67974 = reshape_layer(Sub80906, [2, 1], Res67974), 
LFla34458 = flatten_layer(Res67974, Fla34458), 
LCon98227 = concatenate_layer([Fla34458,[[0.5463, 0.4331, 0.2874, 0.8463, 0.4773, 0.0156]]], 1, Con98227), 
LPRe37745 = prelu_layer([[[[0.8201, 0.8444], [0.2545, 0.9895]], [[0.9676, 0.5532], [0.1152, 0.1056]]]], [[[0.9171, 0.6754], [0.2818, 0.3969]], [[0.6657, 0.3222], [0.9889, 0.499]]], PRe37745), 
LRes76315 = reshape_layer(PRe37745, [2, 4], Res76315), 
LFla64288 = flatten_layer(Res76315, Fla64288), 
LGlo46856 = global_max_pool2D_layer([[[[1.7852]], [[1.6069]]]], Glo46856), 
LCon10964 = concatenate_layer([Glo46856,[[0.307]]], 1, Con10964), 
LGlo98353 = global_average_pooling3D_layer([[[[[1.6261, 1.8882]], [[1.4506, 1.7261]]]]], Glo98353), 
LMin94102 = minimum_layer([Con10964,Glo98353], Min94102), 
LCon63676 = concatenate_layer([Min94102,[[0.8828, 0.1678, 0.2896, 0.2798, 0.4617, 0.7809]]], 1, Con63676), 
LSub41873 = subtract_layer(Fla64288,Con63676, Sub41873), 
LAve12135 = average_layer([Con98227,Sub41873], Ave12135), 
exec_layers([LAve10127,LRes58751,LGlo30426,LRes40055,LPRe79376,LRes1938,LZer53584,LMax98683,LSub80906,LRes67974,LFla34458,LCon98227,LPRe37745,LRes76315,LFla64288,LGlo46856,LCon10964,LGlo98353,LMin94102,LCon63676,LSub41873,LAve12135],["Ave10127","Res58751","Glo30426","Res40055","PRe79376","Res1938","Zer53584","Max98683","Sub80906","Res67974","Fla34458","Con98227","PRe37745","Res76315","Fla64288","Glo46856","Con10964","Glo98353","Min94102","Con63676","Sub41873","Ave12135"],Ave12135,"Ave12135")

Actual (Unparsed): [[-1.3354250, -0.2910250, -0.0410000, 0.6274000, 0.4827000, 0.5598500, 0.0654000, -0.3298500]]

Expected (Unparsed): [[-1.3354249999999999,-0.291025,-0.041000000000000036,0.6274000000000001,0.48269999999999996,0.5598500000000001,0.06539999999999999,-0.32985000000000003]]

Actual:   [[-1.3354, -0.291, -0.041, 0.6274, 0.4827, 0.5599, 0.0654, -0.3298]]

Expected: [[-1.3354, -0.291, -0.041, 0.6275, 0.4827, 0.5599, 0.0654, -0.3298]]