import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Per86887 = tf.keras.layers.Input(shape=([2, 2]))
in0PRe13513 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Sof52840 = tf.keras.layers.Input(shape=([2, 1, 2]))

Per86887 = keras.layers.Permute((2,1), name = 'Per86887',)(in0Per86887)
Max48850 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max48850', )(Per86887)
PRe13513 = keras.layers.PReLU(name = 'PRe13513', input_shape=(1, 2, 1, 1))(in0PRe13513)
Res44348 = keras.layers.Reshape((1, 2, 1), name = 'Res44348', )(PRe13513)
Res76714 = keras.layers.Reshape((1, 2), name = 'Res76714', )(Res44348)
Sof52840 = keras.layers.Softmax(axis=1, name = 'Sof52840', input_shape=(2, 1, 2))(in0Sof52840)
Res42632 = keras.layers.Reshape((2, 2), name = 'Res42632', )(Sof52840)
Dot55489 = keras.layers.Dot(axes=(2, 2), name = 'Dot55489', )([Res76714,Res42632])
Zer33703 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer33703', )(Dot55489)
Max49147 = keras.layers.Maximum(name = 'Max49147', )([Max48850,Zer33703])
Res36456 = keras.layers.Reshape((2, 2, 1), name = 'Res36456', )(Max49147)
Glo37411 = keras.layers.GlobalAveragePooling2D(name = 'Glo37411', )(Res36456)
model = tf.keras.models.Model(inputs=[in0Per86887,in0PRe13513,in0Sof52840], outputs=Glo37411)
w = model.get_layer('PRe13513').get_weights() 
w[0] = np.array([[[[0.5539]], [[0.3439]]]])
model.get_layer('PRe13513').set_weights(w) 
in0Per86887 = tf.constant([[[1.2845, 1.9725], [1.0843, 1.1075]]])
in0PRe13513 = tf.constant([[[[[0.9615]], [[0.3486]]]]])
in0Sof52840 = tf.constant([[[[0.5645, 0.9023]], [[0.4227, 0.0641]]]])
print (np.array2string(model.predict([in0Per86887,in0PRe13513,in0Sof52840],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo37411.png')

LPer86887 = permute_layer([[[1.2845, 1.9725], [1.0843, 1.1075]]], 2,1, Per86887), 
LMax48850 = max_pool1D_layer(Per86887, 1, Max48850), 
LPRe13513 = prelu_layer([[[[[0.9615]], [[0.3486]]]]], [[[[0.5539]], [[0.3439]]]], PRe13513), 
LRes44348 = reshape_layer(PRe13513, [1, 2, 1], Res44348), 
LRes76714 = reshape_layer(Res44348, [1, 2], Res76714), 
LSof52840 = softmax_layer([[[[0.5645, 0.9023]], [[0.4227, 0.0641]]]], 1, Sof52840), 
LRes42632 = reshape_layer(Sof52840, [2, 2], Res42632), 
LDot55489 = dot_layer(Res76714,Res42632, 2, 2, Dot55489), 
LZer33703 = zero_padding1D_layer(Dot55489, 1, 0, Zer33703), 
LMax49147 = maximum_layer([Max48850,Zer33703], Max49147), 
LRes36456 = reshape_layer(Max49147, [2, 2, 1], Res36456), 
LGlo37411 = global_average_pooling2D_layer(Res36456, Glo37411), 
exec_layers([LPer86887,LMax48850,LPRe13513,LRes44348,LRes76714,LSof52840,LRes42632,LDot55489,LZer33703,LMax49147,LRes36456,LGlo37411],["Per86887","Max48850","PRe13513","Res44348","Res76714","Sof52840","Res42632","Dot55489","Zer33703","Max49147","Res36456","Glo37411"],Glo37411,"Glo37411")

Actual (Unparsed): [[1.3622000]]

Expected (Unparsed): [[1.3621999999999999]]

Actual:   [[1.3622]]

Expected: [[1.3622]]