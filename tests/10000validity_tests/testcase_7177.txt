import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul79377 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul79377 = tf.keras.layers.Input(shape=([2, 2]))
in0Con683 = tf.keras.layers.Input(shape=([1]))
in0GRU77235 = tf.keras.layers.Input(shape=([3, 1]))

Mul79377 = keras.layers.Multiply(name = 'Mul79377', )([in0Mul79377,in1Mul79377])
Res46296 = keras.layers.Reshape((2, 2, 1), name = 'Res46296', )(Mul79377)
Max54435 = keras.layers.MaxPool2D(pool_size=(1, 2), name = 'Max54435', )(Res46296)
Res37189 = keras.layers.Reshape((2, 1), name = 'Res37189', )(Max54435)
Fla81656 = keras.layers.Flatten(name = 'Fla81656', )(Res37189)
Con683 = keras.layers.Concatenate(axis=1, name = 'Con683', )([Fla81656,in0Con683])
GRU77235 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU77235', )(in0GRU77235)
Max36315 = keras.layers.Maximum(name = 'Max36315', )([Con683,GRU77235])
model = tf.keras.models.Model(inputs=[in0Mul79377,in1Mul79377,in0Con683,in0GRU77235], outputs=Max36315)
w = model.get_layer('GRU77235').get_weights() 
w[0] = np.array([[5, 5, 3, 1, 9, 7, 6, 3, 1]])
w[1] = np.array([[9, 7, 3, 3, 9, 7, 7, 7, 4], [4, 1, 5, 5, 7, 5, 2, 2, 1], [4, 6, 1, 4, 9, 10, 5, 10, 8]])
w[2] = np.array([10, 6, 4, 3, 3, 2, 3, 6, 4])
model.get_layer('GRU77235').set_weights(w) 
in0Mul79377 = tf.constant([[[0.6395, 0.6893], [0.1535, 0.5859]]])
in1Mul79377 = tf.constant([[[0.5059, 0.0508], [0.3277, 0.8119]]])
in0Con683 = tf.constant([[0.7173]])
in0GRU77235 = tf.constant([[[5], [6], [6]]])
print (np.array2string(model.predict([in0Mul79377,in1Mul79377,in0Con683,in0GRU77235],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max36315.png')

LMul79377 = multiply_layer([[[[0.6395, 0.6893], [0.1535, 0.5859]]], [[[0.5059, 0.0508], [0.3277, 0.8119]]]], Mul79377), 
LRes46296 = reshape_layer(Mul79377, [2, 2, 1], Res46296), 
LMax54435 = max_pool2D_layer(Res46296, 1, 2, Max54435), 
LRes37189 = reshape_layer(Max54435, [2, 1], Res37189), 
LFla81656 = flatten_layer(Res37189, Fla81656), 
LCon683 = concatenate_layer([Fla81656,[[0.7173]]], 1, Con683), 
LGRU77235 = gru_layer([[[5], [6], [6]]],[[5, 5, 3, 1, 9, 7, 6, 3, 1]],[[9, 7, 3, 3, 9, 7, 7, 7, 4], [4, 1, 5, 5, 7, 5, 2, 2, 1], [4, 6, 1, 4, 9, 10, 5, 10, 8]],[10, 6, 4, 3, 3, 2, 3, 6, 4], false, GRU77235), 
LMax36315 = maximum_layer([Con683,GRU77235], Max36315), 
exec_layers([LMul79377,LRes46296,LMax54435,LRes37189,LFla81656,LCon683,LGRU77235,LMax36315],["Mul79377","Res46296","Max54435","Res37189","Fla81656","Con683","GRU77235","Max36315"],Max36315,"Max36315")

Actual (Unparsed): [[0.3235231, 0.4756922, 0.7173000]]

Expected (Unparsed): [[0.32352305,0.47569220999999995,0.7173]]

Actual:   [[0.3236, 0.4757, 0.7173]]

Expected: [[0.3236, 0.4757, 0.7173]]