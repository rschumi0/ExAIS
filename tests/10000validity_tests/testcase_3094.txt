import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sim38201 = tf.keras.layers.Input(shape=([3, 1]))
in0Ave26754 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave26754 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Fla31821 = tf.keras.layers.Input(shape=([4, 1]))
in0Con5604 = tf.keras.layers.Input(shape=([1]))

Sim38201 = keras.layers.SimpleRNN(1,name = 'Sim38201', )(in0Sim38201)
Res36652 = keras.layers.Reshape((1, 1), name = 'Res36652', )(Sim38201)
Sim68269 = keras.layers.SimpleRNN(3,name = 'Sim68269', )(Res36652)
Res44450 = keras.layers.Reshape((3, 1), name = 'Res44450', )(Sim68269)
Res22971 = keras.layers.Reshape((3, 1, 1), name = 'Res22971', )(Res44450)
Ave67349 = keras.layers.AveragePooling2D(pool_size=(1, 1), strides=(1, 1), padding='valid', name = 'Ave67349', )(Res22971)
Dep77927 = keras.layers.DepthwiseConv2D((3, 1),strides=(2, 2), padding='same', name = 'Dep77927', )(Ave67349)
Res95963 = keras.layers.Reshape((2, 1), name = 'Res95963', )(Dep77927)
Fla67118 = keras.layers.Flatten(name = 'Fla67118', )(Res95963)
Ave26754 = keras.layers.Average(name = 'Ave26754', )([in0Ave26754,in1Ave26754])
Res96585 = keras.layers.Reshape((2, 2), name = 'Res96585', )(Ave26754)
Fla70726 = keras.layers.Flatten(name = 'Fla70726', )(Res96585)
Fla31821 = keras.layers.Flatten(name = 'Fla31821', )(in0Fla31821)
Dot39292 = keras.layers.Dot(axes=(1, 1), name = 'Dot39292', )([Fla70726,Fla31821])
Res34145 = keras.layers.Reshape((1, 1), name = 'Res34145', )(Dot39292)
Res56442 = keras.layers.Reshape((1, 1, 1), name = 'Res56442', )(Res34145)
Glo55028 = keras.layers.GlobalAveragePooling2D(name = 'Glo55028', )(Res56442)
Con5604 = keras.layers.Concatenate(axis=1, name = 'Con5604', )([Glo55028,in0Con5604])
Max63286 = keras.layers.Maximum(name = 'Max63286', )([Fla67118,Con5604])
model = tf.keras.models.Model(inputs=[in0Sim38201,in0Ave26754,in1Ave26754,in0Fla31821,in0Con5604], outputs=Max63286)
w = model.get_layer('Sim38201').get_weights() 
w[0] = np.array([[10]])
w[1] = np.array([[1]])
w[2] = np.array([3])
model.get_layer('Sim38201').set_weights(w) 
w = model.get_layer('Sim68269').get_weights() 
w[0] = np.array([[5, 5, 10]])
w[1] = np.array([[8, 7, 4], [3, 9, 5], [7, 5, 10]])
w[2] = np.array([4, 2, 3])
model.get_layer('Sim68269').set_weights(w) 
w = model.get_layer('Dep77927').get_weights() 
w[0] = np.array([[[[0.7215]]], [[[0.629]]], [[[0.5797]]]])
w[1] = np.array([0])
model.get_layer('Dep77927').set_weights(w) 
in0Sim38201 = tf.constant([[[6], [2], [1]]])
in0Ave26754 = tf.constant([[[[0.2133], [0.6773]], [[0.317], [0.6967]]]])
in1Ave26754 = tf.constant([[[[0.8621], [0.4087]], [[0.1423], [0.5265]]]])
in0Fla31821 = tf.constant([[[1.9345], [1.2502], [1.6734], [1.5379]]])
in0Con5604 = tf.constant([[0.8105]])
print (np.array2string(model.predict([in0Sim38201,in0Ave26754,in1Ave26754,in0Fla31821,in0Con5604],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max63286.png')

LSim38201 = simple_rnn_layer([[[6], [2], [1]]],[[10]],[[1]],[3], Sim38201), 
LRes36652 = reshape_layer(Sim38201, [1, 1], Res36652), 
LSim68269 = simple_rnn_layer(Res36652,[[5, 5, 10]],[[8, 7, 4], [3, 9, 5], [7, 5, 10]],[4, 2, 3], Sim68269), 
LRes44450 = reshape_layer(Sim68269, [3, 1], Res44450), 
LRes22971 = reshape_layer(Res44450, [3, 1, 1], Res22971), 
LAve67349 = average_pooling2D_layer(Res22971, 1, 1, 1, 1, false, Ave67349), 
LDep77927 = depthwise_conv2D_layer(Ave67349, 3, 1,[[[[0.7215]]], [[[0.629]]], [[[0.5797]]]],[0], 2, 2, true, Dep77927), 
LRes95963 = reshape_layer(Dep77927, [2, 1], Res95963), 
LFla67118 = flatten_layer(Res95963, Fla67118), 
LAve26754 = average_layer([[[[[0.2133], [0.6773]], [[0.317], [0.6967]]]], [[[[0.8621], [0.4087]], [[0.1423], [0.5265]]]]], Ave26754), 
LRes96585 = reshape_layer(Ave26754, [2, 2], Res96585), 
LFla70726 = flatten_layer(Res96585, Fla70726), 
LFla31821 = flatten_layer([[[1.9345], [1.2502], [1.6734], [1.5379]]], Fla31821), 
LDot39292 = dot_layer(Fla70726,Fla31821, 1, 1, Dot39292), 
LRes34145 = reshape_layer(Dot39292, [1, 1], Res34145), 
LRes56442 = reshape_layer(Res34145, [1, 1, 1], Res56442), 
LGlo55028 = global_average_pooling2D_layer(Res56442, Glo55028), 
LCon5604 = concatenate_layer([Glo55028,[[0.8105]]], 1, Con5604), 
LMax63286 = maximum_layer([Fla67118,Con5604], Max63286), 
exec_layers([LSim38201,LRes36652,LSim68269,LRes44450,LRes22971,LAve67349,LDep77927,LRes95963,LFla67118,LAve26754,LRes96585,LFla70726,LFla31821,LDot39292,LRes34145,LRes56442,LGlo55028,LCon5604,LMax63286],["Sim38201","Res36652","Sim68269","Res44450","Res22971","Ave67349","Dep77927","Res95963","Fla67118","Ave26754","Res96585","Fla70726","Fla31821","Dot39292","Res34145","Res56442","Glo55028","Con5604","Max63286"],Max63286,"Max63286")

Actual (Unparsed): [[3.0439152, 1.3504988]]

Expected (Unparsed): [[3.0439152,1.3504988000986289]]

Actual:   [[3.044, 1.3505]]

Expected: [[3.044, 1.3505]]