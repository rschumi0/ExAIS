import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul36741 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Mul36741 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Ave94680 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con66522 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Max84828 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Max84828 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Cro54016 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

Mul36741 = keras.layers.Multiply(name = 'Mul36741', )([in0Mul36741,in1Mul36741])
Ave94680 = keras.layers.AveragePooling2D(pool_size=(1, 1), name = 'Ave94680', )(in0Ave94680)
Zer30552 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer30552', )(Ave94680)
Ave33060 = keras.layers.Average(name = 'Ave33060', )([Mul36741,Zer30552])
Res7548 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res7548', )(Ave33060)
Zer27216 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (1, 0)), name = 'Zer27216', )(Res7548)
Con66522 = keras.layers.Concatenate(axis=4, name = 'Con66522', )([Zer27216,in0Con66522])
Max84828 = keras.layers.Maximum(name = 'Max84828', )([in0Max84828,in1Max84828])
Cro54016 = keras.layers.Cropping3D(cropping=((0, 0), (1, 0), (0, 0)), name = 'Cro54016', )(in0Cro54016)
Zer87385 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (1, 0)), name = 'Zer87385', )(Cro54016)
Add6684 = keras.layers.Add(name = 'Add6684', )([Max84828,Zer87385])
Mul99480 = keras.layers.Multiply(name = 'Mul99480', )([Con66522,Add6684])
Res48919 = keras.layers.Reshape((2, 2, 4), name = 'Res48919', )(Mul99480)
PRe59911 = keras.layers.PReLU(name = 'PRe59911', )(Res48919)
model = tf.keras.models.Model(inputs=[in0Mul36741,in1Mul36741,in0Ave94680,in0Con66522,in0Max84828,in1Max84828,in0Cro54016], outputs=PRe59911)
w = model.get_layer('PRe59911').get_weights() 
w[0] = np.array([[[0.0309, 0.5014, 0.4499, 0.9595], [0.0455, 0.0156, 0.9342, 0.8528]], [[0.7871, 0.3724, 0.4323, 0.0455], [0.2202, 0.3388, 0.8651, 0.6455]]])
model.get_layer('PRe59911').set_weights(w) 
in0Mul36741 = tf.constant([[[[0.5428], [0.3817]], [[0.7088], [0.1512]]]])
in1Mul36741 = tf.constant([[[[0.5831], [0.8885]], [[0.5541], [0.6547]]]])
in0Ave94680 = tf.constant([[[[1.9462]], [[1.5548]]]])
in0Con66522 = tf.constant([[[[[0.3038], [0.8626]], [[0.9939], [0.5778]]], [[[0.2645], [0.6992]], [[0.6192], [0.5745]]]]])
in0Max84828 = tf.constant([[[[[0.322, 0.9233], [0.5733, 0.2747]], [[0.0966, 0.146], [0.6167, 0.1236]]], [[[0.3732, 0.3605], [0.1952, 0.3794]], [[0.5068, 0.4518], [0.0947, 0.008]]]]])
in1Max84828 = tf.constant([[[[[0.8615, 0.4172], [0.1228, 0.7871]], [[0.8959, 0.7463], [0.2044, 0.2224]]], [[[0.5658, 0.1324], [0.4587, 0.4173]], [[0.8442, 0.6281], [0.4402, 0.0975]]]]])
in0Cro54016 = tf.constant([[[[[1.8641, 1.7939]], [[1.4429, 1.0636]]], [[[1.176, 1.3465]], [[1.2706, 1.4485]]]]])
print (np.array2string(model.predict([in0Mul36741,in1Mul36741,in0Ave94680,in0Con66522,in0Max84828,in1Max84828,in0Cro54016],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='PRe59911.png')

LMul36741 = multiply_layer([[[[[0.5428], [0.3817]], [[0.7088], [0.1512]]]], [[[[0.5831], [0.8885]], [[0.5541], [0.6547]]]]], Mul36741), 
LAve94680 = average_pooling2D_layer([[[[1.9462]], [[1.5548]]]], 1, 1, Ave94680), 
LZer30552 = zero_padding2D_layer(Ave94680, 0, 0, 1, 0, Zer30552), 
LAve33060 = average_layer([Mul36741,Zer30552], Ave33060), 
LRes7548 = reshape_layer(Ave33060, [2, 2, 1, 1], Res7548), 
LZer27216 = zero_padding3D_layer(Res7548, 0, 0, 0, 0, 1, 0, Zer27216), 
LCon66522 = concatenate_layer([Zer27216,[[[[[0.3038], [0.8626]], [[0.9939], [0.5778]]], [[[0.2645], [0.6992]], [[0.6192], [0.5745]]]]]], 4, Con66522), 
LMax84828 = maximum_layer([[[[[[0.322, 0.9233], [0.5733, 0.2747]], [[0.0966, 0.146], [0.6167, 0.1236]]], [[[0.3732, 0.3605], [0.1952, 0.3794]], [[0.5068, 0.4518], [0.0947, 0.008]]]]], [[[[[0.8615, 0.4172], [0.1228, 0.7871]], [[0.8959, 0.7463], [0.2044, 0.2224]]], [[[0.5658, 0.1324], [0.4587, 0.4173]], [[0.8442, 0.6281], [0.4402, 0.0975]]]]]], Max84828), 
LCro54016 = cropping3D_layer([[[[[1.8641, 1.7939]], [[1.4429, 1.0636]]], [[[1.176, 1.3465]], [[1.2706, 1.4485]]]]], 0, 0, 1, 0, 0, 0, Cro54016), 
LZer87385 = zero_padding3D_layer(Cro54016, 0, 0, 1, 0, 1, 0, Zer87385), 
LAdd6684 = add_layer([Max84828,Zer87385], Add6684), 
LMul99480 = multiply_layer([Con66522,Add6684], Mul99480), 
LRes48919 = reshape_layer(Mul99480, [2, 2, 4], Res48919), 
LPRe59911 = prelu_layer(Res48919, [[[0.0309, 0.5014, 0.4499, 0.9595], [0.0455, 0.0156, 0.9342, 0.8528]], [[0.7871, 0.3724, 0.4323, 0.0455], [0.2202, 0.3388, 0.8651, 0.6455]]], PRe59911), 
exec_layers([LMul36741,LAve94680,LZer30552,LAve33060,LRes7548,LZer27216,LCon66522,LMax84828,LCro54016,LZer87385,LAdd6684,LMul99480,LRes48919,LPRe59911],["Mul36741","Ave94680","Zer30552","Ave33060","Res7548","Zer27216","Con66522","Max84828","Cro54016","Zer87385","Add6684","Mul99480","Res48919","PRe59911"],PRe59911,"PRe59911")

Actual (Unparsed): [[[[0.0000000, 0.2804985, 0.0907266, 0.6789525], [0.0000000, 0.7417476, 2.3534435, 0.7430507]], [[0.0000000, 0.0953522, 0.0900763, 0.2917761], [0.0000000, 0.3889195, 1.4146525, 0.8881771]]]]

Expected (Unparsed): [[[[0.0,0.28049854,0.09072663982199998,0.6789524600000001],[0.0,0.74174757,2.3534435954100004,0.7430508]],[[0.0,0.09535225,0.090076313448,0.29177616],[0.0,0.38891951999999996,1.414652513456,0.8881769999999999]]]]

Actual:   [[[[0, 0.2805, 0.0908, 0.679], [0, 0.7418, 2.3535, 0.7431]], [[0, 0.0954, 0.0901, 0.2918], [0, 0.389, 1.4147, 0.8882]]]]

Expected: [[[[0, 0.2805, 0.0908, 0.679], [0, 0.7418, 2.3535, 0.7431]], [[0, 0.0954, 0.0901, 0.2918], [0, 0.389, 1.4147, 0.8882]]]]