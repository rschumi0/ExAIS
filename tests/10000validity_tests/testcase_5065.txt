import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con13755 = tf.keras.layers.Input(shape=([1, 1]))
in0Sim49658 = tf.keras.layers.Input(shape=([2, 3]))
in0Con23487 = tf.keras.layers.Input(shape=([3]))
in0Con78263 = tf.keras.layers.Input(shape=([4, 1]))
in0Dot62797 = tf.keras.layers.Input(shape=([3]))
in1Dot62797 = tf.keras.layers.Input(shape=([3]))
in0Con84396 = tf.keras.layers.Input(shape=([2, 1]))
in0Max47566 = tf.keras.layers.Input(shape=([2, 2]))
in1Max47566 = tf.keras.layers.Input(shape=([2, 2]))

Con13755 = keras.layers.Conv1D(4, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con13755', )(in0Con13755)
Fla38088 = keras.layers.Flatten(name = 'Fla38088', )(Con13755)
Sim49658 = keras.layers.SimpleRNN(1,name = 'Sim49658', )(in0Sim49658)
Con23487 = keras.layers.Concatenate(axis=1, name = 'Con23487', )([Sim49658,in0Con23487])
Mul95115 = keras.layers.Multiply(name = 'Mul95115', )([Fla38088,Con23487])
Res71646 = keras.layers.Reshape((4, 1), name = 'Res71646', )(Mul95115)
Con78263 = keras.layers.Concatenate(axis=2, name = 'Con78263', )([Res71646,in0Con78263])
Dot62797 = keras.layers.Dot(axes=(1, 1), name = 'Dot62797', )([in0Dot62797,in1Dot62797])
Res73358 = keras.layers.Reshape((1, 1), name = 'Res73358', )(Dot62797)
Zer45993 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer45993', )(Res73358)
Con84396 = keras.layers.Concatenate(axis=2, name = 'Con84396', )([Zer45993,in0Con84396])
Max47566 = keras.layers.Maximum(name = 'Max47566', )([in0Max47566,in1Max47566])
Ave84732 = keras.layers.Average(name = 'Ave84732', )([Con84396,Max47566])
Zer79417 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer79417', )(Ave84732)
Max55693 = keras.layers.Maximum(name = 'Max55693', )([Con78263,Zer79417])
model = tf.keras.models.Model(inputs=[in0Con13755,in0Sim49658,in0Con23487,in0Con78263,in0Dot62797,in1Dot62797,in0Con84396,in0Max47566,in1Max47566], outputs=Max55693)
w = model.get_layer('Con13755').get_weights() 
w[0] = np.array([[[0.6271, 0.3272, 0.7542, 0.1153]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con13755').set_weights(w) 
w = model.get_layer('Sim49658').get_weights() 
w[0] = np.array([[3], [8], [10]])
w[1] = np.array([[1]])
w[2] = np.array([1])
model.get_layer('Sim49658').set_weights(w) 
in0Con13755 = tf.constant([[[0.8533]]])
in0Sim49658 = tf.constant([[[4, 6, 7], [2, 10, 6]]])
in0Con23487 = tf.constant([[0.7943, 0.9387, 0.5792]])
in0Con78263 = tf.constant([[[0.0323], [0.128], [0.2457], [0.7117]]])
in0Dot62797 = tf.constant([[0.4073, 0.4747, 0.9993]])
in1Dot62797 = tf.constant([[0.5095, 0.1096, 0.9189]])
in0Con84396 = tf.constant([[[0.5916], [0.4564]]])
in0Max47566 = tf.constant([[[0.1654, 0.7028], [0.21, 0.1542]]])
in1Max47566 = tf.constant([[[0.448, 0.1832], [0.514, 0.1943]]])
print (np.array2string(model.predict([in0Con13755,in0Sim49658,in0Con23487,in0Con78263,in0Dot62797,in1Dot62797,in0Con84396,in0Max47566,in1Max47566],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max55693.png')

LCon13755 = conv1D_layer([[[0.8533]]], 1,[[[0.6271, 0.3272, 0.7542, 0.1153]]],[0, 0, 0, 0], 1, true, 1, Con13755), 
LFla38088 = flatten_layer(Con13755, Fla38088), 
LSim49658 = simple_rnn_layer([[[4, 6, 7], [2, 10, 6]]],[[3], [8], [10]],[[1]],[1], Sim49658), 
LCon23487 = concatenate_layer([Sim49658,[[0.7943, 0.9387, 0.5792]]], 1, Con23487), 
LMul95115 = multiply_layer([Fla38088,Con23487], Mul95115), 
LRes71646 = reshape_layer(Mul95115, [4, 1], Res71646), 
LCon78263 = concatenate_layer([Res71646,[[[0.0323], [0.128], [0.2457], [0.7117]]]], 2, Con78263), 
LDot62797 = dot_layer([[0.4073, 0.4747, 0.9993]], [[0.5095, 0.1096, 0.9189]], 1, 1, Dot62797), 
LRes73358 = reshape_layer(Dot62797, [1, 1], Res73358), 
LZer45993 = zero_padding1D_layer(Res73358, 1, 0, Zer45993), 
LCon84396 = concatenate_layer([Zer45993,[[[0.5916], [0.4564]]]], 2, Con84396), 
LMax47566 = maximum_layer([[[[0.1654, 0.7028], [0.21, 0.1542]]], [[[0.448, 0.1832], [0.514, 0.1943]]]], Max47566), 
LAve84732 = average_layer([Con84396,Max47566], Ave84732), 
LZer79417 = zero_padding1D_layer(Ave84732, 2, 0, Zer79417), 
LMax55693 = maximum_layer([Con78263,Zer79417], Max55693), 
exec_layers([LCon13755,LFla38088,LSim49658,LCon23487,LMul95115,LRes71646,LCon78263,LDot62797,LRes73358,LZer45993,LCon84396,LMax47566,LAve84732,LZer79417,LMax55693],["Con13755","Fla38088","Sim49658","Con23487","Mul95115","Res71646","Con78263","Dot62797","Res73358","Zer45993","Con84396","Max47566","Ave84732","Zer79417","Max55693"],Max55693,"Max55693")

Actual (Unparsed): [[[0.5351044, 0.0323000], [0.2217684, 0.1280000], [0.6041087, 0.6472000], [0.8459016, 0.7117000]]]

Expected (Unparsed): [[[0.53510443,0.0323],[0.22176836936799998,0.128],[0.6041087018819999,0.6472],[0.84590162,0.7117]]]

Actual:   [[[0.5352, 0.0323], [0.2218, 0.128], [0.6042, 0.6472], [0.846, 0.7117]]]

Expected: [[[0.5352, 0.0323], [0.2218, 0.128], [0.6042, 0.6472], [0.846, 0.7117]]]