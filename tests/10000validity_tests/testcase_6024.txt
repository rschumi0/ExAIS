import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub69952 = tf.keras.layers.Input(shape=([3, 2, 2]))
in1Sub69952 = tf.keras.layers.Input(shape=([3, 2, 2]))
in0Max45977 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con44460 = tf.keras.layers.Input(shape=([3, 2, 1]))
in0Min71601 = tf.keras.layers.Input(shape=([2, 2]))
in1Min71601 = tf.keras.layers.Input(shape=([2, 2]))

Sub69952 = keras.layers.Subtract(name = 'Sub69952', )([in0Sub69952,in1Sub69952])
Max45977 = keras.layers.MaxPool2D(pool_size=(2, 1), strides=(1, 1), padding='valid', name = 'Max45977', )(in0Max45977)
Zer12678 = keras.layers.ZeroPadding2D(padding=((2, 0), (1, 0)), name = 'Zer12678', )(Max45977)
Con44460 = keras.layers.Concatenate(axis=3, name = 'Con44460', )([Zer12678,in0Con44460])
Mul34999 = keras.layers.Multiply(name = 'Mul34999', )([Sub69952,Con44460])
Res76393 = keras.layers.Reshape((3, 4), name = 'Res76393', )(Mul34999)
Zer72511 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer72511', )(Res76393)
Min71601 = keras.layers.Minimum(name = 'Min71601', )([in0Min71601,in1Min71601])
Mas14887 = keras.layers.Masking(mask_value=2, name = 'Mas14887', )(Min71601)
Res45281 = keras.layers.Reshape((2, 2, 1), name = 'Res45281', )(Mas14887)
Zer71824 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer71824', )(Res45281)
Res48460 = keras.layers.Reshape((4, 4), name = 'Res48460', )(Zer71824)
Dot41699 = keras.layers.Dot(axes=(2, 2), name = 'Dot41699', )([Zer72511,Res48460])
Res37654 = keras.layers.Reshape((4, 4, 1), name = 'Res37654', )(Dot41699)
Max21887 = keras.layers.MaxPool2D(pool_size=(2, 4), strides=(1, 3), padding='same', name = 'Max21887', )(Res37654)
model = tf.keras.models.Model(inputs=[in0Sub69952,in1Sub69952,in0Max45977,in0Con44460,in0Min71601,in1Min71601], outputs=Max21887)
in0Sub69952 = tf.constant([[[[0.7494, 0.1655], [0.055, 0.9082]], [[0.7118, 0.5244], [0.733, 0.8193]], [[0.0175, 0.2863], [0.7421, 0.6637]]]])
in1Sub69952 = tf.constant([[[[0.7284, 0.3239], [0.6164, 0.1711]], [[0.9468, 0.7526], [0.687, 0.6358]], [[0.594, 0.4851], [0.5853, 0.7518]]]])
in0Max45977 = tf.constant([[[[1.9149]], [[1.0856]]]])
in0Con44460 = tf.constant([[[[0.7669], [0.4945]], [[0.6178], [0.5777]], [[0.3201], [0.3632]]]])
in0Min71601 = tf.constant([[[0.0638, 0.9533], [0.4461, 0.0394]]])
in1Min71601 = tf.constant([[[0.0958, 0.6776], [0.6776, 0.2505]]])
print (np.array2string(model.predict([in0Sub69952,in1Sub69952,in0Max45977,in0Con44460,in0Min71601,in1Min71601],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max21887.png')

LSub69952 = subtract_layer([[[[0.7494, 0.1655], [0.055, 0.9082]], [[0.7118, 0.5244], [0.733, 0.8193]], [[0.0175, 0.2863], [0.7421, 0.6637]]]], [[[[0.7284, 0.3239], [0.6164, 0.1711]], [[0.9468, 0.7526], [0.687, 0.6358]], [[0.594, 0.4851], [0.5853, 0.7518]]]], Sub69952), 
LMax45977 = max_pool2D_layer([[[[1.9149]], [[1.0856]]]], 2, 1, 1, 1, false, Max45977), 
LZer12678 = zero_padding2D_layer(Max45977, 2, 0, 1, 0, Zer12678), 
LCon44460 = concatenate_layer([Zer12678,[[[[0.7669], [0.4945]], [[0.6178], [0.5777]], [[0.3201], [0.3632]]]]], 3, Con44460), 
LMul34999 = multiply_layer([Sub69952,Con44460], Mul34999), 
LRes76393 = reshape_layer(Mul34999, [3, 4], Res76393), 
LZer72511 = zero_padding1D_layer(Res76393, 1, 0, Zer72511), 
LMin71601 = minimum_layer([[[[0.0638, 0.9533], [0.4461, 0.0394]]], [[[0.0958, 0.6776], [0.6776, 0.2505]]]], Min71601), 
LMas14887 = masking_layer(Min71601, 2, Mas14887), 
LRes45281 = reshape_layer(Mas14887, [2, 2, 1], Res45281), 
LZer71824 = zero_padding2D_layer(Res45281, 1, 1, 1, 1, Zer71824), 
LRes48460 = reshape_layer(Zer71824, [4, 4], Res48460), 
LDot41699 = dot_layer(Zer72511,Res48460, 2, 2, Dot41699), 
LRes37654 = reshape_layer(Dot41699, [4, 4, 1], Res37654), 
LMax21887 = max_pool2D_layer(Res37654, 2, 4, 1, 3, true, Max21887), 
exec_layers([LSub69952,LMax45977,LZer12678,LCon44460,LMul34999,LRes76393,LZer72511,LMin71601,LMas14887,LRes45281,LZer71824,LRes48460,LDot41699,LRes37654,LMax21887],["Sub69952","Max45977","Zer12678","Con44460","Mul34999","Res76393","Zer72511","Min71601","Mas14887","Res45281","Zer71824","Res48460","Dot41699","Res37654","Max21887"],Max21887,"Max21887")

Actual (Unparsed): [[[[0.0000000], [0.0000000]], [[0.0000000], [0.0000000]], [[0.1993937], [0.0000000]], [[0.1993937], [0.0000000]]]]

Expected (Unparsed): [[[[0.0],[0.0]],[[0.0],[0.0]],[[0.19939371328799993],[0.0]],[[0.19939371328799993],[0.0]]]]

Actual:   [[[[0], [0]], [[0], [0]], [[0.1994], [0]], [[0.1994], [0]]]]

Expected: [[[[0], [0]], [[0], [0]], [[0.1994], [0]], [[0.1994], [0]]]]