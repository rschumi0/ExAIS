import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave70991 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Ave70991 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con94954 = tf.keras.layers.Input(shape=([3, 2, 1]))
in0GRU70238 = tf.keras.layers.Input(shape=([3, 3]))
in0Con61988 = tf.keras.layers.Input(shape=([3, 2, 1]))
in0Sub60237 = tf.keras.layers.Input(shape=([3, 2, 2]))
in1Sub60237 = tf.keras.layers.Input(shape=([3, 2, 2]))

Ave70991 = keras.layers.Average(name = 'Ave70991', )([in0Ave70991,in1Ave70991])
Cro76180 = keras.layers.Cropping2D(cropping=((0, 0), (1, 0)), name = 'Cro76180', )(Ave70991)
Zer87229 = keras.layers.ZeroPadding2D(padding=((2, 0), (1, 0)), name = 'Zer87229', )(Cro76180)
Con94954 = keras.layers.Concatenate(axis=3, name = 'Con94954', )([Zer87229,in0Con94954])
GRU70238 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU70238', )(in0GRU70238)
Res95446 = keras.layers.Reshape((3, 1), name = 'Res95446', )(GRU70238)
Res44771 = keras.layers.Reshape((3, 1, 1), name = 'Res44771', )(Res95446)
Zer62946 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer62946', )(Res44771)
Con61988 = keras.layers.Concatenate(axis=3, name = 'Con61988', )([Zer62946,in0Con61988])
Sub60237 = keras.layers.Subtract(name = 'Sub60237', )([in0Sub60237,in1Sub60237])
Add57070 = keras.layers.Add(name = 'Add57070', )([Con61988,Sub60237])
Max14769 = keras.layers.Maximum(name = 'Max14769', )([Con94954,Add57070])
model = tf.keras.models.Model(inputs=[in0Ave70991,in1Ave70991,in0Con94954,in0GRU70238,in0Con61988,in0Sub60237,in1Sub60237], outputs=Max14769)
w = model.get_layer('GRU70238').get_weights() 
w[0] = np.array([[8, 6, 5, 6, 9, 8, 1, 5, 3], [4, 7, 3, 1, 1, 10, 1, 4, 5], [2, 10, 6, 9, 10, 9, 4, 5, 8]])
w[1] = np.array([[4, 3, 8, 10, 8, 5, 4, 1, 2], [6, 9, 3, 3, 3, 1, 6, 6, 1], [5, 4, 6, 9, 4, 5, 5, 7, 4]])
w[2] = np.array([6, 5, 4, 6, 3, 5, 10, 10, 2])
model.get_layer('GRU70238').set_weights(w) 
in0Ave70991 = tf.constant([[[[0.0278], [0.6381]]]])
in1Ave70991 = tf.constant([[[[0.4414], [0.0932]]]])
in0Con94954 = tf.constant([[[[0.1417], [0.4085]], [[0.9497], [0.927]], [[0.8141], [0.4471]]]])
in0GRU70238 = tf.constant([[[6, 1, 1], [3, 9, 9], [2, 7, 8]]])
in0Con61988 = tf.constant([[[[0.1276], [0.9509]], [[0.3902], [0.0296]], [[0.3176], [0.4069]]]])
in0Sub60237 = tf.constant([[[[0.1122, 0.0004], [0.1104, 0.8595]], [[0.0573, 0.1176], [0.959, 0.4703]], [[0.4056, 0.8782], [0.4071, 0.787]]]])
in1Sub60237 = tf.constant([[[[0.4629, 0.8552], [0.1376, 0.9767]], [[0.5531, 0.52], [0.3578, 0.3398]], [[0.9152, 0.295], [0.8417, 0.5736]]]])
print (np.array2string(model.predict([in0Ave70991,in1Ave70991,in0Con94954,in0GRU70238,in0Con61988,in0Sub60237,in1Sub60237],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max14769.png')

LAve70991 = average_layer([[[[[0.0278], [0.6381]]]], [[[[0.4414], [0.0932]]]]], Ave70991), 
LCro76180 = cropping2D_layer(Ave70991, 0, 0, 1, 0, Cro76180), 
LZer87229 = zero_padding2D_layer(Cro76180, 2, 0, 1, 0, Zer87229), 
LCon94954 = concatenate_layer([Zer87229,[[[[0.1417], [0.4085]], [[0.9497], [0.927]], [[0.8141], [0.4471]]]]], 3, Con94954), 
LGRU70238 = gru_layer([[[6, 1, 1], [3, 9, 9], [2, 7, 8]]],[[8, 6, 5, 6, 9, 8, 1, 5, 3], [4, 7, 3, 1, 1, 10, 1, 4, 5], [2, 10, 6, 9, 10, 9, 4, 5, 8]],[[4, 3, 8, 10, 8, 5, 4, 1, 2], [6, 9, 3, 3, 3, 1, 6, 6, 1], [5, 4, 6, 9, 4, 5, 5, 7, 4]],[6, 5, 4, 6, 3, 5, 10, 10, 2], false, GRU70238), 
LRes95446 = reshape_layer(GRU70238, [3, 1], Res95446), 
LRes44771 = reshape_layer(Res95446, [3, 1, 1], Res44771), 
LZer62946 = zero_padding2D_layer(Res44771, 0, 0, 1, 0, Zer62946), 
LCon61988 = concatenate_layer([Zer62946,[[[[0.1276], [0.9509]], [[0.3902], [0.0296]], [[0.3176], [0.4069]]]]], 3, Con61988), 
LSub60237 = subtract_layer([[[[0.1122, 0.0004], [0.1104, 0.8595]], [[0.0573, 0.1176], [0.959, 0.4703]], [[0.4056, 0.8782], [0.4071, 0.787]]]], [[[[0.4629, 0.8552], [0.1376, 0.9767]], [[0.5531, 0.52], [0.3578, 0.3398]], [[0.9152, 0.295], [0.8417, 0.5736]]]], Sub60237), 
LAdd57070 = add_layer([Con61988,Sub60237], Add57070), 
LMax14769 = maximum_layer([Con94954,Add57070], Max14769), 
exec_layers([LAve70991,LCro76180,LZer87229,LCon94954,LGRU70238,LRes95446,LRes44771,LZer62946,LCon61988,LSub60237,LAdd57070,LMax14769],["Ave70991","Cro76180","Zer87229","Con94954","GRU70238","Res95446","Res44771","Zer62946","Con61988","Sub60237","Add57070","Max14769"],Max14769,"Max14769")

Actual (Unparsed): [[[[0.0000000, 0.1417000], [0.0000000, 0.8337000]], [[0.0000000, 0.9497000], [0.6012000, 0.9270000]], [[0.0000000, 0.9008000], [0.3656500, 0.6203000]]]]

Expected (Unparsed): [[[[0,0.1417],[0,0.8337]],[[0,0.9497],[0.6012,0.927]],[[0,0.9007999999999999],[0.36565000000000003,0.6203000000000001]]]]

Actual:   [[[[0, 0.1417], [0, 0.8337]], [[0, 0.9497], [0.6012, 0.927]], [[0, 0.9008], [0.3657, 0.6203]]]]

Expected: [[[[0, 0.1417], [0, 0.8337]], [[0, 0.9497], [0.6012, 0.927]], [[0, 0.9008], [0.3657, 0.6204]]]]