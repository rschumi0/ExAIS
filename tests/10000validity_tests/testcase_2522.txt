import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max67621 = tf.keras.layers.Input(shape=([2, 1]))
in1Max67621 = tf.keras.layers.Input(shape=([2, 1]))
in0Con91950 = tf.keras.layers.Input(shape=([2]))
in0Min76665 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Min76665 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0LST42127 = tf.keras.layers.Input(shape=([3, 1]))
in0Con11805 = tf.keras.layers.Input(shape=([3]))
in0Mul3454 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Mul3454 = tf.keras.layers.Input(shape=([2, 2, 1]))

Max67621 = keras.layers.Maximum(name = 'Max67621', )([in0Max67621,in1Max67621])
Fla96004 = keras.layers.Flatten(name = 'Fla96004', )(Max67621)
Con91950 = keras.layers.Concatenate(axis=1, name = 'Con91950', )([Fla96004,in0Con91950])
Min76665 = keras.layers.Minimum(name = 'Min76665', )([in0Min76665,in1Min76665])
Res11221 = keras.layers.Reshape((2, 2, 1), name = 'Res11221', )(Min76665)
Res96714 = keras.layers.Reshape((2, 2), name = 'Res96714', )(Res11221)
Fla70458 = keras.layers.Flatten(name = 'Fla70458', )(Res96714)
LST42127 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST42127', )(in0LST42127)
Con11805 = keras.layers.Concatenate(axis=1, name = 'Con11805', )([LST42127,in0Con11805])
Ave93560 = keras.layers.Average(name = 'Ave93560', )([Fla70458,Con11805])
Dot91167 = keras.layers.Dot(axes=(1, 1), name = 'Dot91167', )([Con91950,Ave93560])
Res49025 = keras.layers.Reshape((1, 1), name = 'Res49025', )(Dot91167)
Res59706 = keras.layers.Reshape((1, 1, 1), name = 'Res59706', )(Res49025)
Zer45799 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer45799', )(Res59706)
Mul3454 = keras.layers.Multiply(name = 'Mul3454', )([in0Mul3454,in1Mul3454])
Max63026 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max63026', )(Mul3454)
Mul98997 = keras.layers.Multiply(name = 'Mul98997', )([Zer45799,Max63026])
model = tf.keras.models.Model(inputs=[in0Max67621,in1Max67621,in0Con91950,in0Min76665,in1Min76665,in0LST42127,in0Con11805,in0Mul3454,in1Mul3454], outputs=Mul98997)
w = model.get_layer('LST42127').get_weights() 
w[0] = np.array([[10, 5, 3, 6]])
w[1] = np.array([[6, 6, 6, 2]])
w[2] = np.array([2, 9, 7, 1])
model.get_layer('LST42127').set_weights(w) 
in0Max67621 = tf.constant([[[0.4653], [0.6653]]])
in1Max67621 = tf.constant([[[0.0538], [0.608]]])
in0Con91950 = tf.constant([[0.0457, 0.1951]])
in0Min76665 = tf.constant([[[[[0.4034]], [[0.736]]], [[[0.7653]], [[0.9225]]]]])
in1Min76665 = tf.constant([[[[[0.4837]], [[0.6001]]], [[[0.4169]], [[0.3371]]]]])
in0LST42127 = tf.constant([[[4], [9], [6]]])
in0Con11805 = tf.constant([[0.7205, 0.3996, 0.1807]])
in0Mul3454 = tf.constant([[[[0.898], [0.8822]], [[0.8137], [0.3716]]]])
in1Mul3454 = tf.constant([[[[0.8704], [0.6487]], [[0.8456], [0.6465]]]])
print (np.array2string(model.predict([in0Max67621,in1Max67621,in0Con91950,in0Min76665,in1Min76665,in0LST42127,in0Con11805,in0Mul3454,in1Mul3454],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul98997.png')

LMax67621 = maximum_layer([[[[0.4653], [0.6653]]], [[[0.0538], [0.608]]]], Max67621), 
LFla96004 = flatten_layer(Max67621, Fla96004), 
LCon91950 = concatenate_layer([Fla96004,[[0.0457, 0.1951]]], 1, Con91950), 
LMin76665 = minimum_layer([[[[[[0.4034]], [[0.736]]], [[[0.7653]], [[0.9225]]]]], [[[[[0.4837]], [[0.6001]]], [[[0.4169]], [[0.3371]]]]]], Min76665), 
LRes11221 = reshape_layer(Min76665, [2, 2, 1], Res11221), 
LRes96714 = reshape_layer(Res11221, [2, 2], Res96714), 
LFla70458 = flatten_layer(Res96714, Fla70458), 
LLST42127 = lstm_layer([[[4], [9], [6]]],[[10, 5, 3, 6]],[[6, 6, 6, 2]],[2, 9, 7, 1], LST42127), 
LCon11805 = concatenate_layer([LST42127,[[0.7205, 0.3996, 0.1807]]], 1, Con11805), 
LAve93560 = average_layer([Fla70458,Con11805], Ave93560), 
LDot91167 = dot_layer(Con91950,Ave93560, 1, 1, Dot91167), 
LRes49025 = reshape_layer(Dot91167, [1, 1], Res49025), 
LRes59706 = reshape_layer(Res49025, [1, 1, 1], Res59706), 
LZer45799 = zero_padding2D_layer(Res59706, 1, 0, 1, 0, Zer45799), 
LMul3454 = multiply_layer([[[[[0.898], [0.8822]], [[0.8137], [0.3716]]]], [[[[0.8704], [0.6487]], [[0.8456], [0.6465]]]]], Mul3454), 
LMax63026 = max_pool2D_layer(Mul3454, 1, 1, Max63026), 
LMul98997 = multiply_layer([Zer45799,Max63026], Mul98997), 
exec_layers([LMax67621,LFla96004,LCon91950,LMin76665,LRes11221,LRes96714,LFla70458,LLST42127,LCon11805,LAve93560,LDot91167,LRes49025,LRes59706,LZer45799,LMul3454,LMax63026,LMul98997],["Max67621","Fla96004","Con91950","Min76665","Res11221","Res96714","Fla70458","LST42127","Con11805","Ave93560","Dot91167","Res49025","Res59706","Zer45799","Mul3454","Max63026","Mul98997"],Mul98997,"Mul98997")

Actual (Unparsed): [[[[0.0000000], [0.0000000]], [[0.0000000], [0.2003156]]]]

Expected (Unparsed): [[[[0.0],[0.0]],[[0.0],[0.20031557649777704]]]]

Actual:   [[[[0], [0]], [[0], [0.2004]]]]

Expected: [[[[0], [0]], [[0], [0.2004]]]]