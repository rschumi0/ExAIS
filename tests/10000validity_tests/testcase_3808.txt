import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot41034 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot41034 = tf.keras.layers.Input(shape=([2, 3]))

Dot41034 = keras.layers.Dot(axes=(2, 2), name = 'Dot41034', )([in0Dot41034,in1Dot41034])
Bat39274 = keras.layers.BatchNormalization(axis=1, epsilon=0.16931840669230303,  name = 'Bat39274', )(Dot41034)
Res94296 = keras.layers.Reshape((2, 2, 1), name = 'Res94296', )(Bat39274)
Ave2802 = keras.layers.AveragePooling2D(pool_size=(2, 2), name = 'Ave2802', )(Res94296)
model = tf.keras.models.Model(inputs=[in0Dot41034,in1Dot41034], outputs=Ave2802)
w = model.get_layer('Bat39274').get_weights() 
w[0] = np.array([0.0891, 0.9529])
w[1] = np.array([0.1346, 0.5923])
w[2] = np.array([0.0545, 0.6511])
w[3] = np.array([0.6506, 0.1568])
model.get_layer('Bat39274').set_weights(w) 
in0Dot41034 = tf.constant([[[0.7126, 0.9495, 0.6843], [0.5178, 0.8708, 0.1753]]])
in1Dot41034 = tf.constant([[[0.5757, 0.5434, 0.5678], [0.0658, 0.8694, 0.8956]]])
print (np.array2string(model.predict([in0Dot41034,in1Dot41034],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave2802.png')

LDot41034 = dot_layer([[[0.7126, 0.9495, 0.6843], [0.5178, 0.8708, 0.1753]]], [[[0.5757, 0.5434, 0.5678], [0.0658, 0.8694, 0.8956]]], 2, 2, Dot41034), 
LBat39274 = batch_normalization_layer(Dot41034, 1, 0.16931840669230303, [0.0891, 0.9529], [0.1346, 0.5923], [0.0545, 0.6511], [0.6506, 0.1568], Bat39274), 
LRes94296 = reshape_layer(Bat39274, [2, 2, 1], Res94296), 
LAve2802 = average_pooling2D_layer(Res94296, 2, 2, Ave2802), 
exec_layers([LDot41034,LBat39274,LRes94296,LAve2802],["Dot41034","Bat39274","Res94296","Ave2802"],Ave2802,"Ave2802")

Actual (Unparsed): [[[[0.6452218]]]]

Expected (Unparsed): [[[[0.6452218286954496]]]]

Actual:   [[[[0.6453]]]]

Expected: [[[[0.6453]]]]