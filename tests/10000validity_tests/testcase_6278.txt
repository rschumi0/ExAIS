import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Zer17267 = tf.keras.layers.Input(shape=([3, 1]))
in0Max31531 = tf.keras.layers.Input(shape=([1, 1]))
in0Con11255 = tf.keras.layers.Input(shape=([5, 1]))
in0Zer33570 = tf.keras.layers.Input(shape=([4, 4, 4]))

Zer17267 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer17267', )(in0Zer17267)
Max31531 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='valid', name = 'Max31531', )(in0Max31531)
Zer85825 = keras.layers.ZeroPadding1D(padding=((4, 0)), name = 'Zer85825', )(Max31531)
Mul46562 = keras.layers.Multiply(name = 'Mul46562', )([Zer17267,Zer85825])
Con11255 = keras.layers.Concatenate(axis=2, name = 'Con11255', )([Mul46562,in0Con11255])
Zer33570 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer33570', )(in0Zer33570)
Res61251 = keras.layers.Reshape((6, 6, 4, 1), name = 'Res61251', )(Zer33570)
Cro70768 = keras.layers.Cropping3D(cropping=((4, 1), (3, 2), (3, 0)), name = 'Cro70768', )(Res61251)
Res61918 = keras.layers.Reshape((1, 1, 1), name = 'Res61918', )(Cro70768)
Res27720 = keras.layers.Reshape((1, 1), name = 'Res27720', )(Res61918)
Loc5405 = keras.layers.LocallyConnected1D(2, (1),strides=(1), name = 'Loc5405', )(Res27720)
Zer96791 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer96791', )(Loc5405)
Dot40443 = keras.layers.Dot(axes=(2, 2), name = 'Dot40443', )([Con11255,Zer96791])
model = tf.keras.models.Model(inputs=[in0Zer17267,in0Max31531,in0Con11255,in0Zer33570], outputs=Dot40443)
w = model.get_layer('Loc5405').get_weights() 
w[0] = np.array([[[0.3856, 0.8881]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc5405').set_weights(w) 
in0Zer17267 = tf.constant([[[1.5058], [1.0746], [1.0027]]])
in0Max31531 = tf.constant([[[1.7696]]])
in0Con11255 = tf.constant([[[0.483], [0.372], [0.7362], [0.6778], [0.8689]]])
in0Zer33570 = tf.constant([[[[1.8743, 1.8998, 1.5196, 1.8028], [1.2525, 1.5189, 1.0512, 1.9769], [1.2748, 1.4452, 1.5878, 1.8004], [1.1137, 1.5353, 1.8302, 1.2058]], [[1.463, 1.9275, 1.0696, 1.2817], [1.1916, 1.5717, 1.8584, 1.2801], [1.9561, 1.086, 1.0133, 1.1851], [1.4459, 1.4715, 1.7651, 1.4404]], [[1.3494, 1.2957, 1.6748, 1.5312], [1.5763, 1.3179, 1.2731, 1.9885], [1.747, 1.1673, 1.2491, 1.0431], [1.4714, 1.6116, 1.4121, 1.5954]], [[1.4784, 1.1552, 1.5829, 1.3848], [1.2265, 1.1928, 1.0299, 1.2454], [1.2324, 1.7094, 1.0628, 1.1162], [1.986, 1.5682, 1.9169, 1.0378]]]])
print (np.array2string(model.predict([in0Zer17267,in0Max31531,in0Con11255,in0Zer33570],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot40443.png')

LZer17267 = zero_padding1D_layer([[[1.5058], [1.0746], [1.0027]]], 1, 1, Zer17267), 
LMax31531 = max_pool1D_layer([[[1.7696]]], 1, 1, false, Max31531), 
LZer85825 = zero_padding1D_layer(Max31531, 4, 0, Zer85825), 
LMul46562 = multiply_layer([Zer17267,Zer85825], Mul46562), 
LCon11255 = concatenate_layer([Mul46562,[[[0.483], [0.372], [0.7362], [0.6778], [0.8689]]]], 2, Con11255), 
LZer33570 = zero_padding2D_layer([[[[1.8743, 1.8998, 1.5196, 1.8028], [1.2525, 1.5189, 1.0512, 1.9769], [1.2748, 1.4452, 1.5878, 1.8004], [1.1137, 1.5353, 1.8302, 1.2058]], [[1.463, 1.9275, 1.0696, 1.2817], [1.1916, 1.5717, 1.8584, 1.2801], [1.9561, 1.086, 1.0133, 1.1851], [1.4459, 1.4715, 1.7651, 1.4404]], [[1.3494, 1.2957, 1.6748, 1.5312], [1.5763, 1.3179, 1.2731, 1.9885], [1.747, 1.1673, 1.2491, 1.0431], [1.4714, 1.6116, 1.4121, 1.5954]], [[1.4784, 1.1552, 1.5829, 1.3848], [1.2265, 1.1928, 1.0299, 1.2454], [1.2324, 1.7094, 1.0628, 1.1162], [1.986, 1.5682, 1.9169, 1.0378]]]], 1, 1, 1, 1, Zer33570), 
LRes61251 = reshape_layer(Zer33570, [6, 6, 4, 1], Res61251), 
LCro70768 = cropping3D_layer(Res61251, 4, 1, 3, 2, 3, 0, Cro70768), 
LRes61918 = reshape_layer(Cro70768, [1, 1, 1], Res61918), 
LRes27720 = reshape_layer(Res61918, [1, 1], Res27720), 
LLoc5405 = locally_connected1D_layer(Res27720, 1,[[[0.3856, 0.8881]]],[[0, 0]], 1, Loc5405), 
LZer96791 = zero_padding1D_layer(Loc5405, 1, 1, Zer96791), 
LDot40443 = dot_layer(Con11255,Zer96791, 2, 2, Dot40443), 
exec_layers([LZer17267,LMax31531,LZer85825,LMul46562,LCon11255,LZer33570,LRes61251,LCro70768,LRes61918,LRes27720,LLoc5405,LZer96791,LDot40443],["Zer17267","Max31531","Zer85825","Mul46562","Con11255","Zer33570","Res61251","Cro70768","Res61918","Res27720","Loc5405","Zer96791","Dot40443"],Dot40443,"Dot40443")

Actual (Unparsed): [[[0.0000000, 0.4787966, 0.0000000], [0.0000000, 0.3687626, 0.0000000], [0.0000000, 0.7297930, 0.0000000], [0.0000000, 0.6719012, 0.0000000], [0.0000000, 0.8613381, 0.0000000]]]

Expected (Unparsed): [[[0.0,0.47879655726000003,0.0],[0.0,0.36876256584000006,0.0],[0.0,0.729793013364,0.0],[0.0,0.671901255716,0.0],[0.0,0.8613381544580001,0.0]]]

Actual:   [[[0, 0.4788, 0], [0, 0.3688, 0], [0, 0.7298, 0], [0, 0.672, 0], [0, 0.8614, 0]]]

Expected: [[[0, 0.4788, 0], [0, 0.3688, 0], [0, 0.7298, 0], [0, 0.672, 0], [0, 0.8614, 0]]]