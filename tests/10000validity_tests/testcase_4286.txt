import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0GRU59299 = tf.keras.layers.Input(shape=([2, 1]))
in0Con77162 = tf.keras.layers.Input(shape=([2]))
in0Dot13005 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot13005 = tf.keras.layers.Input(shape=([3, 2]))

GRU59299 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU59299', )(in0GRU59299)
Thr22102 = keras.layers.ThresholdedReLU(theta=3.3142401846699556, name = 'Thr22102', )(GRU59299)
Con77162 = keras.layers.Concatenate(axis=1, name = 'Con77162', )([Thr22102,in0Con77162])
Dot13005 = keras.layers.Dot(axes=(2, 2), name = 'Dot13005', )([in0Dot13005,in1Dot13005])
Glo49780 = keras.layers.GlobalAveragePooling1D(name = 'Glo49780', )(Dot13005)
Sub95401 = keras.layers.Subtract(name = 'Sub95401', )([Con77162,Glo49780])
Res35307 = keras.layers.Reshape((3, 1), name = 'Res35307', )(Sub95401)
Per39688 = keras.layers.Permute((2,1), name = 'Per39688',)(Res35307)
model = tf.keras.models.Model(inputs=[in0GRU59299,in0Con77162,in0Dot13005,in1Dot13005], outputs=Per39688)
w = model.get_layer('GRU59299').get_weights() 
w[0] = np.array([[6, 7, 6]])
w[1] = np.array([[4, 3, 5]])
w[2] = np.array([9, 9, 7])
model.get_layer('GRU59299').set_weights(w) 
in0GRU59299 = tf.constant([[[2], [5]]])
in0Con77162 = tf.constant([[0.064, 0.9739]])
in0Dot13005 = tf.constant([[[0.9445, 0.415], [0.1867, 0.3206], [0.6259, 0.3854]]])
in1Dot13005 = tf.constant([[[0.1184, 0.915], [0.437, 0.3029], [0.6445, 0.5673]]])
print (np.array2string(model.predict([in0GRU59299,in0Con77162,in0Dot13005,in1Dot13005],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Per39688.png')

LGRU59299 = gru_layer([[[2], [5]]],[[6, 7, 6]],[[4, 3, 5]],[9, 9, 7], false, GRU59299), 
LThr22102 = thresholded_relu_layer(GRU59299, 3.3142401846699556, Thr22102), 
LCon77162 = concatenate_layer([Thr22102,[[0.064, 0.9739]]], 1, Con77162), 
LDot13005 = dot_layer([[[0.9445, 0.415], [0.1867, 0.3206], [0.6259, 0.3854]]], [[[0.1184, 0.915], [0.437, 0.3029], [0.6445, 0.5673]]], 2, 2, Dot13005), 
LGlo49780 = global_average_pooling1D_layer(Dot13005, Glo49780), 
LSub95401 = subtract_layer(Con77162,Glo49780, Sub95401), 
LRes35307 = reshape_layer(Sub95401, [3, 1], Res35307), 
LPer39688 = permute_layer(Res35307, 2,1, Per39688), 
exec_layers([LGRU59299,LThr22102,LCon77162,LDot13005,LGlo49780,LSub95401,LRes35307,LPer39688],["GRU59299","Thr22102","Con77162","Dot13005","Glo49780","Sub95401","Res35307","Per39688"],Per39688,"Per39688")

Actual (Unparsed): [[[-0.4112519, -0.3051345, 0.3844353]]]

Expected (Unparsed): [[[-0.41125188,-0.30513453333333335,0.38443525]]]

Actual:   [[[-0.4112, -0.3051, 0.3845]]]

Expected: [[[-0.4112, -0.3051, 0.3845]]]