import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul66562 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul66562 = tf.keras.layers.Input(shape=([2, 2]))
in0Con95190 = tf.keras.layers.Input(shape=([2, 14]))
in0Per70449 = tf.keras.layers.Input(shape=([2, 3]))

Mul66562 = keras.layers.Multiply(name = 'Mul66562', )([in0Mul66562,in1Mul66562])
Con95190 = keras.layers.Concatenate(axis=2, name = 'Con95190', )([Mul66562,in0Con95190])
Per70449 = keras.layers.Permute((2,1), name = 'Per70449',)(in0Per70449)
Res41847 = keras.layers.Reshape((3, 2, 1), name = 'Res41847', )(Per70449)
Res72835 = keras.layers.Reshape((3, 2, 1, 1), name = 'Res72835', )(Res41847)
Con68172 = keras.layers.Conv3DTranspose(4, (1, 2, 1),strides=(1, 1, 2), padding='same', name = 'Con68172', )(Res72835)
Res92433 = keras.layers.Reshape((3, 2, 8), name = 'Res92433', )(Con68172)
PRe29076 = keras.layers.PReLU(name = 'PRe29076', )(Res92433)
Res33804 = keras.layers.Reshape((3, 16), name = 'Res33804', )(PRe29076)
Dot85897 = keras.layers.Dot(axes=(2, 2), name = 'Dot85897', )([Con95190,Res33804])
model = tf.keras.models.Model(inputs=[in0Mul66562,in1Mul66562,in0Con95190,in0Per70449], outputs=Dot85897)
w = model.get_layer('Con68172').get_weights() 
w[0] = np.array([[[[[0.3135], [0.5959], [0.7462], [0.4532]]], [[[0.0292], [0.7238], [0.8409], [0.834]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con68172').set_weights(w) 
w = model.get_layer('PRe29076').get_weights() 
w[0] = np.array([[[0.9639, 0.0431, 0.0277, 0.3493, 0.0042, 0.0038, 0.214, 0.4707], [0.8423, 0.2094, 0.804, 0.0147, 0.2933, 0.4354, 0.8713, 0.8058]], [[0.6368, 0.6406, 0.2131, 0.2961, 0.0036, 0.5272, 0.5118, 0.741], [0.9166, 0.6638, 0.5457, 0.8135, 0.2351, 0.5757, 0.7009, 0.9781]], [[0.2396, 0.0763, 0.1092, 0.5191, 0.492, 0.6463, 0.7085, 0.8492], [0.4059, 0.8457, 0.3992, 0.6143, 0.1708, 0.5911, 0.2625, 0.1512]]])
model.get_layer('PRe29076').set_weights(w) 
in0Mul66562 = tf.constant([[[0.6744, 0.8121], [0.0348, 0.2903]]])
in1Mul66562 = tf.constant([[[0.9568, 0.1151], [0.8204, 0.0386]]])
in0Con95190 = tf.constant([[[0.0033, 0.6093, 0.3721, 0.3001, 0.0576, 0.1421, 0.606, 0.3789, 0.4453, 0.6583, 0.6115, 0.9238, 0.5286, 0.5643], [0.8511, 0.8566, 0.5984, 0.8794, 0.9089, 0.4371, 0.3954, 0.8329, 0.4077, 0.8986, 0.3355, 0.6643, 0.1844, 0.6603]]])
in0Per70449 = tf.constant([[[1.2256, 1.5538, 1.4846], [1.7668, 1.6141, 1.9364]]])
print (np.array2string(model.predict([in0Mul66562,in1Mul66562,in0Con95190,in0Per70449],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot85897.png')

LMul66562 = multiply_layer([[[[0.6744, 0.8121], [0.0348, 0.2903]]], [[[0.9568, 0.1151], [0.8204, 0.0386]]]], Mul66562), 
LCon95190 = concatenate_layer([Mul66562,[[[0.0033, 0.6093, 0.3721, 0.3001, 0.0576, 0.1421, 0.606, 0.3789, 0.4453, 0.6583, 0.6115, 0.9238, 0.5286, 0.5643], [0.8511, 0.8566, 0.5984, 0.8794, 0.9089, 0.4371, 0.3954, 0.8329, 0.4077, 0.8986, 0.3355, 0.6643, 0.1844, 0.6603]]]], 2, Con95190), 
LPer70449 = permute_layer([[[1.2256, 1.5538, 1.4846], [1.7668, 1.6141, 1.9364]]], 2,1, Per70449), 
LRes41847 = reshape_layer(Per70449, [3, 2, 1], Res41847), 
LRes72835 = reshape_layer(Res41847, [3, 2, 1, 1], Res72835), 
LCon68172 = conv3D_transpose_layer(Res72835, 1, 2, 1,[[[[[0.3135], [0.5959], [0.7462], [0.4532]]], [[[0.0292], [0.7238], [0.8409], [0.834]]]]],[0, 0, 0, 0], 1, 1, 2, true, Con68172), 
LRes92433 = reshape_layer(Con68172, [3, 2, 8], Res92433), 
LPRe29076 = prelu_layer(Res92433, [[[0.9639, 0.0431, 0.0277, 0.3493, 0.0042, 0.0038, 0.214, 0.4707], [0.8423, 0.2094, 0.804, 0.0147, 0.2933, 0.4354, 0.8713, 0.8058]], [[0.6368, 0.6406, 0.2131, 0.2961, 0.0036, 0.5272, 0.5118, 0.741], [0.9166, 0.6638, 0.5457, 0.8135, 0.2351, 0.5757, 0.7009, 0.9781]], [[0.2396, 0.0763, 0.1092, 0.5191, 0.492, 0.6463, 0.7085, 0.8492], [0.4059, 0.8457, 0.3992, 0.6143, 0.1708, 0.5911, 0.2625, 0.1512]]], PRe29076), 
LRes33804 = reshape_layer(PRe29076, [3, 16], Res33804), 
LDot85897 = dot_layer(Con95190,Res33804, 2, 2, Dot85897), 
exec_layers([LMul66562,LCon95190,LPer70449,LRes41847,LRes72835,LCon68172,LRes92433,LPRe29076,LRes33804,LDot85897],["Mul66562","Con95190","Per70449","Res41847","Res72835","Con68172","Res92433","PRe29076","Res33804","Dot85897"],Dot85897,"Dot85897")

Actual (Unparsed): [[[3.9960244, 4.4112488, 4.6272621], [5.7179457, 6.4156912, 6.6549203]]]

Expected (Unparsed): [[[3.9960243839683103,4.411248857679424,4.62726212942284],[5.717945626127475,6.415691282467259,6.654920456055352]]]

Actual:   [[[3.9961, 4.4113, 4.6273], [5.718, 6.4157, 6.655]]]

Expected: [[[3.9961, 4.4113, 4.6273], [5.718, 6.4157, 6.655]]]