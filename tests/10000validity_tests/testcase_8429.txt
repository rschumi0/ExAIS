import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Lay7545 = tf.keras.layers.Input(shape=([2]))
in0Con98807 = tf.keras.layers.Input(shape=([3, 1]))
in0PRe10788 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con25158 = tf.keras.layers.Input(shape=([3, 1]))
in0Sub58429 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub58429 = tf.keras.layers.Input(shape=([3, 2]))

Lay7545 = keras.layers.LayerNormalization(axis=1, epsilon=2.373969664472409, name = 'Lay7545', )(in0Lay7545)
Lea72543 = keras.layers.LeakyReLU(alpha=0.7209065290237051, name = 'Lea72543', )(Lay7545)
Res74898 = keras.layers.Reshape((2, 1), name = 'Res74898', )(Lea72543)
Zer79761 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer79761', )(Res74898)
Con98807 = keras.layers.Concatenate(axis=2, name = 'Con98807', )([Zer79761,in0Con98807])
PRe10788 = keras.layers.PReLU(name = 'PRe10788', input_shape=(1, 1, 1))(in0PRe10788)
Res34047 = keras.layers.Reshape((1, 1), name = 'Res34047', )(PRe10788)
Zer69361 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer69361', )(Res34047)
Con25158 = keras.layers.Concatenate(axis=2, name = 'Con25158', )([Zer69361,in0Con25158])
Sub58429 = keras.layers.Subtract(name = 'Sub58429', )([in0Sub58429,in1Sub58429])
Min59966 = keras.layers.Minimum(name = 'Min59966', )([Con25158,Sub58429])
Sub83245 = keras.layers.Subtract(name = 'Sub83245', )([Con98807,Min59966])
Res11337 = keras.layers.Reshape((3, 2, 1), name = 'Res11337', )(Sub83245)
Max55425 = keras.layers.MaxPool2D(pool_size=(3, 2), name = 'Max55425', )(Res11337)
model = tf.keras.models.Model(inputs=[in0Lay7545,in0Con98807,in0PRe10788,in0Con25158,in0Sub58429,in1Sub58429], outputs=Max55425)
w = model.get_layer('PRe10788').get_weights() 
w[0] = np.array([[[0.7308]]])
model.get_layer('PRe10788').set_weights(w) 
in0Lay7545 = tf.constant([[1.3744, 1.4876]])
in0Con98807 = tf.constant([[[0.2011], [0.8724], [0.3662]]])
in0PRe10788 = tf.constant([[[[0.5887]]]])
in0Con25158 = tf.constant([[[0.5389], [0.825], [0.4197]]])
in0Sub58429 = tf.constant([[[0.5461, 0.1803], [0.1139, 0.9245], [0.9413, 0.2004]]])
in1Sub58429 = tf.constant([[[0.9722, 0.2862], [0.7843, 0.2486], [0.2352, 0.2367]]])
print (np.array2string(model.predict([in0Lay7545,in0Con98807,in0PRe10788,in0Con25158,in0Sub58429,in1Sub58429],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max55425.png')

LLay7545 = layer_normalization_layer([[1.3744, 1.4876]], 1, 2.373969664472409, Lay7545), 
LLea72543 = leaky_relu_layer(Lay7545, 0.7209065290237051, Lea72543), 
LRes74898 = reshape_layer(Lea72543, [2, 1], Res74898), 
LZer79761 = zero_padding1D_layer(Res74898, 1, 0, Zer79761), 
LCon98807 = concatenate_layer([Zer79761,[[[0.2011], [0.8724], [0.3662]]]], 2, Con98807), 
LPRe10788 = prelu_layer([[[[0.5887]]]], [[[0.7308]]], PRe10788), 
LRes34047 = reshape_layer(PRe10788, [1, 1], Res34047), 
LZer69361 = zero_padding1D_layer(Res34047, 2, 0, Zer69361), 
LCon25158 = concatenate_layer([Zer69361,[[[0.5389], [0.825], [0.4197]]]], 2, Con25158), 
LSub58429 = subtract_layer([[[0.5461, 0.1803], [0.1139, 0.9245], [0.9413, 0.2004]]], [[[0.9722, 0.2862], [0.7843, 0.2486], [0.2352, 0.2367]]], Sub58429), 
LMin59966 = minimum_layer([Con25158,Sub58429], Min59966), 
LSub83245 = subtract_layer(Con98807,Min59966, Sub83245), 
LRes11337 = reshape_layer(Sub83245, [3, 2, 1], Res11337), 
LMax55425 = max_pool2D_layer(Res11337, 3, 2, Max55425), 
exec_layers([LLay7545,LLea72543,LRes74898,LZer79761,LCon98807,LPRe10788,LRes34047,LZer69361,LCon25158,LSub58429,LMin59966,LSub83245,LRes11337,LMax55425],["Lay7545","Lea72543","Res74898","Zer79761","Con98807","PRe10788","Res34047","Zer69361","Con25158","Sub58429","Min59966","Sub83245","Res11337","Max55425"],Max55425,"Max55425")

Actual (Unparsed): [[[[0.6439355]]]]

Expected (Unparsed): [[[[0.6439354218866608]]]]

Actual:   [[[[0.644]]]]

Expected: [[[[0.644]]]]