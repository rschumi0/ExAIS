import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add49160 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Add49160 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))

Add49160 = keras.layers.Add(name = 'Add49160', )([in0Add49160,in1Add49160])
Res6499 = keras.layers.Reshape((1, 1, 4), name = 'Res6499', )(Add49160)
Res16731 = keras.layers.Reshape((1, 4), name = 'Res16731', )(Res6499)
LST82110 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST82110', )(Res16731)
Res29654 = keras.layers.Reshape((3, 1), name = 'Res29654', )(LST82110)
Res36556 = keras.layers.Reshape((3, 1, 1), name = 'Res36556', )(Res29654)
Sep65650 = keras.layers.SeparableConv2D(3, (1, 1),strides=(1, 1), padding='valid', name = 'Sep65650', )(Res36556)
model = tf.keras.models.Model(inputs=[in0Add49160,in1Add49160], outputs=Sep65650)
w = model.get_layer('LST82110').get_weights() 
w[0] = np.array([[8, 4, 1, 1, 6, 6, 4, 8, 1, 7, 10, 3], [7, 6, 5, 4, 8, 1, 9, 9, 4, 3, 6, 10], [6, 4, 2, 2, 7, 3, 7, 6, 10, 2, 7, 1], [7, 1, 10, 7, 7, 1, 2, 7, 4, 2, 2, 2]])
w[1] = np.array([[1, 7, 9, 7, 7, 5, 5, 7, 5, 5, 3, 5], [4, 4, 1, 3, 10, 2, 6, 2, 6, 5, 3, 8], [9, 2, 1, 5, 6, 3, 3, 6, 6, 9, 8, 3]])
w[2] = np.array([3, 3, 6, 6, 3, 9, 6, 2, 8, 4, 3, 3])
model.get_layer('LST82110').set_weights(w) 
w = model.get_layer('Sep65650').get_weights() 
w[0] = np.array([[[[0.1009]]]])
w[1] = np.array([[[[0.5663, 0.8955, 0.7778]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep65650').set_weights(w) 
in0Add49160 = tf.constant([[[[[0.6036, 0.3368], [0.2751, 0.8908]]]]])
in1Add49160 = tf.constant([[[[[0.4979, 0.6117], [0.2831, 0.7052]]]]])
print (np.array2string(model.predict([in0Add49160,in1Add49160],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sep65650.png')

LAdd49160 = add_layer([[[[[[0.6036, 0.3368], [0.2751, 0.8908]]]]], [[[[[0.4979, 0.6117], [0.2831, 0.7052]]]]]], Add49160), 
LRes6499 = reshape_layer(Add49160, [1, 1, 4], Res6499), 
LRes16731 = reshape_layer(Res6499, [1, 4], Res16731), 
LLST82110 = lstm_layer(Res16731,[[8, 4, 1, 1, 6, 6, 4, 8, 1, 7, 10, 3], [7, 6, 5, 4, 8, 1, 9, 9, 4, 3, 6, 10], [6, 4, 2, 2, 7, 3, 7, 6, 10, 2, 7, 1], [7, 1, 10, 7, 7, 1, 2, 7, 4, 2, 2, 2]],[[1, 7, 9, 7, 7, 5, 5, 7, 5, 5, 3, 5], [4, 4, 1, 3, 10, 2, 6, 2, 6, 5, 3, 8], [9, 2, 1, 5, 6, 3, 3, 6, 6, 9, 8, 3]],[3, 3, 6, 6, 3, 9, 6, 2, 8, 4, 3, 3], LST82110), 
LRes29654 = reshape_layer(LST82110, [3, 1], Res29654), 
LRes36556 = reshape_layer(Res29654, [3, 1, 1], Res36556), 
LSep65650 = separable_conv2D_layer(Res36556, 1, 1,[[[[[0.1009]]]],[[[[0.5663, 0.8955, 0.7778]]]]],[0, 0, 0], 1, 1, false, Sep65650), 
exec_layers([LAdd49160,LRes6499,LRes16731,LLST82110,LRes29654,LRes36556,LSep65650],["Add49160","Res6499","Res16731","LST82110","Res29654","Res36556","Sep65650"],Sep65650,"Sep65650")

Actual (Unparsed): [[[[0.0435172, 0.0688146, 0.0597699]], [[0.0435172, 0.0688146, 0.0597699]], [[0.0435172, 0.0688146, 0.0597699]]]]

Expected (Unparsed): [[[[0.0435172384660144,0.06881456303428553,0.05976992420778033]],[[0.0435172376751535,0.06881456178368349,0.05976992312155111]],[[0.04351723860310706,0.06881456325107252,0.05976992439607394]]]]

Actual:   [[[[0.0436, 0.0689, 0.0598]], [[0.0436, 0.0689, 0.0598]], [[0.0436, 0.0689, 0.0598]]]]

Expected: [[[[0.0436, 0.0689, 0.0598]], [[0.0436, 0.0689, 0.0598]], [[0.0436, 0.0689, 0.0598]]]]