import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul13637 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Mul13637 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Min10736 = tf.keras.layers.Input(shape=([1, 2]))
in1Min10736 = tf.keras.layers.Input(shape=([1, 2]))
in0Con12814 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Min89339 = tf.keras.layers.Input(shape=([2, 2]))
in1Min89339 = tf.keras.layers.Input(shape=([2, 2]))
in0Mul388 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul388 = tf.keras.layers.Input(shape=([2, 1]))

Mul13637 = keras.layers.Multiply(name = 'Mul13637', )([in0Mul13637,in1Mul13637])
Res35988 = keras.layers.Reshape((2, 2, 1), name = 'Res35988', )(Mul13637)
Min10736 = keras.layers.Minimum(name = 'Min10736', )([in0Min10736,in1Min10736])
Zer7790 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer7790', )(Min10736)
Con12814 = keras.layers.Conv2D(2, (2, 1),strides=(2, 1), padding='same', dilation_rate=(1, 1), name = 'Con12814', )(in0Con12814)
Res75839 = keras.layers.Reshape((1, 2), name = 'Res75839', )(Con12814)
Zer7592 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer7592', )(Res75839)
Min89339 = keras.layers.Minimum(name = 'Min89339', )([in0Min89339,in1Min89339])
Sub73767 = keras.layers.Subtract(name = 'Sub73767', )([Zer7592,Min89339])
Sub16722 = keras.layers.Subtract(name = 'Sub16722', )([Zer7790,Sub73767])
Res1099 = keras.layers.Reshape((2, 2, 1), name = 'Res1099', )(Sub16722)
Mul29031 = keras.layers.Multiply(name = 'Mul29031', )([Res35988,Res1099])
Res3566 = keras.layers.Reshape((2, 2), name = 'Res3566', )(Mul29031)
Mul388 = keras.layers.Multiply(name = 'Mul388', )([in0Mul388,in1Mul388])
Dot31681 = keras.layers.Dot(axes=(2, 1), name = 'Dot31681', )([Res3566,Mul388])
model = tf.keras.models.Model(inputs=[in0Mul13637,in1Mul13637,in0Min10736,in1Min10736,in0Con12814,in0Min89339,in1Min89339,in0Mul388,in1Mul388], outputs=Dot31681)
w = model.get_layer('Con12814').get_weights() 
w[0] = np.array([[[[0.7221, 0.7239], [0.1741, 0.3387]]], [[[0.2231, 0.1278], [0.7874, 0.3161]]]])
w[1] = np.array([0, 0])
model.get_layer('Con12814').set_weights(w) 
in0Mul13637 = tf.constant([[[[[0.7954]], [[0.4027]]], [[[0.9182]], [[0.2284]]]]])
in1Mul13637 = tf.constant([[[[[0.049]], [[0.6214]]], [[[0.2086]], [[0.2961]]]]])
in0Min10736 = tf.constant([[[0.6066, 0.5161]]])
in1Min10736 = tf.constant([[[0.7793, 0.2172]]])
in0Con12814 = tf.constant([[[[0.8427, 0.0706]], [[0.4464, 0.2632]]]])
in0Min89339 = tf.constant([[[0.437, 0.7217], [0.6412, 0.6166]]])
in1Min89339 = tf.constant([[[0.9117, 0.3599], [0.3134, 0.5115]]])
in0Mul388 = tf.constant([[[0.3251], [0.3029]]])
in1Mul388 = tf.constant([[[0.2709], [0.0798]]])
print (np.array2string(model.predict([in0Mul13637,in1Mul13637,in0Min10736,in1Min10736,in0Con12814,in0Min89339,in1Min89339,in0Mul388,in1Mul388],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot31681.png')

LMul13637 = multiply_layer([[[[[[0.7954]], [[0.4027]]], [[[0.9182]], [[0.2284]]]]], [[[[[0.049]], [[0.6214]]], [[[0.2086]], [[0.2961]]]]]], Mul13637), 
LRes35988 = reshape_layer(Mul13637, [2, 2, 1], Res35988), 
LMin10736 = minimum_layer([[[[0.6066, 0.5161]]], [[[0.7793, 0.2172]]]], Min10736), 
LZer7790 = zero_padding1D_layer(Min10736, 1, 0, Zer7790), 
LCon12814 = conv2D_layer([[[[0.8427, 0.0706]], [[0.4464, 0.2632]]]], 2, 1,[[[[0.7221, 0.7239], [0.1741, 0.3387]]], [[[0.2231, 0.1278], [0.7874, 0.3161]]]],[0, 0], 2, 1, true, 1, 1, Con12814), 
LRes75839 = reshape_layer(Con12814, [1, 2], Res75839), 
LZer7592 = zero_padding1D_layer(Res75839, 1, 0, Zer7592), 
LMin89339 = minimum_layer([[[[0.437, 0.7217], [0.6412, 0.6166]]], [[[0.9117, 0.3599], [0.3134, 0.5115]]]], Min89339), 
LSub73767 = subtract_layer(Zer7592,Min89339, Sub73767), 
LSub16722 = subtract_layer(Zer7790,Sub73767, Sub16722), 
LRes1099 = reshape_layer(Sub16722, [2, 2, 1], Res1099), 
LMul29031 = multiply_layer([Res35988,Res1099], Mul29031), 
LRes3566 = reshape_layer(Mul29031, [2, 2], Res3566), 
LMul388 = multiply_layer([[[[0.3251], [0.3029]]], [[[0.2709], [0.0798]]]], Mul388), 
LDot31681 = dot_layer(Res3566,Mul388, 2, 1, Dot31681), 
exec_layers([LMul13637,LRes35988,LMin10736,LZer7790,LCon12814,LRes75839,LZer7592,LMin89339,LSub73767,LSub16722,LRes1099,LMul29031,LRes3566,LMul388,LDot31681],["Mul13637","Res35988","Min10736","Zer7790","Con12814","Res75839","Zer7592","Min89339","Sub73767","Sub16722","Res1099","Mul29031","Res3566","Mul388","Dot31681"],Dot31681,"Dot31681")

Actual (Unparsed): [[[0.0036769], [-0.0002032]]]

Expected (Unparsed): [[[0.0036768845001760283],[-0.00020324920686207084]]]

Actual:   [[[0.0037], [-0.0002]]]

Expected: [[[0.0037], [-0.0002]]]