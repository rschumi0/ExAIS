import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0PRe85939 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Glo93236 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Con86499 = tf.keras.layers.Input(shape=([1]))
in0Con79373 = tf.keras.layers.Input(shape=([2, 1]))
in0Dot44122 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot44122 = tf.keras.layers.Input(shape=([3, 3]))

PRe85939 = keras.layers.PReLU(name = 'PRe85939', input_shape=(2, 1, 1))(in0PRe85939)
Fla77608 = keras.layers.Flatten(name = 'Fla77608', )(PRe85939)
Glo93236 = keras.layers.GlobalAveragePooling3D(name = 'Glo93236', )(in0Glo93236)
Con86499 = keras.layers.Concatenate(axis=1, name = 'Con86499', )([Glo93236,in0Con86499])
Ave75370 = keras.layers.Average(name = 'Ave75370', )([Fla77608,Con86499])
ELU3579 = keras.layers.ELU(alpha=-2.3039329192759617, name = 'ELU3579', )(Ave75370)
Res22011 = keras.layers.Reshape((2, 1), name = 'Res22011', )(ELU3579)
Con79373 = keras.layers.Concatenate(axis=2, name = 'Con79373', )([Res22011,in0Con79373])
Dot44122 = keras.layers.Dot(axes=(2, 2), name = 'Dot44122', )([in0Dot44122,in1Dot44122])
Loc21515 = keras.layers.LocallyConnected1D(2, (2),strides=(1), name = 'Loc21515', )(Dot44122)
Max81631 = keras.layers.Maximum(name = 'Max81631', )([Con79373,Loc21515])
model = tf.keras.models.Model(inputs=[in0PRe85939,in0Glo93236,in0Con86499,in0Con79373,in0Dot44122,in1Dot44122], outputs=Max81631)
w = model.get_layer('PRe85939').get_weights() 
w[0] = np.array([[[0.1953]], [[0.8496]]])
model.get_layer('PRe85939').set_weights(w) 
w = model.get_layer('Loc21515').get_weights() 
w[0] = np.array([[[0.1021, 0.691], [0.1727, 0.679], [0.9386, 0.9732], [0.6888, 0.2469], [0.4808, 0.7614], [0.8428, 0.8566]], [[0.3205, 0.0589], [0.7898, 0.1178], [0.6354, 0.1907], [0.8091, 0.504], [0.652, 0.9518], [0.8882, 0.6086]]])
w[1] = np.array([[0, 0], [0, 0]])
model.get_layer('Loc21515').set_weights(w) 
in0PRe85939 = tf.constant([[[[0.3661]], [[0.9118]]]])
in0Glo93236 = tf.constant([[[[[1.7368], [1.2577]]]]])
in0Con86499 = tf.constant([[0.9064]])
in0Con79373 = tf.constant([[[0.6457], [0.5366]]])
in0Dot44122 = tf.constant([[[0.0126, 0.8189, 0.0459], [0.2463, 0.2157, 0.7392], [0.2383, 0.1882, 0.3287]]])
in1Dot44122 = tf.constant([[[0.0518, 0.989, 0.734], [0.9997, 0.9708, 0.2777], [0.967, 0.9962, 0.4154]]])
print (np.array2string(model.predict([in0PRe85939,in0Glo93236,in0Con86499,in0Con79373,in0Dot44122,in1Dot44122],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max81631.png')

LPRe85939 = prelu_layer([[[[0.3661]], [[0.9118]]]], [[[0.1953]], [[0.8496]]], PRe85939), 
LFla77608 = flatten_layer(PRe85939, Fla77608), 
LGlo93236 = global_average_pooling3D_layer([[[[[1.7368], [1.2577]]]]], Glo93236), 
LCon86499 = concatenate_layer([Glo93236,[[0.9064]]], 1, Con86499), 
LAve75370 = average_layer([Fla77608,Con86499], Ave75370), 
LELU3579 = elu_layer(Ave75370, -2.3039329192759617, ELU3579), 
LRes22011 = reshape_layer(ELU3579, [2, 1], Res22011), 
LCon79373 = concatenate_layer([Res22011,[[[0.6457], [0.5366]]]], 2, Con79373), 
LDot44122 = dot_layer([[[0.0126, 0.8189, 0.0459], [0.2463, 0.2157, 0.7392], [0.2383, 0.1882, 0.3287]]], [[[0.0518, 0.989, 0.734], [0.9997, 0.9708, 0.2777], [0.967, 0.9962, 0.4154]]], 2, 2, Dot44122), 
LLoc21515 = locally_connected1D_layer(Dot44122, 2,[[[0.1021, 0.691], [0.1727, 0.679], [0.9386, 0.9732], [0.6888, 0.2469], [0.4808, 0.7614], [0.8428, 0.8566]], [[0.3205, 0.0589], [0.7898, 0.1178], [0.6354, 0.1907], [0.8091, 0.504], [0.652, 0.9518], [0.8882, 0.6086]]],[[0, 0], [0, 0]], 1, Loc21515), 
LMax81631 = maximum_layer([Con79373,Loc21515], Max81631), 
exec_layers([LPRe85939,LFla77608,LGlo93236,LCon86499,LAve75370,LELU3579,LRes22011,LCon79373,LDot44122,LLoc21515,LMax81631],["PRe85939","Fla77608","Glo93236","Con86499","Ave75370","ELU3579","Res22011","Con79373","Dot44122","Loc21515","Max81631"],Max81631,"Max81631")

Actual (Unparsed): [[[2.5107388, 3.3088190], [2.4335446, 1.3146818]]]

Expected (Unparsed): [[[2.5107387939569996,3.3088189985199996],[2.433544547344,1.3146818114580001]]]

Actual:   [[[2.5108, 3.3089], [2.4336, 1.3147]]]

Expected: [[[2.5108, 3.3089], [2.4336, 1.3147]]]