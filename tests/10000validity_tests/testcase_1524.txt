import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot60547 = tf.keras.layers.Input(shape=([3]))
in1Dot60547 = tf.keras.layers.Input(shape=([3]))
in0Con25792 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Ave19812 = tf.keras.layers.Input(shape=([1, 2]))

Dot60547 = keras.layers.Dot(axes=(1, 1), name = 'Dot60547', )([in0Dot60547,in1Dot60547])
Res82540 = keras.layers.Reshape((1, 1), name = 'Res82540', )(Dot60547)
Res40457 = keras.layers.Reshape((1, 1, 1), name = 'Res40457', )(Res82540)
Con25792 = keras.layers.Concatenate(axis=3, name = 'Con25792', )([Res40457,in0Con25792])
Ave19812 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave19812', )(in0Ave19812)
Res62147 = keras.layers.Reshape((1, 2, 1), name = 'Res62147', )(Ave19812)
Loc8796 = keras.layers.LocallyConnected2D(2, (1, 2),strides=(1, 1), name = 'Loc8796', )(Res62147)
Max48748 = keras.layers.Maximum(name = 'Max48748', )([Con25792,Loc8796])
Res12979 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res12979', )(Max48748)
Glo19717 = keras.layers.GlobalAveragePooling3D(name = 'Glo19717', )(Res12979)
model = tf.keras.models.Model(inputs=[in0Dot60547,in1Dot60547,in0Con25792,in0Ave19812], outputs=Glo19717)
w = model.get_layer('Loc8796').get_weights() 
w[0] = np.array([[[0.8883, 0.8332], [0.946, 0.3648]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc8796').set_weights(w) 
in0Dot60547 = tf.constant([[0.4721, 1, 0.6234]])
in1Dot60547 = tf.constant([[0.6801, 0.0977, 0.6457]])
in0Con25792 = tf.constant([[[[0.9617]]]])
in0Ave19812 = tf.constant([[[1.8909, 1.9146]]])
print (np.array2string(model.predict([in0Dot60547,in1Dot60547,in0Con25792,in0Ave19812],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo19717.png')

LDot60547 = dot_layer([[0.4721, 1, 0.6234]], [[0.6801, 0.0977, 0.6457]], 1, 1, Dot60547), 
LRes82540 = reshape_layer(Dot60547, [1, 1], Res82540), 
LRes40457 = reshape_layer(Res82540, [1, 1, 1], Res40457), 
LCon25792 = concatenate_layer([Res40457,[[[[0.9617]]]]], 3, Con25792), 
LAve19812 = average_pooling1D_layer([[[1.8909, 1.9146]]], 1, Ave19812), 
LRes62147 = reshape_layer(Ave19812, [1, 2, 1], Res62147), 
LLoc8796 = locally_connected2D_layer(Res62147, 1, 2,[[[0.8883, 0.8332], [0.946, 0.3648]]],[[[0, 0]]], 1, 1, Loc8796), 
LMax48748 = maximum_layer([Con25792,Loc8796], Max48748), 
LRes12979 = reshape_layer(Max48748, [1, 1, 2, 1], Res12979), 
LGlo19717 = global_average_pooling3D_layer(Res12979, Glo19717), 
exec_layers([LDot60547,LRes82540,LRes40457,LCon25792,LAve19812,LRes62147,LLoc8796,LMax48748,LRes12979,LGlo19717],["Dot60547","Res82540","Res40457","Con25792","Ave19812","Res62147","Loc8796","Max48748","Res12979","Glo19717"],Glo19717,"Glo19717")

Actual (Unparsed): [[2.8824210]]

Expected (Unparsed): [[2.8824210150000003]]

Actual:   [[2.8825]]

Expected: [[2.8825]]