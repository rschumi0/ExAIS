import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Cro60031 = tf.keras.layers.Input(shape=([3, 1, 4]))
in0Add92489 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Add92489 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con32002 = tf.keras.layers.Input(shape=([3, 1, 2]))
in0Dot1647 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot1647 = tf.keras.layers.Input(shape=([3, 2]))
in0Con14019 = tf.keras.layers.Input(shape=([4, 2, 2]))

Cro60031 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro60031', )(in0Cro60031)
Sep69869 = keras.layers.SeparableConv2D(3, (1, 1),strides=(1, 1), padding='same', name = 'Sep69869', )(Cro60031)
Add92489 = keras.layers.Add(name = 'Add92489', )([in0Add92489,in1Add92489])
Zer72794 = keras.layers.ZeroPadding2D(padding=((2, 0), (0, 0)), name = 'Zer72794', )(Add92489)
Con32002 = keras.layers.Concatenate(axis=3, name = 'Con32002', )([Zer72794,in0Con32002])
Mul98249 = keras.layers.Multiply(name = 'Mul98249', )([Sep69869,Con32002])
Zer61217 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer61217', )(Mul98249)
Dot1647 = keras.layers.Dot(axes=(1, 1), name = 'Dot1647', )([in0Dot1647,in1Dot1647])
Res55599 = keras.layers.Reshape((2, 2, 1), name = 'Res55599', )(Dot1647)
Up_27184 = keras.layers.UpSampling2D(size=(2, 1), name = 'Up_27184', )(Res55599)
Con14019 = keras.layers.Concatenate(axis=3, name = 'Con14019', )([Up_27184,in0Con14019])
Min61801 = keras.layers.Minimum(name = 'Min61801', )([Zer61217,Con14019])
model = tf.keras.models.Model(inputs=[in0Cro60031,in0Add92489,in1Add92489,in0Con32002,in0Dot1647,in1Dot1647,in0Con14019], outputs=Min61801)
w = model.get_layer('Sep69869').get_weights() 
w[0] = np.array([[[[0.2621], [0.0918], [0.2188], [0.2138]]]])
w[1] = np.array([[[[0.841, 0.2065, 0.6734], [0.1305, 0.4653, 0.7561], [0.9399, 0.6427, 0.741], [0.2028, 0.5539, 0.7699]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep69869').set_weights(w) 
in0Cro60031 = tf.constant([[[[1.6238, 1.6918, 1.9784, 1.0237]], [[1.1733, 1.0676, 1.2443, 1.3862]], [[1.759, 1.6831, 1.3859, 1.049]]]])
in0Add92489 = tf.constant([[[[0.138]]]])
in1Add92489 = tf.constant([[[[0.8765]]]])
in0Con32002 = tf.constant([[[[0.6846, 0.6835]], [[0.2553, 0.6199]], [[0.609, 0.2282]]]])
in0Dot1647 = tf.constant([[[0.2882, 0.6004], [0.0418, 0.3492], [0.1274, 0.2539]]])
in1Dot1647 = tf.constant([[[0.2995, 0.5398], [0.1075, 0.2582], [0.2356, 0.1281]]])
in0Con14019 = tf.constant([[[[0.9353, 0.9034], [0.0228, 0.1266]], [[0.2204, 0.6975], [0.4115, 0.2031]], [[0.1573, 0.9356], [0.7046, 0.084]], [[0.5887, 0.8389], [0.2282, 0.9807]]]])
print (np.array2string(model.predict([in0Cro60031,in0Add92489,in1Add92489,in0Con32002,in0Dot1647,in1Dot1647,in0Con14019],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min61801.png')

LCro60031 = cropping2D_layer([[[[1.6238, 1.6918, 1.9784, 1.0237]], [[1.1733, 1.0676, 1.2443, 1.3862]], [[1.759, 1.6831, 1.3859, 1.049]]]], 0, 0, 0, 0, Cro60031), 
LSep69869 = separable_conv2D_layer(Cro60031, 1, 1,[[[[[0.2621], [0.0918], [0.2188], [0.2138]]]],[[[[0.841, 0.2065, 0.6734], [0.1305, 0.4653, 0.7561], [0.9399, 0.6427, 0.741], [0.2028, 0.5539, 0.7699]]]]],[0, 0, 0], 1, 1, true, Sep69869), 
LAdd92489 = add_layer([[[[[0.138]]]], [[[[0.8765]]]]], Add92489), 
LZer72794 = zero_padding2D_layer(Add92489, 2, 0, 0, 0, Zer72794), 
LCon32002 = concatenate_layer([Zer72794,[[[[0.6846, 0.6835]], [[0.2553, 0.6199]], [[0.609, 0.2282]]]]], 3, Con32002), 
LMul98249 = multiply_layer([Sep69869,Con32002], Mul98249), 
LZer61217 = zero_padding2D_layer(Mul98249, 1, 0, 1, 0, Zer61217), 
LDot1647 = dot_layer([[[0.2882, 0.6004], [0.0418, 0.3492], [0.1274, 0.2539]]], [[[0.2995, 0.5398], [0.1075, 0.2582], [0.2356, 0.1281]]], 1, 1, Dot1647), 
LRes55599 = reshape_layer(Dot1647, [2, 2, 1], Res55599), 
LUp_27184 = up_sampling2D_layer(Res55599, 2, 1, Up_27184), 
LCon14019 = concatenate_layer([Up_27184,[[[[0.9353, 0.9034], [0.0228, 0.1266]], [[0.2204, 0.6975], [0.4115, 0.2031]], [[0.1573, 0.9356], [0.7046, 0.084]], [[0.5887, 0.8389], [0.2282, 0.9807]]]]], 3, Con14019), 
LMin61801 = minimum_layer([Zer61217,Con14019], Min61801), 
exec_layers([LCro60031,LSep69869,LAdd92489,LZer72794,LCon32002,LMul98249,LZer61217,LDot1647,LRes55599,LUp_27184,LCon14019,LMin61801],["Cro60031","Sep69869","Add92489","Zer72794","Con32002","Mul98249","Zer61217","Dot1647","Res55599","Up_27184","Con14019","Min61801"],Min61801,"Min61801")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.3830946, 0.2031000]], [[0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.1144360, 0.0840000]], [[0.0000000, 0.0000000, 0.0000000], [0.4467839, 0.2282000, 0.1881855]]]]

Expected (Unparsed): [[[[0,0,0],[0,0,0]],[[0,0,0],[0.0,0.383094611983776,0.2031]],[[0,0,0],[0.0,0.11443600925155531,0.084]],[[0,0,0],[0.44678395,0.2282,0.18818546949268358]]]]

Actual:   [[[[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0.3831, 0.2031]], [[0, 0, 0], [0, 0.1145, 0.084]], [[0, 0, 0], [0.4468, 0.2282, 0.1882]]]]

Expected: [[[[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0.3831, 0.2031]], [[0, 0, 0], [0, 0.1145, 0.084]], [[0, 0, 0], [0.4468, 0.2282, 0.1882]]]]