import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mas33109 = tf.keras.layers.Input(shape=([4, 3]))

Mas33109 = keras.layers.Masking(mask_value=1, name = 'Mas33109', )(in0Mas33109)
Lea57624 = keras.layers.LeakyReLU(alpha=7.727324376277718, name = 'Lea57624', )(Mas33109)
Glo11228 = keras.layers.GlobalAveragePooling1D(name = 'Glo11228', )(Lea57624)
Res9030 = keras.layers.Reshape((3, 1), name = 'Res9030', )(Glo11228)
Cro10310 = keras.layers.Cropping1D(cropping=((0, 2)), name = 'Cro10310', )(Res9030)
LST13840 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST13840', )(Cro10310)
model = tf.keras.models.Model(inputs=[in0Mas33109], outputs=LST13840)
w = model.get_layer('LST13840').get_weights() 
w[0] = np.array([[6, 1, 8, 4, 1, 4, 1, 6, 6, 3, 5, 10]])
w[1] = np.array([[1, 2, 3, 10, 1, 5, 5, 1, 8, 7, 1, 5], [9, 5, 7, 4, 1, 5, 10, 9, 1, 5, 2, 6], [9, 5, 4, 5, 1, 10, 3, 2, 4, 3, 6, 1]])
w[2] = np.array([10, 10, 7, 3, 5, 1, 7, 10, 9, 1, 9, 10])
model.get_layer('LST13840').set_weights(w) 
in0Mas33109 = tf.constant([[[1.922, 1.6292, 1.9496], [1.6905, 1.2534, 1.8238], [1.501, 1.0151, 1.9648], [1.9959, 1.6575, 1.2473]]])
print (np.array2string(model.predict([in0Mas33109],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST13840.png')

LMas33109 = masking_layer([[[1.922, 1.6292, 1.9496], [1.6905, 1.2534, 1.8238], [1.501, 1.0151, 1.9648], [1.9959, 1.6575, 1.2473]]], 1, Mas33109), 
LLea57624 = leaky_relu_layer(Mas33109, 7.727324376277718, Lea57624), 
LGlo11228 = global_average_pooling1D_layer(Lea57624, Glo11228), 
LRes9030 = reshape_layer(Glo11228, [3, 1], Res9030), 
LCro10310 = cropping1D_layer(Res9030, 0, 2, Cro10310), 
LLST13840 = lstm_layer(Cro10310,[[6, 1, 8, 4, 1, 4, 1, 6, 6, 3, 5, 10]],[[1, 2, 3, 10, 1, 5, 5, 1, 8, 7, 1, 5], [9, 5, 7, 4, 1, 5, 10, 9, 1, 5, 2, 6], [9, 5, 4, 5, 1, 10, 3, 2, 4, 3, 6, 1]],[10, 10, 7, 3, 5, 1, 7, 10, 9, 1, 9, 10], LST13840), 
exec_layers([LMas33109,LLea57624,LGlo11228,LRes9030,LCro10310,LLST13840],["Mas33109","Lea57624","Glo11228","Res9030","Cro10310","LST13840"],LST13840,"LST13840")

Actual (Unparsed): [[0.7602421, 0.7615909, 0.7615942]]

Expected (Unparsed): [[0.7602421328367601,0.7615909190489332,0.7615941556992369]]

Actual:   [[0.7603, 0.7616, 0.7616]]

Expected: [[0.7603, 0.7616, 0.7616]]