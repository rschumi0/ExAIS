import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST30527 = tf.keras.layers.Input(shape=([3, 3]))
in0Add33644 = tf.keras.layers.Input(shape=([1, 1]))
in1Add33644 = tf.keras.layers.Input(shape=([1, 1]))

LST30527 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST30527', )(in0LST30527)
Res83964 = keras.layers.Reshape((1, 1), name = 'Res83964', )(LST30527)
Add33644 = keras.layers.Add(name = 'Add33644', )([in0Add33644,in1Add33644])
Ave54237 = keras.layers.Average(name = 'Ave54237', )([Res83964,Add33644])
model = tf.keras.models.Model(inputs=[in0LST30527,in0Add33644,in1Add33644], outputs=Ave54237)
w = model.get_layer('LST30527').get_weights() 
w[0] = np.array([[4, 10, 5, 4], [2, 9, 3, 3], [3, 1, 9, 4]])
w[1] = np.array([[4, 7, 5, 3]])
w[2] = np.array([2, 8, 9, 5])
model.get_layer('LST30527').set_weights(w) 
in0LST30527 = tf.constant([[[9, 6, 7], [5, 7, 1], [9, 5, 2]]])
in0Add33644 = tf.constant([[[0.4274]]])
in1Add33644 = tf.constant([[[0.1285]]])
print (np.array2string(model.predict([in0LST30527,in0Add33644,in1Add33644],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave54237.png')

LLST30527 = lstm_layer([[[9, 6, 7], [5, 7, 1], [9, 5, 2]]],[[4, 10, 5, 4], [2, 9, 3, 3], [3, 1, 9, 4]],[[4, 7, 5, 3]],[2, 8, 9, 5], LST30527), 
LRes83964 = reshape_layer(LST30527, [1, 1], Res83964), 
LAdd33644 = add_layer([[[[0.4274]]], [[[0.1285]]]], Add33644), 
LAve54237 = average_layer([Res83964,Add33644], Ave54237), 
exec_layers([LLST30527,LRes83964,LAdd33644,LAve54237],["LST30527","Res83964","Add33644","Ave54237"],Ave54237,"Ave54237")

Actual (Unparsed): [[[0.7754774]]]

Expected (Unparsed): [[[0.7754773768433653]]]

Actual:   [[[0.7755]]]

Expected: [[[0.7755]]]