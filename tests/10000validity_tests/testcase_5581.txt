import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo83987 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Max28475 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Max28475 = tf.keras.layers.Input(shape=([2, 1, 1]))

Glo83987 = keras.layers.GlobalAveragePooling2D(name = 'Glo83987', )(in0Glo83987)
Max28475 = keras.layers.Maximum(name = 'Max28475', )([in0Max28475,in1Max28475])
Res8105 = keras.layers.Reshape((2, 1), name = 'Res8105', )(Max28475)
Sim36971 = keras.layers.SimpleRNN(2,name = 'Sim36971', )(Res8105)
Max57846 = keras.layers.Maximum(name = 'Max57846', )([Glo83987,Sim36971])
Res15501 = keras.layers.Reshape((2, 1), name = 'Res15501', )(Max57846)
GRU80893 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU80893', )(Res15501)
model = tf.keras.models.Model(inputs=[in0Glo83987,in0Max28475,in1Max28475], outputs=GRU80893)
w = model.get_layer('Sim36971').get_weights() 
w[0] = np.array([[10, 1]])
w[1] = np.array([[2, 1], [7, 10]])
w[2] = np.array([3, 9])
model.get_layer('Sim36971').set_weights(w) 
w = model.get_layer('GRU80893').get_weights() 
w[0] = np.array([[5, 8, 10, 6, 10, 9, 3, 1, 10]])
w[1] = np.array([[7, 5, 5, 8, 2, 4, 4, 8, 2], [4, 8, 6, 5, 4, 4, 1, 1, 5], [8, 7, 3, 3, 2, 9, 6, 5, 6]])
w[2] = np.array([8, 2, 5, 10, 1, 6, 1, 2, 1])
model.get_layer('GRU80893').set_weights(w) 
in0Glo83987 = tf.constant([[[[1.0828, 1.7214], [1.865, 1.7955]], [[1.5242, 1.9872], [1.1865, 1.4634]]]])
in0Max28475 = tf.constant([[[[0.2171]], [[0.3293]]]])
in1Max28475 = tf.constant([[[[0.3128]], [[0.2069]]]])
print (np.array2string(model.predict([in0Glo83987,in0Max28475,in1Max28475],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU80893.png')

LGlo83987 = global_average_pooling2D_layer([[[[1.0828, 1.7214], [1.865, 1.7955]], [[1.5242, 1.9872], [1.1865, 1.4634]]]], Glo83987), 
LMax28475 = maximum_layer([[[[[0.2171]], [[0.3293]]]], [[[[0.3128]], [[0.2069]]]]], Max28475), 
LRes8105 = reshape_layer(Max28475, [2, 1], Res8105), 
LSim36971 = simple_rnn_layer(Res8105,[[10, 1]],[[2, 1], [7, 10]],[3, 9], Sim36971), 
LMax57846 = maximum_layer([Glo83987,Sim36971], Max57846), 
LRes15501 = reshape_layer(Max57846, [2, 1], Res15501), 
LGRU80893 = gru_layer(Res15501,[[5, 8, 10, 6, 10, 9, 3, 1, 10]],[[7, 5, 5, 8, 2, 4, 4, 8, 2], [4, 8, 6, 5, 4, 4, 1, 1, 5], [8, 7, 3, 3, 2, 9, 6, 5, 6]],[8, 2, 5, 10, 1, 6, 1, 2, 1], false, GRU80893), 
exec_layers([LGlo83987,LMax28475,LRes8105,LSim36971,LMax57846,LRes15501,LGRU80893],["Glo83987","Max28475","Res8105","Sim36971","Max57846","Res15501","GRU80893"],GRU80893,"GRU80893")

Actual (Unparsed): [[0.0000003, 0.0000018, 0.0000000]]

Expected (Unparsed): [[3.396765029505421e-7,1.7626631566074652e-6,5.023997661445577e-9]]

Actual:   [[0, 0, 0]]

Expected: [[0, 0, 0]]