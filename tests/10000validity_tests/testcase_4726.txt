import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min90421 = tf.keras.layers.Input(shape=([1, 1]))
in1Min90421 = tf.keras.layers.Input(shape=([1, 1]))
in0Con12218 = tf.keras.layers.Input(shape=([11]))
in0Sub87129 = tf.keras.layers.Input(shape=([3, 3]))
in1Sub87129 = tf.keras.layers.Input(shape=([3, 3]))
in0GRU83019 = tf.keras.layers.Input(shape=([3, 3]))
in0Con62940 = tf.keras.layers.Input(shape=([11]))
in0Ave95533 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Ave95533 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))

Min90421 = keras.layers.Minimum(name = 'Min90421', )([in0Min90421,in1Min90421])
Fla9741 = keras.layers.Flatten(name = 'Fla9741', )(Min90421)
Con12218 = keras.layers.Concatenate(axis=1, name = 'Con12218', )([Fla9741,in0Con12218])
Sub87129 = keras.layers.Subtract(name = 'Sub87129', )([in0Sub87129,in1Sub87129])
Res40275 = keras.layers.Reshape((3, 3, 1), name = 'Res40275', )(Sub87129)
Loc76855 = keras.layers.LocallyConnected2D(3, (2, 2),strides=(1, 1), name = 'Loc76855', )(Res40275)
Res77260 = keras.layers.Reshape((2, 6), name = 'Res77260', )(Loc76855)
Fla24680 = keras.layers.Flatten(name = 'Fla24680', )(Res77260)
GRU83019 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU83019', )(in0GRU83019)
Con62940 = keras.layers.Concatenate(axis=1, name = 'Con62940', )([GRU83019,in0Con62940])
Mul70155 = keras.layers.Multiply(name = 'Mul70155', )([Fla24680,Con62940])
Mul15674 = keras.layers.Multiply(name = 'Mul15674', )([Con12218,Mul70155])
Res56754 = keras.layers.Reshape((12, 1), name = 'Res56754', )(Mul15674)
Res18002 = keras.layers.Reshape((12, 1, 1), name = 'Res18002', )(Res56754)
Res53831 = keras.layers.Reshape((12, 1, 1, 1), name = 'Res53831', )(Res18002)
Ave95533 = keras.layers.Average(name = 'Ave95533', )([in0Ave95533,in1Ave95533])
Zer66162 = keras.layers.ZeroPadding3D(padding=((10, 0), (0, 0), (0, 0)), name = 'Zer66162', )(Ave95533)
Min93398 = keras.layers.Minimum(name = 'Min93398', )([Res53831,Zer66162])
model = tf.keras.models.Model(inputs=[in0Min90421,in1Min90421,in0Con12218,in0Sub87129,in1Sub87129,in0GRU83019,in0Con62940,in0Ave95533,in1Ave95533], outputs=Min93398)
w = model.get_layer('Loc76855').get_weights() 
w[0] = np.array([[[0.6288, 0.5486, 0.464], [0.539, 0.4555, 0.9623], [0.084, 0.1452, 0.7862], [0.8412, 0.5558, 0.2168]], [[0.8658, 0.1069, 0.1556], [0.6886, 0.7372, 0.815], [0.4538, 0.1162, 0.7219], [0.8788, 0.6081, 0.0162]], [[0.4406, 0.8031, 0.6954], [0.7388, 0.7825, 0.9962], [0.1176, 0.5719, 0.9025], [0.9708, 0.2409, 0.0976]], [[0.1476, 0.8849, 0.2036], [0.0392, 0.7982, 0.4309], [0.2649, 0.9731, 0.6454], [0.0358, 0.1571, 0.3115]]])
w[1] = np.array([[[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0, 0]]])
model.get_layer('Loc76855').set_weights(w) 
w = model.get_layer('GRU83019').get_weights() 
w[0] = np.array([[6, 10, 2], [5, 8, 8], [8, 7, 7]])
w[1] = np.array([[7, 8, 1]])
w[2] = np.array([[10, 4, 7], [7, 7, 10]])
model.get_layer('GRU83019').set_weights(w) 
in0Min90421 = tf.constant([[[0.4796]]])
in1Min90421 = tf.constant([[[0.4387]]])
in0Con12218 = tf.constant([[0.1003, 0.9406, 0.5568, 0.0255, 0.2458, 0.0698, 0.3165, 0.6497, 0.1283, 0.5331, 0.089]])
in0Sub87129 = tf.constant([[[0.7882, 0.8265, 0.714], [0.5398, 0.885, 0.592], [0.0237, 0.1433, 0.648]]])
in1Sub87129 = tf.constant([[[0.0084, 0.2992, 0.2281], [0.7416, 0.6157, 0.8183], [0.1739, 0.8493, 0.7812]]])
in0GRU83019 = tf.constant([[[6, 1, 10], [4, 5, 2], [6, 9, 7]]])
in0Con62940 = tf.constant([[0.8477, 0.202, 0.5989, 0.8778, 0.9719, 0.0798, 0.888, 0.3851, 0.782, 0.5855, 0.8427]])
in0Ave95533 = tf.constant([[[[[0.3978]]], [[[0.3522]]]]])
in1Ave95533 = tf.constant([[[[[0.4501]]], [[[0.5882]]]]])
print (np.array2string(model.predict([in0Min90421,in1Min90421,in0Con12218,in0Sub87129,in1Sub87129,in0GRU83019,in0Con62940,in0Ave95533,in1Ave95533],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min93398.png')

LMin90421 = minimum_layer([[[[0.4796]]], [[[0.4387]]]], Min90421), 
LFla9741 = flatten_layer(Min90421, Fla9741), 
LCon12218 = concatenate_layer([Fla9741,[[0.1003, 0.9406, 0.5568, 0.0255, 0.2458, 0.0698, 0.3165, 0.6497, 0.1283, 0.5331, 0.089]]], 1, Con12218), 
LSub87129 = subtract_layer([[[0.7882, 0.8265, 0.714], [0.5398, 0.885, 0.592], [0.0237, 0.1433, 0.648]]], [[[0.0084, 0.2992, 0.2281], [0.7416, 0.6157, 0.8183], [0.1739, 0.8493, 0.7812]]], Sub87129), 
LRes40275 = reshape_layer(Sub87129, [3, 3, 1], Res40275), 
LLoc76855 = locally_connected2D_layer(Res40275, 2, 2,[[[0.6288, 0.5486, 0.464], [0.539, 0.4555, 0.9623], [0.084, 0.1452, 0.7862], [0.8412, 0.5558, 0.2168]], [[0.8658, 0.1069, 0.1556], [0.6886, 0.7372, 0.815], [0.4538, 0.1162, 0.7219], [0.8788, 0.6081, 0.0162]], [[0.4406, 0.8031, 0.6954], [0.7388, 0.7825, 0.9962], [0.1176, 0.5719, 0.9025], [0.9708, 0.2409, 0.0976]], [[0.1476, 0.8849, 0.2036], [0.0392, 0.7982, 0.4309], [0.2649, 0.9731, 0.6454], [0.0358, 0.1571, 0.3115]]],[[[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0, 0]]], 1, 1, Loc76855), 
LRes77260 = reshape_layer(Loc76855, [2, 6], Res77260), 
LFla24680 = flatten_layer(Res77260, Fla24680), 
LGRU83019 = gru_layer([[[6, 1, 10], [4, 5, 2], [6, 9, 7]]],[[6, 10, 2], [5, 8, 8], [8, 7, 7]],[[7, 8, 1]],[[10, 4, 7], [7, 7, 10]], true, GRU83019), 
LCon62940 = concatenate_layer([GRU83019,[[0.8477, 0.202, 0.5989, 0.8778, 0.9719, 0.0798, 0.888, 0.3851, 0.782, 0.5855, 0.8427]]], 1, Con62940), 
LMul70155 = multiply_layer([Fla24680,Con62940], Mul70155), 
LMul15674 = multiply_layer([Con12218,Mul70155], Mul15674), 
LRes56754 = reshape_layer(Mul15674, [12, 1], Res56754), 
LRes18002 = reshape_layer(Res56754, [12, 1, 1], Res18002), 
LRes53831 = reshape_layer(Res18002, [12, 1, 1, 1], Res53831), 
LAve95533 = average_layer([[[[[[0.3978]]], [[[0.3522]]]]], [[[[[0.4501]]], [[[0.5882]]]]]], Ave95533), 
LZer66162 = zero_padding3D_layer(Ave95533, 10, 0, 0, 0, 0, 0, Zer66162), 
LMin93398 = minimum_layer([Res53831,Zer66162], Min93398), 
exec_layers([LMin90421,LFla9741,LCon12218,LSub87129,LRes40275,LLoc76855,LRes77260,LFla24680,LGRU83019,LCon62940,LMul70155,LMul15674,LRes56754,LRes18002,LRes53831,LAve95533,LZer66162,LMin93398],["Min90421","Fla9741","Con12218","Sub87129","Res40275","Loc76855","Res77260","Fla24680","GRU83019","Con62940","Mul70155","Mul15674","Res56754","Res18002","Res53831","Ave95533","Zer66162","Min93398"],Min93398,"Min93398")

Actual (Unparsed): [[[[[0.0000000]]], [[[0.0000000]]], [[[0.0000000]]], [[[0.0000000]]], [[[0.0000000]]], [[[0.0000000]]], [[[-0.0033030]]], [[[-0.0582658]]], [[[-0.0191443]]], [[[-0.0161442]]], [[[-0.2029668]]], [[[-0.0404872]]]]]

Expected (Unparsed): [[[[[0.0]]],[[[0]]],[[[0]]],[[[0]]],[[[0]]],[[[0]]],[[[-0.0033030479793024004]]],[[[-0.05826576419172003]]],[[[-0.01914430267843523]]],[[[-0.016144220925344007]]],[[[-0.20296675067647055]]],[[[-0.040487216198217005]]]]]

Actual:   [[[[[0]]], [[[0]]], [[[0]]], [[[0]]], [[[0]]], [[[0]]], [[[-0.0033]]], [[[-0.0582]]], [[[-0.0191]]], [[[-0.0161]]], [[[-0.2029]]], [[[-0.0404]]]]]

Expected: [[[[[0]]], [[[0]]], [[[0]]], [[[0]]], [[[0]]], [[[0]]], [[[-0.0033]]], [[[-0.0582]]], [[[-0.0191]]], [[[-0.0161]]], [[[-0.2029]]], [[[-0.0404]]]]]