import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Up_42941 = tf.keras.layers.Input(shape=([3, 2, 2]))
in0Zer35525 = tf.keras.layers.Input(shape=([4, 3]))
in0Con23751 = tf.keras.layers.Input(shape=([3, 5, 1]))

Up_42941 = keras.layers.UpSampling2D(size=(1, 2), name = 'Up_42941', )(in0Up_42941)
Loc66518 = keras.layers.LocallyConnected2D(2, (1, 2),strides=(1, 4), name = 'Loc66518', )(Up_42941)
Zer58261 = keras.layers.ZeroPadding2D(padding=((0, 0), (4, 0)), name = 'Zer58261', )(Loc66518)
Zer35525 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer35525', )(in0Zer35525)
Res1908 = keras.layers.Reshape((6, 3, 1), name = 'Res1908', )(Zer35525)
Ave10704 = keras.layers.AveragePooling2D(pool_size=(4, 1), name = 'Ave10704', )(Res1908)
Zer35039 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer35039', )(Ave10704)
Con23751 = keras.layers.Concatenate(axis=3, name = 'Con23751', )([Zer35039,in0Con23751])
Mul74878 = keras.layers.Multiply(name = 'Mul74878', )([Zer58261,Con23751])
Res8775 = keras.layers.Reshape((3, 10), name = 'Res8775', )(Mul74878)
Glo74683 = keras.layers.GlobalMaxPool1D(name = 'Glo74683', )(Res8775)
model = tf.keras.models.Model(inputs=[in0Up_42941,in0Zer35525,in0Con23751], outputs=Glo74683)
w = model.get_layer('Loc66518').get_weights() 
w[0] = np.array([[[0.393, 0.6837], [0.0545, 0.7156], [0.8982, 0.4059], [0.6969, 0.3657]], [[0.2223, 0.4253], [0.2603, 0.0857], [0.826, 0.0787], [0.8195, 0.5685]], [[0.6674, 0.5205], [0.2884, 0.4892], [0.1817, 0.0077], [0.3913, 0.6292]]])
w[1] = np.array([[[0, 0]], [[0, 0]], [[0, 0]]])
model.get_layer('Loc66518').set_weights(w) 
in0Up_42941 = tf.constant([[[[1.6922, 1.2576], [1.2701, 1.6489]], [[1.4871, 1.8014], [1.8133, 1.2526]], [[1.0228, 1.8953], [1.3133, 1.3157]]]])
in0Zer35525 = tf.constant([[[1.1487, 1.8963, 1.2963], [1.7081, 1.7971, 1.7226], [1.7852, 1.2764, 1.5676], [1.8485, 1.7942, 1.2557]]])
in0Con23751 = tf.constant([[[[0.3925], [0.8377], [0.43], [0.6639], [0.4891]], [[0.0038], [0.2742], [0.5092], [0.1978], [0.5627]], [[0.7898], [0.9078], [0.8723], [0.3785], [0.5762]]]])
print (np.array2string(model.predict([in0Up_42941,in0Zer35525,in0Con23751],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo74683.png')

LUp_42941 = up_sampling2D_layer([[[[1.6922, 1.2576], [1.2701, 1.6489]], [[1.4871, 1.8014], [1.8133, 1.2526]], [[1.0228, 1.8953], [1.3133, 1.3157]]]], 1, 2, Up_42941), 
LLoc66518 = locally_connected2D_layer(Up_42941, 1, 2,[[[0.393, 0.6837], [0.0545, 0.7156], [0.8982, 0.4059], [0.6969, 0.3657]], [[0.2223, 0.4253], [0.2603, 0.0857], [0.826, 0.0787], [0.8195, 0.5685]], [[0.6674, 0.5205], [0.2884, 0.4892], [0.1817, 0.0077], [0.3913, 0.6292]]],[[[0, 0]], [[0, 0]], [[0, 0]]], 1, 4, Loc66518), 
LZer58261 = zero_padding2D_layer(Loc66518, 0, 0, 4, 0, Zer58261), 
LZer35525 = zero_padding1D_layer([[[1.1487, 1.8963, 1.2963], [1.7081, 1.7971, 1.7226], [1.7852, 1.2764, 1.5676], [1.8485, 1.7942, 1.2557]]], 1, 1, Zer35525), 
LRes1908 = reshape_layer(Zer35525, [6, 3, 1], Res1908), 
LAve10704 = average_pooling2D_layer(Res1908, 4, 1, Ave10704), 
LZer35039 = zero_padding2D_layer(Ave10704, 2, 0, 2, 0, Zer35039), 
LCon23751 = concatenate_layer([Zer35039,[[[[0.3925], [0.8377], [0.43], [0.6639], [0.4891]], [[0.0038], [0.2742], [0.5092], [0.1978], [0.5627]], [[0.7898], [0.9078], [0.8723], [0.3785], [0.5762]]]]], 3, Con23751), 
LMul74878 = multiply_layer([Zer58261,Con23751], Mul74878), 
LRes8775 = reshape_layer(Mul74878, [3, 10], Res8775), 
LGlo74683 = global_max_pool1D_layer(Res8775, Glo74683), 
exec_layers([LUp_42941,LLoc66518,LZer58261,LZer35525,LRes1908,LAve10704,LZer35039,LCon23751,LMul74878,LRes8775,LGlo74683],["Up_42941","Loc66518","Zer58261","Zer35525","Res1908","Ave10704","Zer35039","Con23751","Mul74878","Res8775","Glo74683"],Glo74683,"Glo74683")

Actual (Unparsed): [[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 2.4729203, 1.5669120]]

Expected (Unparsed): [[0,0.0,0,0.0,0.0,0.0,0.0,0.0,2.47292027824625,1.5669120624000001]]

Actual:   [[0, 0, 0, 0, 0, 0, 0, 0, 2.473, 1.567]]

Expected: [[0, 0, 0, 0, 0, 0, 0, 0, 2.473, 1.567]]