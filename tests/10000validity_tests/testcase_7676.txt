import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub1131 = tf.keras.layers.Input(shape=([2, 2, 3, 2]))
in1Sub1131 = tf.keras.layers.Input(shape=([2, 2, 3, 2]))
in0Max78051 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Max78051 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Dot27622 = tf.keras.layers.Input(shape=([3]))
in1Dot27622 = tf.keras.layers.Input(shape=([3]))
in0Max22602 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Max22602 = tf.keras.layers.Input(shape=([2, 1, 1]))

Sub1131 = keras.layers.Subtract(name = 'Sub1131', )([in0Sub1131,in1Sub1131])
Res71076 = keras.layers.Reshape((2, 2, 6), name = 'Res71076', )(Sub1131)
Res35304 = keras.layers.Reshape((2, 12), name = 'Res35304', )(Res71076)
Per16084 = keras.layers.Permute((2,1), name = 'Per16084',)(Res35304)
Res16884 = keras.layers.Reshape((12, 2, 1), name = 'Res16884', )(Per16084)
Max78051 = keras.layers.Maximum(name = 'Max78051', )([in0Max78051,in1Max78051])
Zer41625 = keras.layers.ZeroPadding2D(padding=((10, 0), (1, 0)), name = 'Zer41625', )(Max78051)
Mul32307 = keras.layers.Multiply(name = 'Mul32307', )([Res16884,Zer41625])
Dot27622 = keras.layers.Dot(axes=(1, 1), name = 'Dot27622', )([in0Dot27622,in1Dot27622])
Res29529 = keras.layers.Reshape((1, 1), name = 'Res29529', )(Dot27622)
Res15081 = keras.layers.Reshape((1, 1, 1), name = 'Res15081', )(Res29529)
Zer53718 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer53718', )(Res15081)
Max22602 = keras.layers.Maximum(name = 'Max22602', )([in0Max22602,in1Max22602])
Add25250 = keras.layers.Add(name = 'Add25250', )([Zer53718,Max22602])
Zer50278 = keras.layers.ZeroPadding2D(padding=((10, 0), (1, 0)), name = 'Zer50278', )(Add25250)
Ave99937 = keras.layers.Average(name = 'Ave99937', )([Mul32307,Zer50278])
model = tf.keras.models.Model(inputs=[in0Sub1131,in1Sub1131,in0Max78051,in1Max78051,in0Dot27622,in1Dot27622,in0Max22602,in1Max22602], outputs=Ave99937)
in0Sub1131 = tf.constant([[[[[0.1209, 0.311], [0.4395, 0.7485], [0.0587, 0.2147]], [[0.0589, 0.3979], [0.8786, 0.9237], [0.5718, 0.9244]]], [[[0.9774, 0.7253], [0.4853, 0.2569], [0.6187, 0.1533]], [[0.8462, 0.2393], [0.5928, 0.8354], [0.9175, 0.1653]]]]])
in1Sub1131 = tf.constant([[[[[0.4945, 0.0063], [0.4979, 0.506], [0.5019, 0.9584]], [[0.2158, 0.9788], [0.5737, 0.4039], [0.5659, 0.8279]]], [[[0.0588, 0.7073], [0.4114, 0.6873], [0.8115, 0.2161]], [[0.1748, 0.6773], [0.0406, 0.4626], [0.9592, 0.4518]]]]])
in0Max78051 = tf.constant([[[[0.2855]], [[0.8413]]]])
in1Max78051 = tf.constant([[[[0.401]], [[0.7575]]]])
in0Dot27622 = tf.constant([[0.1092, 0.474, 0.1406]])
in1Dot27622 = tf.constant([[0.69, 0.3237, 0.3696]])
in0Max22602 = tf.constant([[[[0.4153]], [[0.2436]]]])
in1Max22602 = tf.constant([[[[0.8248]], [[0.6553]]]])
print (np.array2string(model.predict([in0Sub1131,in1Sub1131,in0Max78051,in1Max78051,in0Dot27622,in1Dot27622,in0Max22602,in1Max22602],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave99937.png')

LSub1131 = subtract_layer([[[[[0.1209, 0.311], [0.4395, 0.7485], [0.0587, 0.2147]], [[0.0589, 0.3979], [0.8786, 0.9237], [0.5718, 0.9244]]], [[[0.9774, 0.7253], [0.4853, 0.2569], [0.6187, 0.1533]], [[0.8462, 0.2393], [0.5928, 0.8354], [0.9175, 0.1653]]]]], [[[[[0.4945, 0.0063], [0.4979, 0.506], [0.5019, 0.9584]], [[0.2158, 0.9788], [0.5737, 0.4039], [0.5659, 0.8279]]], [[[0.0588, 0.7073], [0.4114, 0.6873], [0.8115, 0.2161]], [[0.1748, 0.6773], [0.0406, 0.4626], [0.9592, 0.4518]]]]], Sub1131), 
LRes71076 = reshape_layer(Sub1131, [2, 2, 6], Res71076), 
LRes35304 = reshape_layer(Res71076, [2, 12], Res35304), 
LPer16084 = permute_layer(Res35304, 2,1, Per16084), 
LRes16884 = reshape_layer(Per16084, [12, 2, 1], Res16884), 
LMax78051 = maximum_layer([[[[[0.2855]], [[0.8413]]]], [[[[0.401]], [[0.7575]]]]], Max78051), 
LZer41625 = zero_padding2D_layer(Max78051, 10, 0, 1, 0, Zer41625), 
LMul32307 = multiply_layer([Res16884,Zer41625], Mul32307), 
LDot27622 = dot_layer([[0.1092, 0.474, 0.1406]], [[0.69, 0.3237, 0.3696]], 1, 1, Dot27622), 
LRes29529 = reshape_layer(Dot27622, [1, 1], Res29529), 
LRes15081 = reshape_layer(Res29529, [1, 1, 1], Res15081), 
LZer53718 = zero_padding2D_layer(Res15081, 1, 0, 0, 0, Zer53718), 
LMax22602 = maximum_layer([[[[[0.4153]], [[0.2436]]]], [[[[0.8248]], [[0.6553]]]]], Max22602), 
LAdd25250 = add_layer([Zer53718,Max22602], Add25250), 
LZer50278 = zero_padding2D_layer(Add25250, 10, 0, 1, 0, Zer50278), 
LAve99937 = average_layer([Mul32307,Zer50278], Ave99937), 
exec_layers([LSub1131,LRes71076,LRes35304,LPer16084,LRes16884,LMax78051,LZer41625,LMul32307,LDot27622,LRes29529,LRes15081,LZer53718,LMax22602,LAdd25250,LZer50278,LAve99937],["Sub1131","Res71076","Res35304","Per16084","Res16884","Max78051","Zer41625","Mul32307","Dot27622","Res29529","Res15081","Zer53718","Max22602","Add25250","Zer50278","Ave99937"],Ave99937,"Ave99937")

Actual (Unparsed): [[[[0.0000000], [0.0000000]], [[0.0000000], [0.0000000]], [[0.0000000], [0.0000000]], [[0.0000000], [0.0000000]], [[0.0000000], [0.0000000]], [[0.0000000], [0.0000000]], [[0.0000000], [0.0000000]], [[0.0000000], [0.0000000]], [[0.0000000], [0.0000000]], [[0.0000000], [0.0000000]], [[0.0000000], [0.4040392]], [[0.0000000], [0.3475076]]]]

Expected (Unparsed): [[[[0.0],[0.0]],[[0.0],[0.0]],[[0.0],[0.0]],[[0.0],[0.0]],[[0.0],[0.0]],[[0.0],[0.0]],[[0.0],[0.0]],[[0.0],[0.0]],[[0.0],[0.0]],[[0.0],[0.0]],[[0.0],[0.40403914999999996]],[[0.0],[0.347507555]]]]

Actual:   [[[[0], [0]], [[0], [0]], [[0], [0]], [[0], [0]], [[0], [0]], [[0], [0]], [[0], [0]], [[0], [0]], [[0], [0]], [[0], [0]], [[0], [0.4041]], [[0], [0.3476]]]]

Expected: [[[[0], [0]], [[0], [0]], [[0], [0]], [[0], [0]], [[0], [0]], [[0], [0]], [[0], [0]], [[0], [0]], [[0], [0]], [[0], [0]], [[0], [0.4041]], [[0], [0.3476]]]]