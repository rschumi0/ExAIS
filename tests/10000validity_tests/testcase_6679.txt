import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave83406 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Ave83406 = tf.keras.layers.Input(shape=([2, 1, 2]))

Ave83406 = keras.layers.Average(name = 'Ave83406', )([in0Ave83406,in1Ave83406])
Res31546 = keras.layers.Reshape((2, 2), name = 'Res31546', )(Ave83406)
Sep52194 = keras.layers.SeparableConv1D(4, (2),strides=(1), padding='same', name = 'Sep52194', )(Res31546)
Fla46273 = keras.layers.Flatten(name = 'Fla46273', )(Sep52194)
Res16408 = keras.layers.Reshape((8, 1), name = 'Res16408', )(Fla46273)
Res92302 = keras.layers.Reshape((8, 1, 1), name = 'Res92302', )(Res16408)
Res42514 = keras.layers.Reshape((8, 1, 1, 1), name = 'Res42514', )(Res92302)
Con82389 = keras.layers.Conv3DTranspose(3, (8, 1, 1),strides=(1, 1, 5), padding='valid', name = 'Con82389', )(Res42514)
model = tf.keras.models.Model(inputs=[in0Ave83406,in1Ave83406], outputs=Con82389)
w = model.get_layer('Sep52194').get_weights() 
w[0] = np.array([[[0.0125], [0.2343]], [[0.6865], [0.9686]]])
w[1] = np.array([[[0.9497, 0.3483, 0.4839, 0.5729], [0.1144, 0.0336, 0.0735, 0.0997]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep52194').set_weights(w) 
w = model.get_layer('Con82389').get_weights() 
w[0] = np.array([[[[[0.3618], [0.2537], [0.813]]]], [[[[0.2006], [0.2731], [0.0705]]]], [[[[0.0447], [0.1154], [0.3496]]]], [[[[0.7882], [0.4182], [0.171]]]], [[[[0.3935], [0.7543], [0.482]]]], [[[[0.7967], [0.0174], [0.0187]]]], [[[[0.6002], [0.8817], [0.4668]]]], [[[[0.9171], [0.0585], [0.0244]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con82389').set_weights(w) 
in0Ave83406 = tf.constant([[[[0.5727, 0.129]], [[0.9524, 0.6558]]]])
in1Ave83406 = tf.constant([[[[0.9847, 0.7129]], [[0.902, 0.4771]]]])
print (np.array2string(model.predict([in0Ave83406,in1Ave83406],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con82389.png')

LAve83406 = average_layer([[[[[0.5727, 0.129]], [[0.9524, 0.6558]]]], [[[[0.9847, 0.7129]], [[0.902, 0.4771]]]]], Ave83406), 
LRes31546 = reshape_layer(Ave83406, [2, 2], Res31546), 
LSep52194 = separable_conv1D_layer(Res31546, 2,[[[[0.0125], [0.2343]], [[0.6865], [0.9686]]],[[[0.9497, 0.3483, 0.4839, 0.5729], [0.1144, 0.0336, 0.0735, 0.0997]]]],[0, 0, 0, 0], 1, true, Sep52194), 
LFla46273 = flatten_layer(Sep52194, Fla46273), 
LRes16408 = reshape_layer(Fla46273, [8, 1], Res16408), 
LRes92302 = reshape_layer(Res16408, [8, 1, 1], Res92302), 
LRes42514 = reshape_layer(Res92302, [8, 1, 1, 1], Res42514), 
LCon82389 = conv3D_transpose_layer(Res42514, 8, 1, 1,[[[[[0.3618], [0.2537], [0.813]]]], [[[[0.2006], [0.2731], [0.0705]]]], [[[[0.0447], [0.1154], [0.3496]]]], [[[[0.7882], [0.4182], [0.171]]]], [[[[0.3935], [0.7543], [0.482]]]], [[[[0.7967], [0.0174], [0.0187]]]], [[[[0.6002], [0.8817], [0.4668]]]], [[[[0.9171], [0.0585], [0.0244]]]]],[0, 0, 0], 1, 1, 5, false, Con82389), 
exec_layers([LAve83406,LRes31546,LSep52194,LFla46273,LRes16408,LRes92302,LRes42514,LCon82389],["Ave83406","Res31546","Sep52194","Fla46273","Res16408","Res92302","Res42514","Con82389"],Con82389,"Con82389")

Actual (Unparsed): [[[[[0.2488461, 0.1744949, 0.5591815], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]]], [[[0.2272795, 0.2504616, 0.2491710], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]]], [[[0.2106172, 0.2381922, 0.5507806], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]]], [[[0.7827356, 0.5248237, 0.5827827], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]]], [[[0.5780057, 0.7889963, 0.5516342], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]]], [[[0.9568521, 0.4083176, 0.3542013], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]]], [[[1.1023765, 1.0735656, 0.5959373], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]]], [[[1.2683640, 0.6132660, 0.3729945], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]]], [[[0.8106900, 0.3701896, 0.2031895], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]]], [[[0.6285894, 0.4200015, 0.2259037], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]]], [[[0.4429293, 0.0685730, 0.0337961], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]]], [[[0.0491779, 0.0242800, 0.0144707], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]]], [[[0.0328449, 0.0143886, 0.0077505], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]]], [[[0.0260168, 0.0184199, 0.0096511], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]]], [[[0.0182246, 0.0011625, 0.0004849], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]]]]]

Expected (Unparsed): [[[[[0.24884606048764862,0.1744948743662699,0.559181446037751],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],[[[0.22727946465299964,0.2504615464449118,0.24917096172497255],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],[[[0.2106171634460322,0.23819216263749488,0.5507806338480532],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],[[[0.7827355800779564,0.5248236533806433,0.5827826448491411],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],[[[0.5780056556907508,0.7889962948158193,0.5516342246719033],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],[[[0.9568520928366161,0.40831759061758277,0.354201300306047],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],[[[1.1023764381899803,1.0735656204702264,0.5959373082648222],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],[[[1.268364025135922,0.6132659701847577,0.37299448166170085],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],[[[0.8106899896446604,0.3701895798933864,0.20318946005729988],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],[[[0.6285893736995438,0.42000149953863036,0.2259037442887723],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],[[[0.442929278361213,0.0685729969634091,0.0337961470302913],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],[[[0.04917789352974461,0.02427997276660055,0.014470653630447151],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],[[[0.03284490019700875,0.014388589228622552,0.007750485130467051],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],[[[0.026016835764305652,0.018419909902991402,0.0096511220033796],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],[[[0.01822462837682445,0.00116251309567575,0.00048487725699980006],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]]]]

Actual:   [[[[[0.2489, 0.1745, 0.5592], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.2273, 0.2505, 0.2492], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.2107, 0.2382, 0.5508], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.7828, 0.5249, 0.5828], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.5781, 0.789, 0.5517], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.9569, 0.4084, 0.3543], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[1.1024, 1.0736, 0.596], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[1.2684, 0.6133, 0.373], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.8107, 0.3702, 0.2032], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.6286, 0.4201, 0.226], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.443, 0.0686, 0.0338], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.0492, 0.0243, 0.0145], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.0329, 0.0144, 0.0078], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.0261, 0.0185, 0.0097], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.0183, 0.0012, 0.0005], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]]]]

Expected: [[[[[0.2489, 0.1745, 0.5592], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.2273, 0.2505, 0.2492], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.2107, 0.2382, 0.5508], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.7828, 0.5249, 0.5828], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.5781, 0.789, 0.5517], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.9569, 0.4084, 0.3543], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[1.1024, 1.0736, 0.596], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[1.2684, 0.6133, 0.373], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.8107, 0.3702, 0.2032], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.6286, 0.4201, 0.226], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.443, 0.0686, 0.0338], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.0492, 0.0243, 0.0145], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.0329, 0.0144, 0.0078], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.0261, 0.0185, 0.0097], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]], [[[0.0183, 0.0012, 0.0005], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]]]]