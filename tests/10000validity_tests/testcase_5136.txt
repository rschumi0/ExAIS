import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max52767 = tf.keras.layers.Input(shape=([1, 2]))
in0Min14531 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Min14531 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0ELU40495 = tf.keras.layers.Input(shape=([1, 1]))
in0Con31081 = tf.keras.layers.Input(shape=([2, 1]))
in0Add17058 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Add17058 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con70683 = tf.keras.layers.Input(shape=([4, 1]))

Max52767 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max52767', )(in0Max52767)
Res32250 = keras.layers.Reshape((1, 2, 1), name = 'Res32250', )(Max52767)
Res70784 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res70784', )(Res32250)
Zer80897 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (0, 0)), name = 'Zer80897', )(Res70784)
Min14531 = keras.layers.Minimum(name = 'Min14531', )([in0Min14531,in1Min14531])
Min58397 = keras.layers.Minimum(name = 'Min58397', )([Zer80897,Min14531])
Res69594 = keras.layers.Reshape((2, 2, 1), name = 'Res69594', )(Min58397)
Res89372 = keras.layers.Reshape((2, 2), name = 'Res89372', )(Res69594)
ELU40495 = keras.layers.ELU(alpha=0.21716903255125608, name = 'ELU40495', input_shape=(1, 1))(in0ELU40495)
Zer79044 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer79044', )(ELU40495)
Con31081 = keras.layers.Concatenate(axis=2, name = 'Con31081', )([Zer79044,in0Con31081])
Mul64604 = keras.layers.Multiply(name = 'Mul64604', )([Res89372,Con31081])
Zer20297 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer20297', )(Mul64604)
Add17058 = keras.layers.Add(name = 'Add17058', )([in0Add17058,in1Add17058])
Res97001 = keras.layers.Reshape((2, 1), name = 'Res97001', )(Add17058)
Sim65768 = keras.layers.SimpleRNN(2,name = 'Sim65768', )(Res97001)
Res83533 = keras.layers.Reshape((2, 1), name = 'Res83533', )(Sim65768)
Up_15748 = keras.layers.UpSampling1D(size=(2), name = 'Up_15748', )(Res83533)
Con70683 = keras.layers.Concatenate(axis=2, name = 'Con70683', )([Up_15748,in0Con70683])
Min18738 = keras.layers.Minimum(name = 'Min18738', )([Zer20297,Con70683])
Res99546 = keras.layers.Reshape((4, 2, 1), name = 'Res99546', )(Min18738)
Loc33742 = keras.layers.LocallyConnected2D(3, (2, 1),strides=(1, 1), name = 'Loc33742', )(Res99546)
model = tf.keras.models.Model(inputs=[in0Max52767,in0Min14531,in1Min14531,in0ELU40495,in0Con31081,in0Add17058,in1Add17058,in0Con70683], outputs=Loc33742)
w = model.get_layer('Sim65768').get_weights() 
w[0] = np.array([[1, 9]])
w[1] = np.array([[2, 8], [1, 3]])
w[2] = np.array([10, 2])
model.get_layer('Sim65768').set_weights(w) 
w = model.get_layer('Loc33742').get_weights() 
w[0] = np.array([[[0.8698, 0.4311, 0.6396], [0.6913, 0.0703, 0.638]], [[0.8934, 0.2482, 0.1819], [0.1012, 0.9071, 0.5894]], [[0.2321, 0.7153, 0.8495], [0.0296, 0.019, 0.8025]], [[0.3719, 0.0493, 0.0551], [0.2011, 0.4763, 0.8851]], [[0.2202, 0.7618, 0.6268], [0.6712, 0.905, 0.4373]], [[0.3916, 0.7305, 0.9133], [0.0209, 0.9696, 0.1938]]])
w[1] = np.array([[[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0, 0]]])
model.get_layer('Loc33742').set_weights(w) 
in0Max52767 = tf.constant([[[1.1433, 1.5291]]])
in0Min14531 = tf.constant([[[[[0.6581]], [[0.5754]]], [[[0.0182]], [[0.6986]]]]])
in1Min14531 = tf.constant([[[[[0.1706]], [[0.7546]]], [[[0.3583]], [[0.2334]]]]])
in0ELU40495 = tf.constant([[[0.5967]]])
in0Con31081 = tf.constant([[[0.5983], [0.445]]])
in0Add17058 = tf.constant([[[[0.5517]], [[0.9316]]]])
in1Add17058 = tf.constant([[[[0.0453]], [[0.001]]]])
in0Con70683 = tf.constant([[[0.6622], [0.8804], [0.4584], [0.6724]]])
print (np.array2string(model.predict([in0Max52767,in0Min14531,in1Min14531,in0ELU40495,in0Con31081,in0Add17058,in1Add17058,in0Con70683],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc33742.png')

LMax52767 = max_pool1D_layer([[[1.1433, 1.5291]]], 1, Max52767), 
LRes32250 = reshape_layer(Max52767, [1, 2, 1], Res32250), 
LRes70784 = reshape_layer(Res32250, [1, 2, 1, 1], Res70784), 
LZer80897 = zero_padding3D_layer(Res70784, 1, 0, 0, 0, 0, 0, Zer80897), 
LMin14531 = minimum_layer([[[[[[0.6581]], [[0.5754]]], [[[0.0182]], [[0.6986]]]]], [[[[[0.1706]], [[0.7546]]], [[[0.3583]], [[0.2334]]]]]], Min14531), 
LMin58397 = minimum_layer([Zer80897,Min14531], Min58397), 
LRes69594 = reshape_layer(Min58397, [2, 2, 1], Res69594), 
LRes89372 = reshape_layer(Res69594, [2, 2], Res89372), 
LELU40495 = elu_layer([[[0.5967]]], 0.21716903255125608, ELU40495), 
LZer79044 = zero_padding1D_layer(ELU40495, 1, 0, Zer79044), 
LCon31081 = concatenate_layer([Zer79044,[[[0.5983], [0.445]]]], 2, Con31081), 
LMul64604 = multiply_layer([Res89372,Con31081], Mul64604), 
LZer20297 = zero_padding1D_layer(Mul64604, 2, 0, Zer20297), 
LAdd17058 = add_layer([[[[[0.5517]], [[0.9316]]]], [[[[0.0453]], [[0.001]]]]], Add17058), 
LRes97001 = reshape_layer(Add17058, [2, 1], Res97001), 
LSim65768 = simple_rnn_layer(Res97001,[[1, 9]],[[2, 8], [1, 3]],[10, 2], Sim65768), 
LRes83533 = reshape_layer(Sim65768, [2, 1], Res83533), 
LUp_15748 = up_sampling1D_layer(Res83533, 2, Up_15748), 
LCon70683 = concatenate_layer([Up_15748,[[[0.6622], [0.8804], [0.4584], [0.6724]]]], 2, Con70683), 
LMin18738 = minimum_layer([Zer20297,Con70683], Min18738), 
LRes99546 = reshape_layer(Min18738, [4, 2, 1], Res99546), 
LLoc33742 = locally_connected2D_layer(Res99546, 2, 1,[[[0.8698, 0.4311, 0.6396], [0.6913, 0.0703, 0.638]], [[0.8934, 0.2482, 0.1819], [0.1012, 0.9071, 0.5894]], [[0.2321, 0.7153, 0.8495], [0.0296, 0.019, 0.8025]], [[0.3719, 0.0493, 0.0551], [0.2011, 0.4763, 0.8851]], [[0.2202, 0.7618, 0.6268], [0.6712, 0.905, 0.4373]], [[0.3916, 0.7305, 0.9133], [0.0209, 0.9696, 0.1938]]],[[[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0, 0]]], 1, 1, Loc33742), 
exec_layers([LMax52767,LRes32250,LRes70784,LZer80897,LMin14531,LMin58397,LRes69594,LRes89372,LELU40495,LZer79044,LCon31081,LMul64604,LZer20297,LAdd17058,LRes97001,LSim65768,LRes83533,LUp_15748,LCon70683,LMin18738,LRes99546,LLoc33742],["Max52767","Res32250","Res70784","Zer80897","Min14531","Min58397","Res69594","Res89372","ELU40495","Zer79044","Con31081","Mul64604","Zer20297","Add17058","Res97001","Sim65768","Res83533","Up_15748","Con70683","Min18738","Res99546","Loc33742"],Loc33742,"Loc33742")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]], [[0.0072892, 0.0098282, 0.0047491], [0.0021707, 0.1007056, 0.0201286]]]]

Expected (Unparsed): [[[[0.0,0.0,0.0],[0.0,0.0,0.0]],[[0.0,0.0,0.0],[0.0,0.0,0.0]],[[0.007289191728,0.0098282457,0.004749051762],[0.0021707366999999997,0.1007055648,0.0201286494]]]]

Actual:   [[[[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0, 0]], [[0.0073, 0.0099, 0.0048], [0.0022, 0.1008, 0.0202]]]]

Expected: [[[[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0, 0]], [[0.0073, 0.0099, 0.0048], [0.0022, 0.1008, 0.0202]]]]