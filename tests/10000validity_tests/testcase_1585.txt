import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot98207 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot98207 = tf.keras.layers.Input(shape=([2, 2]))
in0Mul28217 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul28217 = tf.keras.layers.Input(shape=([1, 1]))
in0Con48886 = tf.keras.layers.Input(shape=([1]))
in0GRU49934 = tf.keras.layers.Input(shape=([1, 3]))
in0Con99247 = tf.keras.layers.Input(shape=([3]))

Dot98207 = keras.layers.Dot(axes=(1, 1), name = 'Dot98207', )([in0Dot98207,in1Dot98207])
Fla14678 = keras.layers.Flatten(name = 'Fla14678', )(Dot98207)
Mul28217 = keras.layers.Multiply(name = 'Mul28217', )([in0Mul28217,in1Mul28217])
Fla8817 = keras.layers.Flatten(name = 'Fla8817', )(Mul28217)
Con48886 = keras.layers.Concatenate(axis=1, name = 'Con48886', )([Fla8817,in0Con48886])
GRU49934 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU49934', )(in0GRU49934)
Add62670 = keras.layers.Add(name = 'Add62670', )([Con48886,GRU49934])
Res37069 = keras.layers.Reshape((2, 1), name = 'Res37069', )(Add62670)
Res2572 = keras.layers.Reshape((2, 1, 1), name = 'Res2572', )(Res37069)
Glo97299 = keras.layers.GlobalMaxPool2D(name = 'Glo97299', )(Res2572)
Con99247 = keras.layers.Concatenate(axis=1, name = 'Con99247', )([Glo97299,in0Con99247])
Mul41543 = keras.layers.Multiply(name = 'Mul41543', )([Fla14678,Con99247])
model = tf.keras.models.Model(inputs=[in0Dot98207,in1Dot98207,in0Mul28217,in1Mul28217,in0Con48886,in0GRU49934,in0Con99247], outputs=Mul41543)
w = model.get_layer('GRU49934').get_weights() 
w[0] = np.array([[6, 1, 7, 7, 2, 2], [10, 1, 9, 2, 3, 8], [4, 3, 4, 5, 5, 10]])
w[1] = np.array([[5, 6, 8, 1, 2, 4], [6, 8, 1, 5, 5, 4]])
w[2] = np.array([2, 6, 5, 5, 3, 4])
model.get_layer('GRU49934').set_weights(w) 
in0Dot98207 = tf.constant([[[0.1146, 0.0746], [0.967, 0.4412]]])
in1Dot98207 = tf.constant([[[0.8498, 0.8648], [0.6599, 0.2645]]])
in0Mul28217 = tf.constant([[[0.4567]]])
in1Mul28217 = tf.constant([[[0.7986]]])
in0Con48886 = tf.constant([[0.5756]])
in0GRU49934 = tf.constant([[[5, 3, 5]]])
in0Con99247 = tf.constant([[0.3932, 0.8475, 0.7425]])
print (np.array2string(model.predict([in0Dot98207,in1Dot98207,in0Mul28217,in1Mul28217,in0Con48886,in0GRU49934,in0Con99247],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul41543.png')

LDot98207 = dot_layer([[[0.1146, 0.0746], [0.967, 0.4412]]], [[[0.8498, 0.8648], [0.6599, 0.2645]]], 1, 1, Dot98207), 
LFla14678 = flatten_layer(Dot98207, Fla14678), 
LMul28217 = multiply_layer([[[[0.4567]]], [[[0.7986]]]], Mul28217), 
LFla8817 = flatten_layer(Mul28217, Fla8817), 
LCon48886 = concatenate_layer([Fla8817,[[0.5756]]], 1, Con48886), 
LGRU49934 = gru_layer([[[5, 3, 5]]],[[6, 1, 7, 7, 2, 2], [10, 1, 9, 2, 3, 8], [4, 3, 4, 5, 5, 10]],[[5, 6, 8, 1, 2, 4], [6, 8, 1, 5, 5, 4]],[2, 6, 5, 5, 3, 4], false, GRU49934), 
LAdd62670 = add_layer([Con48886,GRU49934], Add62670), 
LRes37069 = reshape_layer(Add62670, [2, 1], Res37069), 
LRes2572 = reshape_layer(Res37069, [2, 1, 1], Res2572), 
LGlo97299 = global_max_pool2D_layer(Res2572, Glo97299), 
LCon99247 = concatenate_layer([Glo97299,[[0.3932, 0.8475, 0.7425]]], 1, Con99247), 
LMul41543 = multiply_layer([Fla14678,Con99247], Mul41543), 
exec_layers([LDot98207,LFla14678,LMul28217,LFla8817,LCon48886,LGRU49934,LAdd62670,LRes37069,LRes2572,LGlo97299,LCon99247,LMul41543],["Dot98207","Fla14678","Mul28217","Fla8817","Con48886","GRU49934","Add62670","Res37069","Res2572","Glo97299","Con99247","Mul41543"],Mul41543,"Mul41543")

Actual (Unparsed): [[0.4233598, 0.1395379, 0.3004752, 0.1345495]]

Expected (Unparsed): [[0.4233597747281872,0.139537864456,0.3004751586,0.13454952390000002]]

Actual:   [[0.4234, 0.1396, 0.3005, 0.1346]]

Expected: [[0.4234, 0.1396, 0.3005, 0.1346]]