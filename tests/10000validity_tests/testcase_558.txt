import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub48219 = tf.keras.layers.Input(shape=([3, 3, 2, 3]))
in1Sub48219 = tf.keras.layers.Input(shape=([3, 3, 2, 3]))
in0Sub95071 = tf.keras.layers.Input(shape=([2]))
in1Sub95071 = tf.keras.layers.Input(shape=([2]))
in0Con79509 = tf.keras.layers.Input(shape=([52]))

Sub48219 = keras.layers.Subtract(name = 'Sub48219', )([in0Sub48219,in1Sub48219])
Res41162 = keras.layers.Reshape((3, 3, 6), name = 'Res41162', )(Sub48219)
Res94634 = keras.layers.Reshape((3, 18), name = 'Res94634', )(Res41162)
Fla4879 = keras.layers.Flatten(name = 'Fla4879', )(Res94634)
Sub95071 = keras.layers.Subtract(name = 'Sub95071', )([in0Sub95071,in1Sub95071])
Con79509 = keras.layers.Concatenate(axis=1, name = 'Con79509', )([Sub95071,in0Con79509])
Add21010 = keras.layers.Add(name = 'Add21010', )([Fla4879,Con79509])
Res70430 = keras.layers.Reshape((54, 1), name = 'Res70430', )(Add21010)
Res68920 = keras.layers.Reshape((54, 1, 1), name = 'Res68920', )(Res70430)
Loc16168 = keras.layers.LocallyConnected2D(4, (6, 1),strides=(42, 1), name = 'Loc16168', )(Res68920)
model = tf.keras.models.Model(inputs=[in0Sub48219,in1Sub48219,in0Sub95071,in1Sub95071,in0Con79509], outputs=Loc16168)
w = model.get_layer('Loc16168').get_weights() 
w[0] = np.array([[[0.2783, 0.2615, 0.5727, 0.5435], [0.5525, 0.1723, 0.4936, 0.4975], [0.0848, 0.1215, 0.163, 0.0511], [0.6964, 0.5287, 0.4678, 0.0269], [0.762, 0.4194, 0.439, 0.0657], [0.0619, 0.8356, 0.8166, 0.0249]], [[0.2036, 0.7108, 0.3739, 0.5885], [0.3229, 0.4093, 0.3284, 0.189], [0.2322, 0.7199, 0.6965, 0.1344], [0.0449, 0.3419, 0.8986, 0.7866], [0.5805, 0.8021, 0.2636, 0.7393], [0.5259, 0.3052, 0.3414, 0.2118]]])
w[1] = np.array([[[0, 0, 0, 0]], [[0, 0, 0, 0]]])
model.get_layer('Loc16168').set_weights(w) 
in0Sub48219 = tf.constant([[[[[0.9815, 0.3038, 0.1419], [0.0899, 0.1375, 0.9228]], [[0.0142, 0.3146, 0.3235], [0.9807, 0.1556, 0.1697]], [[0.8855, 0.9685, 0.9577], [0.7962, 0.0742, 0.2187]]], [[[0.8538, 0.9237, 0.1592], [0.3698, 0.489, 0.9535]], [[0.9005, 0.9755, 0.0358], [0.7033, 0.8034, 0.1546]], [[0.8186, 0.124, 0.6907], [0.4456, 0.9047, 0.5756]]], [[[0.2557, 0.5779, 0.3437], [0.3179, 0.429, 0.7009]], [[0.2916, 0.7141, 0.584], [0.7208, 0.3454, 0.2703]], [[0.8364, 0.7893, 0.0295], [0.0444, 0.951, 0.6588]]]]])
in1Sub48219 = tf.constant([[[[[0.526, 0.142, 0.6584], [0.5747, 0.4214, 0.992]], [[0.5072, 0.6084, 0.4539], [0.8395, 0.7273, 0.8549]], [[0.9902, 0.4313, 0.967], [0.7119, 0.2308, 0.1789]]], [[[0.178, 0.5417, 0.9553], [0.1813, 0.3721, 0.372]], [[0.9489, 0.364, 0.4477], [0.9391, 0.1249, 0.6482]], [[0.7961, 0.2945, 0.7545], [0.504, 0.9358, 0.404]]], [[[0.1466, 0.4599, 0.9934], [0.6512, 0.5832, 0.1407]], [[0.4557, 0.9254, 0.307], [0.1923, 0.2472, 0.0212]], [[0.8847, 0.0097, 0.8553], [0.4061, 0.323, 0.5341]]]]])
in0Sub95071 = tf.constant([[0.9205, 0.0225]])
in1Sub95071 = tf.constant([[0.9026, 0.5081]])
in0Con79509 = tf.constant([[0.5478, 0.0654, 0.934, 0.1323, 0.0145, 0.9377, 0.0856, 0.8143, 0.4693, 0.8926, 0.8734, 0.2871, 0.3405, 0.8576, 0.4694, 0.6459, 0.0372, 0.1321, 0.7016, 0.5248, 0.0912, 0.6562, 0.1916, 0.0552, 0.6088, 0.091, 0.6112, 0.9684, 0.0661, 0.9032, 0.7211, 0.1707, 0.1518, 0.3877, 0.9743, 0.4309, 0.1829, 0.7081, 0.2454, 0.0492, 0.6056, 0.5851, 0.6837, 0.503, 0.227, 0.2217, 0.7748, 0.1024, 0.1182, 0.4179, 0.4468, 0.6296]])
print (np.array2string(model.predict([in0Sub48219,in1Sub48219,in0Sub95071,in1Sub95071,in0Con79509],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc16168.png')

LSub48219 = subtract_layer([[[[[0.9815, 0.3038, 0.1419], [0.0899, 0.1375, 0.9228]], [[0.0142, 0.3146, 0.3235], [0.9807, 0.1556, 0.1697]], [[0.8855, 0.9685, 0.9577], [0.7962, 0.0742, 0.2187]]], [[[0.8538, 0.9237, 0.1592], [0.3698, 0.489, 0.9535]], [[0.9005, 0.9755, 0.0358], [0.7033, 0.8034, 0.1546]], [[0.8186, 0.124, 0.6907], [0.4456, 0.9047, 0.5756]]], [[[0.2557, 0.5779, 0.3437], [0.3179, 0.429, 0.7009]], [[0.2916, 0.7141, 0.584], [0.7208, 0.3454, 0.2703]], [[0.8364, 0.7893, 0.0295], [0.0444, 0.951, 0.6588]]]]], [[[[[0.526, 0.142, 0.6584], [0.5747, 0.4214, 0.992]], [[0.5072, 0.6084, 0.4539], [0.8395, 0.7273, 0.8549]], [[0.9902, 0.4313, 0.967], [0.7119, 0.2308, 0.1789]]], [[[0.178, 0.5417, 0.9553], [0.1813, 0.3721, 0.372]], [[0.9489, 0.364, 0.4477], [0.9391, 0.1249, 0.6482]], [[0.7961, 0.2945, 0.7545], [0.504, 0.9358, 0.404]]], [[[0.1466, 0.4599, 0.9934], [0.6512, 0.5832, 0.1407]], [[0.4557, 0.9254, 0.307], [0.1923, 0.2472, 0.0212]], [[0.8847, 0.0097, 0.8553], [0.4061, 0.323, 0.5341]]]]], Sub48219), 
LRes41162 = reshape_layer(Sub48219, [3, 3, 6], Res41162), 
LRes94634 = reshape_layer(Res41162, [3, 18], Res94634), 
LFla4879 = flatten_layer(Res94634, Fla4879), 
LSub95071 = subtract_layer([[0.9205, 0.0225]], [[0.9026, 0.5081]], Sub95071), 
LCon79509 = concatenate_layer([Sub95071,[[0.5478, 0.0654, 0.934, 0.1323, 0.0145, 0.9377, 0.0856, 0.8143, 0.4693, 0.8926, 0.8734, 0.2871, 0.3405, 0.8576, 0.4694, 0.6459, 0.0372, 0.1321, 0.7016, 0.5248, 0.0912, 0.6562, 0.1916, 0.0552, 0.6088, 0.091, 0.6112, 0.9684, 0.0661, 0.9032, 0.7211, 0.1707, 0.1518, 0.3877, 0.9743, 0.4309, 0.1829, 0.7081, 0.2454, 0.0492, 0.6056, 0.5851, 0.6837, 0.503, 0.227, 0.2217, 0.7748, 0.1024, 0.1182, 0.4179, 0.4468, 0.6296]]], 1, Con79509), 
LAdd21010 = add_layer([Fla4879,Con79509], Add21010), 
LRes70430 = reshape_layer(Add21010, [54, 1], Res70430), 
LRes68920 = reshape_layer(Res70430, [54, 1, 1], Res68920), 
LLoc16168 = locally_connected2D_layer(Res68920, 6, 1,[[[0.2783, 0.2615, 0.5727, 0.5435], [0.5525, 0.1723, 0.4936, 0.4975], [0.0848, 0.1215, 0.163, 0.0511], [0.6964, 0.5287, 0.4678, 0.0269], [0.762, 0.4194, 0.439, 0.0657], [0.0619, 0.8356, 0.8166, 0.0249]], [[0.2036, 0.7108, 0.3739, 0.5885], [0.3229, 0.4093, 0.3284, 0.189], [0.2322, 0.7199, 0.6965, 0.1344], [0.0449, 0.3419, 0.8986, 0.7866], [0.5805, 0.8021, 0.2636, 0.7393], [0.5259, 0.3052, 0.3414, 0.2118]]],[[[0, 0, 0, 0]], [[0, 0, 0, 0]]], 42, 1, Loc16168), 
exec_layers([LSub48219,LRes41162,LRes94634,LFla4879,LSub95071,LCon79509,LAdd21010,LRes70430,LRes68920,LLoc16168],["Sub48219","Res41162","Res94634","Fla4879","Sub95071","Con79509","Add21010","Res70430","Res68920","Loc16168"],Loc16168,"Loc16168")

Actual (Unparsed): [[[[0.1627139, 0.1754479, 0.2571165, 0.1308027]], [[0.9163506, 1.9156234, 2.1303200, 1.6111027]]]]

Expected (Unparsed): [[[[0.1627138900000001,0.17544783000000005,0.25711644000000006,0.13080272999999998]],[[0.9163506299999999,1.9156233999999999,2.13032006,1.6111027299999998]]]]

Actual:   [[[[0.1628, 0.1755, 0.2572, 0.1309]], [[0.9164, 1.9157, 2.1304, 1.6112]]]]

Expected: [[[[0.1628, 0.1755, 0.2572, 0.1309]], [[0.9164, 1.9157, 2.1304, 1.6112]]]]