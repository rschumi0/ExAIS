import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub21634 = tf.keras.layers.Input(shape=([3, 2, 2, 2]))
in1Sub21634 = tf.keras.layers.Input(shape=([3, 2, 2, 2]))
in0Dot73386 = tf.keras.layers.Input(shape=([3]))
in1Dot73386 = tf.keras.layers.Input(shape=([3]))
in0Con83486 = tf.keras.layers.Input(shape=([3, 5]))

Sub21634 = keras.layers.Subtract(name = 'Sub21634', )([in0Sub21634,in1Sub21634])
Res25426 = keras.layers.Reshape((3, 2, 4), name = 'Res25426', )(Sub21634)
Res16143 = keras.layers.Reshape((3, 8), name = 'Res16143', )(Res25426)
Dot73386 = keras.layers.Dot(axes=(1, 1), name = 'Dot73386', )([in0Dot73386,in1Dot73386])
Res19280 = keras.layers.Reshape((1, 1), name = 'Res19280', )(Dot73386)
Con65838 = keras.layers.Conv1D(3, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con65838', )(Res19280)
Zer60093 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer60093', )(Con65838)
Con83486 = keras.layers.Concatenate(axis=2, name = 'Con83486', )([Zer60093,in0Con83486])
Sub43663 = keras.layers.Subtract(name = 'Sub43663', )([Res16143,Con83486])
Res91679 = keras.layers.Reshape((3, 8, 1), name = 'Res91679', )(Sub43663)
Max93905 = keras.layers.MaxPool2D(pool_size=(2, 7), name = 'Max93905', )(Res91679)
model = tf.keras.models.Model(inputs=[in0Sub21634,in1Sub21634,in0Dot73386,in1Dot73386,in0Con83486], outputs=Max93905)
w = model.get_layer('Con65838').get_weights() 
w[0] = np.array([[[0.1178, 0.0243, 0.3952]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con65838').set_weights(w) 
in0Sub21634 = tf.constant([[[[[0.0588, 0.4134], [0.572, 0.6965]], [[0.7832, 0.5546], [0.5571, 0.0828]]], [[[0.4939, 0.5242], [0.591, 0.44]], [[0.0166, 0.255], [0.5212, 0.4193]]], [[[0.5514, 0.5237], [0.5214, 0.9291]], [[0.806, 0.8754], [0.4279, 0.5224]]]]])
in1Sub21634 = tf.constant([[[[[0.6365, 0.9158], [0.3682, 0.7744]], [[0.096, 0.1244], [0.7345, 0.8929]]], [[[0.8864, 0.3779], [0.8499, 0.1728]], [[0.9519, 0.3141], [0.1245, 0.6727]]], [[[0.3588, 0.5176], [0.1064, 0.672]], [[0.6655, 0.2604], [0.5926, 0.0465]]]]])
in0Dot73386 = tf.constant([[0.7003, 0.1946, 0.8868]])
in1Dot73386 = tf.constant([[0.6918, 0.0396, 0.9601]])
in0Con83486 = tf.constant([[[0.1291, 0.2871, 0.1107, 0.196, 0.7561], [0.8079, 0.8221, 0.9949, 0.5147, 0.1701], [0.305, 0.5776, 0.688, 0.3212, 0.4429]]])
print (np.array2string(model.predict([in0Sub21634,in1Sub21634,in0Dot73386,in1Dot73386,in0Con83486],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max93905.png')

LSub21634 = subtract_layer([[[[[0.0588, 0.4134], [0.572, 0.6965]], [[0.7832, 0.5546], [0.5571, 0.0828]]], [[[0.4939, 0.5242], [0.591, 0.44]], [[0.0166, 0.255], [0.5212, 0.4193]]], [[[0.5514, 0.5237], [0.5214, 0.9291]], [[0.806, 0.8754], [0.4279, 0.5224]]]]], [[[[[0.6365, 0.9158], [0.3682, 0.7744]], [[0.096, 0.1244], [0.7345, 0.8929]]], [[[0.8864, 0.3779], [0.8499, 0.1728]], [[0.9519, 0.3141], [0.1245, 0.6727]]], [[[0.3588, 0.5176], [0.1064, 0.672]], [[0.6655, 0.2604], [0.5926, 0.0465]]]]], Sub21634), 
LRes25426 = reshape_layer(Sub21634, [3, 2, 4], Res25426), 
LRes16143 = reshape_layer(Res25426, [3, 8], Res16143), 
LDot73386 = dot_layer([[0.7003, 0.1946, 0.8868]], [[0.6918, 0.0396, 0.9601]], 1, 1, Dot73386), 
LRes19280 = reshape_layer(Dot73386, [1, 1], Res19280), 
LCon65838 = conv1D_layer(Res19280, 1,[[[0.1178, 0.0243, 0.3952]]],[0, 0, 0], 1, true, 1, Con65838), 
LZer60093 = zero_padding1D_layer(Con65838, 2, 0, Zer60093), 
LCon83486 = concatenate_layer([Zer60093,[[[0.1291, 0.2871, 0.1107, 0.196, 0.7561], [0.8079, 0.8221, 0.9949, 0.5147, 0.1701], [0.305, 0.5776, 0.688, 0.3212, 0.4429]]]], 2, Con83486), 
LSub43663 = subtract_layer(Res16143,Con83486, Sub43663), 
LRes91679 = reshape_layer(Sub43663, [3, 8, 1], Res91679), 
LMax93905 = max_pool2D_layer(Res91679, 2, 7, Max93905), 
exec_layers([LSub21634,LRes25426,LRes16143,LDot73386,LRes19280,LCon65838,LZer60093,LCon83486,LSub43663,LRes91679,LMax93905],["Sub21634","Res25426","Res16143","Dot73386","Res19280","Con65838","Zer60093","Con83486","Sub43663","Res91679","Max93905"],Max93905,"Max93905")

Actual (Unparsed): [[[[0.4001000]]]]

Expected (Unparsed): [[[[0.4001]]]]

Actual:   [[[[0.4001]]]]

Expected: [[[[0.4001]]]]