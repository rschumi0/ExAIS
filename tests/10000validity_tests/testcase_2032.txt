import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo59228 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Con57732 = tf.keras.layers.Input(shape=([3, 2]))
in0Up_60248 = tf.keras.layers.Input(shape=([2, 3, 1]))
in0Con98557 = tf.keras.layers.Input(shape=([3, 2]))
in0Dot370 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot370 = tf.keras.layers.Input(shape=([3, 2]))

Glo59228 = keras.layers.GlobalAveragePooling3D(name = 'Glo59228', )(in0Glo59228)
Thr19754 = keras.layers.ThresholdedReLU(theta=2.625710568765417, name = 'Thr19754', )(Glo59228)
Res64843 = keras.layers.Reshape((2, 1), name = 'Res64843', )(Thr19754)
Res12532 = keras.layers.Reshape((2, 1, 1), name = 'Res12532', )(Res64843)
Glo78948 = keras.layers.GlobalAveragePooling2D(name = 'Glo78948', )(Res12532)
Mas75546 = keras.layers.Masking(mask_value=1, name = 'Mas75546', )(Glo78948)
Res10472 = keras.layers.Reshape((1, 1), name = 'Res10472', )(Mas75546)
Zer43290 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer43290', )(Res10472)
Con57732 = keras.layers.Concatenate(axis=2, name = 'Con57732', )([Zer43290,in0Con57732])
Up_60248 = keras.layers.UpSampling2D(size=(2, 1), name = 'Up_60248', )(in0Up_60248)
Res29048 = keras.layers.Reshape((4, 3), name = 'Res29048', )(Up_60248)
LST46733 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST46733', )(Res29048)
Res51985 = keras.layers.Reshape((3, 1), name = 'Res51985', )(LST46733)
Con98557 = keras.layers.Concatenate(axis=2, name = 'Con98557', )([Res51985,in0Con98557])
Dot370 = keras.layers.Dot(axes=(2, 2), name = 'Dot370', )([in0Dot370,in1Dot370])
Dot97706 = keras.layers.Dot(axes=(2, 1), name = 'Dot97706', )([Con98557,Dot370])
Max11082 = keras.layers.Maximum(name = 'Max11082', )([Con57732,Dot97706])
model = tf.keras.models.Model(inputs=[in0Glo59228,in0Con57732,in0Up_60248,in0Con98557,in0Dot370,in1Dot370], outputs=Max11082)
w = model.get_layer('LST46733').get_weights() 
w[0] = np.array([[4, 10, 6, 8, 9, 4, 9, 7, 9, 8, 8, 6], [5, 10, 3, 2, 1, 9, 9, 9, 3, 3, 3, 4], [8, 2, 8, 4, 3, 10, 6, 3, 5, 8, 8, 7]])
w[1] = np.array([[9, 9, 5, 9, 5, 2, 1, 8, 4, 6, 1, 8], [3, 8, 8, 3, 9, 10, 4, 1, 9, 6, 9, 9], [2, 8, 5, 5, 2, 8, 10, 2, 3, 6, 7, 7]])
w[2] = np.array([1, 6, 5, 5, 8, 2, 4, 10, 6, 1, 6, 1])
model.get_layer('LST46733').set_weights(w) 
in0Glo59228 = tf.constant([[[[[1.1395, 1.2938]], [[1.035, 1.2934]]]]])
in0Con57732 = tf.constant([[[0.0991, 0.2127], [0.1711, 0.8254], [0.8725, 0.2367]]])
in0Up_60248 = tf.constant([[[[1.8826], [1.9114], [1.3848]], [[1.4578], [1.9141], [1.271]]]])
in0Con98557 = tf.constant([[[0.1603, 0.8619], [0.0409, 0.7698], [0.115, 0.9467]]])
in0Dot370 = tf.constant([[[0.011, 0.8523], [0.6367, 0.238], [0.1303, 0.7126]]])
in1Dot370 = tf.constant([[[0.2743, 0.3833], [0.7019, 0.2005], [0.7522, 0.046]]])
print (np.array2string(model.predict([in0Glo59228,in0Con57732,in0Up_60248,in0Con98557,in0Dot370,in1Dot370],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max11082.png')

LGlo59228 = global_average_pooling3D_layer([[[[[1.1395, 1.2938]], [[1.035, 1.2934]]]]], Glo59228), 
LThr19754 = thresholded_relu_layer(Glo59228, 2.625710568765417, Thr19754), 
LRes64843 = reshape_layer(Thr19754, [2, 1], Res64843), 
LRes12532 = reshape_layer(Res64843, [2, 1, 1], Res12532), 
LGlo78948 = global_average_pooling2D_layer(Res12532, Glo78948), 
LMas75546 = masking_layer(Glo78948, 1, Mas75546), 
LRes10472 = reshape_layer(Mas75546, [1, 1], Res10472), 
LZer43290 = zero_padding1D_layer(Res10472, 2, 0, Zer43290), 
LCon57732 = concatenate_layer([Zer43290,[[[0.0991, 0.2127], [0.1711, 0.8254], [0.8725, 0.2367]]]], 2, Con57732), 
LUp_60248 = up_sampling2D_layer([[[[1.8826], [1.9114], [1.3848]], [[1.4578], [1.9141], [1.271]]]], 2, 1, Up_60248), 
LRes29048 = reshape_layer(Up_60248, [4, 3], Res29048), 
LLST46733 = lstm_layer(Res29048,[[4, 10, 6, 8, 9, 4, 9, 7, 9, 8, 8, 6], [5, 10, 3, 2, 1, 9, 9, 9, 3, 3, 3, 4], [8, 2, 8, 4, 3, 10, 6, 3, 5, 8, 8, 7]],[[9, 9, 5, 9, 5, 2, 1, 8, 4, 6, 1, 8], [3, 8, 8, 3, 9, 10, 4, 1, 9, 6, 9, 9], [2, 8, 5, 5, 2, 8, 10, 2, 3, 6, 7, 7]],[1, 6, 5, 5, 8, 2, 4, 10, 6, 1, 6, 1], LST46733), 
LRes51985 = reshape_layer(LST46733, [3, 1], Res51985), 
LCon98557 = concatenate_layer([Res51985,[[[0.1603, 0.8619], [0.0409, 0.7698], [0.115, 0.9467]]]], 2, Con98557), 
LDot370 = dot_layer([[[0.011, 0.8523], [0.6367, 0.238], [0.1303, 0.7126]]], [[[0.2743, 0.3833], [0.7019, 0.2005], [0.7522, 0.046]]], 2, 2, Dot370), 
LDot97706 = dot_layer(Con98557,Dot370, 2, 1, Dot97706), 
LMax11082 = maximum_layer([Con57732,Dot97706], Max11082), 
exec_layers([LGlo59228,LThr19754,LRes64843,LRes12532,LGlo78948,LMas75546,LRes10472,LZer43290,LCon57732,LUp_60248,LRes29048,LLST46733,LRes51985,LCon98557,LDot370,LDot97706,LMax11082],["Glo59228","Thr19754","Res64843","Res12532","Glo78948","Mas75546","Res10472","Zer43290","Con57732","Up_60248","Res29048","LST46733","Res51985","Con98557","Dot370","Dot97706","Max11082"],Max11082,"Max11082")

Actual (Unparsed): [[[0.6383265, 0.4597470, 0.2387039], [0.5781334, 0.3791074, 0.8254000], [0.6524756, 0.8725000, 0.2367000]]]

Expected (Unparsed): [[[0.6383264946309462,0.4597470031769605,0.2387039026676109],[0.5781334246299463,0.3791073773879605,0.8254],[0.6524755812939462,0.8725,0.2367]]]

Actual:   [[[0.6384, 0.4598, 0.2388], [0.5782, 0.3792, 0.8254], [0.6525, 0.8725, 0.2367]]]

Expected: [[[0.6384, 0.4598, 0.2388], [0.5782, 0.3792, 0.8254], [0.6525, 0.8725, 0.2367]]]