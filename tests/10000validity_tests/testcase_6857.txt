import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con80024 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Fla82208 = tf.keras.layers.Input(shape=([2]))
in0Con72159 = tf.keras.layers.Input(shape=([10]))

Con80024 = keras.layers.Conv3DTranspose(4, (1, 1, 2),strides=(1, 1, 1), padding='valid', name = 'Con80024', )(in0Con80024)
Res6648 = keras.layers.Reshape((1, 1, 12), name = 'Res6648', )(Con80024)
Res98629 = keras.layers.Reshape((1, 12), name = 'Res98629', )(Res6648)
Fla3395 = keras.layers.Flatten(name = 'Fla3395', )(Res98629)
Fla82208 = keras.layers.Flatten(name = 'Fla82208', )(in0Fla82208)
Con72159 = keras.layers.Concatenate(axis=1, name = 'Con72159', )([Fla82208,in0Con72159])
Mul28399 = keras.layers.Multiply(name = 'Mul28399', )([Fla3395,Con72159])
Res63541 = keras.layers.Reshape((12, 1), name = 'Res63541', )(Mul28399)
Res1330 = keras.layers.Reshape((12, 1, 1), name = 'Res1330', )(Res63541)
Res14006 = keras.layers.Reshape((12, 1, 1, 1), name = 'Res14006', )(Res1330)
Con24866 = keras.layers.Conv3D(4, (11, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con24866', )(Res14006)
model = tf.keras.models.Model(inputs=[in0Con80024,in0Fla82208,in0Con72159], outputs=Con24866)
w = model.get_layer('Con80024').get_weights() 
w[0] = np.array([[[[[0.1699], [0.7215], [0.4462], [0.8314]], [[0.6875], [0.6111], [0.2399], [0.1391]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con80024').set_weights(w) 
w = model.get_layer('Con24866').get_weights() 
w[0] = np.array([[[[[0.5907, 0.037, 0.671, 0.0145]]]], [[[[0.8818, 0.4565, 0.6757, 0.3153]]]], [[[[0.7893, 0.0204, 0.9691, 0.9771]]]], [[[[0.5278, 0.5234, 0.343, 0.517]]]], [[[[0.986, 0.5621, 0.6267, 0.7079]]]], [[[[0.6569, 0.2955, 0.571, 0.1355]]]], [[[[0.1564, 0.8223, 0.0757, 0.2649]]]], [[[[0.2641, 0.3051, 0.4642, 0.0466]]]], [[[[0.618, 0.4974, 0.6571, 0.6894]]]], [[[[0.5543, 0.251, 0.9109, 0.7344]]]], [[[[0.0955, 0.9182, 0.2509, 0.9734]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con24866').set_weights(w) 
in0Con80024 = tf.constant([[[[[0.3443], [0.838]]]]])
in0Fla82208 = tf.constant([[1.7064, 1.8022]])
in0Con72159 = tf.constant([[0.5523, 0.6535, 0.1653, 0.8601, 0.5625, 0.8986, 0.5261, 0.7283, 0.7069, 0.0069]])
print (np.array2string(model.predict([in0Con80024,in0Fla82208,in0Con72159],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con24866.png')

LCon80024 = conv3D_transpose_layer([[[[[0.3443], [0.838]]]]], 1, 1, 2,[[[[[0.1699], [0.7215], [0.4462], [0.8314]], [[0.6875], [0.6111], [0.2399], [0.1391]]]]],[0, 0, 0, 0], 1, 1, 1, false, Con80024), 
LRes6648 = reshape_layer(Con80024, [1, 1, 12], Res6648), 
LRes98629 = reshape_layer(Res6648, [1, 12], Res98629), 
LFla3395 = flatten_layer(Res98629, Fla3395), 
LFla82208 = flatten_layer([[1.7064, 1.8022]], Fla82208), 
LCon72159 = concatenate_layer([Fla82208,[[0.5523, 0.6535, 0.1653, 0.8601, 0.5625, 0.8986, 0.5261, 0.7283, 0.7069, 0.0069]]], 1, Con72159), 
LMul28399 = multiply_layer([Fla3395,Con72159], Mul28399), 
LRes63541 = reshape_layer(Mul28399, [12, 1], Res63541), 
LRes1330 = reshape_layer(Res63541, [12, 1, 1], Res1330), 
LRes14006 = reshape_layer(Res1330, [12, 1, 1, 1], Res14006), 
LCon24866 = conv3D_layer(Res14006, 11, 1, 1,[[[[[0.5907, 0.037, 0.671, 0.0145]]]], [[[[0.8818, 0.4565, 0.6757, 0.3153]]]], [[[[0.7893, 0.0204, 0.9691, 0.9771]]]], [[[[0.5278, 0.5234, 0.343, 0.517]]]], [[[[0.986, 0.5621, 0.6267, 0.7079]]]], [[[[0.6569, 0.2955, 0.571, 0.1355]]]], [[[[0.1564, 0.8223, 0.0757, 0.2649]]]], [[[[0.2641, 0.3051, 0.4642, 0.0466]]]], [[[[0.618, 0.4974, 0.6571, 0.6894]]]], [[[[0.5543, 0.251, 0.9109, 0.7344]]]], [[[[0.0955, 0.9182, 0.2509, 0.9734]]]]],[0, 0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con24866), 
exec_layers([LCon80024,LRes6648,LRes98629,LFla3395,LFla82208,LCon72159,LMul28399,LRes63541,LRes1330,LRes14006,LCon24866],["Con80024","Res6648","Res98629","Fla3395","Fla82208","Con72159","Mul28399","Res63541","Res1330","Res14006","Con24866"],Con24866,"Con24866")

Actual (Unparsed): [[[[[1.7662013, 1.3402349, 1.8600027, 1.1819622]]], [[[1.8738980, 1.4264224, 1.7125268, 1.3330940]]]]]

Expected (Unparsed): [[[[[1.7662013750637706,1.3402349582756437,1.8600027719732972,1.1819621893267152]]],[[[1.8738980460431371,1.4264223877798523,1.712526809408569,1.3330939800470187]]]]]

Actual:   [[[[[1.7663, 1.3403, 1.8601, 1.182]]], [[[1.8739, 1.4265, 1.7126, 1.3331]]]]]

Expected: [[[[[1.7663, 1.3403, 1.8601, 1.182]]], [[[1.8739, 1.4265, 1.7126, 1.3331]]]]]