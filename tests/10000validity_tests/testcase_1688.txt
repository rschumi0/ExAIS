import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con50529 = tf.keras.layers.Input(shape=([1, 2]))
in0Add26462 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Add26462 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Dot54249 = tf.keras.layers.Input(shape=([3]))
in1Dot54249 = tf.keras.layers.Input(shape=([3]))
in0Con1937 = tf.keras.layers.Input(shape=([3]))

Con50529 = keras.layers.Conv1D(4, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con50529', )(in0Con50529)
Res31143 = keras.layers.Reshape((1, 4, 1), name = 'Res31143', )(Con50529)
Glo86217 = keras.layers.GlobalAveragePooling2D(name = 'Glo86217', )(Res31143)
Add26462 = keras.layers.Add(name = 'Add26462', )([in0Add26462,in1Add26462])
Res81590 = keras.layers.Reshape((2, 2), name = 'Res81590', )(Add26462)
Fla22320 = keras.layers.Flatten(name = 'Fla22320', )(Res81590)
Dot54249 = keras.layers.Dot(axes=(1, 1), name = 'Dot54249', )([in0Dot54249,in1Dot54249])
Con1937 = keras.layers.Concatenate(axis=1, name = 'Con1937', )([Dot54249,in0Con1937])
Sub79346 = keras.layers.Subtract(name = 'Sub79346', )([Fla22320,Con1937])
Res29271 = keras.layers.Reshape((4, 1), name = 'Res29271', )(Sub79346)
Res1363 = keras.layers.Reshape((4, 1, 1), name = 'Res1363', )(Res29271)
Glo42524 = keras.layers.GlobalAveragePooling2D(name = 'Glo42524', )(Res1363)
Sub96890 = keras.layers.Subtract(name = 'Sub96890', )([Glo86217,Glo42524])
model = tf.keras.models.Model(inputs=[in0Con50529,in0Add26462,in1Add26462,in0Dot54249,in1Dot54249,in0Con1937], outputs=Sub96890)
w = model.get_layer('Con50529').get_weights() 
w[0] = np.array([[[0.5386, 0.8811, 0.414, 0.8741], [0.4926, 0.5936, 0.1039, 0.929]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con50529').set_weights(w) 
in0Con50529 = tf.constant([[[0.6608, 0.961]]])
in0Add26462 = tf.constant([[[[0.5284], [0.4959]], [[0.8195], [0.8533]]]])
in1Add26462 = tf.constant([[[[0.1945], [0.4976]], [[0.5176], [0.1604]]]])
in0Dot54249 = tf.constant([[0.738, 0.8587, 0.9234]])
in1Dot54249 = tf.constant([[0.0573, 0.1513, 0.3095]])
in0Con1937 = tf.constant([[0.7033, 0.0217, 0.0193]])
print (np.array2string(model.predict([in0Con50529,in0Add26462,in1Add26462,in0Dot54249,in1Dot54249,in0Con1937],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub96890.png')

LCon50529 = conv1D_layer([[[0.6608, 0.961]]], 1,[[[0.5386, 0.8811, 0.414, 0.8741], [0.4926, 0.5936, 0.1039, 0.929]]],[0, 0, 0, 0], 1, false, 1, Con50529), 
LRes31143 = reshape_layer(Con50529, [1, 4, 1], Res31143), 
LGlo86217 = global_average_pooling2D_layer(Res31143, Glo86217), 
LAdd26462 = add_layer([[[[[0.5284], [0.4959]], [[0.8195], [0.8533]]]], [[[[0.1945], [0.4976]], [[0.5176], [0.1604]]]]], Add26462), 
LRes81590 = reshape_layer(Add26462, [2, 2], Res81590), 
LFla22320 = flatten_layer(Res81590, Fla22320), 
LDot54249 = dot_layer([[0.738, 0.8587, 0.9234]], [[0.0573, 0.1513, 0.3095]], 1, 1, Dot54249), 
LCon1937 = concatenate_layer([Dot54249,[[0.7033, 0.0217, 0.0193]]], 1, Con1937), 
LSub79346 = subtract_layer(Fla22320,Con1937, Sub79346), 
LRes29271 = reshape_layer(Sub79346, [4, 1], Res29271), 
LRes1363 = reshape_layer(Res29271, [4, 1, 1], Res1363), 
LGlo42524 = global_average_pooling2D_layer(Res1363, Glo42524), 
LSub96890 = subtract_layer(Glo86217,Glo42524, Sub96890), 
exec_layers([LCon50529,LRes31143,LGlo86217,LAdd26462,LRes81590,LFla22320,LDot54249,LCon1937,LSub79346,LRes29271,LRes1363,LGlo42524,LSub96890],["Con50529","Res31143","Glo86217","Add26462","Res81590","Fla22320","Dot54249","Con1937","Sub79346","Res29271","Res1363","Glo42524","Sub96890"],Sub96890,"Sub96890")

Actual (Unparsed): [[0.2402176]]

Expected (Unparsed): [[0.2402175875]]

Actual:   [[0.2403]]

Expected: [[0.2403]]