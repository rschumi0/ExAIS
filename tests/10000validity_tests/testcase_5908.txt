import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sim17410 = tf.keras.layers.Input(shape=([3, 3]))

Sim17410 = keras.layers.SimpleRNN(2,name = 'Sim17410', )(in0Sim17410)
Res17017 = keras.layers.Reshape((2, 1), name = 'Res17017', )(Sim17410)
Res47044 = keras.layers.Reshape((2, 1, 1), name = 'Res47044', )(Res17017)
Res48025 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res48025', )(Res47044)
Glo41010 = keras.layers.GlobalAveragePooling3D(name = 'Glo41010', )(Res48025)
ReL188 = keras.layers.ReLU(max_value=4.342213168355472, negative_slope=8.511065371641829, threshold=6.137254683945593, name = 'ReL188', )(Glo41010)
Res55620 = keras.layers.Reshape((1, 1), name = 'Res55620', )(ReL188)
Con62296 = keras.layers.Conv1D(2, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con62296', )(Res55620)
Res81647 = keras.layers.Reshape((1, 2, 1), name = 'Res81647', )(Con62296)
Ave40607 = keras.layers.AveragePooling2D(pool_size=(1, 2), name = 'Ave40607', )(Res81647)
model = tf.keras.models.Model(inputs=[in0Sim17410], outputs=Ave40607)
w = model.get_layer('Sim17410').get_weights() 
w[0] = np.array([[6, 2], [3, 4], [10, 3]])
w[1] = np.array([[5, 7], [8, 7]])
w[2] = np.array([7, 10])
model.get_layer('Sim17410').set_weights(w) 
w = model.get_layer('Con62296').get_weights() 
w[0] = np.array([[[0.9975, 0.1932]]])
w[1] = np.array([0, 0])
model.get_layer('Con62296').set_weights(w) 
in0Sim17410 = tf.constant([[[10, 4, 9], [3, 1, 6], [5, 7, 9]]])
print (np.array2string(model.predict([in0Sim17410],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave40607.png')

LSim17410 = simple_rnn_layer([[[10, 4, 9], [3, 1, 6], [5, 7, 9]]],[[6, 2], [3, 4], [10, 3]],[[5, 7], [8, 7]],[7, 10], Sim17410), 
LRes17017 = reshape_layer(Sim17410, [2, 1], Res17017), 
LRes47044 = reshape_layer(Res17017, [2, 1, 1], Res47044), 
LRes48025 = reshape_layer(Res47044, [2, 1, 1, 1], Res48025), 
LGlo41010 = global_average_pooling3D_layer(Res48025, Glo41010), 
LReL188 = relu_layer(Glo41010, 4.342213168355472, 8.511065371641829, 6.137254683945593, ReL188), 
LRes55620 = reshape_layer(ReL188, [1, 1], Res55620), 
LCon62296 = conv1D_layer(Res55620, 1,[[[0.9975, 0.1932]]],[0, 0], 1, true, 1, Con62296), 
LRes81647 = reshape_layer(Con62296, [1, 2, 1], Res81647), 
LAve40607 = average_pooling2D_layer(Res81647, 1, 2, Ave40607), 
exec_layers([LSim17410,LRes17017,LRes47044,LRes48025,LGlo41010,LReL188,LRes55620,LCon62296,LRes81647,LAve40607],["Sim17410","Res17017","Res47044","Res48025","Glo41010","ReL188","Res55620","Con62296","Res81647","Ave40607"],Ave40607,"Ave40607")

Actual (Unparsed): [[[[-26.0307919]]]]

Expected (Unparsed): [[[[-26.030791943927348]]]]

Actual:   [[[[-26.0307]]]]

Expected: [[[[-26.0307]]]]