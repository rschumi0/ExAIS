import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST52519 = tf.keras.layers.Input(shape=([3, 1]))
in0Mul22538 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul22538 = tf.keras.layers.Input(shape=([2, 1]))
in0Ave44180 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave44180 = tf.keras.layers.Input(shape=([2, 1]))

LST52519 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST52519', )(in0LST52519)
Res13147 = keras.layers.Reshape((3, 1), name = 'Res13147', )(LST52519)
Zer23107 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer23107', )(Res13147)
Res63597 = keras.layers.Reshape((5, 1, 1), name = 'Res63597', )(Zer23107)
Res36074 = keras.layers.Reshape((5, 1, 1, 1), name = 'Res36074', )(Res63597)
Mul22538 = keras.layers.Multiply(name = 'Mul22538', )([in0Mul22538,in1Mul22538])
Zer16805 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer16805', )(Mul22538)
Res51390 = keras.layers.Reshape((4, 1, 1), name = 'Res51390', )(Zer16805)
Res46409 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res46409', )(Res51390)
Ave44180 = keras.layers.Average(name = 'Ave44180', )([in0Ave44180,in1Ave44180])
Res27759 = keras.layers.Reshape((2, 1, 1), name = 'Res27759', )(Ave44180)
Res6340 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res6340', )(Res27759)
Up_90329 = keras.layers.UpSampling3D(size=(2, 1, 1), name = 'Up_90329', )(Res6340)
Min44765 = keras.layers.Minimum(name = 'Min44765', )([Res46409,Up_90329])
Zer88446 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (0, 0)), name = 'Zer88446', )(Min44765)
Add62109 = keras.layers.Add(name = 'Add62109', )([Res36074,Zer88446])
model = tf.keras.models.Model(inputs=[in0LST52519,in0Mul22538,in1Mul22538,in0Ave44180,in1Ave44180], outputs=Add62109)
w = model.get_layer('LST52519').get_weights() 
w[0] = np.array([[1, 9, 5, 1, 6, 8, 5, 10, 2, 7, 10, 5]])
w[1] = np.array([[5, 8, 8, 2, 9, 7, 10, 6, 6, 9, 3, 2], [2, 7, 7, 6, 1, 1, 7, 6, 5, 7, 6, 6], [1, 10, 8, 5, 6, 6, 5, 9, 8, 8, 4, 6]])
w[2] = np.array([3, 7, 9, 2, 1, 10, 3, 8, 2, 1, 10, 1])
model.get_layer('LST52519').set_weights(w) 
in0LST52519 = tf.constant([[[9], [7], [6]]])
in0Mul22538 = tf.constant([[[0.1755], [0.0592]]])
in1Mul22538 = tf.constant([[[0.7644], [0.2004]]])
in0Ave44180 = tf.constant([[[0.1495], [0.9882]]])
in1Ave44180 = tf.constant([[[0.7366], [0.9696]]])
print (np.array2string(model.predict([in0LST52519,in0Mul22538,in1Mul22538,in0Ave44180,in1Ave44180],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add62109.png')

LLST52519 = lstm_layer([[[9], [7], [6]]],[[1, 9, 5, 1, 6, 8, 5, 10, 2, 7, 10, 5]],[[5, 8, 8, 2, 9, 7, 10, 6, 6, 9, 3, 2], [2, 7, 7, 6, 1, 1, 7, 6, 5, 7, 6, 6], [1, 10, 8, 5, 6, 6, 5, 9, 8, 8, 4, 6]],[3, 7, 9, 2, 1, 10, 3, 8, 2, 1, 10, 1], LST52519), 
LRes13147 = reshape_layer(LST52519, [3, 1], Res13147), 
LZer23107 = zero_padding1D_layer(Res13147, 1, 1, Zer23107), 
LRes63597 = reshape_layer(Zer23107, [5, 1, 1], Res63597), 
LRes36074 = reshape_layer(Res63597, [5, 1, 1, 1], Res36074), 
LMul22538 = multiply_layer([[[[0.1755], [0.0592]]], [[[0.7644], [0.2004]]]], Mul22538), 
LZer16805 = zero_padding1D_layer(Mul22538, 1, 1, Zer16805), 
LRes51390 = reshape_layer(Zer16805, [4, 1, 1], Res51390), 
LRes46409 = reshape_layer(Res51390, [4, 1, 1, 1], Res46409), 
LAve44180 = average_layer([[[[0.1495], [0.9882]]], [[[0.7366], [0.9696]]]], Ave44180), 
LRes27759 = reshape_layer(Ave44180, [2, 1, 1], Res27759), 
LRes6340 = reshape_layer(Res27759, [2, 1, 1, 1], Res6340), 
LUp_90329 = up_sampling3D_layer(Res6340, 2, 1, 1, Up_90329), 
LMin44765 = minimum_layer([Res46409,Up_90329], Min44765), 
LZer88446 = zero_padding3D_layer(Min44765, 1, 0, 0, 0, 0, 0, Zer88446), 
LAdd62109 = add_layer([Res36074,Zer88446], Add62109), 
exec_layers([LLST52519,LRes13147,LZer23107,LRes63597,LRes36074,LMul22538,LZer16805,LRes51390,LRes46409,LAve44180,LRes27759,LRes6340,LUp_90329,LMin44765,LZer88446,LAdd62109],["LST52519","Res13147","Zer23107","Res63597","Res36074","Mul22538","Zer16805","Res51390","Res46409","Ave44180","Res27759","Res6340","Up_90329","Min44765","Zer88446","Add62109"],Add62109,"Add62109")

Actual (Unparsed): [[[[[0.0000000]]], [[[0.9950547]]], [[[1.1292070]]], [[[1.0069184]]], [[[0.0000000]]]]]

Expected (Unparsed): [[[[[0]]],[[[0.9950546914261649]]],[[[1.1292069536867304]]],[[[1.0069184336867305]]],[[[0]]]]]

Actual:   [[[[[0]]], [[[0.9951]]], [[[1.1293]]], [[[1.007]]], [[[0]]]]]

Expected: [[[[[0]]], [[[0.9951]]], [[[1.1293]]], [[[1.007]]], [[[0]]]]]