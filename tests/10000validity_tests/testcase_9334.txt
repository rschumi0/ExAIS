import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add20829 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Add20829 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con32141 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))

Add20829 = keras.layers.Add(name = 'Add20829', )([in0Add20829,in1Add20829])
Res87454 = keras.layers.Reshape((1, 2), name = 'Res87454', )(Add20829)
Con32141 = keras.layers.Conv3D(2, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con32141', )(in0Con32141)
Res84911 = keras.layers.Reshape((2, 1, 2), name = 'Res84911', )(Con32141)
Res23173 = keras.layers.Reshape((2, 2), name = 'Res23173', )(Res84911)
Dot85923 = keras.layers.Dot(axes=(2, 2), name = 'Dot85923', )([Res87454,Res23173])
Glo28436 = keras.layers.GlobalMaxPool1D(name = 'Glo28436', )(Dot85923)
Res31667 = keras.layers.Reshape((2, 1), name = 'Res31667', )(Glo28436)
Res6808 = keras.layers.Reshape((2, 1, 1), name = 'Res6808', )(Res31667)
Res34122 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res34122', )(Res6808)
Con90896 = keras.layers.Conv3DTranspose(2, (2, 1, 1),strides=(4, 1, 1), padding='valid', name = 'Con90896', )(Res34122)
model = tf.keras.models.Model(inputs=[in0Add20829,in1Add20829,in0Con32141], outputs=Con90896)
w = model.get_layer('Con32141').get_weights() 
w[0] = np.array([[[[[0.8638, 0.9028], [0.0336, 0.3667]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con32141').set_weights(w) 
w = model.get_layer('Con90896').get_weights() 
w[0] = np.array([[[[[0.8326], [0.5582]]]], [[[[0.5917], [0.1894]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con90896').set_weights(w) 
in0Add20829 = tf.constant([[[[0.1408, 0.3368]]]])
in1Add20829 = tf.constant([[[[0.7415, 0.677]]]])
in0Con32141 = tf.constant([[[[[0.4775, 0.4904]]], [[[0.9378, 0.2577]]]]])
print (np.array2string(model.predict([in0Add20829,in1Add20829,in0Con32141],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con90896.png')

LAdd20829 = add_layer([[[[[0.1408, 0.3368]]]], [[[[0.7415, 0.677]]]]], Add20829), 
LRes87454 = reshape_layer(Add20829, [1, 2], Res87454), 
LCon32141 = conv3D_layer([[[[[0.4775, 0.4904]]], [[[0.9378, 0.2577]]]]], 1, 1, 1,[[[[[0.8638, 0.9028], [0.0336, 0.3667]]]]],[0, 0], 1, 1, 1, true, 1, 1, 1, Con32141), 
LRes84911 = reshape_layer(Con32141, [2, 1, 2], Res84911), 
LRes23173 = reshape_layer(Res84911, [2, 2], Res23173), 
LDot85923 = dot_layer(Res87454,Res23173, 2, 2, Dot85923), 
LGlo28436 = global_max_pool1D_layer(Dot85923, Glo28436), 
LRes31667 = reshape_layer(Glo28436, [2, 1], Res31667), 
LRes6808 = reshape_layer(Res31667, [2, 1, 1], Res6808), 
LRes34122 = reshape_layer(Res6808, [2, 1, 1, 1], Res34122), 
LCon90896 = conv3D_transpose_layer(Res34122, 2, 1, 1,[[[[[0.8326], [0.5582]]]], [[[[0.5917], [0.1894]]]]],[0, 0], 4, 1, 1, false, Con90896), 
exec_layers([LAdd20829,LRes87454,LCon32141,LRes84911,LRes23173,LDot85923,LGlo28436,LRes31667,LRes6808,LRes34122,LCon90896],["Add20829","Res87454","Con32141","Res84911","Res23173","Dot85923","Glo28436","Res31667","Res6808","Res34122","Con90896"],Con90896,"Con90896")

Actual (Unparsed): [[[[[0.8307706, 0.5569735]]], [[[0.5903999, 0.1889838]]], [[[0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000]]], [[[1.3958522, 0.9358212]]], [[[0.9919839, 0.3175287]]], [[[0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000]]]]]

Expected (Unparsed): [[[[[0.8307706144821797,0.5569735251068373]]],[[[0.5903999190356782,0.18898385104843243]]],[[[0,0]]],[[[0,0]]],[[[1.3958522512538414,0.9358211946311485]]],[[[0.9919838782931755,0.31752872494292284]]],[[[0,0]]],[[[0,0]]]]]

Actual:   [[[[[0.8308, 0.557]]], [[[0.5904, 0.189]]], [[[0, 0]]], [[[0, 0]]], [[[1.3959, 0.9359]]], [[[0.992, 0.3176]]], [[[0, 0]]], [[[0, 0]]]]]

Expected: [[[[[0.8308, 0.557]]], [[[0.5904, 0.189]]], [[[0, 0]]], [[[0, 0]]], [[[1.3959, 0.9359]]], [[[0.992, 0.3176]]], [[[0, 0]]], [[[0, 0]]]]]