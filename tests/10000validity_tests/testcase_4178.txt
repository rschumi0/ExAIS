import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave61081 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Ave61081 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Dot22652 = tf.keras.layers.Input(shape=([3]))
in1Dot22652 = tf.keras.layers.Input(shape=([3]))
in0Max21530 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Max21530 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))

Ave61081 = keras.layers.Average(name = 'Ave61081', )([in0Ave61081,in1Ave61081])
PRe10526 = keras.layers.PReLU(name = 'PRe10526', )(Ave61081)
Sep26666 = keras.layers.SeparableConv2D(2, (2, 1),strides=(1, 1), padding='valid', name = 'Sep26666', )(PRe10526)
Res69578 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res69578', )(Sep26666)
Glo74799 = keras.layers.GlobalMaxPool3D(name = 'Glo74799', )(Res69578)
Res74990 = keras.layers.Reshape((1, 1), name = 'Res74990', )(Glo74799)
Res90593 = keras.layers.Reshape((1, 1, 1), name = 'Res90593', )(Res74990)
Res25924 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res25924', )(Res90593)
Zer39318 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (0, 0)), name = 'Zer39318', )(Res25924)
Dot22652 = keras.layers.Dot(axes=(1, 1), name = 'Dot22652', )([in0Dot22652,in1Dot22652])
Res53794 = keras.layers.Reshape((1, 1), name = 'Res53794', )(Dot22652)
Res2917 = keras.layers.Reshape((1, 1, 1), name = 'Res2917', )(Res53794)
Res12941 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res12941', )(Res2917)
Zer51732 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (0, 0)), name = 'Zer51732', )(Res12941)
Max21530 = keras.layers.Maximum(name = 'Max21530', )([in0Max21530,in1Max21530])
Sub34532 = keras.layers.Subtract(name = 'Sub34532', )([Zer51732,Max21530])
Ave38747 = keras.layers.Average(name = 'Ave38747', )([Zer39318,Sub34532])
model = tf.keras.models.Model(inputs=[in0Ave61081,in1Ave61081,in0Dot22652,in1Dot22652,in0Max21530,in1Max21530], outputs=Ave38747)
w = model.get_layer('PRe10526').get_weights() 
w[0] = np.array([[[0.865, 0.4235]], [[0.4898, 0.3588]]])
model.get_layer('PRe10526').set_weights(w) 
w = model.get_layer('Sep26666').get_weights() 
w[0] = np.array([[[[0.3881], [0.6979]]], [[[0.1951], [0.4684]]]])
w[1] = np.array([[[[0.772, 0.2615], [0.757, 0.5962]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep26666').set_weights(w) 
in0Ave61081 = tf.constant([[[[0.2998, 0.5647]], [[0.6736, 0.2869]]]])
in1Ave61081 = tf.constant([[[[0.8752, 0.4002]], [[0.225, 0.9274]]]])
in0Dot22652 = tf.constant([[0.0121, 0.2623, 0.1688]])
in1Dot22652 = tf.constant([[0.4863, 0.0245, 0.6456]])
in0Max21530 = tf.constant([[[[[0.6503]]], [[[0.4816]]]]])
in1Max21530 = tf.constant([[[[[0.9223]]], [[[0.2459]]]]])
print (np.array2string(model.predict([in0Ave61081,in1Ave61081,in0Dot22652,in1Dot22652,in0Max21530,in1Max21530],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave38747.png')

LAve61081 = average_layer([[[[[0.2998, 0.5647]], [[0.6736, 0.2869]]]], [[[[0.8752, 0.4002]], [[0.225, 0.9274]]]]], Ave61081), 
LPRe10526 = prelu_layer(Ave61081, [[[0.865, 0.4235]], [[0.4898, 0.3588]]], PRe10526), 
LSep26666 = separable_conv2D_layer(PRe10526, 2, 1,[[[[[0.3881], [0.6979]]], [[[0.1951], [0.4684]]]],[[[[0.772, 0.2615], [0.757, 0.5962]]]]],[0, 0], 1, 1, false, Sep26666), 
LRes69578 = reshape_layer(Sep26666, [1, 1, 2, 1], Res69578), 
LGlo74799 = global_max_pool3D_layer(Res69578, Glo74799), 
LRes74990 = reshape_layer(Glo74799, [1, 1], Res74990), 
LRes90593 = reshape_layer(Res74990, [1, 1, 1], Res90593), 
LRes25924 = reshape_layer(Res90593, [1, 1, 1, 1], Res25924), 
LZer39318 = zero_padding3D_layer(Res25924, 1, 0, 0, 0, 0, 0, Zer39318), 
LDot22652 = dot_layer([[0.0121, 0.2623, 0.1688]], [[0.4863, 0.0245, 0.6456]], 1, 1, Dot22652), 
LRes53794 = reshape_layer(Dot22652, [1, 1], Res53794), 
LRes2917 = reshape_layer(Res53794, [1, 1, 1], Res2917), 
LRes12941 = reshape_layer(Res2917, [1, 1, 1, 1], Res12941), 
LZer51732 = zero_padding3D_layer(Res12941, 1, 0, 0, 0, 0, 0, Zer51732), 
LMax21530 = maximum_layer([[[[[[0.6503]]], [[[0.4816]]]]], [[[[[0.9223]]], [[[0.2459]]]]]], Max21530), 
LSub34532 = subtract_layer(Zer51732,Max21530, Sub34532), 
LAve38747 = average_layer([Zer39318,Sub34532], Ave38747), 
exec_layers([LAve61081,LPRe10526,LSep26666,LRes69578,LGlo74799,LRes74990,LRes90593,LRes25924,LZer39318,LDot22652,LRes53794,LRes2917,LRes12941,LZer51732,LMax21530,LSub34532,LAve38747],["Ave61081","PRe10526","Sep26666","Res69578","Glo74799","Res74990","Res90593","Res25924","Zer39318","Dot22652","Res53794","Res2917","Res12941","Zer51732","Max21530","Sub34532","Ave38747"],Ave38747,"Ave38747")

Actual (Unparsed): [[[[[-0.4611500]]], [[[0.1767744]]]]]

Expected (Unparsed): [[[[[-0.46115]]],[[[0.17677437280749997]]]]]

Actual:   [[[[[-0.4611]]], [[[0.1768]]]]]

Expected: [[[[[-0.4611]]], [[[0.1768]]]]]