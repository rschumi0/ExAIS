import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot28341 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot28341 = tf.keras.layers.Input(shape=([2, 2]))

Dot28341 = keras.layers.Dot(axes=(1, 2), name = 'Dot28341', )([in0Dot28341,in1Dot28341])
Res47483 = keras.layers.Reshape((2, 2, 1), name = 'Res47483', )(Dot28341)
Max22504 = keras.layers.MaxPool2D(pool_size=(2, 2), strides=(1, 1), padding='valid', name = 'Max22504', )(Res47483)
Res7881 = keras.layers.Reshape((1, 1), name = 'Res7881', )(Max22504)
LST93858 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST93858', )(Res7881)
Res64113 = keras.layers.Reshape((2, 1), name = 'Res64113', )(LST93858)
Res95136 = keras.layers.Reshape((2, 1, 1), name = 'Res95136', )(Res64113)
Con89282 = keras.layers.Conv2D(3, (1, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con89282', )(Res95136)
model = tf.keras.models.Model(inputs=[in0Dot28341,in1Dot28341], outputs=Con89282)
w = model.get_layer('LST93858').get_weights() 
w[0] = np.array([[8, 5, 3, 10, 5, 4, 2, 9]])
w[1] = np.array([[1, 6, 5, 6, 10, 3, 3, 10], [4, 10, 10, 7, 1, 3, 2, 3]])
w[2] = np.array([8, 7, 1, 2, 3, 8, 7, 8])
model.get_layer('LST93858').set_weights(w) 
w = model.get_layer('Con89282').get_weights() 
w[0] = np.array([[[[0.5101, 0.9746, 0.8533]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con89282').set_weights(w) 
in0Dot28341 = tf.constant([[[0.072, 0.2675], [0.9693, 0.3825]]])
in1Dot28341 = tf.constant([[[0.7509, 0.7614], [0.3545, 0.0151]]])
print (np.array2string(model.predict([in0Dot28341,in1Dot28341],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con89282.png')

LDot28341 = dot_layer([[[0.072, 0.2675], [0.9693, 0.3825]]], [[[0.7509, 0.7614], [0.3545, 0.0151]]], 1, 2, Dot28341), 
LRes47483 = reshape_layer(Dot28341, [2, 2, 1], Res47483), 
LMax22504 = max_pool2D_layer(Res47483, 2, 2, 1, 1, false, Max22504), 
LRes7881 = reshape_layer(Max22504, [1, 1], Res7881), 
LLST93858 = lstm_layer(Res7881,[[8, 5, 3, 10, 5, 4, 2, 9]],[[1, 6, 5, 6, 10, 3, 3, 10], [4, 10, 10, 7, 1, 3, 2, 3]],[8, 7, 1, 2, 3, 8, 7, 8], LST93858), 
LRes64113 = reshape_layer(LST93858, [2, 1], Res64113), 
LRes95136 = reshape_layer(Res64113, [2, 1, 1], Res95136), 
LCon89282 = conv2D_layer(Res95136, 1, 1,[[[[0.5101, 0.9746, 0.8533]]]],[0, 0, 0], 1, 1, true, 1, 1, Con89282), 
exec_layers([LDot28341,LRes47483,LMax22504,LRes7881,LLST93858,LRes64113,LRes95136,LCon89282],["Dot28341","Res47483","Max22504","Res7881","LST93858","Res64113","Res95136","Con89282"],Con89282,"Con89282")

Actual (Unparsed): [[[[0.3884160, 0.7421099, 0.6497459]], [[0.3884854, 0.7422424, 0.6498619]]]]

Expected (Unparsed): [[[[0.3884160161980469,0.7421098792131279,0.6497459059435275]],[[0.38848535207154505,0.742242352732656,0.6498618916342862]]]]

Actual:   [[[[0.3885, 0.7422, 0.6498]], [[0.3885, 0.7423, 0.6499]]]]

Expected: [[[[0.3885, 0.7422, 0.6498]], [[0.3885, 0.7423, 0.6499]]]]