import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave69803 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Ave69803 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Con19949 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))

Ave69803 = keras.layers.Average(name = 'Ave69803', )([in0Ave69803,in1Ave69803])
Res62189 = keras.layers.Reshape((1, 2, 2), name = 'Res62189', )(Ave69803)
Sep17255 = keras.layers.SeparableConv2D(4, (1, 1),strides=(1, 1), padding='valid', name = 'Sep17255', )(Res62189)
Res87398 = keras.layers.Reshape((1, 8), name = 'Res87398', )(Sep17255)
Con19949 = keras.layers.Conv3D(4, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con19949', )(in0Con19949)
Res10326 = keras.layers.Reshape((1, 2, 8), name = 'Res10326', )(Con19949)
Res5529 = keras.layers.Reshape((1, 16), name = 'Res5529', )(Res10326)
Per24242 = keras.layers.Permute((1,2), name = 'Per24242',)(Res5529)
Dot68430 = keras.layers.Dot(axes=(1, 1), name = 'Dot68430', )([Res87398,Per24242])
model = tf.keras.models.Model(inputs=[in0Ave69803,in1Ave69803,in0Con19949], outputs=Dot68430)
w = model.get_layer('Sep17255').get_weights() 
w[0] = np.array([[[[0.1422], [0.9723]]]])
w[1] = np.array([[[[0.8567, 0.3158, 0.1624, 0.3703], [0.1769, 0.1197, 0.9606, 0.6802]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep17255').set_weights(w) 
w = model.get_layer('Con19949').get_weights() 
w[0] = np.array([[[[[0.5888, 0.2853, 0.0471, 0.1256]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con19949').set_weights(w) 
in0Ave69803 = tf.constant([[[[[0.0809, 0.268]], [[0.1138, 0.9443]]]]])
in1Ave69803 = tf.constant([[[[[0.2321, 0.6047]], [[0.844, 0.091]]]]])
in0Con19949 = tf.constant([[[[[0.94], [0.2476]], [[0.1349], [0.188]]]]])
print (np.array2string(model.predict([in0Ave69803,in1Ave69803,in0Con19949],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot68430.png')

LAve69803 = average_layer([[[[[[0.0809, 0.268]], [[0.1138, 0.9443]]]]], [[[[[0.2321, 0.6047]], [[0.844, 0.091]]]]]], Ave69803), 
LRes62189 = reshape_layer(Ave69803, [1, 2, 2], Res62189), 
LSep17255 = separable_conv2D_layer(Res62189, 1, 1,[[[[[0.1422], [0.9723]]]],[[[[0.8567, 0.3158, 0.1624, 0.3703], [0.1769, 0.1197, 0.9606, 0.6802]]]]],[0, 0, 0, 0], 1, 1, false, Sep17255), 
LRes87398 = reshape_layer(Sep17255, [1, 8], Res87398), 
LCon19949 = conv3D_layer([[[[[0.94], [0.2476]], [[0.1349], [0.188]]]]], 1, 1, 1,[[[[[0.5888, 0.2853, 0.0471, 0.1256]]]]],[0, 0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con19949), 
LRes10326 = reshape_layer(Con19949, [1, 2, 8], Res10326), 
LRes5529 = reshape_layer(Res10326, [1, 16], Res5529), 
LPer24242 = permute_layer(Res5529, 1,2, Per24242), 
LDot68430 = dot_layer(Res87398,Per24242, 1, 1, Dot68430), 
exec_layers([LAve69803,LRes62189,LSep17255,LRes87398,LCon19949,LRes10326,LRes5529,LPer24242,LDot68430],["Ave69803","Res62189","Sep17255","Res87398","Con19949","Res10326","Res5529","Per24242","Dot68430"],Dot68430,"Dot68430")

Actual (Unparsed): [[[0.0520913, 0.0252406, 0.0041670, 0.0111119, 0.0137211, 0.0066485, 0.0010976, 0.0029269, 0.0074757, 0.0036223, 0.0005980, 0.0015947, 0.0104183, 0.0050481, 0.0008334, 0.0022224], [0.0319974, 0.0155042, 0.0025596, 0.0068255, 0.0084283, 0.0040839, 0.0006742, 0.0017979, 0.0045920, 0.0022250, 0.0003673, 0.0009795, 0.0063995, 0.0031008, 0.0005119, 0.0013651], [0.2275662, 0.1102660, 0.0182038, 0.0485433, 0.0599419, 0.0290445, 0.0047949, 0.0127865, 0.0326582, 0.0158244, 0.0026124, 0.0069665, 0.0455132, 0.0220532, 0.0036408, 0.0097087], [0.1642841, 0.0796030, 0.0131416, 0.0350443, 0.0432731, 0.0209678, 0.0034616, 0.0092308, 0.0235765, 0.0114239, 0.0018860, 0.0050292, 0.0328568, 0.0159206, 0.0026283, 0.0070089], [0.0815688, 0.0395238, 0.0065250, 0.0173999, 0.0214856, 0.0104107, 0.0017187, 0.0045832, 0.0117060, 0.0056721, 0.0009364, 0.0024971, 0.0163138, 0.0079048, 0.0013050, 0.0034800], [0.0452475, 0.0219245, 0.0036195, 0.0096520, 0.0119184, 0.0057750, 0.0009534, 0.0025424, 0.0064935, 0.0031464, 0.0005194, 0.0013852, 0.0090495, 0.0043849, 0.0007239, 0.0019304], [0.2737140, 0.1326267, 0.0218953, 0.0583874, 0.0720974, 0.0349344, 0.0057673, 0.0153795, 0.0392809, 0.0190333, 0.0031422, 0.0083792, 0.0547428, 0.0265253, 0.0043791, 0.0116775], [0.2034394, 0.0985755, 0.0162738, 0.0433967, 0.0535868, 0.0259652, 0.0042866, 0.0114309, 0.0291957, 0.0141466, 0.0023355, 0.0062279, 0.0406879, 0.0197151, 0.0032548, 0.0086793]]]

Expected (Unparsed): [[[0.052091346766512385,0.02524059312582538,0.004166953859889153,0.011111876959704408,0.013721082403604751,0.006648479636121664,0.0010975933784133558,0.002926915675768948,0.007475662424258,0.003622293630504089,0.0005980022081904753,0.0015946725551746006,0.010418269353302477,0.005048118625165076,0.0008333907719778308,0.0022223753919408816],[0.03199743484865972,0.015504191851770748,0.0025595774140147296,0.006825539770705945,0.008428260498434197,0.004083870109040891,0.0006742035826702628,0.0017978762204540338,0.00459197229902574,0.0022250164689402913,0.00036732658845807124,0.0009795375692215232,0.006399486969731943,0.00310083837035415,0.0005119154828029459,0.001365107954141189],[0.22756623215545496,0.1102660428565749,0.01820375260618534,0.04854334028316091,0.05994191391669217,0.029044544905625476,0.004794945899246267,0.012786522397990044,0.03265817523167114,0.01582435019292761,0.0026124321559302154,0.0069664857491472405,0.045513246431090996,0.022053208571314983,0.003640750521237069,0.009708668056632182],[0.16428406699376183,0.07960299645604661,0.013141609299263217,0.03504429146470191,0.043273122327293,0.02096776800267781,0.0034615558111676303,0.009230815496447014,0.02357651131644518,0.011423876831830519,0.001885960738798519,0.00502922863679605,0.03285681339875236,0.015920599291209325,0.002628321859852644,0.007008858292940382],[0.08156884529444429,0.03952376284392825,0.006524953487378271,0.017399875966342057,0.021485580952025962,0.01041072731931557,0.0017187005143349575,0.0045832013715598864,0.011705997053426101,0.0056720804336658735,0.0009364002398375838,0.0024970673062335567,0.016313769058888858,0.007904752568785652,0.0013049906974756545,0.0034799751932684114],[0.04524754557735705,0.02192446459446326,0.0036194962579713273,0.00965199002125687,0.011918396047822985,0.005774997269775642,0.0009533907164613836,0.0025423752438970227,0.006493504147218581,0.003146393908290525,0.0005194362182982255,0.0013851632487952678,0.009049509115471411,0.0043848929188926525,0.0007238992515942656,0.0019303980042513745],[0.2737140482204513,0.13262672886768812,0.02189526438719983,0.05838737169919953,0.07209744504189759,0.03493444475280806,0.005767305810926253,0.015379482162470004,0.03928087777121158,0.01903334651516077,0.0031422033679077196,0.008379208981087252,0.05474280964409027,0.026525345773537625,0.004379052877439966,0.011677474339839908],[0.20343941595019932,0.09857551863211933,0.016273771214766284,0.04339672323937675,0.05358680786092483,0.025965211077992285,0.004286580588059715,0.011430881568159239,0.02919572043795945,0.014146635599439253,0.0023354592945446506,0.006227891452119068,0.04068788319003987,0.019715103726423867,0.0032547542429532572,0.008679344647875351]]]

Actual:   [[[0.0521, 0.0253, 0.0042, 0.0112, 0.0138, 0.0067, 0.0011, 0.003, 0.0075, 0.0037, 0.0006, 0.0016, 0.0105, 0.0051, 0.0009, 0.0023], [0.032, 0.0156, 0.0026, 0.0069, 0.0085, 0.0041, 0.0007, 0.0018, 0.0046, 0.0023, 0.0004, 0.001, 0.0064, 0.0032, 0.0006, 0.0014], [0.2276, 0.1103, 0.0183, 0.0486, 0.06, 0.0291, 0.0048, 0.0128, 0.0327, 0.0159, 0.0027, 0.007, 0.0456, 0.0221, 0.0037, 0.0098], [0.1643, 0.0797, 0.0132, 0.0351, 0.0433, 0.021, 0.0035, 0.0093, 0.0236, 0.0115, 0.0019, 0.0051, 0.0329, 0.016, 0.0027, 0.0071], [0.0816, 0.0396, 0.0066, 0.0174, 0.0215, 0.0105, 0.0018, 0.0046, 0.0118, 0.0057, 0.001, 0.0025, 0.0164, 0.008, 0.0014, 0.0035], [0.0453, 0.022, 0.0037, 0.0097, 0.012, 0.0058, 0.001, 0.0026, 0.0065, 0.0032, 0.0006, 0.0014, 0.0091, 0.0044, 0.0008, 0.002], [0.2738, 0.1327, 0.0219, 0.0584, 0.0721, 0.035, 0.0058, 0.0154, 0.0393, 0.0191, 0.0032, 0.0084, 0.0548, 0.0266, 0.0044, 0.0117], [0.2035, 0.0986, 0.0163, 0.0434, 0.0536, 0.026, 0.0043, 0.0115, 0.0292, 0.0142, 0.0024, 0.0063, 0.0407, 0.0198, 0.0033, 0.0087]]]

Expected: [[[0.0521, 0.0253, 0.0042, 0.0112, 0.0138, 0.0067, 0.0011, 0.003, 0.0075, 0.0037, 0.0006, 0.0016, 0.0105, 0.0051, 0.0009, 0.0023], [0.032, 0.0156, 0.0026, 0.0069, 0.0085, 0.0041, 0.0007, 0.0018, 0.0046, 0.0023, 0.0004, 0.001, 0.0064, 0.0032, 0.0006, 0.0014], [0.2276, 0.1103, 0.0183, 0.0486, 0.06, 0.0291, 0.0048, 0.0128, 0.0327, 0.0159, 0.0027, 0.007, 0.0456, 0.0221, 0.0037, 0.0098], [0.1643, 0.0797, 0.0132, 0.0351, 0.0433, 0.021, 0.0035, 0.0093, 0.0236, 0.0115, 0.0019, 0.0051, 0.0329, 0.016, 0.0027, 0.0071], [0.0816, 0.0396, 0.0066, 0.0174, 0.0215, 0.0105, 0.0018, 0.0046, 0.0118, 0.0057, 0.001, 0.0025, 0.0164, 0.008, 0.0014, 0.0035], [0.0453, 0.022, 0.0037, 0.0097, 0.012, 0.0058, 0.001, 0.0026, 0.0065, 0.0032, 0.0006, 0.0014, 0.0091, 0.0044, 0.0008, 0.002], [0.2738, 0.1327, 0.0219, 0.0584, 0.0721, 0.035, 0.0058, 0.0154, 0.0393, 0.0191, 0.0032, 0.0084, 0.0548, 0.0266, 0.0044, 0.0117], [0.2035, 0.0986, 0.0163, 0.0434, 0.0536, 0.026, 0.0043, 0.0115, 0.0292, 0.0142, 0.0024, 0.0063, 0.0407, 0.0198, 0.0033, 0.0087]]]