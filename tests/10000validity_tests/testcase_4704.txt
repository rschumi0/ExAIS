import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sep16859 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Thr78117 = tf.keras.layers.Input(shape=([2, 2, 2]))

Sep16859 = keras.layers.SeparableConv2D(2, (2, 1),strides=(1, 1), padding='valid', name = 'Sep16859', )(in0Sep16859)
Fla2280 = keras.layers.Flatten(name = 'Fla2280', )(Sep16859)
Res7048 = keras.layers.Reshape((4, 1), name = 'Res7048', )(Fla2280)
Thr78117 = keras.layers.ThresholdedReLU(theta=2.920897474333614, name = 'Thr78117', input_shape=(2, 2, 2))(in0Thr78117)
Cro31039 = keras.layers.Cropping2D(cropping=((0, 0), (0, 1)), name = 'Cro31039', )(Thr78117)
Res44783 = keras.layers.Reshape((4, 1), name = 'Res44783', )(Cro31039)
Ave84469 = keras.layers.Average(name = 'Ave84469', )([Res7048,Res44783])
Res80308 = keras.layers.Reshape((4, 1, 1), name = 'Res80308', )(Ave84469)
Res328 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res328', )(Res80308)
Con45669 = keras.layers.Conv3D(2, (3, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con45669', )(Res328)
model = tf.keras.models.Model(inputs=[in0Sep16859,in0Thr78117], outputs=Con45669)
w = model.get_layer('Sep16859').get_weights() 
w[0] = np.array([[[[0.0215], [0.1903]]], [[[0.7564], [0.6889]]]])
w[1] = np.array([[[[0.6177, 0.9859], [0.6245, 0.6263]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep16859').set_weights(w) 
w = model.get_layer('Con45669').get_weights() 
w[0] = np.array([[[[[0.016, 0.0796]]]], [[[[0.7118, 0.1559]]]], [[[[0.0473, 0.6395]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con45669').set_weights(w) 
in0Sep16859 = tf.constant([[[[0.5172, 0.3072], [0.5403, 0.4288]], [[0.1492, 0.7276], [0.166, 0.2732]]]])
in0Thr78117 = tf.constant([[[[0.9729, 0.0745], [0.7333, 0.945]], [[0.6603, 0.1546], [0.9327, 0.8796]]]])
print (np.array2string(model.predict([in0Sep16859,in0Thr78117],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con45669.png')

LSep16859 = separable_conv2D_layer([[[[0.5172, 0.3072], [0.5403, 0.4288]], [[0.1492, 0.7276], [0.166, 0.2732]]]], 2, 1,[[[[[0.0215], [0.1903]]], [[[0.7564], [0.6889]]]],[[[[0.6177, 0.9859], [0.6245, 0.6263]]]]],[0, 0], 1, 1, false, Sep16859), 
LFla2280 = flatten_layer(Sep16859, Fla2280), 
LRes7048 = reshape_layer(Fla2280, [4, 1], Res7048), 
LThr78117 = thresholded_relu_layer([[[[0.9729, 0.0745], [0.7333, 0.945]], [[0.6603, 0.1546], [0.9327, 0.8796]]]], 2.920897474333614, Thr78117), 
LCro31039 = cropping2D_layer(Thr78117, 0, 0, 0, 1, Cro31039), 
LRes44783 = reshape_layer(Cro31039, [4, 1], Res44783), 
LAve84469 = average_layer([Res7048,Res44783], Ave84469), 
LRes80308 = reshape_layer(Ave84469, [4, 1, 1], Res80308), 
LRes328 = reshape_layer(Res80308, [4, 1, 1, 1], Res328), 
LCon45669 = conv3D_layer(Res328, 3, 1, 1,[[[[[0.016, 0.0796]]]], [[[[0.7118, 0.1559]]]], [[[[0.0473, 0.6395]]]]],[0, 0], 1, 1, 1, true, 1, 1, 1, Con45669), 
exec_layers([LSep16859,LFla2280,LRes7048,LThr78117,LCro31039,LRes44783,LAve84469,LRes80308,LRes328,LCon45669],["Sep16859","Fla2280","Res7048","Thr78117","Cro31039","Res44783","Ave84469","Res80308","Res328","Con45669"],Con45669,"Con45669")

Actual (Unparsed): [[[[[0.1628350, 0.1843835]]], [[[0.1776563, 0.1347822]]], [[[0.1011018, 0.1358316]]], [[[0.1102997, 0.0337929]]]]]

Expected (Unparsed): [[[[[0.1628350275593372,0.1843835289027632]]],[[[0.17765634817244005,0.13478216519731495]]],[[[0.10110183652690165,0.1358316212022676]]],[[[0.11029968336977888,0.03379294987553245]]]]]

Actual:   [[[[[0.1629, 0.1844]]], [[[0.1777, 0.1348]]], [[[0.1012, 0.1359]]], [[[0.1103, 0.0338]]]]]

Expected: [[[[[0.1629, 0.1844]]], [[[0.1777, 0.1348]]], [[[0.1012, 0.1359]]], [[[0.1103, 0.0338]]]]]