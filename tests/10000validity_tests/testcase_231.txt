import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Thr31322 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con46728 = tf.keras.layers.Input(shape=([1, 4]))
in0Min16347 = tf.keras.layers.Input(shape=([2, 1]))
in1Min16347 = tf.keras.layers.Input(shape=([2, 1]))
in0Con18566 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Con5845 = tf.keras.layers.Input(shape=([1, 6, 1, 1]))
in0Con14946 = tf.keras.layers.Input(shape=([1, 1]))
in0Con9334 = tf.keras.layers.Input(shape=([1, 3, 1, 1]))
in0Add43428 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Add43428 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))

Thr31322 = keras.layers.ThresholdedReLU(theta=9.580846757893836, name = 'Thr31322', input_shape=(1, 2, 1))(in0Thr31322)
Res40780 = keras.layers.Reshape((1, 2), name = 'Res40780', )(Thr31322)
Con46728 = keras.layers.Concatenate(axis=2, name = 'Con46728', )([Res40780,in0Con46728])
Min16347 = keras.layers.Minimum(name = 'Min16347', )([in0Min16347,in1Min16347])
Mas8821 = keras.layers.Masking(mask_value=1, name = 'Mas8821', )(Min16347)
Con18566 = keras.layers.Conv3D(3, (1, 1, 2),strides=(1, 1, 10), padding='same', dilation_rate=(1, 1, 1), name = 'Con18566', )(in0Con18566)
Res48570 = keras.layers.Reshape((1, 2, 3), name = 'Res48570', )(Con18566)
Res67339 = keras.layers.Reshape((1, 6), name = 'Res67339', )(Res48570)
Zer53155 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer53155', )(Res67339)
Dot26957 = keras.layers.Dot(axes=(1, 1), name = 'Dot26957', )([Mas8821,Zer53155])
Ave32386 = keras.layers.Average(name = 'Ave32386', )([Con46728,Dot26957])
Res10418 = keras.layers.Reshape((1, 6, 1), name = 'Res10418', )(Ave32386)
Res93194 = keras.layers.Reshape((1, 6, 1, 1), name = 'Res93194', )(Res10418)
Con5845 = keras.layers.Concatenate(axis=4, name = 'Con5845', )([Res93194,in0Con5845])
Con14946 = keras.layers.Conv1D(3, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con14946', )(in0Con14946)
Res87549 = keras.layers.Reshape((1, 3, 1), name = 'Res87549', )(Con14946)
Res1478 = keras.layers.Reshape((1, 3, 1, 1), name = 'Res1478', )(Res87549)
Con9334 = keras.layers.Concatenate(axis=4, name = 'Con9334', )([Res1478,in0Con9334])
Add43428 = keras.layers.Add(name = 'Add43428', )([in0Add43428,in1Add43428])
Zer56626 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer56626', )(Add43428)
Add75196 = keras.layers.Add(name = 'Add75196', )([Con9334,Zer56626])
Con47167 = keras.layers.Conv3DTranspose(2, (1, 1, 1),strides=(1, 2, 1), padding='same', name = 'Con47167', )(Add75196)
Min22264 = keras.layers.Minimum(name = 'Min22264', )([Con5845,Con47167])
model = tf.keras.models.Model(inputs=[in0Thr31322,in0Con46728,in0Min16347,in1Min16347,in0Con18566,in0Con5845,in0Con14946,in0Con9334,in0Add43428,in1Add43428], outputs=Min22264)
w = model.get_layer('Con18566').get_weights() 
w[0] = np.array([[[[[0.1592, 0.6526, 0.963]], [[0.0093, 0.6096, 0.7478]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con18566').set_weights(w) 
w = model.get_layer('Con14946').get_weights() 
w[0] = np.array([[[0.1397, 0.8427, 0.0633]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con14946').set_weights(w) 
w = model.get_layer('Con47167').get_weights() 
w[0] = np.array([[[[[0.5826, 0.3065], [0.2592, 0.4587]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con47167').set_weights(w) 
in0Thr31322 = tf.constant([[[[0.0592], [0.0044]]]])
in0Con46728 = tf.constant([[[0.2407, 0.1773, 0.9024, 0.6705]]])
in0Min16347 = tf.constant([[[0.4044], [0.9889]]])
in1Min16347 = tf.constant([[[0.3709], [0.9618]]])
in0Con18566 = tf.constant([[[[[0.2678], [0.5437]], [[0.3482], [0.2325]]]]])
in0Con5845 = tf.constant([[[[[0.6629]], [[0.5011]], [[0.1898]], [[0.2242]], [[0.576]], [[0.8529]]]]])
in0Con14946 = tf.constant([[[0.3723]]])
in0Con9334 = tf.constant([[[[[0.5201]], [[0.1687]], [[0.2226]]]]])
in0Add43428 = tf.constant([[[[[0.8745, 0.8937]]]]])
in1Add43428 = tf.constant([[[[[0.4368, 0.7352]]]]])
print (np.array2string(model.predict([in0Thr31322,in0Con46728,in0Min16347,in1Min16347,in0Con18566,in0Con5845,in0Con14946,in0Con9334,in0Add43428,in1Add43428],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min22264.png')

LThr31322 = thresholded_relu_layer([[[[0.0592], [0.0044]]]], 9.580846757893836, Thr31322), 
LRes40780 = reshape_layer(Thr31322, [1, 2], Res40780), 
LCon46728 = concatenate_layer([Res40780,[[[0.2407, 0.1773, 0.9024, 0.6705]]]], 2, Con46728), 
LMin16347 = minimum_layer([[[[0.4044], [0.9889]]], [[[0.3709], [0.9618]]]], Min16347), 
LMas8821 = masking_layer(Min16347, 1, Mas8821), 
LCon18566 = conv3D_layer([[[[[0.2678], [0.5437]], [[0.3482], [0.2325]]]]], 1, 1, 2,[[[[[0.1592, 0.6526, 0.963]], [[0.0093, 0.6096, 0.7478]]]]],[0, 0, 0], 1, 1, 10, true, 1, 1, 1, Con18566), 
LRes48570 = reshape_layer(Con18566, [1, 2, 3], Res48570), 
LRes67339 = reshape_layer(Res48570, [1, 6], Res67339), 
LZer53155 = zero_padding1D_layer(Res67339, 1, 0, Zer53155), 
LDot26957 = dot_layer(Mas8821,Zer53155, 1, 1, Dot26957), 
LAve32386 = average_layer([Con46728,Dot26957], Ave32386), 
LRes10418 = reshape_layer(Ave32386, [1, 6, 1], Res10418), 
LRes93194 = reshape_layer(Res10418, [1, 6, 1, 1], Res93194), 
LCon5845 = concatenate_layer([Res93194,[[[[[0.6629]], [[0.5011]], [[0.1898]], [[0.2242]], [[0.576]], [[0.8529]]]]]], 4, Con5845), 
LCon14946 = conv1D_layer([[[0.3723]]], 1,[[[0.1397, 0.8427, 0.0633]]],[0, 0, 0], 1, true, 1, Con14946), 
LRes87549 = reshape_layer(Con14946, [1, 3, 1], Res87549), 
LRes1478 = reshape_layer(Res87549, [1, 3, 1, 1], Res1478), 
LCon9334 = concatenate_layer([Res1478,[[[[[0.5201]], [[0.1687]], [[0.2226]]]]]], 4, Con9334), 
LAdd43428 = add_layer([[[[[[0.8745, 0.8937]]]]], [[[[[0.4368, 0.7352]]]]]], Add43428), 
LZer56626 = zero_padding3D_layer(Add43428, 0, 0, 2, 0, 0, 0, Zer56626), 
LAdd75196 = add_layer([Con9334,Zer56626], Add75196), 
LCon47167 = conv3D_transpose_layer(Add75196, 1, 1, 1,[[[[[0.5826, 0.3065], [0.2592, 0.4587]]]]],[0, 0], 1, 2, 1, true, Con47167), 
LMin22264 = minimum_layer([Con5845,Con47167], Min22264), 
exec_layers([LThr31322,LRes40780,LCon46728,LMin16347,LMas8821,LCon18566,LRes48570,LRes67339,LZer53155,LDot26957,LAve32386,LRes10418,LRes93194,LCon5845,LCon14946,LRes87549,LRes1478,LCon9334,LAdd43428,LZer56626,LAdd75196,LCon47167,LMin22264],["Thr31322","Res40780","Con46728","Min16347","Mas8821","Con18566","Res48570","Res67339","Zer53155","Dot26957","Ave32386","Res10418","Res93194","Con5845","Con14946","Res87549","Res1478","Con9334","Add43428","Zer56626","Add75196","Con47167","Min22264"],Min22264,"Min22264")

Actual (Unparsed): [[[[[0.0229342, 0.2520509]], [[0.0000000, 0.0000000]], [[0.2344898, 0.1587034]], [[0.0000000, 0.0000000]], [[0.6286364, 0.5760000]], [[0.0000000, 0.0000000]]]]]

Expected (Unparsed): [[[[[0.022934202753,0.252050942352]],[[0,0]],[[0.23448984854600002,0.15870337483199998]],[[0,0]],[[0.6286363841879999,0.576]],[[0,0]]]]]

Actual:   [[[[[0.023, 0.2521]], [[0, 0]], [[0.2345, 0.1588]], [[0, 0]], [[0.6287, 0.576]], [[0, 0]]]]]

Expected: [[[[[0.023, 0.2521]], [[0, 0]], [[0.2345, 0.1588]], [[0, 0]], [[0.6287, 0.576]], [[0, 0]]]]]