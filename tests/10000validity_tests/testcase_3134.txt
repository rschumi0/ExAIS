import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub62047 = tf.keras.layers.Input(shape=([3, 3]))
in1Sub62047 = tf.keras.layers.Input(shape=([3, 3]))
in0Add31657 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Add31657 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con58784 = tf.keras.layers.Input(shape=([3, 1]))
in0Max67336 = tf.keras.layers.Input(shape=([2, 2]))
in1Max67336 = tf.keras.layers.Input(shape=([2, 2]))

Sub62047 = keras.layers.Subtract(name = 'Sub62047', )([in0Sub62047,in1Sub62047])
Res60955 = keras.layers.Reshape((3, 3, 1), name = 'Res60955', )(Sub62047)
Add31657 = keras.layers.Add(name = 'Add31657', )([in0Add31657,in1Add31657])
Zer17025 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer17025', )(Add31657)
Ave75781 = keras.layers.Average(name = 'Ave75781', )([Res60955,Zer17025])
Res61711 = keras.layers.Reshape((3, 3), name = 'Res61711', )(Ave75781)
Con58784 = keras.layers.Concatenate(axis=2, name = 'Con58784', )([Res61711,in0Con58784])
Max67336 = keras.layers.Maximum(name = 'Max67336', )([in0Max67336,in1Max67336])
Res52461 = keras.layers.Reshape((2, 2, 1), name = 'Res52461', )(Max67336)
Res55644 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res55644', )(Res52461)
Up_87006 = keras.layers.UpSampling3D(size=(1, 1, 2), name = 'Up_87006', )(Res55644)
Res54303 = keras.layers.Reshape((2, 2, 2), name = 'Res54303', )(Up_87006)
Res91437 = keras.layers.Reshape((2, 4), name = 'Res91437', )(Res54303)
Dot8663 = keras.layers.Dot(axes=(2, 2), name = 'Dot8663', )([Con58784,Res91437])
model = tf.keras.models.Model(inputs=[in0Sub62047,in1Sub62047,in0Add31657,in1Add31657,in0Con58784,in0Max67336,in1Max67336], outputs=Dot8663)
in0Sub62047 = tf.constant([[[0.1076, 0.4896, 0.8155], [0.7582, 0.1382, 0.5844], [0.1262, 0.6307, 0.2597]]])
in1Sub62047 = tf.constant([[[0.0276, 0.7107, 0.93], [0.3324, 0.9464, 0.9521], [0.8667, 0.7555, 0.4252]]])
in0Add31657 = tf.constant([[[[0.8193]], [[0.5247]]]])
in1Add31657 = tf.constant([[[[0.441]], [[0.3579]]]])
in0Con58784 = tf.constant([[[0.7489], [0.8203], [0.0638]]])
in0Max67336 = tf.constant([[[0.5231, 0.1775], [0.213, 0.3045]]])
in1Max67336 = tf.constant([[[0.4892, 0.0939], [0.7716, 0.502]]])
print (np.array2string(model.predict([in0Sub62047,in1Sub62047,in0Add31657,in1Add31657,in0Con58784,in0Max67336,in1Max67336],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot8663.png')

LSub62047 = subtract_layer([[[0.1076, 0.4896, 0.8155], [0.7582, 0.1382, 0.5844], [0.1262, 0.6307, 0.2597]]], [[[0.0276, 0.7107, 0.93], [0.3324, 0.9464, 0.9521], [0.8667, 0.7555, 0.4252]]], Sub62047), 
LRes60955 = reshape_layer(Sub62047, [3, 3, 1], Res60955), 
LAdd31657 = add_layer([[[[[0.8193]], [[0.5247]]]], [[[[0.441]], [[0.3579]]]]], Add31657), 
LZer17025 = zero_padding2D_layer(Add31657, 1, 0, 2, 0, Zer17025), 
LAve75781 = average_layer([Res60955,Zer17025], Ave75781), 
LRes61711 = reshape_layer(Ave75781, [3, 3], Res61711), 
LCon58784 = concatenate_layer([Res61711,[[[0.7489], [0.8203], [0.0638]]]], 2, Con58784), 
LMax67336 = maximum_layer([[[[0.5231, 0.1775], [0.213, 0.3045]]], [[[0.4892, 0.0939], [0.7716, 0.502]]]], Max67336), 
LRes52461 = reshape_layer(Max67336, [2, 2, 1], Res52461), 
LRes55644 = reshape_layer(Res52461, [2, 2, 1, 1], Res55644), 
LUp_87006 = up_sampling3D_layer(Res55644, 1, 1, 2, Up_87006), 
LRes54303 = reshape_layer(Up_87006, [2, 2, 2], Res54303), 
LRes91437 = reshape_layer(Res54303, [2, 4], Res91437), 
LDot8663 = dot_layer(Con58784,Res91437, 2, 2, Dot8663), 
exec_layers([LSub62047,LRes60955,LAdd31657,LZer17025,LAve75781,LRes61711,LCon58784,LMax67336,LRes52461,LRes55644,LUp_87006,LRes54303,LRes91437,LDot8663],["Sub62047","Res60955","Add31657","Zer17025","Ave75781","Res61711","Con58784","Max67336","Res52461","Res55644","Up_87006","Res54303","Res91437","Dot8663"],Dot8663,"Dot8663")

Actual (Unparsed): [[[0.0858632, 0.2927719], [0.1248048, 0.4883032], [-0.1513521, -0.1218131]]]

Expected (Unparsed): [[[0.08586316999999997,0.29277191999999996],[0.12480477999999999,0.48830328],[-0.15135209000000002,-0.12181303999999996]]]

Actual:   [[[0.0859, 0.2928], [0.1249, 0.4884], [-0.1513, -0.1218]]]

Expected: [[[0.0859, 0.2928], [0.1249, 0.4884], [-0.1513, -0.1218]]]