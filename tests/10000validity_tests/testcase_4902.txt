import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul57274 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Mul57274 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con96425 = tf.keras.layers.Input(shape=([1, 2, 3]))
in0Con5706 = tf.keras.layers.Input(shape=([1, 2, 2]))

Mul57274 = keras.layers.Multiply(name = 'Mul57274', )([in0Mul57274,in1Mul57274])
Con96425 = keras.layers.Concatenate(axis=3, name = 'Con96425', )([Mul57274,in0Con96425])
Con5706 = keras.layers.Conv2DTranspose(4, (1, 2),strides=(1, 1), padding='same', name = 'Con5706', )(in0Con5706)
Mul86785 = keras.layers.Multiply(name = 'Mul86785', )([Con96425,Con5706])
Res89088 = keras.layers.Reshape((1, 8), name = 'Res89088', )(Mul86785)
Sim6146 = keras.layers.SimpleRNN(2,name = 'Sim6146', )(Res89088)
Fla81473 = keras.layers.Flatten(name = 'Fla81473', )(Sim6146)
model = tf.keras.models.Model(inputs=[in0Mul57274,in1Mul57274,in0Con96425,in0Con5706], outputs=Fla81473)
w = model.get_layer('Con5706').get_weights() 
w[0] = np.array([[[[0.3454, 0.3544], [0.6955, 0.0286], [0.5213, 0.7168], [0.5715, 0.8422]], [[0.0413, 0.641], [0.4835, 0.2395], [0.7865, 0.273], [0.5237, 0.4044]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con5706').set_weights(w) 
w = model.get_layer('Sim6146').get_weights() 
w[0] = np.array([[3, 4], [2, 2], [10, 2], [5, 6], [1, 9], [8, 5], [1, 5], [4, 4]])
w[1] = np.array([[10, 8], [10, 9]])
w[2] = np.array([9, 2])
model.get_layer('Sim6146').set_weights(w) 
in0Mul57274 = tf.constant([[[[0.342], [0.8809]]]])
in1Mul57274 = tf.constant([[[[0.448], [0.0749]]]])
in0Con96425 = tf.constant([[[[0.7868, 0.9498, 0.1565], [0.1919, 0.1818, 0.9686]]]])
in0Con5706 = tf.constant([[[[0.8721, 0.6513], [0.4861, 0.373]]]])
print (np.array2string(model.predict([in0Mul57274,in1Mul57274,in0Con96425,in0Con5706],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Fla81473.png')

LMul57274 = multiply_layer([[[[[0.342], [0.8809]]]], [[[[0.448], [0.0749]]]]], Mul57274), 
LCon96425 = concatenate_layer([Mul57274,[[[[0.7868, 0.9498, 0.1565], [0.1919, 0.1818, 0.9686]]]]], 3, Con96425), 
LCon5706 = conv2D_transpose_layer([[[[0.8721, 0.6513], [0.4861, 0.373]]]], 1, 2,[[[[0.3454, 0.3544], [0.6955, 0.0286], [0.5213, 0.7168], [0.5715, 0.8422]], [[0.0413, 0.641], [0.4835, 0.2395], [0.7865, 0.273], [0.5237, 0.4044]]]],[0, 0, 0, 0], 1, 1, true, Con5706), 
LMul86785 = multiply_layer([Con96425,Con5706], Mul86785), 
LRes89088 = reshape_layer(Mul86785, [1, 8], Res89088), 
LSim6146 = simple_rnn_layer(Res89088,[[3, 4], [2, 2], [10, 2], [5, 6], [1, 9], [8, 5], [1, 5], [4, 4]],[[10, 8], [10, 9]],[9, 2], Sim6146), 
LFla81473 = flatten_layer(Sim6146, Fla81473), 
exec_layers([LMul57274,LCon96425,LCon5706,LMul86785,LRes89088,LSim6146,LFla81473],["Mul57274","Con96425","Con5706","Mul86785","Res89088","Sim6146","Fla81473"],Fla81473,"Fla81473")

Actual (Unparsed): [[1.0000000, 1.0000000]]

Expected (Unparsed): [[1.0,0.9999999999975869]]

Actual:   [[1, 1]]

Expected: [[1, 1]]