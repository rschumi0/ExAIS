import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave97497 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Ave97497 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con60583 = tf.keras.layers.Input(shape=([1, 4]))
in0Max56243 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Max56243 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))

Ave97497 = keras.layers.Average(name = 'Ave97497', )([in0Ave97497,in1Ave97497])
Res20424 = keras.layers.Reshape((1, 4), name = 'Res20424', )(Ave97497)
Con60583 = keras.layers.Concatenate(axis=2, name = 'Con60583', )([Res20424,in0Con60583])
Max56243 = keras.layers.Maximum(name = 'Max56243', )([in0Max56243,in1Max56243])
Res71238 = keras.layers.Reshape((1, 2, 4), name = 'Res71238', )(Max56243)
Res27771 = keras.layers.Reshape((1, 8), name = 'Res27771', )(Res71238)
Ave18467 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave18467', )(Res27771)
Ave71795 = keras.layers.Average(name = 'Ave71795', )([Con60583,Ave18467])
model = tf.keras.models.Model(inputs=[in0Ave97497,in1Ave97497,in0Con60583,in0Max56243,in1Max56243], outputs=Ave71795)
in0Ave97497 = tf.constant([[[[0.6596, 0.9405], [0.0113, 0.0294]]]])
in1Ave97497 = tf.constant([[[[0.4722, 0.6103], [0.206, 0.1206]]]])
in0Con60583 = tf.constant([[[0.5924, 0.497, 0.3384, 0.7177]]])
in0Max56243 = tf.constant([[[[[0.3694, 0.8841], [0.9139, 0.5381]], [[0.8073, 0.7311], [0.3648, 0.3634]]]]])
in1Max56243 = tf.constant([[[[[0.2619, 0.7321], [0.8848, 0.8999]], [[0.257, 0.8348], [0.9519, 0.1889]]]]])
print (np.array2string(model.predict([in0Ave97497,in1Ave97497,in0Con60583,in0Max56243,in1Max56243],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave71795.png')

LAve97497 = average_layer([[[[[0.6596, 0.9405], [0.0113, 0.0294]]]], [[[[0.4722, 0.6103], [0.206, 0.1206]]]]], Ave97497), 
LRes20424 = reshape_layer(Ave97497, [1, 4], Res20424), 
LCon60583 = concatenate_layer([Res20424,[[[0.5924, 0.497, 0.3384, 0.7177]]]], 2, Con60583), 
LMax56243 = maximum_layer([[[[[[0.3694, 0.8841], [0.9139, 0.5381]], [[0.8073, 0.7311], [0.3648, 0.3634]]]]], [[[[[0.2619, 0.7321], [0.8848, 0.8999]], [[0.257, 0.8348], [0.9519, 0.1889]]]]]], Max56243), 
LRes71238 = reshape_layer(Max56243, [1, 2, 4], Res71238), 
LRes27771 = reshape_layer(Res71238, [1, 8], Res27771), 
LAve18467 = average_pooling1D_layer(Res27771, 1, Ave18467), 
LAve71795 = average_layer([Con60583,Ave18467], Ave71795), 
exec_layers([LAve97497,LRes20424,LCon60583,LMax56243,LRes71238,LRes27771,LAve18467,LAve71795],["Ave97497","Res20424","Con60583","Max56243","Res71238","Res27771","Ave18467","Ave71795"],Ave71795,"Ave71795")

Actual (Unparsed): [[[0.4676500, 0.8297500, 0.5112750, 0.4874500, 0.6998500, 0.6659000, 0.6451500, 0.5405500]]]

Expected (Unparsed): [[[0.46765,0.82975,0.511275,0.48745,0.6998500000000001,0.6658999999999999,0.64515,0.54055]]]

Actual:   [[[0.4677, 0.8298, 0.5113, 0.4875, 0.6999, 0.6659, 0.6452, 0.5406]]]

Expected: [[[0.4677, 0.8298, 0.5113, 0.4875, 0.6999, 0.6659, 0.6452, 0.5406]]]