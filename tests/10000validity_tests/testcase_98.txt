import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot45861 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot45861 = tf.keras.layers.Input(shape=([3, 3]))

Dot45861 = keras.layers.Dot(axes=(2, 1), name = 'Dot45861', )([in0Dot45861,in1Dot45861])
Sim2254 = keras.layers.SimpleRNN(1,name = 'Sim2254', )(Dot45861)
Res34130 = keras.layers.Reshape((1, 1), name = 'Res34130', )(Sim2254)
Up_15533 = keras.layers.UpSampling1D(size=(1), name = 'Up_15533', )(Res34130)
Res17807 = keras.layers.Reshape((1, 1, 1), name = 'Res17807', )(Up_15533)
Ave31380 = keras.layers.AveragePooling2D(pool_size=(1, 1), strides=(6, 1), padding='valid', name = 'Ave31380', )(Res17807)
model = tf.keras.models.Model(inputs=[in0Dot45861,in1Dot45861], outputs=Ave31380)
w = model.get_layer('Sim2254').get_weights() 
w[0] = np.array([[3], [8], [10]])
w[1] = np.array([[2]])
w[2] = np.array([3])
model.get_layer('Sim2254').set_weights(w) 
in0Dot45861 = tf.constant([[[0.4773, 0.0642, 0.9617], [0.4345, 0.738, 0.1194], [0.2421, 0.2684, 0.7955]]])
in1Dot45861 = tf.constant([[[0.9391, 0.5429, 0.9535], [0.7279, 0.351, 0.2367], [0.4155, 0.3852, 0.4018]]])
print (np.array2string(model.predict([in0Dot45861,in1Dot45861],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave31380.png')

LDot45861 = dot_layer([[[0.4773, 0.0642, 0.9617], [0.4345, 0.738, 0.1194], [0.2421, 0.2684, 0.7955]]], [[[0.9391, 0.5429, 0.9535], [0.7279, 0.351, 0.2367], [0.4155, 0.3852, 0.4018]]], 2, 1, Dot45861), 
LSim2254 = simple_rnn_layer(Dot45861,[[3], [8], [10]],[[2]],[3], Sim2254), 
LRes34130 = reshape_layer(Sim2254, [1, 1], Res34130), 
LUp_15533 = up_sampling1D_layer(Res34130, 1, Up_15533), 
LRes17807 = reshape_layer(Up_15533, [1, 1, 1], Res17807), 
LAve31380 = average_pooling2D_layer(Res17807, 1, 1, 6, 1, false, Ave31380), 
exec_layers([LDot45861,LSim2254,LRes34130,LUp_15533,LRes17807,LAve31380],["Dot45861","Sim2254","Res34130","Up_15533","Res17807","Ave31380"],Ave31380,"Ave31380")

Actual (Unparsed): [[[[1.0000000]]]]

Expected (Unparsed): [[[[0.9999999999999991]]]]

Actual:   [[[[1]]]]

Expected: [[[[1]]]]