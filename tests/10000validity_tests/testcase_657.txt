import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave63266 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in1Ave63266 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))

Ave63266 = keras.layers.Average(name = 'Ave63266', )([in0Ave63266,in1Ave63266])
Res51344 = keras.layers.Reshape((2, 1, 4), name = 'Res51344', )(Ave63266)
Res29531 = keras.layers.Reshape((2, 4), name = 'Res29531', )(Res51344)
Sim53026 = keras.layers.SimpleRNN(2,name = 'Sim53026', )(Res29531)
Res15952 = keras.layers.Reshape((2, 1), name = 'Res15952', )(Sim53026)
Res48499 = keras.layers.Reshape((2, 1, 1), name = 'Res48499', )(Res15952)
Con12472 = keras.layers.Conv2D(4, (1, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con12472', )(Res48499)
model = tf.keras.models.Model(inputs=[in0Ave63266,in1Ave63266], outputs=Con12472)
w = model.get_layer('Sim53026').get_weights() 
w[0] = np.array([[8, 9], [8, 9], [7, 3], [1, 6]])
w[1] = np.array([[5, 7], [9, 5]])
w[2] = np.array([10, 7])
model.get_layer('Sim53026').set_weights(w) 
w = model.get_layer('Con12472').get_weights() 
w[0] = np.array([[[[0.9281, 0.1842, 0.3021, 0.089]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con12472').set_weights(w) 
in0Ave63266 = tf.constant([[[[[0.7442, 0.851], [0.5583, 0.9088]]], [[[0.8311, 0.4856], [0.7724, 0.934]]]]])
in1Ave63266 = tf.constant([[[[[0.6046, 0.0278], [0.6721, 0.2219]]], [[[0.189, 0.9931], [0.4776, 0.9823]]]]])
print (np.array2string(model.predict([in0Ave63266,in1Ave63266],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con12472.png')

LAve63266 = average_layer([[[[[[0.7442, 0.851], [0.5583, 0.9088]]], [[[0.8311, 0.4856], [0.7724, 0.934]]]]], [[[[[0.6046, 0.0278], [0.6721, 0.2219]]], [[[0.189, 0.9931], [0.4776, 0.9823]]]]]], Ave63266), 
LRes51344 = reshape_layer(Ave63266, [2, 1, 4], Res51344), 
LRes29531 = reshape_layer(Res51344, [2, 4], Res29531), 
LSim53026 = simple_rnn_layer(Res29531,[[8, 9], [8, 9], [7, 3], [1, 6]],[[5, 7], [9, 5]],[10, 7], Sim53026), 
LRes15952 = reshape_layer(Sim53026, [2, 1], Res15952), 
LRes48499 = reshape_layer(Res15952, [2, 1, 1], Res48499), 
LCon12472 = conv2D_layer(Res48499, 1, 1,[[[[0.9281, 0.1842, 0.3021, 0.089]]]],[0, 0, 0, 0], 1, 1, false, 1, 1, Con12472), 
exec_layers([LAve63266,LRes51344,LRes29531,LSim53026,LRes15952,LRes48499,LCon12472],["Ave63266","Res51344","Res29531","Sim53026","Res15952","Res48499","Con12472"],Con12472,"Con12472")

Actual (Unparsed): [[[[0.9281000, 0.1842000, 0.3021000, 0.0890000]], [[0.9281000, 0.1842000, 0.3021000, 0.0890000]]]]

Expected (Unparsed): [[[[0.9281,0.1842,0.3021,0.089]],[[0.9281,0.1842,0.3021,0.089]]]]

Actual:   [[[[0.9281, 0.1842, 0.3021, 0.089]], [[0.9281, 0.1842, 0.3021, 0.089]]]]

Expected: [[[[0.9281, 0.1842, 0.3021, 0.089]], [[0.9281, 0.1842, 0.3021, 0.089]]]]