import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul74607 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Mul74607 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Add30771 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Add30771 = tf.keras.layers.Input(shape=([1, 1, 1]))

Mul74607 = keras.layers.Multiply(name = 'Mul74607', )([in0Mul74607,in1Mul74607])
Con6179 = keras.layers.Conv3DTranspose(2, (1, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con6179', )(Mul74607)
Res4937 = keras.layers.Reshape((1, 2, 4), name = 'Res4937', )(Con6179)
Res80163 = keras.layers.Reshape((1, 8), name = 'Res80163', )(Res4937)
Add30771 = keras.layers.Add(name = 'Add30771', )([in0Add30771,in1Add30771])
Res93744 = keras.layers.Reshape((1, 1), name = 'Res93744', )(Add30771)
Dot45762 = keras.layers.Dot(axes=(1, 1), name = 'Dot45762', )([Res80163,Res93744])
Res28503 = keras.layers.Reshape((8, 1, 1), name = 'Res28503', )(Dot45762)
Res87026 = keras.layers.Reshape((8, 1, 1, 1), name = 'Res87026', )(Res28503)
Con12939 = keras.layers.Conv3DTranspose(2, (7, 1, 1),strides=(1, 1, 12), padding='same', name = 'Con12939', )(Res87026)
model = tf.keras.models.Model(inputs=[in0Mul74607,in1Mul74607,in0Add30771,in1Add30771], outputs=Con12939)
w = model.get_layer('Con6179').get_weights() 
w[0] = np.array([[[[[0.3824], [0.9563]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con6179').set_weights(w) 
w = model.get_layer('Con12939').get_weights() 
w[0] = np.array([[[[[0.7454], [0.2245]]]], [[[[0.8055], [0.5125]]]], [[[[0.307], [0.307]]]], [[[[0.0915], [0.4709]]]], [[[[0.2766], [0.1767]]]], [[[[0.2656], [0.4001]]]], [[[[0.2689], [0.8362]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con12939').set_weights(w) 
in0Mul74607 = tf.constant([[[[[0.0021], [0.1998]], [[0.1555], [0.2321]]]]])
in1Mul74607 = tf.constant([[[[[0.6171], [0.1227]], [[0.9364], [0.5548]]]]])
in0Add30771 = tf.constant([[[[0.6596]]]])
in1Add30771 = tf.constant([[[[0.9268]]]])
print (np.array2string(model.predict([in0Mul74607,in1Mul74607,in0Add30771,in1Add30771],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con12939.png')

LMul74607 = multiply_layer([[[[[[0.0021], [0.1998]], [[0.1555], [0.2321]]]]], [[[[[0.6171], [0.1227]], [[0.9364], [0.5548]]]]]], Mul74607), 
LCon6179 = conv3D_transpose_layer(Mul74607, 1, 1, 1,[[[[[0.3824], [0.9563]]]]],[0, 0], 1, 1, 1, false, Con6179), 
LRes4937 = reshape_layer(Con6179, [1, 2, 4], Res4937), 
LRes80163 = reshape_layer(Res4937, [1, 8], Res80163), 
LAdd30771 = add_layer([[[[[0.6596]]]], [[[[0.9268]]]]], Add30771), 
LRes93744 = reshape_layer(Add30771, [1, 1], Res93744), 
LDot45762 = dot_layer(Res80163,Res93744, 1, 1, Dot45762), 
LRes28503 = reshape_layer(Dot45762, [8, 1, 1], Res28503), 
LRes87026 = reshape_layer(Res28503, [8, 1, 1, 1], Res87026), 
LCon12939 = conv3D_transpose_layer(Res87026, 7, 1, 1,[[[[[0.7454], [0.2245]]]], [[[[0.8055], [0.5125]]]], [[[[0.307], [0.307]]]], [[[[0.0915], [0.4709]]]], [[[[0.2766], [0.1767]]]], [[[[0.2656], [0.4001]]]], [[[[0.2689], [0.8362]]]]],[0, 0], 1, 1, 12, true, Con12939), 
exec_layers([LMul74607,LCon6179,LRes4937,LRes80163,LAdd30771,LRes93744,LDot45762,LRes28503,LRes87026,LCon12939],["Mul74607","Con6179","Res4937","Res80163","Add30771","Res93744","Dot45762","Res28503","Res87026","Con12939"],Con12939,"Con12939")

Actual (Unparsed): [[[[[0.0403777, 0.0169452], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]]], [[[0.1007644, 0.0445219], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]]], [[[0.2493434, 0.1139460], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]]], [[[0.2715325, 0.1794528], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]]], [[[0.2992035, 0.2074700], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]]], [[[0.2398606, 0.2710471], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]]], [[[0.1616842, 0.2022332], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]]], [[[0.1219059, 0.2680412], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]]]]]

Expected (Unparsed): [[[[[0.04037767175380301,0.01694523298214031],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]]],[[[0.10076435680223055,0.04452193124883032],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]]],[[[0.24934336971477,0.11394603517808177],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]]],[[[0.27153252449395116,0.1794528087443009],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]]],[[[0.29920346403362075,0.20746999925964488],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]]],[[[0.23986057021881732,0.27104713310636946],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]]],[[[0.16168422943247823,0.20223319531006362],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]]],[[[0.12190587445469085,0.2680411891009743],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]]]]]

Actual:   [[[[[0.0404, 0.017], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]], [[[0.1008, 0.0446], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]], [[[0.2494, 0.114], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]], [[[0.2716, 0.1795], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]], [[[0.2993, 0.2075], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]], [[[0.2399, 0.2711], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]], [[[0.1617, 0.2023], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]], [[[0.122, 0.2681], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]]]]

Expected: [[[[[0.0404, 0.017], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]], [[[0.1008, 0.0446], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]], [[[0.2494, 0.114], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]], [[[0.2716, 0.1795], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]], [[[0.2993, 0.2075], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]], [[[0.2399, 0.2711], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]], [[[0.1617, 0.2023], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]], [[[0.122, 0.2681], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]]]]