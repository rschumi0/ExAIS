import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max15958 = tf.keras.layers.Input(shape=([1, 1]))
in1Max15958 = tf.keras.layers.Input(shape=([1, 1]))
in0Ave34098 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Ave34098 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con58734 = tf.keras.layers.Input(shape=([3, 3, 3, 1]))
in0Dot87947 = tf.keras.layers.Input(shape=([3]))
in1Dot87947 = tf.keras.layers.Input(shape=([3]))
in0Con36211 = tf.keras.layers.Input(shape=([3, 3, 3, 1]))
in0Ave18836 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Ave18836 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))

Max15958 = keras.layers.Maximum(name = 'Max15958', )([in0Max15958,in1Max15958])
Res96076 = keras.layers.Reshape((1, 1, 1), name = 'Res96076', )(Max15958)
Res22988 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res22988', )(Res96076)
Zer35497 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (0, 0)), name = 'Zer35497', )(Res22988)
Ave34098 = keras.layers.Average(name = 'Ave34098', )([in0Ave34098,in1Ave34098])
Res3314 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res3314', )(Ave34098)
Up_4946 = keras.layers.UpSampling3D(size=(2, 1, 1), name = 'Up_4946', )(Res3314)
Ave17059 = keras.layers.Average(name = 'Ave17059', )([Zer35497,Up_4946])
Zer36925 = keras.layers.ZeroPadding3D(padding=((1, 0), (2, 0), (2, 0)), name = 'Zer36925', )(Ave17059)
Con58734 = keras.layers.Concatenate(axis=4, name = 'Con58734', )([Zer36925,in0Con58734])
Dot87947 = keras.layers.Dot(axes=(1, 1), name = 'Dot87947', )([in0Dot87947,in1Dot87947])
Res41198 = keras.layers.Reshape((1, 1), name = 'Res41198', )(Dot87947)
Res41275 = keras.layers.Reshape((1, 1, 1), name = 'Res41275', )(Res41198)
Res73248 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res73248', )(Res41275)
Zer91123 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer91123', )(Res73248)
Con36211 = keras.layers.Concatenate(axis=4, name = 'Con36211', )([Zer91123,in0Con36211])
Ave18836 = keras.layers.Average(name = 'Ave18836', )([in0Ave18836,in1Ave18836])
Zer55286 = keras.layers.ZeroPadding3D(padding=((2, 0), (1, 0), (2, 0)), name = 'Zer55286', )(Ave18836)
Add45608 = keras.layers.Add(name = 'Add45608', )([Con36211,Zer55286])
Add63945 = keras.layers.Add(name = 'Add63945', )([Con58734,Add45608])
Res55632 = keras.layers.Reshape((3, 3, 6), name = 'Res55632', )(Add63945)
Res87080 = keras.layers.Reshape((3, 18), name = 'Res87080', )(Res55632)
Sim47920 = keras.layers.SimpleRNN(1,name = 'Sim47920', )(Res87080)
model = tf.keras.models.Model(inputs=[in0Max15958,in1Max15958,in0Ave34098,in1Ave34098,in0Con58734,in0Dot87947,in1Dot87947,in0Con36211,in0Ave18836,in1Ave18836], outputs=Sim47920)
w = model.get_layer('Sim47920').get_weights() 
w[0] = np.array([[3], [2], [2], [7], [6], [5], [10], [1], [1], [3], [3], [6], [5], [9], [4], [7], [9], [8]])
w[1] = np.array([[9]])
w[2] = np.array([7])
model.get_layer('Sim47920').set_weights(w) 
in0Max15958 = tf.constant([[[0.6861]]])
in1Max15958 = tf.constant([[[0.7225]]])
in0Ave34098 = tf.constant([[[[0.345]]]])
in1Ave34098 = tf.constant([[[[0.7211]]]])
in0Con58734 = tf.constant([[[[[0.3394], [0.3647], [0.3801]], [[0.5419], [0.9476], [0.4115]], [[0.4673], [0.9025], [0.3732]]], [[[0.8409], [0.8913], [0.6632]], [[0.9985], [0.1982], [0.1192]], [[0.1625], [0.7209], [0.6407]]], [[[0.144], [0.9712], [0.273]], [[0.656], [0.3386], [0.6137]], [[0.667], [0.9734], [0.2788]]]]])
in0Dot87947 = tf.constant([[0.7303, 0.1465, 0.597]])
in1Dot87947 = tf.constant([[0.0153, 0.4117, 0.1681]])
in0Con36211 = tf.constant([[[[[0.4138], [0.5761], [0.4675]], [[0.0806], [0.1147], [0.7552]], [[0.067], [0.5109], [0.0827]]], [[[0.7881], [0.1128], [0.5074]], [[0.2391], [0.2289], [0.2689]], [[0.6872], [0.7357], [0.3067]]], [[[0.1584], [0.6377], [0.6887]], [[0.5298], [0.3402], [0.722]], [[0.4575], [0.921], [0.7271]]]]])
in0Ave18836 = tf.constant([[[[[0.5929, 0.6316]], [[0.962, 0.7361]]]]])
in1Ave18836 = tf.constant([[[[[0.0142, 0.8651]], [[0.9706, 0.2428]]]]])
print (np.array2string(model.predict([in0Max15958,in1Max15958,in0Ave34098,in1Ave34098,in0Con58734,in0Dot87947,in1Dot87947,in0Con36211,in0Ave18836,in1Ave18836],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sim47920.png')

LMax15958 = maximum_layer([[[[0.6861]]], [[[0.7225]]]], Max15958), 
LRes96076 = reshape_layer(Max15958, [1, 1, 1], Res96076), 
LRes22988 = reshape_layer(Res96076, [1, 1, 1, 1], Res22988), 
LZer35497 = zero_padding3D_layer(Res22988, 1, 0, 0, 0, 0, 0, Zer35497), 
LAve34098 = average_layer([[[[[0.345]]]], [[[[0.7211]]]]], Ave34098), 
LRes3314 = reshape_layer(Ave34098, [1, 1, 1, 1], Res3314), 
LUp_4946 = up_sampling3D_layer(Res3314, 2, 1, 1, Up_4946), 
LAve17059 = average_layer([Zer35497,Up_4946], Ave17059), 
LZer36925 = zero_padding3D_layer(Ave17059, 1, 0, 2, 0, 2, 0, Zer36925), 
LCon58734 = concatenate_layer([Zer36925,[[[[[0.3394], [0.3647], [0.3801]], [[0.5419], [0.9476], [0.4115]], [[0.4673], [0.9025], [0.3732]]], [[[0.8409], [0.8913], [0.6632]], [[0.9985], [0.1982], [0.1192]], [[0.1625], [0.7209], [0.6407]]], [[[0.144], [0.9712], [0.273]], [[0.656], [0.3386], [0.6137]], [[0.667], [0.9734], [0.2788]]]]]], 4, Con58734), 
LDot87947 = dot_layer([[0.7303, 0.1465, 0.597]], [[0.0153, 0.4117, 0.1681]], 1, 1, Dot87947), 
LRes41198 = reshape_layer(Dot87947, [1, 1], Res41198), 
LRes41275 = reshape_layer(Res41198, [1, 1, 1], Res41275), 
LRes73248 = reshape_layer(Res41275, [1, 1, 1, 1], Res73248), 
LZer91123 = zero_padding3D_layer(Res73248, 1, 1, 1, 1, 1, 1, Zer91123), 
LCon36211 = concatenate_layer([Zer91123,[[[[[0.4138], [0.5761], [0.4675]], [[0.0806], [0.1147], [0.7552]], [[0.067], [0.5109], [0.0827]]], [[[0.7881], [0.1128], [0.5074]], [[0.2391], [0.2289], [0.2689]], [[0.6872], [0.7357], [0.3067]]], [[[0.1584], [0.6377], [0.6887]], [[0.5298], [0.3402], [0.722]], [[0.4575], [0.921], [0.7271]]]]]], 4, Con36211), 
LAve18836 = average_layer([[[[[[0.5929, 0.6316]], [[0.962, 0.7361]]]]], [[[[[0.0142, 0.8651]], [[0.9706, 0.2428]]]]]], Ave18836), 
LZer55286 = zero_padding3D_layer(Ave18836, 2, 0, 1, 0, 2, 0, Zer55286), 
LAdd45608 = add_layer([Con36211,Zer55286], Add45608), 
LAdd63945 = add_layer([Con58734,Add45608], Add63945), 
LRes55632 = reshape_layer(Add63945, [3, 3, 6], Res55632), 
LRes87080 = reshape_layer(Res55632, [3, 18], Res87080), 
LSim47920 = simple_rnn_layer(Res87080,[[3], [2], [2], [7], [6], [5], [10], [1], [1], [3], [3], [6], [5], [9], [4], [7], [9], [8]],[[9]],[7], Sim47920), 
exec_layers([LMax15958,LRes96076,LRes22988,LZer35497,LAve34098,LRes3314,LUp_4946,LAve17059,LZer36925,LCon58734,LDot87947,LRes41198,LRes41275,LRes73248,LZer91123,LCon36211,LAve18836,LZer55286,LAdd45608,LAdd63945,LRes55632,LRes87080,LSim47920],["Max15958","Res96076","Res22988","Zer35497","Ave34098","Res3314","Up_4946","Ave17059","Zer36925","Con58734","Dot87947","Res41198","Res41275","Res73248","Zer91123","Con36211","Ave18836","Zer55286","Add45608","Add63945","Res55632","Res87080","Sim47920"],Sim47920,"Sim47920")

Actual (Unparsed): [[1.0000000]]

Expected (Unparsed): [[1.0]]

Actual:   [[1]]

Expected: [[1]]