import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add5825 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Add5825 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Add93310 = tf.keras.layers.Input(shape=([1, 1]))
in1Add93310 = tf.keras.layers.Input(shape=([1, 1]))
in0Con31847 = tf.keras.layers.Input(shape=([11]))

Add5825 = keras.layers.Add(name = 'Add5825', )([in0Add5825,in1Add5825])
Con74733 = keras.layers.Conv2DTranspose(3, (1, 1),strides=(1, 1), padding='same', name = 'Con74733', )(Add5825)
Res35872 = keras.layers.Reshape((2, 6), name = 'Res35872', )(Con74733)
Fla3907 = keras.layers.Flatten(name = 'Fla3907', )(Res35872)
Add93310 = keras.layers.Add(name = 'Add93310', )([in0Add93310,in1Add93310])
LST74111 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST74111', )(Add93310)
Con31847 = keras.layers.Concatenate(axis=1, name = 'Con31847', )([LST74111,in0Con31847])
Max50060 = keras.layers.Maximum(name = 'Max50060', )([Fla3907,Con31847])
model = tf.keras.models.Model(inputs=[in0Add5825,in1Add5825,in0Add93310,in1Add93310,in0Con31847], outputs=Max50060)
w = model.get_layer('Con74733').get_weights() 
w[0] = np.array([[[[0.8295], [0.7387], [0.2955]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con74733').set_weights(w) 
w = model.get_layer('LST74111').get_weights() 
w[0] = np.array([[4, 4, 5, 4]])
w[1] = np.array([[1, 6, 8, 1]])
w[2] = np.array([4, 6, 9, 2])
model.get_layer('LST74111').set_weights(w) 
in0Add5825 = tf.constant([[[[0.3973], [0.4215]], [[0.023], [0.5016]]]])
in1Add5825 = tf.constant([[[[0.0663], [0.4882]], [[0.9775], [0.2999]]]])
in0Add93310 = tf.constant([[[0.6721]]])
in1Add93310 = tf.constant([[[0.9042]]])
in0Con31847 = tf.constant([[0.4129, 0.5197, 0.9991, 0.4455, 0.5316, 0.3664, 0.4878, 0.4221, 0.1207, 0.5898, 0.8833]])
print (np.array2string(model.predict([in0Add5825,in1Add5825,in0Add93310,in1Add93310,in0Con31847],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max50060.png')

LAdd5825 = add_layer([[[[[0.3973], [0.4215]], [[0.023], [0.5016]]]], [[[[0.0663], [0.4882]], [[0.9775], [0.2999]]]]], Add5825), 
LCon74733 = conv2D_transpose_layer(Add5825, 1, 1,[[[[0.8295], [0.7387], [0.2955]]]],[0, 0, 0], 1, 1, true, Con74733), 
LRes35872 = reshape_layer(Con74733, [2, 6], Res35872), 
LFla3907 = flatten_layer(Res35872, Fla3907), 
LAdd93310 = add_layer([[[[0.6721]]], [[[0.9042]]]], Add93310), 
LLST74111 = lstm_layer(Add93310,[[4, 4, 5, 4]],[[1, 6, 8, 1]],[4, 6, 9, 2], LST74111), 
LCon31847 = concatenate_layer([LST74111,[[0.4129, 0.5197, 0.9991, 0.4455, 0.5316, 0.3664, 0.4878, 0.4221, 0.1207, 0.5898, 0.8833]]], 1, Con31847), 
LMax50060 = maximum_layer([Fla3907,Con31847], Max50060), 
exec_layers([LAdd5825,LCon74733,LRes35872,LFla3907,LAdd93310,LLST74111,LCon31847,LMax50060],["Add5825","Con74733","Res35872","Fla3907","Add93310","LST74111","Con31847","Max50060"],Max50060,"Max50060")

Actual (Unparsed): [[0.7613919, 0.4129000, 0.5197000, 0.9991000, 0.6719954, 0.5316000, 0.8299148, 0.7390694, 0.4221000, 0.6648443, 0.5920681, 0.8833000]]

Expected (Unparsed): [[0.7613918669828168,0.4129,0.5197,0.9991,0.67199539,0.5316,0.8299147499999999,0.73906935,0.4221,0.6648442500000001,0.5920680500000001,0.8833]]

Actual:   [[0.7614, 0.4129, 0.5197, 0.9991, 0.672, 0.5316, 0.83, 0.7391, 0.4221, 0.6649, 0.5921, 0.8833]]

Expected: [[0.7614, 0.4129, 0.5197, 0.9991, 0.672, 0.5316, 0.83, 0.7391, 0.4221, 0.6649, 0.5921, 0.8833]]