import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Cro58217 = tf.keras.layers.Input(shape=([2, 3, 2, 2]))
in0Con9745 = tf.keras.layers.Input(shape=([1, 20]))
in0Con88409 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Zer32056 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))

Cro58217 = keras.layers.Cropping3D(cropping=((0, 1), (1, 0), (0, 1)), name = 'Cro58217', )(in0Cro58217)
Res39747 = keras.layers.Reshape((1, 2, 2), name = 'Res39747', )(Cro58217)
Res76415 = keras.layers.Reshape((1, 4), name = 'Res76415', )(Res39747)
Con9745 = keras.layers.Concatenate(axis=2, name = 'Con9745', )([Res76415,in0Con9745])
Con88409 = keras.layers.Conv3DTranspose(2, (1, 2, 1),strides=(1, 1, 1), padding='valid', name = 'Con88409', )(in0Con88409)
Zer79111 = keras.layers.ZeroPadding3D(padding=((2, 0), (0, 0), (2, 0)), name = 'Zer79111', )(Con88409)
Zer32056 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer32056', )(in0Zer32056)
Sub38227 = keras.layers.Subtract(name = 'Sub38227', )([Zer79111,Zer32056])
Res48463 = keras.layers.Reshape((4, 3, 8), name = 'Res48463', )(Sub38227)
Res70225 = keras.layers.Reshape((4, 24), name = 'Res70225', )(Res48463)
Dot73448 = keras.layers.Dot(axes=(2, 2), name = 'Dot73448', )([Con9745,Res70225])
Res63214 = keras.layers.Reshape((1, 4, 1), name = 'Res63214', )(Dot73448)
Con61055 = keras.layers.Conv2D(3, (1, 3),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con61055', )(Res63214)
model = tf.keras.models.Model(inputs=[in0Cro58217,in0Con9745,in0Con88409,in0Zer32056], outputs=Con61055)
w = model.get_layer('Con88409').get_weights() 
w[0] = np.array([[[[[0.8389, 0.8716], [0.1492, 0.3349]]], [[[0.3568, 0.1525], [0.3039, 0.5836]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con88409').set_weights(w) 
w = model.get_layer('Con61055').get_weights() 
w[0] = np.array([[[[0.846, 0.0436, 0.519]], [[0.724, 0.451, 0.0804]], [[0.7029, 0.3127, 0.0562]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con61055').set_weights(w) 
in0Cro58217 = tf.constant([[[[[1.5846, 1.662], [1.1483, 1.5525]], [[1.4062, 1.2432], [1.5788, 1.4826]], [[1.8192, 1.2046], [1.263, 1.5547]]], [[[1.0998, 1.8268], [1.8962, 1.4315]], [[1.2966, 1.3623], [1.562, 1.6309]], [[1.0935, 1.1676], [1.2249, 1.4011]]]]])
in0Con9745 = tf.constant([[[0.6626, 0.3672, 0.4199, 0.3093, 0.6411, 0.7179, 0.7573, 0.2585, 0.9503, 0.1954, 0.285, 0.6725, 0.1465, 0.8145, 0.3834, 0.2916, 0.3095, 0.558, 0.7322, 0.9691]]])
in0Con88409 = tf.constant([[[[[0.72, 0.3936], [0.839, 0.1053]], [[0.7586, 0.2456], [0.961, 0.7387]]], [[[0.8197, 0.1454], [0.5858, 0.3435]], [[0.8328, 0.3471], [0.8984, 0.6398]]]]])
in0Zer32056 = tf.constant([[[[[1.1384, 1.6938], [1.7793, 1.1504]]], [[[1.6551, 1.2318], [1.1909, 1.4579]]]]])
print (np.array2string(model.predict([in0Cro58217,in0Con9745,in0Con88409,in0Zer32056],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con61055.png')

LCro58217 = cropping3D_layer([[[[[1.5846, 1.662], [1.1483, 1.5525]], [[1.4062, 1.2432], [1.5788, 1.4826]], [[1.8192, 1.2046], [1.263, 1.5547]]], [[[1.0998, 1.8268], [1.8962, 1.4315]], [[1.2966, 1.3623], [1.562, 1.6309]], [[1.0935, 1.1676], [1.2249, 1.4011]]]]], 0, 1, 1, 0, 0, 1, Cro58217), 
LRes39747 = reshape_layer(Cro58217, [1, 2, 2], Res39747), 
LRes76415 = reshape_layer(Res39747, [1, 4], Res76415), 
LCon9745 = concatenate_layer([Res76415,[[[0.6626, 0.3672, 0.4199, 0.3093, 0.6411, 0.7179, 0.7573, 0.2585, 0.9503, 0.1954, 0.285, 0.6725, 0.1465, 0.8145, 0.3834, 0.2916, 0.3095, 0.558, 0.7322, 0.9691]]]], 2, Con9745), 
LCon88409 = conv3D_transpose_layer([[[[[0.72, 0.3936], [0.839, 0.1053]], [[0.7586, 0.2456], [0.961, 0.7387]]], [[[0.8197, 0.1454], [0.5858, 0.3435]], [[0.8328, 0.3471], [0.8984, 0.6398]]]]], 1, 2, 1,[[[[[0.8389, 0.8716], [0.1492, 0.3349]]], [[[0.3568, 0.1525], [0.3039, 0.5836]]]]],[0, 0], 1, 1, 1, false, Con88409), 
LZer79111 = zero_padding3D_layer(Con88409, 2, 0, 0, 0, 2, 0, Zer79111), 
LZer32056 = zero_padding3D_layer([[[[[1.1384, 1.6938], [1.7793, 1.1504]]], [[[1.6551, 1.2318], [1.1909, 1.4579]]]]], 1, 1, 1, 1, 1, 1, Zer32056), 
LSub38227 = subtract_layer(Zer79111,Zer32056, Sub38227), 
LRes48463 = reshape_layer(Sub38227, [4, 3, 8], Res48463), 
LRes70225 = reshape_layer(Res48463, [4, 24], Res70225), 
LDot73448 = dot_layer(Con9745,Res70225, 2, 2, Dot73448), 
LRes63214 = reshape_layer(Dot73448, [1, 4, 1], Res63214), 
LCon61055 = conv2D_layer(Res63214, 1, 3,[[[[0.846, 0.0436, 0.519]], [[0.724, 0.451, 0.0804]], [[0.7029, 0.3127, 0.0562]]]],[0, 0, 0], 1, 1, true, 1, 1, Con61055), 
exec_layers([LCro58217,LRes39747,LRes76415,LCon9745,LCon88409,LZer79111,LZer32056,LSub38227,LRes48463,LRes70225,LDot73448,LRes63214,LCon61055],["Cro58217","Res39747","Res76415","Con9745","Con88409","Zer79111","Zer32056","Sub38227","Res48463","Res70225","Dot73448","Res63214","Con61055"],Con61055,"Con61055")

Actual (Unparsed): [[[[-2.2602554, -1.0055227, -0.1807175], [-1.1592314, -0.9302439, -0.1650787], [1.7112159, 2.0456757, -1.2771381], [4.7313928, 2.1434621, 1.2322515]]]]

Expected (Unparsed): [[[[-2.2602554812530005,-1.0055226760390001,-0.18071753883400002],[-1.1592314618776738,-0.9302439646066518,-0.16507874624334962],[1.7112158535352102,2.0456757482077235,-1.2771381749933761],[4.731392867125177,2.1434621711643076,1.2322514768234905]]]]

Actual:   [[[[-2.2602, -1.0055, -0.1807], [-1.1592, -0.9302, -0.165], [1.7113, 2.0457, -1.2771], [4.7314, 2.1435, 1.2323]]]]

Expected: [[[[-2.2602, -1.0055, -0.1807], [-1.1592, -0.9302, -0.165], [1.7113, 2.0457, -1.2771], [4.7314, 2.1435, 1.2323]]]]