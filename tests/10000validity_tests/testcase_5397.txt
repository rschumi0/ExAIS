import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max22499 = tf.keras.layers.Input(shape=([1, 2]))
in0Min16892 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Min16892 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Max71578 = tf.keras.layers.Input(shape=([1, 2]))
in0Con61518 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Max48704 = tf.keras.layers.Input(shape=([2, 1]))

Max22499 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max22499', )(in0Max22499)
Min16892 = keras.layers.Minimum(name = 'Min16892', )([in0Min16892,in1Min16892])
Res48665 = keras.layers.Reshape((1, 1, 2), name = 'Res48665', )(Min16892)
Res98013 = keras.layers.Reshape((1, 2), name = 'Res98013', )(Res48665)
Dot24020 = keras.layers.Dot(axes=(1, 1), name = 'Dot24020', )([Max22499,Res98013])
Max71578 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max71578', )(in0Max71578)
Zer4471 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer4471', )(Max71578)
Add70418 = keras.layers.Add(name = 'Add70418', )([Dot24020,Zer4471])
Res64607 = keras.layers.Reshape((2, 2, 1), name = 'Res64607', )(Add70418)
Con61518 = keras.layers.Concatenate(axis=3, name = 'Con61518', )([Res64607,in0Con61518])
Max48704 = keras.layers.MaxPool1D(pool_size=(1), strides=(2), padding='valid', name = 'Max48704', )(in0Max48704)
Res52163 = keras.layers.Reshape((1, 1, 1), name = 'Res52163', )(Max48704)
Con53072 = keras.layers.Conv2D(3, (1, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con53072', )(Res52163)
Zer87196 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer87196', )(Con53072)
Max5345 = keras.layers.Maximum(name = 'Max5345', )([Con61518,Zer87196])
model = tf.keras.models.Model(inputs=[in0Max22499,in0Min16892,in1Min16892,in0Max71578,in0Con61518,in0Max48704], outputs=Max5345)
w = model.get_layer('Con53072').get_weights() 
w[0] = np.array([[[[0.0464, 0.2851, 0.9334]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con53072').set_weights(w) 
in0Max22499 = tf.constant([[[1.4281, 1.0066]]])
in0Min16892 = tf.constant([[[[[0.2882], [0.1405]]]]])
in1Min16892 = tf.constant([[[[[0.7219], [0.1468]]]]])
in0Max71578 = tf.constant([[[1.1145, 1.7406]]])
in0Con61518 = tf.constant([[[[0.8292, 0.0037], [0.1735, 0.7009]], [[0.078, 0.7413], [0.6228, 0.9227]]]])
in0Max48704 = tf.constant([[[1.0114], [1.1162]]])
print (np.array2string(model.predict([in0Max22499,in0Min16892,in1Min16892,in0Max71578,in0Con61518,in0Max48704],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max5345.png')

LMax22499 = max_pool1D_layer([[[1.4281, 1.0066]]], 1, Max22499), 
LMin16892 = minimum_layer([[[[[[0.2882], [0.1405]]]]], [[[[[0.7219], [0.1468]]]]]], Min16892), 
LRes48665 = reshape_layer(Min16892, [1, 1, 2], Res48665), 
LRes98013 = reshape_layer(Res48665, [1, 2], Res98013), 
LDot24020 = dot_layer(Max22499,Res98013, 1, 1, Dot24020), 
LMax71578 = max_pool1D_layer([[[1.1145, 1.7406]]], 1, Max71578), 
LZer4471 = zero_padding1D_layer(Max71578, 1, 0, Zer4471), 
LAdd70418 = add_layer([Dot24020,Zer4471], Add70418), 
LRes64607 = reshape_layer(Add70418, [2, 2, 1], Res64607), 
LCon61518 = concatenate_layer([Res64607,[[[[0.8292, 0.0037], [0.1735, 0.7009]], [[0.078, 0.7413], [0.6228, 0.9227]]]]], 3, Con61518), 
LMax48704 = max_pool1D_layer([[[1.0114], [1.1162]]], 1, 2, false, Max48704), 
LRes52163 = reshape_layer(Max48704, [1, 1, 1], Res52163), 
LCon53072 = conv2D_layer(Res52163, 1, 1,[[[[0.0464, 0.2851, 0.9334]]]],[0, 0, 0], 1, 1, true, 1, 1, Con53072), 
LZer87196 = zero_padding2D_layer(Con53072, 1, 0, 1, 0, Zer87196), 
LMax5345 = maximum_layer([Con61518,Zer87196], Max5345), 
exec_layers([LMax22499,LMin16892,LRes48665,LRes98013,LDot24020,LMax71578,LZer4471,LAdd70418,LRes64607,LCon61518,LMax48704,LRes52163,LCon53072,LZer87196,LMax5345],["Max22499","Min16892","Res48665","Res98013","Dot24020","Max71578","Zer4471","Add70418","Res64607","Con61518","Max48704","Res52163","Con53072","Zer87196","Max5345"],Max5345,"Max5345")

Actual (Unparsed): [[[[0.4115784, 0.8292000, 0.0037000], [0.2006480, 0.1735000, 0.7009000]], [[1.4046022, 0.0780000, 0.7413000], [1.8820273, 0.6228000, 0.9440407]]]]

Expected (Unparsed): [[[[0.41157842,0.8292,0.0037],[0.20064805000000002,0.1735,0.7009]],[[1.40460212,0.078,0.7413],[1.8820272999999998,0.6228,0.94404076]]]]

Actual:   [[[[0.4116, 0.8292, 0.0037], [0.2007, 0.1735, 0.7009]], [[1.4047, 0.078, 0.7413], [1.8821, 0.6228, 0.9441]]]]

Expected: [[[[0.4116, 0.8292, 0.0037], [0.2007, 0.1735, 0.7009]], [[1.4047, 0.078, 0.7413], [1.8821, 0.6228, 0.9441]]]]