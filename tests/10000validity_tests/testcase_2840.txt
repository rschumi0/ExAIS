import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add33806 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Add33806 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Sub65777 = tf.keras.layers.Input(shape=([2, 3, 3]))
in1Sub65777 = tf.keras.layers.Input(shape=([2, 3, 3]))
in0GRU93173 = tf.keras.layers.Input(shape=([3, 2]))
in0Con93887 = tf.keras.layers.Input(shape=([1]))
in0Con18563 = tf.keras.layers.Input(shape=([6]))

Add33806 = keras.layers.Add(name = 'Add33806', )([in0Add33806,in1Add33806])
Res87894 = keras.layers.Reshape((2, 4), name = 'Res87894', )(Add33806)
Fla49174 = keras.layers.Flatten(name = 'Fla49174', )(Res87894)
Sub65777 = keras.layers.Subtract(name = 'Sub65777', )([in0Sub65777,in1Sub65777])
Res25915 = keras.layers.Reshape((2, 9), name = 'Res25915', )(Sub65777)
GRU21366 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU21366', )(Res25915)
GRU93173 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU93173', )(in0GRU93173)
Con93887 = keras.layers.Concatenate(axis=1, name = 'Con93887', )([GRU93173,in0Con93887])
Max97777 = keras.layers.Maximum(name = 'Max97777', )([GRU21366,Con93887])
Sof74268 = keras.layers.Softmax(axis=1, name = 'Sof74268', )(Max97777)
Con18563 = keras.layers.Concatenate(axis=1, name = 'Con18563', )([Sof74268,in0Con18563])
Ave45155 = keras.layers.Average(name = 'Ave45155', )([Fla49174,Con18563])
model = tf.keras.models.Model(inputs=[in0Add33806,in1Add33806,in0Sub65777,in1Sub65777,in0GRU93173,in0Con93887,in0Con18563], outputs=Ave45155)
w = model.get_layer('GRU21366').get_weights() 
w[0] = np.array([[8, 10, 2, 6, 5, 4], [9, 5, 4, 9, 6, 3], [8, 10, 7, 4, 4, 7], [5, 10, 2, 6, 5, 8], [3, 9, 4, 4, 7, 4], [7, 2, 8, 4, 2, 7], [10, 9, 4, 5, 1, 6], [2, 6, 2, 9, 1, 3], [7, 5, 2, 4, 2, 8]])
w[1] = np.array([[9, 1, 1, 6, 6, 8], [4, 4, 9, 7, 7, 2]])
w[2] = np.array([[7, 2, 3, 2, 9, 7], [7, 3, 3, 10, 4, 2]])
model.get_layer('GRU21366').set_weights(w) 
w = model.get_layer('GRU93173').get_weights() 
w[0] = np.array([[9, 5, 2], [5, 4, 1]])
w[1] = np.array([[8, 9, 10]])
w[2] = np.array([[7, 7, 7], [6, 8, 2]])
model.get_layer('GRU93173').set_weights(w) 
in0Add33806 = tf.constant([[[[0.6485, 0.2028], [0.3596, 0.3446]], [[0.088, 0.7872], [0.2132, 0.9439]]]])
in1Add33806 = tf.constant([[[[0.6547, 0.3141], [0.2116, 0.5163]], [[0.4691, 0.1606], [0.4083, 0.2014]]]])
in0Sub65777 = tf.constant([[[[0.209, 0.1364, 0.1025], [0.3542, 0.4887, 0.3882], [0.1036, 0.0197, 0.565]], [[0.4505, 0.6606, 0.8705], [0.7906, 0.0619, 0.8446], [0.489, 0.7963, 0.0315]]]])
in1Sub65777 = tf.constant([[[[0.5047, 0.9361, 0.7269], [0.1338, 0.5269, 0.1341], [0.9851, 0.7413, 0.0155]], [[0.7083, 0.8423, 0.6601], [0.1917, 0.5832, 0.9636], [0.4245, 0.2572, 0.8078]]]])
in0GRU93173 = tf.constant([[[7, 5], [9, 9], [10, 10]]])
in0Con93887 = tf.constant([[0.7032]])
in0Con18563 = tf.constant([[0.6788, 0.7904, 0.374, 0.245, 0.4558, 0.7518]])
print (np.array2string(model.predict([in0Add33806,in1Add33806,in0Sub65777,in1Sub65777,in0GRU93173,in0Con93887,in0Con18563],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave45155.png')

LAdd33806 = add_layer([[[[[0.6485, 0.2028], [0.3596, 0.3446]], [[0.088, 0.7872], [0.2132, 0.9439]]]], [[[[0.6547, 0.3141], [0.2116, 0.5163]], [[0.4691, 0.1606], [0.4083, 0.2014]]]]], Add33806), 
LRes87894 = reshape_layer(Add33806, [2, 4], Res87894), 
LFla49174 = flatten_layer(Res87894, Fla49174), 
LSub65777 = subtract_layer([[[[0.209, 0.1364, 0.1025], [0.3542, 0.4887, 0.3882], [0.1036, 0.0197, 0.565]], [[0.4505, 0.6606, 0.8705], [0.7906, 0.0619, 0.8446], [0.489, 0.7963, 0.0315]]]], [[[[0.5047, 0.9361, 0.7269], [0.1338, 0.5269, 0.1341], [0.9851, 0.7413, 0.0155]], [[0.7083, 0.8423, 0.6601], [0.1917, 0.5832, 0.9636], [0.4245, 0.2572, 0.8078]]]], Sub65777), 
LRes25915 = reshape_layer(Sub65777, [2, 9], Res25915), 
LGRU21366 = gru_layer(Res25915,[[8, 10, 2, 6, 5, 4], [9, 5, 4, 9, 6, 3], [8, 10, 7, 4, 4, 7], [5, 10, 2, 6, 5, 8], [3, 9, 4, 4, 7, 4], [7, 2, 8, 4, 2, 7], [10, 9, 4, 5, 1, 6], [2, 6, 2, 9, 1, 3], [7, 5, 2, 4, 2, 8]],[[9, 1, 1, 6, 6, 8], [4, 4, 9, 7, 7, 2]],[[7, 2, 3, 2, 9, 7], [7, 3, 3, 10, 4, 2]], true, GRU21366), 
LGRU93173 = gru_layer([[[7, 5], [9, 9], [10, 10]]],[[9, 5, 2], [5, 4, 1]],[[8, 9, 10]],[[7, 7, 7], [6, 8, 2]], true, GRU93173), 
LCon93887 = concatenate_layer([GRU93173,[[0.7032]]], 1, Con93887), 
LMax97777 = maximum_layer([GRU21366,Con93887], Max97777), 
LSof74268 = softmax_layer(Max97777, 1, Sof74268), 
LCon18563 = concatenate_layer([Sof74268,[[0.6788, 0.7904, 0.374, 0.245, 0.4558, 0.7518]]], 1, Con18563), 
LAve45155 = average_layer([Fla49174,Con18563], Ave45155), 
exec_layers([LAdd33806,LRes87894,LFla49174,LSub65777,LRes25915,LGRU21366,LGRU93173,LCon93887,LMax97777,LSof74268,LCon18563,LAve45155],["Add33806","Res87894","Fla49174","Sub65777","Res25915","GRU21366","GRU93173","Con93887","Max97777","Sof74268","Con18563","Ave45155"],Ave45155,"Ave45155")

Actual (Unparsed): [[0.9148043, 0.4952457, 0.6250000, 0.8256500, 0.4655500, 0.5964000, 0.5386500, 0.9485500]]

Expected (Unparsed): [[0.9146569580262052,0.4953930419737948,0.625,0.82565,0.46555,0.5964,0.53865,0.94855]]

Actual:   [[0.9149, 0.4953, 0.625, 0.8257, 0.4656, 0.5964, 0.5387, 0.9486]]

Expected: [[0.9147, 0.4954, 0.625, 0.8257, 0.4656, 0.5964, 0.5387, 0.9486]]