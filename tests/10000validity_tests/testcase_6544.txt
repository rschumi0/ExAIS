import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave33134 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Ave33134 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con23460 = tf.keras.layers.Input(shape=([3, 3, 3]))
in0Mul46012 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul46012 = tf.keras.layers.Input(shape=([2, 2]))
in0Con83266 = tf.keras.layers.Input(shape=([2, 2, 3]))
in0Add50863 = tf.keras.layers.Input(shape=([1, 2]))
in1Add50863 = tf.keras.layers.Input(shape=([1, 2]))

Ave33134 = keras.layers.Average(name = 'Ave33134', )([in0Ave33134,in1Ave33134])
Glo1482 = keras.layers.GlobalAveragePooling2D(name = 'Glo1482', )(Ave33134)
Res9529 = keras.layers.Reshape((2, 1), name = 'Res9529', )(Glo1482)
Cro51069 = keras.layers.Cropping1D(cropping=((1, 0)), name = 'Cro51069', )(Res9529)
Zer35153 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer35153', )(Cro51069)
Res36914 = keras.layers.Reshape((3, 1, 1), name = 'Res36914', )(Zer35153)
Zer24584 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer24584', )(Res36914)
Con23460 = keras.layers.Concatenate(axis=3, name = 'Con23460', )([Zer24584,in0Con23460])
Mul46012 = keras.layers.Multiply(name = 'Mul46012', )([in0Mul46012,in1Mul46012])
Res62660 = keras.layers.Reshape((2, 2, 1), name = 'Res62660', )(Mul46012)
Con83266 = keras.layers.Concatenate(axis=3, name = 'Con83266', )([Res62660,in0Con83266])
Add50863 = keras.layers.Add(name = 'Add50863', )([in0Add50863,in1Add50863])
Res25304 = keras.layers.Reshape((1, 2, 1), name = 'Res25304', )(Add50863)
Sep72413 = keras.layers.SeparableConv2D(4, (1, 1),strides=(1, 1), padding='same', name = 'Sep72413', )(Res25304)
Zer15481 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer15481', )(Sep72413)
Mul61029 = keras.layers.Multiply(name = 'Mul61029', )([Con83266,Zer15481])
Zer47227 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer47227', )(Mul61029)
Sub17674 = keras.layers.Subtract(name = 'Sub17674', )([Con23460,Zer47227])
model = tf.keras.models.Model(inputs=[in0Ave33134,in1Ave33134,in0Con23460,in0Mul46012,in1Mul46012,in0Con83266,in0Add50863,in1Add50863], outputs=Sub17674)
w = model.get_layer('Sep72413').get_weights() 
w[0] = np.array([[[[0.8969]]]])
w[1] = np.array([[[[0.9222, 0.7685, 0.545, 0.3039]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep72413').set_weights(w) 
in0Ave33134 = tf.constant([[[[0.1698, 0.1033], [0.5434, 0.4691]], [[0.669, 0.2443], [0.7869, 0.6594]]]])
in1Ave33134 = tf.constant([[[[0.8532, 0.9336], [0.7278, 0.6009]], [[0.6676, 0.5581], [0.2374, 0.8285]]]])
in0Con23460 = tf.constant([[[[0.0017, 0.4844, 0.1039], [0.9591, 0.5232, 0.2649], [0.3673, 0.8477, 0.7019]], [[0.4758, 0.2673, 0.4545], [0.0737, 0.5036, 0.4528], [0.6165, 0.9766, 0.0612]], [[0.6165, 0.3052, 0.6655], [0.0345, 0.259, 0.0953], [0.8919, 0.3743, 0.652]]]])
in0Mul46012 = tf.constant([[[0.4425, 0.5883], [0.6311, 0.0723]]])
in1Mul46012 = tf.constant([[[0.1444, 0.8669], [0.5381, 0.268]]])
in0Con83266 = tf.constant([[[[0.4223, 0.9857, 0.9203], [0.2718, 0.7804, 0.6179]], [[0.0547, 0.3164, 0.3107], [0.3888, 0.4413, 0.8785]]]])
in0Add50863 = tf.constant([[[0.512, 0.7862]]])
in1Add50863 = tf.constant([[[0.0912, 0.1376]]])
print (np.array2string(model.predict([in0Ave33134,in1Ave33134,in0Con23460,in0Mul46012,in1Mul46012,in0Con83266,in0Add50863,in1Add50863],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub17674.png')

LAve33134 = average_layer([[[[[0.1698, 0.1033], [0.5434, 0.4691]], [[0.669, 0.2443], [0.7869, 0.6594]]]], [[[[0.8532, 0.9336], [0.7278, 0.6009]], [[0.6676, 0.5581], [0.2374, 0.8285]]]]], Ave33134), 
LGlo1482 = global_average_pooling2D_layer(Ave33134, Glo1482), 
LRes9529 = reshape_layer(Glo1482, [2, 1], Res9529), 
LCro51069 = cropping1D_layer(Res9529, 1, 0, Cro51069), 
LZer35153 = zero_padding1D_layer(Cro51069, 1, 1, Zer35153), 
LRes36914 = reshape_layer(Zer35153, [3, 1, 1], Res36914), 
LZer24584 = zero_padding2D_layer(Res36914, 0, 0, 2, 0, Zer24584), 
LCon23460 = concatenate_layer([Zer24584,[[[[0.0017, 0.4844, 0.1039], [0.9591, 0.5232, 0.2649], [0.3673, 0.8477, 0.7019]], [[0.4758, 0.2673, 0.4545], [0.0737, 0.5036, 0.4528], [0.6165, 0.9766, 0.0612]], [[0.6165, 0.3052, 0.6655], [0.0345, 0.259, 0.0953], [0.8919, 0.3743, 0.652]]]]], 3, Con23460), 
LMul46012 = multiply_layer([[[[0.4425, 0.5883], [0.6311, 0.0723]]], [[[0.1444, 0.8669], [0.5381, 0.268]]]], Mul46012), 
LRes62660 = reshape_layer(Mul46012, [2, 2, 1], Res62660), 
LCon83266 = concatenate_layer([Res62660,[[[[0.4223, 0.9857, 0.9203], [0.2718, 0.7804, 0.6179]], [[0.0547, 0.3164, 0.3107], [0.3888, 0.4413, 0.8785]]]]], 3, Con83266), 
LAdd50863 = add_layer([[[[0.512, 0.7862]]], [[[0.0912, 0.1376]]]], Add50863), 
LRes25304 = reshape_layer(Add50863, [1, 2, 1], Res25304), 
LSep72413 = separable_conv2D_layer(Res25304, 1, 1,[[[[[0.8969]]]],[[[[0.9222, 0.7685, 0.545, 0.3039]]]]],[0, 0, 0, 0], 1, 1, true, Sep72413), 
LZer15481 = zero_padding2D_layer(Sep72413, 1, 0, 0, 0, Zer15481), 
LMul61029 = multiply_layer([Con83266,Zer15481], Mul61029), 
LZer47227 = zero_padding2D_layer(Mul61029, 1, 0, 1, 0, Zer47227), 
LSub17674 = subtract_layer(Con23460,Zer47227, Sub17674), 
exec_layers([LAve33134,LGlo1482,LRes9529,LCro51069,LZer35153,LRes36914,LZer24584,LCon23460,LMul46012,LRes62660,LCon83266,LAdd50863,LRes25304,LSep72413,LZer15481,LMul61029,LZer47227,LSub17674],["Ave33134","Glo1482","Res9529","Cro51069","Zer35153","Res36914","Zer24584","Con23460","Mul46012","Res62660","Con83266","Add50863","Res25304","Sep72413","Zer15481","Mul61029","Zer47227","Sub17674"],Sub17674,"Sub17674")

Actual (Unparsed): [[[[0.0000000, 0.0017000, 0.4844000, 0.1039000], [0.0000000, 0.9591000, 0.5232000, 0.2649000], [0.0000000, 0.3673000, 0.8477000, 0.7019000]], [[0.0000000, 0.4758000, 0.2673000, 0.4545000], [0.0000000, 0.0737000, 0.5036000, 0.4528000], [0.5496500, 0.6165000, 0.9766000, 0.0612000]], [[0.0000000, 0.6165000, 0.3052000, 0.6655000], [-0.1694305, 0.0117576, 0.1657093, 0.0442169], [-0.0148054, 0.6443334, 0.1750252, 0.4307953]]]]

Expected (Unparsed): [[[[0,0.0017,0.4844,0.1039],[0,0.9591,0.5232,0.2649],[0,0.3673,0.8477,0.7019]],[[0,0.4758,0.2673,0.4545],[0.0,0.0737,0.5036,0.4528],[0.54965,0.6165,0.9766,0.0612]],[[0,0.6165,0.3052,0.6655],[-0.16943052126529612,0.011757586317544005,0.16570930382496002,0.044216892298961606],[-0.014805401562742019,0.6443333670687841,0.17502518636213,0.43079525032584703]]]]

Actual:   [[[[0, 0.0017, 0.4844, 0.1039], [0, 0.9591, 0.5232, 0.2649], [0, 0.3673, 0.8477, 0.7019]], [[0, 0.4758, 0.2673, 0.4545], [0, 0.0737, 0.5036, 0.4528], [0.5497, 0.6165, 0.9766, 0.0612]], [[0, 0.6165, 0.3052, 0.6655], [-0.1694, 0.0118, 0.1658, 0.0443], [-0.0148, 0.6444, 0.1751, 0.4308]]]]

Expected: [[[[0, 0.0017, 0.4844, 0.1039], [0, 0.9591, 0.5232, 0.2649], [0, 0.3673, 0.8477, 0.7019]], [[0, 0.4758, 0.2673, 0.4545], [0, 0.0737, 0.5036, 0.4528], [0.5497, 0.6165, 0.9766, 0.0612]], [[0, 0.6165, 0.3052, 0.6655], [-0.1694, 0.0118, 0.1658, 0.0443], [-0.0148, 0.6444, 0.1751, 0.4308]]]]