import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub84567 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub84567 = tf.keras.layers.Input(shape=([3, 2]))
in0Min99692 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Min99692 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con54970 = tf.keras.layers.Input(shape=([2, 2]))
in0Max92615 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Max92615 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

Sub84567 = keras.layers.Subtract(name = 'Sub84567', )([in0Sub84567,in1Sub84567])
Min99692 = keras.layers.Minimum(name = 'Min99692', )([in0Min99692,in1Min99692])
Res69750 = keras.layers.Reshape((2, 2), name = 'Res69750', )(Min99692)
Con54970 = keras.layers.Concatenate(axis=2, name = 'Con54970', )([Res69750,in0Con54970])
Max92615 = keras.layers.Maximum(name = 'Max92615', )([in0Max92615,in1Max92615])
Res20718 = keras.layers.Reshape((2, 2, 2), name = 'Res20718', )(Max92615)
Res59190 = keras.layers.Reshape((2, 4), name = 'Res59190', )(Res20718)
Dot84634 = keras.layers.Dot(axes=(2, 2), name = 'Dot84634', )([Con54970,Res59190])
Zer11415 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer11415', )(Dot84634)
Ave61113 = keras.layers.Average(name = 'Ave61113', )([Sub84567,Zer11415])
model = tf.keras.models.Model(inputs=[in0Sub84567,in1Sub84567,in0Min99692,in1Min99692,in0Con54970,in0Max92615,in1Max92615], outputs=Ave61113)
in0Sub84567 = tf.constant([[[0.8451, 0.0147], [0.5621, 0.2962], [0.9714, 0.3443]]])
in1Sub84567 = tf.constant([[[0.2521, 0.317], [0.5226, 0.8766], [0.4, 0.9859]]])
in0Min99692 = tf.constant([[[[0.5234, 0.8182]], [[0.6427, 0.06]]]])
in1Min99692 = tf.constant([[[[0.3754, 0.2437]], [[0.8007, 0.155]]]])
in0Con54970 = tf.constant([[[0.2958, 0.8268], [0.93, 0.3626]]])
in0Max92615 = tf.constant([[[[[0.4798, 0.4162]], [[0.2961, 0.6101]]], [[[0.2845, 0.4173]], [[0.6738, 0.2633]]]]])
in1Max92615 = tf.constant([[[[[0.0591, 0.6076]], [[0.5541, 0.8288]]], [[[0.0773, 0.4124]], [[0.4909, 0.9365]]]]])
print (np.array2string(model.predict([in0Sub84567,in1Sub84567,in0Min99692,in1Min99692,in0Con54970,in0Max92615,in1Max92615],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave61113.png')

LSub84567 = subtract_layer([[[0.8451, 0.0147], [0.5621, 0.2962], [0.9714, 0.3443]]], [[[0.2521, 0.317], [0.5226, 0.8766], [0.4, 0.9859]]], Sub84567), 
LMin99692 = minimum_layer([[[[[0.5234, 0.8182]], [[0.6427, 0.06]]]], [[[[0.3754, 0.2437]], [[0.8007, 0.155]]]]], Min99692), 
LRes69750 = reshape_layer(Min99692, [2, 2], Res69750), 
LCon54970 = concatenate_layer([Res69750,[[[0.2958, 0.8268], [0.93, 0.3626]]]], 2, Con54970), 
LMax92615 = maximum_layer([[[[[[0.4798, 0.4162]], [[0.2961, 0.6101]]], [[[0.2845, 0.4173]], [[0.6738, 0.2633]]]]], [[[[[0.0591, 0.6076]], [[0.5541, 0.8288]]], [[[0.0773, 0.4124]], [[0.4909, 0.9365]]]]]], Max92615), 
LRes20718 = reshape_layer(Max92615, [2, 2, 2], Res20718), 
LRes59190 = reshape_layer(Res20718, [2, 4], Res59190), 
LDot84634 = dot_layer(Con54970,Res59190, 2, 2, Dot84634), 
LZer11415 = zero_padding1D_layer(Dot84634, 1, 0, Zer11415), 
LAve61113 = average_layer([Sub84567,Zer11415], Ave61113), 
exec_layers([LSub84567,LMin99692,LRes69750,LCon54970,LMax92615,LRes20718,LRes59190,LDot84634,LZer11415,LAve61113],["Sub84567","Min99692","Res69750","Con54970","Max92615","Res20718","Res59190","Dot84634","Zer11415","Ave61113"],Ave61113,"Ave61113")

Actual (Unparsed): [[[0.2965000, -0.1511500], [0.6084218, 0.3008528], [0.8660297, 0.2662475]]]

Expected (Unparsed): [[[0.2965,-0.15115],[0.60842183,0.30085277499999996],[0.8660296700000001,0.26624752500000004]]]

Actual:   [[[0.2965, -0.1511], [0.6085, 0.3009], [0.8661, 0.2663]]]

Expected: [[[0.2965, -0.1511], [0.6085, 0.3009], [0.8661, 0.2663]]]