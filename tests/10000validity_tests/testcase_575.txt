import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul29946 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Mul29946 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Loc21146 = tf.keras.layers.Input(shape=([2, 1]))
in0Sub25865 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Sub25865 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Glo2518 = tf.keras.layers.Input(shape=([2, 1]))
in0Con68193 = tf.keras.layers.Input(shape=([7]))

Mul29946 = keras.layers.Multiply(name = 'Mul29946', )([in0Mul29946,in1Mul29946])
Res65722 = keras.layers.Reshape((2, 4), name = 'Res65722', )(Mul29946)
Fla93583 = keras.layers.Flatten(name = 'Fla93583', )(Res65722)
Loc21146 = keras.layers.LocallyConnected1D(4, (1),strides=(8), name = 'Loc21146', )(in0Loc21146)
Sub25865 = keras.layers.Subtract(name = 'Sub25865', )([in0Sub25865,in1Sub25865])
Res48935 = keras.layers.Reshape((2, 4), name = 'Res48935', )(Sub25865)
Loc18935 = keras.layers.LocallyConnected1D(4, (2),strides=(1), name = 'Loc18935', )(Res48935)
Dot64221 = keras.layers.Dot(axes=(2, 2), name = 'Dot64221', )([Loc21146,Loc18935])
Fla27111 = keras.layers.Flatten(name = 'Fla27111', )(Dot64221)
Glo2518 = keras.layers.GlobalAveragePooling1D(name = 'Glo2518', )(in0Glo2518)
Add53503 = keras.layers.Add(name = 'Add53503', )([Fla27111,Glo2518])
Con68193 = keras.layers.Concatenate(axis=1, name = 'Con68193', )([Add53503,in0Con68193])
Add91317 = keras.layers.Add(name = 'Add91317', )([Fla93583,Con68193])
model = tf.keras.models.Model(inputs=[in0Mul29946,in1Mul29946,in0Loc21146,in0Sub25865,in1Sub25865,in0Glo2518,in0Con68193], outputs=Add91317)
w = model.get_layer('Loc21146').get_weights() 
w[0] = np.array([[[0.056, 0.001, 0.2412, 0.5637]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc21146').set_weights(w) 
w = model.get_layer('Loc18935').get_weights() 
w[0] = np.array([[[0.9983, 0.3302, 0.2407, 0.5438], [0.4503, 0.0755, 0.4166, 0.2844], [0.403, 0.6191, 0.0898, 0.7148], [0.6665, 0.3717, 0.6944, 0.252], [0.7842, 0.7748, 0.4908, 0.5383], [0.2194, 0.4748, 0.433, 0.2854], [0.4355, 0.8479, 0.3385, 0.7187], [0.1457, 0.4266, 0.8739, 0.496]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc18935').set_weights(w) 
in0Mul29946 = tf.constant([[[[0.184, 0.5824], [0.8004, 0.5749]], [[0.0648, 0.6748], [0.142, 0.0996]]]])
in1Mul29946 = tf.constant([[[[0.85, 0.9999], [0.2692, 0.6755]], [[0.7357, 0.5142], [0.8541, 0.1915]]]])
in0Loc21146 = tf.constant([[[0.72], [0.2796]]])
in0Sub25865 = tf.constant([[[[0.2477, 0.5866], [0.3505, 0.2569]], [[0.2118, 0.0025], [0.2881, 0.3034]]]])
in1Sub25865 = tf.constant([[[[0.2783, 0.1416], [0.6237, 0.8447]], [[0.2426, 0.0793], [0.9663, 0.4984]]]])
in0Glo2518 = tf.constant([[[1.3899], [1.2189]]])
in0Con68193 = tf.constant([[0.8081, 0.0997, 0.8763, 0.7265, 0.5912, 0.0176, 0.5416]])
print (np.array2string(model.predict([in0Mul29946,in1Mul29946,in0Loc21146,in0Sub25865,in1Sub25865,in0Glo2518,in0Con68193],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add91317.png')

LMul29946 = multiply_layer([[[[[0.184, 0.5824], [0.8004, 0.5749]], [[0.0648, 0.6748], [0.142, 0.0996]]]], [[[[0.85, 0.9999], [0.2692, 0.6755]], [[0.7357, 0.5142], [0.8541, 0.1915]]]]], Mul29946), 
LRes65722 = reshape_layer(Mul29946, [2, 4], Res65722), 
LFla93583 = flatten_layer(Res65722, Fla93583), 
LLoc21146 = locally_connected1D_layer([[[0.72], [0.2796]]], 1,[[[0.056, 0.001, 0.2412, 0.5637]]],[[0, 0, 0, 0]], 8, Loc21146), 
LSub25865 = subtract_layer([[[[0.2477, 0.5866], [0.3505, 0.2569]], [[0.2118, 0.0025], [0.2881, 0.3034]]]], [[[[0.2783, 0.1416], [0.6237, 0.8447]], [[0.2426, 0.0793], [0.9663, 0.4984]]]], Sub25865), 
LRes48935 = reshape_layer(Sub25865, [2, 4], Res48935), 
LLoc18935 = locally_connected1D_layer(Res48935, 2,[[[0.9983, 0.3302, 0.2407, 0.5438], [0.4503, 0.0755, 0.4166, 0.2844], [0.403, 0.6191, 0.0898, 0.7148], [0.6665, 0.3717, 0.6944, 0.252], [0.7842, 0.7748, 0.4908, 0.5383], [0.2194, 0.4748, 0.433, 0.2854], [0.4355, 0.8479, 0.3385, 0.7187], [0.1457, 0.4266, 0.8739, 0.496]]],[[0, 0, 0, 0]], 1, Loc18935), 
LDot64221 = dot_layer(Loc21146,Loc18935, 2, 2, Dot64221), 
LFla27111 = flatten_layer(Dot64221, Fla27111), 
LGlo2518 = global_average_pooling1D_layer([[[1.3899], [1.2189]]], Glo2518), 
LAdd53503 = add_layer([Fla27111,Glo2518], Add53503), 
LCon68193 = concatenate_layer([Add53503,[[0.8081, 0.0997, 0.8763, 0.7265, 0.5912, 0.0176, 0.5416]]], 1, Con68193), 
LAdd91317 = add_layer([Fla93583,Con68193], Add91317), 
exec_layers([LMul29946,LRes65722,LFla93583,LLoc21146,LSub25865,LRes48935,LLoc18935,LDot64221,LFla27111,LGlo2518,LAdd53503,LCon68193,LAdd91317],["Mul29946","Res65722","Fla93583","Loc21146","Sub25865","Res48935","Loc18935","Dot64221","Fla27111","Glo2518","Add53503","Con68193","Add91317"],Add91317,"Add91317")

Actual (Unparsed): [[0.9623608, 1.3904418, 0.3151677, 1.2646449, 0.7741733, 0.9381821, 0.1388822, 0.5606734]]

Expected (Unparsed): [[0.9623607967316801,1.39044176,0.31516768,1.2646449499999999,0.77417336,0.93818216,0.13888219999999998,0.5606734]]

Actual:   [[0.9624, 1.3905, 0.3152, 1.2647, 0.7742, 0.9382, 0.1389, 0.5607]]

Expected: [[0.9624, 1.3905, 0.3152, 1.2647, 0.7742, 0.9382, 0.1389, 0.5607]]