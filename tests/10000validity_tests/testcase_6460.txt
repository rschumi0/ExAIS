import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave91355 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Ave91355 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con83971 = tf.keras.layers.Input(shape=([1, 2]))
in0Add32635 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Add32635 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))

Ave91355 = keras.layers.Average(name = 'Ave91355', )([in0Ave91355,in1Ave91355])
Sof8705 = keras.layers.Softmax(axis=1, name = 'Sof8705', )(Ave91355)
Res66604 = keras.layers.Reshape((1, 2), name = 'Res66604', )(Sof8705)
PRe34057 = keras.layers.PReLU(name = 'PRe34057', )(Res66604)
Con83971 = keras.layers.Concatenate(axis=2, name = 'Con83971', )([PRe34057,in0Con83971])
Add32635 = keras.layers.Add(name = 'Add32635', )([in0Add32635,in1Add32635])
Res81777 = keras.layers.Reshape((1, 1, 4), name = 'Res81777', )(Add32635)
Res77443 = keras.layers.Reshape((1, 4), name = 'Res77443', )(Res81777)
Max59742 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max59742', )(Res77443)
Ave55864 = keras.layers.Average(name = 'Ave55864', )([Con83971,Max59742])
model = tf.keras.models.Model(inputs=[in0Ave91355,in1Ave91355,in0Con83971,in0Add32635,in1Add32635], outputs=Ave55864)
w = model.get_layer('PRe34057').get_weights() 
w[0] = np.array([[0.0135, 0.1544]])
model.get_layer('PRe34057').set_weights(w) 
in0Ave91355 = tf.constant([[[[0.0218, 0.5149]]]])
in1Ave91355 = tf.constant([[[[0.0605, 0.7573]]]])
in0Con83971 = tf.constant([[[0.8287, 0.2082]]])
in0Add32635 = tf.constant([[[[[0.5493, 0.0412], [0.6381, 0.4412]]]]])
in1Add32635 = tf.constant([[[[[0.1452, 0.6966], [0.2224, 0.9868]]]]])
print (np.array2string(model.predict([in0Ave91355,in1Ave91355,in0Con83971,in0Add32635,in1Add32635],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave55864.png')

LAve91355 = average_layer([[[[[0.0218, 0.5149]]]], [[[[0.0605, 0.7573]]]]], Ave91355), 
LSof8705 = softmax_layer(Ave91355, 1, Sof8705), 
LRes66604 = reshape_layer(Sof8705, [1, 2], Res66604), 
LPRe34057 = prelu_layer(Res66604, [[0.0135, 0.1544]], PRe34057), 
LCon83971 = concatenate_layer([PRe34057,[[[0.8287, 0.2082]]]], 2, Con83971), 
LAdd32635 = add_layer([[[[[[0.5493, 0.0412], [0.6381, 0.4412]]]]], [[[[[0.1452, 0.6966], [0.2224, 0.9868]]]]]], Add32635), 
LRes81777 = reshape_layer(Add32635, [1, 1, 4], Res81777), 
LRes77443 = reshape_layer(Res81777, [1, 4], Res77443), 
LMax59742 = max_pool1D_layer(Res77443, 1, Max59742), 
LAve55864 = average_layer([Con83971,Max59742], Ave55864), 
exec_layers([LAve91355,LSof8705,LRes66604,LPRe34057,LCon83971,LAdd32635,LRes81777,LRes77443,LMax59742,LAve55864],["Ave91355","Sof8705","Res66604","PRe34057","Con83971","Add32635","Res81777","Res77443","Max59742","Ave55864"],Ave55864,"Ave55864")

Actual (Unparsed): [[[0.8472500, 0.8689000, 0.8446000, 0.8181000]]]

Expected (Unparsed): [[[0.8472500000000001,0.8689,0.8446,0.8180999999999999]]]

Actual:   [[[0.8473, 0.8689, 0.8446, 0.8181]]]

Expected: [[[0.8473, 0.8689, 0.8446, 0.8181]]]