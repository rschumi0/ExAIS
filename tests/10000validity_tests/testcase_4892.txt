import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub97433 = tf.keras.layers.Input(shape=([2, 2, 3, 2]))
in1Sub97433 = tf.keras.layers.Input(shape=([2, 2, 3, 2]))
in0Dot74392 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot74392 = tf.keras.layers.Input(shape=([2, 2]))
in0Con60307 = tf.keras.layers.Input(shape=([2, 10]))

Sub97433 = keras.layers.Subtract(name = 'Sub97433', )([in0Sub97433,in1Sub97433])
Res91688 = keras.layers.Reshape((2, 2, 6), name = 'Res91688', )(Sub97433)
Res36046 = keras.layers.Reshape((2, 12), name = 'Res36046', )(Res91688)
Dot74392 = keras.layers.Dot(axes=(1, 2), name = 'Dot74392', )([in0Dot74392,in1Dot74392])
Mas95233 = keras.layers.Masking(mask_value=2, name = 'Mas95233', )(Dot74392)
Con60307 = keras.layers.Concatenate(axis=2, name = 'Con60307', )([Mas95233,in0Con60307])
Mul60553 = keras.layers.Multiply(name = 'Mul60553', )([Res36046,Con60307])
model = tf.keras.models.Model(inputs=[in0Sub97433,in1Sub97433,in0Dot74392,in1Dot74392,in0Con60307], outputs=Mul60553)
in0Sub97433 = tf.constant([[[[[0.0906, 0.1462], [0.8223, 0.8229], [0.425, 0.9949]], [[0.5884, 0.7365], [0.5389, 0.0017], [0.0198, 0.6393]]], [[[0.4472, 0.2852], [0.4471, 0.8348], [0.5814, 0.5383]], [[0.8736, 0.5882], [0.4901, 0.0986], [0.8648, 0.4616]]]]])
in1Sub97433 = tf.constant([[[[[0.6934, 0.4497], [0.6026, 0.0012], [0.2121, 0.1448]], [[0.5686, 0.9181], [0.1278, 0.7038], [0.1693, 0.1029]]], [[[0.6355, 0.1215], [0.2387, 0.0408], [0.4451, 0.2393]], [[0.7628, 0.453], [0.0592, 0.3874], [0.3586, 0.2799]]]]])
in0Dot74392 = tf.constant([[[0.4102, 0.3805], [0.0098, 0.4432]]])
in1Dot74392 = tf.constant([[[0.5736, 0.1655], [0.3116, 0.1774]]])
in0Con60307 = tf.constant([[[0.1452, 0.2971, 0.609, 0.5319, 0.9588, 0.657, 0.8643, 0.8266, 0.3823, 0.5198], [0.3448, 0.5668, 0.2353, 0.9961, 0.8413, 0.3879, 0.3547, 0.9258, 0.7536, 0.7801]]])
print (np.array2string(model.predict([in0Sub97433,in1Sub97433,in0Dot74392,in1Dot74392,in0Con60307],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul60553.png')

LSub97433 = subtract_layer([[[[[0.0906, 0.1462], [0.8223, 0.8229], [0.425, 0.9949]], [[0.5884, 0.7365], [0.5389, 0.0017], [0.0198, 0.6393]]], [[[0.4472, 0.2852], [0.4471, 0.8348], [0.5814, 0.5383]], [[0.8736, 0.5882], [0.4901, 0.0986], [0.8648, 0.4616]]]]], [[[[[0.6934, 0.4497], [0.6026, 0.0012], [0.2121, 0.1448]], [[0.5686, 0.9181], [0.1278, 0.7038], [0.1693, 0.1029]]], [[[0.6355, 0.1215], [0.2387, 0.0408], [0.4451, 0.2393]], [[0.7628, 0.453], [0.0592, 0.3874], [0.3586, 0.2799]]]]], Sub97433), 
LRes91688 = reshape_layer(Sub97433, [2, 2, 6], Res91688), 
LRes36046 = reshape_layer(Res91688, [2, 12], Res36046), 
LDot74392 = dot_layer([[[0.4102, 0.3805], [0.0098, 0.4432]]], [[[0.5736, 0.1655], [0.3116, 0.1774]]], 1, 2, Dot74392), 
LMas95233 = masking_layer(Dot74392, 2, Mas95233), 
LCon60307 = concatenate_layer([Mas95233,[[[0.1452, 0.2971, 0.609, 0.5319, 0.9588, 0.657, 0.8643, 0.8266, 0.3823, 0.5198], [0.3448, 0.5668, 0.2353, 0.9961, 0.8413, 0.3879, 0.3547, 0.9258, 0.7536, 0.7801]]]], 2, Con60307), 
LMul60553 = multiply_layer([Res36046,Con60307], Mul60553), 
exec_layers([LSub97433,LRes91688,LRes36046,LDot74392,LMas95233,LCon60307,LMul60553],["Sub97433","Res91688","Res36046","Dot74392","Mas95233","Con60307","Mul60553"],Mul60553,"Mul60553")

Actual (Unparsed): [[[-0.1428109, -0.0393205, 0.0319004, 0.2441271, 0.1296561, 0.4521682, 0.0189842, -0.1193112, 0.3553137, -0.5803559, -0.0571539, 0.2788207], [-0.0549091, 0.0322796, 0.0718563, 0.4500392, 0.0320714, 0.2978339, 0.0932161, 0.0524441, 0.1528402, -0.2673710, 0.3814723, 0.1417442]]]

Expected (Unparsed): [[[-0.142810927336,-0.039320500939999996,0.03190044,0.24412706999999997,0.1296561,0.45216819,0.018984240000000038,-0.11931119999999999,0.35531373,-0.58035586,-0.05715384999999999,0.27882072],[-0.054909108519999986,0.032279590476,0.07185632,0.4500392,0.03207139000000001,0.2978339,0.09321604000000001,0.052444079999999976,0.15284023,-0.26737104000000006,0.38147232000000003,0.14174417000000003]]]

Actual:   [[[-0.1428, -0.0393, 0.032, 0.2442, 0.1297, 0.4522, 0.019, -0.1193, 0.3554, -0.5803, -0.0571, 0.2789], [-0.0549, 0.0323, 0.0719, 0.4501, 0.0321, 0.2979, 0.0933, 0.0525, 0.1529, -0.2673, 0.3815, 0.1418]]]

Expected: [[[-0.1428, -0.0393, 0.032, 0.2442, 0.1297, 0.4522, 0.019, -0.1193, 0.3554, -0.5803, -0.0571, 0.2789], [-0.0549, 0.0323, 0.0719, 0.4501, 0.0321, 0.2979, 0.0933, 0.0525, 0.1529, -0.2673, 0.3815, 0.1418]]]