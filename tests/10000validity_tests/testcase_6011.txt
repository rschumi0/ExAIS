import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot59346 = tf.keras.layers.Input(shape=([2]))
in1Dot59346 = tf.keras.layers.Input(shape=([2]))
in0Con89154 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Sub11734 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Sub11734 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con84505 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Con57575 = tf.keras.layers.Input(shape=([2, 2, 1]))

Dot59346 = keras.layers.Dot(axes=(1, 1), name = 'Dot59346', )([in0Dot59346,in1Dot59346])
Res74392 = keras.layers.Reshape((1, 1), name = 'Res74392', )(Dot59346)
Res57885 = keras.layers.Reshape((1, 1, 1), name = 'Res57885', )(Res74392)
Zer60638 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer60638', )(Res57885)
Con89154 = keras.layers.Concatenate(axis=3, name = 'Con89154', )([Zer60638,in0Con89154])
Sub11734 = keras.layers.Subtract(name = 'Sub11734', )([in0Sub11734,in1Sub11734])
Con84505 = keras.layers.Conv3D(3, (2, 1, 1),strides=(8, 1, 3), padding='same', dilation_rate=(1, 1, 1), name = 'Con84505', )(in0Con84505)
Res56337 = keras.layers.Reshape((1, 1, 3), name = 'Res56337', )(Con84505)
Res21952 = keras.layers.Reshape((1, 3), name = 'Res21952', )(Res56337)
Sep99632 = keras.layers.SeparableConv1D(3, (1),strides=(1), padding='same', name = 'Sep99632', )(Res21952)
Res56533 = keras.layers.Reshape((1, 3, 1), name = 'Res56533', )(Sep99632)
Max97607 = keras.layers.MaxPool2D(pool_size=(1, 3), strides=(1, 1), padding='valid', name = 'Max97607', )(Res56533)
Zer45155 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer45155', )(Max97607)
Con57575 = keras.layers.Concatenate(axis=3, name = 'Con57575', )([Zer45155,in0Con57575])
Ave72863 = keras.layers.Average(name = 'Ave72863', )([Sub11734,Con57575])
Ave14294 = keras.layers.Average(name = 'Ave14294', )([Con89154,Ave72863])
model = tf.keras.models.Model(inputs=[in0Dot59346,in1Dot59346,in0Con89154,in0Sub11734,in1Sub11734,in0Con84505,in0Con57575], outputs=Ave14294)
w = model.get_layer('Con84505').get_weights() 
w[0] = np.array([[[[[0.7042, 0.2044, 0.6998]]]], [[[[0.9912, 0.6188, 0.6198]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con84505').set_weights(w) 
w = model.get_layer('Sep99632').get_weights() 
w[0] = np.array([[[0.515], [0.8498], [0.1715]]])
w[1] = np.array([[[0.2842, 0.4195, 0.1207], [0.6995, 0.4077, 0.5881], [0.2208, 0.9731, 0.2186]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep99632').set_weights(w) 
in0Dot59346 = tf.constant([[0.7946, 0.674]])
in1Dot59346 = tf.constant([[0.7017, 0.9184]])
in0Con89154 = tf.constant([[[[0.9851], [0.3541]], [[0.9753], [0.7968]]]])
in0Sub11734 = tf.constant([[[[0.6542, 0.3678], [0.9115, 0.5329]], [[0.8102, 0.4038], [0.3824, 0.5427]]]])
in1Sub11734 = tf.constant([[[[0.5895, 0.217], [0.2059, 0.6431]], [[0.821, 0.8436], [0.7035, 0.022]]]])
in0Con84505 = tf.constant([[[[[0.7537], [0.4323]]], [[[0.0466], [0.0513]]]]])
in0Con57575 = tf.constant([[[[0.4217], [0.7323]], [[0.7751], [0.5946]]]])
print (np.array2string(model.predict([in0Dot59346,in1Dot59346,in0Con89154,in0Sub11734,in1Sub11734,in0Con84505,in0Con57575],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave14294.png')

LDot59346 = dot_layer([[0.7946, 0.674]], [[0.7017, 0.9184]], 1, 1, Dot59346), 
LRes74392 = reshape_layer(Dot59346, [1, 1], Res74392), 
LRes57885 = reshape_layer(Res74392, [1, 1, 1], Res57885), 
LZer60638 = zero_padding2D_layer(Res57885, 1, 0, 1, 0, Zer60638), 
LCon89154 = concatenate_layer([Zer60638,[[[[0.9851], [0.3541]], [[0.9753], [0.7968]]]]], 3, Con89154), 
LSub11734 = subtract_layer([[[[0.6542, 0.3678], [0.9115, 0.5329]], [[0.8102, 0.4038], [0.3824, 0.5427]]]], [[[[0.5895, 0.217], [0.2059, 0.6431]], [[0.821, 0.8436], [0.7035, 0.022]]]], Sub11734), 
LCon84505 = conv3D_layer([[[[[0.7537], [0.4323]]], [[[0.0466], [0.0513]]]]], 2, 1, 1,[[[[[0.7042, 0.2044, 0.6998]]]], [[[[0.9912, 0.6188, 0.6198]]]]],[0, 0, 0], 8, 1, 3, true, 1, 1, 1, Con84505), 
LRes56337 = reshape_layer(Con84505, [1, 1, 3], Res56337), 
LRes21952 = reshape_layer(Res56337, [1, 3], Res21952), 
LSep99632 = separable_conv1D_layer(Res21952, 1,[[[[0.515], [0.8498], [0.1715]]],[[[0.2842, 0.4195, 0.1207], [0.6995, 0.4077, 0.5881], [0.2208, 0.9731, 0.2186]]]],[0, 0, 0], 1, true, Sep99632), 
LRes56533 = reshape_layer(Sep99632, [1, 3, 1], Res56533), 
LMax97607 = max_pool2D_layer(Res56533, 1, 3, 1, 1, false, Max97607), 
LZer45155 = zero_padding2D_layer(Max97607, 1, 0, 1, 0, Zer45155), 
LCon57575 = concatenate_layer([Zer45155,[[[[0.4217], [0.7323]], [[0.7751], [0.5946]]]]], 3, Con57575), 
LAve72863 = average_layer([Sub11734,Con57575], Ave72863), 
LAve14294 = average_layer([Con89154,Ave72863], Ave14294), 
exec_layers([LDot59346,LRes74392,LRes57885,LZer60638,LCon89154,LSub11734,LCon84505,LRes56337,LRes21952,LSep99632,LRes56533,LMax97607,LZer45155,LCon57575,LAve72863,LAve14294],["Dot59346","Res74392","Res57885","Zer60638","Con89154","Sub11734","Con84505","Res56337","Res21952","Sep99632","Res56533","Max97607","Zer45155","Con57575","Ave72863","Ave14294"],Ave14294,"Ave14294")

Actual (Unparsed): [[[[0.0161750, 0.6356750], [0.1764000, 0.3325750]], [[-0.0027000, 0.5714750], [0.5782245, 0.6772250]]]]

Expected (Unparsed): [[[[0.016174999999999995,0.635675],[0.1764,0.332575]],[[-0.00269999999999998,0.571475],[0.5782244510708292,0.677225]]]]

Actual:   [[[[0.0162, 0.6357], [0.1764, 0.3326]], [[-0.0027, 0.5715], [0.5783, 0.6773]]]]

Expected: [[[[0.0162, 0.6357], [0.1764, 0.3326]], [[-0.0026, 0.5715], [0.5783, 0.6773]]]]