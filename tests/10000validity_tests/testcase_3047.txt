import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub84093 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub84093 = tf.keras.layers.Input(shape=([3, 2]))

Sub84093 = keras.layers.Subtract(name = 'Sub84093', )([in0Sub84093,in1Sub84093])
Con27921 = keras.layers.Conv1D(4, (2),strides=(1), padding='valid', dilation_rate=(1), name = 'Con27921', )(Sub84093)
Res36664 = keras.layers.Reshape((2, 4, 1), name = 'Res36664', )(Con27921)
Loc14126 = keras.layers.LocallyConnected2D(2, (1, 2),strides=(1, 1), name = 'Loc14126', )(Res36664)
model = tf.keras.models.Model(inputs=[in0Sub84093,in1Sub84093], outputs=Loc14126)
w = model.get_layer('Con27921').get_weights() 
w[0] = np.array([[[0.2925, 0.2766, 0.9337, 0.7366], [0.5884, 0.0097, 0.7151, 0.8667]], [[0.507, 0.633, 0.1778, 0.0028], [0.4243, 0.2015, 0.2624, 0.056]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con27921').set_weights(w) 
w = model.get_layer('Loc14126').get_weights() 
w[0] = np.array([[[0.4203, 0.9972], [0.3022, 0.0411]], [[0.2929, 0.4219], [0.1612, 0.5004]], [[0.7873, 0.3423], [0.8134, 0.5147]], [[0.8645, 0.3606], [0.2463, 0.2094]], [[0.7147, 0.5887], [0.4375, 0.7832]], [[0.947, 0.684], [0.9937, 0.5025]]])
w[1] = np.array([[[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0]]])
model.get_layer('Loc14126').set_weights(w) 
in0Sub84093 = tf.constant([[[0.2323, 0.8643], [0.345, 0.4076], [0.9741, 0.7846]]])
in1Sub84093 = tf.constant([[[0.2225, 0.2969], [0.5856, 0.0121], [0.4525, 0.1611]]])
print (np.array2string(model.predict([in0Sub84093,in1Sub84093],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc14126.png')

LSub84093 = subtract_layer([[[0.2323, 0.8643], [0.345, 0.4076], [0.9741, 0.7846]]], [[[0.2225, 0.2969], [0.5856, 0.0121], [0.4525, 0.1611]]], Sub84093), 
LCon27921 = conv1D_layer(Sub84093, 2,[[[0.2925, 0.2766, 0.9337, 0.7366], [0.5884, 0.0097, 0.7151, 0.8667]], [[0.507, 0.633, 0.1778, 0.0028], [0.4243, 0.2015, 0.2624, 0.056]]],[0, 0, 0, 0], 1, false, 1, Con27921), 
LRes36664 = reshape_layer(Con27921, [2, 4, 1], Res36664), 
LLoc14126 = locally_connected2D_layer(Res36664, 1, 2,[[[0.4203, 0.9972], [0.3022, 0.0411]], [[0.2929, 0.4219], [0.1612, 0.5004]], [[0.7873, 0.3423], [0.8134, 0.5147]], [[0.8645, 0.3606], [0.2463, 0.2094]], [[0.7147, 0.5887], [0.4375, 0.7832]], [[0.947, 0.684], [0.9937, 0.5025]]],[[[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0]]], 1, 1, Loc14126), 
exec_layers([LSub84093,LCon27921,LRes36664,LLoc14126],["Sub84093","Con27921","Res36664","Loc14126"],Loc14126,"Loc14126")

Actual (Unparsed): [[[[0.1413269, 0.3788334], [0.0578544, 0.2109726], [0.7980159, 0.4307801]], [[0.6944817, 0.3316108], [0.4185474, 0.4777473], [0.4985093, 0.3166021]]]]

Expected (Unparsed): [[[[0.14132694193499998,0.378833451993],[0.057854398262999984,0.2109725966369999],[0.7980159137679999,0.43078009452199995]],[[0.6944816828470001,0.33161080110599994],[0.4185474068929999,0.4777473168999999],[0.4985093210389999,0.31660217656499995]]]]

Actual:   [[[[0.1414, 0.3789], [0.0579, 0.211], [0.7981, 0.4308]], [[0.6945, 0.3317], [0.4186, 0.4778], [0.4986, 0.3167]]]]

Expected: [[[[0.1414, 0.3789], [0.0579, 0.211], [0.7981, 0.4308]], [[0.6945, 0.3317], [0.4186, 0.4778], [0.4986, 0.3167]]]]