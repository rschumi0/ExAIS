import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min82615 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Min82615 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Max2754 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con86314 = tf.keras.layers.Input(shape=([3]))

Min82615 = keras.layers.Minimum(name = 'Min82615', )([in0Min82615,in1Min82615])
Res17477 = keras.layers.Reshape((2, 2), name = 'Res17477', )(Min82615)
Sep8757 = keras.layers.SeparableConv1D(4, (2),strides=(2), padding='valid', name = 'Sep8757', )(Res17477)
Fla79545 = keras.layers.Flatten(name = 'Fla79545', )(Sep8757)
Max2754 = keras.layers.MaxPool2D(pool_size=(2, 2), name = 'Max2754', )(in0Max2754)
Res40035 = keras.layers.Reshape((1, 1), name = 'Res40035', )(Max2754)
Max94547 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='valid', name = 'Max94547', )(Res40035)
Res30502 = keras.layers.Reshape((1, 1, 1), name = 'Res30502', )(Max94547)
PRe31263 = keras.layers.PReLU(name = 'PRe31263', )(Res30502)
PRe23597 = keras.layers.PReLU(name = 'PRe23597', )(PRe31263)
Res1336 = keras.layers.Reshape((1, 1), name = 'Res1336', )(PRe23597)
GRU49153 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU49153', )(Res1336)
Con86314 = keras.layers.Concatenate(axis=1, name = 'Con86314', )([GRU49153,in0Con86314])
Mul57000 = keras.layers.Multiply(name = 'Mul57000', )([Fla79545,Con86314])
model = tf.keras.models.Model(inputs=[in0Min82615,in1Min82615,in0Max2754,in0Con86314], outputs=Mul57000)
w = model.get_layer('Sep8757').get_weights() 
w[0] = np.array([[[0.2674], [0.8993]], [[0.5529], [0.0197]]])
w[1] = np.array([[[0.7828, 0.7547, 0.6102, 0.1301], [0.9673, 0.0492, 0.4498, 0.395]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep8757').set_weights(w) 
w = model.get_layer('PRe31263').get_weights() 
w[0] = np.array([[[0.4837]]])
model.get_layer('PRe31263').set_weights(w) 
w = model.get_layer('PRe23597').get_weights() 
w[0] = np.array([[[0.1072]]])
model.get_layer('PRe23597').set_weights(w) 
w = model.get_layer('GRU49153').get_weights() 
w[0] = np.array([[4, 5, 9]])
w[1] = np.array([[8, 5, 3]])
w[2] = np.array([[3, 3, 8], [2, 2, 4]])
model.get_layer('GRU49153').set_weights(w) 
in0Min82615 = tf.constant([[[[0.5112, 0.4521]], [[0.2032, 0.9545]]]])
in1Min82615 = tf.constant([[[[0.3119, 0.5644]], [[0.7095, 0.0815]]]])
in0Max2754 = tf.constant([[[[1.0047], [1.7017]], [[1.5014], [1.8669]]]])
in0Con86314 = tf.constant([[0.5434, 0.0951, 0.7216]])
print (np.array2string(model.predict([in0Min82615,in1Min82615,in0Max2754,in0Con86314],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul57000.png')

LMin82615 = minimum_layer([[[[[0.5112, 0.4521]], [[0.2032, 0.9545]]]], [[[[0.3119, 0.5644]], [[0.7095, 0.0815]]]]], Min82615), 
LRes17477 = reshape_layer(Min82615, [2, 2], Res17477), 
LSep8757 = separable_conv1D_layer(Res17477, 2,[[[[0.2674], [0.8993]], [[0.5529], [0.0197]]],[[[0.7828, 0.7547, 0.6102, 0.1301], [0.9673, 0.0492, 0.4498, 0.395]]]],[0, 0, 0, 0], 2, false, Sep8757), 
LFla79545 = flatten_layer(Sep8757, Fla79545), 
LMax2754 = max_pool2D_layer([[[[1.0047], [1.7017]], [[1.5014], [1.8669]]]], 2, 2, Max2754), 
LRes40035 = reshape_layer(Max2754, [1, 1], Res40035), 
LMax94547 = max_pool1D_layer(Res40035, 1, 1, false, Max94547), 
LRes30502 = reshape_layer(Max94547, [1, 1, 1], Res30502), 
LPRe31263 = prelu_layer(Res30502, [[[0.4837]]], PRe31263), 
LPRe23597 = prelu_layer(PRe31263, [[[0.1072]]], PRe23597), 
LRes1336 = reshape_layer(PRe23597, [1, 1], Res1336), 
LGRU49153 = gru_layer(Res1336,[[4, 5, 9]],[[8, 5, 3]],[[3, 3, 8], [2, 2, 4]], true, GRU49153), 
LCon86314 = concatenate_layer([GRU49153,[[0.5434, 0.0951, 0.7216]]], 1, Con86314), 
LMul57000 = multiply_layer([Fla79545,Con86314], Mul57000), 
exec_layers([LMin82615,LRes17477,LSep8757,LFla79545,LMax2754,LRes40035,LMax94547,LRes30502,LPRe31263,LPRe23597,LRes1336,LGRU49153,LCon86314,LMul57000],["Min82615","Res17477","Sep8757","Fla79545","Max2754","Res40035","Max94547","Res30502","PRe31263","PRe23597","Res1336","GRU49153","Con86314","Mul57000"],Mul57000,"Mul57000")

Actual (Unparsed): [[0.0000021, 0.0911912, 0.0288197, 0.1347213]]

Expected (Unparsed): [[2.109702058835365e-6,0.0911911856182756,0.028819714337725198,0.1347212666499744]]

Actual:   [[0, 0.0912, 0.0289, 0.1348]]

Expected: [[0, 0.0912, 0.0289, 0.1348]]