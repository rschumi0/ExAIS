import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST60290 = tf.keras.layers.Input(shape=([2, 2]))

LST60290 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST60290', )(in0LST60290)
Res42901 = keras.layers.Reshape((2, 1), name = 'Res42901', )(LST60290)
GRU98365 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU98365', )(Res42901)
Res97170 = keras.layers.Reshape((2, 1), name = 'Res97170', )(GRU98365)
Glo95158 = keras.layers.GlobalAveragePooling1D(name = 'Glo95158', )(Res97170)
model = tf.keras.models.Model(inputs=[in0LST60290], outputs=Glo95158)
w = model.get_layer('LST60290').get_weights() 
w[0] = np.array([[1, 7, 8, 9, 2, 4, 4, 4], [6, 6, 6, 9, 5, 8, 7, 5]])
w[1] = np.array([[2, 4, 7, 4, 7, 6, 7, 4], [9, 5, 1, 1, 8, 4, 6, 7]])
w[2] = np.array([4, 3, 6, 5, 6, 3, 10, 4])
model.get_layer('LST60290').set_weights(w) 
w = model.get_layer('GRU98365').get_weights() 
w[0] = np.array([[9, 9, 3, 5, 9, 9]])
w[1] = np.array([[2, 3, 7, 9, 6, 6], [8, 4, 4, 1, 5, 9]])
w[2] = np.array([[7, 5, 6, 8, 8, 6], [4, 2, 5, 5, 5, 8]])
model.get_layer('GRU98365').set_weights(w) 
in0LST60290 = tf.constant([[[2, 8], [7, 8]]])
print (np.array2string(model.predict([in0LST60290],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo95158.png')

LLST60290 = lstm_layer([[[2, 8], [7, 8]]],[[1, 7, 8, 9, 2, 4, 4, 4], [6, 6, 6, 9, 5, 8, 7, 5]],[[2, 4, 7, 4, 7, 6, 7, 4], [9, 5, 1, 1, 8, 4, 6, 7]],[4, 3, 6, 5, 6, 3, 10, 4], LST60290), 
LRes42901 = reshape_layer(LST60290, [2, 1], Res42901), 
LGRU98365 = gru_layer(Res42901,[[9, 9, 3, 5, 9, 9]],[[2, 3, 7, 9, 6, 6], [8, 4, 4, 1, 5, 9]],[[7, 5, 6, 8, 8, 6], [4, 2, 5, 5, 5, 8]], true, GRU98365), 
LRes97170 = reshape_layer(GRU98365, [2, 1], Res97170), 
LGlo95158 = global_average_pooling1D_layer(Res97170, Glo95158), 
exec_layers([LLST60290,LRes42901,LGRU98365,LRes97170,LGlo95158],["LST60290","Res42901","GRU98365","Res97170","Glo95158"],Glo95158,"Glo95158")

Actual (Unparsed): [[0.0000002]]

Expected (Unparsed): [[1.5840689282335443e-7]]

Actual:   [[0]]

Expected: [[0]]