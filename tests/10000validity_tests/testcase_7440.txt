import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave2669 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in1Ave2669 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))

Ave2669 = keras.layers.Average(name = 'Ave2669', )([in0Ave2669,in1Ave2669])
Res61404 = keras.layers.Reshape((2, 1, 4), name = 'Res61404', )(Ave2669)
Res94419 = keras.layers.Reshape((2, 4), name = 'Res94419', )(Res61404)
Loc78752 = keras.layers.LocallyConnected1D(2, (2),strides=(1), name = 'Loc78752', )(Res94419)
model = tf.keras.models.Model(inputs=[in0Ave2669,in1Ave2669], outputs=Loc78752)
w = model.get_layer('Loc78752').get_weights() 
w[0] = np.array([[[0.9766, 0.3904], [0.1125, 0.8167], [0.6607, 0.8543], [0.9325, 0.1179], [0.8979, 0.1288], [0.8185, 0.2462], [0.987, 0.2084], [0.3741, 0.1522]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc78752').set_weights(w) 
in0Ave2669 = tf.constant([[[[[0.3372, 0.7745], [0.8848, 0.3188]]], [[[0.8147, 0.7727], [0.6544, 0.4671]]]]])
in1Ave2669 = tf.constant([[[[[0.5433, 0.1888], [0.0386, 0.1224]]], [[[0.727, 0.68], [0.8581, 0.7316]]]]])
print (np.array2string(model.predict([in0Ave2669,in1Ave2669],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc78752.png')

LAve2669 = average_layer([[[[[[0.3372, 0.7745], [0.8848, 0.3188]]], [[[0.8147, 0.7727], [0.6544, 0.4671]]]]], [[[[[0.5433, 0.1888], [0.0386, 0.1224]]], [[[0.727, 0.68], [0.8581, 0.7316]]]]]], Ave2669), 
LRes61404 = reshape_layer(Ave2669, [2, 1, 4], Res61404), 
LRes94419 = reshape_layer(Res61404, [2, 4], Res94419), 
LLoc78752 = locally_connected1D_layer(Res94419, 2,[[[0.9766, 0.3904], [0.1125, 0.8167], [0.6607, 0.8543], [0.9325, 0.1179], [0.8979, 0.1288], [0.8185, 0.2462], [0.987, 0.2084], [0.3741, 0.1522]]],[[0, 0]], 1, Loc78752), 
exec_layers([LAve2669,LRes61404,LRes94419,LLoc78752],["Ave2669","Res61404","Res94419","Loc78752"],Loc78752,"Loc78752")

Actual (Unparsed): [[[3.2521877, 1.5126126]]]

Expected (Unparsed): [[[3.25218774,1.512612625]]]

Actual:   [[[3.2522, 1.5127]]]

Expected: [[[3.2522, 1.5127]]]