import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con97481 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Max21190 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Max21190 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Con84761 = tf.keras.layers.Input(shape=([2, 3, 3, 3]))
in0Zer17654 = tf.keras.layers.Input(shape=([2, 3, 3, 1]))

Con97481 = keras.layers.Conv3DTranspose(4, (1, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con97481', )(in0Con97481)
Zer31424 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (2, 0)), name = 'Zer31424', )(Con97481)
Max21190 = keras.layers.Maximum(name = 'Max21190', )([in0Max21190,in1Max21190])
Zer75462 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (1, 0)), name = 'Zer75462', )(Max21190)
Con84761 = keras.layers.Concatenate(axis=4, name = 'Con84761', )([Zer75462,in0Con84761])
Mul55533 = keras.layers.Multiply(name = 'Mul55533', )([Zer31424,Con84761])
Glo68585 = keras.layers.GlobalAveragePooling3D(name = 'Glo68585', )(Mul55533)
Res11904 = keras.layers.Reshape((4, 1), name = 'Res11904', )(Glo68585)
Res59112 = keras.layers.Reshape((4, 1, 1), name = 'Res59112', )(Res11904)
Res39671 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res39671', )(Res59112)
Zer92359 = keras.layers.ZeroPadding3D(padding=((0, 0), (4, 0), (4, 0)), name = 'Zer92359', )(Res39671)
Zer17654 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer17654', )(in0Zer17654)
Max32925 = keras.layers.Maximum(name = 'Max32925', )([Zer92359,Zer17654])
Res39179 = keras.layers.Reshape((4, 5, 5), name = 'Res39179', )(Max32925)
Cro78817 = keras.layers.Cropping2D(cropping=((2, 0), (0, 0)), name = 'Cro78817', )(Res39179)
Mas59520 = keras.layers.Masking(mask_value=2, name = 'Mas59520', )(Cro78817)
model = tf.keras.models.Model(inputs=[in0Con97481,in0Max21190,in1Max21190,in0Con84761,in0Zer17654], outputs=Mas59520)
w = model.get_layer('Con97481').get_weights() 
w[0] = np.array([[[[[0.1607], [0.0172], [0.561], [0.1705]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con97481').set_weights(w) 
in0Con97481 = tf.constant([[[[[0.9587]]], [[[0.3383]]]]])
in0Max21190 = tf.constant([[[[[0.5479], [0.9268]], [[0.401], [0.2628]]]]])
in1Max21190 = tf.constant([[[[[0.454], [0.0453]], [[0.2143], [0.565]]]]])
in0Con84761 = tf.constant([[[[[0.9003, 0.4682, 0.3713], [0.8797, 0.9108, 0.4182], [0.5079, 0.8015, 0.4853]], [[0.6514, 0.9208, 0.4582], [0.64, 0.2253, 0.3837], [0.1379, 0.8081, 0.5734]], [[0.2667, 0.6321, 0.2624], [0.1864, 0.8645, 0.3191], [0.6898, 0.3095, 0.5952]]], [[[0.9083, 0.4979, 0.153], [0.5938, 0.0774, 0.1967], [0.2857, 0.8673, 0.9278]], [[0.9852, 0.3317, 0.3637], [0.65, 0.4974, 0.8306], [0.0165, 0.0428, 0.5108]], [[0.1355, 0.0714, 0.5625], [0.3086, 0.521, 0.7742], [0.3923, 0.2976, 0.2532]]]]])
in0Zer17654 = tf.constant([[[[[1.5177], [1.832], [1.7787]], [[1.9957], [1.5317], [1.3365]], [[1.8803], [1.1768], [1.7652]]], [[[1.4139], [1.1979], [1.0375]], [[1.3754], [1.7191], [1.898]], [[1.1311], [1.7841], [1.1207]]]]])
print (np.array2string(model.predict([in0Con97481,in0Max21190,in1Max21190,in0Con84761,in0Zer17654],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mas59520.png')

LCon97481 = conv3D_transpose_layer([[[[[0.9587]]], [[[0.3383]]]]], 1, 1, 1,[[[[[0.1607], [0.0172], [0.561], [0.1705]]]]],[0, 0, 0, 0], 1, 1, 1, false, Con97481), 
LZer31424 = zero_padding3D_layer(Con97481, 0, 0, 2, 0, 2, 0, Zer31424), 
LMax21190 = maximum_layer([[[[[[0.5479], [0.9268]], [[0.401], [0.2628]]]]], [[[[[0.454], [0.0453]], [[0.2143], [0.565]]]]]], Max21190), 
LZer75462 = zero_padding3D_layer(Max21190, 1, 0, 1, 0, 1, 0, Zer75462), 
LCon84761 = concatenate_layer([Zer75462,[[[[[0.9003, 0.4682, 0.3713], [0.8797, 0.9108, 0.4182], [0.5079, 0.8015, 0.4853]], [[0.6514, 0.9208, 0.4582], [0.64, 0.2253, 0.3837], [0.1379, 0.8081, 0.5734]], [[0.2667, 0.6321, 0.2624], [0.1864, 0.8645, 0.3191], [0.6898, 0.3095, 0.5952]]], [[[0.9083, 0.4979, 0.153], [0.5938, 0.0774, 0.1967], [0.2857, 0.8673, 0.9278]], [[0.9852, 0.3317, 0.3637], [0.65, 0.4974, 0.8306], [0.0165, 0.0428, 0.5108]], [[0.1355, 0.0714, 0.5625], [0.3086, 0.521, 0.7742], [0.3923, 0.2976, 0.2532]]]]]], 4, Con84761), 
LMul55533 = multiply_layer([Zer31424,Con84761], Mul55533), 
LGlo68585 = global_average_pooling3D_layer(Mul55533, Glo68585), 
LRes11904 = reshape_layer(Glo68585, [4, 1], Res11904), 
LRes59112 = reshape_layer(Res11904, [4, 1, 1], Res59112), 
LRes39671 = reshape_layer(Res59112, [4, 1, 1, 1], Res39671), 
LZer92359 = zero_padding3D_layer(Res39671, 0, 0, 4, 0, 4, 0, Zer92359), 
LZer17654 = zero_padding3D_layer([[[[[1.5177], [1.832], [1.7787]], [[1.9957], [1.5317], [1.3365]], [[1.8803], [1.1768], [1.7652]]], [[[1.4139], [1.1979], [1.0375]], [[1.3754], [1.7191], [1.898]], [[1.1311], [1.7841], [1.1207]]]]], 1, 1, 1, 1, 1, 1, Zer17654), 
LMax32925 = maximum_layer([Zer92359,Zer17654], Max32925), 
LRes39179 = reshape_layer(Max32925, [4, 5, 5], Res39179), 
LCro78817 = cropping2D_layer(Res39179, 2, 0, 0, 0, Cro78817), 
LMas59520 = masking_layer(Cro78817, 2, Mas59520), 
exec_layers([LCon97481,LZer31424,LMax21190,LZer75462,LCon84761,LMul55533,LGlo68585,LRes11904,LRes59112,LRes39671,LZer92359,LZer17654,LMax32925,LRes39179,LCro78817,LMas59520],["Con97481","Zer31424","Max21190","Zer75462","Con84761","Mul55533","Glo68585","Res11904","Res59112","Res39671","Zer92359","Zer17654","Max32925","Res39179","Cro78817","Mas59520"],Mas59520,"Mas59520")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 1.4139000, 1.1979001, 1.0375000, 0.0000000], [0.0000000, 1.3753999, 1.7191000, 1.8980000, 0.0000000], [0.0000000, 1.1311001, 1.7841001, 1.1207000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0123855]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0062164]]]]

Expected (Unparsed): [[[[0,0,0,0,0],[0,1.4139,1.1979,1.0375,0],[0,1.3754,1.7191,1.898,0],[0,1.1311,1.7841,1.1207,0],[0,0,0,0,0.012385500251666667]],[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0.006216390216666666]]]]

Actual:   [[[[0, 0, 0, 0, 0], [0, 1.4139, 1.198, 1.0375, 0], [0, 1.3754, 1.7191, 1.898, 0], [0, 1.1312, 1.7842, 1.1207, 0], [0, 0, 0, 0, 0.0124]], [[0, 0, 0, 0, 0], [0, 0, 0, 0, 0], [0, 0, 0, 0, 0], [0, 0, 0, 0, 0], [0, 0, 0, 0, 0.0063]]]]

Expected: [[[[0, 0, 0, 0, 0], [0, 1.4139, 1.1979, 1.0375, 0], [0, 1.3754, 1.7191, 1.898, 0], [0, 1.1311, 1.7841, 1.1207, 0], [0, 0, 0, 0, 0.0124]], [[0, 0, 0, 0, 0], [0, 0, 0, 0, 0], [0, 0, 0, 0, 0], [0, 0, 0, 0, 0], [0, 0, 0, 0, 0.0063]]]]