import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max72716 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Max72716 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Con74376 = tf.keras.layers.Input(shape=([2, 1]))
in0Cro47111 = tf.keras.layers.Input(shape=([2, 2]))

Max72716 = keras.layers.Maximum(name = 'Max72716', )([in0Max72716,in1Max72716])
Res39368 = keras.layers.Reshape((2, 1, 1), name = 'Res39368', )(Max72716)
Res1969 = keras.layers.Reshape((2, 1), name = 'Res1969', )(Res39368)
Con74376 = keras.layers.Concatenate(axis=2, name = 'Con74376', )([Res1969,in0Con74376])
Cro47111 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro47111', )(in0Cro47111)
Ave8282 = keras.layers.Average(name = 'Ave8282', )([Con74376,Cro47111])
Res76854 = keras.layers.Reshape((2, 2, 1), name = 'Res76854', )(Ave8282)
Res7104 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res7104', )(Res76854)
Up_86318 = keras.layers.UpSampling3D(size=(2, 1, 2), name = 'Up_86318', )(Res7104)
Res18906 = keras.layers.Reshape((4, 2, 2), name = 'Res18906', )(Up_86318)
Res34497 = keras.layers.Reshape((4, 4), name = 'Res34497', )(Res18906)
GRU32884 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU32884', )(Res34497)
model = tf.keras.models.Model(inputs=[in0Max72716,in1Max72716,in0Con74376,in0Cro47111], outputs=GRU32884)
w = model.get_layer('GRU32884').get_weights() 
w[0] = np.array([[10, 8, 2], [3, 1, 6], [10, 5, 1], [7, 7, 6]])
w[1] = np.array([[5, 7, 7]])
w[2] = np.array([1, 4, 1])
model.get_layer('GRU32884').set_weights(w) 
in0Max72716 = tf.constant([[[[[0.776]]], [[[0.651]]]]])
in1Max72716 = tf.constant([[[[[0.2939]]], [[[0.3585]]]]])
in0Con74376 = tf.constant([[[0.7102], [0.7216]]])
in0Cro47111 = tf.constant([[[1.9598, 1.8951], [1.8255, 1.1298]]])
print (np.array2string(model.predict([in0Max72716,in1Max72716,in0Con74376,in0Cro47111],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU32884.png')

LMax72716 = maximum_layer([[[[[[0.776]]], [[[0.651]]]]], [[[[[0.2939]]], [[[0.3585]]]]]], Max72716), 
LRes39368 = reshape_layer(Max72716, [2, 1, 1], Res39368), 
LRes1969 = reshape_layer(Res39368, [2, 1], Res1969), 
LCon74376 = concatenate_layer([Res1969,[[[0.7102], [0.7216]]]], 2, Con74376), 
LCro47111 = cropping1D_layer([[[1.9598, 1.8951], [1.8255, 1.1298]]], 0, 0, Cro47111), 
LAve8282 = average_layer([Con74376,Cro47111], Ave8282), 
LRes76854 = reshape_layer(Ave8282, [2, 2, 1], Res76854), 
LRes7104 = reshape_layer(Res76854, [2, 2, 1, 1], Res7104), 
LUp_86318 = up_sampling3D_layer(Res7104, 2, 1, 2, Up_86318), 
LRes18906 = reshape_layer(Up_86318, [4, 2, 2], Res18906), 
LRes34497 = reshape_layer(Res18906, [4, 4], Res34497), 
LGRU32884 = gru_layer(Res34497,[[10, 8, 2], [3, 1, 6], [10, 5, 1], [7, 7, 6]],[[5, 7, 7]],[1, 4, 1], false, GRU32884), 
exec_layers([LMax72716,LRes39368,LRes1969,LCon74376,LCro47111,LAve8282,LRes76854,LRes7104,LUp_86318,LRes18906,LRes34497,LGRU32884],["Max72716","Res39368","Res1969","Con74376","Cro47111","Ave8282","Res76854","Res7104","Up_86318","Res18906","Res34497","GRU32884"],GRU32884,"GRU32884")

Actual (Unparsed): [[0.0000000]]

Expected (Unparsed): [[1.1102230246251518e-14]]

Actual:   [[0]]

Expected: [[0]]