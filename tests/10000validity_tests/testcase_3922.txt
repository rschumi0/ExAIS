import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave43890 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Ave43890 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Add73867 = tf.keras.layers.Input(shape=([2, 1]))
in1Add73867 = tf.keras.layers.Input(shape=([2, 1]))

Ave43890 = keras.layers.Average(name = 'Ave43890', )([in0Ave43890,in1Ave43890])
Res96438 = keras.layers.Reshape((1, 2, 2), name = 'Res96438', )(Ave43890)
Con92239 = keras.layers.Conv2D(2, (1, 2),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con92239', )(Res96438)
Res68096 = keras.layers.Reshape((1, 4), name = 'Res68096', )(Con92239)
Add73867 = keras.layers.Add(name = 'Add73867', )([in0Add73867,in1Add73867])
Res92360 = keras.layers.Reshape((2, 1, 1), name = 'Res92360', )(Add73867)
Con64282 = keras.layers.Conv2D(2, (2, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con64282', )(Res92360)
Res90545 = keras.layers.Reshape((1, 4), name = 'Res90545', )(Con64282)
Dot73908 = keras.layers.Dot(axes=(1, 1), name = 'Dot73908', )([Res68096,Res90545])
model = tf.keras.models.Model(inputs=[in0Ave43890,in1Ave43890,in0Add73867,in1Add73867], outputs=Dot73908)
w = model.get_layer('Con92239').get_weights() 
w[0] = np.array([[[[0.1249, 0.8669], [0.407, 0.1805]], [[0.656, 0.5734], [0.0192, 0.6194]]]])
w[1] = np.array([0, 0])
model.get_layer('Con92239').set_weights(w) 
w = model.get_layer('Con64282').get_weights() 
w[0] = np.array([[[[0.6625, 0.0601]]], [[[0.1524, 0.8834]]]])
w[1] = np.array([0, 0])
model.get_layer('Con64282').set_weights(w) 
in0Ave43890 = tf.constant([[[[[0.1096], [0.4131]], [[0.8246], [0.905]]]]])
in1Ave43890 = tf.constant([[[[[0.4828], [0.9552]], [[0.082], [0.811]]]]])
in0Add73867 = tf.constant([[[0.5227], [0.4247]]])
in1Add73867 = tf.constant([[[0.9415], [0.0239]]])
print (np.array2string(model.predict([in0Ave43890,in1Ave43890,in0Add73867,in1Add73867],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot73908.png')

LAve43890 = average_layer([[[[[[0.1096], [0.4131]], [[0.8246], [0.905]]]]], [[[[[0.4828], [0.9552]], [[0.082], [0.811]]]]]], Ave43890), 
LRes96438 = reshape_layer(Ave43890, [1, 2, 2], Res96438), 
LCon92239 = conv2D_layer(Res96438, 1, 2,[[[[0.1249, 0.8669], [0.407, 0.1805]], [[0.656, 0.5734], [0.0192, 0.6194]]]],[0, 0], 1, 1, true, 1, 1, Con92239), 
LRes68096 = reshape_layer(Con92239, [1, 4], Res68096), 
LAdd73867 = add_layer([[[[0.5227], [0.4247]]], [[[0.9415], [0.0239]]]], Add73867), 
LRes92360 = reshape_layer(Add73867, [2, 1, 1], Res92360), 
LCon64282 = conv2D_layer(Res92360, 2, 1,[[[[0.6625, 0.0601]]], [[[0.1524, 0.8834]]]],[0, 0], 1, 1, true, 1, 1, Con64282), 
LRes90545 = reshape_layer(Con64282, [1, 4], Res90545), 
LDot73908 = dot_layer(Res68096,Res90545, 1, 1, Dot73908), 
exec_layers([LAve43890,LRes96438,LCon92239,LRes68096,LAdd73867,LRes92360,LCon64282,LRes90545,LDot73908],["Ave43890","Res96438","Con92239","Res68096","Add73867","Res92360","Con64282","Res90545","Dot73908"],Dot73908,"Dot73908")

Actual (Unparsed): [[[0.6534468, 0.3047564, 0.1870213, 0.0169660], [1.2166219, 0.5674117, 0.3482062, 0.0315882], [0.4214064, 0.1965368, 0.1206096, 0.0109413], [0.5688711, 0.2653118, 0.1628151, 0.0147701]]]

Expected (Unparsed): [[[0.6534467494887661,0.3047564263501978,0.187021283868925,0.016966006280033797],[1.2166219467562436,0.5674117393693265,0.34820618304931256,0.031588213737756506],[0.4214064307200738,0.19653677666576222,0.120609631566075,0.0109413416711262],[0.5688711540300978,0.2653118101690182,0.16281512405707502,0.014770096537102201]]]

Actual:   [[[0.6535, 0.3048, 0.1871, 0.017], [1.2167, 0.5675, 0.3483, 0.0316], [0.4215, 0.1966, 0.1207, 0.011], [0.5689, 0.2654, 0.1629, 0.0148]]]

Expected: [[[0.6535, 0.3048, 0.1871, 0.017], [1.2167, 0.5675, 0.3483, 0.0316], [0.4215, 0.1966, 0.1207, 0.011], [0.5689, 0.2654, 0.1629, 0.0148]]]