import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max79995 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Max79995 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con99624 = tf.keras.layers.Input(shape=([4, 1]))
in0Mul48812 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in1Mul48812 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in0Min607 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Min607 = tf.keras.layers.Input(shape=([1, 2, 1]))

Max79995 = keras.layers.Maximum(name = 'Max79995', )([in0Max79995,in1Max79995])
Res44822 = keras.layers.Reshape((1, 1), name = 'Res44822', )(Max79995)
Zer78620 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer78620', )(Res44822)
Con99624 = keras.layers.Concatenate(axis=2, name = 'Con99624', )([Zer78620,in0Con99624])
Mul48812 = keras.layers.Multiply(name = 'Mul48812', )([in0Mul48812,in1Mul48812])
Res12799 = keras.layers.Reshape((2, 1, 4), name = 'Res12799', )(Mul48812)
Res90775 = keras.layers.Reshape((2, 4), name = 'Res90775', )(Res12799)
Min607 = keras.layers.Minimum(name = 'Min607', )([in0Min607,in1Min607])
Res74162 = keras.layers.Reshape((1, 2), name = 'Res74162', )(Min607)
Zer50851 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer50851', )(Res74162)
Dot88633 = keras.layers.Dot(axes=(1, 1), name = 'Dot88633', )([Res90775,Zer50851])
Ave67164 = keras.layers.Average(name = 'Ave67164', )([Con99624,Dot88633])
Lay98747 = keras.layers.LayerNormalization(axis=1, epsilon=1.937917619329848, name = 'Lay98747', )(Ave67164)
Res82871 = keras.layers.Reshape((4, 2, 1), name = 'Res82871', )(Lay98747)
Con43778 = keras.layers.Conv2D(2, (4, 1),strides=(3, 1), padding='same', dilation_rate=(1, 1), name = 'Con43778', )(Res82871)
model = tf.keras.models.Model(inputs=[in0Max79995,in1Max79995,in0Con99624,in0Mul48812,in1Mul48812,in0Min607,in1Min607], outputs=Con43778)
w = model.get_layer('Con43778').get_weights() 
w[0] = np.array([[[[0.3033, 0.3933]]], [[[0.2602, 0.2422]]], [[[0.5239, 0.9431]]], [[[0.4962, 0.5501]]]])
w[1] = np.array([0, 0])
model.get_layer('Con43778').set_weights(w) 
in0Max79995 = tf.constant([[[[0.3182]]]])
in1Max79995 = tf.constant([[[[0.3368]]]])
in0Con99624 = tf.constant([[[0.6781], [0.9011], [0.5599], [0.7542]]])
in0Mul48812 = tf.constant([[[[[0.5443, 0.1865], [0.6819, 0.9759]]], [[[0.841, 0.1656], [0.3663, 0.3114]]]]])
in1Mul48812 = tf.constant([[[[[0.5148, 0.4304], [0.0587, 0.6714]]], [[[0.6893, 0.4591], [0.8043, 0.0377]]]]])
in0Min607 = tf.constant([[[[0.1137], [0.0797]]]])
in1Min607 = tf.constant([[[[0.2378], [0.8797]]]])
print (np.array2string(model.predict([in0Max79995,in1Max79995,in0Con99624,in0Mul48812,in1Mul48812,in0Min607,in1Min607],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con43778.png')

LMax79995 = maximum_layer([[[[[0.3182]]]], [[[[0.3368]]]]], Max79995), 
LRes44822 = reshape_layer(Max79995, [1, 1], Res44822), 
LZer78620 = zero_padding1D_layer(Res44822, 3, 0, Zer78620), 
LCon99624 = concatenate_layer([Zer78620,[[[0.6781], [0.9011], [0.5599], [0.7542]]]], 2, Con99624), 
LMul48812 = multiply_layer([[[[[[0.5443, 0.1865], [0.6819, 0.9759]]], [[[0.841, 0.1656], [0.3663, 0.3114]]]]], [[[[[0.5148, 0.4304], [0.0587, 0.6714]]], [[[0.6893, 0.4591], [0.8043, 0.0377]]]]]], Mul48812), 
LRes12799 = reshape_layer(Mul48812, [2, 1, 4], Res12799), 
LRes90775 = reshape_layer(Res12799, [2, 4], Res90775), 
LMin607 = minimum_layer([[[[[0.1137], [0.0797]]]], [[[[0.2378], [0.8797]]]]], Min607), 
LRes74162 = reshape_layer(Min607, [1, 2], Res74162), 
LZer50851 = zero_padding1D_layer(Res74162, 1, 0, Zer50851), 
LDot88633 = dot_layer(Res90775,Zer50851, 1, 1, Dot88633), 
LAve67164 = average_layer([Con99624,Dot88633], Ave67164), 
LLay98747 = layer_normalization_layer(Ave67164, 1, 1.937917619329848, Lay98747), 
LRes82871 = reshape_layer(Lay98747, [4, 2, 1], Res82871), 
LCon43778 = conv2D_layer(Res82871, 4, 1,[[[[0.3033, 0.3933]]], [[[0.2602, 0.2422]]], [[[0.5239, 0.9431]]], [[[0.4962, 0.5501]]]],[0, 0], 3, 1, true, 1, 1, Con43778), 
exec_layers([LMax79995,LRes44822,LZer78620,LCon99624,LMul48812,LRes12799,LRes90775,LMin607,LRes74162,LZer50851,LDot88633,LAve67164,LLay98747,LRes82871,LCon43778],["Max79995","Res44822","Zer78620","Con99624","Mul48812","Res12799","Res90775","Min607","Res74162","Zer50851","Dot88633","Ave67164","Lay98747","Res82871","Con43778"],Con43778,"Con43778")

Actual (Unparsed): [[[[-0.0374959, -0.0541865], [0.0009266, 0.0227380]], [[0.0126593, 0.0086759], [-0.0161382, -0.0213589]]]]

Expected (Unparsed): [[[[-0.03749586751560395,-0.05418653007115038],[0.0009266134099086484,0.02273802132494957]],[[0.012659324061932691,0.00867592843230034],[-0.016138176457380336,-0.02135887397360154]]]]

Actual:   [[[[-0.0374, -0.0541], [0.001, 0.0228]], [[0.0127, 0.0087], [-0.0161, -0.0213]]]]

Expected: [[[[-0.0374, -0.0541], [0.001, 0.0228]], [[0.0127, 0.0087], [-0.0161, -0.0213]]]]