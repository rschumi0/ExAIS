import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Den27746 = tf.keras.layers.Input(shape=([5, 2]))

Den27746 = keras.layers.Dense(4,name = 'Den27746', )(in0Den27746)
Res25169 = keras.layers.Reshape((5, 4, 1), name = 'Res25169', )(Den27746)
Loc31060 = keras.layers.LocallyConnected2D(4, (4, 3),strides=(1, 1), name = 'Loc31060', )(Res25169)
Res83507 = keras.layers.Reshape((2, 2, 4, 1), name = 'Res83507', )(Loc31060)
Up_2176 = keras.layers.UpSampling3D(size=(2, 1, 2), name = 'Up_2176', )(Res83507)
Res96768 = keras.layers.Reshape((4, 2, 8), name = 'Res96768', )(Up_2176)
Glo95517 = keras.layers.GlobalMaxPool2D(name = 'Glo95517', )(Res96768)
Res80772 = keras.layers.Reshape((8, 1), name = 'Res80772', )(Glo95517)
Res80399 = keras.layers.Reshape((8, 1, 1), name = 'Res80399', )(Res80772)
Cro45414 = keras.layers.Cropping2D(cropping=((2, 2), (0, 0)), name = 'Cro45414', )(Res80399)
model = tf.keras.models.Model(inputs=[in0Den27746], outputs=Cro45414)
w = model.get_layer('Den27746').get_weights() 
w[0] = np.array([[0.5216, 0.8923, 0.9213, 0.3625], [0.4664, 0.9887, 0.1178, 0.9733]])
w[1] = np.array([0.6837, 0.1871, 0.8464, 0.5686])
model.get_layer('Den27746').set_weights(w) 
w = model.get_layer('Loc31060').get_weights() 
w[0] = np.array([[[0.8167, 0.7427, 0.4396, 0.09], [0.0133, 0.1991, 0.429, 0.3308], [0.4292, 0.1375, 0.5497, 0.0559], [0.8822, 0.2441, 0.1258, 0.7501], [0.506, 0.0116, 0.0246, 0.8305], [0.7339, 0.7082, 0.6934, 0.9017], [0.4423, 0.9971, 0.0158, 0.8786], [0.1094, 0.0865, 0.1854, 0.0497], [0.382, 0.0871, 0.6595, 0.3979], [0.884, 0.2017, 0.5261, 0.4019], [0.4499, 0.4794, 0.293, 0.0991], [0.2213, 0.129, 0.1924, 0.4067]], [[0.2049, 0.8054, 0.583, 0.5713], [0.9594, 0.8582, 0.9267, 0.1439], [0.0503, 0.2624, 0.1185, 0.0629], [0.7933, 0.8394, 0.6585, 0.2677], [0.5917, 0.4205, 0.2659, 0.763], [0.8671, 0.8049, 0.0578, 0.2078], [0.1794, 0.7213, 0.3407, 0.9118], [0.639, 0.5134, 0.398, 0.5867], [0.1238, 0.9409, 0.3928, 0.3259], [0.1318, 0.3104, 0.6535, 0.059], [0.3225, 0.1339, 0.1601, 0.1668], [0.9331, 0.649, 0.0078, 0.0306]], [[0.287, 0.8296, 0.9877, 0.0374], [0.5587, 0.9662, 0.1972, 0.9655], [0.8072, 0.4998, 0.7656, 0.7371], [0.0406, 0.5593, 0.3677, 0.2349], [0.7429, 0.5669, 0.1848, 0.2583], [0.8551, 0.356, 0.3684, 0.718], [0.679, 0.4728, 0.8637, 0.8551], [0.5532, 0.7242, 0.6596, 0.6106], [0.4338, 0.5772, 0.1431, 0.2683], [0.7068, 0.714, 0.2595, 0.1483], [0.6587, 0.906, 0.604, 0.4365], [0.0333, 0.3794, 0.4064, 0.2018]], [[0.0174, 0.0182, 0.6059, 0.2767], [0.8136, 0.0706, 0.8621, 0.9508], [0.682, 0.5112, 0.3983, 0.3667], [0.9643, 0.8447, 0.031, 0.0943], [0.1359, 0.9345, 0.6051, 0.6092], [0.3802, 0.3871, 0.323, 0.3032], [0.5207, 0.1307, 0.134, 0.2131], [0.408, 0.0895, 0.4336, 0.874], [0.0153, 0.2735, 0.8095, 0.5702], [0.5655, 0.1783, 0.469, 0.7885], [0.9864, 0.1228, 0.2829, 0.8628], [0.8699, 0.0378, 0.0899, 0.6379]]])
w[1] = np.array([[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]]])
model.get_layer('Loc31060').set_weights(w) 
in0Den27746 = tf.constant([[[0.6345, 0.3889], [0.5615, 0.3982], [0.3878, 0.7394], [0.7583, 0.8277], [0.5209, 0.8271]]])
print (np.array2string(model.predict([in0Den27746],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Cro45414.png')

LDen27746 = dense_layer([[[0.6345, 0.3889], [0.5615, 0.3982], [0.3878, 0.7394], [0.7583, 0.8277], [0.5209, 0.8271]]], [[0.5216, 0.8923, 0.9213, 0.3625], [0.4664, 0.9887, 0.1178, 0.9733]],[0.6837, 0.1871, 0.8464, 0.5686], Den27746), 
LRes25169 = reshape_layer(Den27746, [5, 4, 1], Res25169), 
LLoc31060 = locally_connected2D_layer(Res25169, 4, 3,[[[0.8167, 0.7427, 0.4396, 0.09], [0.0133, 0.1991, 0.429, 0.3308], [0.4292, 0.1375, 0.5497, 0.0559], [0.8822, 0.2441, 0.1258, 0.7501], [0.506, 0.0116, 0.0246, 0.8305], [0.7339, 0.7082, 0.6934, 0.9017], [0.4423, 0.9971, 0.0158, 0.8786], [0.1094, 0.0865, 0.1854, 0.0497], [0.382, 0.0871, 0.6595, 0.3979], [0.884, 0.2017, 0.5261, 0.4019], [0.4499, 0.4794, 0.293, 0.0991], [0.2213, 0.129, 0.1924, 0.4067]], [[0.2049, 0.8054, 0.583, 0.5713], [0.9594, 0.8582, 0.9267, 0.1439], [0.0503, 0.2624, 0.1185, 0.0629], [0.7933, 0.8394, 0.6585, 0.2677], [0.5917, 0.4205, 0.2659, 0.763], [0.8671, 0.8049, 0.0578, 0.2078], [0.1794, 0.7213, 0.3407, 0.9118], [0.639, 0.5134, 0.398, 0.5867], [0.1238, 0.9409, 0.3928, 0.3259], [0.1318, 0.3104, 0.6535, 0.059], [0.3225, 0.1339, 0.1601, 0.1668], [0.9331, 0.649, 0.0078, 0.0306]], [[0.287, 0.8296, 0.9877, 0.0374], [0.5587, 0.9662, 0.1972, 0.9655], [0.8072, 0.4998, 0.7656, 0.7371], [0.0406, 0.5593, 0.3677, 0.2349], [0.7429, 0.5669, 0.1848, 0.2583], [0.8551, 0.356, 0.3684, 0.718], [0.679, 0.4728, 0.8637, 0.8551], [0.5532, 0.7242, 0.6596, 0.6106], [0.4338, 0.5772, 0.1431, 0.2683], [0.7068, 0.714, 0.2595, 0.1483], [0.6587, 0.906, 0.604, 0.4365], [0.0333, 0.3794, 0.4064, 0.2018]], [[0.0174, 0.0182, 0.6059, 0.2767], [0.8136, 0.0706, 0.8621, 0.9508], [0.682, 0.5112, 0.3983, 0.3667], [0.9643, 0.8447, 0.031, 0.0943], [0.1359, 0.9345, 0.6051, 0.6092], [0.3802, 0.3871, 0.323, 0.3032], [0.5207, 0.1307, 0.134, 0.2131], [0.408, 0.0895, 0.4336, 0.874], [0.0153, 0.2735, 0.8095, 0.5702], [0.5655, 0.1783, 0.469, 0.7885], [0.9864, 0.1228, 0.2829, 0.8628], [0.8699, 0.0378, 0.0899, 0.6379]]],[[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]]], 1, 1, Loc31060), 
LRes83507 = reshape_layer(Loc31060, [2, 2, 4, 1], Res83507), 
LUp_2176 = up_sampling3D_layer(Res83507, 2, 1, 2, Up_2176), 
LRes96768 = reshape_layer(Up_2176, [4, 2, 8], Res96768), 
LGlo95517 = global_max_pool2D_layer(Res96768, Glo95517), 
LRes80772 = reshape_layer(Glo95517, [8, 1], Res80772), 
LRes80399 = reshape_layer(Res80772, [8, 1, 1], Res80399), 
LCro45414 = cropping2D_layer(Res80399, 2, 2, 0, 0, Cro45414), 
exec_layers([LDen27746,LRes25169,LLoc31060,LRes83507,LUp_2176,LRes96768,LGlo95517,LRes80772,LRes80399,LCro45414],["Den27746","Res25169","Loc31060","Res83507","Up_2176","Res96768","Glo95517","Res80772","Res80399","Cro45414"],Cro45414,"Cro45414")

Actual (Unparsed): [[[[10.2673826]], [[10.2673826]], [[8.0274342]], [[8.0274342]]]]

Expected (Unparsed): [[[[10.267382470398]],[[10.267382470398]],[[8.027434164623]],[[8.027434164623]]]]

Actual:   [[[[10.2674]], [[10.2674]], [[8.0275]], [[8.0275]]]]

Expected: [[[[10.2674]], [[10.2674]], [[8.0275]], [[8.0275]]]]