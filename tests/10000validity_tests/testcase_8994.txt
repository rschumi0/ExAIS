import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min71430 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Min71430 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Con35533 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Mul44548 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Mul44548 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in0Max73405 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Max73405 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Con72816 = tf.keras.layers.Input(shape=([2]))

Min71430 = keras.layers.Minimum(name = 'Min71430', )([in0Min71430,in1Min71430])
Con35533 = keras.layers.Concatenate(axis=4, name = 'Con35533', )([Min71430,in0Con35533])
Mul44548 = keras.layers.Multiply(name = 'Mul44548', )([in0Mul44548,in1Mul44548])
Sub22180 = keras.layers.Subtract(name = 'Sub22180', )([Con35533,Mul44548])
Res65656 = keras.layers.Reshape((1, 1, 4), name = 'Res65656', )(Sub22180)
Res92149 = keras.layers.Reshape((1, 4), name = 'Res92149', )(Res65656)
Fla72965 = keras.layers.Flatten(name = 'Fla72965', )(Res92149)
Max73405 = keras.layers.Maximum(name = 'Max73405', )([in0Max73405,in1Max73405])
Res59629 = keras.layers.Reshape((2, 1, 2), name = 'Res59629', )(Max73405)
Res80846 = keras.layers.Reshape((2, 2), name = 'Res80846', )(Res59629)
LST43408 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST43408', )(Res80846)
Con72816 = keras.layers.Concatenate(axis=1, name = 'Con72816', )([LST43408,in0Con72816])
Min49904 = keras.layers.Minimum(name = 'Min49904', )([Fla72965,Con72816])
model = tf.keras.models.Model(inputs=[in0Min71430,in1Min71430,in0Con35533,in0Mul44548,in1Mul44548,in0Max73405,in1Max73405,in0Con72816], outputs=Min49904)
w = model.get_layer('LST43408').get_weights() 
w[0] = np.array([[10, 8, 9, 5, 10, 8, 8, 2], [10, 5, 9, 5, 5, 6, 6, 9]])
w[1] = np.array([[8, 1, 5, 2, 10, 1, 1, 2], [5, 8, 10, 6, 6, 3, 2, 5]])
w[2] = np.array([10, 7, 3, 1, 3, 1, 4, 2])
model.get_layer('LST43408').set_weights(w) 
in0Min71430 = tf.constant([[[[[0.0619], [0.8406]]]]])
in1Min71430 = tf.constant([[[[[0.95], [0.9114]]]]])
in0Con35533 = tf.constant([[[[[0.7046], [0.6256]]]]])
in0Mul44548 = tf.constant([[[[[0.2732, 0.2842], [0.8196, 0.8586]]]]])
in1Mul44548 = tf.constant([[[[[0.9752, 0.6139], [0.7552, 0.7221]]]]])
in0Max73405 = tf.constant([[[[[0.6175, 0.4642]]], [[[0.4309, 0.766]]]]])
in1Max73405 = tf.constant([[[[[0.4646, 0.9357]]], [[[0.661, 0.6169]]]]])
in0Con72816 = tf.constant([[0.3047, 0.803]])
print (np.array2string(model.predict([in0Min71430,in1Min71430,in0Con35533,in0Mul44548,in1Mul44548,in0Max73405,in1Max73405,in0Con72816],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min49904.png')

LMin71430 = minimum_layer([[[[[[0.0619], [0.8406]]]]], [[[[[0.95], [0.9114]]]]]], Min71430), 
LCon35533 = concatenate_layer([Min71430,[[[[[0.7046], [0.6256]]]]]], 4, Con35533), 
LMul44548 = multiply_layer([[[[[[0.2732, 0.2842], [0.8196, 0.8586]]]]], [[[[[0.9752, 0.6139], [0.7552, 0.7221]]]]]], Mul44548), 
LSub22180 = subtract_layer(Con35533,Mul44548, Sub22180), 
LRes65656 = reshape_layer(Sub22180, [1, 1, 4], Res65656), 
LRes92149 = reshape_layer(Res65656, [1, 4], Res92149), 
LFla72965 = flatten_layer(Res92149, Fla72965), 
LMax73405 = maximum_layer([[[[[[0.6175, 0.4642]]], [[[0.4309, 0.766]]]]], [[[[[0.4646, 0.9357]]], [[[0.661, 0.6169]]]]]], Max73405), 
LRes59629 = reshape_layer(Max73405, [2, 1, 2], Res59629), 
LRes80846 = reshape_layer(Res59629, [2, 2], Res80846), 
LLST43408 = lstm_layer(Res80846,[[10, 8, 9, 5, 10, 8, 8, 2], [10, 5, 9, 5, 5, 6, 6, 9]],[[8, 1, 5, 2, 10, 1, 1, 2], [5, 8, 10, 6, 6, 3, 2, 5]],[10, 7, 3, 1, 3, 1, 4, 2], LST43408), 
LCon72816 = concatenate_layer([LST43408,[[0.3047, 0.803]]], 1, Con72816), 
LMin49904 = minimum_layer([Fla72965,Con72816], Min49904), 
exec_layers([LMin71430,LCon35533,LMul44548,LSub22180,LRes65656,LRes92149,LFla72965,LMax73405,LRes59629,LRes80846,LLST43408,LCon72816,LMin49904],["Min71430","Con35533","Mul44548","Sub22180","Res65656","Res92149","Fla72965","Max73405","Res59629","Res80846","LST43408","Con72816","Min49904"],Min49904,"Min49904")

Actual (Unparsed): [[-0.2045246, 0.5301296, 0.2216381, 0.0056049]]

Expected (Unparsed): [[-0.20452463999999998,0.53012962,0.22163808000000007,0.005604940000000003]]

Actual:   [[-0.2045, 0.5302, 0.2217, 0.0057]]

Expected: [[-0.2045, 0.5302, 0.2217, 0.0057]]