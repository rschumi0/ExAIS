import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Cro86100 = tf.keras.layers.Input(shape=([4, 2, 2]))

Cro86100 = keras.layers.Cropping2D(cropping=((2, 1), (1, 0)), name = 'Cro86100', )(in0Cro86100)
Zer83371 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer83371', )(Cro86100)
Res47974 = keras.layers.Reshape((3, 6), name = 'Res47974', )(Zer83371)
GRU33049 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU33049', )(Res47974)
Res92570 = keras.layers.Reshape((1, 1), name = 'Res92570', )(GRU33049)
Res33422 = keras.layers.Reshape((1, 1, 1), name = 'Res33422', )(Res92570)
Ave33969 = keras.layers.AveragePooling2D(pool_size=(1, 1), strides=(1, 1), padding='same', name = 'Ave33969', )(Res33422)
model = tf.keras.models.Model(inputs=[in0Cro86100], outputs=Ave33969)
w = model.get_layer('GRU33049').get_weights() 
w[0] = np.array([[9, 3, 8], [2, 9, 1], [3, 2, 2], [9, 6, 7], [3, 9, 4], [3, 2, 7]])
w[1] = np.array([[2, 7, 1]])
w[2] = np.array([6, 6, 4])
model.get_layer('GRU33049').set_weights(w) 
in0Cro86100 = tf.constant([[[[1.7198, 1.2304], [1.5438, 1.4203]], [[1.6736, 1.6942], [1.1515, 1.7687]], [[1.5508, 1.2917], [1.5019, 1.1034]], [[1.2719, 1.5293], [1.2466, 1.815]]]])
print (np.array2string(model.predict([in0Cro86100],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave33969.png')

LCro86100 = cropping2D_layer([[[[1.7198, 1.2304], [1.5438, 1.4203]], [[1.6736, 1.6942], [1.1515, 1.7687]], [[1.5508, 1.2917], [1.5019, 1.1034]], [[1.2719, 1.5293], [1.2466, 1.815]]]], 2, 1, 1, 0, Cro86100), 
LZer83371 = zero_padding2D_layer(Cro86100, 1, 1, 1, 1, Zer83371), 
LRes47974 = reshape_layer(Zer83371, [3, 6], Res47974), 
LGRU33049 = gru_layer(Res47974,[[9, 3, 8], [2, 9, 1], [3, 2, 2], [9, 6, 7], [3, 9, 4], [3, 2, 7]],[[2, 7, 1]],[6, 6, 4], false, GRU33049), 
LRes92570 = reshape_layer(GRU33049, [1, 1], Res92570), 
LRes33422 = reshape_layer(Res92570, [1, 1, 1], Res33422), 
LAve33969 = average_pooling2D_layer(Res33422, 1, 1, 1, 1, true, Ave33969), 
exec_layers([LCro86100,LZer83371,LRes47974,LGRU33049,LRes92570,LRes33422,LAve33969],["Cro86100","Zer83371","Res47974","GRU33049","Res92570","Res33422","Ave33969"],Ave33969,"Ave33969")

Actual (Unparsed): [[[[0.0049237]]]]

Expected (Unparsed): [[[[0.004923708003398827]]]]

Actual:   [[[[0.005]]]]

Expected: [[[[0.005]]]]