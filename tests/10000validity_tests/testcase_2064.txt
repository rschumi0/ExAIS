import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub84239 = tf.keras.layers.Input(shape=([2, 3, 2, 2]))
in1Sub84239 = tf.keras.layers.Input(shape=([2, 3, 2, 2]))

Sub84239 = keras.layers.Subtract(name = 'Sub84239', )([in0Sub84239,in1Sub84239])
Res86664 = keras.layers.Reshape((2, 3, 4), name = 'Res86664', )(Sub84239)
Res5530 = keras.layers.Reshape((2, 12), name = 'Res5530', )(Res86664)
Loc96712 = keras.layers.LocallyConnected1D(3, (1),strides=(1), name = 'Loc96712', )(Res5530)
model = tf.keras.models.Model(inputs=[in0Sub84239,in1Sub84239], outputs=Loc96712)
w = model.get_layer('Loc96712').get_weights() 
w[0] = np.array([[[0.2164, 0.305, 0.9954], [0.4127, 0.9341, 0.2271], [0.2534, 0.0525, 0.0953], [0.1816, 0.1817, 0.6303], [0.5518, 0.7449, 0.1782], [0.9677, 0.5603, 0.3396], [0.0387, 0.9219, 0.5608], [0.6163, 0.5117, 0.9221], [0.4177, 0.0224, 0.2875], [0.4686, 0.896, 0.3173], [0.8089, 0.2581, 0.6006], [0.3881, 0.8259, 0.3919]], [[0.474, 0.9649, 0.0605], [0.0735, 0.2148, 0.7395], [0.6967, 0.3095, 0.66], [0.9493, 0.6625, 0.389], [0.2527, 0.7052, 0.8379], [0.3379, 0.2106, 0.2142], [0.3818, 0.1164, 0.902], [0.5761, 0.3542, 0.0628], [0.2416, 0.0159, 0.6803], [0.9722, 0.6232, 0.258], [0.2973, 0.2439, 0.0225], [0.2435, 0.0113, 0.7302]]])
w[1] = np.array([[0, 0, 0], [0, 0, 0]])
model.get_layer('Loc96712').set_weights(w) 
in0Sub84239 = tf.constant([[[[[0.3617, 0.4456], [0.9857, 0.8096]], [[0.1788, 0.0459], [0.3956, 0.7334]], [[0.2789, 0.3455], [0.3296, 0.4588]]], [[[0.153, 0.6858], [0.0338, 0.703]], [[0.1052, 0.6762], [0.4522, 0.9213]], [[0.175, 0.9281], [0.566, 0.4908]]]]])
in1Sub84239 = tf.constant([[[[[0.977, 0.8104], [0.7703, 0.1662]], [[0.5909, 0.3039], [0.4624, 0.6965]], [[0.29, 0.5368], [0.9406, 0.8884]]], [[[0.3376, 0.1261], [0.9157, 0.3355]], [[0.298, 0.0178], [0.4242, 0.4911]], [[0.31, 0.1253], [0.6961, 0.7602]]]]])
print (np.array2string(model.predict([in0Sub84239,in1Sub84239],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc96712.png')

LSub84239 = subtract_layer([[[[[0.3617, 0.4456], [0.9857, 0.8096]], [[0.1788, 0.0459], [0.3956, 0.7334]], [[0.2789, 0.3455], [0.3296, 0.4588]]], [[[0.153, 0.6858], [0.0338, 0.703]], [[0.1052, 0.6762], [0.4522, 0.9213]], [[0.175, 0.9281], [0.566, 0.4908]]]]], [[[[[0.977, 0.8104], [0.7703, 0.1662]], [[0.5909, 0.3039], [0.4624, 0.6965]], [[0.29, 0.5368], [0.9406, 0.8884]]], [[[0.3376, 0.1261], [0.9157, 0.3355]], [[0.298, 0.0178], [0.4242, 0.4911]], [[0.31, 0.1253], [0.6961, 0.7602]]]]], Sub84239), 
LRes86664 = reshape_layer(Sub84239, [2, 3, 4], Res86664), 
LRes5530 = reshape_layer(Res86664, [2, 12], Res5530), 
LLoc96712 = locally_connected1D_layer(Res5530, 1,[[[0.2164, 0.305, 0.9954], [0.4127, 0.9341, 0.2271], [0.2534, 0.0525, 0.0953], [0.1816, 0.1817, 0.6303], [0.5518, 0.7449, 0.1782], [0.9677, 0.5603, 0.3396], [0.0387, 0.9219, 0.5608], [0.6163, 0.5117, 0.9221], [0.4177, 0.0224, 0.2875], [0.4686, 0.896, 0.3173], [0.8089, 0.2581, 0.6006], [0.3881, 0.8259, 0.3919]], [[0.474, 0.9649, 0.0605], [0.0735, 0.2148, 0.7395], [0.6967, 0.3095, 0.66], [0.9493, 0.6625, 0.389], [0.2527, 0.7052, 0.8379], [0.3379, 0.2106, 0.2142], [0.3818, 0.1164, 0.902], [0.5761, 0.3542, 0.0628], [0.2416, 0.0159, 0.6803], [0.9722, 0.6232, 0.258], [0.2973, 0.2439, 0.0225], [0.2435, 0.0113, 0.7302]]],[[0, 0, 0], [0, 0, 0]], 1, Loc96712), 
exec_layers([LSub84239,LRes86664,LRes5530,LLoc96712],["Sub84239","Res86664","Res5530","Loc96712"],Loc96712,"Loc96712")

Actual (Unparsed): [[[-1.3244325, -1.5786030, -1.0329596], [0.7639555, 0.5343391, -0.0889732]]]

Expected (Unparsed): [[[-1.3244324600000001,-1.57860296,-1.03295961],[0.76395552,0.53433909,-0.08897315999999994]]]

Actual:   [[[-1.3244, -1.5786, -1.0329], [0.764, 0.5344, -0.0889]]]

Expected: [[[-1.3244, -1.5786, -1.0329], [0.764, 0.5344, -0.0889]]]