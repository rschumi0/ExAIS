import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Up_46954 = tf.keras.layers.Input(shape=([2, 2]))
in0Mul52040 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul52040 = tf.keras.layers.Input(shape=([2, 1]))
in0Con9922 = tf.keras.layers.Input(shape=([2, 1]))
in0Mul13602 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul13602 = tf.keras.layers.Input(shape=([2, 1]))
in0Con68679 = tf.keras.layers.Input(shape=([1]))
in0Max69136 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Max69136 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con85054 = tf.keras.layers.Input(shape=([1]))

Up_46954 = keras.layers.UpSampling1D(size=(1), name = 'Up_46954', )(in0Up_46954)
Mul52040 = keras.layers.Multiply(name = 'Mul52040', )([in0Mul52040,in1Mul52040])
Con9922 = keras.layers.Concatenate(axis=2, name = 'Con9922', )([Mul52040,in0Con9922])
Mul8938 = keras.layers.Multiply(name = 'Mul8938', )([Up_46954,Con9922])
Fla18350 = keras.layers.Flatten(name = 'Fla18350', )(Mul8938)
Mul13602 = keras.layers.Multiply(name = 'Mul13602', )([in0Mul13602,in1Mul13602])
Fla91737 = keras.layers.Flatten(name = 'Fla91737', )(Mul13602)
Con68679 = keras.layers.Concatenate(axis=1, name = 'Con68679', )([Fla91737,in0Con68679])
Max69136 = keras.layers.Maximum(name = 'Max69136', )([in0Max69136,in1Max69136])
Res29327 = keras.layers.Reshape((2, 2), name = 'Res29327', )(Max69136)
Fla14009 = keras.layers.Flatten(name = 'Fla14009', )(Res29327)
Res50969 = keras.layers.Reshape((4, 1), name = 'Res50969', )(Fla14009)
GRU48601 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU48601', )(Res50969)
Min5881 = keras.layers.Minimum(name = 'Min5881', )([Con68679,GRU48601])
Con85054 = keras.layers.Concatenate(axis=1, name = 'Con85054', )([Min5881,in0Con85054])
Ave64540 = keras.layers.Average(name = 'Ave64540', )([Fla18350,Con85054])
model = tf.keras.models.Model(inputs=[in0Up_46954,in0Mul52040,in1Mul52040,in0Con9922,in0Mul13602,in1Mul13602,in0Con68679,in0Max69136,in1Max69136,in0Con85054], outputs=Ave64540)
w = model.get_layer('GRU48601').get_weights() 
w[0] = np.array([[1, 2, 7, 7, 8, 8, 10, 4, 7]])
w[1] = np.array([[8, 2, 5, 9, 6, 7, 9, 7, 10], [10, 9, 5, 10, 9, 9, 10, 7, 5], [1, 10, 3, 3, 4, 10, 8, 5, 3]])
w[2] = np.array([1, 5, 7, 1, 1, 4, 4, 5, 4])
model.get_layer('GRU48601').set_weights(w) 
in0Up_46954 = tf.constant([[[1.2763, 1.2374], [1.8547, 1.7889]]])
in0Mul52040 = tf.constant([[[0.7978], [0.6733]]])
in1Mul52040 = tf.constant([[[0.8923], [0.1293]]])
in0Con9922 = tf.constant([[[0.7295], [0.9871]]])
in0Mul13602 = tf.constant([[[0.5818], [0.8344]]])
in1Mul13602 = tf.constant([[[0.2841], [0.9149]]])
in0Con68679 = tf.constant([[0.034]])
in0Max69136 = tf.constant([[[[0.3496, 0.9199]], [[0.4629, 0.1849]]]])
in1Max69136 = tf.constant([[[[0.1421, 0.2782]], [[0.4326, 0.4639]]]])
in0Con85054 = tf.constant([[0.4083]])
print (np.array2string(model.predict([in0Up_46954,in0Mul52040,in1Mul52040,in0Con9922,in0Mul13602,in1Mul13602,in0Con68679,in0Max69136,in1Max69136,in0Con85054],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave64540.png')

LUp_46954 = up_sampling1D_layer([[[1.2763, 1.2374], [1.8547, 1.7889]]], 1, Up_46954), 
LMul52040 = multiply_layer([[[[0.7978], [0.6733]]], [[[0.8923], [0.1293]]]], Mul52040), 
LCon9922 = concatenate_layer([Mul52040,[[[0.7295], [0.9871]]]], 2, Con9922), 
LMul8938 = multiply_layer([Up_46954,Con9922], Mul8938), 
LFla18350 = flatten_layer(Mul8938, Fla18350), 
LMul13602 = multiply_layer([[[[0.5818], [0.8344]]], [[[0.2841], [0.9149]]]], Mul13602), 
LFla91737 = flatten_layer(Mul13602, Fla91737), 
LCon68679 = concatenate_layer([Fla91737,[[0.034]]], 1, Con68679), 
LMax69136 = maximum_layer([[[[[0.3496, 0.9199]], [[0.4629, 0.1849]]]], [[[[0.1421, 0.2782]], [[0.4326, 0.4639]]]]], Max69136), 
LRes29327 = reshape_layer(Max69136, [2, 2], Res29327), 
LFla14009 = flatten_layer(Res29327, Fla14009), 
LRes50969 = reshape_layer(Fla14009, [4, 1], Res50969), 
LGRU48601 = gru_layer(Res50969,[[1, 2, 7, 7, 8, 8, 10, 4, 7]],[[8, 2, 5, 9, 6, 7, 9, 7, 10], [10, 9, 5, 10, 9, 9, 10, 7, 5], [1, 10, 3, 3, 4, 10, 8, 5, 3]],[1, 5, 7, 1, 1, 4, 4, 5, 4], false, GRU48601), 
LMin5881 = minimum_layer([Con68679,GRU48601], Min5881), 
LCon85054 = concatenate_layer([Min5881,[[0.4083]]], 1, Con85054), 
LAve64540 = average_layer([Fla18350,Con85054], Ave64540), 
exec_layers([LUp_46954,LMul52040,LCon9922,LMul8938,LFla18350,LMul13602,LFla91737,LCon68679,LMax69136,LRes29327,LFla14009,LRes50969,LGRU48601,LMin5881,LCon85054,LAve64540],["Up_46954","Mul52040","Con9922","Mul8938","Fla18350","Mul13602","Fla91737","Con68679","Max69136","Res29327","Fla14009","Res50969","GRU48601","Min5881","Con85054","Ave64540"],Ave64540,"Ave64540")

Actual (Unparsed): [[0.5369289, 0.4549207, 0.0807831, 1.0870616]]

Expected (Unparsed): [[0.5369289592609999,0.4549206684971805,0.08078311420276514,1.087061595]]

Actual:   [[0.537, 0.455, 0.0808, 1.0871]]

Expected: [[0.537, 0.455, 0.0808, 1.0871]]