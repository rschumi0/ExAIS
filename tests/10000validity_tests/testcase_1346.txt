import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul96734 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Mul96734 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0GRU79166 = tf.keras.layers.Input(shape=([1, 3]))

Mul96734 = keras.layers.Multiply(name = 'Mul96734', )([in0Mul96734,in1Mul96734])
Res15081 = keras.layers.Reshape((1, 2, 4), name = 'Res15081', )(Mul96734)
Res88288 = keras.layers.Reshape((1, 8), name = 'Res88288', )(Res15081)
GRU79166 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU79166', )(in0GRU79166)
Res94097 = keras.layers.Reshape((1, 1), name = 'Res94097', )(GRU79166)
Res30123 = keras.layers.Reshape((1, 1, 1), name = 'Res30123', )(Res94097)
Up_98613 = keras.layers.UpSampling2D(size=(1, 1), name = 'Up_98613', )(Res30123)
Res43396 = keras.layers.Reshape((1, 1), name = 'Res43396', )(Up_98613)
Dot34990 = keras.layers.Dot(axes=(1, 1), name = 'Dot34990', )([Res88288,Res43396])
ReL82334 = keras.layers.ReLU(max_value=7.454752896337583, negative_slope=3.2160091692762793, threshold=4.627950732807928, name = 'ReL82334', )(Dot34990)
model = tf.keras.models.Model(inputs=[in0Mul96734,in1Mul96734,in0GRU79166], outputs=ReL82334)
w = model.get_layer('GRU79166').get_weights() 
w[0] = np.array([[7, 9, 1], [7, 6, 8], [1, 2, 2]])
w[1] = np.array([[10, 1, 9]])
w[2] = np.array([9, 10, 1])
model.get_layer('GRU79166').set_weights(w) 
in0Mul96734 = tf.constant([[[[[0.9421, 0.7973], [0.4357, 0.4663]], [[0.7631, 0.9696], [0.3571, 0.118]]]]])
in1Mul96734 = tf.constant([[[[[0.0771, 0.6021], [0.0874, 0.5506]], [[0.2675, 0.9627], [0.6973, 0.6223]]]]])
in0GRU79166 = tf.constant([[[4, 9, 10]]])
print (np.array2string(model.predict([in0Mul96734,in1Mul96734,in0GRU79166],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='ReL82334.png')

LMul96734 = multiply_layer([[[[[[0.9421, 0.7973], [0.4357, 0.4663]], [[0.7631, 0.9696], [0.3571, 0.118]]]]], [[[[[0.0771, 0.6021], [0.0874, 0.5506]], [[0.2675, 0.9627], [0.6973, 0.6223]]]]]], Mul96734), 
LRes15081 = reshape_layer(Mul96734, [1, 2, 4], Res15081), 
LRes88288 = reshape_layer(Res15081, [1, 8], Res88288), 
LGRU79166 = gru_layer([[[4, 9, 10]]],[[7, 9, 1], [7, 6, 8], [1, 2, 2]],[[10, 1, 9]],[9, 10, 1], false, GRU79166), 
LRes94097 = reshape_layer(GRU79166, [1, 1], Res94097), 
LRes30123 = reshape_layer(Res94097, [1, 1, 1], Res30123), 
LUp_98613 = up_sampling2D_layer(Res30123, 1, 1, Up_98613), 
LRes43396 = reshape_layer(Up_98613, [1, 1], Res43396), 
LDot34990 = dot_layer(Res88288,Res43396, 1, 1, Dot34990), 
LReL82334 = relu_layer(Dot34990, 7.454752896337583, 3.2160091692762793, 4.627950732807928, ReL82334), 
exec_layers([LMul96734,LRes15081,LRes88288,LGRU79166,LRes94097,LRes30123,LUp_98613,LRes43396,LDot34990,LReL82334],["Mul96734","Res15081","Res88288","GRU79166","Res94097","Res30123","Up_98613","Res43396","Dot34990","ReL82334"],ReL82334,"ReL82334")

Actual (Unparsed): [[[-14.8835320], [-14.8835320], [-14.8835320], [-14.8835320], [-14.8835320], [-14.8835320], [-14.8835320], [-14.8835320]]]

Expected (Unparsed): [[[-14.883531991669173],[-14.883531991669173],[-14.883531991669173],[-14.883531991669173],[-14.883531991669173],[-14.883531991669173],[-14.883531991669173],[-14.883531991669173]]]

Actual:   [[[-14.8835], [-14.8835], [-14.8835], [-14.8835], [-14.8835], [-14.8835], [-14.8835], [-14.8835]]]

Expected: [[[-14.8835], [-14.8835], [-14.8835], [-14.8835], [-14.8835], [-14.8835], [-14.8835], [-14.8835]]]