import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave7768 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Ave7768 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))

Ave7768 = keras.layers.Average(name = 'Ave7768', )([in0Ave7768,in1Ave7768])
Res15235 = keras.layers.Reshape((2, 2, 2), name = 'Res15235', )(Ave7768)
Res46684 = keras.layers.Reshape((2, 4), name = 'Res46684', )(Res15235)
Glo87857 = keras.layers.GlobalAveragePooling1D(name = 'Glo87857', )(Res46684)
Res94575 = keras.layers.Reshape((4, 1), name = 'Res94575', )(Glo87857)
Res69058 = keras.layers.Reshape((4, 1, 1), name = 'Res69058', )(Res94575)
Up_69382 = keras.layers.UpSampling2D(size=(1, 2), name = 'Up_69382', )(Res69058)
Glo49075 = keras.layers.GlobalAveragePooling2D(name = 'Glo49075', )(Up_69382)
Res68674 = keras.layers.Reshape((1, 1), name = 'Res68674', )(Glo49075)
Con83532 = keras.layers.Conv1D(4, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con83532', )(Res68674)
model = tf.keras.models.Model(inputs=[in0Ave7768,in1Ave7768], outputs=Con83532)
w = model.get_layer('Con83532').get_weights() 
w[0] = np.array([[[0.271, 0.4087, 0.8165, 0.2755]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con83532').set_weights(w) 
in0Ave7768 = tf.constant([[[[[0.3173], [0.0347]], [[0.2187], [0.0844]]], [[[0.3899], [0.4126]], [[0.3869], [0.3985]]]]])
in1Ave7768 = tf.constant([[[[[0.0682], [0.6043]], [[0.732], [0.4558]]], [[[0.5425], [0.6251]], [[0.1043], [0.4416]]]]])
print (np.array2string(model.predict([in0Ave7768,in1Ave7768],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con83532.png')

LAve7768 = average_layer([[[[[[0.3173], [0.0347]], [[0.2187], [0.0844]]], [[[0.3899], [0.4126]], [[0.3869], [0.3985]]]]], [[[[[0.0682], [0.6043]], [[0.732], [0.4558]]], [[[0.5425], [0.6251]], [[0.1043], [0.4416]]]]]], Ave7768), 
LRes15235 = reshape_layer(Ave7768, [2, 2, 2], Res15235), 
LRes46684 = reshape_layer(Res15235, [2, 4], Res46684), 
LGlo87857 = global_average_pooling1D_layer(Res46684, Glo87857), 
LRes94575 = reshape_layer(Glo87857, [4, 1], Res94575), 
LRes69058 = reshape_layer(Res94575, [4, 1, 1], Res69058), 
LUp_69382 = up_sampling2D_layer(Res69058, 1, 2, Up_69382), 
LGlo49075 = global_average_pooling2D_layer(Up_69382, Glo49075), 
LRes68674 = reshape_layer(Glo49075, [1, 1], Res68674), 
LCon83532 = conv1D_layer(Res68674, 1,[[[0.271, 0.4087, 0.8165, 0.2755]]],[0, 0, 0, 0], 1, false, 1, Con83532), 
exec_layers([LAve7768,LRes15235,LRes46684,LGlo87857,LRes94575,LRes69058,LUp_69382,LGlo49075,LRes68674,LCon83532],["Ave7768","Res15235","Res46684","Glo87857","Res94575","Res69058","Up_69382","Glo49075","Res68674","Con83532"],Con83532,"Con83532")

Actual (Unparsed): [[[0.0985221, 0.1485829, 0.2968386, 0.1001580]]]

Expected (Unparsed): [[[0.09852205000000001,0.14858288500000003,0.29683857500000005,0.10015802500000003]]]

Actual:   [[[0.0986, 0.1486, 0.2969, 0.1002]]]

Expected: [[[0.0986, 0.1486, 0.2969, 0.1002]]]