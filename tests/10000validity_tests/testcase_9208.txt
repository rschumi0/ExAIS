import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add46755 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Add46755 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Up_33444 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Con84482 = tf.keras.layers.Input(shape=([1]))

Add46755 = keras.layers.Add(name = 'Add46755', )([in0Add46755,in1Add46755])
Fla5594 = keras.layers.Flatten(name = 'Fla5594', )(Add46755)
Res25666 = keras.layers.Reshape((2, 1), name = 'Res25666', )(Fla5594)
Up_46613 = keras.layers.UpSampling1D(size=(1), name = 'Up_46613', )(Res25666)
Fla49263 = keras.layers.Flatten(name = 'Fla49263', )(Up_46613)
Up_33444 = keras.layers.UpSampling3D(size=(2, 1, 2), name = 'Up_33444', )(in0Up_33444)
Res33585 = keras.layers.Reshape((4, 2, 4), name = 'Res33585', )(Up_33444)
Con77369 = keras.layers.Conv2DTranspose(3, (4, 1),strides=(3, 1), padding='same', name = 'Con77369', )(Res33585)
Res97098 = keras.layers.Reshape((12, 2, 3, 1), name = 'Res97098', )(Con77369)
Glo16532 = keras.layers.GlobalMaxPool3D(name = 'Glo16532', )(Res97098)
Con84482 = keras.layers.Concatenate(axis=1, name = 'Con84482', )([Glo16532,in0Con84482])
Mul8919 = keras.layers.Multiply(name = 'Mul8919', )([Fla49263,Con84482])
model = tf.keras.models.Model(inputs=[in0Add46755,in1Add46755,in0Up_33444,in0Con84482], outputs=Mul8919)
w = model.get_layer('Con77369').get_weights() 
w[0] = np.array([[[[0.0357, 0.3505, 0.1531, 0.6381], [0.2625, 0.8922, 0.8902, 0.5698], [0.2284, 0.6883, 0.0333, 0.0396]]], [[[0.3828, 0.5201, 0.7687, 0.4044], [0.6936, 0.5729, 0.7865, 0.3149], [0.9225, 0.9521, 0.446, 0.9616]]], [[[0.2355, 0.7685, 0.4409, 0.8743], [0.5499, 0.3965, 0.3423, 0.5146], [0.9493, 0.3215, 0.9039, 0.4146]]], [[[0.8286, 0.454, 0.423, 0.2828], [0.1722, 0.9142, 0.7686, 0.324], [0.5117, 0.0675, 0.913, 0.0022]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con77369').set_weights(w) 
in0Add46755 = tf.constant([[[[0.9817, 0.5186]]]])
in1Add46755 = tf.constant([[[[0.3554, 0.5411]]]])
in0Up_33444 = tf.constant([[[[[1.9871, 1.0008]], [[1.8192, 1.7905]]], [[[1.6333, 1.5496]], [[1.4622, 1.989]]]]])
in0Con84482 = tf.constant([[0.4285]])
print (np.array2string(model.predict([in0Add46755,in1Add46755,in0Up_33444,in0Con84482],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul8919.png')

LAdd46755 = add_layer([[[[[0.9817, 0.5186]]]], [[[[0.3554, 0.5411]]]]], Add46755), 
LFla5594 = flatten_layer(Add46755, Fla5594), 
LRes25666 = reshape_layer(Fla5594, [2, 1], Res25666), 
LUp_46613 = up_sampling1D_layer(Res25666, 1, Up_46613), 
LFla49263 = flatten_layer(Up_46613, Fla49263), 
LUp_33444 = up_sampling3D_layer([[[[[1.9871, 1.0008]], [[1.8192, 1.7905]]], [[[1.6333, 1.5496]], [[1.4622, 1.989]]]]], 2, 1, 2, Up_33444), 
LRes33585 = reshape_layer(Up_33444, [4, 2, 4], Res33585), 
LCon77369 = conv2D_transpose_layer(Res33585, 4, 1,[[[[0.0357, 0.3505, 0.1531, 0.6381], [0.2625, 0.8922, 0.8902, 0.5698], [0.2284, 0.6883, 0.0333, 0.0396]]], [[[0.3828, 0.5201, 0.7687, 0.4044], [0.6936, 0.5729, 0.7865, 0.3149], [0.9225, 0.9521, 0.446, 0.9616]]], [[[0.2355, 0.7685, 0.4409, 0.8743], [0.5499, 0.3965, 0.3423, 0.5146], [0.9493, 0.3215, 0.9039, 0.4146]]], [[[0.8286, 0.454, 0.423, 0.2828], [0.1722, 0.9142, 0.7686, 0.324], [0.5117, 0.0675, 0.913, 0.0022]]]],[0, 0, 0], 3, 1, true, Con77369), 
LRes97098 = reshape_layer(Con77369, [12, 2, 3, 1], Res97098), 
LGlo16532 = global_max_pool3D_layer(Res97098, Glo16532), 
LCon84482 = concatenate_layer([Glo16532,[[0.4285]]], 1, Con84482), 
LMul8919 = multiply_layer([Fla49263,Con84482], Mul8919), 
exec_layers([LAdd46755,LFla5594,LRes25666,LUp_46613,LFla49263,LUp_33444,LRes33585,LCon77369,LRes97098,LGlo16532,LCon84482,LMul8919],["Add46755","Fla5594","Res25666","Up_46613","Fla49263","Up_33444","Res33585","Con77369","Res97098","Glo16532","Con84482","Mul8919"],Mul8919,"Mul8919")

Actual (Unparsed): [[11.5568274, 0.4540815]]

Expected (Unparsed): [[11.55682713243,0.45408144999999994]]

Actual:   [[11.5569, 0.4541]]

Expected: [[11.5569, 0.4541]]