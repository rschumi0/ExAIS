import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave56981 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Ave56981 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Zer63406 = tf.keras.layers.Input(shape=([4, 2]))
in0Con5076 = tf.keras.layers.Input(shape=([6, 2]))

Ave56981 = keras.layers.Average(name = 'Ave56981', )([in0Ave56981,in1Ave56981])
Res27213 = keras.layers.Reshape((2, 2, 2), name = 'Res27213', )(Ave56981)
Res96175 = keras.layers.Reshape((2, 4), name = 'Res96175', )(Res27213)
Zer78005 = keras.layers.ZeroPadding1D(padding=((4, 0)), name = 'Zer78005', )(Res96175)
Zer63406 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer63406', )(in0Zer63406)
Con5076 = keras.layers.Concatenate(axis=2, name = 'Con5076', )([Zer63406,in0Con5076])
Min84177 = keras.layers.Minimum(name = 'Min84177', )([Zer78005,Con5076])
Ave79130 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave79130', )(Min84177)
Res64651 = keras.layers.Reshape((6, 4, 1), name = 'Res64651', )(Ave79130)
Ave77702 = keras.layers.AveragePooling2D(pool_size=(3, 4), strides=(1, 1), padding='same', name = 'Ave77702', )(Res64651)
model = tf.keras.models.Model(inputs=[in0Ave56981,in1Ave56981,in0Zer63406,in0Con5076], outputs=Ave77702)
in0Ave56981 = tf.constant([[[[[0.4432, 0.6387]], [[0.1611, 0.2044]]], [[[0.0433, 0.7867]], [[0.2798, 0.0146]]]]])
in1Ave56981 = tf.constant([[[[[0.8125, 0.1567]], [[0.8114, 0.5375]]], [[[0.5207, 0.0977]], [[0.0976, 0.9043]]]]])
in0Zer63406 = tf.constant([[[1.0475, 1.1032], [1.4994, 1.3161], [1.9756, 1.5036], [1.0404, 1.0931]]])
in0Con5076 = tf.constant([[[0.0296, 0.2212], [0.7609, 0.3854], [0.1483, 0.0013], [0.9599, 0.6262], [0.0453, 0.4706], [0.7079, 0.8352]]])
print (np.array2string(model.predict([in0Ave56981,in1Ave56981,in0Zer63406,in0Con5076],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave77702.png')

LAve56981 = average_layer([[[[[[0.4432, 0.6387]], [[0.1611, 0.2044]]], [[[0.0433, 0.7867]], [[0.2798, 0.0146]]]]], [[[[[0.8125, 0.1567]], [[0.8114, 0.5375]]], [[[0.5207, 0.0977]], [[0.0976, 0.9043]]]]]], Ave56981), 
LRes27213 = reshape_layer(Ave56981, [2, 2, 2], Res27213), 
LRes96175 = reshape_layer(Res27213, [2, 4], Res96175), 
LZer78005 = zero_padding1D_layer(Res96175, 4, 0, Zer78005), 
LZer63406 = zero_padding1D_layer([[[1.0475, 1.1032], [1.4994, 1.3161], [1.9756, 1.5036], [1.0404, 1.0931]]], 1, 1, Zer63406), 
LCon5076 = concatenate_layer([Zer63406,[[[0.0296, 0.2212], [0.7609, 0.3854], [0.1483, 0.0013], [0.9599, 0.6262], [0.0453, 0.4706], [0.7079, 0.8352]]]], 2, Con5076), 
LMin84177 = minimum_layer([Zer78005,Con5076], Min84177), 
LAve79130 = average_pooling1D_layer(Min84177, 1, Ave79130), 
LRes64651 = reshape_layer(Ave79130, [6, 4, 1], Res64651), 
LAve77702 = average_pooling2D_layer(Res64651, 3, 4, 1, 1, true, Ave77702), 
exec_layers([LAve56981,LRes27213,LRes96175,LZer78005,LZer63406,LCon5076,LMin84177,LAve79130,LRes64651,LAve77702],["Ave56981","Res27213","Res96175","Zer78005","Zer63406","Con5076","Min84177","Ave79130","Res64651","Ave77702"],Ave77702,"Ave77702")

Actual (Unparsed): [[[[0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.1189833], [0.1201500], [0.0904389], [0.0693750]], [[0.1399500], [0.1741625], [0.1624556], [0.1774000]], [[0.2099250], [0.2612437], [0.2436833], [0.2661000]]]]

Expected (Unparsed): [[[[0],[0],[0],[0]],[[0],[0],[0],[0]],[[0],[0],[0],[0]],[[0.11898333333333332],[0.12014999999999998],[0.0904388888888889],[0.069375]],[[0.13995],[0.1741625],[0.16245555555555555],[0.1774]],[[0.209925],[0.26124375],[0.24368333333333334],[0.2661]]]]

Actual:   [[[[0], [0], [0], [0]], [[0], [0], [0], [0]], [[0], [0], [0], [0]], [[0.119], [0.1202], [0.0905], [0.0694]], [[0.14], [0.1742], [0.1625], [0.1774]], [[0.21], [0.2613], [0.2437], [0.2661]]]]

Expected: [[[[0], [0], [0], [0]], [[0], [0], [0], [0]], [[0], [0], [0], [0]], [[0.119], [0.1202], [0.0905], [0.0694]], [[0.14], [0.1742], [0.1625], [0.1774]], [[0.21], [0.2613], [0.2437], [0.2661]]]]