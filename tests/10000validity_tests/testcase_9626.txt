import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave15901 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Ave15901 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Con68036 = tf.keras.layers.Input(shape=([8, 2]))
in0Dot3726 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot3726 = tf.keras.layers.Input(shape=([3, 2]))

Ave15901 = keras.layers.Average(name = 'Ave15901', )([in0Ave15901,in1Ave15901])
Fla2267 = keras.layers.Flatten(name = 'Fla2267', )(Ave15901)
Thr2216 = keras.layers.ThresholdedReLU(theta=5.455064342744146, name = 'Thr2216', )(Fla2267)
Res50902 = keras.layers.Reshape((8, 1), name = 'Res50902', )(Thr2216)
Con68036 = keras.layers.Concatenate(axis=2, name = 'Con68036', )([Res50902,in0Con68036])
Dot3726 = keras.layers.Dot(axes=(2, 2), name = 'Dot3726', )([in0Dot3726,in1Dot3726])
Zer89627 = keras.layers.ZeroPadding1D(padding=((5, 0)), name = 'Zer89627', )(Dot3726)
Max29682 = keras.layers.Maximum(name = 'Max29682', )([Con68036,Zer89627])
model = tf.keras.models.Model(inputs=[in0Ave15901,in1Ave15901,in0Con68036,in0Dot3726,in1Dot3726], outputs=Max29682)
in0Ave15901 = tf.constant([[[[[0.6718], [0.8204]], [[0.6035], [0.9802]]], [[[0.372], [0.3708]], [[0.3661], [0.0072]]]]])
in1Ave15901 = tf.constant([[[[[0.2302], [0.2569]], [[0.0013], [0.7409]]], [[[0.0216], [0.1792]], [[0.654], [0.0573]]]]])
in0Con68036 = tf.constant([[[0.3558, 0.9733], [0.6773, 0.2155], [0.0545, 0.9524], [0.648, 0.5539], [0.8345, 0.6435], [0.5543, 0.7933], [0.484, 0.6385], [0.7911, 0.6656]]])
in0Dot3726 = tf.constant([[[0.4717, 0.9563], [0.7641, 0.3257], [0.2255, 0.8671]]])
in1Dot3726 = tf.constant([[[0.9939, 0.1946], [0.5134, 0.1757], [0.3261, 0.152]]])
print (np.array2string(model.predict([in0Ave15901,in1Ave15901,in0Con68036,in0Dot3726,in1Dot3726],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max29682.png')

LAve15901 = average_layer([[[[[[0.6718], [0.8204]], [[0.6035], [0.9802]]], [[[0.372], [0.3708]], [[0.3661], [0.0072]]]]], [[[[[0.2302], [0.2569]], [[0.0013], [0.7409]]], [[[0.0216], [0.1792]], [[0.654], [0.0573]]]]]], Ave15901), 
LFla2267 = flatten_layer(Ave15901, Fla2267), 
LThr2216 = thresholded_relu_layer(Fla2267, 5.455064342744146, Thr2216), 
LRes50902 = reshape_layer(Thr2216, [8, 1], Res50902), 
LCon68036 = concatenate_layer([Res50902,[[[0.3558, 0.9733], [0.6773, 0.2155], [0.0545, 0.9524], [0.648, 0.5539], [0.8345, 0.6435], [0.5543, 0.7933], [0.484, 0.6385], [0.7911, 0.6656]]]], 2, Con68036), 
LDot3726 = dot_layer([[[0.4717, 0.9563], [0.7641, 0.3257], [0.2255, 0.8671]]], [[[0.9939, 0.1946], [0.5134, 0.1757], [0.3261, 0.152]]], 2, 2, Dot3726), 
LZer89627 = zero_padding1D_layer(Dot3726, 5, 0, Zer89627), 
LMax29682 = maximum_layer([Con68036,Zer89627], Max29682), 
exec_layers([LAve15901,LFla2267,LThr2216,LRes50902,LCon68036,LDot3726,LZer89627,LMax29682],["Ave15901","Fla2267","Thr2216","Res50902","Con68036","Dot3726","Zer89627","Max29682"],Max29682,"Max29682")

Actual (Unparsed): [[[0.0000000, 0.3558000, 0.9733000], [0.0000000, 0.6773000, 0.2155000], [0.0000000, 0.0545000, 0.9524000], [0.0000000, 0.6480000, 0.5539000], [0.0000000, 0.8345000, 0.6435000], [0.6549186, 0.5543000, 0.7933000], [0.8228202, 0.4840000, 0.6385000], [0.3928621, 0.7911000, 0.6656000]]]

Expected (Unparsed): [[[0,0.3558,0.9733],[0,0.6773,0.2155],[0,0.0545,0.9524],[0,0.648,0.5539],[0,0.8345,0.6435],[0.65491861,0.5543,0.7933],[0.82282021,0.484,0.6385],[0.39286211,0.7911,0.6656]]]

Actual:   [[[0, 0.3558, 0.9733], [0, 0.6773, 0.2155], [0, 0.0545, 0.9524], [0, 0.648, 0.5539], [0, 0.8345, 0.6435], [0.655, 0.5543, 0.7933], [0.8229, 0.484, 0.6385], [0.3929, 0.7911, 0.6656]]]

Expected: [[[0, 0.3558, 0.9733], [0, 0.6773, 0.2155], [0, 0.0545, 0.9524], [0, 0.648, 0.5539], [0, 0.8345, 0.6435], [0.655, 0.5543, 0.7933], [0.8229, 0.484, 0.6385], [0.3929, 0.7911, 0.6656]]]