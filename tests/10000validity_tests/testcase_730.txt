import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max96711 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Max96711 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con90677 = tf.keras.layers.Input(shape=([1, 2]))
in0Sub89406 = tf.keras.layers.Input(shape=([2]))
in1Sub89406 = tf.keras.layers.Input(shape=([2]))
in0Ave64937 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave64937 = tf.keras.layers.Input(shape=([2, 2]))

Max96711 = keras.layers.Maximum(name = 'Max96711', )([in0Max96711,in1Max96711])
Cro19104 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro19104', )(Max96711)
Res4009 = keras.layers.Reshape((1, 2), name = 'Res4009', )(Cro19104)
Con90677 = keras.layers.Concatenate(axis=2, name = 'Con90677', )([Res4009,in0Con90677])
Sub89406 = keras.layers.Subtract(name = 'Sub89406', )([in0Sub89406,in1Sub89406])
Thr88370 = keras.layers.ThresholdedReLU(theta=6.89550197232752, name = 'Thr88370', )(Sub89406)
Res82480 = keras.layers.Reshape((2, 1), name = 'Res82480', )(Thr88370)
Ave64937 = keras.layers.Average(name = 'Ave64937', )([in0Ave64937,in1Ave64937])
Sep57188 = keras.layers.SeparableConv1D(4, (2),strides=(1), padding='same', name = 'Sep57188', )(Ave64937)
Dot69801 = keras.layers.Dot(axes=(1, 1), name = 'Dot69801', )([Res82480,Sep57188])
Ave23275 = keras.layers.Average(name = 'Ave23275', )([Con90677,Dot69801])
model = tf.keras.models.Model(inputs=[in0Max96711,in1Max96711,in0Con90677,in0Sub89406,in1Sub89406,in0Ave64937,in1Ave64937], outputs=Ave23275)
w = model.get_layer('Sep57188').get_weights() 
w[0] = np.array([[[0.1068], [0.4693]], [[0.4785], [0.4154]]])
w[1] = np.array([[[0.502, 0.6085, 0.7302, 0.4053], [0.1609, 0.4113, 0.3035, 0.2099]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep57188').set_weights(w) 
in0Max96711 = tf.constant([[[[0.5369, 0.7371]]]])
in1Max96711 = tf.constant([[[[0.735, 0.8326]]]])
in0Con90677 = tf.constant([[[0.427, 0.0077]]])
in0Sub89406 = tf.constant([[0.8107, 0.1539]])
in1Sub89406 = tf.constant([[0.727, 0.5116]])
in0Ave64937 = tf.constant([[[0.7381, 0.8146], [0.7163, 0.691]]])
in1Ave64937 = tf.constant([[[0.1467, 0.747], [0.2389, 0.462]]])
print (np.array2string(model.predict([in0Max96711,in1Max96711,in0Con90677,in0Sub89406,in1Sub89406,in0Ave64937,in1Ave64937],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave23275.png')

LMax96711 = maximum_layer([[[[[0.5369, 0.7371]]]], [[[[0.735, 0.8326]]]]], Max96711), 
LCro19104 = cropping2D_layer(Max96711, 0, 0, 0, 0, Cro19104), 
LRes4009 = reshape_layer(Cro19104, [1, 2], Res4009), 
LCon90677 = concatenate_layer([Res4009,[[[0.427, 0.0077]]]], 2, Con90677), 
LSub89406 = subtract_layer([[0.8107, 0.1539]], [[0.727, 0.5116]], Sub89406), 
LThr88370 = thresholded_relu_layer(Sub89406, 6.89550197232752, Thr88370), 
LRes82480 = reshape_layer(Thr88370, [2, 1], Res82480), 
LAve64937 = average_layer([[[[0.7381, 0.8146], [0.7163, 0.691]]], [[[0.1467, 0.747], [0.2389, 0.462]]]], Ave64937), 
LSep57188 = separable_conv1D_layer(Ave64937, 2,[[[[0.1068], [0.4693]], [[0.4785], [0.4154]]],[[[0.502, 0.6085, 0.7302, 0.4053], [0.1609, 0.4113, 0.3035, 0.2099]]]],[0, 0, 0, 0], 1, true, Sep57188), 
LDot69801 = dot_layer(Res82480,Sep57188, 1, 1, Dot69801), 
LAve23275 = average_layer([Con90677,Dot69801], Ave23275), 
exec_layers([LMax96711,LCro19104,LRes4009,LCon90677,LSub89406,LThr88370,LRes82480,LAve64937,LSep57188,LDot69801,LAve23275],["Max96711","Cro19104","Res4009","Con90677","Sub89406","Thr88370","Res82480","Ave64937","Sep57188","Dot69801","Ave23275"],Ave23275,"Ave23275")

Actual (Unparsed): [[[0.3675000, 0.4163000, 0.2135000, 0.0038500]]]

Expected (Unparsed): [[[0.3675,0.4163,0.2135,0.00385]]]

Actual:   [[[0.3675, 0.4163, 0.2135, 0.0039]]]

Expected: [[[0.3675, 0.4163, 0.2135, 0.0039]]]