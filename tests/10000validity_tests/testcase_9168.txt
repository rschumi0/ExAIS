import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add41002 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Add41002 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con81056 = tf.keras.layers.Input(shape=([4, 3, 1]))
in0Cro91525 = tf.keras.layers.Input(shape=([4, 1, 3]))

Add41002 = keras.layers.Add(name = 'Add41002', )([in0Add41002,in1Add41002])
Res22549 = keras.layers.Reshape((1, 2, 2, 1), name = 'Res22549', )(Add41002)
Up_63385 = keras.layers.UpSampling3D(size=(1, 1, 1), name = 'Up_63385', )(Res22549)
Res93230 = keras.layers.Reshape((1, 2, 2), name = 'Res93230', )(Up_63385)
Zer36703 = keras.layers.ZeroPadding2D(padding=((3, 0), (1, 0)), name = 'Zer36703', )(Res93230)
Con81056 = keras.layers.Concatenate(axis=3, name = 'Con81056', )([Zer36703,in0Con81056])
Cro91525 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro91525', )(in0Cro91525)
Zer81416 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer81416', )(Cro91525)
Mul26236 = keras.layers.Multiply(name = 'Mul26236', )([Con81056,Zer81416])
Fla86328 = keras.layers.Flatten(name = 'Fla86328', )(Mul26236)
model = tf.keras.models.Model(inputs=[in0Add41002,in1Add41002,in0Con81056,in0Cro91525], outputs=Fla86328)
in0Add41002 = tf.constant([[[[0.7199, 0.598], [0.3129, 0.7082]]]])
in1Add41002 = tf.constant([[[[0.2206, 0.4904], [0.4116, 0.4552]]]])
in0Con81056 = tf.constant([[[[0.2021], [0.4324], [0.5341]], [[0.9245], [0.7725], [0.202]], [[0.9213], [0.4403], [0.7049]], [[0.621], [0.4162], [0.9959]]]])
in0Cro91525 = tf.constant([[[[1.8845, 1.7057, 1.5962]], [[1.1739, 1.8118, 1.1213]], [[1.768, 1.2722, 1.0876]], [[1.207, 1.6817, 1.9026]]]])
print (np.array2string(model.predict([in0Add41002,in1Add41002,in0Con81056,in0Cro91525],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Fla86328.png')

LAdd41002 = add_layer([[[[[0.7199, 0.598], [0.3129, 0.7082]]]], [[[[0.2206, 0.4904], [0.4116, 0.4552]]]]], Add41002), 
LRes22549 = reshape_layer(Add41002, [1, 2, 2, 1], Res22549), 
LUp_63385 = up_sampling3D_layer(Res22549, 1, 1, 1, Up_63385), 
LRes93230 = reshape_layer(Up_63385, [1, 2, 2], Res93230), 
LZer36703 = zero_padding2D_layer(Res93230, 3, 0, 1, 0, Zer36703), 
LCon81056 = concatenate_layer([Zer36703,[[[[0.2021], [0.4324], [0.5341]], [[0.9245], [0.7725], [0.202]], [[0.9213], [0.4403], [0.7049]], [[0.621], [0.4162], [0.9959]]]]], 3, Con81056), 
LCro91525 = cropping2D_layer([[[[1.8845, 1.7057, 1.5962]], [[1.1739, 1.8118, 1.1213]], [[1.768, 1.2722, 1.0876]], [[1.207, 1.6817, 1.9026]]]], 0, 0, 0, 0, Cro91525), 
LZer81416 = zero_padding2D_layer(Cro91525, 0, 0, 2, 0, Zer81416), 
LMul26236 = multiply_layer([Con81056,Zer81416], Mul26236), 
LFla86328 = flatten_layer(Mul26236, Fla86328), 
exec_layers([LAdd41002,LRes22549,LUp_63385,LRes93230,LZer36703,LCon81056,LCro91525,LZer81416,LMul26236,LFla86328],["Add41002","Res22549","Up_63385","Res93230","Zer36703","Con81056","Cro91525","Zer81416","Mul26236","Fla86328"],Fla86328,"Fla86328")

Actual (Unparsed): [[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.8525304, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.2265026, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.7666493, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.8744715, 1.9564897, 1.8947993]]

Expected (Unparsed): [[0,0,0.0,0,0,0.0,0.0,0.0,0.85253042,0,0,0.0,0,0,0.0,0.0,0.0,0.2265026,0,0,0.0,0,0,0.0,0.0,0.0,0.7666492399999999,0,0,0.0,0.0,0.0,0.0,0.8744715000000001,1.9564897799999998,1.89479934]]

Actual:   [[0, 0, 0, 0, 0, 0, 0, 0, 0.8526, 0, 0, 0, 0, 0, 0, 0, 0, 0.2266, 0, 0, 0, 0, 0, 0, 0, 0, 0.7667, 0, 0, 0, 0, 0, 0, 0.8745, 1.9565, 1.8948]]

Expected: [[0, 0, 0, 0, 0, 0, 0, 0, 0.8526, 0, 0, 0, 0, 0, 0, 0, 0, 0.2266, 0, 0, 0, 0, 0, 0, 0, 0, 0.7667, 0, 0, 0, 0, 0, 0, 0.8745, 1.9565, 1.8948]]