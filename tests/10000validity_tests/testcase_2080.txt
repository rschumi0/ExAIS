import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub65673 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub65673 = tf.keras.layers.Input(shape=([3, 2]))
in0Ave1082 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave1082 = tf.keras.layers.Input(shape=([2, 1]))

Sub65673 = keras.layers.Subtract(name = 'Sub65673', )([in0Sub65673,in1Sub65673])
Fla47374 = keras.layers.Flatten(name = 'Fla47374', )(Sub65673)
Res32493 = keras.layers.Reshape((6, 1), name = 'Res32493', )(Fla47374)
Res11072 = keras.layers.Reshape((6, 1, 1), name = 'Res11072', )(Res32493)
Ave1082 = keras.layers.Average(name = 'Ave1082', )([in0Ave1082,in1Ave1082])
Mas40860 = keras.layers.Masking(mask_value=2, name = 'Mas40860', )(Ave1082)
Res28093 = keras.layers.Reshape((2, 1, 1), name = 'Res28093', )(Mas40860)
Up_16378 = keras.layers.UpSampling2D(size=(1, 1), name = 'Up_16378', )(Res28093)
Zer42920 = keras.layers.ZeroPadding2D(padding=((4, 0), (0, 0)), name = 'Zer42920', )(Up_16378)
Add51647 = keras.layers.Add(name = 'Add51647', )([Res11072,Zer42920])
Res43467 = keras.layers.Reshape((6, 1, 1, 1), name = 'Res43467', )(Add51647)
Glo89774 = keras.layers.GlobalMaxPool3D(name = 'Glo89774', )(Res43467)
model = tf.keras.models.Model(inputs=[in0Sub65673,in1Sub65673,in0Ave1082,in1Ave1082], outputs=Glo89774)
in0Sub65673 = tf.constant([[[0.2158, 0.5089], [0.7906, 0.5426], [0.321, 0.4769]]])
in1Sub65673 = tf.constant([[[0.8953, 0.9752], [0.0842, 0.5432], [0.2172, 0.3058]]])
in0Ave1082 = tf.constant([[[0.8527], [0.8892]]])
in1Ave1082 = tf.constant([[[0.1616], [0.4591]]])
print (np.array2string(model.predict([in0Sub65673,in1Sub65673,in0Ave1082,in1Ave1082],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo89774.png')

LSub65673 = subtract_layer([[[0.2158, 0.5089], [0.7906, 0.5426], [0.321, 0.4769]]], [[[0.8953, 0.9752], [0.0842, 0.5432], [0.2172, 0.3058]]], Sub65673), 
LFla47374 = flatten_layer(Sub65673, Fla47374), 
LRes32493 = reshape_layer(Fla47374, [6, 1], Res32493), 
LRes11072 = reshape_layer(Res32493, [6, 1, 1], Res11072), 
LAve1082 = average_layer([[[[0.8527], [0.8892]]], [[[0.1616], [0.4591]]]], Ave1082), 
LMas40860 = masking_layer(Ave1082, 2, Mas40860), 
LRes28093 = reshape_layer(Mas40860, [2, 1, 1], Res28093), 
LUp_16378 = up_sampling2D_layer(Res28093, 1, 1, Up_16378), 
LZer42920 = zero_padding2D_layer(Up_16378, 4, 0, 0, 0, Zer42920), 
LAdd51647 = add_layer([Res11072,Zer42920], Add51647), 
LRes43467 = reshape_layer(Add51647, [6, 1, 1, 1], Res43467), 
LGlo89774 = global_max_pool3D_layer(Res43467, Glo89774), 
exec_layers([LSub65673,LFla47374,LRes32493,LRes11072,LAve1082,LMas40860,LRes28093,LUp_16378,LZer42920,LAdd51647,LRes43467,LGlo89774],["Sub65673","Fla47374","Res32493","Res11072","Ave1082","Mas40860","Res28093","Up_16378","Zer42920","Add51647","Res43467","Glo89774"],Glo89774,"Glo89774")

Actual (Unparsed): [[0.8452500]]

Expected (Unparsed): [[0.8452500000000001]]

Actual:   [[0.8453]]

Expected: [[0.8453]]