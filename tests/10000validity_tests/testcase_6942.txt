import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add82330 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Add82330 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Bat54655 = tf.keras.layers.Input(shape=([2]))
in0Con72915 = tf.keras.layers.Input(shape=([3, 3]))
in0Mul15799 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Mul15799 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Min47452 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Min47452 = tf.keras.layers.Input(shape=([2, 1, 1]))

Add82330 = keras.layers.Add(name = 'Add82330', )([in0Add82330,in1Add82330])
Res73443 = keras.layers.Reshape((2, 2), name = 'Res73443', )(Add82330)
Zer28323 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer28323', )(Res73443)
Bat54655 = keras.layers.BatchNormalization(axis=1, epsilon=0.9061896378623138,  name = 'Bat54655', )(in0Bat54655)
Res7812 = keras.layers.Reshape((2, 1), name = 'Res7812', )(Bat54655)
Zer9477 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer9477', )(Res7812)
Con72915 = keras.layers.Concatenate(axis=2, name = 'Con72915', )([Zer9477,in0Con72915])
Mul15799 = keras.layers.Multiply(name = 'Mul15799', )([in0Mul15799,in1Mul15799])
Res6368 = keras.layers.Reshape((1, 2, 2), name = 'Res6368', )(Mul15799)
Res3938 = keras.layers.Reshape((1, 4), name = 'Res3938', )(Res6368)
Dot95375 = keras.layers.Dot(axes=(2, 2), name = 'Dot95375', )([Con72915,Res3938])
Min47452 = keras.layers.Minimum(name = 'Min47452', )([in0Min47452,in1Min47452])
Mas78703 = keras.layers.Masking(mask_value=1, name = 'Mas78703', )(Min47452)
Res34599 = keras.layers.Reshape((2, 1), name = 'Res34599', )(Mas78703)
Dot18271 = keras.layers.Dot(axes=(2, 2), name = 'Dot18271', )([Dot95375,Res34599])
Max27339 = keras.layers.Maximum(name = 'Max27339', )([Zer28323,Dot18271])
model = tf.keras.models.Model(inputs=[in0Add82330,in1Add82330,in0Bat54655,in0Con72915,in0Mul15799,in1Mul15799,in0Min47452,in1Min47452], outputs=Max27339)
w = model.get_layer('Bat54655').get_weights() 
w[0] = np.array([0.9195, 0.7598])
w[1] = np.array([0.2823, 0.4661])
w[2] = np.array([0.6654, 0.7879])
w[3] = np.array([0.389, 0.843])
model.get_layer('Bat54655').set_weights(w) 
in0Add82330 = tf.constant([[[[0.1189, 0.164]], [[0.4349, 0.8504]]]])
in1Add82330 = tf.constant([[[[0.3773, 0.8214]], [[0.1149, 0.402]]]])
in0Bat54655 = tf.constant([[1.3556, 1.446]])
in0Con72915 = tf.constant([[[0.7778, 0.9855, 0.5758], [0.4517, 0.4482, 0.1296], [0.7351, 0.9881, 0.6778]]])
in0Mul15799 = tf.constant([[[[[0.592, 0.3311]], [[0.5339, 0.952]]]]])
in1Mul15799 = tf.constant([[[[[0.2577, 0.0126]], [[0.4009, 0.0693]]]]])
in0Min47452 = tf.constant([[[[0.7711]], [[0.3522]]]])
in1Min47452 = tf.constant([[[[0.1877]], [[0.4475]]]])
print (np.array2string(model.predict([in0Add82330,in1Add82330,in0Bat54655,in0Con72915,in0Mul15799,in1Mul15799,in0Min47452,in1Min47452],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max27339.png')

LAdd82330 = add_layer([[[[[0.1189, 0.164]], [[0.4349, 0.8504]]]], [[[[0.3773, 0.8214]], [[0.1149, 0.402]]]]], Add82330), 
LRes73443 = reshape_layer(Add82330, [2, 2], Res73443), 
LZer28323 = zero_padding1D_layer(Res73443, 1, 0, Zer28323), 
LBat54655 = batch_normalization_layer([[1.3556, 1.446]], 1, 0.9061896378623138, [0.9195, 0.7598], [0.2823, 0.4661], [0.6654, 0.7879], [0.389, 0.843], Bat54655), 
LRes7812 = reshape_layer(Bat54655, [2, 1], Res7812), 
LZer9477 = zero_padding1D_layer(Res7812, 1, 0, Zer9477), 
LCon72915 = concatenate_layer([Zer9477,[[[0.7778, 0.9855, 0.5758], [0.4517, 0.4482, 0.1296], [0.7351, 0.9881, 0.6778]]]], 2, Con72915), 
LMul15799 = multiply_layer([[[[[[0.592, 0.3311]], [[0.5339, 0.952]]]]], [[[[[0.2577, 0.0126]], [[0.4009, 0.0693]]]]]], Mul15799), 
LRes6368 = reshape_layer(Mul15799, [1, 2, 2], Res6368), 
LRes3938 = reshape_layer(Res6368, [1, 4], Res3938), 
LDot95375 = dot_layer(Con72915,Res3938, 2, 2, Dot95375), 
LMin47452 = minimum_layer([[[[[0.7711]], [[0.3522]]]], [[[[0.1877]], [[0.4475]]]]], Min47452), 
LMas78703 = masking_layer(Min47452, 1, Mas78703), 
LRes34599 = reshape_layer(Mas78703, [2, 1], Res34599), 
LDot18271 = dot_layer(Dot95375,Res34599, 2, 2, Dot18271), 
LMax27339 = maximum_layer([Zer28323,Dot18271], Max27339), 
exec_layers([LAdd82330,LRes73443,LZer28323,LBat54655,LRes7812,LZer9477,LCon72915,LMul15799,LRes6368,LRes3938,LDot95375,LMin47452,LMas78703,LRes34599,LDot18271,LMax27339],["Add82330","Res73443","Zer28323","Bat54655","Res7812","Zer9477","Con72915","Mul15799","Res6368","Res3938","Dot95375","Min47452","Mas78703","Res34599","Dot18271","Max27339"],Max27339,"Max27339")

Actual (Unparsed): [[[0.0473322, 0.0888141], [0.4962000, 0.9854000], [0.5498000, 1.2524000]]]

Expected (Unparsed): [[[0.0473321952900261,0.08881406063477461],[0.49620000000000003,0.9854],[0.5498000000000001,1.2524000000000002]]]

Actual:   [[[0.0474, 0.0889], [0.4962, 0.9854], [0.5498, 1.2524]]]

Expected: [[[0.0474, 0.0889], [0.4963, 0.9854], [0.5499, 1.2525]]]