import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave81939 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Ave81939 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in0Max28009 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Max28009 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Ave4359 = tf.keras.layers.Input(shape=([2, 2]))

Ave81939 = keras.layers.Average(name = 'Ave81939', )([in0Ave81939,in1Ave81939])
Zer92885 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (0, 0)), name = 'Zer92885', )(Ave81939)
Max28009 = keras.layers.Maximum(name = 'Max28009', )([in0Max28009,in1Max28009])
Sub62745 = keras.layers.Subtract(name = 'Sub62745', )([Zer92885,Max28009])
Res46587 = keras.layers.Reshape((2, 2, 1), name = 'Res46587', )(Sub62745)
Ave4359 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='valid', name = 'Ave4359', )(in0Ave4359)
Res15891 = keras.layers.Reshape((2, 2, 1), name = 'Res15891', )(Ave4359)
Sep11121 = keras.layers.SeparableConv2D(2, (1, 1),strides=(1, 1), padding='same', name = 'Sep11121', )(Res15891)
Res84167 = keras.layers.Reshape((2, 4), name = 'Res84167', )(Sep11121)
Con89448 = keras.layers.Conv1D(4, (2),strides=(1), padding='valid', dilation_rate=(1), name = 'Con89448', )(Res84167)
Res95038 = keras.layers.Reshape((2, 2, 1), name = 'Res95038', )(Con89448)
Sub10089 = keras.layers.Subtract(name = 'Sub10089', )([Res46587,Res95038])
model = tf.keras.models.Model(inputs=[in0Ave81939,in1Ave81939,in0Max28009,in1Max28009,in0Ave4359], outputs=Sub10089)
w = model.get_layer('Sep11121').get_weights() 
w[0] = np.array([[[[0.8295]]]])
w[1] = np.array([[[[0.2237, 0.6121]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep11121').set_weights(w) 
w = model.get_layer('Con89448').get_weights() 
w[0] = np.array([[[0.8994, 0.2984, 0.5333, 0.133], [0.7156, 0.7652, 0.3537, 0.6458], [0.7959, 0.6111, 0.6646, 0.1483], [0.6671, 0.1396, 0.6644, 0.15]], [[0.7484, 0.0055, 0.5793, 0.1708], [0.8585, 0.1343, 0.9897, 0.9555], [0.7142, 0.3397, 0.6297, 0.0387], [0.9277, 0.2066, 0.6482, 0.1851]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con89448').set_weights(w) 
in0Ave81939 = tf.constant([[[[[0.2321]]]]])
in1Ave81939 = tf.constant([[[[[0.5315]]]]])
in0Max28009 = tf.constant([[[[[0.131]], [[0.0451]]], [[[0.2468]], [[0.6218]]]]])
in1Max28009 = tf.constant([[[[[0.1451]], [[0.7286]]], [[[0.9491]], [[0.8521]]]]])
in0Ave4359 = tf.constant([[[1.5786, 1.2684], [1.9841, 1.2031]]])
print (np.array2string(model.predict([in0Ave81939,in1Ave81939,in0Max28009,in1Max28009,in0Ave4359],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub10089.png')

LAve81939 = average_layer([[[[[[0.2321]]]]], [[[[[0.5315]]]]]], Ave81939), 
LZer92885 = zero_padding3D_layer(Ave81939, 1, 0, 1, 0, 0, 0, Zer92885), 
LMax28009 = maximum_layer([[[[[[0.131]], [[0.0451]]], [[[0.2468]], [[0.6218]]]]], [[[[[0.1451]], [[0.7286]]], [[[0.9491]], [[0.8521]]]]]], Max28009), 
LSub62745 = subtract_layer(Zer92885,Max28009, Sub62745), 
LRes46587 = reshape_layer(Sub62745, [2, 2, 1], Res46587), 
LAve4359 = average_pooling1D_layer([[[1.5786, 1.2684], [1.9841, 1.2031]]], 1, 1, false, Ave4359), 
LRes15891 = reshape_layer(Ave4359, [2, 2, 1], Res15891), 
LSep11121 = separable_conv2D_layer(Res15891, 1, 1,[[[[[0.8295]]]],[[[[0.2237, 0.6121]]]]],[0, 0], 1, 1, true, Sep11121), 
LRes84167 = reshape_layer(Sep11121, [2, 4], Res84167), 
LCon89448 = conv1D_layer(Res84167, 2,[[[0.8994, 0.2984, 0.5333, 0.133], [0.7156, 0.7652, 0.3537, 0.6458], [0.7959, 0.6111, 0.6646, 0.1483], [0.6671, 0.1396, 0.6644, 0.15]], [[0.7484, 0.0055, 0.5793, 0.1708], [0.8585, 0.1343, 0.9897, 0.9555], [0.7142, 0.3397, 0.6297, 0.0387], [0.9277, 0.2066, 0.6482, 0.1851]]],[0, 0, 0, 0], 1, false, 1, Con89448), 
LRes95038 = reshape_layer(Con89448, [2, 2, 1], Res95038), 
LSub10089 = subtract_layer(Res46587,Res95038, Sub10089), 
exec_layers([LAve81939,LZer92885,LMax28009,LSub62745,LRes46587,LAve4359,LRes15891,LSep11121,LRes84167,LCon89448,LRes95038,LSub10089],["Ave81939","Zer92885","Max28009","Sub62745","Res46587","Ave4359","Res15891","Sep11121","Res84167","Con89448","Res95038","Sub10089"],Sub10089,"Sub10089")

Actual (Unparsed): [[[[-3.4655919], [-2.0024203]], [[-3.7199574], [-2.3055469]]]]

Expected (Unparsed): [[[[-3.4655919117119334],[-2.0024202813694925]],[[-3.719957368521505],[-2.3055468237875134]]]]

Actual:   [[[[-3.4655], [-2.0024]], [[-3.7199], [-2.3055]]]]

Expected: [[[[-3.4655], [-2.0024]], [[-3.7199], [-2.3055]]]]