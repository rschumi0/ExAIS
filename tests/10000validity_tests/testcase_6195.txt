import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave13297 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Ave13297 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Con75581 = tf.keras.layers.Input(shape=([3, 2]))
in0Con98230 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))

Ave13297 = keras.layers.Average(name = 'Ave13297', )([in0Ave13297,in1Ave13297])
Res19115 = keras.layers.Reshape((2, 2, 1), name = 'Res19115', )(Ave13297)
Res88226 = keras.layers.Reshape((2, 2), name = 'Res88226', )(Res19115)
Zer61987 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer61987', )(Res88226)
Con75581 = keras.layers.Concatenate(axis=2, name = 'Con75581', )([Zer61987,in0Con75581])
Con98230 = keras.layers.Conv3D(2, (1, 1, 1),strides=(8, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con98230', )(in0Con98230)
Res63198 = keras.layers.Reshape((1, 1, 2), name = 'Res63198', )(Con98230)
Res65465 = keras.layers.Reshape((1, 2), name = 'Res65465', )(Res63198)
GRU95685 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU95685', )(Res65465)
Res12060 = keras.layers.Reshape((2, 1), name = 'Res12060', )(GRU95685)
Res81486 = keras.layers.Reshape((2, 1, 1), name = 'Res81486', )(Res12060)
Con43827 = keras.layers.Conv2D(4, (1, 1),strides=(2, 1), padding='valid', dilation_rate=(1, 1), name = 'Con43827', )(Res81486)
Res38740 = keras.layers.Reshape((1, 4), name = 'Res38740', )(Con43827)
Zer16422 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer16422', )(Res38740)
Mul14512 = keras.layers.Multiply(name = 'Mul14512', )([Con75581,Zer16422])
model = tf.keras.models.Model(inputs=[in0Ave13297,in1Ave13297,in0Con75581,in0Con98230], outputs=Mul14512)
w = model.get_layer('Con98230').get_weights() 
w[0] = np.array([[[[[0.1683, 0.491], [0.5578, 0.7455]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con98230').set_weights(w) 
w = model.get_layer('GRU95685').get_weights() 
w[0] = np.array([[4, 10, 1, 7, 4, 6], [2, 4, 9, 3, 4, 9]])
w[1] = np.array([[1, 7, 6, 4, 10, 7], [10, 6, 2, 10, 6, 9]])
w[2] = np.array([3, 4, 2, 10, 3, 1])
model.get_layer('GRU95685').set_weights(w) 
w = model.get_layer('Con43827').get_weights() 
w[0] = np.array([[[[0.335, 0.4055, 0.7375, 0.1379]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con43827').set_weights(w) 
in0Ave13297 = tf.constant([[[[[0.9084]], [[0.6197]]], [[[0.5122]], [[0.8722]]]]])
in1Ave13297 = tf.constant([[[[[0.7373]], [[0.4839]]], [[[0.7679]], [[0.9654]]]]])
in0Con75581 = tf.constant([[[0.1985, 0.6824], [0.2707, 0.7277], [0.0365, 0.098]]])
in0Con98230 = tf.constant([[[[[0.5997, 0.6826]]], [[[0.3002, 0.7658]]]]])
print (np.array2string(model.predict([in0Ave13297,in1Ave13297,in0Con75581,in0Con98230],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul14512.png')

LAve13297 = average_layer([[[[[[0.9084]], [[0.6197]]], [[[0.5122]], [[0.8722]]]]], [[[[[0.7373]], [[0.4839]]], [[[0.7679]], [[0.9654]]]]]], Ave13297), 
LRes19115 = reshape_layer(Ave13297, [2, 2, 1], Res19115), 
LRes88226 = reshape_layer(Res19115, [2, 2], Res88226), 
LZer61987 = zero_padding1D_layer(Res88226, 1, 0, Zer61987), 
LCon75581 = concatenate_layer([Zer61987,[[[0.1985, 0.6824], [0.2707, 0.7277], [0.0365, 0.098]]]], 2, Con75581), 
LCon98230 = conv3D_layer([[[[[0.5997, 0.6826]]], [[[0.3002, 0.7658]]]]], 1, 1, 1,[[[[[0.1683, 0.491], [0.5578, 0.7455]]]]],[0, 0], 8, 1, 1, false, 1, 1, 1, Con98230), 
LRes63198 = reshape_layer(Con98230, [1, 1, 2], Res63198), 
LRes65465 = reshape_layer(Res63198, [1, 2], Res65465), 
LGRU95685 = gru_layer(Res65465,[[4, 10, 1, 7, 4, 6], [2, 4, 9, 3, 4, 9]],[[1, 7, 6, 4, 10, 7], [10, 6, 2, 10, 6, 9]],[3, 4, 2, 10, 3, 1], false, GRU95685), 
LRes12060 = reshape_layer(GRU95685, [2, 1], Res12060), 
LRes81486 = reshape_layer(Res12060, [2, 1, 1], Res81486), 
LCon43827 = conv2D_layer(Res81486, 1, 1,[[[[0.335, 0.4055, 0.7375, 0.1379]]]],[0, 0, 0, 0], 2, 1, false, 1, 1, Con43827), 
LRes38740 = reshape_layer(Con43827, [1, 4], Res38740), 
LZer16422 = zero_padding1D_layer(Res38740, 1, 1, Zer16422), 
LMul14512 = multiply_layer([Con75581,Zer16422], Mul14512), 
exec_layers([LAve13297,LRes19115,LRes88226,LZer61987,LCon75581,LCon98230,LRes63198,LRes65465,LGRU95685,LRes12060,LRes81486,LCon43827,LRes38740,LZer16422,LMul14512],["Ave13297","Res19115","Res88226","Zer61987","Con75581","Con98230","Res63198","Res65465","GRU95685","Res12060","Res81486","Con43827","Res38740","Zer16422","Mul14512"],Mul14512,"Mul14512")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0004002, 0.0003249, 0.0002899, 0.0001457], [0.0000000, 0.0000000, 0.0000000, 0.0000000]]]

Expected (Unparsed): [[[0,0,0.0,0.0],[0.00040023590033770584,0.00032488010403039806,0.0002898683786087308,0.00014570256655757147],[0.0,0.0,0.0,0.0]]]

Actual:   [[[0, 0, 0, 0], [0.0005, 0.0004, 0.0003, 0.0002], [0, 0, 0, 0]]]

Expected: [[[0, 0, 0, 0], [0.0005, 0.0004, 0.0003, 0.0002], [0, 0, 0, 0]]]