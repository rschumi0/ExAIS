import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave22925 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Ave22925 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Dot69041 = tf.keras.layers.Input(shape=([3]))
in1Dot69041 = tf.keras.layers.Input(shape=([3]))

Ave22925 = keras.layers.Average(name = 'Ave22925', )([in0Ave22925,in1Ave22925])
Res85747 = keras.layers.Reshape((1, 1), name = 'Res85747', )(Ave22925)
Fla65779 = keras.layers.Flatten(name = 'Fla65779', )(Res85747)
Dot69041 = keras.layers.Dot(axes=(1, 1), name = 'Dot69041', )([in0Dot69041,in1Dot69041])
Mul82046 = keras.layers.Multiply(name = 'Mul82046', )([Fla65779,Dot69041])
Res59497 = keras.layers.Reshape((1, 1), name = 'Res59497', )(Mul82046)
Res10692 = keras.layers.Reshape((1, 1, 1), name = 'Res10692', )(Res59497)
Loc20168 = keras.layers.LocallyConnected2D(3, (1, 1),strides=(1, 1), name = 'Loc20168', )(Res10692)
model = tf.keras.models.Model(inputs=[in0Ave22925,in1Ave22925,in0Dot69041,in1Dot69041], outputs=Loc20168)
w = model.get_layer('Loc20168').get_weights() 
w[0] = np.array([[[0.718, 0.9565, 0.048]]])
w[1] = np.array([[[0, 0, 0]]])
model.get_layer('Loc20168').set_weights(w) 
in0Ave22925 = tf.constant([[[[0.3717]]]])
in1Ave22925 = tf.constant([[[[0.5705]]]])
in0Dot69041 = tf.constant([[0.9074, 0.0602, 0.647]])
in1Dot69041 = tf.constant([[0.5655, 0.9773, 0.6109]])
print (np.array2string(model.predict([in0Ave22925,in1Ave22925,in0Dot69041,in1Dot69041],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc20168.png')

LAve22925 = average_layer([[[[[0.3717]]]], [[[[0.5705]]]]], Ave22925), 
LRes85747 = reshape_layer(Ave22925, [1, 1], Res85747), 
LFla65779 = flatten_layer(Res85747, Fla65779), 
LDot69041 = dot_layer([[0.9074, 0.0602, 0.647]], [[0.5655, 0.9773, 0.6109]], 1, 1, Dot69041), 
LMul82046 = multiply_layer([Fla65779,Dot69041], Mul82046), 
LRes59497 = reshape_layer(Mul82046, [1, 1], Res59497), 
LRes10692 = reshape_layer(Res59497, [1, 1, 1], Res10692), 
LLoc20168 = locally_connected2D_layer(Res10692, 1, 1,[[[0.718, 0.9565, 0.048]]],[[[0, 0, 0]]], 1, 1, Loc20168), 
exec_layers([LAve22925,LRes85747,LFla65779,LDot69041,LMul82046,LRes59497,LRes10692,LLoc20168],["Ave22925","Res85747","Fla65779","Dot69041","Mul82046","Res59497","Res10692","Loc20168"],Loc20168,"Loc20168")

Actual (Unparsed): [[[[0.3271621, 0.4358365, 0.0218716]]]]

Expected (Unparsed): [[[[0.3271621271509079,0.43583645490228895,0.021871562817887998]]]]

Actual:   [[[[0.3272, 0.4359, 0.0219]]]]

Expected: [[[[0.3272, 0.4359, 0.0219]]]]