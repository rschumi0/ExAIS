import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub56281 = tf.keras.layers.Input(shape=([3, 3, 2, 3]))
in1Sub56281 = tf.keras.layers.Input(shape=([3, 3, 2, 3]))
in0Ave44994 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave44994 = tf.keras.layers.Input(shape=([1, 2]))
in0Con90619 = tf.keras.layers.Input(shape=([4]))

Sub56281 = keras.layers.Subtract(name = 'Sub56281', )([in0Sub56281,in1Sub56281])
Res89487 = keras.layers.Reshape((3, 3, 6), name = 'Res89487', )(Sub56281)
Res82698 = keras.layers.Reshape((3, 18), name = 'Res82698', )(Res89487)
LST90204 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST90204', )(Res82698)
Res54054 = keras.layers.Reshape((3, 1), name = 'Res54054', )(LST90204)
Zer93412 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer93412', )(Res54054)
Fla5593 = keras.layers.Flatten(name = 'Fla5593', )(Zer93412)
Ave44994 = keras.layers.Average(name = 'Ave44994', )([in0Ave44994,in1Ave44994])
Res62724 = keras.layers.Reshape((1, 2, 1), name = 'Res62724', )(Ave44994)
Glo68936 = keras.layers.GlobalMaxPool2D(name = 'Glo68936', )(Res62724)
Res14897 = keras.layers.Reshape((1, 1), name = 'Res14897', )(Glo68936)
Glo20986 = keras.layers.GlobalMaxPool1D(name = 'Glo20986', )(Res14897)
Con90619 = keras.layers.Concatenate(axis=1, name = 'Con90619', )([Glo20986,in0Con90619])
Sub84653 = keras.layers.Subtract(name = 'Sub84653', )([Fla5593,Con90619])
model = tf.keras.models.Model(inputs=[in0Sub56281,in1Sub56281,in0Ave44994,in1Ave44994,in0Con90619], outputs=Sub84653)
w = model.get_layer('LST90204').get_weights() 
w[0] = np.array([[8, 8, 10, 5, 10, 4, 3, 2, 4, 7, 6, 9], [4, 4, 9, 6, 4, 2, 8, 5, 10, 8, 1, 1], [8, 9, 8, 4, 9, 9, 10, 4, 9, 4, 8, 3], [7, 1, 6, 4, 8, 2, 3, 1, 7, 6, 9, 7], [5, 6, 7, 6, 1, 8, 9, 9, 6, 8, 4, 2], [1, 7, 3, 10, 8, 4, 8, 1, 3, 8, 8, 5], [8, 7, 10, 4, 10, 9, 5, 5, 8, 8, 2, 2], [10, 7, 3, 9, 7, 9, 5, 2, 3, 7, 4, 4], [10, 5, 3, 1, 3, 2, 10, 4, 10, 4, 8, 7], [10, 10, 3, 4, 1, 2, 3, 6, 9, 1, 4, 5], [2, 7, 5, 6, 6, 10, 3, 8, 4, 9, 6, 10], [5, 8, 5, 10, 7, 4, 10, 4, 7, 3, 9, 9], [5, 4, 3, 8, 3, 7, 5, 8, 3, 4, 6, 2], [8, 1, 1, 7, 9, 8, 1, 6, 4, 4, 4, 7], [3, 1, 8, 1, 2, 2, 9, 3, 9, 2, 1, 10], [5, 7, 2, 6, 2, 6, 1, 6, 8, 9, 1, 6], [6, 7, 3, 5, 3, 1, 2, 6, 3, 5, 4, 1], [1, 2, 5, 8, 10, 1, 1, 2, 7, 4, 2, 2]])
w[1] = np.array([[8, 5, 9, 8, 7, 8, 1, 10, 10, 7, 4, 10], [6, 1, 7, 8, 1, 2, 7, 2, 4, 8, 5, 5], [8, 1, 7, 2, 2, 7, 6, 8, 6, 9, 10, 3]])
w[2] = np.array([7, 7, 3, 4, 10, 4, 2, 7, 8, 6, 9, 1])
model.get_layer('LST90204').set_weights(w) 
in0Sub56281 = tf.constant([[[[[0.7959, 0.3274, 0.9538], [0.563, 0.4196, 0.5474]], [[0.8873, 0.5082, 0.8484], [0.2867, 0.2834, 0.6942]], [[0.6002, 0.4504, 0.0636], [0.3919, 0.686, 0.8051]]], [[[0.3644, 0.4247, 0.2046], [0.2436, 0.0626, 0.2109]], [[0.6433, 0.8211, 0.1463], [0.7087, 0.7563, 0.6158]], [[0.8995, 0.462, 0.4664], [0.9503, 0.3299, 0.9459]]], [[[0.8388, 0.2806, 0.2628], [0.1908, 0.805, 0.1026]], [[0.0487, 0.2315, 0.9862], [0.5593, 0.8869, 0.2694]], [[0.6575, 0.0395, 0.3557], [0.5616, 0.6216, 0.952]]]]])
in1Sub56281 = tf.constant([[[[[0.857, 0.961, 0.5235], [0.0309, 0.3321, 0.7172]], [[0.9229, 0.9827, 0.7879], [0.6174, 0.2655, 0.0212]], [[0.8831, 0.8007, 0.7456], [0.852, 0.067, 0.6081]]], [[[0.9362, 0.9663, 0.5394], [0.6452, 0.9794, 0.6849]], [[0.6046, 0.8297, 0.0731], [0.2499, 0.8288, 0.5716]], [[0.9703, 0.4067, 0.7814], [0.3905, 0.216, 0.3404]]], [[[0.0351, 0.2141, 0.884], [0.5334, 0.5358, 0.3206]], [[0.6507, 0.0989, 0.4109], [0.3889, 0.1429, 0.4109]], [[0.7808, 0.4039, 0.6322], [0.3963, 0.1604, 0.2263]]]]])
in0Ave44994 = tf.constant([[[0.3122, 0.6894]]])
in1Ave44994 = tf.constant([[[0.5945, 0.4801]]])
in0Con90619 = tf.constant([[0.8658, 0.4451, 0.3972, 0.3398]])
print (np.array2string(model.predict([in0Sub56281,in1Sub56281,in0Ave44994,in1Ave44994,in0Con90619],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub84653.png')

LSub56281 = subtract_layer([[[[[0.7959, 0.3274, 0.9538], [0.563, 0.4196, 0.5474]], [[0.8873, 0.5082, 0.8484], [0.2867, 0.2834, 0.6942]], [[0.6002, 0.4504, 0.0636], [0.3919, 0.686, 0.8051]]], [[[0.3644, 0.4247, 0.2046], [0.2436, 0.0626, 0.2109]], [[0.6433, 0.8211, 0.1463], [0.7087, 0.7563, 0.6158]], [[0.8995, 0.462, 0.4664], [0.9503, 0.3299, 0.9459]]], [[[0.8388, 0.2806, 0.2628], [0.1908, 0.805, 0.1026]], [[0.0487, 0.2315, 0.9862], [0.5593, 0.8869, 0.2694]], [[0.6575, 0.0395, 0.3557], [0.5616, 0.6216, 0.952]]]]], [[[[[0.857, 0.961, 0.5235], [0.0309, 0.3321, 0.7172]], [[0.9229, 0.9827, 0.7879], [0.6174, 0.2655, 0.0212]], [[0.8831, 0.8007, 0.7456], [0.852, 0.067, 0.6081]]], [[[0.9362, 0.9663, 0.5394], [0.6452, 0.9794, 0.6849]], [[0.6046, 0.8297, 0.0731], [0.2499, 0.8288, 0.5716]], [[0.9703, 0.4067, 0.7814], [0.3905, 0.216, 0.3404]]], [[[0.0351, 0.2141, 0.884], [0.5334, 0.5358, 0.3206]], [[0.6507, 0.0989, 0.4109], [0.3889, 0.1429, 0.4109]], [[0.7808, 0.4039, 0.6322], [0.3963, 0.1604, 0.2263]]]]], Sub56281), 
LRes89487 = reshape_layer(Sub56281, [3, 3, 6], Res89487), 
LRes82698 = reshape_layer(Res89487, [3, 18], Res82698), 
LLST90204 = lstm_layer(Res82698,[[8, 8, 10, 5, 10, 4, 3, 2, 4, 7, 6, 9], [4, 4, 9, 6, 4, 2, 8, 5, 10, 8, 1, 1], [8, 9, 8, 4, 9, 9, 10, 4, 9, 4, 8, 3], [7, 1, 6, 4, 8, 2, 3, 1, 7, 6, 9, 7], [5, 6, 7, 6, 1, 8, 9, 9, 6, 8, 4, 2], [1, 7, 3, 10, 8, 4, 8, 1, 3, 8, 8, 5], [8, 7, 10, 4, 10, 9, 5, 5, 8, 8, 2, 2], [10, 7, 3, 9, 7, 9, 5, 2, 3, 7, 4, 4], [10, 5, 3, 1, 3, 2, 10, 4, 10, 4, 8, 7], [10, 10, 3, 4, 1, 2, 3, 6, 9, 1, 4, 5], [2, 7, 5, 6, 6, 10, 3, 8, 4, 9, 6, 10], [5, 8, 5, 10, 7, 4, 10, 4, 7, 3, 9, 9], [5, 4, 3, 8, 3, 7, 5, 8, 3, 4, 6, 2], [8, 1, 1, 7, 9, 8, 1, 6, 4, 4, 4, 7], [3, 1, 8, 1, 2, 2, 9, 3, 9, 2, 1, 10], [5, 7, 2, 6, 2, 6, 1, 6, 8, 9, 1, 6], [6, 7, 3, 5, 3, 1, 2, 6, 3, 5, 4, 1], [1, 2, 5, 8, 10, 1, 1, 2, 7, 4, 2, 2]],[[8, 5, 9, 8, 7, 8, 1, 10, 10, 7, 4, 10], [6, 1, 7, 8, 1, 2, 7, 2, 4, 8, 5, 5], [8, 1, 7, 2, 2, 7, 6, 8, 6, 9, 10, 3]],[7, 7, 3, 4, 10, 4, 2, 7, 8, 6, 9, 1], LST90204), 
LRes54054 = reshape_layer(LST90204, [3, 1], Res54054), 
LZer93412 = zero_padding1D_layer(Res54054, 1, 1, Zer93412), 
LFla5593 = flatten_layer(Zer93412, Fla5593), 
LAve44994 = average_layer([[[[0.3122, 0.6894]]], [[[0.5945, 0.4801]]]], Ave44994), 
LRes62724 = reshape_layer(Ave44994, [1, 2, 1], Res62724), 
LGlo68936 = global_max_pool2D_layer(Res62724, Glo68936), 
LRes14897 = reshape_layer(Glo68936, [1, 1], Res14897), 
LGlo20986 = global_max_pool1D_layer(Res14897, Glo20986), 
LCon90619 = concatenate_layer([Glo20986,[[0.8658, 0.4451, 0.3972, 0.3398]]], 1, Con90619), 
LSub84653 = subtract_layer(Fla5593,Con90619, Sub84653), 
exec_layers([LSub56281,LRes89487,LRes82698,LLST90204,LRes54054,LZer93412,LFla5593,LAve44994,LRes62724,LGlo68936,LRes14897,LGlo20986,LCon90619,LSub84653],["Sub56281","Res89487","Res82698","LST90204","Res54054","Zer93412","Fla5593","Ave44994","Res62724","Glo68936","Res14897","Glo20986","Con90619","Sub84653"],Sub84653,"Sub84653")

Actual (Unparsed): [[-0.5847500, -1.0010310, 0.3579760, 0.3642656, -0.3398000]]

Expected (Unparsed): [[-0.58475,-1.0010311585037903,0.35797601224211256,0.3642655907209661,-0.3398]]

Actual:   [[-0.5847, -1.001, 0.358, 0.3643, -0.3398]]

Expected: [[-0.5847, -1.001, 0.358, 0.3643, -0.3398]]