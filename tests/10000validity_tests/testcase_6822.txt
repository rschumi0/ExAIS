import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul2528 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Mul2528 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Dot63914 = tf.keras.layers.Input(shape=([3]))
in1Dot63914 = tf.keras.layers.Input(shape=([3]))

Mul2528 = keras.layers.Multiply(name = 'Mul2528', )([in0Mul2528,in1Mul2528])
Res5896 = keras.layers.Reshape((2, 1, 2), name = 'Res5896', )(Mul2528)
Res93769 = keras.layers.Reshape((2, 2), name = 'Res93769', )(Res5896)
Per90832 = keras.layers.Permute((2,1), name = 'Per90832',)(Res93769)
Res85429 = keras.layers.Reshape((2, 2, 1), name = 'Res85429', )(Per90832)
Res69786 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res69786', )(Res85429)
Glo98206 = keras.layers.GlobalAveragePooling3D(name = 'Glo98206', )(Res69786)
Res72899 = keras.layers.Reshape((1, 1), name = 'Res72899', )(Glo98206)
Dot63914 = keras.layers.Dot(axes=(1, 1), name = 'Dot63914', )([in0Dot63914,in1Dot63914])
Res77057 = keras.layers.Reshape((1, 1), name = 'Res77057', )(Dot63914)
Res58441 = keras.layers.Reshape((1, 1, 1), name = 'Res58441', )(Res77057)
Res20011 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res20011', )(Res58441)
Up_84687 = keras.layers.UpSampling3D(size=(1, 1, 1), name = 'Up_84687', )(Res20011)
Res29927 = keras.layers.Reshape((1, 1), name = 'Res29927', )(Up_84687)
Sub33078 = keras.layers.Subtract(name = 'Sub33078', )([Res72899,Res29927])
model = tf.keras.models.Model(inputs=[in0Mul2528,in1Mul2528,in0Dot63914,in1Dot63914], outputs=Sub33078)
in0Mul2528 = tf.constant([[[[[0.387, 0.6582]]], [[[0.7176, 0.915]]]]])
in1Mul2528 = tf.constant([[[[[0.6379, 0.6253]]], [[[0.2107, 0.0227]]]]])
in0Dot63914 = tf.constant([[0.3001, 0.9903, 0.238]])
in1Dot63914 = tf.constant([[0.0409, 0.3379, 0.7737]])
print (np.array2string(model.predict([in0Mul2528,in1Mul2528,in0Dot63914,in1Dot63914],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub33078.png')

LMul2528 = multiply_layer([[[[[[0.387, 0.6582]]], [[[0.7176, 0.915]]]]], [[[[[0.6379, 0.6253]]], [[[0.2107, 0.0227]]]]]], Mul2528), 
LRes5896 = reshape_layer(Mul2528, [2, 1, 2], Res5896), 
LRes93769 = reshape_layer(Res5896, [2, 2], Res93769), 
LPer90832 = permute_layer(Res93769, 2,1, Per90832), 
LRes85429 = reshape_layer(Per90832, [2, 2, 1], Res85429), 
LRes69786 = reshape_layer(Res85429, [2, 2, 1, 1], Res69786), 
LGlo98206 = global_average_pooling3D_layer(Res69786, Glo98206), 
LRes72899 = reshape_layer(Glo98206, [1, 1], Res72899), 
LDot63914 = dot_layer([[0.3001, 0.9903, 0.238]], [[0.0409, 0.3379, 0.7737]], 1, 1, Dot63914), 
LRes77057 = reshape_layer(Dot63914, [1, 1], Res77057), 
LRes58441 = reshape_layer(Res77057, [1, 1, 1], Res58441), 
LRes20011 = reshape_layer(Res58441, [1, 1, 1, 1], Res20011), 
LUp_84687 = up_sampling3D_layer(Res20011, 1, 1, 1, Up_84687), 
LRes29927 = reshape_layer(Up_84687, [1, 1], Res29927), 
LSub33078 = subtract_layer(Res72899,Res29927, Sub33078), 
exec_layers([LMul2528,LRes5896,LRes93769,LPer90832,LRes85429,LRes69786,LGlo98206,LRes72899,LDot63914,LRes77057,LRes58441,LRes20011,LUp_84687,LRes29927,LSub33078],["Mul2528","Res5896","Res93769","Per90832","Res85429","Res69786","Glo98206","Res72899","Dot63914","Res77057","Res58441","Res20011","Up_84687","Res29927","Sub33078"],Sub33078,"Sub33078")

Actual (Unparsed): [[[-0.3234349]]]

Expected (Unparsed): [[[-0.32343491499999993]]]

Actual:   [[[-0.3234]]]

Expected: [[[-0.3234]]]