import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST99768 = tf.keras.layers.Input(shape=([2, 2]))
in0Fla64136 = tf.keras.layers.Input(shape=([1, 1]))
in0Con95729 = tf.keras.layers.Input(shape=([1]))
in0Dot94563 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot94563 = tf.keras.layers.Input(shape=([2, 2]))
in0Dot88976 = tf.keras.layers.Input(shape=([2]))
in1Dot88976 = tf.keras.layers.Input(shape=([2]))
in0Con26349 = tf.keras.layers.Input(shape=([3]))
in0Con41202 = tf.keras.layers.Input(shape=([4]))

LST99768 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST99768', )(in0LST99768)
Fla64136 = keras.layers.Flatten(name = 'Fla64136', )(in0Fla64136)
Con95729 = keras.layers.Concatenate(axis=1, name = 'Con95729', )([Fla64136,in0Con95729])
Add4205 = keras.layers.Add(name = 'Add4205', )([LST99768,Con95729])
Res96904 = keras.layers.Reshape((2, 1), name = 'Res96904', )(Add4205)
Res3056 = keras.layers.Reshape((2, 1, 1), name = 'Res3056', )(Res96904)
Res81741 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res81741', )(Res3056)
Con52744 = keras.layers.Conv3D(4, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con52744', )(Res81741)
Res6365 = keras.layers.Reshape((2, 1, 4), name = 'Res6365', )(Con52744)
Res79711 = keras.layers.Reshape((2, 4), name = 'Res79711', )(Res6365)
Fla63511 = keras.layers.Flatten(name = 'Fla63511', )(Res79711)
Dot94563 = keras.layers.Dot(axes=(2, 2), name = 'Dot94563', )([in0Dot94563,in1Dot94563])
Fla7445 = keras.layers.Flatten(name = 'Fla7445', )(Dot94563)
Dot88976 = keras.layers.Dot(axes=(1, 1), name = 'Dot88976', )([in0Dot88976,in1Dot88976])
Con26349 = keras.layers.Concatenate(axis=1, name = 'Con26349', )([Dot88976,in0Con26349])
Sub54643 = keras.layers.Subtract(name = 'Sub54643', )([Fla7445,Con26349])
Con41202 = keras.layers.Concatenate(axis=1, name = 'Con41202', )([Sub54643,in0Con41202])
Sub58036 = keras.layers.Subtract(name = 'Sub58036', )([Fla63511,Con41202])
model = tf.keras.models.Model(inputs=[in0LST99768,in0Fla64136,in0Con95729,in0Dot94563,in1Dot94563,in0Dot88976,in1Dot88976,in0Con26349,in0Con41202], outputs=Sub58036)
w = model.get_layer('LST99768').get_weights() 
w[0] = np.array([[1, 4, 9, 4, 5, 4, 4, 5], [1, 5, 1, 5, 2, 4, 2, 2]])
w[1] = np.array([[3, 2, 8, 9, 3, 6, 7, 4], [1, 2, 5, 7, 2, 4, 9, 4]])
w[2] = np.array([2, 2, 4, 9, 2, 4, 10, 4])
model.get_layer('LST99768').set_weights(w) 
w = model.get_layer('Con52744').get_weights() 
w[0] = np.array([[[[[0.103, 0.3802, 0.0521, 0.9986]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con52744').set_weights(w) 
in0LST99768 = tf.constant([[[9, 8], [1, 3]]])
in0Fla64136 = tf.constant([[[1.1263]]])
in0Con95729 = tf.constant([[0.4117]])
in0Dot94563 = tf.constant([[[0.4694, 0.5678], [0.2062, 0.2599]]])
in1Dot94563 = tf.constant([[[0.2321, 0.0572], [0.7859, 0.139]]])
in0Dot88976 = tf.constant([[0.6078, 0.1973]])
in1Dot88976 = tf.constant([[0.4116, 0.4199]])
in0Con26349 = tf.constant([[0.8417, 0.696, 0.019]])
in0Con41202 = tf.constant([[0.6192, 0.9402, 0.1671, 0.676]])
print (np.array2string(model.predict([in0LST99768,in0Fla64136,in0Con95729,in0Dot94563,in1Dot94563,in0Dot88976,in1Dot88976,in0Con26349,in0Con41202],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub58036.png')

LLST99768 = lstm_layer([[[9, 8], [1, 3]]],[[1, 4, 9, 4, 5, 4, 4, 5], [1, 5, 1, 5, 2, 4, 2, 2]],[[3, 2, 8, 9, 3, 6, 7, 4], [1, 2, 5, 7, 2, 4, 9, 4]],[2, 2, 4, 9, 2, 4, 10, 4], LST99768), 
LFla64136 = flatten_layer([[[1.1263]]], Fla64136), 
LCon95729 = concatenate_layer([Fla64136,[[0.4117]]], 1, Con95729), 
LAdd4205 = add_layer([LST99768,Con95729], Add4205), 
LRes96904 = reshape_layer(Add4205, [2, 1], Res96904), 
LRes3056 = reshape_layer(Res96904, [2, 1, 1], Res3056), 
LRes81741 = reshape_layer(Res3056, [2, 1, 1, 1], Res81741), 
LCon52744 = conv3D_layer(Res81741, 1, 1, 1,[[[[[0.103, 0.3802, 0.0521, 0.9986]]]]],[0, 0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con52744), 
LRes6365 = reshape_layer(Con52744, [2, 1, 4], Res6365), 
LRes79711 = reshape_layer(Res6365, [2, 4], Res79711), 
LFla63511 = flatten_layer(Res79711, Fla63511), 
LDot94563 = dot_layer([[[0.4694, 0.5678], [0.2062, 0.2599]]], [[[0.2321, 0.0572], [0.7859, 0.139]]], 2, 2, Dot94563), 
LFla7445 = flatten_layer(Dot94563, Fla7445), 
LDot88976 = dot_layer([[0.6078, 0.1973]], [[0.4116, 0.4199]], 1, 1, Dot88976), 
LCon26349 = concatenate_layer([Dot88976,[[0.8417, 0.696, 0.019]]], 1, Con26349), 
LSub54643 = subtract_layer(Fla7445,Con26349, Sub54643), 
LCon41202 = concatenate_layer([Sub54643,[[0.6192, 0.9402, 0.1671, 0.676]]], 1, Con41202), 
LSub58036 = subtract_layer(Fla63511,Con41202, Sub58036), 
exec_layers([LLST99768,LFla64136,LCon95729,LAdd4205,LRes96904,LRes3056,LRes81741,LCon52744,LRes6365,LRes79711,LFla63511,LDot94563,LFla7445,LDot88976,LCon26349,LSub54643,LCon41202,LSub58036],["LST99768","Fla64136","Con95729","Add4205","Res96904","Res3056","Res81741","Con52744","Res6365","Res79711","Fla63511","Dot94563","Fla7445","Dot88976","Con26349","Sub54643","Con41202","Sub58036"],Sub58036,"Sub58036")

Actual (Unparsed): [[0.4068937, 1.1886137, 0.7421803, 1.9082141, -0.4775000, -0.4171483, -0.0954246, 0.6978016]]

Expected (Unparsed): [[0.40689373335102286,1.1886137210685328,0.7421803332290124,1.908214128877004,-0.47750005932107464,-0.4171483743094426,-0.0954245931128931,0.6978015607958724]]

Actual:   [[0.4069, 1.1887, 0.7422, 1.9083, -0.4775, -0.4171, -0.0954, 0.6979]]

Expected: [[0.4069, 1.1887, 0.7422, 1.9083, -0.4775, -0.4171, -0.0954, 0.6979]]