import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo66782 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Ave26962 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave26962 = tf.keras.layers.Input(shape=([2, 1]))
in0Con6963 = tf.keras.layers.Input(shape=([2, 1]))
in0Add45923 = tf.keras.layers.Input(shape=([1, 2]))
in1Add45923 = tf.keras.layers.Input(shape=([1, 2]))
in0Con98167 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con43405 = tf.keras.layers.Input(shape=([3]))

Glo66782 = keras.layers.GlobalAveragePooling3D(name = 'Glo66782', )(in0Glo66782)
Res33578 = keras.layers.Reshape((2, 1), name = 'Res33578', )(Glo66782)
Ave26962 = keras.layers.Average(name = 'Ave26962', )([in0Ave26962,in1Ave26962])
Ave13781 = keras.layers.Average(name = 'Ave13781', )([Res33578,Ave26962])
Con6963 = keras.layers.Concatenate(axis=2, name = 'Con6963', )([Ave13781,in0Con6963])
Add45923 = keras.layers.Add(name = 'Add45923', )([in0Add45923,in1Add45923])
Zer96124 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer96124', )(Add45923)
Max42603 = keras.layers.Maximum(name = 'Max42603', )([Con6963,Zer96124])
Fla72719 = keras.layers.Flatten(name = 'Fla72719', )(Max42603)
Con98167 = keras.layers.Conv2D(2, (2, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con98167', )(in0Con98167)
Res67544 = keras.layers.Reshape((2, 2), name = 'Res67544', )(Con98167)
Cro23338 = keras.layers.Cropping1D(cropping=((0, 1)), name = 'Cro23338', )(Res67544)
Res27904 = keras.layers.Reshape((1, 2, 1), name = 'Res27904', )(Cro23338)
Res56763 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res56763', )(Res27904)
Glo37952 = keras.layers.GlobalAveragePooling3D(name = 'Glo37952', )(Res56763)
Con43405 = keras.layers.Concatenate(axis=1, name = 'Con43405', )([Glo37952,in0Con43405])
Mul16931 = keras.layers.Multiply(name = 'Mul16931', )([Fla72719,Con43405])
model = tf.keras.models.Model(inputs=[in0Glo66782,in0Ave26962,in1Ave26962,in0Con6963,in0Add45923,in1Add45923,in0Con98167,in0Con43405], outputs=Mul16931)
w = model.get_layer('Con98167').get_weights() 
w[0] = np.array([[[[0.7362, 0.1355]]], [[[0.3495, 0.0922]]]])
w[1] = np.array([0, 0])
model.get_layer('Con98167').set_weights(w) 
in0Glo66782 = tf.constant([[[[[1.9364, 1.8203]], [[1.0421, 1.829]]], [[[1.4518, 1.181]], [[1.1654, 1.9694]]]]])
in0Ave26962 = tf.constant([[[0.6173], [0.7616]]])
in1Ave26962 = tf.constant([[[0.3097], [0.0177]]])
in0Con6963 = tf.constant([[[0.2405], [0.0396]]])
in0Add45923 = tf.constant([[[0.8155, 0.4145]]])
in1Add45923 = tf.constant([[[0.4392, 0.6658]]])
in0Con98167 = tf.constant([[[[0.4048]], [[0.2314]]]])
in0Con43405 = tf.constant([[0.0018, 0.4516, 0.956]])
print (np.array2string(model.predict([in0Glo66782,in0Ave26962,in1Ave26962,in0Con6963,in0Add45923,in1Add45923,in0Con98167,in0Con43405],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul16931.png')

LGlo66782 = global_average_pooling3D_layer([[[[[1.9364, 1.8203]], [[1.0421, 1.829]]], [[[1.4518, 1.181]], [[1.1654, 1.9694]]]]], Glo66782), 
LRes33578 = reshape_layer(Glo66782, [2, 1], Res33578), 
LAve26962 = average_layer([[[[0.6173], [0.7616]]], [[[0.3097], [0.0177]]]], Ave26962), 
LAve13781 = average_layer([Res33578,Ave26962], Ave13781), 
LCon6963 = concatenate_layer([Ave13781,[[[0.2405], [0.0396]]]], 2, Con6963), 
LAdd45923 = add_layer([[[[0.8155, 0.4145]]], [[[0.4392, 0.6658]]]], Add45923), 
LZer96124 = zero_padding1D_layer(Add45923, 1, 0, Zer96124), 
LMax42603 = maximum_layer([Con6963,Zer96124], Max42603), 
LFla72719 = flatten_layer(Max42603, Fla72719), 
LCon98167 = conv2D_layer([[[[0.4048]], [[0.2314]]]], 2, 1,[[[[0.7362, 0.1355]]], [[[0.3495, 0.0922]]]],[0, 0], 1, 1, true, 1, 1, Con98167), 
LRes67544 = reshape_layer(Con98167, [2, 2], Res67544), 
LCro23338 = cropping1D_layer(Res67544, 0, 1, Cro23338), 
LRes27904 = reshape_layer(Cro23338, [1, 2, 1], Res27904), 
LRes56763 = reshape_layer(Res27904, [1, 2, 1, 1], Res56763), 
LGlo37952 = global_average_pooling3D_layer(Res56763, Glo37952), 
LCon43405 = concatenate_layer([Glo37952,[[0.0018, 0.4516, 0.956]]], 1, Con43405), 
LMul16931 = multiply_layer([Fla72719,Con43405], Mul16931), 
exec_layers([LGlo66782,LRes33578,LAve26962,LAve13781,LCon6963,LAdd45923,LZer96124,LMax42603,LFla72719,LCon98167,LRes67544,LCro23338,LRes27904,LRes56763,LGlo37952,LCon43405,LMul16931],["Glo66782","Res33578","Ave26962","Ave13781","Con6963","Add45923","Zer96124","Max42603","Fla72719","Con98167","Res67544","Cro23338","Res27904","Res56763","Glo37952","Con43405","Mul16931"],Mul16931,"Mul16931")

Actual (Unparsed): [[0.2118851, 0.0004329, 0.5666225, 1.0327667]]

Expected (Unparsed): [[0.211885084433625,0.00043289999999999995,0.56662252,1.0327667999999999]]

Actual:   [[0.2119, 0.0005, 0.5667, 1.0328]]

Expected: [[0.2119, 0.0005, 0.5667, 1.0328]]