import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul81187 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Mul81187 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in0Glo31508 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Con70701 = tf.keras.layers.Input(shape=([1, 3]))
in0Dot17336 = tf.keras.layers.Input(shape=([3]))
in1Dot17336 = tf.keras.layers.Input(shape=([3]))
in0Con3643 = tf.keras.layers.Input(shape=([2]))
in0Cro62025 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Dot49865 = tf.keras.layers.Input(shape=([3]))
in1Dot49865 = tf.keras.layers.Input(shape=([3]))
in0Con53341 = tf.keras.layers.Input(shape=([3]))

Mul81187 = keras.layers.Multiply(name = 'Mul81187', )([in0Mul81187,in1Mul81187])
Res52488 = keras.layers.Reshape((1, 1, 4), name = 'Res52488', )(Mul81187)
PRe7780 = keras.layers.PReLU(name = 'PRe7780', )(Res52488)
Res83068 = keras.layers.Reshape((1, 4), name = 'Res83068', )(PRe7780)
Glo31508 = keras.layers.GlobalMaxPool3D(name = 'Glo31508', )(in0Glo31508)
Res69723 = keras.layers.Reshape((2, 1), name = 'Res69723', )(Glo31508)
Glo15187 = keras.layers.GlobalMaxPool1D(name = 'Glo15187', )(Res69723)
Res89679 = keras.layers.Reshape((1, 1), name = 'Res89679', )(Glo15187)
Up_33040 = keras.layers.UpSampling1D(size=(1), name = 'Up_33040', )(Res89679)
Con70701 = keras.layers.Concatenate(axis=2, name = 'Con70701', )([Up_33040,in0Con70701])
Add80939 = keras.layers.Add(name = 'Add80939', )([Res83068,Con70701])
Fla51021 = keras.layers.Flatten(name = 'Fla51021', )(Add80939)
Dot17336 = keras.layers.Dot(axes=(1, 1), name = 'Dot17336', )([in0Dot17336,in1Dot17336])
Res41753 = keras.layers.Reshape((1, 1), name = 'Res41753', )(Dot17336)
Res87517 = keras.layers.Reshape((1, 1, 1), name = 'Res87517', )(Res41753)
Up_24871 = keras.layers.UpSampling2D(size=(2, 1), name = 'Up_24871', )(Res87517)
Res19219 = keras.layers.Reshape((2, 1), name = 'Res19219', )(Up_24871)
Fla81531 = keras.layers.Flatten(name = 'Fla81531', )(Res19219)
Con3643 = keras.layers.Concatenate(axis=1, name = 'Con3643', )([Fla81531,in0Con3643])
Cro62025 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro62025', )(in0Cro62025)
Con75703 = keras.layers.Conv2D(4, (1, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con75703', )(Cro62025)
Res40273 = keras.layers.Reshape((1, 4), name = 'Res40273', )(Con75703)
Max49222 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max49222', )(Res40273)
Fla32679 = keras.layers.Flatten(name = 'Fla32679', )(Max49222)
Dot49865 = keras.layers.Dot(axes=(1, 1), name = 'Dot49865', )([in0Dot49865,in1Dot49865])
Con53341 = keras.layers.Concatenate(axis=1, name = 'Con53341', )([Dot49865,in0Con53341])
Ave32183 = keras.layers.Average(name = 'Ave32183', )([Fla32679,Con53341])
Min96207 = keras.layers.Minimum(name = 'Min96207', )([Con3643,Ave32183])
Ave50350 = keras.layers.Average(name = 'Ave50350', )([Fla51021,Min96207])
model = tf.keras.models.Model(inputs=[in0Mul81187,in1Mul81187,in0Glo31508,in0Con70701,in0Dot17336,in1Dot17336,in0Con3643,in0Cro62025,in0Dot49865,in1Dot49865,in0Con53341], outputs=Ave50350)
w = model.get_layer('PRe7780').get_weights() 
w[0] = np.array([[[0.3394, 0.5811, 0.081, 0.4088]]])
model.get_layer('PRe7780').set_weights(w) 
w = model.get_layer('Con75703').get_weights() 
w[0] = np.array([[[[0.227, 0.4843, 0.1548, 0.4709]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con75703').set_weights(w) 
in0Mul81187 = tf.constant([[[[[0.9745, 0.7619], [0.5085, 0.6]]]]])
in1Mul81187 = tf.constant([[[[[0.8142, 0.2035], [0.2139, 0.5129]]]]])
in0Glo31508 = tf.constant([[[[[1.4284, 1.5912], [1.8041, 1.0654]], [[1.2637, 1.0467], [1.0782, 1.6417]]]]])
in0Con70701 = tf.constant([[[0.565, 0.9678, 0.6354]]])
in0Dot17336 = tf.constant([[0.8702, 0.5404, 0.2217]])
in1Dot17336 = tf.constant([[0.764, 0.2314, 0.764]])
in0Con3643 = tf.constant([[0.0808, 0.9134]])
in0Cro62025 = tf.constant([[[[1.8732]]]])
in0Dot49865 = tf.constant([[0.303, 0.0648, 0.0991]])
in1Dot49865 = tf.constant([[0.6421, 0.1115, 0.6288]])
in0Con53341 = tf.constant([[0.4054, 0.5618, 0.6111]])
print (np.array2string(model.predict([in0Mul81187,in1Mul81187,in0Glo31508,in0Con70701,in0Dot17336,in1Dot17336,in0Con3643,in0Cro62025,in0Dot49865,in1Dot49865,in0Con53341],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave50350.png')

LMul81187 = multiply_layer([[[[[[0.9745, 0.7619], [0.5085, 0.6]]]]], [[[[[0.8142, 0.2035], [0.2139, 0.5129]]]]]], Mul81187), 
LRes52488 = reshape_layer(Mul81187, [1, 1, 4], Res52488), 
LPRe7780 = prelu_layer(Res52488, [[[0.3394, 0.5811, 0.081, 0.4088]]], PRe7780), 
LRes83068 = reshape_layer(PRe7780, [1, 4], Res83068), 
LGlo31508 = global_max_pool3D_layer([[[[[1.4284, 1.5912], [1.8041, 1.0654]], [[1.2637, 1.0467], [1.0782, 1.6417]]]]], Glo31508), 
LRes69723 = reshape_layer(Glo31508, [2, 1], Res69723), 
LGlo15187 = global_max_pool1D_layer(Res69723, Glo15187), 
LRes89679 = reshape_layer(Glo15187, [1, 1], Res89679), 
LUp_33040 = up_sampling1D_layer(Res89679, 1, Up_33040), 
LCon70701 = concatenate_layer([Up_33040,[[[0.565, 0.9678, 0.6354]]]], 2, Con70701), 
LAdd80939 = add_layer([Res83068,Con70701], Add80939), 
LFla51021 = flatten_layer(Add80939, Fla51021), 
LDot17336 = dot_layer([[0.8702, 0.5404, 0.2217]], [[0.764, 0.2314, 0.764]], 1, 1, Dot17336), 
LRes41753 = reshape_layer(Dot17336, [1, 1], Res41753), 
LRes87517 = reshape_layer(Res41753, [1, 1, 1], Res87517), 
LUp_24871 = up_sampling2D_layer(Res87517, 2, 1, Up_24871), 
LRes19219 = reshape_layer(Up_24871, [2, 1], Res19219), 
LFla81531 = flatten_layer(Res19219, Fla81531), 
LCon3643 = concatenate_layer([Fla81531,[[0.0808, 0.9134]]], 1, Con3643), 
LCro62025 = cropping2D_layer([[[[1.8732]]]], 0, 0, 0, 0, Cro62025), 
LCon75703 = conv2D_layer(Cro62025, 1, 1,[[[[0.227, 0.4843, 0.1548, 0.4709]]]],[0, 0, 0, 0], 1, 1, true, 1, 1, Con75703), 
LRes40273 = reshape_layer(Con75703, [1, 4], Res40273), 
LMax49222 = max_pool1D_layer(Res40273, 1, Max49222), 
LFla32679 = flatten_layer(Max49222, Fla32679), 
LDot49865 = dot_layer([[0.303, 0.0648, 0.0991]], [[0.6421, 0.1115, 0.6288]], 1, 1, Dot49865), 
LCon53341 = concatenate_layer([Dot49865,[[0.4054, 0.5618, 0.6111]]], 1, Con53341), 
LAve32183 = average_layer([Fla32679,Con53341], Ave32183), 
LMin96207 = minimum_layer([Con3643,Ave32183], Min96207), 
LAve50350 = average_layer([Fla51021,Min96207], Ave50350), 
exec_layers([LMul81187,LRes52488,LPRe7780,LRes83068,LGlo31508,LRes69723,LGlo15187,LRes89679,LUp_33040,LCon70701,LAdd80939,LFla51021,LDot17336,LRes41753,LRes87517,LUp_24871,LRes19219,LFla81531,LCon3643,LCro62025,LCon75703,LRes40273,LMax49222,LFla32679,LDot49865,LCon53341,LAve32183,LMin96207,LAve50350],["Mul81187","Res52488","PRe7780","Res83068","Glo31508","Res69723","Glo15187","Res89679","Up_33040","Con70701","Add80939","Fla51021","Dot17336","Res41753","Res87517","Up_24871","Res19219","Fla81531","Con3643","Cro62025","Con75703","Res40273","Max49222","Fla32679","Dot49865","Con53341","Ave32183","Min96207","Ave50350"],Ave50350,"Ave50350")

Actual (Unparsed): [[1.4710970, 0.6881710, 0.5786841, 0.8448675]]

Expected (Unparsed): [[1.471096945,0.688171015,0.578684075,0.8448674700000001]]

Actual:   [[1.4711, 0.6882, 0.5787, 0.8449]]

Expected: [[1.4711, 0.6882, 0.5787, 0.8449]]