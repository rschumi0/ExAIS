import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul21868 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Mul21868 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Dot45327 = tf.keras.layers.Input(shape=([3]))
in1Dot45327 = tf.keras.layers.Input(shape=([3]))
in0Ave89108 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Ave89108 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Ave80417 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Ave80417 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in0Con31803 = tf.keras.layers.Input(shape=([1, 2, 3, 3]))
in0Mul36597 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Mul36597 = tf.keras.layers.Input(shape=([1, 1, 1]))

Mul21868 = keras.layers.Multiply(name = 'Mul21868', )([in0Mul21868,in1Mul21868])
Con29792 = keras.layers.Conv3D(4, (2, 1, 2),strides=(7, 6, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con29792', )(Mul21868)
Zer37212 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (1, 0)), name = 'Zer37212', )(Con29792)
Dot45327 = keras.layers.Dot(axes=(1, 1), name = 'Dot45327', )([in0Dot45327,in1Dot45327])
Res33634 = keras.layers.Reshape((1, 1), name = 'Res33634', )(Dot45327)
Res60609 = keras.layers.Reshape((1, 1, 1), name = 'Res60609', )(Res33634)
Res66909 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res66909', )(Res60609)
Zer35167 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (2, 0)), name = 'Zer35167', )(Res66909)
Ave89108 = keras.layers.Average(name = 'Ave89108', )([in0Ave89108,in1Ave89108])
Den58006 = keras.layers.Dense(3,name = 'Den58006', )(Ave89108)
Res75507 = keras.layers.Reshape((1, 2, 3, 1), name = 'Res75507', )(Den58006)
Ave80417 = keras.layers.Average(name = 'Ave80417', )([in0Ave80417,in1Ave80417])
Zer76103 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (2, 0)), name = 'Zer76103', )(Ave80417)
Add24077 = keras.layers.Add(name = 'Add24077', )([Res75507,Zer76103])
Sub66098 = keras.layers.Subtract(name = 'Sub66098', )([Zer35167,Add24077])
Con31803 = keras.layers.Concatenate(axis=4, name = 'Con31803', )([Sub66098,in0Con31803])
Mul78693 = keras.layers.Multiply(name = 'Mul78693', )([Zer37212,Con31803])
Mul36597 = keras.layers.Multiply(name = 'Mul36597', )([in0Mul36597,in1Mul36597])
Res46816 = keras.layers.Reshape((1, 1), name = 'Res46816', )(Mul36597)
Res18238 = keras.layers.Reshape((1, 1, 1), name = 'Res18238', )(Res46816)
Res7549 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res7549', )(Res18238)
Con64943 = keras.layers.Conv3DTranspose(4, (1, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con64943', )(Res7549)
Zer44091 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (2, 0)), name = 'Zer44091', )(Con64943)
Add64277 = keras.layers.Add(name = 'Add64277', )([Mul78693,Zer44091])
model = tf.keras.models.Model(inputs=[in0Mul21868,in1Mul21868,in0Dot45327,in1Dot45327,in0Ave89108,in1Ave89108,in0Ave80417,in1Ave80417,in0Con31803,in0Mul36597,in1Mul36597], outputs=Add64277)
w = model.get_layer('Con29792').get_weights() 
w[0] = np.array([[[[[0.6456, 0.2519, 0.5625, 0.2286]], [[0.8482, 0.9399, 0.1937, 0.767]]]], [[[[0.1972, 0.0773, 0.6329, 0.6511]], [[0.3925, 0.1858, 0.1174, 0.7612]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con29792').set_weights(w) 
w = model.get_layer('Den58006').get_weights() 
w[0] = np.array([[0.6407, 0.5208, 0.2787], [0.352, 0.2152, 0.3549]])
w[1] = np.array([0.658, 0.7046, 0.9541])
model.get_layer('Den58006').set_weights(w) 
w = model.get_layer('Con64943').get_weights() 
w[0] = np.array([[[[[0.7679], [0.5816], [0.3621], [0.81]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con64943').set_weights(w) 
in0Mul21868 = tf.constant([[[[[0.2788], [0.6174]]]]])
in1Mul21868 = tf.constant([[[[[0.7491], [0.2722]]]]])
in0Dot45327 = tf.constant([[0.6869, 0.6497, 0.5739]])
in1Dot45327 = tf.constant([[0.7492, 0.0888, 0.4783]])
in0Ave89108 = tf.constant([[[[0.8474, 0.673], [0.6982, 0.1331]]]])
in1Ave89108 = tf.constant([[[[0.2335, 0.0662], [0.1415, 0.2649]]]])
in0Ave80417 = tf.constant([[[[[0.3204]]]]])
in1Ave80417 = tf.constant([[[[[0.1069]]]]])
in0Con31803 = tf.constant([[[[[0.2992, 0.6129, 0.9813], [0.0596, 0.0226, 0.8497], [0.7903, 0.3653, 0.1587]], [[0.5063, 0.99, 0.3471], [0.1679, 0.7031, 0.794], [0.6643, 0.087, 0.7312]]]]])
in0Mul36597 = tf.constant([[[[0.5731]]]])
in1Mul36597 = tf.constant([[[[0.8883]]]])
print (np.array2string(model.predict([in0Mul21868,in1Mul21868,in0Dot45327,in1Dot45327,in0Ave89108,in1Ave89108,in0Ave80417,in1Ave80417,in0Con31803,in0Mul36597,in1Mul36597],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add64277.png')

LMul21868 = multiply_layer([[[[[[0.2788], [0.6174]]]]], [[[[[0.7491], [0.2722]]]]]], Mul21868), 
LCon29792 = conv3D_layer(Mul21868, 2, 1, 2,[[[[[0.6456, 0.2519, 0.5625, 0.2286]], [[0.8482, 0.9399, 0.1937, 0.767]]]], [[[[0.1972, 0.0773, 0.6329, 0.6511]], [[0.3925, 0.1858, 0.1174, 0.7612]]]]],[0, 0, 0, 0], 7, 6, 1, true, 1, 1, 1, Con29792), 
LZer37212 = zero_padding3D_layer(Con29792, 0, 0, 1, 0, 1, 0, Zer37212), 
LDot45327 = dot_layer([[0.6869, 0.6497, 0.5739]], [[0.7492, 0.0888, 0.4783]], 1, 1, Dot45327), 
LRes33634 = reshape_layer(Dot45327, [1, 1], Res33634), 
LRes60609 = reshape_layer(Res33634, [1, 1, 1], Res60609), 
LRes66909 = reshape_layer(Res60609, [1, 1, 1, 1], Res66909), 
LZer35167 = zero_padding3D_layer(Res66909, 0, 0, 1, 0, 2, 0, Zer35167), 
LAve89108 = average_layer([[[[[0.8474, 0.673], [0.6982, 0.1331]]]], [[[[0.2335, 0.0662], [0.1415, 0.2649]]]]], Ave89108), 
LDen58006 = dense_layer(Ave89108, [[0.6407, 0.5208, 0.2787], [0.352, 0.2152, 0.3549]],[0.658, 0.7046, 0.9541], Den58006), 
LRes75507 = reshape_layer(Den58006, [1, 2, 3, 1], Res75507), 
LAve80417 = average_layer([[[[[[0.3204]]]]], [[[[[0.1069]]]]]], Ave80417), 
LZer76103 = zero_padding3D_layer(Ave80417, 0, 0, 1, 0, 2, 0, Zer76103), 
LAdd24077 = add_layer([Res75507,Zer76103], Add24077), 
LSub66098 = subtract_layer(Zer35167,Add24077, Sub66098), 
LCon31803 = concatenate_layer([Sub66098,[[[[[0.2992, 0.6129, 0.9813], [0.0596, 0.0226, 0.8497], [0.7903, 0.3653, 0.1587]], [[0.5063, 0.99, 0.3471], [0.1679, 0.7031, 0.794], [0.6643, 0.087, 0.7312]]]]]], 4, Con31803), 
LMul78693 = multiply_layer([Zer37212,Con31803], Mul78693), 
LMul36597 = multiply_layer([[[[[0.5731]]]], [[[[0.8883]]]]], Mul36597), 
LRes46816 = reshape_layer(Mul36597, [1, 1], Res46816), 
LRes18238 = reshape_layer(Res46816, [1, 1, 1], Res18238), 
LRes7549 = reshape_layer(Res18238, [1, 1, 1, 1], Res7549), 
LCon64943 = conv3D_transpose_layer(Res7549, 1, 1, 1,[[[[[0.7679], [0.5816], [0.3621], [0.81]]]]],[0, 0, 0, 0], 1, 1, 1, false, Con64943), 
LZer44091 = zero_padding3D_layer(Con64943, 0, 0, 1, 0, 2, 0, Zer44091), 
LAdd64277 = add_layer([Mul78693,Zer44091], Add64277), 
exec_layers([LMul21868,LCon29792,LZer37212,LDot45327,LRes33634,LRes60609,LRes66909,LZer35167,LAve89108,LDen58006,LRes75507,LAve80417,LZer76103,LAdd24077,LSub66098,LCon31803,LMul78693,LMul36597,LRes46816,LRes18238,LRes7549,LCon64943,LZer44091,LAdd64277],["Mul21868","Con29792","Zer37212","Dot45327","Res33634","Res60609","Res66909","Zer35167","Ave89108","Den58006","Res75507","Ave80417","Zer76103","Add24077","Sub66098","Con31803","Mul78693","Mul36597","Res46816","Res18238","Res7549","Con64943","Zer44091","Add64277"],Add64277,"Add64277")

Actual (Unparsed): [[[[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [-0.2679704, 0.0353539, 0.1054862, 0.1402538], [0.3357475, 0.3242057, 0.1925638, 0.4404496]]]]]

Expected (Unparsed): [[[[[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]],[[0.0,0.0,0.0,0.0],[-0.2679703740887749,0.035353893860349594,0.1054861695929016,0.140253800759712],[0.3357475503249411,0.3242057412639276,0.1925638349355,0.44044962839256957]]]]]

Actual:   [[[[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [-0.2679, 0.0354, 0.1055, 0.1403], [0.3358, 0.3243, 0.1926, 0.4405]]]]]

Expected: [[[[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [-0.2679, 0.0354, 0.1055, 0.1403], [0.3358, 0.3243, 0.1926, 0.4405]]]]]