import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave85285 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Ave85285 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))

Ave85285 = keras.layers.Average(name = 'Ave85285', )([in0Ave85285,in1Ave85285])
Res7616 = keras.layers.Reshape((2, 2, 2), name = 'Res7616', )(Ave85285)
Res70830 = keras.layers.Reshape((2, 4), name = 'Res70830', )(Res7616)
GRU14652 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU14652', )(Res70830)
model = tf.keras.models.Model(inputs=[in0Ave85285,in1Ave85285], outputs=GRU14652)
w = model.get_layer('GRU14652').get_weights() 
w[0] = np.array([[9, 4, 3, 5, 4, 5], [6, 7, 4, 4, 4, 9], [9, 2, 7, 1, 5, 10], [5, 8, 10, 9, 8, 9]])
w[1] = np.array([[8, 9, 6, 4, 10, 5], [5, 7, 8, 6, 9, 4]])
w[2] = np.array([4, 3, 8, 4, 4, 6])
model.get_layer('GRU14652').set_weights(w) 
in0Ave85285 = tf.constant([[[[[0.5419], [0.6064]], [[0.3426], [0.3996]]], [[[0.8571], [0.7164]], [[0.1306], [0.4604]]]]])
in1Ave85285 = tf.constant([[[[[0.4935], [0.4097]], [[0.5883], [0.2392]]], [[[0.7872], [0.3777]], [[0.0651], [0.2274]]]]])
print (np.array2string(model.predict([in0Ave85285,in1Ave85285],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU14652.png')

LAve85285 = average_layer([[[[[[0.5419], [0.6064]], [[0.3426], [0.3996]]], [[[0.8571], [0.7164]], [[0.1306], [0.4604]]]]], [[[[[0.4935], [0.4097]], [[0.5883], [0.2392]]], [[[0.7872], [0.3777]], [[0.0651], [0.2274]]]]]], Ave85285), 
LRes7616 = reshape_layer(Ave85285, [2, 2, 2], Res7616), 
LRes70830 = reshape_layer(Res7616, [2, 4], Res70830), 
LGRU14652 = gru_layer(Res70830,[[9, 4, 3, 5, 4, 5], [6, 7, 4, 4, 4, 9], [9, 2, 7, 1, 5, 10], [5, 8, 10, 9, 8, 9]],[[8, 9, 6, 4, 10, 5], [5, 7, 8, 6, 9, 4]],[4, 3, 8, 4, 4, 6], false, GRU14652), 
exec_layers([LAve85285,LRes7616,LRes70830,LGRU14652],["Ave85285","Res7616","Res70830","GRU14652"],GRU14652,"GRU14652")

Actual (Unparsed): [[0.0000001, 0.0000076]]

Expected (Unparsed): [[5.650178834624389e-8,7.604606399363395e-6]]

Actual:   [[0, 0]]

Expected: [[0, 0]]