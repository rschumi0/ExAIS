import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot73637 = tf.keras.layers.Input(shape=([2]))
in1Dot73637 = tf.keras.layers.Input(shape=([2]))
in0Mul69137 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Mul69137 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Dot49157 = tf.keras.layers.Input(shape=([3]))
in1Dot49157 = tf.keras.layers.Input(shape=([3]))
in0Con35186 = tf.keras.layers.Input(shape=([3]))
in0Con48456 = tf.keras.layers.Input(shape=([23]))

Dot73637 = keras.layers.Dot(axes=(1, 1), name = 'Dot73637', )([in0Dot73637,in1Dot73637])
Res53935 = keras.layers.Reshape((1, 1), name = 'Res53935', )(Dot73637)
Up_98308 = keras.layers.UpSampling1D(size=(1), name = 'Up_98308', )(Res53935)
Res2380 = keras.layers.Reshape((1, 1, 1), name = 'Res2380', )(Up_98308)
Res46601 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res46601', )(Res2380)
Zer11194 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer11194', )(Res46601)
Res64551 = keras.layers.Reshape((3, 3, 3), name = 'Res64551', )(Zer11194)
Res6464 = keras.layers.Reshape((3, 9), name = 'Res6464', )(Res64551)
Fla80877 = keras.layers.Flatten(name = 'Fla80877', )(Res6464)
Mul69137 = keras.layers.Multiply(name = 'Mul69137', )([in0Mul69137,in1Mul69137])
Res21229 = keras.layers.Reshape((2, 2), name = 'Res21229', )(Mul69137)
Fla33916 = keras.layers.Flatten(name = 'Fla33916', )(Res21229)
Dot49157 = keras.layers.Dot(axes=(1, 1), name = 'Dot49157', )([in0Dot49157,in1Dot49157])
Mas44289 = keras.layers.Masking(mask_value=1, name = 'Mas44289', )(Dot49157)
Con35186 = keras.layers.Concatenate(axis=1, name = 'Con35186', )([Mas44289,in0Con35186])
Ave54217 = keras.layers.Average(name = 'Ave54217', )([Fla33916,Con35186])
Con48456 = keras.layers.Concatenate(axis=1, name = 'Con48456', )([Ave54217,in0Con48456])
Add3100 = keras.layers.Add(name = 'Add3100', )([Fla80877,Con48456])
model = tf.keras.models.Model(inputs=[in0Dot73637,in1Dot73637,in0Mul69137,in1Mul69137,in0Dot49157,in1Dot49157,in0Con35186,in0Con48456], outputs=Add3100)
in0Dot73637 = tf.constant([[0.3709, 0.2636]])
in1Dot73637 = tf.constant([[0.557, 0.4472]])
in0Mul69137 = tf.constant([[[[0.594], [0.3668]], [[0.2711], [0.9657]]]])
in1Mul69137 = tf.constant([[[[0.421], [0.7411]], [[0.8253], [0.3238]]]])
in0Dot49157 = tf.constant([[0.2596, 0.0285, 0.7079]])
in1Dot49157 = tf.constant([[0.3216, 0.8425, 0.2271]])
in0Con35186 = tf.constant([[0.2375, 0.0773, 0.7238]])
in0Con48456 = tf.constant([[0.8304, 0.0488, 0.8455, 0.6545, 0.1336, 0.0264, 0.3649, 0.0479, 0.985, 0.2572, 0.696, 0.7467, 0.562, 0.0893, 0.3385, 0.7249, 0.7751, 0.6252, 0.1488, 0.8586, 0.3097, 0.1545, 0.6877]])
print (np.array2string(model.predict([in0Dot73637,in1Dot73637,in0Mul69137,in1Mul69137,in0Dot49157,in1Dot49157,in0Con35186,in0Con48456],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add3100.png')

LDot73637 = dot_layer([[0.3709, 0.2636]], [[0.557, 0.4472]], 1, 1, Dot73637), 
LRes53935 = reshape_layer(Dot73637, [1, 1], Res53935), 
LUp_98308 = up_sampling1D_layer(Res53935, 1, Up_98308), 
LRes2380 = reshape_layer(Up_98308, [1, 1, 1], Res2380), 
LRes46601 = reshape_layer(Res2380, [1, 1, 1, 1], Res46601), 
LZer11194 = zero_padding3D_layer(Res46601, 1, 1, 1, 1, 1, 1, Zer11194), 
LRes64551 = reshape_layer(Zer11194, [3, 3, 3], Res64551), 
LRes6464 = reshape_layer(Res64551, [3, 9], Res6464), 
LFla80877 = flatten_layer(Res6464, Fla80877), 
LMul69137 = multiply_layer([[[[[0.594], [0.3668]], [[0.2711], [0.9657]]]], [[[[0.421], [0.7411]], [[0.8253], [0.3238]]]]], Mul69137), 
LRes21229 = reshape_layer(Mul69137, [2, 2], Res21229), 
LFla33916 = flatten_layer(Res21229, Fla33916), 
LDot49157 = dot_layer([[0.2596, 0.0285, 0.7079]], [[0.3216, 0.8425, 0.2271]], 1, 1, Dot49157), 
LMas44289 = masking_layer(Dot49157, 1, Mas44289), 
LCon35186 = concatenate_layer([Mas44289,[[0.2375, 0.0773, 0.7238]]], 1, Con35186), 
LAve54217 = average_layer([Fla33916,Con35186], Ave54217), 
LCon48456 = concatenate_layer([Ave54217,[[0.8304, 0.0488, 0.8455, 0.6545, 0.1336, 0.0264, 0.3649, 0.0479, 0.985, 0.2572, 0.696, 0.7467, 0.562, 0.0893, 0.3385, 0.7249, 0.7751, 0.6252, 0.1488, 0.8586, 0.3097, 0.1545, 0.6877]]], 1, Con48456), 
LAdd3100 = add_layer([Fla80877,Con48456], Add3100), 
exec_layers([LDot73637,LRes53935,LUp_98308,LRes2380,LRes46601,LZer11194,LRes64551,LRes6464,LFla80877,LMul69137,LRes21229,LFla33916,LDot49157,LMas44289,LCon35186,LAve54217,LCon48456,LAdd3100],["Dot73637","Res53935","Up_98308","Res2380","Res46601","Zer11194","Res64551","Res6464","Fla80877","Mul69137","Res21229","Fla33916","Dot49157","Mas44289","Con35186","Ave54217","Con48456","Add3100"],Add3100,"Add3100")

Actual (Unparsed): [[0.2591683, 0.2546677, 0.1505194, 0.5182468, 0.8304000, 0.0488000, 0.8455000, 0.6545000, 0.1336000, 0.0264000, 0.3649000, 0.0479000, 0.9850000, 0.5816732, 0.6960000, 0.7467000, 0.5620000, 0.0893000, 0.3385000, 0.7249000, 0.7751000, 0.6252000, 0.1488000, 0.8586000, 0.3097000, 0.1545000, 0.6877000]]

Expected (Unparsed): [[0.25916834999999994,0.25466774000000003,0.15051941500000002,0.51824683,0.8304,0.0488,0.8455,0.6545,0.1336,0.0264,0.3649,0.0479,0.985,0.58167322,0.696,0.7467,0.562,0.0893,0.3385,0.7249,0.7751,0.6252,0.1488,0.8586,0.3097,0.1545,0.6877]]

Actual:   [[0.2592, 0.2547, 0.1506, 0.5183, 0.8304, 0.0488, 0.8455, 0.6545, 0.1336, 0.0264, 0.3649, 0.0479, 0.985, 0.5817, 0.696, 0.7467, 0.562, 0.0893, 0.3385, 0.7249, 0.7751, 0.6252, 0.1488, 0.8586, 0.3097, 0.1545, 0.6877]]

Expected: [[0.2592, 0.2547, 0.1506, 0.5183, 0.8304, 0.0488, 0.8455, 0.6545, 0.1336, 0.0264, 0.3649, 0.0479, 0.985, 0.5817, 0.696, 0.7467, 0.562, 0.0893, 0.3385, 0.7249, 0.7751, 0.6252, 0.1488, 0.8586, 0.3097, 0.1545, 0.6877]]