import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con80099 = tf.keras.layers.Input(shape=([1, 2]))
in0Con57184 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Max82963 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Max82963 = tf.keras.layers.Input(shape=([2, 2, 2]))

Con80099 = keras.layers.Conv1D(3, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con80099', )(in0Con80099)
Res9273 = keras.layers.Reshape((1, 3, 1), name = 'Res9273', )(Con80099)
Res61835 = keras.layers.Reshape((1, 3, 1, 1), name = 'Res61835', )(Res9273)
Cro41946 = keras.layers.Cropping3D(cropping=((0, 0), (1, 1), (0, 0)), name = 'Cro41946', )(Res61835)
Res87642 = keras.layers.Reshape((1, 1, 1), name = 'Res87642', )(Cro41946)
Zer43708 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer43708', )(Res87642)
Con57184 = keras.layers.Concatenate(axis=3, name = 'Con57184', )([Zer43708,in0Con57184])
Max82963 = keras.layers.Maximum(name = 'Max82963', )([in0Max82963,in1Max82963])
Loc60679 = keras.layers.LocallyConnected2D(2, (1, 2),strides=(1, 1), name = 'Loc60679', )(Max82963)
Sub43141 = keras.layers.Subtract(name = 'Sub43141', )([Con57184,Loc60679])
Bat92847 = keras.layers.BatchNormalization(axis=2, epsilon=0.11069269837021627,  name = 'Bat92847', )(Sub43141)
model = tf.keras.models.Model(inputs=[in0Con80099,in0Con57184,in0Max82963,in1Max82963], outputs=Bat92847)
w = model.get_layer('Con80099').get_weights() 
w[0] = np.array([[[0.1735, 0.7454, 0.2796], [0.0106, 0.9692, 0.3024]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con80099').set_weights(w) 
w = model.get_layer('Loc60679').get_weights() 
w[0] = np.array([[[0.8681, 0.242], [0.7132, 0.7482], [0.4215, 0.8633], [0.2558, 0.0971]], [[0.2751, 0.0043], [0.5708, 0.9369], [0.5993, 0.8189], [0.8401, 0.616]]])
w[1] = np.array([[[0, 0]], [[0, 0]]])
model.get_layer('Loc60679').set_weights(w) 
w = model.get_layer('Bat92847').get_weights() 
w[0] = np.array([0.043])
w[1] = np.array([0.3226])
w[2] = np.array([0.3404])
w[3] = np.array([0.9902])
model.get_layer('Bat92847').set_weights(w) 
in0Con80099 = tf.constant([[[0.5223, 0.3657]]])
in0Con57184 = tf.constant([[[[0.9977]], [[0.1858]]]])
in0Max82963 = tf.constant([[[[0.5268, 0.5115], [0.6104, 0.9884]], [[0.8856, 0.9534], [0.445, 0.2937]]]])
in1Max82963 = tf.constant([[[[0.3253, 0.5098], [0.2687, 0.8669]], [[0.7951, 0.0156], [0.6023, 0.509]]]])
print (np.array2string(model.predict([in0Con80099,in0Con57184,in0Max82963,in1Max82963],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Bat92847.png')

LCon80099 = conv1D_layer([[[0.5223, 0.3657]]], 1,[[[0.1735, 0.7454, 0.2796], [0.0106, 0.9692, 0.3024]]],[0, 0, 0], 1, true, 1, Con80099), 
LRes9273 = reshape_layer(Con80099, [1, 3, 1], Res9273), 
LRes61835 = reshape_layer(Res9273, [1, 3, 1, 1], Res61835), 
LCro41946 = cropping3D_layer(Res61835, 0, 0, 1, 1, 0, 0, Cro41946), 
LRes87642 = reshape_layer(Cro41946, [1, 1, 1], Res87642), 
LZer43708 = zero_padding2D_layer(Res87642, 1, 0, 0, 0, Zer43708), 
LCon57184 = concatenate_layer([Zer43708,[[[[0.9977]], [[0.1858]]]]], 3, Con57184), 
LMax82963 = maximum_layer([[[[[0.5268, 0.5115], [0.6104, 0.9884]], [[0.8856, 0.9534], [0.445, 0.2937]]]], [[[[0.3253, 0.5098], [0.2687, 0.8669]], [[0.7951, 0.0156], [0.6023, 0.509]]]]], Max82963), 
LLoc60679 = locally_connected2D_layer(Max82963, 1, 2,[[[0.8681, 0.242], [0.7132, 0.7482], [0.4215, 0.8633], [0.2558, 0.0971]], [[0.2751, 0.0043], [0.5708, 0.9369], [0.5993, 0.8189], [0.8401, 0.616]]],[[[0, 0]], [[0, 0]]], 1, 1, Loc60679), 
LSub43141 = subtract_layer(Con57184,Loc60679, Sub43141), 
LBat92847 = batch_normalization_layer(Sub43141, 2, 0.11069269837021627, [0.043], [0.3226], [0.3404], [0.9902], Bat92847), 
exec_layers([LCon80099,LRes9273,LRes61835,LCro41946,LRes87642,LZer43708,LCon57184,LMax82963,LLoc60679,LSub43141,LBat92847],["Con80099","Res9273","Res61835","Cro41946","Res87642","Zer43708","Con57184","Max82963","Loc60679","Sub43141","Bat92847"],Bat92847,"Bat92847")

Actual (Unparsed): [[[[0.2540517, 0.3030997]], [[0.2745262, 0.2464379]]]]

Expected (Unparsed): [[[[0.2540517025234587,0.30309974231940323]],[[0.2745261754502567,0.24643790212423922]]]]

Actual:   [[[[0.2541, 0.3031]], [[0.2746, 0.2465]]]]

Expected: [[[[0.2541, 0.3031]], [[0.2746, 0.2465]]]]