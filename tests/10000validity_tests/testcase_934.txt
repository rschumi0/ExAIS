import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave39802 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Ave39802 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in0Sof81897 = tf.keras.layers.Input(shape=([1, 2, 2]))

Ave39802 = keras.layers.Average(name = 'Ave39802', )([in0Ave39802,in1Ave39802])
PRe35820 = keras.layers.PReLU(name = 'PRe35820', )(Ave39802)
Res84711 = keras.layers.Reshape((1, 1, 1), name = 'Res84711', )(PRe35820)
Res35676 = keras.layers.Reshape((1, 1), name = 'Res35676', )(Res84711)
Fla56308 = keras.layers.Flatten(name = 'Fla56308', )(Res35676)
Sof81897 = keras.layers.Softmax(axis=1, name = 'Sof81897', input_shape=(1, 2, 2))(in0Sof81897)
Res769 = keras.layers.Reshape((1, 4), name = 'Res769', )(Sof81897)
Sep88996 = keras.layers.SeparableConv1D(2, (1),strides=(1), padding='same', name = 'Sep88996', )(Res769)
Zer62399 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer62399', )(Sep88996)
GRU85993 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU85993', )(Zer62399)
Dot42415 = keras.layers.Dot(axes=(1, 1), name = 'Dot42415', )([Fla56308,GRU85993])
model = tf.keras.models.Model(inputs=[in0Ave39802,in1Ave39802,in0Sof81897], outputs=Dot42415)
w = model.get_layer('PRe35820').get_weights() 
w[0] = np.array([[[[0.8636]]]])
model.get_layer('PRe35820').set_weights(w) 
w = model.get_layer('Sep88996').get_weights() 
w[0] = np.array([[[0.254], [0.5533], [0.3077], [0.9099]]])
w[1] = np.array([[[0.2226, 0.931], [0.9368, 0.3282], [0.6823, 0.3504], [0.1422, 0.4486]]])
w[2] = np.array([0, 0])
model.get_layer('Sep88996').set_weights(w) 
w = model.get_layer('GRU85993').get_weights() 
w[0] = np.array([[7, 6, 3], [3, 2, 2]])
w[1] = np.array([[5, 7, 5]])
w[2] = np.array([[6, 2, 6], [3, 9, 6]])
model.get_layer('GRU85993').set_weights(w) 
in0Ave39802 = tf.constant([[[[[0.8267]]]]])
in1Ave39802 = tf.constant([[[[[0.6753]]]]])
in0Sof81897 = tf.constant([[[[0.4875, 0.3574], [0.6806, 0.9497]]]])
print (np.array2string(model.predict([in0Ave39802,in1Ave39802,in0Sof81897],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot42415.png')

LAve39802 = average_layer([[[[[[0.8267]]]]], [[[[[0.6753]]]]]], Ave39802), 
LPRe35820 = prelu_layer(Ave39802, [[[[0.8636]]]], PRe35820), 
LRes84711 = reshape_layer(PRe35820, [1, 1, 1], Res84711), 
LRes35676 = reshape_layer(Res84711, [1, 1], Res35676), 
LFla56308 = flatten_layer(Res35676, Fla56308), 
LSof81897 = softmax_layer([[[[0.4875, 0.3574], [0.6806, 0.9497]]]], 1, Sof81897), 
LRes769 = reshape_layer(Sof81897, [1, 4], Res769), 
LSep88996 = separable_conv1D_layer(Res769, 1,[[[[0.254], [0.5533], [0.3077], [0.9099]]],[[[0.2226, 0.931], [0.9368, 0.3282], [0.6823, 0.3504], [0.1422, 0.4486]]]],[0, 0], 1, true, Sep88996), 
LZer62399 = zero_padding1D_layer(Sep88996, 1, 1, Zer62399), 
LGRU85993 = gru_layer(Zer62399,[[7, 6, 3], [3, 2, 2]],[[5, 7, 5]],[[6, 2, 6], [3, 9, 6]], true, GRU85993), 
LDot42415 = dot_layer(Fla56308,GRU85993, 1, 1, Dot42415), 
exec_layers([LAve39802,LPRe35820,LRes84711,LRes35676,LFla56308,LSof81897,LRes769,LSep88996,LZer62399,LGRU85993,LDot42415],["Ave39802","PRe35820","Res84711","Res35676","Fla56308","Sof81897","Res769","Sep88996","Zer62399","GRU85993","Dot42415"],Dot42415,"Dot42415")

Actual (Unparsed): [[0.0001853]]

Expected (Unparsed): [[0.00018527941089843596]]

Actual:   [[0.0002]]

Expected: [[0.0002]]