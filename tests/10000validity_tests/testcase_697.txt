import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Up_52025 = tf.keras.layers.Input(shape=([3, 1, 4, 2]))
in0Con24970 = tf.keras.layers.Input(shape=([3, 3, 3]))
in0Ave25138 = tf.keras.layers.Input(shape=([1, 1]))
in1Ave25138 = tf.keras.layers.Input(shape=([1, 1]))
in0Ave66116 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Ave66116 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Con33651 = tf.keras.layers.Input(shape=([3, 3, 2]))
in0Zer58464 = tf.keras.layers.Input(shape=([1, 1, 4]))

Up_52025 = keras.layers.UpSampling3D(size=(1, 1, 1), name = 'Up_52025', )(in0Up_52025)
Res41530 = keras.layers.Reshape((3, 1, 8), name = 'Res41530', )(Up_52025)
Res26573 = keras.layers.Reshape((3, 8), name = 'Res26573', )(Res41530)
Loc96303 = keras.layers.LocallyConnected1D(3, (1),strides=(1), name = 'Loc96303', )(Res26573)
Res36101 = keras.layers.Reshape((3, 3, 1), name = 'Res36101', )(Loc96303)
Con24970 = keras.layers.Concatenate(axis=3, name = 'Con24970', )([Res36101,in0Con24970])
Ave25138 = keras.layers.Average(name = 'Ave25138', )([in0Ave25138,in1Ave25138])
Res66006 = keras.layers.Reshape((1, 1, 1), name = 'Res66006', )(Ave25138)
Res32855 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res32855', )(Res66006)
Zer89514 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (1, 0)), name = 'Zer89514', )(Res32855)
Ave66116 = keras.layers.Average(name = 'Ave66116', )([in0Ave66116,in1Ave66116])
Mul87437 = keras.layers.Multiply(name = 'Mul87437', )([Zer89514,Ave66116])
Res24323 = keras.layers.Reshape((1, 2, 2), name = 'Res24323', )(Mul87437)
Zer96515 = keras.layers.ZeroPadding2D(padding=((2, 0), (1, 0)), name = 'Zer96515', )(Res24323)
Con33651 = keras.layers.Concatenate(axis=3, name = 'Con33651', )([Zer96515,in0Con33651])
Zer58464 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer58464', )(in0Zer58464)
Sub26134 = keras.layers.Subtract(name = 'Sub26134', )([Con33651,Zer58464])
Add51448 = keras.layers.Add(name = 'Add51448', )([Con24970,Sub26134])
model = tf.keras.models.Model(inputs=[in0Up_52025,in0Con24970,in0Ave25138,in1Ave25138,in0Ave66116,in1Ave66116,in0Con33651,in0Zer58464], outputs=Add51448)
w = model.get_layer('Loc96303').get_weights() 
w[0] = np.array([[[0.6075, 0.0568, 0.4514], [0.7624, 0.8278, 0.2528], [0.9761, 0.5564, 0.754], [0.2535, 0.34, 0.1299], [0.4075, 0.7196, 0.5156], [0.4099, 0.6404, 0.1421], [0.2514, 0.6263, 0.0427], [0.4456, 0.0768, 0.8713]], [[0.4002, 0.7352, 0.1313], [0.2533, 0.1125, 0.3814], [0.7066, 0.5903, 0.512], [0.0252, 0.1914, 0.8637], [0.3407, 0.4957, 0.1861], [0.4601, 0.7326, 0.0823], [0.9138, 0.5625, 0.9296], [0.0792, 0.6989, 0.9238]], [[0.6125, 0.0312, 0.2034], [0.6529, 0.1696, 0.6454], [0.319, 0.575, 0.4432], [0.9105, 0.0955, 0.1902], [0.4976, 0.5614, 0.854], [0.2458, 0.7317, 0.668], [0.6811, 0.4641, 0.2255], [0.7843, 0.8295, 0.0232]]])
w[1] = np.array([[0, 0, 0], [0, 0, 0], [0, 0, 0]])
model.get_layer('Loc96303').set_weights(w) 
in0Up_52025 = tf.constant([[[[[1.1194, 1.5771], [1.4952, 1.8087], [1.8897, 1.5493], [1.7524, 1.2221]]], [[[1.7912, 1.5992], [1.5475, 1.583], [1.4817, 1.6204], [1.1544, 1.36]]], [[[1.7359, 1.0891], [1.9068, 1.8897], [1.9839, 1.7297], [1.6831, 1.4758]]]]])
in0Con24970 = tf.constant([[[[0.0674, 0.0351, 0.3225], [0.0938, 0.718, 0.1246], [0.4177, 0.8534, 0.3853]], [[0.7236, 0.0706, 0.9697], [0.4873, 0.8356, 0.5938], [0.7444, 0.5017, 0.0381]], [[0.9469, 0.2926, 0.772], [0.6752, 0.5872, 0.5443], [0.812, 0.6479, 0.5555]]]])
in0Ave25138 = tf.constant([[[0.4751]]])
in1Ave25138 = tf.constant([[[0.1188]]])
in0Ave66116 = tf.constant([[[[[0.7647], [0.1258]], [[0.7155], [0.4676]]]]])
in1Ave66116 = tf.constant([[[[[0.0977], [0.4593]], [[0.0635], [0.4443]]]]])
in0Con33651 = tf.constant([[[[0.3371, 0.3095], [0.8294, 0.5647], [0.8506, 0.3975]], [[0.9585, 0.3653], [0.2179, 0.0876], [0.1896, 0.3905]], [[0.1034, 0.5885], [0.8308, 0.2119], [0.1962, 0.5502]]]])
in0Zer58464 = tf.constant([[[[1.8038, 1.6411, 1.0186, 1.1761]]]])
print (np.array2string(model.predict([in0Up_52025,in0Con24970,in0Ave25138,in1Ave25138,in0Ave66116,in1Ave66116,in0Con33651,in0Zer58464],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add51448.png')

LUp_52025 = up_sampling3D_layer([[[[[1.1194, 1.5771], [1.4952, 1.8087], [1.8897, 1.5493], [1.7524, 1.2221]]], [[[1.7912, 1.5992], [1.5475, 1.583], [1.4817, 1.6204], [1.1544, 1.36]]], [[[1.7359, 1.0891], [1.9068, 1.8897], [1.9839, 1.7297], [1.6831, 1.4758]]]]], 1, 1, 1, Up_52025), 
LRes41530 = reshape_layer(Up_52025, [3, 1, 8], Res41530), 
LRes26573 = reshape_layer(Res41530, [3, 8], Res26573), 
LLoc96303 = locally_connected1D_layer(Res26573, 1,[[[0.6075, 0.0568, 0.4514], [0.7624, 0.8278, 0.2528], [0.9761, 0.5564, 0.754], [0.2535, 0.34, 0.1299], [0.4075, 0.7196, 0.5156], [0.4099, 0.6404, 0.1421], [0.2514, 0.6263, 0.0427], [0.4456, 0.0768, 0.8713]], [[0.4002, 0.7352, 0.1313], [0.2533, 0.1125, 0.3814], [0.7066, 0.5903, 0.512], [0.0252, 0.1914, 0.8637], [0.3407, 0.4957, 0.1861], [0.4601, 0.7326, 0.0823], [0.9138, 0.5625, 0.9296], [0.0792, 0.6989, 0.9238]], [[0.6125, 0.0312, 0.2034], [0.6529, 0.1696, 0.6454], [0.319, 0.575, 0.4432], [0.9105, 0.0955, 0.1902], [0.4976, 0.5614, 0.854], [0.2458, 0.7317, 0.668], [0.6811, 0.4641, 0.2255], [0.7843, 0.8295, 0.0232]]],[[0, 0, 0], [0, 0, 0], [0, 0, 0]], 1, Loc96303), 
LRes36101 = reshape_layer(Loc96303, [3, 3, 1], Res36101), 
LCon24970 = concatenate_layer([Res36101,[[[[0.0674, 0.0351, 0.3225], [0.0938, 0.718, 0.1246], [0.4177, 0.8534, 0.3853]], [[0.7236, 0.0706, 0.9697], [0.4873, 0.8356, 0.5938], [0.7444, 0.5017, 0.0381]], [[0.9469, 0.2926, 0.772], [0.6752, 0.5872, 0.5443], [0.812, 0.6479, 0.5555]]]]], 3, Con24970), 
LAve25138 = average_layer([[[[0.4751]]], [[[0.1188]]]], Ave25138), 
LRes66006 = reshape_layer(Ave25138, [1, 1, 1], Res66006), 
LRes32855 = reshape_layer(Res66006, [1, 1, 1, 1], Res32855), 
LZer89514 = zero_padding3D_layer(Res32855, 0, 0, 1, 0, 1, 0, Zer89514), 
LAve66116 = average_layer([[[[[[0.7647], [0.1258]], [[0.7155], [0.4676]]]]], [[[[[0.0977], [0.4593]], [[0.0635], [0.4443]]]]]], Ave66116), 
LMul87437 = multiply_layer([Zer89514,Ave66116], Mul87437), 
LRes24323 = reshape_layer(Mul87437, [1, 2, 2], Res24323), 
LZer96515 = zero_padding2D_layer(Res24323, 2, 0, 1, 0, Zer96515), 
LCon33651 = concatenate_layer([Zer96515,[[[[0.3371, 0.3095], [0.8294, 0.5647], [0.8506, 0.3975]], [[0.9585, 0.3653], [0.2179, 0.0876], [0.1896, 0.3905]], [[0.1034, 0.5885], [0.8308, 0.2119], [0.1962, 0.5502]]]]], 3, Con33651), 
LZer58464 = zero_padding2D_layer([[[[1.8038, 1.6411, 1.0186, 1.1761]]]], 1, 1, 1, 1, Zer58464), 
LSub26134 = subtract_layer(Con33651,Zer58464, Sub26134), 
LAdd51448 = add_layer([Con24970,Sub26134], Add51448), 
exec_layers([LUp_52025,LRes41530,LRes26573,LLoc96303,LRes36101,LCon24970,LAve25138,LRes66006,LRes32855,LZer89514,LAve66116,LMul87437,LRes24323,LZer96515,LCon33651,LZer58464,LSub26134,LAdd51448],["Up_52025","Res41530","Res26573","Loc96303","Res36101","Con24970","Ave25138","Res66006","Res32855","Zer89514","Ave66116","Mul87437","Res24323","Zer96515","Con33651","Zer58464","Sub26134","Add51448"],Add51448,"Add51448")

Actual (Unparsed): [[[[6.1906187, 0.0674000, 0.3722000, 0.6320000], [6.3593779, 0.0938000, 1.5474000, 0.6893000], [4.6004471, 0.4177000, 1.7040000, 0.7828000]], [[4.6682346, 0.7236000, 1.0291000, 1.3350000], [4.4309134, -1.1538000, 0.0349000, -0.4947000], [5.7432780, 0.7444000, 0.6913000, 0.4286000]], [[7.8193315, 0.9469000, 0.3960000, 1.3605000], [5.9004335, 0.6752000, 1.4180000, 0.7562000], [5.5239697, 0.9473943, 0.8441000, 1.1057000]]]]

Expected (Unparsed): [[[[6.19061865,0.0674,0.37220000000000003,0.632],[6.35937782,0.0938,1.5474,0.6893],[4.60044703,0.4177,1.7040000000000002,0.7827999999999999]],[[4.66823465,0.7236,1.0291000000000001,1.335],[4.43091342,-1.1538,0.03490000000000004,-0.49470000000000003],[5.743278070000001,0.7444,0.6913,0.42860000000000004]],[[7.819331440000001,0.9469,0.396,1.3605],[5.90043355,0.6752,1.4180000000000001,0.7562],[5.52396971,0.9473943525,0.8441000000000001,1.1057000000000001]]]]

Actual:   [[[[6.1907, 0.0674, 0.3722, 0.632], [6.3594, 0.0938, 1.5474, 0.6893], [4.6005, 0.4177, 1.704, 0.7828]], [[4.6683, 0.7236, 1.0291, 1.335], [4.431, -1.1538, 0.0349, -0.4947], [5.7433, 0.7444, 0.6913, 0.4286]], [[7.8194, 0.9469, 0.396, 1.3605], [5.9005, 0.6752, 1.418, 0.7562], [5.524, 0.9474, 0.8441, 1.1057]]]]

Expected: [[[[6.1907, 0.0674, 0.3723, 0.632], [6.3594, 0.0938, 1.5474, 0.6893], [4.6005, 0.4177, 1.7041, 0.7828]], [[4.6683, 0.7236, 1.0292, 1.335], [4.431, -1.1538, 0.035, -0.4947], [5.7433, 0.7444, 0.6913, 0.4287]], [[7.8194, 0.9469, 0.396, 1.3605], [5.9005, 0.6752, 1.4181, 0.7562], [5.524, 0.9474, 0.8442, 1.1058]]]]