import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul66742 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul66742 = tf.keras.layers.Input(shape=([2, 2]))
in0Up_15004 = tf.keras.layers.Input(shape=([4, 2]))

Mul66742 = keras.layers.Multiply(name = 'Mul66742', )([in0Mul66742,in1Mul66742])
Up_15004 = keras.layers.UpSampling1D(size=(2), name = 'Up_15004', )(in0Up_15004)
Fla97627 = keras.layers.Flatten(name = 'Fla97627', )(Up_15004)
Res37748 = keras.layers.Reshape((16, 1), name = 'Res37748', )(Fla97627)
Glo90958 = keras.layers.GlobalMaxPool1D(name = 'Glo90958', )(Res37748)
Res54202 = keras.layers.Reshape((1, 1), name = 'Res54202', )(Glo90958)
Sep77791 = keras.layers.SeparableConv1D(2, (1),strides=(1), padding='same', name = 'Sep77791', )(Res54202)
Zer19407 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer19407', )(Sep77791)
Ave2820 = keras.layers.Average(name = 'Ave2820', )([Mul66742,Zer19407])
model = tf.keras.models.Model(inputs=[in0Mul66742,in1Mul66742,in0Up_15004], outputs=Ave2820)
w = model.get_layer('Sep77791').get_weights() 
w[0] = np.array([[[0.8081]]])
w[1] = np.array([[[0.5173, 0.1549]]])
w[2] = np.array([0, 0])
model.get_layer('Sep77791').set_weights(w) 
in0Mul66742 = tf.constant([[[0.1886, 0.4909], [0.9104, 0.2228]]])
in1Mul66742 = tf.constant([[[0.5949, 0.5906], [0.2669, 0.187]]])
in0Up_15004 = tf.constant([[[1.422, 1.248], [1.3543, 1.5204], [1.5457, 1.3675], [1.7985, 1.838]]])
print (np.array2string(model.predict([in0Mul66742,in1Mul66742,in0Up_15004],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave2820.png')

LMul66742 = multiply_layer([[[[0.1886, 0.4909], [0.9104, 0.2228]]], [[[0.5949, 0.5906], [0.2669, 0.187]]]], Mul66742), 
LUp_15004 = up_sampling1D_layer([[[1.422, 1.248], [1.3543, 1.5204], [1.5457, 1.3675], [1.7985, 1.838]]], 2, Up_15004), 
LFla97627 = flatten_layer(Up_15004, Fla97627), 
LRes37748 = reshape_layer(Fla97627, [16, 1], Res37748), 
LGlo90958 = global_max_pool1D_layer(Res37748, Glo90958), 
LRes54202 = reshape_layer(Glo90958, [1, 1], Res54202), 
LSep77791 = separable_conv1D_layer(Res54202, 1,[[[[0.8081]]],[[[0.5173, 0.1549]]]],[0, 0], 1, true, Sep77791), 
LZer19407 = zero_padding1D_layer(Sep77791, 1, 0, Zer19407), 
LAve2820 = average_layer([Mul66742,Zer19407], Ave2820), 
exec_layers([LMul66742,LUp_15004,LFla97627,LRes37748,LGlo90958,LRes54202,LSep77791,LZer19407,LAve2820],["Mul66742","Up_15004","Fla97627","Res37748","Glo90958","Res54202","Sep77791","Zer19407","Ave2820"],Ave2820,"Ave2820")

Actual (Unparsed): [[[0.0560991, 0.1449628], [0.5056626, 0.1358673]]]

Expected (Unparsed): [[[0.056099069999999994,0.14496277],[0.50566256947,0.13586734011]]]

Actual:   [[[0.0561, 0.145], [0.5057, 0.1359]]]

Expected: [[[0.0561, 0.145], [0.5057, 0.1359]]]