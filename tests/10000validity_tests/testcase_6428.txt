import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max35296 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Max35296 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con37690 = tf.keras.layers.Input(shape=([4, 2]))
in0Zer67403 = tf.keras.layers.Input(shape=([3, 3]))

Max35296 = keras.layers.Maximum(name = 'Max35296', )([in0Max35296,in1Max35296])
Fla77574 = keras.layers.Flatten(name = 'Fla77574', )(Max35296)
Res23983 = keras.layers.Reshape((4, 1), name = 'Res23983', )(Fla77574)
PRe24979 = keras.layers.PReLU(name = 'PRe24979', )(Res23983)
Con37690 = keras.layers.Concatenate(axis=2, name = 'Con37690', )([PRe24979,in0Con37690])
Zer67403 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer67403', )(in0Zer67403)
Res1851 = keras.layers.Reshape((5, 3, 1), name = 'Res1851', )(Zer67403)
Con32805 = keras.layers.Conv2D(4, (4, 3),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con32805', )(Res1851)
Res48224 = keras.layers.Reshape((5, 3, 4, 1), name = 'Res48224', )(Con32805)
Cro29804 = keras.layers.Cropping3D(cropping=((4, 0), (2, 0), (0, 1)), name = 'Cro29804', )(Res48224)
Res6221 = keras.layers.Reshape((1, 1, 3), name = 'Res6221', )(Cro29804)
Res96858 = keras.layers.Reshape((1, 3), name = 'Res96858', )(Res6221)
Zer70564 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer70564', )(Res96858)
Dot86985 = keras.layers.Dot(axes=(1, 1), name = 'Dot86985', )([Con37690,Zer70564])
model = tf.keras.models.Model(inputs=[in0Max35296,in1Max35296,in0Con37690,in0Zer67403], outputs=Dot86985)
w = model.get_layer('PRe24979').get_weights() 
w[0] = np.array([[0.4186], [0.5946], [0.1064], [0.7206]])
model.get_layer('PRe24979').set_weights(w) 
w = model.get_layer('Con32805').get_weights() 
w[0] = np.array([[[[0.1015, 0.5744, 0.0783, 0.1184]], [[0.2307, 0.5094, 0.642, 0.8727]], [[0.4633, 0.8399, 0.0218, 0.168]]], [[[0.3442, 0.5702, 0.1352, 0.9964]], [[0.5155, 0.9008, 0.666, 0.5956]], [[0.9113, 0.9358, 0.9513, 0.5212]]], [[[0.649, 0.6954, 0.5402, 0.6039]], [[0.5664, 0.8321, 0.247, 0.9567]], [[0.9185, 0.1159, 0.8496, 0.2531]]], [[[0.0904, 0.4502, 0.1917, 0.0864]], [[0.3104, 0.9067, 0.3426, 0.3355]], [[0.2553, 0.027, 0.6392, 0.1141]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con32805').set_weights(w) 
in0Max35296 = tf.constant([[[[0.1836, 0.5757]], [[0.1253, 0.0031]]]])
in1Max35296 = tf.constant([[[[0.2797, 0.2361]], [[0.4007, 0.0925]]]])
in0Con37690 = tf.constant([[[0.4452, 0.2888], [0.7819, 0.5122], [0.6619, 0.3204], [0.3073, 0.5145]]])
in0Zer67403 = tf.constant([[[1.4263, 1.979, 1.7891], [1.4703, 1.9361, 1.642], [1.2161, 1.8864, 1.3257]]])
print (np.array2string(model.predict([in0Max35296,in1Max35296,in0Con37690,in0Zer67403],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot86985.png')

LMax35296 = maximum_layer([[[[[0.1836, 0.5757]], [[0.1253, 0.0031]]]], [[[[0.2797, 0.2361]], [[0.4007, 0.0925]]]]], Max35296), 
LFla77574 = flatten_layer(Max35296, Fla77574), 
LRes23983 = reshape_layer(Fla77574, [4, 1], Res23983), 
LPRe24979 = prelu_layer(Res23983, [[0.4186], [0.5946], [0.1064], [0.7206]], PRe24979), 
LCon37690 = concatenate_layer([PRe24979,[[[0.4452, 0.2888], [0.7819, 0.5122], [0.6619, 0.3204], [0.3073, 0.5145]]]], 2, Con37690), 
LZer67403 = zero_padding1D_layer([[[1.4263, 1.979, 1.7891], [1.4703, 1.9361, 1.642], [1.2161, 1.8864, 1.3257]]], 1, 1, Zer67403), 
LRes1851 = reshape_layer(Zer67403, [5, 3, 1], Res1851), 
LCon32805 = conv2D_layer(Res1851, 4, 3,[[[[0.1015, 0.5744, 0.0783, 0.1184]], [[0.2307, 0.5094, 0.642, 0.8727]], [[0.4633, 0.8399, 0.0218, 0.168]]], [[[0.3442, 0.5702, 0.1352, 0.9964]], [[0.5155, 0.9008, 0.666, 0.5956]], [[0.9113, 0.9358, 0.9513, 0.5212]]], [[[0.649, 0.6954, 0.5402, 0.6039]], [[0.5664, 0.8321, 0.247, 0.9567]], [[0.9185, 0.1159, 0.8496, 0.2531]]], [[[0.0904, 0.4502, 0.1917, 0.0864]], [[0.3104, 0.9067, 0.3426, 0.3355]], [[0.2553, 0.027, 0.6392, 0.1141]]]],[0, 0, 0, 0], 1, 1, true, 1, 1, Con32805), 
LRes48224 = reshape_layer(Con32805, [5, 3, 4, 1], Res48224), 
LCro29804 = cropping3D_layer(Res48224, 4, 0, 2, 0, 0, 1, Cro29804), 
LRes6221 = reshape_layer(Cro29804, [1, 1, 3], Res6221), 
LRes96858 = reshape_layer(Res6221, [1, 3], Res96858), 
LZer70564 = zero_padding1D_layer(Res96858, 3, 0, Zer70564), 
LDot86985 = dot_layer(Con37690,Zer70564, 1, 1, Dot86985), 
exec_layers([LMax35296,LFla77574,LRes23983,LPRe24979,LCon37690,LZer67403,LRes1851,LCon32805,LRes48224,LCro29804,LRes6221,LRes96858,LZer70564,LDot86985],["Max35296","Fla77574","Res23983","PRe24979","Con37690","Zer67403","Res1851","Con32805","Res48224","Cro29804","Res6221","Res96858","Zer70564","Dot86985"],Dot86985,"Dot86985")

Actual (Unparsed): [[[0.0460010, 0.1626945, 0.0923894], [0.1528229, 0.5404976, 0.3069326], [0.2558653, 0.9049334, 0.5138850]]]

Expected (Unparsed): [[[0.046001044575000004,0.16269452595,0.09238941810000001],[0.152822929707,0.540497598102,0.30693262899600005],[0.255865269555,0.9049333362299999,0.51388492554]]]

Actual:   [[[0.0461, 0.1627, 0.0924], [0.1529, 0.5405, 0.307], [0.2559, 0.905, 0.5139]]]

Expected: [[[0.0461, 0.1627, 0.0924], [0.1529, 0.5405, 0.307], [0.2559, 0.905, 0.5139]]]