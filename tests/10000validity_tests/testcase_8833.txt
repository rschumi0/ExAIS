import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0GRU24153 = tf.keras.layers.Input(shape=([2, 2]))
in0Dot65367 = tf.keras.layers.Input(shape=([2]))
in1Dot65367 = tf.keras.layers.Input(shape=([2]))
in0Con16607 = tf.keras.layers.Input(shape=([2]))
in0Con36098 = tf.keras.layers.Input(shape=([4, 4, 1]))
in0Zer30247 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Mul11554 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Mul11554 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))

GRU24153 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU24153', )(in0GRU24153)
Dot65367 = keras.layers.Dot(axes=(1, 1), name = 'Dot65367', )([in0Dot65367,in1Dot65367])
Con16607 = keras.layers.Concatenate(axis=1, name = 'Con16607', )([Dot65367,in0Con16607])
Add21506 = keras.layers.Add(name = 'Add21506', )([GRU24153,Con16607])
Res64567 = keras.layers.Reshape((3, 1), name = 'Res64567', )(Add21506)
Res49547 = keras.layers.Reshape((3, 1, 1), name = 'Res49547', )(Res64567)
Zer7525 = keras.layers.ZeroPadding2D(padding=((1, 0), (3, 0)), name = 'Zer7525', )(Res49547)
Con36098 = keras.layers.Concatenate(axis=3, name = 'Con36098', )([Zer7525,in0Con36098])
Zer30247 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer30247', )(in0Zer30247)
Sub33727 = keras.layers.Subtract(name = 'Sub33727', )([Con36098,Zer30247])
Res24844 = keras.layers.Reshape((4, 4, 2, 1), name = 'Res24844', )(Sub33727)
Mul11554 = keras.layers.Multiply(name = 'Mul11554', )([in0Mul11554,in1Mul11554])
Zer68822 = keras.layers.ZeroPadding3D(padding=((3, 0), (2, 0), (0, 0)), name = 'Zer68822', )(Mul11554)
Min4966 = keras.layers.Minimum(name = 'Min4966', )([Res24844,Zer68822])
Con80129 = keras.layers.Conv3DTranspose(4, (1, 1, 2),strides=(1, 1, 1), padding='valid', name = 'Con80129', )(Min4966)
model = tf.keras.models.Model(inputs=[in0GRU24153,in0Dot65367,in1Dot65367,in0Con16607,in0Con36098,in0Zer30247,in0Mul11554,in1Mul11554], outputs=Con80129)
w = model.get_layer('GRU24153').get_weights() 
w[0] = np.array([[10, 6, 4, 10, 8, 5, 6, 10, 3], [7, 5, 9, 3, 5, 7, 3, 8, 2]])
w[1] = np.array([[4, 1, 5, 3, 10, 6, 2, 7, 6], [2, 6, 8, 2, 3, 8, 6, 2, 10], [9, 1, 4, 5, 2, 2, 7, 8, 5]])
w[2] = np.array([1, 4, 7, 3, 5, 6, 4, 4, 10])
model.get_layer('GRU24153').set_weights(w) 
w = model.get_layer('Con80129').get_weights() 
w[0] = np.array([[[[[0.6911], [0.0265], [0.2033], [0.4553]], [[0.5009], [0.818], [0.7697], [0.1405]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con80129').set_weights(w) 
in0GRU24153 = tf.constant([[[2, 10], [4, 3]]])
in0Dot65367 = tf.constant([[0.5466, 0.752]])
in1Dot65367 = tf.constant([[0.4191, 0.0172]])
in0Con16607 = tf.constant([[0.3913, 0.1698]])
in0Con36098 = tf.constant([[[[0.3403], [0.125], [0.7936], [0.8144]], [[0.9882], [0.9034], [0.0068], [0.0514]], [[0.6327], [0.4601], [0.4788], [0.632]], [[0.5868], [0.1646], [0.5321], [0.2861]]]])
in0Zer30247 = tf.constant([[[[1.6376, 1.7509], [1.318, 1.449]], [[1.6153, 1.6268], [1.2579, 1.1868]]]])
in0Mul11554 = tf.constant([[[[[0.3385], [0.3568]], [[0.1171], [0.9259]]]]])
in1Mul11554 = tf.constant([[[[[0.0601], [0.2031]], [[0.1251], [0.2868]]]]])
print (np.array2string(model.predict([in0GRU24153,in0Dot65367,in1Dot65367,in0Con16607,in0Con36098,in0Zer30247,in0Mul11554,in1Mul11554],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con80129.png')

LGRU24153 = gru_layer([[[2, 10], [4, 3]]],[[10, 6, 4, 10, 8, 5, 6, 10, 3], [7, 5, 9, 3, 5, 7, 3, 8, 2]],[[4, 1, 5, 3, 10, 6, 2, 7, 6], [2, 6, 8, 2, 3, 8, 6, 2, 10], [9, 1, 4, 5, 2, 2, 7, 8, 5]],[1, 4, 7, 3, 5, 6, 4, 4, 10], false, GRU24153), 
LDot65367 = dot_layer([[0.5466, 0.752]], [[0.4191, 0.0172]], 1, 1, Dot65367), 
LCon16607 = concatenate_layer([Dot65367,[[0.3913, 0.1698]]], 1, Con16607), 
LAdd21506 = add_layer([GRU24153,Con16607], Add21506), 
LRes64567 = reshape_layer(Add21506, [3, 1], Res64567), 
LRes49547 = reshape_layer(Res64567, [3, 1, 1], Res49547), 
LZer7525 = zero_padding2D_layer(Res49547, 1, 0, 3, 0, Zer7525), 
LCon36098 = concatenate_layer([Zer7525,[[[[0.3403], [0.125], [0.7936], [0.8144]], [[0.9882], [0.9034], [0.0068], [0.0514]], [[0.6327], [0.4601], [0.4788], [0.632]], [[0.5868], [0.1646], [0.5321], [0.2861]]]]], 3, Con36098), 
LZer30247 = zero_padding2D_layer([[[[1.6376, 1.7509], [1.318, 1.449]], [[1.6153, 1.6268], [1.2579, 1.1868]]]], 1, 1, 1, 1, Zer30247), 
LSub33727 = subtract_layer(Con36098,Zer30247, Sub33727), 
LRes24844 = reshape_layer(Sub33727, [4, 4, 2, 1], Res24844), 
LMul11554 = multiply_layer([[[[[[0.3385], [0.3568]], [[0.1171], [0.9259]]]]], [[[[[0.0601], [0.2031]], [[0.1251], [0.2868]]]]]], Mul11554), 
LZer68822 = zero_padding3D_layer(Mul11554, 3, 0, 2, 0, 0, 0, Zer68822), 
LMin4966 = minimum_layer([Res24844,Zer68822], Min4966), 
LCon80129 = conv3D_transpose_layer(Min4966, 1, 1, 2,[[[[[0.6911], [0.0265], [0.2033], [0.4553]], [[0.5009], [0.818], [0.7697], [0.1405]]]]],[0, 0, 0, 0], 1, 1, 1, false, Con80129), 
exec_layers([LGRU24153,LDot65367,LCon16607,LAdd21506,LRes64567,LRes49547,LZer7525,LCon36098,LZer30247,LSub33727,LRes24844,LMul11554,LZer68822,LMin4966,LCon80129],["GRU24153","Dot65367","Con16607","Add21506","Res64567","Res49547","Zer7525","Con36098","Zer30247","Sub33727","Res24844","Mul11554","Zer68822","Min4966","Con80129"],Con80129,"Con80129")

Actual (Unparsed): [[[[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[-1.1317453, -0.0433964, -0.3329241, -0.7455993], [-1.4059811, -1.3620155, -1.4327574, -0.6159496], [-0.4245128, -0.6932550, -0.6523208, -0.1190738]], [[-0.9108698, -0.0349270, -0.2679494, -0.6000854], [-1.6568906, -1.1163423, -1.3076638, -0.8418127], [-0.7223980, -1.1797196, -1.1100613, -0.2026291]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[-1.1163339, -0.0428055, -0.3283905, -0.7354461], [-1.6154101, -1.3522330, -1.4804866, -0.7581481], [-0.5844000, -0.9543606, -0.8980089, -0.1639213]], [[-0.8693347, -0.0333343, -0.2557311, -0.5727219], [-1.1193809, -1.0477242, -1.1121420, -0.4990874], [-0.3546372, -0.5791440, -0.5449476, -0.0994740]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0500813, 0.0019204, 0.0147324, 0.0329938], [0.0362983, 0.0592773, 0.0557771, 0.0101815]], [[0.0101241, 0.0003882, 0.0029782, 0.0066698], [0.1908581, 0.0190201, 0.0652614, 0.1229623], [0.1330130, 0.2172184, 0.2043924, 0.0373095]]]]]

Expected (Unparsed): [[[[[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]],[[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]],[[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]],[[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]]],[[[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]],[[-1.13174536,-0.043396399999999995,-0.33292408,-0.74559928],[-1.40598109,-1.3620155499999997,-1.4327574699999999,-0.61594955],[-0.42451275,-0.6932549999999998,-0.65232075,-0.11907375]],[[-0.9108698000000001,-0.034927,-0.2679494,-0.6000854],[-1.6568906200000002,-1.1163423000000001,-1.3076638600000001,-0.84181266],[-0.7223979800000001,-1.1797196,-1.1100613400000001,-0.20262910000000003]],[[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]]],[[[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]],[[-1.11633383,-0.042805449999999995,-0.32839049,-0.7354460899999999],[-1.61541014,-1.3522329499999999,-1.4804865200000001,-0.75814816],[-0.5844000300000001,-0.9543606,-0.8980089900000001,-0.16392135000000002]],[[-0.8693346900000001,-0.03333435,-0.25573107,-0.57272187],[-1.11938091,-1.0477242,-1.11214203,-0.49908735000000004],[-0.35463720000000004,-0.579144,-0.5449476000000001,-0.09947400000000002]],[[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]]],[[[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]],[[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0]],[[0.0,0.0,0.0,0.0],[0.050081307888000005,0.00192035112,0.014732354064000001,0.032993806224],[0.036298259472,0.05927725344,0.055777141776,0.010181484240000002]],[[0.010124069030999999,0.0003882040649999999,0.0029781843929999998,0.0066697853129999984],[0.190858095021,0.01902007896,0.065261429733,0.12296227304099999],[0.133013053308,0.21721836215999998,0.204392387964,0.037309510860000006]]]]]

Actual:   [[[[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]], [[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[-1.1317, -0.0433, -0.3329, -0.7455], [-1.4059, -1.362, -1.4327, -0.6159], [-0.4245, -0.6932, -0.6523, -0.119]], [[-0.9108, -0.0349, -0.2679, -0.6], [-1.6568, -1.1163, -1.3076, -0.8418], [-0.7223, -1.1797, -1.11, -0.2026]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]], [[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[-1.1163, -0.0428, -0.3283, -0.7354], [-1.6154, -1.3522, -1.4804, -0.7581], [-0.5844, -0.9543, -0.898, -0.1639]], [[-0.8693, -0.0333, -0.2557, -0.5727], [-1.1193, -1.0477, -1.1121, -0.499], [-0.3546, -0.5791, -0.5449, -0.0994]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]], [[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0.0501, 0.002, 0.0148, 0.033], [0.0363, 0.0593, 0.0558, 0.0102]], [[0.0102, 0.0004, 0.003, 0.0067], [0.1909, 0.0191, 0.0653, 0.123], [0.1331, 0.2173, 0.2044, 0.0374]]]]]

Expected: [[[[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]], [[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[-1.1317, -0.0433, -0.3329, -0.7455], [-1.4059, -1.362, -1.4327, -0.6159], [-0.4245, -0.6932, -0.6523, -0.119]], [[-0.9108, -0.0349, -0.2679, -0.6], [-1.6568, -1.1163, -1.3076, -0.8418], [-0.7223, -1.1797, -1.11, -0.2026]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]], [[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[-1.1163, -0.0428, -0.3283, -0.7354], [-1.6154, -1.3522, -1.4804, -0.7581], [-0.5844, -0.9543, -0.898, -0.1639]], [[-0.8693, -0.0333, -0.2557, -0.5727], [-1.1193, -1.0477, -1.1121, -0.499], [-0.3546, -0.5791, -0.5449, -0.0994]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]], [[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0.0501, 0.002, 0.0148, 0.033], [0.0363, 0.0593, 0.0558, 0.0102]], [[0.0102, 0.0004, 0.003, 0.0067], [0.1909, 0.0191, 0.0653, 0.123], [0.1331, 0.2173, 0.2044, 0.0374]]]]]