import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0ReL1846 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Sub28423 = tf.keras.layers.Input(shape=([2]))
in1Sub28423 = tf.keras.layers.Input(shape=([2]))
in0Con68581 = tf.keras.layers.Input(shape=([2]))

ReL1846 = keras.layers.ReLU(max_value=9.561153215662078, negative_slope=3.6287557800239236, threshold=1.2543747734575772, name = 'ReL1846', input_shape=(1, 2, 1))(in0ReL1846)
Zer91870 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer91870', )(ReL1846)
Con20355 = keras.layers.Conv2D(2, (2, 1),strides=(10, 2), padding='valid', dilation_rate=(1, 1), name = 'Con20355', )(Zer91870)
Res14741 = keras.layers.Reshape((1, 4), name = 'Res14741', )(Con20355)
Fla61562 = keras.layers.Flatten(name = 'Fla61562', )(Res14741)
Sub28423 = keras.layers.Subtract(name = 'Sub28423', )([in0Sub28423,in1Sub28423])
Con68581 = keras.layers.Concatenate(axis=1, name = 'Con68581', )([Sub28423,in0Con68581])
Add79676 = keras.layers.Add(name = 'Add79676', )([Fla61562,Con68581])
Res16779 = keras.layers.Reshape((4, 1), name = 'Res16779', )(Add79676)
Con44330 = keras.layers.Conv1D(3, (2),strides=(3), padding='valid', dilation_rate=(1), name = 'Con44330', )(Res16779)
Sim61613 = keras.layers.SimpleRNN(2,name = 'Sim61613', )(Con44330)
model = tf.keras.models.Model(inputs=[in0ReL1846,in0Sub28423,in1Sub28423,in0Con68581], outputs=Sim61613)
w = model.get_layer('Con20355').get_weights() 
w[0] = np.array([[[[0.9552, 0.1774]]], [[[0.2821, 0.4291]]]])
w[1] = np.array([0, 0])
model.get_layer('Con20355').set_weights(w) 
w = model.get_layer('Con44330').get_weights() 
w[0] = np.array([[[0.5924, 0.2046, 0.5714]], [[0.0353, 0.8839, 0.7893]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con44330').set_weights(w) 
w = model.get_layer('Sim61613').get_weights() 
w[0] = np.array([[3, 2], [3, 8], [3, 3]])
w[1] = np.array([[8, 1], [3, 6]])
w[2] = np.array([8, 8])
model.get_layer('Sim61613').set_weights(w) 
in0ReL1846 = tf.constant([[[[0.2928], [0.6818]]]])
in0Sub28423 = tf.constant([[0.0991, 0.1294]])
in1Sub28423 = tf.constant([[0.2663, 0.0998]])
in0Con68581 = tf.constant([[0.7781, 0.082]])
print (np.array2string(model.predict([in0ReL1846,in0Sub28423,in1Sub28423,in0Con68581],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sim61613.png')

LReL1846 = relu_layer([[[[0.2928], [0.6818]]]], 9.561153215662078, 3.6287557800239236, 1.2543747734575772, ReL1846), 
LZer91870 = zero_padding2D_layer(ReL1846, 1, 1, 1, 1, Zer91870), 
LCon20355 = conv2D_layer(Zer91870, 2, 1,[[[[0.9552, 0.1774]]], [[[0.2821, 0.4291]]]],[0, 0], 10, 2, false, 1, 1, Con20355), 
LRes14741 = reshape_layer(Con20355, [1, 4], Res14741), 
LFla61562 = flatten_layer(Res14741, Fla61562), 
LSub28423 = subtract_layer([[0.0991, 0.1294]], [[0.2663, 0.0998]], Sub28423), 
LCon68581 = concatenate_layer([Sub28423,[[0.7781, 0.082]]], 1, Con68581), 
LAdd79676 = add_layer([Fla61562,Con68581], Add79676), 
LRes16779 = reshape_layer(Add79676, [4, 1], Res16779), 
LCon44330 = conv1D_layer(Res16779, 2,[[[0.5924, 0.2046, 0.5714]], [[0.0353, 0.8839, 0.7893]]],[0, 0, 0], 3, false, 1, Con44330), 
LSim61613 = simple_rnn_layer(Con44330,[[3, 2], [3, 8], [3, 3]],[[8, 1], [3, 6]],[8, 8], Sim61613), 
exec_layers([LReL1846,LZer91870,LCon20355,LRes14741,LFla61562,LSub28423,LCon68581,LAdd79676,LRes16779,LCon44330,LSim61613],["ReL1846","Zer91870","Con20355","Res14741","Fla61562","Sub28423","Con68581","Add79676","Res16779","Con44330","Sim61613"],Sim61613,"Sim61613")

Actual (Unparsed): [[0.9999993, 0.9999994]]

Expected (Unparsed): [[0.9999993442615733,0.9999994158195029]]

Actual:   [[1, 1]]

Expected: [[1, 1]]