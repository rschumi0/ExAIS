import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave41952 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Ave41952 = tf.keras.layers.Input(shape=([1, 2, 1]))

Ave41952 = keras.layers.Average(name = 'Ave41952', )([in0Ave41952,in1Ave41952])
Res68358 = keras.layers.Reshape((1, 2), name = 'Res68358', )(Ave41952)
Sim54095 = keras.layers.SimpleRNN(2,name = 'Sim54095', )(Res68358)
Res97078 = keras.layers.Reshape((2, 1), name = 'Res97078', )(Sim54095)
LST96130 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST96130', )(Res97078)
model = tf.keras.models.Model(inputs=[in0Ave41952,in1Ave41952], outputs=LST96130)
w = model.get_layer('Sim54095').get_weights() 
w[0] = np.array([[10, 3], [1, 5]])
w[1] = np.array([[7, 8], [4, 7]])
w[2] = np.array([1, 9])
model.get_layer('Sim54095').set_weights(w) 
w = model.get_layer('LST96130').get_weights() 
w[0] = np.array([[3, 6, 5, 2, 1, 4, 1, 7, 9, 4, 2, 9]])
w[1] = np.array([[7, 5, 9, 10, 5, 7, 10, 2, 8, 4, 6, 7], [3, 8, 4, 6, 2, 1, 9, 1, 3, 2, 8, 3], [6, 8, 7, 8, 7, 8, 9, 7, 1, 1, 8, 6]])
w[2] = np.array([10, 9, 3, 1, 8, 8, 3, 4, 4, 8, 7, 7])
model.get_layer('LST96130').set_weights(w) 
in0Ave41952 = tf.constant([[[[0.9113], [0.5436]]]])
in1Ave41952 = tf.constant([[[[0.1132], [0.8687]]]])
print (np.array2string(model.predict([in0Ave41952,in1Ave41952],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST96130.png')

LAve41952 = average_layer([[[[[0.9113], [0.5436]]]], [[[[0.1132], [0.8687]]]]], Ave41952), 
LRes68358 = reshape_layer(Ave41952, [1, 2], Res68358), 
LSim54095 = simple_rnn_layer(Res68358,[[10, 3], [1, 5]],[[7, 8], [4, 7]],[1, 9], Sim54095), 
LRes97078 = reshape_layer(Sim54095, [2, 1], Res97078), 
LLST96130 = lstm_layer(Res97078,[[3, 6, 5, 2, 1, 4, 1, 7, 9, 4, 2, 9]],[[7, 5, 9, 10, 5, 7, 10, 2, 8, 4, 6, 7], [3, 8, 4, 6, 2, 1, 9, 1, 3, 2, 8, 3], [6, 8, 7, 8, 7, 8, 9, 7, 1, 1, 8, 6]],[10, 9, 3, 1, 8, 8, 3, 4, 4, 8, 7, 7], LST96130), 
exec_layers([LAve41952,LRes68358,LSim54095,LRes97078,LLST96130],["Ave41952","Res68358","Sim54095","Res97078","LST96130"],LST96130,"LST96130")

Actual (Unparsed): [[0.9639800, 0.9640276, 0.9640039]]

Expected (Unparsed): [[0.9639799751396342,0.9640275582128759,0.9640038793644345]]

Actual:   [[0.964, 0.9641, 0.9641]]

Expected: [[0.964, 0.9641, 0.9641]]