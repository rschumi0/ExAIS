import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub311 = tf.keras.layers.Input(shape=([2, 3, 2]))
in1Sub311 = tf.keras.layers.Input(shape=([2, 3, 2]))
in0Con10534 = tf.keras.layers.Input(shape=([2, 2]))
in0GRU68271 = tf.keras.layers.Input(shape=([3, 2]))
in0Con39813 = tf.keras.layers.Input(shape=([6]))
in0Con44066 = tf.keras.layers.Input(shape=([11]))
in0Con10717 = tf.keras.layers.Input(shape=([14, 1, 1, 1]))
in0Dot33895 = tf.keras.layers.Input(shape=([3]))
in1Dot33895 = tf.keras.layers.Input(shape=([3]))
in0Con26565 = tf.keras.layers.Input(shape=([14, 1, 1, 1]))
in0Ave56459 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Ave56459 = tf.keras.layers.Input(shape=([2, 2, 2]))

Sub311 = keras.layers.Subtract(name = 'Sub311', )([in0Sub311,in1Sub311])
Res15695 = keras.layers.Reshape((2, 6), name = 'Res15695', )(Sub311)
Fla60178 = keras.layers.Flatten(name = 'Fla60178', )(Res15695)
Con10534 = keras.layers.Conv1D(4, (2),strides=(1), padding='same', dilation_rate=(1), name = 'Con10534', )(in0Con10534)
Fla85264 = keras.layers.Flatten(name = 'Fla85264', )(Con10534)
GRU68271 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU68271', )(in0GRU68271)
Con39813 = keras.layers.Concatenate(axis=1, name = 'Con39813', )([GRU68271,in0Con39813])
Ave27607 = keras.layers.Average(name = 'Ave27607', )([Fla85264,Con39813])
Res29188 = keras.layers.Reshape((8, 1), name = 'Res29188', )(Ave27607)
LST670 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST670', )(Res29188)
Con44066 = keras.layers.Concatenate(axis=1, name = 'Con44066', )([LST670,in0Con44066])
Add36787 = keras.layers.Add(name = 'Add36787', )([Fla60178,Con44066])
Res99008 = keras.layers.Reshape((12, 1), name = 'Res99008', )(Add36787)
Res32832 = keras.layers.Reshape((12, 1, 1), name = 'Res32832', )(Res99008)
Res81699 = keras.layers.Reshape((12, 1, 1, 1), name = 'Res81699', )(Res32832)
Zer40725 = keras.layers.ZeroPadding3D(padding=((2, 0), (0, 0), (0, 0)), name = 'Zer40725', )(Res81699)
Con10717 = keras.layers.Concatenate(axis=4, name = 'Con10717', )([Zer40725,in0Con10717])
Dot33895 = keras.layers.Dot(axes=(1, 1), name = 'Dot33895', )([in0Dot33895,in1Dot33895])
Res63981 = keras.layers.Reshape((1, 1), name = 'Res63981', )(Dot33895)
Ave67411 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave67411', )(Res63981)
Res40828 = keras.layers.Reshape((1, 1, 1), name = 'Res40828', )(Ave67411)
Res69431 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res69431', )(Res40828)
Zer5699 = keras.layers.ZeroPadding3D(padding=((13, 0), (0, 0), (0, 0)), name = 'Zer5699', )(Res69431)
Con26565 = keras.layers.Concatenate(axis=4, name = 'Con26565', )([Zer5699,in0Con26565])
Ave56459 = keras.layers.Average(name = 'Ave56459', )([in0Ave56459,in1Ave56459])
Fla42958 = keras.layers.Flatten(name = 'Fla42958', )(Ave56459)
Res15625 = keras.layers.Reshape((8, 1), name = 'Res15625', )(Fla42958)
Res28137 = keras.layers.Reshape((8, 1, 1), name = 'Res28137', )(Res15625)
Res37979 = keras.layers.Reshape((8, 1, 1, 1), name = 'Res37979', )(Res28137)
Con25164 = keras.layers.Conv3DTranspose(2, (7, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con25164', )(Res37979)
Max79665 = keras.layers.Maximum(name = 'Max79665', )([Con26565,Con25164])
Max11387 = keras.layers.Maximum(name = 'Max11387', )([Con10717,Max79665])
model = tf.keras.models.Model(inputs=[in0Sub311,in1Sub311,in0Con10534,in0GRU68271,in0Con39813,in0Con44066,in0Con10717,in0Dot33895,in1Dot33895,in0Con26565,in0Ave56459,in1Ave56459], outputs=Max11387)
w = model.get_layer('Con10534').get_weights() 
w[0] = np.array([[[0.5505, 0.1775, 0.7356, 0.3917], [0.6202, 0.414, 0.2087, 0.2362]], [[0.9208, 0.7651, 0.3619, 0.8934], [0.5129, 0.375, 0.7749, 0.2394]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con10534').set_weights(w) 
w = model.get_layer('GRU68271').get_weights() 
w[0] = np.array([[8, 10, 9, 9, 6, 10], [10, 5, 1, 2, 8, 6]])
w[1] = np.array([[6, 7, 8, 9, 1, 3], [8, 1, 1, 3, 3, 10]])
w[2] = np.array([10, 2, 8, 5, 8, 5])
model.get_layer('GRU68271').set_weights(w) 
w = model.get_layer('LST670').get_weights() 
w[0] = np.array([[10, 3, 4, 5]])
w[1] = np.array([[3, 8, 9, 3]])
w[2] = np.array([6, 4, 1, 3])
model.get_layer('LST670').set_weights(w) 
w = model.get_layer('Con25164').get_weights() 
w[0] = np.array([[[[[0.3304], [0.5815]]]], [[[[0.8619], [0.2714]]]], [[[[0.4714], [0.8953]]]], [[[[0.1117], [0.1188]]]], [[[[0.9194], [0.7494]]]], [[[[0.9783], [0.7641]]]], [[[[0.078], [0.3834]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con25164').set_weights(w) 
in0Sub311 = tf.constant([[[[0.5686, 0.4554], [0.3731, 0.2312], [0.1677, 0.3747]], [[0.0872, 0.0145], [0.5323, 0.2821], [0.2579, 0.2832]]]])
in1Sub311 = tf.constant([[[[0.2994, 0.3214], [0.2336, 0.6413], [0.4142, 0.1565]], [[0.6548, 0.4377], [0.5493, 0.3419], [0.2337, 0.7339]]]])
in0Con10534 = tf.constant([[[0.0132, 0.6269], [0.3179, 0.0747]]])
in0GRU68271 = tf.constant([[[3, 8], [1, 8], [7, 4]]])
in0Con39813 = tf.constant([[0.3915, 0.1905, 0.0992, 0.4146, 0.6946, 0.214]])
in0Con44066 = tf.constant([[0.1072, 0.9538, 0.0233, 0.5804, 0.9977, 0.5934, 0.5293, 0.2725, 0.2365, 0.6544, 0.1669]])
in0Con10717 = tf.constant([[[[[0.7523]]], [[[0.1516]]], [[[0.2264]]], [[[0.6958]]], [[[0.0648]]], [[[0.9072]]], [[[0.2141]]], [[[0.9111]]], [[[0.1678]]], [[[0.1291]]], [[[0.5322]]], [[[0.8372]]], [[[0.9165]]], [[[0.3413]]]]])
in0Dot33895 = tf.constant([[0.6534, 0.6455, 0.9648]])
in1Dot33895 = tf.constant([[0.4312, 0.3345, 0.3276]])
in0Con26565 = tf.constant([[[[[0.2081]]], [[[0.4653]]], [[[0.0711]]], [[[0.6664]]], [[[0.1666]]], [[[0.9922]]], [[[0.6355]]], [[[0.1985]]], [[[0.4599]]], [[[0.8418]]], [[[0.9799]]], [[[0.2253]]], [[[0.3783]]], [[[0.7972]]]]])
in0Ave56459 = tf.constant([[[[0.1763, 0.9593], [0.5258, 0.8168]], [[0.1755, 0.8834], [0.0743, 0.5181]]]])
in1Ave56459 = tf.constant([[[[0.9996, 0.9865], [0.2041, 0.0277]], [[0.3696, 0.9937], [0.0106, 0.822]]]])
print (np.array2string(model.predict([in0Sub311,in1Sub311,in0Con10534,in0GRU68271,in0Con39813,in0Con44066,in0Con10717,in0Dot33895,in1Dot33895,in0Con26565,in0Ave56459,in1Ave56459],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max11387.png')

LSub311 = subtract_layer([[[[0.5686, 0.4554], [0.3731, 0.2312], [0.1677, 0.3747]], [[0.0872, 0.0145], [0.5323, 0.2821], [0.2579, 0.2832]]]], [[[[0.2994, 0.3214], [0.2336, 0.6413], [0.4142, 0.1565]], [[0.6548, 0.4377], [0.5493, 0.3419], [0.2337, 0.7339]]]], Sub311), 
LRes15695 = reshape_layer(Sub311, [2, 6], Res15695), 
LFla60178 = flatten_layer(Res15695, Fla60178), 
LCon10534 = conv1D_layer([[[0.0132, 0.6269], [0.3179, 0.0747]]], 2,[[[0.5505, 0.1775, 0.7356, 0.3917], [0.6202, 0.414, 0.2087, 0.2362]], [[0.9208, 0.7651, 0.3619, 0.8934], [0.5129, 0.375, 0.7749, 0.2394]]],[0, 0, 0, 0], 1, true, 1, Con10534), 
LFla85264 = flatten_layer(Con10534, Fla85264), 
LGRU68271 = gru_layer([[[3, 8], [1, 8], [7, 4]]],[[8, 10, 9, 9, 6, 10], [10, 5, 1, 2, 8, 6]],[[6, 7, 8, 9, 1, 3], [8, 1, 1, 3, 3, 10]],[10, 2, 8, 5, 8, 5], false, GRU68271), 
LCon39813 = concatenate_layer([GRU68271,[[0.3915, 0.1905, 0.0992, 0.4146, 0.6946, 0.214]]], 1, Con39813), 
LAve27607 = average_layer([Fla85264,Con39813], Ave27607), 
LRes29188 = reshape_layer(Ave27607, [8, 1], Res29188), 
LLST670 = lstm_layer(Res29188,[[10, 3, 4, 5]],[[3, 8, 9, 3]],[6, 4, 1, 3], LST670), 
LCon44066 = concatenate_layer([LST670,[[0.1072, 0.9538, 0.0233, 0.5804, 0.9977, 0.5934, 0.5293, 0.2725, 0.2365, 0.6544, 0.1669]]], 1, Con44066), 
LAdd36787 = add_layer([Fla60178,Con44066], Add36787), 
LRes99008 = reshape_layer(Add36787, [12, 1], Res99008), 
LRes32832 = reshape_layer(Res99008, [12, 1, 1], Res32832), 
LRes81699 = reshape_layer(Res32832, [12, 1, 1, 1], Res81699), 
LZer40725 = zero_padding3D_layer(Res81699, 2, 0, 0, 0, 0, 0, Zer40725), 
LCon10717 = concatenate_layer([Zer40725,[[[[[0.7523]]], [[[0.1516]]], [[[0.2264]]], [[[0.6958]]], [[[0.0648]]], [[[0.9072]]], [[[0.2141]]], [[[0.9111]]], [[[0.1678]]], [[[0.1291]]], [[[0.5322]]], [[[0.8372]]], [[[0.9165]]], [[[0.3413]]]]]], 4, Con10717), 
LDot33895 = dot_layer([[0.6534, 0.6455, 0.9648]], [[0.4312, 0.3345, 0.3276]], 1, 1, Dot33895), 
LRes63981 = reshape_layer(Dot33895, [1, 1], Res63981), 
LAve67411 = average_pooling1D_layer(Res63981, 1, Ave67411), 
LRes40828 = reshape_layer(Ave67411, [1, 1, 1], Res40828), 
LRes69431 = reshape_layer(Res40828, [1, 1, 1, 1], Res69431), 
LZer5699 = zero_padding3D_layer(Res69431, 13, 0, 0, 0, 0, 0, Zer5699), 
LCon26565 = concatenate_layer([Zer5699,[[[[[0.2081]]], [[[0.4653]]], [[[0.0711]]], [[[0.6664]]], [[[0.1666]]], [[[0.9922]]], [[[0.6355]]], [[[0.1985]]], [[[0.4599]]], [[[0.8418]]], [[[0.9799]]], [[[0.2253]]], [[[0.3783]]], [[[0.7972]]]]]], 4, Con26565), 
LAve56459 = average_layer([[[[[0.1763, 0.9593], [0.5258, 0.8168]], [[0.1755, 0.8834], [0.0743, 0.5181]]]], [[[[0.9996, 0.9865], [0.2041, 0.0277]], [[0.3696, 0.9937], [0.0106, 0.822]]]]], Ave56459), 
LFla42958 = flatten_layer(Ave56459, Fla42958), 
LRes15625 = reshape_layer(Fla42958, [8, 1], Res15625), 
LRes28137 = reshape_layer(Res15625, [8, 1, 1], Res28137), 
LRes37979 = reshape_layer(Res28137, [8, 1, 1, 1], Res37979), 
LCon25164 = conv3D_transpose_layer(Res37979, 7, 1, 1,[[[[[0.3304], [0.5815]]]], [[[[0.8619], [0.2714]]]], [[[[0.4714], [0.8953]]]], [[[[0.1117], [0.1188]]]], [[[[0.9194], [0.7494]]]], [[[[0.9783], [0.7641]]]], [[[[0.078], [0.3834]]]]],[0, 0], 1, 1, 1, false, Con25164), 
LMax79665 = maximum_layer([Con26565,Con25164], Max79665), 
LMax11387 = maximum_layer([Con10717,Max79665], Max11387), 
exec_layers([LSub311,LRes15695,LFla60178,LCon10534,LFla85264,LGRU68271,LCon39813,LAve27607,LRes29188,LLST670,LCon44066,LAdd36787,LRes99008,LRes32832,LRes81699,LZer40725,LCon10717,LDot33895,LRes63981,LAve67411,LRes40828,LRes69431,LZer5699,LCon26565,LAve56459,LFla42958,LRes15625,LRes28137,LRes37979,LCon25164,LMax79665,LMax11387],["Sub311","Res15695","Fla60178","Con10534","Fla85264","GRU68271","Con39813","Ave27607","Res29188","LST670","Con44066","Add36787","Res99008","Res32832","Res81699","Zer40725","Con10717","Dot33895","Res63981","Ave67411","Res40828","Res69431","Zer5699","Con26565","Ave56459","Fla42958","Res15625","Res28137","Res37979","Con25164","Max79665","Max11387"],Max11387,"Max11387")

Actual (Unparsed): [[[[[0.1942587, 0.7523000]]], [[[0.8282003, 0.7253110]]], [[[1.2681826, 1.0026551]]], [[[0.9783609, 1.2854716]]], [[[1.2752594, 1.1560165]]], [[[2.2544971, 2.2194772]]], [[[2.3317903, 1.8158909]]], [[[1.5519819, 2.2421201]]], [[[1.3944988, 0.9981688]]], [[[1.4830773, 1.6784343]]], [[[1.0533155, 0.9799000]]], [[[0.7307797, 0.8944116]]], [[[0.6786000, 0.9165000]]], [[[0.8137343, 0.7972000]]]]]

Expected (Unparsed): [[[[[0.19425868000000002,0.7523]]],[[[0.828200265,0.72531098]]],[[[1.268182590258832,1.00265512]]],[[[0.9783608800000001,1.285471635]]],[[[1.2752593849999998,1.15601646]]],[[[2.2544970749999997,2.2194772350000003]]],[[[2.3317903199999996,1.8158909099999998]]],[[[1.5519819149999998,2.242120065]]],[[[1.3944988049999998,0.9981688199999998]]],[[[1.4830772700000001,1.6784343000000002]]],[[[1.0533154799999997,0.9799]]],[[[0.730779705,0.8944115850000001]]],[[[0.6786,0.9165]]],[[[0.81373431,0.7972]]]]]

Actual:   [[[[[0.1943, 0.7523]]], [[[0.8283, 0.7254]]], [[[1.2682, 1.0027]]], [[[0.9784, 1.2855]]], [[[1.2753, 1.1561]]], [[[2.2545, 2.2195]]], [[[2.3318, 1.8159]]], [[[1.552, 2.2422]]], [[[1.3945, 0.9982]]], [[[1.4831, 1.6785]]], [[[1.0534, 0.9799]]], [[[0.7308, 0.8945]]], [[[0.6786, 0.9165]]], [[[0.8138, 0.7972]]]]]

Expected: [[[[[0.1943, 0.7523]]], [[[0.8283, 0.7254]]], [[[1.2682, 1.0027]]], [[[0.9784, 1.2855]]], [[[1.2753, 1.1561]]], [[[2.2545, 2.2195]]], [[[2.3318, 1.8159]]], [[[1.552, 2.2422]]], [[[1.3945, 0.9982]]], [[[1.4831, 1.6785]]], [[[1.0534, 0.9799]]], [[[0.7308, 0.8945]]], [[[0.6786, 0.9165]]], [[[0.8138, 0.7972]]]]]