import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul22184 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Mul22184 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Dot93439 = tf.keras.layers.Input(shape=([3]))
in1Dot93439 = tf.keras.layers.Input(shape=([3]))
in0Con68091 = tf.keras.layers.Input(shape=([3]))
in0Con44709 = tf.keras.layers.Input(shape=([2]))
in0LST76299 = tf.keras.layers.Input(shape=([3, 2]))

Mul22184 = keras.layers.Multiply(name = 'Mul22184', )([in0Mul22184,in1Mul22184])
Res53095 = keras.layers.Reshape((2, 2, 2), name = 'Res53095', )(Mul22184)
Max60326 = keras.layers.MaxPool2D(pool_size=(2, 1), strides=(2, 1), padding='same', name = 'Max60326', )(Res53095)
Res48764 = keras.layers.Reshape((1, 4), name = 'Res48764', )(Max60326)
Fla91461 = keras.layers.Flatten(name = 'Fla91461', )(Res48764)
Dot93439 = keras.layers.Dot(axes=(1, 1), name = 'Dot93439', )([in0Dot93439,in1Dot93439])
Con68091 = keras.layers.Concatenate(axis=1, name = 'Con68091', )([Dot93439,in0Con68091])
Sub18513 = keras.layers.Subtract(name = 'Sub18513', )([Fla91461,Con68091])
Res91549 = keras.layers.Reshape((4, 1), name = 'Res91549', )(Sub18513)
Res87191 = keras.layers.Reshape((4, 1, 1), name = 'Res87191', )(Res91549)
Res23468 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res23468', )(Res87191)
Cro61095 = keras.layers.Cropping3D(cropping=((3, 0), (0, 0), (0, 0)), name = 'Cro61095', )(Res23468)
Res31235 = keras.layers.Reshape((1, 1, 1), name = 'Res31235', )(Cro61095)
Res4904 = keras.layers.Reshape((1, 1), name = 'Res4904', )(Res31235)
Fla73131 = keras.layers.Flatten(name = 'Fla73131', )(Res4904)
Con44709 = keras.layers.Concatenate(axis=1, name = 'Con44709', )([Fla73131,in0Con44709])
LST76299 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST76299', )(in0LST76299)
Sub51836 = keras.layers.Subtract(name = 'Sub51836', )([Con44709,LST76299])
model = tf.keras.models.Model(inputs=[in0Mul22184,in1Mul22184,in0Dot93439,in1Dot93439,in0Con68091,in0Con44709,in0LST76299], outputs=Sub51836)
w = model.get_layer('LST76299').get_weights() 
w[0] = np.array([[4, 6, 9, 9, 7, 2, 8, 2, 10, 7, 8, 9], [3, 6, 4, 5, 4, 4, 2, 2, 5, 8, 10, 9]])
w[1] = np.array([[2, 9, 6, 10, 3, 3, 7, 6, 7, 6, 10, 3], [1, 2, 7, 1, 2, 2, 8, 3, 6, 3, 5, 4], [4, 6, 5, 7, 2, 5, 6, 8, 2, 4, 4, 5]])
w[2] = np.array([7, 8, 5, 8, 9, 6, 2, 3, 7, 5, 2, 2])
model.get_layer('LST76299').set_weights(w) 
in0Mul22184 = tf.constant([[[[[0.7684, 0.2464]], [[0.0905, 0.3225]]], [[[0.2146, 0.5978]], [[0.5496, 0.9586]]]]])
in1Mul22184 = tf.constant([[[[[0.9259, 0.4924]], [[0.3377, 0.8982]]], [[[0.987, 0.4557]], [[0.1793, 0.3595]]]]])
in0Dot93439 = tf.constant([[0.6844, 0.6484, 0.0057]])
in1Dot93439 = tf.constant([[0.5687, 0.4338, 0.6235]])
in0Con68091 = tf.constant([[0.7166, 0.4452, 0.2268]])
in0Con44709 = tf.constant([[0.2076, 0.9634]])
in0LST76299 = tf.constant([[[3, 5], [6, 3], [8, 5]]])
print (np.array2string(model.predict([in0Mul22184,in1Mul22184,in0Dot93439,in1Dot93439,in0Con68091,in0Con44709,in0LST76299],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub51836.png')

LMul22184 = multiply_layer([[[[[[0.7684, 0.2464]], [[0.0905, 0.3225]]], [[[0.2146, 0.5978]], [[0.5496, 0.9586]]]]], [[[[[0.9259, 0.4924]], [[0.3377, 0.8982]]], [[[0.987, 0.4557]], [[0.1793, 0.3595]]]]]], Mul22184), 
LRes53095 = reshape_layer(Mul22184, [2, 2, 2], Res53095), 
LMax60326 = max_pool2D_layer(Res53095, 2, 1, 2, 1, true, Max60326), 
LRes48764 = reshape_layer(Max60326, [1, 4], Res48764), 
LFla91461 = flatten_layer(Res48764, Fla91461), 
LDot93439 = dot_layer([[0.6844, 0.6484, 0.0057]], [[0.5687, 0.4338, 0.6235]], 1, 1, Dot93439), 
LCon68091 = concatenate_layer([Dot93439,[[0.7166, 0.4452, 0.2268]]], 1, Con68091), 
LSub18513 = subtract_layer(Fla91461,Con68091, Sub18513), 
LRes91549 = reshape_layer(Sub18513, [4, 1], Res91549), 
LRes87191 = reshape_layer(Res91549, [4, 1, 1], Res87191), 
LRes23468 = reshape_layer(Res87191, [4, 1, 1, 1], Res23468), 
LCro61095 = cropping3D_layer(Res23468, 3, 0, 0, 0, 0, 0, Cro61095), 
LRes31235 = reshape_layer(Cro61095, [1, 1, 1], Res31235), 
LRes4904 = reshape_layer(Res31235, [1, 1], Res4904), 
LFla73131 = flatten_layer(Res4904, Fla73131), 
LCon44709 = concatenate_layer([Fla73131,[[0.2076, 0.9634]]], 1, Con44709), 
LLST76299 = lstm_layer([[[3, 5], [6, 3], [8, 5]]],[[4, 6, 9, 9, 7, 2, 8, 2, 10, 7, 8, 9], [3, 6, 4, 5, 4, 4, 2, 2, 5, 8, 10, 9]],[[2, 9, 6, 10, 3, 3, 7, 6, 7, 6, 10, 3], [1, 2, 7, 1, 2, 2, 8, 3, 6, 3, 5, 4], [4, 6, 5, 7, 2, 5, 6, 8, 2, 4, 4, 5]],[7, 8, 5, 8, 9, 6, 2, 3, 7, 5, 2, 2], LST76299), 
LSub51836 = subtract_layer(Con44709,LST76299, Sub51836), 
exec_layers([LMul22184,LRes53095,LMax60326,LRes48764,LFla91461,LDot93439,LCon68091,LSub18513,LRes91549,LRes87191,LRes23468,LCro61095,LRes31235,LRes4904,LFla73131,LCon44709,LLST76299,LSub51836],["Mul22184","Res53095","Max60326","Res48764","Fla91461","Dot93439","Con68091","Sub18513","Res91549","Res87191","Res23468","Cro61095","Res31235","Res4904","Fla73131","Con44709","LST76299","Sub51836"],Sub51836,"Sub51836")

Actual (Unparsed): [[-0.8772381, -0.7874548, -0.0316547]]

Expected (Unparsed): [[-0.8772380536867305,-0.7874547536867305,-0.03165475368673043]]

Actual:   [[-0.8772, -0.7874, -0.0316]]

Expected: [[-0.8772, -0.7874, -0.0316]]