import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min82925 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Min82925 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))

Min82925 = keras.layers.Minimum(name = 'Min82925', )([in0Min82925,in1Min82925])
Lea12857 = keras.layers.LeakyReLU(alpha=0.6957842557749843, name = 'Lea12857', )(Min82925)
Res413 = keras.layers.Reshape((2, 2, 4), name = 'Res413', )(Lea12857)
Res86271 = keras.layers.Reshape((2, 8), name = 'Res86271', )(Res413)
Fla33182 = keras.layers.Flatten(name = 'Fla33182', )(Res86271)
Res97596 = keras.layers.Reshape((16, 1), name = 'Res97596', )(Fla33182)
Res606 = keras.layers.Reshape((16, 1, 1), name = 'Res606', )(Res97596)
Res74514 = keras.layers.Reshape((16, 1, 1, 1), name = 'Res74514', )(Res606)
Cro5285 = keras.layers.Cropping3D(cropping=((2, 9), (0, 0), (0, 0)), name = 'Cro5285', )(Res74514)
Res6555 = keras.layers.Reshape((5, 1, 1), name = 'Res6555', )(Cro5285)
Res93377 = keras.layers.Reshape((5, 1), name = 'Res93377', )(Res6555)
GRU90593 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU90593', )(Res93377)
model = tf.keras.models.Model(inputs=[in0Min82925,in1Min82925], outputs=GRU90593)
w = model.get_layer('GRU90593').get_weights() 
w[0] = np.array([[4, 7, 3]])
w[1] = np.array([[10, 1, 5]])
w[2] = np.array([6, 9, 3])
model.get_layer('GRU90593').set_weights(w) 
in0Min82925 = tf.constant([[[[[0.6671, 0.4751], [0.7093, 0.7565]], [[0.0484, 0.526], [0.8868, 0.0626]]], [[[0.5636, 0.9061], [0.9777, 0.5481]], [[0.0935, 0.4473], [0.2663, 0.4648]]]]])
in1Min82925 = tf.constant([[[[[0.1828, 0.0241], [0.4777, 0.8116]], [[0.5873, 0.5225], [0.4411, 0.8063]]], [[[0.9814, 0.0846], [0.8142, 0.6119]], [[0.1397, 0.9679], [0.3325, 0.9546]]]]])
print (np.array2string(model.predict([in0Min82925,in1Min82925],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU90593.png')

LMin82925 = minimum_layer([[[[[[0.6671, 0.4751], [0.7093, 0.7565]], [[0.0484, 0.526], [0.8868, 0.0626]]], [[[0.5636, 0.9061], [0.9777, 0.5481]], [[0.0935, 0.4473], [0.2663, 0.4648]]]]], [[[[[0.1828, 0.0241], [0.4777, 0.8116]], [[0.5873, 0.5225], [0.4411, 0.8063]]], [[[0.9814, 0.0846], [0.8142, 0.6119]], [[0.1397, 0.9679], [0.3325, 0.9546]]]]]], Min82925), 
LLea12857 = leaky_relu_layer(Min82925, 0.6957842557749843, Lea12857), 
LRes413 = reshape_layer(Lea12857, [2, 2, 4], Res413), 
LRes86271 = reshape_layer(Res413, [2, 8], Res86271), 
LFla33182 = flatten_layer(Res86271, Fla33182), 
LRes97596 = reshape_layer(Fla33182, [16, 1], Res97596), 
LRes606 = reshape_layer(Res97596, [16, 1, 1], Res606), 
LRes74514 = reshape_layer(Res606, [16, 1, 1, 1], Res74514), 
LCro5285 = cropping3D_layer(Res74514, 2, 9, 0, 0, 0, 0, Cro5285), 
LRes6555 = reshape_layer(Cro5285, [5, 1, 1], Res6555), 
LRes93377 = reshape_layer(Res6555, [5, 1], Res93377), 
LGRU90593 = gru_layer(Res93377,[[4, 7, 3]],[[10, 1, 5]],[6, 9, 3], false, GRU90593), 
exec_layers([LMin82925,LLea12857,LRes413,LRes86271,LFla33182,LRes97596,LRes606,LRes74514,LCro5285,LRes6555,LRes93377,LGRU90593],["Min82925","Lea12857","Res413","Res86271","Fla33182","Res97596","Res606","Res74514","Cro5285","Res6555","Res93377","GRU90593"],GRU90593,"GRU90593")

Actual (Unparsed): [[0.0032157]]

Expected (Unparsed): [[0.00321570807812484]]

Actual:   [[0.0033]]

Expected: [[0.0033]]