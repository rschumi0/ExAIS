import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul23649 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul23649 = tf.keras.layers.Input(shape=([2, 1]))
in0Con75373 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Mul91803 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Mul91803 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Mul5900 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Mul5900 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con68784 = tf.keras.layers.Input(shape=([2, 2, 1]))

Mul23649 = keras.layers.Multiply(name = 'Mul23649', )([in0Mul23649,in1Mul23649])
Res30678 = keras.layers.Reshape((2, 1, 1), name = 'Res30678', )(Mul23649)
Con75373 = keras.layers.Concatenate(axis=3, name = 'Con75373', )([Res30678,in0Con75373])
Mul91803 = keras.layers.Multiply(name = 'Mul91803', )([in0Mul91803,in1Mul91803])
Sep54397 = keras.layers.SeparableConv2D(2, (1, 1),strides=(1, 1), padding='same', name = 'Sep54397', )(Mul91803)
Zer90309 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer90309', )(Sep54397)
Mul5900 = keras.layers.Multiply(name = 'Mul5900', )([in0Mul5900,in1Mul5900])
Mas43561 = keras.layers.Masking(mask_value=2, name = 'Mas43561', )(Mul5900)
Con68784 = keras.layers.Concatenate(axis=3, name = 'Con68784', )([Mas43561,in0Con68784])
Sub41064 = keras.layers.Subtract(name = 'Sub41064', )([Zer90309,Con68784])
Sep37916 = keras.layers.SeparableConv2D(2, (2, 2),strides=(2, 2), padding='valid', name = 'Sep37916', )(Sub41064)
Zer38690 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer38690', )(Sep37916)
Add23673 = keras.layers.Add(name = 'Add23673', )([Con75373,Zer38690])
model = tf.keras.models.Model(inputs=[in0Mul23649,in1Mul23649,in0Con75373,in0Mul91803,in1Mul91803,in0Mul5900,in1Mul5900,in0Con68784], outputs=Add23673)
w = model.get_layer('Sep54397').get_weights() 
w[0] = np.array([[[[0.4852], [0.1146]]]])
w[1] = np.array([[[[0.2909, 0.0938], [0.4894, 0.954]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep54397').set_weights(w) 
w = model.get_layer('Sep37916').get_weights() 
w[0] = np.array([[[[0.7572], [0.3163]], [[0.9283], [0.7604]]], [[[0.1012], [0.6296]], [[0.3796], [0.816]]]])
w[1] = np.array([[[[0.0004, 0.0909], [0.6398, 0.1648]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep37916').set_weights(w) 
in0Mul23649 = tf.constant([[[0.2943], [0.957]]])
in1Mul23649 = tf.constant([[[0.119], [0.3913]]])
in0Con75373 = tf.constant([[[[0.8185]], [[0.5972]]]])
in0Mul91803 = tf.constant([[[[0.1143, 0.193]], [[0.426, 0.8859]]]])
in1Mul91803 = tf.constant([[[[0.7157, 0.2069]], [[0.8804, 0.883]]]])
in0Mul5900 = tf.constant([[[[0.8409], [0.2709]], [[0.9363], [0.8555]]]])
in1Mul5900 = tf.constant([[[[0.5322], [0.3571]], [[0.2775], [0.1737]]]])
in0Con68784 = tf.constant([[[[0.5129], [0.3474]], [[0.8459], [0.3578]]]])
print (np.array2string(model.predict([in0Mul23649,in1Mul23649,in0Con75373,in0Mul91803,in1Mul91803,in0Mul5900,in1Mul5900,in0Con68784],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add23673.png')

LMul23649 = multiply_layer([[[[0.2943], [0.957]]], [[[0.119], [0.3913]]]], Mul23649), 
LRes30678 = reshape_layer(Mul23649, [2, 1, 1], Res30678), 
LCon75373 = concatenate_layer([Res30678,[[[[0.8185]], [[0.5972]]]]], 3, Con75373), 
LMul91803 = multiply_layer([[[[[0.1143, 0.193]], [[0.426, 0.8859]]]], [[[[0.7157, 0.2069]], [[0.8804, 0.883]]]]], Mul91803), 
LSep54397 = separable_conv2D_layer(Mul91803, 1, 1,[[[[[0.4852], [0.1146]]]],[[[[0.2909, 0.0938], [0.4894, 0.954]]]]],[0, 0], 1, 1, true, Sep54397), 
LZer90309 = zero_padding2D_layer(Sep54397, 0, 0, 1, 0, Zer90309), 
LMul5900 = multiply_layer([[[[[0.8409], [0.2709]], [[0.9363], [0.8555]]]], [[[[0.5322], [0.3571]], [[0.2775], [0.1737]]]]], Mul5900), 
LMas43561 = masking_layer(Mul5900, 2, Mas43561), 
LCon68784 = concatenate_layer([Mas43561,[[[[0.5129], [0.3474]], [[0.8459], [0.3578]]]]], 3, Con68784), 
LSub41064 = subtract_layer(Zer90309,Con68784, Sub41064), 
LSep37916 = separable_conv2D_layer(Sub41064, 2, 2,[[[[[0.7572], [0.3163]], [[0.9283], [0.7604]]], [[[0.1012], [0.6296]], [[0.3796], [0.816]]]],[[[[0.0004, 0.0909], [0.6398, 0.1648]]]]],[0, 0], 2, 2, false, Sep37916), 
LZer38690 = zero_padding2D_layer(Sep37916, 1, 0, 0, 0, Zer38690), 
LAdd23673 = add_layer([Con75373,Zer38690], Add23673), 
exec_layers([LMul23649,LRes30678,LCon75373,LMul91803,LSep54397,LZer90309,LMul5900,LMas43561,LCon68784,LSub41064,LSep37916,LZer38690,LAdd23673],["Mul23649","Res30678","Con75373","Mul91803","Sep54397","Zer90309","Mul5900","Mas43561","Con68784","Sub41064","Sep37916","Zer38690","Add23673"],Add23673,"Add23673")

Actual (Unparsed): [[[[0.0350217, 0.8185000]], [[-0.3685642, 0.3638754]]]]

Expected (Unparsed): [[[[0.035021699999999996,0.8185]],[[-0.3685641663735572,0.36387540236072213]]]]

Actual:   [[[[0.0351, 0.8185]], [[-0.3685, 0.3639]]]]

Expected: [[[[0.0351, 0.8185]], [[-0.3685, 0.3639]]]]