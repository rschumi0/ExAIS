import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul2857 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Mul2857 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Fla12743 = tf.keras.layers.Input(shape=([1, 1, 4]))
in0Lay27897 = tf.keras.layers.Input(shape=([2, 3, 1]))

Mul2857 = keras.layers.Multiply(name = 'Mul2857', )([in0Mul2857,in1Mul2857])
Zer80105 = keras.layers.ZeroPadding2D(padding=((3, 0), (4, 0)), name = 'Zer80105', )(Mul2857)
Fla12743 = keras.layers.Flatten(name = 'Fla12743', )(in0Fla12743)
Res55705 = keras.layers.Reshape((4, 1), name = 'Res55705', )(Fla12743)
Res86416 = keras.layers.Reshape((4, 1, 1), name = 'Res86416', )(Res55705)
Zer41108 = keras.layers.ZeroPadding2D(padding=((0, 0), (4, 0)), name = 'Zer41108', )(Res86416)
Lay27897 = keras.layers.LayerNormalization(axis=2, epsilon=2.000225074866134, name = 'Lay27897', )(in0Lay27897)
Zer15568 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer15568', )(Lay27897)
Sub35898 = keras.layers.Subtract(name = 'Sub35898', )([Zer41108,Zer15568])
Add82455 = keras.layers.Add(name = 'Add82455', )([Zer80105,Sub35898])
model = tf.keras.models.Model(inputs=[in0Mul2857,in1Mul2857,in0Fla12743,in0Lay27897], outputs=Add82455)
in0Mul2857 = tf.constant([[[[0.857]]]])
in1Mul2857 = tf.constant([[[[0.7015]]]])
in0Fla12743 = tf.constant([[[[1.4977, 1.3934, 1.1598, 1.2631]]]])
in0Lay27897 = tf.constant([[[[1.5241], [1.6603], [1.0798]], [[1.624], [1.8246], [1.1495]]]])
print (np.array2string(model.predict([in0Mul2857,in1Mul2857,in0Fla12743,in0Lay27897],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add82455.png')

LMul2857 = multiply_layer([[[[[0.857]]]], [[[[0.7015]]]]], Mul2857), 
LZer80105 = zero_padding2D_layer(Mul2857, 3, 0, 4, 0, Zer80105), 
LFla12743 = flatten_layer([[[[1.4977, 1.3934, 1.1598, 1.2631]]]], Fla12743), 
LRes55705 = reshape_layer(Fla12743, [4, 1], Res55705), 
LRes86416 = reshape_layer(Res55705, [4, 1, 1], Res86416), 
LZer41108 = zero_padding2D_layer(Res86416, 0, 0, 4, 0, Zer41108), 
LLay27897 = layer_normalization_layer([[[[1.5241], [1.6603], [1.0798]], [[1.624], [1.8246], [1.1495]]]], 2, 2.000225074866134, Lay27897), 
LZer15568 = zero_padding2D_layer(Lay27897, 2, 0, 2, 0, Zer15568), 
LSub35898 = subtract_layer(Zer41108,Zer15568, Sub35898), 
LAdd82455 = add_layer([Zer80105,Sub35898], Add82455), 
exec_layers([LMul2857,LZer80105,LFla12743,LRes55705,LRes86416,LZer41108,LLay27897,LZer15568,LSub35898,LAdd82455],["Mul2857","Zer80105","Fla12743","Res55705","Res86416","Zer41108","Lay27897","Zer15568","Sub35898","Add82455"],Add82455,"Add82455")

Actual (Unparsed): [[[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [1.4977000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [1.3934000]], [[0.0000000], [0.0000000], [-0.0715256], [-0.1663824], [1.3977081]], [[0.0000000], [0.0000000], [-0.0632998], [-0.2023791], [2.1299644]]]]

Expected (Unparsed): [[[[0],[0],[0],[0],[1.4977]],[[0],[0],[0],[0],[1.3934]],[[0],[0],[-0.07152563143797984],[-0.16638240847646943],[1.3977080399144495]],[[0],[0],[-0.06329978996358948],[-0.2023790656119577],[2.129964355575547]]]]

Actual:   [[[[0], [0], [0], [0], [1.4977]], [[0], [0], [0], [0], [1.3934]], [[0], [0], [-0.0715], [-0.1663], [1.3978]], [[0], [0], [-0.0632], [-0.2023], [2.13]]]]

Expected: [[[[0], [0], [0], [0], [1.4977]], [[0], [0], [0], [0], [1.3934]], [[0], [0], [-0.0715], [-0.1663], [1.3978]], [[0], [0], [-0.0632], [-0.2023], [2.13]]]]