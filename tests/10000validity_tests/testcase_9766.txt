import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul39127 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Mul39127 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in0Dot51189 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot51189 = tf.keras.layers.Input(shape=([2, 3]))

Mul39127 = keras.layers.Multiply(name = 'Mul39127', )([in0Mul39127,in1Mul39127])
Res26066 = keras.layers.Reshape((1, 1, 4), name = 'Res26066', )(Mul39127)
Dot51189 = keras.layers.Dot(axes=(2, 2), name = 'Dot51189', )([in0Dot51189,in1Dot51189])
Res27598 = keras.layers.Reshape((1, 1, 4), name = 'Res27598', )(Dot51189)
Ave43858 = keras.layers.Average(name = 'Ave43858', )([Res26066,Res27598])
model = tf.keras.models.Model(inputs=[in0Mul39127,in1Mul39127,in0Dot51189,in1Dot51189], outputs=Ave43858)
in0Mul39127 = tf.constant([[[[[0.2837, 0.5671], [0.5738, 0.5724]]]]])
in1Mul39127 = tf.constant([[[[[0.4866, 0.476], [0.9821, 0.1355]]]]])
in0Dot51189 = tf.constant([[[0.4826, 0.0778, 0.8083], [0.1533, 0.6794, 0.6177]]])
in1Dot51189 = tf.constant([[[0.3752, 0.9085, 0.4003], [0.0526, 0.9652, 0.8375]]])
print (np.array2string(model.predict([in0Mul39127,in1Mul39127,in0Dot51189,in1Dot51189],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave43858.png')

LMul39127 = multiply_layer([[[[[[0.2837, 0.5671], [0.5738, 0.5724]]]]], [[[[[0.4866, 0.476], [0.9821, 0.1355]]]]]], Mul39127), 
LRes26066 = reshape_layer(Mul39127, [1, 1, 4], Res26066), 
LDot51189 = dot_layer([[[0.4826, 0.0778, 0.8083], [0.1533, 0.6794, 0.6177]]], [[[0.3752, 0.9085, 0.4003], [0.0526, 0.9652, 0.8375]]], 2, 2, Dot51189), 
LRes27598 = reshape_layer(Dot51189, [1, 1, 4], Res27598), 
LAve43858 = average_layer([Res26066,Res27598], Ave43858), 
exec_layers([LMul39127,LRes26066,LDot51189,LRes27598,LAve43858],["Mul39127","Res26066","Dot51189","Res27598","Ave43858"],Ave43858,"Ave43858")

Actual (Unparsed): [[[[0.3566819, 0.5236841, 0.7427737, 0.6293522]]]]

Expected (Unparsed): [[[[0.356681865,0.523684085,0.742773675,0.629352205]]]]

Actual:   [[[[0.3567, 0.5237, 0.7428, 0.6294]]]]

Expected: [[[[0.3567, 0.5237, 0.7428, 0.6294]]]]