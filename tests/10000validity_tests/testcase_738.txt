import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max63770 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Max63770 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con24252 = tf.keras.layers.Input(shape=([2, 4, 1, 3]))
in0Min47225 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Min47225 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Con39131 = tf.keras.layers.Input(shape=([2, 4, 1, 3]))
in0Con62646 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))

Max63770 = keras.layers.Maximum(name = 'Max63770', )([in0Max63770,in1Max63770])
Glo43710 = keras.layers.GlobalAveragePooling2D(name = 'Glo43710', )(Max63770)
Res96060 = keras.layers.Reshape((2, 1), name = 'Res96060', )(Glo43710)
Res14904 = keras.layers.Reshape((2, 1, 1), name = 'Res14904', )(Res96060)
Res79651 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res79651', )(Res14904)
Zer50596 = keras.layers.ZeroPadding3D(padding=((0, 0), (3, 0), (0, 0)), name = 'Zer50596', )(Res79651)
Con24252 = keras.layers.Concatenate(axis=4, name = 'Con24252', )([Zer50596,in0Con24252])
Min47225 = keras.layers.Minimum(name = 'Min47225', )([in0Min47225,in1Min47225])
Res14007 = keras.layers.Reshape((2, 2, 2), name = 'Res14007', )(Min47225)
Res4438 = keras.layers.Reshape((2, 4), name = 'Res4438', )(Res14007)
Max60219 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='valid', name = 'Max60219', )(Res4438)
Res33348 = keras.layers.Reshape((2, 4, 1), name = 'Res33348', )(Max60219)
Res18903 = keras.layers.Reshape((2, 4, 1, 1), name = 'Res18903', )(Res33348)
Con39131 = keras.layers.Concatenate(axis=4, name = 'Con39131', )([Res18903,in0Con39131])
Con62646 = keras.layers.Conv3D(4, (1, 1, 2),strides=(1, 1, 4), padding='valid', dilation_rate=(1, 1, 1), name = 'Con62646', )(in0Con62646)
Zer88903 = keras.layers.ZeroPadding3D(padding=((1, 0), (3, 0), (0, 0)), name = 'Zer88903', )(Con62646)
Max77005 = keras.layers.Maximum(name = 'Max77005', )([Con39131,Zer88903])
Max70741 = keras.layers.Maximum(name = 'Max70741', )([Con24252,Max77005])
model = tf.keras.models.Model(inputs=[in0Max63770,in1Max63770,in0Con24252,in0Min47225,in1Min47225,in0Con39131,in0Con62646], outputs=Max70741)
w = model.get_layer('Con62646').get_weights() 
w[0] = np.array([[[[[0.5682, 0.7243, 0.1472, 0.908], [0.3716, 0.2826, 0.5079, 0.3758]], [[0.9265, 0.8753, 0.1999, 0.2071], [0.1226, 0.5537, 0.9671, 0.1623]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con62646').set_weights(w) 
in0Max63770 = tf.constant([[[[0.5622, 0.6806]], [[0.1756, 0.2771]]]])
in1Max63770 = tf.constant([[[[0.8854, 0.5781]], [[0.7361, 0.4786]]]])
in0Con24252 = tf.constant([[[[[0.5733, 0.0691, 0.3344]], [[0.5016, 0.0037, 0.382]], [[0.2399, 0.6877, 0.8869]], [[0.2858, 0.776, 0.9673]]], [[[0.054, 0.486, 0.548]], [[0.6014, 0.5537, 0.9931]], [[0.1162, 0.7979, 0.6142]], [[0.8678, 0.2043, 0.9205]]]]])
in0Min47225 = tf.constant([[[[[0.4281, 0.4118]], [[0.6709, 0.7438]]], [[[0.7657, 0.6685]], [[0.1077, 0.8684]]]]])
in1Min47225 = tf.constant([[[[[0.2151, 0.2734]], [[0.2098, 0.3736]]], [[[0.4181, 0.1885]], [[0.7935, 0.3199]]]]])
in0Con39131 = tf.constant([[[[[0.44, 0.9988, 0.9132]], [[0.1301, 0.3851, 0.599]], [[0.4157, 0.3878, 0.1537]], [[0.5719, 0.6621, 0.2487]]], [[[0.8017, 0.5565, 0.5455]], [[0.6406, 0.4928, 0.6298]], [[0.3225, 0.4408, 0.5708]], [[0.1124, 0.5788, 0.1162]]]]])
in0Con62646 = tf.constant([[[[[0.8033, 0.1083], [0.3271, 0.6952]]]]])
print (np.array2string(model.predict([in0Max63770,in1Max63770,in0Con24252,in0Min47225,in1Min47225,in0Con39131,in0Con62646],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max70741.png')

LMax63770 = maximum_layer([[[[[0.5622, 0.6806]], [[0.1756, 0.2771]]]], [[[[0.8854, 0.5781]], [[0.7361, 0.4786]]]]], Max63770), 
LGlo43710 = global_average_pooling2D_layer(Max63770, Glo43710), 
LRes96060 = reshape_layer(Glo43710, [2, 1], Res96060), 
LRes14904 = reshape_layer(Res96060, [2, 1, 1], Res14904), 
LRes79651 = reshape_layer(Res14904, [2, 1, 1, 1], Res79651), 
LZer50596 = zero_padding3D_layer(Res79651, 0, 0, 3, 0, 0, 0, Zer50596), 
LCon24252 = concatenate_layer([Zer50596,[[[[[0.5733, 0.0691, 0.3344]], [[0.5016, 0.0037, 0.382]], [[0.2399, 0.6877, 0.8869]], [[0.2858, 0.776, 0.9673]]], [[[0.054, 0.486, 0.548]], [[0.6014, 0.5537, 0.9931]], [[0.1162, 0.7979, 0.6142]], [[0.8678, 0.2043, 0.9205]]]]]], 4, Con24252), 
LMin47225 = minimum_layer([[[[[[0.4281, 0.4118]], [[0.6709, 0.7438]]], [[[0.7657, 0.6685]], [[0.1077, 0.8684]]]]], [[[[[0.2151, 0.2734]], [[0.2098, 0.3736]]], [[[0.4181, 0.1885]], [[0.7935, 0.3199]]]]]], Min47225), 
LRes14007 = reshape_layer(Min47225, [2, 2, 2], Res14007), 
LRes4438 = reshape_layer(Res14007, [2, 4], Res4438), 
LMax60219 = max_pool1D_layer(Res4438, 1, 1, false, Max60219), 
LRes33348 = reshape_layer(Max60219, [2, 4, 1], Res33348), 
LRes18903 = reshape_layer(Res33348, [2, 4, 1, 1], Res18903), 
LCon39131 = concatenate_layer([Res18903,[[[[[0.44, 0.9988, 0.9132]], [[0.1301, 0.3851, 0.599]], [[0.4157, 0.3878, 0.1537]], [[0.5719, 0.6621, 0.2487]]], [[[0.8017, 0.5565, 0.5455]], [[0.6406, 0.4928, 0.6298]], [[0.3225, 0.4408, 0.5708]], [[0.1124, 0.5788, 0.1162]]]]]], 4, Con39131), 
LCon62646 = conv3D_layer([[[[[0.8033, 0.1083], [0.3271, 0.6952]]]]], 1, 1, 2,[[[[[0.5682, 0.7243, 0.1472, 0.908], [0.3716, 0.2826, 0.5079, 0.3758]], [[0.9265, 0.8753, 0.1999, 0.2071], [0.1226, 0.5537, 0.9671, 0.1623]]]]],[0, 0, 0, 0], 1, 1, 4, false, 1, 1, 1, Con62646), 
LZer88903 = zero_padding3D_layer(Con62646, 1, 0, 3, 0, 0, 0, Zer88903), 
LMax77005 = maximum_layer([Con39131,Zer88903], Max77005), 
LMax70741 = maximum_layer([Con24252,Max77005], Max70741), 
exec_layers([LMax63770,LGlo43710,LRes96060,LRes14904,LRes79651,LZer50596,LCon24252,LMin47225,LRes14007,LRes4438,LMax60219,LRes33348,LRes18903,LCon39131,LCon62646,LZer88903,LMax77005,LMax70741],["Max63770","Glo43710","Res96060","Res14904","Res79651","Zer50596","Con24252","Min47225","Res14007","Res4438","Max60219","Res33348","Res18903","Con39131","Con62646","Zer88903","Max77005","Max70741"],Max70741,"Max70741")

Actual (Unparsed): [[[[[0.2151000, 0.5733000, 0.9988000, 0.9132000]], [[0.2734000, 0.5016000, 0.3851000, 0.5990000]], [[0.2098000, 0.4157000, 0.6877000, 0.8869000]], [[0.8107500, 0.5719000, 0.7760000, 0.9673000]]], [[[0.4181000, 0.8017000, 0.5565000, 0.5480000]], [[0.1885000, 0.6406000, 0.5537000, 0.9931000]], [[0.1077000, 0.3225000, 0.7979000, 0.6142000]], [[0.8849690, 1.2836787, 0.9109666, 0.9506689]]]]]

Expected (Unparsed): [[[[[0.2151,0.5733,0.9988,0.9132]],[[0.2734,0.5016,0.3851,0.599]],[[0.2098,0.4157,0.6877,0.8869]],[[0.81075,0.5719,0.776,0.9673]]],[[[0.4181,0.8017,0.5565,0.548]],[[0.1885,0.6406,0.5537,0.9931]],[[0.1077,0.3225,0.7979,0.6142]],[[0.8849690100000001,1.28367864,0.91096654,0.9506689100000001]]]]]

Actual:   [[[[[0.2151, 0.5733, 0.9988, 0.9132]], [[0.2734, 0.5016, 0.3851, 0.599]], [[0.2098, 0.4157, 0.6877, 0.8869]], [[0.8108, 0.5719, 0.776, 0.9673]]], [[[0.4181, 0.8017, 0.5565, 0.548]], [[0.1885, 0.6406, 0.5537, 0.9931]], [[0.1077, 0.3225, 0.7979, 0.6142]], [[0.885, 1.2837, 0.911, 0.9507]]]]]

Expected: [[[[[0.2151, 0.5733, 0.9988, 0.9132]], [[0.2734, 0.5016, 0.3851, 0.599]], [[0.2098, 0.4157, 0.6877, 0.8869]], [[0.8108, 0.5719, 0.776, 0.9673]]], [[[0.4181, 0.8017, 0.5565, 0.548]], [[0.1885, 0.6406, 0.5537, 0.9931]], [[0.1077, 0.3225, 0.7979, 0.6142]], [[0.885, 1.2837, 0.911, 0.9507]]]]]