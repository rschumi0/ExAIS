import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot51682 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot51682 = tf.keras.layers.Input(shape=([3, 3]))
in0Max59469 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Max59469 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))

Dot51682 = keras.layers.Dot(axes=(2, 2), name = 'Dot51682', )([in0Dot51682,in1Dot51682])
Max59469 = keras.layers.Maximum(name = 'Max59469', )([in0Max59469,in1Max59469])
Res37226 = keras.layers.Reshape((1, 2, 2), name = 'Res37226', )(Max59469)
Res62670 = keras.layers.Reshape((1, 4), name = 'Res62670', )(Res37226)
Zer6835 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer6835', )(Res62670)
Dot43632 = keras.layers.Dot(axes=(1, 1), name = 'Dot43632', )([Dot51682,Zer6835])
Ave92229 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave92229', )(Dot43632)
model = tf.keras.models.Model(inputs=[in0Dot51682,in1Dot51682,in0Max59469,in1Max59469], outputs=Ave92229)
in0Dot51682 = tf.constant([[[0.4859, 0.6097, 0.6482], [0.8151, 0.5936, 0.9918], [0.382, 0.3292, 0.6164]]])
in1Dot51682 = tf.constant([[[0.1231, 0.304, 0.3291], [0.6677, 0.4583, 0.2275], [0.2154, 0.9288, 0.2733]]])
in0Max59469 = tf.constant([[[[[0.8307, 0.645]], [[0.2694, 0.8882]]]]])
in1Max59469 = tf.constant([[[[[0.8884, 0.0971]], [[0.1501, 0.4661]]]]])
print (np.array2string(model.predict([in0Dot51682,in1Dot51682,in0Max59469,in1Max59469],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave92229.png')

LDot51682 = dot_layer([[[0.4859, 0.6097, 0.6482], [0.8151, 0.5936, 0.9918], [0.382, 0.3292, 0.6164]]], [[[0.1231, 0.304, 0.3291], [0.6677, 0.4583, 0.2275], [0.2154, 0.9288, 0.2733]]], 2, 2, Dot51682), 
LMax59469 = maximum_layer([[[[[[0.8307, 0.645]], [[0.2694, 0.8882]]]]], [[[[[0.8884, 0.0971]], [[0.1501, 0.4661]]]]]], Max59469), 
LRes37226 = reshape_layer(Max59469, [1, 2, 2], Res37226), 
LRes62670 = reshape_layer(Res37226, [1, 4], Res62670), 
LZer6835 = zero_padding1D_layer(Res62670, 2, 0, Zer6835), 
LDot43632 = dot_layer(Dot51682,Zer6835, 1, 1, Dot43632), 
LAve92229 = average_pooling1D_layer(Dot43632, 1, Ave92229), 
exec_layers([LDot51682,LMax59469,LRes37226,LRes62670,LZer6835,LDot43632,LAve92229],["Dot51682","Max59469","Res37226","Res62670","Zer6835","Dot43632","Ave92229"],Ave92229,"Ave92229")

Actual (Unparsed): [[[0.3109029, 0.2257231, 0.0942788, 0.3108329], [0.4852128, 0.3522763, 0.1471368, 0.4851035], [0.4943998, 0.3589463, 0.1499227, 0.4942885]]]

Expected (Unparsed): [[[0.310902900416,0.22572306479999998,0.09427874985599999,0.31083290876799996],[0.48521277278399993,0.35227627019999996,0.14713678634399996,0.48510353983199994],[0.49439982379199987,0.35894629259999994,0.14992268407199996,0.4942885226159999]]]

Actual:   [[[0.311, 0.2258, 0.0943, 0.3109], [0.4853, 0.3523, 0.1472, 0.4852], [0.4944, 0.359, 0.15, 0.4943]]]

Expected: [[[0.311, 0.2258, 0.0943, 0.3109], [0.4853, 0.3523, 0.1472, 0.4852], [0.4944, 0.359, 0.15, 0.4943]]]