import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul68560 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul68560 = tf.keras.layers.Input(shape=([1, 1]))
in0Max94294 = tf.keras.layers.Input(shape=([2, 2]))
in1Max94294 = tf.keras.layers.Input(shape=([2, 2]))

Mul68560 = keras.layers.Multiply(name = 'Mul68560', )([in0Mul68560,in1Mul68560])
Fla11965 = keras.layers.Flatten(name = 'Fla11965', )(Mul68560)
Max94294 = keras.layers.Maximum(name = 'Max94294', )([in0Max94294,in1Max94294])
Res87278 = keras.layers.Reshape((2, 2, 1), name = 'Res87278', )(Max94294)
Res44109 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res44109', )(Res87278)
Glo66321 = keras.layers.GlobalMaxPool3D(name = 'Glo66321', )(Res44109)
Ave73310 = keras.layers.Average(name = 'Ave73310', )([Fla11965,Glo66321])
model = tf.keras.models.Model(inputs=[in0Mul68560,in1Mul68560,in0Max94294,in1Max94294], outputs=Ave73310)
in0Mul68560 = tf.constant([[[0.4109]]])
in1Mul68560 = tf.constant([[[0.2689]]])
in0Max94294 = tf.constant([[[0.9609, 0.3138], [0.3388, 0.7382]]])
in1Max94294 = tf.constant([[[0.0465, 0.3734], [0.7523, 0.3203]]])
print (np.array2string(model.predict([in0Mul68560,in1Mul68560,in0Max94294,in1Max94294],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave73310.png')

LMul68560 = multiply_layer([[[[0.4109]]], [[[0.2689]]]], Mul68560), 
LFla11965 = flatten_layer(Mul68560, Fla11965), 
LMax94294 = maximum_layer([[[[0.9609, 0.3138], [0.3388, 0.7382]]], [[[0.0465, 0.3734], [0.7523, 0.3203]]]], Max94294), 
LRes87278 = reshape_layer(Max94294, [2, 2, 1], Res87278), 
LRes44109 = reshape_layer(Res87278, [2, 2, 1, 1], Res44109), 
LGlo66321 = global_max_pool3D_layer(Res44109, Glo66321), 
LAve73310 = average_layer([Fla11965,Glo66321], Ave73310), 
exec_layers([LMul68560,LFla11965,LMax94294,LRes87278,LRes44109,LGlo66321,LAve73310],["Mul68560","Fla11965","Max94294","Res87278","Res44109","Glo66321","Ave73310"],Ave73310,"Ave73310")

Actual (Unparsed): [[0.5356955]]

Expected (Unparsed): [[0.535695505]]

Actual:   [[0.5357]]

Expected: [[0.5357]]