import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Cro84911 = tf.keras.layers.Input(shape=([3, 1]))
in0Con85036 = tf.keras.layers.Input(shape=([1]))
in0Sub90357 = tf.keras.layers.Input(shape=([2]))
in1Sub90357 = tf.keras.layers.Input(shape=([2]))
in0Dot81503 = tf.keras.layers.Input(shape=([2]))
in1Dot81503 = tf.keras.layers.Input(shape=([2]))

Cro84911 = keras.layers.Cropping1D(cropping=((2, 0)), name = 'Cro84911', )(in0Cro84911)
Per91615 = keras.layers.Permute((1,2), name = 'Per91615',)(Cro84911)
Fla62087 = keras.layers.Flatten(name = 'Fla62087', )(Per91615)
Con85036 = keras.layers.Concatenate(axis=1, name = 'Con85036', )([Fla62087,in0Con85036])
Sub90357 = keras.layers.Subtract(name = 'Sub90357', )([in0Sub90357,in1Sub90357])
Min68256 = keras.layers.Minimum(name = 'Min68256', )([Con85036,Sub90357])
Res85921 = keras.layers.Reshape((2, 1), name = 'Res85921', )(Min68256)
Res72027 = keras.layers.Reshape((2, 1, 1), name = 'Res72027', )(Res85921)
Res26347 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res26347', )(Res72027)
Glo92617 = keras.layers.GlobalMaxPool3D(name = 'Glo92617', )(Res26347)
Res17853 = keras.layers.Reshape((1, 1), name = 'Res17853', )(Glo92617)
Res84442 = keras.layers.Reshape((1, 1, 1), name = 'Res84442', )(Res17853)
Res74366 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res74366', )(Res84442)
Dot81503 = keras.layers.Dot(axes=(1, 1), name = 'Dot81503', )([in0Dot81503,in1Dot81503])
Res35598 = keras.layers.Reshape((1, 1), name = 'Res35598', )(Dot81503)
Res89142 = keras.layers.Reshape((1, 1, 1), name = 'Res89142', )(Res35598)
Res94347 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res94347', )(Res89142)
Cro6128 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro6128', )(Res94347)
Ave17608 = keras.layers.Average(name = 'Ave17608', )([Res74366,Cro6128])
model = tf.keras.models.Model(inputs=[in0Cro84911,in0Con85036,in0Sub90357,in1Sub90357,in0Dot81503,in1Dot81503], outputs=Ave17608)
in0Cro84911 = tf.constant([[[1.0104], [1.3855], [1.6198]]])
in0Con85036 = tf.constant([[0.1184]])
in0Sub90357 = tf.constant([[0.8805, 0.3992]])
in1Sub90357 = tf.constant([[0.7909, 0.1107]])
in0Dot81503 = tf.constant([[0.4595, 0.6491]])
in1Dot81503 = tf.constant([[0.0378, 0.5053]])
print (np.array2string(model.predict([in0Cro84911,in0Con85036,in0Sub90357,in1Sub90357,in0Dot81503,in1Dot81503],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave17608.png')

LCro84911 = cropping1D_layer([[[1.0104], [1.3855], [1.6198]]], 2, 0, Cro84911), 
LPer91615 = permute_layer(Cro84911, 1,2, Per91615), 
LFla62087 = flatten_layer(Per91615, Fla62087), 
LCon85036 = concatenate_layer([Fla62087,[[0.1184]]], 1, Con85036), 
LSub90357 = subtract_layer([[0.8805, 0.3992]], [[0.7909, 0.1107]], Sub90357), 
LMin68256 = minimum_layer([Con85036,Sub90357], Min68256), 
LRes85921 = reshape_layer(Min68256, [2, 1], Res85921), 
LRes72027 = reshape_layer(Res85921, [2, 1, 1], Res72027), 
LRes26347 = reshape_layer(Res72027, [2, 1, 1, 1], Res26347), 
LGlo92617 = global_max_pool3D_layer(Res26347, Glo92617), 
LRes17853 = reshape_layer(Glo92617, [1, 1], Res17853), 
LRes84442 = reshape_layer(Res17853, [1, 1, 1], Res84442), 
LRes74366 = reshape_layer(Res84442, [1, 1, 1, 1], Res74366), 
LDot81503 = dot_layer([[0.4595, 0.6491]], [[0.0378, 0.5053]], 1, 1, Dot81503), 
LRes35598 = reshape_layer(Dot81503, [1, 1], Res35598), 
LRes89142 = reshape_layer(Res35598, [1, 1, 1], Res89142), 
LRes94347 = reshape_layer(Res89142, [1, 1, 1, 1], Res94347), 
LCro6128 = cropping3D_layer(Res94347, 0, 0, 0, 0, 0, 0, Cro6128), 
LAve17608 = average_layer([Res74366,Cro6128], Ave17608), 
exec_layers([LCro84911,LPer91615,LFla62087,LCon85036,LSub90357,LMin68256,LRes85921,LRes72027,LRes26347,LGlo92617,LRes17853,LRes84442,LRes74366,LDot81503,LRes35598,LRes89142,LRes94347,LCro6128,LAve17608],["Cro84911","Per91615","Fla62087","Con85036","Sub90357","Min68256","Res85921","Res72027","Res26347","Glo92617","Res17853","Res84442","Res74366","Dot81503","Res35598","Res89142","Res94347","Cro6128","Ave17608"],Ave17608,"Ave17608")

Actual (Unparsed): [[[[[0.2318797]]]]]

Expected (Unparsed): [[[[[0.231879665]]]]]

Actual:   [[[[[0.2319]]]]]

Expected: [[[[[0.2319]]]]]