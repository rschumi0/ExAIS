import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave58961 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Ave58961 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Con69132 = tf.keras.layers.Input(shape=([21]))
in0Con14283 = tf.keras.layers.Input(shape=([1, 1, 1]))

Ave58961 = keras.layers.Average(name = 'Ave58961', )([in0Ave58961,in1Ave58961])
Res88723 = keras.layers.Reshape((2, 1, 2), name = 'Res88723', )(Ave58961)
Res47687 = keras.layers.Reshape((2, 2), name = 'Res47687', )(Res88723)
Res97968 = keras.layers.Reshape((2, 2, 1), name = 'Res97968', )(Res47687)
Res16002 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res16002', )(Res97968)
Cro79718 = keras.layers.Cropping3D(cropping=((1, 0), (1, 0), (0, 0)), name = 'Cro79718', )(Res16002)
Res61459 = keras.layers.Reshape((1, 1, 1), name = 'Res61459', )(Cro79718)
Dep77472 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='valid', name = 'Dep77472', )(Res61459)
Res38202 = keras.layers.Reshape((1, 1), name = 'Res38202', )(Dep77472)
Fla2928 = keras.layers.Flatten(name = 'Fla2928', )(Res38202)
Con69132 = keras.layers.Concatenate(axis=1, name = 'Con69132', )([Fla2928,in0Con69132])
Con14283 = keras.layers.Conv2DTranspose(2, (1, 1),strides=(11, 1), padding='valid', name = 'Con14283', )(in0Con14283)
Res52407 = keras.layers.Reshape((11, 2), name = 'Res52407', )(Con14283)
Fla38002 = keras.layers.Flatten(name = 'Fla38002', )(Res52407)
Fla69520 = keras.layers.Flatten(name = 'Fla69520', )(Fla38002)
Ave12051 = keras.layers.Average(name = 'Ave12051', )([Con69132,Fla69520])
model = tf.keras.models.Model(inputs=[in0Ave58961,in1Ave58961,in0Con69132,in0Con14283], outputs=Ave12051)
w = model.get_layer('Dep77472').get_weights() 
w[0] = np.array([[[[0.6901]]]])
w[1] = np.array([0])
model.get_layer('Dep77472').set_weights(w) 
w = model.get_layer('Con14283').get_weights() 
w[0] = np.array([[[[0.3346], [0.8418]]]])
w[1] = np.array([0, 0])
model.get_layer('Con14283').set_weights(w) 
in0Ave58961 = tf.constant([[[[[0.2994, 0.289]]], [[[0.8554, 0.8243]]]]])
in1Ave58961 = tf.constant([[[[[0.9198, 0.513]]], [[[0.5513, 0.6456]]]]])
in0Con69132 = tf.constant([[0.9079, 0.2715, 0.7698, 0.0752, 0.888, 0.6738, 0.7861, 0.1612, 0.6091, 0.7191, 0.7864, 0.5021, 0.6236, 0.038, 0.2301, 0.9963, 0.9184, 0.5033, 0.4514, 0.5879, 0.8032]])
in0Con14283 = tf.constant([[[[0.8173]]]])
print (np.array2string(model.predict([in0Ave58961,in1Ave58961,in0Con69132,in0Con14283],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave12051.png')

LAve58961 = average_layer([[[[[[0.2994, 0.289]]], [[[0.8554, 0.8243]]]]], [[[[[0.9198, 0.513]]], [[[0.5513, 0.6456]]]]]], Ave58961), 
LRes88723 = reshape_layer(Ave58961, [2, 1, 2], Res88723), 
LRes47687 = reshape_layer(Res88723, [2, 2], Res47687), 
LRes97968 = reshape_layer(Res47687, [2, 2, 1], Res97968), 
LRes16002 = reshape_layer(Res97968, [2, 2, 1, 1], Res16002), 
LCro79718 = cropping3D_layer(Res16002, 1, 0, 1, 0, 0, 0, Cro79718), 
LRes61459 = reshape_layer(Cro79718, [1, 1, 1], Res61459), 
LDep77472 = depthwise_conv2D_layer(Res61459, 1, 1,[[[[0.6901]]]],[0], 1, 1, false, Dep77472), 
LRes38202 = reshape_layer(Dep77472, [1, 1], Res38202), 
LFla2928 = flatten_layer(Res38202, Fla2928), 
LCon69132 = concatenate_layer([Fla2928,[[0.9079, 0.2715, 0.7698, 0.0752, 0.888, 0.6738, 0.7861, 0.1612, 0.6091, 0.7191, 0.7864, 0.5021, 0.6236, 0.038, 0.2301, 0.9963, 0.9184, 0.5033, 0.4514, 0.5879, 0.8032]]], 1, Con69132), 
LCon14283 = conv2D_transpose_layer([[[[0.8173]]]], 1, 1,[[[[0.3346], [0.8418]]]],[0, 0], 11, 1, false, Con14283), 
LRes52407 = reshape_layer(Con14283, [11, 2], Res52407), 
LFla38002 = flatten_layer(Res52407, Fla38002), 
LFla69520 = flatten_layer(Fla38002, Fla69520), 
LAve12051 = average_layer([Con69132,Fla69520], Ave12051), 
exec_layers([LAve58961,LRes88723,LRes47687,LRes97968,LRes16002,LCro79718,LRes61459,LDep77472,LRes38202,LFla2928,LCon69132,LCon14283,LRes52407,LFla38002,LFla69520,LAve12051],["Ave58961","Res88723","Res47687","Res97968","Res16002","Cro79718","Res61459","Dep77472","Res38202","Fla2928","Con69132","Con14283","Res52407","Fla38002","Fla69520","Ave12051"],Ave12051,"Ave12051")

Actual (Unparsed): [[0.3903288, 0.7979516, 0.1357500, 0.3849000, 0.0376000, 0.4440000, 0.3369000, 0.3930500, 0.0806000, 0.3045500, 0.3595500, 0.3932000, 0.2510500, 0.3118000, 0.0190000, 0.1150500, 0.4981500, 0.4592000, 0.2516500, 0.2257000, 0.2939500, 0.4016000]]

Expected (Unparsed): [[0.3903287875,0.79795157,0.13575,0.3849,0.0376,0.444,0.3369,0.39305,0.0806,0.30455,0.35955,0.3932,0.25105,0.3118,0.019,0.11505,0.49815,0.4592,0.25165,0.2257,0.29395,0.4016]]

Actual:   [[0.3904, 0.798, 0.1358, 0.3849, 0.0376, 0.444, 0.3369, 0.3931, 0.0806, 0.3046, 0.3596, 0.3932, 0.2511, 0.3118, 0.019, 0.1151, 0.4982, 0.4592, 0.2517, 0.2257, 0.294, 0.4016]]

Expected: [[0.3904, 0.798, 0.1358, 0.3849, 0.0376, 0.444, 0.3369, 0.3931, 0.0806, 0.3046, 0.3596, 0.3932, 0.2511, 0.3118, 0.019, 0.1151, 0.4982, 0.4592, 0.2517, 0.2257, 0.294, 0.4016]]