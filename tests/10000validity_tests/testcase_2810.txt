import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add55155 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in1Add55155 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in0Add73832 = tf.keras.layers.Input(shape=([1, 2]))
in1Add73832 = tf.keras.layers.Input(shape=([1, 2]))
in0Dot60667 = tf.keras.layers.Input(shape=([3]))
in1Dot60667 = tf.keras.layers.Input(shape=([3]))
in0Con20443 = tf.keras.layers.Input(shape=([1]))
in0Con20648 = tf.keras.layers.Input(shape=([2, 2, 3]))
in0Mul16531 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Mul16531 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))

Add55155 = keras.layers.Add(name = 'Add55155', )([in0Add55155,in1Add55155])
Res92135 = keras.layers.Reshape((2, 1, 4), name = 'Res92135', )(Add55155)
Zer95413 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer95413', )(Res92135)
Add73832 = keras.layers.Add(name = 'Add73832', )([in0Add73832,in1Add73832])
Fla87601 = keras.layers.Flatten(name = 'Fla87601', )(Add73832)
Dot60667 = keras.layers.Dot(axes=(1, 1), name = 'Dot60667', )([in0Dot60667,in1Dot60667])
Con20443 = keras.layers.Concatenate(axis=1, name = 'Con20443', )([Dot60667,in0Con20443])
Sub92336 = keras.layers.Subtract(name = 'Sub92336', )([Fla87601,Con20443])
Res79884 = keras.layers.Reshape((2, 1), name = 'Res79884', )(Sub92336)
Res62461 = keras.layers.Reshape((2, 1, 1), name = 'Res62461', )(Res79884)
Zer81301 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer81301', )(Res62461)
Con20648 = keras.layers.Concatenate(axis=3, name = 'Con20648', )([Zer81301,in0Con20648])
Mul16531 = keras.layers.Multiply(name = 'Mul16531', )([in0Mul16531,in1Mul16531])
Res28588 = keras.layers.Reshape((2, 2, 4), name = 'Res28588', )(Mul16531)
PRe73252 = keras.layers.PReLU(name = 'PRe73252', )(Res28588)
Add70663 = keras.layers.Add(name = 'Add70663', )([Con20648,PRe73252])
Max95351 = keras.layers.Maximum(name = 'Max95351', )([Zer95413,Add70663])
model = tf.keras.models.Model(inputs=[in0Add55155,in1Add55155,in0Add73832,in1Add73832,in0Dot60667,in1Dot60667,in0Con20443,in0Con20648,in0Mul16531,in1Mul16531], outputs=Max95351)
w = model.get_layer('PRe73252').get_weights() 
w[0] = np.array([[[0.493, 0.368, 0.0583, 0.5322], [0.348, 0.212, 0.2829, 0.9144]], [[0.7685, 0.9994, 0.3109, 0.2077], [0.8031, 0.8227, 0.5387, 0.5535]]])
model.get_layer('PRe73252').set_weights(w) 
in0Add55155 = tf.constant([[[[[0.7979, 0.2093], [0.9717, 0.4638]]], [[[0.1559, 0.1329], [0.0362, 0.5862]]]]])
in1Add55155 = tf.constant([[[[[0.0752, 0.0177], [0.1909, 0.2121]]], [[[0.7772, 0.9485], [0.6836, 0.2471]]]]])
in0Add73832 = tf.constant([[[0.1848, 0.753]]])
in1Add73832 = tf.constant([[[0.1919, 0.3547]]])
in0Dot60667 = tf.constant([[0.3534, 0.3984, 0.2037]])
in1Dot60667 = tf.constant([[0.0414, 0.915, 0.7797]])
in0Con20443 = tf.constant([[0.4876]])
in0Con20648 = tf.constant([[[[0.6318, 0.2506, 0.3768], [0.7235, 0.82, 0.4095]], [[0.3423, 0.7282, 0.5838], [0.1716, 0.6473, 0.5263]]]])
in0Mul16531 = tf.constant([[[[[0.3392, 0.6045], [0.0684, 0.6414]], [[0.9541, 0.2719], [0.4821, 0.3401]]], [[[0.2689, 0.0356], [0.7156, 0.7792]], [[0.0904, 0.0013], [0.4083, 0.1239]]]]])
in1Mul16531 = tf.constant([[[[[0.9137, 0.5624], [0.5411, 0.8395]], [[0.8232, 0.342], [0.5292, 0.1865]]], [[[0.1463, 0.6391], [0.7722, 0.5554]], [[0.2578, 0.0706], [0.5564, 0.9224]]]]])
print (np.array2string(model.predict([in0Add55155,in1Add55155,in0Add73832,in1Add73832,in0Dot60667,in1Dot60667,in0Con20443,in0Con20648,in0Mul16531,in1Mul16531],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max95351.png')

LAdd55155 = add_layer([[[[[[0.7979, 0.2093], [0.9717, 0.4638]]], [[[0.1559, 0.1329], [0.0362, 0.5862]]]]], [[[[[0.0752, 0.0177], [0.1909, 0.2121]]], [[[0.7772, 0.9485], [0.6836, 0.2471]]]]]], Add55155), 
LRes92135 = reshape_layer(Add55155, [2, 1, 4], Res92135), 
LZer95413 = zero_padding2D_layer(Res92135, 0, 0, 1, 0, Zer95413), 
LAdd73832 = add_layer([[[[0.1848, 0.753]]], [[[0.1919, 0.3547]]]], Add73832), 
LFla87601 = flatten_layer(Add73832, Fla87601), 
LDot60667 = dot_layer([[0.3534, 0.3984, 0.2037]], [[0.0414, 0.915, 0.7797]], 1, 1, Dot60667), 
LCon20443 = concatenate_layer([Dot60667,[[0.4876]]], 1, Con20443), 
LSub92336 = subtract_layer(Fla87601,Con20443, Sub92336), 
LRes79884 = reshape_layer(Sub92336, [2, 1], Res79884), 
LRes62461 = reshape_layer(Res79884, [2, 1, 1], Res62461), 
LZer81301 = zero_padding2D_layer(Res62461, 0, 0, 1, 0, Zer81301), 
LCon20648 = concatenate_layer([Zer81301,[[[[0.6318, 0.2506, 0.3768], [0.7235, 0.82, 0.4095]], [[0.3423, 0.7282, 0.5838], [0.1716, 0.6473, 0.5263]]]]], 3, Con20648), 
LMul16531 = multiply_layer([[[[[[0.3392, 0.6045], [0.0684, 0.6414]], [[0.9541, 0.2719], [0.4821, 0.3401]]], [[[0.2689, 0.0356], [0.7156, 0.7792]], [[0.0904, 0.0013], [0.4083, 0.1239]]]]], [[[[[0.9137, 0.5624], [0.5411, 0.8395]], [[0.8232, 0.342], [0.5292, 0.1865]]], [[[0.1463, 0.6391], [0.7722, 0.5554]], [[0.2578, 0.0706], [0.5564, 0.9224]]]]]], Mul16531), 
LRes28588 = reshape_layer(Mul16531, [2, 2, 4], Res28588), 
LPRe73252 = prelu_layer(Res28588, [[[0.493, 0.368, 0.0583, 0.5322], [0.348, 0.212, 0.2829, 0.9144]], [[0.7685, 0.9994, 0.3109, 0.2077], [0.8031, 0.8227, 0.5387, 0.5535]]], PRe73252), 
LAdd70663 = add_layer([Con20648,PRe73252], Add70663), 
LMax95351 = maximum_layer([Zer95413,Add70663], Max95351), 
exec_layers([LAdd55155,LRes92135,LZer95413,LAdd73832,LFla87601,LDot60667,LCon20443,LSub92336,LRes79884,LRes62461,LZer81301,LCon20648,LMul16531,LRes28588,LPRe73252,LAdd70663,LMax95351],["Add55155","Res92135","Zer95413","Add73832","Fla87601","Dot60667","Con20443","Sub92336","Res79884","Res62461","Zer81301","Con20648","Mul16531","Res28588","PRe73252","Add70663","Max95351"],Max95351,"Max95351")

Actual (Unparsed): [[[[0.3099270, 0.9717708, 0.2876113, 0.9152553], [0.8731000, 0.8164898, 1.1626000, 0.6759000]], [[0.0393401, 0.3650520, 1.2807863, 1.0165677], [0.9331000, 1.0814000, 0.8744781, 0.8333000]]]]

Expected (Unparsed): [[[[0.30992704,0.9717708,0.28761124,0.9152553],[0.8731000000000001,0.8164898,1.1626,0.6759]],[[0.03934007,0.36505196,1.2807863199999998,1.01656768],[0.9331,1.0814,0.87447812,0.8333]]]]

Actual:   [[[[0.31, 0.9718, 0.2877, 0.9153], [0.8731, 0.8165, 1.1626, 0.6759]], [[0.0394, 0.3651, 1.2808, 1.0166], [0.9331, 1.0814, 0.8745, 0.8333]]]]

Expected: [[[[0.31, 0.9718, 0.2877, 0.9153], [0.8732, 0.8165, 1.1626, 0.6759]], [[0.0394, 0.3651, 1.2808, 1.0166], [0.9331, 1.0814, 0.8745, 0.8333]]]]