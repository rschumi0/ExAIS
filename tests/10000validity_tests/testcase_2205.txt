import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo80846 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Con23661 = tf.keras.layers.Input(shape=([12, 1, 1, 3]))
in0Max72214 = tf.keras.layers.Input(shape=([1, 1]))
in1Max72214 = tf.keras.layers.Input(shape=([1, 1]))
in0Mul13826 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul13826 = tf.keras.layers.Input(shape=([1, 1]))
in0Con27498 = tf.keras.layers.Input(shape=([12, 1]))

Glo80846 = keras.layers.GlobalMaxPool3D(name = 'Glo80846', )(in0Glo80846)
Res98538 = keras.layers.Reshape((1, 1), name = 'Res98538', )(Glo80846)
Res13836 = keras.layers.Reshape((1, 1, 1), name = 'Res13836', )(Res98538)
Res41881 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res41881', )(Res13836)
Zer17885 = keras.layers.ZeroPadding3D(padding=((11, 0), (0, 0), (0, 0)), name = 'Zer17885', )(Res41881)
Con23661 = keras.layers.Concatenate(axis=4, name = 'Con23661', )([Zer17885,in0Con23661])
Max72214 = keras.layers.Maximum(name = 'Max72214', )([in0Max72214,in1Max72214])
Res86914 = keras.layers.Reshape((1, 1, 1), name = 'Res86914', )(Max72214)
Res79305 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res79305', )(Res86914)
Con70518 = keras.layers.Conv3DTranspose(4, (1, 1, 1),strides=(12, 1, 1), padding='valid', name = 'Con70518', )(Res79305)
Add41435 = keras.layers.Add(name = 'Add41435', )([Con23661,Con70518])
Res42265 = keras.layers.Reshape((12, 1, 4), name = 'Res42265', )(Add41435)
Res55524 = keras.layers.Reshape((12, 4), name = 'Res55524', )(Res42265)
Mul13826 = keras.layers.Multiply(name = 'Mul13826', )([in0Mul13826,in1Mul13826])
Zer26810 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer26810', )(Mul13826)
Loc2600 = keras.layers.LocallyConnected1D(3, (2),strides=(1), name = 'Loc2600', )(Zer26810)
Zer59238 = keras.layers.ZeroPadding1D(padding=((11, 0)), name = 'Zer59238', )(Loc2600)
Con27498 = keras.layers.Concatenate(axis=2, name = 'Con27498', )([Zer59238,in0Con27498])
Min23706 = keras.layers.Minimum(name = 'Min23706', )([Res55524,Con27498])
model = tf.keras.models.Model(inputs=[in0Glo80846,in0Con23661,in0Max72214,in1Max72214,in0Mul13826,in1Mul13826,in0Con27498], outputs=Min23706)
w = model.get_layer('Con70518').get_weights() 
w[0] = np.array([[[[[0.2881], [0.8989], [0.2637], [0.9052]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con70518').set_weights(w) 
w = model.get_layer('Loc2600').get_weights() 
w[0] = np.array([[[0.5612, 0.7147, 0.2172], [0.2902, 0.1622, 0.8188]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc2600').set_weights(w) 
in0Glo80846 = tf.constant([[[[[1.7907], [1.9741]], [[1.5263], [1.8354]]], [[[1.8185], [1.2691]], [[1.3799], [1.2597]]]]])
in0Con23661 = tf.constant([[[[[0.0846, 0.5276, 0.4974]]], [[[0.7883, 0.8376, 0.9308]]], [[[0.8748, 0.4039, 0.6702]]], [[[0.6742, 0.9396, 0.903]]], [[[0.7668, 0.5782, 0.9663]]], [[[0.1634, 0.1683, 0.0963]]], [[[0.7925, 0.6806, 0.6236]]], [[[0.5229, 0.8006, 0.2085]]], [[[0.9634, 0.2518, 0.8282]]], [[[0.9361, 0.0205, 0.2522]]], [[[0.0024, 0.5936, 0.9757]]], [[[0.3589, 0.804, 0.8867]]]]])
in0Max72214 = tf.constant([[[0.4177]]])
in1Max72214 = tf.constant([[[0.4386]]])
in0Mul13826 = tf.constant([[[0.159]]])
in1Mul13826 = tf.constant([[[0.1605]]])
in0Con27498 = tf.constant([[[0.1395], [0.0571], [0.4454], [0.463], [0.6477], [0.97], [0.5522], [0.6064], [0.2146], [0.0706], [0.6167], [0.9256]]])
print (np.array2string(model.predict([in0Glo80846,in0Con23661,in0Max72214,in1Max72214,in0Mul13826,in1Mul13826,in0Con27498],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min23706.png')

LGlo80846 = global_max_pool3D_layer([[[[[1.7907], [1.9741]], [[1.5263], [1.8354]]], [[[1.8185], [1.2691]], [[1.3799], [1.2597]]]]], Glo80846), 
LRes98538 = reshape_layer(Glo80846, [1, 1], Res98538), 
LRes13836 = reshape_layer(Res98538, [1, 1, 1], Res13836), 
LRes41881 = reshape_layer(Res13836, [1, 1, 1, 1], Res41881), 
LZer17885 = zero_padding3D_layer(Res41881, 11, 0, 0, 0, 0, 0, Zer17885), 
LCon23661 = concatenate_layer([Zer17885,[[[[[0.0846, 0.5276, 0.4974]]], [[[0.7883, 0.8376, 0.9308]]], [[[0.8748, 0.4039, 0.6702]]], [[[0.6742, 0.9396, 0.903]]], [[[0.7668, 0.5782, 0.9663]]], [[[0.1634, 0.1683, 0.0963]]], [[[0.7925, 0.6806, 0.6236]]], [[[0.5229, 0.8006, 0.2085]]], [[[0.9634, 0.2518, 0.8282]]], [[[0.9361, 0.0205, 0.2522]]], [[[0.0024, 0.5936, 0.9757]]], [[[0.3589, 0.804, 0.8867]]]]]], 4, Con23661), 
LMax72214 = maximum_layer([[[[0.4177]]], [[[0.4386]]]], Max72214), 
LRes86914 = reshape_layer(Max72214, [1, 1, 1], Res86914), 
LRes79305 = reshape_layer(Res86914, [1, 1, 1, 1], Res79305), 
LCon70518 = conv3D_transpose_layer(Res79305, 1, 1, 1,[[[[[0.2881], [0.8989], [0.2637], [0.9052]]]]],[0, 0, 0, 0], 12, 1, 1, false, Con70518), 
LAdd41435 = add_layer([Con23661,Con70518], Add41435), 
LRes42265 = reshape_layer(Add41435, [12, 1, 4], Res42265), 
LRes55524 = reshape_layer(Res42265, [12, 4], Res55524), 
LMul13826 = multiply_layer([[[[0.159]]], [[[0.1605]]]], Mul13826), 
LZer26810 = zero_padding1D_layer(Mul13826, 1, 0, Zer26810), 
LLoc2600 = locally_connected1D_layer(Zer26810, 2,[[[0.5612, 0.7147, 0.2172], [0.2902, 0.1622, 0.8188]]],[[0, 0, 0]], 1, Loc2600), 
LZer59238 = zero_padding1D_layer(Loc2600, 11, 0, Zer59238), 
LCon27498 = concatenate_layer([Zer59238,[[[0.1395], [0.0571], [0.4454], [0.463], [0.6477], [0.97], [0.5522], [0.6064], [0.2146], [0.0706], [0.6167], [0.9256]]]], 2, Con27498), 
LMin23706 = minimum_layer([Res55524,Con27498], Min23706), 
exec_layers([LGlo80846,LRes98538,LRes13836,LRes41881,LZer17885,LCon23661,LMax72214,LRes86914,LRes79305,LCon70518,LAdd41435,LRes42265,LRes55524,LMul13826,LZer26810,LLoc2600,LZer59238,LCon27498,LMin23706],["Glo80846","Res98538","Res13836","Res41881","Zer17885","Con23661","Max72214","Res86914","Res79305","Con70518","Add41435","Res42265","Res55524","Mul13826","Zer26810","Loc2600","Zer59238","Con27498","Min23706"],Min23706,"Min23706")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.1395000], [0.0000000, 0.0000000, 0.0000000, 0.0571000], [0.0000000, 0.0000000, 0.0000000, 0.4454000], [0.0000000, 0.0000000, 0.0000000, 0.4630000], [0.0000000, 0.0000000, 0.0000000, 0.6477000], [0.0000000, 0.0000000, 0.0000000, 0.0963000], [0.0000000, 0.0000000, 0.0000000, 0.5522000], [0.0000000, 0.0000000, 0.0000000, 0.2085000], [0.0000000, 0.0000000, 0.0000000, 0.2146000], [0.0000000, 0.0000000, 0.0000000, 0.0706000], [0.0000000, 0.0000000, 0.0000000, 0.6167000], [0.0074058, 0.0041393, 0.0208954, 0.8867000]]]

Expected (Unparsed): [[[0,0,0,0.1395],[0,0,0,0.0571],[0,0,0,0.4454],[0,0,0,0.463],[0,0,0,0.6477],[0,0,0,0.0963],[0,0,0,0.5522],[0,0,0,0.2085],[0,0,0,0.2146],[0,0,0,0.0706],[0,0,0,0.6167],[0.007405758900000001,0.0041392629,0.0208953666,0.8867]]]

Actual:   [[[0, 0, 0, 0.1395], [0, 0, 0, 0.0571], [0, 0, 0, 0.4454], [0, 0, 0, 0.463], [0, 0, 0, 0.6477], [0, 0, 0, 0.0963], [0, 0, 0, 0.5522], [0, 0, 0, 0.2085], [0, 0, 0, 0.2146], [0, 0, 0, 0.0706], [0, 0, 0, 0.6167], [0.0075, 0.0042, 0.0209, 0.8867]]]

Expected: [[[0, 0, 0, 0.1395], [0, 0, 0, 0.0571], [0, 0, 0, 0.4454], [0, 0, 0, 0.463], [0, 0, 0, 0.6477], [0, 0, 0, 0.0963], [0, 0, 0, 0.5522], [0, 0, 0, 0.2085], [0, 0, 0, 0.2146], [0, 0, 0, 0.0706], [0, 0, 0, 0.6167], [0.0075, 0.0042, 0.0209, 0.8867]]]