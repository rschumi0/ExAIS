import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con54021 = tf.keras.layers.Input(shape=([2, 2]))
in0Max95502 = tf.keras.layers.Input(shape=([1, 1]))
in1Max95502 = tf.keras.layers.Input(shape=([1, 1]))
in0Sim13131 = tf.keras.layers.Input(shape=([2, 2]))
in0Con88270 = tf.keras.layers.Input(shape=([3]))

Con54021 = keras.layers.Conv1D(2, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con54021', )(in0Con54021)
Res94318 = keras.layers.Reshape((2, 2, 1), name = 'Res94318', )(Con54021)
Res32851 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res32851', )(Res94318)
Cro69224 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro69224', )(Res32851)
Res41424 = keras.layers.Reshape((2, 2, 1), name = 'Res41424', )(Cro69224)
Ave46733 = keras.layers.AveragePooling2D(pool_size=(2, 1), strides=(12, 11), padding='same', name = 'Ave46733', )(Res41424)
Res43193 = keras.layers.Reshape((1, 1), name = 'Res43193', )(Ave46733)
Max95502 = keras.layers.Maximum(name = 'Max95502', )([in0Max95502,in1Max95502])
Res73082 = keras.layers.Reshape((1, 1, 1), name = 'Res73082', )(Max95502)
Sep7684 = keras.layers.SeparableConv2D(4, (1, 1),strides=(1, 1), padding='valid', name = 'Sep7684', )(Res73082)
Res95773 = keras.layers.Reshape((1, 4), name = 'Res95773', )(Sep7684)
Fla23661 = keras.layers.Flatten(name = 'Fla23661', )(Res95773)
Sim13131 = keras.layers.SimpleRNN(1,name = 'Sim13131', )(in0Sim13131)
Con88270 = keras.layers.Concatenate(axis=1, name = 'Con88270', )([Sim13131,in0Con88270])
Sub36412 = keras.layers.Subtract(name = 'Sub36412', )([Fla23661,Con88270])
Res26328 = keras.layers.Reshape((4, 1), name = 'Res26328', )(Sub36412)
Res29039 = keras.layers.Reshape((4, 1, 1), name = 'Res29039', )(Res26328)
Res71882 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res71882', )(Res29039)
Glo88465 = keras.layers.GlobalMaxPool3D(name = 'Glo88465', )(Res71882)
Res48139 = keras.layers.Reshape((1, 1), name = 'Res48139', )(Glo88465)
Sub43826 = keras.layers.Subtract(name = 'Sub43826', )([Res43193,Res48139])
model = tf.keras.models.Model(inputs=[in0Con54021,in0Max95502,in1Max95502,in0Sim13131,in0Con88270], outputs=Sub43826)
w = model.get_layer('Con54021').get_weights() 
w[0] = np.array([[[0.657, 0.0395], [0.3945, 0.4459]]])
w[1] = np.array([0, 0])
model.get_layer('Con54021').set_weights(w) 
w = model.get_layer('Sep7684').get_weights() 
w[0] = np.array([[[[0.0516]]]])
w[1] = np.array([[[[0.8745, 0.8969, 0.5454, 0.3043]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep7684').set_weights(w) 
w = model.get_layer('Sim13131').get_weights() 
w[0] = np.array([[4], [10]])
w[1] = np.array([[7]])
w[2] = np.array([7])
model.get_layer('Sim13131').set_weights(w) 
in0Con54021 = tf.constant([[[0.3916, 0.8821], [0.3464, 0.7043]]])
in0Max95502 = tf.constant([[[0.1865]]])
in1Max95502 = tf.constant([[[0.0255]]])
in0Sim13131 = tf.constant([[[3, 9], [10, 7]]])
in0Con88270 = tf.constant([[0.2147, 0.7632, 0.275]])
print (np.array2string(model.predict([in0Con54021,in0Max95502,in1Max95502,in0Sim13131,in0Con88270],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub43826.png')

LCon54021 = conv1D_layer([[[0.3916, 0.8821], [0.3464, 0.7043]]], 1,[[[0.657, 0.0395], [0.3945, 0.4459]]],[0, 0], 1, false, 1, Con54021), 
LRes94318 = reshape_layer(Con54021, [2, 2, 1], Res94318), 
LRes32851 = reshape_layer(Res94318, [2, 2, 1, 1], Res32851), 
LCro69224 = cropping3D_layer(Res32851, 0, 0, 0, 0, 0, 0, Cro69224), 
LRes41424 = reshape_layer(Cro69224, [2, 2, 1], Res41424), 
LAve46733 = average_pooling2D_layer(Res41424, 2, 1, 12, 11, true, Ave46733), 
LRes43193 = reshape_layer(Ave46733, [1, 1], Res43193), 
LMax95502 = maximum_layer([[[[0.1865]]], [[[0.0255]]]], Max95502), 
LRes73082 = reshape_layer(Max95502, [1, 1, 1], Res73082), 
LSep7684 = separable_conv2D_layer(Res73082, 1, 1,[[[[[0.0516]]]],[[[[0.8745, 0.8969, 0.5454, 0.3043]]]]],[0, 0, 0, 0], 1, 1, false, Sep7684), 
LRes95773 = reshape_layer(Sep7684, [1, 4], Res95773), 
LFla23661 = flatten_layer(Res95773, Fla23661), 
LSim13131 = simple_rnn_layer([[[3, 9], [10, 7]]],[[4], [10]],[[7]],[7], Sim13131), 
LCon88270 = concatenate_layer([Sim13131,[[0.2147, 0.7632, 0.275]]], 1, Con88270), 
LSub36412 = subtract_layer(Fla23661,Con88270, Sub36412), 
LRes26328 = reshape_layer(Sub36412, [4, 1], Res26328), 
LRes29039 = reshape_layer(Res26328, [4, 1, 1], Res29039), 
LRes71882 = reshape_layer(Res29039, [4, 1, 1, 1], Res71882), 
LGlo88465 = global_max_pool3D_layer(Res71882, Glo88465), 
LRes48139 = reshape_layer(Glo88465, [1, 1], Res48139), 
LSub43826 = subtract_layer(Res43193,Res48139, Sub43826), 
exec_layers([LCon54021,LRes94318,LRes32851,LCro69224,LRes41424,LAve46733,LRes43193,LMax95502,LRes73082,LSep7684,LRes95773,LFla23661,LSim13131,LCon88270,LSub36412,LRes26328,LRes29039,LRes71882,LGlo88465,LRes48139,LSub43826],["Con54021","Res94318","Res32851","Cro69224","Res41424","Ave46733","Res43193","Max95502","Res73082","Sep7684","Res95773","Fla23661","Sim13131","Con88270","Sub36412","Res26328","Res29039","Res71882","Glo88465","Res48139","Sub43826"],Sub43826,"Sub43826")

Actual (Unparsed): [[[0.7614192]]]

Expected (Unparsed): [[[0.76141917254]]]

Actual:   [[[0.7615]]]

Expected: [[[0.7615]]]