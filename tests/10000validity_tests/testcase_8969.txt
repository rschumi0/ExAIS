import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave60466 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave60466 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con64803 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Dep90274 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con54082 = tf.keras.layers.Input(shape=([2, 2]))
in0Con18624 = tf.keras.layers.Input(shape=([1, 1]))
in0Sep42119 = tf.keras.layers.Input(shape=([1, 2]))

Ave60466 = keras.layers.Average(name = 'Ave60466', )([in0Ave60466,in1Ave60466])
Con64803 = keras.layers.Concatenate(axis=3, name = 'Con64803', )([Ave60466,in0Con64803])
Dep90274 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='valid', name = 'Dep90274', )(in0Dep90274)
Zer22411 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer22411', )(Dep90274)
Mul16717 = keras.layers.Multiply(name = 'Mul16717', )([Con64803,Zer22411])
Con54082 = keras.layers.Conv1D(2, (2),strides=(1), padding='valid', dilation_rate=(1), name = 'Con54082', )(in0Con54082)
Con18624 = keras.layers.Concatenate(axis=2, name = 'Con18624', )([Con54082,in0Con18624])
Sep42119 = keras.layers.SeparableConv1D(3, (1),strides=(1), padding='valid', name = 'Sep42119', )(in0Sep42119)
Add38493 = keras.layers.Add(name = 'Add38493', )([Con18624,Sep42119])
Res64699 = keras.layers.Reshape((1, 3, 1), name = 'Res64699', )(Add38493)
Con24896 = keras.layers.Conv2D(2, (1, 3),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con24896', )(Res64699)
Zer30358 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer30358', )(Con24896)
Ave99366 = keras.layers.Average(name = 'Ave99366', )([Mul16717,Zer30358])
model = tf.keras.models.Model(inputs=[in0Ave60466,in1Ave60466,in0Con64803,in0Dep90274,in0Con54082,in0Con18624,in0Sep42119], outputs=Ave99366)
w = model.get_layer('Dep90274').get_weights() 
w[0] = np.array([[[[0.5227], [0.712]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep90274').set_weights(w) 
w = model.get_layer('Con54082').get_weights() 
w[0] = np.array([[[0.2128, 0.9344], [0.9973, 0.6004]], [[0.5012, 0.1074], [0.1859, 0.5791]]])
w[1] = np.array([0, 0])
model.get_layer('Con54082').set_weights(w) 
w = model.get_layer('Sep42119').get_weights() 
w[0] = np.array([[[0.1191], [0.0725]]])
w[1] = np.array([[[0.7953, 0.2842, 0.1018], [0.6075, 0.4566, 0.9391]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep42119').set_weights(w) 
w = model.get_layer('Con24896').get_weights() 
w[0] = np.array([[[[0.6191, 0.9734]], [[0.8215, 0.6894]], [[0.9063, 0.8247]]]])
w[1] = np.array([0, 0])
model.get_layer('Con24896').set_weights(w) 
in0Ave60466 = tf.constant([[[[0.413], [0.942]], [[0.1116], [0.9128]]]])
in1Ave60466 = tf.constant([[[[0.1169], [0.1922]], [[0.9901], [0.0387]]]])
in0Con64803 = tf.constant([[[[0.99], [0.7744]], [[0.1053], [0.8079]]]])
in0Dep90274 = tf.constant([[[[0.8272, 0.7514]]]])
in0Con54082 = tf.constant([[[0.4719, 0.819], [0.5446, 0.1862]]])
in0Con18624 = tf.constant([[[0.8608]]])
in0Sep42119 = tf.constant([[[0.1522, 0.8944]]])
print (np.array2string(model.predict([in0Ave60466,in1Ave60466,in0Con64803,in0Dep90274,in0Con54082,in0Con18624,in0Sep42119],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave99366.png')

LAve60466 = average_layer([[[[[0.413], [0.942]], [[0.1116], [0.9128]]]], [[[[0.1169], [0.1922]], [[0.9901], [0.0387]]]]], Ave60466), 
LCon64803 = concatenate_layer([Ave60466,[[[[0.99], [0.7744]], [[0.1053], [0.8079]]]]], 3, Con64803), 
LDep90274 = depthwise_conv2D_layer([[[[0.8272, 0.7514]]]], 1, 1,[[[[0.5227], [0.712]]]],[0, 0], 1, 1, false, Dep90274), 
LZer22411 = zero_padding2D_layer(Dep90274, 1, 0, 1, 0, Zer22411), 
LMul16717 = multiply_layer([Con64803,Zer22411], Mul16717), 
LCon54082 = conv1D_layer([[[0.4719, 0.819], [0.5446, 0.1862]]], 2,[[[0.2128, 0.9344], [0.9973, 0.6004]], [[0.5012, 0.1074], [0.1859, 0.5791]]],[0, 0], 1, false, 1, Con54082), 
LCon18624 = concatenate_layer([Con54082,[[[0.8608]]]], 2, Con18624), 
LSep42119 = separable_conv1D_layer([[[0.1522, 0.8944]]], 1,[[[[0.1191], [0.0725]]],[[[0.7953, 0.2842, 0.1018], [0.6075, 0.4566, 0.9391]]]],[0, 0, 0], 1, false, Sep42119), 
LAdd38493 = add_layer([Con18624,Sep42119], Add38493), 
LRes64699 = reshape_layer(Add38493, [1, 3, 1], Res64699), 
LCon24896 = conv2D_layer(Res64699, 1, 3,[[[[0.6191, 0.9734]], [[0.8215, 0.6894]], [[0.9063, 0.8247]]]],[0, 0], 1, 1, false, 1, 1, Con24896), 
LZer30358 = zero_padding2D_layer(Con24896, 1, 0, 1, 0, Zer30358), 
LAve99366 = average_layer([Mul16717,Zer30358], Ave99366), 
exec_layers([LAve60466,LCon64803,LDep90274,LZer22411,LMul16717,LCon54082,LCon18624,LSep42119,LAdd38493,LRes64699,LCon24896,LZer30358,LAve99366],["Ave60466","Con64803","Dep90274","Zer22411","Mul16717","Con54082","Con18624","Sep42119","Add38493","Res64699","Con24896","Zer30358","Ave99366"],Ave99366,"Ave99366")

Actual (Unparsed): [[[[0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [1.3828278, 1.6100250]]]]

Expected (Unparsed): [[[[0.0,0.0],[0.0,0.0]],[[0.0,0.0],[1.3828278204753237,1.6100249921930494]]]]

Actual:   [[[[0, 0], [0, 0]], [[0, 0], [1.3829, 1.6101]]]]

Expected: [[[[0, 0], [0, 0]], [[0, 0], [1.3829, 1.6101]]]]