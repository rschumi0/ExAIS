import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul29711 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Mul29711 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))

Mul29711 = keras.layers.Multiply(name = 'Mul29711', )([in0Mul29711,in1Mul29711])
Bat70927 = keras.layers.BatchNormalization(axis=1, epsilon=0.4854864466883646,  name = 'Bat70927', )(Mul29711)
Res49208 = keras.layers.Reshape((1, 2, 1), name = 'Res49208', )(Bat70927)
Res32805 = keras.layers.Reshape((1, 2), name = 'Res32805', )(Res49208)
LST96972 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST96972', )(Res32805)
model = tf.keras.models.Model(inputs=[in0Mul29711,in1Mul29711], outputs=LST96972)
w = model.get_layer('Bat70927').get_weights() 
w[0] = np.array([0.3357])
w[1] = np.array([0.4369])
w[2] = np.array([0.001])
w[3] = np.array([0.7164])
model.get_layer('Bat70927').set_weights(w) 
w = model.get_layer('LST96972').get_weights() 
w[0] = np.array([[10, 7, 2, 1, 7, 5, 7, 1, 2, 6, 3, 10], [1, 9, 3, 5, 7, 2, 4, 8, 4, 8, 3, 3]])
w[1] = np.array([[6, 9, 1, 5, 3, 1, 7, 2, 5, 10, 5, 1], [5, 3, 5, 1, 6, 4, 3, 4, 6, 2, 2, 5], [8, 4, 4, 1, 5, 8, 5, 4, 3, 6, 6, 6]])
w[2] = np.array([7, 3, 4, 4, 1, 7, 10, 4, 3, 7, 2, 2])
model.get_layer('LST96972').set_weights(w) 
in0Mul29711 = tf.constant([[[[[0.9844]], [[0.8802]]]]])
in1Mul29711 = tf.constant([[[[[0.65]], [[0.9203]]]]])
print (np.array2string(model.predict([in0Mul29711,in1Mul29711],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST96972.png')

LMul29711 = multiply_layer([[[[[[0.9844]], [[0.8802]]]]], [[[[[0.65]], [[0.9203]]]]]], Mul29711), 
LBat70927 = batch_normalization_layer(Mul29711, 1, 0.4854864466883646, [0.3357], [0.4369], [0.001], [0.7164], Bat70927), 
LRes49208 = reshape_layer(Bat70927, [1, 2, 1], Res49208), 
LRes32805 = reshape_layer(Res49208, [1, 2], Res32805), 
LLST96972 = lstm_layer(Res32805,[[10, 7, 2, 1, 7, 5, 7, 1, 2, 6, 3, 10], [1, 9, 3, 5, 7, 2, 4, 8, 4, 8, 3, 3]],[[6, 9, 1, 5, 3, 1, 7, 2, 5, 10, 5, 1], [5, 3, 5, 1, 6, 4, 3, 4, 6, 2, 2, 5], [8, 4, 4, 1, 5, 8, 5, 4, 3, 6, 6, 6]],[7, 3, 4, 4, 1, 7, 10, 4, 3, 7, 2, 2], LST96972), 
exec_layers([LMul29711,LBat70927,LRes49208,LRes32805,LLST96972],["Mul29711","Bat70927","Res49208","Res32805","LST96972"],LST96972,"LST96972")

Actual (Unparsed): [[0.7615937, 0.7596171, 0.7612915]]

Expected (Unparsed): [[0.761593744894545,0.7596171391542994,0.7612914721700527]]

Actual:   [[0.7616, 0.7597, 0.7613]]

Expected: [[0.7616, 0.7597, 0.7613]]