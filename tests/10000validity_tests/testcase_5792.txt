import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Up_57032 = tf.keras.layers.Input(shape=([3, 4, 1]))
in0Add64146 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Add64146 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0LST81956 = tf.keras.layers.Input(shape=([1, 2]))
in0Add1379 = tf.keras.layers.Input(shape=([2, 1]))
in1Add1379 = tf.keras.layers.Input(shape=([2, 1]))
in0Con45573 = tf.keras.layers.Input(shape=([2, 1]))

Up_57032 = keras.layers.UpSampling2D(size=(1, 1), name = 'Up_57032', )(in0Up_57032)
Res66512 = keras.layers.Reshape((3, 4, 1, 1), name = 'Res66512', )(Up_57032)
Glo41645 = keras.layers.GlobalMaxPool3D(name = 'Glo41645', )(Res66512)
Res39391 = keras.layers.Reshape((1, 1), name = 'Res39391', )(Glo41645)
Add64146 = keras.layers.Add(name = 'Add64146', )([in0Add64146,in1Add64146])
Res34353 = keras.layers.Reshape((2, 4), name = 'Res34353', )(Add64146)
Cro9442 = keras.layers.Cropping1D(cropping=((1, 0)), name = 'Cro9442', )(Res34353)
Dot60358 = keras.layers.Dot(axes=(2, 1), name = 'Dot60358', )([Res39391,Cro9442])
Zer3923 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer3923', )(Dot60358)
LST81956 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST81956', )(in0LST81956)
Res82630 = keras.layers.Reshape((2, 1), name = 'Res82630', )(LST81956)
Sep67798 = keras.layers.SeparableConv1D(2, (2),strides=(2), padding='same', name = 'Sep67798', )(Res82630)
Mas73190 = keras.layers.Masking(mask_value=2, name = 'Mas73190', )(Sep67798)
Zer12101 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer12101', )(Mas73190)
Add1379 = keras.layers.Add(name = 'Add1379', )([in0Add1379,in1Add1379])
Con45573 = keras.layers.Concatenate(axis=2, name = 'Con45573', )([Add1379,in0Con45573])
Mul32553 = keras.layers.Multiply(name = 'Mul32553', )([Zer12101,Con45573])
Dot76911 = keras.layers.Dot(axes=(1, 1), name = 'Dot76911', )([Zer3923,Mul32553])
model = tf.keras.models.Model(inputs=[in0Up_57032,in0Add64146,in1Add64146,in0LST81956,in0Add1379,in1Add1379,in0Con45573], outputs=Dot76911)
w = model.get_layer('LST81956').get_weights() 
w[0] = np.array([[6, 2, 10, 2, 2, 1, 1, 6], [4, 4, 4, 8, 1, 7, 2, 8]])
w[1] = np.array([[10, 8, 2, 2, 6, 1, 2, 4], [6, 8, 7, 3, 4, 9, 8, 7]])
w[2] = np.array([8, 9, 8, 5, 2, 8, 3, 7])
model.get_layer('LST81956').set_weights(w) 
w = model.get_layer('Sep67798').get_weights() 
w[0] = np.array([[[0.1067]], [[0.4628]]])
w[1] = np.array([[[0.6077, 0.4784]]])
w[2] = np.array([0, 0])
model.get_layer('Sep67798').set_weights(w) 
in0Up_57032 = tf.constant([[[[1.5666], [1.8849], [1.1226], [1.2263]], [[1.4536], [1.8687], [1.0064], [1.2241]], [[1.1297], [1.1391], [1.417], [1.4752]]]])
in0Add64146 = tf.constant([[[[0.1485, 0.4249], [0.3547, 0.9307]], [[0.1301, 0.1469], [0.4897, 0.728]]]])
in1Add64146 = tf.constant([[[[0.95, 0.7623], [0.1176, 0.7714]], [[0.4473, 0.4347], [0.3889, 0.6057]]]])
in0LST81956 = tf.constant([[[4, 7]]])
in0Add1379 = tf.constant([[[0.9948], [0.0197]]])
in1Add1379 = tf.constant([[[0.2825], [0.7118]]])
in0Con45573 = tf.constant([[[0.3658], [0.8257]]])
print (np.array2string(model.predict([in0Up_57032,in0Add64146,in1Add64146,in0LST81956,in0Add1379,in1Add1379,in0Con45573],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot76911.png')

LUp_57032 = up_sampling2D_layer([[[[1.5666], [1.8849], [1.1226], [1.2263]], [[1.4536], [1.8687], [1.0064], [1.2241]], [[1.1297], [1.1391], [1.417], [1.4752]]]], 1, 1, Up_57032), 
LRes66512 = reshape_layer(Up_57032, [3, 4, 1, 1], Res66512), 
LGlo41645 = global_max_pool3D_layer(Res66512, Glo41645), 
LRes39391 = reshape_layer(Glo41645, [1, 1], Res39391), 
LAdd64146 = add_layer([[[[[0.1485, 0.4249], [0.3547, 0.9307]], [[0.1301, 0.1469], [0.4897, 0.728]]]], [[[[0.95, 0.7623], [0.1176, 0.7714]], [[0.4473, 0.4347], [0.3889, 0.6057]]]]], Add64146), 
LRes34353 = reshape_layer(Add64146, [2, 4], Res34353), 
LCro9442 = cropping1D_layer(Res34353, 1, 0, Cro9442), 
LDot60358 = dot_layer(Res39391,Cro9442, 2, 1, Dot60358), 
LZer3923 = zero_padding1D_layer(Dot60358, 1, 0, Zer3923), 
LLST81956 = lstm_layer([[[4, 7]]],[[6, 2, 10, 2, 2, 1, 1, 6], [4, 4, 4, 8, 1, 7, 2, 8]],[[10, 8, 2, 2, 6, 1, 2, 4], [6, 8, 7, 3, 4, 9, 8, 7]],[8, 9, 8, 5, 2, 8, 3, 7], LST81956), 
LRes82630 = reshape_layer(LST81956, [2, 1], Res82630), 
LSep67798 = separable_conv1D_layer(Res82630, 2,[[[[0.1067]], [[0.4628]]],[[[0.6077, 0.4784]]]],[0, 0], 2, true, Sep67798), 
LMas73190 = masking_layer(Sep67798, 2, Mas73190), 
LZer12101 = zero_padding1D_layer(Mas73190, 1, 0, Zer12101), 
LAdd1379 = add_layer([[[[0.9948], [0.0197]]], [[[0.2825], [0.7118]]]], Add1379), 
LCon45573 = concatenate_layer([Add1379,[[[0.3658], [0.8257]]]], 2, Con45573), 
LMul32553 = multiply_layer([Zer12101,Con45573], Mul32553), 
LDot76911 = dot_layer(Zer3923,Mul32553, 1, 1, Dot76911), 
exec_layers([LUp_57032,LRes66512,LGlo41645,LRes39391,LAdd64146,LRes34353,LCro9442,LDot60358,LZer3923,LLST81956,LRes82630,LSep67798,LMas73190,LZer12101,LAdd1379,LCon45573,LMul32553,LDot76911],["Up_57032","Res66512","Glo41645","Res39391","Add64146","Res34353","Cro9442","Dot60358","Zer3923","LST81956","Res82630","Sep67798","Mas73190","Zer12101","Add1379","Con45573","Mul32553","Dot76911"],Dot76911,"Dot76911")

Actual (Unparsed): [[[0.2098389, 0.1864644], [0.2113653, 0.1878207], [0.3193011, 0.2837333], [0.4846937, 0.4307023]]]

Expected (Unparsed): [[[0.20983889566818195,0.18646437969885313],[0.2113652610332779,0.1878207191424541],[0.3193010975650584,0.2837332940828064],[0.4846936874829482,0.4307023609358511]]]

Actual:   [[[0.2099, 0.1865], [0.2114, 0.1879], [0.3194, 0.2838], [0.4847, 0.4308]]]

Expected: [[[0.2099, 0.1865], [0.2114, 0.1879], [0.3194, 0.2838], [0.4847, 0.4308]]]