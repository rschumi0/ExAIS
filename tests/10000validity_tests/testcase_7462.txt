import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul6575 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul6575 = tf.keras.layers.Input(shape=([2, 1]))
in0Con76710 = tf.keras.layers.Input(shape=([1, 1]))
in0Add69752 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Add69752 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))

Mul6575 = keras.layers.Multiply(name = 'Mul6575', )([in0Mul6575,in1Mul6575])
Sim80510 = keras.layers.SimpleRNN(1,name = 'Sim80510', )(Mul6575)
Res87232 = keras.layers.Reshape((1, 1), name = 'Res87232', )(Sim80510)
Con76710 = keras.layers.Concatenate(axis=2, name = 'Con76710', )([Res87232,in0Con76710])
Add69752 = keras.layers.Add(name = 'Add69752', )([in0Add69752,in1Add69752])
Res4802 = keras.layers.Reshape((1, 1, 1), name = 'Res4802', )(Add69752)
Res70082 = keras.layers.Reshape((1, 1), name = 'Res70082', )(Res4802)
Loc65450 = keras.layers.LocallyConnected1D(2, (1),strides=(1), name = 'Loc65450', )(Res70082)
Max43326 = keras.layers.Maximum(name = 'Max43326', )([Con76710,Loc65450])
model = tf.keras.models.Model(inputs=[in0Mul6575,in1Mul6575,in0Con76710,in0Add69752,in1Add69752], outputs=Max43326)
w = model.get_layer('Sim80510').get_weights() 
w[0] = np.array([[2]])
w[1] = np.array([[9]])
w[2] = np.array([9])
model.get_layer('Sim80510').set_weights(w) 
w = model.get_layer('Loc65450').get_weights() 
w[0] = np.array([[[0.3602, 0.8462]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc65450').set_weights(w) 
in0Mul6575 = tf.constant([[[0.143], [0.6895]]])
in1Mul6575 = tf.constant([[[0.2298], [0.2564]]])
in0Con76710 = tf.constant([[[0.1448]]])
in0Add69752 = tf.constant([[[[[0.5519]]]]])
in1Add69752 = tf.constant([[[[[0.6877]]]]])
print (np.array2string(model.predict([in0Mul6575,in1Mul6575,in0Con76710,in0Add69752,in1Add69752],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max43326.png')

LMul6575 = multiply_layer([[[[0.143], [0.6895]]], [[[0.2298], [0.2564]]]], Mul6575), 
LSim80510 = simple_rnn_layer(Mul6575,[[2]],[[9]],[9], Sim80510), 
LRes87232 = reshape_layer(Sim80510, [1, 1], Res87232), 
LCon76710 = concatenate_layer([Res87232,[[[0.1448]]]], 2, Con76710), 
LAdd69752 = add_layer([[[[[[0.5519]]]]], [[[[[0.6877]]]]]], Add69752), 
LRes4802 = reshape_layer(Add69752, [1, 1, 1], Res4802), 
LRes70082 = reshape_layer(Res4802, [1, 1], Res70082), 
LLoc65450 = locally_connected1D_layer(Res70082, 1,[[[0.3602, 0.8462]]],[[0, 0]], 1, Loc65450), 
LMax43326 = maximum_layer([Con76710,Loc65450], Max43326), 
exec_layers([LMul6575,LSim80510,LRes87232,LCon76710,LAdd69752,LRes4802,LRes70082,LLoc65450,LMax43326],["Mul6575","Sim80510","Res87232","Con76710","Add69752","Res4802","Res70082","Loc65450","Max43326"],Max43326,"Max43326")

Actual (Unparsed): [[[1.0000000, 1.0489495]]]

Expected (Unparsed): [[[0.9999999999999998,1.0489495199999999]]]

Actual:   [[[1, 1.049]]]

Expected: [[[1, 1.049]]]