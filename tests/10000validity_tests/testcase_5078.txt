import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max98954 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Add27789 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Add27789 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con25217 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Up_58420 = tf.keras.layers.Input(shape=([2, 3]))

Max98954 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max98954', )(in0Max98954)
Add27789 = keras.layers.Add(name = 'Add27789', )([in0Add27789,in1Add27789])
Zer33409 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer33409', )(Add27789)
Con25217 = keras.layers.Concatenate(axis=3, name = 'Con25217', )([Zer33409,in0Con25217])
Min44923 = keras.layers.Minimum(name = 'Min44923', )([Max98954,Con25217])
Res10962 = keras.layers.Reshape((2, 4), name = 'Res10962', )(Min44923)
LST40661 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST40661', )(Res10962)
Res96698 = keras.layers.Reshape((2, 1), name = 'Res96698', )(LST40661)
Res41021 = keras.layers.Reshape((2, 1, 1), name = 'Res41021', )(Res96698)
Res90827 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res90827', )(Res41021)
Con8297 = keras.layers.Conv3DTranspose(3, (2, 1, 1),strides=(1, 5, 7), padding='same', name = 'Con8297', )(Res90827)
Up_58420 = keras.layers.UpSampling1D(size=(1), name = 'Up_58420', )(in0Up_58420)
Res16562 = keras.layers.Reshape((2, 3, 1), name = 'Res16562', )(Up_58420)
Res13834 = keras.layers.Reshape((2, 3, 1, 1), name = 'Res13834', )(Res16562)
Con76160 = keras.layers.Conv3D(3, (2, 2, 1),strides=(1, 6, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con76160', )(Res13834)
Zer77303 = keras.layers.ZeroPadding3D(padding=((0, 0), (4, 0), (6, 0)), name = 'Zer77303', )(Con76160)
Ave5998 = keras.layers.Average(name = 'Ave5998', )([Con8297,Zer77303])
Fla29232 = keras.layers.Flatten(name = 'Fla29232', )(Ave5998)
model = tf.keras.models.Model(inputs=[in0Max98954,in0Add27789,in1Add27789,in0Con25217,in0Up_58420], outputs=Fla29232)
w = model.get_layer('LST40661').get_weights() 
w[0] = np.array([[10, 2, 6, 5, 3, 8, 9, 10], [6, 4, 5, 8, 8, 6, 10, 9], [10, 7, 10, 2, 5, 3, 10, 7], [10, 1, 6, 3, 5, 8, 8, 1]])
w[1] = np.array([[10, 6, 3, 7, 10, 5, 5, 10], [9, 5, 2, 3, 1, 7, 3, 9]])
w[2] = np.array([4, 1, 6, 2, 2, 3, 4, 1])
model.get_layer('LST40661').set_weights(w) 
w = model.get_layer('Con8297').get_weights() 
w[0] = np.array([[[[[0.0446], [0.5397], [0.8093]]]], [[[[0.7962], [0.6897], [0.0493]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con8297').set_weights(w) 
w = model.get_layer('Con76160').get_weights() 
w[0] = np.array([[[[[0.7456, 0.0973, 0.5843]]], [[[0.8527, 0.4515, 0.7593]]]], [[[[0.8721, 0.1402, 0.0315]]], [[[0.6895, 0.0709, 0.6544]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con76160').set_weights(w) 
in0Max98954 = tf.constant([[[[1.9055, 1.7938], [1.1264, 1.9104]], [[1.5424, 1.2281], [1.2489, 1.5221]]]])
in0Add27789 = tf.constant([[[[0.334]]]])
in1Add27789 = tf.constant([[[[0.8747]]]])
in0Con25217 = tf.constant([[[[0.7431], [0.4549]], [[0.9703], [0.9406]]]])
in0Up_58420 = tf.constant([[[1.7408, 1.8456, 1.7329], [1.5873, 1.6651, 1.0313]]])
print (np.array2string(model.predict([in0Max98954,in0Add27789,in1Add27789,in0Con25217,in0Up_58420],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Fla29232.png')

LMax98954 = max_pool2D_layer([[[[1.9055, 1.7938], [1.1264, 1.9104]], [[1.5424, 1.2281], [1.2489, 1.5221]]]], 1, 1, Max98954), 
LAdd27789 = add_layer([[[[[0.334]]]], [[[[0.8747]]]]], Add27789), 
LZer33409 = zero_padding2D_layer(Add27789, 1, 0, 1, 0, Zer33409), 
LCon25217 = concatenate_layer([Zer33409,[[[[0.7431], [0.4549]], [[0.9703], [0.9406]]]]], 3, Con25217), 
LMin44923 = minimum_layer([Max98954,Con25217], Min44923), 
LRes10962 = reshape_layer(Min44923, [2, 4], Res10962), 
LLST40661 = lstm_layer(Res10962,[[10, 2, 6, 5, 3, 8, 9, 10], [6, 4, 5, 8, 8, 6, 10, 9], [10, 7, 10, 2, 5, 3, 10, 7], [10, 1, 6, 3, 5, 8, 8, 1]],[[10, 6, 3, 7, 10, 5, 5, 10], [9, 5, 2, 3, 1, 7, 3, 9]],[4, 1, 6, 2, 2, 3, 4, 1], LST40661), 
LRes96698 = reshape_layer(LST40661, [2, 1], Res96698), 
LRes41021 = reshape_layer(Res96698, [2, 1, 1], Res41021), 
LRes90827 = reshape_layer(Res41021, [2, 1, 1, 1], Res90827), 
LCon8297 = conv3D_transpose_layer(Res90827, 2, 1, 1,[[[[[0.0446], [0.5397], [0.8093]]]], [[[[0.7962], [0.6897], [0.0493]]]]],[0, 0, 0], 1, 5, 7, true, Con8297), 
LUp_58420 = up_sampling1D_layer([[[1.7408, 1.8456, 1.7329], [1.5873, 1.6651, 1.0313]]], 1, Up_58420), 
LRes16562 = reshape_layer(Up_58420, [2, 3, 1], Res16562), 
LRes13834 = reshape_layer(Res16562, [2, 3, 1, 1], Res13834), 
LCon76160 = conv3D_layer(Res13834, 2, 2, 1,[[[[[0.7456, 0.0973, 0.5843]]], [[[0.8527, 0.4515, 0.7593]]]], [[[[0.8721, 0.1402, 0.0315]]], [[[0.6895, 0.0709, 0.6544]]]]],[0, 0, 0], 1, 6, 1, true, 1, 1, 1, Con76160), 
LZer77303 = zero_padding3D_layer(Con76160, 0, 0, 4, 0, 6, 0, Zer77303), 
LAve5998 = average_layer([Con8297,Zer77303], Ave5998), 
LFla29232 = flatten_layer(Ave5998, Fla29232), 
exec_layers([LMax98954,LAdd27789,LZer33409,LCon25217,LMin44923,LRes10962,LLST40661,LRes96698,LRes41021,LRes90827,LCon8297,LUp_58420,LRes16562,LRes13834,LCon76160,LZer77303,LAve5998,LFla29232],["Max98954","Add27789","Zer33409","Con25217","Min44923","Res10962","LST40661","Res96698","Res41021","Res90827","Con8297","Up_58420","Res16562","Res13834","Con76160","Zer77303","Ave5998","Fla29232"],Fla29232,"Fla29232")

Actual (Unparsed): [[0.0214978, 0.2601428, 0.3900937, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 2.7020272, 0.6716316, 1.7790775, 0.4052583, 0.5923600, 0.4135157, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 1.3016608, 0.4531185, 1.0958849]]

Expected (Unparsed): [[0.02149781149728538,0.2601427996655812,0.39009369607069644,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2.7020271900000004,0.6716316449999999,1.779077455,0.40525831827502523,0.5923600419052266,0.41351565639698684,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.301660825,0.45311847000000005,1.0958849099999999]]

Actual:   [[0.0215, 0.2602, 0.3901, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.7021, 0.6717, 1.7791, 0.4053, 0.5924, 0.4136, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.3017, 0.4532, 1.0959]]

Expected: [[0.0215, 0.2602, 0.3901, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.7021, 0.6717, 1.7791, 0.4053, 0.5924, 0.4136, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.3017, 0.4532, 1.0959]]