import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot9768 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot9768 = tf.keras.layers.Input(shape=([2, 2]))
in0Con17695 = tf.keras.layers.Input(shape=([1, 1, 3]))
in0Max82035 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Max82035 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))

Dot9768 = keras.layers.Dot(axes=(1, 1), name = 'Dot9768', )([in0Dot9768,in1Dot9768])
Res11513 = keras.layers.Reshape((2, 2, 1), name = 'Res11513', )(Dot9768)
Glo3209 = keras.layers.GlobalMaxPool2D(name = 'Glo3209', )(Res11513)
Res91303 = keras.layers.Reshape((1, 1), name = 'Res91303', )(Glo3209)
Res60200 = keras.layers.Reshape((1, 1, 1), name = 'Res60200', )(Res91303)
Con17695 = keras.layers.Concatenate(axis=3, name = 'Con17695', )([Res60200,in0Con17695])
Max82035 = keras.layers.Maximum(name = 'Max82035', )([in0Max82035,in1Max82035])
Res46348 = keras.layers.Reshape((1, 1, 4), name = 'Res46348', )(Max82035)
Dep3303 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='valid', name = 'Dep3303', )(Res46348)
Sub48007 = keras.layers.Subtract(name = 'Sub48007', )([Con17695,Dep3303])
model = tf.keras.models.Model(inputs=[in0Dot9768,in1Dot9768,in0Con17695,in0Max82035,in1Max82035], outputs=Sub48007)
w = model.get_layer('Dep3303').get_weights() 
w[0] = np.array([[[[0.6771], [0.1963], [0.5046], [0.6808]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Dep3303').set_weights(w) 
in0Dot9768 = tf.constant([[[0.1459, 0.422], [0.4436, 0.1946]]])
in1Dot9768 = tf.constant([[[0.3924, 0.6509], [0.2165, 0.9937]]])
in0Con17695 = tf.constant([[[[0.0401, 0.0842, 0.2571]]]])
in0Max82035 = tf.constant([[[[[0.2838, 0.596], [0.0943, 0.4614]]]]])
in1Max82035 = tf.constant([[[[[0.4736, 0.8115], [0.752, 0.6206]]]]])
print (np.array2string(model.predict([in0Dot9768,in1Dot9768,in0Con17695,in0Max82035,in1Max82035],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub48007.png')

LDot9768 = dot_layer([[[0.1459, 0.422], [0.4436, 0.1946]]], [[[0.3924, 0.6509], [0.2165, 0.9937]]], 1, 1, Dot9768), 
LRes11513 = reshape_layer(Dot9768, [2, 2, 1], Res11513), 
LGlo3209 = global_max_pool2D_layer(Res11513, Glo3209), 
LRes91303 = reshape_layer(Glo3209, [1, 1], Res91303), 
LRes60200 = reshape_layer(Res91303, [1, 1, 1], Res60200), 
LCon17695 = concatenate_layer([Res60200,[[[[0.0401, 0.0842, 0.2571]]]]], 3, Con17695), 
LMax82035 = maximum_layer([[[[[[0.2838, 0.596], [0.0943, 0.4614]]]]], [[[[[0.4736, 0.8115], [0.752, 0.6206]]]]]], Max82035), 
LRes46348 = reshape_layer(Max82035, [1, 1, 4], Res46348), 
LDep3303 = depthwise_conv2D_layer(Res46348, 1, 1,[[[[0.6771], [0.1963], [0.5046], [0.6808]]]],[0, 0, 0, 0], 1, 1, false, Dep3303), 
LSub48007 = subtract_layer(Con17695,Dep3303, Sub48007), 
exec_layers([LDot9768,LRes11513,LGlo3209,LRes91303,LRes60200,LCon17695,LMax82035,LRes46348,LDep3303,LSub48007],["Dot9768","Res11513","Glo3209","Res91303","Res60200","Con17695","Max82035","Res46348","Dep3303","Sub48007"],Sub48007,"Sub48007")

Actual (Unparsed): [[[[0.2150971, -0.1191975, -0.2952592, -0.1654045]]]]

Expected (Unparsed): [[[[0.21509707,-0.11919745000000001,-0.29525920000000005,-0.16540448000000002]]]]

Actual:   [[[[0.2151, -0.1191, -0.2952, -0.1654]]]]

Expected: [[[[0.2151, -0.1191, -0.2952, -0.1654]]]]