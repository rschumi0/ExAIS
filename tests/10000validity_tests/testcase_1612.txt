import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0PRe31063 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))

PRe31063 = keras.layers.PReLU(name = 'PRe31063', input_shape=(1, 2, 2, 1))(in0PRe31063)
Res38147 = keras.layers.Reshape((1, 2, 2), name = 'Res38147', )(PRe31063)
Res73475 = keras.layers.Reshape((1, 4), name = 'Res73475', )(Res38147)
Up_2160 = keras.layers.UpSampling1D(size=(1), name = 'Up_2160', )(Res73475)
Res21946 = keras.layers.Reshape((1, 4, 1), name = 'Res21946', )(Up_2160)
Con25516 = keras.layers.Conv2D(4, (1, 4),strides=(7, 1), padding='same', dilation_rate=(1, 1), name = 'Con25516', )(Res21946)
model = tf.keras.models.Model(inputs=[in0PRe31063], outputs=Con25516)
w = model.get_layer('PRe31063').get_weights() 
w[0] = np.array([[[[0.6451], [0.3443]], [[0.6192], [0.0498]]]])
model.get_layer('PRe31063').set_weights(w) 
w = model.get_layer('Con25516').get_weights() 
w[0] = np.array([[[[0.3838, 0.2009, 0.8996, 0.1413]], [[0.9533, 0.2462, 0.7747, 0.847]], [[0.611, 0.4692, 0.7457, 0.6722]], [[0.9286, 0.5401, 0.1014, 0.9443]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con25516').set_weights(w) 
in0PRe31063 = tf.constant([[[[[0.4078], [0.2886]], [[0.2644], [0.0025]]]]])
print (np.array2string(model.predict([in0PRe31063],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con25516.png')

LPRe31063 = prelu_layer([[[[[0.4078], [0.2886]], [[0.2644], [0.0025]]]]], [[[[0.6451], [0.3443]], [[0.6192], [0.0498]]]], PRe31063), 
LRes38147 = reshape_layer(PRe31063, [1, 2, 2], Res38147), 
LRes73475 = reshape_layer(Res38147, [1, 4], Res73475), 
LUp_2160 = up_sampling1D_layer(Res73475, 1, Up_2160), 
LRes21946 = reshape_layer(Up_2160, [1, 4, 1], Res21946), 
LCon25516 = conv2D_layer(Res21946, 1, 4,[[[[0.3838, 0.2009, 0.8996, 0.1413]], [[0.9533, 0.2462, 0.7747, 0.847]], [[0.611, 0.4692, 0.7457, 0.6722]], [[0.9286, 0.5401, 0.1014, 0.9443]]]],[0, 0, 0, 0], 7, 1, true, 1, 1, Con25516), 
exec_layers([LPRe31063,LRes38147,LRes73475,LUp_2160,LRes21946,LCon25516],["PRe31063","Res38147","Res73475","Up_2160","Res21946","Con25516"],Con25516,"Con25516")

Actual (Unparsed): [[[[0.8106122, 0.3786139, 0.5579418, 0.7890764], [0.5955059, 0.2783871, 0.7878519, 0.4821568], [0.3643447, 0.1242480, 0.4663195, 0.2664065], [0.1038600, 0.0537335, 0.2397910, 0.0394772]]]]

Expected (Unparsed): [[[[0.81061218,0.37861392000000005,0.5579418400000001,0.7890764400000001],[0.59550592,0.27838707,0.7878518800000001,0.48215677],[0.3643447000000001,0.12424802,0.46631949000000006,0.26640648],[0.10385997000000001,0.053733460000000004,0.23979099,0.03947722000000001]]]]

Actual:   [[[[0.8107, 0.3787, 0.558, 0.7891], [0.5956, 0.2784, 0.7879, 0.4822], [0.3644, 0.1243, 0.4664, 0.2665], [0.1039, 0.0538, 0.2398, 0.0395]]]]

Expected: [[[[0.8107, 0.3787, 0.558, 0.7891], [0.5956, 0.2784, 0.7879, 0.4822], [0.3644, 0.1243, 0.4664, 0.2665], [0.1039, 0.0538, 0.2398, 0.0395]]]]