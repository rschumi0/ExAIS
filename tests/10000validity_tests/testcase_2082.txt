import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max97807 = tf.keras.layers.Input(shape=([1, 2]))
in1Max97807 = tf.keras.layers.Input(shape=([1, 2]))
in0Con85461 = tf.keras.layers.Input(shape=([4, 4, 2, 1]))
in0Add68032 = tf.keras.layers.Input(shape=([2, 2]))
in1Add68032 = tf.keras.layers.Input(shape=([2, 2]))
in0Max86105 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Max86105 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Add92820 = tf.keras.layers.Input(shape=([2, 1]))
in1Add92820 = tf.keras.layers.Input(shape=([2, 1]))
in0Con7998 = tf.keras.layers.Input(shape=([2, 1]))
in0Con53459 = tf.keras.layers.Input(shape=([4, 4, 2, 1]))
in0Min64503 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Min64503 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

Max97807 = keras.layers.Maximum(name = 'Max97807', )([in0Max97807,in1Max97807])
LST85220 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST85220', )(Max97807)
Res63992 = keras.layers.Reshape((1, 1), name = 'Res63992', )(LST85220)
Res56966 = keras.layers.Reshape((1, 1, 1), name = 'Res56966', )(Res63992)
Res21869 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res21869', )(Res56966)
Zer35072 = keras.layers.ZeroPadding3D(padding=((3, 0), (3, 0), (1, 0)), name = 'Zer35072', )(Res21869)
Con85461 = keras.layers.Concatenate(axis=4, name = 'Con85461', )([Zer35072,in0Con85461])
Add68032 = keras.layers.Add(name = 'Add68032', )([in0Add68032,in1Add68032])
Max86105 = keras.layers.Maximum(name = 'Max86105', )([in0Max86105,in1Max86105])
Res47194 = keras.layers.Reshape((2, 1), name = 'Res47194', )(Max86105)
Add92820 = keras.layers.Add(name = 'Add92820', )([in0Add92820,in1Add92820])
Mul44513 = keras.layers.Multiply(name = 'Mul44513', )([Res47194,Add92820])
Con7998 = keras.layers.Concatenate(axis=2, name = 'Con7998', )([Mul44513,in0Con7998])
Add88059 = keras.layers.Add(name = 'Add88059', )([Add68032,Con7998])
Res52176 = keras.layers.Reshape((2, 2, 1), name = 'Res52176', )(Add88059)
Res19076 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res19076', )(Res52176)
Zer9874 = keras.layers.ZeroPadding3D(padding=((2, 0), (2, 0), (1, 0)), name = 'Zer9874', )(Res19076)
Con53459 = keras.layers.Concatenate(axis=4, name = 'Con53459', )([Zer9874,in0Con53459])
Min64503 = keras.layers.Minimum(name = 'Min64503', )([in0Min64503,in1Min64503])
Up_55790 = keras.layers.UpSampling3D(size=(2, 2, 2), name = 'Up_55790', )(Min64503)
Max75179 = keras.layers.Maximum(name = 'Max75179', )([Con53459,Up_55790])
Max47914 = keras.layers.Maximum(name = 'Max47914', )([Con85461,Max75179])
model = tf.keras.models.Model(inputs=[in0Max97807,in1Max97807,in0Con85461,in0Add68032,in1Add68032,in0Max86105,in1Max86105,in0Add92820,in1Add92820,in0Con7998,in0Con53459,in0Min64503,in1Min64503], outputs=Max47914)
w = model.get_layer('LST85220').get_weights() 
w[0] = np.array([[6, 4, 1, 9], [1, 8, 3, 3]])
w[1] = np.array([[1, 10, 9, 2]])
w[2] = np.array([4, 2, 10, 4])
model.get_layer('LST85220').set_weights(w) 
in0Max97807 = tf.constant([[[0.183, 0.2094]]])
in1Max97807 = tf.constant([[[0.0081, 0.2847]]])
in0Con85461 = tf.constant([[[[[0.0633], [0.5943]], [[0.0267], [0.2191]], [[0.3555], [0.6091]], [[0.7656], [0.8493]]], [[[0.347], [0.3982]], [[0.6385], [0.6409]], [[0.7678], [0.9354]], [[0.0013], [0.283]]], [[[0.2919], [0.8091]], [[0.9971], [0.651]], [[0.1997], [0.489]], [[0.4894], [0.4647]]], [[[0.5023], [0.2657]], [[0.4986], [0.6437]], [[0.1683], [0.0075]], [[0.2418], [0.1994]]]]])
in0Add68032 = tf.constant([[[0.7938, 0.7832], [0.0543, 0.2543]]])
in1Add68032 = tf.constant([[[0.3064, 0.5091], [0.9375, 0.7223]]])
in0Max86105 = tf.constant([[[[0.3231]], [[0.3948]]]])
in1Max86105 = tf.constant([[[[0.5706]], [[0.7008]]]])
in0Add92820 = tf.constant([[[0.6405], [0.6004]]])
in1Add92820 = tf.constant([[[0.9168], [0.0666]]])
in0Con7998 = tf.constant([[[0.0287], [0.6378]]])
in0Con53459 = tf.constant([[[[[0.1405], [0.2166]], [[0.6429], [0.1185]], [[0.7643], [0.012]], [[0.4101], [0.3768]]], [[[0.9631], [0.3424]], [[0.4397], [0.7174]], [[0.7271], [0.1549]], [[0.6787], [0.0065]]], [[[0.4831], [0.1486]], [[0.1495], [0.6176]], [[0.2438], [0.1412]], [[0.6122], [0.8966]]], [[[0.7306], [0.0812]], [[0.3688], [0.1125]], [[0.3492], [0.6526]], [[0.5716], [0.7949]]]]])
in0Min64503 = tf.constant([[[[[0.4492, 0.7812]], [[0.1301, 0.4175]]], [[[0.4131, 0.8515]], [[0.9051, 0.3271]]]]])
in1Min64503 = tf.constant([[[[[0.2382, 0.238]], [[0.1407, 0.0458]]], [[[0.0827, 0.219]], [[0.4017, 0.4904]]]]])
print (np.array2string(model.predict([in0Max97807,in1Max97807,in0Con85461,in0Add68032,in1Add68032,in0Max86105,in1Max86105,in0Add92820,in1Add92820,in0Con7998,in0Con53459,in0Min64503,in1Min64503],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max47914.png')

LMax97807 = maximum_layer([[[[0.183, 0.2094]]], [[[0.0081, 0.2847]]]], Max97807), 
LLST85220 = lstm_layer(Max97807,[[6, 4, 1, 9], [1, 8, 3, 3]],[[1, 10, 9, 2]],[4, 2, 10, 4], LST85220), 
LRes63992 = reshape_layer(LST85220, [1, 1], Res63992), 
LRes56966 = reshape_layer(Res63992, [1, 1, 1], Res56966), 
LRes21869 = reshape_layer(Res56966, [1, 1, 1, 1], Res21869), 
LZer35072 = zero_padding3D_layer(Res21869, 3, 0, 3, 0, 1, 0, Zer35072), 
LCon85461 = concatenate_layer([Zer35072,[[[[[0.0633], [0.5943]], [[0.0267], [0.2191]], [[0.3555], [0.6091]], [[0.7656], [0.8493]]], [[[0.347], [0.3982]], [[0.6385], [0.6409]], [[0.7678], [0.9354]], [[0.0013], [0.283]]], [[[0.2919], [0.8091]], [[0.9971], [0.651]], [[0.1997], [0.489]], [[0.4894], [0.4647]]], [[[0.5023], [0.2657]], [[0.4986], [0.6437]], [[0.1683], [0.0075]], [[0.2418], [0.1994]]]]]], 4, Con85461), 
LAdd68032 = add_layer([[[[0.7938, 0.7832], [0.0543, 0.2543]]], [[[0.3064, 0.5091], [0.9375, 0.7223]]]], Add68032), 
LMax86105 = maximum_layer([[[[[0.3231]], [[0.3948]]]], [[[[0.5706]], [[0.7008]]]]], Max86105), 
LRes47194 = reshape_layer(Max86105, [2, 1], Res47194), 
LAdd92820 = add_layer([[[[0.6405], [0.6004]]], [[[0.9168], [0.0666]]]], Add92820), 
LMul44513 = multiply_layer([Res47194,Add92820], Mul44513), 
LCon7998 = concatenate_layer([Mul44513,[[[0.0287], [0.6378]]]], 2, Con7998), 
LAdd88059 = add_layer([Add68032,Con7998], Add88059), 
LRes52176 = reshape_layer(Add88059, [2, 2, 1], Res52176), 
LRes19076 = reshape_layer(Res52176, [2, 2, 1, 1], Res19076), 
LZer9874 = zero_padding3D_layer(Res19076, 2, 0, 2, 0, 1, 0, Zer9874), 
LCon53459 = concatenate_layer([Zer9874,[[[[[0.1405], [0.2166]], [[0.6429], [0.1185]], [[0.7643], [0.012]], [[0.4101], [0.3768]]], [[[0.9631], [0.3424]], [[0.4397], [0.7174]], [[0.7271], [0.1549]], [[0.6787], [0.0065]]], [[[0.4831], [0.1486]], [[0.1495], [0.6176]], [[0.2438], [0.1412]], [[0.6122], [0.8966]]], [[[0.7306], [0.0812]], [[0.3688], [0.1125]], [[0.3492], [0.6526]], [[0.5716], [0.7949]]]]]], 4, Con53459), 
LMin64503 = minimum_layer([[[[[[0.4492, 0.7812]], [[0.1301, 0.4175]]], [[[0.4131, 0.8515]], [[0.9051, 0.3271]]]]], [[[[[0.2382, 0.238]], [[0.1407, 0.0458]]], [[[0.0827, 0.219]], [[0.4017, 0.4904]]]]]], Min64503), 
LUp_55790 = up_sampling3D_layer(Min64503, 2, 2, 2, Up_55790), 
LMax75179 = maximum_layer([Con53459,Up_55790], Max75179), 
LMax47914 = maximum_layer([Con85461,Max75179], Max47914), 
exec_layers([LMax97807,LLST85220,LRes63992,LRes56966,LRes21869,LZer35072,LCon85461,LAdd68032,LMax86105,LRes47194,LAdd92820,LMul44513,LCon7998,LAdd88059,LRes52176,LRes19076,LZer9874,LCon53459,LMin64503,LUp_55790,LMax75179,LMax47914],["Max97807","LST85220","Res63992","Res56966","Res21869","Zer35072","Con85461","Add68032","Max86105","Res47194","Add92820","Mul44513","Con7998","Add88059","Res52176","Res19076","Zer9874","Con53459","Min64503","Up_55790","Max75179","Max47914"],Max47914,"Max47914")

Actual (Unparsed): [[[[[0.2382000, 0.2380000], [0.2382000, 0.5943000]], [[0.2382000, 0.6429000], [0.2382000, 0.2380000]], [[0.1301000, 0.7643000], [0.1301000, 0.6091000]], [[0.1301000, 0.7656000], [0.1301000, 0.8493000]]], [[[0.2382000, 0.9631000], [0.2382000, 0.3982000]], [[0.2382000, 0.6385000], [0.2382000, 0.7174000]], [[0.1301000, 0.7678000], [0.1301000, 0.9354000]], [[0.1301000, 0.6787000], [0.1301000, 0.2830000]]], [[[0.0827000, 0.4831000], [0.0827000, 0.8091000]], [[0.0827000, 0.9971000], [0.0827000, 0.6510000]], [[0.4017000, 0.3271000], [1.9887954, 0.4890000]], [[0.4017000, 0.6122000], [1.3210000, 0.8966000]]], [[[0.0827000, 0.7306000], [0.0827000, 0.2657000]], [[0.0827000, 0.4986000], [0.0827000, 0.6437000]], [[0.4017000, 0.3492000], [1.4592336, 0.6526000]], [[0.4017000, 0.5716000], [1.6144000, 0.7949000]]]]]

Expected (Unparsed): [[[[[0.2382,0.238],[0.2382,0.5943]],[[0.2382,0.6429],[0.2382,0.238]],[[0.1301,0.7643],[0.1301,0.6091]],[[0.1301,0.7656],[0.1301,0.8493]]],[[[0.2382,0.9631],[0.2382,0.3982]],[[0.2382,0.6385],[0.2382,0.7174]],[[0.1301,0.7678],[0.1301,0.9354]],[[0.1301,0.6787],[0.1301,0.283]]],[[[0.0827,0.4831],[0.0827,0.8091]],[[0.0827,0.9971],[0.0827,0.651]],[[0.4017,0.3271],[1.98879538,0.489]],[[0.4017,0.6122],[1.321,0.8966]]],[[[0.0827,0.7306],[0.0827,0.2657]],[[0.0827,0.4986],[0.0827,0.6437]],[[0.4017,0.3492],[1.4592336000000001,0.6526]],[[0.4017,0.5716],[1.6144000000000003,0.7949]]]]]

Actual:   [[[[[0.2382, 0.238], [0.2382, 0.5943]], [[0.2382, 0.6429], [0.2382, 0.238]], [[0.1301, 0.7643], [0.1301, 0.6091]], [[0.1301, 0.7656], [0.1301, 0.8493]]], [[[0.2382, 0.9631], [0.2382, 0.3982]], [[0.2382, 0.6385], [0.2382, 0.7174]], [[0.1301, 0.7678], [0.1301, 0.9354]], [[0.1301, 0.6787], [0.1301, 0.283]]], [[[0.0827, 0.4831], [0.0827, 0.8091]], [[0.0827, 0.9971], [0.0827, 0.651]], [[0.4017, 0.3271], [1.9888, 0.489]], [[0.4017, 0.6122], [1.321, 0.8966]]], [[[0.0827, 0.7306], [0.0827, 0.2657]], [[0.0827, 0.4986], [0.0827, 0.6437]], [[0.4017, 0.3492], [1.4593, 0.6526]], [[0.4017, 0.5716], [1.6144, 0.7949]]]]]

Expected: [[[[[0.2382, 0.238], [0.2382, 0.5943]], [[0.2382, 0.6429], [0.2382, 0.238]], [[0.1301, 0.7643], [0.1301, 0.6091]], [[0.1301, 0.7656], [0.1301, 0.8493]]], [[[0.2382, 0.9631], [0.2382, 0.3982]], [[0.2382, 0.6385], [0.2382, 0.7174]], [[0.1301, 0.7678], [0.1301, 0.9354]], [[0.1301, 0.6787], [0.1301, 0.283]]], [[[0.0827, 0.4831], [0.0827, 0.8091]], [[0.0827, 0.9971], [0.0827, 0.651]], [[0.4017, 0.3271], [1.9888, 0.489]], [[0.4017, 0.6122], [1.321, 0.8966]]], [[[0.0827, 0.7306], [0.0827, 0.2657]], [[0.0827, 0.4986], [0.0827, 0.6437]], [[0.4017, 0.3492], [1.4593, 0.6526]], [[0.4017, 0.5716], [1.6145, 0.7949]]]]]