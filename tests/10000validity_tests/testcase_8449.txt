import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc5819 = tf.keras.layers.Input(shape=([1, 2]))
in0Mul60806 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Mul60806 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con25011 = tf.keras.layers.Input(shape=([1, 3]))
in0Ave1472 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave1472 = tf.keras.layers.Input(shape=([2, 1]))
in0Con65913 = tf.keras.layers.Input(shape=([2, 3]))

Loc5819 = keras.layers.LocallyConnected1D(4, (1),strides=(1), name = 'Loc5819', )(in0Loc5819)
Mul60806 = keras.layers.Multiply(name = 'Mul60806', )([in0Mul60806,in1Mul60806])
Res46286 = keras.layers.Reshape((1, 1), name = 'Res46286', )(Mul60806)
Per32629 = keras.layers.Permute((1,2), name = 'Per32629',)(Res46286)
Con25011 = keras.layers.Concatenate(axis=2, name = 'Con25011', )([Per32629,in0Con25011])
Sub48265 = keras.layers.Subtract(name = 'Sub48265', )([Loc5819,Con25011])
Zer44614 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer44614', )(Sub48265)
Ave1472 = keras.layers.Average(name = 'Ave1472', )([in0Ave1472,in1Ave1472])
Con65913 = keras.layers.Concatenate(axis=2, name = 'Con65913', )([Ave1472,in0Con65913])
Ave26243 = keras.layers.Average(name = 'Ave26243', )([Zer44614,Con65913])
model = tf.keras.models.Model(inputs=[in0Loc5819,in0Mul60806,in1Mul60806,in0Con25011,in0Ave1472,in1Ave1472,in0Con65913], outputs=Ave26243)
w = model.get_layer('Loc5819').get_weights() 
w[0] = np.array([[[0.8024, 0.5833, 0.9411, 0.0351], [0.1322, 0.2929, 0.6, 0.9505]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc5819').set_weights(w) 
in0Loc5819 = tf.constant([[[0.0561, 0.5072]]])
in0Mul60806 = tf.constant([[[[0.602]]]])
in1Mul60806 = tf.constant([[[[0.8595]]]])
in0Con25011 = tf.constant([[[0.8977, 0.6679, 0.6711]]])
in0Ave1472 = tf.constant([[[0.5302], [0.6342]]])
in1Ave1472 = tf.constant([[[0.4322], [0.7723]]])
in0Con65913 = tf.constant([[[0.8261, 0.1211, 0.7229], [0.195, 0.3733, 0.2343]]])
print (np.array2string(model.predict([in0Loc5819,in0Mul60806,in1Mul60806,in0Con25011,in0Ave1472,in1Ave1472,in0Con65913],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave26243.png')

LLoc5819 = locally_connected1D_layer([[[0.0561, 0.5072]]], 1,[[[0.8024, 0.5833, 0.9411, 0.0351], [0.1322, 0.2929, 0.6, 0.9505]]],[[0, 0, 0, 0]], 1, Loc5819), 
LMul60806 = multiply_layer([[[[[0.602]]]], [[[[0.8595]]]]], Mul60806), 
LRes46286 = reshape_layer(Mul60806, [1, 1], Res46286), 
LPer32629 = permute_layer(Res46286, 1,2, Per32629), 
LCon25011 = concatenate_layer([Per32629,[[[0.8977, 0.6679, 0.6711]]]], 2, Con25011), 
LSub48265 = subtract_layer(Loc5819,Con25011, Sub48265), 
LZer44614 = zero_padding1D_layer(Sub48265, 1, 0, Zer44614), 
LAve1472 = average_layer([[[[0.5302], [0.6342]]], [[[0.4322], [0.7723]]]], Ave1472), 
LCon65913 = concatenate_layer([Ave1472,[[[0.8261, 0.1211, 0.7229], [0.195, 0.3733, 0.2343]]]], 2, Con65913), 
LAve26243 = average_layer([Zer44614,Con65913], Ave26243), 
exec_layers([LLoc5819,LMul60806,LRes46286,LPer32629,LCon25011,LSub48265,LZer44614,LAve1472,LCon65913,LAve26243],["Loc5819","Mul60806","Res46286","Per32629","Con25011","Sub48265","Zer44614","Ave1472","Con65913","Ave26243"],Ave26243,"Ave26243")

Actual (Unparsed): [[[0.2406000, 0.4130500, 0.0605500, 0.3614500], [0.1489487, -0.2607090, 0.0312578, 0.0236313]]]

Expected (Unparsed): [[[0.24059999999999998,0.41305,0.06055,0.36145],[0.14894873999999997,-0.260708995,0.03125785499999997,0.023631354999999993]]]

Actual:   [[[0.2406, 0.4131, 0.0606, 0.3615], [0.149, -0.2607, 0.0313, 0.0237]]]

Expected: [[[0.2406, 0.4131, 0.0606, 0.3615], [0.149, -0.2607, 0.0313, 0.0237]]]