import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot83431 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot83431 = tf.keras.layers.Input(shape=([3, 2]))
in0Cro41201 = tf.keras.layers.Input(shape=([3, 3]))
in0Thr24598 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con41640 = tf.keras.layers.Input(shape=([3, 1]))

Dot83431 = keras.layers.Dot(axes=(2, 2), name = 'Dot83431', )([in0Dot83431,in1Dot83431])
Cro41201 = keras.layers.Cropping1D(cropping=((2, 0)), name = 'Cro41201', )(in0Cro41201)
Zer3312 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer3312', )(Cro41201)
Sub23350 = keras.layers.Subtract(name = 'Sub23350', )([Dot83431,Zer3312])
Thr24598 = keras.layers.ThresholdedReLU(theta=2.1790094579939288, name = 'Thr24598', input_shape=(2, 1, 2))(in0Thr24598)
Res83892 = keras.layers.Reshape((2, 2), name = 'Res83892', )(Thr24598)
Cro92470 = keras.layers.Cropping1D(cropping=((0, 1)), name = 'Cro92470', )(Res83892)
Zer72900 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer72900', )(Cro92470)
Con41640 = keras.layers.Concatenate(axis=2, name = 'Con41640', )([Zer72900,in0Con41640])
Add22976 = keras.layers.Add(name = 'Add22976', )([Sub23350,Con41640])
Res22231 = keras.layers.Reshape((3, 3, 1), name = 'Res22231', )(Add22976)
Ave19067 = keras.layers.AveragePooling2D(pool_size=(1, 2), strides=(1, 1), padding='same', name = 'Ave19067', )(Res22231)
model = tf.keras.models.Model(inputs=[in0Dot83431,in1Dot83431,in0Cro41201,in0Thr24598,in0Con41640], outputs=Ave19067)
in0Dot83431 = tf.constant([[[0.9774, 0.9989], [0.878, 0.3411], [0.8549, 0.9274]]])
in1Dot83431 = tf.constant([[[0.617, 0.0066], [0.4503, 0.4936], [0.1468, 0.7192]]])
in0Cro41201 = tf.constant([[[1.864, 1.093, 1.0777], [1.8804, 1.7644, 1.9269], [1.3892, 1.055, 1.1466]]])
in0Thr24598 = tf.constant([[[[0.1478, 0.5885]], [[0.7868, 0.2632]]]])
in0Con41640 = tf.constant([[[0.486], [0.6985], [0.341]]])
print (np.array2string(model.predict([in0Dot83431,in1Dot83431,in0Cro41201,in0Thr24598,in0Con41640],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave19067.png')

LDot83431 = dot_layer([[[0.9774, 0.9989], [0.878, 0.3411], [0.8549, 0.9274]]], [[[0.617, 0.0066], [0.4503, 0.4936], [0.1468, 0.7192]]], 2, 2, Dot83431), 
LCro41201 = cropping1D_layer([[[1.864, 1.093, 1.0777], [1.8804, 1.7644, 1.9269], [1.3892, 1.055, 1.1466]]], 2, 0, Cro41201), 
LZer3312 = zero_padding1D_layer(Cro41201, 2, 0, Zer3312), 
LSub23350 = subtract_layer(Dot83431,Zer3312, Sub23350), 
LThr24598 = thresholded_relu_layer([[[[0.1478, 0.5885]], [[0.7868, 0.2632]]]], 2.1790094579939288, Thr24598), 
LRes83892 = reshape_layer(Thr24598, [2, 2], Res83892), 
LCro92470 = cropping1D_layer(Res83892, 0, 1, Cro92470), 
LZer72900 = zero_padding1D_layer(Cro92470, 2, 0, Zer72900), 
LCon41640 = concatenate_layer([Zer72900,[[[0.486], [0.6985], [0.341]]]], 2, Con41640), 
LAdd22976 = add_layer([Sub23350,Con41640], Add22976), 
LRes22231 = reshape_layer(Add22976, [3, 3, 1], Res22231), 
LAve19067 = average_pooling2D_layer(Res22231, 1, 2, 1, 1, true, Ave19067), 
exec_layers([LDot83431,LCro41201,LZer3312,LSub23350,LThr24598,LRes83892,LCro92470,LZer72900,LCon41640,LAdd22976,LRes22231,LAve19067],["Dot83431","Cro41201","Zer3312","Sub23350","Thr24598","Res83892","Cro92470","Zer72900","Con41640","Add22976","Res22231","Ave19067"],Ave19067,"Ave19067")

Actual (Unparsed): [[[[0.7714144], [1.1405357], [1.3478912]], [[0.5538538], [0.8182199], [1.0727095]], [[-0.5339398], [-0.1126942], [-0.0131146]]]]

Expected (Unparsed): [[[[0.7714144000000001],[1.1405357299999999],[1.3478911999999998]],[[0.55385381],[0.8182199400000001],[1.07270952]],[[-0.533939875],[-0.11269424500000005],[-0.013114600000000143]]]]

Actual:   [[[[0.7715], [1.1406], [1.3479]], [[0.5539], [0.8183], [1.0728]], [[-0.5339], [-0.1126], [-0.0131]]]]

Expected: [[[[0.7715], [1.1406], [1.3479]], [[0.5539], [0.8183], [1.0728]], [[-0.5339], [-0.1126], [-0.0131]]]]