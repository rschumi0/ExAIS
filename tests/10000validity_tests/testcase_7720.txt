import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add39323 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Add39323 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Max99824 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con30753 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0GRU32554 = tf.keras.layers.Input(shape=([2, 1]))
in0Mul30296 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Mul30296 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))

Add39323 = keras.layers.Add(name = 'Add39323', )([in0Add39323,in1Add39323])
Lay98421 = keras.layers.LayerNormalization(axis=2, epsilon=2.8282989350517056, name = 'Lay98421', )(Add39323)
Max99824 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 1), padding='valid', name = 'Max99824', )(in0Max99824)
PRe3208 = keras.layers.PReLU(name = 'PRe3208', )(Max99824)
Con30753 = keras.layers.Concatenate(axis=3, name = 'Con30753', )([PRe3208,in0Con30753])
Sub66514 = keras.layers.Subtract(name = 'Sub66514', )([Lay98421,Con30753])
Res97827 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res97827', )(Sub66514)
GRU32554 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU32554', )(in0GRU32554)
Res77246 = keras.layers.Reshape((1, 1), name = 'Res77246', )(GRU32554)
Res1676 = keras.layers.Reshape((1, 1, 1), name = 'Res1676', )(Res77246)
Dep69706 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='valid', name = 'Dep69706', )(Res1676)
Res35566 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res35566', )(Dep69706)
Mul30296 = keras.layers.Multiply(name = 'Mul30296', )([in0Mul30296,in1Mul30296])
Add52301 = keras.layers.Add(name = 'Add52301', )([Res35566,Mul30296])
Zer25475 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (1, 0)), name = 'Zer25475', )(Add52301)
Mul71561 = keras.layers.Multiply(name = 'Mul71561', )([Res97827,Zer25475])
model = tf.keras.models.Model(inputs=[in0Add39323,in1Add39323,in0Max99824,in0Con30753,in0GRU32554,in0Mul30296,in1Mul30296], outputs=Mul71561)
w = model.get_layer('PRe3208').get_weights() 
w[0] = np.array([[[0.1771]]])
model.get_layer('PRe3208').set_weights(w) 
w = model.get_layer('GRU32554').get_weights() 
w[0] = np.array([[9, 9, 1]])
w[1] = np.array([[4, 1, 4]])
w[2] = np.array([[3, 5, 2], [7, 6, 5]])
model.get_layer('GRU32554').set_weights(w) 
w = model.get_layer('Dep69706').get_weights() 
w[0] = np.array([[[[0.3201]]]])
w[1] = np.array([0])
model.get_layer('Dep69706').set_weights(w) 
in0Add39323 = tf.constant([[[[0.4726, 0.4618]]]])
in1Add39323 = tf.constant([[[[0.7832, 0.147]]]])
in0Max99824 = tf.constant([[[[1.9428]]]])
in0Con30753 = tf.constant([[[[0.9853]]]])
in0GRU32554 = tf.constant([[[7], [4]]])
in0Mul30296 = tf.constant([[[[[0.4343]]]]])
in1Mul30296 = tf.constant([[[[[0.0686]]]]])
print (np.array2string(model.predict([in0Add39323,in1Add39323,in0Max99824,in0Con30753,in0GRU32554,in0Mul30296,in1Mul30296],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul71561.png')

LAdd39323 = add_layer([[[[[0.4726, 0.4618]]]], [[[[0.7832, 0.147]]]]], Add39323), 
LLay98421 = layer_normalization_layer(Add39323, 2, 2.8282989350517056, Lay98421), 
LMax99824 = max_pool2D_layer([[[[1.9428]]]], 1, 1, 1, 1, false, Max99824), 
LPRe3208 = prelu_layer(Max99824, [[[0.1771]]], PRe3208), 
LCon30753 = concatenate_layer([PRe3208,[[[[0.9853]]]]], 3, Con30753), 
LSub66514 = subtract_layer(Lay98421,Con30753, Sub66514), 
LRes97827 = reshape_layer(Sub66514, [1, 1, 2, 1], Res97827), 
LGRU32554 = gru_layer([[[7], [4]]],[[9, 9, 1]],[[4, 1, 4]],[[3, 5, 2], [7, 6, 5]], true, GRU32554), 
LRes77246 = reshape_layer(GRU32554, [1, 1], Res77246), 
LRes1676 = reshape_layer(Res77246, [1, 1, 1], Res1676), 
LDep69706 = depthwise_conv2D_layer(Res1676, 1, 1,[[[[0.3201]]]],[0], 1, 1, false, Dep69706), 
LRes35566 = reshape_layer(Dep69706, [1, 1, 1, 1], Res35566), 
LMul30296 = multiply_layer([[[[[[0.4343]]]]], [[[[[0.0686]]]]]], Mul30296), 
LAdd52301 = add_layer([Res35566,Mul30296], Add52301), 
LZer25475 = zero_padding3D_layer(Add52301, 0, 0, 0, 0, 1, 0, Zer25475), 
LMul71561 = multiply_layer([Res97827,Zer25475], Mul71561), 
exec_layers([LAdd39323,LLay98421,LMax99824,LPRe3208,LCon30753,LSub66514,LRes97827,LGRU32554,LRes77246,LRes1676,LDep69706,LRes35566,LMul30296,LAdd52301,LZer25475,LMul71561],["Add39323","Lay98421","Max99824","PRe3208","Con30753","Sub66514","Res97827","GRU32554","Res77246","Res1676","Dep69706","Res35566","Mul30296","Add52301","Zer25475","Mul71561"],Mul71561,"Mul71561")

Actual (Unparsed): [[[[[-0.0000000], [-0.0293550]]]]]

Expected (Unparsed): [[[[[-0.0],[-0.029355023193999998]]]]]

Actual:   [[[[[-0], [-0.0293]]]]]

Expected: [[[[[-0], [-0.0293]]]]]