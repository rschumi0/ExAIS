import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add45948 = tf.keras.layers.Input(shape=([2, 1]))
in1Add45948 = tf.keras.layers.Input(shape=([2, 1]))
in0Con37597 = tf.keras.layers.Input(shape=([1]))
in0Ave31330 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Ave31330 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))

Add45948 = keras.layers.Add(name = 'Add45948', )([in0Add45948,in1Add45948])
Fla64929 = keras.layers.Flatten(name = 'Fla64929', )(Add45948)
Con37597 = keras.layers.Concatenate(axis=1, name = 'Con37597', )([Fla64929,in0Con37597])
Ave31330 = keras.layers.Average(name = 'Ave31330', )([in0Ave31330,in1Ave31330])
Res26201 = keras.layers.Reshape((1, 2, 2), name = 'Res26201', )(Ave31330)
Res50323 = keras.layers.Reshape((1, 4), name = 'Res50323', )(Res26201)
LST78824 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST78824', )(Res50323)
Mul41645 = keras.layers.Multiply(name = 'Mul41645', )([Con37597,LST78824])
Res65624 = keras.layers.Reshape((3, 1), name = 'Res65624', )(Mul41645)
Res73810 = keras.layers.Reshape((3, 1, 1), name = 'Res73810', )(Res65624)
Res96163 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res96163', )(Res73810)
Cro37933 = keras.layers.Cropping3D(cropping=((0, 1), (0, 0), (0, 0)), name = 'Cro37933', )(Res96163)
Res68567 = keras.layers.Reshape((2, 1, 1), name = 'Res68567', )(Cro37933)
Res80242 = keras.layers.Reshape((2, 1), name = 'Res80242', )(Res68567)
LST80533 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST80533', )(Res80242)
model = tf.keras.models.Model(inputs=[in0Add45948,in1Add45948,in0Con37597,in0Ave31330,in1Ave31330], outputs=LST80533)
w = model.get_layer('LST78824').get_weights() 
w[0] = np.array([[8, 9, 5, 3, 10, 9, 10, 9, 3, 10, 4, 4], [6, 9, 6, 10, 4, 10, 2, 10, 2, 3, 3, 8], [7, 5, 4, 2, 1, 2, 7, 4, 9, 2, 6, 3], [5, 5, 10, 10, 3, 10, 10, 5, 9, 5, 7, 6]])
w[1] = np.array([[1, 5, 9, 9, 3, 1, 2, 9, 2, 6, 7, 7], [9, 7, 8, 2, 10, 3, 3, 10, 3, 9, 4, 3], [6, 9, 9, 7, 2, 2, 6, 8, 9, 7, 9, 9]])
w[2] = np.array([9, 10, 10, 3, 3, 8, 4, 8, 9, 8, 4, 8])
model.get_layer('LST78824').set_weights(w) 
w = model.get_layer('LST80533').get_weights() 
w[0] = np.array([[7, 2, 6, 7, 9, 10, 8, 2]])
w[1] = np.array([[2, 4, 9, 2, 4, 3, 3, 1], [1, 7, 3, 5, 5, 4, 10, 4]])
w[2] = np.array([7, 9, 3, 6, 8, 10, 7, 4])
model.get_layer('LST80533').set_weights(w) 
in0Add45948 = tf.constant([[[0.6356], [0.7621]]])
in1Add45948 = tf.constant([[[0.9934], [0.8272]]])
in0Con37597 = tf.constant([[0.8497]])
in0Ave31330 = tf.constant([[[[[0.5854], [0.4434]], [[0.0501], [0.615]]]]])
in1Ave31330 = tf.constant([[[[[0.9212], [0.9229]], [[0.1135], [0.3593]]]]])
print (np.array2string(model.predict([in0Add45948,in1Add45948,in0Con37597,in0Ave31330,in1Ave31330],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST80533.png')

LAdd45948 = add_layer([[[[0.6356], [0.7621]]], [[[0.9934], [0.8272]]]], Add45948), 
LFla64929 = flatten_layer(Add45948, Fla64929), 
LCon37597 = concatenate_layer([Fla64929,[[0.8497]]], 1, Con37597), 
LAve31330 = average_layer([[[[[[0.5854], [0.4434]], [[0.0501], [0.615]]]]], [[[[[0.9212], [0.9229]], [[0.1135], [0.3593]]]]]], Ave31330), 
LRes26201 = reshape_layer(Ave31330, [1, 2, 2], Res26201), 
LRes50323 = reshape_layer(Res26201, [1, 4], Res50323), 
LLST78824 = lstm_layer(Res50323,[[8, 9, 5, 3, 10, 9, 10, 9, 3, 10, 4, 4], [6, 9, 6, 10, 4, 10, 2, 10, 2, 3, 3, 8], [7, 5, 4, 2, 1, 2, 7, 4, 9, 2, 6, 3], [5, 5, 10, 10, 3, 10, 10, 5, 9, 5, 7, 6]],[[1, 5, 9, 9, 3, 1, 2, 9, 2, 6, 7, 7], [9, 7, 8, 2, 10, 3, 3, 10, 3, 9, 4, 3], [6, 9, 9, 7, 2, 2, 6, 8, 9, 7, 9, 9]],[9, 10, 10, 3, 3, 8, 4, 8, 9, 8, 4, 8], LST78824), 
LMul41645 = multiply_layer([Con37597,LST78824], Mul41645), 
LRes65624 = reshape_layer(Mul41645, [3, 1], Res65624), 
LRes73810 = reshape_layer(Res65624, [3, 1, 1], Res73810), 
LRes96163 = reshape_layer(Res73810, [3, 1, 1, 1], Res96163), 
LCro37933 = cropping3D_layer(Res96163, 0, 1, 0, 0, 0, 0, Cro37933), 
LRes68567 = reshape_layer(Cro37933, [2, 1, 1], Res68567), 
LRes80242 = reshape_layer(Res68567, [2, 1], Res80242), 
LLST80533 = lstm_layer(Res80242,[[7, 2, 6, 7, 9, 10, 8, 2]],[[2, 4, 9, 2, 4, 3, 3, 1], [1, 7, 3, 5, 5, 4, 10, 4]],[7, 9, 3, 6, 8, 10, 7, 4], LST80533), 
exec_layers([LAdd45948,LFla64929,LCon37597,LAve31330,LRes26201,LRes50323,LLST78824,LMul41645,LRes65624,LRes73810,LRes96163,LCro37933,LRes68567,LRes80242,LLST80533],["Add45948","Fla64929","Con37597","Ave31330","Res26201","Res50323","LST78824","Mul41645","Res65624","Res73810","Res96163","Cro37933","Res68567","Res80242","LST80533"],LST80533,"LST80533")

Actual (Unparsed): [[0.9640276, 0.9639919]]

Expected (Unparsed): [[0.9640275675339345,0.9639918715299474]]

Actual:   [[0.9641, 0.964]]

Expected: [[0.9641, 0.964]]