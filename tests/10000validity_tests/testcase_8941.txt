import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min52439 = tf.keras.layers.Input(shape=([2, 1]))
in1Min52439 = tf.keras.layers.Input(shape=([2, 1]))
in0Con13438 = tf.keras.layers.Input(shape=([2, 3]))
in0Ave84698 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Ave84698 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Con68515 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con44287 = tf.keras.layers.Input(shape=([1, 1, 1]))

Min52439 = keras.layers.Minimum(name = 'Min52439', )([in0Min52439,in1Min52439])
Con13438 = keras.layers.Concatenate(axis=2, name = 'Con13438', )([Min52439,in0Con13438])
Ave84698 = keras.layers.Average(name = 'Ave84698', )([in0Ave84698,in1Ave84698])
Res34962 = keras.layers.Reshape((2, 1, 2), name = 'Res34962', )(Ave84698)
Con68515 = keras.layers.Concatenate(axis=3, name = 'Con68515', )([Res34962,in0Con68515])
Con44287 = keras.layers.Conv2D(4, (1, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con44287', )(in0Con44287)
Zer43969 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer43969', )(Con44287)
Ave20666 = keras.layers.Average(name = 'Ave20666', )([Con68515,Zer43969])
Res84462 = keras.layers.Reshape((2, 4), name = 'Res84462', )(Ave20666)
Dot92503 = keras.layers.Dot(axes=(1, 1), name = 'Dot92503', )([Con13438,Res84462])
model = tf.keras.models.Model(inputs=[in0Min52439,in1Min52439,in0Con13438,in0Ave84698,in1Ave84698,in0Con68515,in0Con44287], outputs=Dot92503)
w = model.get_layer('Con44287').get_weights() 
w[0] = np.array([[[[0.6345, 0.7171, 0.2274, 0.1396]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con44287').set_weights(w) 
in0Min52439 = tf.constant([[[0.3372], [0.1186]]])
in1Min52439 = tf.constant([[[0.6818], [0.6927]]])
in0Con13438 = tf.constant([[[0.6548, 0.5107, 0.0418], [0.7323, 0.7948, 0.1204]]])
in0Ave84698 = tf.constant([[[[[0.0599, 0.0087]]], [[[0.2514, 0.7861]]]]])
in1Ave84698 = tf.constant([[[[[0.2426, 0.3132]]], [[[0.1813, 0.5179]]]]])
in0Con68515 = tf.constant([[[[0.6256, 0.3721]], [[0.0744, 0.7408]]]])
in0Con44287 = tf.constant([[[[0.2831]]]])
print (np.array2string(model.predict([in0Min52439,in1Min52439,in0Con13438,in0Ave84698,in1Ave84698,in0Con68515,in0Con44287],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot92503.png')

LMin52439 = minimum_layer([[[[0.3372], [0.1186]]], [[[0.6818], [0.6927]]]], Min52439), 
LCon13438 = concatenate_layer([Min52439,[[[0.6548, 0.5107, 0.0418], [0.7323, 0.7948, 0.1204]]]], 2, Con13438), 
LAve84698 = average_layer([[[[[[0.0599, 0.0087]]], [[[0.2514, 0.7861]]]]], [[[[[0.2426, 0.3132]]], [[[0.1813, 0.5179]]]]]], Ave84698), 
LRes34962 = reshape_layer(Ave84698, [2, 1, 2], Res34962), 
LCon68515 = concatenate_layer([Res34962,[[[[0.6256, 0.3721]], [[0.0744, 0.7408]]]]], 3, Con68515), 
LCon44287 = conv2D_layer([[[[0.2831]]]], 1, 1,[[[[0.6345, 0.7171, 0.2274, 0.1396]]]],[0, 0, 0, 0], 1, 1, false, 1, 1, Con44287), 
LZer43969 = zero_padding2D_layer(Con44287, 1, 0, 0, 0, Zer43969), 
LAve20666 = average_layer([Con68515,Zer43969], Ave20666), 
LRes84462 = reshape_layer(Ave20666, [2, 4], Res84462), 
LDot92503 = dot_layer(Con13438,Res84462, 1, 1, Dot92503), 
exec_layers([LMin52439,LCon13438,LAve84698,LRes34962,LCon68515,LCon44287,LZer43969,LAve20666,LRes84462,LDot92503],["Min52439","Con13438","Ave84698","Res34962","Con68515","Con44287","Zer43969","Ave20666","Res84462","Dot92503"],Dot92503,"Dot92503")

Actual (Unparsed): [[[0.0489822, 0.0778383, 0.1137056, 0.1090091], [0.1945062, 0.3657573, 0.2556346, 0.4075400], [0.1959829, 0.3808799, 0.2148969, 0.4051152], [0.0269989, 0.0548355, 0.0214294, 0.0547522]]]

Expected (Unparsed): [[[0.048982183134999996,0.077838322893,0.11370563254200002,0.109009081068],[0.19450621024249998,0.36575731131149997,0.255634616581,0.407539986274],[0.19598292742999998,0.380879957874,0.21489691595600002,0.405115205024],[0.026998937389999998,0.054835517801999994,0.021429411788,0.054752199752000005]]]

Actual:   [[[0.049, 0.0779, 0.1138, 0.1091], [0.1946, 0.3658, 0.2557, 0.4076], [0.196, 0.3809, 0.2149, 0.4052], [0.027, 0.0549, 0.0215, 0.0548]]]

Expected: [[[0.049, 0.0779, 0.1138, 0.1091], [0.1946, 0.3658, 0.2557, 0.4076], [0.196, 0.3809, 0.2149, 0.4052], [0.027, 0.0549, 0.0215, 0.0548]]]