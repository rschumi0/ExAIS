import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min78552 = tf.keras.layers.Input(shape=([2, 1]))
in1Min78552 = tf.keras.layers.Input(shape=([2, 1]))
in0Con51490 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con92891 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Mul68010 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul68010 = tf.keras.layers.Input(shape=([2, 2]))

Min78552 = keras.layers.Minimum(name = 'Min78552', )([in0Min78552,in1Min78552])
Glo81970 = keras.layers.GlobalAveragePooling1D(name = 'Glo81970', )(Min78552)
Res35803 = keras.layers.Reshape((1, 1), name = 'Res35803', )(Glo81970)
Res62761 = keras.layers.Reshape((1, 1, 1), name = 'Res62761', )(Res35803)
Res52030 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res52030', )(Res62761)
Con57176 = keras.layers.Conv3DTranspose(2, (1, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con57176', )(Res52030)
Res31207 = keras.layers.Reshape((1, 1, 2), name = 'Res31207', )(Con57176)
Con51490 = keras.layers.Concatenate(axis=3, name = 'Con51490', )([Res31207,in0Con51490])
Con92891 = keras.layers.Conv3D(2, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con92891', )(in0Con92891)
Res5086 = keras.layers.Reshape((1, 1, 4), name = 'Res5086', )(Con92891)
Mul68010 = keras.layers.Multiply(name = 'Mul68010', )([in0Mul68010,in1Mul68010])
Res46201 = keras.layers.Reshape((1, 1, 4), name = 'Res46201', )(Mul68010)
Add57442 = keras.layers.Add(name = 'Add57442', )([Res5086,Res46201])
Ave61184 = keras.layers.Average(name = 'Ave61184', )([Con51490,Add57442])
model = tf.keras.models.Model(inputs=[in0Min78552,in1Min78552,in0Con51490,in0Con92891,in0Mul68010,in1Mul68010], outputs=Ave61184)
w = model.get_layer('Con57176').get_weights() 
w[0] = np.array([[[[[0.8381], [0.6389]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con57176').set_weights(w) 
w = model.get_layer('Con92891').get_weights() 
w[0] = np.array([[[[[0.7484, 0.1032]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con92891').set_weights(w) 
in0Min78552 = tf.constant([[[0.4639], [0.5312]]])
in1Min78552 = tf.constant([[[0.8454], [0.6754]]])
in0Con51490 = tf.constant([[[[0.1249, 0.3983]]]])
in0Con92891 = tf.constant([[[[[0.0487], [0.8478]]]]])
in0Mul68010 = tf.constant([[[0.0847, 0.5205], [0.6513, 0.3374]]])
in1Mul68010 = tf.constant([[[0.7537, 0.156], [0.521, 0.6382]]])
print (np.array2string(model.predict([in0Min78552,in1Min78552,in0Con51490,in0Con92891,in0Mul68010,in1Mul68010],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave61184.png')

LMin78552 = minimum_layer([[[[0.4639], [0.5312]]], [[[0.8454], [0.6754]]]], Min78552), 
LGlo81970 = global_average_pooling1D_layer(Min78552, Glo81970), 
LRes35803 = reshape_layer(Glo81970, [1, 1], Res35803), 
LRes62761 = reshape_layer(Res35803, [1, 1, 1], Res62761), 
LRes52030 = reshape_layer(Res62761, [1, 1, 1, 1], Res52030), 
LCon57176 = conv3D_transpose_layer(Res52030, 1, 1, 1,[[[[[0.8381], [0.6389]]]]],[0, 0], 1, 1, 1, false, Con57176), 
LRes31207 = reshape_layer(Con57176, [1, 1, 2], Res31207), 
LCon51490 = concatenate_layer([Res31207,[[[[0.1249, 0.3983]]]]], 3, Con51490), 
LCon92891 = conv3D_layer([[[[[0.0487], [0.8478]]]]], 1, 1, 1,[[[[[0.7484, 0.1032]]]]],[0, 0], 1, 1, 1, true, 1, 1, 1, Con92891), 
LRes5086 = reshape_layer(Con92891, [1, 1, 4], Res5086), 
LMul68010 = multiply_layer([[[[0.0847, 0.5205], [0.6513, 0.3374]]], [[[0.7537, 0.156], [0.521, 0.6382]]]], Mul68010), 
LRes46201 = reshape_layer(Mul68010, [1, 1, 4], Res46201), 
LAdd57442 = add_layer([Res5086,Res46201], Add57442), 
LAve61184 = average_layer([Con51490,Add57442], Ave61184), 
exec_layers([LMin78552,LGlo81970,LRes35803,LRes62761,LRes52030,LCon57176,LRes31207,LCon51490,LCon92891,LRes5086,LMul68010,LRes46201,LAdd57442,LAve61184],["Min78552","Glo81970","Res35803","Res62761","Res52030","Con57176","Res31207","Con51490","Con92891","Res5086","Mul68010","Res46201","Add57442","Ave61184"],Ave61184,"Ave61184")

Actual (Unparsed): [[[[0.2586411, 0.2020543, 0.5493604, 0.3505608]]]]

Expected (Unparsed): [[[[0.25864106249999996,0.2020542675,0.5493604099999999,0.35056082]]]]

Actual:   [[[[0.2587, 0.2021, 0.5494, 0.3506]]]]

Expected: [[[[0.2587, 0.2021, 0.5494, 0.3506]]]]