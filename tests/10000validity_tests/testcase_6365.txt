import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min67397 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Min67397 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Min52278 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Min52278 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Con73953 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Zer45792 = tf.keras.layers.Input(shape=([1, 2]))
in0Ave98066 = tf.keras.layers.Input(shape=([1, 1]))
in0Con49190 = tf.keras.layers.Input(shape=([1, 1, 3]))
in0Dot86684 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot86684 = tf.keras.layers.Input(shape=([2, 2]))
in0PRe30353 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Con87824 = tf.keras.layers.Input(shape=([1, 1, 1]))

Min67397 = keras.layers.Minimum(name = 'Min67397', )([in0Min67397,in1Min67397])
Zer92743 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer92743', )(Min67397)
Min52278 = keras.layers.Minimum(name = 'Min52278', )([in0Min52278,in1Min52278])
Zer46245 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (1, 0)), name = 'Zer46245', )(Min52278)
Add29795 = keras.layers.Add(name = 'Add29795', )([Zer92743,Zer46245])
Res98411 = keras.layers.Reshape((2, 2, 3), name = 'Res98411', )(Add29795)
Con73953 = keras.layers.Concatenate(axis=3, name = 'Con73953', )([Res98411,in0Con73953])
Zer45792 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer45792', )(in0Zer45792)
Res37261 = keras.layers.Reshape((3, 2, 1), name = 'Res37261', )(Zer45792)
Res93351 = keras.layers.Reshape((3, 2, 1, 1), name = 'Res93351', )(Res37261)
Glo31410 = keras.layers.GlobalMaxPool3D(name = 'Glo31410', )(Res93351)
Ave98066 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave98066', )(in0Ave98066)
Res92452 = keras.layers.Reshape((1, 1, 1), name = 'Res92452', )(Ave98066)
Glo56252 = keras.layers.GlobalMaxPool2D(name = 'Glo56252', )(Res92452)
Min47047 = keras.layers.Minimum(name = 'Min47047', )([Glo31410,Glo56252])
Res71471 = keras.layers.Reshape((1, 1), name = 'Res71471', )(Min47047)
Res33196 = keras.layers.Reshape((1, 1, 1), name = 'Res33196', )(Res71471)
Con49190 = keras.layers.Concatenate(axis=3, name = 'Con49190', )([Res33196,in0Con49190])
Dot86684 = keras.layers.Dot(axes=(2, 1), name = 'Dot86684', )([in0Dot86684,in1Dot86684])
Res31132 = keras.layers.Reshape((2, 2, 1), name = 'Res31132', )(Dot86684)
Con5560 = keras.layers.Conv2D(4, (2, 2),strides=(1, 7), padding='valid', dilation_rate=(1, 1), name = 'Con5560', )(Res31132)
Sep76570 = keras.layers.SeparableConv2D(4, (1, 1),strides=(1, 1), padding='valid', name = 'Sep76570', )(Con5560)
PRe30353 = keras.layers.PReLU(name = 'PRe30353', input_shape=(2, 1, 1, 1))(in0PRe30353)
Res15254 = keras.layers.Reshape((2, 1, 1), name = 'Res15254', )(PRe30353)
Loc47526 = keras.layers.LocallyConnected2D(3, (1, 1),strides=(2, 1), name = 'Loc47526', )(Res15254)
Con87824 = keras.layers.Concatenate(axis=3, name = 'Con87824', )([Loc47526,in0Con87824])
Mul13266 = keras.layers.Multiply(name = 'Mul13266', )([Sep76570,Con87824])
Ave6188 = keras.layers.Average(name = 'Ave6188', )([Con49190,Mul13266])
Zer65679 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer65679', )(Ave6188)
Ave393 = keras.layers.Average(name = 'Ave393', )([Con73953,Zer65679])
model = tf.keras.models.Model(inputs=[in0Min67397,in1Min67397,in0Min52278,in1Min52278,in0Con73953,in0Zer45792,in0Ave98066,in0Con49190,in0Dot86684,in1Dot86684,in0PRe30353,in0Con87824], outputs=Ave393)
w = model.get_layer('Con5560').get_weights() 
w[0] = np.array([[[[0.7681, 0.9759, 0.691, 0.0839]], [[0.7339, 0.3755, 0.6214, 0.9387]]], [[[0.4603, 0.7484, 0.2285, 0.4153]], [[0.2506, 0.1169, 0.2705, 0.6977]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con5560').set_weights(w) 
w = model.get_layer('Sep76570').get_weights() 
w[0] = np.array([[[[0.302], [0.7404], [0.3147], [0.5226]]]])
w[1] = np.array([[[[0.2936, 0.7228, 0.4428, 0.0244], [0.6237, 0.2578, 0.8769, 0.0152], [0.5679, 0.0427, 0.4333, 0.9379], [0.4828, 0.7286, 0.2344, 0.0481]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep76570').set_weights(w) 
w = model.get_layer('PRe30353').get_weights() 
w[0] = np.array([[[[0.0637]]], [[[0.7298]]]])
model.get_layer('PRe30353').set_weights(w) 
w = model.get_layer('Loc47526').get_weights() 
w[0] = np.array([[[0.0886, 0.7187, 0.0901]]])
w[1] = np.array([[[0, 0, 0]]])
model.get_layer('Loc47526').set_weights(w) 
in0Min67397 = tf.constant([[[[[0.6933]], [[0.6692]]], [[[0.3132]], [[0.5817]]]]])
in1Min67397 = tf.constant([[[[[0.5762]], [[0.4891]]], [[[0.3205]], [[0.0845]]]]])
in0Min52278 = tf.constant([[[[[0.7591], [0.3777]], [[0.4319], [0.049]]]]])
in1Min52278 = tf.constant([[[[[0.3588], [0.744]], [[0.4842], [0.8474]]]]])
in0Con73953 = tf.constant([[[[0.5492], [0.2049]], [[0.5136], [0.2857]]]])
in0Zer45792 = tf.constant([[[1.2067, 1.7802]]])
in0Ave98066 = tf.constant([[[1.7033]]])
in0Con49190 = tf.constant([[[[0.5999, 0.3525, 0.5536]]]])
in0Dot86684 = tf.constant([[[0.8416, 0.9423], [0.2014, 0.2148]]])
in1Dot86684 = tf.constant([[[0.5073, 0.9206], [0.2509, 0.3531]]])
in0PRe30353 = tf.constant([[[[[0.11]]], [[[0.7136]]]]])
in0Con87824 = tf.constant([[[[0.6153]]]])
print (np.array2string(model.predict([in0Min67397,in1Min67397,in0Min52278,in1Min52278,in0Con73953,in0Zer45792,in0Ave98066,in0Con49190,in0Dot86684,in1Dot86684,in0PRe30353,in0Con87824],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave393.png')

LMin67397 = minimum_layer([[[[[[0.6933]], [[0.6692]]], [[[0.3132]], [[0.5817]]]]], [[[[[0.5762]], [[0.4891]]], [[[0.3205]], [[0.0845]]]]]], Min67397), 
LZer92743 = zero_padding3D_layer(Min67397, 0, 0, 0, 0, 2, 0, Zer92743), 
LMin52278 = minimum_layer([[[[[[0.7591], [0.3777]], [[0.4319], [0.049]]]]], [[[[[0.3588], [0.744]], [[0.4842], [0.8474]]]]]], Min52278), 
LZer46245 = zero_padding3D_layer(Min52278, 1, 0, 0, 0, 1, 0, Zer46245), 
LAdd29795 = add_layer([Zer92743,Zer46245], Add29795), 
LRes98411 = reshape_layer(Add29795, [2, 2, 3], Res98411), 
LCon73953 = concatenate_layer([Res98411,[[[[0.5492], [0.2049]], [[0.5136], [0.2857]]]]], 3, Con73953), 
LZer45792 = zero_padding1D_layer([[[1.2067, 1.7802]]], 1, 1, Zer45792), 
LRes37261 = reshape_layer(Zer45792, [3, 2, 1], Res37261), 
LRes93351 = reshape_layer(Res37261, [3, 2, 1, 1], Res93351), 
LGlo31410 = global_max_pool3D_layer(Res93351, Glo31410), 
LAve98066 = average_pooling1D_layer([[[1.7033]]], 1, Ave98066), 
LRes92452 = reshape_layer(Ave98066, [1, 1, 1], Res92452), 
LGlo56252 = global_max_pool2D_layer(Res92452, Glo56252), 
LMin47047 = minimum_layer([Glo31410,Glo56252], Min47047), 
LRes71471 = reshape_layer(Min47047, [1, 1], Res71471), 
LRes33196 = reshape_layer(Res71471, [1, 1, 1], Res33196), 
LCon49190 = concatenate_layer([Res33196,[[[[0.5999, 0.3525, 0.5536]]]]], 3, Con49190), 
LDot86684 = dot_layer([[[0.8416, 0.9423], [0.2014, 0.2148]]], [[[0.5073, 0.9206], [0.2509, 0.3531]]], 2, 1, Dot86684), 
LRes31132 = reshape_layer(Dot86684, [2, 2, 1], Res31132), 
LCon5560 = conv2D_layer(Res31132, 2, 2,[[[[0.7681, 0.9759, 0.691, 0.0839]], [[0.7339, 0.3755, 0.6214, 0.9387]]], [[[0.4603, 0.7484, 0.2285, 0.4153]], [[0.2506, 0.1169, 0.2705, 0.6977]]]],[0, 0, 0, 0], 1, 7, false, 1, 1, Con5560), 
LSep76570 = separable_conv2D_layer(Con5560, 1, 1,[[[[[0.302], [0.7404], [0.3147], [0.5226]]]],[[[[0.2936, 0.7228, 0.4428, 0.0244], [0.6237, 0.2578, 0.8769, 0.0152], [0.5679, 0.0427, 0.4333, 0.9379], [0.4828, 0.7286, 0.2344, 0.0481]]]]],[0, 0, 0, 0], 1, 1, false, Sep76570), 
LPRe30353 = prelu_layer([[[[[0.11]]], [[[0.7136]]]]], [[[[0.0637]]], [[[0.7298]]]], PRe30353), 
LRes15254 = reshape_layer(PRe30353, [2, 1, 1], Res15254), 
LLoc47526 = locally_connected2D_layer(Res15254, 1, 1,[[[0.0886, 0.7187, 0.0901]]],[[[0, 0, 0]]], 2, 1, Loc47526), 
LCon87824 = concatenate_layer([Loc47526,[[[[0.6153]]]]], 3, Con87824), 
LMul13266 = multiply_layer([Sep76570,Con87824], Mul13266), 
LAve6188 = average_layer([Con49190,Mul13266], Ave6188), 
LZer65679 = zero_padding2D_layer(Ave6188, 1, 0, 1, 0, Zer65679), 
LAve393 = average_layer([Con73953,Zer65679], Ave393), 
exec_layers([LMin67397,LZer92743,LMin52278,LZer46245,LAdd29795,LRes98411,LCon73953,LZer45792,LRes37261,LRes93351,LGlo31410,LAve98066,LRes92452,LGlo56252,LMin47047,LRes71471,LRes33196,LCon49190,LDot86684,LRes31132,LCon5560,LSep76570,LPRe30353,LRes15254,LLoc47526,LCon87824,LMul13266,LAve6188,LZer65679,LAve393],["Min67397","Zer92743","Min52278","Zer46245","Add29795","Res98411","Con73953","Zer45792","Res37261","Res93351","Glo31410","Ave98066","Res92452","Glo56252","Min47047","Res71471","Res33196","Con49190","Dot86684","Res31132","Con5560","Sep76570","PRe30353","Res15254","Loc47526","Con87824","Mul13266","Ave6188","Zer65679","Ave393"],Ave393,"Ave393")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.2881000, 0.2746000], [0.0000000, 0.0000000, 0.2445500, 0.1024500]], [[0.0000000, 0.1794000, 0.3454500, 0.2568000], [0.4288732, 0.3872239, 0.1581368, 0.3470764]]]]

Expected (Unparsed): [[[[0,0,0.2881,0.2746],[0,0,0.24455,0.10245]],[[0,0.1794,0.34545,0.2568],[0.42887322467647176,0.3872239427180274,0.1581368452964117,0.34707643724036685]]]]

Actual:   [[[[0, 0, 0.2881, 0.2746], [0, 0, 0.2446, 0.1025]], [[0, 0.1794, 0.3455, 0.2568], [0.4289, 0.3873, 0.1582, 0.3471]]]]

Expected: [[[[0, 0, 0.2881, 0.2746], [0, 0, 0.2446, 0.1025]], [[0, 0.1794, 0.3455, 0.2568], [0.4289, 0.3873, 0.1582, 0.3471]]]]