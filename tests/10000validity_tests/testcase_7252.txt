import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave73725 = tf.keras.layers.Input(shape=([1, 2, 2]))

Ave73725 = keras.layers.AveragePooling2D(pool_size=(1, 2), name = 'Ave73725', )(in0Ave73725)
Res87855 = keras.layers.Reshape((1, 2), name = 'Res87855', )(Ave73725)
Sim59620 = keras.layers.SimpleRNN(3,name = 'Sim59620', )(Res87855)
Res1810 = keras.layers.Reshape((3, 1), name = 'Res1810', )(Sim59620)
Per32029 = keras.layers.Permute((1,2), name = 'Per32029',)(Res1810)
model = tf.keras.models.Model(inputs=[in0Ave73725], outputs=Per32029)
w = model.get_layer('Sim59620').get_weights() 
w[0] = np.array([[9, 9, 3], [4, 3, 1]])
w[1] = np.array([[7, 2, 2], [2, 9, 9], [2, 9, 1]])
w[2] = np.array([9, 8, 4])
model.get_layer('Sim59620').set_weights(w) 
in0Ave73725 = tf.constant([[[[1.8312, 1.6591], [1.329, 1.1124]]]])
print (np.array2string(model.predict([in0Ave73725],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Per32029.png')

LAve73725 = average_pooling2D_layer([[[[1.8312, 1.6591], [1.329, 1.1124]]]], 1, 2, Ave73725), 
LRes87855 = reshape_layer(Ave73725, [1, 2], Res87855), 
LSim59620 = simple_rnn_layer(Res87855,[[9, 9, 3], [4, 3, 1]],[[7, 2, 2], [2, 9, 9], [2, 9, 1]],[9, 8, 4], Sim59620), 
LRes1810 = reshape_layer(Sim59620, [3, 1], Res1810), 
LPer32029 = permute_layer(Res1810, 1,2, Per32029), 
exec_layers([LAve73725,LRes87855,LSim59620,LRes1810,LPer32029],["Ave73725","Res87855","Sim59620","Res1810","Per32029"],Per32029,"Per32029")

Actual (Unparsed): [[[1.0000000], [1.0000000], [1.0000000]]]

Expected (Unparsed): [[[1.0],[1.0],[0.9999999967962788]]]

Actual:   [[[1], [1], [1]]]

Expected: [[[1], [1], [1]]]