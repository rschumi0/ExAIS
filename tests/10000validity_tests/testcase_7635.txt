import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sep41262 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con55541 = tf.keras.layers.Input(shape=([2, 1, 3]))
in0Cro34354 = tf.keras.layers.Input(shape=([1, 4, 4]))

Sep41262 = keras.layers.SeparableConv2D(2, (2, 1),strides=(2, 2), padding='valid', name = 'Sep41262', )(in0Sep41262)
Fla72276 = keras.layers.Flatten(name = 'Fla72276', )(Sep41262)
Mas4634 = keras.layers.Masking(mask_value=1, name = 'Mas4634', )(Fla72276)
Res33610 = keras.layers.Reshape((2, 1), name = 'Res33610', )(Mas4634)
Res97816 = keras.layers.Reshape((2, 1, 1), name = 'Res97816', )(Res33610)
Con55541 = keras.layers.Concatenate(axis=3, name = 'Con55541', )([Res97816,in0Con55541])
Cro34354 = keras.layers.Cropping2D(cropping=((0, 0), (0, 3)), name = 'Cro34354', )(in0Cro34354)
Zer8745 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer8745', )(Cro34354)
Ave95916 = keras.layers.Average(name = 'Ave95916', )([Con55541,Zer8745])
model = tf.keras.models.Model(inputs=[in0Sep41262,in0Con55541,in0Cro34354], outputs=Ave95916)
w = model.get_layer('Sep41262').get_weights() 
w[0] = np.array([[[[0.4322]]], [[[0.7459]]]])
w[1] = np.array([[[[0.8068, 0.3991]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep41262').set_weights(w) 
in0Sep41262 = tf.constant([[[[0.8446]], [[0.1642]]]])
in0Con55541 = tf.constant([[[[0.2454, 0.4362, 0.1179]], [[0.7641, 0.1686, 0.537]]]])
in0Cro34354 = tf.constant([[[[1.6372, 1.0844, 1.9773, 1.1244], [1.0394, 1.4879, 1.1134, 1.4172], [1.259, 1.1221, 1.0438, 1.7308], [1.8467, 1.2427, 1.932, 1.3594]]]])
print (np.array2string(model.predict([in0Sep41262,in0Con55541,in0Cro34354],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave95916.png')

LSep41262 = separable_conv2D_layer([[[[0.8446]], [[0.1642]]]], 2, 1,[[[[[0.4322]]], [[[0.7459]]]],[[[[0.8068, 0.3991]]]]],[0, 0], 2, 2, false, Sep41262), 
LFla72276 = flatten_layer(Sep41262, Fla72276), 
LMas4634 = masking_layer(Fla72276, 1, Mas4634), 
LRes33610 = reshape_layer(Mas4634, [2, 1], Res33610), 
LRes97816 = reshape_layer(Res33610, [2, 1, 1], Res97816), 
LCon55541 = concatenate_layer([Res97816,[[[[0.2454, 0.4362, 0.1179]], [[0.7641, 0.1686, 0.537]]]]], 3, Con55541), 
LCro34354 = cropping2D_layer([[[[1.6372, 1.0844, 1.9773, 1.1244], [1.0394, 1.4879, 1.1134, 1.4172], [1.259, 1.1221, 1.0438, 1.7308], [1.8467, 1.2427, 1.932, 1.3594]]]], 0, 0, 0, 3, Cro34354), 
LZer8745 = zero_padding2D_layer(Cro34354, 1, 0, 0, 0, Zer8745), 
LAve95916 = average_layer([Con55541,Zer8745], Ave95916), 
exec_layers([LSep41262,LFla72276,LMas4634,LRes33610,LRes97816,LCon55541,LCro34354,LZer8745,LAve95916],["Sep41262","Fla72276","Mas4634","Res33610","Res97816","Con55541","Cro34354","Zer8745","Ave95916"],Ave95916,"Ave95916")

Actual (Unparsed): [[[[0.1966627, 0.1227000, 0.2181000, 0.0589500]], [[0.9158832, 0.9242500, 1.0729500, 0.8307000]]]]

Expected (Unparsed): [[[[0.19666270385999998,0.1227,0.2181,0.05895]],[[0.915883199195,0.92425,1.07295,0.8307]]]]

Actual:   [[[[0.1967, 0.1227, 0.2181, 0.059]], [[0.9159, 0.9243, 1.073, 0.8307]]]]

Expected: [[[[0.1967, 0.1227, 0.2181, 0.059]], [[0.9159, 0.9243, 1.073, 0.8307]]]]