import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min95901 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Min95901 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Sub86747 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub86747 = tf.keras.layers.Input(shape=([2, 3]))
in0Ave91990 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Ave91990 = tf.keras.layers.Input(shape=([1, 1, 1]))

Min95901 = keras.layers.Minimum(name = 'Min95901', )([in0Min95901,in1Min95901])
Sub86747 = keras.layers.Subtract(name = 'Sub86747', )([in0Sub86747,in1Sub86747])
Sep87896 = keras.layers.SeparableConv1D(3, (2),strides=(2), padding='same', name = 'Sep87896', )(Sub86747)
LST66945 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST66945', )(Sep87896)
Res40117 = keras.layers.Reshape((2, 1), name = 'Res40117', )(LST66945)
Res94502 = keras.layers.Reshape((2, 1, 1), name = 'Res94502', )(Res40117)
Ave91990 = keras.layers.Average(name = 'Ave91990', )([in0Ave91990,in1Ave91990])
Zer91702 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer91702', )(Ave91990)
Sub3740 = keras.layers.Subtract(name = 'Sub3740', )([Res94502,Zer91702])
Ave75048 = keras.layers.Average(name = 'Ave75048', )([Min95901,Sub3740])
model = tf.keras.models.Model(inputs=[in0Min95901,in1Min95901,in0Sub86747,in1Sub86747,in0Ave91990,in1Ave91990], outputs=Ave75048)
w = model.get_layer('Sep87896').get_weights() 
w[0] = np.array([[[0.459], [0.1737], [0.9416]], [[0.9684], [0.3494], [0.4714]]])
w[1] = np.array([[[0.0052, 0.2769, 0.1492], [0.2683, 0.4135, 0.5083], [0.6044, 0.5589, 0.571]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep87896').set_weights(w) 
w = model.get_layer('LST66945').get_weights() 
w[0] = np.array([[7, 1, 9, 1, 8, 7, 4, 6], [1, 9, 9, 8, 3, 1, 10, 1], [2, 7, 5, 6, 4, 3, 7, 5]])
w[1] = np.array([[7, 6, 2, 9, 8, 5, 7, 5], [4, 9, 3, 8, 9, 9, 9, 9]])
w[2] = np.array([3, 3, 3, 5, 8, 10, 6, 6])
model.get_layer('LST66945').set_weights(w) 
in0Min95901 = tf.constant([[[[0.7382]], [[0.7971]]]])
in1Min95901 = tf.constant([[[[0.8471]], [[0.6087]]]])
in0Sub86747 = tf.constant([[[0.1425, 0.8577, 0.8814], [0.5575, 0.3259, 0.0525]]])
in1Sub86747 = tf.constant([[[0.2552, 0.3544, 0.3806], [0.8631, 0.4979, 0.5054]]])
in0Ave91990 = tf.constant([[[[0.9217]]]])
in1Ave91990 = tf.constant([[[[0.1561]]]])
print (np.array2string(model.predict([in0Min95901,in1Min95901,in0Sub86747,in1Sub86747,in0Ave91990,in1Ave91990],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave75048.png')

LMin95901 = minimum_layer([[[[[0.7382]], [[0.7971]]]], [[[[0.8471]], [[0.6087]]]]], Min95901), 
LSub86747 = subtract_layer([[[0.1425, 0.8577, 0.8814], [0.5575, 0.3259, 0.0525]]], [[[0.2552, 0.3544, 0.3806], [0.8631, 0.4979, 0.5054]]], Sub86747), 
LSep87896 = separable_conv1D_layer(Sub86747, 2,[[[[0.459], [0.1737], [0.9416]], [[0.9684], [0.3494], [0.4714]]],[[[0.0052, 0.2769, 0.1492], [0.2683, 0.4135, 0.5083], [0.6044, 0.5589, 0.571]]]],[0, 0, 0], 2, true, Sep87896), 
LLST66945 = lstm_layer(Sep87896,[[7, 1, 9, 1, 8, 7, 4, 6], [1, 9, 9, 8, 3, 1, 10, 1], [2, 7, 5, 6, 4, 3, 7, 5]],[[7, 6, 2, 9, 8, 5, 7, 5], [4, 9, 3, 8, 9, 9, 9, 9]],[3, 3, 3, 5, 8, 10, 6, 6], LST66945), 
LRes40117 = reshape_layer(LST66945, [2, 1], Res40117), 
LRes94502 = reshape_layer(Res40117, [2, 1, 1], Res94502), 
LAve91990 = average_layer([[[[[0.9217]]]], [[[[0.1561]]]]], Ave91990), 
LZer91702 = zero_padding2D_layer(Ave91990, 1, 0, 0, 0, Zer91702), 
LSub3740 = subtract_layer(Res94502,Zer91702, Sub3740), 
LAve75048 = average_layer([Min95901,Sub3740], Ave75048), 
exec_layers([LMin95901,LSub86747,LSep87896,LLST66945,LRes40117,LRes94502,LAve91990,LZer91702,LSub3740,LAve75048],["Min95901","Sub86747","Sep87896","LST66945","Res40117","Res94502","Ave91990","Zer91702","Sub3740","Ave75048"],Ave75048,"Ave75048")

Actual (Unparsed): [[[[0.7472219]], [[0.4130828]]]]

Expected (Unparsed): [[[[0.7472218627447761]],[[0.4130827710070009]]]]

Actual:   [[[[0.7473]], [[0.4131]]]]

Expected: [[[[0.7473]], [[0.4131]]]]