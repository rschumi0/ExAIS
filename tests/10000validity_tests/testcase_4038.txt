import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave3159 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Sub8948 = tf.keras.layers.Input(shape=([3]))
in1Sub8948 = tf.keras.layers.Input(shape=([3]))
in0Con7058 = tf.keras.layers.Input(shape=([5]))
in0Mul93975 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul93975 = tf.keras.layers.Input(shape=([1, 1]))
in0Mul73697 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul73697 = tf.keras.layers.Input(shape=([1, 1]))

Ave3159 = keras.layers.AveragePooling2D(pool_size=(1, 2), strides=(2, 1), padding='same', name = 'Ave3159', )(in0Ave3159)
Res9750 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res9750', )(Ave3159)
Con42952 = keras.layers.Conv3D(4, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con42952', )(Res9750)
Res78672 = keras.layers.Reshape((1, 2, 4), name = 'Res78672', )(Con42952)
Res15980 = keras.layers.Reshape((1, 8), name = 'Res15980', )(Res78672)
Fla6991 = keras.layers.Flatten(name = 'Fla6991', )(Res15980)
Sub8948 = keras.layers.Subtract(name = 'Sub8948', )([in0Sub8948,in1Sub8948])
Con7058 = keras.layers.Concatenate(axis=1, name = 'Con7058', )([Sub8948,in0Con7058])
Ave24637 = keras.layers.Average(name = 'Ave24637', )([Fla6991,Con7058])
Res60716 = keras.layers.Reshape((8, 1), name = 'Res60716', )(Ave24637)
Mul93975 = keras.layers.Multiply(name = 'Mul93975', )([in0Mul93975,in1Mul93975])
Mul73697 = keras.layers.Multiply(name = 'Mul73697', )([in0Mul73697,in1Mul73697])
Dot87063 = keras.layers.Dot(axes=(2, 2), name = 'Dot87063', )([Mul93975,Mul73697])
Zer84663 = keras.layers.ZeroPadding1D(padding=((7, 0)), name = 'Zer84663', )(Dot87063)
Max14195 = keras.layers.Maximum(name = 'Max14195', )([Res60716,Zer84663])
model = tf.keras.models.Model(inputs=[in0Ave3159,in0Sub8948,in1Sub8948,in0Con7058,in0Mul93975,in1Mul93975,in0Mul73697,in1Mul73697], outputs=Max14195)
w = model.get_layer('Con42952').get_weights() 
w[0] = np.array([[[[[0.3517, 0.3076, 0.22, 0.2228]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con42952').set_weights(w) 
in0Ave3159 = tf.constant([[[[1.6073], [1.6227]], [[1.4075], [1.6709]]]])
in0Sub8948 = tf.constant([[0.1797, 0.5725, 0.6359]])
in1Sub8948 = tf.constant([[0.2223, 0.1672, 0.9721]])
in0Con7058 = tf.constant([[0.5735, 0.1502, 0.0197, 0.7177, 0.3535]])
in0Mul93975 = tf.constant([[[0.5888]]])
in1Mul93975 = tf.constant([[[0.9409]]])
in0Mul73697 = tf.constant([[[0.0311]]])
in1Mul73697 = tf.constant([[[0.0187]]])
print (np.array2string(model.predict([in0Ave3159,in0Sub8948,in1Sub8948,in0Con7058,in0Mul93975,in1Mul93975,in0Mul73697,in1Mul73697],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max14195.png')

LAve3159 = average_pooling2D_layer([[[[1.6073], [1.6227]], [[1.4075], [1.6709]]]], 1, 2, 2, 1, true, Ave3159), 
LRes9750 = reshape_layer(Ave3159, [1, 2, 1, 1], Res9750), 
LCon42952 = conv3D_layer(Res9750, 1, 1, 1,[[[[[0.3517, 0.3076, 0.22, 0.2228]]]]],[0, 0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con42952), 
LRes78672 = reshape_layer(Con42952, [1, 2, 4], Res78672), 
LRes15980 = reshape_layer(Res78672, [1, 8], Res15980), 
LFla6991 = flatten_layer(Res15980, Fla6991), 
LSub8948 = subtract_layer([[0.1797, 0.5725, 0.6359]], [[0.2223, 0.1672, 0.9721]], Sub8948), 
LCon7058 = concatenate_layer([Sub8948,[[0.5735, 0.1502, 0.0197, 0.7177, 0.3535]]], 1, Con7058), 
LAve24637 = average_layer([Fla6991,Con7058], Ave24637), 
LRes60716 = reshape_layer(Ave24637, [8, 1], Res60716), 
LMul93975 = multiply_layer([[[[0.5888]]], [[[0.9409]]]], Mul93975), 
LMul73697 = multiply_layer([[[[0.0311]]], [[[0.0187]]]], Mul73697), 
LDot87063 = dot_layer(Mul93975,Mul73697, 2, 2, Dot87063), 
LZer84663 = zero_padding1D_layer(Dot87063, 7, 0, Zer84663), 
LMax14195 = maximum_layer([Res60716,Zer84663], Max14195), 
exec_layers([LAve3159,LRes9750,LCon42952,LRes78672,LRes15980,LFla6991,LSub8948,LCon7058,LAve24637,LRes60716,LMul93975,LMul73697,LDot87063,LZer84663,LMax14195],["Ave3159","Res9750","Con42952","Res78672","Res15980","Fla6991","Sub8948","Con7058","Ave24637","Res60716","Mul93975","Mul73697","Dot87063","Zer84663","Max14195"],Max14195,"Max14195")

Actual (Unparsed): [[[0.2626978], [0.4510370], [0.0095500], [0.4666610], [0.3604518], [0.2594213], [0.5373470], [0.3575188]]]

Expected (Unparsed): [[[0.26269775],[0.451037],[0.00955000000000003],[0.466661],[0.360451795],[0.25942126],[0.537347],[0.35751878]]]

Actual:   [[[0.2627], [0.4511], [0.0096], [0.4667], [0.3605], [0.2595], [0.5374], [0.3576]]]

Expected: [[[0.2627], [0.4511], [0.0096], [0.4667], [0.3605], [0.2595], [0.5374], [0.3576]]]