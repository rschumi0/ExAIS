import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul90143 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Mul90143 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con26179 = tf.keras.layers.Input(shape=([4]))
in0Sub92021 = tf.keras.layers.Input(shape=([2, 3, 3, 2]))
in1Sub92021 = tf.keras.layers.Input(shape=([2, 3, 3, 2]))
in0Min56752 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Min56752 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))

Mul90143 = keras.layers.Multiply(name = 'Mul90143', )([in0Mul90143,in1Mul90143])
Max17129 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 4), padding='same', name = 'Max17129', )(Mul90143)
Res41353 = keras.layers.Reshape((1, 2), name = 'Res41353', )(Max17129)
Fla49346 = keras.layers.Flatten(name = 'Fla49346', )(Res41353)
Con26179 = keras.layers.Concatenate(axis=1, name = 'Con26179', )([Fla49346,in0Con26179])
Sub92021 = keras.layers.Subtract(name = 'Sub92021', )([in0Sub92021,in1Sub92021])
Res82774 = keras.layers.Reshape((2, 3, 6), name = 'Res82774', )(Sub92021)
Glo43458 = keras.layers.GlobalAveragePooling2D(name = 'Glo43458', )(Res82774)
Max72820 = keras.layers.Maximum(name = 'Max72820', )([Con26179,Glo43458])
Res37281 = keras.layers.Reshape((6, 1), name = 'Res37281', )(Max72820)
Res56227 = keras.layers.Reshape((6, 1, 1), name = 'Res56227', )(Res37281)
Res23954 = keras.layers.Reshape((6, 1, 1, 1), name = 'Res23954', )(Res56227)
Min56752 = keras.layers.Minimum(name = 'Min56752', )([in0Min56752,in1Min56752])
Res11846 = keras.layers.Reshape((1, 1, 2), name = 'Res11846', )(Min56752)
Res55494 = keras.layers.Reshape((1, 2), name = 'Res55494', )(Res11846)
LST94211 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST94211', )(Res55494)
Res16678 = keras.layers.Reshape((2, 1), name = 'Res16678', )(LST94211)
Res65665 = keras.layers.Reshape((2, 1, 1), name = 'Res65665', )(Res16678)
Res98820 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res98820', )(Res65665)
Cro33463 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro33463', )(Res98820)
Zer21824 = keras.layers.ZeroPadding3D(padding=((4, 0), (0, 0), (0, 0)), name = 'Zer21824', )(Cro33463)
Max76869 = keras.layers.Maximum(name = 'Max76869', )([Res23954,Zer21824])
model = tf.keras.models.Model(inputs=[in0Mul90143,in1Mul90143,in0Con26179,in0Sub92021,in1Sub92021,in0Min56752,in1Min56752], outputs=Max76869)
w = model.get_layer('LST94211').get_weights() 
w[0] = np.array([[7, 9, 9, 6, 8, 9, 4, 4], [1, 4, 7, 4, 6, 7, 10, 3]])
w[1] = np.array([[9, 4, 7, 9, 8, 3, 5, 5], [5, 8, 6, 2, 6, 3, 10, 4]])
w[2] = np.array([3, 10, 8, 1, 8, 8, 9, 3])
model.get_layer('LST94211').set_weights(w) 
in0Mul90143 = tf.constant([[[[0.8467, 0.7125]]]])
in1Mul90143 = tf.constant([[[[0.3712, 0.424]]]])
in0Con26179 = tf.constant([[0.237, 0.9792, 0.0949, 0.1995]])
in0Sub92021 = tf.constant([[[[[0.553, 0.7512], [0.8278, 0.3511], [0.7411, 0.3584]], [[0.6689, 0.2303], [0.8561, 0.0538], [0.8853, 0.5879]], [[0.7578, 0.94], [0.1623, 0.4949], [0.872, 0.8401]]], [[[0.622, 0.3201], [0.9548, 0.1046], [0.9833, 0.4071]], [[0.5287, 0.6214], [0.7592, 0.5749], [0.058, 0.9878]], [[0.0148, 0.2782], [0.9723, 0.5058], [0.638, 0.9858]]]]])
in1Sub92021 = tf.constant([[[[[0.716, 0.6481], [0.0356, 0.8336], [0.1075, 0.909]], [[0.6637, 0.8931], [0.4213, 0.5008], [0.8235, 0.4586]], [[0.7761, 0.1881], [0.7089, 0.6019], [0.6036, 0.6594]]], [[[0.7821, 0.868], [0.2037, 0.231], [0.1678, 0.3945]], [[0.6487, 0.3459], [0.9085, 0.9235], [0.5908, 0.29]], [[0.6036, 0.1462], [0.8458, 0.7794], [0.1668, 0.5716]]]]])
in0Min56752 = tf.constant([[[[[0.9809, 0.5907]]]]])
in1Min56752 = tf.constant([[[[[0.1783, 0.6407]]]]])
print (np.array2string(model.predict([in0Mul90143,in1Mul90143,in0Con26179,in0Sub92021,in1Sub92021,in0Min56752,in1Min56752],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max76869.png')

LMul90143 = multiply_layer([[[[[0.8467, 0.7125]]]], [[[[0.3712, 0.424]]]]], Mul90143), 
LMax17129 = max_pool2D_layer(Mul90143, 1, 1, 1, 4, true, Max17129), 
LRes41353 = reshape_layer(Max17129, [1, 2], Res41353), 
LFla49346 = flatten_layer(Res41353, Fla49346), 
LCon26179 = concatenate_layer([Fla49346,[[0.237, 0.9792, 0.0949, 0.1995]]], 1, Con26179), 
LSub92021 = subtract_layer([[[[[0.553, 0.7512], [0.8278, 0.3511], [0.7411, 0.3584]], [[0.6689, 0.2303], [0.8561, 0.0538], [0.8853, 0.5879]], [[0.7578, 0.94], [0.1623, 0.4949], [0.872, 0.8401]]], [[[0.622, 0.3201], [0.9548, 0.1046], [0.9833, 0.4071]], [[0.5287, 0.6214], [0.7592, 0.5749], [0.058, 0.9878]], [[0.0148, 0.2782], [0.9723, 0.5058], [0.638, 0.9858]]]]], [[[[[0.716, 0.6481], [0.0356, 0.8336], [0.1075, 0.909]], [[0.6637, 0.8931], [0.4213, 0.5008], [0.8235, 0.4586]], [[0.7761, 0.1881], [0.7089, 0.6019], [0.6036, 0.6594]]], [[[0.7821, 0.868], [0.2037, 0.231], [0.1678, 0.3945]], [[0.6487, 0.3459], [0.9085, 0.9235], [0.5908, 0.29]], [[0.6036, 0.1462], [0.8458, 0.7794], [0.1668, 0.5716]]]]], Sub92021), 
LRes82774 = reshape_layer(Sub92021, [2, 3, 6], Res82774), 
LGlo43458 = global_average_pooling2D_layer(Res82774, Glo43458), 
LMax72820 = maximum_layer([Con26179,Glo43458], Max72820), 
LRes37281 = reshape_layer(Max72820, [6, 1], Res37281), 
LRes56227 = reshape_layer(Res37281, [6, 1, 1], Res56227), 
LRes23954 = reshape_layer(Res56227, [6, 1, 1, 1], Res23954), 
LMin56752 = minimum_layer([[[[[[0.9809, 0.5907]]]]], [[[[[0.1783, 0.6407]]]]]], Min56752), 
LRes11846 = reshape_layer(Min56752, [1, 1, 2], Res11846), 
LRes55494 = reshape_layer(Res11846, [1, 2], Res55494), 
LLST94211 = lstm_layer(Res55494,[[7, 9, 9, 6, 8, 9, 4, 4], [1, 4, 7, 4, 6, 7, 10, 3]],[[9, 4, 7, 9, 8, 3, 5, 5], [5, 8, 6, 2, 6, 3, 10, 4]],[3, 10, 8, 1, 8, 8, 9, 3], LST94211), 
LRes16678 = reshape_layer(LST94211, [2, 1], Res16678), 
LRes65665 = reshape_layer(Res16678, [2, 1, 1], Res65665), 
LRes98820 = reshape_layer(Res65665, [2, 1, 1, 1], Res98820), 
LCro33463 = cropping3D_layer(Res98820, 0, 0, 0, 0, 0, 0, Cro33463), 
LZer21824 = zero_padding3D_layer(Cro33463, 4, 0, 0, 0, 0, 0, Zer21824), 
LMax76869 = maximum_layer([Res23954,Zer21824], Max76869), 
exec_layers([LMul90143,LMax17129,LRes41353,LFla49346,LCon26179,LSub92021,LRes82774,LGlo43458,LMax72820,LRes37281,LRes56227,LRes23954,LMin56752,LRes11846,LRes55494,LLST94211,LRes16678,LRes65665,LRes98820,LCro33463,LZer21824,LMax76869],["Mul90143","Max17129","Res41353","Fla49346","Con26179","Sub92021","Res82774","Glo43458","Max72820","Res37281","Res56227","Res23954","Min56752","Res11846","Res55494","LST94211","Res16678","Res65665","Res98820","Cro33463","Zer21824","Max76869"],Max76869,"Max76869")

Actual (Unparsed): [[[[[0.3142950]]], [[[0.3021000]]], [[[0.2370000]]], [[[0.9792000]]], [[[0.7582756]]], [[[0.7584483]]]]]

Expected (Unparsed): [[[[[0.31429503999999997]]],[[[0.3021]]],[[[0.237]]],[[[0.9792]]],[[[0.758275615866894]]],[[[0.7584482896557798]]]]]

Actual:   [[[[[0.3143]]], [[[0.3021]]], [[[0.237]]], [[[0.9792]]], [[[0.7583]]], [[[0.7585]]]]]

Expected: [[[[[0.3143]]], [[[0.3021]]], [[[0.237]]], [[[0.9792]]], [[[0.7583]]], [[[0.7585]]]]]