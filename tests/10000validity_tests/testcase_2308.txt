import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con91202 = tf.keras.layers.Input(shape=([1, 1]))
in0Con23065 = tf.keras.layers.Input(shape=([2]))
in0LST53898 = tf.keras.layers.Input(shape=([3, 3]))
in0Con60192 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Mul73736 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Mul73736 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Mul52685 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Mul52685 = tf.keras.layers.Input(shape=([2, 1, 2]))

Con91202 = keras.layers.Conv1D(4, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con91202', )(in0Con91202)
LST92289 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST92289', )(Con91202)
Con23065 = keras.layers.Concatenate(axis=1, name = 'Con23065', )([LST92289,in0Con23065])
LST53898 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST53898', )(in0LST53898)
Min96412 = keras.layers.Minimum(name = 'Min96412', )([Con23065,LST53898])
Res50387 = keras.layers.Reshape((3, 1), name = 'Res50387', )(Min96412)
Res48198 = keras.layers.Reshape((3, 1, 1), name = 'Res48198', )(Res50387)
Zer22417 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer22417', )(Res48198)
Con60192 = keras.layers.Concatenate(axis=3, name = 'Con60192', )([Zer22417,in0Con60192])
Mul73736 = keras.layers.Multiply(name = 'Mul73736', )([in0Mul73736,in1Mul73736])
Res35032 = keras.layers.Reshape((2, 2, 2), name = 'Res35032', )(Mul73736)
Mul52685 = keras.layers.Multiply(name = 'Mul52685', )([in0Mul52685,in1Mul52685])
Zer79580 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer79580', )(Mul52685)
Mul82173 = keras.layers.Multiply(name = 'Mul82173', )([Res35032,Zer79580])
Zer41615 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer41615', )(Mul82173)
Sub94453 = keras.layers.Subtract(name = 'Sub94453', )([Con60192,Zer41615])
model = tf.keras.models.Model(inputs=[in0Con91202,in0Con23065,in0LST53898,in0Con60192,in0Mul73736,in1Mul73736,in0Mul52685,in1Mul52685], outputs=Sub94453)
w = model.get_layer('Con91202').get_weights() 
w[0] = np.array([[[0.7185, 0.7185, 0.068, 0.5893]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con91202').set_weights(w) 
w = model.get_layer('LST92289').get_weights() 
w[0] = np.array([[2, 4, 10, 7], [1, 2, 2, 6], [2, 9, 3, 10], [9, 6, 4, 5]])
w[1] = np.array([[4, 5, 2, 10]])
w[2] = np.array([8, 4, 6, 6])
model.get_layer('LST92289').set_weights(w) 
w = model.get_layer('LST53898').get_weights() 
w[0] = np.array([[2, 4, 7, 1, 1, 3, 3, 7, 4, 6, 1, 2], [10, 2, 6, 9, 2, 10, 7, 2, 10, 5, 8, 4], [8, 2, 5, 4, 3, 7, 1, 5, 8, 1, 5, 6]])
w[1] = np.array([[4, 6, 10, 1, 6, 7, 6, 8, 1, 8, 2, 4], [6, 7, 1, 7, 10, 5, 6, 5, 2, 8, 7, 3], [6, 2, 2, 3, 3, 6, 10, 2, 3, 5, 7, 9]])
w[2] = np.array([10, 8, 2, 10, 8, 3, 7, 8, 9, 7, 1, 5])
model.get_layer('LST53898').set_weights(w) 
in0Con91202 = tf.constant([[[0.3298]]])
in0Con23065 = tf.constant([[0.6491, 0.7204]])
in0LST53898 = tf.constant([[[8, 1, 6], [8, 2, 8], [4, 3, 7]]])
in0Con60192 = tf.constant([[[[0.7566], [0.2441], [0.8976]], [[0.4509], [0.1587], [0.0839]], [[0.5119], [0.7625], [0.7321]]]])
in0Mul73736 = tf.constant([[[[[0.4714], [0.2733]], [[0.9293], [0.0379]]], [[[0.7163], [0.3023]], [[0.1314], [0.804]]]]])
in1Mul73736 = tf.constant([[[[[0.5787], [0.1136]], [[0.2146], [0.4869]]], [[[0.0151], [0.9431]], [[0.2935], [0.5029]]]]])
in0Mul52685 = tf.constant([[[[0.8309, 0.742]], [[0.6811, 0.7586]]]])
in1Mul52685 = tf.constant([[[[0.1323, 0.9473]], [[0.3223, 0.1471]]]])
print (np.array2string(model.predict([in0Con91202,in0Con23065,in0LST53898,in0Con60192,in0Mul73736,in1Mul73736,in0Mul52685,in1Mul52685],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub94453.png')

LCon91202 = conv1D_layer([[[0.3298]]], 1,[[[0.7185, 0.7185, 0.068, 0.5893]]],[0, 0, 0, 0], 1, false, 1, Con91202), 
LLST92289 = lstm_layer(Con91202,[[2, 4, 10, 7], [1, 2, 2, 6], [2, 9, 3, 10], [9, 6, 4, 5]],[[4, 5, 2, 10]],[8, 4, 6, 6], LST92289), 
LCon23065 = concatenate_layer([LST92289,[[0.6491, 0.7204]]], 1, Con23065), 
LLST53898 = lstm_layer([[[8, 1, 6], [8, 2, 8], [4, 3, 7]]],[[2, 4, 7, 1, 1, 3, 3, 7, 4, 6, 1, 2], [10, 2, 6, 9, 2, 10, 7, 2, 10, 5, 8, 4], [8, 2, 5, 4, 3, 7, 1, 5, 8, 1, 5, 6]],[[4, 6, 10, 1, 6, 7, 6, 8, 1, 8, 2, 4], [6, 7, 1, 7, 10, 5, 6, 5, 2, 8, 7, 3], [6, 2, 2, 3, 3, 6, 10, 2, 3, 5, 7, 9]],[10, 8, 2, 10, 8, 3, 7, 8, 9, 7, 1, 5], LST53898), 
LMin96412 = minimum_layer([Con23065,LST53898], Min96412), 
LRes50387 = reshape_layer(Min96412, [3, 1], Res50387), 
LRes48198 = reshape_layer(Res50387, [3, 1, 1], Res48198), 
LZer22417 = zero_padding2D_layer(Res48198, 0, 0, 2, 0, Zer22417), 
LCon60192 = concatenate_layer([Zer22417,[[[[0.7566], [0.2441], [0.8976]], [[0.4509], [0.1587], [0.0839]], [[0.5119], [0.7625], [0.7321]]]]], 3, Con60192), 
LMul73736 = multiply_layer([[[[[[0.4714], [0.2733]], [[0.9293], [0.0379]]], [[[0.7163], [0.3023]], [[0.1314], [0.804]]]]], [[[[[0.5787], [0.1136]], [[0.2146], [0.4869]]], [[[0.0151], [0.9431]], [[0.2935], [0.5029]]]]]], Mul73736), 
LRes35032 = reshape_layer(Mul73736, [2, 2, 2], Res35032), 
LMul52685 = multiply_layer([[[[[0.8309, 0.742]], [[0.6811, 0.7586]]]], [[[[0.1323, 0.9473]], [[0.3223, 0.1471]]]]], Mul52685), 
LZer79580 = zero_padding2D_layer(Mul52685, 0, 0, 1, 0, Zer79580), 
LMul82173 = multiply_layer([Res35032,Zer79580], Mul82173), 
LZer41615 = zero_padding2D_layer(Mul82173, 1, 0, 1, 0, Zer41615), 
LSub94453 = subtract_layer(Con60192,Zer41615, Sub94453), 
exec_layers([LCon91202,LLST92289,LCon23065,LLST53898,LMin96412,LRes50387,LRes48198,LZer22417,LCon60192,LMul73736,LRes35032,LMul52685,LZer79580,LMul82173,LZer41615,LSub94453],["Con91202","LST92289","Con23065","LST53898","Min96412","Res50387","Res48198","Zer22417","Con60192","Mul73736","Res35032","Mul52685","Zer79580","Mul82173","Zer41615","Sub94453"],Sub94453,"Sub94453")

Actual (Unparsed): [[[[0.0000000, 0.7566000], [0.0000000, 0.2441000], [0.7615564, 0.8976000]], [[0.0000000, 0.4509000], [0.0000000, 0.1587000], [0.6271773, 0.0709291]], [[0.0000000, 0.5119000], [0.0000000, 0.7625000], [0.7119340, 0.6869806]]]]

Expected (Unparsed): [[[[0,0.7566],[0,0.2441],[0.7615564225820416,0.8976]],[[0,0.4509],[0.0,0.1587],[0.6271772890402154,0.070929090562934]],[[0,0.5119],[0.0,0.7625],[0.711934070323873,0.686980612496104]]]]

Actual:   [[[[0, 0.7566], [0, 0.2441], [0.7616, 0.8976]], [[0, 0.4509], [0, 0.1587], [0.6272, 0.071]], [[0, 0.5119], [0, 0.7625], [0.712, 0.687]]]]

Expected: [[[[0, 0.7566], [0, 0.2441], [0.7616, 0.8976]], [[0, 0.4509], [0, 0.1587], [0.6272, 0.071]], [[0, 0.5119], [0, 0.7625], [0.712, 0.687]]]]