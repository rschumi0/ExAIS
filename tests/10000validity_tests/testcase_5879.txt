import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub37964 = tf.keras.layers.Input(shape=([2, 3, 2]))
in1Sub37964 = tf.keras.layers.Input(shape=([2, 3, 2]))
in0Dot21507 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot21507 = tf.keras.layers.Input(shape=([2, 2]))

Sub37964 = keras.layers.Subtract(name = 'Sub37964', )([in0Sub37964,in1Sub37964])
Res36934 = keras.layers.Reshape((2, 3, 2, 1), name = 'Res36934', )(Sub37964)
Glo81209 = keras.layers.GlobalAveragePooling3D(name = 'Glo81209', )(Res36934)
Res17289 = keras.layers.Reshape((1, 1), name = 'Res17289', )(Glo81209)
Res82000 = keras.layers.Reshape((1, 1, 1), name = 'Res82000', )(Res17289)
Zer13432 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer13432', )(Res82000)
Dot21507 = keras.layers.Dot(axes=(1, 1), name = 'Dot21507', )([in0Dot21507,in1Dot21507])
Res51789 = keras.layers.Reshape((2, 2, 1), name = 'Res51789', )(Dot21507)
Dep83254 = keras.layers.DepthwiseConv2D((2, 2),strides=(1, 1), padding='same', name = 'Dep83254', )(Res51789)
Add43238 = keras.layers.Add(name = 'Add43238', )([Zer13432,Dep83254])
model = tf.keras.models.Model(inputs=[in0Sub37964,in1Sub37964,in0Dot21507,in1Dot21507], outputs=Add43238)
w = model.get_layer('Dep83254').get_weights() 
w[0] = np.array([[[[0.2598]], [[0.0746]]], [[[0.8007]], [[0.1206]]]])
w[1] = np.array([0])
model.get_layer('Dep83254').set_weights(w) 
in0Sub37964 = tf.constant([[[[0.0306, 0.2433], [0.3629, 0.5622], [0.0212, 0.1441]], [[0.7334, 0.34], [0.6152, 0.0157], [0.4752, 0.4704]]]])
in1Sub37964 = tf.constant([[[[0.0308, 0.4708], [0.0404, 0.7528], [0.1983, 0.0105]], [[0.1809, 0.3968], [0.2719, 0.7682], [0.7779, 0.7647]]]])
in0Dot21507 = tf.constant([[[0.9244, 0.5887], [0.9952, 0.3859]]])
in1Dot21507 = tf.constant([[[0.2585, 0.1147], [0.2664, 0.9701]]])
print (np.array2string(model.predict([in0Sub37964,in1Sub37964,in0Dot21507,in1Dot21507],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add43238.png')

LSub37964 = subtract_layer([[[[0.0306, 0.2433], [0.3629, 0.5622], [0.0212, 0.1441]], [[0.7334, 0.34], [0.6152, 0.0157], [0.4752, 0.4704]]]], [[[[0.0308, 0.4708], [0.0404, 0.7528], [0.1983, 0.0105]], [[0.1809, 0.3968], [0.2719, 0.7682], [0.7779, 0.7647]]]], Sub37964), 
LRes36934 = reshape_layer(Sub37964, [2, 3, 2, 1], Res36934), 
LGlo81209 = global_average_pooling3D_layer(Res36934, Glo81209), 
LRes17289 = reshape_layer(Glo81209, [1, 1], Res17289), 
LRes82000 = reshape_layer(Res17289, [1, 1, 1], Res82000), 
LZer13432 = zero_padding2D_layer(Res82000, 1, 0, 1, 0, Zer13432), 
LDot21507 = dot_layer([[[0.9244, 0.5887], [0.9952, 0.3859]]], [[[0.2585, 0.1147], [0.2664, 0.9701]]], 1, 1, Dot21507), 
LRes51789 = reshape_layer(Dot21507, [2, 2, 1], Res51789), 
LDep83254 = depthwise_conv2D_layer(Res51789, 2, 2,[[[[0.2598]], [[0.0746]]], [[[0.8007]], [[0.1206]]]],[0], 1, 1, true, Dep83254), 
LAdd43238 = add_layer([Zer13432,Dep83254], Add43238), 
exec_layers([LSub37964,LRes36934,LGlo81209,LRes17289,LRes82000,LZer13432,LDot21507,LRes51789,LDep83254,LAdd43238],["Sub37964","Res36934","Glo81209","Res17289","Res82000","Zer13432","Dot21507","Res51789","Dep83254","Add43238"],Add43238,"Add43238")

Actual (Unparsed): [[[[0.4683475], [0.6321862]], [[0.0992092], [0.0606518]]]]

Expected (Unparsed): [[[[0.468347511969],[0.6321861813959999]],[[0.09920916486600001],[0.060651847704000006]]]]

Actual:   [[[[0.4684], [0.6322]], [[0.0993], [0.0607]]]]

Expected: [[[[0.4684], [0.6322]], [[0.0993], [0.0607]]]]