import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mas4946 = tf.keras.layers.Input(shape=([4, 4]))
in0Dot33904 = tf.keras.layers.Input(shape=([3]))
in1Dot33904 = tf.keras.layers.Input(shape=([3]))

Mas4946 = keras.layers.Masking(mask_value=1, name = 'Mas4946', )(in0Mas4946)
Lay34483 = keras.layers.LayerNormalization(axis=2, epsilon=1.9523977663676948, name = 'Lay34483', )(Mas4946)
Res18293 = keras.layers.Reshape((4, 4, 1), name = 'Res18293', )(Lay34483)
Max71086 = keras.layers.MaxPool2D(pool_size=(4, 2), strides=(1, 4), padding='valid', name = 'Max71086', )(Res18293)
Res57318 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res57318', )(Max71086)
Dot33904 = keras.layers.Dot(axes=(1, 1), name = 'Dot33904', )([in0Dot33904,in1Dot33904])
Res73043 = keras.layers.Reshape((1, 1), name = 'Res73043', )(Dot33904)
Res38307 = keras.layers.Reshape((1, 1, 1), name = 'Res38307', )(Res73043)
Res28134 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res28134', )(Res38307)
Glo17360 = keras.layers.GlobalMaxPool3D(name = 'Glo17360', )(Res28134)
Res87765 = keras.layers.Reshape((1, 1), name = 'Res87765', )(Glo17360)
Res30660 = keras.layers.Reshape((1, 1, 1), name = 'Res30660', )(Res87765)
Res64419 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res64419', )(Res30660)
Up_78345 = keras.layers.UpSampling3D(size=(1, 1, 1), name = 'Up_78345', )(Res64419)
Max98969 = keras.layers.Maximum(name = 'Max98969', )([Res57318,Up_78345])
model = tf.keras.models.Model(inputs=[in0Mas4946,in0Dot33904,in1Dot33904], outputs=Max98969)
in0Mas4946 = tf.constant([[[1.1787, 1.0348, 1.763, 1.6126], [1.844, 1.7419, 1.8236, 1.4423], [1.2106, 1.8462, 1.8908, 1.2463], [1.8249, 1.9366, 1.7454, 1.9371]]])
in0Dot33904 = tf.constant([[0.3196, 0.3571, 0.7848]])
in1Dot33904 = tf.constant([[0.6788, 0.5403, 0.4513]])
print (np.array2string(model.predict([in0Mas4946,in0Dot33904,in1Dot33904],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max98969.png')

LMas4946 = masking_layer([[[1.1787, 1.0348, 1.763, 1.6126], [1.844, 1.7419, 1.8236, 1.4423], [1.2106, 1.8462, 1.8908, 1.2463], [1.8249, 1.9366, 1.7454, 1.9371]]], 1, Mas4946), 
LLay34483 = layer_normalization_layer(Mas4946, 2, 1.9523977663676948, Lay34483), 
LRes18293 = reshape_layer(Lay34483, [4, 4, 1], Res18293), 
LMax71086 = max_pool2D_layer(Res18293, 4, 2, 1, 4, false, Max71086), 
LRes57318 = reshape_layer(Max71086, [1, 1, 1, 1], Res57318), 
LDot33904 = dot_layer([[0.3196, 0.3571, 0.7848]], [[0.6788, 0.5403, 0.4513]], 1, 1, Dot33904), 
LRes73043 = reshape_layer(Dot33904, [1, 1], Res73043), 
LRes38307 = reshape_layer(Res73043, [1, 1, 1], Res38307), 
LRes28134 = reshape_layer(Res38307, [1, 1, 1, 1], Res28134), 
LGlo17360 = global_max_pool3D_layer(Res28134, Glo17360), 
LRes87765 = reshape_layer(Glo17360, [1, 1], Res87765), 
LRes30660 = reshape_layer(Res87765, [1, 1, 1], Res30660), 
LRes64419 = reshape_layer(Res30660, [1, 1, 1, 1], Res64419), 
LUp_78345 = up_sampling3D_layer(Res64419, 1, 1, 1, Up_78345), 
LMax98969 = maximum_layer([Res57318,Up_78345], Max98969), 
exec_layers([LMas4946,LLay34483,LRes18293,LMax71086,LRes57318,LDot33904,LRes73043,LRes38307,LRes28134,LGlo17360,LRes87765,LRes30660,LRes64419,LUp_78345,LMax98969],["Mas4946","Lay34483","Res18293","Max71086","Res57318","Dot33904","Res73043","Res38307","Res28134","Glo17360","Res87765","Res30660","Res64419","Up_78345","Max98969"],Max98969,"Max98969")

Actual (Unparsed): [[[[[0.7640658]]]]]

Expected (Unparsed): [[[[[0.76406585]]]]]

Actual:   [[[[[0.7641]]]]]

Expected: [[[[[0.7641]]]]]