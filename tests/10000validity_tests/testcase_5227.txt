import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dep22136 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con75072 = tf.keras.layers.Input(shape=([2, 1]))
in0Sub45289 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub45289 = tf.keras.layers.Input(shape=([2, 3]))
in0Zer42426 = tf.keras.layers.Input(shape=([4, 4, 4]))
in0Min24411 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Min24411 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))

Dep22136 = keras.layers.DepthwiseConv2D((2, 1),strides=(1, 1), padding='same', name = 'Dep22136', )(in0Dep22136)
Res51109 = keras.layers.Reshape((2, 2), name = 'Res51109', )(Dep22136)
Per98739 = keras.layers.Permute((1,2), name = 'Per98739',)(Res51109)
Con75072 = keras.layers.Concatenate(axis=2, name = 'Con75072', )([Per98739,in0Con75072])
Sub45289 = keras.layers.Subtract(name = 'Sub45289', )([in0Sub45289,in1Sub45289])
Max4311 = keras.layers.Maximum(name = 'Max4311', )([Con75072,Sub45289])
Res63822 = keras.layers.Reshape((2, 3, 1), name = 'Res63822', )(Max4311)
Res78204 = keras.layers.Reshape((2, 3, 1, 1), name = 'Res78204', )(Res63822)
Zer87000 = keras.layers.ZeroPadding3D(padding=((4, 0), (3, 0), (3, 0)), name = 'Zer87000', )(Res78204)
Zer42426 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer42426', )(in0Zer42426)
Res53065 = keras.layers.Reshape((6, 6, 4, 1), name = 'Res53065', )(Zer42426)
Min24411 = keras.layers.Minimum(name = 'Min24411', )([in0Min24411,in1Min24411])
Zer65875 = keras.layers.ZeroPadding3D(padding=((5, 0), (5, 0), (2, 0)), name = 'Zer65875', )(Min24411)
Add14991 = keras.layers.Add(name = 'Add14991', )([Res53065,Zer65875])
Ave42077 = keras.layers.Average(name = 'Ave42077', )([Zer87000,Add14991])
model = tf.keras.models.Model(inputs=[in0Dep22136,in0Con75072,in0Sub45289,in1Sub45289,in0Zer42426,in0Min24411,in1Min24411], outputs=Ave42077)
w = model.get_layer('Dep22136').get_weights() 
w[0] = np.array([[[[0.1213]]], [[[0.6695]]]])
w[1] = np.array([0])
model.get_layer('Dep22136').set_weights(w) 
in0Dep22136 = tf.constant([[[[0.0274], [0.3264]], [[0.8954], [0.843]]]])
in0Con75072 = tf.constant([[[0.461], [0.8642]]])
in0Sub45289 = tf.constant([[[0.3092, 0.7007, 0.7584], [0.1603, 0.5067, 0.2842]]])
in1Sub45289 = tf.constant([[[0.6431, 0.6066, 0.1332], [0.6434, 0.4852, 0.0235]]])
in0Zer42426 = tf.constant([[[[1.6111, 1.5848, 1.7372, 1.935], [1.5655, 1.1425, 1.1542, 1.9932], [1.3525, 1.6948, 1.8472, 1.7833], [1.5357, 1.0107, 1.6945, 1.0831]], [[1.2584, 1.651, 1.0192, 1.9927], [1.1049, 1.426, 1.1663, 1.8377], [1.1008, 1.5468, 1.2408, 1.3806], [1.9525, 1.6972, 1.8049, 1.675]], [[1.4979, 1.5023, 1.7753, 1.8418], [1.6059, 1.7708, 1.1099, 1.1578], [1.4401, 1.4489, 1.1277, 1.1063], [1.088, 1.4394, 1.4672, 1.461]], [[1.0407, 1.3117, 1.7566, 1.047], [1.9093, 1.4561, 1.0409, 1.5565], [1.0627, 1.4212, 1.8939, 1.6831], [1.5794, 1.0135, 1.9249, 1.8834]]]])
in0Min24411 = tf.constant([[[[[0.0222], [0.2359]]]]])
in1Min24411 = tf.constant([[[[[0.0876], [0.2731]]]]])
print (np.array2string(model.predict([in0Dep22136,in0Con75072,in0Sub45289,in1Sub45289,in0Zer42426,in0Min24411,in1Min24411],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave42077.png')

LDep22136 = depthwise_conv2D_layer([[[[0.0274], [0.3264]], [[0.8954], [0.843]]]], 2, 1,[[[[0.1213]]], [[[0.6695]]]],[0], 1, 1, true, Dep22136), 
LRes51109 = reshape_layer(Dep22136, [2, 2], Res51109), 
LPer98739 = permute_layer(Res51109, 1,2, Per98739), 
LCon75072 = concatenate_layer([Per98739,[[[0.461], [0.8642]]]], 2, Con75072), 
LSub45289 = subtract_layer([[[0.3092, 0.7007, 0.7584], [0.1603, 0.5067, 0.2842]]], [[[0.6431, 0.6066, 0.1332], [0.6434, 0.4852, 0.0235]]], Sub45289), 
LMax4311 = maximum_layer([Con75072,Sub45289], Max4311), 
LRes63822 = reshape_layer(Max4311, [2, 3, 1], Res63822), 
LRes78204 = reshape_layer(Res63822, [2, 3, 1, 1], Res78204), 
LZer87000 = zero_padding3D_layer(Res78204, 4, 0, 3, 0, 3, 0, Zer87000), 
LZer42426 = zero_padding2D_layer([[[[1.6111, 1.5848, 1.7372, 1.935], [1.5655, 1.1425, 1.1542, 1.9932], [1.3525, 1.6948, 1.8472, 1.7833], [1.5357, 1.0107, 1.6945, 1.0831]], [[1.2584, 1.651, 1.0192, 1.9927], [1.1049, 1.426, 1.1663, 1.8377], [1.1008, 1.5468, 1.2408, 1.3806], [1.9525, 1.6972, 1.8049, 1.675]], [[1.4979, 1.5023, 1.7753, 1.8418], [1.6059, 1.7708, 1.1099, 1.1578], [1.4401, 1.4489, 1.1277, 1.1063], [1.088, 1.4394, 1.4672, 1.461]], [[1.0407, 1.3117, 1.7566, 1.047], [1.9093, 1.4561, 1.0409, 1.5565], [1.0627, 1.4212, 1.8939, 1.6831], [1.5794, 1.0135, 1.9249, 1.8834]]]], 1, 1, 1, 1, Zer42426), 
LRes53065 = reshape_layer(Zer42426, [6, 6, 4, 1], Res53065), 
LMin24411 = minimum_layer([[[[[[0.0222], [0.2359]]]]], [[[[[0.0876], [0.2731]]]]]], Min24411), 
LZer65875 = zero_padding3D_layer(Min24411, 5, 0, 5, 0, 2, 0, Zer65875), 
LAdd14991 = add_layer([Res53065,Zer65875], Add14991), 
LAve42077 = average_layer([Zer87000,Add14991], Ave42077), 
exec_layers([LDep22136,LRes51109,LPer98739,LCon75072,LSub45289,LMax4311,LRes63822,LRes78204,LZer87000,LZer42426,LRes53065,LMin24411,LZer65875,LAdd14991,LAve42077],["Dep22136","Res51109","Per98739","Con75072","Sub45289","Max4311","Res63822","Res78204","Zer87000","Zer42426","Res53065","Min24411","Zer65875","Add14991","Ave42077"],Ave42077,"Ave42077")

Actual (Unparsed): [[[[[0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.8055500], [0.7924000], [0.8686000], [0.9675000]], [[0.7827500], [0.5712500], [0.5771000], [0.9966000]], [[0.6762500], [0.8474000], [0.9236000], [0.8916500]], [[0.7678500], [0.5053500], [0.8472500], [0.5415500]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.6292000], [0.8255000], [0.5096000], [0.9963500]], [[0.5524500], [0.7130000], [0.5831500], [0.9188500]], [[0.5504000], [0.7734000], [0.6204000], [0.6903000]], [[0.9762500], [0.8486000], [0.9024500], [0.8375000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.7489500], [0.7511500], [0.8876500], [0.9209000]], [[0.8029500], [0.8854000], [0.5549500], [0.5789000]], [[0.7200500], [0.7244500], [0.5638500], [0.5531500]], [[0.5440000], [0.7197000], [0.7336000], [0.7305000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.5203500], [0.6558500], [0.8783000], [0.5235000]], [[0.9546500], [0.7280500], [0.5204500], [0.7782500]], [[0.5313500], [0.7106000], [0.9469500], [1.1429469]], [[0.7897000], [0.5067500], [0.9624500], [1.2436904]], [[0.0000000], [0.0000000], [0.0000000], [0.3126000]]], [[[0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0543060]], [[0.0000000], [0.0000000], [0.0000000], [0.0511279]], [[0.0000000], [0.0000000], [0.0111000], [0.5500500]]]]]

Expected (Unparsed): [[[[[0],[0],[0],[0]],[[0],[0],[0],[0]],[[0],[0],[0],[0]],[[0],[0],[0],[0]],[[0],[0],[0],[0]],[[0],[0],[0],[0]]],[[[0],[0],[0],[0]],[[0.80555],[0.7924],[0.8686],[0.9675]],[[0.78275],[0.57125],[0.5771],[0.9966]],[[0.67625],[0.8474],[0.9236],[0.89165]],[[0.76785],[0.50535],[0.84725],[0.54155]],[[0],[0],[0],[0]]],[[[0],[0],[0],[0]],[[0.6292],[0.8255],[0.5096],[0.99635]],[[0.55245],[0.713],[0.58315],[0.91885]],[[0.5504],[0.7734],[0.6204],[0.6903]],[[0.97625],[0.8486],[0.90245],[0.8375]],[[0],[0],[0],[0]]],[[[0],[0],[0],[0]],[[0.74895],[0.75115],[0.88765],[0.9209]],[[0.80295],[0.8854],[0.55495],[0.5789]],[[0.72005],[0.72445],[0.56385],[0.55315]],[[0.544],[0.7197],[0.7336],[0.7305]],[[0],[0],[0],[0]]],[[[0],[0],[0],[0]],[[0.52035],[0.65585],[0.8783],[0.5235]],[[0.95465],[0.72805],[0.52045],[0.77825]],[[0.53135],[0.7106],[0.94695],[1.14294696]],[[0.7897],[0.50675],[0.96245],[1.24369041]],[[0],[0],[0],[0.3126]]],[[[0],[0],[0],[0]],[[0],[0],[0],[0]],[[0],[0],[0],[0]],[[0],[0],[0],[0.05430601]],[[0],[0],[0],[0.05112795]],[[0],[0],[0.0111],[0.5500499999999999]]]]]

Actual:   [[[[[0], [0], [0], [0]], [[0], [0], [0], [0]], [[0], [0], [0], [0]], [[0], [0], [0], [0]], [[0], [0], [0], [0]], [[0], [0], [0], [0]]], [[[0], [0], [0], [0]], [[0.8056], [0.7924], [0.8686], [0.9675]], [[0.7828], [0.5713], [0.5771], [0.9966]], [[0.6763], [0.8474], [0.9236], [0.8917]], [[0.7679], [0.5054], [0.8473], [0.5416]], [[0], [0], [0], [0]]], [[[0], [0], [0], [0]], [[0.6292], [0.8255], [0.5096], [0.9964]], [[0.5525], [0.713], [0.5832], [0.9189]], [[0.5504], [0.7734], [0.6204], [0.6903]], [[0.9763], [0.8486], [0.9025], [0.8375]], [[0], [0], [0], [0]]], [[[0], [0], [0], [0]], [[0.749], [0.7512], [0.8877], [0.9209]], [[0.803], [0.8854], [0.555], [0.5789]], [[0.7201], [0.7245], [0.5639], [0.5532]], [[0.544], [0.7197], [0.7336], [0.7305]], [[0], [0], [0], [0]]], [[[0], [0], [0], [0]], [[0.5204], [0.6559], [0.8783], [0.5235]], [[0.9547], [0.7281], [0.5205], [0.7783]], [[0.5314], [0.7106], [0.947], [1.143]], [[0.7897], [0.5068], [0.9625], [1.2437]], [[0], [0], [0], [0.3126]]], [[[0], [0], [0], [0]], [[0], [0], [0], [0]], [[0], [0], [0], [0]], [[0], [0], [0], [0.0544]], [[0], [0], [0], [0.0512]], [[0], [0], [0.0111], [0.5501]]]]]

Expected: [[[[[0], [0], [0], [0]], [[0], [0], [0], [0]], [[0], [0], [0], [0]], [[0], [0], [0], [0]], [[0], [0], [0], [0]], [[0], [0], [0], [0]]], [[[0], [0], [0], [0]], [[0.8056], [0.7924], [0.8686], [0.9675]], [[0.7828], [0.5713], [0.5771], [0.9966]], [[0.6763], [0.8474], [0.9236], [0.8917]], [[0.7679], [0.5054], [0.8473], [0.5416]], [[0], [0], [0], [0]]], [[[0], [0], [0], [0]], [[0.6292], [0.8255], [0.5096], [0.9964]], [[0.5525], [0.713], [0.5832], [0.9189]], [[0.5504], [0.7734], [0.6204], [0.6903]], [[0.9763], [0.8486], [0.9025], [0.8375]], [[0], [0], [0], [0]]], [[[0], [0], [0], [0]], [[0.749], [0.7512], [0.8877], [0.9209]], [[0.803], [0.8854], [0.555], [0.5789]], [[0.7201], [0.7245], [0.5639], [0.5532]], [[0.544], [0.7197], [0.7336], [0.7305]], [[0], [0], [0], [0]]], [[[0], [0], [0], [0]], [[0.5204], [0.6559], [0.8783], [0.5235]], [[0.9547], [0.7281], [0.5205], [0.7783]], [[0.5314], [0.7106], [0.947], [1.143]], [[0.7897], [0.5068], [0.9625], [1.2437]], [[0], [0], [0], [0.3126]]], [[[0], [0], [0], [0]], [[0], [0], [0], [0]], [[0], [0], [0], [0]], [[0], [0], [0], [0.0544]], [[0], [0], [0], [0.0512]], [[0], [0], [0.0111], [0.5501]]]]]