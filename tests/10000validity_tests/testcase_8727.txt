import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Per32593 = tf.keras.layers.Input(shape=([4, 2]))
in0Dot14916 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot14916 = tf.keras.layers.Input(shape=([2, 3]))
in0Con53560 = tf.keras.layers.Input(shape=([3, 25]))

Per32593 = keras.layers.Permute((2,1), name = 'Per32593',)(in0Per32593)
Res10809 = keras.layers.Reshape((2, 4, 1), name = 'Res10809', )(Per32593)
Res18117 = keras.layers.Reshape((2, 4, 1, 1), name = 'Res18117', )(Res10809)
Con4087 = keras.layers.Conv3DTranspose(4, (2, 4, 1),strides=(1, 1, 1), padding='valid', name = 'Con4087', )(Res18117)
Res43739 = keras.layers.Reshape((3, 7, 4), name = 'Res43739', )(Con4087)
Res62596 = keras.layers.Reshape((3, 28), name = 'Res62596', )(Res43739)
Dot14916 = keras.layers.Dot(axes=(1, 1), name = 'Dot14916', )([in0Dot14916,in1Dot14916])
Con66403 = keras.layers.Conv1D(3, (2),strides=(1), padding='same', dilation_rate=(1), name = 'Con66403', )(Dot14916)
Con53560 = keras.layers.Concatenate(axis=2, name = 'Con53560', )([Con66403,in0Con53560])
Mul97678 = keras.layers.Multiply(name = 'Mul97678', )([Res62596,Con53560])
model = tf.keras.models.Model(inputs=[in0Per32593,in0Dot14916,in1Dot14916,in0Con53560], outputs=Mul97678)
w = model.get_layer('Con4087').get_weights() 
w[0] = np.array([[[[[0.7028], [0.6051], [0.0766], [0.3057]]], [[[0.9803], [0.6821], [0.6177], [0.3333]]], [[[0.659], [0.4327], [0.0675], [0.0503]]], [[[0.7869], [0.8158], [0.6296], [0.0411]]]], [[[[0.1824], [0.499], [0.8625], [0.5]]], [[[0.8365], [0.6796], [0.6413], [0.8936]]], [[[0.3622], [0.9396], [0.8086], [0.029]]], [[[0.5303], [0.2908], [0.8353], [0.3129]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con4087').set_weights(w) 
w = model.get_layer('Con66403').get_weights() 
w[0] = np.array([[[0.5468, 0.1108, 0.4125], [0.5257, 0.1222, 0.8928], [0.6368, 0.162, 0.1192]], [[0.2877, 0.2936, 0.5607], [0.2404, 0.2562, 0.7107], [0.7981, 0.9183, 0.3439]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con66403').set_weights(w) 
in0Per32593 = tf.constant([[[1.5922, 1.599], [1.3508, 1.3987], [1.6336, 1.1003], [1.393, 1.6634]]])
in0Dot14916 = tf.constant([[[0.8509, 0.5016, 0.2629], [0.7372, 0.0545, 0.1808]]])
in1Dot14916 = tf.constant([[[0.0431, 0.8372, 0.144], [0.3157, 0.0085, 0.0229]]])
in0Con53560 = tf.constant([[[0.0328, 0.1135, 0.8076, 0.3252, 0.9212, 0.6334, 0.7286, 0.0044, 0.5477, 0.9967, 0.8648, 0.0613, 0.8242, 0.6941, 0.164, 0.0596, 0.9282, 0.0356, 0.7452, 0.1711, 0.4336, 0.2002, 0.8079, 0.9113, 0.0544], [0.0207, 0.0935, 0.412, 0.2209, 0.6505, 0.7093, 0.0255, 0.2754, 0.7425, 0.5906, 0.0502, 0.6793, 0.5409, 0.865, 0.1536, 0.2565, 0.3295, 0.9119, 0.6295, 0.1626, 0.0128, 0.963, 0.9732, 0.9665, 0.2154], [0.6777, 0.3825, 0.959, 0.1771, 0.245, 0.7011, 0.5587, 0.8921, 0.2132, 0.0083, 0.4808, 0.3994, 0.4296, 0.5291, 0.1505, 0.8602, 0.1834, 0.79, 0.6975, 0.0815, 0.8888, 0.9779, 0.7545, 0.4376, 0.4207]]])
print (np.array2string(model.predict([in0Per32593,in0Dot14916,in1Dot14916,in0Con53560],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul97678.png')

LPer32593 = permute_layer([[[1.5922, 1.599], [1.3508, 1.3987], [1.6336, 1.1003], [1.393, 1.6634]]], 2,1, Per32593), 
LRes10809 = reshape_layer(Per32593, [2, 4, 1], Res10809), 
LRes18117 = reshape_layer(Res10809, [2, 4, 1, 1], Res18117), 
LCon4087 = conv3D_transpose_layer(Res18117, 2, 4, 1,[[[[[0.7028], [0.6051], [0.0766], [0.3057]]], [[[0.9803], [0.6821], [0.6177], [0.3333]]], [[[0.659], [0.4327], [0.0675], [0.0503]]], [[[0.7869], [0.8158], [0.6296], [0.0411]]]], [[[[0.1824], [0.499], [0.8625], [0.5]]], [[[0.8365], [0.6796], [0.6413], [0.8936]]], [[[0.3622], [0.9396], [0.8086], [0.029]]], [[[0.5303], [0.2908], [0.8353], [0.3129]]]]],[0, 0, 0, 0], 1, 1, 1, false, Con4087), 
LRes43739 = reshape_layer(Con4087, [3, 7, 4], Res43739), 
LRes62596 = reshape_layer(Res43739, [3, 28], Res62596), 
LDot14916 = dot_layer([[[0.8509, 0.5016, 0.2629], [0.7372, 0.0545, 0.1808]]], [[[0.0431, 0.8372, 0.144], [0.3157, 0.0085, 0.0229]]], 1, 1, Dot14916), 
LCon66403 = conv1D_layer(Dot14916, 2,[[[0.5468, 0.1108, 0.4125], [0.5257, 0.1222, 0.8928], [0.6368, 0.162, 0.1192]], [[0.2877, 0.2936, 0.5607], [0.2404, 0.2562, 0.7107], [0.7981, 0.9183, 0.3439]]],[0, 0, 0], 1, true, 1, Con66403), 
LCon53560 = concatenate_layer([Con66403,[[[0.0328, 0.1135, 0.8076, 0.3252, 0.9212, 0.6334, 0.7286, 0.0044, 0.5477, 0.9967, 0.8648, 0.0613, 0.8242, 0.6941, 0.164, 0.0596, 0.9282, 0.0356, 0.7452, 0.1711, 0.4336, 0.2002, 0.8079, 0.9113, 0.0544], [0.0207, 0.0935, 0.412, 0.2209, 0.6505, 0.7093, 0.0255, 0.2754, 0.7425, 0.5906, 0.0502, 0.6793, 0.5409, 0.865, 0.1536, 0.2565, 0.3295, 0.9119, 0.6295, 0.1626, 0.0128, 0.963, 0.9732, 0.9665, 0.2154], [0.6777, 0.3825, 0.959, 0.1771, 0.245, 0.7011, 0.5587, 0.8921, 0.2132, 0.0083, 0.4808, 0.3994, 0.4296, 0.5291, 0.1505, 0.8602, 0.1834, 0.79, 0.6975, 0.0815, 0.8888, 0.9779, 0.7545, 0.4376, 0.4207]]]], 2, Con53560), 
LMul97678 = multiply_layer([Res62596,Con53560], Mul97678), 
exec_layers([LPer32593,LRes10809,LRes18117,LCon4087,LRes43739,LRes62596,LDot14916,LCon66403,LCon53560,LMul97678],["Per32593","Res10809","Res18117","Con4087","Res43739","Res62596","Dot14916","Con66403","Con53560","Mul97678"],Mul97678,"Mul97678")

Actual (Unparsed): [[[0.8781407, 0.3148852, 0.1360088, 0.0159649, 0.2849050, 1.5371929, 0.3534837, 0.8692626, 2.2305455, 1.8934981, 0.0046948, 0.5639671, 4.7079103, 3.3213429, 0.1354366, 0.9096725, 2.4328517, 0.4524771, 0.1085428, 0.5587531, 0.0784434, 1.4422913, 0.1920670, 0.0594938, 0.2194496, 0.9181052, 0.7992400, 0.0031145], [0.5593246, 0.3224813, 0.9130496, 0.0265977, 0.3860398, 1.5215735, 0.7247697, 1.9896969, 3.6903354, 0.1412938, 1.2720433, 2.1926224, 4.3597213, 0.3616531, 4.4694722, 2.0040142, 5.1291295, 0.8641829, 1.3658515, 0.7848912, 3.0392253, 2.1411130, 0.5359221, 0.0087097, 1.9718748, 1.7148623, 2.1367861, 0.1086123], [0.0526923, 0.0330869, 0.3187219, 0.5418211, 0.6092025, 1.7114618, 0.3952549, 0.5214130, 1.3670504, 1.6772323, 2.8002540, 0.3936523, 0.0214004, 1.6140495, 1.8400112, 1.0120592, 1.3395190, 0.3869401, 2.6879315, 0.3587260, 0.9369184, 1.3133213, 0.1845246, 0.3488740, 0.8626066, 0.3649643, 0.6080181, 0.2189650]]]

Expected (Unparsed): [[[0.878140664213969,0.31488518659928383,0.13600876426740952,0.015964925712000005,0.28490496465000004,1.53719286612,0.353483691144,0.8692625781840001,2.230545412208,1.893498051628,0.004694784248000001,0.563967139114,4.707910317062001,3.321342906544,0.13543662703200002,0.909672540088,2.4328516095620003,0.45247709224,0.10854279168800002,0.5587530650520001,0.078443419504,1.4422913634959997,0.192066946466,0.05949376169599999,0.21944957034,0.91810515426,0.7992399906400001,0.00311452512],[0.5593245731574406,0.32248134196876543,0.913049612917592,0.02659772601,0.38603974067999997,1.5215735110800002,0.724769714622,1.9896968461050002,3.6903354927090004,0.14129379914999998,1.272043250622,2.192622399,4.3597212183180005,0.3616530819320001,4.469472093316001,2.004014172978,5.12912943965,0.8641828469759999,1.365851483325,0.7848912083,3.039225322265,2.1411130621999996,0.535922162676,0.008709654911999999,1.9718747776799999,1.7148622119839998,2.13678608041,0.108612313776],[0.05269232615815135,0.03308691461694388,0.3187218749429067,0.54182115,0.60920254035,1.7114618002999997,0.39525487039500007,0.521413018,1.367050400577,1.6772322725939997,2.8002541369659997,0.39365233502399993,0.021400420785000002,1.61404954256,1.8400112009540002,1.012059189408,1.339518962067,0.38694008724,2.6879315496219998,0.35872602957800004,0.9369183303000002,1.3133212713,0.184524625145,0.34887397133600007,0.862606587458,0.36496426524,0.608018077552,0.21896503570200004]]]

Actual:   [[[0.8782, 0.3149, 0.1361, 0.016, 0.285, 1.5372, 0.3535, 0.8693, 2.2306, 1.8935, 0.0047, 0.564, 4.708, 3.3214, 0.1355, 0.9097, 2.4329, 0.4525, 0.1086, 0.5588, 0.0785, 1.4423, 0.1921, 0.0595, 0.2195, 0.9182, 0.7993, 0.0032], [0.5594, 0.3225, 0.9131, 0.0266, 0.3861, 1.5216, 0.7248, 1.9897, 3.6904, 0.1413, 1.2721, 2.1927, 4.3598, 0.3617, 4.4695, 2.0041, 5.1292, 0.8642, 1.3659, 0.7849, 3.0393, 2.1412, 0.536, 0.0088, 1.9719, 1.7149, 2.1368, 0.1087], [0.0527, 0.0331, 0.3188, 0.5419, 0.6093, 1.7115, 0.3953, 0.5215, 1.3671, 1.6773, 2.8003, 0.3937, 0.0215, 1.6141, 1.8401, 1.0121, 1.3396, 0.387, 2.688, 0.3588, 0.937, 1.3134, 0.1846, 0.3489, 0.8627, 0.365, 0.6081, 0.219]]]

Expected: [[[0.8782, 0.3149, 0.1361, 0.016, 0.285, 1.5372, 0.3535, 0.8693, 2.2306, 1.8935, 0.0047, 0.564, 4.708, 3.3214, 0.1355, 0.9097, 2.4329, 0.4525, 0.1086, 0.5588, 0.0785, 1.4423, 0.1921, 0.0595, 0.2195, 0.9182, 0.7993, 0.0032], [0.5594, 0.3225, 0.9131, 0.0266, 0.3861, 1.5216, 0.7248, 1.9897, 3.6904, 0.1413, 1.2721, 2.1927, 4.3598, 0.3617, 4.4695, 2.0041, 5.1292, 0.8642, 1.3659, 0.7849, 3.0393, 2.1412, 0.536, 0.0088, 1.9719, 1.7149, 2.1368, 0.1087], [0.0527, 0.0331, 0.3188, 0.5419, 0.6093, 1.7115, 0.3953, 0.5215, 1.3671, 1.6773, 2.8003, 0.3937, 0.0215, 1.6141, 1.8401, 1.0121, 1.3396, 0.387, 2.688, 0.3588, 0.937, 1.3134, 0.1846, 0.3489, 0.8627, 0.365, 0.6081, 0.219]]]