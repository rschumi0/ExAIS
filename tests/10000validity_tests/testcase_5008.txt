import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add76731 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Add76731 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Mul52077 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Mul52077 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Mas8541 = tf.keras.layers.Input(shape=([4, 2, 1]))
in0Sim3503 = tf.keras.layers.Input(shape=([1, 2]))
in0Con34233 = tf.keras.layers.Input(shape=([2, 7]))

Add76731 = keras.layers.Add(name = 'Add76731', )([in0Add76731,in1Add76731])
Res56382 = keras.layers.Reshape((1, 2, 4), name = 'Res56382', )(Add76731)
Res65088 = keras.layers.Reshape((1, 8), name = 'Res65088', )(Res56382)
Zer57333 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer57333', )(Res65088)
Mul52077 = keras.layers.Multiply(name = 'Mul52077', )([in0Mul52077,in1Mul52077])
Res54212 = keras.layers.Reshape((2, 4), name = 'Res54212', )(Mul52077)
Fla9777 = keras.layers.Flatten(name = 'Fla9777', )(Res54212)
Res34725 = keras.layers.Reshape((8, 1), name = 'Res34725', )(Fla9777)
Res74876 = keras.layers.Reshape((8, 1, 1), name = 'Res74876', )(Res34725)
Res65611 = keras.layers.Reshape((8, 1, 1, 1), name = 'Res65611', )(Res74876)
Glo34874 = keras.layers.GlobalAveragePooling3D(name = 'Glo34874', )(Res65611)
Res81868 = keras.layers.Reshape((1, 1), name = 'Res81868', )(Glo34874)
Res97461 = keras.layers.Reshape((1, 1, 1), name = 'Res97461', )(Res81868)
Zer99045 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer99045', )(Res97461)
Mas8541 = keras.layers.Masking(mask_value=1, name = 'Mas8541', )(in0Mas8541)
Dep41065 = keras.layers.DepthwiseConv2D((1, 1),strides=(3, 3), padding='same', name = 'Dep41065', )(Mas8541)
Sub52179 = keras.layers.Subtract(name = 'Sub52179', )([Zer99045,Dep41065])
Res96967 = keras.layers.Reshape((2, 1), name = 'Res96967', )(Sub52179)
Sim3503 = keras.layers.SimpleRNN(2,name = 'Sim3503', )(in0Sim3503)
Res22443 = keras.layers.Reshape((2, 1), name = 'Res22443', )(Sim3503)
Min7495 = keras.layers.Minimum(name = 'Min7495', )([Res96967,Res22443])
Con34233 = keras.layers.Concatenate(axis=2, name = 'Con34233', )([Min7495,in0Con34233])
Add81041 = keras.layers.Add(name = 'Add81041', )([Zer57333,Con34233])
model = tf.keras.models.Model(inputs=[in0Add76731,in1Add76731,in0Mul52077,in1Mul52077,in0Mas8541,in0Sim3503,in0Con34233], outputs=Add81041)
w = model.get_layer('Dep41065').get_weights() 
w[0] = np.array([[[[0.3866]]]])
w[1] = np.array([0])
model.get_layer('Dep41065').set_weights(w) 
w = model.get_layer('Sim3503').get_weights() 
w[0] = np.array([[5, 5], [8, 4]])
w[1] = np.array([[3, 8], [8, 2]])
w[2] = np.array([1, 9])
model.get_layer('Sim3503').set_weights(w) 
in0Add76731 = tf.constant([[[[[0.9651, 0.7654], [0.9633, 0.0444]], [[0.8261, 0.1773], [0.347, 0.4142]]]]])
in1Add76731 = tf.constant([[[[[0.7895, 0.0734], [0.3013, 0.3825]], [[0.3305, 0.8799], [0.8896, 0.9049]]]]])
in0Mul52077 = tf.constant([[[[0.0496, 0.4421], [0.0978, 0.9015]], [[0.3063, 0.809], [0.3452, 0.1229]]]])
in1Mul52077 = tf.constant([[[[0.5255, 0.2644], [0.4056, 0.4971]], [[0.8639, 0.0749], [0.7012, 0.4411]]]])
in0Mas8541 = tf.constant([[[[1.0141], [1.6853]], [[1.0644], [1.1942]], [[1.6525], [1.011]], [[1.6625], [1.306]]]])
in0Sim3503 = tf.constant([[[5, 8]]])
in0Con34233 = tf.constant([[[0.2404, 0.6987, 0.8856, 0.1836, 0.6782, 0.6382, 0.4424], [0.7226, 0.3463, 0.2444, 0.723, 0.657, 0.4322, 0.8652]]])
print (np.array2string(model.predict([in0Add76731,in1Add76731,in0Mul52077,in1Mul52077,in0Mas8541,in0Sim3503,in0Con34233],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add81041.png')

LAdd76731 = add_layer([[[[[[0.9651, 0.7654], [0.9633, 0.0444]], [[0.8261, 0.1773], [0.347, 0.4142]]]]], [[[[[0.7895, 0.0734], [0.3013, 0.3825]], [[0.3305, 0.8799], [0.8896, 0.9049]]]]]], Add76731), 
LRes56382 = reshape_layer(Add76731, [1, 2, 4], Res56382), 
LRes65088 = reshape_layer(Res56382, [1, 8], Res65088), 
LZer57333 = zero_padding1D_layer(Res65088, 1, 0, Zer57333), 
LMul52077 = multiply_layer([[[[[0.0496, 0.4421], [0.0978, 0.9015]], [[0.3063, 0.809], [0.3452, 0.1229]]]], [[[[0.5255, 0.2644], [0.4056, 0.4971]], [[0.8639, 0.0749], [0.7012, 0.4411]]]]], Mul52077), 
LRes54212 = reshape_layer(Mul52077, [2, 4], Res54212), 
LFla9777 = flatten_layer(Res54212, Fla9777), 
LRes34725 = reshape_layer(Fla9777, [8, 1], Res34725), 
LRes74876 = reshape_layer(Res34725, [8, 1, 1], Res74876), 
LRes65611 = reshape_layer(Res74876, [8, 1, 1, 1], Res65611), 
LGlo34874 = global_average_pooling3D_layer(Res65611, Glo34874), 
LRes81868 = reshape_layer(Glo34874, [1, 1], Res81868), 
LRes97461 = reshape_layer(Res81868, [1, 1, 1], Res97461), 
LZer99045 = zero_padding2D_layer(Res97461, 1, 0, 0, 0, Zer99045), 
LMas8541 = masking_layer([[[[1.0141], [1.6853]], [[1.0644], [1.1942]], [[1.6525], [1.011]], [[1.6625], [1.306]]]], 1, Mas8541), 
LDep41065 = depthwise_conv2D_layer(Mas8541, 1, 1,[[[[0.3866]]]],[0], 3, 3, true, Dep41065), 
LSub52179 = subtract_layer(Zer99045,Dep41065, Sub52179), 
LRes96967 = reshape_layer(Sub52179, [2, 1], Res96967), 
LSim3503 = simple_rnn_layer([[[5, 8]]],[[5, 5], [8, 4]],[[3, 8], [8, 2]],[1, 9], Sim3503), 
LRes22443 = reshape_layer(Sim3503, [2, 1], Res22443), 
LMin7495 = minimum_layer([Res96967,Res22443], Min7495), 
LCon34233 = concatenate_layer([Min7495,[[[0.2404, 0.6987, 0.8856, 0.1836, 0.6782, 0.6382, 0.4424], [0.7226, 0.3463, 0.2444, 0.723, 0.657, 0.4322, 0.8652]]]], 2, Con34233), 
LAdd81041 = add_layer([Zer57333,Con34233], Add81041), 
exec_layers([LAdd76731,LRes56382,LRes65088,LZer57333,LMul52077,LRes54212,LFla9777,LRes34725,LRes74876,LRes65611,LGlo34874,LRes81868,LRes97461,LZer99045,LMas8541,LDep41065,LSub52179,LRes96967,LSim3503,LRes22443,LMin7495,LCon34233,LAdd81041],["Add76731","Res56382","Res65088","Zer57333","Mul52077","Res54212","Fla9777","Res34725","Res74876","Res65611","Glo34874","Res81868","Res97461","Zer99045","Mas8541","Dep41065","Sub52179","Res96967","Sim3503","Res22443","Min7495","Con34233","Add81041"],Add81041,"Add81041")

Actual (Unparsed): [[[-0.3920510, 0.2404000, 0.6987000, 0.8856000, 0.1836000, 0.6782000, 0.6382000, 0.4424000], [1.2684064, 1.5614000, 1.6109000, 0.6713000, 1.8796000, 1.7142000, 1.6688000, 2.1843000]]]

Expected (Unparsed): [[[-0.39205106,0.2404,0.6987,0.8856,0.1836,0.6782,0.6382,0.4424],[1.2684064337499998,1.5614,1.6109000000000002,0.6713,1.8796,1.7142,1.6687999999999998,2.1843000000000004]]]

Actual:   [[[-0.392, 0.2404, 0.6987, 0.8856, 0.1836, 0.6782, 0.6382, 0.4424], [1.2685, 1.5614, 1.6109, 0.6713, 1.8796, 1.7142, 1.6688, 2.1843]]]

Expected: [[[-0.392, 0.2404, 0.6987, 0.8856, 0.1836, 0.6782, 0.6382, 0.4424], [1.2685, 1.5614, 1.611, 0.6713, 1.8796, 1.7142, 1.6688, 2.1844]]]