import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min84068 = tf.keras.layers.Input(shape=([1, 1]))
in1Min84068 = tf.keras.layers.Input(shape=([1, 1]))
in0Con94319 = tf.keras.layers.Input(shape=([2, 1, 3]))
in0GRU77213 = tf.keras.layers.Input(shape=([1, 2]))

Min84068 = keras.layers.Minimum(name = 'Min84068', )([in0Min84068,in1Min84068])
Sof16818 = keras.layers.Softmax(axis=1, name = 'Sof16818', )(Min84068)
Res65968 = keras.layers.Reshape((1, 1, 1), name = 'Res65968', )(Sof16818)
Zer71510 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer71510', )(Res65968)
Con94319 = keras.layers.Concatenate(axis=3, name = 'Con94319', )([Zer71510,in0Con94319])
GRU77213 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU77213', )(in0GRU77213)
Res61531 = keras.layers.Reshape((2, 1), name = 'Res61531', )(GRU77213)
Res13021 = keras.layers.Reshape((2, 1, 1), name = 'Res13021', )(Res61531)
Loc8843 = keras.layers.LocallyConnected2D(4, (1, 1),strides=(1, 1), name = 'Loc8843', )(Res13021)
Sub4287 = keras.layers.Subtract(name = 'Sub4287', )([Con94319,Loc8843])
model = tf.keras.models.Model(inputs=[in0Min84068,in1Min84068,in0Con94319,in0GRU77213], outputs=Sub4287)
w = model.get_layer('GRU77213').get_weights() 
w[0] = np.array([[9, 8, 6, 6, 7, 5], [1, 1, 10, 5, 4, 10]])
w[1] = np.array([[10, 1, 10, 6, 4, 6], [7, 3, 6, 8, 1, 7]])
w[2] = np.array([6, 4, 6, 5, 1, 2])
model.get_layer('GRU77213').set_weights(w) 
w = model.get_layer('Loc8843').get_weights() 
w[0] = np.array([[[0.1776, 0.5282, 0.6074, 0.9903]], [[0.8797, 0.1915, 0.8305, 0.363]]])
w[1] = np.array([[[0, 0, 0, 0]], [[0, 0, 0, 0]]])
model.get_layer('Loc8843').set_weights(w) 
in0Min84068 = tf.constant([[[0.6877]]])
in1Min84068 = tf.constant([[[0.0491]]])
in0Con94319 = tf.constant([[[[0.1491, 0.0517, 0.6823]], [[0.4806, 0.3034, 0.1054]]]])
in0GRU77213 = tf.constant([[[5, 8]]])
print (np.array2string(model.predict([in0Min84068,in1Min84068,in0Con94319,in0GRU77213],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub4287.png')

LMin84068 = minimum_layer([[[[0.6877]]], [[[0.0491]]]], Min84068), 
LSof16818 = softmax_layer(Min84068, 1, Sof16818), 
LRes65968 = reshape_layer(Sof16818, [1, 1, 1], Res65968), 
LZer71510 = zero_padding2D_layer(Res65968, 1, 0, 0, 0, Zer71510), 
LCon94319 = concatenate_layer([Zer71510,[[[[0.1491, 0.0517, 0.6823]], [[0.4806, 0.3034, 0.1054]]]]], 3, Con94319), 
LGRU77213 = gru_layer([[[5, 8]]],[[9, 8, 6, 6, 7, 5], [1, 1, 10, 5, 4, 10]],[[10, 1, 10, 6, 4, 6], [7, 3, 6, 8, 1, 7]],[6, 4, 6, 5, 1, 2], false, GRU77213), 
LRes61531 = reshape_layer(GRU77213, [2, 1], Res61531), 
LRes13021 = reshape_layer(Res61531, [2, 1, 1], Res13021), 
LLoc8843 = locally_connected2D_layer(Res13021, 1, 1,[[[0.1776, 0.5282, 0.6074, 0.9903]], [[0.8797, 0.1915, 0.8305, 0.363]]],[[[0, 0, 0, 0]], [[0, 0, 0, 0]]], 1, 1, Loc8843), 
LSub4287 = subtract_layer(Con94319,Loc8843, Sub4287), 
exec_layers([LMin84068,LSof16818,LRes65968,LZer71510,LCon94319,LGRU77213,LRes61531,LRes13021,LLoc8843,LSub4287],["Min84068","Sof16818","Res65968","Zer71510","Con94319","GRU77213","Res61531","Res13021","Loc8843","Sub4287"],Sub4287,"Sub4287")

Actual (Unparsed): [[[[0.0000000, 0.1491000, 0.0517000, 0.6823000]], [[1.0000000, 0.4806000, 0.3034000, 0.1054000]]]]

Expected (Unparsed): [[[[0.0,0.1491,0.0517,0.6823]],[[1.0,0.4806,0.3034,0.1054]]]]

Actual:   [[[[0, 0.1491, 0.0517, 0.6823]], [[1, 0.4806, 0.3034, 0.1054]]]]

Expected: [[[[0, 0.1491, 0.0517, 0.6823]], [[1, 0.4806, 0.3034, 0.1054]]]]