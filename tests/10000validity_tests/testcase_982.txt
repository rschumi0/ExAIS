import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub13511 = tf.keras.layers.Input(shape=([3, 2, 2, 3]))
in1Sub13511 = tf.keras.layers.Input(shape=([3, 2, 2, 3]))
in0Bat6399 = tf.keras.layers.Input(shape=([3]))
in0Con23389 = tf.keras.layers.Input(shape=([33]))

Sub13511 = keras.layers.Subtract(name = 'Sub13511', )([in0Sub13511,in1Sub13511])
Res54367 = keras.layers.Reshape((3, 2, 6), name = 'Res54367', )(Sub13511)
Res26494 = keras.layers.Reshape((3, 12), name = 'Res26494', )(Res54367)
Fla60936 = keras.layers.Flatten(name = 'Fla60936', )(Res26494)
Bat6399 = keras.layers.BatchNormalization(axis=1, epsilon=0.441236406350766,  name = 'Bat6399', )(in0Bat6399)
Con23389 = keras.layers.Concatenate(axis=1, name = 'Con23389', )([Bat6399,in0Con23389])
Add90516 = keras.layers.Add(name = 'Add90516', )([Fla60936,Con23389])
Res12631 = keras.layers.Reshape((36, 1), name = 'Res12631', )(Add90516)
Res42488 = keras.layers.Reshape((36, 1, 1), name = 'Res42488', )(Res12631)
Sep97374 = keras.layers.SeparableConv2D(4, (29, 1),strides=(9, 9), padding='valid', name = 'Sep97374', )(Res42488)
model = tf.keras.models.Model(inputs=[in0Sub13511,in1Sub13511,in0Bat6399,in0Con23389], outputs=Sep97374)
w = model.get_layer('Bat6399').get_weights() 
w[0] = np.array([0.6955, 0.9067, 0.8938])
w[1] = np.array([0.9757, 0.8483, 0.8993])
w[2] = np.array([0.1363, 0.4551, 0.3138])
w[3] = np.array([0.8849, 0.9104, 0.3])
model.get_layer('Bat6399').set_weights(w) 
w = model.get_layer('Sep97374').get_weights() 
w[0] = np.array([[[[0.9949]]], [[[0.4813]]], [[[0.7538]]], [[[0.3188]]], [[[0.297]]], [[[0.4937]]], [[[0.8936]]], [[[0.8388]]], [[[0.149]]], [[[0.6821]]], [[[0.9792]]], [[[0.0018]]], [[[0.2895]]], [[[0.9304]]], [[[0.5473]]], [[[0.089]]], [[[0.0179]]], [[[0.942]]], [[[0.9979]]], [[[0.3169]]], [[[0.9507]]], [[[0.8622]]], [[[0.9234]]], [[[0.4461]]], [[[0.0372]]], [[[0.0423]]], [[[0.6302]]], [[[0.2285]]], [[[0.8648]]]])
w[1] = np.array([[[[0.8575, 0.2765, 0.5718, 0.9784]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep97374').set_weights(w) 
in0Sub13511 = tf.constant([[[[[0.3913, 0.6344, 0.0894], [0.5336, 0.2759, 0.0051]], [[0.375, 0.6065, 0.98], [0.036, 0.9459, 0.6596]]], [[[0.2038, 0.0695, 0.0675], [0.0261, 0.8829, 0.4795]], [[0.4377, 0.3143, 0.7658], [0.679, 0.5397, 0.0255]]], [[[0.6, 0.4786, 0.7942], [0.7101, 0.9158, 0.8041]], [[0.4113, 0.5354, 0.667], [0.2748, 0.1256, 0.2776]]]]])
in1Sub13511 = tf.constant([[[[[0.5332, 0.1658, 0.0632], [0.9087, 0.5179, 0.8382]], [[0.8318, 0.1523, 0.5883], [0.803, 0.5519, 0.6038]]], [[[0.4923, 0.2057, 0.9545], [0.2739, 0.5629, 0.6677]], [[0.8596, 0.7013, 0.2726], [0.0994, 0.3183, 0.103]]], [[[0.5374, 0.3147, 0.4526], [0.3836, 0.2855, 0.0168]], [[0.561, 0.2077, 0.6038], [0.0018, 0.3686, 0.7553]]]]])
in0Bat6399 = tf.constant([[1.8544, 1.2323, 1.3977]])
in0Con23389 = tf.constant([[0.4455, 0.0659, 0.114, 0.3506, 0.9881, 0.199, 0.4727, 0.394, 0.1166, 0.8561, 0.207, 0.4022, 0.8341, 0.6188, 0.448, 0.0654, 0.9006, 0.0825, 0.8521, 0.7723, 0.6794, 0.2466, 0.2637, 0.7737, 0.2393, 0.7694, 0.0977, 0.7321, 0.4814, 0.7639, 0.735, 0.6004, 0.3622]])
print (np.array2string(model.predict([in0Sub13511,in1Sub13511,in0Bat6399,in0Con23389],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sep97374.png')

LSub13511 = subtract_layer([[[[[0.3913, 0.6344, 0.0894], [0.5336, 0.2759, 0.0051]], [[0.375, 0.6065, 0.98], [0.036, 0.9459, 0.6596]]], [[[0.2038, 0.0695, 0.0675], [0.0261, 0.8829, 0.4795]], [[0.4377, 0.3143, 0.7658], [0.679, 0.5397, 0.0255]]], [[[0.6, 0.4786, 0.7942], [0.7101, 0.9158, 0.8041]], [[0.4113, 0.5354, 0.667], [0.2748, 0.1256, 0.2776]]]]], [[[[[0.5332, 0.1658, 0.0632], [0.9087, 0.5179, 0.8382]], [[0.8318, 0.1523, 0.5883], [0.803, 0.5519, 0.6038]]], [[[0.4923, 0.2057, 0.9545], [0.2739, 0.5629, 0.6677]], [[0.8596, 0.7013, 0.2726], [0.0994, 0.3183, 0.103]]], [[[0.5374, 0.3147, 0.4526], [0.3836, 0.2855, 0.0168]], [[0.561, 0.2077, 0.6038], [0.0018, 0.3686, 0.7553]]]]], Sub13511), 
LRes54367 = reshape_layer(Sub13511, [3, 2, 6], Res54367), 
LRes26494 = reshape_layer(Res54367, [3, 12], Res26494), 
LFla60936 = flatten_layer(Res26494, Fla60936), 
LBat6399 = batch_normalization_layer([[1.8544, 1.2323, 1.3977]], 1, 0.441236406350766, [0.6955, 0.9067, 0.8938], [0.9757, 0.8483, 0.8993], [0.1363, 0.4551, 0.3138], [0.8849, 0.9104, 0.3], Bat6399), 
LCon23389 = concatenate_layer([Bat6399,[[0.4455, 0.0659, 0.114, 0.3506, 0.9881, 0.199, 0.4727, 0.394, 0.1166, 0.8561, 0.207, 0.4022, 0.8341, 0.6188, 0.448, 0.0654, 0.9006, 0.0825, 0.8521, 0.7723, 0.6794, 0.2466, 0.2637, 0.7737, 0.2393, 0.7694, 0.0977, 0.7321, 0.4814, 0.7639, 0.735, 0.6004, 0.3622]]], 1, Con23389), 
LAdd90516 = add_layer([Fla60936,Con23389], Add90516), 
LRes12631 = reshape_layer(Add90516, [36, 1], Res12631), 
LRes42488 = reshape_layer(Res12631, [36, 1, 1], Res42488), 
LSep97374 = separable_conv2D_layer(Res42488, 29, 1,[[[[[0.9949]]], [[[0.4813]]], [[[0.7538]]], [[[0.3188]]], [[[0.297]]], [[[0.4937]]], [[[0.8936]]], [[[0.8388]]], [[[0.149]]], [[[0.6821]]], [[[0.9792]]], [[[0.0018]]], [[[0.2895]]], [[[0.9304]]], [[[0.5473]]], [[[0.089]]], [[[0.0179]]], [[[0.942]]], [[[0.9979]]], [[[0.3169]]], [[[0.9507]]], [[[0.8622]]], [[[0.9234]]], [[[0.4461]]], [[[0.0372]]], [[[0.0423]]], [[[0.6302]]], [[[0.2285]]], [[[0.8648]]]],[[[[0.8575, 0.2765, 0.5718, 0.9784]]]]],[0, 0, 0, 0], 9, 9, false, Sep97374), 
exec_layers([LSub13511,LRes54367,LRes26494,LFla60936,LBat6399,LCon23389,LAdd90516,LRes12631,LRes42488,LSep97374],["Sub13511","Res54367","Res26494","Fla60936","Bat6399","Con23389","Add90516","Res12631","Res42488","Sep97374"],Sep97374,"Sep97374")

Actual (Unparsed): [[[[9.3022809, 2.9995110, 6.2029670, 10.6138212]]]]

Expected (Unparsed): [[[[9.302280888100949,2.999510980244796,6.202967010864284,10.613821132265851]]]]

Actual:   [[[[9.3023, 2.9996, 6.203, 10.6139]]]]

Expected: [[[[9.3023, 2.9996, 6.203, 10.6139]]]]