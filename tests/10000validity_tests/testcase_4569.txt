import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo99201 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in0Ave17689 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Ave17689 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Con96857 = tf.keras.layers.Input(shape=([2, 1]))

Glo99201 = keras.layers.GlobalMaxPool3D(name = 'Glo99201', )(in0Glo99201)
Bat77742 = keras.layers.BatchNormalization(axis=1, epsilon=0.5040364439594418,  name = 'Bat77742', )(Glo99201)
Res79296 = keras.layers.Reshape((2, 1), name = 'Res79296', )(Bat77742)
Sep26660 = keras.layers.SeparableConv1D(3, (1),strides=(1), padding='valid', name = 'Sep26660', )(Res79296)
Ave17689 = keras.layers.Average(name = 'Ave17689', )([in0Ave17689,in1Ave17689])
Res95663 = keras.layers.Reshape((1, 2, 2), name = 'Res95663', )(Ave17689)
Cro4006 = keras.layers.Cropping2D(cropping=((0, 0), (0, 1)), name = 'Cro4006', )(Res95663)
Res52359 = keras.layers.Reshape((1, 2), name = 'Res52359', )(Cro4006)
Ave95735 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave95735', )(Res52359)
Zer97995 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer97995', )(Ave95735)
Con96857 = keras.layers.Concatenate(axis=2, name = 'Con96857', )([Zer97995,in0Con96857])
Ave17052 = keras.layers.Average(name = 'Ave17052', )([Sep26660,Con96857])
model = tf.keras.models.Model(inputs=[in0Glo99201,in0Ave17689,in1Ave17689,in0Con96857], outputs=Ave17052)
w = model.get_layer('Bat77742').get_weights() 
w[0] = np.array([0.2521, 0.3087])
w[1] = np.array([0.2696, 0.4659])
w[2] = np.array([0.5133, 0.46])
w[3] = np.array([0.9967, 0.5125])
model.get_layer('Bat77742').set_weights(w) 
w = model.get_layer('Sep26660').get_weights() 
w[0] = np.array([[[0.9868]]])
w[1] = np.array([[[0.4969, 0.9201, 0.5283]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep26660').set_weights(w) 
in0Glo99201 = tf.constant([[[[[1.7728, 1.8842]]]]])
in0Ave17689 = tf.constant([[[[[0.2583, 0.6994]], [[0.3294, 0.0394]]]]])
in1Ave17689 = tf.constant([[[[[0.0411, 0.059]], [[0.5185, 0.2635]]]]])
in0Con96857 = tf.constant([[[0.7236], [0.9805]]])
print (np.array2string(model.predict([in0Glo99201,in0Ave17689,in1Ave17689,in0Con96857],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave17052.png')

LGlo99201 = global_max_pool3D_layer([[[[[1.7728, 1.8842]]]]], Glo99201), 
LBat77742 = batch_normalization_layer(Glo99201, 1, 0.5040364439594418, [0.2521, 0.3087], [0.2696, 0.4659], [0.5133, 0.46], [0.9967, 0.5125], Bat77742), 
LRes79296 = reshape_layer(Bat77742, [2, 1], Res79296), 
LSep26660 = separable_conv1D_layer(Res79296, 1,[[[[0.9868]]],[[[0.4969, 0.9201, 0.5283]]]],[0, 0, 0], 1, false, Sep26660), 
LAve17689 = average_layer([[[[[[0.2583, 0.6994]], [[0.3294, 0.0394]]]]], [[[[[0.0411, 0.059]], [[0.5185, 0.2635]]]]]], Ave17689), 
LRes95663 = reshape_layer(Ave17689, [1, 2, 2], Res95663), 
LCro4006 = cropping2D_layer(Res95663, 0, 0, 0, 1, Cro4006), 
LRes52359 = reshape_layer(Cro4006, [1, 2], Res52359), 
LAve95735 = average_pooling1D_layer(Res52359, 1, Ave95735), 
LZer97995 = zero_padding1D_layer(Ave95735, 1, 0, Zer97995), 
LCon96857 = concatenate_layer([Zer97995,[[[0.7236], [0.9805]]]], 2, Con96857), 
LAve17052 = average_layer([Sep26660,Con96857], Ave17052), 
exec_layers([LGlo99201,LBat77742,LRes79296,LSep26660,LAve17689,LRes95663,LCro4006,LRes52359,LAve95735,LZer97995,LCon96857,LAve17052],["Glo99201","Bat77742","Res79296","Sep26660","Ave17689","Res95663","Cro4006","Res52359","Ave95735","Zer97995","Con96857","Ave17052"],Ave17052,"Ave17052")

Actual (Unparsed): [[[0.1296438, 0.2400588, 0.4996362], [0.2959839, 0.5990693, 0.7253578]]]

Expected (Unparsed): [[[0.12964376966899682,0.2400588296889595,0.49963619141906024],[0.29598391951357783,0.5990693486505192,0.7253577675166496]]]

Actual:   [[[0.1297, 0.2401, 0.4997], [0.296, 0.5991, 0.7254]]]

Expected: [[[0.1297, 0.2401, 0.4997], [0.296, 0.5991, 0.7254]]]