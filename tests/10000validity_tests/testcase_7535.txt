import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con33864 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in0Con17804 = tf.keras.layers.Input(shape=([3, 1]))
in0Sub88925 = tf.keras.layers.Input(shape=([3, 3]))
in1Sub88925 = tf.keras.layers.Input(shape=([3, 3]))
in0Con68381 = tf.keras.layers.Input(shape=([3, 1]))
in0Glo78154 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Con6712 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Dot41881 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot41881 = tf.keras.layers.Input(shape=([2, 3]))
in0Con62796 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Max90644 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Ave73788 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave73788 = tf.keras.layers.Input(shape=([2, 2]))
in0Con90935 = tf.keras.layers.Input(shape=([2, 2]))

Con33864 = keras.layers.Conv3DTranspose(2, (1, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con33864', )(in0Con33864)
Res46700 = keras.layers.Reshape((1, 1, 2), name = 'Res46700', )(Con33864)
Res20287 = keras.layers.Reshape((1, 2), name = 'Res20287', )(Res46700)
Zer10101 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer10101', )(Res20287)
Con17804 = keras.layers.Concatenate(axis=2, name = 'Con17804', )([Zer10101,in0Con17804])
Sub88925 = keras.layers.Subtract(name = 'Sub88925', )([in0Sub88925,in1Sub88925])
Add6109 = keras.layers.Add(name = 'Add6109', )([Con17804,Sub88925])
Con68381 = keras.layers.Concatenate(axis=2, name = 'Con68381', )([Add6109,in0Con68381])
Glo78154 = keras.layers.GlobalAveragePooling3D(name = 'Glo78154', )(in0Glo78154)
Res61438 = keras.layers.Reshape((2, 1), name = 'Res61438', )(Glo78154)
Res56128 = keras.layers.Reshape((2, 1, 1), name = 'Res56128', )(Res61438)
Res59641 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res59641', )(Res56128)
Cro5962 = keras.layers.Cropping3D(cropping=((1, 0), (0, 0), (0, 0)), name = 'Cro5962', )(Res59641)
Res21560 = keras.layers.Reshape((1, 1, 1), name = 'Res21560', )(Cro5962)
Zer24765 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer24765', )(Res21560)
Con6712 = keras.layers.Concatenate(axis=3, name = 'Con6712', )([Zer24765,in0Con6712])
Dot41881 = keras.layers.Dot(axes=(2, 2), name = 'Dot41881', )([in0Dot41881,in1Dot41881])
Res27194 = keras.layers.Reshape((2, 2, 1), name = 'Res27194', )(Dot41881)
Con62796 = keras.layers.Concatenate(axis=3, name = 'Con62796', )([Res27194,in0Con62796])
Max90644 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max90644', )(in0Max90644)
Zer52652 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer52652', )(Max90644)
Sub94318 = keras.layers.Subtract(name = 'Sub94318', )([Con62796,Zer52652])
Ave25742 = keras.layers.Average(name = 'Ave25742', )([Con6712,Sub94318])
Res39924 = keras.layers.Reshape((2, 4), name = 'Res39924', )(Ave25742)
Ave73788 = keras.layers.Average(name = 'Ave73788', )([in0Ave73788,in1Ave73788])
Con90935 = keras.layers.Concatenate(axis=2, name = 'Con90935', )([Ave73788,in0Con90935])
Add42912 = keras.layers.Add(name = 'Add42912', )([Res39924,Con90935])
Zer57836 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer57836', )(Add42912)
Max7717 = keras.layers.Maximum(name = 'Max7717', )([Con68381,Zer57836])
model = tf.keras.models.Model(inputs=[in0Con33864,in0Con17804,in0Sub88925,in1Sub88925,in0Con68381,in0Glo78154,in0Con6712,in0Dot41881,in1Dot41881,in0Con62796,in0Max90644,in0Ave73788,in1Ave73788,in0Con90935], outputs=Max7717)
w = model.get_layer('Con33864').get_weights() 
w[0] = np.array([[[[[0.2058, 0.1912], [0.5563, 0.6338]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con33864').set_weights(w) 
in0Con33864 = tf.constant([[[[[0.4158, 0.7357]]]]])
in0Con17804 = tf.constant([[[0.5307], [0.4512], [0.2613]]])
in0Sub88925 = tf.constant([[[0.3541, 0.6308, 0.4194], [0.5714, 0.3176, 0.4304], [0.6487, 0.7015, 0.1649]]])
in1Sub88925 = tf.constant([[[0.0207, 0.8287, 0.1211], [0.4762, 0.7966, 0.6848], [0.3398, 0.3908, 0.4763]]])
in0Con68381 = tf.constant([[[0.8437], [0.4585], [0.5174]]])
in0Glo78154 = tf.constant([[[[[1.242, 1.9087], [1.078, 1.8641]], [[1.1779, 1.1595], [1.5056, 1.1733]]], [[[1.5228, 1.2017], [1.7609, 1.1587]], [[1.184, 1.6961], [1.0038, 1.04]]]]])
in0Con6712 = tf.constant([[[[0.3086], [0.3971]], [[0.1227], [0.8166]]]])
in0Dot41881 = tf.constant([[[0.4809, 0.1744, 0.9806], [0.2175, 0.1217, 0.7047]]])
in1Dot41881 = tf.constant([[[0.9129, 0.0764, 0.8274], [0.5185, 0.4914, 0.7571]]])
in0Con62796 = tf.constant([[[[0.2093], [0.7893]], [[0.466], [0.7576]]]])
in0Max90644 = tf.constant([[[[1.1133, 1.8073]], [[1.6488, 1.6286]]]])
in0Ave73788 = tf.constant([[[0.5758, 0.2759], [0.7654, 0.3439]]])
in1Ave73788 = tf.constant([[[0.4001, 0.1919], [0.9689, 0.7778]]])
in0Con90935 = tf.constant([[[0.1798, 0.4793], [0.8089, 0.0405]]])
print (np.array2string(model.predict([in0Con33864,in0Con17804,in0Sub88925,in1Sub88925,in0Con68381,in0Glo78154,in0Con6712,in0Dot41881,in1Dot41881,in0Con62796,in0Max90644,in0Ave73788,in1Ave73788,in0Con90935],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max7717.png')

LCon33864 = conv3D_transpose_layer([[[[[0.4158, 0.7357]]]]], 1, 1, 1,[[[[[0.2058, 0.1912], [0.5563, 0.6338]]]]],[0, 0], 1, 1, 1, false, Con33864), 
LRes46700 = reshape_layer(Con33864, [1, 1, 2], Res46700), 
LRes20287 = reshape_layer(Res46700, [1, 2], Res20287), 
LZer10101 = zero_padding1D_layer(Res20287, 1, 1, Zer10101), 
LCon17804 = concatenate_layer([Zer10101,[[[0.5307], [0.4512], [0.2613]]]], 2, Con17804), 
LSub88925 = subtract_layer([[[0.3541, 0.6308, 0.4194], [0.5714, 0.3176, 0.4304], [0.6487, 0.7015, 0.1649]]], [[[0.0207, 0.8287, 0.1211], [0.4762, 0.7966, 0.6848], [0.3398, 0.3908, 0.4763]]], Sub88925), 
LAdd6109 = add_layer([Con17804,Sub88925], Add6109), 
LCon68381 = concatenate_layer([Add6109,[[[0.8437], [0.4585], [0.5174]]]], 2, Con68381), 
LGlo78154 = global_average_pooling3D_layer([[[[[1.242, 1.9087], [1.078, 1.8641]], [[1.1779, 1.1595], [1.5056, 1.1733]]], [[[1.5228, 1.2017], [1.7609, 1.1587]], [[1.184, 1.6961], [1.0038, 1.04]]]]], Glo78154), 
LRes61438 = reshape_layer(Glo78154, [2, 1], Res61438), 
LRes56128 = reshape_layer(Res61438, [2, 1, 1], Res56128), 
LRes59641 = reshape_layer(Res56128, [2, 1, 1, 1], Res59641), 
LCro5962 = cropping3D_layer(Res59641, 1, 0, 0, 0, 0, 0, Cro5962), 
LRes21560 = reshape_layer(Cro5962, [1, 1, 1], Res21560), 
LZer24765 = zero_padding2D_layer(Res21560, 1, 0, 1, 0, Zer24765), 
LCon6712 = concatenate_layer([Zer24765,[[[[0.3086], [0.3971]], [[0.1227], [0.8166]]]]], 3, Con6712), 
LDot41881 = dot_layer([[[0.4809, 0.1744, 0.9806], [0.2175, 0.1217, 0.7047]]], [[[0.9129, 0.0764, 0.8274], [0.5185, 0.4914, 0.7571]]], 2, 2, Dot41881), 
LRes27194 = reshape_layer(Dot41881, [2, 2, 1], Res27194), 
LCon62796 = concatenate_layer([Res27194,[[[[0.2093], [0.7893]], [[0.466], [0.7576]]]]], 3, Con62796), 
LMax90644 = max_pool2D_layer([[[[1.1133, 1.8073]], [[1.6488, 1.6286]]]], 1, 1, Max90644), 
LZer52652 = zero_padding2D_layer(Max90644, 0, 0, 1, 0, Zer52652), 
LSub94318 = subtract_layer(Con62796,Zer52652, Sub94318), 
LAve25742 = average_layer([Con6712,Sub94318], Ave25742), 
LRes39924 = reshape_layer(Ave25742, [2, 4], Res39924), 
LAve73788 = average_layer([[[[0.5758, 0.2759], [0.7654, 0.3439]]], [[[0.4001, 0.1919], [0.9689, 0.7778]]]], Ave73788), 
LCon90935 = concatenate_layer([Ave73788,[[[0.1798, 0.4793], [0.8089, 0.0405]]]], 2, Con90935), 
LAdd42912 = add_layer([Res39924,Con90935], Add42912), 
LZer57836 = zero_padding1D_layer(Add42912, 1, 0, Zer57836), 
LMax7717 = maximum_layer([Con68381,Zer57836], Max7717), 
exec_layers([LCon33864,LRes46700,LRes20287,LZer10101,LCon17804,LSub88925,LAdd6109,LCon68381,LGlo78154,LRes61438,LRes56128,LRes59641,LCro5962,LRes21560,LZer24765,LCon6712,LDot41881,LRes27194,LCon62796,LMax90644,LZer52652,LSub94318,LAve25742,LRes39924,LAve73788,LCon90935,LAdd42912,LZer57836,LMax7717],["Con33864","Res46700","Res20287","Zer10101","Con17804","Sub88925","Add6109","Con68381","Glo78154","Res61438","Res56128","Res59641","Cro5962","Res21560","Zer24765","Con6712","Dot41881","Res27194","Con62796","Max90644","Zer52652","Sub94318","Ave25742","Res39924","Ave73788","Con90935","Add42912","Zer57836","Max7717"],Max7717,"Max7717")

Actual (Unparsed): [[[0.3334000, 0.0000000, 0.8290000, 0.8437000], [1.1197931, 0.4928500, 0.1968000, 0.4585000], [1.2626112, 0.8552000, 1.0376840, 0.5174000]]]

Expected (Unparsed): [[[0.33340000000000003,0,0.829,0.8437],[1.1197931049999998,0.49285,0.19680000000000003,0.4585],[1.262611205,0.8552000000000001,1.0376839999999998,0.5174]]]

Actual:   [[[0.3334, 0, 0.829, 0.8437], [1.1198, 0.4929, 0.1968, 0.4585], [1.2627, 0.8552, 1.0377, 0.5174]]]

Expected: [[[0.3335, 0, 0.829, 0.8437], [1.1198, 0.4929, 0.1969, 0.4585], [1.2627, 0.8553, 1.0377, 0.5174]]]