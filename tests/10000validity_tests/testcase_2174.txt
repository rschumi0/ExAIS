import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max40911 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Max40911 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in0Lay27143 = tf.keras.layers.Input(shape=([2]))
in0Con95478 = tf.keras.layers.Input(shape=([3, 2]))
in0Dot82530 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot82530 = tf.keras.layers.Input(shape=([3, 3]))

Max40911 = keras.layers.Maximum(name = 'Max40911', )([in0Max40911,in1Max40911])
Res71929 = keras.layers.Reshape((1, 1, 2), name = 'Res71929', )(Max40911)
Res4274 = keras.layers.Reshape((1, 2), name = 'Res4274', )(Res71929)
Fla60410 = keras.layers.Flatten(name = 'Fla60410', )(Res4274)
Lay27143 = keras.layers.LayerNormalization(axis=1, epsilon=1.0411876259991035, name = 'Lay27143', )(in0Lay27143)
Add48822 = keras.layers.Add(name = 'Add48822', )([Fla60410,Lay27143])
Res19608 = keras.layers.Reshape((2, 1), name = 'Res19608', )(Add48822)
Zer59311 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer59311', )(Res19608)
Con95478 = keras.layers.Concatenate(axis=2, name = 'Con95478', )([Zer59311,in0Con95478])
Dot82530 = keras.layers.Dot(axes=(1, 1), name = 'Dot82530', )([in0Dot82530,in1Dot82530])
Mul93856 = keras.layers.Multiply(name = 'Mul93856', )([Con95478,Dot82530])
model = tf.keras.models.Model(inputs=[in0Max40911,in1Max40911,in0Lay27143,in0Con95478,in0Dot82530,in1Dot82530], outputs=Mul93856)
in0Max40911 = tf.constant([[[[[0.0264, 0.2812]]]]])
in1Max40911 = tf.constant([[[[[0.0321, 0.655]]]]])
in0Lay27143 = tf.constant([[1.8394, 1.7221]])
in0Con95478 = tf.constant([[[0.1911, 0.5607], [0.1608, 0.0435], [0.0798, 0.2505]]])
in0Dot82530 = tf.constant([[[0.0728, 0.1622, 0.9606], [0.6329, 0.2436, 0.1402], [0.2698, 0.2461, 0.5531]]])
in1Dot82530 = tf.constant([[[0.609, 0.3157, 0.4961], [0.5404, 0.3325, 0.017], [0.5873, 0.9482, 0.9408]]])
print (np.array2string(model.predict([in0Max40911,in1Max40911,in0Lay27143,in0Con95478,in0Dot82530,in1Dot82530],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul93856.png')

LMax40911 = maximum_layer([[[[[[0.0264, 0.2812]]]]], [[[[[0.0321, 0.655]]]]]], Max40911), 
LRes71929 = reshape_layer(Max40911, [1, 1, 2], Res71929), 
LRes4274 = reshape_layer(Res71929, [1, 2], Res4274), 
LFla60410 = flatten_layer(Res4274, Fla60410), 
LLay27143 = layer_normalization_layer([[1.8394, 1.7221]], 1, 1.0411876259991035, Lay27143), 
LAdd48822 = add_layer([Fla60410,Lay27143], Add48822), 
LRes19608 = reshape_layer(Add48822, [2, 1], Res19608), 
LZer59311 = zero_padding1D_layer(Res19608, 1, 0, Zer59311), 
LCon95478 = concatenate_layer([Zer59311,[[[0.1911, 0.5607], [0.1608, 0.0435], [0.0798, 0.2505]]]], 2, Con95478), 
LDot82530 = dot_layer([[[0.0728, 0.1622, 0.9606], [0.6329, 0.2436, 0.1402], [0.2698, 0.2461, 0.5531]]], [[[0.609, 0.3157, 0.4961], [0.5404, 0.3325, 0.017], [0.5873, 0.9482, 0.9408]]], 1, 1, Dot82530), 
LMul93856 = multiply_layer([Con95478,Dot82530], Mul93856), 
exec_layers([LMax40911,LRes71929,LRes4274,LFla60410,LLay27143,LAdd48822,LRes19608,LZer59311,LCon95478,LDot82530,LMul93856],["Max40911","Res71929","Res4274","Fla60410","Lay27143","Add48822","Res19608","Zer59311","Con95478","Dot82530","Mul93856"],Mul93856,"Mul93856")

Actual (Unparsed): [[[0.0000000, 0.0934950, 0.1686043], [0.0335524, 0.0587813, 0.0137521], [0.5890138, 0.0697713, 0.2503230]]]

Expected (Unparsed): [[[0.0,0.093495019527,0.168604295454],[0.033552367832637785,0.058781334048,0.013752068249999999],[0.5890138415548793,0.069771321732,0.25032303177]]]

Actual:   [[[0, 0.0935, 0.1687], [0.0336, 0.0588, 0.0138], [0.5891, 0.0698, 0.2504]]]

Expected: [[[0, 0.0935, 0.1687], [0.0336, 0.0588, 0.0138], [0.5891, 0.0698, 0.2504]]]