import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST55252 = tf.keras.layers.Input(shape=([1, 3]))
in0Con95248 = tf.keras.layers.Input(shape=([6, 4, 1]))
in0Up_76294 = tf.keras.layers.Input(shape=([3, 2, 2, 1]))
in0Glo96580 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con74600 = tf.keras.layers.Input(shape=([6, 4, 1]))
in0Mul81107 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Mul81107 = tf.keras.layers.Input(shape=([1, 2, 1]))

LST55252 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST55252', )(in0LST55252)
Res65275 = keras.layers.Reshape((2, 1), name = 'Res65275', )(LST55252)
Res22594 = keras.layers.Reshape((2, 1, 1), name = 'Res22594', )(Res65275)
Zer9184 = keras.layers.ZeroPadding2D(padding=((4, 0), (3, 0)), name = 'Zer9184', )(Res22594)
Con95248 = keras.layers.Concatenate(axis=3, name = 'Con95248', )([Zer9184,in0Con95248])
Up_76294 = keras.layers.UpSampling3D(size=(2, 2, 1), name = 'Up_76294', )(in0Up_76294)
Res41408 = keras.layers.Reshape((6, 4, 2), name = 'Res41408', )(Up_76294)
Glo96580 = keras.layers.GlobalMaxPool2D(name = 'Glo96580', )(in0Glo96580)
Res82613 = keras.layers.Reshape((2, 1), name = 'Res82613', )(Glo96580)
Res16858 = keras.layers.Reshape((2, 1, 1), name = 'Res16858', )(Res82613)
Max64759 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 1), padding='same', name = 'Max64759', )(Res16858)
Zer15051 = keras.layers.ZeroPadding2D(padding=((4, 0), (3, 0)), name = 'Zer15051', )(Max64759)
Con74600 = keras.layers.Concatenate(axis=3, name = 'Con74600', )([Zer15051,in0Con74600])
Mul14676 = keras.layers.Multiply(name = 'Mul14676', )([Res41408,Con74600])
Mul45582 = keras.layers.Multiply(name = 'Mul45582', )([Con95248,Mul14676])
Res7761 = keras.layers.Reshape((6, 8), name = 'Res7761', )(Mul45582)
Mul81107 = keras.layers.Multiply(name = 'Mul81107', )([in0Mul81107,in1Mul81107])
Res54122 = keras.layers.Reshape((1, 2), name = 'Res54122', )(Mul81107)
Zer48894 = keras.layers.ZeroPadding1D(padding=((5, 0)), name = 'Zer48894', )(Res54122)
Dot82393 = keras.layers.Dot(axes=(1, 1), name = 'Dot82393', )([Res7761,Zer48894])
model = tf.keras.models.Model(inputs=[in0LST55252,in0Con95248,in0Up_76294,in0Glo96580,in0Con74600,in0Mul81107,in1Mul81107], outputs=Dot82393)
w = model.get_layer('LST55252').get_weights() 
w[0] = np.array([[6, 4, 4, 4, 5, 2, 2, 6], [6, 5, 6, 2, 2, 4, 3, 1], [2, 1, 6, 8, 1, 3, 2, 9]])
w[1] = np.array([[7, 9, 10, 3, 5, 8, 2, 4], [5, 9, 1, 9, 6, 7, 1, 2]])
w[2] = np.array([9, 6, 5, 9, 5, 5, 3, 10])
model.get_layer('LST55252').set_weights(w) 
in0LST55252 = tf.constant([[[7, 9, 9]]])
in0Con95248 = tf.constant([[[[0.0443], [0.2711], [0.3061], [0.956]], [[0.0812], [0.7549], [0.685], [0.379]], [[0.31], [0.609], [0.2418], [0.0445]], [[0.9234], [0.8993], [0.5294], [0.5062]], [[0.4442], [0.0302], [0.0166], [0.5682]], [[0.2532], [0.9145], [0.6044], [0.323]]]])
in0Up_76294 = tf.constant([[[[[1.0264], [1.6309]], [[1.2176], [1.0109]]], [[[1.0593], [1.9334]], [[1.8062], [1.0739]]], [[[1.1966], [1.2187]], [[1.4318], [1.2124]]]]])
in0Glo96580 = tf.constant([[[[1.993, 1.2681], [1.1171, 1.0509]], [[1.8497, 1.3238], [1.3033, 1.3824]]]])
in0Con74600 = tf.constant([[[[0.5327], [0.3336], [0.8714], [0.6221]], [[0.4759], [0.5394], [0.7657], [0.3981]], [[0.0164], [0.3627], [0.293], [0.0972]], [[0.3924], [0.4149], [0.5568], [0.2018]], [[0.9073], [0.378], [0.6491], [0.1912]], [[0.0381], [0.9103], [0.4573], [0.5]]]])
in0Mul81107 = tf.constant([[[[0.7841], [0.258]]]])
in1Mul81107 = tf.constant([[[[0.6752], [0.7547]]]])
print (np.array2string(model.predict([in0LST55252,in0Con95248,in0Up_76294,in0Glo96580,in0Con74600,in0Mul81107,in1Mul81107],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot82393.png')

LLST55252 = lstm_layer([[[7, 9, 9]]],[[6, 4, 4, 4, 5, 2, 2, 6], [6, 5, 6, 2, 2, 4, 3, 1], [2, 1, 6, 8, 1, 3, 2, 9]],[[7, 9, 10, 3, 5, 8, 2, 4], [5, 9, 1, 9, 6, 7, 1, 2]],[9, 6, 5, 9, 5, 5, 3, 10], LST55252), 
LRes65275 = reshape_layer(LST55252, [2, 1], Res65275), 
LRes22594 = reshape_layer(Res65275, [2, 1, 1], Res22594), 
LZer9184 = zero_padding2D_layer(Res22594, 4, 0, 3, 0, Zer9184), 
LCon95248 = concatenate_layer([Zer9184,[[[[0.0443], [0.2711], [0.3061], [0.956]], [[0.0812], [0.7549], [0.685], [0.379]], [[0.31], [0.609], [0.2418], [0.0445]], [[0.9234], [0.8993], [0.5294], [0.5062]], [[0.4442], [0.0302], [0.0166], [0.5682]], [[0.2532], [0.9145], [0.6044], [0.323]]]]], 3, Con95248), 
LUp_76294 = up_sampling3D_layer([[[[[1.0264], [1.6309]], [[1.2176], [1.0109]]], [[[1.0593], [1.9334]], [[1.8062], [1.0739]]], [[[1.1966], [1.2187]], [[1.4318], [1.2124]]]]], 2, 2, 1, Up_76294), 
LRes41408 = reshape_layer(Up_76294, [6, 4, 2], Res41408), 
LGlo96580 = global_max_pool2D_layer([[[[1.993, 1.2681], [1.1171, 1.0509]], [[1.8497, 1.3238], [1.3033, 1.3824]]]], Glo96580), 
LRes82613 = reshape_layer(Glo96580, [2, 1], Res82613), 
LRes16858 = reshape_layer(Res82613, [2, 1, 1], Res16858), 
LMax64759 = max_pool2D_layer(Res16858, 1, 1, 1, 1, true, Max64759), 
LZer15051 = zero_padding2D_layer(Max64759, 4, 0, 3, 0, Zer15051), 
LCon74600 = concatenate_layer([Zer15051,[[[[0.5327], [0.3336], [0.8714], [0.6221]], [[0.4759], [0.5394], [0.7657], [0.3981]], [[0.0164], [0.3627], [0.293], [0.0972]], [[0.3924], [0.4149], [0.5568], [0.2018]], [[0.9073], [0.378], [0.6491], [0.1912]], [[0.0381], [0.9103], [0.4573], [0.5]]]]], 3, Con74600), 
LMul14676 = multiply_layer([Res41408,Con74600], Mul14676), 
LMul45582 = multiply_layer([Con95248,Mul14676], Mul45582), 
LRes7761 = reshape_layer(Mul45582, [6, 8], Res7761), 
LMul81107 = multiply_layer([[[[[0.7841], [0.258]]]], [[[[0.6752], [0.7547]]]]], Mul81107), 
LRes54122 = reshape_layer(Mul81107, [1, 2], Res54122), 
LZer48894 = zero_padding1D_layer(Res54122, 5, 0, Zer48894), 
LDot82393 = dot_layer(Res7761,Zer48894, 1, 1, Dot82393), 
exec_layers([LLST55252,LRes65275,LRes22594,LZer9184,LCon95248,LUp_76294,LRes41408,LGlo96580,LRes82613,LRes16858,LMax64759,LZer15051,LCon74600,LMul14676,LMul45582,LRes7761,LMul81107,LRes54122,LZer48894,LDot82393],["LST55252","Res65275","Res22594","Zer9184","Con95248","Up_76294","Res41408","Glo96580","Res82613","Res16858","Max64759","Zer15051","Con74600","Mul14676","Mul45582","Res7761","Mul81107","Res54122","Zer48894","Dot82393"],Dot82393,"Dot82393")

Actual (Unparsed): [[[0.0000000, 0.0000000], [0.0062243, 0.0022892], [0.0000000, 0.0000000], [0.5371171, 0.1975419], [0.0000000, 0.0000000], [0.1774089, 0.0652478], [0.7980748, 0.2935173], [0.1036627, 0.0381252]]]

Expected (Unparsed): [[[0.0,0.0],[0.006224283646255745,0.0022891778977964902],[0.0,0.0],[0.5371170654689943,0.19754185134872174],[0.0,0.0],[0.1774089282275161,0.06524776511663283],[0.798074755530792,0.29351732584510826],[0.10366265835923201,0.03812523333276]]]

Actual:   [[[0, 0], [0.0063, 0.0023], [0, 0], [0.5372, 0.1976], [0, 0], [0.1775, 0.0653], [0.7981, 0.2936], [0.1037, 0.0382]]]

Expected: [[[0, 0], [0.0063, 0.0023], [0, 0], [0.5372, 0.1976], [0, 0], [0.1775, 0.0653], [0.7981, 0.2936], [0.1037, 0.0382]]]