import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max92576 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Max92576 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con34715 = tf.keras.layers.Input(shape=([3, 2, 2, 1]))
in0Sub23282 = tf.keras.layers.Input(shape=([3, 2, 2, 2]))
in1Sub23282 = tf.keras.layers.Input(shape=([3, 2, 2, 2]))
in0Dot92475 = tf.keras.layers.Input(shape=([2]))
in1Dot92475 = tf.keras.layers.Input(shape=([2]))
in0Con71535 = tf.keras.layers.Input(shape=([3, 2, 2]))

Max92576 = keras.layers.Maximum(name = 'Max92576', )([in0Max92576,in1Max92576])
Res52081 = keras.layers.Reshape((1, 2, 2, 1), name = 'Res52081', )(Max92576)
Zer69732 = keras.layers.ZeroPadding3D(padding=((2, 0), (0, 0), (0, 0)), name = 'Zer69732', )(Res52081)
Con34715 = keras.layers.Concatenate(axis=4, name = 'Con34715', )([Zer69732,in0Con34715])
Sub23282 = keras.layers.Subtract(name = 'Sub23282', )([in0Sub23282,in1Sub23282])
Min75732 = keras.layers.Minimum(name = 'Min75732', )([Con34715,Sub23282])
Res75910 = keras.layers.Reshape((3, 2, 4), name = 'Res75910', )(Min75732)
Dot92475 = keras.layers.Dot(axes=(1, 1), name = 'Dot92475', )([in0Dot92475,in1Dot92475])
Res23185 = keras.layers.Reshape((1, 1), name = 'Res23185', )(Dot92475)
Res73816 = keras.layers.Reshape((1, 1, 1), name = 'Res73816', )(Res23185)
Con77298 = keras.layers.Conv2DTranspose(2, (1, 1),strides=(1, 1), padding='valid', name = 'Con77298', )(Res73816)
Zer17328 = keras.layers.ZeroPadding2D(padding=((2, 0), (1, 0)), name = 'Zer17328', )(Con77298)
Con71535 = keras.layers.Concatenate(axis=3, name = 'Con71535', )([Zer17328,in0Con71535])
Add66109 = keras.layers.Add(name = 'Add66109', )([Res75910,Con71535])
model = tf.keras.models.Model(inputs=[in0Max92576,in1Max92576,in0Con34715,in0Sub23282,in1Sub23282,in0Dot92475,in1Dot92475,in0Con71535], outputs=Add66109)
w = model.get_layer('Con77298').get_weights() 
w[0] = np.array([[[[0.6565], [0.5559]]]])
w[1] = np.array([0, 0])
model.get_layer('Con77298').set_weights(w) 
in0Max92576 = tf.constant([[[[0.8704, 0.5426], [0.4811, 0.2764]]]])
in1Max92576 = tf.constant([[[[0.9675, 0.65], [0.1998, 0.4582]]]])
in0Con34715 = tf.constant([[[[[0.9698], [0.8305]], [[0.06], [0.1328]]], [[[0.8878], [0.1486]], [[0.7204], [0.2259]]], [[[0.4969], [0.9134]], [[0.5439], [0.6622]]]]])
in0Sub23282 = tf.constant([[[[[0.1567, 0.8377], [0.8078, 0.0001]], [[0.9841, 0.9473], [0.5665, 0.2077]]], [[[0.1671, 0.5014], [0.9052, 0.6499]], [[0.401, 0.4861], [0.0418, 0.4759]]], [[[0.3521, 0.8898], [0.6369, 0.791]], [[0.2999, 0.6577], [0.5041, 0.9109]]]]])
in1Sub23282 = tf.constant([[[[[0.3653, 0.9556], [0.2026, 0.9992]], [[0.6426, 0.0222], [0.5471, 0.9321]]], [[[0.8363, 0.4342], [0.683, 0.2328]], [[0.2005, 0.3078], [0.3946, 0.5703]]], [[[0.6724, 0.8178], [0.7439, 0.6287]], [[0.1006, 0.4263], [0.9673, 0.116]]]]])
in0Dot92475 = tf.constant([[0.3774, 0.3852]])
in1Dot92475 = tf.constant([[0.7982, 0.3061]])
in0Con71535 = tf.constant([[[[0.3993, 0.0297], [0.335, 0.4425]], [[0.9787, 0.9718], [0.1747, 0.4715]], [[0.4858, 0.9873], [0.0346, 0.0471]]]])
print (np.array2string(model.predict([in0Max92576,in1Max92576,in0Con34715,in0Sub23282,in1Sub23282,in0Dot92475,in1Dot92475,in0Con71535],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add66109.png')

LMax92576 = maximum_layer([[[[[0.8704, 0.5426], [0.4811, 0.2764]]]], [[[[0.9675, 0.65], [0.1998, 0.4582]]]]], Max92576), 
LRes52081 = reshape_layer(Max92576, [1, 2, 2, 1], Res52081), 
LZer69732 = zero_padding3D_layer(Res52081, 2, 0, 0, 0, 0, 0, Zer69732), 
LCon34715 = concatenate_layer([Zer69732,[[[[[0.9698], [0.8305]], [[0.06], [0.1328]]], [[[0.8878], [0.1486]], [[0.7204], [0.2259]]], [[[0.4969], [0.9134]], [[0.5439], [0.6622]]]]]], 4, Con34715), 
LSub23282 = subtract_layer([[[[[0.1567, 0.8377], [0.8078, 0.0001]], [[0.9841, 0.9473], [0.5665, 0.2077]]], [[[0.1671, 0.5014], [0.9052, 0.6499]], [[0.401, 0.4861], [0.0418, 0.4759]]], [[[0.3521, 0.8898], [0.6369, 0.791]], [[0.2999, 0.6577], [0.5041, 0.9109]]]]], [[[[[0.3653, 0.9556], [0.2026, 0.9992]], [[0.6426, 0.0222], [0.5471, 0.9321]]], [[[0.8363, 0.4342], [0.683, 0.2328]], [[0.2005, 0.3078], [0.3946, 0.5703]]], [[[0.6724, 0.8178], [0.7439, 0.6287]], [[0.1006, 0.4263], [0.9673, 0.116]]]]], Sub23282), 
LMin75732 = minimum_layer([Con34715,Sub23282], Min75732), 
LRes75910 = reshape_layer(Min75732, [3, 2, 4], Res75910), 
LDot92475 = dot_layer([[0.3774, 0.3852]], [[0.7982, 0.3061]], 1, 1, Dot92475), 
LRes23185 = reshape_layer(Dot92475, [1, 1], Res23185), 
LRes73816 = reshape_layer(Res23185, [1, 1, 1], Res73816), 
LCon77298 = conv2D_transpose_layer(Res73816, 1, 1,[[[[0.6565], [0.5559]]]],[0, 0], 1, 1, false, Con77298), 
LZer17328 = zero_padding2D_layer(Con77298, 2, 0, 1, 0, Zer17328), 
LCon71535 = concatenate_layer([Zer17328,[[[[0.3993, 0.0297], [0.335, 0.4425]], [[0.9787, 0.9718], [0.1747, 0.4715]], [[0.4858, 0.9873], [0.0346, 0.0471]]]]], 3, Con71535), 
LAdd66109 = add_layer([Res75910,Con71535], Add66109), 
exec_layers([LMax92576,LRes52081,LZer69732,LCon34715,LSub23282,LMin75732,LRes75910,LDot92475,LRes23185,LRes73816,LCon77298,LZer17328,LCon71535,LAdd66109],["Max92576","Res52081","Zer69732","Con34715","Sub23282","Min75732","Res75910","Dot92475","Res23185","Res73816","Con77298","Zer17328","Con71535","Add66109"],Add66109,"Add66109")

Actual (Unparsed): [[[[-0.2086000, -0.1179000, 0.3993000, -0.9694000], [0.0000000, 0.0600000, 0.3350000, -0.2819000]], [[-0.6692000, 0.0672000, 0.9787000, 1.1204000], [0.0000000, 0.1783000, -0.1781000, 0.3771000]], [[-0.3203000, 0.0720000, 0.3788000, 1.1496000], [0.4744722, 0.4644057, -0.4286000, 0.7093000]]]]

Expected (Unparsed): [[[[-0.2086,-0.1179,0.3993,-0.9694],[0,0.06,0.335,-0.28190000000000004]],[[-0.6692,0.06719999999999998,0.9787,1.1204],[0,0.17829999999999996,-0.1781,0.37709999999999994]],[[-0.3203,0.07200000000000006,0.3788,1.1496],[0.4744722376,0.46440570736,-0.42860000000000004,0.7093]]]]

Actual:   [[[[-0.2086, -0.1179, 0.3993, -0.9694], [0, 0.06, 0.335, -0.2819]], [[-0.6692, 0.0672, 0.9787, 1.1204], [0, 0.1783, -0.1781, 0.3771]], [[-0.3203, 0.072, 0.3788, 1.1496], [0.4745, 0.4645, -0.4286, 0.7093]]]]

Expected: [[[[-0.2086, -0.1179, 0.3993, -0.9694], [0, 0.06, 0.335, -0.2819]], [[-0.6692, 0.0672, 0.9787, 1.1204], [0, 0.1783, -0.1781, 0.3771]], [[-0.3203, 0.0721, 0.3788, 1.1496], [0.4745, 0.4645, -0.4286, 0.7093]]]]