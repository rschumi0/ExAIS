import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub92216 = tf.keras.layers.Input(shape=([3, 2, 2, 2]))
in1Sub92216 = tf.keras.layers.Input(shape=([3, 2, 2, 2]))
in0Per24430 = tf.keras.layers.Input(shape=([3, 2]))
in0Con5637 = tf.keras.layers.Input(shape=([3, 6]))

Sub92216 = keras.layers.Subtract(name = 'Sub92216', )([in0Sub92216,in1Sub92216])
Res7781 = keras.layers.Reshape((3, 2, 4), name = 'Res7781', )(Sub92216)
Res76085 = keras.layers.Reshape((3, 8), name = 'Res76085', )(Res7781)
Per24430 = keras.layers.Permute((1,2), name = 'Per24430',)(in0Per24430)
Con5637 = keras.layers.Concatenate(axis=2, name = 'Con5637', )([Per24430,in0Con5637])
Min17414 = keras.layers.Minimum(name = 'Min17414', )([Res76085,Con5637])
Con67823 = keras.layers.Conv1D(3, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con67823', )(Min17414)
model = tf.keras.models.Model(inputs=[in0Sub92216,in1Sub92216,in0Per24430,in0Con5637], outputs=Con67823)
w = model.get_layer('Con67823').get_weights() 
w[0] = np.array([[[0.4723, 0.2443, 0.7627], [0.8106, 0.834, 0.9188], [0.1207, 0.745, 0.1414], [0.5789, 0.4634, 0.4798], [0.6148, 0.1332, 0.8152], [0.0111, 0.3253, 0.4925], [0.0833, 0.0152, 0.9584], [0.9108, 0.2043, 0.1225]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con67823').set_weights(w) 
in0Sub92216 = tf.constant([[[[[0.2077, 0.6868], [0.329, 0.3453]], [[0.5985, 0.1837], [0.6791, 0.6339]]], [[[0.4602, 0.3362], [0.1547, 0.0287]], [[0.3557, 0.519], [0.1487, 0.1112]]], [[[0.4881, 0.0095], [0.1688, 0.632]], [[0.5103, 0.7822], [0.3814, 0.5899]]]]])
in1Sub92216 = tf.constant([[[[[0.1311, 0.6463], [0.9256, 0.9566]], [[0.6691, 0.1068], [0.2156, 0.2902]]], [[[0.7155, 0.7476], [0.3436, 0.4183]], [[0.1095, 0.6461], [0.1315, 0.091]]], [[[0.4979, 0.3066], [0.3386, 0.0065]], [[0.8538, 0.873], [0.0255, 0.8914]]]]])
in0Per24430 = tf.constant([[[1.4658, 1.9246], [1.101, 1.3846], [1.0697, 1.9896]]])
in0Con5637 = tf.constant([[[0.5204, 0.5991, 0.0024, 0.4016, 0.435, 0.1501], [0.0811, 0.1069, 0.5261, 0.051, 0.8207, 0.2299], [0.923, 0.6928, 0.9438, 0.2097, 0.3407, 0.4782]]])
print (np.array2string(model.predict([in0Sub92216,in1Sub92216,in0Per24430,in0Con5637],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con67823.png')

LSub92216 = subtract_layer([[[[[0.2077, 0.6868], [0.329, 0.3453]], [[0.5985, 0.1837], [0.6791, 0.6339]]], [[[0.4602, 0.3362], [0.1547, 0.0287]], [[0.3557, 0.519], [0.1487, 0.1112]]], [[[0.4881, 0.0095], [0.1688, 0.632]], [[0.5103, 0.7822], [0.3814, 0.5899]]]]], [[[[[0.1311, 0.6463], [0.9256, 0.9566]], [[0.6691, 0.1068], [0.2156, 0.2902]]], [[[0.7155, 0.7476], [0.3436, 0.4183]], [[0.1095, 0.6461], [0.1315, 0.091]]], [[[0.4979, 0.3066], [0.3386, 0.0065]], [[0.8538, 0.873], [0.0255, 0.8914]]]]], Sub92216), 
LRes7781 = reshape_layer(Sub92216, [3, 2, 4], Res7781), 
LRes76085 = reshape_layer(Res7781, [3, 8], Res76085), 
LPer24430 = permute_layer([[[1.4658, 1.9246], [1.101, 1.3846], [1.0697, 1.9896]]], 1,2, Per24430), 
LCon5637 = concatenate_layer([Per24430,[[[0.5204, 0.5991, 0.0024, 0.4016, 0.435, 0.1501], [0.0811, 0.1069, 0.5261, 0.051, 0.8207, 0.2299], [0.923, 0.6928, 0.9438, 0.2097, 0.3407, 0.4782]]]], 2, Con5637), 
LMin17414 = minimum_layer([Res76085,Con5637], Min17414), 
LCon67823 = conv1D_layer(Min17414, 1,[[[0.4723, 0.2443, 0.7627], [0.8106, 0.834, 0.9188], [0.1207, 0.745, 0.1414], [0.5789, 0.4634, 0.4798], [0.6148, 0.1332, 0.8152], [0.0111, 0.3253, 0.4925], [0.0833, 0.0152, 0.9584], [0.9108, 0.2043, 0.1225]]],[0, 0, 0], 1, true, 1, Con67823), 
exec_layers([LSub92216,LRes7781,LRes76085,LPer24430,LCon5637,LMin17414,LCon67823],["Sub92216","Res7781","Res76085","Per24430","Con5637","Min17414","Con67823"],Con67823,"Con67823")

Actual (Unparsed): [[[-0.2264884, -0.6223640, 0.1335846], [-0.5326149, -0.7309120, -0.6292877], [-0.3622683, -0.2185291, -0.0394919]]]

Expected (Unparsed): [[[-0.22648842,-0.62236396,0.13358462000000002],[-0.53261483,-0.7309120200000002,-0.6292876999999999],[-0.36226828000000005,-0.21852908999999993,-0.039491829999999964]]]

Actual:   [[[-0.2264, -0.6223, 0.1336], [-0.5326, -0.7309, -0.6292], [-0.3622, -0.2185, -0.0394]]]

Expected: [[[-0.2264, -0.6223, 0.1336], [-0.5326, -0.7309, -0.6292], [-0.3622, -0.2185, -0.0394]]]