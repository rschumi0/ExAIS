import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add97795 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Add97795 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Con85726 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Sep95633 = tf.keras.layers.Input(shape=([1, 2, 2]))

Add97795 = keras.layers.Add(name = 'Add97795', )([in0Add97795,in1Add97795])
Res96974 = keras.layers.Reshape((2, 2, 2), name = 'Res96974', )(Add97795)
Con85726 = keras.layers.Concatenate(axis=3, name = 'Con85726', )([Res96974,in0Con85726])
Sep95633 = keras.layers.SeparableConv2D(4, (1, 1),strides=(1, 1), padding='same', name = 'Sep95633', )(in0Sep95633)
Zer69645 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer69645', )(Sep95633)
Max21940 = keras.layers.Maximum(name = 'Max21940', )([Con85726,Zer69645])
Res8353 = keras.layers.Reshape((2, 8), name = 'Res8353', )(Max21940)
GRU75254 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU75254', )(Res8353)
model = tf.keras.models.Model(inputs=[in0Add97795,in1Add97795,in0Con85726,in0Sep95633], outputs=GRU75254)
w = model.get_layer('Sep95633').get_weights() 
w[0] = np.array([[[[0.8683], [0.9993]]]])
w[1] = np.array([[[[0.1453, 0.1036, 0.2414, 0.0238], [0.7295, 0.1642, 0.4646, 0.7497]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep95633').set_weights(w) 
w = model.get_layer('GRU75254').get_weights() 
w[0] = np.array([[6, 9, 3, 2, 4, 6], [3, 4, 4, 1, 4, 1], [6, 1, 8, 8, 1, 7], [3, 2, 4, 10, 4, 6], [9, 9, 6, 4, 1, 8], [10, 5, 10, 5, 3, 2], [10, 5, 1, 4, 4, 7], [7, 4, 7, 6, 5, 6]])
w[1] = np.array([[4, 8, 7, 9, 8, 6], [2, 7, 7, 8, 7, 4]])
w[2] = np.array([[3, 4, 5, 1, 4, 10], [8, 10, 4, 9, 8, 4]])
model.get_layer('GRU75254').set_weights(w) 
in0Add97795 = tf.constant([[[[[0.9387, 0.2728]], [[0.7404, 0.0335]]], [[[0.7407, 0.1971]], [[0.3272, 0.5661]]]]])
in1Add97795 = tf.constant([[[[[0.8062, 0.5389]], [[0.0971, 0.1201]]], [[[0.5567, 0.418]], [[0.5239, 0.7403]]]]])
in0Con85726 = tf.constant([[[[0.8841, 0.762], [0.6113, 0.8138]], [[0.6305, 0.7829], [0.8375, 0.5779]]]])
in0Sep95633 = tf.constant([[[[0.8513, 0.0201], [0.0149, 0.3388]]]])
print (np.array2string(model.predict([in0Add97795,in1Add97795,in0Con85726,in0Sep95633],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU75254.png')

LAdd97795 = add_layer([[[[[[0.9387, 0.2728]], [[0.7404, 0.0335]]], [[[0.7407, 0.1971]], [[0.3272, 0.5661]]]]], [[[[[0.8062, 0.5389]], [[0.0971, 0.1201]]], [[[0.5567, 0.418]], [[0.5239, 0.7403]]]]]], Add97795), 
LRes96974 = reshape_layer(Add97795, [2, 2, 2], Res96974), 
LCon85726 = concatenate_layer([Res96974,[[[[0.8841, 0.762], [0.6113, 0.8138]], [[0.6305, 0.7829], [0.8375, 0.5779]]]]], 3, Con85726), 
LSep95633 = separable_conv2D_layer([[[[0.8513, 0.0201], [0.0149, 0.3388]]]], 1, 1,[[[[[0.8683], [0.9993]]]],[[[[0.1453, 0.1036, 0.2414, 0.0238], [0.7295, 0.1642, 0.4646, 0.7497]]]]],[0, 0, 0, 0], 1, 1, true, Sep95633), 
LZer69645 = zero_padding2D_layer(Sep95633, 1, 0, 0, 0, Zer69645), 
LMax21940 = maximum_layer([Con85726,Zer69645], Max21940), 
LRes8353 = reshape_layer(Max21940, [2, 8], Res8353), 
LGRU75254 = gru_layer(Res8353,[[6, 9, 3, 2, 4, 6], [3, 4, 4, 1, 4, 1], [6, 1, 8, 8, 1, 7], [3, 2, 4, 10, 4, 6], [9, 9, 6, 4, 1, 8], [10, 5, 10, 5, 3, 2], [10, 5, 1, 4, 4, 7], [7, 4, 7, 6, 5, 6]],[[4, 8, 7, 9, 8, 6], [2, 7, 7, 8, 7, 4]],[[3, 4, 5, 1, 4, 10], [8, 10, 4, 9, 8, 4]], true, GRU75254), 
exec_layers([LAdd97795,LRes96974,LCon85726,LSep95633,LZer69645,LMax21940,LRes8353,LGRU75254],["Add97795","Res96974","Con85726","Sep95633","Zer69645","Max21940","Res8353","GRU75254"],GRU75254,"GRU75254")

Actual (Unparsed): [[0.0000000, 0.0000000]]

Expected (Unparsed): [[0.0,0.0]]

Actual:   [[0, 0]]

Expected: [[0, 0]]