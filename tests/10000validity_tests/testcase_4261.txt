import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add20939 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Add20939 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Ave26549 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave26549 = tf.keras.layers.Input(shape=([1, 2]))
in0Con24474 = tf.keras.layers.Input(shape=([15]))

Add20939 = keras.layers.Add(name = 'Add20939', )([in0Add20939,in1Add20939])
Lay27353 = keras.layers.LayerNormalization(axis=2, epsilon=2.440707194861889, name = 'Lay27353', )(Add20939)
Res91893 = keras.layers.Reshape((2, 2, 4), name = 'Res91893', )(Lay27353)
Res1687 = keras.layers.Reshape((2, 8), name = 'Res1687', )(Res91893)
Fla87890 = keras.layers.Flatten(name = 'Fla87890', )(Res1687)
Ave26549 = keras.layers.Average(name = 'Ave26549', )([in0Ave26549,in1Ave26549])
Res8334 = keras.layers.Reshape((1, 2, 1), name = 'Res8334', )(Ave26549)
Res9589 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res9589', )(Res8334)
Glo73943 = keras.layers.GlobalAveragePooling3D(name = 'Glo73943', )(Res9589)
Con24474 = keras.layers.Concatenate(axis=1, name = 'Con24474', )([Glo73943,in0Con24474])
Ave94120 = keras.layers.Average(name = 'Ave94120', )([Fla87890,Con24474])
model = tf.keras.models.Model(inputs=[in0Add20939,in1Add20939,in0Ave26549,in1Ave26549,in0Con24474], outputs=Ave94120)
in0Add20939 = tf.constant([[[[[0.4537, 0.5971], [0.8228, 0.8035]], [[0.0151, 0.1927], [0.6763, 0.0053]]], [[[0.3881, 0.4083], [0.8452, 0.194]], [[0.939, 0.6096], [0.6786, 0.8686]]]]])
in1Add20939 = tf.constant([[[[[0.4753, 0.3903], [0.3462, 0.8835]], [[0.6307, 0.4617], [0.97, 0.1948]]], [[[0.5448, 0.9525], [0.9373, 0.3744]], [[0.8289, 0.0548], [0.0327, 0.0098]]]]])
in0Ave26549 = tf.constant([[[0.8323, 0.6049]]])
in1Ave26549 = tf.constant([[[0.1287, 0.9611]]])
in0Con24474 = tf.constant([[0.9365, 0.6508, 0.405, 0.7541, 0.3022, 0.4453, 0.8359, 0.9333, 0.1542, 0.5685, 0.2974, 0.0116, 0.4469, 0.958, 0.4102]])
print (np.array2string(model.predict([in0Add20939,in1Add20939,in0Ave26549,in1Ave26549,in0Con24474],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave94120.png')

LAdd20939 = add_layer([[[[[[0.4537, 0.5971], [0.8228, 0.8035]], [[0.0151, 0.1927], [0.6763, 0.0053]]], [[[0.3881, 0.4083], [0.8452, 0.194]], [[0.939, 0.6096], [0.6786, 0.8686]]]]], [[[[[0.4753, 0.3903], [0.3462, 0.8835]], [[0.6307, 0.4617], [0.97, 0.1948]]], [[[0.5448, 0.9525], [0.9373, 0.3744]], [[0.8289, 0.0548], [0.0327, 0.0098]]]]]], Add20939), 
LLay27353 = layer_normalization_layer(Add20939, 2, 2.440707194861889, Lay27353), 
LRes91893 = reshape_layer(Lay27353, [2, 2, 4], Res91893), 
LRes1687 = reshape_layer(Res91893, [2, 8], Res1687), 
LFla87890 = flatten_layer(Res1687, Fla87890), 
LAve26549 = average_layer([[[[0.8323, 0.6049]]], [[[0.1287, 0.9611]]]], Ave26549), 
LRes8334 = reshape_layer(Ave26549, [1, 2, 1], Res8334), 
LRes9589 = reshape_layer(Res8334, [1, 2, 1, 1], Res9589), 
LGlo73943 = global_average_pooling3D_layer(Res9589, Glo73943), 
LCon24474 = concatenate_layer([Glo73943,[[0.9365, 0.6508, 0.405, 0.7541, 0.3022, 0.4453, 0.8359, 0.9333, 0.1542, 0.5685, 0.2974, 0.0116, 0.4469, 0.958, 0.4102]]], 1, Con24474), 
LAve94120 = average_layer([Fla87890,Con24474], Ave94120), 
exec_layers([LAdd20939,LLay27353,LRes91893,LRes1687,LFla87890,LAve26549,LRes8334,LRes9589,LGlo73943,LCon24474,LAve94120],["Add20939","Lay27353","Res91893","Res1687","Fla87890","Ave26549","Res8334","Res9589","Glo73943","Con24474","Ave94120"],Ave94120,"Ave94120")

Actual (Unparsed): [[0.3610085, 0.5212376, 0.2498969, 0.4173511, 0.3319165, 0.0981124, 0.2981531, 0.2030989, 0.3375609, 0.1858711, 0.4464020, 0.0993353, 0.1348891, 0.1146789, 0.3168480, 0.2544647]]

Expected (Unparsed): [[0.3610084805773482,0.5212375553255001,0.249896915294059,0.4173510954600127,0.3319165194226518,0.0981124446744999,0.29815308470594104,0.20309890453998733,0.33756091540734995,0.1858710721684236,0.44640198052445085,0.09933526232349957,0.13488908459265003,0.11467892783157643,0.3168480194755492,0.25446473767650046]]

Actual:   [[0.3611, 0.5213, 0.2499, 0.4174, 0.332, 0.0982, 0.2982, 0.2031, 0.3376, 0.1859, 0.4465, 0.0994, 0.1349, 0.1147, 0.3169, 0.2545]]

Expected: [[0.3611, 0.5213, 0.2499, 0.4174, 0.332, 0.0982, 0.2982, 0.2031, 0.3376, 0.1859, 0.4465, 0.0994, 0.1349, 0.1147, 0.3169, 0.2545]]