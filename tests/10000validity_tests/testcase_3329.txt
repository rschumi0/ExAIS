import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub12326 = tf.keras.layers.Input(shape=([2]))
in1Sub12326 = tf.keras.layers.Input(shape=([2]))
in0Glo98192 = tf.keras.layers.Input(shape=([1, 1]))

Sub12326 = keras.layers.Subtract(name = 'Sub12326', )([in0Sub12326,in1Sub12326])
Bat42431 = keras.layers.BatchNormalization(axis=1, epsilon=0.974715569657568,  name = 'Bat42431', )(Sub12326)
Res31740 = keras.layers.Reshape((2, 1), name = 'Res31740', )(Bat42431)
Glo49045 = keras.layers.GlobalMaxPool1D(name = 'Glo49045', )(Res31740)
Glo98192 = keras.layers.GlobalMaxPool1D(name = 'Glo98192', )(in0Glo98192)
Res57776 = keras.layers.Reshape((1, 1), name = 'Res57776', )(Glo98192)
Res35975 = keras.layers.Reshape((1, 1, 1), name = 'Res35975', )(Res57776)
Glo31235 = keras.layers.GlobalMaxPool2D(name = 'Glo31235', )(Res35975)
Max25903 = keras.layers.Maximum(name = 'Max25903', )([Glo49045,Glo31235])
model = tf.keras.models.Model(inputs=[in0Sub12326,in1Sub12326,in0Glo98192], outputs=Max25903)
w = model.get_layer('Bat42431').get_weights() 
w[0] = np.array([0.1026, 0.4096])
w[1] = np.array([0.5476, 0.6692])
w[2] = np.array([0.4282, 0.5435])
w[3] = np.array([0.7961, 0.7555])
model.get_layer('Bat42431').set_weights(w) 
in0Sub12326 = tf.constant([[0.9745, 0.616]])
in1Sub12326 = tf.constant([[0.6931, 0.6586]])
in0Glo98192 = tf.constant([[[1.0689]]])
print (np.array2string(model.predict([in0Sub12326,in1Sub12326,in0Glo98192],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max25903.png')

LSub12326 = subtract_layer([[0.9745, 0.616]], [[0.6931, 0.6586]], Sub12326), 
LBat42431 = batch_normalization_layer(Sub12326, 1, 0.974715569657568, [0.1026, 0.4096], [0.5476, 0.6692], [0.4282, 0.5435], [0.7961, 0.7555], Bat42431), 
LRes31740 = reshape_layer(Bat42431, [2, 1], Res31740), 
LGlo49045 = global_max_pool1D_layer(Res31740, Glo49045), 
LGlo98192 = global_max_pool1D_layer([[[1.0689]]], Glo98192), 
LRes57776 = reshape_layer(Glo98192, [1, 1], Res57776), 
LRes35975 = reshape_layer(Res57776, [1, 1, 1], Res35975), 
LGlo31235 = global_max_pool2D_layer(Res35975, Glo31235), 
LMax25903 = maximum_layer([Glo49045,Glo31235], Max25903), 
exec_layers([LSub12326,LBat42431,LRes31740,LGlo49045,LGlo98192,LRes57776,LRes35975,LGlo31235,LMax25903],["Sub12326","Bat42431","Res31740","Glo49045","Glo98192","Res57776","Res35975","Glo31235","Max25903"],Max25903,"Max25903")

Actual (Unparsed): [[1.0689000]]

Expected (Unparsed): [[1.0689]]

Actual:   [[1.0689]]

Expected: [[1.0689]]