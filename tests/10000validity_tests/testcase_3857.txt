import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave13515 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Ave13515 = tf.keras.layers.Input(shape=([1, 2, 2]))

Ave13515 = keras.layers.Average(name = 'Ave13515', )([in0Ave13515,in1Ave13515])
Res37420 = keras.layers.Reshape((1, 4), name = 'Res37420', )(Ave13515)
GRU64115 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU64115', )(Res37420)
Res22585 = keras.layers.Reshape((2, 1), name = 'Res22585', )(GRU64115)
Res40677 = keras.layers.Reshape((2, 1, 1), name = 'Res40677', )(Res22585)
Res53046 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res53046', )(Res40677)
Zer24222 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer24222', )(Res53046)
model = tf.keras.models.Model(inputs=[in0Ave13515,in1Ave13515], outputs=Zer24222)
w = model.get_layer('GRU64115').get_weights() 
w[0] = np.array([[5, 10, 2, 7, 2, 2], [8, 6, 5, 2, 1, 3], [3, 3, 2, 5, 4, 4], [3, 10, 7, 6, 10, 1]])
w[1] = np.array([[10, 8, 1, 10, 10, 9], [2, 6, 6, 10, 10, 10]])
w[2] = np.array([2, 3, 8, 3, 1, 3])
model.get_layer('GRU64115').set_weights(w) 
in0Ave13515 = tf.constant([[[[0.4207, 0.5752], [0.2015, 0.2066]]]])
in1Ave13515 = tf.constant([[[[0.9648, 0.0043], [0.6815, 0.9615]]]])
print (np.array2string(model.predict([in0Ave13515,in1Ave13515],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Zer24222.png')

LAve13515 = average_layer([[[[[0.4207, 0.5752], [0.2015, 0.2066]]]], [[[[0.9648, 0.0043], [0.6815, 0.9615]]]]], Ave13515), 
LRes37420 = reshape_layer(Ave13515, [1, 4], Res37420), 
LGRU64115 = gru_layer(Res37420,[[5, 10, 2, 7, 2, 2], [8, 6, 5, 2, 1, 3], [3, 3, 2, 5, 4, 4], [3, 10, 7, 6, 10, 1]],[[10, 8, 1, 10, 10, 9], [2, 6, 6, 10, 10, 10]],[2, 3, 8, 3, 1, 3], false, GRU64115), 
LRes22585 = reshape_layer(GRU64115, [2, 1], Res22585), 
LRes40677 = reshape_layer(Res22585, [2, 1, 1], Res40677), 
LRes53046 = reshape_layer(Res40677, [2, 1, 1, 1], Res53046), 
LZer24222 = zero_padding3D_layer(Res53046, 1, 1, 1, 1, 1, 1, Zer24222), 
exec_layers([LAve13515,LRes37420,LGRU64115,LRes22585,LRes40677,LRes53046,LZer24222],["Ave13515","Res37420","GRU64115","Res22585","Res40677","Res53046","Zer24222"],Zer24222,"Zer24222")

Actual (Unparsed): [[[[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000192], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]]]]

Expected (Unparsed): [[[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]]],[[[0],[0],[0]],[[0],[1.924192156158791e-5],[0]],[[0],[0],[0]]],[[[0],[0],[0]],[[0],[6.63438086172509e-9],[0]],[[0],[0],[0]]],[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]]]]]

Actual:   [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0.0001], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]]]]

Expected: [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0.0001], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]]]]