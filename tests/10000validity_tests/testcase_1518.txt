import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave31993 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Ave31993 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Sub99478 = tf.keras.layers.Input(shape=([3]))
in1Sub99478 = tf.keras.layers.Input(shape=([3]))
in0Con36151 = tf.keras.layers.Input(shape=([1]))

Ave31993 = keras.layers.Average(name = 'Ave31993', )([in0Ave31993,in1Ave31993])
Res70931 = keras.layers.Reshape((2, 2), name = 'Res70931', )(Ave31993)
Fla7199 = keras.layers.Flatten(name = 'Fla7199', )(Res70931)
Sub99478 = keras.layers.Subtract(name = 'Sub99478', )([in0Sub99478,in1Sub99478])
Con36151 = keras.layers.Concatenate(axis=1, name = 'Con36151', )([Sub99478,in0Con36151])
Sub16768 = keras.layers.Subtract(name = 'Sub16768', )([Fla7199,Con36151])
Res9075 = keras.layers.Reshape((4, 1), name = 'Res9075', )(Sub16768)
GRU85265 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU85265', )(Res9075)
model = tf.keras.models.Model(inputs=[in0Ave31993,in1Ave31993,in0Sub99478,in1Sub99478,in0Con36151], outputs=GRU85265)
w = model.get_layer('GRU85265').get_weights() 
w[0] = np.array([[5, 4, 6, 4, 3, 2]])
w[1] = np.array([[1, 7, 10, 8, 2, 9], [9, 1, 2, 5, 1, 10]])
w[2] = np.array([[7, 8, 4, 8, 9, 5], [9, 1, 6, 6, 3, 5]])
model.get_layer('GRU85265').set_weights(w) 
in0Ave31993 = tf.constant([[[[0.0931, 0.2795]], [[0.4274, 0.4154]]]])
in1Ave31993 = tf.constant([[[[0.1274, 0.457]], [[0.716, 0.398]]]])
in0Sub99478 = tf.constant([[0.582, 0.0841, 0.4871]])
in1Sub99478 = tf.constant([[0.4527, 0.6066, 0.2316]])
in0Con36151 = tf.constant([[0.1209]])
print (np.array2string(model.predict([in0Ave31993,in1Ave31993,in0Sub99478,in1Sub99478,in0Con36151],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU85265.png')

LAve31993 = average_layer([[[[[0.0931, 0.2795]], [[0.4274, 0.4154]]]], [[[[0.1274, 0.457]], [[0.716, 0.398]]]]], Ave31993), 
LRes70931 = reshape_layer(Ave31993, [2, 2], Res70931), 
LFla7199 = flatten_layer(Res70931, Fla7199), 
LSub99478 = subtract_layer([[0.582, 0.0841, 0.4871]], [[0.4527, 0.6066, 0.2316]], Sub99478), 
LCon36151 = concatenate_layer([Sub99478,[[0.1209]]], 1, Con36151), 
LSub16768 = subtract_layer(Fla7199,Con36151, Sub16768), 
LRes9075 = reshape_layer(Sub16768, [4, 1], Res9075), 
LGRU85265 = gru_layer(Res9075,[[5, 4, 6, 4, 3, 2]],[[1, 7, 10, 8, 2, 9], [9, 1, 2, 5, 1, 10]],[[7, 8, 4, 8, 9, 5], [9, 1, 6, 6, 3, 5]], true, GRU85265), 
exec_layers([LAve31993,LRes70931,LFla7199,LSub99478,LCon36151,LSub16768,LRes9075,LGRU85265],["Ave31993","Res70931","Fla7199","Sub99478","Con36151","Sub16768","Res9075","GRU85265"],GRU85265,"GRU85265")

Actual (Unparsed): [[0.0000002, 0.0002108]]

Expected (Unparsed): [[1.7513282740137902e-7,0.00021081655072788434]]

Actual:   [[0, 0.0003]]

Expected: [[0, 0.0003]]