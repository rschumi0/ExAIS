import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con27348 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Sub54986 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub54986 = tf.keras.layers.Input(shape=([3, 2]))
in0Con9016 = tf.keras.layers.Input(shape=([3, 2]))

Con27348 = keras.layers.Conv3D(4, (2, 2, 2),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con27348', )(in0Con27348)
Res95566 = keras.layers.Reshape((1, 1, 4), name = 'Res95566', )(Con27348)
Res28557 = keras.layers.Reshape((1, 4), name = 'Res28557', )(Res95566)
Zer44042 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer44042', )(Res28557)
Sub54986 = keras.layers.Subtract(name = 'Sub54986', )([in0Sub54986,in1Sub54986])
Lay18975 = keras.layers.LayerNormalization(axis=1, epsilon=1.4149107829361036, name = 'Lay18975', )(Sub54986)
Den81390 = keras.layers.Dense(2,name = 'Den81390', )(Lay18975)
Con9016 = keras.layers.Concatenate(axis=2, name = 'Con9016', )([Den81390,in0Con9016])
Ave7207 = keras.layers.Average(name = 'Ave7207', )([Zer44042,Con9016])
Res38447 = keras.layers.Reshape((3, 4, 1), name = 'Res38447', )(Ave7207)
Res9518 = keras.layers.Reshape((3, 4, 1, 1), name = 'Res9518', )(Res38447)
Zer85080 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer85080', )(Res9518)
model = tf.keras.models.Model(inputs=[in0Con27348,in0Sub54986,in1Sub54986,in0Con9016], outputs=Zer85080)
w = model.get_layer('Con27348').get_weights() 
w[0] = np.array([[[[[0.6539, 0.288, 0.3035, 0.907]], [[0.5901, 0.7498, 0.0962, 0.076]]], [[[0.5169, 0.9654, 0.8089, 0.1162]], [[0.3105, 0.4353, 0.4703, 0.6828]]]], [[[[0.2534, 0.2805, 0.7696, 0.91]], [[0.3576, 0.3704, 0.953, 0.122]]], [[[0.5239, 0.1924, 0.1362, 0.4887]], [[0.5575, 0.7544, 0.4672, 0.2831]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con27348').set_weights(w) 
w = model.get_layer('Den81390').get_weights() 
w[0] = np.array([[0.4112, 0.0099], [0.7339, 0.0289]])
w[1] = np.array([0.004, 0.0006])
model.get_layer('Den81390').set_weights(w) 
in0Con27348 = tf.constant([[[[[0.53], [0.0298]], [[0.2005], [0.8567]]], [[[0.3559], [0.156]], [[0.3802], [0.4232]]]]])
in0Sub54986 = tf.constant([[[0.2314, 0.312], [0.8591, 0.9381], [0.2397, 0.0786]]])
in1Sub54986 = tf.constant([[[0.2703, 0.5461], [0.4228, 0.6181], [0.8181, 0.5289]]])
in0Con9016 = tf.constant([[[0.3677, 0.8112], [0.1757, 0.6883], [0.2057, 0.1218]]])
print (np.array2string(model.predict([in0Con27348,in0Sub54986,in1Sub54986,in0Con9016],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Zer85080.png')

LCon27348 = conv3D_layer([[[[[0.53], [0.0298]], [[0.2005], [0.8567]]], [[[0.3559], [0.156]], [[0.3802], [0.4232]]]]], 2, 2, 2,[[[[[0.6539, 0.288, 0.3035, 0.907]], [[0.5901, 0.7498, 0.0962, 0.076]]], [[[0.5169, 0.9654, 0.8089, 0.1162]], [[0.3105, 0.4353, 0.4703, 0.6828]]]], [[[[0.2534, 0.2805, 0.7696, 0.91]], [[0.3576, 0.3704, 0.953, 0.122]]], [[[0.5239, 0.1924, 0.1362, 0.4887]], [[0.5575, 0.7544, 0.4672, 0.2831]]]]],[0, 0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con27348), 
LRes95566 = reshape_layer(Con27348, [1, 1, 4], Res95566), 
LRes28557 = reshape_layer(Res95566, [1, 4], Res28557), 
LZer44042 = zero_padding1D_layer(Res28557, 2, 0, Zer44042), 
LSub54986 = subtract_layer([[[0.2314, 0.312], [0.8591, 0.9381], [0.2397, 0.0786]]], [[[0.2703, 0.5461], [0.4228, 0.6181], [0.8181, 0.5289]]], Sub54986), 
LLay18975 = layer_normalization_layer(Sub54986, 1, 1.4149107829361036, Lay18975), 
LDen81390 = dense_layer(Lay18975, [[0.4112, 0.0099], [0.7339, 0.0289]],[0.004, 0.0006], Den81390), 
LCon9016 = concatenate_layer([Den81390,[[[0.3677, 0.8112], [0.1757, 0.6883], [0.2057, 0.1218]]]], 2, Con9016), 
LAve7207 = average_layer([Zer44042,Con9016], Ave7207), 
LRes38447 = reshape_layer(Ave7207, [3, 4, 1], Res38447), 
LRes9518 = reshape_layer(Res38447, [3, 4, 1, 1], Res9518), 
LZer85080 = zero_padding3D_layer(Res9518, 1, 1, 1, 1, 1, 1, Zer85080), 
exec_layers([LCon27348,LRes95566,LRes28557,LZer44042,LSub54986,LLay18975,LDen81390,LCon9016,LAve7207,LRes38447,LRes9518,LZer85080],["Con27348","Res95566","Res28557","Zer44042","Sub54986","Lay18975","Den81390","Con9016","Ave7207","Res38447","Res9518","Zer85080"],Zer85080,"Zer85080")

Actual (Unparsed): [[[[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [-0.0280238], [0.0000000]], [[0.0000000], [-0.0009358], [0.0000000]], [[0.0000000], [0.1838500], [0.0000000]], [[0.0000000], [0.4056000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.2144497], [0.0000000]], [[0.0000000], [0.0074255], [0.0000000]], [[0.0000000], [0.0878500], [0.0000000]], [[0.0000000], [0.3441500], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.4770177], [0.0000000]], [[0.0000000], [0.6401569], [0.0000000]], [[0.0000000], [0.8032916], [0.0000000]], [[0.0000000], [0.9307701], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]]]]

Expected (Unparsed): [[[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]]],[[[0],[0],[0]],[[0],[-0.02802375955959047],[0]],[[0],[-0.0009358295192043504],[0]],[[0],[0.18385],[0]],[[0],[0.4056],[0]],[[0],[0],[0]]],[[[0],[0],[0]],[[0],[0.21444970878473366],[0]],[[0],[0.007425544079311067],[0]],[[0],[0.08785],[0]],[[0],[0.34415],[0]],[[0],[0],[0]]],[[[0],[0],[0]],[[0],[0.4770176607748569],[0]],[[0],[0.6401568654398933],[0]],[[0],[0.80329157],[0]],[[0],[0.93077016],[0]],[[0],[0],[0]]],[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]]]]]

Actual:   [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [-0.028], [0]], [[0], [-0.0009], [0]], [[0], [0.1839], [0]], [[0], [0.4056], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0.2145], [0]], [[0], [0.0075], [0]], [[0], [0.0879], [0]], [[0], [0.3442], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0.4771], [0]], [[0], [0.6402], [0]], [[0], [0.8033], [0]], [[0], [0.9308], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]]]]

Expected: [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [-0.028], [0]], [[0], [-0.0009], [0]], [[0], [0.1839], [0]], [[0], [0.4056], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0.2145], [0]], [[0], [0.0075], [0]], [[0], [0.0879], [0]], [[0], [0.3442], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0.4771], [0]], [[0], [0.6402], [0]], [[0], [0.8033], [0]], [[0], [0.9308], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]]]]