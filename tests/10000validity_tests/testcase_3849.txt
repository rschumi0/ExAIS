import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max98116 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Max98116 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Max55729 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Min16088 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Min16088 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))

Max98116 = keras.layers.Maximum(name = 'Max98116', )([in0Max98116,in1Max98116])
Res7051 = keras.layers.Reshape((2, 1, 1), name = 'Res7051', )(Max98116)
Zer99786 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer99786', )(Res7051)
Max55729 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(9, 2), padding='same', name = 'Max55729', )(in0Max55729)
Zer30632 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer30632', )(Max55729)
Sub17306 = keras.layers.Subtract(name = 'Sub17306', )([Zer99786,Zer30632])
Sof70239 = keras.layers.Softmax(axis=1, name = 'Sof70239', )(Sub17306)
Res65462 = keras.layers.Reshape((3, 3, 1, 1), name = 'Res65462', )(Sof70239)
Min16088 = keras.layers.Minimum(name = 'Min16088', )([in0Min16088,in1Min16088])
Zer98011 = keras.layers.ZeroPadding3D(padding=((2, 0), (2, 0), (0, 0)), name = 'Zer98011', )(Min16088)
Add51616 = keras.layers.Add(name = 'Add51616', )([Res65462,Zer98011])
model = tf.keras.models.Model(inputs=[in0Max98116,in1Max98116,in0Max55729,in0Min16088,in1Min16088], outputs=Add51616)
in0Max98116 = tf.constant([[[[[0.3501]]], [[[0.1097]]]]])
in1Max98116 = tf.constant([[[[[0.6796]]], [[[0.5665]]]]])
in0Max55729 = tf.constant([[[[1.4578], [1.367]]]])
in0Min16088 = tf.constant([[[[[0.4569]]]]])
in1Min16088 = tf.constant([[[[[0.5304]]]]])
print (np.array2string(model.predict([in0Max98116,in1Max98116,in0Max55729,in0Min16088,in1Min16088],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add51616.png')

LMax98116 = maximum_layer([[[[[[0.3501]]], [[[0.1097]]]]], [[[[[0.6796]]], [[[0.5665]]]]]], Max98116), 
LRes7051 = reshape_layer(Max98116, [2, 1, 1], Res7051), 
LZer99786 = zero_padding2D_layer(Res7051, 1, 0, 2, 0, Zer99786), 
LMax55729 = max_pool2D_layer([[[[1.4578], [1.367]]]], 1, 1, 9, 2, true, Max55729), 
LZer30632 = zero_padding2D_layer(Max55729, 1, 1, 1, 1, Zer30632), 
LSub17306 = subtract_layer(Zer99786,Zer30632, Sub17306), 
LSof70239 = softmax_layer(Sub17306, 1, Sof70239), 
LRes65462 = reshape_layer(Sof70239, [3, 3, 1, 1], Res65462), 
LMin16088 = minimum_layer([[[[[[0.4569]]]]], [[[[[0.5304]]]]]], Min16088), 
LZer98011 = zero_padding3D_layer(Min16088, 2, 0, 2, 0, 0, 0, Zer98011), 
LAdd51616 = add_layer([Res65462,Zer98011], Add51616), 
exec_layers([LMax98116,LRes7051,LZer99786,LMax55729,LZer30632,LSub17306,LSof70239,LRes65462,LMin16088,LZer98011,LAdd51616],["Max98116","Res7051","Zer99786","Max55729","Zer30632","Sub17306","Sof70239","Res65462","Min16088","Zer98011","Add51616"],Add51616,"Add51616")

Actual (Unparsed): [[[[[0.3333333]], [[0.4478786]], [[0.2111853]]], [[[0.3333333]], [[0.1042427]], [[0.4166873]]], [[[0.3333333]], [[0.4478786]], [[0.8290273]]]]]

Expected (Unparsed): [[[[[0.3333333333333333]],[[0.44787862707890674]],[[0.2111853352428566]]],[[[0.3333333333333333]],[[0.10424274584218648]],[[0.41668732234112926]]],[[[0.3333333333333333]],[[0.44787862707890674]],[[0.8290273424160142]]]]]

Actual:   [[[[[0.3334]], [[0.4479]], [[0.2112]]], [[[0.3334]], [[0.1043]], [[0.4167]]], [[[0.3334]], [[0.4479]], [[0.8291]]]]]

Expected: [[[[[0.3334]], [[0.4479]], [[0.2112]]], [[[0.3334]], [[0.1043]], [[0.4167]]], [[[0.3334]], [[0.4479]], [[0.8291]]]]]