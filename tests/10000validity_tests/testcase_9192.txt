import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot74174 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot74174 = tf.keras.layers.Input(shape=([2, 3]))
in0Con32497 = tf.keras.layers.Input(shape=([2, 1]))
in0Loc6000 = tf.keras.layers.Input(shape=([2, 2]))
in0Ave57429 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave57429 = tf.keras.layers.Input(shape=([2, 2]))
in0Con487 = tf.keras.layers.Input(shape=([2]))
in0Mul713 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Mul713 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))

Dot74174 = keras.layers.Dot(axes=(2, 2), name = 'Dot74174', )([in0Dot74174,in1Dot74174])
Con32497 = keras.layers.Concatenate(axis=2, name = 'Con32497', )([Dot74174,in0Con32497])
Loc6000 = keras.layers.LocallyConnected1D(3, (2),strides=(2), name = 'Loc6000', )(in0Loc6000)
Zer5400 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer5400', )(Loc6000)
Sub91475 = keras.layers.Subtract(name = 'Sub91475', )([Con32497,Zer5400])
Fla56331 = keras.layers.Flatten(name = 'Fla56331', )(Sub91475)
Ave57429 = keras.layers.Average(name = 'Ave57429', )([in0Ave57429,in1Ave57429])
Fla70929 = keras.layers.Flatten(name = 'Fla70929', )(Ave57429)
Con487 = keras.layers.Concatenate(axis=1, name = 'Con487', )([Fla70929,in0Con487])
Sub22841 = keras.layers.Subtract(name = 'Sub22841', )([Fla56331,Con487])
Res9561 = keras.layers.Reshape((6, 1), name = 'Res9561', )(Sub22841)
Res75573 = keras.layers.Reshape((6, 1, 1), name = 'Res75573', )(Res9561)
Res64618 = keras.layers.Reshape((6, 1, 1, 1), name = 'Res64618', )(Res75573)
Zer15324 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (2, 0)), name = 'Zer15324', )(Res64618)
Mul713 = keras.layers.Multiply(name = 'Mul713', )([in0Mul713,in1Mul713])
Zer17847 = keras.layers.ZeroPadding3D(padding=((4, 0), (1, 0), (1, 0)), name = 'Zer17847', )(Mul713)
Ave56874 = keras.layers.Average(name = 'Ave56874', )([Zer15324,Zer17847])
model = tf.keras.models.Model(inputs=[in0Dot74174,in1Dot74174,in0Con32497,in0Loc6000,in0Ave57429,in1Ave57429,in0Con487,in0Mul713,in1Mul713], outputs=Ave56874)
w = model.get_layer('Loc6000').get_weights() 
w[0] = np.array([[[0.8344, 0.0985, 0.4447], [0.338, 0.7533, 0.5419], [0.1534, 0.4113, 0.5141], [0.719, 0.4187, 0.7034]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc6000').set_weights(w) 
in0Dot74174 = tf.constant([[[0.124, 0.1533, 0.0899], [0.8055, 0.3792, 0.827]]])
in1Dot74174 = tf.constant([[[0.0606, 0.2072, 0.1382], [0.3325, 0.6652, 0.6283]]])
in0Con32497 = tf.constant([[[0.1589], [0.4136]]])
in0Loc6000 = tf.constant([[[0.7331, 0.5959], [0.4076, 0.1364]]])
in0Ave57429 = tf.constant([[[0.3352, 0.5916], [0.4955, 0.5877]]])
in1Ave57429 = tf.constant([[[0.5858, 0.3671], [0.356, 0.6798]]])
in0Con487 = tf.constant([[0.9328, 0.006]])
in0Mul713 = tf.constant([[[[[0.0558], [0.5971]], [[0.1032], [0.4207]]], [[[0.3568], [0.5912]], [[0.5957], [0.5558]]]]])
in1Mul713 = tf.constant([[[[[0.2395], [0.6049]], [[0.1208], [0.9271]]], [[[0.5513], [0.5052]], [[0.6745], [0.9665]]]]])
print (np.array2string(model.predict([in0Dot74174,in1Dot74174,in0Con32497,in0Loc6000,in0Ave57429,in1Ave57429,in0Con487,in0Mul713,in1Mul713],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave56874.png')

LDot74174 = dot_layer([[[0.124, 0.1533, 0.0899], [0.8055, 0.3792, 0.827]]], [[[0.0606, 0.2072, 0.1382], [0.3325, 0.6652, 0.6283]]], 2, 2, Dot74174), 
LCon32497 = concatenate_layer([Dot74174,[[[0.1589], [0.4136]]]], 2, Con32497), 
LLoc6000 = locally_connected1D_layer([[[0.7331, 0.5959], [0.4076, 0.1364]]], 2,[[[0.8344, 0.0985, 0.4447], [0.338, 0.7533, 0.5419], [0.1534, 0.4113, 0.5141], [0.719, 0.4187, 0.7034]]],[[0, 0, 0]], 2, Loc6000), 
LZer5400 = zero_padding1D_layer(Loc6000, 1, 0, Zer5400), 
LSub91475 = subtract_layer(Con32497,Zer5400, Sub91475), 
LFla56331 = flatten_layer(Sub91475, Fla56331), 
LAve57429 = average_layer([[[[0.3352, 0.5916], [0.4955, 0.5877]]], [[[0.5858, 0.3671], [0.356, 0.6798]]]], Ave57429), 
LFla70929 = flatten_layer(Ave57429, Fla70929), 
LCon487 = concatenate_layer([Fla70929,[[0.9328, 0.006]]], 1, Con487), 
LSub22841 = subtract_layer(Fla56331,Con487, Sub22841), 
LRes9561 = reshape_layer(Sub22841, [6, 1], Res9561), 
LRes75573 = reshape_layer(Res9561, [6, 1, 1], Res75573), 
LRes64618 = reshape_layer(Res75573, [6, 1, 1, 1], Res64618), 
LZer15324 = zero_padding3D_layer(Res64618, 0, 0, 2, 0, 2, 0, Zer15324), 
LMul713 = multiply_layer([[[[[[0.0558], [0.5971]], [[0.1032], [0.4207]]], [[[0.3568], [0.5912]], [[0.5957], [0.5558]]]]], [[[[[0.2395], [0.6049]], [[0.1208], [0.9271]]], [[[0.5513], [0.5052]], [[0.6745], [0.9665]]]]]], Mul713), 
LZer17847 = zero_padding3D_layer(Mul713, 4, 0, 1, 0, 1, 0, Zer17847), 
LAve56874 = average_layer([Zer15324,Zer17847], Ave56874), 
exec_layers([LDot74174,LCon32497,LLoc6000,LZer5400,LSub91475,LFla56331,LAve57429,LFla70929,LCon487,LSub22841,LRes9561,LRes75573,LRes64618,LZer15324,LMul713,LZer17847,LAve56874],["Dot74174","Con32497","Loc6000","Zer5400","Sub91475","Fla56331","Ave57429","Fla70929","Con487","Sub22841","Res9561","Res75573","Res64618","Zer15324","Mul713","Zer17847","Ave56874"],Ave56874,"Ave56874")

Actual (Unparsed): [[[[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [-0.2043988]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [-0.1398303]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [-0.1334250]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [-0.6828927]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0066820], [0.1805929]], [[0.0000000], [0.0062333], [-0.1244753]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0983519], [0.1493371]], [[0.0000000], [0.2008998], [-0.0048190]]]]]

Expected (Unparsed): [[[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[-0.20439883]]],[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[-0.139830335]]],[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[-0.13342499999999996]]],[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[-0.68289267]]],[[[0],[0],[0]],[[0],[0.00668205],[0.18059289499999998]],[[0],[0.00623328],[-0.12447536000000001]]],[[[0],[0],[0]],[[0],[0.09835192000000001],[0.14933712]],[[0],[0.200899825],[-0.004819000000000018]]]]]

Actual:   [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [-0.2043]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [-0.1398]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [-0.1334]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [-0.6828]]], [[[0], [0], [0]], [[0], [0.0067], [0.1806]], [[0], [0.0063], [-0.1244]]], [[[0], [0], [0]], [[0], [0.0984], [0.1494]], [[0], [0.2009], [-0.0048]]]]]

Expected: [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [-0.2043]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [-0.1398]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [-0.1334]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [-0.6828]]], [[[0], [0], [0]], [[0], [0.0067], [0.1806]], [[0], [0.0063], [-0.1244]]], [[[0], [0], [0]], [[0], [0.0984], [0.1494]], [[0], [0.2009], [-0.0048]]]]]