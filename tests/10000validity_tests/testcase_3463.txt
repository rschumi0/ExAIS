import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub12381 = tf.keras.layers.Input(shape=([2, 3, 2]))
in1Sub12381 = tf.keras.layers.Input(shape=([2, 3, 2]))
in0Max93045 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Max93045 = tf.keras.layers.Input(shape=([2, 2, 2]))

Sub12381 = keras.layers.Subtract(name = 'Sub12381', )([in0Sub12381,in1Sub12381])
Glo75237 = keras.layers.GlobalAveragePooling2D(name = 'Glo75237', )(Sub12381)
Max93045 = keras.layers.Maximum(name = 'Max93045', )([in0Max93045,in1Max93045])
Res43630 = keras.layers.Reshape((2, 4), name = 'Res43630', )(Max93045)
GRU87503 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU87503', )(Res43630)
Add41681 = keras.layers.Add(name = 'Add41681', )([Glo75237,GRU87503])
model = tf.keras.models.Model(inputs=[in0Sub12381,in1Sub12381,in0Max93045,in1Max93045], outputs=Add41681)
w = model.get_layer('GRU87503').get_weights() 
w[0] = np.array([[10, 8, 2, 4, 2, 7], [2, 1, 5, 2, 6, 7], [5, 5, 5, 8, 4, 1], [5, 5, 8, 6, 4, 2]])
w[1] = np.array([[6, 5, 1, 2, 9, 10], [3, 3, 5, 10, 3, 1]])
w[2] = np.array([3, 2, 8, 3, 1, 1])
model.get_layer('GRU87503').set_weights(w) 
in0Sub12381 = tf.constant([[[[0.7272, 0.1983], [0.9539, 0.6482], [0.2207, 0.8294]], [[0.5555, 0.4529], [0.338, 0.5672], [0.3462, 0.0369]]]])
in1Sub12381 = tf.constant([[[[0.7831, 0.5173], [0.7799, 0.563], [0.16, 0.0923]], [[0.0741, 0.2105], [0.1671, 0.5706], [0.726, 0.1818]]]])
in0Max93045 = tf.constant([[[[0.4048, 0.2081], [0.5227, 0.6539]], [[0.1241, 0.4137], [0.2776, 0.439]]]])
in1Max93045 = tf.constant([[[[0.9067, 0.418], [0.517, 0.488]], [[0.8333, 0.9396], [0.7324, 0.4007]]]])
print (np.array2string(model.predict([in0Sub12381,in1Sub12381,in0Max93045,in1Max93045],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add41681.png')

LSub12381 = subtract_layer([[[[0.7272, 0.1983], [0.9539, 0.6482], [0.2207, 0.8294]], [[0.5555, 0.4529], [0.338, 0.5672], [0.3462, 0.0369]]]], [[[[0.7831, 0.5173], [0.7799, 0.563], [0.16, 0.0923]], [[0.0741, 0.2105], [0.1671, 0.5706], [0.726, 0.1818]]]], Sub12381), 
LGlo75237 = global_average_pooling2D_layer(Sub12381, Glo75237), 
LMax93045 = maximum_layer([[[[[0.4048, 0.2081], [0.5227, 0.6539]], [[0.1241, 0.4137], [0.2776, 0.439]]]], [[[[0.9067, 0.418], [0.517, 0.488]], [[0.8333, 0.9396], [0.7324, 0.4007]]]]], Max93045), 
LRes43630 = reshape_layer(Max93045, [2, 4], Res43630), 
LGRU87503 = gru_layer(Res43630,[[10, 8, 2, 4, 2, 7], [2, 1, 5, 2, 6, 7], [5, 5, 5, 8, 4, 1], [5, 5, 8, 6, 4, 2]],[[6, 5, 1, 2, 9, 10], [3, 3, 5, 10, 3, 1]],[3, 2, 8, 3, 1, 1], false, GRU87503), 
LAdd41681 = add_layer([Glo75237,GRU87503], Add41681), 
exec_layers([LSub12381,LGlo75237,LMax93045,LRes43630,LGRU87503,LAdd41681],["Sub12381","Glo75237","Max93045","Res43630","GRU87503","Add41681"],Add41681,"Add41681")

Actual (Unparsed): [[0.0752167, 0.0995670]]

Expected (Unparsed): [[0.07521667883460792,0.0995670348794185]]

Actual:   [[0.0753, 0.0996]]

Expected: [[0.0753, 0.0996]]