import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST36287 = tf.keras.layers.Input(shape=([1, 1]))
in0Con88761 = tf.keras.layers.Input(shape=([2]))
in0Sub17384 = tf.keras.layers.Input(shape=([3]))
in1Sub17384 = tf.keras.layers.Input(shape=([3]))
in0Glo36104 = tf.keras.layers.Input(shape=([1, 1]))
in0Con85655 = tf.keras.layers.Input(shape=([2]))

LST36287 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST36287', )(in0LST36287)
Con88761 = keras.layers.Concatenate(axis=1, name = 'Con88761', )([LST36287,in0Con88761])
Sub17384 = keras.layers.Subtract(name = 'Sub17384', )([in0Sub17384,in1Sub17384])
Ave98789 = keras.layers.Average(name = 'Ave98789', )([Con88761,Sub17384])
Glo36104 = keras.layers.GlobalAveragePooling1D(name = 'Glo36104', )(in0Glo36104)
Con85655 = keras.layers.Concatenate(axis=1, name = 'Con85655', )([Glo36104,in0Con85655])
Ave71056 = keras.layers.Average(name = 'Ave71056', )([Ave98789,Con85655])
Res96981 = keras.layers.Reshape((3, 1), name = 'Res96981', )(Ave71056)
Res41736 = keras.layers.Reshape((3, 1, 1), name = 'Res41736', )(Res96981)
Sep34159 = keras.layers.SeparableConv2D(4, (2, 1),strides=(3, 3), padding='valid', name = 'Sep34159', )(Res41736)
model = tf.keras.models.Model(inputs=[in0LST36287,in0Con88761,in0Sub17384,in1Sub17384,in0Glo36104,in0Con85655], outputs=Sep34159)
w = model.get_layer('LST36287').get_weights() 
w[0] = np.array([[8, 7, 9, 10]])
w[1] = np.array([[6, 9, 3, 10]])
w[2] = np.array([4, 6, 7, 7])
model.get_layer('LST36287').set_weights(w) 
w = model.get_layer('Sep34159').get_weights() 
w[0] = np.array([[[[0.0643]]], [[[0.9545]]]])
w[1] = np.array([[[[0.5784, 0.8741, 0.3334, 0.6442]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep34159').set_weights(w) 
in0LST36287 = tf.constant([[[4]]])
in0Con88761 = tf.constant([[0.8526, 0.9527]])
in0Sub17384 = tf.constant([[0.5818, 0.1536, 0.7515]])
in1Sub17384 = tf.constant([[0.578, 0.8495, 0.7401]])
in0Glo36104 = tf.constant([[[1.8644]]])
in0Con85655 = tf.constant([[0.6985, 0.4193]])
print (np.array2string(model.predict([in0LST36287,in0Con88761,in0Sub17384,in1Sub17384,in0Glo36104,in0Con85655],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sep34159.png')

LLST36287 = lstm_layer([[[4]]],[[8, 7, 9, 10]],[[6, 9, 3, 10]],[4, 6, 7, 7], LST36287), 
LCon88761 = concatenate_layer([LST36287,[[0.8526, 0.9527]]], 1, Con88761), 
LSub17384 = subtract_layer([[0.5818, 0.1536, 0.7515]], [[0.578, 0.8495, 0.7401]], Sub17384), 
LAve98789 = average_layer([Con88761,Sub17384], Ave98789), 
LGlo36104 = global_average_pooling1D_layer([[[1.8644]]], Glo36104), 
LCon85655 = concatenate_layer([Glo36104,[[0.6985, 0.4193]]], 1, Con85655), 
LAve71056 = average_layer([Ave98789,Con85655], Ave71056), 
LRes96981 = reshape_layer(Ave71056, [3, 1], Res96981), 
LRes41736 = reshape_layer(Res96981, [3, 1, 1], Res41736), 
LSep34159 = separable_conv2D_layer(Res41736, 2, 1,[[[[[0.0643]]], [[[0.9545]]]],[[[[0.5784, 0.8741, 0.3334, 0.6442]]]]],[0, 0, 0, 0], 3, 3, false, Sep34159), 
exec_layers([LLST36287,LCon88761,LSub17384,LAve98789,LGlo36104,LCon85655,LAve71056,LRes96981,LRes41736,LSep34159],["LST36287","Con88761","Sub17384","Ave98789","Glo36104","Con85655","Ave71056","Res96981","Res41736","Sep34159"],Sep34159,"Sep34159")

Actual (Unparsed): [[[[0.2562288, 0.3872226, 0.1476948, 0.2853779]]]]

Expected (Unparsed): [[[[0.25622879012936245,0.38722265811216405,0.1476948109079001,0.2853779159774123]]]]

Actual:   [[[[0.2563, 0.3873, 0.1477, 0.2854]]]]

Expected: [[[[0.2563, 0.3873, 0.1477, 0.2854]]]]