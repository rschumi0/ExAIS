import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max3749 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Max3749 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))

Max3749 = keras.layers.Maximum(name = 'Max3749', )([in0Max3749,in1Max3749])
Den6905 = keras.layers.Dense(4,name = 'Den6905', )(Max3749)
Fla3951 = keras.layers.Flatten(name = 'Fla3951', )(Den6905)
Res40127 = keras.layers.Reshape((8, 1), name = 'Res40127', )(Fla3951)
Res49166 = keras.layers.Reshape((8, 1, 1), name = 'Res49166', )(Res40127)
Res73887 = keras.layers.Reshape((8, 1, 1, 1), name = 'Res73887', )(Res49166)
Con82106 = keras.layers.Conv3D(4, (4, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con82106', )(Res73887)
model = tf.keras.models.Model(inputs=[in0Max3749,in1Max3749], outputs=Con82106)
w = model.get_layer('Den6905').get_weights() 
w[0] = np.array([[0.4771, 0.8678, 0.1973, 0.6783], [0.7808, 0.6647, 0.9889, 0.9848]])
w[1] = np.array([0.1371, 0.9123, 0.7772, 0.1313])
model.get_layer('Den6905').set_weights(w) 
w = model.get_layer('Con82106').get_weights() 
w[0] = np.array([[[[[0.3821, 0.4382, 0.7471, 0.4077]]]], [[[[0.7598, 0.1424, 0.4179, 0.1548]]]], [[[[0.7071, 0.5863, 0.3731, 0.1226]]]], [[[[0.8257, 0.6314, 0.6793, 0.4649]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con82106').set_weights(w) 
in0Max3749 = tf.constant([[[[[0.6356, 0.4434], [0.623, 0.2246]]]]])
in1Max3749 = tf.constant([[[[[0.6276, 0.2398], [0.2348, 0.6406]]]]])
print (np.array2string(model.predict([in0Max3749,in1Max3749],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con82106.png')

LMax3749 = maximum_layer([[[[[[0.6356, 0.4434], [0.623, 0.2246]]]]], [[[[[0.6276, 0.2398], [0.2348, 0.6406]]]]]], Max3749), 
LDen6905 = dense_layer(Max3749, [[0.4771, 0.8678, 0.1973, 0.6783], [0.7808, 0.6647, 0.9889, 0.9848]],[0.1371, 0.9123, 0.7772, 0.1313], Den6905), 
LFla3951 = flatten_layer(Den6905, Fla3951), 
LRes40127 = reshape_layer(Fla3951, [8, 1], Res40127), 
LRes49166 = reshape_layer(Res40127, [8, 1, 1], Res49166), 
LRes73887 = reshape_layer(Res49166, [8, 1, 1, 1], Res73887), 
LCon82106 = conv3D_layer(Res73887, 4, 1, 1,[[[[[0.3821, 0.4382, 0.7471, 0.4077]]]], [[[[0.7598, 0.1424, 0.4179, 0.1548]]]], [[[[0.7071, 0.5863, 0.3731, 0.1226]]]], [[[[0.8257, 0.6314, 0.6793, 0.4649]]]]],[0, 0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con82106), 
exec_layers([LMax3749,LDen6905,LFla3951,LRes40127,LRes49166,LRes73887,LCon82106],["Max3749","Den6905","Fla3951","Res40127","Res49166","Res73887","Con82106"],Con82106,"Con82106")

Actual (Unparsed): [[[[[3.4099528, 2.0121922, 2.5015903, 1.2218011]]], [[[3.1689989, 2.1374065, 2.8818644, 1.4815250]]], [[[3.4836099, 2.4640781, 3.0443407, 1.6894185]]], [[[3.6865560, 2.6407036, 2.8796914, 1.4952991]]], [[[3.8472058, 2.3242386, 2.8602887, 1.4106389]]]]]

Expected (Unparsed): [[[[[3.4099528394300003,2.0121922305220004,2.501590333396,1.221801163948]]],[[[3.168998915784,2.13740652198,2.881864395426,1.481525032656]]],[[[3.4836098438260006,2.46407808899,3.044340656978,1.689418487024]]],[[[3.686555968654,2.640703556354,2.8796914168559997,1.495299121652]]],[[[3.8472057118439995,2.324238547628,2.8602886013739997,1.410638813908]]]]]

Actual:   [[[[[3.41, 2.0122, 2.5016, 1.2219]]], [[[3.169, 2.1375, 2.8819, 1.4816]]], [[[3.4837, 2.4641, 3.0444, 1.6895]]], [[[3.6866, 2.6408, 2.8797, 1.4953]]], [[[3.8473, 2.3243, 2.8603, 1.4107]]]]]

Expected: [[[[[3.41, 2.0122, 2.5016, 1.2219]]], [[[3.169, 2.1375, 2.8819, 1.4816]]], [[[3.4837, 2.4641, 3.0444, 1.6895]]], [[[3.6866, 2.6408, 2.8797, 1.4953]]], [[[3.8473, 2.3243, 2.8603, 1.4107]]]]]