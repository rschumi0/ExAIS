import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add87983 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Add87983 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Max62188 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Max62188 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Glo15923 = tf.keras.layers.Input(shape=([1, 1, 2]))

Add87983 = keras.layers.Add(name = 'Add87983', )([in0Add87983,in1Add87983])
Res22603 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res22603', )(Add87983)
Up_7208 = keras.layers.UpSampling3D(size=(1, 2, 2), name = 'Up_7208', )(Res22603)
Res66358 = keras.layers.Reshape((1, 2, 2), name = 'Res66358', )(Up_7208)
Res47711 = keras.layers.Reshape((1, 4), name = 'Res47711', )(Res66358)
Max62188 = keras.layers.Maximum(name = 'Max62188', )([in0Max62188,in1Max62188])
Res84905 = keras.layers.Reshape((1, 2), name = 'Res84905', )(Max62188)
Glo15923 = keras.layers.GlobalMaxPool2D(name = 'Glo15923', )(in0Glo15923)
Res10414 = keras.layers.Reshape((1, 2), name = 'Res10414', )(Glo15923)
Mul3809 = keras.layers.Multiply(name = 'Mul3809', )([Res84905,Res10414])
Res46107 = keras.layers.Reshape((1, 2, 1), name = 'Res46107', )(Mul3809)
Con93169 = keras.layers.Conv2DTranspose(2, (1, 2),strides=(1, 1), padding='same', name = 'Con93169', )(Res46107)
Res35501 = keras.layers.Reshape((1, 4), name = 'Res35501', )(Con93169)
Dot68857 = keras.layers.Dot(axes=(1, 1), name = 'Dot68857', )([Res47711,Res35501])
model = tf.keras.models.Model(inputs=[in0Add87983,in1Add87983,in0Max62188,in1Max62188,in0Glo15923], outputs=Dot68857)
w = model.get_layer('Con93169').get_weights() 
w[0] = np.array([[[[0.1197], [0.1788]], [[0.0412], [0.0812]]]])
w[1] = np.array([0, 0])
model.get_layer('Con93169').set_weights(w) 
in0Add87983 = tf.constant([[[[0.6747]]]])
in1Add87983 = tf.constant([[[[0.606]]]])
in0Max62188 = tf.constant([[[[0.2871, 0.5129]]]])
in1Max62188 = tf.constant([[[[0.8006, 0.8344]]]])
in0Glo15923 = tf.constant([[[[1.1594, 1.2408]]]])
print (np.array2string(model.predict([in0Add87983,in1Add87983,in0Max62188,in1Max62188,in0Glo15923],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot68857.png')

LAdd87983 = add_layer([[[[[0.6747]]]], [[[[0.606]]]]], Add87983), 
LRes22603 = reshape_layer(Add87983, [1, 1, 1, 1], Res22603), 
LUp_7208 = up_sampling3D_layer(Res22603, 1, 2, 2, Up_7208), 
LRes66358 = reshape_layer(Up_7208, [1, 2, 2], Res66358), 
LRes47711 = reshape_layer(Res66358, [1, 4], Res47711), 
LMax62188 = maximum_layer([[[[[0.2871, 0.5129]]]], [[[[0.8006, 0.8344]]]]], Max62188), 
LRes84905 = reshape_layer(Max62188, [1, 2], Res84905), 
LGlo15923 = global_max_pool2D_layer([[[[1.1594, 1.2408]]]], Glo15923), 
LRes10414 = reshape_layer(Glo15923, [1, 2], Res10414), 
LMul3809 = multiply_layer([Res84905,Res10414], Mul3809), 
LRes46107 = reshape_layer(Mul3809, [1, 2, 1], Res46107), 
LCon93169 = conv2D_transpose_layer(Res46107, 1, 2,[[[[0.1197], [0.1788]], [[0.0412], [0.0812]]]],[0, 0], 1, 1, true, Con93169), 
LRes35501 = reshape_layer(Con93169, [1, 4], Res35501), 
LDot68857 = dot_layer(Res47711,Res35501, 1, 1, Dot68857), 
exec_layers([LAdd87983,LRes22603,LUp_7208,LRes66358,LRes47711,LMax62188,LRes84905,LGlo15923,LRes10414,LMul3809,LRes46107,LCon93169,LRes35501,LDot68857],["Add87983","Res22603","Up_7208","Res66358","Res47711","Max62188","Res84905","Glo15923","Res10414","Mul3809","Res46107","Con93169","Res35501","Dot68857"],Dot68857,"Dot68857")

Actual (Unparsed): [[[0.1422953, 0.2125513, 0.2076920, 0.3336057], [0.1422953, 0.2125513, 0.2076920, 0.3336057], [0.1422953, 0.2125513, 0.2076920, 0.3336057], [0.1422953, 0.2125513, 0.2076920, 0.3336057]]]

Expected (Unparsed): [[[0.1422952626867156,0.21255131970246238,0.20769202792815836,0.33360564370906076],[0.1422952626867156,0.21255131970246238,0.20769202792815836,0.33360564370906076],[0.1422952626867156,0.21255131970246238,0.20769202792815836,0.33360564370906076],[0.1422952626867156,0.21255131970246238,0.20769202792815836,0.33360564370906076]]]

Actual:   [[[0.1423, 0.2126, 0.2077, 0.3337], [0.1423, 0.2126, 0.2077, 0.3337], [0.1423, 0.2126, 0.2077, 0.3337], [0.1423, 0.2126, 0.2077, 0.3337]]]

Expected: [[[0.1423, 0.2126, 0.2077, 0.3337], [0.1423, 0.2126, 0.2077, 0.3337], [0.1423, 0.2126, 0.2077, 0.3337], [0.1423, 0.2126, 0.2077, 0.3337]]]