import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub14516 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub14516 = tf.keras.layers.Input(shape=([2, 2]))
in0Con54394 = tf.keras.layers.Input(shape=([2, 2]))
in0Con70503 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Dot5658 = tf.keras.layers.Input(shape=([2]))
in1Dot5658 = tf.keras.layers.Input(shape=([2]))
in0Con71044 = tf.keras.layers.Input(shape=([1]))
in0Con43108 = tf.keras.layers.Input(shape=([2, 7]))
in0Con15225 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))

Sub14516 = keras.layers.Subtract(name = 'Sub14516', )([in0Sub14516,in1Sub14516])
Con54394 = keras.layers.Concatenate(axis=2, name = 'Con54394', )([Sub14516,in0Con54394])
Con70503 = keras.layers.Conv2D(4, (1, 2),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con70503', )(in0Con70503)
PRe66203 = keras.layers.PReLU(name = 'PRe66203', )(Con70503)
Res47025 = keras.layers.Reshape((1, 4), name = 'Res47025', )(PRe66203)
Dot85729 = keras.layers.Dot(axes=(2, 2), name = 'Dot85729', )([Con54394,Res47025])
Fla24513 = keras.layers.Flatten(name = 'Fla24513', )(Dot85729)
Dot5658 = keras.layers.Dot(axes=(1, 1), name = 'Dot5658', )([in0Dot5658,in1Dot5658])
Con71044 = keras.layers.Concatenate(axis=1, name = 'Con71044', )([Dot5658,in0Con71044])
Ave67336 = keras.layers.Average(name = 'Ave67336', )([Fla24513,Con71044])
Res40054 = keras.layers.Reshape((2, 1), name = 'Res40054', )(Ave67336)
Con43108 = keras.layers.Concatenate(axis=2, name = 'Con43108', )([Res40054,in0Con43108])
Con15225 = keras.layers.Conv3D(4, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con15225', )(in0Con15225)
Res30943 = keras.layers.Reshape((1, 1, 8), name = 'Res30943', )(Con15225)
Res12972 = keras.layers.Reshape((1, 8), name = 'Res12972', )(Res30943)
Dot54545 = keras.layers.Dot(axes=(2, 2), name = 'Dot54545', )([Con43108,Res12972])
model = tf.keras.models.Model(inputs=[in0Sub14516,in1Sub14516,in0Con54394,in0Con70503,in0Dot5658,in1Dot5658,in0Con71044,in0Con43108,in0Con15225], outputs=Dot54545)
w = model.get_layer('Con70503').get_weights() 
w[0] = np.array([[[[0.6021, 0.1986, 0.3375, 0.1008], [0.0549, 0.7922, 0.7662, 0.2189]], [[0.4748, 0.5386, 0.7503, 0.9361], [0.5499, 0.4557, 0.0453, 0.2595]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con70503').set_weights(w) 
w = model.get_layer('PRe66203').get_weights() 
w[0] = np.array([[[0.7482, 0.733, 0.501, 0.6445]]])
model.get_layer('PRe66203').set_weights(w) 
w = model.get_layer('Con15225').get_weights() 
w[0] = np.array([[[[[0.2821, 0.3611, 0.638, 0.4954], [0.322, 0.4411, 0.0815, 0.9288]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con15225').set_weights(w) 
in0Sub14516 = tf.constant([[[0.5588, 0.9295], [0.7321, 0.0581]]])
in1Sub14516 = tf.constant([[[0.5339, 0.6115], [0.4684, 0.4982]]])
in0Con54394 = tf.constant([[[0.2578, 0.4052], [0.6997, 0.2424]]])
in0Con70503 = tf.constant([[[[0.8359, 0.8469], [0.9082, 0.2587]]]])
in0Dot5658 = tf.constant([[0.5246, 0.8956]])
in1Dot5658 = tf.constant([[0.827, 0.453]])
in0Con71044 = tf.constant([[0.0997]])
in0Con43108 = tf.constant([[[0.3528, 0.0683, 0.8945, 0.8002, 0.4159, 0.727, 0.3599], [0.5276, 0.6631, 0.7959, 0.4278, 0.2789, 0.0308, 0.516]]])
in0Con15225 = tf.constant([[[[[0.243, 0.2379], [0.5637, 0.3307]]]]])
print (np.array2string(model.predict([in0Sub14516,in1Sub14516,in0Con54394,in0Con70503,in0Dot5658,in1Dot5658,in0Con71044,in0Con43108,in0Con15225],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot54545.png')

LSub14516 = subtract_layer([[[0.5588, 0.9295], [0.7321, 0.0581]]], [[[0.5339, 0.6115], [0.4684, 0.4982]]], Sub14516), 
LCon54394 = concatenate_layer([Sub14516,[[[0.2578, 0.4052], [0.6997, 0.2424]]]], 2, Con54394), 
LCon70503 = conv2D_layer([[[[0.8359, 0.8469], [0.9082, 0.2587]]]], 1, 2,[[[[0.6021, 0.1986, 0.3375, 0.1008], [0.0549, 0.7922, 0.7662, 0.2189]], [[0.4748, 0.5386, 0.7503, 0.9361], [0.5499, 0.4557, 0.0453, 0.2595]]]],[0, 0, 0, 0], 1, 1, false, 1, 1, Con70503), 
LPRe66203 = prelu_layer(Con70503, [[[0.7482, 0.733, 0.501, 0.6445]]], PRe66203), 
LRes47025 = reshape_layer(PRe66203, [1, 4], Res47025), 
LDot85729 = dot_layer(Con54394,Res47025, 2, 2, Dot85729), 
LFla24513 = flatten_layer(Dot85729, Fla24513), 
LDot5658 = dot_layer([[0.5246, 0.8956]], [[0.827, 0.453]], 1, 1, Dot5658), 
LCon71044 = concatenate_layer([Dot5658,[[0.0997]]], 1, Con71044), 
LAve67336 = average_layer([Fla24513,Con71044], Ave67336), 
LRes40054 = reshape_layer(Ave67336, [2, 1], Res40054), 
LCon43108 = concatenate_layer([Res40054,[[[0.3528, 0.0683, 0.8945, 0.8002, 0.4159, 0.727, 0.3599], [0.5276, 0.6631, 0.7959, 0.4278, 0.2789, 0.0308, 0.516]]]], 2, Con43108), 
LCon15225 = conv3D_layer([[[[[0.243, 0.2379], [0.5637, 0.3307]]]]], 1, 1, 1,[[[[[0.2821, 0.3611, 0.638, 0.4954], [0.322, 0.4411, 0.0815, 0.9288]]]]],[0, 0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con15225), 
LRes30943 = reshape_layer(Con15225, [1, 1, 8], Res30943), 
LRes12972 = reshape_layer(Res30943, [1, 8], Res12972), 
LDot54545 = dot_layer(Con43108,Res12972, 2, 2, Dot54545), 
exec_layers([LSub14516,LCon54394,LCon70503,LPRe66203,LRes47025,LDot85729,LFla24513,LDot5658,LCon71044,LAve67336,LRes40054,LCon43108,LCon15225,LRes30943,LRes12972,LDot54545],["Sub14516","Con54394","Con70503","PRe66203","Res47025","Dot85729","Fla24513","Dot5658","Con71044","Ave67336","Res40054","Con43108","Con15225","Res30943","Res12972","Dot54545"],Dot54545,"Dot54545")

Actual (Unparsed): [[[1.3966917], [1.1004995]]]

Expected (Unparsed): [[[1.3966917002402655],[1.1004994749411823]]]

Actual:   [[[1.3967], [1.1005]]]

Expected: [[[1.3967], [1.1005]]]