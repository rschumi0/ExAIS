import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub57131 = tf.keras.layers.Input(shape=([2]))
in1Sub57131 = tf.keras.layers.Input(shape=([2]))
in0Con24565 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Max38959 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Dot98640 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot98640 = tf.keras.layers.Input(shape=([3, 3]))

Sub57131 = keras.layers.Subtract(name = 'Sub57131', )([in0Sub57131,in1Sub57131])
Res23572 = keras.layers.Reshape((2, 1), name = 'Res23572', )(Sub57131)
Glo90015 = keras.layers.GlobalAveragePooling1D(name = 'Glo90015', )(Res23572)
Res46051 = keras.layers.Reshape((1, 1), name = 'Res46051', )(Glo90015)
Res19536 = keras.layers.Reshape((1, 1, 1), name = 'Res19536', )(Res46051)
Zer17231 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer17231', )(Res19536)
Con24565 = keras.layers.Concatenate(axis=3, name = 'Con24565', )([Zer17231,in0Con24565])
Max38959 = keras.layers.MaxPool2D(pool_size=(1, 2), strides=(1, 1), padding='valid', name = 'Max38959', )(in0Max38959)
Res21430 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res21430', )(Max38959)
Zer82495 = keras.layers.ZeroPadding3D(padding=((2, 0), (2, 0), (1, 0)), name = 'Zer82495', )(Res21430)
Dot98640 = keras.layers.Dot(axes=(1, 2), name = 'Dot98640', )([in0Dot98640,in1Dot98640])
Res90717 = keras.layers.Reshape((3, 3, 1), name = 'Res90717', )(Dot98640)
Res22208 = keras.layers.Reshape((3, 3, 1, 1), name = 'Res22208', )(Res90717)
Up_33992 = keras.layers.UpSampling3D(size=(1, 1, 2), name = 'Up_33992', )(Res22208)
Ave3475 = keras.layers.Average(name = 'Ave3475', )([Zer82495,Up_33992])
Res64252 = keras.layers.Reshape((3, 3, 2), name = 'Res64252', )(Ave3475)
Max98174 = keras.layers.MaxPool2D(pool_size=(1, 3), strides=(2, 1), padding='valid', name = 'Max98174', )(Res64252)
Zer22157 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer22157', )(Max98174)
Mul79744 = keras.layers.Multiply(name = 'Mul79744', )([Con24565,Zer22157])
model = tf.keras.models.Model(inputs=[in0Sub57131,in1Sub57131,in0Con24565,in0Max38959,in0Dot98640,in1Dot98640], outputs=Mul79744)
in0Sub57131 = tf.constant([[0.2272, 0.0117]])
in1Sub57131 = tf.constant([[0.2578, 0.3664]])
in0Con24565 = tf.constant([[[[0.1188], [0.0673], [0.2372]], [[0.7567], [0.52], [0.7852]], [[0.5089], [0.5555], [0.1916]]]])
in0Max38959 = tf.constant([[[[1.9611], [1.3663]]]])
in0Dot98640 = tf.constant([[[0.6961, 0.7246, 0.3402], [0.0245, 0.6366, 0.9229], [0.4771, 0.7398, 0.9446]]])
in1Dot98640 = tf.constant([[[0.1949, 0.9612, 0.7597], [0.3054, 0.4324, 0.1263], [0.9639, 0.1662, 0.7568]]])
print (np.array2string(model.predict([in0Sub57131,in1Sub57131,in0Con24565,in0Max38959,in0Dot98640,in1Dot98640],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul79744.png')

LSub57131 = subtract_layer([[0.2272, 0.0117]], [[0.2578, 0.3664]], Sub57131), 
LRes23572 = reshape_layer(Sub57131, [2, 1], Res23572), 
LGlo90015 = global_average_pooling1D_layer(Res23572, Glo90015), 
LRes46051 = reshape_layer(Glo90015, [1, 1], Res46051), 
LRes19536 = reshape_layer(Res46051, [1, 1, 1], Res19536), 
LZer17231 = zero_padding2D_layer(Res19536, 1, 1, 1, 1, Zer17231), 
LCon24565 = concatenate_layer([Zer17231,[[[[0.1188], [0.0673], [0.2372]], [[0.7567], [0.52], [0.7852]], [[0.5089], [0.5555], [0.1916]]]]], 3, Con24565), 
LMax38959 = max_pool2D_layer([[[[1.9611], [1.3663]]]], 1, 2, 1, 1, false, Max38959), 
LRes21430 = reshape_layer(Max38959, [1, 1, 1, 1], Res21430), 
LZer82495 = zero_padding3D_layer(Res21430, 2, 0, 2, 0, 1, 0, Zer82495), 
LDot98640 = dot_layer([[[0.6961, 0.7246, 0.3402], [0.0245, 0.6366, 0.9229], [0.4771, 0.7398, 0.9446]]], [[[0.1949, 0.9612, 0.7597], [0.3054, 0.4324, 0.1263], [0.9639, 0.1662, 0.7568]]], 1, 2, Dot98640), 
LRes90717 = reshape_layer(Dot98640, [3, 3, 1], Res90717), 
LRes22208 = reshape_layer(Res90717, [3, 3, 1, 1], Res22208), 
LUp_33992 = up_sampling3D_layer(Res22208, 1, 1, 2, Up_33992), 
LAve3475 = average_layer([Zer82495,Up_33992], Ave3475), 
LRes64252 = reshape_layer(Ave3475, [3, 3, 2], Res64252), 
LMax98174 = max_pool2D_layer(Res64252, 1, 3, 2, 1, false, Max98174), 
LZer22157 = zero_padding2D_layer(Max98174, 1, 0, 2, 0, Zer22157), 
LMul79744 = multiply_layer([Con24565,Zer22157], Mul79744), 
exec_layers([LSub57131,LRes23572,LGlo90015,LRes46051,LRes19536,LZer17231,LCon24565,LMax38959,LRes21430,LZer82495,LDot98640,LRes90717,LRes22208,LUp_33992,LAve3475,LRes64252,LMax98174,LZer22157,LMul79744],["Sub57131","Res23572","Glo90015","Res46051","Res19536","Zer17231","Con24565","Max38959","Res21430","Zer82495","Dot98640","Res90717","Res22208","Up_33992","Ave3475","Res64252","Max98174","Zer22157","Mul79744"],Mul79744,"Mul79744")

Actual (Unparsed): [[[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [-0.0000000, 0.0000000], [0.0000000, 0.4067776]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.3024672]]]]

Expected (Unparsed): [[[[0,0.0],[0,0.0],[0,0.0]],[[0,0.0],[-0.0,0.0],[0.0,0.40677755942200006]],[[0,0.0],[0,0.0],[0.0,0.302467236232]]]]

Actual:   [[[[0, 0], [0, 0], [0, 0]], [[0, 0], [-0, 0], [0, 0.4068]], [[0, 0], [0, 0], [0, 0.3025]]]]

Expected: [[[[0, 0], [0, 0], [0, 0]], [[0, 0], [-0, 0], [0, 0.4068]], [[0, 0], [0, 0], [0, 0.3025]]]]