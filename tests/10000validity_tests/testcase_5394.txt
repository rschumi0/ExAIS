import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc35757 = tf.keras.layers.Input(shape=([2, 2]))
in0Ave13271 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave13271 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con5944 = tf.keras.layers.Input(shape=([2, 4, 1]))
in0Max93050 = tf.keras.layers.Input(shape=([2, 2]))
in1Max93050 = tf.keras.layers.Input(shape=([2, 2]))
in0Con211 = tf.keras.layers.Input(shape=([14]))

Loc35757 = keras.layers.LocallyConnected1D(3, (2),strides=(1), name = 'Loc35757', )(in0Loc35757)
Res75139 = keras.layers.Reshape((1, 3, 1), name = 'Res75139', )(Loc35757)
Res73905 = keras.layers.Reshape((1, 3, 1, 1), name = 'Res73905', )(Res75139)
Con67894 = keras.layers.Conv3DTranspose(2, (1, 3, 1),strides=(1, 1, 1), padding='same', name = 'Con67894', )(Res73905)
Res27796 = keras.layers.Reshape((1, 3, 2), name = 'Res27796', )(Con67894)
Zer91636 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer91636', )(Res27796)
Ave13271 = keras.layers.Average(name = 'Ave13271', )([in0Ave13271,in1Ave13271])
Zer99776 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer99776', )(Ave13271)
Con5944 = keras.layers.Concatenate(axis=3, name = 'Con5944', )([Zer99776,in0Con5944])
Ave18092 = keras.layers.Average(name = 'Ave18092', )([Zer91636,Con5944])
Res40972 = keras.layers.Reshape((2, 8), name = 'Res40972', )(Ave18092)
Fla88734 = keras.layers.Flatten(name = 'Fla88734', )(Res40972)
Max93050 = keras.layers.Maximum(name = 'Max93050', )([in0Max93050,in1Max93050])
Glo11954 = keras.layers.GlobalAveragePooling1D(name = 'Glo11954', )(Max93050)
Con211 = keras.layers.Concatenate(axis=1, name = 'Con211', )([Glo11954,in0Con211])
Add25573 = keras.layers.Add(name = 'Add25573', )([Fla88734,Con211])
model = tf.keras.models.Model(inputs=[in0Loc35757,in0Ave13271,in1Ave13271,in0Con5944,in0Max93050,in1Max93050,in0Con211], outputs=Add25573)
w = model.get_layer('Loc35757').get_weights() 
w[0] = np.array([[[0.805, 0.9267, 0.3681], [0.0066, 0.8558, 0.8482], [0.4914, 0.3228, 0.5333], [0.4036, 0.3159, 0.0131]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc35757').set_weights(w) 
w = model.get_layer('Con67894').get_weights() 
w[0] = np.array([[[[[0.0991], [0.4685]]], [[[0.0309], [0.2563]]], [[[0.2977], [0.0458]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con67894').set_weights(w) 
in0Loc35757 = tf.constant([[[0.6537, 0.5227], [0.0997, 0.4479]]])
in0Ave13271 = tf.constant([[[[0.8709], [0.6758]], [[0.8251], [0.6532]]]])
in1Ave13271 = tf.constant([[[[0.2546], [0.8444]], [[0.2446], [0.2575]]]])
in0Con5944 = tf.constant([[[[0.5931], [0.7398], [0.2413], [0.6774]], [[0.74], [0.1375], [0.518], [0.5159]]]])
in0Max93050 = tf.constant([[[0.2304, 0.0023], [0.3124, 0.7958]]])
in1Max93050 = tf.constant([[[0.9318, 0.8227], [0.7969, 0.7835]]])
in0Con211 = tf.constant([[0.7437, 0.4663, 0.5876, 0.0477, 0.7097, 0.0413, 0.741, 0.9284, 0.0397, 0.9237, 0.4093, 0.0248, 0.1498, 0.8822]])
print (np.array2string(model.predict([in0Loc35757,in0Ave13271,in1Ave13271,in0Con5944,in0Max93050,in1Max93050,in0Con211],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add25573.png')

LLoc35757 = locally_connected1D_layer([[[0.6537, 0.5227], [0.0997, 0.4479]]], 2,[[[0.805, 0.9267, 0.3681], [0.0066, 0.8558, 0.8482], [0.4914, 0.3228, 0.5333], [0.4036, 0.3159, 0.0131]]],[[0, 0, 0]], 1, Loc35757), 
LRes75139 = reshape_layer(Loc35757, [1, 3, 1], Res75139), 
LRes73905 = reshape_layer(Res75139, [1, 3, 1, 1], Res73905), 
LCon67894 = conv3D_transpose_layer(Res73905, 1, 3, 1,[[[[[0.0991], [0.4685]]], [[[0.0309], [0.2563]]], [[[0.2977], [0.0458]]]]],[0, 0], 1, 1, 1, true, Con67894), 
LRes27796 = reshape_layer(Con67894, [1, 3, 2], Res27796), 
LZer91636 = zero_padding2D_layer(Res27796, 1, 0, 1, 0, Zer91636), 
LAve13271 = average_layer([[[[[0.8709], [0.6758]], [[0.8251], [0.6532]]]], [[[[0.2546], [0.8444]], [[0.2446], [0.2575]]]]], Ave13271), 
LZer99776 = zero_padding2D_layer(Ave13271, 0, 0, 2, 0, Zer99776), 
LCon5944 = concatenate_layer([Zer99776,[[[[0.5931], [0.7398], [0.2413], [0.6774]], [[0.74], [0.1375], [0.518], [0.5159]]]]], 3, Con5944), 
LAve18092 = average_layer([Zer91636,Con5944], Ave18092), 
LRes40972 = reshape_layer(Ave18092, [2, 8], Res40972), 
LFla88734 = flatten_layer(Res40972, Fla88734), 
LMax93050 = maximum_layer([[[[0.2304, 0.0023], [0.3124, 0.7958]]], [[[0.9318, 0.8227], [0.7969, 0.7835]]]], Max93050), 
LGlo11954 = global_average_pooling1D_layer(Max93050, Glo11954), 
LCon211 = concatenate_layer([Glo11954,[[0.7437, 0.4663, 0.5876, 0.0477, 0.7097, 0.0413, 0.741, 0.9284, 0.0397, 0.9237, 0.4093, 0.0248, 0.1498, 0.8822]]], 1, Con211), 
LAdd25573 = add_layer([Fla88734,Con211], Add25573), 
exec_layers([LLoc35757,LRes75139,LRes73905,LCon67894,LRes27796,LZer91636,LAve13271,LZer99776,LCon5944,LAve18092,LRes40972,LFla88734,LMax93050,LGlo11954,LCon211,LAdd25573],["Loc35757","Res75139","Res73905","Con67894","Res27796","Zer91636","Ave13271","Zer99776","Con5944","Ave18092","Res40972","Fla88734","Max93050","Glo11954","Con211","Add25573"],Add25573,"Add25573")

Actual (Unparsed): [[0.8643500, 1.1058000, 0.7437000, 0.8362000, 0.8689750, 0.1683500, 1.0897500, 0.3800000, 0.7410000, 1.2984000, 0.1122206, 1.3771471, 0.8455385, 0.6324559, 0.5715616, 1.2634612]]

Expected (Unparsed): [[0.86435,1.1058,0.7437,0.8362,0.868975,0.16835,1.08975,0.38,0.741,1.2984,0.112220607254,1.377147101806,0.8455385449335,0.6324558878215001,0.5715616175215,1.2634612164095]]

Actual:   [[0.8644, 1.1058, 0.7437, 0.8362, 0.869, 0.1684, 1.0898, 0.38, 0.741, 1.2984, 0.1123, 1.3772, 0.8456, 0.6325, 0.5716, 1.2635]]

Expected: [[0.8644, 1.1058, 0.7437, 0.8362, 0.869, 0.1684, 1.0898, 0.38, 0.741, 1.2984, 0.1123, 1.3772, 0.8456, 0.6325, 0.5716, 1.2635]]