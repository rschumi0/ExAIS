import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max98027 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Max98027 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Con32074 = tf.keras.layers.Input(shape=([2, 7]))
in0Add48378 = tf.keras.layers.Input(shape=([2, 1]))
in1Add48378 = tf.keras.layers.Input(shape=([2, 1]))

Max98027 = keras.layers.Maximum(name = 'Max98027', )([in0Max98027,in1Max98027])
Res90011 = keras.layers.Reshape((2, 2, 4), name = 'Res90011', )(Max98027)
Res51358 = keras.layers.Reshape((2, 8), name = 'Res51358', )(Res90011)
Con32074 = keras.layers.Concatenate(axis=2, name = 'Con32074', )([Res51358,in0Con32074])
Add48378 = keras.layers.Add(name = 'Add48378', )([in0Add48378,in1Add48378])
Dot87378 = keras.layers.Dot(axes=(1, 1), name = 'Dot87378', )([Con32074,Add48378])
model = tf.keras.models.Model(inputs=[in0Max98027,in1Max98027,in0Con32074,in0Add48378,in1Add48378], outputs=Dot87378)
in0Max98027 = tf.constant([[[[[0.773, 0.8616], [0.546, 0.8395]], [[0.7342, 0.6349], [0.397, 0.2572]]], [[[0.0294, 0.9397], [0.6628, 0.8926]], [[0.96, 0.7413], [0.3797, 0.6999]]]]])
in1Max98027 = tf.constant([[[[[0.9434, 0.7042], [0.287, 0.4098]], [[0.1967, 0.9164], [0.8301, 0.5952]]], [[[0.1357, 0.6494], [0.388, 0.2242]], [[0.2272, 0.5742], [0.5749, 0.1118]]]]])
in0Con32074 = tf.constant([[[0.0685, 0.5015, 0.8886, 0.4235, 0.0181, 0.7478, 0.7638], [0.4864, 0.3805, 0.1113, 0.6204, 0.5552, 0.6602, 0.7704]]])
in0Add48378 = tf.constant([[[0.4167], [0.0613]]])
in1Add48378 = tf.constant([[[0.8028], [0.9661]]])
print (np.array2string(model.predict([in0Max98027,in1Max98027,in0Con32074,in0Add48378,in1Add48378],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot87378.png')

LMax98027 = maximum_layer([[[[[[0.773, 0.8616], [0.546, 0.8395]], [[0.7342, 0.6349], [0.397, 0.2572]]], [[[0.0294, 0.9397], [0.6628, 0.8926]], [[0.96, 0.7413], [0.3797, 0.6999]]]]], [[[[[0.9434, 0.7042], [0.287, 0.4098]], [[0.1967, 0.9164], [0.8301, 0.5952]]], [[[0.1357, 0.6494], [0.388, 0.2242]], [[0.2272, 0.5742], [0.5749, 0.1118]]]]]], Max98027), 
LRes90011 = reshape_layer(Max98027, [2, 2, 4], Res90011), 
LRes51358 = reshape_layer(Res90011, [2, 8], Res51358), 
LCon32074 = concatenate_layer([Res51358,[[[0.0685, 0.5015, 0.8886, 0.4235, 0.0181, 0.7478, 0.7638], [0.4864, 0.3805, 0.1113, 0.6204, 0.5552, 0.6602, 0.7704]]]], 2, Con32074), 
LAdd48378 = add_layer([[[[0.4167], [0.0613]]], [[[0.8028], [0.9661]]]], Add48378), 
LDot87378 = dot_layer(Con32074,Add48378, 1, 1, Dot87378), 
exec_layers([LMax98027,LRes90011,LRes51358,LCon32074,LAdd48378,LDot87378],["Max98027","Res90011","Res51358","Con32074","Add48378","Dot87378"],Dot87378,"Dot87378")

Actual (Unparsed): [[[1.2898945], [2.0161689], [1.3468077], [1.9408275], [1.8816609], [1.8791614], [1.6029592], [1.4449236], [0.5832631], [1.0025049], [1.1979973], [1.1538572], [0.5924854], [1.5902316], [1.7229631]]]

Expected (Unparsed): [[[1.28989448],[2.0161689799999998],[1.34680772],[1.94082749],[1.8816609],[1.8791614199999997],[1.6029592099999999],[1.4449236599999997],[0.58326311],[1.0025049499999998],[1.19799732],[1.15385721],[0.59248543],[1.59023158],[1.7229630599999999]]]

Actual:   [[[1.2899], [2.0162], [1.3469], [1.9409], [1.8817], [1.8792], [1.603], [1.445], [0.5833], [1.0026], [1.198], [1.1539], [0.5925], [1.5903], [1.723]]]

Expected: [[[1.2899], [2.0162], [1.3469], [1.9409], [1.8817], [1.8792], [1.603], [1.445], [0.5833], [1.0026], [1.198], [1.1539], [0.5925], [1.5903], [1.723]]]