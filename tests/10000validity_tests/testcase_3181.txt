import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Zer16610 = tf.keras.layers.Input(shape=([4, 3, 2, 1]))
in0Con98470 = tf.keras.layers.Input(shape=([5, 2]))
in0Mul44634 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Mul44634 = tf.keras.layers.Input(shape=([2, 1, 1]))

Zer16610 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer16610', )(in0Zer16610)
Res10442 = keras.layers.Reshape((6, 5, 4), name = 'Res10442', )(Zer16610)
Res28436 = keras.layers.Reshape((6, 20), name = 'Res28436', )(Res10442)
Res32104 = keras.layers.Reshape((6, 20, 1), name = 'Res32104', )(Res28436)
Con71987 = keras.layers.Conv2DTranspose(2, (4, 18),strides=(1, 1), padding='same', name = 'Con71987', )(Res32104)
Res3096 = keras.layers.Reshape((6, 20, 2, 1), name = 'Res3096', )(Con71987)
Con25231 = keras.layers.Conv3D(3, (2, 14, 2),strides=(1, 12, 2), padding='valid', dilation_rate=(1, 1, 1), name = 'Con25231', )(Res3096)
Res95492 = keras.layers.Reshape((5, 1, 3), name = 'Res95492', )(Con25231)
Res21013 = keras.layers.Reshape((5, 3), name = 'Res21013', )(Res95492)
Con98470 = keras.layers.Concatenate(axis=2, name = 'Con98470', )([Res21013,in0Con98470])
Mul44634 = keras.layers.Multiply(name = 'Mul44634', )([in0Mul44634,in1Mul44634])
Res8182 = keras.layers.Reshape((2, 1), name = 'Res8182', )(Mul44634)
Zer83873 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer83873', )(Res8182)
Dot9340 = keras.layers.Dot(axes=(1, 1), name = 'Dot9340', )([Con98470,Zer83873])
model = tf.keras.models.Model(inputs=[in0Zer16610,in0Con98470,in0Mul44634,in1Mul44634], outputs=Dot9340)
w = model.get_layer('Con71987').get_weights() 
w[0] = np.array([[[[0.1971], [0.758]], [[0.8661], [0.6259]], [[0.0902], [0.5063]], [[0.9114], [0.6916]], [[0.1891], [0.5199]], [[0.2679], [0.6288]], [[0.7701], [0.7589]], [[0.0864], [0.992]], [[0.3056], [0.397]], [[0.2339], [0.3695]], [[0.8517], [0.2412]], [[0.8163], [0.5882]], [[0.1489], [0.7471]], [[0.9686], [0.3295]], [[0.4233], [0.5993]], [[0.895], [0.8176]], [[0.1526], [0.5515]], [[0.6187], [0.2861]]], [[[0.9955], [0.8524]], [[0.5445], [0.3915]], [[0.6767], [0.117]], [[0.7273], [0.6039]], [[0.8628], [0.9465]], [[0.6898], [0.8769]], [[0.9704], [0.949]], [[0.7419], [0.5751]], [[0.4069], [0.0672]], [[0.015], [0.7207]], [[0.9597], [0.2811]], [[0.8425], [0.1098]], [[0.9212], [0.8211]], [[0.6957], [0.7441]], [[0.0674], [0.0001]], [[0.6131], [0.3272]], [[0.7897], [0.6525]], [[0.9507], [0.2804]]], [[[0.5221], [0.9565]], [[0.3234], [0.8482]], [[0.103], [0.1056]], [[0.8088], [0.385]], [[0.8631], [0.8959]], [[0.8411], [0.8399]], [[0.0417], [0.7987]], [[0.7344], [0.7903]], [[0.5986], [0.5022]], [[0.4451], [0.1138]], [[0.611], [0.2198]], [[0.0076], [0.534]], [[0.2241], [0.2887]], [[0.058], [0.8271]], [[0.5571], [0.7112]], [[0.0015], [0.4344]], [[0.0581], [0.3276]], [[0.6675], [0.5894]]], [[[0.5487], [0.2527]], [[0.7533], [0.8402]], [[0.6015], [0.0539]], [[0.9575], [0.0237]], [[0.9542], [0.9086]], [[0.4721], [0.3295]], [[0.3789], [0.6336]], [[0.4168], [0.085]], [[0.7983], [0.0521]], [[0.8784], [0.2837]], [[0.4679], [0.6341]], [[0.4457], [0.6843]], [[0.7285], [0.728]], [[0.5209], [0.5134]], [[0.1737], [0.9846]], [[0.2308], [0.4217]], [[0.0746], [0.7708]], [[0.4628], [0.3605]]]])
w[1] = np.array([0, 0])
model.get_layer('Con71987').set_weights(w) 
w = model.get_layer('Con25231').get_weights() 
w[0] = np.array([[[[[0.9598, 0.6544, 0.3698]], [[0.1991, 0.5382, 0.3988]]], [[[0.9853, 0.5733, 0.2708]], [[0.1795, 0.1538, 0.7123]]], [[[0.0707, 0.3185, 0.1591]], [[0.1764, 0.2717, 0.2823]]], [[[0.5789, 0.7456, 0.4797]], [[0.6674, 0.7235, 0.0318]]], [[[0.3191, 0.0765, 0.9724]], [[0.3428, 0.2922, 0.0082]]], [[[0.7332, 0.3345, 0.459]], [[0.7519, 0.8139, 0.5678]]], [[[0.5381, 0.8139, 0.9737]], [[0.8126, 0.3357, 0.5791]]], [[[0.2971, 0.8352, 0.1122]], [[0.7578, 0.823, 0.4434]]], [[[0.6143, 0.6624, 0.5509]], [[0.768, 0.0197, 0.5123]]], [[[0.5479, 0.1137, 0.9672]], [[0.7743, 0.3826, 0.2265]]], [[[0.1802, 0.0139, 0.5233]], [[0.4916, 0.9278, 0.8518]]], [[[0.6581, 0.4038, 0.7171]], [[0.4003, 0.1132, 0.6311]]], [[[0.1587, 0.9888, 0.681]], [[0.132, 0.9064, 0.0773]]], [[[0.2013, 0.079, 0.9381]], [[0.0049, 0.184, 0.7937]]]], [[[[0.2124, 0.623, 0.6095]], [[0.502, 0.9142, 0.9231]]], [[[0.7969, 0.4833, 0.0858]], [[0.4844, 0.8933, 0.1055]]], [[[0.4274, 0.9385, 0.1031]], [[0.3124, 0.4487, 0.6767]]], [[[0.2506, 0.3624, 0.9527]], [[0.7108, 0.6489, 0.0045]]], [[[0.0436, 0.9385, 0.5343]], [[0.8219, 0.4618, 0.0607]]], [[[0.5183, 0.173, 0.0722]], [[0.0534, 0.606, 0.0177]]], [[[0.7569, 0.4045, 0.3375]], [[0.9268, 0.7984, 0.2925]]], [[[0.5182, 0.745, 0.0754]], [[0.5071, 0.8206, 0.6988]]], [[[0.0432, 0.1865, 0.2657]], [[0.2264, 0.518, 0.3867]]], [[[0.2216, 0.4411, 0.7459]], [[0.0828, 0.0912, 0.9354]]], [[[0.0996, 0.4525, 0.3054]], [[0.5821, 0.0173, 0.1968]]], [[[0.5867, 0.0974, 0.4745]], [[0.2074, 0.7004, 0.3892]]], [[[0.3623, 0.1124, 0.0764]], [[0.1386, 0.6366, 0.0985]]], [[[0.7467, 0.6325, 0.9952]], [[0.9397, 0.0213, 0.6003]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con25231').set_weights(w) 
in0Zer16610 = tf.constant([[[[[1.5509], [1.6661]], [[1.2297], [1.9164]], [[1.2577], [1.6594]]], [[[1.2455], [1.7109]], [[1.2613], [1.4872]], [[1.3156], [1.2856]]], [[[1.3183], [1.7132]], [[1.381], [1.2681]], [[1.9514], [1.3189]]], [[[1.9763], [1.9312]], [[1.9051], [1.6544]], [[1.3744], [1.8449]]]]])
in0Con98470 = tf.constant([[[0.8599, 0.0671], [0.0858, 0.5322], [0.2681, 0.6196], [0.2335, 0.2305], [0.9195, 0.503]]])
in0Mul44634 = tf.constant([[[[0.3276]], [[0.7692]]]])
in1Mul44634 = tf.constant([[[[0.7904]], [[0.3469]]]])
print (np.array2string(model.predict([in0Zer16610,in0Con98470,in0Mul44634,in1Mul44634],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot9340.png')

LZer16610 = zero_padding3D_layer([[[[[1.5509], [1.6661]], [[1.2297], [1.9164]], [[1.2577], [1.6594]]], [[[1.2455], [1.7109]], [[1.2613], [1.4872]], [[1.3156], [1.2856]]], [[[1.3183], [1.7132]], [[1.381], [1.2681]], [[1.9514], [1.3189]]], [[[1.9763], [1.9312]], [[1.9051], [1.6544]], [[1.3744], [1.8449]]]]], 1, 1, 1, 1, 1, 1, Zer16610), 
LRes10442 = reshape_layer(Zer16610, [6, 5, 4], Res10442), 
LRes28436 = reshape_layer(Res10442, [6, 20], Res28436), 
LRes32104 = reshape_layer(Res28436, [6, 20, 1], Res32104), 
LCon71987 = conv2D_transpose_layer(Res32104, 4, 18,[[[[0.1971], [0.758]], [[0.8661], [0.6259]], [[0.0902], [0.5063]], [[0.9114], [0.6916]], [[0.1891], [0.5199]], [[0.2679], [0.6288]], [[0.7701], [0.7589]], [[0.0864], [0.992]], [[0.3056], [0.397]], [[0.2339], [0.3695]], [[0.8517], [0.2412]], [[0.8163], [0.5882]], [[0.1489], [0.7471]], [[0.9686], [0.3295]], [[0.4233], [0.5993]], [[0.895], [0.8176]], [[0.1526], [0.5515]], [[0.6187], [0.2861]]], [[[0.9955], [0.8524]], [[0.5445], [0.3915]], [[0.6767], [0.117]], [[0.7273], [0.6039]], [[0.8628], [0.9465]], [[0.6898], [0.8769]], [[0.9704], [0.949]], [[0.7419], [0.5751]], [[0.4069], [0.0672]], [[0.015], [0.7207]], [[0.9597], [0.2811]], [[0.8425], [0.1098]], [[0.9212], [0.8211]], [[0.6957], [0.7441]], [[0.0674], [0.0001]], [[0.6131], [0.3272]], [[0.7897], [0.6525]], [[0.9507], [0.2804]]], [[[0.5221], [0.9565]], [[0.3234], [0.8482]], [[0.103], [0.1056]], [[0.8088], [0.385]], [[0.8631], [0.8959]], [[0.8411], [0.8399]], [[0.0417], [0.7987]], [[0.7344], [0.7903]], [[0.5986], [0.5022]], [[0.4451], [0.1138]], [[0.611], [0.2198]], [[0.0076], [0.534]], [[0.2241], [0.2887]], [[0.058], [0.8271]], [[0.5571], [0.7112]], [[0.0015], [0.4344]], [[0.0581], [0.3276]], [[0.6675], [0.5894]]], [[[0.5487], [0.2527]], [[0.7533], [0.8402]], [[0.6015], [0.0539]], [[0.9575], [0.0237]], [[0.9542], [0.9086]], [[0.4721], [0.3295]], [[0.3789], [0.6336]], [[0.4168], [0.085]], [[0.7983], [0.0521]], [[0.8784], [0.2837]], [[0.4679], [0.6341]], [[0.4457], [0.6843]], [[0.7285], [0.728]], [[0.5209], [0.5134]], [[0.1737], [0.9846]], [[0.2308], [0.4217]], [[0.0746], [0.7708]], [[0.4628], [0.3605]]]],[0, 0], 1, 1, true, Con71987), 
LRes3096 = reshape_layer(Con71987, [6, 20, 2, 1], Res3096), 
LCon25231 = conv3D_layer(Res3096, 2, 14, 2,[[[[[0.9598, 0.6544, 0.3698]], [[0.1991, 0.5382, 0.3988]]], [[[0.9853, 0.5733, 0.2708]], [[0.1795, 0.1538, 0.7123]]], [[[0.0707, 0.3185, 0.1591]], [[0.1764, 0.2717, 0.2823]]], [[[0.5789, 0.7456, 0.4797]], [[0.6674, 0.7235, 0.0318]]], [[[0.3191, 0.0765, 0.9724]], [[0.3428, 0.2922, 0.0082]]], [[[0.7332, 0.3345, 0.459]], [[0.7519, 0.8139, 0.5678]]], [[[0.5381, 0.8139, 0.9737]], [[0.8126, 0.3357, 0.5791]]], [[[0.2971, 0.8352, 0.1122]], [[0.7578, 0.823, 0.4434]]], [[[0.6143, 0.6624, 0.5509]], [[0.768, 0.0197, 0.5123]]], [[[0.5479, 0.1137, 0.9672]], [[0.7743, 0.3826, 0.2265]]], [[[0.1802, 0.0139, 0.5233]], [[0.4916, 0.9278, 0.8518]]], [[[0.6581, 0.4038, 0.7171]], [[0.4003, 0.1132, 0.6311]]], [[[0.1587, 0.9888, 0.681]], [[0.132, 0.9064, 0.0773]]], [[[0.2013, 0.079, 0.9381]], [[0.0049, 0.184, 0.7937]]]], [[[[0.2124, 0.623, 0.6095]], [[0.502, 0.9142, 0.9231]]], [[[0.7969, 0.4833, 0.0858]], [[0.4844, 0.8933, 0.1055]]], [[[0.4274, 0.9385, 0.1031]], [[0.3124, 0.4487, 0.6767]]], [[[0.2506, 0.3624, 0.9527]], [[0.7108, 0.6489, 0.0045]]], [[[0.0436, 0.9385, 0.5343]], [[0.8219, 0.4618, 0.0607]]], [[[0.5183, 0.173, 0.0722]], [[0.0534, 0.606, 0.0177]]], [[[0.7569, 0.4045, 0.3375]], [[0.9268, 0.7984, 0.2925]]], [[[0.5182, 0.745, 0.0754]], [[0.5071, 0.8206, 0.6988]]], [[[0.0432, 0.1865, 0.2657]], [[0.2264, 0.518, 0.3867]]], [[[0.2216, 0.4411, 0.7459]], [[0.0828, 0.0912, 0.9354]]], [[[0.0996, 0.4525, 0.3054]], [[0.5821, 0.0173, 0.1968]]], [[[0.5867, 0.0974, 0.4745]], [[0.2074, 0.7004, 0.3892]]], [[[0.3623, 0.1124, 0.0764]], [[0.1386, 0.6366, 0.0985]]], [[[0.7467, 0.6325, 0.9952]], [[0.9397, 0.0213, 0.6003]]]]],[0, 0, 0], 1, 12, 2, false, 1, 1, 1, Con25231), 
LRes95492 = reshape_layer(Con25231, [5, 1, 3], Res95492), 
LRes21013 = reshape_layer(Res95492, [5, 3], Res21013), 
LCon98470 = concatenate_layer([Res21013,[[[0.8599, 0.0671], [0.0858, 0.5322], [0.2681, 0.6196], [0.2335, 0.2305], [0.9195, 0.503]]]], 2, Con98470), 
LMul44634 = multiply_layer([[[[[0.3276]], [[0.7692]]]], [[[[0.7904]], [[0.3469]]]]], Mul44634), 
LRes8182 = reshape_layer(Mul44634, [2, 1], Res8182), 
LZer83873 = zero_padding1D_layer(Res8182, 3, 0, Zer83873), 
LDot9340 = dot_layer(Con98470,Zer83873, 1, 1, Dot9340), 
exec_layers([LZer16610,LRes10442,LRes28436,LRes32104,LCon71987,LRes3096,LCon25231,LRes95492,LRes21013,LCon98470,LMul44634,LRes8182,LZer83873,LDot9340],["Zer16610","Res10442","Res28436","Res32104","Con71987","Res3096","Con25231","Res95492","Res21013","Con98470","Mul44634","Res8182","Zer83873","Dot9340"],Dot9340,"Dot9340")

Actual (Unparsed): [[[174.9309687], [181.1121844], [178.6903017], [0.3058166], [0.1939028]]]

Expected (Unparsed): [[[174.93096467956963],[181.11218023328237],[178.69029765641088],[0.3058165557],[0.19390277315999999]]]

Actual:   [[[174.931], [181.1122], [178.6904], [0.3059], [0.194]]]

Expected: [[[174.931], [181.1122], [178.6903], [0.3059], [0.194]]]