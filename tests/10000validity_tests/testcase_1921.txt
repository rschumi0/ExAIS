import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add95205 = tf.keras.layers.Input(shape=([2, 1]))
in1Add95205 = tf.keras.layers.Input(shape=([2, 1]))
in0Ave89606 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Ave89606 = tf.keras.layers.Input(shape=([2, 2, 2]))

Add95205 = keras.layers.Add(name = 'Add95205', )([in0Add95205,in1Add95205])
Den34721 = keras.layers.Dense(1,name = 'Den34721', )(Add95205)
Fla1575 = keras.layers.Flatten(name = 'Fla1575', )(Den34721)
Ave89606 = keras.layers.Average(name = 'Ave89606', )([in0Ave89606,in1Ave89606])
Glo36680 = keras.layers.GlobalAveragePooling2D(name = 'Glo36680', )(Ave89606)
Ave72583 = keras.layers.Average(name = 'Ave72583', )([Fla1575,Glo36680])
Res15854 = keras.layers.Reshape((2, 1), name = 'Res15854', )(Ave72583)
Res81924 = keras.layers.Reshape((2, 1, 1), name = 'Res81924', )(Res15854)
Loc53542 = keras.layers.LocallyConnected2D(4, (1, 1),strides=(1, 1), name = 'Loc53542', )(Res81924)
model = tf.keras.models.Model(inputs=[in0Add95205,in1Add95205,in0Ave89606,in1Ave89606], outputs=Loc53542)
w = model.get_layer('Den34721').get_weights() 
w[0] = np.array([[0.8993]])
w[1] = np.array([0.0665])
model.get_layer('Den34721').set_weights(w) 
w = model.get_layer('Loc53542').get_weights() 
w[0] = np.array([[[0.6419, 0.7683, 0.139, 0.4687]], [[0.6561, 0.7643, 0.663, 0.8439]]])
w[1] = np.array([[[0, 0, 0, 0]], [[0, 0, 0, 0]]])
model.get_layer('Loc53542').set_weights(w) 
in0Add95205 = tf.constant([[[0.9167], [0.9238]]])
in1Add95205 = tf.constant([[[0.7839], [0.8933]]])
in0Ave89606 = tf.constant([[[[0.1869, 0.4044], [0.0756, 0.4939]], [[0.4376, 0.843], [0.8178, 0.4807]]]])
in1Ave89606 = tf.constant([[[[0.8191, 0.6918], [0.3213, 0.3997]], [[0.4985, 0.125], [0.8926, 0.0036]]]])
print (np.array2string(model.predict([in0Add95205,in1Add95205,in0Ave89606,in1Ave89606],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc53542.png')

LAdd95205 = add_layer([[[[0.9167], [0.9238]]], [[[0.7839], [0.8933]]]], Add95205), 
LDen34721 = dense_layer(Add95205, [[0.8993]],[0.0665], Den34721), 
LFla1575 = flatten_layer(Den34721, Fla1575), 
LAve89606 = average_layer([[[[[0.1869, 0.4044], [0.0756, 0.4939]], [[0.4376, 0.843], [0.8178, 0.4807]]]], [[[[0.8191, 0.6918], [0.3213, 0.3997]], [[0.4985, 0.125], [0.8926, 0.0036]]]]], Ave89606), 
LGlo36680 = global_average_pooling2D_layer(Ave89606, Glo36680), 
LAve72583 = average_layer([Fla1575,Glo36680], Ave72583), 
LRes15854 = reshape_layer(Ave72583, [2, 1], Res15854), 
LRes81924 = reshape_layer(Res15854, [2, 1, 1], Res81924), 
LLoc53542 = locally_connected2D_layer(Res81924, 1, 1,[[[0.6419, 0.7683, 0.139, 0.4687]], [[0.6561, 0.7643, 0.663, 0.8439]]],[[[0, 0, 0, 0]], [[0, 0, 0, 0]]], 1, 1, Loc53542), 
exec_layers([LAdd95205,LDen34721,LFla1575,LAve89606,LGlo36680,LAve72583,LRes15854,LRes81924,LLoc53542],["Add95205","Den34721","Fla1575","Ave89606","Glo36680","Ave72583","Res15854","Res81924","Loc53542"],Loc53542,"Loc53542")

Actual (Unparsed): [[[[0.6746448, 0.8074928, 0.1460907, 0.4926095]], [[0.6990354, 0.8143160, 0.7063869, 0.8991250]]]]

Expected (Unparsed): [[[[0.6746447889510001,0.8074927424070001,0.14609070831,0.492609460323]],[[0.6990353578665,0.8143159945394999,0.7063868956949999,0.8991250396334999]]]]

Actual:   [[[[0.6747, 0.8075, 0.1461, 0.4927]], [[0.6991, 0.8144, 0.7064, 0.8992]]]]

Expected: [[[[0.6747, 0.8075, 0.1461, 0.4927]], [[0.6991, 0.8144, 0.7064, 0.8992]]]]