import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con44717 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Add30168 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Add30168 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))

Con44717 = keras.layers.Conv2D(2, (1, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con44717', )(in0Con44717)
Fla83076 = keras.layers.Flatten(name = 'Fla83076', )(Con44717)
Res11299 = keras.layers.Reshape((4, 1), name = 'Res11299', )(Fla83076)
Res56942 = keras.layers.Reshape((4, 1, 1), name = 'Res56942', )(Res11299)
Res75917 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res75917', )(Res56942)
Zer13867 = keras.layers.ZeroPadding3D(padding=((1, 0), (2, 0), (2, 0)), name = 'Zer13867', )(Res75917)
Add30168 = keras.layers.Add(name = 'Add30168', )([in0Add30168,in1Add30168])
Res5249 = keras.layers.Reshape((1, 2, 2), name = 'Res5249', )(Add30168)
Res8675 = keras.layers.Reshape((1, 4), name = 'Res8675', )(Res5249)
Sim41560 = keras.layers.SimpleRNN(1,name = 'Sim41560', )(Res8675)
Res28167 = keras.layers.Reshape((1, 1), name = 'Res28167', )(Sim41560)
GRU9187 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU9187', )(Res28167)
Res85939 = keras.layers.Reshape((3, 1), name = 'Res85939', )(GRU9187)
Res8645 = keras.layers.Reshape((3, 1, 1), name = 'Res8645', )(Res85939)
Res80179 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res80179', )(Res8645)
Zer29257 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer29257', )(Res80179)
Max65165 = keras.layers.Maximum(name = 'Max65165', )([Zer13867,Zer29257])
model = tf.keras.models.Model(inputs=[in0Con44717,in0Add30168,in1Add30168], outputs=Max65165)
w = model.get_layer('Con44717').get_weights() 
w[0] = np.array([[[[0.1414, 0.721]]]])
w[1] = np.array([0, 0])
model.get_layer('Con44717').set_weights(w) 
w = model.get_layer('Sim41560').get_weights() 
w[0] = np.array([[5], [5], [1], [4]])
w[1] = np.array([[5]])
w[2] = np.array([6])
model.get_layer('Sim41560').set_weights(w) 
w = model.get_layer('GRU9187').get_weights() 
w[0] = np.array([[5, 3, 2, 6, 5, 7, 6, 3, 2]])
w[1] = np.array([[3, 3, 9, 6, 7, 5, 1, 7, 4], [7, 10, 9, 7, 7, 9, 6, 7, 2], [8, 4, 10, 2, 8, 4, 2, 4, 6]])
w[2] = np.array([4, 9, 10, 8, 10, 3, 1, 5, 1])
model.get_layer('GRU9187').set_weights(w) 
in0Con44717 = tf.constant([[[[0.7114]], [[0.8003]]]])
in0Add30168 = tf.constant([[[[[0.5087], [0.8984]], [[0.969], [0.1919]]]]])
in1Add30168 = tf.constant([[[[[0.4311], [0.5993]], [[0.2976], [0.1148]]]]])
print (np.array2string(model.predict([in0Con44717,in0Add30168,in1Add30168],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max65165.png')

LCon44717 = conv2D_layer([[[[0.7114]], [[0.8003]]]], 1, 1,[[[[0.1414, 0.721]]]],[0, 0], 1, 1, false, 1, 1, Con44717), 
LFla83076 = flatten_layer(Con44717, Fla83076), 
LRes11299 = reshape_layer(Fla83076, [4, 1], Res11299), 
LRes56942 = reshape_layer(Res11299, [4, 1, 1], Res56942), 
LRes75917 = reshape_layer(Res56942, [4, 1, 1, 1], Res75917), 
LZer13867 = zero_padding3D_layer(Res75917, 1, 0, 2, 0, 2, 0, Zer13867), 
LAdd30168 = add_layer([[[[[[0.5087], [0.8984]], [[0.969], [0.1919]]]]], [[[[[0.4311], [0.5993]], [[0.2976], [0.1148]]]]]], Add30168), 
LRes5249 = reshape_layer(Add30168, [1, 2, 2], Res5249), 
LRes8675 = reshape_layer(Res5249, [1, 4], Res8675), 
LSim41560 = simple_rnn_layer(Res8675,[[5], [5], [1], [4]],[[5]],[6], Sim41560), 
LRes28167 = reshape_layer(Sim41560, [1, 1], Res28167), 
LGRU9187 = gru_layer(Res28167,[[5, 3, 2, 6, 5, 7, 6, 3, 2]],[[3, 3, 9, 6, 7, 5, 1, 7, 4], [7, 10, 9, 7, 7, 9, 6, 7, 2], [8, 4, 10, 2, 8, 4, 2, 4, 6]],[4, 9, 10, 8, 10, 3, 1, 5, 1], false, GRU9187), 
LRes85939 = reshape_layer(GRU9187, [3, 1], Res85939), 
LRes8645 = reshape_layer(Res85939, [3, 1, 1], Res8645), 
LRes80179 = reshape_layer(Res8645, [3, 1, 1, 1], Res80179), 
LZer29257 = zero_padding3D_layer(Res80179, 1, 1, 1, 1, 1, 1, Zer29257), 
LMax65165 = maximum_layer([Zer13867,Zer29257], Max65165), 
exec_layers([LCon44717,LFla83076,LRes11299,LRes56942,LRes75917,LZer13867,LAdd30168,LRes5249,LRes8675,LSim41560,LRes28167,LGRU9187,LRes85939,LRes8645,LRes80179,LZer29257,LMax65165],["Con44717","Fla83076","Res11299","Res56942","Res75917","Zer13867","Add30168","Res5249","Res8675","Sim41560","Res28167","GRU9187","Res85939","Res8645","Res80179","Zer29257","Max65165"],Max65165,"Max65165")

Actual (Unparsed): [[[[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0001234], [0.0000000]], [[0.0000000], [0.0000000], [0.1005920]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000061], [0.0000000]], [[0.0000000], [0.0000000], [0.5129194]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000061], [0.0000000]], [[0.0000000], [0.0000000], [0.1131624]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.5770163]]]]]

Expected (Unparsed): [[[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]]],[[[0],[0],[0]],[[0],[0.0001233943707742163],[0]],[[0],[0],[0.10059196000000001]]],[[[0],[0],[0]],[[0],[6.144173219335917e-6],[0]],[[0],[0],[0.5129194]]],[[[0],[0],[0]],[[0],[6.113790145407636e-6],[0]],[[0],[0],[0.11316242]]],[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0.5770163]]]]]

Actual:   [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0.0002], [0]], [[0], [0], [0.1006]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0.513]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0.1132]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0.5771]]]]]

Expected: [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0.0002], [0]], [[0], [0], [0.1006]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0.513]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0.1132]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0.5771]]]]]