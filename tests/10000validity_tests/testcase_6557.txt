import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dep38403 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con63385 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Sub12427 = tf.keras.layers.Input(shape=([3, 3, 2]))
in1Sub12427 = tf.keras.layers.Input(shape=([3, 3, 2]))

Dep38403 = keras.layers.DepthwiseConv2D((2, 2),strides=(1, 1), padding='same', name = 'Dep38403', )(in0Dep38403)
Zer22851 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer22851', )(Dep38403)
Con63385 = keras.layers.Concatenate(axis=3, name = 'Con63385', )([Zer22851,in0Con63385])
Sub12427 = keras.layers.Subtract(name = 'Sub12427', )([in0Sub12427,in1Sub12427])
Lay71234 = keras.layers.LayerNormalization(axis=1, epsilon=1.9599512338323315, name = 'Lay71234', )(Sub12427)
Sub55988 = keras.layers.Subtract(name = 'Sub55988', )([Con63385,Lay71234])
model = tf.keras.models.Model(inputs=[in0Dep38403,in0Con63385,in0Sub12427,in1Sub12427], outputs=Sub55988)
w = model.get_layer('Dep38403').get_weights() 
w[0] = np.array([[[[0.3965]], [[0.8464]]], [[[0.2901]], [[0.0329]]]])
w[1] = np.array([0])
model.get_layer('Dep38403').set_weights(w) 
in0Dep38403 = tf.constant([[[[0.0632], [0.2833]], [[0.9067], [0.3064]]]])
in0Con63385 = tf.constant([[[[0.5592], [0.5588], [0.2216]], [[0.2078], [0.2002], [0.1853]], [[0.7651], [0.5418], [0.2358]]]])
in0Sub12427 = tf.constant([[[[0.0107, 0.926], [0.7058, 0.001], [0.8138, 0.4227]], [[0.0863, 0.2089], [0.9886, 0.4681], [0.0005, 0.3454]], [[0.4451, 0.2336], [0.2659, 0.9603], [0.2962, 0.7069]]]])
in1Sub12427 = tf.constant([[[[0.5596, 0.0865], [0.4313, 0.0078], [0.0074, 0.717]], [[0.4929, 0.1741], [0.5273, 0.7531], [0.1295, 0.1175]], [[0.8353, 0.1199], [0.9155, 0.199], [0.5563, 0.1284]]]])
print (np.array2string(model.predict([in0Dep38403,in0Con63385,in0Sub12427,in1Sub12427],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub55988.png')

LDep38403 = depthwise_conv2D_layer([[[[0.0632], [0.2833]], [[0.9067], [0.3064]]]], 2, 2,[[[[0.3965]], [[0.8464]]], [[[0.2901]], [[0.0329]]]],[0], 1, 1, true, Dep38403), 
LZer22851 = zero_padding2D_layer(Dep38403, 1, 0, 1, 0, Zer22851), 
LCon63385 = concatenate_layer([Zer22851,[[[[0.5592], [0.5588], [0.2216]], [[0.2078], [0.2002], [0.1853]], [[0.7651], [0.5418], [0.2358]]]]], 3, Con63385), 
LSub12427 = subtract_layer([[[[0.0107, 0.926], [0.7058, 0.001], [0.8138, 0.4227]], [[0.0863, 0.2089], [0.9886, 0.4681], [0.0005, 0.3454]], [[0.4451, 0.2336], [0.2659, 0.9603], [0.2962, 0.7069]]]], [[[[0.5596, 0.0865], [0.4313, 0.0078], [0.0074, 0.717]], [[0.4929, 0.1741], [0.5273, 0.7531], [0.1295, 0.1175]], [[0.8353, 0.1199], [0.9155, 0.199], [0.5563, 0.1284]]]], Sub12427), 
LLay71234 = layer_normalization_layer(Sub12427, 1, 1.9599512338323315, Lay71234), 
LSub55988 = subtract_layer(Con63385,Lay71234, Sub55988), 
exec_layers([LDep38403,LZer22851,LCon63385,LSub12427,LLay71234,LSub55988],["Dep38403","Zer22851","Con63385","Sub12427","Lay71234","Sub55988"],Sub55988,"Sub55988")

Actual (Unparsed): [[[[0.0715749, 0.2064052], [-0.1658529, 0.6700213], [-0.4513876, 0.5433588]], [[-0.0299378, 0.4114782], [0.2460453, 0.5008992], [0.3825683, 0.1457202]], [[-0.0416371, 0.9142166], [1.0766093, 0.1298795], [0.3915220, -0.0463790]]]]

Expected (Unparsed): [[[[0.07157489328241323,0.206405172959636],[-0.1658529222574085,0.6700212565105802],[-0.45138762932442017,0.543358824507148]],[[-0.029937804200185533,0.41147821572875903],[0.2460453096182842,0.5008992330031915],[0.3825683395457471,0.14572020481331427]],[[-0.041637089082227824,0.914216611311605],[1.0766092726391243,0.1298795104862282],[0.3915219797786731,-0.04637902932046234]]]]

Actual:   [[[[0.0716, 0.2065], [-0.1658, 0.6701], [-0.4513, 0.5434]], [[-0.0299, 0.4115], [0.2461, 0.5009], [0.3826, 0.1458]], [[-0.0416, 0.9143], [1.0767, 0.1299], [0.3916, -0.0463]]]]

Expected: [[[[0.0716, 0.2065], [-0.1658, 0.6701], [-0.4513, 0.5434]], [[-0.0299, 0.4115], [0.2461, 0.5009], [0.3826, 0.1458]], [[-0.0416, 0.9143], [1.0767, 0.1299], [0.3916, -0.0463]]]]