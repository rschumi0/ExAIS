import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max1584 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Dot68310 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot68310 = tf.keras.layers.Input(shape=([2, 2]))
in0Ave29932 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave29932 = tf.keras.layers.Input(shape=([1, 2]))

Max1584 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max1584', )(in0Max1584)
Res58146 = keras.layers.Reshape((1, 2), name = 'Res58146', )(Max1584)
Zer57651 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer57651', )(Res58146)
Dot68310 = keras.layers.Dot(axes=(2, 1), name = 'Dot68310', )([in0Dot68310,in1Dot68310])
Sub38418 = keras.layers.Subtract(name = 'Sub38418', )([Zer57651,Dot68310])
Res42444 = keras.layers.Reshape((2, 2, 1), name = 'Res42444', )(Sub38418)
Ave29932 = keras.layers.Average(name = 'Ave29932', )([in0Ave29932,in1Ave29932])
Res12808 = keras.layers.Reshape((1, 2, 1), name = 'Res12808', )(Ave29932)
Cro37684 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro37684', )(Res12808)
Zer43425 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer43425', )(Cro37684)
Ave47088 = keras.layers.Average(name = 'Ave47088', )([Res42444,Zer43425])
model = tf.keras.models.Model(inputs=[in0Max1584,in0Dot68310,in1Dot68310,in0Ave29932,in1Ave29932], outputs=Ave47088)
in0Max1584 = tf.constant([[[[1.2637, 1.8471]]]])
in0Dot68310 = tf.constant([[[0.022, 0.5116], [0.9841, 0.8055]]])
in1Dot68310 = tf.constant([[[0.4728, 0.7287], [0.0209, 0.265]]])
in0Ave29932 = tf.constant([[[0.307, 0.4587]]])
in1Ave29932 = tf.constant([[[0.4462, 0.9864]]])
print (np.array2string(model.predict([in0Max1584,in0Dot68310,in1Dot68310,in0Ave29932,in1Ave29932],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave47088.png')

LMax1584 = max_pool2D_layer([[[[1.2637, 1.8471]]]], 1, 1, Max1584), 
LRes58146 = reshape_layer(Max1584, [1, 2], Res58146), 
LZer57651 = zero_padding1D_layer(Res58146, 1, 0, Zer57651), 
LDot68310 = dot_layer([[[0.022, 0.5116], [0.9841, 0.8055]]], [[[0.4728, 0.7287], [0.0209, 0.265]]], 2, 1, Dot68310), 
LSub38418 = subtract_layer(Zer57651,Dot68310, Sub38418), 
LRes42444 = reshape_layer(Sub38418, [2, 2, 1], Res42444), 
LAve29932 = average_layer([[[[0.307, 0.4587]]], [[[0.4462, 0.9864]]]], Ave29932), 
LRes12808 = reshape_layer(Ave29932, [1, 2, 1], Res12808), 
LCro37684 = cropping2D_layer(Res12808, 0, 0, 0, 0, Cro37684), 
LZer43425 = zero_padding2D_layer(Cro37684, 1, 0, 0, 0, Zer43425), 
LAve47088 = average_layer([Res42444,Zer43425], Ave47088), 
exec_layers([LMax1584,LRes58146,LZer57651,LDot68310,LSub38418,LRes42444,LAve29932,LRes12808,LCro37684,LZer43425,LAve47088],["Max1584","Res58146","Zer57651","Dot68310","Sub38418","Res42444","Ave29932","Res12808","Cro37684","Zer43425","Ave47088"],Ave47088,"Ave47088")

Actual (Unparsed): [[[[-0.0105470], [-0.0758027]], [[0.5790913], [0.8195395]]]]

Expected (Unparsed): [[[[-0.01054702],[-0.07580270000000001]],[[0.5790912850000001],[0.8195394149999999]]]]

Actual:   [[[[-0.0105], [-0.0758]], [[0.5791], [0.8196]]]]

Expected: [[[[-0.0105], [-0.0758]], [[0.5791], [0.8196]]]]