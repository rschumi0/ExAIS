import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Per67776 = tf.keras.layers.Input(shape=([4, 2]))
in0Dot96007 = tf.keras.layers.Input(shape=([2]))
in1Dot96007 = tf.keras.layers.Input(shape=([2]))
in0Con90458 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Max57321 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Max57321 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Dot49206 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot49206 = tf.keras.layers.Input(shape=([2, 2]))
in0Sim22855 = tf.keras.layers.Input(shape=([3, 1]))

Per67776 = keras.layers.Permute((1,2), name = 'Per67776',)(in0Per67776)
Res86882 = keras.layers.Reshape((4, 2, 1), name = 'Res86882', )(Per67776)
Res56620 = keras.layers.Reshape((4, 2, 1, 1), name = 'Res56620', )(Res86882)
Con42840 = keras.layers.Conv3DTranspose(2, (3, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con42840', )(Res56620)
Res94999 = keras.layers.Reshape((6, 2, 2), name = 'Res94999', )(Con42840)
Res61575 = keras.layers.Reshape((6, 4), name = 'Res61575', )(Res94999)
Dot96007 = keras.layers.Dot(axes=(1, 1), name = 'Dot96007', )([in0Dot96007,in1Dot96007])
Res16725 = keras.layers.Reshape((1, 1), name = 'Res16725', )(Dot96007)
Res27809 = keras.layers.Reshape((1, 1, 1), name = 'Res27809', )(Res16725)
Zer1822 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer1822', )(Res27809)
Con90458 = keras.layers.Concatenate(axis=3, name = 'Con90458', )([Zer1822,in0Con90458])
Max57321 = keras.layers.Maximum(name = 'Max57321', )([in0Max57321,in1Max57321])
Ave34005 = keras.layers.Average(name = 'Ave34005', )([Con90458,Max57321])
Res4686 = keras.layers.Reshape((2, 4), name = 'Res4686', )(Ave34005)
Dot98915 = keras.layers.Dot(axes=(2, 2), name = 'Dot98915', )([Res61575,Res4686])
Res96491 = keras.layers.Reshape((6, 2, 1), name = 'Res96491', )(Dot98915)
Res37690 = keras.layers.Reshape((6, 2, 1, 1), name = 'Res37690', )(Res96491)
Dot49206 = keras.layers.Dot(axes=(1, 2), name = 'Dot49206', )([in0Dot49206,in1Dot49206])
Res58593 = keras.layers.Reshape((2, 2, 1), name = 'Res58593', )(Dot49206)
Res6105 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res6105', )(Res58593)
Glo62835 = keras.layers.GlobalMaxPool3D(name = 'Glo62835', )(Res6105)
Sim22855 = keras.layers.SimpleRNN(1,name = 'Sim22855', )(in0Sim22855)
Max58096 = keras.layers.Maximum(name = 'Max58096', )([Glo62835,Sim22855])
Res66400 = keras.layers.Reshape((1, 1), name = 'Res66400', )(Max58096)
Res1719 = keras.layers.Reshape((1, 1, 1), name = 'Res1719', )(Res66400)
Res53220 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res53220', )(Res1719)
Cro74543 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro74543', )(Res53220)
Zer39950 = keras.layers.ZeroPadding3D(padding=((5, 0), (1, 0), (0, 0)), name = 'Zer39950', )(Cro74543)
Ave95695 = keras.layers.Average(name = 'Ave95695', )([Res37690,Zer39950])
model = tf.keras.models.Model(inputs=[in0Per67776,in0Dot96007,in1Dot96007,in0Con90458,in0Max57321,in1Max57321,in0Dot49206,in1Dot49206,in0Sim22855], outputs=Ave95695)
w = model.get_layer('Con42840').get_weights() 
w[0] = np.array([[[[[0.768], [0.1369]]]], [[[[0.1478], [0.8128]]]], [[[[0.1445], [0.2897]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con42840').set_weights(w) 
w = model.get_layer('Sim22855').get_weights() 
w[0] = np.array([[7]])
w[1] = np.array([[5]])
w[2] = np.array([3])
model.get_layer('Sim22855').set_weights(w) 
in0Per67776 = tf.constant([[[1.0465, 1.439], [1.3909, 1.5743], [1.7956, 1.048], [1.1424, 1.0572]]])
in0Dot96007 = tf.constant([[0.7107, 0.8453]])
in1Dot96007 = tf.constant([[0.0001, 0.9683]])
in0Con90458 = tf.constant([[[[0.4375], [0.6485]], [[0.916], [0.9183]]]])
in0Max57321 = tf.constant([[[[0.0902, 0.9043], [0.0892, 0.2943]], [[0.7147, 0.3475], [0.5503, 0.8409]]]])
in1Max57321 = tf.constant([[[[0.4179, 0.0695], [0.8022, 0.4084]], [[0.6446, 0.3703], [0.7132, 0.1772]]]])
in0Dot49206 = tf.constant([[[0.3275, 0.6238], [0.5134, 0.0275]]])
in1Dot49206 = tf.constant([[[0.768, 0.2144], [0.9569, 0.0726]]])
in0Sim22855 = tf.constant([[[10], [6], [7]]])
print (np.array2string(model.predict([in0Per67776,in0Dot96007,in1Dot96007,in0Con90458,in0Max57321,in1Max57321,in0Dot49206,in1Dot49206,in0Sim22855],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave95695.png')

LPer67776 = permute_layer([[[1.0465, 1.439], [1.3909, 1.5743], [1.7956, 1.048], [1.1424, 1.0572]]], 1,2, Per67776), 
LRes86882 = reshape_layer(Per67776, [4, 2, 1], Res86882), 
LRes56620 = reshape_layer(Res86882, [4, 2, 1, 1], Res56620), 
LCon42840 = conv3D_transpose_layer(Res56620, 3, 1, 1,[[[[[0.768], [0.1369]]]], [[[[0.1478], [0.8128]]]], [[[[0.1445], [0.2897]]]]],[0, 0], 1, 1, 1, false, Con42840), 
LRes94999 = reshape_layer(Con42840, [6, 2, 2], Res94999), 
LRes61575 = reshape_layer(Res94999, [6, 4], Res61575), 
LDot96007 = dot_layer([[0.7107, 0.8453]], [[0.0001, 0.9683]], 1, 1, Dot96007), 
LRes16725 = reshape_layer(Dot96007, [1, 1], Res16725), 
LRes27809 = reshape_layer(Res16725, [1, 1, 1], Res27809), 
LZer1822 = zero_padding2D_layer(Res27809, 1, 0, 1, 0, Zer1822), 
LCon90458 = concatenate_layer([Zer1822,[[[[0.4375], [0.6485]], [[0.916], [0.9183]]]]], 3, Con90458), 
LMax57321 = maximum_layer([[[[[0.0902, 0.9043], [0.0892, 0.2943]], [[0.7147, 0.3475], [0.5503, 0.8409]]]], [[[[0.4179, 0.0695], [0.8022, 0.4084]], [[0.6446, 0.3703], [0.7132, 0.1772]]]]], Max57321), 
LAve34005 = average_layer([Con90458,Max57321], Ave34005), 
LRes4686 = reshape_layer(Ave34005, [2, 4], Res4686), 
LDot98915 = dot_layer(Res61575,Res4686, 2, 2, Dot98915), 
LRes96491 = reshape_layer(Dot98915, [6, 2, 1], Res96491), 
LRes37690 = reshape_layer(Res96491, [6, 2, 1, 1], Res37690), 
LDot49206 = dot_layer([[[0.3275, 0.6238], [0.5134, 0.0275]]], [[[0.768, 0.2144], [0.9569, 0.0726]]], 1, 2, Dot49206), 
LRes58593 = reshape_layer(Dot49206, [2, 2, 1], Res58593), 
LRes6105 = reshape_layer(Res58593, [2, 2, 1, 1], Res6105), 
LGlo62835 = global_max_pool3D_layer(Res6105, Glo62835), 
LSim22855 = simple_rnn_layer([[[10], [6], [7]]],[[7]],[[5]],[3], Sim22855), 
LMax58096 = maximum_layer([Glo62835,Sim22855], Max58096), 
LRes66400 = reshape_layer(Max58096, [1, 1], Res66400), 
LRes1719 = reshape_layer(Res66400, [1, 1, 1], Res1719), 
LRes53220 = reshape_layer(Res1719, [1, 1, 1, 1], Res53220), 
LCro74543 = cropping3D_layer(Res53220, 0, 0, 0, 0, 0, 0, Cro74543), 
LZer39950 = zero_padding3D_layer(Cro74543, 5, 0, 1, 0, 0, 0, Zer39950), 
LAve95695 = average_layer([Res37690,Zer39950], Ave95695), 
exec_layers([LPer67776,LRes86882,LRes56620,LCon42840,LRes94999,LRes61575,LDot96007,LRes16725,LRes27809,LZer1822,LCon90458,LMax57321,LAve34005,LRes4686,LDot98915,LRes96491,LRes37690,LDot49206,LRes58593,LRes6105,LGlo62835,LSim22855,LMax58096,LRes66400,LRes1719,LRes53220,LCro74543,LZer39950,LAve95695],["Per67776","Res86882","Res56620","Con42840","Res94999","Res61575","Dot96007","Res16725","Res27809","Zer1822","Con90458","Max57321","Ave34005","Res4686","Dot98915","Res96491","Res37690","Dot49206","Res58593","Res6105","Glo62835","Sim22855","Max58096","Res66400","Res1719","Res53220","Cro74543","Zer39950","Ave95695"],Ave95695,"Ave95695")

Actual (Unparsed): [[[[[0.4057167]], [[0.6995252]]], [[[1.1280875]], [[1.7068953]]], [[[1.4806812]], [[2.1363909]]], [[[1.4409316]], [[1.9855045]]], [[[0.8996975]], [[1.1716736]]], [[[0.2398262]], [[0.8291199]]]]]

Expected (Unparsed): [[[[[0.40571666138000007]],[[0.69952522927103]]],[[[1.1280875290427501]],[[1.706895332359199]]],[[[1.4806811620362499]],[[2.1363909447487153]]],[[[1.4409315457785001]],[[1.9855045037949677]]],[[[0.899697526609]],[[1.1716736362658524]]],[[[0.239826190125]],[[0.829119871125731]]]]]

Actual:   [[[[[0.4058]], [[0.6996]]], [[[1.1281]], [[1.7069]]], [[[1.4807]], [[2.1364]]], [[[1.441]], [[1.9856]]], [[[0.8997]], [[1.1717]]], [[[0.2399]], [[0.8292]]]]]

Expected: [[[[[0.4058]], [[0.6996]]], [[[1.1281]], [[1.7069]]], [[[1.4807]], [[2.1364]]], [[[1.441]], [[1.9856]]], [[[0.8997]], [[1.1717]]], [[[0.2399]], [[0.8292]]]]]