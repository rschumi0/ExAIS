import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub6225 = tf.keras.layers.Input(shape=([3, 2, 3, 2]))
in1Sub6225 = tf.keras.layers.Input(shape=([3, 2, 3, 2]))
in0Loc6234 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con62520 = tf.keras.layers.Input(shape=([3, 2, 2]))

Sub6225 = keras.layers.Subtract(name = 'Sub6225', )([in0Sub6225,in1Sub6225])
Res11218 = keras.layers.Reshape((3, 2, 6), name = 'Res11218', )(Sub6225)
Loc6234 = keras.layers.LocallyConnected2D(4, (2, 2),strides=(1, 1), name = 'Loc6234', )(in0Loc6234)
Ave71372 = keras.layers.AveragePooling2D(pool_size=(1, 1), strides=(1, 1), padding='valid', name = 'Ave71372', )(Loc6234)
Zer54689 = keras.layers.ZeroPadding2D(padding=((2, 0), (1, 0)), name = 'Zer54689', )(Ave71372)
Con62520 = keras.layers.Concatenate(axis=3, name = 'Con62520', )([Zer54689,in0Con62520])
Mul96295 = keras.layers.Multiply(name = 'Mul96295', )([Res11218,Con62520])
model = tf.keras.models.Model(inputs=[in0Sub6225,in1Sub6225,in0Loc6234,in0Con62520], outputs=Mul96295)
w = model.get_layer('Loc6234').get_weights() 
w[0] = np.array([[[0.5777, 0.9551, 0.4062, 0.4241], [0.2875, 0.7851, 0.2793, 0.7508], [0.1936, 0.0407, 0.7372, 0.4428], [0.4814, 0.8721, 0.1471, 0.0363]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc6234').set_weights(w) 
in0Sub6225 = tf.constant([[[[[0.2175, 0.4613], [0.9975, 0.8452], [0.9767, 0.0603]], [[0.4544, 0.4231], [0.0405, 0.7086], [0.4581, 0.1436]]], [[[0.6591, 0.1411], [0.4274, 0.6721], [0.0795, 0.7517]], [[0.7051, 0.5454], [0.7279, 0.9579], [0.829, 0.5299]]], [[[0.4687, 0.0812], [0.204, 0.7424], [0.6331, 0.9997]], [[0.3504, 0.7441], [0.5775, 0.4073], [0.8007, 0.352]]]]])
in1Sub6225 = tf.constant([[[[[0.5051, 0.2412], [0.017, 0.0914], [0.1648, 0.7316]], [[0.4105, 0.0577], [0.8274, 0.5687], [0.6573, 0.4502]]], [[[0.6302, 0.8825], [0.0282, 0.1964], [0.9823, 0.0881]], [[0.3726, 0.8917], [0.2253, 0.1617], [0.7342, 0.7487]]], [[[0.1565, 0.5815], [0.3114, 0.3704], [0.339, 0.9924]], [[0.6236, 0.939], [0.3463, 0.6348], [0.2962, 0.8489]]]]])
in0Loc6234 = tf.constant([[[[0.2193], [0.7172]], [[0.832], [0.9031]]]])
in0Con62520 = tf.constant([[[[0.3241, 0.339], [0.1552, 0.2397]], [[0.1527, 0.0418], [0.7943, 0.5672]], [[0.3153, 0.1388], [0.4102, 0.5226]]]])
print (np.array2string(model.predict([in0Sub6225,in1Sub6225,in0Loc6234,in0Con62520],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul96295.png')

LSub6225 = subtract_layer([[[[[0.2175, 0.4613], [0.9975, 0.8452], [0.9767, 0.0603]], [[0.4544, 0.4231], [0.0405, 0.7086], [0.4581, 0.1436]]], [[[0.6591, 0.1411], [0.4274, 0.6721], [0.0795, 0.7517]], [[0.7051, 0.5454], [0.7279, 0.9579], [0.829, 0.5299]]], [[[0.4687, 0.0812], [0.204, 0.7424], [0.6331, 0.9997]], [[0.3504, 0.7441], [0.5775, 0.4073], [0.8007, 0.352]]]]], [[[[[0.5051, 0.2412], [0.017, 0.0914], [0.1648, 0.7316]], [[0.4105, 0.0577], [0.8274, 0.5687], [0.6573, 0.4502]]], [[[0.6302, 0.8825], [0.0282, 0.1964], [0.9823, 0.0881]], [[0.3726, 0.8917], [0.2253, 0.1617], [0.7342, 0.7487]]], [[[0.1565, 0.5815], [0.3114, 0.3704], [0.339, 0.9924]], [[0.6236, 0.939], [0.3463, 0.6348], [0.2962, 0.8489]]]]], Sub6225), 
LRes11218 = reshape_layer(Sub6225, [3, 2, 6], Res11218), 
LLoc6234 = locally_connected2D_layer([[[[0.2193], [0.7172]], [[0.832], [0.9031]]]], 2, 2,[[[0.5777, 0.9551, 0.4062, 0.4241], [0.2875, 0.7851, 0.2793, 0.7508], [0.1936, 0.0407, 0.7372, 0.4428], [0.4814, 0.8721, 0.1471, 0.0363]]],[[[0, 0, 0, 0]]], 1, 1, Loc6234), 
LAve71372 = average_pooling2D_layer(Loc6234, 1, 1, 1, 1, false, Ave71372), 
LZer54689 = zero_padding2D_layer(Ave71372, 2, 0, 1, 0, Zer54689), 
LCon62520 = concatenate_layer([Zer54689,[[[[0.3241, 0.339], [0.1552, 0.2397]], [[0.1527, 0.0418], [0.7943, 0.5672]], [[0.3153, 0.1388], [0.4102, 0.5226]]]]], 3, Con62520), 
LMul96295 = multiply_layer([Res11218,Con62520], Mul96295), 
exec_layers([LSub6225,LRes11218,LLoc6234,LAve71372,LZer54689,LCon62520,LMul96295],["Sub6225","Res11218","Loc6234","Ave71372","Zer54689","Con62520","Mul96295"],Mul96295,"Mul96295")

Actual (Unparsed): [[[[-0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.2631368, -0.2275707], [0.0000000, 0.0000000, -0.0000000, 0.0000000, -0.0309158, -0.0734920]], [[0.0000000, -0.0000000, 0.0000000, 0.0000000, -0.1378576, 0.0277385], [0.0000000, -0.0000000, 0.0000000, 0.0000000, 0.0752996, -0.1241034]], [[0.0000000, -0.0000000, -0.0000000, 0.0000000, 0.0927297, 0.0010132], [-0.2537242, -0.3106674, 0.2394284, -0.2349327, 0.2069459, -0.2596799]]]]

Expected (Unparsed): [[[[-0.0,0.0,0.0,0.0,0.26313679,-0.22757070000000001],[0.0,0.0,-0.0,0.0,-0.03091584,-0.07349201999999999]],[[0.0,-0.0,0.0,0.0,-0.13785756,0.027738480000000003],[0.0,-0.0,0.0,0.0,0.07529964,-0.12410336000000001]],[[0.0,-0.0,-0.0,0.0,0.09272973,0.0010132400000000118],[-0.25372415938000004,-0.3106672983939999,0.23942841493600003,-0.23493265705000005,0.2069459,-0.25967994]]]]

Actual:   [[[[-0, 0, 0, 0, 0.2632, -0.2275], [0, 0, -0, 0, -0.0309, -0.0734]], [[0, -0, 0, 0, -0.1378, 0.0278], [0, -0, 0, 0, 0.0753, -0.1241]], [[0, -0, -0, 0, 0.0928, 0.0011], [-0.2537, -0.3106, 0.2395, -0.2349, 0.207, -0.2596]]]]

Expected: [[[[-0, 0, 0, 0, 0.2632, -0.2275], [0, 0, -0, 0, -0.0309, -0.0734]], [[0, -0, 0, 0, -0.1378, 0.0278], [0, -0, 0, 0, 0.0753, -0.1241]], [[0, -0, -0, 0, 0.0928, 0.0011], [-0.2537, -0.3106, 0.2395, -0.2349, 0.207, -0.2596]]]]