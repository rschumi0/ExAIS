import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave91306 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave91306 = tf.keras.layers.Input(shape=([2, 2]))

Ave91306 = keras.layers.Average(name = 'Ave91306', )([in0Ave91306,in1Ave91306])
Res65556 = keras.layers.Reshape((2, 2, 1), name = 'Res65556', )(Ave91306)
Loc74544 = keras.layers.LocallyConnected2D(3, (1, 2),strides=(1, 1), name = 'Loc74544', )(Res65556)
Res77888 = keras.layers.Reshape((2, 1, 3, 1), name = 'Res77888', )(Loc74544)
Glo53568 = keras.layers.GlobalMaxPool3D(name = 'Glo53568', )(Res77888)
Lay86711 = keras.layers.LayerNormalization(axis=1, epsilon=1.5146653130179473, name = 'Lay86711', )(Glo53568)
Res37272 = keras.layers.Reshape((1, 1), name = 'Res37272', )(Lay86711)
Res60696 = keras.layers.Reshape((1, 1, 1), name = 'Res60696', )(Res37272)
Con59919 = keras.layers.Conv2DTranspose(4, (1, 1),strides=(1, 1), padding='valid', name = 'Con59919', )(Res60696)
ReL32237 = keras.layers.ReLU(max_value=2.037603113090106, negative_slope=1.8037027480328345, threshold=5.422278667631658, name = 'ReL32237', )(Con59919)
model = tf.keras.models.Model(inputs=[in0Ave91306,in1Ave91306], outputs=ReL32237)
w = model.get_layer('Loc74544').get_weights() 
w[0] = np.array([[[0.1216, 0.7334, 0.9278], [0.8783, 0.5772, 0.3234]], [[0.8137, 0.7893, 0.4288], [0.3592, 0.6929, 0.5847]]])
w[1] = np.array([[[0, 0, 0]], [[0, 0, 0]]])
model.get_layer('Loc74544').set_weights(w) 
w = model.get_layer('Con59919').get_weights() 
w[0] = np.array([[[[0.6027], [0.6818], [0.6052], [0.5385]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con59919').set_weights(w) 
in0Ave91306 = tf.constant([[[0.8294, 0.1607], [0.5724, 0.2051]]])
in1Ave91306 = tf.constant([[[0.1849, 0.8651], [0.3663, 0.6316]]])
print (np.array2string(model.predict([in0Ave91306,in1Ave91306],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='ReL32237.png')

LAve91306 = average_layer([[[[0.8294, 0.1607], [0.5724, 0.2051]]], [[[0.1849, 0.8651], [0.3663, 0.6316]]]], Ave91306), 
LRes65556 = reshape_layer(Ave91306, [2, 2, 1], Res65556), 
LLoc74544 = locally_connected2D_layer(Res65556, 1, 2,[[[0.1216, 0.7334, 0.9278], [0.8783, 0.5772, 0.3234]], [[0.8137, 0.7893, 0.4288], [0.3592, 0.6929, 0.5847]]],[[[0, 0, 0]], [[0, 0, 0]]], 1, 1, Loc74544), 
LRes77888 = reshape_layer(Loc74544, [2, 1, 3, 1], Res77888), 
LGlo53568 = global_max_pool3D_layer(Res77888, Glo53568), 
LLay86711 = layer_normalization_layer(Glo53568, 1, 1.5146653130179473, Lay86711), 
LRes37272 = reshape_layer(Lay86711, [1, 1], Res37272), 
LRes60696 = reshape_layer(Res37272, [1, 1, 1], Res60696), 
LCon59919 = conv2D_transpose_layer(Res60696, 1, 1,[[[[0.6027], [0.6818], [0.6052], [0.5385]]]],[0, 0, 0, 0], 1, 1, false, Con59919), 
LReL32237 = relu_layer(Con59919, 2.037603113090106, 1.8037027480328345, 5.422278667631658, ReL32237), 
exec_layers([LAve91306,LRes65556,LLoc74544,LRes77888,LGlo53568,LLay86711,LRes37272,LRes60696,LCon59919,LReL32237],["Ave91306","Res65556","Loc74544","Res77888","Glo53568","Lay86711","Res37272","Res60696","Con59919","ReL32237"],ReL32237,"ReL32237")

Actual (Unparsed): [[[[-9.7801789, -9.7801789, -9.7801789, -9.7801789]]]]

Expected (Unparsed): [[[[-9.780178933407038,-9.780178933407038,-9.780178933407038,-9.780178933407038]]]]

Actual:   [[[[-9.7801, -9.7801, -9.7801, -9.7801]]]]

Expected: [[[[-9.7801, -9.7801, -9.7801, -9.7801]]]]