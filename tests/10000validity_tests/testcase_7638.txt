import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave91504 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave91504 = tf.keras.layers.Input(shape=([1, 2]))

Ave91504 = keras.layers.Average(name = 'Ave91504', )([in0Ave91504,in1Ave91504])
Res4830 = keras.layers.Reshape((1, 2, 1), name = 'Res4830', )(Ave91504)
Con63195 = keras.layers.Conv2D(4, (1, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con63195', )(Res4830)
Res26958 = keras.layers.Reshape((1, 8), name = 'Res26958', )(Con63195)
Glo24650 = keras.layers.GlobalAveragePooling1D(name = 'Glo24650', )(Res26958)
Res94694 = keras.layers.Reshape((8, 1), name = 'Res94694', )(Glo24650)
GRU87629 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU87629', )(Res94694)
model = tf.keras.models.Model(inputs=[in0Ave91504,in1Ave91504], outputs=GRU87629)
w = model.get_layer('Con63195').get_weights() 
w[0] = np.array([[[[0.8361, 0.4064, 0.9574, 0.2902]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con63195').set_weights(w) 
w = model.get_layer('GRU87629').get_weights() 
w[0] = np.array([[5, 1, 7, 3, 8, 5, 6, 5, 2]])
w[1] = np.array([[2, 6, 5, 5, 6, 5, 2, 10, 6], [1, 9, 7, 4, 3, 8, 8, 2, 7], [3, 1, 9, 5, 1, 5, 1, 9, 7]])
w[2] = np.array([8, 6, 2, 9, 7, 7, 8, 5, 2])
model.get_layer('GRU87629').set_weights(w) 
in0Ave91504 = tf.constant([[[0.5051, 0.662]]])
in1Ave91504 = tf.constant([[[0.442, 0.3179]]])
print (np.array2string(model.predict([in0Ave91504,in1Ave91504],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU87629.png')

LAve91504 = average_layer([[[[0.5051, 0.662]]], [[[0.442, 0.3179]]]], Ave91504), 
LRes4830 = reshape_layer(Ave91504, [1, 2, 1], Res4830), 
LCon63195 = conv2D_layer(Res4830, 1, 1,[[[[0.8361, 0.4064, 0.9574, 0.2902]]]],[0, 0, 0, 0], 1, 1, false, 1, 1, Con63195), 
LRes26958 = reshape_layer(Con63195, [1, 8], Res26958), 
LGlo24650 = global_average_pooling1D_layer(Res26958, Glo24650), 
LRes94694 = reshape_layer(Glo24650, [8, 1], Res94694), 
LGRU87629 = gru_layer(Res94694,[[5, 1, 7, 3, 8, 5, 6, 5, 2]],[[2, 6, 5, 5, 6, 5, 2, 10, 6], [1, 9, 7, 4, 3, 8, 8, 2, 7], [3, 1, 9, 5, 1, 5, 1, 9, 7]],[8, 6, 2, 9, 7, 7, 8, 5, 2], false, GRU87629), 
exec_layers([LAve91504,LRes4830,LCon63195,LRes26958,LGlo24650,LRes94694,LGRU87629],["Ave91504","Res4830","Con63195","Res26958","Glo24650","Res94694","GRU87629"],GRU87629,"GRU87629")

Actual (Unparsed): [[0.0006284, 0.0132231, 0.1108656]]

Expected (Unparsed): [[0.000628407733114968,0.013223071917144568,0.11086562929694038]]

Actual:   [[0.0007, 0.0133, 0.1109]]

Expected: [[0.0007, 0.0133, 0.1109]]