import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Den74189 = tf.keras.layers.Input(shape=([3, 5, 5]))
in0Glo83511 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Con98995 = tf.keras.layers.Input(shape=([4]))
in0Max71490 = tf.keras.layers.Input(shape=([1, 2]))
in1Max71490 = tf.keras.layers.Input(shape=([1, 2]))
in0Con75083 = tf.keras.layers.Input(shape=([1, 1]))
in0Cro59714 = tf.keras.layers.Input(shape=([1, 1, 2, 3]))

Den74189 = keras.layers.Dense(1,name = 'Den74189', )(in0Den74189)
Res28631 = keras.layers.Reshape((3, 5), name = 'Res28631', )(Den74189)
Max7651 = keras.layers.MaxPool1D(pool_size=(2), strides=(12), padding='same', name = 'Max7651', )(Res28631)
Fla91220 = keras.layers.Flatten(name = 'Fla91220', )(Max7651)
Glo83511 = keras.layers.GlobalMaxPool3D(name = 'Glo83511', )(in0Glo83511)
Con98995 = keras.layers.Concatenate(axis=1, name = 'Con98995', )([Glo83511,in0Con98995])
Sub23841 = keras.layers.Subtract(name = 'Sub23841', )([Fla91220,Con98995])
Res62087 = keras.layers.Reshape((5, 1), name = 'Res62087', )(Sub23841)
LST83883 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST83883', )(Res62087)
Res94050 = keras.layers.Reshape((3, 1), name = 'Res94050', )(LST83883)
Zer96631 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer96631', )(Res94050)
Max71490 = keras.layers.Maximum(name = 'Max71490', )([in0Max71490,in1Max71490])
Con75083 = keras.layers.Concatenate(axis=2, name = 'Con75083', )([Max71490,in0Con75083])
Cro59714 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 1)), name = 'Cro59714', )(in0Cro59714)
Sof62063 = keras.layers.Softmax(axis=1, name = 'Sof62063', )(Cro59714)
Res90381 = keras.layers.Reshape((1, 1, 3), name = 'Res90381', )(Sof62063)
Res3996 = keras.layers.Reshape((1, 3), name = 'Res3996', )(Res90381)
Dot15081 = keras.layers.Dot(axes=(2, 2), name = 'Dot15081', )([Con75083,Res3996])
Dot39296 = keras.layers.Dot(axes=(2, 1), name = 'Dot39296', )([Zer96631,Dot15081])
model = tf.keras.models.Model(inputs=[in0Den74189,in0Glo83511,in0Con98995,in0Max71490,in1Max71490,in0Con75083,in0Cro59714], outputs=Dot39296)
w = model.get_layer('Den74189').get_weights() 
w[0] = np.array([[0.9445], [0.9541], [0.2135], [0.0178], [0.5213]])
w[1] = np.array([0.9529])
model.get_layer('Den74189').set_weights(w) 
w = model.get_layer('LST83883').get_weights() 
w[0] = np.array([[8, 8, 9, 6, 4, 6, 10, 7, 8, 1, 10, 4]])
w[1] = np.array([[5, 6, 6, 3, 3, 4, 8, 5, 2, 7, 3, 8], [2, 4, 1, 4, 7, 4, 5, 10, 6, 6, 1, 10], [4, 8, 10, 10, 2, 9, 6, 1, 2, 9, 7, 8]])
w[2] = np.array([4, 3, 1, 4, 4, 3, 7, 5, 1, 3, 6, 4])
model.get_layer('LST83883').set_weights(w) 
in0Den74189 = tf.constant([[[[0.9545, 0.3232, 0.0697, 0.7882, 0.3787], [0.8761, 0.8839, 0.853, 0.0965, 0.2191], [0.4816, 0.8014, 0.0866, 0.2888, 0.2229], [0.6286, 0.3318, 0.087, 0.0749, 0.9421], [0.8652, 0.5513, 0.8211, 0.5694, 0.7665]], [[0.0947, 0.8921, 0.5582, 0.9683, 0.8631], [0.2062, 0.0901, 0.5802, 0.5498, 0.453], [0.9387, 0.9294, 0.2958, 0.4542, 0.6265], [0.6735, 0.8035, 0.591, 0.3599, 0.1504], [0.2995, 0.8008, 0.1557, 0.5935, 0.3881]], [[0.3147, 0.3108, 0.9663, 0.1581, 0.1326], [0.5136, 0.9452, 0.1299, 0.2143, 0.4461], [0.0166, 0.7553, 0.5014, 0.6846, 0.744], [0.2236, 0.1821, 0.0699, 0.0068, 0.2671], [0.0559, 0.491, 0.4187, 0.5075, 0.4673]]]])
in0Glo83511 = tf.constant([[[[[1.199], [1.1907]], [[1.6422], [1.0362]]]]])
in0Con98995 = tf.constant([[0.3069, 0.4896, 0.3078, 0.9709]])
in0Max71490 = tf.constant([[[0.356, 0.4197]]])
in1Max71490 = tf.constant([[[0.4271, 0.3334]]])
in0Con75083 = tf.constant([[[0.2519]]])
in0Cro59714 = tf.constant([[[[[1.5077, 1.1575, 1.9835], [1.7248, 1.0681, 1.6411]]]]])
print (np.array2string(model.predict([in0Den74189,in0Glo83511,in0Con98995,in0Max71490,in1Max71490,in0Con75083,in0Cro59714],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot39296.png')

LDen74189 = dense_layer([[[[0.9545, 0.3232, 0.0697, 0.7882, 0.3787], [0.8761, 0.8839, 0.853, 0.0965, 0.2191], [0.4816, 0.8014, 0.0866, 0.2888, 0.2229], [0.6286, 0.3318, 0.087, 0.0749, 0.9421], [0.8652, 0.5513, 0.8211, 0.5694, 0.7665]], [[0.0947, 0.8921, 0.5582, 0.9683, 0.8631], [0.2062, 0.0901, 0.5802, 0.5498, 0.453], [0.9387, 0.9294, 0.2958, 0.4542, 0.6265], [0.6735, 0.8035, 0.591, 0.3599, 0.1504], [0.2995, 0.8008, 0.1557, 0.5935, 0.3881]], [[0.3147, 0.3108, 0.9663, 0.1581, 0.1326], [0.5136, 0.9452, 0.1299, 0.2143, 0.4461], [0.0166, 0.7553, 0.5014, 0.6846, 0.744], [0.2236, 0.1821, 0.0699, 0.0068, 0.2671], [0.0559, 0.491, 0.4187, 0.5075, 0.4673]]]], [[0.9445], [0.9541], [0.2135], [0.0178], [0.5213]],[0.9529], Den74189), 
LRes28631 = reshape_layer(Den74189, [3, 5], Res28631), 
LMax7651 = max_pool1D_layer(Res28631, 2, 12, true, Max7651), 
LFla91220 = flatten_layer(Max7651, Fla91220), 
LGlo83511 = global_max_pool3D_layer([[[[[1.199], [1.1907]], [[1.6422], [1.0362]]]]], Glo83511), 
LCon98995 = concatenate_layer([Glo83511,[[0.3069, 0.4896, 0.3078, 0.9709]]], 1, Con98995), 
LSub23841 = subtract_layer(Fla91220,Con98995, Sub23841), 
LRes62087 = reshape_layer(Sub23841, [5, 1], Res62087), 
LLST83883 = lstm_layer(Res62087,[[8, 8, 9, 6, 4, 6, 10, 7, 8, 1, 10, 4]],[[5, 6, 6, 3, 3, 4, 8, 5, 2, 7, 3, 8], [2, 4, 1, 4, 7, 4, 5, 10, 6, 6, 1, 10], [4, 8, 10, 10, 2, 9, 6, 1, 2, 9, 7, 8]],[4, 3, 1, 4, 4, 3, 7, 5, 1, 3, 6, 4], LST83883), 
LRes94050 = reshape_layer(LST83883, [3, 1], Res94050), 
LZer96631 = zero_padding1D_layer(Res94050, 2, 0, Zer96631), 
LMax71490 = maximum_layer([[[[0.356, 0.4197]]], [[[0.4271, 0.3334]]]], Max71490), 
LCon75083 = concatenate_layer([Max71490,[[[0.2519]]]], 2, Con75083), 
LCro59714 = cropping3D_layer([[[[[1.5077, 1.1575, 1.9835], [1.7248, 1.0681, 1.6411]]]]], 0, 0, 0, 0, 0, 1, Cro59714), 
LSof62063 = softmax_layer(Cro59714, 1, Sof62063), 
LRes90381 = reshape_layer(Sof62063, [1, 1, 3], Res90381), 
LRes3996 = reshape_layer(Res90381, [1, 3], Res3996), 
LDot15081 = dot_layer(Con75083,Res3996, 2, 2, Dot15081), 
LDot39296 = dot_layer(Zer96631,Dot15081, 2, 1, Dot39296), 
exec_layers([LDen74189,LRes28631,LMax7651,LFla91220,LGlo83511,LCon98995,LSub23841,LRes62087,LLST83883,LRes94050,LZer96631,LMax71490,LCon75083,LCro59714,LSof62063,LRes90381,LRes3996,LDot15081,LDot39296],["Den74189","Res28631","Max7651","Fla91220","Glo83511","Con98995","Sub23841","Res62087","LST83883","Res94050","Zer96631","Max71490","Con75083","Cro59714","Sof62063","Res90381","Res3996","Dot15081","Dot39296"],Dot39296,"Dot39296")

Actual (Unparsed): [[[0.0000000], [0.0000000], [1.0986002], [1.0986002], [1.0986002]]]

Expected (Unparsed): [[[0.0],[0.0],[1.0986002382282967],[1.0986002305106108],[1.098600203592677]]]

Actual:   [[[0], [0], [1.0987], [1.0987], [1.0987]]]

Expected: [[[0], [0], [1.0987], [1.0987], [1.0987]]]