import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Cro90208 = tf.keras.layers.Input(shape=([1, 1]))
in0Min98583 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Min98583 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Add6103 = tf.keras.layers.Input(shape=([1, 1]))
in1Add6103 = tf.keras.layers.Input(shape=([1, 1]))
in0Con27841 = tf.keras.layers.Input(shape=([2]))
in0Min65068 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Min65068 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Glo28539 = tf.keras.layers.Input(shape=([2, 2, 2]))

Cro90208 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro90208', )(in0Cro90208)
Sof7820 = keras.layers.Softmax(axis=1, name = 'Sof7820', )(Cro90208)
Per47621 = keras.layers.Permute((2,1), name = 'Per47621',)(Sof7820)
Fla58052 = keras.layers.Flatten(name = 'Fla58052', )(Per47621)
Min98583 = keras.layers.Minimum(name = 'Min98583', )([in0Min98583,in1Min98583])
Res23845 = keras.layers.Reshape((1, 1), name = 'Res23845', )(Min98583)
Add6103 = keras.layers.Add(name = 'Add6103', )([in0Add6103,in1Add6103])
Add62161 = keras.layers.Add(name = 'Add62161', )([Res23845,Add6103])
Fla80348 = keras.layers.Flatten(name = 'Fla80348', )(Add62161)
Con27841 = keras.layers.Concatenate(axis=1, name = 'Con27841', )([Fla80348,in0Con27841])
Min65068 = keras.layers.Minimum(name = 'Min65068', )([in0Min65068,in1Min65068])
Res56385 = keras.layers.Reshape((1, 2, 1), name = 'Res56385', )(Min65068)
Glo28539 = keras.layers.GlobalMaxPool2D(name = 'Glo28539', )(in0Glo28539)
Res17979 = keras.layers.Reshape((1, 2, 1), name = 'Res17979', )(Glo28539)
Mul80968 = keras.layers.Multiply(name = 'Mul80968', )([Res56385,Res17979])
Res51313 = keras.layers.Reshape((1, 2), name = 'Res51313', )(Mul80968)
Sim15641 = keras.layers.SimpleRNN(3,name = 'Sim15641', )(Res51313)
Dot20725 = keras.layers.Dot(axes=(1, 1), name = 'Dot20725', )([Con27841,Sim15641])
Ave73969 = keras.layers.Average(name = 'Ave73969', )([Fla58052,Dot20725])
model = tf.keras.models.Model(inputs=[in0Cro90208,in0Min98583,in1Min98583,in0Add6103,in1Add6103,in0Con27841,in0Min65068,in1Min65068,in0Glo28539], outputs=Ave73969)
w = model.get_layer('Sim15641').get_weights() 
w[0] = np.array([[9, 3, 1], [4, 5, 4]])
w[1] = np.array([[9, 4, 10], [5, 5, 7], [3, 10, 6]])
w[2] = np.array([7, 7, 8])
model.get_layer('Sim15641').set_weights(w) 
in0Cro90208 = tf.constant([[[1.7428]]])
in0Min98583 = tf.constant([[[[0.6794]]]])
in1Min98583 = tf.constant([[[[0.2029]]]])
in0Add6103 = tf.constant([[[0.2572]]])
in1Add6103 = tf.constant([[[0.1177]]])
in0Con27841 = tf.constant([[0.4761, 0.1159]])
in0Min65068 = tf.constant([[[[[0.9912]], [[0.4424]]]]])
in1Min65068 = tf.constant([[[[[0.2844]], [[0.7471]]]]])
in0Glo28539 = tf.constant([[[[1.8928, 1.1134], [1.3571, 1.797]], [[1.0088, 1.7567], [1.1725, 1.519]]]])
print (np.array2string(model.predict([in0Cro90208,in0Min98583,in1Min98583,in0Add6103,in1Add6103,in0Con27841,in0Min65068,in1Min65068,in0Glo28539],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave73969.png')

LCro90208 = cropping1D_layer([[[1.7428]]], 0, 0, Cro90208), 
LSof7820 = softmax_layer(Cro90208, 1, Sof7820), 
LPer47621 = permute_layer(Sof7820, 2,1, Per47621), 
LFla58052 = flatten_layer(Per47621, Fla58052), 
LMin98583 = minimum_layer([[[[[0.6794]]]], [[[[0.2029]]]]], Min98583), 
LRes23845 = reshape_layer(Min98583, [1, 1], Res23845), 
LAdd6103 = add_layer([[[[0.2572]]], [[[0.1177]]]], Add6103), 
LAdd62161 = add_layer([Res23845,Add6103], Add62161), 
LFla80348 = flatten_layer(Add62161, Fla80348), 
LCon27841 = concatenate_layer([Fla80348,[[0.4761, 0.1159]]], 1, Con27841), 
LMin65068 = minimum_layer([[[[[[0.9912]], [[0.4424]]]]], [[[[[0.2844]], [[0.7471]]]]]], Min65068), 
LRes56385 = reshape_layer(Min65068, [1, 2, 1], Res56385), 
LGlo28539 = global_max_pool2D_layer([[[[1.8928, 1.1134], [1.3571, 1.797]], [[1.0088, 1.7567], [1.1725, 1.519]]]], Glo28539), 
LRes17979 = reshape_layer(Glo28539, [1, 2, 1], Res17979), 
LMul80968 = multiply_layer([Res56385,Res17979], Mul80968), 
LRes51313 = reshape_layer(Mul80968, [1, 2], Res51313), 
LSim15641 = simple_rnn_layer(Res51313,[[9, 3, 1], [4, 5, 4]],[[9, 4, 10], [5, 5, 7], [3, 10, 6]],[7, 7, 8], Sim15641), 
LDot20725 = dot_layer(Con27841,Sim15641, 1, 1, Dot20725), 
LAve73969 = average_layer([Fla58052,Dot20725], Ave73969), 
exec_layers([LCro90208,LSof7820,LPer47621,LFla58052,LMin98583,LRes23845,LAdd6103,LAdd62161,LFla80348,LCon27841,LMin65068,LRes56385,LGlo28539,LRes17979,LMul80968,LRes51313,LSim15641,LDot20725,LAve73969],["Cro90208","Sof7820","Per47621","Fla58052","Min98583","Res23845","Add6103","Add62161","Fla80348","Con27841","Min65068","Res56385","Glo28539","Res17979","Mul80968","Res51313","Sim15641","Dot20725","Ave73969"],Ave73969,"Ave73969")

Actual (Unparsed): [[1.0849000]]

Expected (Unparsed): [[1.0848999999867384]]

Actual:   [[1.0849]]

Expected: [[1.0849]]