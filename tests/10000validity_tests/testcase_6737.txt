import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul2965 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Mul2965 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Add36979 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Add36979 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Glo55058 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Con46904 = tf.keras.layers.Input(shape=([1, 1]))
in0Ave56777 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con15468 = tf.keras.layers.Input(shape=([2, 2]))

Mul2965 = keras.layers.Multiply(name = 'Mul2965', )([in0Mul2965,in1Mul2965])
Zer1740 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer1740', )(Mul2965)
Res1063 = keras.layers.Reshape((4, 4, 3), name = 'Res1063', )(Zer1740)
Sep30226 = keras.layers.SeparableConv2D(2, (4, 4),strides=(2, 2), padding='same', name = 'Sep30226', )(Res1063)
Res17782 = keras.layers.Reshape((2, 4), name = 'Res17782', )(Sep30226)
Add36979 = keras.layers.Add(name = 'Add36979', )([in0Add36979,in1Add36979])
Res90040 = keras.layers.Reshape((2, 2), name = 'Res90040', )(Add36979)
Glo55058 = keras.layers.GlobalAveragePooling3D(name = 'Glo55058', )(in0Glo55058)
Res38747 = keras.layers.Reshape((1, 1), name = 'Res38747', )(Glo55058)
Con46904 = keras.layers.Concatenate(axis=2, name = 'Con46904', )([Res38747,in0Con46904])
Ave56777 = keras.layers.AveragePooling2D(pool_size=(1, 1), name = 'Ave56777', )(in0Ave56777)
Res91664 = keras.layers.Reshape((1, 2), name = 'Res91664', )(Ave56777)
Dot51004 = keras.layers.Dot(axes=(1, 1), name = 'Dot51004', )([Con46904,Res91664])
Cro89866 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro89866', )(Dot51004)
Dot32325 = keras.layers.Dot(axes=(1, 2), name = 'Dot32325', )([Res90040,Cro89866])
Con15468 = keras.layers.Concatenate(axis=2, name = 'Con15468', )([Dot32325,in0Con15468])
Sub35157 = keras.layers.Subtract(name = 'Sub35157', )([Res17782,Con15468])
model = tf.keras.models.Model(inputs=[in0Mul2965,in1Mul2965,in0Add36979,in1Add36979,in0Glo55058,in0Con46904,in0Ave56777,in0Con15468], outputs=Sub35157)
w = model.get_layer('Sep30226').get_weights() 
w[0] = np.array([[[[0.0185], [0.8285], [0.9465]], [[0.7683], [0.6589], [0.4551]], [[0.3326], [0.1068], [0.4375]], [[0.7804], [0.3938], [0.5506]]], [[[0.1047], [0.6517], [0.2613]], [[0.2816], [0.0513], [0.5327]], [[0.9742], [0.2477], [0.4216]], [[0.7564], [0.7883], [0.5087]]], [[[0.3547], [0.7528], [0.4427]], [[0.086], [0.2642], [0.0196]], [[0.0354], [0.522], [0.8412]], [[0.8267], [0.1426], [0.9031]]], [[[0.9027], [0.7776], [0.9552]], [[0.0618], [0.2981], [0.3833]], [[0.4964], [0.0343], [0.8318]], [[0.7506], [0.4389], [0.6235]]]])
w[1] = np.array([[[[0.1012, 0.2408], [0.6367, 0.941], [0.8318, 0.2198]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep30226').set_weights(w) 
in0Mul2965 = tf.constant([[[[[0.4165]], [[0.2689]]], [[[0.6498]], [[0.2967]]]]])
in1Mul2965 = tf.constant([[[[[0.8974]], [[0.65]]], [[[0.7721]], [[0.4678]]]]])
in0Add36979 = tf.constant([[[[0.4307, 0.6338]], [[0.7362, 0.5]]]])
in1Add36979 = tf.constant([[[[0.8938, 0.3348]], [[0.3016, 0.5852]]]])
in0Glo55058 = tf.constant([[[[[1.9608], [1.8231]]], [[[1.8781], [1.4378]]]]])
in0Con46904 = tf.constant([[[0.5485]]])
in0Ave56777 = tf.constant([[[[1.9283, 1.5773]]]])
in0Con15468 = tf.constant([[[0.8223, 0.4585], [0.7886, 0.9552]]])
print (np.array2string(model.predict([in0Mul2965,in1Mul2965,in0Add36979,in1Add36979,in0Glo55058,in0Con46904,in0Ave56777,in0Con15468],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub35157.png')

LMul2965 = multiply_layer([[[[[[0.4165]], [[0.2689]]], [[[0.6498]], [[0.2967]]]]], [[[[[0.8974]], [[0.65]]], [[[0.7721]], [[0.4678]]]]]], Mul2965), 
LZer1740 = zero_padding3D_layer(Mul2965, 1, 1, 1, 1, 1, 1, Zer1740), 
LRes1063 = reshape_layer(Zer1740, [4, 4, 3], Res1063), 
LSep30226 = separable_conv2D_layer(Res1063, 4, 4,[[[[[0.0185], [0.8285], [0.9465]], [[0.7683], [0.6589], [0.4551]], [[0.3326], [0.1068], [0.4375]], [[0.7804], [0.3938], [0.5506]]], [[[0.1047], [0.6517], [0.2613]], [[0.2816], [0.0513], [0.5327]], [[0.9742], [0.2477], [0.4216]], [[0.7564], [0.7883], [0.5087]]], [[[0.3547], [0.7528], [0.4427]], [[0.086], [0.2642], [0.0196]], [[0.0354], [0.522], [0.8412]], [[0.8267], [0.1426], [0.9031]]], [[[0.9027], [0.7776], [0.9552]], [[0.0618], [0.2981], [0.3833]], [[0.4964], [0.0343], [0.8318]], [[0.7506], [0.4389], [0.6235]]]],[[[[0.1012, 0.2408], [0.6367, 0.941], [0.8318, 0.2198]]]]],[0, 0], 2, 2, true, Sep30226), 
LRes17782 = reshape_layer(Sep30226, [2, 4], Res17782), 
LAdd36979 = add_layer([[[[[0.4307, 0.6338]], [[0.7362, 0.5]]]], [[[[0.8938, 0.3348]], [[0.3016, 0.5852]]]]], Add36979), 
LRes90040 = reshape_layer(Add36979, [2, 2], Res90040), 
LGlo55058 = global_average_pooling3D_layer([[[[[1.9608], [1.8231]]], [[[1.8781], [1.4378]]]]], Glo55058), 
LRes38747 = reshape_layer(Glo55058, [1, 1], Res38747), 
LCon46904 = concatenate_layer([Res38747,[[[0.5485]]]], 2, Con46904), 
LAve56777 = average_pooling2D_layer([[[[1.9283, 1.5773]]]], 1, 1, Ave56777), 
LRes91664 = reshape_layer(Ave56777, [1, 2], Res91664), 
LDot51004 = dot_layer(Con46904,Res91664, 1, 1, Dot51004), 
LCro89866 = cropping1D_layer(Dot51004, 0, 0, Cro89866), 
LDot32325 = dot_layer(Res90040,Cro89866, 1, 2, Dot32325), 
LCon15468 = concatenate_layer([Dot32325,[[[0.8223, 0.4585], [0.7886, 0.9552]]]], 2, Con15468), 
LSub35157 = subtract_layer(Res17782,Con15468, Sub35157), 
exec_layers([LMul2965,LZer1740,LRes1063,LSep30226,LRes17782,LAdd36979,LRes90040,LGlo55058,LRes38747,LCon46904,LAve56777,LRes91664,LDot51004,LCro89866,LDot32325,LCon15468,LSub35157],["Mul2965","Zer1740","Res1063","Sep30226","Res17782","Add36979","Res90040","Glo55058","Res38747","Con46904","Ave56777","Res91664","Dot51004","Cro89866","Dot32325","Con15468","Sub35157"],Sub35157,"Sub35157")

Actual (Unparsed): [[[-7.2488996, -2.0181731, -0.3390095, 0.2557711], [-6.1352938, -1.6410897, -0.3053976, -0.2410592]]]

Expected (Unparsed): [[[-7.248899454567785,-2.0181731279548716,-0.3390094382844202,0.2557711144563538],[-6.135293648166063,-1.6410896115265359,-0.3053976021461542,-0.2410591858324661]]]

Actual:   [[[-7.2488, -2.0181, -0.339, 0.2558], [-6.1352, -1.641, -0.3053, -0.241]]]

Expected: [[[-7.2488, -2.0181, -0.339, 0.2558], [-6.1352, -1.641, -0.3053, -0.241]]]