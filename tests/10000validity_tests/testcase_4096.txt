import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sim17071 = tf.keras.layers.Input(shape=([1, 2]))
in0Ave90838 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con90477 = tf.keras.layers.Input(shape=([1]))
in0Con35569 = tf.keras.layers.Input(shape=([2, 3, 1]))
in0Ave4271 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Ave4271 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Dot91298 = tf.keras.layers.Input(shape=([2]))
in1Dot91298 = tf.keras.layers.Input(shape=([2]))
in0Con88408 = tf.keras.layers.Input(shape=([1, 2, 1]))

Sim17071 = keras.layers.SimpleRNN(2,name = 'Sim17071', )(in0Sim17071)
Res35685 = keras.layers.Reshape((2, 1), name = 'Res35685', )(Sim17071)
Ave28361 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave28361', )(Res35685)
Fla41011 = keras.layers.Flatten(name = 'Fla41011', )(Ave28361)
Ave90838 = keras.layers.AveragePooling2D(pool_size=(1, 2), strides=(1, 1), padding='valid', name = 'Ave90838', )(in0Ave90838)
Fla39002 = keras.layers.Flatten(name = 'Fla39002', )(Ave90838)
Con90477 = keras.layers.Concatenate(axis=1, name = 'Con90477', )([Fla39002,in0Con90477])
Mul24978 = keras.layers.Multiply(name = 'Mul24978', )([Fla41011,Con90477])
Res26429 = keras.layers.Reshape((2, 1), name = 'Res26429', )(Mul24978)
Res70794 = keras.layers.Reshape((2, 1, 1), name = 'Res70794', )(Res26429)
Zer86157 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer86157', )(Res70794)
Con35569 = keras.layers.Concatenate(axis=3, name = 'Con35569', )([Zer86157,in0Con35569])
Ave4271 = keras.layers.Average(name = 'Ave4271', )([in0Ave4271,in1Ave4271])
Res18087 = keras.layers.Reshape((1, 2, 2), name = 'Res18087', )(Ave4271)
Dot91298 = keras.layers.Dot(axes=(1, 1), name = 'Dot91298', )([in0Dot91298,in1Dot91298])
Res86089 = keras.layers.Reshape((1, 1), name = 'Res86089', )(Dot91298)
Res32249 = keras.layers.Reshape((1, 1, 1), name = 'Res32249', )(Res86089)
Ave52436 = keras.layers.AveragePooling2D(pool_size=(1, 1), strides=(1, 1), padding='valid', name = 'Ave52436', )(Res32249)
Zer18753 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer18753', )(Ave52436)
Con88408 = keras.layers.Concatenate(axis=3, name = 'Con88408', )([Zer18753,in0Con88408])
Add3121 = keras.layers.Add(name = 'Add3121', )([Res18087,Con88408])
Zer17412 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer17412', )(Add3121)
Mul23740 = keras.layers.Multiply(name = 'Mul23740', )([Con35569,Zer17412])
model = tf.keras.models.Model(inputs=[in0Sim17071,in0Ave90838,in0Con90477,in0Con35569,in0Ave4271,in1Ave4271,in0Dot91298,in1Dot91298,in0Con88408], outputs=Mul23740)
w = model.get_layer('Sim17071').get_weights() 
w[0] = np.array([[2, 2], [6, 4]])
w[1] = np.array([[5, 5], [7, 10]])
w[2] = np.array([9, 5])
model.get_layer('Sim17071').set_weights(w) 
in0Sim17071 = tf.constant([[[9, 9]]])
in0Ave90838 = tf.constant([[[[1.7126], [1.8891]]]])
in0Con90477 = tf.constant([[0.3284]])
in0Con35569 = tf.constant([[[[0.6362], [0.4925], [0.2226]], [[0.8246], [0.3744], [0.5239]]]])
in0Ave4271 = tf.constant([[[[[0.1806, 0.6699]], [[0.6609, 0.5176]]]]])
in1Ave4271 = tf.constant([[[[[0.3991, 0.6371]], [[0.9743, 0.0274]]]]])
in0Dot91298 = tf.constant([[0.9652, 0.5838]])
in1Dot91298 = tf.constant([[0.688, 0.5287]])
in0Con88408 = tf.constant([[[[0.7839], [0.5373]]]])
print (np.array2string(model.predict([in0Sim17071,in0Ave90838,in0Con90477,in0Con35569,in0Ave4271,in1Ave4271,in0Dot91298,in1Dot91298,in0Con88408],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul23740.png')

LSim17071 = simple_rnn_layer([[[9, 9]]],[[2, 2], [6, 4]],[[5, 5], [7, 10]],[9, 5], Sim17071), 
LRes35685 = reshape_layer(Sim17071, [2, 1], Res35685), 
LAve28361 = average_pooling1D_layer(Res35685, 1, Ave28361), 
LFla41011 = flatten_layer(Ave28361, Fla41011), 
LAve90838 = average_pooling2D_layer([[[[1.7126], [1.8891]]]], 1, 2, 1, 1, false, Ave90838), 
LFla39002 = flatten_layer(Ave90838, Fla39002), 
LCon90477 = concatenate_layer([Fla39002,[[0.3284]]], 1, Con90477), 
LMul24978 = multiply_layer([Fla41011,Con90477], Mul24978), 
LRes26429 = reshape_layer(Mul24978, [2, 1], Res26429), 
LRes70794 = reshape_layer(Res26429, [2, 1, 1], Res70794), 
LZer86157 = zero_padding2D_layer(Res70794, 0, 0, 2, 0, Zer86157), 
LCon35569 = concatenate_layer([Zer86157,[[[[0.6362], [0.4925], [0.2226]], [[0.8246], [0.3744], [0.5239]]]]], 3, Con35569), 
LAve4271 = average_layer([[[[[[0.1806, 0.6699]], [[0.6609, 0.5176]]]]], [[[[[0.3991, 0.6371]], [[0.9743, 0.0274]]]]]], Ave4271), 
LRes18087 = reshape_layer(Ave4271, [1, 2, 2], Res18087), 
LDot91298 = dot_layer([[0.9652, 0.5838]], [[0.688, 0.5287]], 1, 1, Dot91298), 
LRes86089 = reshape_layer(Dot91298, [1, 1], Res86089), 
LRes32249 = reshape_layer(Res86089, [1, 1, 1], Res32249), 
LAve52436 = average_pooling2D_layer(Res32249, 1, 1, 1, 1, false, Ave52436), 
LZer18753 = zero_padding2D_layer(Ave52436, 0, 0, 1, 0, Zer18753), 
LCon88408 = concatenate_layer([Zer18753,[[[[0.7839], [0.5373]]]]], 3, Con88408), 
LAdd3121 = add_layer([Res18087,Con88408], Add3121), 
LZer17412 = zero_padding2D_layer(Add3121, 1, 0, 1, 0, Zer17412), 
LMul23740 = multiply_layer([Con35569,Zer17412], Mul23740), 
exec_layers([LSim17071,LRes35685,LAve28361,LFla41011,LAve90838,LFla39002,LCon90477,LMul24978,LRes26429,LRes70794,LZer86157,LCon35569,LAve4271,LRes18087,LDot91298,LRes86089,LRes32249,LAve52436,LZer18753,LCon88408,LAdd3121,LZer17412,LMul23740],["Sim17071","Res35685","Ave28361","Fla41011","Ave90838","Fla39002","Con90477","Mul24978","Res26429","Res70794","Zer86157","Con35569","Ave4271","Res18087","Dot91298","Res86089","Res32249","Ave52436","Zer18753","Con88408","Add3121","Zer17412","Mul23740"],Mul23740,"Mul23740")

Actual (Unparsed): [[[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.5381626], [0.5879387, 0.4242542]]]]

Expected (Unparsed): [[[[0,0.0],[0,0.0],[0.0,0.0]],[[0,0.0],[0.0,0.5381625600000001],[0.5879386775440001,0.42425422]]]]

Actual:   [[[[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0.5382], [0.588, 0.4243]]]]

Expected: [[[[0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0.5382], [0.588, 0.4243]]]]