import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max76089 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Max76089 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Dep84775 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Ave71844 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave71844 = tf.keras.layers.Input(shape=([2, 1]))

Max76089 = keras.layers.Maximum(name = 'Max76089', )([in0Max76089,in1Max76089])
Res94505 = keras.layers.Reshape((1, 1, 2), name = 'Res94505', )(Max76089)
Res81952 = keras.layers.Reshape((1, 2), name = 'Res81952', )(Res94505)
Fla8622 = keras.layers.Flatten(name = 'Fla8622', )(Res81952)
Dep84775 = keras.layers.DepthwiseConv2D((2, 1),strides=(1, 1), padding='same', name = 'Dep84775', )(in0Dep84775)
Res45753 = keras.layers.Reshape((2, 1), name = 'Res45753', )(Dep84775)
Ave71844 = keras.layers.Average(name = 'Ave71844', )([in0Ave71844,in1Ave71844])
Max55394 = keras.layers.Maximum(name = 'Max55394', )([Res45753,Ave71844])
Res38083 = keras.layers.Reshape((2, 1, 1), name = 'Res38083', )(Max55394)
Res6745 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res6745', )(Res38083)
Con71831 = keras.layers.Conv3DTranspose(4, (2, 1, 1),strides=(1, 1, 1), padding='same', name = 'Con71831', )(Res6745)
Res13722 = keras.layers.Reshape((2, 1, 4), name = 'Res13722', )(Con71831)
Res48889 = keras.layers.Reshape((2, 4), name = 'Res48889', )(Res13722)
LST79994 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST79994', )(Res48889)
Ave37590 = keras.layers.Average(name = 'Ave37590', )([Fla8622,LST79994])
model = tf.keras.models.Model(inputs=[in0Max76089,in1Max76089,in0Dep84775,in0Ave71844,in1Ave71844], outputs=Ave37590)
w = model.get_layer('Dep84775').get_weights() 
w[0] = np.array([[[[0.2509]]], [[[0.3992]]]])
w[1] = np.array([0])
model.get_layer('Dep84775').set_weights(w) 
w = model.get_layer('Con71831').get_weights() 
w[0] = np.array([[[[[0.9109], [0.0837], [0.8453], [0.5419]]]], [[[[0.5619], [0.0189], [0.8197], [0.6932]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con71831').set_weights(w) 
w = model.get_layer('LST79994').get_weights() 
w[0] = np.array([[2, 1, 9, 10, 9, 10, 3, 7], [9, 9, 8, 9, 2, 10, 3, 6], [7, 9, 8, 4, 10, 3, 1, 5], [4, 5, 10, 7, 2, 4, 10, 2]])
w[1] = np.array([[8, 10, 1, 3, 9, 1, 10, 4], [3, 5, 3, 6, 5, 1, 5, 1]])
w[2] = np.array([5, 6, 8, 5, 10, 5, 9, 5])
model.get_layer('LST79994').set_weights(w) 
in0Max76089 = tf.constant([[[[[0.418], [0.9514]]]]])
in1Max76089 = tf.constant([[[[[0.0072], [0.4964]]]]])
in0Dep84775 = tf.constant([[[[0.3848]], [[0.7992]]]])
in0Ave71844 = tf.constant([[[0.5513], [0.204]]])
in1Ave71844 = tf.constant([[[0.5318], [0.1889]]])
print (np.array2string(model.predict([in0Max76089,in1Max76089,in0Dep84775,in0Ave71844,in1Ave71844],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave37590.png')

LMax76089 = maximum_layer([[[[[[0.418], [0.9514]]]]], [[[[[0.0072], [0.4964]]]]]], Max76089), 
LRes94505 = reshape_layer(Max76089, [1, 1, 2], Res94505), 
LRes81952 = reshape_layer(Res94505, [1, 2], Res81952), 
LFla8622 = flatten_layer(Res81952, Fla8622), 
LDep84775 = depthwise_conv2D_layer([[[[0.3848]], [[0.7992]]]], 2, 1,[[[[0.2509]]], [[[0.3992]]]],[0], 1, 1, true, Dep84775), 
LRes45753 = reshape_layer(Dep84775, [2, 1], Res45753), 
LAve71844 = average_layer([[[[0.5513], [0.204]]], [[[0.5318], [0.1889]]]], Ave71844), 
LMax55394 = maximum_layer([Res45753,Ave71844], Max55394), 
LRes38083 = reshape_layer(Max55394, [2, 1, 1], Res38083), 
LRes6745 = reshape_layer(Res38083, [2, 1, 1, 1], Res6745), 
LCon71831 = conv3D_transpose_layer(Res6745, 2, 1, 1,[[[[[0.9109], [0.0837], [0.8453], [0.5419]]]], [[[[0.5619], [0.0189], [0.8197], [0.6932]]]]],[0, 0, 0, 0], 1, 1, 1, true, Con71831), 
LRes13722 = reshape_layer(Con71831, [2, 1, 4], Res13722), 
LRes48889 = reshape_layer(Res13722, [2, 4], Res48889), 
LLST79994 = lstm_layer(Res48889,[[2, 1, 9, 10, 9, 10, 3, 7], [9, 9, 8, 9, 2, 10, 3, 6], [7, 9, 8, 4, 10, 3, 1, 5], [4, 5, 10, 7, 2, 4, 10, 2]],[[8, 10, 1, 3, 9, 1, 10, 4], [3, 5, 3, 6, 5, 1, 5, 1]],[5, 6, 8, 5, 10, 5, 9, 5], LST79994), 
LAve37590 = average_layer([Fla8622,LST79994], Ave37590), 
exec_layers([LMax76089,LRes94505,LRes81952,LFla8622,LDep84775,LRes45753,LAve71844,LMax55394,LRes38083,LRes6745,LCon71831,LRes13722,LRes48889,LLST79994,LAve37590],["Max76089","Res94505","Res81952","Fla8622","Dep84775","Res45753","Ave71844","Max55394","Res38083","Res6745","Con71831","Res13722","Res48889","LST79994","Ave37590"],Ave37590,"Ave37590")

Actual (Unparsed): [[0.6910131, 0.9577136]]

Expected (Unparsed): [[0.6910130495257314,0.9577136210080468]]

Actual:   [[0.6911, 0.9578]]

Expected: [[0.6911, 0.9578]]