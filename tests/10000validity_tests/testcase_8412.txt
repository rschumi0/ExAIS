import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave19327 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Ave19327 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Con55528 = tf.keras.layers.Input(shape=([8, 3, 1]))
in0Add71640 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Add71640 = tf.keras.layers.Input(shape=([1, 2, 2]))

Ave19327 = keras.layers.Average(name = 'Ave19327', )([in0Ave19327,in1Ave19327])
Fla49932 = keras.layers.Flatten(name = 'Fla49932', )(Ave19327)
Res15925 = keras.layers.Reshape((8, 1), name = 'Res15925', )(Fla49932)
Res89571 = keras.layers.Reshape((8, 1, 1), name = 'Res89571', )(Res15925)
Zer62907 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer62907', )(Res89571)
Con55528 = keras.layers.Concatenate(axis=3, name = 'Con55528', )([Zer62907,in0Con55528])
Add71640 = keras.layers.Add(name = 'Add71640', )([in0Add71640,in1Add71640])
Zer58274 = keras.layers.ZeroPadding2D(padding=((7, 0), (1, 0)), name = 'Zer58274', )(Add71640)
Add54025 = keras.layers.Add(name = 'Add54025', )([Con55528,Zer58274])
Res52318 = keras.layers.Reshape((8, 6), name = 'Res52318', )(Add54025)
LST62693 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST62693', )(Res52318)
model = tf.keras.models.Model(inputs=[in0Ave19327,in1Ave19327,in0Con55528,in0Add71640,in1Add71640], outputs=LST62693)
w = model.get_layer('LST62693').get_weights() 
w[0] = np.array([[9, 3, 4, 3, 6, 6, 2, 10, 9, 1, 2, 9], [3, 5, 3, 2, 1, 10, 3, 4, 6, 5, 2, 10], [8, 6, 4, 1, 9, 5, 3, 9, 7, 6, 8, 6], [5, 7, 7, 8, 2, 4, 5, 5, 9, 6, 9, 3], [10, 3, 6, 6, 8, 9, 4, 6, 5, 2, 2, 6], [9, 4, 3, 1, 8, 7, 3, 10, 7, 10, 5, 9]])
w[1] = np.array([[8, 5, 3, 3, 1, 4, 10, 2, 2, 5, 6, 5], [3, 3, 9, 7, 5, 1, 6, 1, 1, 6, 4, 7], [7, 4, 3, 9, 10, 6, 3, 3, 10, 10, 9, 3]])
w[2] = np.array([10, 2, 1, 5, 6, 5, 5, 1, 10, 9, 10, 6])
model.get_layer('LST62693').set_weights(w) 
in0Ave19327 = tf.constant([[[[[0.0719, 0.7274]], [[0.5135, 0.5846]]], [[[0.9142, 0.7982]], [[0.6843, 0.3902]]]]])
in1Ave19327 = tf.constant([[[[[0.1922, 0.5566]], [[0.2163, 0.4069]]], [[[0.7809, 0.893]], [[0.675, 0.7373]]]]])
in0Con55528 = tf.constant([[[[0.033], [0.8911], [0.5341]], [[0.6455], [0.4257], [0.9033]], [[0.8429], [0.1497], [0.3826]], [[0.6806], [0.6412], [0.0851]], [[0.4383], [0.0956], [0.6567]], [[0.3245], [0.7523], [0.0254]], [[0.3067], [0.0173], [0.073]], [[0.1417], [0.9931], [0.1836]]]])
in0Add71640 = tf.constant([[[[0.0165, 0.2008], [0.3029, 0.6917]]]])
in1Add71640 = tf.constant([[[[0.6, 0.4623], [0.9762, 0.0061]]]])
print (np.array2string(model.predict([in0Ave19327,in1Ave19327,in0Con55528,in0Add71640,in1Add71640],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST62693.png')

LAve19327 = average_layer([[[[[[0.0719, 0.7274]], [[0.5135, 0.5846]]], [[[0.9142, 0.7982]], [[0.6843, 0.3902]]]]], [[[[[0.1922, 0.5566]], [[0.2163, 0.4069]]], [[[0.7809, 0.893]], [[0.675, 0.7373]]]]]], Ave19327), 
LFla49932 = flatten_layer(Ave19327, Fla49932), 
LRes15925 = reshape_layer(Fla49932, [8, 1], Res15925), 
LRes89571 = reshape_layer(Res15925, [8, 1, 1], Res89571), 
LZer62907 = zero_padding2D_layer(Res89571, 0, 0, 2, 0, Zer62907), 
LCon55528 = concatenate_layer([Zer62907,[[[[0.033], [0.8911], [0.5341]], [[0.6455], [0.4257], [0.9033]], [[0.8429], [0.1497], [0.3826]], [[0.6806], [0.6412], [0.0851]], [[0.4383], [0.0956], [0.6567]], [[0.3245], [0.7523], [0.0254]], [[0.3067], [0.0173], [0.073]], [[0.1417], [0.9931], [0.1836]]]]], 3, Con55528), 
LAdd71640 = add_layer([[[[[0.0165, 0.2008], [0.3029, 0.6917]]]], [[[[0.6, 0.4623], [0.9762, 0.0061]]]]], Add71640), 
LZer58274 = zero_padding2D_layer(Add71640, 7, 0, 1, 0, Zer58274), 
LAdd54025 = add_layer([Con55528,Zer58274], Add54025), 
LRes52318 = reshape_layer(Add54025, [8, 6], Res52318), 
LLST62693 = lstm_layer(Res52318,[[9, 3, 4, 3, 6, 6, 2, 10, 9, 1, 2, 9], [3, 5, 3, 2, 1, 10, 3, 4, 6, 5, 2, 10], [8, 6, 4, 1, 9, 5, 3, 9, 7, 6, 8, 6], [5, 7, 7, 8, 2, 4, 5, 5, 9, 6, 9, 3], [10, 3, 6, 6, 8, 9, 4, 6, 5, 2, 2, 6], [9, 4, 3, 1, 8, 7, 3, 10, 7, 10, 5, 9]],[[8, 5, 3, 3, 1, 4, 10, 2, 2, 5, 6, 5], [3, 3, 9, 7, 5, 1, 6, 1, 1, 6, 4, 7], [7, 4, 3, 9, 10, 6, 3, 3, 10, 10, 9, 3]],[10, 2, 1, 5, 6, 5, 5, 1, 10, 9, 10, 6], LST62693), 
exec_layers([LAve19327,LFla49932,LRes15925,LRes89571,LZer62907,LCon55528,LAdd71640,LZer58274,LAdd54025,LRes52318,LLST62693],["Ave19327","Fla49932","Res15925","Res89571","Zer62907","Con55528","Add71640","Zer58274","Add54025","Res52318","LST62693"],LST62693,"LST62693")

Actual (Unparsed): [[0.9999998, 0.9999998, 0.9999998]]

Expected (Unparsed): [[0.9999997749296754,0.9999997749216474,0.9999997749029395]]

Actual:   [[1, 1, 1]]

Expected: [[1, 1, 1]]