import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min12678 = tf.keras.layers.Input(shape=([1, 1]))
in1Min12678 = tf.keras.layers.Input(shape=([1, 1]))
in0Con53804 = tf.keras.layers.Input(shape=([1, 3]))
in0Glo14270 = tf.keras.layers.Input(shape=([2, 1]))
in0Con12751 = tf.keras.layers.Input(shape=([1, 3]))
in0Max43569 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Max43569 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))

Min12678 = keras.layers.Minimum(name = 'Min12678', )([in0Min12678,in1Min12678])
Res86933 = keras.layers.Reshape((1, 1, 1), name = 'Res86933', )(Min12678)
Res9404 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res9404', )(Res86933)
Glo44089 = keras.layers.GlobalMaxPool3D(name = 'Glo44089', )(Res9404)
Res54300 = keras.layers.Reshape((1, 1), name = 'Res54300', )(Glo44089)
Res35000 = keras.layers.Reshape((1, 1, 1), name = 'Res35000', )(Res54300)
Res3840 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res3840', )(Res35000)
Cro88397 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro88397', )(Res3840)
Res74967 = keras.layers.Reshape((1, 1, 1), name = 'Res74967', )(Cro88397)
Glo88745 = keras.layers.GlobalMaxPool2D(name = 'Glo88745', )(Res74967)
Res97618 = keras.layers.Reshape((1, 1), name = 'Res97618', )(Glo88745)
Con53804 = keras.layers.Concatenate(axis=2, name = 'Con53804', )([Res97618,in0Con53804])
Glo14270 = keras.layers.GlobalMaxPool1D(name = 'Glo14270', )(in0Glo14270)
Res76338 = keras.layers.Reshape((1, 1), name = 'Res76338', )(Glo14270)
Con12751 = keras.layers.Concatenate(axis=2, name = 'Con12751', )([Res76338,in0Con12751])
Max43569 = keras.layers.Maximum(name = 'Max43569', )([in0Max43569,in1Max43569])
Res86729 = keras.layers.Reshape((2, 1, 2), name = 'Res86729', )(Max43569)
Res42644 = keras.layers.Reshape((2, 2), name = 'Res42644', )(Res86729)
Sep61811 = keras.layers.SeparableConv1D(4, (1),strides=(2), padding='valid', name = 'Sep61811', )(Res42644)
Min53243 = keras.layers.Minimum(name = 'Min53243', )([Con12751,Sep61811])
Dot96813 = keras.layers.Dot(axes=(1, 1), name = 'Dot96813', )([Con53804,Min53243])
model = tf.keras.models.Model(inputs=[in0Min12678,in1Min12678,in0Con53804,in0Glo14270,in0Con12751,in0Max43569,in1Max43569], outputs=Dot96813)
w = model.get_layer('Sep61811').get_weights() 
w[0] = np.array([[[0.0492], [0.6663]]])
w[1] = np.array([[[0.6895, 0.1344, 0.229, 0.3311], [0.4376, 0.7015, 0.1309, 0.4644]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep61811').set_weights(w) 
in0Min12678 = tf.constant([[[0.7362]]])
in1Min12678 = tf.constant([[[0.4639]]])
in0Con53804 = tf.constant([[[0.6568, 0.6004, 0.5888]]])
in0Glo14270 = tf.constant([[[1.7774], [1.5248]]])
in0Con12751 = tf.constant([[[0.91, 0.9896, 0.4158]]])
in0Max43569 = tf.constant([[[[[0.5561], [0.5898]]], [[[0.283], [0.3681]]]]])
in1Max43569 = tf.constant([[[[[0.7132], [0.5617]]], [[[0.5768], [0.2452]]]]])
print (np.array2string(model.predict([in0Min12678,in1Min12678,in0Con53804,in0Glo14270,in0Con12751,in0Max43569,in1Max43569],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot96813.png')

LMin12678 = minimum_layer([[[[0.7362]]], [[[0.4639]]]], Min12678), 
LRes86933 = reshape_layer(Min12678, [1, 1, 1], Res86933), 
LRes9404 = reshape_layer(Res86933, [1, 1, 1, 1], Res9404), 
LGlo44089 = global_max_pool3D_layer(Res9404, Glo44089), 
LRes54300 = reshape_layer(Glo44089, [1, 1], Res54300), 
LRes35000 = reshape_layer(Res54300, [1, 1, 1], Res35000), 
LRes3840 = reshape_layer(Res35000, [1, 1, 1, 1], Res3840), 
LCro88397 = cropping3D_layer(Res3840, 0, 0, 0, 0, 0, 0, Cro88397), 
LRes74967 = reshape_layer(Cro88397, [1, 1, 1], Res74967), 
LGlo88745 = global_max_pool2D_layer(Res74967, Glo88745), 
LRes97618 = reshape_layer(Glo88745, [1, 1], Res97618), 
LCon53804 = concatenate_layer([Res97618,[[[0.6568, 0.6004, 0.5888]]]], 2, Con53804), 
LGlo14270 = global_max_pool1D_layer([[[1.7774], [1.5248]]], Glo14270), 
LRes76338 = reshape_layer(Glo14270, [1, 1], Res76338), 
LCon12751 = concatenate_layer([Res76338,[[[0.91, 0.9896, 0.4158]]]], 2, Con12751), 
LMax43569 = maximum_layer([[[[[[0.5561], [0.5898]]], [[[0.283], [0.3681]]]]], [[[[[0.7132], [0.5617]]], [[[0.5768], [0.2452]]]]]], Max43569), 
LRes86729 = reshape_layer(Max43569, [2, 1, 2], Res86729), 
LRes42644 = reshape_layer(Res86729, [2, 2], Res42644), 
LSep61811 = separable_conv1D_layer(Res42644, 1,[[[[0.0492], [0.6663]]],[[[0.6895, 0.1344, 0.229, 0.3311], [0.4376, 0.7015, 0.1309, 0.4644]]]],[0, 0, 0, 0], 2, false, Sep61811), 
LMin53243 = minimum_layer([Con12751,Sep61811], Min53243), 
LDot96813 = dot_layer(Con53804,Min53243, 1, 1, Dot96813), 
exec_layers([LMin12678,LRes86933,LRes9404,LGlo44089,LRes54300,LRes35000,LRes3840,LCro88397,LRes74967,LGlo88745,LRes97618,LCon53804,LGlo14270,LRes76338,LCon12751,LMax43569,LRes86729,LRes42644,LSep61811,LMin53243,LDot96813],["Min12678","Res86933","Res9404","Glo44089","Res54300","Res35000","Res3840","Cro88397","Res74967","Glo88745","Res97618","Con53804","Glo14270","Res76338","Con12751","Max43569","Res86729","Res42644","Sep61811","Min53243","Dot96813"],Dot96813,"Dot96813")

Actual (Unparsed): [[[0.0910004, 0.1300748, 0.0275914, 0.0900522], [0.1288404, 0.1841628, 0.0390645, 0.1274979], [0.1177768, 0.1683486, 0.0357100, 0.1165495], [0.1155013, 0.1650961, 0.0350201, 0.1142977]]]

Expected (Unparsed): [[[0.09100041164050558,0.1300748296451094,0.027591405037931397,0.090052157795916],[0.1288404189814272,0.18416285430245283,0.0390645286245168,0.127497859970592],[0.1177767776438016,0.16834862625333843,0.0357100228169304,0.116549505368976],[0.11550127694315519,0.16509605452692483,0.0350200889983488,0.11429771612467199]]]

Actual:   [[[0.0911, 0.1301, 0.0276, 0.0901], [0.1289, 0.1842, 0.0391, 0.1275], [0.1178, 0.1684, 0.0358, 0.1166], [0.1156, 0.1651, 0.0351, 0.1143]]]

Expected: [[[0.0911, 0.1301, 0.0276, 0.0901], [0.1289, 0.1842, 0.0391, 0.1275], [0.1178, 0.1684, 0.0358, 0.1166], [0.1156, 0.1651, 0.0351, 0.1143]]]