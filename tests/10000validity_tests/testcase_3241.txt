import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min96605 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Min96605 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con50700 = tf.keras.layers.Input(shape=([2, 2]))
in0Up_25607 = tf.keras.layers.Input(shape=([1, 1, 3]))
in0Bat57017 = tf.keras.layers.Input(shape=([3]))
in0Con30807 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Dot70772 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot70772 = tf.keras.layers.Input(shape=([3, 2]))
in0Con72342 = tf.keras.layers.Input(shape=([2, 4]))

Min96605 = keras.layers.Minimum(name = 'Min96605', )([in0Min96605,in1Min96605])
Res13055 = keras.layers.Reshape((2, 4), name = 'Res13055', )(Min96605)
Con50700 = keras.layers.Concatenate(axis=2, name = 'Con50700', )([Res13055,in0Con50700])
Up_25607 = keras.layers.UpSampling2D(size=(2, 2), name = 'Up_25607', )(in0Up_25607)
Thr23837 = keras.layers.ThresholdedReLU(theta=6.888179317427829, name = 'Thr23837', )(Up_25607)
Bat57017 = keras.layers.BatchNormalization(axis=1, epsilon=0.9251042826983603,  name = 'Bat57017', )(in0Bat57017)
Res22407 = keras.layers.Reshape((3, 1), name = 'Res22407', )(Bat57017)
Res28161 = keras.layers.Reshape((3, 1, 1), name = 'Res28161', )(Res22407)
Dep93745 = keras.layers.DepthwiseConv2D((2, 1),strides=(2, 2), padding='same', name = 'Dep93745', )(Res28161)
Zer57933 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer57933', )(Dep93745)
Con30807 = keras.layers.Concatenate(axis=3, name = 'Con30807', )([Zer57933,in0Con30807])
Sub37498 = keras.layers.Subtract(name = 'Sub37498', )([Thr23837,Con30807])
Res17005 = keras.layers.Reshape((2, 6), name = 'Res17005', )(Sub37498)
Dot70772 = keras.layers.Dot(axes=(1, 1), name = 'Dot70772', )([in0Dot70772,in1Dot70772])
Bat29347 = keras.layers.BatchNormalization(axis=2, epsilon=0.7839203123649233,  name = 'Bat29347', )(Dot70772)
Con72342 = keras.layers.Concatenate(axis=2, name = 'Con72342', )([Bat29347,in0Con72342])
Sub59497 = keras.layers.Subtract(name = 'Sub59497', )([Res17005,Con72342])
Ave51394 = keras.layers.Average(name = 'Ave51394', )([Con50700,Sub59497])
model = tf.keras.models.Model(inputs=[in0Min96605,in1Min96605,in0Con50700,in0Up_25607,in0Bat57017,in0Con30807,in0Dot70772,in1Dot70772,in0Con72342], outputs=Ave51394)
w = model.get_layer('Bat57017').get_weights() 
w[0] = np.array([0.2494, 0.9242, 0.6555])
w[1] = np.array([0.4879, 0.605, 0.2302])
w[2] = np.array([0.7163, 0.5722, 0.5917])
w[3] = np.array([0.2612, 0.9749, 0.8669])
model.get_layer('Bat57017').set_weights(w) 
w = model.get_layer('Dep93745').get_weights() 
w[0] = np.array([[[[0.0101]]], [[[0.5327]]]])
w[1] = np.array([0])
model.get_layer('Dep93745').set_weights(w) 
w = model.get_layer('Bat29347').get_weights() 
w[0] = np.array([0.2693, 0.7325])
w[1] = np.array([0.7047, 0.3721])
w[2] = np.array([0.8203, 0.3764])
w[3] = np.array([0.268, 0.7574])
model.get_layer('Bat29347').set_weights(w) 
in0Min96605 = tf.constant([[[[0.9163, 0.0545], [0.341, 0.4667]], [[0.4829, 0.794], [0.3862, 0.242]]]])
in1Min96605 = tf.constant([[[[0.4026, 0.7669], [0.4159, 0.5382]], [[0.3949, 0.2232], [0.4376, 0.6727]]]])
in0Con50700 = tf.constant([[[0.3391, 0.8844], [0.2065, 0.2618]]])
in0Up_25607 = tf.constant([[[[1.2009, 1.6502, 1.1773]]]])
in0Bat57017 = tf.constant([[1.0472, 1.8474, 1.5843]])
in0Con30807 = tf.constant([[[[0.2379, 0.4634], [0.9984, 0.3195]], [[0.7912, 0.8111], [0.3356, 0.9446]]]])
in0Dot70772 = tf.constant([[[0.7207, 0.201], [0.6172, 0.2409], [0.9497, 0.5553]]])
in1Dot70772 = tf.constant([[[0.9466, 0.8677], [0.7104, 0.1112], [0.2231, 0.079]]])
in0Con72342 = tf.constant([[[0.5486, 0.7201, 0.1305, 0.2772], [0.1652, 0.5761, 0.5159, 0.0842]]])
print (np.array2string(model.predict([in0Min96605,in1Min96605,in0Con50700,in0Up_25607,in0Bat57017,in0Con30807,in0Dot70772,in1Dot70772,in0Con72342],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave51394.png')

LMin96605 = minimum_layer([[[[[0.9163, 0.0545], [0.341, 0.4667]], [[0.4829, 0.794], [0.3862, 0.242]]]], [[[[0.4026, 0.7669], [0.4159, 0.5382]], [[0.3949, 0.2232], [0.4376, 0.6727]]]]], Min96605), 
LRes13055 = reshape_layer(Min96605, [2, 4], Res13055), 
LCon50700 = concatenate_layer([Res13055,[[[0.3391, 0.8844], [0.2065, 0.2618]]]], 2, Con50700), 
LUp_25607 = up_sampling2D_layer([[[[1.2009, 1.6502, 1.1773]]]], 2, 2, Up_25607), 
LThr23837 = thresholded_relu_layer(Up_25607, 6.888179317427829, Thr23837), 
LBat57017 = batch_normalization_layer([[1.0472, 1.8474, 1.5843]], 1, 0.9251042826983603, [0.2494, 0.9242, 0.6555], [0.4879, 0.605, 0.2302], [0.7163, 0.5722, 0.5917], [0.2612, 0.9749, 0.8669], Bat57017), 
LRes22407 = reshape_layer(Bat57017, [3, 1], Res22407), 
LRes28161 = reshape_layer(Res22407, [3, 1, 1], Res28161), 
LDep93745 = depthwise_conv2D_layer(Res28161, 2, 1,[[[[0.0101]]], [[[0.5327]]]],[0], 2, 2, true, Dep93745), 
LZer57933 = zero_padding2D_layer(Dep93745, 0, 0, 1, 0, Zer57933), 
LCon30807 = concatenate_layer([Zer57933,[[[[0.2379, 0.4634], [0.9984, 0.3195]], [[0.7912, 0.8111], [0.3356, 0.9446]]]]], 3, Con30807), 
LSub37498 = subtract_layer(Thr23837,Con30807, Sub37498), 
LRes17005 = reshape_layer(Sub37498, [2, 6], Res17005), 
LDot70772 = dot_layer([[[0.7207, 0.201], [0.6172, 0.2409], [0.9497, 0.5553]]], [[[0.9466, 0.8677], [0.7104, 0.1112], [0.2231, 0.079]]], 1, 1, Dot70772), 
LBat29347 = batch_normalization_layer(Dot70772, 2, 0.7839203123649233, [0.2693, 0.7325], [0.7047, 0.3721], [0.8203, 0.3764], [0.268, 0.7574], Bat29347), 
LCon72342 = concatenate_layer([Bat29347,[[[0.5486, 0.7201, 0.1305, 0.2772], [0.1652, 0.5761, 0.5159, 0.0842]]]], 2, Con72342), 
LSub59497 = subtract_layer(Res17005,Con72342, Sub59497), 
LAve51394 = average_layer([Con50700,Sub59497], Ave51394), 
exec_layers([LMin96605,LRes13055,LCon50700,LUp_25607,LThr23837,LBat57017,LRes22407,LRes28161,LDep93745,LZer57933,LCon30807,LSub37498,LRes17005,LDot70772,LBat29347,LCon72342,LSub59497,LAve51394],["Min96605","Res13055","Con50700","Up_25607","Thr23837","Bat57017","Res22407","Res28161","Dep93745","Zer57933","Con30807","Sub37498","Res17005","Dot70772","Bat29347","Con72342","Sub59497","Ave51394"],Ave51394,"Ave51394")

Actual (Unparsed): [[[-0.2183009, -0.3935725, -0.3355000, -0.5184180, -0.3949000, 0.1438500], [-0.1109182, -0.4313052, -0.2950500, -0.1706670, -0.3225000, -0.3835000]]]

Expected (Unparsed): [[[-0.21830092082327066,-0.39357249194186394,-0.3355,-0.5184179844590431,-0.39490000000000003,0.14384999999999998],[-0.110918149425944,-0.4313052038381656,-0.29505000000000003,-0.17066704270628275,-0.3225,-0.38349999999999995]]]

Actual:   [[[-0.2183, -0.3935, -0.3355, -0.5184, -0.3949, 0.1439], [-0.1109, -0.4313, -0.295, -0.1706, -0.3225, -0.3835]]]

Expected: [[[-0.2183, -0.3935, -0.3355, -0.5184, -0.3949, 0.1439], [-0.1109, -0.4313, -0.295, -0.1706, -0.3225, -0.3834]]]