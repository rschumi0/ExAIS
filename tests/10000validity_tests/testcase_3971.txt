import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min90648 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Min90648 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))

Min90648 = keras.layers.Minimum(name = 'Min90648', )([in0Min90648,in1Min90648])
Res78188 = keras.layers.Reshape((2, 1, 2), name = 'Res78188', )(Min90648)
Res50428 = keras.layers.Reshape((2, 2), name = 'Res50428', )(Res78188)
Per56129 = keras.layers.Permute((1,2), name = 'Per56129',)(Res50428)
LST28834 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST28834', )(Per56129)
model = tf.keras.models.Model(inputs=[in0Min90648,in1Min90648], outputs=LST28834)
w = model.get_layer('LST28834').get_weights() 
w[0] = np.array([[9, 3, 4, 6, 10, 5, 5, 8, 6, 6, 4, 7], [3, 1, 1, 3, 8, 4, 9, 8, 5, 6, 6, 1]])
w[1] = np.array([[2, 2, 3, 9, 5, 4, 7, 7, 9, 7, 3, 3], [7, 1, 8, 8, 2, 6, 10, 9, 3, 8, 7, 7], [6, 5, 5, 7, 5, 6, 3, 1, 5, 8, 8, 7]])
w[2] = np.array([3, 4, 9, 1, 9, 7, 10, 6, 7, 1, 5, 1])
model.get_layer('LST28834').set_weights(w) 
in0Min90648 = tf.constant([[[[[0.4319], [0.482]]], [[[0.355], [0.1399]]]]])
in1Min90648 = tf.constant([[[[[0.9375], [0.2945]]], [[[0.3896], [0.2379]]]]])
print (np.array2string(model.predict([in0Min90648,in1Min90648],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST28834.png')

LMin90648 = minimum_layer([[[[[[0.4319], [0.482]]], [[[0.355], [0.1399]]]]], [[[[[0.9375], [0.2945]]], [[[0.3896], [0.2379]]]]]], Min90648), 
LRes78188 = reshape_layer(Min90648, [2, 1, 2], Res78188), 
LRes50428 = reshape_layer(Res78188, [2, 2], Res50428), 
LPer56129 = permute_layer(Res50428, 1,2, Per56129), 
LLST28834 = lstm_layer(Per56129,[[9, 3, 4, 6, 10, 5, 5, 8, 6, 6, 4, 7], [3, 1, 1, 3, 8, 4, 9, 8, 5, 6, 6, 1]],[[2, 2, 3, 9, 5, 4, 7, 7, 9, 7, 3, 3], [7, 1, 8, 8, 2, 6, 10, 9, 3, 8, 7, 7], [6, 5, 5, 7, 5, 6, 3, 1, 5, 8, 8, 7]],[3, 4, 9, 1, 9, 7, 10, 6, 7, 1, 5, 1], LST28834), 
exec_layers([LMin90648,LRes78188,LRes50428,LPer56129,LLST28834],["Min90648","Res78188","Res50428","Per56129","LST28834"],LST28834,"LST28834")

Actual (Unparsed): [[0.9639978, 0.9637628, 0.9640264]]

Expected (Unparsed): [[0.9639977670515919,0.9637628493828679,0.964026358571525]]

Actual:   [[0.964, 0.9638, 0.9641]]

Expected: [[0.964, 0.9638, 0.9641]]