import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max28329 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Max28329 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Ave70644 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Ave70644 = tf.keras.layers.Input(shape=([2, 1, 1]))

Max28329 = keras.layers.Maximum(name = 'Max28329', )([in0Max28329,in1Max28329])
Res46831 = keras.layers.Reshape((2, 2, 2), name = 'Res46831', )(Max28329)
Loc17516 = keras.layers.LocallyConnected2D(2, (1, 2),strides=(1, 1), name = 'Loc17516', )(Res46831)
Res95264 = keras.layers.Reshape((2, 1, 2, 1), name = 'Res95264', )(Loc17516)
Glo54895 = keras.layers.GlobalAveragePooling3D(name = 'Glo54895', )(Res95264)
Res42242 = keras.layers.Reshape((1, 1), name = 'Res42242', )(Glo54895)
Res40845 = keras.layers.Reshape((1, 1, 1), name = 'Res40845', )(Res42242)
Zer20133 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer20133', )(Res40845)
Ave70644 = keras.layers.Average(name = 'Ave70644', )([in0Ave70644,in1Ave70644])
Ave41660 = keras.layers.Average(name = 'Ave41660', )([Zer20133,Ave70644])
Res78418 = keras.layers.Reshape((2, 1), name = 'Res78418', )(Ave41660)
Up_36234 = keras.layers.UpSampling1D(size=(1), name = 'Up_36234', )(Res78418)
model = tf.keras.models.Model(inputs=[in0Max28329,in1Max28329,in0Ave70644,in1Ave70644], outputs=Up_36234)
w = model.get_layer('Loc17516').get_weights() 
w[0] = np.array([[[0.2867, 0.6601], [0.6613, 0.1964], [0.1506, 0.0175], [0.0334, 0.5366]], [[0.812, 0.4889], [0.0094, 0.7646], [0.9632, 0.4444], [0.8396, 0.1993]]])
w[1] = np.array([[[0, 0]], [[0, 0]]])
model.get_layer('Loc17516').set_weights(w) 
in0Max28329 = tf.constant([[[[[0.2139], [0.0036]], [[0.795], [0.0924]]], [[[0.5662], [0.9948]], [[0.7669], [0.6788]]]]])
in1Max28329 = tf.constant([[[[[0.6056], [0.0627]], [[0.0635], [0.4314]]], [[[0.3355], [0.7142]], [[0.3656], [0.9487]]]]])
in0Ave70644 = tf.constant([[[[0.8117]], [[0.4753]]]])
in1Ave70644 = tf.constant([[[[0.1877]], [[0.5001]]]])
print (np.array2string(model.predict([in0Max28329,in1Max28329,in0Ave70644,in1Ave70644],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Up_36234.png')

LMax28329 = maximum_layer([[[[[[0.2139], [0.0036]], [[0.795], [0.0924]]], [[[0.5662], [0.9948]], [[0.7669], [0.6788]]]]], [[[[[0.6056], [0.0627]], [[0.0635], [0.4314]]], [[[0.3355], [0.7142]], [[0.3656], [0.9487]]]]]], Max28329), 
LRes46831 = reshape_layer(Max28329, [2, 2, 2], Res46831), 
LLoc17516 = locally_connected2D_layer(Res46831, 1, 2,[[[0.2867, 0.6601], [0.6613, 0.1964], [0.1506, 0.0175], [0.0334, 0.5366]], [[0.812, 0.4889], [0.0094, 0.7646], [0.9632, 0.4444], [0.8396, 0.1993]]],[[[0, 0]], [[0, 0]]], 1, 1, Loc17516), 
LRes95264 = reshape_layer(Loc17516, [2, 1, 2, 1], Res95264), 
LGlo54895 = global_average_pooling3D_layer(Res95264, Glo54895), 
LRes42242 = reshape_layer(Glo54895, [1, 1], Res42242), 
LRes40845 = reshape_layer(Res42242, [1, 1, 1], Res40845), 
LZer20133 = zero_padding2D_layer(Res40845, 1, 0, 0, 0, Zer20133), 
LAve70644 = average_layer([[[[[0.8117]], [[0.4753]]]], [[[[0.1877]], [[0.5001]]]]], Ave70644), 
LAve41660 = average_layer([Zer20133,Ave70644], Ave41660), 
LRes78418 = reshape_layer(Ave41660, [2, 1], Res78418), 
LUp_36234 = up_sampling1D_layer(Res78418, 1, Up_36234), 
exec_layers([LMax28329,LRes46831,LLoc17516,LRes95264,LGlo54895,LRes42242,LRes40845,LZer20133,LAve70644,LAve41660,LRes78418,LUp_36234],["Max28329","Res46831","Loc17516","Res95264","Glo54895","Res42242","Res40845","Zer20133","Ave70644","Ave41660","Res78418","Up_36234"],Up_36234,"Up_36234")

Actual (Unparsed): [[[0.2498500], [0.8161419]]]

Expected (Unparsed): [[[0.24985],[0.8161418775000001]]]

Actual:   [[[0.2499], [0.8162]]]

Expected: [[[0.2499], [0.8162]]]