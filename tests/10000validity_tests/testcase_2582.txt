import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave99374 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Ave99374 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Add113 = tf.keras.layers.Input(shape=([1, 2]))
in1Add113 = tf.keras.layers.Input(shape=([1, 2]))

Ave99374 = keras.layers.Average(name = 'Ave99374', )([in0Ave99374,in1Ave99374])
Bat25085 = keras.layers.BatchNormalization(axis=1, epsilon=0.2886081788281525,  name = 'Bat25085', )(Ave99374)
Res14456 = keras.layers.Reshape((2, 1, 2), name = 'Res14456', )(Bat25085)
Res26402 = keras.layers.Reshape((2, 2), name = 'Res26402', )(Res14456)
Add113 = keras.layers.Add(name = 'Add113', )([in0Add113,in1Add113])
Dot14449 = keras.layers.Dot(axes=(2, 2), name = 'Dot14449', )([Res26402,Add113])
ReL73980 = keras.layers.ReLU(max_value=9.501771445468963, negative_slope=5.027395057972551, threshold=8.378933675726039, name = 'ReL73980', )(Dot14449)
model = tf.keras.models.Model(inputs=[in0Ave99374,in1Ave99374,in0Add113,in1Add113], outputs=ReL73980)
w = model.get_layer('Bat25085').get_weights() 
w[0] = np.array([0.8109, 0.3795])
w[1] = np.array([0.1049, 0.7796])
w[2] = np.array([0.474, 0.8974])
w[3] = np.array([0.1264, 0.888])
model.get_layer('Bat25085').set_weights(w) 
in0Ave99374 = tf.constant([[[[[0.8667], [0.7899]]], [[[0.4061], [0.6559]]]]])
in1Ave99374 = tf.constant([[[[[0.2267], [0.3801]]], [[[0.9369], [0.0206]]]]])
in0Add113 = tf.constant([[[0.1564, 0.2385]]])
in1Add113 = tf.constant([[[0.4738, 0.4366]]])
print (np.array2string(model.predict([in0Ave99374,in1Ave99374,in0Add113,in1Add113],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='ReL73980.png')

LAve99374 = average_layer([[[[[[0.8667], [0.7899]]], [[[0.4061], [0.6559]]]]], [[[[[0.2267], [0.3801]]], [[[0.9369], [0.0206]]]]]], Ave99374), 
LBat25085 = batch_normalization_layer(Ave99374, 1, 0.2886081788281525, [0.8109, 0.3795], [0.1049, 0.7796], [0.474, 0.8974], [0.1264, 0.888], Bat25085), 
LRes14456 = reshape_layer(Bat25085, [2, 1, 2], Res14456), 
LRes26402 = reshape_layer(Res14456, [2, 2], Res26402), 
LAdd113 = add_layer([[[[0.1564, 0.2385]]], [[[0.4738, 0.4366]]]], Add113), 
LDot14449 = dot_layer(Res26402,Add113, 2, 2, Dot14449), 
LReL73980 = relu_layer(Dot14449, 9.501771445468963, 5.027395057972551, 8.378933675726039, ReL73980), 
exec_layers([LAve99374,LBat25085,LRes14456,LRes26402,LAdd113,LDot14449,LReL73980],["Ave99374","Bat25085","Res14456","Res26402","Add113","Dot14449","ReL73980"],ReL73980,"ReL73980")

Actual (Unparsed): [[[-40.6716851], [-37.9226222]]]

Expected (Unparsed): [[[-40.67168512968881],[-37.92262222098781]]]

Actual:   [[[-40.6716], [-37.9226]]]

Expected: [[[-40.6716], [-37.9226]]]