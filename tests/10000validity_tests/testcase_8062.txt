import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc14634 = tf.keras.layers.Input(shape=([2, 1]))
in0Con47308 = tf.keras.layers.Input(shape=([1, 1]))
in0Mul91590 = tf.keras.layers.Input(shape=([1, 2]))
in1Mul91590 = tf.keras.layers.Input(shape=([1, 2]))
in0Con99743 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Sep55140 = tf.keras.layers.Input(shape=([2, 2, 2]))

Loc14634 = keras.layers.LocallyConnected1D(4, (1),strides=(1), name = 'Loc14634', )(in0Loc14634)
Con9420 = keras.layers.Conv1D(3, (2),strides=(1), padding='valid', dilation_rate=(1), name = 'Con9420', )(Loc14634)
Con47308 = keras.layers.Concatenate(axis=2, name = 'Con47308', )([Con9420,in0Con47308])
Mul91590 = keras.layers.Multiply(name = 'Mul91590', )([in0Mul91590,in1Mul91590])
Res20153 = keras.layers.Reshape((1, 2, 1), name = 'Res20153', )(Mul91590)
Con99743 = keras.layers.Concatenate(axis=3, name = 'Con99743', )([Res20153,in0Con99743])
Sep55140 = keras.layers.SeparableConv2D(2, (1, 2),strides=(2, 2), padding='same', name = 'Sep55140', )(in0Sep55140)
Zer30645 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer30645', )(Sep55140)
Ave38096 = keras.layers.Average(name = 'Ave38096', )([Con99743,Zer30645])
Sof94042 = keras.layers.Softmax(axis=1, name = 'Sof94042', )(Ave38096)
Res48863 = keras.layers.Reshape((1, 4), name = 'Res48863', )(Sof94042)
Dot64629 = keras.layers.Dot(axes=(2, 2), name = 'Dot64629', )([Con47308,Res48863])
model = tf.keras.models.Model(inputs=[in0Loc14634,in0Con47308,in0Mul91590,in1Mul91590,in0Con99743,in0Sep55140], outputs=Dot64629)
w = model.get_layer('Loc14634').get_weights() 
w[0] = np.array([[[0.1421, 0.0547, 0.3001, 0.6914]], [[0.8233, 0.1394, 0.6367, 0.7149]]])
w[1] = np.array([[0, 0, 0, 0], [0, 0, 0, 0]])
model.get_layer('Loc14634').set_weights(w) 
w = model.get_layer('Con9420').get_weights() 
w[0] = np.array([[[0.2347, 0.9765, 0.5998], [0.2221, 0.1663, 0.8911], [0.8328, 0.7942, 0.1202], [0.5518, 0.7746, 0.4765]], [[0.6642, 0.0129, 0.9834], [0.3382, 0.8049, 0.2216], [0.5946, 0.7412, 0.569], [0.6973, 0.6067, 0.65]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con9420').set_weights(w) 
w = model.get_layer('Sep55140').get_weights() 
w[0] = np.array([[[[0.2573], [0.9266]], [[0.0747], [0.8973]]]])
w[1] = np.array([[[[0.0692, 0.4242], [0.0708, 0.1733]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep55140').set_weights(w) 
in0Loc14634 = tf.constant([[[0.3337], [0.6205]]])
in0Con47308 = tf.constant([[[0.3097]]])
in0Mul91590 = tf.constant([[[0.0863, 0.2764]]])
in1Mul91590 = tf.constant([[[0.506, 0.5328]]])
in0Con99743 = tf.constant([[[[0.278], [0.7147]]]])
in0Sep55140 = tf.constant([[[[0.9829, 0.575], [0.1742, 0.2747]], [[0.4798, 0.4147], [0.0275, 0.3058]]]])
print (np.array2string(model.predict([in0Loc14634,in0Con47308,in0Mul91590,in1Mul91590,in0Con99743,in0Sep55140],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot64629.png')

LLoc14634 = locally_connected1D_layer([[[0.3337], [0.6205]]], 1,[[[0.1421, 0.0547, 0.3001, 0.6914]], [[0.8233, 0.1394, 0.6367, 0.7149]]],[[0, 0, 0, 0], [0, 0, 0, 0]], 1, Loc14634), 
LCon9420 = conv1D_layer(Loc14634, 2,[[[0.2347, 0.9765, 0.5998], [0.2221, 0.1663, 0.8911], [0.8328, 0.7942, 0.1202], [0.5518, 0.7746, 0.4765]], [[0.6642, 0.0129, 0.9834], [0.3382, 0.8049, 0.2216], [0.5946, 0.7412, 0.569], [0.6973, 0.6067, 0.65]]],[0, 0, 0], 1, false, 1, Con9420), 
LCon47308 = concatenate_layer([Con9420,[[[0.3097]]]], 2, Con47308), 
LMul91590 = multiply_layer([[[[0.0863, 0.2764]]], [[[0.506, 0.5328]]]], Mul91590), 
LRes20153 = reshape_layer(Mul91590, [1, 2, 1], Res20153), 
LCon99743 = concatenate_layer([Res20153,[[[[0.278], [0.7147]]]]], 3, Con99743), 
LSep55140 = separable_conv2D_layer([[[[0.9829, 0.575], [0.1742, 0.2747]], [[0.4798, 0.4147], [0.0275, 0.3058]]]], 1, 2,[[[[[0.2573], [0.9266]], [[0.0747], [0.8973]]]],[[[[0.0692, 0.4242], [0.0708, 0.1733]]]]],[0, 0], 2, 2, true, Sep55140), 
LZer30645 = zero_padding2D_layer(Sep55140, 0, 0, 1, 0, Zer30645), 
LAve38096 = average_layer([Con99743,Zer30645], Ave38096), 
LSof94042 = softmax_layer(Ave38096, 1, Sof94042), 
LRes48863 = reshape_layer(Sof94042, [1, 4], Res48863), 
LDot64629 = dot_layer(Con47308,Res48863, 2, 2, Dot64629), 
exec_layers([LLoc14634,LCon9420,LCon47308,LMul91590,LRes20153,LCon99743,LSep55140,LZer30645,LAve38096,LSof94042,LRes48863,LDot64629],["Loc14634","Con9420","Con47308","Mul91590","Res20153","Con99743","Sep55140","Zer30645","Ave38096","Sof94042","Res48863","Dot64629"],Dot64629,"Dot64629")

Actual (Unparsed): [[[3.5955085]]]

Expected (Unparsed): [[[3.5955083741560006]]]

Actual:   [[[3.5956]]]

Expected: [[[3.5956]]]