import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave27718 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Ave27718 = tf.keras.layers.Input(shape=([1, 2, 2]))

Ave27718 = keras.layers.Average(name = 'Ave27718', )([in0Ave27718,in1Ave27718])
Res50999 = keras.layers.Reshape((1, 4), name = 'Res50999', )(Ave27718)
GRU29833 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU29833', )(Res50999)
model = tf.keras.models.Model(inputs=[in0Ave27718,in1Ave27718], outputs=GRU29833)
w = model.get_layer('GRU29833').get_weights() 
w[0] = np.array([[5, 4, 10, 8, 6, 2, 1, 2, 2], [8, 2, 6, 9, 3, 3, 7, 5, 4], [1, 9, 9, 7, 6, 2, 3, 7, 8], [10, 2, 2, 2, 5, 3, 9, 5, 2]])
w[1] = np.array([[6, 8, 1, 2, 6, 4, 7, 9, 7], [7, 2, 4, 8, 4, 3, 9, 6, 9], [5, 9, 2, 4, 4, 1, 7, 4, 8]])
w[2] = np.array([3, 7, 5, 1, 6, 6, 6, 10, 1])
model.get_layer('GRU29833').set_weights(w) 
in0Ave27718 = tf.constant([[[[0.6529, 0.2855], [0.1814, 0.8552]]]])
in1Ave27718 = tf.constant([[[[0.6697, 0.2174], [0.0886, 0.3223]]]])
print (np.array2string(model.predict([in0Ave27718,in1Ave27718],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU29833.png')

LAve27718 = average_layer([[[[[0.6529, 0.2855], [0.1814, 0.8552]]]], [[[[0.6697, 0.2174], [0.0886, 0.3223]]]]], Ave27718), 
LRes50999 = reshape_layer(Ave27718, [1, 4], Res50999), 
LGRU29833 = gru_layer(Res50999,[[5, 4, 10, 8, 6, 2, 1, 2, 2], [8, 2, 6, 9, 3, 3, 7, 5, 4], [1, 9, 9, 7, 6, 2, 3, 7, 8], [10, 2, 2, 2, 5, 3, 9, 5, 2]],[[6, 8, 1, 2, 6, 4, 7, 9, 7], [7, 2, 4, 8, 4, 3, 9, 6, 9], [5, 9, 2, 4, 4, 1, 7, 4, 8]],[3, 7, 5, 1, 6, 6, 6, 10, 1], false, GRU29833), 
exec_layers([LAve27718,LRes50999,LGRU29833],["Ave27718","Res50999","GRU29833"],GRU29833,"GRU29833")

Actual (Unparsed): [[0.0000006, 0.0000036, 0.0000002]]

Expected (Unparsed): [[5.915021069607134e-7,3.57836853337453e-6,1.8291791936643934e-7]]

Actual:   [[0, 0, 0]]

Expected: [[0, 0, 0]]