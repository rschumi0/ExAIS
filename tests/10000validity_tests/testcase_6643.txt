import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Zer56904 = tf.keras.layers.Input(shape=([3, 4, 1, 1]))

Zer56904 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer56904', )(in0Zer56904)
Res2585 = keras.layers.Reshape((5, 6, 3), name = 'Res2585', )(Zer56904)
Res12657 = keras.layers.Reshape((5, 18), name = 'Res12657', )(Res2585)
Con39928 = keras.layers.Conv1D(4, (2),strides=(1), padding='valid', dilation_rate=(1), name = 'Con39928', )(Res12657)
Res44272 = keras.layers.Reshape((4, 4, 1), name = 'Res44272', )(Con39928)
Loc82879 = keras.layers.LocallyConnected2D(4, (3, 3),strides=(1, 1), name = 'Loc82879', )(Res44272)
Dep88138 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='valid', name = 'Dep88138', )(Loc82879)
Fla27350 = keras.layers.Flatten(name = 'Fla27350', )(Dep88138)
model = tf.keras.models.Model(inputs=[in0Zer56904], outputs=Fla27350)
w = model.get_layer('Con39928').get_weights() 
w[0] = np.array([[[0.1969, 0.425, 0.4, 0.1685], [0.7571, 0.1709, 0.2268, 0.3718], [0.4501, 0.2743, 0.2315, 0.9071], [0.1285, 0.0237, 0.0777, 0.3843], [0.1411, 0.8081, 0.7586, 0.5257], [0.5743, 0.8958, 0.1417, 0.9573], [0.8727, 0.5161, 0.1738, 0.5005], [0.1261, 0.3762, 0.5195, 0.2596], [0.9147, 0.5123, 0.3999, 0.5767], [0.2378, 0.4184, 0.9236, 0.4939], [0.7145, 0.7311, 0.2543, 0.705], [0.9449, 0.3537, 0.5516, 0.105], [0.6433, 0.7978, 0.734, 0.9531], [0.9176, 0.6917, 0.7675, 0.355], [0.857, 0.8606, 0.3605, 0.2369], [0.4116, 0.1173, 0.6588, 0.2369], [0.4012, 0.9193, 0.7782, 0.972], [0.3721, 0.3466, 0.7857, 0.9498]], [[0.9389, 0.4339, 0.0462, 0.9917], [0.1919, 0.7487, 0.6888, 0.4086], [0.7288, 0.2516, 0.3153, 0.3283], [0.8804, 0.8968, 0.9711, 0.5105], [0.7354, 0.1336, 0.8323, 0.708], [0.6464, 0.4566, 0.0217, 0.1308], [0.9971, 0.4196, 0.4618, 0.8538], [0.147, 0.0725, 0.6965, 0.0714], [0.6336, 0.6145, 0.1679, 0.947], [0.9098, 0.1629, 0.5236, 0.4334], [0.12, 0.9313, 0.1466, 0.8428], [0.6791, 0.7829, 0.2486, 0.1386], [0.7067, 0.0771, 0.5511, 0.8887], [0.6919, 0.9668, 0.7866, 0.5692], [0.1149, 0.8158, 0.9998, 0.4436], [0.1371, 0.208, 0.8978, 0.5523], [0.8852, 0.0941, 0.3106, 0.4443], [0.3015, 0.9888, 0.1526, 0.1584]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con39928').set_weights(w) 
w = model.get_layer('Loc82879').get_weights() 
w[0] = np.array([[[0.2972, 0.4306, 0.3097, 0.8529], [0.4549, 0.8029, 0.1303, 0.1614], [0.7472, 0.13, 0.4956, 0.8197], [0.7248, 0.1752, 0.6861, 0.6112], [0.5494, 0.7692, 0.6305, 0.7897], [0.4767, 0.5751, 0.6347, 0.9217], [0.5481, 0.6749, 0.5327, 0.3362], [0.3013, 0.7923, 0.1375, 0.0653], [0.8556, 0.5818, 0.8627, 0.3534]], [[0.4273, 0.4337, 0.0443, 0.909], [0.1862, 0.6727, 0.7957, 0.0798], [0.3785, 0.8589, 0.2, 0.0423], [0.8091, 0.141, 0.2631, 0.9142], [0.1022, 0.2566, 0.329, 0.4221], [0.6398, 0.825, 0.5955, 0.3868], [0.716, 0.0381, 0.9566, 0.8238], [0.2395, 0.7166, 0.6483, 0.9], [0.2649, 0.9728, 0.0729, 0.3365]], [[0.7422, 0.3931, 0.7432, 0.1002], [0.1353, 0.7423, 0.4966, 0.3908], [0.9788, 0.6746, 0.0068, 0.9957], [0.0194, 0.8383, 0.1463, 0.0576], [0.3176, 0.0566, 0.9381, 0.1836], [0.5743, 0.9806, 0.6756, 0.6056], [0.9912, 0.7197, 0.2878, 0.7981], [0.1716, 0.4805, 0.1789, 0.5565], [0.9291, 0.1659, 0.581, 0.0439]], [[0.38, 0.2258, 0.9263, 0.7257], [0.3655, 0.7835, 0.8648, 0.4291], [0.078, 0.2128, 0.3329, 0.9872], [0.7414, 0.89, 0.5139, 0.0589], [0.3389, 0.8014, 0.6202, 0.7502], [0.6717, 0.056, 0.1753, 0.6053], [0.4839, 0.1186, 0.8775, 0.3867], [0.9955, 0.758, 0.1849, 0.8141], [0.9472, 0.2873, 0.4792, 0.0977]]])
w[1] = np.array([[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]]])
model.get_layer('Loc82879').set_weights(w) 
w = model.get_layer('Dep88138').get_weights() 
w[0] = np.array([[[[0.9164], [0.1804], [0.5375], [0.9803]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Dep88138').set_weights(w) 
in0Zer56904 = tf.constant([[[[[1.2528]], [[1.646]], [[1.1755]], [[1.3325]]], [[[1.5916]], [[1.8689]], [[1.8253]], [[1.8481]]], [[[1.7427]], [[1.1395]], [[1.3634]], [[1.7638]]]]])
print (np.array2string(model.predict([in0Zer56904],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Fla27350.png')

LZer56904 = zero_padding3D_layer([[[[[1.2528]], [[1.646]], [[1.1755]], [[1.3325]]], [[[1.5916]], [[1.8689]], [[1.8253]], [[1.8481]]], [[[1.7427]], [[1.1395]], [[1.3634]], [[1.7638]]]]], 1, 1, 1, 1, 1, 1, Zer56904), 
LRes2585 = reshape_layer(Zer56904, [5, 6, 3], Res2585), 
LRes12657 = reshape_layer(Res2585, [5, 18], Res12657), 
LCon39928 = conv1D_layer(Res12657, 2,[[[0.1969, 0.425, 0.4, 0.1685], [0.7571, 0.1709, 0.2268, 0.3718], [0.4501, 0.2743, 0.2315, 0.9071], [0.1285, 0.0237, 0.0777, 0.3843], [0.1411, 0.8081, 0.7586, 0.5257], [0.5743, 0.8958, 0.1417, 0.9573], [0.8727, 0.5161, 0.1738, 0.5005], [0.1261, 0.3762, 0.5195, 0.2596], [0.9147, 0.5123, 0.3999, 0.5767], [0.2378, 0.4184, 0.9236, 0.4939], [0.7145, 0.7311, 0.2543, 0.705], [0.9449, 0.3537, 0.5516, 0.105], [0.6433, 0.7978, 0.734, 0.9531], [0.9176, 0.6917, 0.7675, 0.355], [0.857, 0.8606, 0.3605, 0.2369], [0.4116, 0.1173, 0.6588, 0.2369], [0.4012, 0.9193, 0.7782, 0.972], [0.3721, 0.3466, 0.7857, 0.9498]], [[0.9389, 0.4339, 0.0462, 0.9917], [0.1919, 0.7487, 0.6888, 0.4086], [0.7288, 0.2516, 0.3153, 0.3283], [0.8804, 0.8968, 0.9711, 0.5105], [0.7354, 0.1336, 0.8323, 0.708], [0.6464, 0.4566, 0.0217, 0.1308], [0.9971, 0.4196, 0.4618, 0.8538], [0.147, 0.0725, 0.6965, 0.0714], [0.6336, 0.6145, 0.1679, 0.947], [0.9098, 0.1629, 0.5236, 0.4334], [0.12, 0.9313, 0.1466, 0.8428], [0.6791, 0.7829, 0.2486, 0.1386], [0.7067, 0.0771, 0.5511, 0.8887], [0.6919, 0.9668, 0.7866, 0.5692], [0.1149, 0.8158, 0.9998, 0.4436], [0.1371, 0.208, 0.8978, 0.5523], [0.8852, 0.0941, 0.3106, 0.4443], [0.3015, 0.9888, 0.1526, 0.1584]]],[0, 0, 0, 0], 1, false, 1, Con39928), 
LRes44272 = reshape_layer(Con39928, [4, 4, 1], Res44272), 
LLoc82879 = locally_connected2D_layer(Res44272, 3, 3,[[[0.2972, 0.4306, 0.3097, 0.8529], [0.4549, 0.8029, 0.1303, 0.1614], [0.7472, 0.13, 0.4956, 0.8197], [0.7248, 0.1752, 0.6861, 0.6112], [0.5494, 0.7692, 0.6305, 0.7897], [0.4767, 0.5751, 0.6347, 0.9217], [0.5481, 0.6749, 0.5327, 0.3362], [0.3013, 0.7923, 0.1375, 0.0653], [0.8556, 0.5818, 0.8627, 0.3534]], [[0.4273, 0.4337, 0.0443, 0.909], [0.1862, 0.6727, 0.7957, 0.0798], [0.3785, 0.8589, 0.2, 0.0423], [0.8091, 0.141, 0.2631, 0.9142], [0.1022, 0.2566, 0.329, 0.4221], [0.6398, 0.825, 0.5955, 0.3868], [0.716, 0.0381, 0.9566, 0.8238], [0.2395, 0.7166, 0.6483, 0.9], [0.2649, 0.9728, 0.0729, 0.3365]], [[0.7422, 0.3931, 0.7432, 0.1002], [0.1353, 0.7423, 0.4966, 0.3908], [0.9788, 0.6746, 0.0068, 0.9957], [0.0194, 0.8383, 0.1463, 0.0576], [0.3176, 0.0566, 0.9381, 0.1836], [0.5743, 0.9806, 0.6756, 0.6056], [0.9912, 0.7197, 0.2878, 0.7981], [0.1716, 0.4805, 0.1789, 0.5565], [0.9291, 0.1659, 0.581, 0.0439]], [[0.38, 0.2258, 0.9263, 0.7257], [0.3655, 0.7835, 0.8648, 0.4291], [0.078, 0.2128, 0.3329, 0.9872], [0.7414, 0.89, 0.5139, 0.0589], [0.3389, 0.8014, 0.6202, 0.7502], [0.6717, 0.056, 0.1753, 0.6053], [0.4839, 0.1186, 0.8775, 0.3867], [0.9955, 0.758, 0.1849, 0.8141], [0.9472, 0.2873, 0.4792, 0.0977]]],[[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]]], 1, 1, Loc82879), 
LDep88138 = depthwise_conv2D_layer(Loc82879, 1, 1,[[[[0.9164], [0.1804], [0.5375], [0.9803]]]],[0, 0, 0, 0], 1, 1, false, Dep88138), 
LFla27350 = flatten_layer(Dep88138, Fla27350), 
exec_layers([LZer56904,LRes2585,LRes12657,LCon39928,LRes44272,LLoc82879,LDep88138,LFla27350],["Zer56904","Res2585","Res12657","Con39928","Res44272","Loc82879","Dep88138","Fla27350"],Fla27350,"Fla27350")

Actual (Unparsed): [[26.0764528, 5.3137713, 14.5045594, 25.9308877, 20.8589038, 4.7642353, 13.2333922, 30.2712372, 24.2554971, 5.5376200, 13.4352381, 21.7634491, 24.9559929, 4.7934839, 16.6367920, 29.2815976]]

Expected (Unparsed): [[26.076453055697193,5.313771389319743,14.50455956649241,25.930888003681765,20.858904005145263,4.764235374335651,13.233392349113497,30.271237558637296,24.25549732404796,5.537620020515695,13.435238235095527,21.76344933381231,24.955993111007174,4.793483966146471,16.636792217512436,29.281597887703793]]

Actual:   [[26.0765, 5.3138, 14.5046, 25.9309, 20.859, 4.7643, 13.2334, 30.2713, 24.2555, 5.5377, 13.4353, 21.7635, 24.956, 4.7935, 16.6368, 29.2816]]

Expected: [[26.0765, 5.3138, 14.5046, 25.9309, 20.859, 4.7643, 13.2334, 30.2713, 24.2555, 5.5377, 13.4353, 21.7635, 24.956, 4.7935, 16.6368, 29.2816]]