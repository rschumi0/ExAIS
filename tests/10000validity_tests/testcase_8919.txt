import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Cro32999 = tf.keras.layers.Input(shape=([1, 4, 4]))

Cro32999 = keras.layers.Cropping2D(cropping=((0, 0), (1, 1)), name = 'Cro32999', )(in0Cro32999)
Up_91144 = keras.layers.UpSampling2D(size=(2, 1), name = 'Up_91144', )(Cro32999)
Res18764 = keras.layers.Reshape((2, 8), name = 'Res18764', )(Up_91144)
GRU46978 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU46978', )(Res18764)
Res36205 = keras.layers.Reshape((3, 1), name = 'Res36205', )(GRU46978)
Ave7999 = keras.layers.AveragePooling1D(pool_size=(2), strides=(1), padding='same', name = 'Ave7999', )(Res36205)
Sof33936 = keras.layers.Softmax(axis=1, name = 'Sof33936', )(Ave7999)
model = tf.keras.models.Model(inputs=[in0Cro32999], outputs=Sof33936)
w = model.get_layer('GRU46978').get_weights() 
w[0] = np.array([[3, 1, 6, 5, 3, 3, 7, 6, 8], [1, 3, 4, 10, 4, 5, 8, 4, 9], [5, 4, 2, 8, 4, 10, 10, 9, 10], [8, 3, 8, 9, 3, 8, 3, 7, 8], [9, 2, 7, 8, 10, 8, 3, 8, 6], [8, 3, 8, 2, 5, 4, 1, 10, 6], [2, 8, 1, 2, 9, 1, 1, 5, 8], [2, 6, 2, 2, 8, 3, 2, 8, 9]])
w[1] = np.array([[1, 5, 10, 5, 9, 4, 10, 3, 7], [5, 8, 5, 8, 8, 5, 2, 8, 3], [1, 7, 8, 3, 3, 5, 3, 1, 1]])
w[2] = np.array([[9, 1, 5, 10, 6, 7, 4, 1, 5], [5, 4, 1, 9, 6, 10, 7, 6, 1]])
model.get_layer('GRU46978').set_weights(w) 
in0Cro32999 = tf.constant([[[[1.6545, 1.961, 1.1564, 1.6248], [1.0918, 1.2304, 1.1309, 1.998], [1.4537, 1.9721, 1.7562, 1.0078], [1.029, 1.2833, 1.4977, 1.9213]]]])
print (np.array2string(model.predict([in0Cro32999],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sof33936.png')

LCro32999 = cropping2D_layer([[[[1.6545, 1.961, 1.1564, 1.6248], [1.0918, 1.2304, 1.1309, 1.998], [1.4537, 1.9721, 1.7562, 1.0078], [1.029, 1.2833, 1.4977, 1.9213]]]], 0, 0, 1, 1, Cro32999), 
LUp_91144 = up_sampling2D_layer(Cro32999, 2, 1, Up_91144), 
LRes18764 = reshape_layer(Up_91144, [2, 8], Res18764), 
LGRU46978 = gru_layer(Res18764,[[3, 1, 6, 5, 3, 3, 7, 6, 8], [1, 3, 4, 10, 4, 5, 8, 4, 9], [5, 4, 2, 8, 4, 10, 10, 9, 10], [8, 3, 8, 9, 3, 8, 3, 7, 8], [9, 2, 7, 8, 10, 8, 3, 8, 6], [8, 3, 8, 2, 5, 4, 1, 10, 6], [2, 8, 1, 2, 9, 1, 1, 5, 8], [2, 6, 2, 2, 8, 3, 2, 8, 9]],[[1, 5, 10, 5, 9, 4, 10, 3, 7], [5, 8, 5, 8, 8, 5, 2, 8, 3], [1, 7, 8, 3, 3, 5, 3, 1, 1]],[[9, 1, 5, 10, 6, 7, 4, 1, 5], [5, 4, 1, 9, 6, 10, 7, 6, 1]], true, GRU46978), 
LRes36205 = reshape_layer(GRU46978, [3, 1], Res36205), 
LAve7999 = average_pooling1D_layer(Res36205, 2, 1, true, Ave7999), 
LSof33936 = softmax_layer(Ave7999, 1, Sof33936), 
exec_layers([LCro32999,LUp_91144,LRes18764,LGRU46978,LRes36205,LAve7999,LSof33936],["Cro32999","Up_91144","Res18764","GRU46978","Res36205","Ave7999","Sof33936"],Sof33936,"Sof33936")

Actual (Unparsed): [[[0.3333333], [0.3333333], [0.3333333]]]

Expected (Unparsed): [[[0.3333333333333333],[0.3333333333333333],[0.3333333333333333]]]

Actual:   [[[0.3334], [0.3334], [0.3334]]]

Expected: [[[0.3334], [0.3334], [0.3334]]]