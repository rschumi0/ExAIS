import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul55000 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Mul55000 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Dot64148 = tf.keras.layers.Input(shape=([3]))
in1Dot64148 = tf.keras.layers.Input(shape=([3]))
in0Con19870 = tf.keras.layers.Input(shape=([3]))

Mul55000 = keras.layers.Multiply(name = 'Mul55000', )([in0Mul55000,in1Mul55000])
Zer1325 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer1325', )(Mul55000)
Ave82501 = keras.layers.AveragePooling2D(pool_size=(2, 2), strides=(1, 1), padding='valid', name = 'Ave82501', )(Zer1325)
Res52588 = keras.layers.Reshape((2, 6), name = 'Res52588', )(Ave82501)
Cro55104 = keras.layers.Cropping1D(cropping=((1, 0)), name = 'Cro55104', )(Res52588)
Sof10204 = keras.layers.Softmax(axis=1, name = 'Sof10204', )(Cro55104)
Res40925 = keras.layers.Reshape((1, 6, 1), name = 'Res40925', )(Sof10204)
Res10091 = keras.layers.Reshape((1, 6, 1, 1), name = 'Res10091', )(Res40925)
Con80883 = keras.layers.Conv3D(4, (1, 4, 1),strides=(1, 7, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con80883', )(Res10091)
Res91420 = keras.layers.Reshape((1, 1, 4), name = 'Res91420', )(Con80883)
Res98267 = keras.layers.Reshape((1, 4), name = 'Res98267', )(Res91420)
Fla31321 = keras.layers.Flatten(name = 'Fla31321', )(Res98267)
Dot64148 = keras.layers.Dot(axes=(1, 1), name = 'Dot64148', )([in0Dot64148,in1Dot64148])
Bat69203 = keras.layers.BatchNormalization(axis=1, epsilon=0.5807876800282168,  name = 'Bat69203', )(Dot64148)
Con19870 = keras.layers.Concatenate(axis=1, name = 'Con19870', )([Bat69203,in0Con19870])
Mul33895 = keras.layers.Multiply(name = 'Mul33895', )([Fla31321,Con19870])
model = tf.keras.models.Model(inputs=[in0Mul55000,in1Mul55000,in0Dot64148,in1Dot64148,in0Con19870], outputs=Mul33895)
w = model.get_layer('Con80883').get_weights() 
w[0] = np.array([[[[[0.4891, 0.397, 0.7619, 0.076]]], [[[0.1635, 0.5694, 0.8524, 0.7635]]], [[[0.4855, 0.0988, 0.5692, 0.489]]], [[[0.1107, 0.2661, 0.4633, 0.4518]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con80883').set_weights(w) 
w = model.get_layer('Bat69203').get_weights() 
w[0] = np.array([0.2309])
w[1] = np.array([0.4561])
w[2] = np.array([0.3432])
w[3] = np.array([0.8673])
model.get_layer('Bat69203').set_weights(w) 
in0Mul55000 = tf.constant([[[[0.2629, 0.0351], [0.0269, 0.9564]]]])
in1Mul55000 = tf.constant([[[[0.4275, 0.4898], [0.7035, 0.5964]]]])
in0Dot64148 = tf.constant([[0.1154, 0.7803, 0.2195]])
in1Dot64148 = tf.constant([[0.5274, 0.0895, 0.4582]])
in0Con19870 = tf.constant([[0.5211, 0.1069, 0.996]])
print (np.array2string(model.predict([in0Mul55000,in1Mul55000,in0Dot64148,in1Dot64148,in0Con19870],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul33895.png')

LMul55000 = multiply_layer([[[[[0.2629, 0.0351], [0.0269, 0.9564]]]], [[[[0.4275, 0.4898], [0.7035, 0.5964]]]]], Mul55000), 
LZer1325 = zero_padding2D_layer(Mul55000, 1, 1, 1, 1, Zer1325), 
LAve82501 = average_pooling2D_layer(Zer1325, 2, 2, 1, 1, false, Ave82501), 
LRes52588 = reshape_layer(Ave82501, [2, 6], Res52588), 
LCro55104 = cropping1D_layer(Res52588, 1, 0, Cro55104), 
LSof10204 = softmax_layer(Cro55104, 1, Sof10204), 
LRes40925 = reshape_layer(Sof10204, [1, 6, 1], Res40925), 
LRes10091 = reshape_layer(Res40925, [1, 6, 1, 1], Res10091), 
LCon80883 = conv3D_layer(Res10091, 1, 4, 1,[[[[[0.4891, 0.397, 0.7619, 0.076]]], [[[0.1635, 0.5694, 0.8524, 0.7635]]], [[[0.4855, 0.0988, 0.5692, 0.489]]], [[[0.1107, 0.2661, 0.4633, 0.4518]]]]],[0, 0, 0, 0], 1, 7, 1, false, 1, 1, 1, Con80883), 
LRes91420 = reshape_layer(Con80883, [1, 1, 4], Res91420), 
LRes98267 = reshape_layer(Res91420, [1, 4], Res98267), 
LFla31321 = flatten_layer(Res98267, Fla31321), 
LDot64148 = dot_layer([[0.1154, 0.7803, 0.2195]], [[0.5274, 0.0895, 0.4582]], 1, 1, Dot64148), 
LBat69203 = batch_normalization_layer(Dot64148, 1, 0.5807876800282168, [0.2309], [0.4561], [0.3432], [0.8673], Bat69203), 
LCon19870 = concatenate_layer([Bat69203,[[0.5211, 0.1069, 0.996]]], 1, Con19870), 
LMul33895 = multiply_layer([Fla31321,Con19870], Mul33895), 
exec_layers([LMul55000,LZer1325,LAve82501,LRes52588,LCro55104,LSof10204,LRes40925,LRes10091,LCon80883,LRes91420,LRes98267,LFla31321,LDot64148,LBat69203,LCon19870,LMul33895],["Mul55000","Zer1325","Ave82501","Res52588","Cro55104","Sof10204","Res40925","Res10091","Con80883","Res91420","Res98267","Fla31321","Dot64148","Bat69203","Con19870","Mul33895"],Mul33895,"Mul33895")

Actual (Unparsed): [[0.5427581, 0.6937404, 0.2829429, 1.7731788]]

Expected (Unparsed): [[0.5427581290418473,0.69374043,0.28294292,1.7731788]]

Actual:   [[0.5428, 0.6938, 0.283, 1.7732]]

Expected: [[0.5428, 0.6938, 0.283, 1.7732]]