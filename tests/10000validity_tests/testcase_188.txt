import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul43750 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul43750 = tf.keras.layers.Input(shape=([2, 2]))
in0Con13663 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Min28346 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Min28346 = tf.keras.layers.Input(shape=([2, 2, 2]))

Mul43750 = keras.layers.Multiply(name = 'Mul43750', )([in0Mul43750,in1Mul43750])
Res90254 = keras.layers.Reshape((2, 2, 1), name = 'Res90254', )(Mul43750)
Con13663 = keras.layers.Concatenate(axis=3, name = 'Con13663', )([Res90254,in0Con13663])
Min28346 = keras.layers.Minimum(name = 'Min28346', )([in0Min28346,in1Min28346])
Sub44479 = keras.layers.Subtract(name = 'Sub44479', )([Con13663,Min28346])
Ave13820 = keras.layers.AveragePooling2D(pool_size=(1, 1), name = 'Ave13820', )(Sub44479)
model = tf.keras.models.Model(inputs=[in0Mul43750,in1Mul43750,in0Con13663,in0Min28346,in1Min28346], outputs=Ave13820)
in0Mul43750 = tf.constant([[[0.9227, 0.4016], [0.8842, 0.9203]]])
in1Mul43750 = tf.constant([[[0.8637, 0.5272], [0.4426, 0.5257]]])
in0Con13663 = tf.constant([[[[0.9745], [0.6958]], [[0.492], [0.4005]]]])
in0Min28346 = tf.constant([[[[0.8305, 0.2997], [0.4274, 0.1002]], [[0.6757, 0.6592], [0.4928, 0.737]]]])
in1Min28346 = tf.constant([[[[0.6298, 0.4717], [0.0016, 0.1281]], [[0.6999, 0.2153], [0.3137, 0.6543]]]])
print (np.array2string(model.predict([in0Mul43750,in1Mul43750,in0Con13663,in0Min28346,in1Min28346],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave13820.png')

LMul43750 = multiply_layer([[[[0.9227, 0.4016], [0.8842, 0.9203]]], [[[0.8637, 0.5272], [0.4426, 0.5257]]]], Mul43750), 
LRes90254 = reshape_layer(Mul43750, [2, 2, 1], Res90254), 
LCon13663 = concatenate_layer([Res90254,[[[[0.9745], [0.6958]], [[0.492], [0.4005]]]]], 3, Con13663), 
LMin28346 = minimum_layer([[[[[0.8305, 0.2997], [0.4274, 0.1002]], [[0.6757, 0.6592], [0.4928, 0.737]]]], [[[[0.6298, 0.4717], [0.0016, 0.1281]], [[0.6999, 0.2153], [0.3137, 0.6543]]]]], Min28346), 
LSub44479 = subtract_layer(Con13663,Min28346, Sub44479), 
LAve13820 = average_pooling2D_layer(Sub44479, 1, 1, Ave13820), 
exec_layers([LMul43750,LRes90254,LCon13663,LMin28346,LSub44479,LAve13820],["Mul43750","Res90254","Con13663","Min28346","Sub44479","Ave13820"],Ave13820,"Ave13820")

Actual (Unparsed): [[[[0.1671359, 0.6748000], [0.2101235, 0.5956000]], [[-0.2843531, 0.2767000], [0.1701017, -0.2538000]]]]

Expected (Unparsed): [[[[0.16713599,0.6748000000000001],[0.21012352,0.5956]],[[-0.28435308,0.2767],[0.17010170999999996,-0.25379999999999997]]]]

Actual:   [[[[0.1672, 0.6748], [0.2102, 0.5956]], [[-0.2843, 0.2767], [0.1702, -0.2538]]]]

Expected: [[[[0.1672, 0.6749], [0.2102, 0.5956]], [[-0.2843, 0.2767], [0.1702, -0.2537]]]]