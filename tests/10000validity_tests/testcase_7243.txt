import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max14654 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Max14654 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Mul91273 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Mul91273 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))

Max14654 = keras.layers.Maximum(name = 'Max14654', )([in0Max14654,in1Max14654])
Zer85383 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (0, 0)), name = 'Zer85383', )(Max14654)
Mul91273 = keras.layers.Multiply(name = 'Mul91273', )([in0Mul91273,in1Mul91273])
Ave27092 = keras.layers.Average(name = 'Ave27092', )([Zer85383,Mul91273])
Res83536 = keras.layers.Reshape((2, 2, 4), name = 'Res83536', )(Ave27092)
Con89077 = keras.layers.Conv2D(3, (1, 1),strides=(1, 7), padding='same', dilation_rate=(1, 1), name = 'Con89077', )(Res83536)
model = tf.keras.models.Model(inputs=[in0Max14654,in1Max14654,in0Mul91273,in1Mul91273], outputs=Con89077)
w = model.get_layer('Con89077').get_weights() 
w[0] = np.array([[[[0.5789, 0.2214, 0.7375], [0.4884, 0.1035, 0.1269], [0.9548, 0.0176, 0.8501], [0.8784, 0.4445, 0.8004]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con89077').set_weights(w) 
in0Max14654 = tf.constant([[[[[0.3311, 0.0061], [0.5235, 0.7527]], [[0.6961, 0.69], [0.4591, 0.0805]]]]])
in1Max14654 = tf.constant([[[[[0.109, 0.6871], [0.083, 0.0867]], [[0.1015, 0.5264], [0.3486, 0.5443]]]]])
in0Mul91273 = tf.constant([[[[[0.6271, 0.2288], [0.8219, 0.5422]], [[0.4375, 0.1958], [0.267, 0.477]]], [[[0.046, 0.4569], [0.965, 0.6366]], [[0.214, 0.2642], [0.9442, 0.893]]]]])
in1Mul91273 = tf.constant([[[[[0.6034, 0.8634], [0.0824, 0.0601]], [[0.3536, 0.7667], [0.7364, 0.6769]]], [[[0.86, 0.0089], [0.1528, 0.3291]], [[0.9606, 0.6746], [0.4171, 0.138]]]]])
print (np.array2string(model.predict([in0Max14654,in1Max14654,in0Mul91273,in1Mul91273],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con89077.png')

LMax14654 = maximum_layer([[[[[[0.3311, 0.0061], [0.5235, 0.7527]], [[0.6961, 0.69], [0.4591, 0.0805]]]]], [[[[[0.109, 0.6871], [0.083, 0.0867]], [[0.1015, 0.5264], [0.3486, 0.5443]]]]]], Max14654), 
LZer85383 = zero_padding3D_layer(Max14654, 1, 0, 0, 0, 0, 0, Zer85383), 
LMul91273 = multiply_layer([[[[[[0.6271, 0.2288], [0.8219, 0.5422]], [[0.4375, 0.1958], [0.267, 0.477]]], [[[0.046, 0.4569], [0.965, 0.6366]], [[0.214, 0.2642], [0.9442, 0.893]]]]], [[[[[0.6034, 0.8634], [0.0824, 0.0601]], [[0.3536, 0.7667], [0.7364, 0.6769]]], [[[0.86, 0.0089], [0.1528, 0.3291]], [[0.9606, 0.6746], [0.4171, 0.138]]]]]], Mul91273), 
LAve27092 = average_layer([Zer85383,Mul91273], Ave27092), 
LRes83536 = reshape_layer(Ave27092, [2, 2, 4], Res83536), 
LCon89077 = conv2D_layer(Res83536, 1, 1,[[[[0.5789, 0.2214, 0.7375], [0.4884, 0.1035, 0.1269], [0.9548, 0.0176, 0.8501], [0.8784, 0.4445, 0.8004]]]],[0, 0, 0], 1, 7, true, 1, 1, Con89077), 
exec_layers([LMax14654,LZer85383,LMul91273,LAve27092,LRes83536,LCon89077],["Max14654","Zer85383","Mul91273","Ave27092","Res83536","Con89077"],Con89077,"Con89077")

Actual (Unparsed): [[[[0.2044099, 0.0599493, 0.1938937]], [[1.0189833, 0.2965544, 0.8507980]]]]

Expected (Unparsed): [[[[0.20440989135500004,0.059949274781,0.19389371972100003]],[[1.0189833214739998,0.2965543759025,0.8507979963265]]]]

Actual:   [[[[0.2045, 0.06, 0.1939]], [[1.019, 0.2966, 0.8508]]]]

Expected: [[[[0.2045, 0.06, 0.1939]], [[1.019, 0.2966, 0.8508]]]]