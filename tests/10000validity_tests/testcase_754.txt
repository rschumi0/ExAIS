import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot89247 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot89247 = tf.keras.layers.Input(shape=([2, 2]))
in0Min74512 = tf.keras.layers.Input(shape=([2, 2]))
in1Min74512 = tf.keras.layers.Input(shape=([2, 2]))

Dot89247 = keras.layers.Dot(axes=(1, 2), name = 'Dot89247', )([in0Dot89247,in1Dot89247])
Sof49930 = keras.layers.Softmax(axis=1, name = 'Sof49930', )(Dot89247)
Min74512 = keras.layers.Minimum(name = 'Min74512', )([in0Min74512,in1Min74512])
Ave96844 = keras.layers.Average(name = 'Ave96844', )([Sof49930,Min74512])
model = tf.keras.models.Model(inputs=[in0Dot89247,in1Dot89247,in0Min74512,in1Min74512], outputs=Ave96844)
in0Dot89247 = tf.constant([[[0.0468, 0.0673], [0.6509, 0.5437]]])
in1Dot89247 = tf.constant([[[0.5529, 0.3952], [0.6042, 0.5088]]])
in0Min74512 = tf.constant([[[0.7041, 0.9518], [0.2293, 0.4287]]])
in1Min74512 = tf.constant([[[0.2934, 0.3005], [0.1222, 0.442]]])
print (np.array2string(model.predict([in0Dot89247,in1Dot89247,in0Min74512,in1Min74512],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave96844.png')

LDot89247 = dot_layer([[[0.0468, 0.0673], [0.6509, 0.5437]]], [[[0.5529, 0.3952], [0.6042, 0.5088]]], 1, 2, Dot89247), 
LSof49930 = softmax_layer(Dot89247, 1, Sof49930), 
LMin74512 = minimum_layer([[[[0.7041, 0.9518], [0.2293, 0.4287]]], [[[0.2934, 0.3005], [0.1222, 0.442]]]], Min74512), 
LAve96844 = average_layer([Sof49930,Min74512], Ave96844), 
exec_layers([LDot89247,LSof49930,LMin74512,LAve96844],["Dot89247","Sof49930","Min74512","Ave96844"],Ave96844,"Ave96844")

Actual (Unparsed): [[[0.4005786, 0.4055189], [0.3072214, 0.4590811]]]

Expected (Unparsed): [[[0.4005785625254527,0.4055188771872225],[0.30722143747454733,0.45908112281277746]]]

Actual:   [[[0.4006, 0.4056], [0.3073, 0.4591]]]

Expected: [[[0.4006, 0.4056], [0.3073, 0.4591]]]