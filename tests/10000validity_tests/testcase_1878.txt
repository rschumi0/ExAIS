import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave89341 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave89341 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Thr28519 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Dot18682 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot18682 = tf.keras.layers.Input(shape=([2, 2]))
in0Max15840 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Max15840 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))

Ave89341 = keras.layers.Average(name = 'Ave89341', )([in0Ave89341,in1Ave89341])
Res96835 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res96835', )(Ave89341)
Thr28519 = keras.layers.ThresholdedReLU(theta=2.672097240115948, name = 'Thr28519', input_shape=(2, 2, 1, 1))(in0Thr28519)
Cro24683 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro24683', )(Thr28519)
Add99151 = keras.layers.Add(name = 'Add99151', )([Res96835,Cro24683])
Zer63173 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer63173', )(Add99151)
Dot18682 = keras.layers.Dot(axes=(2, 2), name = 'Dot18682', )([in0Dot18682,in1Dot18682])
Sep71584 = keras.layers.SeparableConv1D(4, (1),strides=(1), padding='same', name = 'Sep71584', )(Dot18682)
Res10085 = keras.layers.Reshape((2, 4, 1), name = 'Res10085', )(Sep71584)
Res30811 = keras.layers.Reshape((2, 4, 1, 1), name = 'Res30811', )(Res10085)
Max15840 = keras.layers.Maximum(name = 'Max15840', )([in0Max15840,in1Max15840])
Zer67070 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer67070', )(Max15840)
Min97491 = keras.layers.Minimum(name = 'Min97491', )([Res30811,Zer67070])
Add9094 = keras.layers.Add(name = 'Add9094', )([Zer63173,Min97491])
model = tf.keras.models.Model(inputs=[in0Ave89341,in1Ave89341,in0Thr28519,in0Dot18682,in1Dot18682,in0Max15840,in1Max15840], outputs=Add9094)
w = model.get_layer('Sep71584').get_weights() 
w[0] = np.array([[[0.6861], [0.4259]]])
w[1] = np.array([[[0.17, 0.2375, 0.1055, 0.764], [0.0154, 0.0677, 0.0673, 0.5102]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep71584').set_weights(w) 
in0Ave89341 = tf.constant([[[[0.6431], [0.1711]], [[0.1258], [0.0221]]]])
in1Ave89341 = tf.constant([[[[0.6967], [0.6372]], [[0.0058], [0.9385]]]])
in0Thr28519 = tf.constant([[[[[0.7129]], [[0.8368]]], [[[0.873]], [[0.8631]]]]])
in0Dot18682 = tf.constant([[[0.0003, 0.0954], [0.5604, 0.2582]]])
in1Dot18682 = tf.constant([[[0.1885, 0.1409], [0.8353, 0.4438]]])
in0Max15840 = tf.constant([[[[[0.0085]], [[0.2425]]], [[[0.0238]], [[0.5414]]]]])
in1Max15840 = tf.constant([[[[[0.6956]], [[0.8195]]], [[[0.6757]], [[0.1639]]]]])
print (np.array2string(model.predict([in0Ave89341,in1Ave89341,in0Thr28519,in0Dot18682,in1Dot18682,in0Max15840,in1Max15840],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add9094.png')

LAve89341 = average_layer([[[[[0.6431], [0.1711]], [[0.1258], [0.0221]]]], [[[[0.6967], [0.6372]], [[0.0058], [0.9385]]]]], Ave89341), 
LRes96835 = reshape_layer(Ave89341, [2, 2, 1, 1], Res96835), 
LThr28519 = thresholded_relu_layer([[[[[0.7129]], [[0.8368]]], [[[0.873]], [[0.8631]]]]], 2.672097240115948, Thr28519), 
LCro24683 = cropping3D_layer(Thr28519, 0, 0, 0, 0, 0, 0, Cro24683), 
LAdd99151 = add_layer([Res96835,Cro24683], Add99151), 
LZer63173 = zero_padding3D_layer(Add99151, 0, 0, 2, 0, 0, 0, Zer63173), 
LDot18682 = dot_layer([[[0.0003, 0.0954], [0.5604, 0.2582]]], [[[0.1885, 0.1409], [0.8353, 0.4438]]], 2, 2, Dot18682), 
LSep71584 = separable_conv1D_layer(Dot18682, 1,[[[[0.6861], [0.4259]]],[[[0.17, 0.2375, 0.1055, 0.764], [0.0154, 0.0677, 0.0673, 0.5102]]]],[0, 0, 0, 0], 1, true, Sep71584), 
LRes10085 = reshape_layer(Sep71584, [2, 4, 1], Res10085), 
LRes30811 = reshape_layer(Res10085, [2, 4, 1, 1], Res30811), 
LMax15840 = maximum_layer([[[[[[0.0085]], [[0.2425]]], [[[0.0238]], [[0.5414]]]]], [[[[[0.6956]], [[0.8195]]], [[[0.6757]], [[0.1639]]]]]], Max15840), 
LZer67070 = zero_padding3D_layer(Max15840, 0, 0, 2, 0, 0, 0, Zer67070), 
LMin97491 = minimum_layer([Res30811,Zer67070], Min97491), 
LAdd9094 = add_layer([Zer63173,Min97491], Add9094), 
exec_layers([LAve89341,LRes96835,LThr28519,LCro24683,LAdd99151,LZer63173,LDot18682,LSep71584,LRes10085,LRes30811,LMax15840,LZer67070,LMin97491,LAdd9094],["Ave89341","Res96835","Thr28519","Cro24683","Add99151","Zer63173","Dot18682","Sep71584","Res10085","Res30811","Max15840","Zer67070","Min97491","Add9094"],Add9094,"Add9094")

Actual (Unparsed): [[[[[0.0000000]], [[0.0000000]], [[0.6720978]], [[0.4204800]]], [[[0.0000000]], [[0.0000000]], [[0.0927813]], [[0.6813573]]]]]

Expected (Unparsed): [[[[[0]],[[0]],[[0.6720977974763231]],[[0.4204799676875438]]],[[[0]],[[0]],[[0.0927813272594486]],[[0.6813573122474624]]]]]

Actual:   [[[[[0]], [[0]], [[0.6721]], [[0.4205]]], [[[0]], [[0]], [[0.0928]], [[0.6814]]]]]

Expected: [[[[[0]], [[0]], [[0.6721]], [[0.4205]]], [[[0]], [[0]], [[0.0928]], [[0.6814]]]]]