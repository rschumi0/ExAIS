import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub4073 = tf.keras.layers.Input(shape=([2, 2, 3]))
in1Sub4073 = tf.keras.layers.Input(shape=([2, 2, 3]))

Sub4073 = keras.layers.Subtract(name = 'Sub4073', )([in0Sub4073,in1Sub4073])
Bat13442 = keras.layers.BatchNormalization(axis=2, epsilon=0.5329973839694009,  name = 'Bat13442', )(Sub4073)
Max70274 = keras.layers.MaxPool2D(pool_size=(2, 2), name = 'Max70274', )(Bat13442)
model = tf.keras.models.Model(inputs=[in0Sub4073,in1Sub4073], outputs=Max70274)
w = model.get_layer('Bat13442').get_weights() 
w[0] = np.array([0.8486, 0.1103])
w[1] = np.array([0.1583, 0.696])
w[2] = np.array([0.138, 0.596])
w[3] = np.array([0.5164, 0.7304])
model.get_layer('Bat13442').set_weights(w) 
in0Sub4073 = tf.constant([[[[0.4682, 0.0167, 0.4302], [0.0846, 0.3156, 0.8955]], [[0.1178, 0.8205, 0.8103], [0.1286, 0.3166, 0.4116]]]])
in1Sub4073 = tf.constant([[[[0.363, 0.8303, 0.6639], [0.3363, 0.4858, 0.0689]], [[0.134, 0.5389, 0.472], [0.4097, 0.7086, 0.5409]]]])
print (np.array2string(model.predict([in0Sub4073,in1Sub4073],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max70274.png')

LSub4073 = subtract_layer([[[[0.4682, 0.0167, 0.4302], [0.0846, 0.3156, 0.8955]], [[0.1178, 0.8205, 0.8103], [0.1286, 0.3166, 0.4116]]]], [[[[0.363, 0.8303, 0.6639], [0.3363, 0.4858, 0.0689]], [[0.134, 0.5389, 0.472], [0.4097, 0.7086, 0.5409]]]], Sub4073), 
LBat13442 = batch_normalization_layer(Sub4073, 2, 0.5329973839694009, [0.8486, 0.1103], [0.1583, 0.696], [0.138, 0.596], [0.5164, 0.7304], Bat13442), 
LMax70274 = max_pool2D_layer(Bat13442, 2, 2, Max70274), 
exec_layers([LSub4073,LBat13442,LMax70274],["Sub4073","Bat13442","Max70274"],Max70274,"Max70274")

Actual (Unparsed): [[[[0.6128145, 0.6208121, 0.7186290]]]]

Expected (Unparsed): [[[[0.6128144851370365,0.6208121487696088,0.7186289721922843]]]]

Actual:   [[[[0.6129, 0.6209, 0.7187]]]]

Expected: [[[[0.6129, 0.6209, 0.7187]]]]