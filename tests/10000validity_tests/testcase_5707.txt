import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Zer37318 = tf.keras.layers.Input(shape=([3, 3]))
in0Con85536 = tf.keras.layers.Input(shape=([5, 1]))
in0Con48724 = tf.keras.layers.Input(shape=([2, 1]))
in0Ave80295 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave80295 = tf.keras.layers.Input(shape=([2, 2]))
in0Con39274 = tf.keras.layers.Input(shape=([2, 2]))
in0Min87173 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Min87173 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Con14269 = tf.keras.layers.Input(shape=([5, 14]))

Zer37318 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer37318', )(in0Zer37318)
Con85536 = keras.layers.Concatenate(axis=2, name = 'Con85536', )([Zer37318,in0Con85536])
Con48724 = keras.layers.Conv1D(4, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con48724', )(in0Con48724)
Ave80295 = keras.layers.Average(name = 'Ave80295', )([in0Ave80295,in1Ave80295])
Con39274 = keras.layers.Concatenate(axis=2, name = 'Con39274', )([Ave80295,in0Con39274])
Max40793 = keras.layers.Maximum(name = 'Max40793', )([Con48724,Con39274])
Zer24233 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer24233', )(Max40793)
Min59105 = keras.layers.Minimum(name = 'Min59105', )([Con85536,Zer24233])
Res61212 = keras.layers.Reshape((5, 4, 1), name = 'Res61212', )(Min59105)
Con13690 = keras.layers.Conv2DTranspose(4, (4, 3),strides=(1, 1), padding='same', name = 'Con13690', )(Res61212)
Res32685 = keras.layers.Reshape((5, 16), name = 'Res32685', )(Con13690)
Min87173 = keras.layers.Minimum(name = 'Min87173', )([in0Min87173,in1Min87173])
Res23825 = keras.layers.Reshape((2, 1, 2), name = 'Res23825', )(Min87173)
Res35992 = keras.layers.Reshape((2, 2), name = 'Res35992', )(Res23825)
Per2710 = keras.layers.Permute((1,2), name = 'Per2710',)(Res35992)
Zer22793 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer22793', )(Per2710)
Con14269 = keras.layers.Concatenate(axis=2, name = 'Con14269', )([Zer22793,in0Con14269])
Sub97000 = keras.layers.Subtract(name = 'Sub97000', )([Res32685,Con14269])
model = tf.keras.models.Model(inputs=[in0Zer37318,in0Con85536,in0Con48724,in0Ave80295,in1Ave80295,in0Con39274,in0Min87173,in1Min87173,in0Con14269], outputs=Sub97000)
w = model.get_layer('Con48724').get_weights() 
w[0] = np.array([[[0.792, 0.746, 0.9781, 0.5174]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con48724').set_weights(w) 
w = model.get_layer('Con13690').get_weights() 
w[0] = np.array([[[[0.0165], [0.1815], [0.8612], [0.6107]], [[0.4838], [0.596], [0.831], [0.8254]], [[0.601], [0.7404], [0.4767], [0.7034]]], [[[0.8336], [0.4161], [0.861], [0.78]], [[0.1143], [0.9868], [0.2057], [0.3877]], [[0.5493], [0.7464], [0.6978], [0.5892]]], [[[0.0214], [0.162], [0.9737], [0.8041]], [[0.4161], [0.5058], [0.9003], [0.8696]], [[0.1795], [0.3535], [0.7742], [0.3814]]], [[[0.1845], [0.9175], [0.3413], [0.2916]], [[0.4297], [0.2102], [0.1027], [0.9073]], [[0.9242], [0.587], [0.2176], [0.6283]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con13690').set_weights(w) 
in0Zer37318 = tf.constant([[[1.5532, 1.071, 1.9604], [1.5591, 1.6898, 1.9222], [1.3009, 1.6189, 1.2548]]])
in0Con85536 = tf.constant([[[0.6302], [0.4409], [0.6348], [0.9058], [0.66]]])
in0Con48724 = tf.constant([[[0.7057], [0.7863]]])
in0Ave80295 = tf.constant([[[0.1824, 0.877], [0.7703, 0.4984]]])
in1Ave80295 = tf.constant([[[0.6399, 0.9483], [0.8314, 0.8086]]])
in0Con39274 = tf.constant([[[0.1298, 0.9201], [0.7353, 0.5821]]])
in0Min87173 = tf.constant([[[[[0.511, 0.7252]]], [[[0.3022, 0.8038]]]]])
in1Min87173 = tf.constant([[[[[0.4574, 0.2443]]], [[[0.7815, 0.7788]]]]])
in0Con14269 = tf.constant([[[0.9964, 0.4556, 0.7967, 0.3997, 0.9453, 0.7226, 0.8551, 0.4883, 0.5732, 0.1019, 0.9855, 0.1781, 0.9708, 0.1025], [0.4596, 0.2225, 0.3801, 0.088, 0.1219, 0.6723, 0.7826, 0.7881, 0.0214, 0.4256, 0.6064, 0.8779, 0.5479, 0.8944], [0.2427, 0.7727, 0.0625, 0.0249, 0.8937, 0.755, 0.928, 0.0783, 0.5136, 0.1667, 0.6593, 0.9023, 0.25, 0.6856], [0.6386, 0.906, 0.8438, 0.6312, 0.4707, 0.5885, 0.9059, 0.8434, 0.588, 0.2664, 0.8508, 0.92, 0.1598, 0.5923], [0.5384, 0.5022, 0.7059, 0.5676, 0.3542, 0.8621, 0.0731, 0.0117, 0.5372, 0.253, 0.5904, 0.8704, 0.058, 0.366]]])
print (np.array2string(model.predict([in0Zer37318,in0Con85536,in0Con48724,in0Ave80295,in1Ave80295,in0Con39274,in0Min87173,in1Min87173,in0Con14269],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub97000.png')

LZer37318 = zero_padding1D_layer([[[1.5532, 1.071, 1.9604], [1.5591, 1.6898, 1.9222], [1.3009, 1.6189, 1.2548]]], 1, 1, Zer37318), 
LCon85536 = concatenate_layer([Zer37318,[[[0.6302], [0.4409], [0.6348], [0.9058], [0.66]]]], 2, Con85536), 
LCon48724 = conv1D_layer([[[0.7057], [0.7863]]], 1,[[[0.792, 0.746, 0.9781, 0.5174]]],[0, 0, 0, 0], 1, false, 1, Con48724), 
LAve80295 = average_layer([[[[0.1824, 0.877], [0.7703, 0.4984]]], [[[0.6399, 0.9483], [0.8314, 0.8086]]]], Ave80295), 
LCon39274 = concatenate_layer([Ave80295,[[[0.1298, 0.9201], [0.7353, 0.5821]]]], 2, Con39274), 
LMax40793 = maximum_layer([Con48724,Con39274], Max40793), 
LZer24233 = zero_padding1D_layer(Max40793, 3, 0, Zer24233), 
LMin59105 = minimum_layer([Con85536,Zer24233], Min59105), 
LRes61212 = reshape_layer(Min59105, [5, 4, 1], Res61212), 
LCon13690 = conv2D_transpose_layer(Res61212, 4, 3,[[[[0.0165], [0.1815], [0.8612], [0.6107]], [[0.4838], [0.596], [0.831], [0.8254]], [[0.601], [0.7404], [0.4767], [0.7034]]], [[[0.8336], [0.4161], [0.861], [0.78]], [[0.1143], [0.9868], [0.2057], [0.3877]], [[0.5493], [0.7464], [0.6978], [0.5892]]], [[[0.0214], [0.162], [0.9737], [0.8041]], [[0.4161], [0.5058], [0.9003], [0.8696]], [[0.1795], [0.3535], [0.7742], [0.3814]]], [[[0.1845], [0.9175], [0.3413], [0.2916]], [[0.4297], [0.2102], [0.1027], [0.9073]], [[0.9242], [0.587], [0.2176], [0.6283]]]],[0, 0, 0, 0], 1, 1, true, Con13690), 
LRes32685 = reshape_layer(Con13690, [5, 16], Res32685), 
LMin87173 = minimum_layer([[[[[[0.511, 0.7252]]], [[[0.3022, 0.8038]]]]], [[[[[0.4574, 0.2443]]], [[[0.7815, 0.7788]]]]]], Min87173), 
LRes23825 = reshape_layer(Min87173, [2, 1, 2], Res23825), 
LRes35992 = reshape_layer(Res23825, [2, 2], Res35992), 
LPer2710 = permute_layer(Res35992, 1,2, Per2710), 
LZer22793 = zero_padding1D_layer(Per2710, 3, 0, Zer22793), 
LCon14269 = concatenate_layer([Zer22793,[[[0.9964, 0.4556, 0.7967, 0.3997, 0.9453, 0.7226, 0.8551, 0.4883, 0.5732, 0.1019, 0.9855, 0.1781, 0.9708, 0.1025], [0.4596, 0.2225, 0.3801, 0.088, 0.1219, 0.6723, 0.7826, 0.7881, 0.0214, 0.4256, 0.6064, 0.8779, 0.5479, 0.8944], [0.2427, 0.7727, 0.0625, 0.0249, 0.8937, 0.755, 0.928, 0.0783, 0.5136, 0.1667, 0.6593, 0.9023, 0.25, 0.6856], [0.6386, 0.906, 0.8438, 0.6312, 0.4707, 0.5885, 0.9059, 0.8434, 0.588, 0.2664, 0.8508, 0.92, 0.1598, 0.5923], [0.5384, 0.5022, 0.7059, 0.5676, 0.3542, 0.8621, 0.0731, 0.0117, 0.5372, 0.253, 0.5904, 0.8704, 0.058, 0.366]]]], 2, Con14269), 
LSub97000 = subtract_layer(Res32685,Con14269, Sub97000), 
exec_layers([LZer37318,LCon85536,LCon48724,LAve80295,LCon39274,LMax40793,LZer24233,LMin59105,LRes61212,LCon13690,LRes32685,LMin87173,LRes23825,LRes35992,LPer2710,LZer22793,LCon14269,LSub97000],["Zer37318","Con85536","Con48724","Ave80295","Con39274","Max40793","Zer24233","Min59105","Res61212","Con13690","Res32685","Min87173","Res23825","Res35992","Per2710","Zer22793","Con14269","Sub97000"],Sub97000,"Sub97000")

Actual (Unparsed): [[[0.0000000, 0.0000000, -0.9964000, -0.4556000, -0.7967000, -0.3997000, -0.9453000, -0.7226000, -0.8551000, -0.4883000, -0.5732000, -0.1019000, -0.9855000, -0.1781000, -0.9708000, -0.1025000], [0.0000000, 0.0000000, -0.4596000, -0.2225000, -0.3801000, -0.0880000, -0.1219000, -0.6723000, -0.7826000, -0.7881000, -0.0214000, -0.4256000, -0.6064000, -0.8779000, -0.5479000, -0.8944000], [0.2854615, 0.4987589, 1.0077320, 0.2459833, 0.7263367, 1.0581391, 0.7255857, 0.8129744, -0.0306110, 1.1732149, 1.2751289, 1.5981584, 0.1937633, 0.1486143, 0.8317597, 0.5475658], [0.3672690, 0.6869904, 0.2621603, 0.0225581, 0.1429159, 0.9737877, 0.7013436, 0.6330380, 0.4389932, 1.0014904, 1.4720289, 1.6009539, -0.0864954, 0.8359740, 0.9919012, 0.6460364], [-0.0501050, -0.3482518, 0.8534379, 0.7176938, -0.2110500, 0.2034143, 1.5722620, 0.6997365, 0.8825543, 1.0489992, 2.1739669, 1.8777136, -0.0230636, 0.4061715, 1.4116175, 0.9106233]]]

Expected (Unparsed): [[[0.0,0.0,-0.9964,-0.4556,-0.7967,-0.3997,-0.9453,-0.7226,-0.8551,-0.4883,-0.5732,-0.1019,-0.9855,-0.1781,-0.9708,-0.1025],[0.0,0.0,-0.4596,-0.2225,-0.3801,-0.088,-0.1219,-0.6723,-0.7826,-0.7881,-0.0214,-0.4256,-0.6064,-0.8779,-0.5479,-0.8944],[0.28546151172,0.4987589574,1.0077320464000001,0.24598330075999997,0.726336669705,1.058139120115,0.7255857848839998,0.8129744242789999,-0.03061103675400012,1.1732148813199998,1.2751289512700001,1.598158433318,0.19376338716999997,0.1486143238680001,0.831759672539,0.5475657725780001],[0.36726895592000003,0.68699039492,0.26216034208000005,0.02255811287999998,0.14291594863200008,0.9737877433969999,0.7013436646899999,0.6330380020799999,0.4389931979309999,1.0014904237559996,1.4720289214689997,1.600953902409,-0.08649540811900003,0.8359740348879999,0.9919012396260001,0.646036454164],[-0.05010500816000002,-0.34825179648000004,0.85343793932,0.7176938272400002,-0.21104995356199996,0.20341432793999992,1.5722620455089997,0.6997365333569999,0.882554370237,1.0489991919859998,2.1739669165509996,1.877713689832,-0.023063581984999915,0.40617158759499994,1.411617520614,0.910623357838]]]

Actual:   [[[0, 0, -0.9964, -0.4556, -0.7967, -0.3997, -0.9453, -0.7226, -0.8551, -0.4883, -0.5732, -0.1019, -0.9855, -0.1781, -0.9708, -0.1025], [0, 0, -0.4596, -0.2225, -0.3801, -0.088, -0.1219, -0.6723, -0.7826, -0.7881, -0.0214, -0.4256, -0.6064, -0.8779, -0.5479, -0.8944], [0.2855, 0.4988, 1.0078, 0.246, 0.7264, 1.0582, 0.7256, 0.813, -0.0306, 1.1733, 1.2752, 1.5982, 0.1938, 0.1487, 0.8318, 0.5476], [0.3673, 0.687, 0.2622, 0.0226, 0.143, 0.9738, 0.7014, 0.6331, 0.439, 1.0015, 1.4721, 1.601, -0.0864, 0.836, 0.992, 0.6461], [-0.0501, -0.3482, 0.8535, 0.7177, -0.211, 0.2035, 1.5723, 0.6998, 0.8826, 1.049, 2.174, 1.8778, -0.023, 0.4062, 1.4117, 0.9107]]]

Expected: [[[0, 0, -0.9964, -0.4556, -0.7967, -0.3997, -0.9453, -0.7226, -0.8551, -0.4883, -0.5732, -0.1019, -0.9855, -0.1781, -0.9708, -0.1025], [0, 0, -0.4596, -0.2225, -0.3801, -0.088, -0.1219, -0.6723, -0.7826, -0.7881, -0.0214, -0.4256, -0.6064, -0.8779, -0.5479, -0.8944], [0.2855, 0.4988, 1.0078, 0.246, 0.7264, 1.0582, 0.7256, 0.813, -0.0306, 1.1733, 1.2752, 1.5982, 0.1938, 0.1487, 0.8318, 0.5476], [0.3673, 0.687, 0.2622, 0.0226, 0.143, 0.9738, 0.7014, 0.6331, 0.439, 1.0015, 1.4721, 1.601, -0.0864, 0.836, 0.992, 0.6461], [-0.0501, -0.3482, 0.8535, 0.7177, -0.211, 0.2035, 1.5723, 0.6998, 0.8826, 1.049, 2.174, 1.8778, -0.023, 0.4062, 1.4117, 0.9107]]]