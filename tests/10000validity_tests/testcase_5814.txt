import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot59556 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot59556 = tf.keras.layers.Input(shape=([2, 3]))
in0Con73414 = tf.keras.layers.Input(shape=([3, 2, 2, 1]))
in0Sub62175 = tf.keras.layers.Input(shape=([3, 2, 2, 2]))
in1Sub62175 = tf.keras.layers.Input(shape=([3, 2, 2, 2]))
in0Mul90996 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul90996 = tf.keras.layers.Input(shape=([1, 1]))
in0Con52816 = tf.keras.layers.Input(shape=([22]))

Dot59556 = keras.layers.Dot(axes=(2, 2), name = 'Dot59556', )([in0Dot59556,in1Dot59556])
Res68337 = keras.layers.Reshape((2, 2, 1), name = 'Res68337', )(Dot59556)
Res57983 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res57983', )(Res68337)
Zer29054 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (1, 0)), name = 'Zer29054', )(Res57983)
Con73414 = keras.layers.Concatenate(axis=4, name = 'Con73414', )([Zer29054,in0Con73414])
Sub62175 = keras.layers.Subtract(name = 'Sub62175', )([in0Sub62175,in1Sub62175])
Sub88987 = keras.layers.Subtract(name = 'Sub88987', )([Con73414,Sub62175])
Res68042 = keras.layers.Reshape((3, 2, 4), name = 'Res68042', )(Sub88987)
Res70782 = keras.layers.Reshape((3, 8), name = 'Res70782', )(Res68042)
Fla90801 = keras.layers.Flatten(name = 'Fla90801', )(Res70782)
Mul90996 = keras.layers.Multiply(name = 'Mul90996', )([in0Mul90996,in1Mul90996])
GRU33419 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU33419', )(Mul90996)
Con52816 = keras.layers.Concatenate(axis=1, name = 'Con52816', )([GRU33419,in0Con52816])
Min49878 = keras.layers.Minimum(name = 'Min49878', )([Fla90801,Con52816])
model = tf.keras.models.Model(inputs=[in0Dot59556,in1Dot59556,in0Con73414,in0Sub62175,in1Sub62175,in0Mul90996,in1Mul90996,in0Con52816], outputs=Min49878)
w = model.get_layer('GRU33419').get_weights() 
w[0] = np.array([[10, 2, 6, 6, 2, 1]])
w[1] = np.array([[5, 2, 4, 5, 4, 3], [5, 2, 4, 4, 6, 9]])
w[2] = np.array([[6, 7, 7, 8, 6, 8], [3, 2, 6, 4, 3, 5]])
model.get_layer('GRU33419').set_weights(w) 
in0Dot59556 = tf.constant([[[0.2981, 0.4706, 0.0523], [0.3607, 0.1173, 0.4201]]])
in1Dot59556 = tf.constant([[[0.7364, 0.6492, 0.3993], [0.416, 0.3139, 0.2068]]])
in0Con73414 = tf.constant([[[[[0.0908], [0.4139]], [[0.2469], [0.179]]], [[[0.8813], [0.2254]], [[0.7573], [0.431]]], [[[0.2818], [0.3766]], [[0.5865], [0.3459]]]]])
in0Sub62175 = tf.constant([[[[[0.7625, 0.1829], [0.6841, 0.9336]], [[0.2596, 0.7877], [0.2194, 0.9449]]], [[[0.0589, 0.1659], [0.4417, 0.682]], [[0.218, 0.6492], [0.6829, 0.8997]]], [[[0.7978, 0.8973], [0.9864, 0.851]], [[0.0546, 0.5092], [0.5713, 0.5629]]]]])
in1Sub62175 = tf.constant([[[[[0.3456, 0.1184], [0.1553, 0.8312]], [[0.6812, 0.9601], [0.3137, 0.4479]]], [[[0.5693, 0.7393], [0.8358, 0.2194]], [[0.9084, 0.1274], [0.7331, 0.5345]]], [[[0.2078, 0.3651], [0.1541, 0.5966]], [[0.3403, 0.2625], [0.9625, 0.9477]]]]])
in0Mul90996 = tf.constant([[[0.3647]]])
in1Mul90996 = tf.constant([[[0.3506]]])
in0Con52816 = tf.constant([[0.6754, 0.4808, 0.9333, 0.4938, 0.7515, 0.8168, 0.4125, 0.3117, 0.0187, 0.6618, 0.8756, 0.8668, 0.0102, 0.981, 0.903, 0.4714, 0.5813, 0.1241, 0.9978, 0.9781, 0.8275, 0.0096]])
print (np.array2string(model.predict([in0Dot59556,in1Dot59556,in0Con73414,in0Sub62175,in1Sub62175,in0Mul90996,in1Mul90996,in0Con52816],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min49878.png')

LDot59556 = dot_layer([[[0.2981, 0.4706, 0.0523], [0.3607, 0.1173, 0.4201]]], [[[0.7364, 0.6492, 0.3993], [0.416, 0.3139, 0.2068]]], 2, 2, Dot59556), 
LRes68337 = reshape_layer(Dot59556, [2, 2, 1], Res68337), 
LRes57983 = reshape_layer(Res68337, [2, 2, 1, 1], Res57983), 
LZer29054 = zero_padding3D_layer(Res57983, 1, 0, 0, 0, 1, 0, Zer29054), 
LCon73414 = concatenate_layer([Zer29054,[[[[[0.0908], [0.4139]], [[0.2469], [0.179]]], [[[0.8813], [0.2254]], [[0.7573], [0.431]]], [[[0.2818], [0.3766]], [[0.5865], [0.3459]]]]]], 4, Con73414), 
LSub62175 = subtract_layer([[[[[0.7625, 0.1829], [0.6841, 0.9336]], [[0.2596, 0.7877], [0.2194, 0.9449]]], [[[0.0589, 0.1659], [0.4417, 0.682]], [[0.218, 0.6492], [0.6829, 0.8997]]], [[[0.7978, 0.8973], [0.9864, 0.851]], [[0.0546, 0.5092], [0.5713, 0.5629]]]]], [[[[[0.3456, 0.1184], [0.1553, 0.8312]], [[0.6812, 0.9601], [0.3137, 0.4479]]], [[[0.5693, 0.7393], [0.8358, 0.2194]], [[0.9084, 0.1274], [0.7331, 0.5345]]], [[[0.2078, 0.3651], [0.1541, 0.5966]], [[0.3403, 0.2625], [0.9625, 0.9477]]]]], Sub62175), 
LSub88987 = subtract_layer(Con73414,Sub62175, Sub88987), 
LRes68042 = reshape_layer(Sub88987, [3, 2, 4], Res68042), 
LRes70782 = reshape_layer(Res68042, [3, 8], Res70782), 
LFla90801 = flatten_layer(Res70782, Fla90801), 
LMul90996 = multiply_layer([[[[0.3647]]], [[[0.3506]]]], Mul90996), 
LGRU33419 = gru_layer(Mul90996,[[10, 2, 6, 6, 2, 1]],[[5, 2, 4, 5, 4, 3], [5, 2, 4, 4, 6, 9]],[[6, 7, 7, 8, 6, 8], [3, 2, 6, 4, 3, 5]], true, GRU33419), 
LCon52816 = concatenate_layer([GRU33419,[[0.6754, 0.4808, 0.9333, 0.4938, 0.7515, 0.8168, 0.4125, 0.3117, 0.0187, 0.6618, 0.8756, 0.8668, 0.0102, 0.981, 0.903, 0.4714, 0.5813, 0.1241, 0.9978, 0.9781, 0.8275, 0.0096]]], 1, Con52816), 
LMin49878 = minimum_layer([Fla90801,Con52816], Min49878), 
exec_layers([LDot59556,LRes68337,LRes57983,LZer29054,LCon73414,LSub62175,LSub88987,LRes68042,LRes70782,LFla90801,LMul90996,LGRU33419,LCon52816,LMin49878],["Dot59556","Res68337","Res57983","Zer29054","Con73414","Sub62175","Sub88987","Res68042","Res70782","Fla90801","Mul90996","GRU33419","Con52816","Min49878"],Min49878,"Min49878")

Actual (Unparsed): [[-0.4169000, 0.0000956, -0.5288000, 0.3115000, 0.4216000, 0.4193000, 0.0943000, -0.3180000, 0.4125000, 0.3117000, 0.0187000, -0.2372000, 0.6904000, 0.2355000, 0.0102000, 0.0658000, -0.5900000, -0.2504000, -0.3227834, 0.1222000, 0.2857000, 0.3398000, 0.6649483, 0.0096000]]

Expected (Unparsed): [[-0.41689999999999994,9.555360126180967e-5,-0.5288,0.31150000000000005,0.42160000000000003,0.4193,0.09429999999999997,-0.31799999999999995,0.4125,0.3117,0.0187,-0.23720000000000002,0.6904,0.23549999999999993,0.0102,0.06579999999999991,-0.59,-0.2504,-0.3227834300000001,0.12220000000000003,0.2857,0.33980000000000005,0.66494835,0.0096]]

Actual:   [[-0.4169, 0.0001, -0.5288, 0.3115, 0.4216, 0.4193, 0.0943, -0.318, 0.4125, 0.3117, 0.0187, -0.2372, 0.6904, 0.2355, 0.0102, 0.0658, -0.59, -0.2504, -0.3227, 0.1222, 0.2857, 0.3398, 0.665, 0.0096]]

Expected: [[-0.4168, 0.0001, -0.5288, 0.3116, 0.4217, 0.4193, 0.0943, -0.3179, 0.4125, 0.3117, 0.0187, -0.2372, 0.6904, 0.2355, 0.0102, 0.0658, -0.59, -0.2504, -0.3227, 0.1223, 0.2857, 0.3399, 0.665, 0.0096]]