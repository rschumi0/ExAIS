import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul95501 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul95501 = tf.keras.layers.Input(shape=([2, 2]))
in0Con35212 = tf.keras.layers.Input(shape=([2, 1]))
in0Add40137 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Add40137 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Sub45079 = tf.keras.layers.Input(shape=([2]))
in1Sub45079 = tf.keras.layers.Input(shape=([2]))
in0Con52102 = tf.keras.layers.Input(shape=([8]))

Mul95501 = keras.layers.Multiply(name = 'Mul95501', )([in0Mul95501,in1Mul95501])
Con35212 = keras.layers.Concatenate(axis=2, name = 'Con35212', )([Mul95501,in0Con35212])
Add40137 = keras.layers.Add(name = 'Add40137', )([in0Add40137,in1Add40137])
Res44136 = keras.layers.Reshape((2, 2, 4), name = 'Res44136', )(Add40137)
Loc40357 = keras.layers.LocallyConnected2D(3, (1, 2),strides=(1, 1), name = 'Loc40357', )(Res44136)
Res53198 = keras.layers.Reshape((2, 3), name = 'Res53198', )(Loc40357)
Dot9248 = keras.layers.Dot(axes=(1, 1), name = 'Dot9248', )([Con35212,Res53198])
Fla97232 = keras.layers.Flatten(name = 'Fla97232', )(Dot9248)
Sub45079 = keras.layers.Subtract(name = 'Sub45079', )([in0Sub45079,in1Sub45079])
Res72026 = keras.layers.Reshape((2, 1), name = 'Res72026', )(Sub45079)
Glo60859 = keras.layers.GlobalMaxPool1D(name = 'Glo60859', )(Res72026)
Con52102 = keras.layers.Concatenate(axis=1, name = 'Con52102', )([Glo60859,in0Con52102])
Sub52562 = keras.layers.Subtract(name = 'Sub52562', )([Fla97232,Con52102])
model = tf.keras.models.Model(inputs=[in0Mul95501,in1Mul95501,in0Con35212,in0Add40137,in1Add40137,in0Sub45079,in1Sub45079,in0Con52102], outputs=Sub52562)
w = model.get_layer('Loc40357').get_weights() 
w[0] = np.array([[[0.1779, 0.5106, 0.2012], [0.7139, 0.0767, 0.3107], [0.3778, 0.5545, 0.7142], [0.1136, 0.5428, 0.8706], [0.5802, 0.1146, 0.8474], [0.6217, 0.2001, 0.36], [0.2593, 0.9407, 0.9185], [0.7458, 0.9595, 0.2293]], [[0.8683, 0.9074, 0.2665], [0.2591, 0.7246, 0.2561], [0.3135, 0.6679, 0.506], [0.1596, 0.8228, 0.5561], [0.515, 0.4073, 0.1026], [0.1125, 0.4897, 0.653], [0.8254, 0.3284, 0.1754], [0.4881, 0.2354, 0.8952]]])
w[1] = np.array([[[0, 0, 0]], [[0, 0, 0]]])
model.get_layer('Loc40357').set_weights(w) 
in0Mul95501 = tf.constant([[[0.8847, 0.2394], [0.0835, 0.4896]]])
in1Mul95501 = tf.constant([[[0.4963, 0.9479], [0.0539, 0.974]]])
in0Con35212 = tf.constant([[[0.2729], [0.59]]])
in0Add40137 = tf.constant([[[[[0.2136, 0.7917], [0.2723, 0.0082]], [[0.3112, 0.719], [0.5728, 0.555]]], [[[0.7927, 0.4297], [0.2556, 0.516]], [[0.6806, 0.2163], [0.8652, 0.5913]]]]])
in1Add40137 = tf.constant([[[[[0.8068, 0.1391], [0.5661, 0.628]], [[0.832, 0.29], [0.1883, 0.4045]]], [[[0.7641, 0.6981], [0.8804, 0.0446]], [[0.6817, 0.3755], [0.5775, 0.1573]]]]])
in0Sub45079 = tf.constant([[0.7245, 0.1113]])
in1Sub45079 = tf.constant([[0.1694, 0.3594]])
in0Con52102 = tf.constant([[0.1761, 0.6257, 0.0799, 0.5673, 0.8349, 0.9373, 0.0323, 0.1973]])
print (np.array2string(model.predict([in0Mul95501,in1Mul95501,in0Con35212,in0Add40137,in1Add40137,in0Sub45079,in1Sub45079,in0Con52102],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub52562.png')

LMul95501 = multiply_layer([[[[0.8847, 0.2394], [0.0835, 0.4896]]], [[[0.4963, 0.9479], [0.0539, 0.974]]]], Mul95501), 
LCon35212 = concatenate_layer([Mul95501,[[[0.2729], [0.59]]]], 2, Con35212), 
LAdd40137 = add_layer([[[[[[0.2136, 0.7917], [0.2723, 0.0082]], [[0.3112, 0.719], [0.5728, 0.555]]], [[[0.7927, 0.4297], [0.2556, 0.516]], [[0.6806, 0.2163], [0.8652, 0.5913]]]]], [[[[[0.8068, 0.1391], [0.5661, 0.628]], [[0.832, 0.29], [0.1883, 0.4045]]], [[[0.7641, 0.6981], [0.8804, 0.0446]], [[0.6817, 0.3755], [0.5775, 0.1573]]]]]], Add40137), 
LRes44136 = reshape_layer(Add40137, [2, 2, 4], Res44136), 
LLoc40357 = locally_connected2D_layer(Res44136, 1, 2,[[[0.1779, 0.5106, 0.2012], [0.7139, 0.0767, 0.3107], [0.3778, 0.5545, 0.7142], [0.1136, 0.5428, 0.8706], [0.5802, 0.1146, 0.8474], [0.6217, 0.2001, 0.36], [0.2593, 0.9407, 0.9185], [0.7458, 0.9595, 0.2293]], [[0.8683, 0.9074, 0.2665], [0.2591, 0.7246, 0.2561], [0.3135, 0.6679, 0.506], [0.1596, 0.8228, 0.5561], [0.515, 0.4073, 0.1026], [0.1125, 0.4897, 0.653], [0.8254, 0.3284, 0.1754], [0.4881, 0.2354, 0.8952]]],[[[0, 0, 0]], [[0, 0, 0]]], 1, 1, Loc40357), 
LRes53198 = reshape_layer(Loc40357, [2, 3], Res53198), 
LDot9248 = dot_layer(Con35212,Res53198, 1, 1, Dot9248), 
LFla97232 = flatten_layer(Dot9248, Fla97232), 
LSub45079 = subtract_layer([[0.7245, 0.1113]], [[0.1694, 0.3594]], Sub45079), 
LRes72026 = reshape_layer(Sub45079, [2, 1], Res72026), 
LGlo60859 = global_max_pool1D_layer(Res72026, Glo60859), 
LCon52102 = concatenate_layer([Glo60859,[[0.1761, 0.6257, 0.0799, 0.5673, 0.8349, 0.9373, 0.0323, 0.1973]]], 1, Con52102), 
LSub52562 = subtract_layer(Fla97232,Con52102, Sub52562), 
exec_layers([LMul95501,LCon35212,LAdd40137,LRes44136,LLoc40357,LRes53198,LDot9248,LFla97232,LSub45079,LRes72026,LGlo60859,LCon52102,LSub52562],["Mul95501","Con35212","Add40137","Res44136","Loc40357","Res53198","Dot9248","Fla97232","Sub45079","Res72026","Glo60859","Con52102","Sub52562"],Sub52562,"Sub52562")

Actual (Unparsed): [[0.9745637, 1.3267855, 1.0996051, 2.8052878, 2.5558243, 1.4992571, 2.6053166, 3.8052218, 2.6599493]]

Expected (Unparsed): [[0.9745636624271011,1.3267854478237566,1.0996050406146143,2.8052878401808994,2.555824348863204,1.499257214245657,2.605316791731,3.8052220347599994,2.6599494298180004]]

Actual:   [[0.9746, 1.3268, 1.0997, 2.8053, 2.5559, 1.4993, 2.6054, 3.8053, 2.66]]

Expected: [[0.9746, 1.3268, 1.0997, 2.8053, 2.5559, 1.4993, 2.6054, 3.8053, 2.66]]