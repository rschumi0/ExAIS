import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max42278 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Max42278 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Lea30795 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Max70528 = tf.keras.layers.Input(shape=([2, 1]))

Max42278 = keras.layers.Maximum(name = 'Max42278', )([in0Max42278,in1Max42278])
Res88623 = keras.layers.Reshape((2, 4), name = 'Res88623', )(Max42278)
LST80159 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST80159', )(Res88623)
Res79280 = keras.layers.Reshape((1, 1), name = 'Res79280', )(LST80159)
Zer9974 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer9974', )(Res79280)
Lea30795 = keras.layers.LeakyReLU(alpha=1.0118544746552751, name = 'Lea30795', input_shape=(1, 1, 1))(in0Lea30795)
Res23030 = keras.layers.Reshape((1, 1), name = 'Res23030', )(Lea30795)
Zer22319 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer22319', )(Res23030)
Max70528 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max70528', )(in0Max70528)
Ave52951 = keras.layers.Average(name = 'Ave52951', )([Zer22319,Max70528])
Ave12063 = keras.layers.Average(name = 'Ave12063', )([Zer9974,Ave52951])
model = tf.keras.models.Model(inputs=[in0Max42278,in1Max42278,in0Lea30795,in0Max70528], outputs=Ave12063)
w = model.get_layer('LST80159').get_weights() 
w[0] = np.array([[10, 8, 1, 6], [2, 9, 7, 8], [7, 1, 2, 10], [6, 10, 4, 1]])
w[1] = np.array([[6, 9, 5, 6]])
w[2] = np.array([2, 2, 7, 3])
model.get_layer('LST80159').set_weights(w) 
in0Max42278 = tf.constant([[[[0.5632, 0.2521], [0.0866, 0.3854]], [[0.6743, 0.4523], [0.85, 0.2505]]]])
in1Max42278 = tf.constant([[[[0.3851, 0.3243], [0.3972, 0.3216]], [[0.0359, 0.5773], [0.5982, 0.9353]]]])
in0Lea30795 = tf.constant([[[[0.0126]]]])
in0Max70528 = tf.constant([[[1.5257], [1.3135]]])
print (np.array2string(model.predict([in0Max42278,in1Max42278,in0Lea30795,in0Max70528],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave12063.png')

LMax42278 = maximum_layer([[[[[0.5632, 0.2521], [0.0866, 0.3854]], [[0.6743, 0.4523], [0.85, 0.2505]]]], [[[[0.3851, 0.3243], [0.3972, 0.3216]], [[0.0359, 0.5773], [0.5982, 0.9353]]]]], Max42278), 
LRes88623 = reshape_layer(Max42278, [2, 4], Res88623), 
LLST80159 = lstm_layer(Res88623,[[10, 8, 1, 6], [2, 9, 7, 8], [7, 1, 2, 10], [6, 10, 4, 1]],[[6, 9, 5, 6]],[2, 2, 7, 3], LST80159), 
LRes79280 = reshape_layer(LST80159, [1, 1], Res79280), 
LZer9974 = zero_padding1D_layer(Res79280, 1, 0, Zer9974), 
LLea30795 = leaky_relu_layer([[[[0.0126]]]], 1.0118544746552751, Lea30795), 
LRes23030 = reshape_layer(Lea30795, [1, 1], Res23030), 
LZer22319 = zero_padding1D_layer(Res23030, 1, 0, Zer22319), 
LMax70528 = max_pool1D_layer([[[1.5257], [1.3135]]], 1, Max70528), 
LAve52951 = average_layer([Zer22319,Max70528], Ave52951), 
LAve12063 = average_layer([Zer9974,Ave52951], Ave12063), 
exec_layers([LMax42278,LRes88623,LLST80159,LRes79280,LZer9974,LLea30795,LRes23030,LZer22319,LMax70528,LAve52951,LAve12063],["Max42278","Res88623","LST80159","Res79280","Zer9974","Lea30795","Res23030","Zer22319","Max70528","Ave52951","Ave12063"],Ave12063,"Ave12063")

Actual (Unparsed): [[[0.3814250], [0.8135387]]]

Expected (Unparsed): [[[0.381425],[0.8135387350664924]]]

Actual:   [[[0.3815], [0.8136]]]

Expected: [[[0.3815], [0.8136]]]