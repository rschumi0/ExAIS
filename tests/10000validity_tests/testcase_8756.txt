import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max20030 = tf.keras.layers.Input(shape=([2, 2]))
in1Max20030 = tf.keras.layers.Input(shape=([2, 2]))
in0Sim76493 = tf.keras.layers.Input(shape=([3, 2]))
in0Con95785 = tf.keras.layers.Input(shape=([2, 1]))
in0Mul93659 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul93659 = tf.keras.layers.Input(shape=([1, 1]))
in0Mul82122 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Mul82122 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))

Max20030 = keras.layers.Maximum(name = 'Max20030', )([in0Max20030,in1Max20030])
Bat93407 = keras.layers.BatchNormalization(axis=1, epsilon=0.5300446097581806,  name = 'Bat93407', )(Max20030)
Sim76493 = keras.layers.SimpleRNN(1,name = 'Sim76493', )(in0Sim76493)
Res31833 = keras.layers.Reshape((1, 1), name = 'Res31833', )(Sim76493)
Ave95948 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='valid', name = 'Ave95948', )(Res31833)
Zer58408 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer58408', )(Ave95948)
Con95785 = keras.layers.Concatenate(axis=2, name = 'Con95785', )([Zer58408,in0Con95785])
Sub78525 = keras.layers.Subtract(name = 'Sub78525', )([Bat93407,Con95785])
Res33355 = keras.layers.Reshape((2, 2, 1), name = 'Res33355', )(Sub78525)
Res70983 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res70983', )(Res33355)
Zer86175 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer86175', )(Res70983)
Mul93659 = keras.layers.Multiply(name = 'Mul93659', )([in0Mul93659,in1Mul93659])
Res3472 = keras.layers.Reshape((1, 1, 1), name = 'Res3472', )(Mul93659)
Res9753 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res9753', )(Res3472)
Zer81307 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (1, 0)), name = 'Zer81307', )(Res9753)
Mul82122 = keras.layers.Multiply(name = 'Mul82122', )([in0Mul82122,in1Mul82122])
Add69346 = keras.layers.Add(name = 'Add69346', )([Zer81307,Mul82122])
Zer92686 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (1, 0)), name = 'Zer92686', )(Add69346)
Max2145 = keras.layers.Maximum(name = 'Max2145', )([Zer86175,Zer92686])
model = tf.keras.models.Model(inputs=[in0Max20030,in1Max20030,in0Sim76493,in0Con95785,in0Mul93659,in1Mul93659,in0Mul82122,in1Mul82122], outputs=Max2145)
w = model.get_layer('Bat93407').get_weights() 
w[0] = np.array([0.1399, 0.4997])
w[1] = np.array([0.1063, 0.8321])
w[2] = np.array([0.0051, 0.0859])
w[3] = np.array([0.7883, 0.3159])
model.get_layer('Bat93407').set_weights(w) 
w = model.get_layer('Sim76493').get_weights() 
w[0] = np.array([[8], [4]])
w[1] = np.array([[6]])
w[2] = np.array([3])
model.get_layer('Sim76493').set_weights(w) 
in0Max20030 = tf.constant([[[0.3842, 0.3283], [0.132, 0.3841]]])
in1Max20030 = tf.constant([[[0.4124, 0.7466], [0.1037, 0.569]]])
in0Sim76493 = tf.constant([[[3, 2], [1, 6], [9, 5]]])
in0Con95785 = tf.constant([[[0.1411], [0.173]]])
in0Mul93659 = tf.constant([[[0.6264]]])
in1Mul93659 = tf.constant([[[0.4279]]])
in0Mul82122 = tf.constant([[[[[0.3557], [0.4676]]]]])
in1Mul82122 = tf.constant([[[[[0.8011], [0.4372]]]]])
print (np.array2string(model.predict([in0Max20030,in1Max20030,in0Sim76493,in0Con95785,in0Mul93659,in1Mul93659,in0Mul82122,in1Mul82122],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max2145.png')

LMax20030 = maximum_layer([[[[0.3842, 0.3283], [0.132, 0.3841]]], [[[0.4124, 0.7466], [0.1037, 0.569]]]], Max20030), 
LBat93407 = batch_normalization_layer(Max20030, 1, 0.5300446097581806, [0.1399, 0.4997], [0.1063, 0.8321], [0.0051, 0.0859], [0.7883, 0.3159], Bat93407), 
LSim76493 = simple_rnn_layer([[[3, 2], [1, 6], [9, 5]]],[[8], [4]],[[6]],[3], Sim76493), 
LRes31833 = reshape_layer(Sim76493, [1, 1], Res31833), 
LAve95948 = average_pooling1D_layer(Res31833, 1, 1, false, Ave95948), 
LZer58408 = zero_padding1D_layer(Ave95948, 1, 0, Zer58408), 
LCon95785 = concatenate_layer([Zer58408,[[[0.1411], [0.173]]]], 2, Con95785), 
LSub78525 = subtract_layer(Bat93407,Con95785, Sub78525), 
LRes33355 = reshape_layer(Sub78525, [2, 2, 1], Res33355), 
LRes70983 = reshape_layer(Res33355, [2, 2, 1, 1], Res70983), 
LZer86175 = zero_padding3D_layer(Res70983, 0, 0, 0, 0, 2, 0, Zer86175), 
LMul93659 = multiply_layer([[[[0.6264]]], [[[0.4279]]]], Mul93659), 
LRes3472 = reshape_layer(Mul93659, [1, 1, 1], Res3472), 
LRes9753 = reshape_layer(Res3472, [1, 1, 1, 1], Res9753), 
LZer81307 = zero_padding3D_layer(Res9753, 0, 0, 0, 0, 1, 0, Zer81307), 
LMul82122 = multiply_layer([[[[[[0.3557], [0.4676]]]]], [[[[[0.8011], [0.4372]]]]]], Mul82122), 
LAdd69346 = add_layer([Zer81307,Mul82122], Add69346), 
LZer92686 = zero_padding3D_layer(Add69346, 1, 0, 1, 0, 1, 0, Zer92686), 
LMax2145 = maximum_layer([Zer86175,Zer92686], Max2145), 
exec_layers([LMax20030,LBat93407,LSim76493,LRes31833,LAve95948,LZer58408,LCon95785,LSub78525,LRes33355,LRes70983,LZer86175,LMul93659,LRes3472,LRes9753,LZer81307,LMul82122,LAdd69346,LZer92686,LMax2145],["Max20030","Bat93407","Sim76493","Res31833","Ave95948","Zer58408","Con95785","Sub78525","Res33355","Res70983","Zer86175","Mul93659","Res3472","Res9753","Zer81307","Mul82122","Add69346","Zer92686","Max2145"],Max2145,"Max2145")

Actual (Unparsed): [[[[[0.0000000], [0.0000000], [0.1559270]], [[0.0000000], [0.0000000], [0.0555471]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.2849513], [0.9215674]]]]]

Expected (Unparsed): [[[[[0],[0],[0.15592695751190908]],[[0],[0],[0.055547137233195626]]],[[[0],[0],[0]],[[0],[0.28495127000000003],[0.9215674326494754]]]]]

Actual:   [[[[[0], [0], [0.156]], [[0], [0], [0.0556]]], [[[0], [0], [0]], [[0], [0.285], [0.9216]]]]]

Expected: [[[[[0], [0], [0.156]], [[0], [0], [0.0556]]], [[[0], [0], [0]], [[0], [0.285], [0.9216]]]]]