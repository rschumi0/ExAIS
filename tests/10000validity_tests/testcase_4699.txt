import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul22122 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Mul22122 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con4108 = tf.keras.layers.Input(shape=([1, 2, 3]))
in0Ave65676 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave65676 = tf.keras.layers.Input(shape=([1, 2]))

Mul22122 = keras.layers.Multiply(name = 'Mul22122', )([in0Mul22122,in1Mul22122])
Res51387 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res51387', )(Mul22122)
Glo76834 = keras.layers.GlobalAveragePooling3D(name = 'Glo76834', )(Res51387)
Res157 = keras.layers.Reshape((1, 1), name = 'Res157', )(Glo76834)
Res53445 = keras.layers.Reshape((1, 1, 1), name = 'Res53445', )(Res157)
Zer29987 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer29987', )(Res53445)
Con4108 = keras.layers.Concatenate(axis=3, name = 'Con4108', )([Zer29987,in0Con4108])
Ave65676 = keras.layers.Average(name = 'Ave65676', )([in0Ave65676,in1Ave65676])
Res12714 = keras.layers.Reshape((1, 2, 1), name = 'Res12714', )(Ave65676)
Con51995 = keras.layers.Conv2DTranspose(4, (1, 1),strides=(1, 1), padding='valid', name = 'Con51995', )(Res12714)
Add74161 = keras.layers.Add(name = 'Add74161', )([Con4108,Con51995])
Res50103 = keras.layers.Reshape((1, 8), name = 'Res50103', )(Add74161)
Glo93050 = keras.layers.GlobalMaxPool1D(name = 'Glo93050', )(Res50103)
model = tf.keras.models.Model(inputs=[in0Mul22122,in1Mul22122,in0Con4108,in0Ave65676,in1Ave65676], outputs=Glo93050)
w = model.get_layer('Con51995').get_weights() 
w[0] = np.array([[[[0.9131], [0.1398], [0.2292], [0.708]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con51995').set_weights(w) 
in0Mul22122 = tf.constant([[[[0.4524]], [[0.6333]]]])
in1Mul22122 = tf.constant([[[[0.1337]], [[0.8485]]]])
in0Con4108 = tf.constant([[[[0.269, 0.0781, 0.7561], [0.9387, 0.916, 0.1567]]]])
in0Ave65676 = tf.constant([[[0.447, 0.2895]]])
in1Ave65676 = tf.constant([[[0.3919, 0.1465]]])
print (np.array2string(model.predict([in0Mul22122,in1Mul22122,in0Con4108,in0Ave65676,in1Ave65676],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo93050.png')

LMul22122 = multiply_layer([[[[[0.4524]], [[0.6333]]]], [[[[0.1337]], [[0.8485]]]]], Mul22122), 
LRes51387 = reshape_layer(Mul22122, [2, 1, 1, 1], Res51387), 
LGlo76834 = global_average_pooling3D_layer(Res51387, Glo76834), 
LRes157 = reshape_layer(Glo76834, [1, 1], Res157), 
LRes53445 = reshape_layer(Res157, [1, 1, 1], Res53445), 
LZer29987 = zero_padding2D_layer(Res53445, 0, 0, 1, 0, Zer29987), 
LCon4108 = concatenate_layer([Zer29987,[[[[0.269, 0.0781, 0.7561], [0.9387, 0.916, 0.1567]]]]], 3, Con4108), 
LAve65676 = average_layer([[[[0.447, 0.2895]]], [[[0.3919, 0.1465]]]], Ave65676), 
LRes12714 = reshape_layer(Ave65676, [1, 2, 1], Res12714), 
LCon51995 = conv2D_transpose_layer(Res12714, 1, 1,[[[[0.9131], [0.1398], [0.2292], [0.708]]]],[0, 0, 0, 0], 1, 1, false, Con51995), 
LAdd74161 = add_layer([Con4108,Con51995], Add74161), 
LRes50103 = reshape_layer(Add74161, [1, 8], Res50103), 
LGlo93050 = global_max_pool1D_layer(Res50103, Glo93050), 
exec_layers([LMul22122,LRes51387,LGlo76834,LRes157,LRes53445,LZer29987,LCon4108,LAve65676,LRes12714,LCon51995,LAdd74161,LRes50103,LGlo93050],["Mul22122","Res51387","Glo76834","Res157","Res53445","Zer29987","Con4108","Ave65676","Res12714","Con51995","Add74161","Res50103","Glo93050"],Glo93050,"Glo93050")

Actual (Unparsed): [[0.3829998, 0.3276391, 0.1742379, 1.0530706, 0.4979763, 0.9691764, 0.9659656, 0.3110440]]

Expected (Unparsed): [[0.382999795,0.32763911,0.17423793999999998,1.0530705999999999,0.4979762649999999,0.9691763999999999,0.9659656,0.311044]]

Actual:   [[0.383, 0.3277, 0.1743, 1.0531, 0.498, 0.9692, 0.966, 0.3111]]

Expected: [[0.383, 0.3277, 0.1743, 1.0531, 0.498, 0.9692, 0.966, 0.3111]]