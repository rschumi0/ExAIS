import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave95572 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave95572 = tf.keras.layers.Input(shape=([2, 2, 1]))

Ave95572 = keras.layers.Average(name = 'Ave95572', )([in0Ave95572,in1Ave95572])
Res28357 = keras.layers.Reshape((2, 2), name = 'Res28357', )(Ave95572)
Zer91624 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer91624', )(Res28357)
Res20383 = keras.layers.Reshape((4, 2, 1), name = 'Res20383', )(Zer91624)
Res92465 = keras.layers.Reshape((4, 2, 1, 1), name = 'Res92465', )(Res20383)
Up_56405 = keras.layers.UpSampling3D(size=(2, 1, 2), name = 'Up_56405', )(Res92465)
Res14686 = keras.layers.Reshape((8, 2, 2), name = 'Res14686', )(Up_56405)
Res53111 = keras.layers.Reshape((8, 4), name = 'Res53111', )(Res14686)
Per618 = keras.layers.Permute((1,2), name = 'Per618',)(Res53111)
model = tf.keras.models.Model(inputs=[in0Ave95572,in1Ave95572], outputs=Per618)
in0Ave95572 = tf.constant([[[[0.2628], [0.8775]], [[0.5114], [0.8045]]]])
in1Ave95572 = tf.constant([[[[0.6656], [0.269]], [[0.5764], [0.381]]]])
print (np.array2string(model.predict([in0Ave95572,in1Ave95572],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Per618.png')

LAve95572 = average_layer([[[[[0.2628], [0.8775]], [[0.5114], [0.8045]]]], [[[[0.6656], [0.269]], [[0.5764], [0.381]]]]], Ave95572), 
LRes28357 = reshape_layer(Ave95572, [2, 2], Res28357), 
LZer91624 = zero_padding1D_layer(Res28357, 1, 1, Zer91624), 
LRes20383 = reshape_layer(Zer91624, [4, 2, 1], Res20383), 
LRes92465 = reshape_layer(Res20383, [4, 2, 1, 1], Res92465), 
LUp_56405 = up_sampling3D_layer(Res92465, 2, 1, 2, Up_56405), 
LRes14686 = reshape_layer(Up_56405, [8, 2, 2], Res14686), 
LRes53111 = reshape_layer(Res14686, [8, 4], Res53111), 
LPer618 = permute_layer(Res53111, 1,2, Per618), 
exec_layers([LAve95572,LRes28357,LZer91624,LRes20383,LRes92465,LUp_56405,LRes14686,LRes53111,LPer618],["Ave95572","Res28357","Zer91624","Res20383","Res92465","Up_56405","Res14686","Res53111","Per618"],Per618,"Per618")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.4642000, 0.4642000, 0.5732500, 0.5732500], [0.4642000, 0.4642000, 0.5732500, 0.5732500], [0.5439000, 0.5439000, 0.5927500, 0.5927500], [0.5439000, 0.5439000, 0.5927500, 0.5927500], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]]]

Expected (Unparsed): [[[0,0,0,0],[0,0,0,0],[0.46419999999999995,0.46419999999999995,0.57325,0.57325],[0.46419999999999995,0.46419999999999995,0.57325,0.57325],[0.5439,0.5439,0.59275,0.59275],[0.5439,0.5439,0.59275,0.59275],[0,0,0,0],[0,0,0,0]]]

Actual:   [[[0, 0, 0, 0], [0, 0, 0, 0], [0.4642, 0.4642, 0.5733, 0.5733], [0.4642, 0.4642, 0.5733, 0.5733], [0.5439, 0.5439, 0.5928, 0.5928], [0.5439, 0.5439, 0.5928, 0.5928], [0, 0, 0, 0], [0, 0, 0, 0]]]

Expected: [[[0, 0, 0, 0], [0, 0, 0, 0], [0.4642, 0.4642, 0.5733, 0.5733], [0.4642, 0.4642, 0.5733, 0.5733], [0.5439, 0.5439, 0.5928, 0.5928], [0.5439, 0.5439, 0.5928, 0.5928], [0, 0, 0, 0], [0, 0, 0, 0]]]