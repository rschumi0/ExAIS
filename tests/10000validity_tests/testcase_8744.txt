import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add78546 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Add78546 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Ave69452 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Ave69452 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in0Sof32790 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con76740 = tf.keras.layers.Input(shape=([3]))

Add78546 = keras.layers.Add(name = 'Add78546', )([in0Add78546,in1Add78546])
Ave69452 = keras.layers.Average(name = 'Ave69452', )([in0Ave69452,in1Ave69452])
Zer80701 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (1, 0)), name = 'Zer80701', )(Ave69452)
Max75012 = keras.layers.Maximum(name = 'Max75012', )([Add78546,Zer80701])
Res66600 = keras.layers.Reshape((1, 2, 2), name = 'Res66600', )(Max75012)
Res41763 = keras.layers.Reshape((1, 4), name = 'Res41763', )(Res66600)
Fla76856 = keras.layers.Flatten(name = 'Fla76856', )(Res41763)
Sof32790 = keras.layers.Softmax(axis=1, name = 'Sof32790', input_shape=(2, 2, 1))(in0Sof32790)
Res84066 = keras.layers.Reshape((2, 2), name = 'Res84066', )(Sof32790)
Sim40077 = keras.layers.SimpleRNN(1,name = 'Sim40077', )(Res84066)
Con76740 = keras.layers.Concatenate(axis=1, name = 'Con76740', )([Sim40077,in0Con76740])
Add1749 = keras.layers.Add(name = 'Add1749', )([Fla76856,Con76740])
Res63359 = keras.layers.Reshape((4, 1), name = 'Res63359', )(Add1749)
Res78344 = keras.layers.Reshape((4, 1, 1), name = 'Res78344', )(Res63359)
Res6572 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res6572', )(Res78344)
Glo97442 = keras.layers.GlobalAveragePooling3D(name = 'Glo97442', )(Res6572)
model = tf.keras.models.Model(inputs=[in0Add78546,in1Add78546,in0Ave69452,in1Ave69452,in0Sof32790,in0Con76740], outputs=Glo97442)
w = model.get_layer('Sim40077').get_weights() 
w[0] = np.array([[1], [7]])
w[1] = np.array([[3]])
w[2] = np.array([9])
model.get_layer('Sim40077').set_weights(w) 
in0Add78546 = tf.constant([[[[[0.3529], [0.7956]], [[0.0348], [0.4111]]]]])
in1Add78546 = tf.constant([[[[[0.1706], [0.3495]], [[0.4721], [0.8792]]]]])
in0Ave69452 = tf.constant([[[[[0.3989]]]]])
in1Ave69452 = tf.constant([[[[[0.5373]]]]])
in0Sof32790 = tf.constant([[[[0.9422], [0.4911]], [[0.013], [0.4689]]]])
in0Con76740 = tf.constant([[0.648, 0.3993, 0.1977]])
print (np.array2string(model.predict([in0Add78546,in1Add78546,in0Ave69452,in1Ave69452,in0Sof32790,in0Con76740],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo97442.png')

LAdd78546 = add_layer([[[[[[0.3529], [0.7956]], [[0.0348], [0.4111]]]]], [[[[[0.1706], [0.3495]], [[0.4721], [0.8792]]]]]], Add78546), 
LAve69452 = average_layer([[[[[[0.3989]]]]], [[[[[0.5373]]]]]], Ave69452), 
LZer80701 = zero_padding3D_layer(Ave69452, 0, 0, 1, 0, 1, 0, Zer80701), 
LMax75012 = maximum_layer([Add78546,Zer80701], Max75012), 
LRes66600 = reshape_layer(Max75012, [1, 2, 2], Res66600), 
LRes41763 = reshape_layer(Res66600, [1, 4], Res41763), 
LFla76856 = flatten_layer(Res41763, Fla76856), 
LSof32790 = softmax_layer([[[[0.9422], [0.4911]], [[0.013], [0.4689]]]], 1, Sof32790), 
LRes84066 = reshape_layer(Sof32790, [2, 2], Res84066), 
LSim40077 = simple_rnn_layer(Res84066,[[1], [7]],[[3]],[9], Sim40077), 
LCon76740 = concatenate_layer([Sim40077,[[0.648, 0.3993, 0.1977]]], 1, Con76740), 
LAdd1749 = add_layer([Fla76856,Con76740], Add1749), 
LRes63359 = reshape_layer(Add1749, [4, 1], Res63359), 
LRes78344 = reshape_layer(Res63359, [4, 1, 1], Res78344), 
LRes6572 = reshape_layer(Res78344, [4, 1, 1, 1], Res6572), 
LGlo97442 = global_average_pooling3D_layer(Res6572, Glo97442), 
exec_layers([LAdd78546,LAve69452,LZer80701,LMax75012,LRes66600,LRes41763,LFla76856,LSof32790,LRes84066,LSim40077,LCon76740,LAdd1749,LRes63359,LRes78344,LRes6572,LGlo97442],["Add78546","Ave69452","Zer80701","Max75012","Res66600","Res41763","Fla76856","Sof32790","Res84066","Sim40077","Con76740","Add1749","Res63359","Res78344","Res6572","Glo97442"],Glo97442,"Glo97442")

Actual (Unparsed): [[1.4277000]]

Expected (Unparsed): [[1.4276999999999895]]

Actual:   [[1.4277]]

Expected: [[1.4277]]