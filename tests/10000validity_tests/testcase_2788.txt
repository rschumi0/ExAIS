import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con11623 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Dot39601 = tf.keras.layers.Input(shape=([2]))
in1Dot39601 = tf.keras.layers.Input(shape=([2]))

Con11623 = keras.layers.Conv3D(4, (2, 1, 2),strides=(2, 1, 11), padding='valid', dilation_rate=(1, 1, 1), name = 'Con11623', )(in0Con11623)
ELU53369 = keras.layers.ELU(alpha=3.9214391631588867, name = 'ELU53369', )(Con11623)
Res29746 = keras.layers.Reshape((1, 2, 4), name = 'Res29746', )(ELU53369)
Res97315 = keras.layers.Reshape((1, 8), name = 'Res97315', )(Res29746)
GRU21106 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU21106', )(Res97315)
Dot39601 = keras.layers.Dot(axes=(1, 1), name = 'Dot39601', )([in0Dot39601,in1Dot39601])
Max66416 = keras.layers.Maximum(name = 'Max66416', )([GRU21106,Dot39601])
model = tf.keras.models.Model(inputs=[in0Con11623,in0Dot39601,in1Dot39601], outputs=Max66416)
w = model.get_layer('Con11623').get_weights() 
w[0] = np.array([[[[[0.2978, 0.6002, 0.9122, 0.9153], [0.4504, 0.8642, 0.771, 0.9706]], [[0.3407, 0.6165, 0.4516, 0.315], [0.6689, 0.8497, 0.7277, 0.9132]]]], [[[[0.0347, 0.1322, 0.9048, 0.7845], [0.4431, 0.2752, 0.2049, 0.2279]], [[0.2335, 0.3221, 0.9568, 0.2325], [0.5497, 0.9437, 0.4466, 0.5659]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con11623').set_weights(w) 
w = model.get_layer('GRU21106').get_weights() 
w[0] = np.array([[10, 7, 2], [5, 8, 4], [9, 8, 2], [7, 6, 2], [3, 10, 1], [4, 1, 1], [8, 4, 3], [10, 6, 3]])
w[1] = np.array([[8, 10, 1]])
w[2] = np.array([[7, 5, 4], [5, 4, 4]])
model.get_layer('GRU21106').set_weights(w) 
in0Con11623 = tf.constant([[[[[0.3297, 0.862], [0.5474, 0.6454]], [[0.1568, 0.9973], [0.2794, 0.3496]]], [[[0.5713, 0.1724], [0.5795, 0.2982]], [[0.5633, 0.0803], [0.0107, 0.554]]]]])
in0Dot39601 = tf.constant([[0.4705, 0.864]])
in1Dot39601 = tf.constant([[0.8715, 0.2232]])
print (np.array2string(model.predict([in0Con11623,in0Dot39601,in1Dot39601],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max66416.png')

LCon11623 = conv3D_layer([[[[[0.3297, 0.862], [0.5474, 0.6454]], [[0.1568, 0.9973], [0.2794, 0.3496]]], [[[0.5713, 0.1724], [0.5795, 0.2982]], [[0.5633, 0.0803], [0.0107, 0.554]]]]], 2, 1, 2,[[[[[0.2978, 0.6002, 0.9122, 0.9153], [0.4504, 0.8642, 0.771, 0.9706]], [[0.3407, 0.6165, 0.4516, 0.315], [0.6689, 0.8497, 0.7277, 0.9132]]]], [[[[0.0347, 0.1322, 0.9048, 0.7845], [0.4431, 0.2752, 0.2049, 0.2279]], [[0.2335, 0.3221, 0.9568, 0.2325], [0.5497, 0.9437, 0.4466, 0.5659]]]]],[0, 0, 0, 0], 2, 1, 11, false, 1, 1, 1, Con11623), 
LELU53369 = elu_layer(Con11623, 3.9214391631588867, ELU53369), 
LRes29746 = reshape_layer(ELU53369, [1, 2, 4], Res29746), 
LRes97315 = reshape_layer(Res29746, [1, 8], Res97315), 
LGRU21106 = gru_layer(Res97315,[[10, 7, 2], [5, 8, 4], [9, 8, 2], [7, 6, 2], [3, 10, 1], [4, 1, 1], [8, 4, 3], [10, 6, 3]],[[8, 10, 1]],[[7, 5, 4], [5, 4, 4]], true, GRU21106), 
LDot39601 = dot_layer([[0.4705, 0.864]], [[0.8715, 0.2232]], 1, 1, Dot39601), 
LMax66416 = maximum_layer([GRU21106,Dot39601], Max66416), 
exec_layers([LCon11623,LELU53369,LRes29746,LRes97315,LGRU21106,LDot39601,LMax66416],["Con11623","ELU53369","Res29746","Res97315","GRU21106","Dot39601","Max66416"],Max66416,"Max66416")

Actual (Unparsed): [[0.6028855]]

Expected (Unparsed): [[0.60288555]]

Actual:   [[0.6029]]

Expected: [[0.6029]]