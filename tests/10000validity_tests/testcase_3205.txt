import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add16894 = tf.keras.layers.Input(shape=([1, 1]))
in1Add16894 = tf.keras.layers.Input(shape=([1, 1]))
in0Ave79023 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Ave79023 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))

Add16894 = keras.layers.Add(name = 'Add16894', )([in0Add16894,in1Add16894])
Res14671 = keras.layers.Reshape((1, 1, 1), name = 'Res14671', )(Add16894)
Res20005 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res20005', )(Res14671)
Ave79023 = keras.layers.Average(name = 'Ave79023', )([in0Ave79023,in1Ave79023])
ELU76503 = keras.layers.ELU(alpha=2.1232880144156425, name = 'ELU76503', )(Ave79023)
Mul4398 = keras.layers.Multiply(name = 'Mul4398', )([Res20005,ELU76503])
Res36135 = keras.layers.Reshape((1, 1, 1), name = 'Res36135', )(Mul4398)
Res80072 = keras.layers.Reshape((1, 1), name = 'Res80072', )(Res36135)
GRU50345 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU50345', )(Res80072)
model = tf.keras.models.Model(inputs=[in0Add16894,in1Add16894,in0Ave79023,in1Ave79023], outputs=GRU50345)
w = model.get_layer('GRU50345').get_weights() 
w[0] = np.array([[4, 10, 10]])
w[1] = np.array([[8, 3, 7]])
w[2] = np.array([[4, 7, 4], [1, 4, 2]])
model.get_layer('GRU50345').set_weights(w) 
in0Add16894 = tf.constant([[[0.9269]]])
in1Add16894 = tf.constant([[[0.1821]]])
in0Ave79023 = tf.constant([[[[[0.2908]]]]])
in1Ave79023 = tf.constant([[[[[0.271]]]]])
print (np.array2string(model.predict([in0Add16894,in1Add16894,in0Ave79023,in1Ave79023],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU50345.png')

LAdd16894 = add_layer([[[[0.9269]]], [[[0.1821]]]], Add16894), 
LRes14671 = reshape_layer(Add16894, [1, 1, 1], Res14671), 
LRes20005 = reshape_layer(Res14671, [1, 1, 1, 1], Res20005), 
LAve79023 = average_layer([[[[[[0.2908]]]]], [[[[[0.271]]]]]], Ave79023), 
LELU76503 = elu_layer(Ave79023, 2.1232880144156425, ELU76503), 
LMul4398 = multiply_layer([Res20005,ELU76503], Mul4398), 
LRes36135 = reshape_layer(Mul4398, [1, 1, 1], Res36135), 
LRes80072 = reshape_layer(Res36135, [1, 1], Res80072), 
LGRU50345 = gru_layer(Res80072,[[4, 10, 10]],[[8, 3, 7]],[[4, 7, 4], [1, 4, 2]], true, GRU50345), 
exec_layers([LAdd16894,LRes14671,LRes20005,LAve79023,LELU76503,LMul4398,LRes36135,LRes80072,LGRU50345],["Add16894","Res14671","Res20005","Ave79023","ELU76503","Mul4398","Res36135","Res80072","GRU50345"],GRU50345,"GRU50345")

Actual (Unparsed): [[0.0019343]]

Expected (Unparsed): [[0.0019343022735088934]]

Actual:   [[0.002]]

Expected: [[0.002]]