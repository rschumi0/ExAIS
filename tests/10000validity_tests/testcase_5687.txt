import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub37480 = tf.keras.layers.Input(shape=([2, 3, 2]))
in1Sub37480 = tf.keras.layers.Input(shape=([2, 3, 2]))
in0Dot89987 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot89987 = tf.keras.layers.Input(shape=([3, 3]))
in0Con42394 = tf.keras.layers.Input(shape=([3, 9]))

Sub37480 = keras.layers.Subtract(name = 'Sub37480', )([in0Sub37480,in1Sub37480])
Con5086 = keras.layers.Conv2DTranspose(2, (2, 1),strides=(1, 2), padding='valid', name = 'Con5086', )(Sub37480)
Res83242 = keras.layers.Reshape((3, 12), name = 'Res83242', )(Con5086)
Dot89987 = keras.layers.Dot(axes=(1, 2), name = 'Dot89987', )([in0Dot89987,in1Dot89987])
Con42394 = keras.layers.Concatenate(axis=2, name = 'Con42394', )([Dot89987,in0Con42394])
Mul39681 = keras.layers.Multiply(name = 'Mul39681', )([Res83242,Con42394])
model = tf.keras.models.Model(inputs=[in0Sub37480,in1Sub37480,in0Dot89987,in1Dot89987,in0Con42394], outputs=Mul39681)
w = model.get_layer('Con5086').get_weights() 
w[0] = np.array([[[[0.4891, 0.6317], [0.2499, 0.4736]]], [[[0.5068, 0.5526], [0.337, 0.2856]]]])
w[1] = np.array([0, 0])
model.get_layer('Con5086').set_weights(w) 
in0Sub37480 = tf.constant([[[[0.5938, 0.1589], [0.0893, 0.3125], [0.755, 0.0571]], [[0.8388, 0.6814], [0.0594, 0.1047], [0.499, 0.3573]]]])
in1Sub37480 = tf.constant([[[[0.6268, 0.4458], [0.6355, 0.0261], [0.237, 0.1956]], [[0.7548, 0.56], [0.3042, 0.1016], [0.7116, 0.5897]]]])
in0Dot89987 = tf.constant([[[0.6676, 0.6914, 0.1193], [0.1585, 0.6738, 0.6171], [0.5398, 0.4624, 0.3896]]])
in1Dot89987 = tf.constant([[[0.0646, 0.2404, 0.1016], [0.6871, 0.0327, 0.344], [0.9755, 0.371, 0.0086]]])
in0Con42394 = tf.constant([[[0.7164, 0.7556, 0.1261, 0.6564, 0.4389, 0.8782, 0.3161, 0.0816, 0.4777], [0.1153, 0.2795, 0.0628, 0.8116, 0.587, 0.0103, 0.7175, 0.8582, 0.5914], [0.6382, 0.6431, 0.0093, 0.6897, 0.299, 0.0885, 0.3814, 0.1682, 0.1479]]])
print (np.array2string(model.predict([in0Sub37480,in1Sub37480,in0Dot89987,in1Dot89987,in0Con42394],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul39681.png')

LSub37480 = subtract_layer([[[[0.5938, 0.1589], [0.0893, 0.3125], [0.755, 0.0571]], [[0.8388, 0.6814], [0.0594, 0.1047], [0.499, 0.3573]]]], [[[[0.6268, 0.4458], [0.6355, 0.0261], [0.237, 0.1956]], [[0.7548, 0.56], [0.3042, 0.1016], [0.7116, 0.5897]]]], Sub37480), 
LCon5086 = conv2D_transpose_layer(Sub37480, 2, 1,[[[[0.4891, 0.6317], [0.2499, 0.4736]]], [[[0.5068, 0.5526], [0.337, 0.2856]]]],[0, 0], 1, 2, false, Con5086), 
LRes83242 = reshape_layer(Con5086, [3, 12], Res83242), 
LDot89987 = dot_layer([[[0.6676, 0.6914, 0.1193], [0.1585, 0.6738, 0.6171], [0.5398, 0.4624, 0.3896]]], [[[0.0646, 0.2404, 0.1016], [0.6871, 0.0327, 0.344], [0.9755, 0.371, 0.0086]]], 1, 2, Dot89987), 
LCon42394 = concatenate_layer([Dot89987,[[[0.7164, 0.7556, 0.1261, 0.6564, 0.4389, 0.8782, 0.3161, 0.0816, 0.4777], [0.1153, 0.2795, 0.0628, 0.8116, 0.587, 0.0103, 0.7175, 0.8582, 0.5914], [0.6382, 0.6431, 0.0093, 0.6897, 0.299, 0.0885, 0.3814, 0.1682, 0.1479]]]], 2, Con42394), 
LMul39681 = multiply_layer([Res83242,Con42394], Mul39681), 
exec_layers([LSub37480,LCon5086,LRes83242,LDot89987,LCon42394,LMul39681],["Sub37480","Con5086","Res83242","Dot89987","Con42394","Mul39681"],Mul39681,"Mul39681")

Actual (Unparsed): [[[-0.0268576, -0.0936194, 0.0000000, 0.0000000, -0.0651535, -0.0001080, 0.0000000, 0.0000000, 0.1456612, 0.0201844, 0.0000000, 0.0000000], [-0.0145816, -0.0095622, 0.0000000, 0.0000000, -0.0660523, -0.0101724, 0.0000000, 0.0000000, -0.0006675, -0.0202213, 0.0000000, 0.0000000], [0.0214534, 0.0148741, 0.0000000, 0.0000000, -0.0786843, -0.0007590, 0.0000000, 0.0000000, -0.0209010, -0.0526407, 0.0000000, 0.0000000]]]

Expected (Unparsed): [[[-0.0268576177272212,-0.09361942363175937,0.0,0.0,-0.06515352922399996,-0.00010798447399999788,0.0,0.0,0.14566119397000002,0.020184439060000003,0.0,0.0],[-0.014581596524048014,-0.00956221676540001,0.0,0.0,-0.066052258935,-0.010172401776,0.0,0.0,-0.0006674651319999999,-0.02022128814999999,0.0,0.0],[0.021453371641303186,0.014874112560383996,0.0,0.0,-0.07868430109800001,-0.000758993832,0.0,0.0,-0.02090103792,-0.052640690696000005,0.0,0.0]]]

Actual:   [[[-0.0268, -0.0936, 0, 0, -0.0651, -0.0001, 0, 0, 0.1457, 0.0202, 0, 0], [-0.0145, -0.0095, 0, 0, -0.066, -0.0101, 0, 0, -0.0006, -0.0202, 0, 0], [0.0215, 0.0149, 0, 0, -0.0786, -0.0007, 0, 0, -0.0209, -0.0526, 0, 0]]]

Expected: [[[-0.0268, -0.0936, 0, 0, -0.0651, -0.0001, 0, 0, 0.1457, 0.0202, 0, 0], [-0.0145, -0.0095, 0, 0, -0.066, -0.0101, 0, 0, -0.0006, -0.0202, 0, 0], [0.0215, 0.0149, 0, 0, -0.0786, -0.0007, 0, 0, -0.0209, -0.0526, 0, 0]]]