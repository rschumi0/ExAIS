import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave20491 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave20491 = tf.keras.layers.Input(shape=([2, 2]))
in0Con30260 = tf.keras.layers.Input(shape=([3, 2, 3]))
in0Mas350 = tf.keras.layers.Input(shape=([3, 2, 4]))
in0Max60022 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Max60022 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))

Ave20491 = keras.layers.Average(name = 'Ave20491', )([in0Ave20491,in1Ave20491])
Res68265 = keras.layers.Reshape((2, 2, 1), name = 'Res68265', )(Ave20491)
Zer36142 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer36142', )(Res68265)
Con30260 = keras.layers.Concatenate(axis=3, name = 'Con30260', )([Zer36142,in0Con30260])
Mas350 = keras.layers.Masking(mask_value=2, name = 'Mas350', )(in0Mas350)
Max37031 = keras.layers.Maximum(name = 'Max37031', )([Con30260,Mas350])
Res50788 = keras.layers.Reshape((3, 2, 4, 1), name = 'Res50788', )(Max37031)
Max60022 = keras.layers.Maximum(name = 'Max60022', )([in0Max60022,in1Max60022])
Zer90673 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (2, 0)), name = 'Zer90673', )(Max60022)
Add8719 = keras.layers.Add(name = 'Add8719', )([Res50788,Zer90673])
Res15446 = keras.layers.Reshape((3, 2, 4), name = 'Res15446', )(Add8719)
Res54741 = keras.layers.Reshape((3, 8), name = 'Res54741', )(Res15446)
GRU79896 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU79896', )(Res54741)
model = tf.keras.models.Model(inputs=[in0Ave20491,in1Ave20491,in0Con30260,in0Mas350,in0Max60022,in1Max60022], outputs=GRU79896)
w = model.get_layer('GRU79896').get_weights() 
w[0] = np.array([[6, 8, 2, 3, 3, 6, 5, 3, 1], [5, 3, 9, 6, 2, 2, 7, 9, 2], [10, 1, 1, 1, 9, 5, 8, 3, 10], [2, 4, 9, 5, 2, 9, 1, 4, 10], [1, 9, 4, 8, 5, 3, 1, 3, 2], [9, 6, 10, 3, 3, 4, 9, 8, 8], [3, 7, 3, 3, 2, 1, 9, 9, 6], [6, 5, 9, 3, 9, 4, 5, 4, 2]])
w[1] = np.array([[1, 1, 7, 10, 6, 9, 9, 3, 6], [6, 8, 3, 5, 1, 2, 9, 1, 7], [7, 7, 3, 4, 9, 6, 5, 9, 4]])
w[2] = np.array([[7, 1, 5, 5, 2, 8, 6, 7, 9], [2, 6, 2, 7, 7, 10, 10, 6, 8]])
model.get_layer('GRU79896').set_weights(w) 
in0Ave20491 = tf.constant([[[0.7986, 0.5808], [0.2685, 0.0712]]])
in1Ave20491 = tf.constant([[[0.779, 0.5267], [0.9552, 0.8708]]])
in0Con30260 = tf.constant([[[[0.9791, 0.5775, 0.6138], [0.1273, 0.0475, 0.9893]], [[0.1521, 0.1768, 0.346], [0.8048, 0.4262, 0.699]], [[0.0555, 0.7163, 0.8179], [0.1586, 0.4053, 0.5304]]]])
in0Mas350 = tf.constant([[[[1.6234, 1.386, 1.0959, 1.7177], [1.258, 1.8138, 1.645, 1.773]], [[1.5728, 1.2428, 1.3356, 1.7578], [1.205, 1.2043, 1.7667, 1.6729]], [[1.2283, 1.0728, 1.0818, 1.5425], [1.6407, 1.4318, 1.892, 1.2544]]]])
in0Max60022 = tf.constant([[[[[0.0655], [0.8268]]], [[[0.7563], [0.8953]]]]])
in1Max60022 = tf.constant([[[[[0.1392], [0.0107]]], [[[0.2322], [0.5933]]]]])
print (np.array2string(model.predict([in0Ave20491,in1Ave20491,in0Con30260,in0Mas350,in0Max60022,in1Max60022],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU79896.png')

LAve20491 = average_layer([[[[0.7986, 0.5808], [0.2685, 0.0712]]], [[[0.779, 0.5267], [0.9552, 0.8708]]]], Ave20491), 
LRes68265 = reshape_layer(Ave20491, [2, 2, 1], Res68265), 
LZer36142 = zero_padding2D_layer(Res68265, 1, 0, 0, 0, Zer36142), 
LCon30260 = concatenate_layer([Zer36142,[[[[0.9791, 0.5775, 0.6138], [0.1273, 0.0475, 0.9893]], [[0.1521, 0.1768, 0.346], [0.8048, 0.4262, 0.699]], [[0.0555, 0.7163, 0.8179], [0.1586, 0.4053, 0.5304]]]]], 3, Con30260), 
LMas350 = masking_layer([[[[1.6234, 1.386, 1.0959, 1.7177], [1.258, 1.8138, 1.645, 1.773]], [[1.5728, 1.2428, 1.3356, 1.7578], [1.205, 1.2043, 1.7667, 1.6729]], [[1.2283, 1.0728, 1.0818, 1.5425], [1.6407, 1.4318, 1.892, 1.2544]]]], 2, Mas350), 
LMax37031 = maximum_layer([Con30260,Mas350], Max37031), 
LRes50788 = reshape_layer(Max37031, [3, 2, 4, 1], Res50788), 
LMax60022 = maximum_layer([[[[[[0.0655], [0.8268]]], [[[0.7563], [0.8953]]]]], [[[[[0.1392], [0.0107]]], [[[0.2322], [0.5933]]]]]], Max60022), 
LZer90673 = zero_padding3D_layer(Max60022, 1, 0, 1, 0, 2, 0, Zer90673), 
LAdd8719 = add_layer([Res50788,Zer90673], Add8719), 
LRes15446 = reshape_layer(Add8719, [3, 2, 4], Res15446), 
LRes54741 = reshape_layer(Res15446, [3, 8], Res54741), 
LGRU79896 = gru_layer(Res54741,[[6, 8, 2, 3, 3, 6, 5, 3, 1], [5, 3, 9, 6, 2, 2, 7, 9, 2], [10, 1, 1, 1, 9, 5, 8, 3, 10], [2, 4, 9, 5, 2, 9, 1, 4, 10], [1, 9, 4, 8, 5, 3, 1, 3, 2], [9, 6, 10, 3, 3, 4, 9, 8, 8], [3, 7, 3, 3, 2, 1, 9, 9, 6], [6, 5, 9, 3, 9, 4, 5, 4, 2]],[[1, 1, 7, 10, 6, 9, 9, 3, 6], [6, 8, 3, 5, 1, 2, 9, 1, 7], [7, 7, 3, 4, 9, 6, 5, 9, 4]],[[7, 1, 5, 5, 2, 8, 6, 7, 9], [2, 6, 2, 7, 7, 10, 10, 6, 8]], true, GRU79896), 
exec_layers([LAve20491,LRes68265,LZer36142,LCon30260,LMas350,LMax37031,LRes50788,LMax60022,LZer90673,LAdd8719,LRes15446,LRes54741,LGRU79896],["Ave20491","Res68265","Zer36142","Con30260","Mas350","Max37031","Res50788","Max60022","Zer90673","Add8719","Res15446","Res54741","GRU79896"],GRU79896,"GRU79896")

Actual (Unparsed): [[0.0000000, 0.0000000, 0.0000000]]

Expected (Unparsed): [[0.0,0.0,0.0]]

Actual:   [[0, 0, 0]]

Expected: [[0, 0, 0]]