import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot88703 = tf.keras.layers.Input(shape=([3]))
in1Dot88703 = tf.keras.layers.Input(shape=([3]))
in0Con24484 = tf.keras.layers.Input(shape=([4, 3]))
in0Up_33398 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Add48139 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Add48139 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con60335 = tf.keras.layers.Input(shape=([2, 14]))
in0Dot85046 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot85046 = tf.keras.layers.Input(shape=([3, 2]))
in0Con38844 = tf.keras.layers.Input(shape=([5]))

Dot88703 = keras.layers.Dot(axes=(1, 1), name = 'Dot88703', )([in0Dot88703,in1Dot88703])
Res27407 = keras.layers.Reshape((1, 1), name = 'Res27407', )(Dot88703)
Sim5772 = keras.layers.SimpleRNN(3,name = 'Sim5772', )(Res27407)
Res70184 = keras.layers.Reshape((3, 1), name = 'Res70184', )(Sim5772)
Zer6425 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer6425', )(Res70184)
Con24484 = keras.layers.Concatenate(axis=2, name = 'Con24484', )([Zer6425,in0Con24484])
Up_33398 = keras.layers.UpSampling3D(size=(1, 2, 1), name = 'Up_33398', )(in0Up_33398)
Res12116 = keras.layers.Reshape((2, 4, 4), name = 'Res12116', )(Up_33398)
Res10551 = keras.layers.Reshape((2, 16), name = 'Res10551', )(Res12116)
Add48139 = keras.layers.Add(name = 'Add48139', )([in0Add48139,in1Add48139])
Res29004 = keras.layers.Reshape((2, 2), name = 'Res29004', )(Add48139)
Max51502 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='same', name = 'Max51502', )(Res29004)
Con60335 = keras.layers.Concatenate(axis=2, name = 'Con60335', )([Max51502,in0Con60335])
Max76111 = keras.layers.Maximum(name = 'Max76111', )([Res10551,Con60335])
Res49058 = keras.layers.Reshape((2, 16, 1), name = 'Res49058', )(Max76111)
Con37681 = keras.layers.Conv2D(4, (1, 16),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con37681', )(Res49058)
Res92751 = keras.layers.Reshape((2, 4), name = 'Res92751', )(Con37681)
Dot36748 = keras.layers.Dot(axes=(2, 2), name = 'Dot36748', )([Con24484,Res92751])
Fla30504 = keras.layers.Flatten(name = 'Fla30504', )(Dot36748)
Dot85046 = keras.layers.Dot(axes=(2, 2), name = 'Dot85046', )([in0Dot85046,in1Dot85046])
Glo81820 = keras.layers.GlobalAveragePooling1D(name = 'Glo81820', )(Dot85046)
Con38844 = keras.layers.Concatenate(axis=1, name = 'Con38844', )([Glo81820,in0Con38844])
Max3010 = keras.layers.Maximum(name = 'Max3010', )([Fla30504,Con38844])
model = tf.keras.models.Model(inputs=[in0Dot88703,in1Dot88703,in0Con24484,in0Up_33398,in0Add48139,in1Add48139,in0Con60335,in0Dot85046,in1Dot85046,in0Con38844], outputs=Max3010)
w = model.get_layer('Sim5772').get_weights() 
w[0] = np.array([[3, 1, 7]])
w[1] = np.array([[9, 10, 8], [9, 1, 9], [1, 1, 2]])
w[2] = np.array([9, 5, 1])
model.get_layer('Sim5772').set_weights(w) 
w = model.get_layer('Con37681').get_weights() 
w[0] = np.array([[[[0.2779, 0.3878, 0.0346, 0.3066]], [[0.4055, 0.3547, 0.3016, 0.5878]], [[0.9502, 0.925, 0.8034, 0.0609]], [[0.0619, 0.4149, 0.9549, 0.8691]], [[0.0592, 0.6935, 0.5067, 0.6685]], [[0.5675, 0.6829, 0.6009, 0.4582]], [[0.9124, 0.0055, 0.4713, 0.6871]], [[0.4309, 0.586, 0.8194, 0.2996]], [[0.8594, 0.2988, 0.0318, 0.932]], [[0.9779, 0.8134, 0.569, 0.3012]], [[0.2504, 0.637, 0.0538, 0.9355]], [[0.2831, 0.9783, 0.8125, 0.7918]], [[0.5452, 0.4641, 0.8822, 0.9738]], [[0.9419, 0.928, 0.7889, 0.7207]], [[0.5144, 0.4625, 0.7183, 0.073]], [[0.7492, 0.6734, 0.0598, 0.1348]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con37681').set_weights(w) 
in0Dot88703 = tf.constant([[0.4386, 0.8262, 0.2054]])
in1Dot88703 = tf.constant([[0.942, 0.4614, 0.4215]])
in0Con24484 = tf.constant([[[0.2161, 0.7039, 0.4411], [0.4398, 0.1807, 0.2455], [0.4921, 0.456, 0.7462], [0.6773, 0.3947, 0.873]]])
in0Up_33398 = tf.constant([[[[[1.9635, 1.2968], [1.3552, 1.2125]], [[1.1699, 1.7966], [1.4575, 1.9696]]], [[[1.1733, 1.9591], [1.4422, 1.8368]], [[1.4483, 1.3978], [1.7817, 1.2653]]]]])
in0Add48139 = tf.constant([[[[0.0765, 0.5804]], [[0.0024, 0.4025]]]])
in1Add48139 = tf.constant([[[[0.6334, 0.6464]], [[0.756, 0.6733]]]])
in0Con60335 = tf.constant([[[0.4981, 0.0052, 0.0751, 0.5209, 0.9881, 0.8936, 0.0991, 0.0352, 0.1912, 0.1069, 0.879, 0.9055, 0.0543, 0.637], [0.0594, 0.5583, 0.0624, 0.4365, 0.272, 0.0216, 0.4425, 0.989, 0.5645, 0.6241, 0.152, 0.03, 0.259, 0.7948]]])
in0Dot85046 = tf.constant([[[0.3209, 0.4535], [0.3743, 0.9744], [0.9778, 0.4756]]])
in1Dot85046 = tf.constant([[[0.7602, 0.3768], [0.4206, 0.9107], [0.1758, 0.4779]]])
in0Con38844 = tf.constant([[0.2225, 0.7491, 0.7352, 0.643, 0.483]])
print (np.array2string(model.predict([in0Dot88703,in1Dot88703,in0Con24484,in0Up_33398,in0Add48139,in1Add48139,in0Con60335,in0Dot85046,in1Dot85046,in0Con38844],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max3010.png')

LDot88703 = dot_layer([[0.4386, 0.8262, 0.2054]], [[0.942, 0.4614, 0.4215]], 1, 1, Dot88703), 
LRes27407 = reshape_layer(Dot88703, [1, 1], Res27407), 
LSim5772 = simple_rnn_layer(Res27407,[[3, 1, 7]],[[9, 10, 8], [9, 1, 9], [1, 1, 2]],[9, 5, 1], Sim5772), 
LRes70184 = reshape_layer(Sim5772, [3, 1], Res70184), 
LZer6425 = zero_padding1D_layer(Res70184, 1, 0, Zer6425), 
LCon24484 = concatenate_layer([Zer6425,[[[0.2161, 0.7039, 0.4411], [0.4398, 0.1807, 0.2455], [0.4921, 0.456, 0.7462], [0.6773, 0.3947, 0.873]]]], 2, Con24484), 
LUp_33398 = up_sampling3D_layer([[[[[1.9635, 1.2968], [1.3552, 1.2125]], [[1.1699, 1.7966], [1.4575, 1.9696]]], [[[1.1733, 1.9591], [1.4422, 1.8368]], [[1.4483, 1.3978], [1.7817, 1.2653]]]]], 1, 2, 1, Up_33398), 
LRes12116 = reshape_layer(Up_33398, [2, 4, 4], Res12116), 
LRes10551 = reshape_layer(Res12116, [2, 16], Res10551), 
LAdd48139 = add_layer([[[[[0.0765, 0.5804]], [[0.0024, 0.4025]]]], [[[[0.6334, 0.6464]], [[0.756, 0.6733]]]]], Add48139), 
LRes29004 = reshape_layer(Add48139, [2, 2], Res29004), 
LMax51502 = max_pool1D_layer(Res29004, 1, 1, true, Max51502), 
LCon60335 = concatenate_layer([Max51502,[[[0.4981, 0.0052, 0.0751, 0.5209, 0.9881, 0.8936, 0.0991, 0.0352, 0.1912, 0.1069, 0.879, 0.9055, 0.0543, 0.637], [0.0594, 0.5583, 0.0624, 0.4365, 0.272, 0.0216, 0.4425, 0.989, 0.5645, 0.6241, 0.152, 0.03, 0.259, 0.7948]]]], 2, Con60335), 
LMax76111 = maximum_layer([Res10551,Con60335], Max76111), 
LRes49058 = reshape_layer(Max76111, [2, 16, 1], Res49058), 
LCon37681 = conv2D_layer(Res49058, 1, 16,[[[[0.2779, 0.3878, 0.0346, 0.3066]], [[0.4055, 0.3547, 0.3016, 0.5878]], [[0.9502, 0.925, 0.8034, 0.0609]], [[0.0619, 0.4149, 0.9549, 0.8691]], [[0.0592, 0.6935, 0.5067, 0.6685]], [[0.5675, 0.6829, 0.6009, 0.4582]], [[0.9124, 0.0055, 0.4713, 0.6871]], [[0.4309, 0.586, 0.8194, 0.2996]], [[0.8594, 0.2988, 0.0318, 0.932]], [[0.9779, 0.8134, 0.569, 0.3012]], [[0.2504, 0.637, 0.0538, 0.9355]], [[0.2831, 0.9783, 0.8125, 0.7918]], [[0.5452, 0.4641, 0.8822, 0.9738]], [[0.9419, 0.928, 0.7889, 0.7207]], [[0.5144, 0.4625, 0.7183, 0.073]], [[0.7492, 0.6734, 0.0598, 0.1348]]]],[0, 0, 0, 0], 1, 1, false, 1, 1, Con37681), 
LRes92751 = reshape_layer(Con37681, [2, 4], Res92751), 
LDot36748 = dot_layer(Con24484,Res92751, 2, 2, Dot36748), 
LFla30504 = flatten_layer(Dot36748, Fla30504), 
LDot85046 = dot_layer([[[0.3209, 0.4535], [0.3743, 0.9744], [0.9778, 0.4756]]], [[[0.7602, 0.3768], [0.4206, 0.9107], [0.1758, 0.4779]]], 2, 2, Dot85046), 
LGlo81820 = global_average_pooling1D_layer(Dot85046, Glo81820), 
LCon38844 = concatenate_layer([Glo81820,[[0.2225, 0.7491, 0.7352, 0.643, 0.483]]], 1, Con38844), 
LMax3010 = maximum_layer([Fla30504,Con38844], Max3010), 
exec_layers([LDot88703,LRes27407,LSim5772,LRes70184,LZer6425,LCon24484,LUp_33398,LRes12116,LRes10551,LAdd48139,LRes29004,LMax51502,LCon60335,LMax76111,LRes49058,LCon37681,LRes92751,LDot36748,LFla30504,LDot85046,LGlo81820,LCon38844,LMax3010],["Dot88703","Res27407","Sim5772","Res70184","Zer6425","Con24484","Up_33398","Res12116","Res10551","Add48139","Res29004","Max51502","Con60335","Max76111","Res49058","Con37681","Res92751","Dot36748","Fla30504","Dot85046","Glo81820","Con38844","Max3010"],Max3010,"Max3010")

Actual (Unparsed): [[17.7380309, 18.3218557, 25.2626446, 25.1862400, 36.0092334, 36.3541354, 39.6463424, 39.8722919]]

Expected (Unparsed): [[17.738031141446,18.32185591792,25.262644844332854,25.18624021991777,36.00923325914444,36.35413515422528,39.64634278260317,39.87229217299348]]

Actual:   [[17.7381, 18.3219, 25.2627, 25.1863, 36.0093, 36.3542, 39.6464, 39.8723]]

Expected: [[17.7381, 18.3219, 25.2627, 25.1863, 36.0093, 36.3542, 39.6464, 39.8723]]