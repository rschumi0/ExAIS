import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave25655 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Ave25655 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

Ave25655 = keras.layers.Average(name = 'Ave25655', )([in0Ave25655,in1Ave25655])
Res75307 = keras.layers.Reshape((2, 2, 2), name = 'Res75307', )(Ave25655)
Con64393 = keras.layers.Conv2DTranspose(3, (2, 1),strides=(1, 1), padding='same', name = 'Con64393', )(Res75307)
Res56826 = keras.layers.Reshape((2, 2, 3, 1), name = 'Res56826', )(Con64393)
Glo18990 = keras.layers.GlobalAveragePooling3D(name = 'Glo18990', )(Res56826)
Res83193 = keras.layers.Reshape((1, 1), name = 'Res83193', )(Glo18990)
GRU97826 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU97826', )(Res83193)
model = tf.keras.models.Model(inputs=[in0Ave25655,in1Ave25655], outputs=GRU97826)
w = model.get_layer('Con64393').get_weights() 
w[0] = np.array([[[[0.0805, 0.575], [0.488, 0.1846], [0.3085, 0.7884]]], [[[0.1995, 0.5887], [0.8961, 0.1706], [0.8314, 0.4642]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con64393').set_weights(w) 
w = model.get_layer('GRU97826').get_weights() 
w[0] = np.array([[8, 5, 4, 3, 1, 4, 2, 1, 5]])
w[1] = np.array([[1, 3, 8, 6, 5, 6, 10, 5, 7], [1, 1, 4, 2, 10, 2, 7, 6, 8], [7, 10, 1, 7, 4, 5, 6, 3, 4]])
w[2] = np.array([10, 1, 6, 2, 3, 6, 9, 2, 7])
model.get_layer('GRU97826').set_weights(w) 
in0Ave25655 = tf.constant([[[[[0.7185, 0.4119]], [[0.4699, 0.8868]]], [[[0.0471, 0.1347]], [[0.6226, 0.8599]]]]])
in1Ave25655 = tf.constant([[[[[0.5948, 0.1419]], [[0.6351, 0.759]]], [[[0.6327, 0.5535]], [[0.6434, 0.0416]]]]])
print (np.array2string(model.predict([in0Ave25655,in1Ave25655],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU97826.png')

LAve25655 = average_layer([[[[[[0.7185, 0.4119]], [[0.4699, 0.8868]]], [[[0.0471, 0.1347]], [[0.6226, 0.8599]]]]], [[[[[0.5948, 0.1419]], [[0.6351, 0.759]]], [[[0.6327, 0.5535]], [[0.6434, 0.0416]]]]]], Ave25655), 
LRes75307 = reshape_layer(Ave25655, [2, 2, 2], Res75307), 
LCon64393 = conv2D_transpose_layer(Res75307, 2, 1,[[[[0.0805, 0.575], [0.488, 0.1846], [0.3085, 0.7884]]], [[[0.1995, 0.5887], [0.8961, 0.1706], [0.8314, 0.4642]]]],[0, 0, 0], 1, 1, true, Con64393), 
LRes56826 = reshape_layer(Con64393, [2, 2, 3, 1], Res56826), 
LGlo18990 = global_average_pooling3D_layer(Res56826, Glo18990), 
LRes83193 = reshape_layer(Glo18990, [1, 1], Res83193), 
LGRU97826 = gru_layer(Res83193,[[8, 5, 4, 3, 1, 4, 2, 1, 5]],[[1, 3, 8, 6, 5, 6, 10, 5, 7], [1, 1, 4, 2, 10, 2, 7, 6, 8], [7, 10, 1, 7, 4, 5, 6, 3, 4]],[10, 1, 6, 2, 3, 6, 9, 2, 7], false, GRU97826), 
exec_layers([LAve25655,LRes75307,LCon64393,LRes56826,LGlo18990,LRes83193,LGRU97826],["Ave25655","Res75307","Con64393","Res56826","Glo18990","Res83193","GRU97826"],GRU97826,"GRU97826")

Actual (Unparsed): [[0.0000002, 0.0103551, 0.0001447]]

Expected (Unparsed): [[1.5474677645080926e-7,0.010355106930213204,0.00014469499599766467]]

Actual:   [[0, 0.0104, 0.0002]]

Expected: [[0, 0.0104, 0.0002]]