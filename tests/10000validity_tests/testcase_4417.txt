import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave93268 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Ave93268 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Dep43544 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con80363 = tf.keras.layers.Input(shape=([2, 7]))

Ave93268 = keras.layers.Average(name = 'Ave93268', )([in0Ave93268,in1Ave93268])
Res21750 = keras.layers.Reshape((2, 2, 4), name = 'Res21750', )(Ave93268)
Res15578 = keras.layers.Reshape((2, 8), name = 'Res15578', )(Res21750)
Dep43544 = keras.layers.DepthwiseConv2D((2, 1),strides=(2, 2), padding='same', name = 'Dep43544', )(in0Dep43544)
Glo24392 = keras.layers.GlobalMaxPool2D(name = 'Glo24392', )(Dep43544)
Res82083 = keras.layers.Reshape((2, 1), name = 'Res82083', )(Glo24392)
Ave64032 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='valid', name = 'Ave64032', )(Res82083)
Con80363 = keras.layers.Concatenate(axis=2, name = 'Con80363', )([Ave64032,in0Con80363])
Sub78352 = keras.layers.Subtract(name = 'Sub78352', )([Res15578,Con80363])
Con13333 = keras.layers.Conv1D(2, (2),strides=(1), padding='same', dilation_rate=(1), name = 'Con13333', )(Sub78352)
model = tf.keras.models.Model(inputs=[in0Ave93268,in1Ave93268,in0Dep43544,in0Con80363], outputs=Con13333)
w = model.get_layer('Dep43544').get_weights() 
w[0] = np.array([[[[0.148], [0.2121]]], [[[0.5993], [0.8026]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep43544').set_weights(w) 
w = model.get_layer('Con13333').get_weights() 
w[0] = np.array([[[0.1538, 0.7517], [0.882, 0.3578], [0.2803, 0.7549], [0.8788, 0.9905], [0.9358, 0.6499], [0.7022, 0.9646], [0.2315, 0.7416], [0.6894, 0.059]], [[0.274, 0.2904], [0.4615, 0.6225], [0.9628, 0.8096], [0.7026, 0.1665], [0.3352, 0.391], [0.387, 0.5851], [0.499, 0.1205], [0.4257, 0.7792]]])
w[1] = np.array([0, 0])
model.get_layer('Con13333').set_weights(w) 
in0Ave93268 = tf.constant([[[[[0.4456, 0.0264], [0.9798, 0.2877]], [[0.2904, 0.638], [0.5448, 0.9744]]], [[[0.5097, 0.288], [0.8059, 0.7837]], [[0.9899, 0.2228], [0.3621, 0.5658]]]]])
in1Ave93268 = tf.constant([[[[[0.0212, 0.683], [0.5081, 0.4428]], [[0.2042, 0.7239], [0.7123, 0.288]]], [[[0.7095, 0.254], [0.1143, 0.4848]], [[0.9743, 0.2131], [0.8012, 0.942]]]]])
in0Dep43544 = tf.constant([[[[0.432, 0.1487]], [[0.086, 0.7543]]]])
in0Con80363 = tf.constant([[[0.7949, 0.1771, 0.402, 0.4548, 0.8354, 0.2257, 0.2724], [0.5048, 0.7422, 0.4126, 0.2674, 0.5532, 0.6952, 0.8243]]])
print (np.array2string(model.predict([in0Ave93268,in1Ave93268,in0Dep43544,in0Con80363],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con13333.png')

LAve93268 = average_layer([[[[[[0.4456, 0.0264], [0.9798, 0.2877]], [[0.2904, 0.638], [0.5448, 0.9744]]], [[[0.5097, 0.288], [0.8059, 0.7837]], [[0.9899, 0.2228], [0.3621, 0.5658]]]]], [[[[[0.0212, 0.683], [0.5081, 0.4428]], [[0.2042, 0.7239], [0.7123, 0.288]]], [[[0.7095, 0.254], [0.1143, 0.4848]], [[0.9743, 0.2131], [0.8012, 0.942]]]]]], Ave93268), 
LRes21750 = reshape_layer(Ave93268, [2, 2, 4], Res21750), 
LRes15578 = reshape_layer(Res21750, [2, 8], Res15578), 
LDep43544 = depthwise_conv2D_layer([[[[0.432, 0.1487]], [[0.086, 0.7543]]]], 2, 1,[[[[0.148], [0.2121]]], [[[0.5993], [0.8026]]]],[0, 0], 2, 2, true, Dep43544), 
LGlo24392 = global_max_pool2D_layer(Dep43544, Glo24392), 
LRes82083 = reshape_layer(Glo24392, [2, 1], Res82083), 
LAve64032 = average_pooling1D_layer(Res82083, 1, 1, false, Ave64032), 
LCon80363 = concatenate_layer([Ave64032,[[[0.7949, 0.1771, 0.402, 0.4548, 0.8354, 0.2257, 0.2724], [0.5048, 0.7422, 0.4126, 0.2674, 0.5532, 0.6952, 0.8243]]]], 2, Con80363), 
LSub78352 = subtract_layer(Res15578,Con80363, Sub78352), 
LCon13333 = conv1D_layer(Sub78352, 2,[[[0.1538, 0.7517], [0.882, 0.3578], [0.2803, 0.7549], [0.8788, 0.9905], [0.9358, 0.6499], [0.7022, 0.9646], [0.2315, 0.7416], [0.6894, 0.059]], [[0.274, 0.2904], [0.4615, 0.6225], [0.9628, 0.8096], [0.7026, 0.1665], [0.3352, 0.391], [0.387, 0.5851], [0.499, 0.1205], [0.4257, 0.7792]]],[0, 0], 1, true, 1, Con13333), 
exec_layers([LAve93268,LRes21750,LRes15578,LDep43544,LGlo24392,LRes82083,LAve64032,LCon80363,LSub78352,LCon13333],["Ave93268","Res21750","Res15578","Dep43544","Glo24392","Res82083","Ave64032","Con80363","Sub78352","Con13333"],Con13333,"Con13333")

Actual (Unparsed): [[[-0.4136140, 0.0285311], [0.2638799, -0.0448794]]]

Expected (Unparsed): [[[-0.41361391134000014,0.02853115945999976],[0.2638799537899997,-0.04487932126500007]]]

Actual:   [[[-0.4136, 0.0286], [0.2639, -0.0448]]]

Expected: [[[-0.4136, 0.0286], [0.2639, -0.0448]]]