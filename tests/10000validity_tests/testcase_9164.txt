import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add49310 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Add49310 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Ave2235 = tf.keras.layers.Input(shape=([2, 2, 2]))

Add49310 = keras.layers.Add(name = 'Add49310', )([in0Add49310,in1Add49310])
Res86646 = keras.layers.Reshape((2, 2), name = 'Res86646', )(Add49310)
Ave2235 = keras.layers.AveragePooling2D(pool_size=(2, 2), name = 'Ave2235', )(in0Ave2235)
Res92363 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res92363', )(Ave2235)
Glo2829 = keras.layers.GlobalAveragePooling3D(name = 'Glo2829', )(Res92363)
Res11640 = keras.layers.Reshape((1, 1), name = 'Res11640', )(Glo2829)
Con28663 = keras.layers.Conv1D(2, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con28663', )(Res11640)
Mas97863 = keras.layers.Masking(mask_value=1, name = 'Mas97863', )(Con28663)
Res14463 = keras.layers.Reshape((1, 2, 1), name = 'Res14463', )(Mas97863)
Max38321 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max38321', )(Res14463)
Res38791 = keras.layers.Reshape((1, 2), name = 'Res38791', )(Max38321)
Dot60334 = keras.layers.Dot(axes=(2, 2), name = 'Dot60334', )([Res86646,Res38791])
model = tf.keras.models.Model(inputs=[in0Add49310,in1Add49310,in0Ave2235], outputs=Dot60334)
w = model.get_layer('Con28663').get_weights() 
w[0] = np.array([[[0.0832, 0.0131]]])
w[1] = np.array([0, 0])
model.get_layer('Con28663').set_weights(w) 
in0Add49310 = tf.constant([[[[0.0581, 0.7072]], [[0.9373, 0.6498]]]])
in1Add49310 = tf.constant([[[[0.0432, 0.6438]], [[0.5883, 0.9757]]]])
in0Ave2235 = tf.constant([[[[1.5178, 1.1386], [1.244, 1.6214]], [[1.9505, 1.5944], [1.7619, 1.9937]]]])
print (np.array2string(model.predict([in0Add49310,in1Add49310,in0Ave2235],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot60334.png')

LAdd49310 = add_layer([[[[[0.0581, 0.7072]], [[0.9373, 0.6498]]]], [[[[0.0432, 0.6438]], [[0.5883, 0.9757]]]]], Add49310), 
LRes86646 = reshape_layer(Add49310, [2, 2], Res86646), 
LAve2235 = average_pooling2D_layer([[[[1.5178, 1.1386], [1.244, 1.6214]], [[1.9505, 1.5944], [1.7619, 1.9937]]]], 2, 2, Ave2235), 
LRes92363 = reshape_layer(Ave2235, [1, 1, 2, 1], Res92363), 
LGlo2829 = global_average_pooling3D_layer(Res92363, Glo2829), 
LRes11640 = reshape_layer(Glo2829, [1, 1], Res11640), 
LCon28663 = conv1D_layer(Res11640, 1,[[[0.0832, 0.0131]]],[0, 0], 1, false, 1, Con28663), 
LMas97863 = masking_layer(Con28663, 1, Mas97863), 
LRes14463 = reshape_layer(Mas97863, [1, 2, 1], Res14463), 
LMax38321 = max_pool2D_layer(Res14463, 1, 1, Max38321), 
LRes38791 = reshape_layer(Max38321, [1, 2], Res38791), 
LDot60334 = dot_layer(Res86646,Res38791, 2, 2, Dot60334), 
exec_layers([LAdd49310,LRes86646,LAve2235,LRes92363,LGlo2829,LRes11640,LCon28663,LMas97863,LRes14463,LMax38321,LRes38791,LDot60334],["Add49310","Res86646","Ave2235","Res92363","Glo2829","Res11640","Con28663","Mas97863","Res14463","Max38321","Res38791","Dot60334"],Dot60334,"Dot60334")

Actual (Unparsed): [[[0.0418748], [0.2375715]]]

Expected (Unparsed): [[[0.041874842949749996],[0.237571526316375]]]

Actual:   [[[0.0419], [0.2376]]]

Expected: [[[0.0419], [0.2376]]]