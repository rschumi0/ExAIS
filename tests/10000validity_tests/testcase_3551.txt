import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min17157 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Min17157 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Con33856 = tf.keras.layers.Input(shape=([2, 2]))
in0Sep47927 = tf.keras.layers.Input(shape=([2, 1]))

Min17157 = keras.layers.Minimum(name = 'Min17157', )([in0Min17157,in1Min17157])
Res10057 = keras.layers.Reshape((2, 2, 1), name = 'Res10057', )(Min17157)
Res13561 = keras.layers.Reshape((2, 2), name = 'Res13561', )(Res10057)
Con33856 = keras.layers.Concatenate(axis=2, name = 'Con33856', )([Res13561,in0Con33856])
Sep47927 = keras.layers.SeparableConv1D(4, (1),strides=(1), padding='valid', name = 'Sep47927', )(in0Sep47927)
Mul49560 = keras.layers.Multiply(name = 'Mul49560', )([Con33856,Sep47927])
Ave80097 = keras.layers.AveragePooling1D(pool_size=(2), strides=(2), padding='same', name = 'Ave80097', )(Mul49560)
model = tf.keras.models.Model(inputs=[in0Min17157,in1Min17157,in0Con33856,in0Sep47927], outputs=Ave80097)
w = model.get_layer('Sep47927').get_weights() 
w[0] = np.array([[[0.7545]]])
w[1] = np.array([[[0.9792, 0.5258, 0.5655, 0.8022]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep47927').set_weights(w) 
in0Min17157 = tf.constant([[[[[0.2922]], [[0.5226]]], [[[0.3955]], [[0.3235]]]]])
in1Min17157 = tf.constant([[[[[0.7258]], [[0.3279]]], [[[0.9899]], [[0.1251]]]]])
in0Con33856 = tf.constant([[[0.4916, 0.448], [0.102, 0.9555]]])
in0Sep47927 = tf.constant([[[0.9171], [0.1842]]])
print (np.array2string(model.predict([in0Min17157,in1Min17157,in0Con33856,in0Sep47927],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave80097.png')

LMin17157 = minimum_layer([[[[[[0.2922]], [[0.5226]]], [[[0.3955]], [[0.3235]]]]], [[[[[0.7258]], [[0.3279]]], [[[0.9899]], [[0.1251]]]]]], Min17157), 
LRes10057 = reshape_layer(Min17157, [2, 2, 1], Res10057), 
LRes13561 = reshape_layer(Res10057, [2, 2], Res13561), 
LCon33856 = concatenate_layer([Res13561,[[[0.4916, 0.448], [0.102, 0.9555]]]], 2, Con33856), 
LSep47927 = separable_conv1D_layer([[[0.9171], [0.1842]]], 1,[[[[0.7545]]],[[[0.9792, 0.5258, 0.5655, 0.8022]]]],[0, 0, 0, 0], 1, false, Sep47927), 
LMul49560 = multiply_layer([Con33856,Sep47927], Mul49560), 
LAve80097 = average_pooling1D_layer(Mul49560, 2, 2, true, Ave80097), 
exec_layers([LMin17157,LRes10057,LRes13561,LCon33856,LSep47927,LMul49560,LAve80097],["Min17157","Res10057","Res13561","Con33856","Sep47927","Mul49560","Ave80097"],Ave80097,"Ave80097")

Actual (Unparsed): [[[0.1259029, 0.0642205, 0.1001895, 0.1776026]]]

Expected (Unparsed): [[[0.125902850416704,0.06422050343060551,0.10018947282025499,0.177602592713805]]]

Actual:   [[[0.126, 0.0643, 0.1002, 0.1777]]]

Expected: [[[0.126, 0.0643, 0.1002, 0.1777]]]