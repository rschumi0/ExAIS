import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo57221 = tf.keras.layers.Input(shape=([1, 2]))
in0Con70491 = tf.keras.layers.Input(shape=([4, 3]))
in0Min15775 = tf.keras.layers.Input(shape=([2, 2]))
in1Min15775 = tf.keras.layers.Input(shape=([2, 2]))
in0Glo38104 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con83133 = tf.keras.layers.Input(shape=([2]))
in0Con21850 = tf.keras.layers.Input(shape=([4, 3]))
in0PRe42168 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in0Per91929 = tf.keras.layers.Input(shape=([1, 3]))
in0Con71539 = tf.keras.layers.Input(shape=([3, 3]))

Glo57221 = keras.layers.GlobalMaxPool1D(name = 'Glo57221', )(in0Glo57221)
Res8197 = keras.layers.Reshape((2, 1), name = 'Res8197', )(Glo57221)
GRU30274 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU30274', )(Res8197)
Res76827 = keras.layers.Reshape((3, 1), name = 'Res76827', )(GRU30274)
Zer67483 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer67483', )(Res76827)
Con70491 = keras.layers.Concatenate(axis=2, name = 'Con70491', )([Zer67483,in0Con70491])
Min15775 = keras.layers.Minimum(name = 'Min15775', )([in0Min15775,in1Min15775])
Fla777 = keras.layers.Flatten(name = 'Fla777', )(Min15775)
Glo38104 = keras.layers.GlobalAveragePooling2D(name = 'Glo38104', )(in0Glo38104)
Con83133 = keras.layers.Concatenate(axis=1, name = 'Con83133', )([Glo38104,in0Con83133])
Add50303 = keras.layers.Add(name = 'Add50303', )([Fla777,Con83133])
Res63274 = keras.layers.Reshape((4, 1), name = 'Res63274', )(Add50303)
Con21850 = keras.layers.Concatenate(axis=2, name = 'Con21850', )([Res63274,in0Con21850])
PRe42168 = keras.layers.PReLU(name = 'PRe42168', input_shape=(1, 1, 2, 2))(in0PRe42168)
Res27864 = keras.layers.Reshape((1, 1, 4), name = 'Res27864', )(PRe42168)
Res27480 = keras.layers.Reshape((1, 4), name = 'Res27480', )(Res27864)
Zer18301 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer18301', )(Res27480)
Per91929 = keras.layers.Permute((2,1), name = 'Per91929',)(in0Per91929)
Con71539 = keras.layers.Concatenate(axis=2, name = 'Con71539', )([Per91929,in0Con71539])
Mul7444 = keras.layers.Multiply(name = 'Mul7444', )([Zer18301,Con71539])
Zer18716 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer18716', )(Mul7444)
Dot820 = keras.layers.Dot(axes=(1, 2), name = 'Dot820', )([Con21850,Zer18716])
Mul33137 = keras.layers.Multiply(name = 'Mul33137', )([Con70491,Dot820])
model = tf.keras.models.Model(inputs=[in0Glo57221,in0Con70491,in0Min15775,in1Min15775,in0Glo38104,in0Con83133,in0Con21850,in0PRe42168,in0Per91929,in0Con71539], outputs=Mul33137)
w = model.get_layer('GRU30274').get_weights() 
w[0] = np.array([[6, 4, 6, 7, 10, 6, 9, 9, 9]])
w[1] = np.array([[7, 2, 5, 5, 8, 4, 9, 9, 9], [3, 7, 8, 5, 10, 2, 6, 10, 8], [9, 1, 1, 3, 8, 1, 2, 7, 8]])
w[2] = np.array([[4, 4, 2, 1, 6, 10, 5, 4, 8], [5, 2, 6, 2, 6, 5, 9, 2, 1]])
model.get_layer('GRU30274').set_weights(w) 
w = model.get_layer('PRe42168').get_weights() 
w[0] = np.array([[[[0.6112, 0.2489], [0.7717, 0.5723]]]])
model.get_layer('PRe42168').set_weights(w) 
in0Glo57221 = tf.constant([[[1.9288, 1.374]]])
in0Con70491 = tf.constant([[[0.1705, 0.3475, 0.5183], [0.2454, 0.5347, 0.8962], [0.222, 0.4299, 0.4572], [0.2499, 0.3609, 0.9251]]])
in0Min15775 = tf.constant([[[0.1677, 0.4753], [0.5921, 0.5839]]])
in1Min15775 = tf.constant([[[0.16, 0.136], [0.4629, 0.985]]])
in0Glo38104 = tf.constant([[[[1.9859, 1.4887], [1.1562, 1.3539]]]])
in0Con83133 = tf.constant([[0.0867, 0.8815]])
in0Con21850 = tf.constant([[[0.3757, 0.3531, 0.0044], [0.0069, 0.8478, 0.967], [0.2419, 0.3395, 0.5725], [0.4573, 0.4141, 0.2012]]])
in0PRe42168 = tf.constant([[[[[0.8771, 0.6501], [0.5832, 0.4439]]]]])
in0Per91929 = tf.constant([[[1.1031, 1.3383, 1.8346]]])
in0Con71539 = tf.constant([[[0.6107, 0.7742, 0.1505], [0.2719, 0.6772, 0.9445], [0.953, 0.0081, 0.0513]]])
print (np.array2string(model.predict([in0Glo57221,in0Con70491,in0Min15775,in1Min15775,in0Glo38104,in0Con83133,in0Con21850,in0PRe42168,in0Per91929,in0Con71539],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul33137.png')

LGlo57221 = global_max_pool1D_layer([[[1.9288, 1.374]]], Glo57221), 
LRes8197 = reshape_layer(Glo57221, [2, 1], Res8197), 
LGRU30274 = gru_layer(Res8197,[[6, 4, 6, 7, 10, 6, 9, 9, 9]],[[7, 2, 5, 5, 8, 4, 9, 9, 9], [3, 7, 8, 5, 10, 2, 6, 10, 8], [9, 1, 1, 3, 8, 1, 2, 7, 8]],[[4, 4, 2, 1, 6, 10, 5, 4, 8], [5, 2, 6, 2, 6, 5, 9, 2, 1]], true, GRU30274), 
LRes76827 = reshape_layer(GRU30274, [3, 1], Res76827), 
LZer67483 = zero_padding1D_layer(Res76827, 1, 0, Zer67483), 
LCon70491 = concatenate_layer([Zer67483,[[[0.1705, 0.3475, 0.5183], [0.2454, 0.5347, 0.8962], [0.222, 0.4299, 0.4572], [0.2499, 0.3609, 0.9251]]]], 2, Con70491), 
LMin15775 = minimum_layer([[[[0.1677, 0.4753], [0.5921, 0.5839]]], [[[0.16, 0.136], [0.4629, 0.985]]]], Min15775), 
LFla777 = flatten_layer(Min15775, Fla777), 
LGlo38104 = global_average_pooling2D_layer([[[[1.9859, 1.4887], [1.1562, 1.3539]]]], Glo38104), 
LCon83133 = concatenate_layer([Glo38104,[[0.0867, 0.8815]]], 1, Con83133), 
LAdd50303 = add_layer([Fla777,Con83133], Add50303), 
LRes63274 = reshape_layer(Add50303, [4, 1], Res63274), 
LCon21850 = concatenate_layer([Res63274,[[[0.3757, 0.3531, 0.0044], [0.0069, 0.8478, 0.967], [0.2419, 0.3395, 0.5725], [0.4573, 0.4141, 0.2012]]]], 2, Con21850), 
LPRe42168 = prelu_layer([[[[[0.8771, 0.6501], [0.5832, 0.4439]]]]], [[[[0.6112, 0.2489], [0.7717, 0.5723]]]], PRe42168), 
LRes27864 = reshape_layer(PRe42168, [1, 1, 4], Res27864), 
LRes27480 = reshape_layer(Res27864, [1, 4], Res27480), 
LZer18301 = zero_padding1D_layer(Res27480, 2, 0, Zer18301), 
LPer91929 = permute_layer([[[1.1031, 1.3383, 1.8346]]], 2,1, Per91929), 
LCon71539 = concatenate_layer([Per91929,[[[0.6107, 0.7742, 0.1505], [0.2719, 0.6772, 0.9445], [0.953, 0.0081, 0.0513]]]], 2, Con71539), 
LMul7444 = multiply_layer([Zer18301,Con71539], Mul7444), 
LZer18716 = zero_padding1D_layer(Mul7444, 1, 0, Zer18716), 
LDot820 = dot_layer(Con21850,Zer18716, 1, 2, Dot820), 
LMul33137 = multiply_layer([Con70491,Dot820], Mul33137), 
exec_layers([LGlo57221,LRes8197,LGRU30274,LRes76827,LZer67483,LCon70491,LMin15775,LFla777,LGlo38104,LCon83133,LAdd50303,LRes63274,LCon21850,LPRe42168,LRes27864,LRes27480,LZer18301,LPer91929,LCon71539,LMul7444,LZer18716,LDot820,LMul33137],["Glo57221","Res8197","GRU30274","Res76827","Zer67483","Con70491","Min15775","Fla777","Glo38104","Con83133","Add50303","Res63274","Con21850","PRe42168","Res27864","Res27480","Zer18301","Per91929","Con71539","Mul7444","Zer18716","Dot820","Mul33137"],Mul33137,"Mul33137")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 1.9624210], [0.0000000, 0.0000000, 0.0000000, 0.5559850], [0.0000000, 0.0000000, 0.0000000, 0.5049624], [0.0000000, 0.0000000, 0.0000000, 0.5675180]]]

Expected (Unparsed): [[[0.0,0.0,0.0,1.9624210403164768],[0.0,0.0,0.0,0.5559850115303941],[0.0,0.0,0.0,0.5049623888040636],[0.0,0.0,0.0,0.5675179992915488]]]

Actual:   [[[0, 0, 0, 1.9625], [0, 0, 0, 0.556], [0, 0, 0, 0.505], [0, 0, 0, 0.5676]]]

Expected: [[[0, 0, 0, 1.9625], [0, 0, 0, 0.556], [0, 0, 0, 0.505], [0, 0, 0, 0.5676]]]