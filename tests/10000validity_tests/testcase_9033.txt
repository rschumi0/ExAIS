import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul87751 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Mul87751 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Sub39508 = tf.keras.layers.Input(shape=([2]))
in1Sub39508 = tf.keras.layers.Input(shape=([2]))
in0Con91690 = tf.keras.layers.Input(shape=([2]))
in0Con43628 = tf.keras.layers.Input(shape=([4, 3]))
in0Max4322 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Max4322 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))

Mul87751 = keras.layers.Multiply(name = 'Mul87751', )([in0Mul87751,in1Mul87751])
Res48657 = keras.layers.Reshape((2, 2, 1), name = 'Res48657', )(Mul87751)
Res73535 = keras.layers.Reshape((2, 2), name = 'Res73535', )(Res48657)
Fla83168 = keras.layers.Flatten(name = 'Fla83168', )(Res73535)
Sub39508 = keras.layers.Subtract(name = 'Sub39508', )([in0Sub39508,in1Sub39508])
Con91690 = keras.layers.Concatenate(axis=1, name = 'Con91690', )([Sub39508,in0Con91690])
Max56709 = keras.layers.Maximum(name = 'Max56709', )([Fla83168,Con91690])
Res94660 = keras.layers.Reshape((4, 1), name = 'Res94660', )(Max56709)
Con43628 = keras.layers.Concatenate(axis=2, name = 'Con43628', )([Res94660,in0Con43628])
Max4322 = keras.layers.Maximum(name = 'Max4322', )([in0Max4322,in1Max4322])
Res59954 = keras.layers.Reshape((1, 2, 2), name = 'Res59954', )(Max4322)
Cro62370 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro62370', )(Res59954)
Res61155 = keras.layers.Reshape((1, 4), name = 'Res61155', )(Cro62370)
Dot57173 = keras.layers.Dot(axes=(1, 2), name = 'Dot57173', )([Con43628,Res61155])
model = tf.keras.models.Model(inputs=[in0Mul87751,in1Mul87751,in0Sub39508,in1Sub39508,in0Con91690,in0Con43628,in0Max4322,in1Max4322], outputs=Dot57173)
in0Mul87751 = tf.constant([[[[[0.6154]], [[0.6193]]], [[[0.7834]], [[0.1443]]]]])
in1Mul87751 = tf.constant([[[[[0.8566]], [[0.229]]], [[[0.1435]], [[0.8271]]]]])
in0Sub39508 = tf.constant([[0.366, 0.2485]])
in1Sub39508 = tf.constant([[0.0732, 0.2448]])
in0Con91690 = tf.constant([[0.8212, 0.4753]])
in0Con43628 = tf.constant([[[0.5684, 0.607, 0.3878], [0.9577, 0.7814, 0.4357], [0.9837, 0.59, 0.7791], [0.5553, 0.1229, 0.4465]]])
in0Max4322 = tf.constant([[[[[0.746], [0.5208]], [[0.1498], [0.0798]]]]])
in1Max4322 = tf.constant([[[[[0.2818], [0.5742]], [[0.2933], [0.5677]]]]])
print (np.array2string(model.predict([in0Mul87751,in1Mul87751,in0Sub39508,in1Sub39508,in0Con91690,in0Con43628,in0Max4322,in1Max4322],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot57173.png')

LMul87751 = multiply_layer([[[[[[0.6154]], [[0.6193]]], [[[0.7834]], [[0.1443]]]]], [[[[[0.8566]], [[0.229]]], [[[0.1435]], [[0.8271]]]]]], Mul87751), 
LRes48657 = reshape_layer(Mul87751, [2, 2, 1], Res48657), 
LRes73535 = reshape_layer(Res48657, [2, 2], Res73535), 
LFla83168 = flatten_layer(Res73535, Fla83168), 
LSub39508 = subtract_layer([[0.366, 0.2485]], [[0.0732, 0.2448]], Sub39508), 
LCon91690 = concatenate_layer([Sub39508,[[0.8212, 0.4753]]], 1, Con91690), 
LMax56709 = maximum_layer([Fla83168,Con91690], Max56709), 
LRes94660 = reshape_layer(Max56709, [4, 1], Res94660), 
LCon43628 = concatenate_layer([Res94660,[[[0.5684, 0.607, 0.3878], [0.9577, 0.7814, 0.4357], [0.9837, 0.59, 0.7791], [0.5553, 0.1229, 0.4465]]]], 2, Con43628), 
LMax4322 = maximum_layer([[[[[[0.746], [0.5208]], [[0.1498], [0.0798]]]]], [[[[[0.2818], [0.5742]], [[0.2933], [0.5677]]]]]], Max4322), 
LRes59954 = reshape_layer(Max4322, [1, 2, 2], Res59954), 
LCro62370 = cropping2D_layer(Res59954, 0, 0, 0, 0, Cro62370), 
LRes61155 = reshape_layer(Cro62370, [1, 4], Res61155), 
LDot57173 = dot_layer(Con43628,Res61155, 1, 2, Dot57173), 
exec_layers([LMul87751,LRes48657,LRes73535,LFla83168,LSub39508,LCon91690,LMax56709,LRes94660,LCon43628,LMax4322,LRes59954,LCro62370,LRes61155,LDot57173],["Mul87751","Res48657","Res73535","Fla83168","Sub39508","Con91690","Max56709","Res94660","Con43628","Max4322","Res59954","Cro62370","Res61155","Dot57173"],Dot57173,"Dot57173")

Actual (Unparsed): [[[0.9853738], [1.5777008], [1.1443192], [1.0214658]]]

Expected (Unparsed): [[[0.98537376518],[1.5777007600000004],[1.14431921],[1.02146582]]]

Actual:   [[[0.9854], [1.5778], [1.1444], [1.0215]]]

Expected: [[[0.9854], [1.5778], [1.1444], [1.0215]]]