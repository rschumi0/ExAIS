import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Up_73247 = tf.keras.layers.Input(shape=([1, 3, 2, 2]))
in0Con20064 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con52576 = tf.keras.layers.Input(shape=([2, 11, 2]))
in0Sep2409 = tf.keras.layers.Input(shape=([2, 1, 1]))

Up_73247 = keras.layers.UpSampling3D(size=(1, 2, 1), name = 'Up_73247', )(in0Up_73247)
Res26953 = keras.layers.Reshape((1, 6, 4), name = 'Res26953', )(Up_73247)
Zer25059 = keras.layers.ZeroPadding2D(padding=((1, 0), (5, 0)), name = 'Zer25059', )(Res26953)
Con20064 = keras.layers.Conv2D(2, (2, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con20064', )(in0Con20064)
Zer2242 = keras.layers.ZeroPadding2D(padding=((0, 0), (10, 0)), name = 'Zer2242', )(Con20064)
Con52576 = keras.layers.Concatenate(axis=3, name = 'Con52576', )([Zer2242,in0Con52576])
Sub52034 = keras.layers.Subtract(name = 'Sub52034', )([Zer25059,Con52576])
Res20838 = keras.layers.Reshape((2, 44), name = 'Res20838', )(Sub52034)
Sep2409 = keras.layers.SeparableConv2D(3, (1, 1),strides=(1, 1), padding='valid', name = 'Sep2409', )(in0Sep2409)
Res67044 = keras.layers.Reshape((2, 3), name = 'Res67044', )(Sep2409)
Dot16833 = keras.layers.Dot(axes=(1, 1), name = 'Dot16833', )([Res20838,Res67044])
Res85659 = keras.layers.Reshape((44, 3, 1), name = 'Res85659', )(Dot16833)
Sep52073 = keras.layers.SeparableConv2D(4, (28, 2),strides=(21, 21), padding='same', name = 'Sep52073', )(Res85659)
model = tf.keras.models.Model(inputs=[in0Up_73247,in0Con20064,in0Con52576,in0Sep2409], outputs=Sep52073)
w = model.get_layer('Con20064').get_weights() 
w[0] = np.array([[[[0.535, 0.3083]]], [[[0.4339, 0.4714]]]])
w[1] = np.array([0, 0])
model.get_layer('Con20064').set_weights(w) 
w = model.get_layer('Sep2409').get_weights() 
w[0] = np.array([[[[0.5229]]]])
w[1] = np.array([[[[0.3067, 0.1524, 0.5779]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep2409').set_weights(w) 
w = model.get_layer('Sep52073').get_weights() 
w[0] = np.array([[[[0.2394]], [[0.5746]]], [[[0.595]], [[0.3538]]], [[[0.5975]], [[0.3169]]], [[[0.7912]], [[0.7141]]], [[[0.9768]], [[0.8058]]], [[[0.7794]], [[0.2583]]], [[[0.1963]], [[0.4608]]], [[[0.9861]], [[0.5252]]], [[[0.6137]], [[0.5198]]], [[[0.5012]], [[0.9933]]], [[[0.5242]], [[0.1425]]], [[[0.0599]], [[0.3671]]], [[[0.8169]], [[0.1805]]], [[[0.0804]], [[0.961]]], [[[0.6813]], [[0.2351]]], [[[0.7752]], [[0.6845]]], [[[0.5842]], [[0.933]]], [[[0.3614]], [[0.1488]]], [[[0.5724]], [[0.3136]]], [[[0.3025]], [[0.5811]]], [[[0.1919]], [[0.8484]]], [[[0.3369]], [[0.5583]]], [[[0.9633]], [[0.8865]]], [[[0.7666]], [[0.0553]]], [[[0.4034]], [[0.257]]], [[[0.114]], [[0.9386]]], [[[0.0406]], [[0.3513]]], [[[0.7867]], [[0.8301]]]])
w[1] = np.array([[[[0.705, 0.5746, 0.5795, 0.7394]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep52073').set_weights(w) 
in0Up_73247 = tf.constant([[[[[1.7222, 1.7065], [1.9467, 1.0613]], [[1.4977, 1.8264], [1.7138, 1.4909]], [[1.304, 1.7833], [1.4026, 1.1301]]]]])
in0Con20064 = tf.constant([[[[0.6582]], [[0.0126]]]])
in0Con52576 = tf.constant([[[[0.3353, 0.7546], [0.2514, 0.586], [0.5892, 0.204], [0.7763, 0.2071], [0.5793, 0.9056], [0.3215, 0.1099], [0.1651, 0.236], [0.2116, 0.7925], [0.321, 0.1966], [0.4452, 0.537], [0.3814, 0.0146]], [[0.0497, 0.9794], [0.196, 0.6985], [0.2102, 0.6458], [0.0774, 0.4211], [0.273, 0.5968], [0.2422, 0.3402], [0.4352, 0.5746], [0.3021, 0.4788], [0.1776, 0.0785], [0.2439, 0.5902], [0.2698, 0.6085]]]])
in0Sep2409 = tf.constant([[[[0.9409]], [[0.5782]]]])
print (np.array2string(model.predict([in0Up_73247,in0Con20064,in0Con52576,in0Sep2409],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sep52073.png')

LUp_73247 = up_sampling3D_layer([[[[[1.7222, 1.7065], [1.9467, 1.0613]], [[1.4977, 1.8264], [1.7138, 1.4909]], [[1.304, 1.7833], [1.4026, 1.1301]]]]], 1, 2, 1, Up_73247), 
LRes26953 = reshape_layer(Up_73247, [1, 6, 4], Res26953), 
LZer25059 = zero_padding2D_layer(Res26953, 1, 0, 5, 0, Zer25059), 
LCon20064 = conv2D_layer([[[[0.6582]], [[0.0126]]]], 2, 1,[[[[0.535, 0.3083]]], [[[0.4339, 0.4714]]]],[0, 0], 1, 1, true, 1, 1, Con20064), 
LZer2242 = zero_padding2D_layer(Con20064, 0, 0, 10, 0, Zer2242), 
LCon52576 = concatenate_layer([Zer2242,[[[[0.3353, 0.7546], [0.2514, 0.586], [0.5892, 0.204], [0.7763, 0.2071], [0.5793, 0.9056], [0.3215, 0.1099], [0.1651, 0.236], [0.2116, 0.7925], [0.321, 0.1966], [0.4452, 0.537], [0.3814, 0.0146]], [[0.0497, 0.9794], [0.196, 0.6985], [0.2102, 0.6458], [0.0774, 0.4211], [0.273, 0.5968], [0.2422, 0.3402], [0.4352, 0.5746], [0.3021, 0.4788], [0.1776, 0.0785], [0.2439, 0.5902], [0.2698, 0.6085]]]]], 3, Con52576), 
LSub52034 = subtract_layer(Zer25059,Con52576, Sub52034), 
LRes20838 = reshape_layer(Sub52034, [2, 44], Res20838), 
LSep2409 = separable_conv2D_layer([[[[0.9409]], [[0.5782]]]], 1, 1,[[[[[0.5229]]]],[[[[0.3067, 0.1524, 0.5779]]]]],[0, 0, 0], 1, 1, false, Sep2409), 
LRes67044 = reshape_layer(Sep2409, [2, 3], Res67044), 
LDot16833 = dot_layer(Res20838,Res67044, 1, 1, Dot16833), 
LRes85659 = reshape_layer(Dot16833, [44, 3, 1], Res85659), 
LSep52073 = separable_conv2D_layer(Res85659, 28, 2,[[[[[0.2394]], [[0.5746]]], [[[0.595]], [[0.3538]]], [[[0.5975]], [[0.3169]]], [[[0.7912]], [[0.7141]]], [[[0.9768]], [[0.8058]]], [[[0.7794]], [[0.2583]]], [[[0.1963]], [[0.4608]]], [[[0.9861]], [[0.5252]]], [[[0.6137]], [[0.5198]]], [[[0.5012]], [[0.9933]]], [[[0.5242]], [[0.1425]]], [[[0.0599]], [[0.3671]]], [[[0.8169]], [[0.1805]]], [[[0.0804]], [[0.961]]], [[[0.6813]], [[0.2351]]], [[[0.7752]], [[0.6845]]], [[[0.5842]], [[0.933]]], [[[0.3614]], [[0.1488]]], [[[0.5724]], [[0.3136]]], [[[0.3025]], [[0.5811]]], [[[0.1919]], [[0.8484]]], [[[0.3369]], [[0.5583]]], [[[0.9633]], [[0.8865]]], [[[0.7666]], [[0.0553]]], [[[0.4034]], [[0.257]]], [[[0.114]], [[0.9386]]], [[[0.0406]], [[0.3513]]], [[[0.7867]], [[0.8301]]]],[[[[0.705, 0.5746, 0.5795, 0.7394]]]]],[0, 0, 0, 0], 21, 21, true, Sep52073), 
exec_layers([LUp_73247,LRes26953,LZer25059,LCon20064,LZer2242,LCon52576,LSub52034,LRes20838,LSep2409,LRes67044,LDot16833,LRes85659,LSep52073],["Up_73247","Res26953","Zer25059","Con20064","Zer2242","Con52576","Sub52034","Res20838","Sep2409","Res67044","Dot16833","Res85659","Sep52073"],Sep52073,"Sep52073")

Actual (Unparsed): [[[[-0.4839858, -0.3944656, -0.3978295, -0.5076016]], [[0.6232026, 0.5079322, 0.5122637, 0.6536113]], [[0.8344570, 0.6801121, 0.6859119, 0.8751738]]]]

Expected (Unparsed): [[[[-0.48398578856033897,-0.39446558029329193,-0.3978294531499525,-0.507601549023425]],[[0.6232026219763214,0.50793223629446,0.5122637155110332,0.6536113740273648]],[[0.8344570733577775,0.680112105462949,0.6859118780295492,0.8751738440294196]]]]

Actual:   [[[[-0.4839, -0.3944, -0.3978, -0.5076]], [[0.6233, 0.508, 0.5123, 0.6537]], [[0.8345, 0.6802, 0.686, 0.8752]]]]

Expected: [[[[-0.4839, -0.3944, -0.3978, -0.5076]], [[0.6233, 0.508, 0.5123, 0.6537]], [[0.8345, 0.6802, 0.686, 0.8752]]]]