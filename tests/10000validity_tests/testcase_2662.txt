import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con58807 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Dot97691 = tf.keras.layers.Input(shape=([3]))
in1Dot97691 = tf.keras.layers.Input(shape=([3]))
in0Con65694 = tf.keras.layers.Input(shape=([3]))

Con58807 = keras.layers.Conv3D(2, (2, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con58807', )(in0Con58807)
Res22427 = keras.layers.Reshape((1, 2, 2), name = 'Res22427', )(Con58807)
Res47577 = keras.layers.Reshape((1, 4), name = 'Res47577', )(Res22427)
Fla1073 = keras.layers.Flatten(name = 'Fla1073', )(Res47577)
Dot97691 = keras.layers.Dot(axes=(1, 1), name = 'Dot97691', )([in0Dot97691,in1Dot97691])
Sof43615 = keras.layers.Softmax(axis=1, name = 'Sof43615', )(Dot97691)
Res31797 = keras.layers.Reshape((1, 1), name = 'Res31797', )(Sof43615)
Max76983 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='same', name = 'Max76983', )(Res31797)
Glo7146 = keras.layers.GlobalMaxPool1D(name = 'Glo7146', )(Max76983)
Con65694 = keras.layers.Concatenate(axis=1, name = 'Con65694', )([Glo7146,in0Con65694])
Ave94605 = keras.layers.Average(name = 'Ave94605', )([Fla1073,Con65694])
model = tf.keras.models.Model(inputs=[in0Con58807,in0Dot97691,in1Dot97691,in0Con65694], outputs=Ave94605)
w = model.get_layer('Con58807').get_weights() 
w[0] = np.array([[[[[0.0309, 0.0766]]]], [[[[0.2133, 0.388]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con58807').set_weights(w) 
in0Con58807 = tf.constant([[[[[0.3855]], [[0.6473]]], [[[0.4376]], [[0.9769]]]]])
in0Dot97691 = tf.constant([[0.7618, 0.1049, 0.0207]])
in1Dot97691 = tf.constant([[0.6082, 0.2076, 0.5278]])
in0Con65694 = tf.constant([[0.2839, 0.4856, 0.1815]])
print (np.array2string(model.predict([in0Con58807,in0Dot97691,in1Dot97691,in0Con65694],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave94605.png')

LCon58807 = conv3D_layer([[[[[0.3855]], [[0.6473]]], [[[0.4376]], [[0.9769]]]]], 2, 1, 1,[[[[[0.0309, 0.0766]]]], [[[[0.2133, 0.388]]]]],[0, 0], 1, 1, 1, false, 1, 1, 1, Con58807), 
LRes22427 = reshape_layer(Con58807, [1, 2, 2], Res22427), 
LRes47577 = reshape_layer(Res22427, [1, 4], Res47577), 
LFla1073 = flatten_layer(Res47577, Fla1073), 
LDot97691 = dot_layer([[0.7618, 0.1049, 0.0207]], [[0.6082, 0.2076, 0.5278]], 1, 1, Dot97691), 
LSof43615 = softmax_layer(Dot97691, 1, Sof43615), 
LRes31797 = reshape_layer(Sof43615, [1, 1], Res31797), 
LMax76983 = max_pool1D_layer(Res31797, 1, 1, true, Max76983), 
LGlo7146 = global_max_pool1D_layer(Max76983, Glo7146), 
LCon65694 = concatenate_layer([Glo7146,[[0.2839, 0.4856, 0.1815]]], 1, Con65694), 
LAve94605 = average_layer([Fla1073,Con65694], Ave94605), 
exec_layers([LCon58807,LRes22427,LRes47577,LFla1073,LDot97691,LSof43615,LRes31797,LMax76983,LGlo7146,LCon65694,LAve94605],["Con58807","Res22427","Res47577","Fla1073","Dot97691","Sof43615","Res31797","Max76983","Glo7146","Con65694","Ave94605"],Ave94605,"Ave94605")

Actual (Unparsed): [[0.5526260, 0.2416090, 0.3569872, 0.3050602]]

Expected (Unparsed): [[0.552626015,0.24160905,0.35698716999999996,0.30506019]]

Actual:   [[0.5527, 0.2417, 0.357, 0.3051]]

Expected: [[0.5527, 0.2417, 0.357, 0.3051]]