import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave13737 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave13737 = tf.keras.layers.Input(shape=([2, 1]))
in0Zer9084 = tf.keras.layers.Input(shape=([2, 2, 3]))
in0Con95529 = tf.keras.layers.Input(shape=([7]))

Ave13737 = keras.layers.Average(name = 'Ave13737', )([in0Ave13737,in1Ave13737])
Res3482 = keras.layers.Reshape((2, 1, 1), name = 'Res3482', )(Ave13737)
Up_77314 = keras.layers.UpSampling2D(size=(2, 2), name = 'Up_77314', )(Res3482)
Res74611 = keras.layers.Reshape((4, 2), name = 'Res74611', )(Up_77314)
Fla80029 = keras.layers.Flatten(name = 'Fla80029', )(Res74611)
Zer9084 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer9084', )(in0Zer9084)
Res99453 = keras.layers.Reshape((4, 12), name = 'Res99453', )(Zer9084)
GRU75700 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU75700', )(Res99453)
Res21612 = keras.layers.Reshape((1, 1), name = 'Res21612', )(GRU75700)
Glo86159 = keras.layers.GlobalAveragePooling1D(name = 'Glo86159', )(Res21612)
Con95529 = keras.layers.Concatenate(axis=1, name = 'Con95529', )([Glo86159,in0Con95529])
Min50489 = keras.layers.Minimum(name = 'Min50489', )([Fla80029,Con95529])
model = tf.keras.models.Model(inputs=[in0Ave13737,in1Ave13737,in0Zer9084,in0Con95529], outputs=Min50489)
w = model.get_layer('GRU75700').get_weights() 
w[0] = np.array([[9, 3, 3], [10, 7, 5], [6, 6, 9], [9, 2, 8], [10, 6, 7], [10, 10, 2], [5, 10, 3], [2, 1, 4], [10, 3, 4], [9, 7, 7], [10, 4, 7], [9, 5, 10]])
w[1] = np.array([[1, 3, 8]])
w[2] = np.array([3, 3, 10])
model.get_layer('GRU75700').set_weights(w) 
in0Ave13737 = tf.constant([[[0.5834], [0.0834]]])
in1Ave13737 = tf.constant([[[0.5957], [0.2332]]])
in0Zer9084 = tf.constant([[[[1.9057, 1.4583, 1.5221], [1.3309, 1.778, 1.431]], [[1.7053, 1.625, 1.2017], [1.5991, 1.4361, 1.1322]]]])
in0Con95529 = tf.constant([[0.8674, 0.6072, 0.1839, 0.3917, 0.1872, 0.9873, 0.8408]])
print (np.array2string(model.predict([in0Ave13737,in1Ave13737,in0Zer9084,in0Con95529],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min50489.png')

LAve13737 = average_layer([[[[0.5834], [0.0834]]], [[[0.5957], [0.2332]]]], Ave13737), 
LRes3482 = reshape_layer(Ave13737, [2, 1, 1], Res3482), 
LUp_77314 = up_sampling2D_layer(Res3482, 2, 2, Up_77314), 
LRes74611 = reshape_layer(Up_77314, [4, 2], Res74611), 
LFla80029 = flatten_layer(Res74611, Fla80029), 
LZer9084 = zero_padding2D_layer([[[[1.9057, 1.4583, 1.5221], [1.3309, 1.778, 1.431]], [[1.7053, 1.625, 1.2017], [1.5991, 1.4361, 1.1322]]]], 1, 1, 1, 1, Zer9084), 
LRes99453 = reshape_layer(Zer9084, [4, 12], Res99453), 
LGRU75700 = gru_layer(Res99453,[[9, 3, 3], [10, 7, 5], [6, 6, 9], [9, 2, 8], [10, 6, 7], [10, 10, 2], [5, 10, 3], [2, 1, 4], [10, 3, 4], [9, 7, 7], [10, 4, 7], [9, 5, 10]],[[1, 3, 8]],[3, 3, 10], false, GRU75700), 
LRes21612 = reshape_layer(GRU75700, [1, 1], Res21612), 
LGlo86159 = global_average_pooling1D_layer(Res21612, Glo86159), 
LCon95529 = concatenate_layer([Glo86159,[[0.8674, 0.6072, 0.1839, 0.3917, 0.1872, 0.9873, 0.8408]]], 1, Con95529), 
LMin50489 = minimum_layer([Fla80029,Con95529], Min50489), 
exec_layers([LAve13737,LRes3482,LUp_77314,LRes74611,LFla80029,LZer9084,LRes99453,LGRU75700,LRes21612,LGlo86159,LCon95529,LMin50489],["Ave13737","Res3482","Up_77314","Res74611","Fla80029","Zer9084","Res99453","GRU75700","Res21612","Glo86159","Con95529","Min50489"],Min50489,"Min50489")

Actual (Unparsed): [[0.0906049, 0.5895500, 0.5895500, 0.1839000, 0.1583000, 0.1583000, 0.1583000, 0.1583000]]

Expected (Unparsed): [[0.09060485409414817,0.58955,0.58955,0.1839,0.1583,0.1583,0.1583,0.1583]]

Actual:   [[0.0907, 0.5896, 0.5896, 0.1839, 0.1583, 0.1583, 0.1583, 0.1583]]

Expected: [[0.0907, 0.5896, 0.5896, 0.1839, 0.1583, 0.1583, 0.1583, 0.1583]]