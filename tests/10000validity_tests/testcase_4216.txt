import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min70511 = tf.keras.layers.Input(shape=([1, 2]))
in1Min70511 = tf.keras.layers.Input(shape=([1, 2]))
in0Con1597 = tf.keras.layers.Input(shape=([3, 3, 1, 3]))
in0Add52214 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Add52214 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Con27834 = tf.keras.layers.Input(shape=([3, 3, 1, 2]))
in0Con46759 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Add1692 = tf.keras.layers.Input(shape=([1, 2]))
in1Add1692 = tf.keras.layers.Input(shape=([1, 2]))
in0Con51993 = tf.keras.layers.Input(shape=([3, 10]))

Min70511 = keras.layers.Minimum(name = 'Min70511', )([in0Min70511,in1Min70511])
Res25179 = keras.layers.Reshape((1, 2, 1), name = 'Res25179', )(Min70511)
Res53905 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res53905', )(Res25179)
Zer62789 = keras.layers.ZeroPadding3D(padding=((2, 0), (1, 0), (0, 0)), name = 'Zer62789', )(Res53905)
Con1597 = keras.layers.Concatenate(axis=4, name = 'Con1597', )([Zer62789,in0Con1597])
Add52214 = keras.layers.Add(name = 'Add52214', )([in0Add52214,in1Add52214])
Zer17875 = keras.layers.ZeroPadding3D(padding=((2, 0), (1, 0), (0, 0)), name = 'Zer17875', )(Add52214)
Con27834 = keras.layers.Concatenate(axis=4, name = 'Con27834', )([Zer17875,in0Con27834])
Con46759 = keras.layers.Conv3DTranspose(4, (2, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con46759', )(in0Con46759)
Zer50062 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer50062', )(Con46759)
Min33950 = keras.layers.Minimum(name = 'Min33950', )([Con27834,Zer50062])
Mul89307 = keras.layers.Multiply(name = 'Mul89307', )([Con1597,Min33950])
Res44842 = keras.layers.Reshape((3, 3, 4), name = 'Res44842', )(Mul89307)
Res6553 = keras.layers.Reshape((3, 12), name = 'Res6553', )(Res44842)
Add1692 = keras.layers.Add(name = 'Add1692', )([in0Add1692,in1Add1692])
Zer45900 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer45900', )(Add1692)
Con51993 = keras.layers.Concatenate(axis=2, name = 'Con51993', )([Zer45900,in0Con51993])
Add4071 = keras.layers.Add(name = 'Add4071', )([Res6553,Con51993])
model = tf.keras.models.Model(inputs=[in0Min70511,in1Min70511,in0Con1597,in0Add52214,in1Add52214,in0Con27834,in0Con46759,in0Add1692,in1Add1692,in0Con51993], outputs=Add4071)
w = model.get_layer('Con46759').get_weights() 
w[0] = np.array([[[[[0.9265, 0.6161], [0.8863, 0.7126], [0.0295, 0.4522], [0.2417, 0.6374]]]], [[[[0.7561, 0.1177], [0.2321, 0.9801], [0.9247, 0.9181], [0.6199, 0.7615]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con46759').set_weights(w) 
in0Min70511 = tf.constant([[[0.5944, 0.8834]]])
in1Min70511 = tf.constant([[[0.3529, 0.0828]]])
in0Con1597 = tf.constant([[[[[0.649, 0.3511, 0.2544]], [[0.1638, 0.3532, 0.7596]], [[0.3158, 0.3387, 0.1461]]], [[[0.5709, 0.0936, 0.7175]], [[0.4286, 0.5468, 0.3968]], [[0.1698, 0.0887, 0.4068]]], [[[0.6614, 0.2112, 0.7505]], [[0.9471, 0.4831, 0.7362]], [[0.6366, 0.4818, 0.7973]]]]])
in0Add52214 = tf.constant([[[[[0.9099, 0.6849]], [[0.0573, 0.9346]]]]])
in1Add52214 = tf.constant([[[[[0.4219, 0.8518]], [[0.2291, 0.9068]]]]])
in0Con27834 = tf.constant([[[[[0.7405, 0.0196]], [[0.4632, 0.779]], [[0.7312, 0.7731]]], [[[0.6805, 0.3116]], [[0.2052, 0.6631]], [[0.0156, 0.779]]], [[[0.735, 0.872]], [[0.4278, 0.9983]], [[0.5195, 0.1037]]]]])
in0Con46759 = tf.constant([[[[[0.6024, 0.5242]]], [[[0.9757, 0.6622]]]]])
in0Add1692 = tf.constant([[[0.5093, 0.5508]]])
in1Add1692 = tf.constant([[[0.963, 0.1578]]])
in0Con51993 = tf.constant([[[0.5616, 0.3846, 0.5599, 0.9989, 0.1362, 0.7655, 0.9897, 0.2127, 0.9077, 0.2873], [0.3765, 0.2013, 0.5316, 0.1907, 0.647, 0.2123, 0.04, 0.5729, 0.5277, 0.8747], [0.7303, 0.1182, 0.8669, 0.0426, 0.696, 0.8753, 0.8672, 0.2149, 0.7942, 0.2566]]])
print (np.array2string(model.predict([in0Min70511,in1Min70511,in0Con1597,in0Add52214,in1Add52214,in0Con27834,in0Con46759,in0Add1692,in1Add1692,in0Con51993],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add4071.png')

LMin70511 = minimum_layer([[[[0.5944, 0.8834]]], [[[0.3529, 0.0828]]]], Min70511), 
LRes25179 = reshape_layer(Min70511, [1, 2, 1], Res25179), 
LRes53905 = reshape_layer(Res25179, [1, 2, 1, 1], Res53905), 
LZer62789 = zero_padding3D_layer(Res53905, 2, 0, 1, 0, 0, 0, Zer62789), 
LCon1597 = concatenate_layer([Zer62789,[[[[[0.649, 0.3511, 0.2544]], [[0.1638, 0.3532, 0.7596]], [[0.3158, 0.3387, 0.1461]]], [[[0.5709, 0.0936, 0.7175]], [[0.4286, 0.5468, 0.3968]], [[0.1698, 0.0887, 0.4068]]], [[[0.6614, 0.2112, 0.7505]], [[0.9471, 0.4831, 0.7362]], [[0.6366, 0.4818, 0.7973]]]]]], 4, Con1597), 
LAdd52214 = add_layer([[[[[[0.9099, 0.6849]], [[0.0573, 0.9346]]]]], [[[[[0.4219, 0.8518]], [[0.2291, 0.9068]]]]]], Add52214), 
LZer17875 = zero_padding3D_layer(Add52214, 2, 0, 1, 0, 0, 0, Zer17875), 
LCon27834 = concatenate_layer([Zer17875,[[[[[0.7405, 0.0196]], [[0.4632, 0.779]], [[0.7312, 0.7731]]], [[[0.6805, 0.3116]], [[0.2052, 0.6631]], [[0.0156, 0.779]]], [[[0.735, 0.872]], [[0.4278, 0.9983]], [[0.5195, 0.1037]]]]]], 4, Con27834), 
LCon46759 = conv3D_transpose_layer([[[[[0.6024, 0.5242]]], [[[0.9757, 0.6622]]]]], 2, 1, 1,[[[[[0.9265, 0.6161], [0.8863, 0.7126], [0.0295, 0.4522], [0.2417, 0.6374]]]], [[[[0.7561, 0.1177], [0.2321, 0.9801], [0.9247, 0.9181], [0.6199, 0.7615]]]]],[0, 0, 0, 0], 1, 1, 1, false, Con46759), 
LZer50062 = zero_padding3D_layer(Con46759, 0, 0, 2, 0, 0, 0, Zer50062), 
LMin33950 = minimum_layer([Con27834,Zer50062], Min33950), 
LMul89307 = multiply_layer([Con1597,Min33950], Mul89307), 
LRes44842 = reshape_layer(Mul89307, [3, 3, 4], Res44842), 
LRes6553 = reshape_layer(Res44842, [3, 12], Res6553), 
LAdd1692 = add_layer([[[[0.5093, 0.5508]]], [[[0.963, 0.1578]]]], Add1692), 
LZer45900 = zero_padding1D_layer(Add1692, 2, 0, Zer45900), 
LCon51993 = concatenate_layer([Zer45900,[[[0.5616, 0.3846, 0.5599, 0.9989, 0.1362, 0.7655, 0.9897, 0.2127, 0.9077, 0.2873], [0.3765, 0.2013, 0.5316, 0.1907, 0.647, 0.2123, 0.04, 0.5729, 0.5277, 0.8747], [0.7303, 0.1182, 0.8669, 0.0426, 0.696, 0.8753, 0.8672, 0.2149, 0.7942, 0.2566]]]], 2, Con51993), 
LAdd4071 = add_layer([Res6553,Con51993], Add4071), 
exec_layers([LMin70511,LRes25179,LRes53905,LZer62789,LCon1597,LAdd52214,LZer17875,LCon27834,LCon46759,LZer50062,LMin33950,LMul89307,LRes44842,LRes6553,LAdd1692,LZer45900,LCon51993,LAdd4071],["Min70511","Res25179","Res53905","Zer62789","Con1597","Add52214","Zer17875","Con27834","Con46759","Zer50062","Min33950","Mul89307","Res44842","Res6553","Add1692","Zer45900","Con51993","Add4071"],Add4071,"Add4071")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.5616000, 0.3846000, 0.5599000, 0.9989000, 0.1362000, 0.7655000, 0.9897000, 0.2127000, 0.9940055, 0.3573878], [0.0000000, 0.0000000, 0.3765000, 0.2013000, 0.5316000, 0.1907000, 0.6470000, 0.2123000, 0.0400000, 0.5729000, 0.5290837, 1.1915972], [1.4723000, 0.7086000, 0.7303000, 0.1182000, 0.8669000, 0.0426000, 0.6960000, 0.8753000, 0.8909139, 0.7722320, 1.0444951, 0.3392800]]]

Expected (Unparsed): [[[0,0.0,0.5616,0.3846,0.5599,0.9989,0.1362,0.7655,0.9897,0.2127,0.994005515348,0.35738784587600003],[0,0.0,0.3765,0.2013,0.5316,0.1907,0.647,0.2123,0.04,0.5729,0.5290837199999999,1.1915972],[1.4723,0.7085999999999999,0.7303,0.1182,0.8669,0.0426,0.696,0.8753,0.89091392,0.772231962154,1.0444951,0.33928000999999997]]]

Actual:   [[[0, 0, 0.5616, 0.3846, 0.5599, 0.9989, 0.1362, 0.7655, 0.9897, 0.2127, 0.9941, 0.3574], [0, 0, 0.3765, 0.2013, 0.5316, 0.1907, 0.647, 0.2123, 0.04, 0.5729, 0.5291, 1.1916], [1.4723, 0.7086, 0.7303, 0.1182, 0.8669, 0.0426, 0.696, 0.8753, 0.891, 0.7723, 1.0445, 0.3393]]]

Expected: [[[0, 0, 0.5616, 0.3846, 0.5599, 0.9989, 0.1362, 0.7655, 0.9897, 0.2127, 0.9941, 0.3574], [0, 0, 0.3765, 0.2013, 0.5316, 0.1907, 0.647, 0.2123, 0.04, 0.5729, 0.5291, 1.1916], [1.4723, 0.7086, 0.7303, 0.1182, 0.8669, 0.0426, 0.696, 0.8753, 0.891, 0.7723, 1.0445, 0.3393]]]