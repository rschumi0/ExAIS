import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con28708 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))

Con28708 = keras.layers.Conv3DTranspose(4, (2, 2, 1),strides=(1, 1, 1), padding='valid', name = 'Con28708', )(in0Con28708)
Res41688 = keras.layers.Reshape((3, 3, 8), name = 'Res41688', )(Con28708)
Res23283 = keras.layers.Reshape((3, 24), name = 'Res23283', )(Res41688)
Per36646 = keras.layers.Permute((1,2), name = 'Per36646',)(Res23283)
model = tf.keras.models.Model(inputs=[in0Con28708], outputs=Per36646)
w = model.get_layer('Con28708').get_weights() 
w[0] = np.array([[[[[0.4734, 0.1543], [0.7593, 0.7559], [0.554, 0.4426], [0.6214, 0.9774]]], [[[0.7785, 0.8061], [0.5279, 0.1863], [0.0017, 0.3491], [0.7584, 0.7155]]]], [[[[0.3498, 0.7593], [0.1706, 0.3385], [0.8181, 0.1908], [0.413, 0.3891]]], [[[0.1318, 0.2567], [0.6014, 0.0391], [0.0514, 0.3078], [0.8775, 0.0269]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con28708').set_weights(w) 
in0Con28708 = tf.constant([[[[[0.6324, 0.8591], [0.6673, 0.2205]], [[0.0788, 0.2356], [0.4129, 0.2387]]], [[[0.8699, 0.6714], [0.5891, 0.2816]], [[0.0568, 0.7339], [0.1778, 0.6029]]]]])
print (np.array2string(model.predict([in0Con28708],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Per36646.png')

LCon28708 = conv3D_transpose_layer([[[[[0.6324, 0.8591], [0.6673, 0.2205]], [[0.0788, 0.2356], [0.4129, 0.2387]]], [[[0.8699, 0.6714], [0.5891, 0.2816]], [[0.0568, 0.7339], [0.1778, 0.6029]]]]], 2, 2, 1,[[[[[0.4734, 0.1543], [0.7593, 0.7559], [0.554, 0.4426], [0.6214, 0.9774]]], [[[0.7785, 0.8061], [0.5279, 0.1863], [0.0017, 0.3491], [0.7584, 0.7155]]]], [[[[0.3498, 0.7593], [0.1706, 0.3385], [0.8181, 0.1908], [0.413, 0.3891]]], [[[0.1318, 0.2567], [0.6014, 0.0391], [0.0514, 0.3078], [0.8775, 0.0269]]]]],[0, 0, 0, 0], 1, 1, 1, false, Con28708), 
LRes41688 = reshape_layer(Con28708, [3, 3, 8], Res41688), 
LRes23283 = reshape_layer(Res41688, [3, 24], Res23283), 
LPer36646 = permute_layer(Res23283, 1,2, Per36646), 
exec_layers([LCon28708,LRes41688,LRes23283,LPer36646],["Con28708","Res41688","Res23283","Per36646"],Per36646,"Per36646")

Actual (Unparsed): [[[0.4319373, 1.1295750, 0.7305872, 1.2326577, 0.3499230, 0.6733568, 0.4672775, 0.6301769, 1.2585009, 0.7318172, 0.4489186, 1.3735399, 0.9295364, 0.8872951, 0.4125062, 1.1537295, 0.2512630, 0.0854908, 0.0823819, 0.2283337, 0.5138587, 0.2624397, 0.0840321, 0.4839332], [1.3889358, 1.5667191, 1.4603689, 1.7922392, 0.7231780, 0.8486457, 1.0389871, 1.0026940, 1.8688992, 1.6892953, 0.9985110, 2.5949854, 1.3330399, 1.5153601, 0.9501594, 2.2029107, 0.7066800, 0.2233126, 0.3328691, 0.6436672, 0.7401095, 0.4638321, 0.3054696, 0.9349593], [0.8140850, 0.3756738, 0.8397683, 0.6205104, 0.4198861, 0.1958221, 0.5356720, 0.3528689, 0.8641201, 0.8075248, 0.4378660, 1.0904168, 0.6699065, 0.5997096, 0.3774477, 0.8325301, 0.1958784, 0.0628550, 0.2288139, 0.0695839, 0.1781985, 0.1305023, 0.1947115, 0.1722375]]]

Expected (Unparsed): [[[0.4319372899999999,1.12957501,0.73058726,1.2326576999999999,0.34992297,0.67335684,0.4672775,0.63017692,1.2585009100000002,0.73181717,0.44891865000000003,1.3735399699999997,0.9295363700000001,0.8872951200000001,0.41250618000000006,1.15372951,0.25126296,0.0854908,0.08238192000000001,0.22833372000000002,0.51385872,0.26243972000000004,0.08403210000000001,0.48393321],[1.38893583,1.56671912,1.4603689600000003,1.79223923,0.72317801,0.8486457000000001,1.03898709,1.0026940299999998,1.86889919,1.68929533,0.9985110099999999,2.59498539,1.3330399199999998,1.51536008,0.9501593400000001,2.20291069,0.70667995,0.22331257,0.33286905,0.6436672099999999,0.7401095,0.46383212,0.30546957,0.93495925],[0.8140850399999999,0.37567384000000004,0.8397683100000001,0.62051044,0.41988606,0.19582206000000002,0.53567199,0.35286885999999995,0.86412011,0.8075248300000001,0.4378659800000001,1.0904167999999999,0.66990651,0.59970963,0.37744772000000004,0.83253008,0.19587837,0.06285501,0.22881394000000002,0.06958391,0.17819847,0.13050231,0.19471154000000002,0.17223751]]]

Actual:   [[[0.432, 1.1296, 0.7306, 1.2327, 0.35, 0.6734, 0.4673, 0.6302, 1.2586, 0.7319, 0.449, 1.3736, 0.9296, 0.8873, 0.4126, 1.1538, 0.2513, 0.0855, 0.0824, 0.2284, 0.5139, 0.2625, 0.0841, 0.484], [1.389, 1.5668, 1.4604, 1.7923, 0.7232, 0.8487, 1.039, 1.0027, 1.8689, 1.6893, 0.9986, 2.595, 1.3331, 1.5154, 0.9502, 2.203, 0.7067, 0.2234, 0.3329, 0.6437, 0.7402, 0.4639, 0.3055, 0.935], [0.8141, 0.3757, 0.8398, 0.6206, 0.4199, 0.1959, 0.5357, 0.3529, 0.8642, 0.8076, 0.4379, 1.0905, 0.67, 0.5998, 0.3775, 0.8326, 0.1959, 0.0629, 0.2289, 0.0696, 0.1782, 0.1306, 0.1948, 0.1723]]]

Expected: [[[0.432, 1.1296, 0.7306, 1.2327, 0.35, 0.6734, 0.4673, 0.6302, 1.2586, 0.7319, 0.449, 1.3736, 0.9296, 0.8873, 0.4126, 1.1538, 0.2513, 0.0855, 0.0824, 0.2284, 0.5139, 0.2625, 0.0841, 0.484], [1.389, 1.5668, 1.4604, 1.7923, 0.7232, 0.8487, 1.039, 1.0027, 1.8689, 1.6893, 0.9986, 2.595, 1.3331, 1.5154, 0.9502, 2.203, 0.7067, 0.2234, 0.3329, 0.6437, 0.7402, 0.4639, 0.3055, 0.935], [0.8141, 0.3757, 0.8398, 0.6206, 0.4199, 0.1959, 0.5357, 0.3529, 0.8642, 0.8076, 0.4379, 1.0905, 0.67, 0.5998, 0.3775, 0.8326, 0.1959, 0.0629, 0.2289, 0.0696, 0.1782, 0.1306, 0.1948, 0.1723]]]