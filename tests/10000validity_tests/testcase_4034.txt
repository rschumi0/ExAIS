import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max69100 = tf.keras.layers.Input(shape=([1, 1]))
in1Max69100 = tf.keras.layers.Input(shape=([1, 1]))
in0Glo39737 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Con57174 = tf.keras.layers.Input(shape=([1, 1, 1, 3]))
in0Max89950 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Max89950 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))

Max69100 = keras.layers.Maximum(name = 'Max69100', )([in0Max69100,in1Max69100])
Res59395 = keras.layers.Reshape((1, 1, 1), name = 'Res59395', )(Max69100)
Max43202 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 1), padding='same', name = 'Max43202', )(Res59395)
Res9258 = keras.layers.Reshape((1, 1), name = 'Res9258', )(Max43202)
Fla19674 = keras.layers.Flatten(name = 'Fla19674', )(Res9258)
Glo39737 = keras.layers.GlobalMaxPool3D(name = 'Glo39737', )(in0Glo39737)
Ave87605 = keras.layers.Average(name = 'Ave87605', )([Fla19674,Glo39737])
Res76259 = keras.layers.Reshape((1, 1), name = 'Res76259', )(Ave87605)
Res10459 = keras.layers.Reshape((1, 1, 1), name = 'Res10459', )(Res76259)
Res67423 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res67423', )(Res10459)
Con57174 = keras.layers.Concatenate(axis=4, name = 'Con57174', )([Res67423,in0Con57174])
Max89950 = keras.layers.Maximum(name = 'Max89950', )([in0Max89950,in1Max89950])
Den12190 = keras.layers.Dense(4,name = 'Den12190', )(Max89950)
Sub5358 = keras.layers.Subtract(name = 'Sub5358', )([Con57174,Den12190])
model = tf.keras.models.Model(inputs=[in0Max69100,in1Max69100,in0Glo39737,in0Con57174,in0Max89950,in1Max89950], outputs=Sub5358)
w = model.get_layer('Den12190').get_weights() 
w[0] = np.array([[0.5771, 0.8244, 0.0477, 0.9213], [0.4881, 0.3237, 0.9429, 0.9625]])
w[1] = np.array([0.0613, 0.8497, 0.9343, 0.9162])
model.get_layer('Den12190').set_weights(w) 
in0Max69100 = tf.constant([[[0.0947]]])
in1Max69100 = tf.constant([[[0.9828]]])
in0Glo39737 = tf.constant([[[[[1.3318]]], [[[1.7665]]]]])
in0Con57174 = tf.constant([[[[[0.846, 0.1171, 0.483]]]]])
in0Max89950 = tf.constant([[[[[0.1516, 0.154]]]]])
in1Max89950 = tf.constant([[[[[0.4402, 0.2734]]]]])
print (np.array2string(model.predict([in0Max69100,in1Max69100,in0Glo39737,in0Con57174,in0Max89950,in1Max89950],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub5358.png')

LMax69100 = maximum_layer([[[[0.0947]]], [[[0.9828]]]], Max69100), 
LRes59395 = reshape_layer(Max69100, [1, 1, 1], Res59395), 
LMax43202 = max_pool2D_layer(Res59395, 1, 1, 1, 1, true, Max43202), 
LRes9258 = reshape_layer(Max43202, [1, 1], Res9258), 
LFla19674 = flatten_layer(Res9258, Fla19674), 
LGlo39737 = global_max_pool3D_layer([[[[[1.3318]]], [[[1.7665]]]]], Glo39737), 
LAve87605 = average_layer([Fla19674,Glo39737], Ave87605), 
LRes76259 = reshape_layer(Ave87605, [1, 1], Res76259), 
LRes10459 = reshape_layer(Res76259, [1, 1, 1], Res10459), 
LRes67423 = reshape_layer(Res10459, [1, 1, 1, 1], Res67423), 
LCon57174 = concatenate_layer([Res67423,[[[[[0.846, 0.1171, 0.483]]]]]], 4, Con57174), 
LMax89950 = maximum_layer([[[[[[0.1516, 0.154]]]]], [[[[[0.4402, 0.2734]]]]]], Max89950), 
LDen12190 = dense_layer(Max89950, [[0.5771, 0.8244, 0.0477, 0.9213], [0.4881, 0.3237, 0.9429, 0.9625]],[0.0613, 0.8497, 0.9343, 0.9162], Den12190), 
LSub5358 = subtract_layer(Con57174,Den12190, Sub5358), 
exec_layers([LMax69100,LRes59395,LMax43202,LRes9258,LFla19674,LGlo39737,LAve87605,LRes76259,LRes10459,LRes67423,LCon57174,LMax89950,LDen12190,LSub5358],["Max69100","Res59395","Max43202","Res9258","Fla19674","Glo39737","Ave87605","Res76259","Res10459","Res67423","Con57174","Max89950","Den12190","Sub5358"],Sub5358,"Sub5358")

Actual (Unparsed): [[[[[0.9258640, -0.4551004, -1.0959864, -1.1019038]]]]]

Expected (Unparsed): [[[[[0.92586404,-0.45510046000000004,-1.0959864,-1.10190376]]]]]

Actual:   [[[[[0.9259, -0.4551, -1.0959, -1.1019]]]]]

Expected: [[[[[0.9259, -0.4551, -1.0959, -1.1019]]]]]