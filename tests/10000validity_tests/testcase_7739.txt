import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub71595 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub71595 = tf.keras.layers.Input(shape=([2, 3]))

Sub71595 = keras.layers.Subtract(name = 'Sub71595', )([in0Sub71595,in1Sub71595])
Res21720 = keras.layers.Reshape((2, 3, 1), name = 'Res21720', )(Sub71595)
Res41401 = keras.layers.Reshape((2, 3, 1, 1), name = 'Res41401', )(Res21720)
Cro17047 = keras.layers.Cropping3D(cropping=((0, 0), (1, 1), (0, 0)), name = 'Cro17047', )(Res41401)
Res56100 = keras.layers.Reshape((2, 1, 1), name = 'Res56100', )(Cro17047)
Res71363 = keras.layers.Reshape((2, 1), name = 'Res71363', )(Res56100)
Res98876 = keras.layers.Reshape((2, 1, 1), name = 'Res98876', )(Res71363)
Loc3890 = keras.layers.LocallyConnected2D(4, (1, 1),strides=(1, 1), name = 'Loc3890', )(Res98876)
model = tf.keras.models.Model(inputs=[in0Sub71595,in1Sub71595], outputs=Loc3890)
w = model.get_layer('Loc3890').get_weights() 
w[0] = np.array([[[0.9438, 0.7238, 0.0782, 0.0571]], [[0.1283, 0.1686, 0.6419, 0.0667]]])
w[1] = np.array([[[0, 0, 0, 0]], [[0, 0, 0, 0]]])
model.get_layer('Loc3890').set_weights(w) 
in0Sub71595 = tf.constant([[[0.855, 0.3394, 0.6292], [0.3588, 0.6344, 0.3748]]])
in1Sub71595 = tf.constant([[[0.966, 0.1635, 0.7934], [0.6497, 0.7198, 0.1794]]])
print (np.array2string(model.predict([in0Sub71595,in1Sub71595],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc3890.png')

LSub71595 = subtract_layer([[[0.855, 0.3394, 0.6292], [0.3588, 0.6344, 0.3748]]], [[[0.966, 0.1635, 0.7934], [0.6497, 0.7198, 0.1794]]], Sub71595), 
LRes21720 = reshape_layer(Sub71595, [2, 3, 1], Res21720), 
LRes41401 = reshape_layer(Res21720, [2, 3, 1, 1], Res41401), 
LCro17047 = cropping3D_layer(Res41401, 0, 0, 1, 1, 0, 0, Cro17047), 
LRes56100 = reshape_layer(Cro17047, [2, 1, 1], Res56100), 
LRes71363 = reshape_layer(Res56100, [2, 1], Res71363), 
LRes98876 = reshape_layer(Res71363, [2, 1, 1], Res98876), 
LLoc3890 = locally_connected2D_layer(Res98876, 1, 1,[[[0.9438, 0.7238, 0.0782, 0.0571]], [[0.1283, 0.1686, 0.6419, 0.0667]]],[[[0, 0, 0, 0]], [[0, 0, 0, 0]]], 1, 1, Loc3890), 
exec_layers([LSub71595,LRes21720,LRes41401,LCro17047,LRes56100,LRes71363,LRes98876,LLoc3890],["Sub71595","Res21720","Res41401","Cro17047","Res56100","Res71363","Res98876","Loc3890"],Loc3890,"Loc3890")

Actual (Unparsed): [[[[0.1660144, 0.1273164, 0.0137554, 0.0100439]], [[-0.0109568, -0.0143984, -0.0548183, -0.0056962]]]]

Expected (Unparsed): [[[[0.16601441999999997,0.12731641999999999,0.01375538,0.010043889999999998]],[[-0.010956820000000004,-0.014398440000000005,-0.05481826000000002,-0.005696180000000002]]]]

Actual:   [[[[0.1661, 0.1274, 0.0138, 0.0101]], [[-0.0109, -0.0143, -0.0548, -0.0056]]]]

Expected: [[[[0.1661, 0.1274, 0.0138, 0.0101]], [[-0.0109, -0.0143, -0.0548, -0.0056]]]]