import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc2341 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Max21314 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Max21314 = tf.keras.layers.Input(shape=([1, 2, 1]))

Loc2341 = keras.layers.LocallyConnected2D(3, (1, 1),strides=(1, 1), name = 'Loc2341', )(in0Loc2341)
Res48986 = keras.layers.Reshape((2, 3), name = 'Res48986', )(Loc2341)
Glo76743 = keras.layers.GlobalMaxPool1D(name = 'Glo76743', )(Res48986)
Res68838 = keras.layers.Reshape((3, 1), name = 'Res68838', )(Glo76743)
Res38940 = keras.layers.Reshape((3, 1, 1), name = 'Res38940', )(Res68838)
Zer75856 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer75856', )(Res38940)
Max21314 = keras.layers.Maximum(name = 'Max21314', )([in0Max21314,in1Max21314])
PRe61995 = keras.layers.PReLU(name = 'PRe61995', )(Max21314)
Zer77045 = keras.layers.ZeroPadding2D(padding=((2, 0), (1, 0)), name = 'Zer77045', )(PRe61995)
Ave27009 = keras.layers.Average(name = 'Ave27009', )([Zer75856,Zer77045])
model = tf.keras.models.Model(inputs=[in0Loc2341,in0Max21314,in1Max21314], outputs=Ave27009)
w = model.get_layer('Loc2341').get_weights() 
w[0] = np.array([[[0.0622, 0.3579, 0.7002], [0.4985, 0.4497, 0.8346]], [[0.0648, 0.0543, 0.0008], [0.2005, 0.6844, 0.5034]]])
w[1] = np.array([[[0, 0, 0]], [[0, 0, 0]]])
model.get_layer('Loc2341').set_weights(w) 
w = model.get_layer('PRe61995').get_weights() 
w[0] = np.array([[[0.246], [0.5774]]])
model.get_layer('PRe61995').set_weights(w) 
in0Loc2341 = tf.constant([[[[0.6505, 0.0799]], [[0.7818, 0.8613]]]])
in0Max21314 = tf.constant([[[[0.1852], [0.5724]]]])
in1Max21314 = tf.constant([[[[0.3738], [0.9771]]]])
print (np.array2string(model.predict([in0Loc2341,in0Max21314,in1Max21314],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave27009.png')

LLoc2341 = locally_connected2D_layer([[[[0.6505, 0.0799]], [[0.7818, 0.8613]]]], 1, 1,[[[0.0622, 0.3579, 0.7002], [0.4985, 0.4497, 0.8346]], [[0.0648, 0.0543, 0.0008], [0.2005, 0.6844, 0.5034]]],[[[0, 0, 0]], [[0, 0, 0]]], 1, 1, Loc2341), 
LRes48986 = reshape_layer(Loc2341, [2, 3], Res48986), 
LGlo76743 = global_max_pool1D_layer(Res48986, Glo76743), 
LRes68838 = reshape_layer(Glo76743, [3, 1], Res68838), 
LRes38940 = reshape_layer(Res68838, [3, 1, 1], Res38940), 
LZer75856 = zero_padding2D_layer(Res38940, 0, 0, 2, 0, Zer75856), 
LMax21314 = maximum_layer([[[[[0.1852], [0.5724]]]], [[[[0.3738], [0.9771]]]]], Max21314), 
LPRe61995 = prelu_layer(Max21314, [[[0.246], [0.5774]]], PRe61995), 
LZer77045 = zero_padding2D_layer(PRe61995, 2, 0, 1, 0, Zer77045), 
LAve27009 = average_layer([Zer75856,Zer77045], Ave27009), 
exec_layers([LLoc2341,LRes48986,LGlo76743,LRes68838,LRes38940,LZer75856,LMax21314,LPRe61995,LZer77045,LAve27009],["Loc2341","Res48986","Glo76743","Res68838","Res38940","Zer75856","Max21314","PRe61995","Zer77045","Ave27009"],Ave27009,"Ave27009")

Actual (Unparsed): [[[[0.0000000], [0.0000000], [0.1116756]], [[0.0000000], [0.0000000], [0.3159627]], [[0.0000000], [0.1869000], [0.7496323]]]]

Expected (Unparsed): [[[[0],[0],[0.111675645]],[[0],[0],[0.31596272999999997]],[[0],[0.1869],[0.7496323199999999]]]]

Actual:   [[[[0], [0], [0.1117]], [[0], [0], [0.316]], [[0], [0.1869], [0.7497]]]]

Expected: [[[[0], [0], [0.1117]], [[0], [0], [0.316]], [[0], [0.1869], [0.7497]]]]