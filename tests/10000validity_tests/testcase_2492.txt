import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub7783 = tf.keras.layers.Input(shape=([3, 2, 2]))
in1Sub7783 = tf.keras.layers.Input(shape=([3, 2, 2]))
in0Sub19152 = tf.keras.layers.Input(shape=([3]))
in1Sub19152 = tf.keras.layers.Input(shape=([3]))
in0Con21315 = tf.keras.layers.Input(shape=([1]))

Sub7783 = keras.layers.Subtract(name = 'Sub7783', )([in0Sub7783,in1Sub7783])
Loc80187 = keras.layers.LocallyConnected2D(4, (3, 2),strides=(1, 1), name = 'Loc80187', )(Sub7783)
Res42748 = keras.layers.Reshape((1, 4), name = 'Res42748', )(Loc80187)
Fla57393 = keras.layers.Flatten(name = 'Fla57393', )(Res42748)
Sub19152 = keras.layers.Subtract(name = 'Sub19152', )([in0Sub19152,in1Sub19152])
Con21315 = keras.layers.Concatenate(axis=1, name = 'Con21315', )([Sub19152,in0Con21315])
Mul55531 = keras.layers.Multiply(name = 'Mul55531', )([Fla57393,Con21315])
model = tf.keras.models.Model(inputs=[in0Sub7783,in1Sub7783,in0Sub19152,in1Sub19152,in0Con21315], outputs=Mul55531)
w = model.get_layer('Loc80187').get_weights() 
w[0] = np.array([[[0.8876, 0.2892, 0.1393, 0.2764], [0.7361, 0.2354, 0.8364, 0.3112], [0.3106, 0.8584, 0.0666, 0.9867], [0.1533, 0.3092, 0.094, 0.4467], [0.2764, 0.3801, 0.6981, 0.5988], [0.6355, 0.7876, 0.4542, 0.636], [0.5422, 0.1526, 0.333, 0.5151], [0.3638, 0.1663, 0.9256, 0.2607], [0.9, 0.1354, 0.0238, 0.6822], [0.896, 0.0851, 0.2541, 0.5943], [0.2572, 0.8644, 0.9514, 0.911], [0.6592, 0.2474, 0.4876, 0.0486]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc80187').set_weights(w) 
in0Sub7783 = tf.constant([[[[0.8273, 0.1808], [0.0197, 0.5109]], [[0.0934, 0.2591], [0.3754, 0.5801]], [[0.363, 0.5593], [0.0051, 0.8582]]]])
in1Sub7783 = tf.constant([[[[0.016, 0.0265], [0.0696, 0.502]], [[0.4556, 0.9894], [0.5944, 0.2582]], [[0.1525, 0.794], [0.7153, 0.038]]]])
in0Sub19152 = tf.constant([[0.5263, 0.8195, 0.5768]])
in1Sub19152 = tf.constant([[0.6615, 0.8162, 0.8572]])
in0Con21315 = tf.constant([[0.6497]])
print (np.array2string(model.predict([in0Sub7783,in1Sub7783,in0Sub19152,in1Sub19152,in0Con21315],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul55531.png')

LSub7783 = subtract_layer([[[[0.8273, 0.1808], [0.0197, 0.5109]], [[0.0934, 0.2591], [0.3754, 0.5801]], [[0.363, 0.5593], [0.0051, 0.8582]]]], [[[[0.016, 0.0265], [0.0696, 0.502]], [[0.4556, 0.9894], [0.5944, 0.2582]], [[0.1525, 0.794], [0.7153, 0.038]]]], Sub7783), 
LLoc80187 = locally_connected2D_layer(Sub7783, 3, 2,[[[0.8876, 0.2892, 0.1393, 0.2764], [0.7361, 0.2354, 0.8364, 0.3112], [0.3106, 0.8584, 0.0666, 0.9867], [0.1533, 0.3092, 0.094, 0.4467], [0.2764, 0.3801, 0.6981, 0.5988], [0.6355, 0.7876, 0.4542, 0.636], [0.5422, 0.1526, 0.333, 0.5151], [0.3638, 0.1663, 0.9256, 0.2607], [0.9, 0.1354, 0.0238, 0.6822], [0.896, 0.0851, 0.2541, 0.5943], [0.2572, 0.8644, 0.9514, 0.911], [0.6592, 0.2474, 0.4876, 0.0486]]],[[[0, 0, 0, 0]]], 1, 1, Loc80187), 
LRes42748 = reshape_layer(Loc80187, [1, 4], Res42748), 
LFla57393 = flatten_layer(Res42748, Fla57393), 
LSub19152 = subtract_layer([[0.5263, 0.8195, 0.5768]], [[0.6615, 0.8162, 0.8572]], Sub19152), 
LCon21315 = concatenate_layer([Sub19152,[[0.6497]]], 1, Con21315), 
LMul55531 = multiply_layer([Fla57393,Con21315], Mul55531), 
exec_layers([LSub7783,LLoc80187,LRes42748,LFla57393,LSub19152,LCon21315,LMul55531],["Sub7783","Loc80187","Res42748","Fla57393","Sub19152","Con21315","Mul55531"],Mul55531,"Mul55531")

Actual (Unparsed): [[-0.0798862, -0.0028523, 0.1262722, -0.7057383]]

Expected (Unparsed): [[-0.07988622293599996,-0.0028522781099999733,0.12627216748000009,-0.7057382752379999]]

Actual:   [[-0.0798, -0.0028, 0.1263, -0.7057]]

Expected: [[-0.0798, -0.0028, 0.1263, -0.7057]]