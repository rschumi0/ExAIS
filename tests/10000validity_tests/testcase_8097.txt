import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub60714 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub60714 = tf.keras.layers.Input(shape=([2, 2]))
in0Con45184 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Ave91204 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Ave91204 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Add52947 = tf.keras.layers.Input(shape=([2, 2]))
in1Add52947 = tf.keras.layers.Input(shape=([2, 2]))
in0Con1847 = tf.keras.layers.Input(shape=([2, 2, 1]))

Sub60714 = keras.layers.Subtract(name = 'Sub60714', )([in0Sub60714,in1Sub60714])
Res50547 = keras.layers.Reshape((2, 2, 1), name = 'Res50547', )(Sub60714)
Res73866 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res73866', )(Res50547)
Con45184 = keras.layers.Concatenate(axis=4, name = 'Con45184', )([Res73866,in0Con45184])
Ave91204 = keras.layers.Average(name = 'Ave91204', )([in0Ave91204,in1Ave91204])
Min10597 = keras.layers.Minimum(name = 'Min10597', )([Con45184,Ave91204])
Res6234 = keras.layers.Reshape((2, 2, 2), name = 'Res6234', )(Min10597)
Add52947 = keras.layers.Add(name = 'Add52947', )([in0Add52947,in1Add52947])
Res47130 = keras.layers.Reshape((2, 2, 1), name = 'Res47130', )(Add52947)
Up_37228 = keras.layers.UpSampling2D(size=(1, 1), name = 'Up_37228', )(Res47130)
Con1847 = keras.layers.Concatenate(axis=3, name = 'Con1847', )([Up_37228,in0Con1847])
Mul573 = keras.layers.Multiply(name = 'Mul573', )([Res6234,Con1847])
model = tf.keras.models.Model(inputs=[in0Sub60714,in1Sub60714,in0Con45184,in0Ave91204,in1Ave91204,in0Add52947,in1Add52947,in0Con1847], outputs=Mul573)
in0Sub60714 = tf.constant([[[0.7783, 0.0331], [0.3829, 0.3086]]])
in1Sub60714 = tf.constant([[[0.0854, 0.7675], [0.0644, 0.2773]]])
in0Con45184 = tf.constant([[[[[0.8331]], [[0.3671]]], [[[0.3561]], [[0.9411]]]]])
in0Ave91204 = tf.constant([[[[[0.6897, 0.6823]], [[0.2761, 0.4606]]], [[[0.3935, 0.5996]], [[0.8779, 0.9022]]]]])
in1Ave91204 = tf.constant([[[[[0.4197, 0.1392]], [[0.6055, 0.7566]]], [[[0.6269, 0.4396]], [[0.714, 0.1554]]]]])
in0Add52947 = tf.constant([[[0.1893, 0.2134], [0.9336, 0.9634]]])
in1Add52947 = tf.constant([[[0.9134, 0.5405], [0.198, 0.278]]])
in0Con1847 = tf.constant([[[[0.7433], [0.8951]], [[0.6536], [0.751]]]])
print (np.array2string(model.predict([in0Sub60714,in1Sub60714,in0Con45184,in0Ave91204,in1Ave91204,in0Add52947,in1Add52947,in0Con1847],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul573.png')

LSub60714 = subtract_layer([[[0.7783, 0.0331], [0.3829, 0.3086]]], [[[0.0854, 0.7675], [0.0644, 0.2773]]], Sub60714), 
LRes50547 = reshape_layer(Sub60714, [2, 2, 1], Res50547), 
LRes73866 = reshape_layer(Res50547, [2, 2, 1, 1], Res73866), 
LCon45184 = concatenate_layer([Res73866,[[[[[0.8331]], [[0.3671]]], [[[0.3561]], [[0.9411]]]]]], 4, Con45184), 
LAve91204 = average_layer([[[[[[0.6897, 0.6823]], [[0.2761, 0.4606]]], [[[0.3935, 0.5996]], [[0.8779, 0.9022]]]]], [[[[[0.4197, 0.1392]], [[0.6055, 0.7566]]], [[[0.6269, 0.4396]], [[0.714, 0.1554]]]]]], Ave91204), 
LMin10597 = minimum_layer([Con45184,Ave91204], Min10597), 
LRes6234 = reshape_layer(Min10597, [2, 2, 2], Res6234), 
LAdd52947 = add_layer([[[[0.1893, 0.2134], [0.9336, 0.9634]]], [[[0.9134, 0.5405], [0.198, 0.278]]]], Add52947), 
LRes47130 = reshape_layer(Add52947, [2, 2, 1], Res47130), 
LUp_37228 = up_sampling2D_layer(Res47130, 1, 1, Up_37228), 
LCon1847 = concatenate_layer([Up_37228,[[[[0.7433], [0.8951]], [[0.6536], [0.751]]]]], 3, Con1847), 
LMul573 = multiply_layer([Res6234,Con1847], Mul573), 
exec_layers([LSub60714,LRes50547,LRes73866,LCon45184,LAve91204,LMin10597,LRes6234,LAdd52947,LRes47130,LUp_37228,LCon1847,LMul573],["Sub60714","Res50547","Res73866","Con45184","Ave91204","Min10597","Res6234","Add52947","Res47130","Up_37228","Con1847","Mul573"],Mul573,"Mul573")

Actual (Unparsed): [[[[0.6116677, 0.3053105], [-0.5536641, 0.3285912]], [[0.3604146, 0.2327469], [0.0388558, 0.3971288]]]]

Expected (Unparsed): [[[[0.61166769,0.30531047499999997],[-0.55366416,0.32859120999999997]],[[0.3604146,0.23274696],[0.03885581999999999,0.39712880000000006]]]]

Actual:   [[[[0.6117, 0.3054], [-0.5536, 0.3286]], [[0.3605, 0.2328], [0.0389, 0.3972]]]]

Expected: [[[[0.6117, 0.3054], [-0.5536, 0.3286]], [[0.3605, 0.2328], [0.0389, 0.3972]]]]