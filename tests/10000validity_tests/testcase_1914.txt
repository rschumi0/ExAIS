import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add89120 = tf.keras.layers.Input(shape=([2, 1]))
in1Add89120 = tf.keras.layers.Input(shape=([2, 1]))
in0Con84784 = tf.keras.layers.Input(shape=([1]))
in0Add16627 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Add16627 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Con9980 = tf.keras.layers.Input(shape=([1]))
in0Sim86197 = tf.keras.layers.Input(shape=([1, 1]))
in0Con46272 = tf.keras.layers.Input(shape=([3, 3, 2]))
in0Lea43540 = tf.keras.layers.Input(shape=([2, 2]))
in0Mul92701 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Mul92701 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con75860 = tf.keras.layers.Input(shape=([3, 6]))

Add89120 = keras.layers.Add(name = 'Add89120', )([in0Add89120,in1Add89120])
Fla82331 = keras.layers.Flatten(name = 'Fla82331', )(Add89120)
Con84784 = keras.layers.Concatenate(axis=1, name = 'Con84784', )([Fla82331,in0Con84784])
Add16627 = keras.layers.Add(name = 'Add16627', )([in0Add16627,in1Add16627])
Res21555 = keras.layers.Reshape((2, 1, 1), name = 'Res21555', )(Add16627)
Res67124 = keras.layers.Reshape((2, 1), name = 'Res67124', )(Res21555)
Fla30859 = keras.layers.Flatten(name = 'Fla30859', )(Res67124)
Con9980 = keras.layers.Concatenate(axis=1, name = 'Con9980', )([Fla30859,in0Con9980])
Sim86197 = keras.layers.SimpleRNN(3,name = 'Sim86197', )(in0Sim86197)
Add48569 = keras.layers.Add(name = 'Add48569', )([Con9980,Sim86197])
Sub37257 = keras.layers.Subtract(name = 'Sub37257', )([Con84784,Add48569])
Res75495 = keras.layers.Reshape((3, 1), name = 'Res75495', )(Sub37257)
Res54724 = keras.layers.Reshape((3, 1, 1), name = 'Res54724', )(Res75495)
Zer77470 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer77470', )(Res54724)
Con46272 = keras.layers.Concatenate(axis=3, name = 'Con46272', )([Zer77470,in0Con46272])
Lea43540 = keras.layers.LeakyReLU(alpha=2.1155270932336188, name = 'Lea43540', input_shape=(2, 2))(in0Lea43540)
Res28638 = keras.layers.Reshape((2, 2, 1), name = 'Res28638', )(Lea43540)
Sep42203 = keras.layers.SeparableConv2D(3, (2, 1),strides=(1, 1), padding='same', name = 'Sep42203', )(Res28638)
Zer35624 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer35624', )(Sep42203)
Min35283 = keras.layers.Minimum(name = 'Min35283', )([Con46272,Zer35624])
Res69787 = keras.layers.Reshape((3, 9), name = 'Res69787', )(Min35283)
Mul92701 = keras.layers.Multiply(name = 'Mul92701', )([in0Mul92701,in1Mul92701])
Res95273 = keras.layers.Reshape((2, 2), name = 'Res95273', )(Mul92701)
Sep39462 = keras.layers.SeparableConv1D(3, (1),strides=(1), padding='valid', name = 'Sep39462', )(Res95273)
Zer54095 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer54095', )(Sep39462)
Con75860 = keras.layers.Concatenate(axis=2, name = 'Con75860', )([Zer54095,in0Con75860])
Ave3929 = keras.layers.Average(name = 'Ave3929', )([Res69787,Con75860])
model = tf.keras.models.Model(inputs=[in0Add89120,in1Add89120,in0Con84784,in0Add16627,in1Add16627,in0Con9980,in0Sim86197,in0Con46272,in0Lea43540,in0Mul92701,in1Mul92701,in0Con75860], outputs=Ave3929)
w = model.get_layer('Sim86197').get_weights() 
w[0] = np.array([[3, 10, 10]])
w[1] = np.array([[6, 3, 3], [10, 5, 9], [3, 8, 5]])
w[2] = np.array([8, 1, 4])
model.get_layer('Sim86197').set_weights(w) 
w = model.get_layer('Sep42203').get_weights() 
w[0] = np.array([[[[0.2686]]], [[[0.3933]]]])
w[1] = np.array([[[[0.3741, 0.854, 0.4153]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep42203').set_weights(w) 
w = model.get_layer('Sep39462').get_weights() 
w[0] = np.array([[[0.3542], [0.8755]]])
w[1] = np.array([[[0.6917, 0.7296, 0.2742], [0.6853, 0.1044, 0.1165]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep39462').set_weights(w) 
in0Add89120 = tf.constant([[[0.2632], [0.9399]]])
in1Add89120 = tf.constant([[[0.8069], [0.8244]]])
in0Con84784 = tf.constant([[0.7617]])
in0Add16627 = tf.constant([[[[[0.6564]]], [[[0.2457]]]]])
in1Add16627 = tf.constant([[[[[0.7354]]], [[[0.7215]]]]])
in0Con9980 = tf.constant([[0.6982]])
in0Sim86197 = tf.constant([[[6]]])
in0Con46272 = tf.constant([[[[0.6272, 0.2661], [0.2121, 0.5838], [0.6367, 0.8903]], [[0.226, 0.5915], [0.2834, 0.4717], [0.5925, 0.3836]], [[0.684, 0.3827], [0.6744, 0.8781], [0.4678, 0.74]]]])
in0Lea43540 = tf.constant([[[0.2799, 0.5204], [0.52, 0.2626]]])
in0Mul92701 = tf.constant([[[[0.5449, 0.6412]], [[0.048, 0.9214]]]])
in1Mul92701 = tf.constant([[[[0.98, 0.638]], [[0.0092, 0.917]]]])
in0Con75860 = tf.constant([[[0.1974, 0.1012, 0.3184, 0.934, 0.382, 0.6229], [0.721, 0.0591, 0.2, 0.0135, 0.9291, 0.6456], [0.4435, 0.2445, 0.5162, 0.0583, 0.3901, 0.1708]]])
print (np.array2string(model.predict([in0Add89120,in1Add89120,in0Con84784,in0Add16627,in1Add16627,in0Con9980,in0Sim86197,in0Con46272,in0Lea43540,in0Mul92701,in1Mul92701,in0Con75860],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave3929.png')

LAdd89120 = add_layer([[[[0.2632], [0.9399]]], [[[0.8069], [0.8244]]]], Add89120), 
LFla82331 = flatten_layer(Add89120, Fla82331), 
LCon84784 = concatenate_layer([Fla82331,[[0.7617]]], 1, Con84784), 
LAdd16627 = add_layer([[[[[[0.6564]]], [[[0.2457]]]]], [[[[[0.7354]]], [[[0.7215]]]]]], Add16627), 
LRes21555 = reshape_layer(Add16627, [2, 1, 1], Res21555), 
LRes67124 = reshape_layer(Res21555, [2, 1], Res67124), 
LFla30859 = flatten_layer(Res67124, Fla30859), 
LCon9980 = concatenate_layer([Fla30859,[[0.6982]]], 1, Con9980), 
LSim86197 = simple_rnn_layer([[[6]]],[[3, 10, 10]],[[6, 3, 3], [10, 5, 9], [3, 8, 5]],[8, 1, 4], Sim86197), 
LAdd48569 = add_layer([Con9980,Sim86197], Add48569), 
LSub37257 = subtract_layer(Con84784,Add48569, Sub37257), 
LRes75495 = reshape_layer(Sub37257, [3, 1], Res75495), 
LRes54724 = reshape_layer(Res75495, [3, 1, 1], Res54724), 
LZer77470 = zero_padding2D_layer(Res54724, 0, 0, 2, 0, Zer77470), 
LCon46272 = concatenate_layer([Zer77470,[[[[0.6272, 0.2661], [0.2121, 0.5838], [0.6367, 0.8903]], [[0.226, 0.5915], [0.2834, 0.4717], [0.5925, 0.3836]], [[0.684, 0.3827], [0.6744, 0.8781], [0.4678, 0.74]]]]], 3, Con46272), 
LLea43540 = leaky_relu_layer([[[0.2799, 0.5204], [0.52, 0.2626]]], 2.1155270932336188, Lea43540), 
LRes28638 = reshape_layer(Lea43540, [2, 2, 1], Res28638), 
LSep42203 = separable_conv2D_layer(Res28638, 2, 1,[[[[[0.2686]]], [[[0.3933]]]],[[[[0.3741, 0.854, 0.4153]]]]],[0, 0, 0], 1, 1, true, Sep42203), 
LZer35624 = zero_padding2D_layer(Sep42203, 1, 0, 1, 0, Zer35624), 
LMin35283 = minimum_layer([Con46272,Zer35624], Min35283), 
LRes69787 = reshape_layer(Min35283, [3, 9], Res69787), 
LMul92701 = multiply_layer([[[[[0.5449, 0.6412]], [[0.048, 0.9214]]]], [[[[0.98, 0.638]], [[0.0092, 0.917]]]]], Mul92701), 
LRes95273 = reshape_layer(Mul92701, [2, 2], Res95273), 
LSep39462 = separable_conv1D_layer(Res95273, 1,[[[[0.3542], [0.8755]]],[[[0.6917, 0.7296, 0.2742], [0.6853, 0.1044, 0.1165]]]],[0, 0, 0], 1, false, Sep39462), 
LZer54095 = zero_padding1D_layer(Sep39462, 1, 0, Zer54095), 
LCon75860 = concatenate_layer([Zer54095,[[[0.1974, 0.1012, 0.3184, 0.934, 0.382, 0.6229], [0.721, 0.0591, 0.2, 0.0135, 0.9291, 0.6456], [0.4435, 0.2445, 0.5162, 0.0583, 0.3901, 0.1708]]]], 2, Con75860), 
LAve3929 = average_layer([Res69787,Con75860], Ave3929), 
exec_layers([LAdd89120,LFla82331,LCon84784,LAdd16627,LRes21555,LRes67124,LFla30859,LCon9980,LSim86197,LAdd48569,LSub37257,LRes75495,LRes54724,LZer77470,LCon46272,LLea43540,LRes28638,LSep42203,LZer35624,LMin35283,LRes69787,LMul92701,LRes95273,LSep39462,LZer54095,LCon75860,LAve3929],["Add89120","Fla82331","Con84784","Add16627","Res21555","Res67124","Fla30859","Con9980","Sim86197","Add48569","Sub37257","Res75495","Res54724","Zer77470","Con46272","Lea43540","Res28638","Sep42203","Zer35624","Min35283","Res69787","Mul92701","Res95273","Sep39462","Zer54095","Con75860","Ave3929"],Ave3929,"Ave3929")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0987000, 0.0506000, 0.1592000, -0.1938500, 0.1910000, 0.3114500], [0.1881369, 0.0876952, 0.0467941, 0.3605000, 0.1489807, 0.1580791, -0.0947000, 0.5683366, 0.3732714], [0.2535229, 0.0386710, 0.0431108, 0.2217500, 0.1818899, 0.2871029, -0.4391000, 0.2251682, 0.1000465]]]

Expected (Unparsed): [[[0,0,0,0.0987,0.0506,0.1592,-0.1938499999999999,0.191,0.31145],[0.18813690220556,0.08769521377848002,0.04679407129474,0.3605,0.14898067878,0.158079111121,-0.09470000000000003,0.56833662854,0.37327141315299994],[0.253522850162197,0.038671007166036005,0.043110762795037,0.22175,0.181889944,0.2871028908,-0.43909999999999993,0.22516817172,0.100046459854]]]

Actual:   [[[0, 0, 0, 0.0987, 0.0506, 0.1592, -0.1938, 0.191, 0.3115], [0.1882, 0.0877, 0.0468, 0.3605, 0.149, 0.1581, -0.0947, 0.5684, 0.3733], [0.2536, 0.0387, 0.0432, 0.2218, 0.1819, 0.2872, -0.4391, 0.2252, 0.1001]]]

Expected: [[[0, 0, 0, 0.0987, 0.0506, 0.1592, -0.1938, 0.191, 0.3115], [0.1882, 0.0877, 0.0468, 0.3605, 0.149, 0.1581, -0.0947, 0.5684, 0.3733], [0.2536, 0.0387, 0.0432, 0.2218, 0.1819, 0.2872, -0.439, 0.2252, 0.1001]]]