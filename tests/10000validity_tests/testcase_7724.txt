import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add41764 = tf.keras.layers.Input(shape=([1, 1]))
in1Add41764 = tf.keras.layers.Input(shape=([1, 1]))
in0Con36416 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Mul76476 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Mul76476 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Ave95287 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Ave95287 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con78304 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Dot13408 = tf.keras.layers.Input(shape=([2]))
in1Dot13408 = tf.keras.layers.Input(shape=([2]))
in0Con29680 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Sub4520 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Sub4520 = tf.keras.layers.Input(shape=([2, 2, 2]))

Add41764 = keras.layers.Add(name = 'Add41764', )([in0Add41764,in1Add41764])
Res67740 = keras.layers.Reshape((1, 1, 1), name = 'Res67740', )(Add41764)
Con36416 = keras.layers.Concatenate(axis=3, name = 'Con36416', )([Res67740,in0Con36416])
Mul76476 = keras.layers.Multiply(name = 'Mul76476', )([in0Mul76476,in1Mul76476])
Res49907 = keras.layers.Reshape((2, 2, 2), name = 'Res49907', )(Mul76476)
Max38660 = keras.layers.MaxPool2D(pool_size=(2, 2), strides=(11, 2), padding='same', name = 'Max38660', )(Res49907)
Sub46416 = keras.layers.Subtract(name = 'Sub46416', )([Con36416,Max38660])
Res72260 = keras.layers.Reshape((1, 2), name = 'Res72260', )(Sub46416)
Fla77878 = keras.layers.Flatten(name = 'Fla77878', )(Res72260)
Ave95287 = keras.layers.Average(name = 'Ave95287', )([in0Ave95287,in1Ave95287])
Res98812 = keras.layers.Reshape((1, 2), name = 'Res98812', )(Ave95287)
LST18312 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST18312', )(Res98812)
Dot46828 = keras.layers.Dot(axes=(1, 1), name = 'Dot46828', )([Fla77878,LST18312])
Res68083 = keras.layers.Reshape((1, 1), name = 'Res68083', )(Dot46828)
Res99702 = keras.layers.Reshape((1, 1, 1), name = 'Res99702', )(Res68083)
Zer47686 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer47686', )(Res99702)
Con78304 = keras.layers.Concatenate(axis=3, name = 'Con78304', )([Zer47686,in0Con78304])
Dot13408 = keras.layers.Dot(axes=(1, 1), name = 'Dot13408', )([in0Dot13408,in1Dot13408])
Res66866 = keras.layers.Reshape((1, 1), name = 'Res66866', )(Dot13408)
Res90359 = keras.layers.Reshape((1, 1, 1), name = 'Res90359', )(Res66866)
Zer53653 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer53653', )(Res90359)
Con29680 = keras.layers.Concatenate(axis=3, name = 'Con29680', )([Zer53653,in0Con29680])
Sub4520 = keras.layers.Subtract(name = 'Sub4520', )([in0Sub4520,in1Sub4520])
Min95174 = keras.layers.Minimum(name = 'Min95174', )([Con29680,Sub4520])
Lay84744 = keras.layers.LayerNormalization(axis=1, epsilon=2.9437179611453255, name = 'Lay84744', )(Min95174)
Sub31688 = keras.layers.Subtract(name = 'Sub31688', )([Con78304,Lay84744])
model = tf.keras.models.Model(inputs=[in0Add41764,in1Add41764,in0Con36416,in0Mul76476,in1Mul76476,in0Ave95287,in1Ave95287,in0Con78304,in0Dot13408,in1Dot13408,in0Con29680,in0Sub4520,in1Sub4520], outputs=Sub31688)
w = model.get_layer('LST18312').get_weights() 
w[0] = np.array([[3, 6, 8, 1, 9, 4, 9, 10], [1, 3, 4, 1, 10, 6, 10, 7]])
w[1] = np.array([[5, 10, 1, 3, 9, 2, 2, 2], [4, 5, 7, 7, 7, 3, 9, 7]])
w[2] = np.array([2, 2, 3, 1, 7, 10, 4, 6])
model.get_layer('LST18312').set_weights(w) 
in0Add41764 = tf.constant([[[0.5053]]])
in1Add41764 = tf.constant([[[0.2538]]])
in0Con36416 = tf.constant([[[[0.3726]]]])
in0Mul76476 = tf.constant([[[[[0.0733], [0.5575]], [[0.0306], [0.4711]]], [[[0.5484], [0.6434]], [[0.9581], [0.3469]]]]])
in1Mul76476 = tf.constant([[[[[0.1106], [0.6192]], [[0.9306], [0.7675]]], [[[0.7823], [0.7965]], [[0.0227], [0.4459]]]]])
in0Ave95287 = tf.constant([[[[0.0783, 0.417]]]])
in1Ave95287 = tf.constant([[[[0.331, 0.5047]]]])
in0Con78304 = tf.constant([[[[0.5827], [0.1657]], [[0.4615], [0.7276]]]])
in0Dot13408 = tf.constant([[0.2152, 0.1861]])
in1Dot13408 = tf.constant([[0.0387, 0.4918]])
in0Con29680 = tf.constant([[[[0.4379], [0.065]], [[0.0383], [0.9193]]]])
in0Sub4520 = tf.constant([[[[0.8508, 0.9489], [0.048, 0.0568]], [[0.573, 0.1643], [0.41, 0.0612]]]])
in1Sub4520 = tf.constant([[[[0.3833, 0.8922], [0.9429, 0.7259]], [[0.9722, 0.8537], [0.63, 0.5304]]]])
print (np.array2string(model.predict([in0Add41764,in1Add41764,in0Con36416,in0Mul76476,in1Mul76476,in0Ave95287,in1Ave95287,in0Con78304,in0Dot13408,in1Dot13408,in0Con29680,in0Sub4520,in1Sub4520],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub31688.png')

LAdd41764 = add_layer([[[[0.5053]]], [[[0.2538]]]], Add41764), 
LRes67740 = reshape_layer(Add41764, [1, 1, 1], Res67740), 
LCon36416 = concatenate_layer([Res67740,[[[[0.3726]]]]], 3, Con36416), 
LMul76476 = multiply_layer([[[[[[0.0733], [0.5575]], [[0.0306], [0.4711]]], [[[0.5484], [0.6434]], [[0.9581], [0.3469]]]]], [[[[[0.1106], [0.6192]], [[0.9306], [0.7675]]], [[[0.7823], [0.7965]], [[0.0227], [0.4459]]]]]], Mul76476), 
LRes49907 = reshape_layer(Mul76476, [2, 2, 2], Res49907), 
LMax38660 = max_pool2D_layer(Res49907, 2, 2, 11, 2, true, Max38660), 
LSub46416 = subtract_layer(Con36416,Max38660, Sub46416), 
LRes72260 = reshape_layer(Sub46416, [1, 2], Res72260), 
LFla77878 = flatten_layer(Res72260, Fla77878), 
LAve95287 = average_layer([[[[[0.0783, 0.417]]]], [[[[0.331, 0.5047]]]]], Ave95287), 
LRes98812 = reshape_layer(Ave95287, [1, 2], Res98812), 
LLST18312 = lstm_layer(Res98812,[[3, 6, 8, 1, 9, 4, 9, 10], [1, 3, 4, 1, 10, 6, 10, 7]],[[5, 10, 1, 3, 9, 2, 2, 2], [4, 5, 7, 7, 7, 3, 9, 7]],[2, 2, 3, 1, 7, 10, 4, 6], LST18312), 
LDot46828 = dot_layer(Fla77878,LST18312, 1, 1, Dot46828), 
LRes68083 = reshape_layer(Dot46828, [1, 1], Res68083), 
LRes99702 = reshape_layer(Res68083, [1, 1, 1], Res99702), 
LZer47686 = zero_padding2D_layer(Res99702, 1, 0, 1, 0, Zer47686), 
LCon78304 = concatenate_layer([Zer47686,[[[[0.5827], [0.1657]], [[0.4615], [0.7276]]]]], 3, Con78304), 
LDot13408 = dot_layer([[0.2152, 0.1861]], [[0.0387, 0.4918]], 1, 1, Dot13408), 
LRes66866 = reshape_layer(Dot13408, [1, 1], Res66866), 
LRes90359 = reshape_layer(Res66866, [1, 1, 1], Res90359), 
LZer53653 = zero_padding2D_layer(Res90359, 1, 0, 1, 0, Zer53653), 
LCon29680 = concatenate_layer([Zer53653,[[[[0.4379], [0.065]], [[0.0383], [0.9193]]]]], 3, Con29680), 
LSub4520 = subtract_layer([[[[0.8508, 0.9489], [0.048, 0.0568]], [[0.573, 0.1643], [0.41, 0.0612]]]], [[[[0.3833, 0.8922], [0.9429, 0.7259]], [[0.9722, 0.8537], [0.63, 0.5304]]]], Sub4520), 
LMin95174 = minimum_layer([Con29680,Sub4520], Min95174), 
LLay84744 = layer_normalization_layer(Min95174, 1, 2.9437179611453255, Lay84744), 
LSub31688 = subtract_layer(Con78304,Lay84744, Sub31688), 
exec_layers([LAdd41764,LRes67740,LCon36416,LMul76476,LRes49907,LMax38660,LSub46416,LRes72260,LFla77878,LAve95287,LRes98812,LLST18312,LDot46828,LRes68083,LRes99702,LZer47686,LCon78304,LDot13408,LRes66866,LRes90359,LZer53653,LCon29680,LSub4520,LMin95174,LLay84744,LSub31688],["Add41764","Res67740","Con36416","Mul76476","Res49907","Max38660","Sub46416","Res72260","Fla77878","Ave95287","Res98812","LST18312","Dot46828","Res68083","Res99702","Zer47686","Con78304","Dot13408","Res66866","Res90359","Zer53653","Con29680","Sub4520","Min95174","Lay84744","Sub31688"],Sub31688,"Sub31688")

Actual (Unparsed): [[[[-0.1155562, 0.3702345], [0.1929833, 0.2238566]], [[0.1155562, 0.6739655], [-0.0538672, 0.6694434]]]]

Expected (Unparsed): [[[[-0.11555620899554149,0.37023449306046763],[0.19298332059657383,0.22385660173910393]],[[0.11555620899554149,0.6739655069395324],[-0.05386721578297812,0.669443398260896]]]]

Actual:   [[[[-0.1155, 0.3703], [0.193, 0.2239]], [[0.1156, 0.674], [-0.0538, 0.6695]]]]

Expected: [[[[-0.1155, 0.3703], [0.193, 0.2239]], [[0.1156, 0.674], [-0.0538, 0.6695]]]]