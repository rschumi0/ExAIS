import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave80108 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Ave80108 = tf.keras.layers.Input(shape=([2, 1, 2]))

Ave80108 = keras.layers.Average(name = 'Ave80108', )([in0Ave80108,in1Ave80108])
Dep45754 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='same', name = 'Dep45754', )(Ave80108)
Cro37580 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro37580', )(Dep45754)
Res47813 = keras.layers.Reshape((2, 2), name = 'Res47813', )(Cro37580)
LST74816 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST74816', )(Res47813)
Res12836 = keras.layers.Reshape((1, 1), name = 'Res12836', )(LST74816)
Res75567 = keras.layers.Reshape((1, 1, 1), name = 'Res75567', )(Res12836)
Con50638 = keras.layers.Conv2D(2, (1, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con50638', )(Res75567)
model = tf.keras.models.Model(inputs=[in0Ave80108,in1Ave80108], outputs=Con50638)
w = model.get_layer('Dep45754').get_weights() 
w[0] = np.array([[[[0.0504], [0.6197]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep45754').set_weights(w) 
w = model.get_layer('LST74816').get_weights() 
w[0] = np.array([[3, 2, 2, 3], [2, 9, 4, 5]])
w[1] = np.array([[7, 10, 10, 2]])
w[2] = np.array([1, 2, 6, 3])
model.get_layer('LST74816').set_weights(w) 
w = model.get_layer('Con50638').get_weights() 
w[0] = np.array([[[[0.784, 0.2667]]]])
w[1] = np.array([0, 0])
model.get_layer('Con50638').set_weights(w) 
in0Ave80108 = tf.constant([[[[0.3239, 0.7036]], [[0.2884, 0.1451]]]])
in1Ave80108 = tf.constant([[[[0.3703, 0.6833]], [[0.1928, 0.6702]]]])
print (np.array2string(model.predict([in0Ave80108,in1Ave80108],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con50638.png')

LAve80108 = average_layer([[[[[0.3239, 0.7036]], [[0.2884, 0.1451]]]], [[[[0.3703, 0.6833]], [[0.1928, 0.6702]]]]], Ave80108), 
LDep45754 = depthwise_conv2D_layer(Ave80108, 1, 1,[[[[0.0504], [0.6197]]]],[0, 0], 1, 1, true, Dep45754), 
LCro37580 = cropping2D_layer(Dep45754, 0, 0, 0, 0, Cro37580), 
LRes47813 = reshape_layer(Cro37580, [2, 2], Res47813), 
LLST74816 = lstm_layer(Res47813,[[3, 2, 2, 3], [2, 9, 4, 5]],[[7, 10, 10, 2]],[1, 2, 6, 3], LST74816), 
LRes12836 = reshape_layer(LST74816, [1, 1], Res12836), 
LRes75567 = reshape_layer(Res12836, [1, 1, 1], Res75567), 
LCon50638 = conv2D_layer(Res75567, 1, 1,[[[[0.784, 0.2667]]]],[0, 0], 1, 1, false, 1, 1, Con50638), 
exec_layers([LAve80108,LDep45754,LCro37580,LRes47813,LLST74816,LRes12836,LRes75567,LCon50638],["Ave80108","Dep45754","Cro37580","Res47813","LST74816","Res12836","Res75567","Con50638"],Con50638,"Con50638")

Actual (Unparsed): [[[[0.7450868, 0.2534626]]]]

Expected (Unparsed): [[[[0.745086805416016,0.2534625650566983]]]]

Actual:   [[[[0.7451, 0.2535]]]]

Expected: [[[[0.7451, 0.2535]]]]