import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave75178 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave75178 = tf.keras.layers.Input(shape=([2, 2]))
in0Con12707 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Cro68560 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con75007 = tf.keras.layers.Input(shape=([1]))
in0Sub78299 = tf.keras.layers.Input(shape=([2]))
in1Sub78299 = tf.keras.layers.Input(shape=([2]))
in0Con63893 = tf.keras.layers.Input(shape=([3, 1, 5, 1]))
in0Sim33538 = tf.keras.layers.Input(shape=([3, 1]))
in0Con57845 = tf.keras.layers.Input(shape=([3, 1, 1, 1]))
in0Ave87014 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Ave87014 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))

Ave75178 = keras.layers.Average(name = 'Ave75178', )([in0Ave75178,in1Ave75178])
Zer86916 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer86916', )(Ave75178)
Res35534 = keras.layers.Reshape((4, 2, 1), name = 'Res35534', )(Zer86916)
Dep4305 = keras.layers.DepthwiseConv2D((1, 1),strides=(3, 3), padding='same', name = 'Dep4305', )(Res35534)
Con12707 = keras.layers.Concatenate(axis=3, name = 'Con12707', )([Dep4305,in0Con12707])
Cro68560 = keras.layers.Cropping2D(cropping=((1, 0), (0, 0)), name = 'Cro68560', )(in0Cro68560)
Res26675 = keras.layers.Reshape((1, 1), name = 'Res26675', )(Cro68560)
Fla25591 = keras.layers.Flatten(name = 'Fla25591', )(Res26675)
Con75007 = keras.layers.Concatenate(axis=1, name = 'Con75007', )([Fla25591,in0Con75007])
Sub78299 = keras.layers.Subtract(name = 'Sub78299', )([in0Sub78299,in1Sub78299])
Max52530 = keras.layers.Maximum(name = 'Max52530', )([Con75007,Sub78299])
Res9025 = keras.layers.Reshape((2, 1), name = 'Res9025', )(Max52530)
Res71865 = keras.layers.Reshape((2, 1, 1), name = 'Res71865', )(Res9025)
Con19333 = keras.layers.Conv2DTranspose(3, (1, 1),strides=(1, 1), padding='same', name = 'Con19333', )(Res71865)
Sub40825 = keras.layers.Subtract(name = 'Sub40825', )([Con12707,Con19333])
Res43470 = keras.layers.Reshape((2, 1, 3, 1), name = 'Res43470', )(Sub40825)
Zer46485 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (2, 0)), name = 'Zer46485', )(Res43470)
Con63893 = keras.layers.Concatenate(axis=4, name = 'Con63893', )([Zer46485,in0Con63893])
Sim33538 = keras.layers.SimpleRNN(3,name = 'Sim33538', )(in0Sim33538)
Res2120 = keras.layers.Reshape((3, 1), name = 'Res2120', )(Sim33538)
Res3507 = keras.layers.Reshape((3, 1, 1), name = 'Res3507', )(Res2120)
Res18709 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res18709', )(Res3507)
Con57845 = keras.layers.Concatenate(axis=4, name = 'Con57845', )([Res18709,in0Con57845])
Ave87014 = keras.layers.Average(name = 'Ave87014', )([in0Ave87014,in1Ave87014])
Zer83327 = keras.layers.ZeroPadding3D(padding=((2, 0), (0, 0), (0, 0)), name = 'Zer83327', )(Ave87014)
Min2390 = keras.layers.Minimum(name = 'Min2390', )([Con57845,Zer83327])
Zer63248 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (4, 0)), name = 'Zer63248', )(Min2390)
Mul41697 = keras.layers.Multiply(name = 'Mul41697', )([Con63893,Zer63248])
model = tf.keras.models.Model(inputs=[in0Ave75178,in1Ave75178,in0Con12707,in0Cro68560,in0Con75007,in0Sub78299,in1Sub78299,in0Con63893,in0Sim33538,in0Con57845,in0Ave87014,in1Ave87014], outputs=Mul41697)
w = model.get_layer('Dep4305').get_weights() 
w[0] = np.array([[[[0.5847]]]])
w[1] = np.array([0])
model.get_layer('Dep4305').set_weights(w) 
w = model.get_layer('Con19333').get_weights() 
w[0] = np.array([[[[0.2512], [0.2408], [0.1347]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con19333').set_weights(w) 
w = model.get_layer('Sim33538').get_weights() 
w[0] = np.array([[4, 8, 1]])
w[1] = np.array([[7, 1, 3], [10, 5, 5], [9, 10, 3]])
w[2] = np.array([2, 10, 4])
model.get_layer('Sim33538').set_weights(w) 
in0Ave75178 = tf.constant([[[0.2077, 0.1635], [0.8987, 0.2285]]])
in1Ave75178 = tf.constant([[[0.9028, 0.8203], [0.0813, 0.6462]]])
in0Con12707 = tf.constant([[[[0.793, 0.0081]], [[0.0483, 0.388]]]])
in0Cro68560 = tf.constant([[[[1.1304]], [[1.3774]]]])
in0Con75007 = tf.constant([[0.0856]])
in0Sub78299 = tf.constant([[0.993, 0.0725]])
in1Sub78299 = tf.constant([[0.5144, 0.443]])
in0Con63893 = tf.constant([[[[[0.6487], [0.2113], [0.9964], [0.5556], [0.4531]]], [[[0.7743], [0.9404], [0.111], [0.3347], [0.5789]]], [[[0.916], [0.1983], [0.2881], [0.5774], [0.3999]]]]])
in0Sim33538 = tf.constant([[[6], [9], [1]]])
in0Con57845 = tf.constant([[[[[0.6918]]], [[[0.0944]]], [[[0.8834]]]]])
in0Ave87014 = tf.constant([[[[[0.2152, 0.2484]]]]])
in1Ave87014 = tf.constant([[[[[0.8227, 0.1584]]]]])
print (np.array2string(model.predict([in0Ave75178,in1Ave75178,in0Con12707,in0Cro68560,in0Con75007,in0Sub78299,in1Sub78299,in0Con63893,in0Sim33538,in0Con57845,in0Ave87014,in1Ave87014],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul41697.png')

LAve75178 = average_layer([[[[0.2077, 0.1635], [0.8987, 0.2285]]], [[[0.9028, 0.8203], [0.0813, 0.6462]]]], Ave75178), 
LZer86916 = zero_padding1D_layer(Ave75178, 1, 1, Zer86916), 
LRes35534 = reshape_layer(Zer86916, [4, 2, 1], Res35534), 
LDep4305 = depthwise_conv2D_layer(Res35534, 1, 1,[[[[0.5847]]]],[0], 3, 3, true, Dep4305), 
LCon12707 = concatenate_layer([Dep4305,[[[[0.793, 0.0081]], [[0.0483, 0.388]]]]], 3, Con12707), 
LCro68560 = cropping2D_layer([[[[1.1304]], [[1.3774]]]], 1, 0, 0, 0, Cro68560), 
LRes26675 = reshape_layer(Cro68560, [1, 1], Res26675), 
LFla25591 = flatten_layer(Res26675, Fla25591), 
LCon75007 = concatenate_layer([Fla25591,[[0.0856]]], 1, Con75007), 
LSub78299 = subtract_layer([[0.993, 0.0725]], [[0.5144, 0.443]], Sub78299), 
LMax52530 = maximum_layer([Con75007,Sub78299], Max52530), 
LRes9025 = reshape_layer(Max52530, [2, 1], Res9025), 
LRes71865 = reshape_layer(Res9025, [2, 1, 1], Res71865), 
LCon19333 = conv2D_transpose_layer(Res71865, 1, 1,[[[[0.2512], [0.2408], [0.1347]]]],[0, 0, 0], 1, 1, true, Con19333), 
LSub40825 = subtract_layer(Con12707,Con19333, Sub40825), 
LRes43470 = reshape_layer(Sub40825, [2, 1, 3, 1], Res43470), 
LZer46485 = zero_padding3D_layer(Res43470, 1, 0, 0, 0, 2, 0, Zer46485), 
LCon63893 = concatenate_layer([Zer46485,[[[[[0.6487], [0.2113], [0.9964], [0.5556], [0.4531]]], [[[0.7743], [0.9404], [0.111], [0.3347], [0.5789]]], [[[0.916], [0.1983], [0.2881], [0.5774], [0.3999]]]]]], 4, Con63893), 
LSim33538 = simple_rnn_layer([[[6], [9], [1]]],[[4, 8, 1]],[[7, 1, 3], [10, 5, 5], [9, 10, 3]],[2, 10, 4], Sim33538), 
LRes2120 = reshape_layer(Sim33538, [3, 1], Res2120), 
LRes3507 = reshape_layer(Res2120, [3, 1, 1], Res3507), 
LRes18709 = reshape_layer(Res3507, [3, 1, 1, 1], Res18709), 
LCon57845 = concatenate_layer([Res18709,[[[[[0.6918]]], [[[0.0944]]], [[[0.8834]]]]]], 4, Con57845), 
LAve87014 = average_layer([[[[[[0.2152, 0.2484]]]]], [[[[[0.8227, 0.1584]]]]]], Ave87014), 
LZer83327 = zero_padding3D_layer(Ave87014, 2, 0, 0, 0, 0, 0, Zer83327), 
LMin2390 = minimum_layer([Con57845,Zer83327], Min2390), 
LZer63248 = zero_padding3D_layer(Min2390, 0, 0, 0, 0, 4, 0, Zer63248), 
LMul41697 = multiply_layer([Con63893,Zer63248], Mul41697), 
exec_layers([LAve75178,LZer86916,LRes35534,LDep4305,LCon12707,LCro68560,LRes26675,LFla25591,LCon75007,LSub78299,LMax52530,LRes9025,LRes71865,LCon19333,LSub40825,LRes43470,LZer46485,LCon63893,LSim33538,LRes2120,LRes3507,LRes18709,LCon57845,LAve87014,LZer83327,LMin2390,LZer63248,LMul41697],["Ave75178","Zer86916","Res35534","Dep4305","Con12707","Cro68560","Res26675","Fla25591","Con75007","Sub78299","Max52530","Res9025","Res71865","Con19333","Sub40825","Res43470","Zer46485","Con63893","Sim33538","Res2120","Res3507","Res18709","Con57845","Ave87014","Zer83327","Min2390","Zer63248","Mul41697"],Mul41697,"Mul41697")

Actual (Unparsed): [[[[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [-0.0000000, 0.0000000], [0.0000000, 0.0000000], [-0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [-0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.1953690, 0.0813397]]]]]

Expected (Unparsed): [[[[[0,0.0],[0,0.0],[0,0.0],[0,0.0],[0,0.0]]],[[[0,0.0],[0,0.0],[-0.0,0.0],[0.0,0.0],[-0.0,0.0]]],[[[0,0.0],[0,0.0],[-0.0,0.0],[0.0,0.0],[0.19536894043600003,0.08133966000000001]]]]]

Actual:   [[[[[0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]], [[[0, 0], [0, 0], [-0, 0], [0, 0], [-0, 0]]], [[[0, 0], [0, 0], [-0, 0], [0, 0], [0.1954, 0.0814]]]]]

Expected: [[[[[0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]], [[[0, 0], [0, 0], [-0, 0], [0, 0], [-0, 0]]], [[[0, 0], [0, 0], [-0, 0], [0, 0], [0.1954, 0.0814]]]]]