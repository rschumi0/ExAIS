import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST95961 = tf.keras.layers.Input(shape=([3, 1]))

LST95961 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST95961', )(in0LST95961)
Res37959 = keras.layers.Reshape((1, 1), name = 'Res37959', )(LST95961)
Loc4459 = keras.layers.LocallyConnected1D(4, (1),strides=(9), name = 'Loc4459', )(Res37959)
Loc82366 = keras.layers.LocallyConnected1D(2, (1),strides=(1), name = 'Loc82366', )(Loc4459)
model = tf.keras.models.Model(inputs=[in0LST95961], outputs=Loc82366)
w = model.get_layer('LST95961').get_weights() 
w[0] = np.array([[6, 5, 5, 8]])
w[1] = np.array([[4, 4, 4, 1]])
w[2] = np.array([5, 9, 1, 6])
model.get_layer('LST95961').set_weights(w) 
w = model.get_layer('Loc4459').get_weights() 
w[0] = np.array([[[0.6901, 0.6014, 0.2225, 0.6987]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc4459').set_weights(w) 
w = model.get_layer('Loc82366').get_weights() 
w[0] = np.array([[[0.8193, 0.7061], [0.1828, 0.8246], [0.0269, 0.5183], [0.1743, 0.7597]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc82366').set_weights(w) 
in0LST95961 = tf.constant([[[3], [3], [6]]])
print (np.array2string(model.predict([in0LST95961],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc82366.png')

LLST95961 = lstm_layer([[[3], [3], [6]]],[[6, 5, 5, 8]],[[4, 4, 4, 1]],[5, 9, 1, 6], LST95961), 
LRes37959 = reshape_layer(LST95961, [1, 1], Res37959), 
LLoc4459 = locally_connected1D_layer(Res37959, 1,[[[0.6901, 0.6014, 0.2225, 0.6987]]],[[0, 0, 0, 0]], 9, Loc4459), 
LLoc82366 = locally_connected1D_layer(Loc4459, 1,[[[0.8193, 0.7061], [0.1828, 0.8246], [0.0269, 0.5183], [0.1743, 0.7597]]],[[0, 0]], 1, Loc82366), 
exec_layers([LLST95961,LRes37959,LLoc4459,LLoc82366],["LST95961","Res37959","Loc4459","Loc82366"],Loc82366,"Loc82366")

Actual (Unparsed): [[[0.7991320, 1.6212608]]]

Expected (Unparsed): [[[0.7991319653271325,1.6212608102260022]]]

Actual:   [[[0.7992, 1.6213]]]

Expected: [[[0.7992, 1.6213]]]