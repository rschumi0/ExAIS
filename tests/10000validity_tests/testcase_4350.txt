import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul75959 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Mul75959 = tf.keras.layers.Input(shape=([2, 1, 2]))

Mul75959 = keras.layers.Multiply(name = 'Mul75959', )([in0Mul75959,in1Mul75959])
Res29095 = keras.layers.Reshape((2, 1, 2, 1), name = 'Res29095', )(Mul75959)
Glo65150 = keras.layers.GlobalMaxPool3D(name = 'Glo65150', )(Res29095)
Res10710 = keras.layers.Reshape((1, 1), name = 'Res10710', )(Glo65150)
GRU53018 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU53018', )(Res10710)
ReL40085 = keras.layers.ReLU(max_value=5.326278913537838, negative_slope=6.428851900407598, threshold=1.4916625878100387, name = 'ReL40085', )(GRU53018)
Res30000 = keras.layers.Reshape((1, 1), name = 'Res30000', )(ReL40085)
Max84773 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='same', name = 'Max84773', )(Res30000)
model = tf.keras.models.Model(inputs=[in0Mul75959,in1Mul75959], outputs=Max84773)
w = model.get_layer('GRU53018').get_weights() 
w[0] = np.array([[3, 8, 8]])
w[1] = np.array([[4, 10, 5]])
w[2] = np.array([[9, 8, 1], [5, 6, 9]])
model.get_layer('GRU53018').set_weights(w) 
in0Mul75959 = tf.constant([[[[0.274, 0.204]], [[0.9493, 0.4835]]]])
in1Mul75959 = tf.constant([[[[0.6118, 0.2979]], [[0.9543, 0.5349]]]])
print (np.array2string(model.predict([in0Mul75959,in1Mul75959],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max84773.png')

LMul75959 = multiply_layer([[[[[0.274, 0.204]], [[0.9493, 0.4835]]]], [[[[0.6118, 0.2979]], [[0.9543, 0.5349]]]]], Mul75959), 
LRes29095 = reshape_layer(Mul75959, [2, 1, 2, 1], Res29095), 
LGlo65150 = global_max_pool3D_layer(Res29095, Glo65150), 
LRes10710 = reshape_layer(Glo65150, [1, 1], Res10710), 
LGRU53018 = gru_layer(Res10710,[[3, 8, 8]],[[4, 10, 5]],[[9, 8, 1], [5, 6, 9]], true, GRU53018), 
LReL40085 = relu_layer(GRU53018, 5.326278913537838, 6.428851900407598, 1.4916625878100387, ReL40085), 
LRes30000 = reshape_layer(ReL40085, [1, 1], Res30000), 
LMax84773 = max_pool1D_layer(Res30000, 1, 1, true, Max84773), 
exec_layers([LMul75959,LRes29095,LGlo65150,LRes10710,LGRU53018,LReL40085,LRes30000,LMax84773],["Mul75959","Res29095","Glo65150","Res10710","GRU53018","ReL40085","Res30000","Max84773"],Max84773,"Max84773")

Actual (Unparsed): [[[-9.5896775]]]

Expected (Unparsed): [[[-9.589677509464996]]]

Actual:   [[[-9.5896]]]

Expected: [[[-9.5896]]]