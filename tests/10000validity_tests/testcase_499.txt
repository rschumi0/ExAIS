import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Fla82608 = tf.keras.layers.Input(shape=([1, 1, 3]))
in0Con17050 = tf.keras.layers.Input(shape=([3, 7]))
in0Sub7085 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Sub7085 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Max49648 = tf.keras.layers.Input(shape=([1, 1]))
in1Max49648 = tf.keras.layers.Input(shape=([1, 1]))
in0Con21607 = tf.keras.layers.Input(shape=([2, 3]))

Fla82608 = keras.layers.Flatten(name = 'Fla82608', )(in0Fla82608)
Res96671 = keras.layers.Reshape((3, 1), name = 'Res96671', )(Fla82608)
Con17050 = keras.layers.Concatenate(axis=2, name = 'Con17050', )([Res96671,in0Con17050])
Sub7085 = keras.layers.Subtract(name = 'Sub7085', )([in0Sub7085,in1Sub7085])
Bat29288 = keras.layers.BatchNormalization(axis=2, epsilon=0.7653682676753417,  name = 'Bat29288', )(Sub7085)
Res551 = keras.layers.Reshape((2, 4), name = 'Res551', )(Bat29288)
Max49648 = keras.layers.Maximum(name = 'Max49648', )([in0Max49648,in1Max49648])
Zer34465 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer34465', )(Max49648)
Con21607 = keras.layers.Concatenate(axis=2, name = 'Con21607', )([Zer34465,in0Con21607])
Max17565 = keras.layers.Maximum(name = 'Max17565', )([Res551,Con21607])
Res6060 = keras.layers.Reshape((2, 4, 1), name = 'Res6060', )(Max17565)
Con72296 = keras.layers.Conv2DTranspose(2, (1, 1),strides=(1, 1), padding='valid', name = 'Con72296', )(Res6060)
Res91971 = keras.layers.Reshape((2, 8), name = 'Res91971', )(Con72296)
Dot83346 = keras.layers.Dot(axes=(2, 2), name = 'Dot83346', )([Con17050,Res91971])
model = tf.keras.models.Model(inputs=[in0Fla82608,in0Con17050,in0Sub7085,in1Sub7085,in0Max49648,in1Max49648,in0Con21607], outputs=Dot83346)
w = model.get_layer('Bat29288').get_weights() 
w[0] = np.array([0.5836, 0.5312])
w[1] = np.array([0.9495, 0.7991])
w[2] = np.array([0.3945, 0.3744])
w[3] = np.array([0.2305, 0.9707])
model.get_layer('Bat29288').set_weights(w) 
w = model.get_layer('Con72296').get_weights() 
w[0] = np.array([[[[0.7934], [0.3822]]]])
w[1] = np.array([0, 0])
model.get_layer('Con72296').set_weights(w) 
in0Fla82608 = tf.constant([[[[1.5895, 1.2486, 1.4481]]]])
in0Con17050 = tf.constant([[[0.3026, 0.7776, 0.633, 0.3495, 0.4094, 0.4504, 0.0019], [0.28, 0.079, 0.4774, 0.5083, 0.8627, 0.4257, 0.2918], [0.5995, 0.8979, 0.0767, 0.8901, 0.4168, 0.6834, 0.9893]]])
in0Sub7085 = tf.constant([[[[0.6157, 0.4894], [0.3701, 0.8448]], [[0.8067, 0.6558], [0.162, 0.3209]]]])
in1Sub7085 = tf.constant([[[[0.7667, 0.2484], [0.2717, 0.5211]], [[0.1697, 0.921], [0.9678, 0.6017]]]])
in0Max49648 = tf.constant([[[0.7611]]])
in1Max49648 = tf.constant([[[0.4759]]])
in0Con21607 = tf.constant([[[0.853, 0.9621, 0.7981], [0.3245, 0.7291, 0.9664]]])
print (np.array2string(model.predict([in0Fla82608,in0Con17050,in0Sub7085,in1Sub7085,in0Max49648,in1Max49648,in0Con21607],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot83346.png')

LFla82608 = flatten_layer([[[[1.5895, 1.2486, 1.4481]]]], Fla82608), 
LRes96671 = reshape_layer(Fla82608, [3, 1], Res96671), 
LCon17050 = concatenate_layer([Res96671,[[[0.3026, 0.7776, 0.633, 0.3495, 0.4094, 0.4504, 0.0019], [0.28, 0.079, 0.4774, 0.5083, 0.8627, 0.4257, 0.2918], [0.5995, 0.8979, 0.0767, 0.8901, 0.4168, 0.6834, 0.9893]]]], 2, Con17050), 
LSub7085 = subtract_layer([[[[0.6157, 0.4894], [0.3701, 0.8448]], [[0.8067, 0.6558], [0.162, 0.3209]]]], [[[[0.7667, 0.2484], [0.2717, 0.5211]], [[0.1697, 0.921], [0.9678, 0.6017]]]], Sub7085), 
LBat29288 = batch_normalization_layer(Sub7085, 2, 0.7653682676753417, [0.5836, 0.5312], [0.9495, 0.7991], [0.3945, 0.3744], [0.2305, 0.9707], Bat29288), 
LRes551 = reshape_layer(Bat29288, [2, 4], Res551), 
LMax49648 = maximum_layer([[[[0.7611]]], [[[0.4759]]]], Max49648), 
LZer34465 = zero_padding1D_layer(Max49648, 1, 0, Zer34465), 
LCon21607 = concatenate_layer([Zer34465,[[[0.853, 0.9621, 0.7981], [0.3245, 0.7291, 0.9664]]]], 2, Con21607), 
LMax17565 = maximum_layer([Res551,Con21607], Max17565), 
LRes6060 = reshape_layer(Max17565, [2, 4, 1], Res6060), 
LCon72296 = conv2D_transpose_layer(Res6060, 1, 1,[[[[0.7934], [0.3822]]]],[0, 0], 1, 1, false, Con72296), 
LRes91971 = reshape_layer(Con72296, [2, 8], Res91971), 
LDot83346 = dot_layer(Con17050,Res91971, 2, 2, Dot83346), 
exec_layers([LFla82608,LRes96671,LCon17050,LSub7085,LBat29288,LRes551,LMax49648,LZer34465,LCon21607,LMax17565,LRes6060,LCon72296,LRes91971,LDot83346],["Fla82608","Res96671","Con17050","Sub7085","Bat29288","Res551","Max49648","Zer34465","Con21607","Max17565","Res6060","Con72296","Res91971","Dot83346"],Dot83346,"Dot83346")

Actual (Unparsed): [[[2.3095420, 2.6489369], [1.9666078, 2.3046929], [3.0737242, 3.4424299]]]

Expected (Unparsed): [[[2.3095420013331522,2.648936912530926],[1.9666077467171275,2.3046928827560467],[3.073724258188115,3.442429939575554]]]

Actual:   [[[2.3096, 2.649], [1.9667, 2.3047], [3.0738, 3.4425]]]

Expected: [[[2.3096, 2.649], [1.9667, 2.3047], [3.0738, 3.4425]]]