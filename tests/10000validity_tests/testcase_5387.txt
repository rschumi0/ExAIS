import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sep55493 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con68937 = tf.keras.layers.Input(shape=([2, 2]))
in0Add82006 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Add82006 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Sub23637 = tf.keras.layers.Input(shape=([3]))
in1Sub23637 = tf.keras.layers.Input(shape=([3]))
in0Con7109 = tf.keras.layers.Input(shape=([29]))

Sep55493 = keras.layers.SeparableConv2D(3, (2, 2),strides=(1, 1), padding='same', name = 'Sep55493', )(in0Sep55493)
Res80958 = keras.layers.Reshape((2, 6), name = 'Res80958', )(Sep55493)
Con68937 = keras.layers.Concatenate(axis=2, name = 'Con68937', )([Res80958,in0Con68937])
Add82006 = keras.layers.Add(name = 'Add82006', )([in0Add82006,in1Add82006])
Res45356 = keras.layers.Reshape((2, 2, 2), name = 'Res45356', )(Add82006)
Res32187 = keras.layers.Reshape((2, 4), name = 'Res32187', )(Res45356)
Dot82529 = keras.layers.Dot(axes=(1, 1), name = 'Dot82529', )([Con68937,Res32187])
Fla98779 = keras.layers.Flatten(name = 'Fla98779', )(Dot82529)
Sub23637 = keras.layers.Subtract(name = 'Sub23637', )([in0Sub23637,in1Sub23637])
Con7109 = keras.layers.Concatenate(axis=1, name = 'Con7109', )([Sub23637,in0Con7109])
Ave10135 = keras.layers.Average(name = 'Ave10135', )([Fla98779,Con7109])
model = tf.keras.models.Model(inputs=[in0Sep55493,in0Con68937,in0Add82006,in1Add82006,in0Sub23637,in1Sub23637,in0Con7109], outputs=Ave10135)
w = model.get_layer('Sep55493').get_weights() 
w[0] = np.array([[[[0.1897]], [[0.8581]]], [[[0.6764]], [[0.3567]]]])
w[1] = np.array([[[[0.4932, 0.0317, 0.6973]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep55493').set_weights(w) 
in0Sep55493 = tf.constant([[[[0.0095], [0.2869]], [[0.5025], [0.4719]]]])
in0Con68937 = tf.constant([[[0.1419, 0.5962], [0.9352, 0.2554]]])
in0Add82006 = tf.constant([[[[[0.2442, 0.9176]], [[0.2272, 0.4927]]], [[[0.4409, 0.7049]], [[0.8635, 0.2879]]]]])
in1Add82006 = tf.constant([[[[[0.848, 0.2649]], [[0.8399, 0.8287]]], [[[0.5141, 0.5488]], [[0.2334, 0.9723]]]]])
in0Sub23637 = tf.constant([[0.7367, 0.2086, 0.8277]])
in1Sub23637 = tf.constant([[0.8944, 0.6092, 0.3776]])
in0Con7109 = tf.constant([[0.5346, 0.8424, 0.5932, 0.8277, 0.9007, 0.273, 0.3028, 0.6546, 0.0202, 0.2572, 0.857, 0.9188, 0.4363, 0.7854, 0.7579, 0.2618, 0.9089, 0.3707, 0.212, 0.4878, 0.5028, 0.4336, 0.1591, 0.8281, 0.2849, 0.5195, 0.4283, 0.4717, 0.9948]])
print (np.array2string(model.predict([in0Sep55493,in0Con68937,in0Add82006,in1Add82006,in0Sub23637,in1Sub23637,in0Con7109],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave10135.png')

LSep55493 = separable_conv2D_layer([[[[0.0095], [0.2869]], [[0.5025], [0.4719]]]], 2, 2,[[[[[0.1897]], [[0.8581]]], [[[0.6764]], [[0.3567]]]],[[[[0.4932, 0.0317, 0.6973]]]]],[0, 0, 0], 1, 1, true, Sep55493), 
LRes80958 = reshape_layer(Sep55493, [2, 6], Res80958), 
LCon68937 = concatenate_layer([Res80958,[[[0.1419, 0.5962], [0.9352, 0.2554]]]], 2, Con68937), 
LAdd82006 = add_layer([[[[[[0.2442, 0.9176]], [[0.2272, 0.4927]]], [[[0.4409, 0.7049]], [[0.8635, 0.2879]]]]], [[[[[0.848, 0.2649]], [[0.8399, 0.8287]]], [[[0.5141, 0.5488]], [[0.2334, 0.9723]]]]]], Add82006), 
LRes45356 = reshape_layer(Add82006, [2, 2, 2], Res45356), 
LRes32187 = reshape_layer(Res45356, [2, 4], Res32187), 
LDot82529 = dot_layer(Con68937,Res32187, 1, 1, Dot82529), 
LFla98779 = flatten_layer(Dot82529, Fla98779), 
LSub23637 = subtract_layer([[0.7367, 0.2086, 0.8277]], [[0.8944, 0.6092, 0.3776]], Sub23637), 
LCon7109 = concatenate_layer([Sub23637,[[0.5346, 0.8424, 0.5932, 0.8277, 0.9007, 0.273, 0.3028, 0.6546, 0.0202, 0.2572, 0.857, 0.9188, 0.4363, 0.7854, 0.7579, 0.2618, 0.9089, 0.3707, 0.212, 0.4878, 0.5028, 0.4336, 0.1591, 0.8281, 0.2849, 0.5195, 0.4283, 0.4717, 0.9948]]], 1, Con7109), 
LAve10135 = average_layer([Fla98779,Con7109], Ave10135), 
exec_layers([LSep55493,LRes80958,LCon68937,LAdd82006,LRes45356,LRes32187,LDot82529,LFla98779,LSub23637,LCon7109,LAve10135],["Sep55493","Res80958","Con68937","Add82006","Res45356","Res32187","Dot82529","Fla98779","Sub23637","Con7109","Ave10135"],Ave10135,"Ave10135")

Actual (Unparsed): [[0.2426378, 0.1748760, 0.5593625, 0.6691801, 0.4418634, 0.3207141, 0.4353377, 0.4761805, 0.5910284, 0.6818343, 0.7999604, 0.5782893, 0.2503111, 0.5651248, 0.5819310, 0.3677157, 0.4005229, 0.3877314, 0.1387756, 0.4640632, 0.3574286, 0.2991639, 0.4171378, 0.4628602, 0.7408496, 0.7496785, 1.0026712, 0.8254728, 0.7072883, 0.7267507, 0.6940266, 1.0522369]]

Expected (Unparsed): [[0.2426377555102004,0.17487597952703376,0.5593625057830477,0.6691800712943196,0.4418633451939849,0.320714108984199,0.43533764483642057,0.4761804912003851,0.5910284102134282,0.6818343279079495,0.7999604020326829,0.5782893222091019,0.25031109049293676,0.5651247599412256,0.5819310337810395,0.3677156939316392,0.40052287422673577,0.3877314373279336,0.1387755753667051,0.4640632045775202,0.3574285551515102,0.2991639195194984,0.4171378139811819,0.46286017513895383,0.7408495900000001,0.749678495,1.0026711849999999,0.8254728499999999,0.70728832,0.72675074,0.6940266399999999,1.05223688]]

Actual:   [[0.2427, 0.1749, 0.5594, 0.6692, 0.4419, 0.3208, 0.4354, 0.4762, 0.5911, 0.6819, 0.8, 0.5783, 0.2504, 0.5652, 0.582, 0.3678, 0.4006, 0.3878, 0.1388, 0.4641, 0.3575, 0.2992, 0.4172, 0.4629, 0.7409, 0.7497, 1.0027, 0.8255, 0.7073, 0.7268, 0.6941, 1.0523]]

Expected: [[0.2427, 0.1749, 0.5594, 0.6692, 0.4419, 0.3208, 0.4354, 0.4762, 0.5911, 0.6819, 0.8, 0.5783, 0.2504, 0.5652, 0.582, 0.3678, 0.4006, 0.3878, 0.1388, 0.4641, 0.3575, 0.2992, 0.4172, 0.4629, 0.7409, 0.7497, 1.0027, 0.8255, 0.7073, 0.7268, 0.6941, 1.0523]]