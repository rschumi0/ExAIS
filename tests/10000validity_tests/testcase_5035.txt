import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot55247 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot55247 = tf.keras.layers.Input(shape=([3, 2]))
in0Mul83538 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul83538 = tf.keras.layers.Input(shape=([1, 1]))
in0Con77700 = tf.keras.layers.Input(shape=([2, 1]))
in0Min87858 = tf.keras.layers.Input(shape=([2, 1]))
in1Min87858 = tf.keras.layers.Input(shape=([2, 1]))
in0Con96344 = tf.keras.layers.Input(shape=([2, 1]))
in0Sep77355 = tf.keras.layers.Input(shape=([2, 1]))

Dot55247 = keras.layers.Dot(axes=(1, 1), name = 'Dot55247', )([in0Dot55247,in1Dot55247])
Mul83538 = keras.layers.Multiply(name = 'Mul83538', )([in0Mul83538,in1Mul83538])
Zer80637 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer80637', )(Mul83538)
Con77700 = keras.layers.Concatenate(axis=2, name = 'Con77700', )([Zer80637,in0Con77700])
Ave91832 = keras.layers.Average(name = 'Ave91832', )([Dot55247,Con77700])
Min87858 = keras.layers.Minimum(name = 'Min87858', )([in0Min87858,in1Min87858])
Max31285 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='same', name = 'Max31285', )(Min87858)
Con96344 = keras.layers.Concatenate(axis=2, name = 'Con96344', )([Max31285,in0Con96344])
Sep77355 = keras.layers.SeparableConv1D(2, (2),strides=(2), padding='same', name = 'Sep77355', )(in0Sep77355)
Zer63016 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer63016', )(Sep77355)
Mul68605 = keras.layers.Multiply(name = 'Mul68605', )([Con96344,Zer63016])
Sub83327 = keras.layers.Subtract(name = 'Sub83327', )([Ave91832,Mul68605])
model = tf.keras.models.Model(inputs=[in0Dot55247,in1Dot55247,in0Mul83538,in1Mul83538,in0Con77700,in0Min87858,in1Min87858,in0Con96344,in0Sep77355], outputs=Sub83327)
w = model.get_layer('Sep77355').get_weights() 
w[0] = np.array([[[0.5726]], [[0.9383]]])
w[1] = np.array([[[0.556, 0.5904]]])
w[2] = np.array([0, 0])
model.get_layer('Sep77355').set_weights(w) 
in0Dot55247 = tf.constant([[[0.1231, 0.517], [0.12, 0.4797], [0.1382, 0.7158]]])
in1Dot55247 = tf.constant([[[0.3629, 0.0022], [0.3384, 0.507], [0.7857, 0.67]]])
in0Mul83538 = tf.constant([[[0.2228]]])
in1Mul83538 = tf.constant([[[0.4165]]])
in0Con77700 = tf.constant([[[0.1035], [0.2774]]])
in0Min87858 = tf.constant([[[0.6034], [0.1607]]])
in1Min87858 = tf.constant([[[0.8118], [0.5712]]])
in0Con96344 = tf.constant([[[0.1083], [0.2217]]])
in0Sep77355 = tf.constant([[[0.5823], [0.2857]]])
print (np.array2string(model.predict([in0Dot55247,in1Dot55247,in0Mul83538,in1Mul83538,in0Con77700,in0Min87858,in1Min87858,in0Con96344,in0Sep77355],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub83327.png')

LDot55247 = dot_layer([[[0.1231, 0.517], [0.12, 0.4797], [0.1382, 0.7158]]], [[[0.3629, 0.0022], [0.3384, 0.507], [0.7857, 0.67]]], 1, 1, Dot55247), 
LMul83538 = multiply_layer([[[[0.2228]]], [[[0.4165]]]], Mul83538), 
LZer80637 = zero_padding1D_layer(Mul83538, 1, 0, Zer80637), 
LCon77700 = concatenate_layer([Zer80637,[[[0.1035], [0.2774]]]], 2, Con77700), 
LAve91832 = average_layer([Dot55247,Con77700], Ave91832), 
LMin87858 = minimum_layer([[[[0.6034], [0.1607]]], [[[0.8118], [0.5712]]]], Min87858), 
LMax31285 = max_pool1D_layer(Min87858, 1, 1, true, Max31285), 
LCon96344 = concatenate_layer([Max31285,[[[0.1083], [0.2217]]]], 2, Con96344), 
LSep77355 = separable_conv1D_layer([[[0.5823], [0.2857]]], 2,[[[[0.5726]], [[0.9383]]],[[[0.556, 0.5904]]]],[0, 0], 2, true, Sep77355), 
LZer63016 = zero_padding1D_layer(Sep77355, 1, 0, Zer63016), 
LMul68605 = multiply_layer([Con96344,Zer63016], Mul68605), 
LSub83327 = subtract_layer(Ave91832,Mul68605, Sub83327), 
exec_layers([LDot55247,LMul83538,LZer80637,LCon77700,LAve91832,LMin87858,LMax31285,LCon96344,LSep77355,LZer63016,LMul68605,LSub83327],["Dot55247","Mul83538","Zer80637","Con77700","Ave91832","Min87858","Max31285","Con96344","Sep77355","Zer63016","Mul68605","Sub83327"],Sub83327,"Sub83327")

Actual (Unparsed): [[[0.0969324, 0.1286024], [0.4488317, 0.4219347]]]

Expected (Unparsed): [[[0.09693236499999999,0.12860241],[0.44883171833633195,0.42193465919645273]]]

Actual:   [[[0.097, 0.1287], [0.4489, 0.422]]]

Expected: [[[0.097, 0.1287], [0.4489, 0.422]]]