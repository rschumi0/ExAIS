import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub97325 = tf.keras.layers.Input(shape=([3]))
in1Sub97325 = tf.keras.layers.Input(shape=([3]))
in0Bat98030 = tf.keras.layers.Input(shape=([1, 2]))
in0Up_68330 = tf.keras.layers.Input(shape=([2, 4]))

Sub97325 = keras.layers.Subtract(name = 'Sub97325', )([in0Sub97325,in1Sub97325])
Bat98030 = keras.layers.BatchNormalization(axis=2, epsilon=0.35017580433573414,  name = 'Bat98030', )(in0Bat98030)
ELU48628 = keras.layers.ELU(alpha=-0.7792388500347425, name = 'ELU48628', )(Bat98030)
Res80659 = keras.layers.Reshape((1, 2, 1), name = 'Res80659', )(ELU48628)
Res65762 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res65762', )(Res80659)
Zer47299 = keras.layers.ZeroPadding3D(padding=((3, 0), (4, 0), (2, 0)), name = 'Zer47299', )(Res65762)
Up_68330 = keras.layers.UpSampling1D(size=(1), name = 'Up_68330', )(in0Up_68330)
Res36363 = keras.layers.Reshape((2, 4, 1), name = 'Res36363', )(Up_68330)
Res54216 = keras.layers.Reshape((2, 4, 1, 1), name = 'Res54216', )(Res36363)
Zer88614 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer88614', )(Res54216)
Ave26251 = keras.layers.Average(name = 'Ave26251', )([Zer47299,Zer88614])
Res69221 = keras.layers.Reshape((4, 6, 3), name = 'Res69221', )(Ave26251)
Res33547 = keras.layers.Reshape((4, 18), name = 'Res33547', )(Res69221)
LST24879 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST24879', )(Res33547)
Ave44086 = keras.layers.Average(name = 'Ave44086', )([Sub97325,LST24879])
model = tf.keras.models.Model(inputs=[in0Sub97325,in1Sub97325,in0Bat98030,in0Up_68330], outputs=Ave44086)
w = model.get_layer('Bat98030').get_weights() 
w[0] = np.array([0.9864, 0.3009])
w[1] = np.array([0.9299, 0.6481])
w[2] = np.array([0.5003, 0.4411])
w[3] = np.array([0.3121, 0.6177])
model.get_layer('Bat98030').set_weights(w) 
w = model.get_layer('LST24879').get_weights() 
w[0] = np.array([[6, 1, 4, 6, 5, 4, 1, 9, 10, 3, 8, 8], [2, 3, 2, 3, 4, 4, 9, 4, 7, 5, 9, 7], [6, 9, 3, 7, 2, 5, 6, 8, 10, 2, 2, 10], [7, 4, 5, 1, 8, 3, 6, 9, 6, 4, 2, 8], [3, 4, 2, 4, 10, 7, 10, 6, 6, 4, 5, 5], [6, 1, 4, 7, 1, 1, 3, 9, 9, 4, 5, 6], [6, 2, 6, 2, 2, 4, 2, 7, 7, 10, 9, 5], [10, 5, 1, 9, 1, 9, 10, 3, 9, 7, 6, 5], [7, 10, 4, 6, 4, 4, 6, 3, 2, 8, 10, 2], [10, 7, 4, 1, 10, 8, 9, 9, 1, 3, 7, 7], [2, 7, 5, 10, 8, 7, 10, 8, 10, 3, 3, 3], [2, 8, 3, 4, 6, 3, 7, 2, 8, 5, 5, 1], [10, 3, 8, 5, 8, 1, 9, 9, 5, 1, 4, 1], [8, 9, 2, 5, 3, 8, 10, 10, 8, 7, 7, 8], [9, 3, 9, 4, 5, 1, 4, 10, 2, 10, 2, 3], [6, 1, 9, 2, 8, 1, 7, 8, 10, 6, 10, 10], [6, 9, 7, 10, 4, 2, 3, 1, 7, 6, 2, 1], [7, 1, 4, 3, 6, 9, 8, 2, 6, 1, 6, 9]])
w[1] = np.array([[9, 5, 4, 9, 9, 9, 6, 2, 5, 4, 5, 3], [3, 8, 7, 8, 10, 4, 7, 10, 7, 6, 7, 3], [3, 10, 10, 4, 1, 1, 9, 5, 4, 9, 4, 6]])
w[2] = np.array([10, 9, 6, 6, 4, 4, 1, 8, 1, 9, 8, 5])
model.get_layer('LST24879').set_weights(w) 
in0Sub97325 = tf.constant([[0.0827, 0.0542, 0.2566]])
in1Sub97325 = tf.constant([[0.8151, 0.6405, 0.5825]])
in0Bat98030 = tf.constant([[[1.2694, 1.3207]]])
in0Up_68330 = tf.constant([[[1.7126, 1.8549, 1.4799, 1.5393], [1.698, 1.2307, 1.0951, 1.5223]]])
print (np.array2string(model.predict([in0Sub97325,in1Sub97325,in0Bat98030,in0Up_68330],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave44086.png')

LSub97325 = subtract_layer([[0.0827, 0.0542, 0.2566]], [[0.8151, 0.6405, 0.5825]], Sub97325), 
LBat98030 = batch_normalization_layer([[[1.2694, 1.3207]]], 2, 0.35017580433573414, [0.9864, 0.3009], [0.9299, 0.6481], [0.5003, 0.4411], [0.3121, 0.6177], Bat98030), 
LELU48628 = elu_layer(Bat98030, -0.7792388500347425, ELU48628), 
LRes80659 = reshape_layer(ELU48628, [1, 2, 1], Res80659), 
LRes65762 = reshape_layer(Res80659, [1, 2, 1, 1], Res65762), 
LZer47299 = zero_padding3D_layer(Res65762, 3, 0, 4, 0, 2, 0, Zer47299), 
LUp_68330 = up_sampling1D_layer([[[1.7126, 1.8549, 1.4799, 1.5393], [1.698, 1.2307, 1.0951, 1.5223]]], 1, Up_68330), 
LRes36363 = reshape_layer(Up_68330, [2, 4, 1], Res36363), 
LRes54216 = reshape_layer(Res36363, [2, 4, 1, 1], Res54216), 
LZer88614 = zero_padding3D_layer(Res54216, 1, 1, 1, 1, 1, 1, Zer88614), 
LAve26251 = average_layer([Zer47299,Zer88614], Ave26251), 
LRes69221 = reshape_layer(Ave26251, [4, 6, 3], Res69221), 
LRes33547 = reshape_layer(Res69221, [4, 18], Res33547), 
LLST24879 = lstm_layer(Res33547,[[6, 1, 4, 6, 5, 4, 1, 9, 10, 3, 8, 8], [2, 3, 2, 3, 4, 4, 9, 4, 7, 5, 9, 7], [6, 9, 3, 7, 2, 5, 6, 8, 10, 2, 2, 10], [7, 4, 5, 1, 8, 3, 6, 9, 6, 4, 2, 8], [3, 4, 2, 4, 10, 7, 10, 6, 6, 4, 5, 5], [6, 1, 4, 7, 1, 1, 3, 9, 9, 4, 5, 6], [6, 2, 6, 2, 2, 4, 2, 7, 7, 10, 9, 5], [10, 5, 1, 9, 1, 9, 10, 3, 9, 7, 6, 5], [7, 10, 4, 6, 4, 4, 6, 3, 2, 8, 10, 2], [10, 7, 4, 1, 10, 8, 9, 9, 1, 3, 7, 7], [2, 7, 5, 10, 8, 7, 10, 8, 10, 3, 3, 3], [2, 8, 3, 4, 6, 3, 7, 2, 8, 5, 5, 1], [10, 3, 8, 5, 8, 1, 9, 9, 5, 1, 4, 1], [8, 9, 2, 5, 3, 8, 10, 10, 8, 7, 7, 8], [9, 3, 9, 4, 5, 1, 4, 10, 2, 10, 2, 3], [6, 1, 9, 2, 8, 1, 7, 8, 10, 6, 10, 10], [6, 9, 7, 10, 4, 2, 3, 1, 7, 6, 2, 1], [7, 1, 4, 3, 6, 9, 8, 2, 6, 1, 6, 9]],[[9, 5, 4, 9, 9, 9, 6, 2, 5, 4, 5, 3], [3, 8, 7, 8, 10, 4, 7, 10, 7, 6, 7, 3], [3, 10, 10, 4, 1, 1, 9, 5, 4, 9, 4, 6]],[10, 9, 6, 6, 4, 4, 1, 8, 1, 9, 8, 5], LST24879), 
LAve44086 = average_layer([Sub97325,LST24879], Ave44086), 
exec_layers([LSub97325,LBat98030,LELU48628,LRes80659,LRes65762,LZer47299,LUp_68330,LRes36363,LRes54216,LZer88614,LAve26251,LRes69221,LRes33547,LLST24879,LAve44086],["Sub97325","Bat98030","ELU48628","Res80659","Res65762","Zer47299","Up_68330","Res36363","Res54216","Zer88614","Ave26251","Res69221","Res33547","LST24879","Ave44086"],Ave44086,"Ave44086")

Actual (Unparsed): [[0.1332598, 0.2065146, 0.3365079]]

Expected (Unparsed): [[0.13325984772132954,0.2065145669751795,0.33650784807884737]]

Actual:   [[0.1333, 0.2066, 0.3366]]

Expected: [[0.1333, 0.2066, 0.3366]]