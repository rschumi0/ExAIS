import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add99441 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Add99441 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Sub57424 = tf.keras.layers.Input(shape=([2]))
in1Sub57424 = tf.keras.layers.Input(shape=([2]))
in0Con26928 = tf.keras.layers.Input(shape=([2, 1, 1]))

Add99441 = keras.layers.Add(name = 'Add99441', )([in0Add99441,in1Add99441])
Up_91627 = keras.layers.UpSampling3D(size=(1, 1, 2), name = 'Up_91627', )(Add99441)
Res92762 = keras.layers.Reshape((2, 1, 4), name = 'Res92762', )(Up_91627)
Sub57424 = keras.layers.Subtract(name = 'Sub57424', )([in0Sub57424,in1Sub57424])
Res94841 = keras.layers.Reshape((2, 1), name = 'Res94841', )(Sub57424)
Res94187 = keras.layers.Reshape((2, 1, 1), name = 'Res94187', )(Res94841)
Loc89929 = keras.layers.LocallyConnected2D(3, (2, 1),strides=(1, 1), name = 'Loc89929', )(Res94187)
Zer12860 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer12860', )(Loc89929)
Con26928 = keras.layers.Concatenate(axis=3, name = 'Con26928', )([Zer12860,in0Con26928])
Ave26858 = keras.layers.Average(name = 'Ave26858', )([Res92762,Con26928])
model = tf.keras.models.Model(inputs=[in0Add99441,in1Add99441,in0Sub57424,in1Sub57424,in0Con26928], outputs=Ave26858)
w = model.get_layer('Loc89929').get_weights() 
w[0] = np.array([[[0.2158, 0.2223, 0.9773], [0.0315, 0.0145, 0.5922]]])
w[1] = np.array([[[0, 0, 0]]])
model.get_layer('Loc89929').set_weights(w) 
in0Add99441 = tf.constant([[[[[0.5504, 0.6723]]], [[[0.5537, 0.7204]]]]])
in1Add99441 = tf.constant([[[[[0.8386, 0.3154]]], [[[0.8278, 0.1494]]]]])
in0Sub57424 = tf.constant([[0.3787, 0.8997]])
in1Sub57424 = tf.constant([[0.2314, 0.0725]])
in0Con26928 = tf.constant([[[[0.2254]], [[0.3347]]]])
print (np.array2string(model.predict([in0Add99441,in1Add99441,in0Sub57424,in1Sub57424,in0Con26928],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave26858.png')

LAdd99441 = add_layer([[[[[[0.5504, 0.6723]]], [[[0.5537, 0.7204]]]]], [[[[[0.8386, 0.3154]]], [[[0.8278, 0.1494]]]]]], Add99441), 
LUp_91627 = up_sampling3D_layer(Add99441, 1, 1, 2, Up_91627), 
LRes92762 = reshape_layer(Up_91627, [2, 1, 4], Res92762), 
LSub57424 = subtract_layer([[0.3787, 0.8997]], [[0.2314, 0.0725]], Sub57424), 
LRes94841 = reshape_layer(Sub57424, [2, 1], Res94841), 
LRes94187 = reshape_layer(Res94841, [2, 1, 1], Res94187), 
LLoc89929 = locally_connected2D_layer(Res94187, 2, 1,[[[0.2158, 0.2223, 0.9773], [0.0315, 0.0145, 0.5922]]],[[[0, 0, 0]]], 1, 1, Loc89929), 
LZer12860 = zero_padding2D_layer(Loc89929, 1, 0, 0, 0, Zer12860), 
LCon26928 = concatenate_layer([Zer12860,[[[[0.2254]], [[0.3347]]]]], 3, Con26928), 
LAve26858 = average_layer([Res92762,Con26928], Ave26858), 
exec_layers([LAdd99441,LUp_91627,LRes92762,LSub57424,LRes94841,LRes94187,LLoc89929,LZer12860,LCon26928,LAve26858],["Add99441","Up_91627","Res92762","Sub57424","Res94841","Res94187","Loc89929","Zer12860","Con26928","Ave26858"],Ave26858,"Ave26858")

Actual (Unparsed): [[[[0.6945000, 0.4938500, 0.6945000, 0.6065500]], [[0.7196720, 0.4572696, 1.0076620, 0.6022500]]]]

Expected (Unparsed): [[[[0.6945,0.49385,0.6945,0.60655]],[[0.71967207,0.45726959500000003,1.0076620649999999,0.60225]]]]

Actual:   [[[[0.6945, 0.4939, 0.6945, 0.6066]], [[0.7197, 0.4573, 1.0077, 0.6023]]]]

Expected: [[[[0.6945, 0.4939, 0.6945, 0.6066]], [[0.7197, 0.4573, 1.0077, 0.6023]]]]