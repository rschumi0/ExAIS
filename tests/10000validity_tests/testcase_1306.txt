import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot36173 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot36173 = tf.keras.layers.Input(shape=([3, 3]))
in0Glo45339 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))

Dot36173 = keras.layers.Dot(axes=(1, 2), name = 'Dot36173', )([in0Dot36173,in1Dot36173])
Res3110 = keras.layers.Reshape((3, 3, 1), name = 'Res3110', )(Dot36173)
Glo45339 = keras.layers.GlobalAveragePooling3D(name = 'Glo45339', )(in0Glo45339)
Lay92406 = keras.layers.LayerNormalization(axis=1, epsilon=2.0867662089138177, name = 'Lay92406', )(Glo45339)
Res47104 = keras.layers.Reshape((1, 1), name = 'Res47104', )(Lay92406)
Res15492 = keras.layers.Reshape((1, 1, 1), name = 'Res15492', )(Res47104)
Cro44244 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro44244', )(Res15492)
Zer7223 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer7223', )(Cro44244)
Sub76834 = keras.layers.Subtract(name = 'Sub76834', )([Res3110,Zer7223])
model = tf.keras.models.Model(inputs=[in0Dot36173,in1Dot36173,in0Glo45339], outputs=Sub76834)
in0Dot36173 = tf.constant([[[0.0653, 0.8749, 0.5787], [0.4874, 0.7661, 0.3671], [0.106, 0.1954, 0.3024]]])
in1Dot36173 = tf.constant([[[0.8948, 0.3265, 0.4539], [0.7155, 0.6198, 0.8318], [0.5371, 0.9553, 0.4192]]])
in0Glo45339 = tf.constant([[[[[1.5654], [1.6314]], [[1.1749], [1.2599]]], [[[1.676], [1.9586]], [[1.5912], [1.0055]]]]])
print (np.array2string(model.predict([in0Dot36173,in1Dot36173,in0Glo45339],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub76834.png')

LDot36173 = dot_layer([[[0.0653, 0.8749, 0.5787], [0.4874, 0.7661, 0.3671], [0.106, 0.1954, 0.3024]]], [[[0.8948, 0.3265, 0.4539], [0.7155, 0.6198, 0.8318], [0.5371, 0.9553, 0.4192]]], 1, 2, Dot36173), 
LRes3110 = reshape_layer(Dot36173, [3, 3, 1], Res3110), 
LGlo45339 = global_average_pooling3D_layer([[[[[1.5654], [1.6314]], [[1.1749], [1.2599]]], [[[1.676], [1.9586]], [[1.5912], [1.0055]]]]], Glo45339), 
LLay92406 = layer_normalization_layer(Glo45339, 1, 2.0867662089138177, Lay92406), 
LRes47104 = reshape_layer(Lay92406, [1, 1], Res47104), 
LRes15492 = reshape_layer(Res47104, [1, 1, 1], Res15492), 
LCro44244 = cropping2D_layer(Res15492, 0, 0, 0, 0, Cro44244), 
LZer7223 = zero_padding2D_layer(Cro44244, 2, 0, 2, 0, Zer7223), 
LSub76834 = subtract_layer(Res3110,Zer7223, Sub76834), 
exec_layers([LDot36173,LRes3110,LGlo45339,LLay92406,LRes47104,LRes15492,LCro44244,LZer7223,LSub76834],["Dot36173","Res3110","Glo45339","Lay92406","Res47104","Res15492","Cro44244","Zer7223","Sub76834"],Sub76834,"Sub76834")

Actual (Unparsed): [[[[0.2656799], [0.4369835], [0.5451210]], [[1.1216842], [1.2633534], [1.2836758]], [[0.7749383], [0.8931247], [0.7882765]]]]

Expected (Unparsed): [[[[0.26567994],[0.43698347000000004],[0.54512105]],[[1.12168423],[1.2633534499999999],[1.2836758]],[[0.77493827],[0.8931247499999999],[0.7882764800000001]]]]

Actual:   [[[[0.2657], [0.437], [0.5452]], [[1.1217], [1.2634], [1.2837]], [[0.775], [0.8932], [0.7883]]]]

Expected: [[[[0.2657], [0.437], [0.5452]], [[1.1217], [1.2634], [1.2837]], [[0.775], [0.8932], [0.7883]]]]