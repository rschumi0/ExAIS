import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min56839 = tf.keras.layers.Input(shape=([2, 1]))
in1Min56839 = tf.keras.layers.Input(shape=([2, 1]))
in0Con19848 = tf.keras.layers.Input(shape=([2, 11]))
in0Per13559 = tf.keras.layers.Input(shape=([4, 2]))
in0Min53478 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Min53478 = tf.keras.layers.Input(shape=([2, 2, 1]))

Min56839 = keras.layers.Minimum(name = 'Min56839', )([in0Min56839,in1Min56839])
Lay2373 = keras.layers.LayerNormalization(axis=2, epsilon=2.1737963293793765, name = 'Lay2373', )(Min56839)
Con19848 = keras.layers.Concatenate(axis=2, name = 'Con19848', )([Lay2373,in0Con19848])
Per13559 = keras.layers.Permute((2,1), name = 'Per13559',)(in0Per13559)
Res6942 = keras.layers.Reshape((2, 4, 1), name = 'Res6942', )(Per13559)
Res57341 = keras.layers.Reshape((2, 4, 1, 1), name = 'Res57341', )(Res6942)
Zer41577 = keras.layers.ZeroPadding3D(padding=((2, 0), (0, 0), (2, 0)), name = 'Zer41577', )(Res57341)
Min53478 = keras.layers.Minimum(name = 'Min53478', )([in0Min53478,in1Min53478])
Res72186 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res72186', )(Min53478)
Zer55147 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer55147', )(Res72186)
Ave608 = keras.layers.Average(name = 'Ave608', )([Zer41577,Zer55147])
Res37563 = keras.layers.Reshape((4, 4, 3), name = 'Res37563', )(Ave608)
Res94037 = keras.layers.Reshape((4, 12), name = 'Res94037', )(Res37563)
Dot33130 = keras.layers.Dot(axes=(2, 2), name = 'Dot33130', )([Con19848,Res94037])
model = tf.keras.models.Model(inputs=[in0Min56839,in1Min56839,in0Con19848,in0Per13559,in0Min53478,in1Min53478], outputs=Dot33130)
in0Min56839 = tf.constant([[[0.3835], [0.7947]]])
in1Min56839 = tf.constant([[[0.2112], [0.3021]]])
in0Con19848 = tf.constant([[[0.7121, 0.7749, 0.7942, 0.8212, 0.088, 0.2899, 0.4281, 0.2793, 0.1445, 0.1027, 0.9649], [0.5846, 0.9252, 0.2837, 0.9504, 0.7818, 0.5109, 0.4565, 0.0464, 0.3208, 0.8034, 0.4731]]])
in0Per13559 = tf.constant([[[1.0251, 1.6415], [1.1398, 1.4641], [1.3642, 1.6843], [1.9797, 1.1296]]])
in0Min53478 = tf.constant([[[[0.8164], [0.1008]], [[0.8107], [0.6992]]]])
in1Min53478 = tf.constant([[[[0.9582], [0.4123]], [[0.0161], [0.3705]]]])
print (np.array2string(model.predict([in0Min56839,in1Min56839,in0Con19848,in0Per13559,in0Min53478,in1Min53478],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot33130.png')

LMin56839 = minimum_layer([[[[0.3835], [0.7947]]], [[[0.2112], [0.3021]]]], Min56839), 
LLay2373 = layer_normalization_layer(Min56839, 2, 2.1737963293793765, Lay2373), 
LCon19848 = concatenate_layer([Lay2373,[[[0.7121, 0.7749, 0.7942, 0.8212, 0.088, 0.2899, 0.4281, 0.2793, 0.1445, 0.1027, 0.9649], [0.5846, 0.9252, 0.2837, 0.9504, 0.7818, 0.5109, 0.4565, 0.0464, 0.3208, 0.8034, 0.4731]]]], 2, Con19848), 
LPer13559 = permute_layer([[[1.0251, 1.6415], [1.1398, 1.4641], [1.3642, 1.6843], [1.9797, 1.1296]]], 2,1, Per13559), 
LRes6942 = reshape_layer(Per13559, [2, 4, 1], Res6942), 
LRes57341 = reshape_layer(Res6942, [2, 4, 1, 1], Res57341), 
LZer41577 = zero_padding3D_layer(Res57341, 2, 0, 0, 0, 2, 0, Zer41577), 
LMin53478 = minimum_layer([[[[[0.8164], [0.1008]], [[0.8107], [0.6992]]]], [[[[0.9582], [0.4123]], [[0.0161], [0.3705]]]]], Min53478), 
LRes72186 = reshape_layer(Min53478, [2, 2, 1, 1], Res72186), 
LZer55147 = zero_padding3D_layer(Res72186, 1, 1, 1, 1, 1, 1, Zer55147), 
LAve608 = average_layer([Zer41577,Zer55147], Ave608), 
LRes37563 = reshape_layer(Ave608, [4, 4, 3], Res37563), 
LRes94037 = reshape_layer(Res37563, [4, 12], Res94037), 
LDot33130 = dot_layer(Con19848,Res94037, 2, 2, Dot33130), 
exec_layers([LMin56839,LLay2373,LCon19848,LPer13559,LRes6942,LRes57341,LZer41577,LMin53478,LRes72186,LZer55147,LAve608,LRes37563,LRes94037,LDot33130],["Min56839","Lay2373","Con19848","Per13559","Res6942","Res57341","Zer41577","Min53478","Res72186","Zer55147","Ave608","Res37563","Res94037","Dot33130"],Dot33130,"Dot33130")

Actual (Unparsed): [[[0.0000000, 0.3567901, 1.6788592, 1.4806076], [0.0000000, 0.4109609, 1.5119239, 1.6379572]]]

Expected (Unparsed): [[[0.0,0.35679008000000006,1.678859175,1.48060759],[0.0,0.41096088000000003,1.5119238999999998,1.63795723]]]

Actual:   [[[0, 0.3568, 1.6789, 1.4807], [0, 0.411, 1.512, 1.638]]]

Expected: [[[0, 0.3568, 1.6789, 1.4807], [0, 0.411, 1.512, 1.638]]]