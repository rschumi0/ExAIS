import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max71125 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con84208 = tf.keras.layers.Input(shape=([2, 1]))
in0LST94574 = tf.keras.layers.Input(shape=([1, 2]))
in0Glo53080 = tf.keras.layers.Input(shape=([1, 1, 2]))

Max71125 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 1), padding='valid', name = 'Max71125', )(in0Max71125)
ReL95029 = keras.layers.ReLU(max_value=9.317210963563765, negative_slope=5.947710840574494, threshold=8.226274229457747, name = 'ReL95029', )(Max71125)
Zer17876 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer17876', )(ReL95029)
Ave3837 = keras.layers.AveragePooling2D(pool_size=(1, 2), strides=(2, 2), padding='valid', name = 'Ave3837', )(Zer17876)
Res38624 = keras.layers.Reshape((2, 2), name = 'Res38624', )(Ave3837)
Con84208 = keras.layers.Concatenate(axis=2, name = 'Con84208', )([Res38624,in0Con84208])
LST94574 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST94574', )(in0LST94574)
Res50766 = keras.layers.Reshape((1, 1), name = 'Res50766', )(LST94574)
Glo53080 = keras.layers.GlobalMaxPool2D(name = 'Glo53080', )(in0Glo53080)
Res84102 = keras.layers.Reshape((2, 1), name = 'Res84102', )(Glo53080)
Res94677 = keras.layers.Reshape((2, 1, 1), name = 'Res94677', )(Res84102)
Res39348 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res39348', )(Res94677)
Con61758 = keras.layers.Conv3D(3, (2, 1, 1),strides=(9, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con61758', )(Res39348)
Res18475 = keras.layers.Reshape((1, 1, 3), name = 'Res18475', )(Con61758)
Res81013 = keras.layers.Reshape((1, 3), name = 'Res81013', )(Res18475)
Dot8764 = keras.layers.Dot(axes=(1, 1), name = 'Dot8764', )([Res50766,Res81013])
Zer47890 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer47890', )(Dot8764)
Mul40909 = keras.layers.Multiply(name = 'Mul40909', )([Con84208,Zer47890])
model = tf.keras.models.Model(inputs=[in0Max71125,in0Con84208,in0LST94574,in0Glo53080], outputs=Mul40909)
w = model.get_layer('LST94574').get_weights() 
w[0] = np.array([[1, 4, 4, 10], [7, 3, 5, 2]])
w[1] = np.array([[3, 7, 3, 1]])
w[2] = np.array([4, 4, 2, 6])
model.get_layer('LST94574').set_weights(w) 
w = model.get_layer('Con61758').get_weights() 
w[0] = np.array([[[[[0.8835, 0.5352, 0.3055]]]], [[[[0.7124, 0.3466, 0.6316]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con61758').set_weights(w) 
in0Max71125 = tf.constant([[[[1.1506, 1.14]], [[1.6465, 1.0698]]]])
in0Con84208 = tf.constant([[[0.4475], [0.4791]]])
in0LST94574 = tf.constant([[[3, 3]]])
in0Glo53080 = tf.constant([[[[1.0244, 1.432]]]])
print (np.array2string(model.predict([in0Max71125,in0Con84208,in0LST94574,in0Glo53080],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul40909.png')

LMax71125 = max_pool2D_layer([[[[1.1506, 1.14]], [[1.6465, 1.0698]]]], 1, 1, 1, 1, false, Max71125), 
LReL95029 = relu_layer(Max71125, 9.317210963563765, 5.947710840574494, 8.226274229457747, ReL95029), 
LZer17876 = zero_padding2D_layer(ReL95029, 1, 1, 1, 1, Zer17876), 
LAve3837 = average_pooling2D_layer(Zer17876, 1, 2, 2, 2, false, Ave3837), 
LRes38624 = reshape_layer(Ave3837, [2, 2], Res38624), 
LCon84208 = concatenate_layer([Res38624,[[[0.4475], [0.4791]]]], 2, Con84208), 
LLST94574 = lstm_layer([[[3, 3]]],[[1, 4, 4, 10], [7, 3, 5, 2]],[[3, 7, 3, 1]],[4, 4, 2, 6], LST94574), 
LRes50766 = reshape_layer(LST94574, [1, 1], Res50766), 
LGlo53080 = global_max_pool2D_layer([[[[1.0244, 1.432]]]], Glo53080), 
LRes84102 = reshape_layer(Glo53080, [2, 1], Res84102), 
LRes94677 = reshape_layer(Res84102, [2, 1, 1], Res94677), 
LRes39348 = reshape_layer(Res94677, [2, 1, 1, 1], Res39348), 
LCon61758 = conv3D_layer(Res39348, 2, 1, 1,[[[[[0.8835, 0.5352, 0.3055]]]], [[[[0.7124, 0.3466, 0.6316]]]]],[0, 0, 0], 9, 1, 1, true, 1, 1, 1, Con61758), 
LRes18475 = reshape_layer(Con61758, [1, 1, 3], Res18475), 
LRes81013 = reshape_layer(Res18475, [1, 3], Res81013), 
LDot8764 = dot_layer(Res50766,Res81013, 1, 1, Dot8764), 
LZer47890 = zero_padding1D_layer(Dot8764, 1, 0, Zer47890), 
LMul40909 = multiply_layer([Con84208,Zer47890], Mul40909), 
exec_layers([LMax71125,LReL95029,LZer17876,LAve3837,LRes38624,LCon84208,LLST94574,LRes50766,LGlo53080,LRes84102,LRes94677,LRes39348,LCon61758,LRes18475,LRes81013,LDot8764,LZer47890,LMul40909],["Max71125","ReL95029","Zer17876","Ave3837","Res38624","Con84208","LST94574","Res50766","Glo53080","Res84102","Res94677","Res39348","Con61758","Res18475","Res81013","Dot8764","Zer47890","Mul40909"],Mul40909,"Mul40909")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000], [-28.6901955, -16.9312283, 0.4442066]]]

Expected (Unparsed): [[[0,0,0.0],[-28.690195115030864,-16.93122817027559,0.444206590318684]]]

Actual:   [[[0, 0, 0], [-28.6901, -16.9312, 0.4443]]]

Expected: [[[0, 0, 0], [-28.6901, -16.9312, 0.4443]]]