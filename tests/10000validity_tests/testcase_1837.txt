import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max12194 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Mul95393 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul95393 = tf.keras.layers.Input(shape=([2, 2]))
in0Con56891 = tf.keras.layers.Input(shape=([2, 6]))
in0Con29827 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Sep56005 = tf.keras.layers.Input(shape=([2, 1, 2]))

Max12194 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max12194', )(in0Max12194)
Res31254 = keras.layers.Reshape((1, 2, 2, 1), name = 'Res31254', )(Max12194)
Con24835 = keras.layers.Conv3D(2, (1, 2, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con24835', )(Res31254)
Res92121 = keras.layers.Reshape((1, 2, 4), name = 'Res92121', )(Con24835)
Res87246 = keras.layers.Reshape((1, 8), name = 'Res87246', )(Res92121)
Zer38465 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer38465', )(Res87246)
Mul95393 = keras.layers.Multiply(name = 'Mul95393', )([in0Mul95393,in1Mul95393])
ReL78737 = keras.layers.ReLU(max_value=4.082712222453287, negative_slope=9.235788619761172, threshold=3.9432705987459804, name = 'ReL78737', )(Mul95393)
Con56891 = keras.layers.Concatenate(axis=2, name = 'Con56891', )([ReL78737,in0Con56891])
Add35292 = keras.layers.Add(name = 'Add35292', )([Zer38465,Con56891])
GRU16987 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU16987', )(Add35292)
Res1568 = keras.layers.Reshape((1, 1), name = 'Res1568', )(GRU16987)
Res50499 = keras.layers.Reshape((1, 1, 1), name = 'Res50499', )(Res1568)
Zer31225 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer31225', )(Res50499)
Con29827 = keras.layers.Concatenate(axis=3, name = 'Con29827', )([Zer31225,in0Con29827])
Sep56005 = keras.layers.SeparableConv2D(3, (1, 1),strides=(1, 1), padding='valid', name = 'Sep56005', )(in0Sep56005)
Mul18781 = keras.layers.Multiply(name = 'Mul18781', )([Con29827,Sep56005])
model = tf.keras.models.Model(inputs=[in0Max12194,in0Mul95393,in1Mul95393,in0Con56891,in0Con29827,in0Sep56005], outputs=Mul18781)
w = model.get_layer('Con24835').get_weights() 
w[0] = np.array([[[[[0.0025, 0.0977]]], [[[0.5358, 0.2057]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con24835').set_weights(w) 
w = model.get_layer('GRU16987').get_weights() 
w[0] = np.array([[1, 9, 6], [10, 4, 8], [3, 10, 10], [10, 10, 10], [5, 9, 9], [2, 8, 6], [10, 10, 10], [7, 10, 8]])
w[1] = np.array([[3, 7, 6]])
w[2] = np.array([[10, 10, 9], [6, 9, 5]])
model.get_layer('GRU16987').set_weights(w) 
w = model.get_layer('Sep56005').get_weights() 
w[0] = np.array([[[[0.0617], [0.3957]]]])
w[1] = np.array([[[[0.2401, 0.8887, 0.6798], [0.4394, 0.5919, 0.8644]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep56005').set_weights(w) 
in0Max12194 = tf.constant([[[[1.1766, 1.6369], [1.3289, 1.051]]]])
in0Mul95393 = tf.constant([[[0.8579, 0.8078], [0.8918, 0.8797]]])
in1Mul95393 = tf.constant([[[0.6424, 0.895], [0.717, 0.3846]]])
in0Con56891 = tf.constant([[[0.7166, 0.7028, 0.6739, 0.1639, 0.2946, 0.1394], [0.4548, 0.3394, 0.7437, 0.5932, 0.5, 0.1747]]])
in0Con29827 = tf.constant([[[[0.5603, 0.296]], [[0.2523, 0.9053]]]])
in0Sep56005 = tf.constant([[[[0.4325, 0.8746]], [[0.3048, 0.8499]]]])
print (np.array2string(model.predict([in0Max12194,in0Mul95393,in1Mul95393,in0Con56891,in0Con29827,in0Sep56005],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul18781.png')

LMax12194 = max_pool2D_layer([[[[1.1766, 1.6369], [1.3289, 1.051]]]], 1, 1, Max12194), 
LRes31254 = reshape_layer(Max12194, [1, 2, 2, 1], Res31254), 
LCon24835 = conv3D_layer(Res31254, 1, 2, 1,[[[[[0.0025, 0.0977]]], [[[0.5358, 0.2057]]]]],[0, 0], 1, 1, 1, true, 1, 1, 1, Con24835), 
LRes92121 = reshape_layer(Con24835, [1, 2, 4], Res92121), 
LRes87246 = reshape_layer(Res92121, [1, 8], Res87246), 
LZer38465 = zero_padding1D_layer(Res87246, 1, 0, Zer38465), 
LMul95393 = multiply_layer([[[[0.8579, 0.8078], [0.8918, 0.8797]]], [[[0.6424, 0.895], [0.717, 0.3846]]]], Mul95393), 
LReL78737 = relu_layer(Mul95393, 4.082712222453287, 9.235788619761172, 3.9432705987459804, ReL78737), 
LCon56891 = concatenate_layer([ReL78737,[[[0.7166, 0.7028, 0.6739, 0.1639, 0.2946, 0.1394], [0.4548, 0.3394, 0.7437, 0.5932, 0.5, 0.1747]]]], 2, Con56891), 
LAdd35292 = add_layer([Zer38465,Con56891], Add35292), 
LGRU16987 = gru_layer(Add35292,[[1, 9, 6], [10, 4, 8], [3, 10, 10], [10, 10, 10], [5, 9, 9], [2, 8, 6], [10, 10, 10], [7, 10, 8]],[[3, 7, 6]],[[10, 10, 9], [6, 9, 5]], true, GRU16987), 
LRes1568 = reshape_layer(GRU16987, [1, 1], Res1568), 
LRes50499 = reshape_layer(Res1568, [1, 1, 1], Res50499), 
LZer31225 = zero_padding2D_layer(Res50499, 1, 0, 0, 0, Zer31225), 
LCon29827 = concatenate_layer([Zer31225,[[[[0.5603, 0.296]], [[0.2523, 0.9053]]]]], 3, Con29827), 
LSep56005 = separable_conv2D_layer([[[[0.4325, 0.8746]], [[0.3048, 0.8499]]]], 1, 1,[[[[[0.0617], [0.3957]]]],[[[[0.2401, 0.8887, 0.6798], [0.4394, 0.5919, 0.8644]]]]],[0, 0, 0], 1, 1, false, Sep56005), 
LMul18781 = multiply_layer([Con29827,Sep56005], Mul18781), 
exec_layers([LMax12194,LRes31254,LCon24835,LRes92121,LRes87246,LZer38465,LMul95393,LReL78737,LCon56891,LAdd35292,LGRU16987,LRes1568,LRes50499,LZer31225,LCon29827,LSep56005,LMul18781],["Max12194","Res31254","Con24835","Res92121","Res87246","Zer38465","Mul95393","ReL78737","Con56891","Add35292","GRU16987","Res1568","Res50499","Zer31225","Con29827","Sep56005","Mul18781"],Mul18781,"Mul18781")

Actual (Unparsed): [[[[0.0000000, 0.1280619, 0.0939183]], [[-0.1522880, 0.0544393, 0.2747466]]]]

Expected (Unparsed): [[[[0.0,0.1280618721576779,0.093918287172528]],[[-0.152287964958,0.054439330704590706,0.274746637392678]]]]

Actual:   [[[[0, 0.1281, 0.094]], [[-0.1522, 0.0545, 0.2748]]]]

Expected: [[[[0, 0.1281, 0.094]], [[-0.1522, 0.0545, 0.2748]]]]