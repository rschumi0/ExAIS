import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave20376 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Add16700 = tf.keras.layers.Input(shape=([2, 1]))
in1Add16700 = tf.keras.layers.Input(shape=([2, 1]))
in0Min45853 = tf.keras.layers.Input(shape=([2, 1]))
in1Min45853 = tf.keras.layers.Input(shape=([2, 1]))

Ave20376 = keras.layers.AveragePooling2D(pool_size=(2, 2), strides=(2, 2), padding='same', name = 'Ave20376', )(in0Ave20376)
Fla45043 = keras.layers.Flatten(name = 'Fla45043', )(Ave20376)
Res27375 = keras.layers.Reshape((2, 1), name = 'Res27375', )(Fla45043)
Add16700 = keras.layers.Add(name = 'Add16700', )([in0Add16700,in1Add16700])
Min45853 = keras.layers.Minimum(name = 'Min45853', )([in0Min45853,in1Min45853])
Add67671 = keras.layers.Add(name = 'Add67671', )([Add16700,Min45853])
Dot44493 = keras.layers.Dot(axes=(2, 2), name = 'Dot44493', )([Res27375,Add67671])
Res99935 = keras.layers.Reshape((2, 2, 1), name = 'Res99935', )(Dot44493)
Con51230 = keras.layers.Conv2D(3, (2, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con51230', )(Res99935)
model = tf.keras.models.Model(inputs=[in0Ave20376,in0Add16700,in1Add16700,in0Min45853,in1Min45853], outputs=Con51230)
w = model.get_layer('Con51230').get_weights() 
w[0] = np.array([[[[0.5277, 0.678, 0.4067]]], [[[0.6888, 0.2368, 0.5883]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con51230').set_weights(w) 
in0Ave20376 = tf.constant([[[[1.1222, 1.3561], [1.7737, 1.967]], [[1.0979, 1.0668], [1.3224, 1.923]]]])
in0Add16700 = tf.constant([[[0.3024], [0.9647]]])
in1Add16700 = tf.constant([[[0.7681], [0.8917]]])
in0Min45853 = tf.constant([[[0.7391], [0.5494]]])
in1Min45853 = tf.constant([[[0.7721], [0.6664]]])
print (np.array2string(model.predict([in0Ave20376,in0Add16700,in1Add16700,in0Min45853,in1Min45853],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con51230.png')

LAve20376 = average_pooling2D_layer([[[[1.1222, 1.3561], [1.7737, 1.967]], [[1.0979, 1.0668], [1.3224, 1.923]]]], 2, 2, 2, 2, true, Ave20376), 
LFla45043 = flatten_layer(Ave20376, Fla45043), 
LRes27375 = reshape_layer(Fla45043, [2, 1], Res27375), 
LAdd16700 = add_layer([[[[0.3024], [0.9647]]], [[[0.7681], [0.8917]]]], Add16700), 
LMin45853 = minimum_layer([[[[0.7391], [0.5494]]], [[[0.7721], [0.6664]]]], Min45853), 
LAdd67671 = add_layer([Add16700,Min45853], Add67671), 
LDot44493 = dot_layer(Res27375,Add67671, 2, 2, Dot44493), 
LRes99935 = reshape_layer(Dot44493, [2, 2, 1], Res99935), 
LCon51230 = conv2D_layer(Res99935, 2, 1,[[[[0.5277, 0.678, 0.4067]]], [[[0.6888, 0.2368, 0.5883]]]],[0, 0, 0], 1, 1, true, 1, 1, Con51230), 
exec_layers([LAve20376,LFla45043,LRes27375,LAdd16700,LMin45853,LAdd67671,LDot44493,LRes99935,LCon51230],["Ave20376","Fla45043","Res27375","Add16700","Min45853","Add67671","Dot44493","Res99935","Con51230"],Con51230,"Con51230")

Actual (Unparsed): [[[[3.2363267, 2.3069135, 2.6582923], [4.3025834, 3.0669609, 3.5341067]], [[1.5070879, 1.9363381, 1.1615173], [2.0036208, 2.5742939, 1.5441966]]]]

Expected (Unparsed): [[[[3.236326759224,2.306913511968,2.658292270764001],[4.302583398177001,3.066960945564001,3.5341067335345007]],[[1.5070879600920002,1.9363381408800007,1.1615172889320002],[2.0036208081285003,2.5742939319900007,1.5441966698235003]]]]

Actual:   [[[[3.2364, 2.307, 2.6583], [4.3026, 3.067, 3.5342]], [[1.5071, 1.9364, 1.1616], [2.0037, 2.5743, 1.5442]]]]

Expected: [[[[3.2364, 2.307, 2.6583], [4.3026, 3.067, 3.5342]], [[1.5071, 1.9364, 1.1616], [2.0037, 2.5743, 1.5442]]]]