import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add97786 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Add97786 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Glo33253 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Con49738 = tf.keras.layers.Input(shape=([2]))
in0Add96947 = tf.keras.layers.Input(shape=([2, 1]))
in1Add96947 = tf.keras.layers.Input(shape=([2, 1]))
in0Con97981 = tf.keras.layers.Input(shape=([4, 1]))
in0Dot59966 = tf.keras.layers.Input(shape=([3]))
in1Dot59966 = tf.keras.layers.Input(shape=([3]))
in0Mul28442 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Mul28442 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in0Loc87972 = tf.keras.layers.Input(shape=([2, 1]))

Add97786 = keras.layers.Add(name = 'Add97786', )([in0Add97786,in1Add97786])
Res1319 = keras.layers.Reshape((2, 1, 2), name = 'Res1319', )(Add97786)
Res50790 = keras.layers.Reshape((2, 2), name = 'Res50790', )(Res1319)
Fla53813 = keras.layers.Flatten(name = 'Fla53813', )(Res50790)
Glo33253 = keras.layers.GlobalMaxPool3D(name = 'Glo33253', )(in0Glo33253)
Con49738 = keras.layers.Concatenate(axis=1, name = 'Con49738', )([Glo33253,in0Con49738])
Sub11933 = keras.layers.Subtract(name = 'Sub11933', )([Fla53813,Con49738])
Res10866 = keras.layers.Reshape((4, 1), name = 'Res10866', )(Sub11933)
Add96947 = keras.layers.Add(name = 'Add96947', )([in0Add96947,in1Add96947])
Zer2479 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer2479', )(Add96947)
Max51653 = keras.layers.Maximum(name = 'Max51653', )([Res10866,Zer2479])
Con97981 = keras.layers.Concatenate(axis=2, name = 'Con97981', )([Max51653,in0Con97981])
Dot59966 = keras.layers.Dot(axes=(1, 1), name = 'Dot59966', )([in0Dot59966,in1Dot59966])
Res58063 = keras.layers.Reshape((1, 1), name = 'Res58063', )(Dot59966)
Cro37025 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro37025', )(Res58063)
Mul28442 = keras.layers.Multiply(name = 'Mul28442', )([in0Mul28442,in1Mul28442])
Res50258 = keras.layers.Reshape((1, 1, 2), name = 'Res50258', )(Mul28442)
Res95907 = keras.layers.Reshape((1, 2), name = 'Res95907', )(Res50258)
Loc87972 = keras.layers.LocallyConnected1D(2, (2),strides=(1), name = 'Loc87972', )(in0Loc87972)
Ave69078 = keras.layers.Average(name = 'Ave69078', )([Res95907,Loc87972])
Dot15984 = keras.layers.Dot(axes=(2, 1), name = 'Dot15984', )([Cro37025,Ave69078])
Zer63393 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer63393', )(Dot15984)
Mul35506 = keras.layers.Multiply(name = 'Mul35506', )([Con97981,Zer63393])
model = tf.keras.models.Model(inputs=[in0Add97786,in1Add97786,in0Glo33253,in0Con49738,in0Add96947,in1Add96947,in0Con97981,in0Dot59966,in1Dot59966,in0Mul28442,in1Mul28442,in0Loc87972], outputs=Mul35506)
w = model.get_layer('Loc87972').get_weights() 
w[0] = np.array([[[0.0412, 0.7176], [0.3033, 0.6673]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc87972').set_weights(w) 
in0Add97786 = tf.constant([[[[[0.3634], [0.7373]]], [[[0.0969], [0.5711]]]]])
in1Add97786 = tf.constant([[[[[0.4435], [0.1705]]], [[[0.4493], [0.9686]]]]])
in0Glo33253 = tf.constant([[[[[1.5579, 1.6471], [1.6831, 1.3304]], [[1.1284, 1.8208], [1.5666, 1.2345]]]]])
in0Con49738 = tf.constant([[0.7742, 0.1707]])
in0Add96947 = tf.constant([[[0.1156], [0.0146]]])
in1Add96947 = tf.constant([[[0.1105], [0.8505]]])
in0Con97981 = tf.constant([[[0.9798], [0.6774], [0.1299], [0.6943]]])
in0Dot59966 = tf.constant([[0.4803, 0.5344, 0.5223]])
in1Dot59966 = tf.constant([[0.2022, 0.2404, 0.9007]])
in0Mul28442 = tf.constant([[[[[0.5177, 0.6297]]]]])
in1Mul28442 = tf.constant([[[[[0.0383, 0.2382]]]]])
in0Loc87972 = tf.constant([[[0.7124], [0.096]]])
print (np.array2string(model.predict([in0Add97786,in1Add97786,in0Glo33253,in0Con49738,in0Add96947,in1Add96947,in0Con97981,in0Dot59966,in1Dot59966,in0Mul28442,in1Mul28442,in0Loc87972],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul35506.png')

LAdd97786 = add_layer([[[[[[0.3634], [0.7373]]], [[[0.0969], [0.5711]]]]], [[[[[0.4435], [0.1705]]], [[[0.4493], [0.9686]]]]]], Add97786), 
LRes1319 = reshape_layer(Add97786, [2, 1, 2], Res1319), 
LRes50790 = reshape_layer(Res1319, [2, 2], Res50790), 
LFla53813 = flatten_layer(Res50790, Fla53813), 
LGlo33253 = global_max_pool3D_layer([[[[[1.5579, 1.6471], [1.6831, 1.3304]], [[1.1284, 1.8208], [1.5666, 1.2345]]]]], Glo33253), 
LCon49738 = concatenate_layer([Glo33253,[[0.7742, 0.1707]]], 1, Con49738), 
LSub11933 = subtract_layer(Fla53813,Con49738, Sub11933), 
LRes10866 = reshape_layer(Sub11933, [4, 1], Res10866), 
LAdd96947 = add_layer([[[[0.1156], [0.0146]]], [[[0.1105], [0.8505]]]], Add96947), 
LZer2479 = zero_padding1D_layer(Add96947, 2, 0, Zer2479), 
LMax51653 = maximum_layer([Res10866,Zer2479], Max51653), 
LCon97981 = concatenate_layer([Max51653,[[[0.9798], [0.6774], [0.1299], [0.6943]]]], 2, Con97981), 
LDot59966 = dot_layer([[0.4803, 0.5344, 0.5223]], [[0.2022, 0.2404, 0.9007]], 1, 1, Dot59966), 
LRes58063 = reshape_layer(Dot59966, [1, 1], Res58063), 
LCro37025 = cropping1D_layer(Res58063, 0, 0, Cro37025), 
LMul28442 = multiply_layer([[[[[[0.5177, 0.6297]]]]], [[[[[0.0383, 0.2382]]]]]], Mul28442), 
LRes50258 = reshape_layer(Mul28442, [1, 1, 2], Res50258), 
LRes95907 = reshape_layer(Res50258, [1, 2], Res95907), 
LLoc87972 = locally_connected1D_layer([[[0.7124], [0.096]]], 2,[[[0.0412, 0.7176], [0.3033, 0.6673]]],[[0, 0]], 1, Loc87972), 
LAve69078 = average_layer([Res95907,Loc87972], Ave69078), 
LDot15984 = dot_layer(Cro37025,Ave69078, 2, 1, Dot15984), 
LZer63393 = zero_padding1D_layer(Dot15984, 3, 0, Zer63393), 
LMul35506 = multiply_layer([Con97981,Zer63393], Mul35506), 
exec_layers([LAdd97786,LRes1319,LRes50790,LFla53813,LGlo33253,LCon49738,LSub11933,LRes10866,LAdd96947,LZer2479,LMax51653,LCon97981,LDot59966,LRes58063,LCro37025,LMul28442,LRes50258,LRes95907,LLoc87972,LAve69078,LDot15984,LZer63393,LMul35506],["Add97786","Res1319","Res50790","Fla53813","Glo33253","Con49738","Sub11933","Res10866","Add96947","Zer2479","Max51653","Con97981","Dot59966","Res58063","Cro37025","Mul28442","Res50258","Res95907","Loc87972","Ave69078","Dot15984","Zer63393","Mul35506"],Mul35506,"Mul35506")

Actual (Unparsed): [[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0373021, 0.1752435]]]

Expected (Unparsed): [[[0,0.0],[0,0.0],[0.0,0.0],[0.037302139284169755,0.17524353809998625]]]

Actual:   [[[0, 0], [0, 0], [0, 0], [0.0374, 0.1753]]]

Expected: [[[0, 0], [0, 0], [0, 0], [0.0374, 0.1753]]]