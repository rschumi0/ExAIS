import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave32162 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave32162 = tf.keras.layers.Input(shape=([2, 2]))
in0Con98365 = tf.keras.layers.Input(shape=([2, 4]))
in0Sub80811 = tf.keras.layers.Input(shape=([2, 3, 2]))
in1Sub80811 = tf.keras.layers.Input(shape=([2, 3, 2]))
in0Add79130 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Add79130 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Con91670 = tf.keras.layers.Input(shape=([2, 4]))

Ave32162 = keras.layers.Average(name = 'Ave32162', )([in0Ave32162,in1Ave32162])
Con98365 = keras.layers.Concatenate(axis=2, name = 'Con98365', )([Ave32162,in0Con98365])
Sub80811 = keras.layers.Subtract(name = 'Sub80811', )([in0Sub80811,in1Sub80811])
Res55215 = keras.layers.Reshape((2, 6), name = 'Res55215', )(Sub80811)
Add79130 = keras.layers.Add(name = 'Add79130', )([in0Add79130,in1Add79130])
Res13152 = keras.layers.Reshape((2, 2, 1), name = 'Res13152', )(Add79130)
Res4257 = keras.layers.Reshape((2, 2), name = 'Res4257', )(Res13152)
Per38585 = keras.layers.Permute((2,1), name = 'Per38585',)(Res4257)
Con91670 = keras.layers.Concatenate(axis=2, name = 'Con91670', )([Per38585,in0Con91670])
Ave35961 = keras.layers.Average(name = 'Ave35961', )([Res55215,Con91670])
Add72209 = keras.layers.Add(name = 'Add72209', )([Con98365,Ave35961])
model = tf.keras.models.Model(inputs=[in0Ave32162,in1Ave32162,in0Con98365,in0Sub80811,in1Sub80811,in0Add79130,in1Add79130,in0Con91670], outputs=Add72209)
in0Ave32162 = tf.constant([[[0.1514, 0.2023], [0.9137, 0.6622]]])
in1Ave32162 = tf.constant([[[0.9474, 0.6328], [0.1505, 0.2904]]])
in0Con98365 = tf.constant([[[0.1266, 0.4987, 0.3977, 0.7169], [0.4876, 0.571, 0.6919, 0.7459]]])
in0Sub80811 = tf.constant([[[[0.2035, 0.8884], [0.0806, 0.3218], [0.4949, 0.5217]], [[0.9642, 0.4622], [0.7443, 0.0903], [0.743, 0.3276]]]])
in1Sub80811 = tf.constant([[[[0.4215, 0.1], [0.52, 0.1281], [0.5934, 0.5098]], [[0.8782, 0.3564], [0.9676, 0.3686], [0.375, 0.0646]]]])
in0Add79130 = tf.constant([[[[[0.0018]], [[0.7823]]], [[[0.1886]], [[0.7697]]]]])
in1Add79130 = tf.constant([[[[[0.7449]], [[0.9485]]], [[[0.6846]], [[0.897]]]]])
in0Con91670 = tf.constant([[[0.6218, 0.518, 0.9759, 0.5693], [0.6117, 0.5621, 0.2103, 0.3263]]])
print (np.array2string(model.predict([in0Ave32162,in1Ave32162,in0Con98365,in0Sub80811,in1Sub80811,in0Add79130,in1Add79130,in0Con91670],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add72209.png')

LAve32162 = average_layer([[[[0.1514, 0.2023], [0.9137, 0.6622]]], [[[0.9474, 0.6328], [0.1505, 0.2904]]]], Ave32162), 
LCon98365 = concatenate_layer([Ave32162,[[[0.1266, 0.4987, 0.3977, 0.7169], [0.4876, 0.571, 0.6919, 0.7459]]]], 2, Con98365), 
LSub80811 = subtract_layer([[[[0.2035, 0.8884], [0.0806, 0.3218], [0.4949, 0.5217]], [[0.9642, 0.4622], [0.7443, 0.0903], [0.743, 0.3276]]]], [[[[0.4215, 0.1], [0.52, 0.1281], [0.5934, 0.5098]], [[0.8782, 0.3564], [0.9676, 0.3686], [0.375, 0.0646]]]], Sub80811), 
LRes55215 = reshape_layer(Sub80811, [2, 6], Res55215), 
LAdd79130 = add_layer([[[[[[0.0018]], [[0.7823]]], [[[0.1886]], [[0.7697]]]]], [[[[[0.7449]], [[0.9485]]], [[[0.6846]], [[0.897]]]]]], Add79130), 
LRes13152 = reshape_layer(Add79130, [2, 2, 1], Res13152), 
LRes4257 = reshape_layer(Res13152, [2, 2], Res4257), 
LPer38585 = permute_layer(Res4257, 2,1, Per38585), 
LCon91670 = concatenate_layer([Per38585,[[[0.6218, 0.518, 0.9759, 0.5693], [0.6117, 0.5621, 0.2103, 0.3263]]]], 2, Con91670), 
LAve35961 = average_layer([Res55215,Con91670], Ave35961), 
LAdd72209 = add_layer([Con98365,Ave35961], Add72209), 
exec_layers([LAve32162,LCon98365,LSub80811,LRes55215,LAdd79130,LRes13152,LRes4257,LPer38585,LCon91670,LAve35961,LAdd72209],["Ave32162","Con98365","Sub80811","Res55215","Add79130","Res13152","Res4257","Per38585","Con91670","Ave35961","Add72209"],Add72209,"Add72209")

Actual (Unparsed): [[[0.8137500, 1.2483500, 0.2178000, 0.8545500, 0.8364000, 1.0075000], [1.4405000, 1.3625500, 0.6818000, 0.7129000, 0.9810500, 1.0405500]]]

Expected (Unparsed): [[[0.81375,1.24835,0.2178,0.8545499999999999,0.8364,1.0075],[1.4405,1.36255,0.6818,0.7129,0.98105,1.04055]]]

Actual:   [[[0.8138, 1.2484, 0.2178, 0.8546, 0.8364, 1.0075], [1.4405, 1.3626, 0.6818, 0.7129, 0.9811, 1.0406]]]

Expected: [[[0.8138, 1.2484, 0.2178, 0.8546, 0.8364, 1.0075], [1.4405, 1.3626, 0.6818, 0.7129, 0.9811, 1.0406]]]