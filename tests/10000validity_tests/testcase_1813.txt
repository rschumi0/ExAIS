import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave86737 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Ave86737 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Con13525 = tf.keras.layers.Input(shape=([2, 2]))
in0Ave31789 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Ave31789 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))

Ave86737 = keras.layers.Average(name = 'Ave86737', )([in0Ave86737,in1Ave86737])
Res27685 = keras.layers.Reshape((2, 2, 2), name = 'Res27685', )(Ave86737)
Res19948 = keras.layers.Reshape((2, 4), name = 'Res19948', )(Res27685)
Con13525 = keras.layers.Concatenate(axis=2, name = 'Con13525', )([Res19948,in0Con13525])
Ave31789 = keras.layers.Average(name = 'Ave31789', )([in0Ave31789,in1Ave31789])
Res96972 = keras.layers.Reshape((2, 1, 2), name = 'Res96972', )(Ave31789)
Res9998 = keras.layers.Reshape((2, 2), name = 'Res9998', )(Res96972)
Dot57060 = keras.layers.Dot(axes=(1, 1), name = 'Dot57060', )([Con13525,Res9998])
LST9443 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST9443', )(Dot57060)
Res12313 = keras.layers.Reshape((1, 1), name = 'Res12313', )(LST9443)
Res99412 = keras.layers.Reshape((1, 1, 1), name = 'Res99412', )(Res12313)
Res82067 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res82067', )(Res99412)
Con56959 = keras.layers.Conv3D(2, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con56959', )(Res82067)
model = tf.keras.models.Model(inputs=[in0Ave86737,in1Ave86737,in0Con13525,in0Ave31789,in1Ave31789], outputs=Con56959)
w = model.get_layer('LST9443').get_weights() 
w[0] = np.array([[9, 9, 8, 3], [7, 2, 7, 5]])
w[1] = np.array([[8, 2, 10, 7]])
w[2] = np.array([10, 5, 3, 6])
model.get_layer('LST9443').set_weights(w) 
w = model.get_layer('Con56959').get_weights() 
w[0] = np.array([[[[[0.4895, 0.2651]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con56959').set_weights(w) 
in0Ave86737 = tf.constant([[[[[0.7259], [0.9084]], [[0.2226], [0.1967]]], [[[0.3186], [0.7401]], [[0.2217], [0.3727]]]]])
in1Ave86737 = tf.constant([[[[[0.7738], [0.0131]], [[0.3724], [0.1205]]], [[[0.2834], [0.5647]], [[0.0481], [0.7351]]]]])
in0Con13525 = tf.constant([[[0.5172, 0.5914], [0.013, 0.8247]]])
in0Ave31789 = tf.constant([[[[[0.4059, 0.8006]]], [[[0.0387, 0.2601]]]]])
in1Ave31789 = tf.constant([[[[[0.8876, 0.1305]]], [[[0.416, 0.4912]]]]])
print (np.array2string(model.predict([in0Ave86737,in1Ave86737,in0Con13525,in0Ave31789,in1Ave31789],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con56959.png')

LAve86737 = average_layer([[[[[[0.7259], [0.9084]], [[0.2226], [0.1967]]], [[[0.3186], [0.7401]], [[0.2217], [0.3727]]]]], [[[[[0.7738], [0.0131]], [[0.3724], [0.1205]]], [[[0.2834], [0.5647]], [[0.0481], [0.7351]]]]]], Ave86737), 
LRes27685 = reshape_layer(Ave86737, [2, 2, 2], Res27685), 
LRes19948 = reshape_layer(Res27685, [2, 4], Res19948), 
LCon13525 = concatenate_layer([Res19948,[[[0.5172, 0.5914], [0.013, 0.8247]]]], 2, Con13525), 
LAve31789 = average_layer([[[[[[0.4059, 0.8006]]], [[[0.0387, 0.2601]]]]], [[[[[0.8876, 0.1305]]], [[[0.416, 0.4912]]]]]], Ave31789), 
LRes96972 = reshape_layer(Ave31789, [2, 1, 2], Res96972), 
LRes9998 = reshape_layer(Res96972, [2, 2], Res9998), 
LDot57060 = dot_layer(Con13525,Res9998, 1, 1, Dot57060), 
LLST9443 = lstm_layer(Dot57060,[[9, 9, 8, 3], [7, 2, 7, 5]],[[8, 2, 10, 7]],[10, 5, 3, 6], LST9443), 
LRes12313 = reshape_layer(LST9443, [1, 1], Res12313), 
LRes99412 = reshape_layer(Res12313, [1, 1, 1], Res99412), 
LRes82067 = reshape_layer(Res99412, [1, 1, 1, 1], Res82067), 
LCon56959 = conv3D_layer(Res82067, 1, 1, 1,[[[[[0.4895, 0.2651]]]]],[0, 0], 1, 1, 1, false, 1, 1, 1, Con56959), 
exec_layers([LAve86737,LRes27685,LRes19948,LCon13525,LAve31789,LRes96972,LRes9998,LDot57060,LLST9443,LRes12313,LRes99412,LRes82067,LCon56959],["Ave86737","Res27685","Res19948","Con13525","Ave31789","Res96972","Res9998","Dot57060","LST9443","Res12313","Res99412","Res82067","Con56959"],Con56959,"Con56959")

Actual (Unparsed): [[[[[0.4894940, 0.2650967]]]]]

Expected (Unparsed): [[[[[0.48949396800558514,0.26509673323448546]]]]]

Actual:   [[[[[0.4895, 0.2651]]]]]

Expected: [[[[[0.4895, 0.2651]]]]]