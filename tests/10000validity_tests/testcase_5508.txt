import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add98243 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Add98243 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con40603 = tf.keras.layers.Input(shape=([3, 2]))
in0Dot57761 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot57761 = tf.keras.layers.Input(shape=([3, 3]))

Add98243 = keras.layers.Add(name = 'Add98243', )([in0Add98243,in1Add98243])
Lay11625 = keras.layers.LayerNormalization(axis=3, epsilon=1.3303941842312998, name = 'Lay11625', )(Add98243)
Res70825 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res70825', )(Lay11625)
Glo54210 = keras.layers.GlobalAveragePooling3D(name = 'Glo54210', )(Res70825)
Res24562 = keras.layers.Reshape((1, 1), name = 'Res24562', )(Glo54210)
Res34492 = keras.layers.Reshape((1, 1, 1), name = 'Res34492', )(Res24562)
Cro85166 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro85166', )(Res34492)
Res90042 = keras.layers.Reshape((1, 1), name = 'Res90042', )(Cro85166)
Zer63269 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer63269', )(Res90042)
Con40603 = keras.layers.Concatenate(axis=2, name = 'Con40603', )([Zer63269,in0Con40603])
Dot57761 = keras.layers.Dot(axes=(1, 2), name = 'Dot57761', )([in0Dot57761,in1Dot57761])
Ave83530 = keras.layers.Average(name = 'Ave83530', )([Con40603,Dot57761])
Per34043 = keras.layers.Permute((1,2), name = 'Per34043',)(Ave83530)
model = tf.keras.models.Model(inputs=[in0Add98243,in1Add98243,in0Con40603,in0Dot57761,in1Dot57761], outputs=Per34043)
in0Add98243 = tf.constant([[[[0.8233, 0.1786]]]])
in1Add98243 = tf.constant([[[[0.8927, 0.3696]]]])
in0Con40603 = tf.constant([[[0.0306, 0.0132], [0.9459, 0.4027], [0.119, 0.6846]]])
in0Dot57761 = tf.constant([[[0.6576, 0.6322, 0.2235], [0.4956, 0.6513, 0.6848], [0.8129, 0.6937, 0.9812]]])
in1Dot57761 = tf.constant([[[0.8635, 0.3227, 0.6585], [0.0469, 0.4603, 0.3682], [0.5287, 0.5056, 0.9832]]])
print (np.array2string(model.predict([in0Add98243,in1Add98243,in0Con40603,in0Dot57761,in1Dot57761],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Per34043.png')

LAdd98243 = add_layer([[[[[0.8233, 0.1786]]]], [[[[0.8927, 0.3696]]]]], Add98243), 
LLay11625 = layer_normalization_layer(Add98243, 3, 1.3303941842312998, Lay11625), 
LRes70825 = reshape_layer(Lay11625, [1, 1, 2, 1], Res70825), 
LGlo54210 = global_average_pooling3D_layer(Res70825, Glo54210), 
LRes24562 = reshape_layer(Glo54210, [1, 1], Res24562), 
LRes34492 = reshape_layer(Res24562, [1, 1, 1], Res34492), 
LCro85166 = cropping2D_layer(Res34492, 0, 0, 0, 0, Cro85166), 
LRes90042 = reshape_layer(Cro85166, [1, 1], Res90042), 
LZer63269 = zero_padding1D_layer(Res90042, 2, 0, Zer63269), 
LCon40603 = concatenate_layer([Zer63269,[[[0.0306, 0.0132], [0.9459, 0.4027], [0.119, 0.6846]]]], 2, Con40603), 
LDot57761 = dot_layer([[[0.6576, 0.6322, 0.2235], [0.4956, 0.6513, 0.6848], [0.8129, 0.6937, 0.9812]]], [[[0.8635, 0.3227, 0.6585], [0.0469, 0.4603, 0.3682], [0.5287, 0.5056, 0.9832]]], 1, 2, Dot57761), 
LAve83530 = average_layer([Con40603,Dot57761], Ave83530), 
LPer34043 = permute_layer(Ave83530, 1,2, Per34043), 
exec_layers([LAdd98243,LLay11625,LRes70825,LGlo54210,LRes24562,LRes34492,LCro85166,LRes90042,LZer63269,LCon40603,LDot57761,LAve83530,LPer34043],["Add98243","Lay11625","Res70825","Glo54210","Res24562","Res34492","Cro85166","Res90042","Zer63269","Con40603","Dot57761","Ave83530","Per34043"],Per34043,"Per34043")

Actual (Unparsed): [[[0.6315312, 0.2944379, 0.7053459], [0.6064403, 0.7653820, 0.8741436], [0.5300487, 0.4029867, 1.0568576]]]

Expected (Unparsed): [[[0.6315311849999999,0.29443794999999995,0.70534588],[0.60644033,0.7653819550000001,0.87414363],[0.530048705,0.402986715,1.056857585]]]

Actual:   [[[0.6316, 0.2945, 0.7054], [0.6065, 0.7654, 0.8742], [0.5301, 0.403, 1.0569]]]

Expected: [[[0.6316, 0.2945, 0.7054], [0.6065, 0.7654, 0.8742], [0.5301, 0.403, 1.0569]]]