import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave37679 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Ave37679 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con60778 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Up_42837 = tf.keras.layers.Input(shape=([3, 2, 1, 2]))
in0Con78394 = tf.keras.layers.Input(shape=([2]))

Ave37679 = keras.layers.Average(name = 'Ave37679', )([in0Ave37679,in1Ave37679])
Res93220 = keras.layers.Reshape((2, 1), name = 'Res93220', )(Ave37679)
Con2892 = keras.layers.Conv1D(2, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con2892', )(Res93220)
Fla70911 = keras.layers.Flatten(name = 'Fla70911', )(Con2892)
Con60778 = keras.layers.Conv3D(4, (1, 2, 1),strides=(1, 7, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con60778', )(in0Con60778)
Res64055 = keras.layers.Reshape((2, 1, 4), name = 'Res64055', )(Con60778)
Res84091 = keras.layers.Reshape((2, 4), name = 'Res84091', )(Res64055)
Loc23206 = keras.layers.LocallyConnected1D(4, (2),strides=(1), name = 'Loc23206', )(Res84091)
Up_42837 = keras.layers.UpSampling3D(size=(2, 1, 1), name = 'Up_42837', )(in0Up_42837)
Res45888 = keras.layers.Reshape((6, 2, 2), name = 'Res45888', )(Up_42837)
Res43749 = keras.layers.Reshape((6, 4), name = 'Res43749', )(Res45888)
Dot5178 = keras.layers.Dot(axes=(2, 2), name = 'Dot5178', )([Loc23206,Res43749])
Sim20038 = keras.layers.SimpleRNN(2,name = 'Sim20038', )(Dot5178)
ReL7361 = keras.layers.ReLU(max_value=5.750867051996649, negative_slope=0.4140029630137059, threshold=9.927231974229798, name = 'ReL7361', )(Sim20038)
Con78394 = keras.layers.Concatenate(axis=1, name = 'Con78394', )([ReL7361,in0Con78394])
Mul75491 = keras.layers.Multiply(name = 'Mul75491', )([Fla70911,Con78394])
model = tf.keras.models.Model(inputs=[in0Ave37679,in1Ave37679,in0Con60778,in0Up_42837,in0Con78394], outputs=Mul75491)
w = model.get_layer('Con2892').get_weights() 
w[0] = np.array([[[0.7271, 0.0202]]])
w[1] = np.array([0, 0])
model.get_layer('Con2892').set_weights(w) 
w = model.get_layer('Con60778').get_weights() 
w[0] = np.array([[[[[0.5358, 0.4607, 0.9694, 0.8408], [0.5342, 0.6613, 0.8646, 0.9274]]], [[[0.9575, 0.964, 0.7423, 0.7101], [0.2154, 0.9749, 0.5743, 0.2847]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con60778').set_weights(w) 
w = model.get_layer('Loc23206').get_weights() 
w[0] = np.array([[[0.8843, 0.1202, 0.3481, 0.4238], [0.1739, 0.5523, 0.0431, 0.5092], [0.959, 0.6964, 0.6574, 0.9169], [0.8825, 0.3604, 0.7833, 0.9195], [0.5285, 0.0474, 0.1869, 0.2201], [0.4402, 0.3036, 0.4501, 0.5089], [0.3233, 0.4435, 0.9218, 0.1936], [0.0353, 0.6193, 0.1503, 0.6621]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc23206').set_weights(w) 
w = model.get_layer('Sim20038').get_weights() 
w[0] = np.array([[3, 8], [7, 1], [8, 5], [1, 4], [7, 1], [10, 1]])
w[1] = np.array([[1, 10], [6, 4]])
w[2] = np.array([5, 6])
model.get_layer('Sim20038').set_weights(w) 
in0Ave37679 = tf.constant([[[[0.6722]], [[0.6612]]]])
in1Ave37679 = tf.constant([[[[0.5994]], [[0.8509]]]])
in0Con60778 = tf.constant([[[[[0.1734, 0.5887]], [[0.2398, 0.4282]]], [[[0.9189, 0.2149]], [[0.1378, 0.8823]]]]])
in0Up_42837 = tf.constant([[[[[1.3512, 1.1311]], [[1.9419, 1.6493]]], [[[1.8216, 1.9365]], [[1.0093, 1.4051]]], [[[1.2715, 1.5697]], [[1.8988, 1.084]]]]])
in0Con78394 = tf.constant([[0.5436, 0.3263]])
print (np.array2string(model.predict([in0Ave37679,in1Ave37679,in0Con60778,in0Up_42837,in0Con78394],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul75491.png')

LAve37679 = average_layer([[[[[0.6722]], [[0.6612]]]], [[[[0.5994]], [[0.8509]]]]], Ave37679), 
LRes93220 = reshape_layer(Ave37679, [2, 1], Res93220), 
LCon2892 = conv1D_layer(Res93220, 1,[[[0.7271, 0.0202]]],[0, 0], 1, false, 1, Con2892), 
LFla70911 = flatten_layer(Con2892, Fla70911), 
LCon60778 = conv3D_layer([[[[[0.1734, 0.5887]], [[0.2398, 0.4282]]], [[[0.9189, 0.2149]], [[0.1378, 0.8823]]]]], 1, 2, 1,[[[[[0.5358, 0.4607, 0.9694, 0.8408], [0.5342, 0.6613, 0.8646, 0.9274]]], [[[0.9575, 0.964, 0.7423, 0.7101], [0.2154, 0.9749, 0.5743, 0.2847]]]]],[0, 0, 0, 0], 1, 7, 1, false, 1, 1, 1, Con60778), 
LRes64055 = reshape_layer(Con60778, [2, 1, 4], Res64055), 
LRes84091 = reshape_layer(Res64055, [2, 4], Res84091), 
LLoc23206 = locally_connected1D_layer(Res84091, 2,[[[0.8843, 0.1202, 0.3481, 0.4238], [0.1739, 0.5523, 0.0431, 0.5092], [0.959, 0.6964, 0.6574, 0.9169], [0.8825, 0.3604, 0.7833, 0.9195], [0.5285, 0.0474, 0.1869, 0.2201], [0.4402, 0.3036, 0.4501, 0.5089], [0.3233, 0.4435, 0.9218, 0.1936], [0.0353, 0.6193, 0.1503, 0.6621]]],[[0, 0, 0, 0]], 1, Loc23206), 
LUp_42837 = up_sampling3D_layer([[[[[1.3512, 1.1311]], [[1.9419, 1.6493]]], [[[1.8216, 1.9365]], [[1.0093, 1.4051]]], [[[1.2715, 1.5697]], [[1.8988, 1.084]]]]], 2, 1, 1, Up_42837), 
LRes45888 = reshape_layer(Up_42837, [6, 2, 2], Res45888), 
LRes43749 = reshape_layer(Res45888, [6, 4], Res43749), 
LDot5178 = dot_layer(Loc23206,Res43749, 2, 2, Dot5178), 
LSim20038 = simple_rnn_layer(Dot5178,[[3, 8], [7, 1], [8, 5], [1, 4], [7, 1], [10, 1]],[[1, 10], [6, 4]],[5, 6], Sim20038), 
LReL7361 = relu_layer(Sim20038, 5.750867051996649, 0.4140029630137059, 9.927231974229798, ReL7361), 
LCon78394 = concatenate_layer([ReL7361,[[0.5436, 0.3263]]], 1, Con78394), 
LMul75491 = multiply_layer([Fla70911,Con78394], Mul75491), 
exec_layers([LAve37679,LRes93220,LCon2892,LFla70911,LCon60778,LRes64055,LRes84091,LLoc23206,LUp_42837,LRes45888,LRes43749,LDot5178,LSim20038,LReL7361,LCon78394,LMul75491],["Ave37679","Res93220","Con2892","Fla70911","Con60778","Res64055","Res84091","Loc23206","Up_42837","Res45888","Res43749","Dot5178","Sim20038","ReL7361","Con78394","Mul75491"],Mul75491,"Mul75491")

Actual (Unparsed): [[-1.7085785, -0.0474670, 0.2988300, 0.0049833]]

Expected (Unparsed): [[-1.7085785022487785,-0.04746704132227386,0.29882994193799994,0.004983322122999999]]

Actual:   [[-1.7085, -0.0474, 0.2989, 0.005]]

Expected: [[-1.7085, -0.0474, 0.2989, 0.005]]