import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot9414 = tf.keras.layers.Input(shape=([3]))
in1Dot9414 = tf.keras.layers.Input(shape=([3]))
in0Con40119 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Mul4708 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Mul4708 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in0Add13378 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Add13378 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Con43499 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))

Dot9414 = keras.layers.Dot(axes=(1, 1), name = 'Dot9414', )([in0Dot9414,in1Dot9414])
Res83557 = keras.layers.Reshape((1, 1), name = 'Res83557', )(Dot9414)
Res7328 = keras.layers.Reshape((1, 1, 1), name = 'Res7328', )(Res83557)
Res34821 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res34821', )(Res7328)
Zer24742 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (0, 0)), name = 'Zer24742', )(Res34821)
Con40119 = keras.layers.Concatenate(axis=4, name = 'Con40119', )([Zer24742,in0Con40119])
Mul4708 = keras.layers.Multiply(name = 'Mul4708', )([in0Mul4708,in1Mul4708])
Zer45845 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (0, 0)), name = 'Zer45845', )(Mul4708)
Add13378 = keras.layers.Add(name = 'Add13378', )([in0Add13378,in1Add13378])
Con43499 = keras.layers.Concatenate(axis=4, name = 'Con43499', )([Add13378,in0Con43499])
Min33571 = keras.layers.Minimum(name = 'Min33571', )([Zer45845,Con43499])
Sof69696 = keras.layers.Softmax(axis=1, name = 'Sof69696', )(Min33571)
Mul68117 = keras.layers.Multiply(name = 'Mul68117', )([Con40119,Sof69696])
Res85384 = keras.layers.Reshape((2, 2, 2), name = 'Res85384', )(Mul68117)
Loc53339 = keras.layers.LocallyConnected2D(2, (2, 2),strides=(1, 1), name = 'Loc53339', )(Res85384)
model = tf.keras.models.Model(inputs=[in0Dot9414,in1Dot9414,in0Con40119,in0Mul4708,in1Mul4708,in0Add13378,in1Add13378,in0Con43499], outputs=Loc53339)
w = model.get_layer('Loc53339').get_weights() 
w[0] = np.array([[[0.4541, 0.0991], [0.4271, 0.06], [0.6424, 0.865], [0.6653, 0.4981], [0.7235, 0.4765], [0.3025, 0.1061], [0.5711, 0.9398], [0.3714, 0.5276]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc53339').set_weights(w) 
in0Dot9414 = tf.constant([[0.5104, 0.461, 0.2337]])
in1Dot9414 = tf.constant([[0.1046, 0.5303, 0.23]])
in0Con40119 = tf.constant([[[[[0.8063]], [[0.5542]]], [[[0.2605]], [[0.5489]]]]])
in0Mul4708 = tf.constant([[[[[0.8696, 0.4546]]]]])
in1Mul4708 = tf.constant([[[[[0.6893, 0.0166]]]]])
in0Add13378 = tf.constant([[[[[0.8564]], [[0.0087]]], [[[0.8402]], [[0.2349]]]]])
in1Add13378 = tf.constant([[[[[0.5968]], [[0.7846]]], [[[0.3388]], [[0.3847]]]]])
in0Con43499 = tf.constant([[[[[0.271]], [[0.5768]]], [[[0.2027]], [[0.6045]]]]])
print (np.array2string(model.predict([in0Dot9414,in1Dot9414,in0Con40119,in0Mul4708,in1Mul4708,in0Add13378,in1Add13378,in0Con43499],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc53339.png')

LDot9414 = dot_layer([[0.5104, 0.461, 0.2337]], [[0.1046, 0.5303, 0.23]], 1, 1, Dot9414), 
LRes83557 = reshape_layer(Dot9414, [1, 1], Res83557), 
LRes7328 = reshape_layer(Res83557, [1, 1, 1], Res7328), 
LRes34821 = reshape_layer(Res7328, [1, 1, 1, 1], Res34821), 
LZer24742 = zero_padding3D_layer(Res34821, 1, 0, 1, 0, 0, 0, Zer24742), 
LCon40119 = concatenate_layer([Zer24742,[[[[[0.8063]], [[0.5542]]], [[[0.2605]], [[0.5489]]]]]], 4, Con40119), 
LMul4708 = multiply_layer([[[[[[0.8696, 0.4546]]]]], [[[[[0.6893, 0.0166]]]]]], Mul4708), 
LZer45845 = zero_padding3D_layer(Mul4708, 1, 0, 1, 0, 0, 0, Zer45845), 
LAdd13378 = add_layer([[[[[[0.8564]], [[0.0087]]], [[[0.8402]], [[0.2349]]]]], [[[[[0.5968]], [[0.7846]]], [[[0.3388]], [[0.3847]]]]]], Add13378), 
LCon43499 = concatenate_layer([Add13378,[[[[[0.271]], [[0.5768]]], [[[0.2027]], [[0.6045]]]]]], 4, Con43499), 
LMin33571 = minimum_layer([Zer45845,Con43499], Min33571), 
LSof69696 = softmax_layer(Min33571, 1, Sof69696), 
LMul68117 = multiply_layer([Con40119,Sof69696], Mul68117), 
LRes85384 = reshape_layer(Mul68117, [2, 2, 2], Res85384), 
LLoc53339 = locally_connected2D_layer(Res85384, 2, 2,[[[0.4541, 0.0991], [0.4271, 0.06], [0.6424, 0.865], [0.6653, 0.4981], [0.7235, 0.4765], [0.3025, 0.1061], [0.5711, 0.9398], [0.3714, 0.5276]]],[[[0, 0]]], 1, 1, Loc53339), 
exec_layers([LDot9414,LRes83557,LRes7328,LRes34821,LZer24742,LCon40119,LMul4708,LZer45845,LAdd13378,LCon43499,LMin33571,LSof69696,LMul68117,LRes85384,LLoc53339],["Dot9414","Res83557","Res7328","Res34821","Zer24742","Con40119","Mul4708","Zer45845","Add13378","Con43499","Min33571","Sof69696","Mul68117","Res85384","Loc53339"],Loc53339,"Loc53339")

Actual (Unparsed): [[[[0.6271831, 0.5341641]]]]

Expected (Unparsed): [[[[0.6271831050733763,0.5341641365273817]]]]

Actual:   [[[[0.6272, 0.5342]]]]

Expected: [[[[0.6272, 0.5342]]]]