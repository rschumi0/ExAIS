import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0ELU22966 = tf.keras.layers.Input(shape=([2, 1]))
in0Ave78633 = tf.keras.layers.Input(shape=([1, 1]))
in1Ave78633 = tf.keras.layers.Input(shape=([1, 1]))
in0Con22645 = tf.keras.layers.Input(shape=([5, 3, 1]))

ELU22966 = keras.layers.ELU(alpha=-3.2790952855917332, name = 'ELU22966', input_shape=(2, 1))(in0ELU22966)
Res12254 = keras.layers.Reshape((2, 1, 1), name = 'Res12254', )(ELU22966)
Loc5829 = keras.layers.LocallyConnected2D(4, (1, 1),strides=(1, 1), name = 'Loc5829', )(Res12254)
Zer20118 = keras.layers.ZeroPadding2D(padding=((3, 0), (2, 0)), name = 'Zer20118', )(Loc5829)
Ave78633 = keras.layers.Average(name = 'Ave78633', )([in0Ave78633,in1Ave78633])
Zer94707 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer94707', )(Ave78633)
Res62140 = keras.layers.Reshape((3, 1, 1), name = 'Res62140', )(Zer94707)
Loc85581 = keras.layers.LocallyConnected2D(3, (1, 1),strides=(1, 1), name = 'Loc85581', )(Res62140)
Zer24268 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer24268', )(Loc85581)
Con22645 = keras.layers.Concatenate(axis=3, name = 'Con22645', )([Zer24268,in0Con22645])
Add63937 = keras.layers.Add(name = 'Add63937', )([Zer20118,Con22645])
model = tf.keras.models.Model(inputs=[in0ELU22966,in0Ave78633,in1Ave78633,in0Con22645], outputs=Add63937)
w = model.get_layer('Loc5829').get_weights() 
w[0] = np.array([[[0.3805, 0.22, 0.826, 0.2111]], [[0.6562, 0.7437, 0.4716, 0.9648]]])
w[1] = np.array([[[0, 0, 0, 0]], [[0, 0, 0, 0]]])
model.get_layer('Loc5829').set_weights(w) 
w = model.get_layer('Loc85581').get_weights() 
w[0] = np.array([[[0.0263, 0.2038, 0.3817]], [[0.05, 0.7468, 0.281]], [[0.1872, 0.478, 0.9218]]])
w[1] = np.array([[[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]]])
model.get_layer('Loc85581').set_weights(w) 
in0ELU22966 = tf.constant([[[0.5654], [0.1614]]])
in0Ave78633 = tf.constant([[[0.4584]]])
in1Ave78633 = tf.constant([[[0.6041]]])
in0Con22645 = tf.constant([[[[0.1002], [0.5238], [0.3874]], [[0.8635], [0.6754], [0.0482]], [[0.8195], [0.9097], [0.5466]], [[0.8577], [0.4875], [0.5444]], [[0.2633], [0.6718], [0.7343]]]])
print (np.array2string(model.predict([in0ELU22966,in0Ave78633,in1Ave78633,in0Con22645],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add63937.png')

LELU22966 = elu_layer([[[0.5654], [0.1614]]], -3.2790952855917332, ELU22966), 
LRes12254 = reshape_layer(ELU22966, [2, 1, 1], Res12254), 
LLoc5829 = locally_connected2D_layer(Res12254, 1, 1,[[[0.3805, 0.22, 0.826, 0.2111]], [[0.6562, 0.7437, 0.4716, 0.9648]]],[[[0, 0, 0, 0]], [[0, 0, 0, 0]]], 1, 1, Loc5829), 
LZer20118 = zero_padding2D_layer(Loc5829, 3, 0, 2, 0, Zer20118), 
LAve78633 = average_layer([[[[0.4584]]], [[[0.6041]]]], Ave78633), 
LZer94707 = zero_padding1D_layer(Ave78633, 1, 1, Zer94707), 
LRes62140 = reshape_layer(Zer94707, [3, 1, 1], Res62140), 
LLoc85581 = locally_connected2D_layer(Res62140, 1, 1,[[[0.0263, 0.2038, 0.3817]], [[0.05, 0.7468, 0.281]], [[0.1872, 0.478, 0.9218]]],[[[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]]], 1, 1, Loc85581), 
LZer24268 = zero_padding2D_layer(Loc85581, 1, 1, 1, 1, Zer24268), 
LCon22645 = concatenate_layer([Zer24268,[[[[0.1002], [0.5238], [0.3874]], [[0.8635], [0.6754], [0.0482]], [[0.8195], [0.9097], [0.5466]], [[0.8577], [0.4875], [0.5444]], [[0.2633], [0.6718], [0.7343]]]]], 3, Con22645), 
LAdd63937 = add_layer([Zer20118,Con22645], Add63937), 
exec_layers([LELU22966,LRes12254,LLoc5829,LZer20118,LAve78633,LZer94707,LRes62140,LLoc85581,LZer24268,LCon22645,LAdd63937],["ELU22966","Res12254","Loc5829","Zer20118","Ave78633","Zer94707","Res62140","Loc85581","Zer24268","Con22645","Add63937"],Add63937,"Add63937")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000000, 0.1002000], [0.0000000, 0.0000000, 0.0000000, 0.5238000], [0.0000000, 0.0000000, 0.0000000, 0.3874000]], [[0.0000000, 0.0000000, 0.0000000, 0.8635000], [0.0000000, 0.0000000, 0.0000000, 0.6754000], [0.0000000, 0.0000000, 0.0000000, 0.0482000]], [[0.0000000, 0.0000000, 0.0000000, 0.8195000], [0.0265625, 0.3967375, 0.1492813, 0.9097000], [0.0000000, 0.0000000, 0.0000000, 0.5466000]], [[0.0000000, 0.0000000, 0.0000000, 0.8577000], [0.0000000, 0.0000000, 0.0000000, 0.4875000], [0.2151347, 0.1243880, 0.4670204, 0.6637559]], [[0.0000000, 0.0000000, 0.0000000, 0.2633000], [0.0000000, 0.0000000, 0.0000000, 0.6718000], [0.1059107, 0.1200332, 0.0761162, 0.8900187]]]]

Expected (Unparsed): [[[[0,0,0,0.1002],[0,0,0,0.5238],[0,0,0,0.3874]],[[0,0,0,0.8635],[0.0,0.0,0.0,0.6754],[0,0,0,0.0482]],[[0,0,0,0.8195],[0.026562500000000003,0.3967375,0.14928125,0.9097],[0,0,0,0.5466]],[[0,0,0,0.8577],[0.0,0.0,0.0,0.4875],[0.2151347,0.124388,0.4670204,0.66375594]],[[0,0,0,0.2633],[0,0,0,0.6718],[0.10591068,0.12003317999999999,0.07611624,0.8900187199999999]]]]

Actual:   [[[[0, 0, 0, 0.1002], [0, 0, 0, 0.5238], [0, 0, 0, 0.3874]], [[0, 0, 0, 0.8635], [0, 0, 0, 0.6754], [0, 0, 0, 0.0482]], [[0, 0, 0, 0.8195], [0.0266, 0.3968, 0.1493, 0.9097], [0, 0, 0, 0.5466]], [[0, 0, 0, 0.8577], [0, 0, 0, 0.4875], [0.2152, 0.1244, 0.4671, 0.6638]], [[0, 0, 0, 0.2633], [0, 0, 0, 0.6718], [0.106, 0.1201, 0.0762, 0.8901]]]]

Expected: [[[[0, 0, 0, 0.1002], [0, 0, 0, 0.5238], [0, 0, 0, 0.3874]], [[0, 0, 0, 0.8635], [0, 0, 0, 0.6754], [0, 0, 0, 0.0482]], [[0, 0, 0, 0.8195], [0.0266, 0.3968, 0.1493, 0.9097], [0, 0, 0, 0.5466]], [[0, 0, 0, 0.8577], [0, 0, 0, 0.4875], [0.2152, 0.1244, 0.4671, 0.6638]], [[0, 0, 0, 0.2633], [0, 0, 0, 0.6718], [0.106, 0.1201, 0.0762, 0.8901]]]]