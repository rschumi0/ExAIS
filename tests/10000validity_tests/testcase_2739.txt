import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Up_79717 = tf.keras.layers.Input(shape=([1, 3, 1]))
in0Ave46261 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Ave46261 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con8540 = tf.keras.layers.Input(shape=([2, 3, 1]))

Up_79717 = keras.layers.UpSampling2D(size=(2, 1), name = 'Up_79717', )(in0Up_79717)
Res93454 = keras.layers.Reshape((2, 3, 1, 1), name = 'Res93454', )(Up_79717)
Con78372 = keras.layers.Conv3D(3, (2, 3, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con78372', )(Res93454)
Res39059 = keras.layers.Reshape((2, 3, 3), name = 'Res39059', )(Con78372)
Ave46261 = keras.layers.Average(name = 'Ave46261', )([in0Ave46261,in1Ave46261])
Zer71700 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer71700', )(Ave46261)
Con8540 = keras.layers.Concatenate(axis=3, name = 'Con8540', )([Zer71700,in0Con8540])
Add41336 = keras.layers.Add(name = 'Add41336', )([Res39059,Con8540])
model = tf.keras.models.Model(inputs=[in0Up_79717,in0Ave46261,in1Ave46261,in0Con8540], outputs=Add41336)
w = model.get_layer('Con78372').get_weights() 
w[0] = np.array([[[[[0.9271, 0.2203, 0.7641]]], [[[0.4192, 0.3513, 0.3581]]], [[[0.5442, 0.904, 0.712]]]], [[[[0.634, 0.1258, 0.7815]]], [[[0.5232, 0.3697, 0.639]]], [[[0.6457, 0.0311, 0.8144]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con78372').set_weights(w) 
in0Up_79717 = tf.constant([[[[1.0837], [1.0257], [1.0231]]]])
in0Ave46261 = tf.constant([[[[0.1761, 0.2003]], [[0.8474, 0.5186]]]])
in1Ave46261 = tf.constant([[[[0.9506, 0.6758]], [[0.8289, 0.9673]]]])
in0Con8540 = tf.constant([[[[0.3973], [0.4496], [0.805]], [[0.2433], [0.0138], [0.8457]]]])
print (np.array2string(model.predict([in0Up_79717,in0Ave46261,in1Ave46261,in0Con8540],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add41336.png')

LUp_79717 = up_sampling2D_layer([[[[1.0837], [1.0257], [1.0231]]]], 2, 1, Up_79717), 
LRes93454 = reshape_layer(Up_79717, [2, 3, 1, 1], Res93454), 
LCon78372 = conv3D_layer(Res93454, 2, 3, 1,[[[[[0.9271, 0.2203, 0.7641]]], [[[0.4192, 0.3513, 0.3581]]], [[[0.5442, 0.904, 0.712]]]], [[[[0.634, 0.1258, 0.7815]]], [[[0.5232, 0.3697, 0.639]]], [[[0.6457, 0.0311, 0.8144]]]]],[0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con78372), 
LRes39059 = reshape_layer(Con78372, [2, 3, 3], Res39059), 
LAve46261 = average_layer([[[[[0.1761, 0.2003]], [[0.8474, 0.5186]]]], [[[[0.9506, 0.6758]], [[0.8289, 0.9673]]]]], Ave46261), 
LZer71700 = zero_padding2D_layer(Ave46261, 0, 0, 2, 0, Zer71700), 
LCon8540 = concatenate_layer([Zer71700,[[[[0.3973], [0.4496], [0.805]], [[0.2433], [0.0138], [0.8457]]]]], 3, Con8540), 
LAdd41336 = add_layer([Res39059,Con8540], Add41336), 
exec_layers([LUp_79717,LRes93454,LCon78372,LRes39059,LAve46261,LZer71700,LCon8540,LAdd41336],["Up_79717","Res93454","Con78372","Res39059","Ave46261","Zer71700","Con8540","Add41336"],Add41336,"Add41336")

Actual (Unparsed): [[[[2.2417592, 1.7404797, 3.0434857], [3.8757703, 2.0712991, 4.7089520], [3.1287397, 1.5306999, 3.4104549]], [[1.0124729, 1.3079366, 1.3616713], [1.9914427, 1.5239499, 1.9376055], [2.2179600, 1.3283267, 1.9958095]]]]

Expected (Unparsed): [[[[2.24175931,1.74047977,3.04348575],[3.8757704400000006,2.07129908,4.70895203],[3.1287397099999996,1.5306998699999999,3.41045493]],[[1.01247298,1.30793661,1.36167137],[1.9914427300000004,1.52394992,1.93760554],[2.2179599899999998,1.32832674,1.9958094800000001]]]]

Actual:   [[[[2.2418, 1.7405, 3.0435], [3.8758, 2.0713, 4.709], [3.1288, 1.5307, 3.4105]], [[1.0125, 1.308, 1.3617], [1.9915, 1.524, 1.9377], [2.218, 1.3284, 1.9959]]]]

Expected: [[[[2.2418, 1.7405, 3.0435], [3.8758, 2.0713, 4.709], [3.1288, 1.5307, 3.4105]], [[1.0125, 1.308, 1.3617], [1.9915, 1.524, 1.9377], [2.218, 1.3284, 1.9959]]]]