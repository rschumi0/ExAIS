import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add362 = tf.keras.layers.Input(shape=([1, 1]))
in1Add362 = tf.keras.layers.Input(shape=([1, 1]))
in0Dep74315 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Dot85785 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot85785 = tf.keras.layers.Input(shape=([2, 3]))

Add362 = keras.layers.Add(name = 'Add362', )([in0Add362,in1Add362])
Fla15681 = keras.layers.Flatten(name = 'Fla15681', )(Add362)
Dep74315 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='same', name = 'Dep74315', )(in0Dep74315)
Den56314 = keras.layers.Dense(1,name = 'Den56314', )(Dep74315)
Res70979 = keras.layers.Reshape((1, 1), name = 'Res70979', )(Den56314)
Fla27634 = keras.layers.Flatten(name = 'Fla27634', )(Res70979)
Dot85785 = keras.layers.Dot(axes=(1, 1), name = 'Dot85785', )([in0Dot85785,in1Dot85785])
Res13879 = keras.layers.Reshape((3, 3, 1), name = 'Res13879', )(Dot85785)
Res98542 = keras.layers.Reshape((3, 3, 1, 1), name = 'Res98542', )(Res13879)
Glo43859 = keras.layers.GlobalMaxPool3D(name = 'Glo43859', )(Res98542)
Dot90652 = keras.layers.Dot(axes=(1, 1), name = 'Dot90652', )([Fla27634,Glo43859])
Mul80503 = keras.layers.Multiply(name = 'Mul80503', )([Fla15681,Dot90652])
model = tf.keras.models.Model(inputs=[in0Add362,in1Add362,in0Dep74315,in0Dot85785,in1Dot85785], outputs=Mul80503)
w = model.get_layer('Dep74315').get_weights() 
w[0] = np.array([[[[0.878], [0.8749]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep74315').set_weights(w) 
w = model.get_layer('Den56314').get_weights() 
w[0] = np.array([[0.0083], [0.8757]])
w[1] = np.array([0.9016])
model.get_layer('Den56314').set_weights(w) 
in0Add362 = tf.constant([[[0.6773]]])
in1Add362 = tf.constant([[[0.255]]])
in0Dep74315 = tf.constant([[[[0.1335, 0.9558]]]])
in0Dot85785 = tf.constant([[[0.2987, 0.2378, 0.9798], [0.0788, 0.1066, 0.9678]]])
in1Dot85785 = tf.constant([[[0.657, 0.7431, 0.1901], [0.3866, 0.1819, 0.3573]]])
print (np.array2string(model.predict([in0Add362,in1Add362,in0Dep74315,in0Dot85785,in1Dot85785],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul80503.png')

LAdd362 = add_layer([[[[0.6773]]], [[[0.255]]]], Add362), 
LFla15681 = flatten_layer(Add362, Fla15681), 
LDep74315 = depthwise_conv2D_layer([[[[0.1335, 0.9558]]]], 1, 1,[[[[0.878], [0.8749]]]],[0, 0], 1, 1, true, Dep74315), 
LDen56314 = dense_layer(Dep74315, [[0.0083], [0.8757]],[0.9016], Den56314), 
LRes70979 = reshape_layer(Den56314, [1, 1], Res70979), 
LFla27634 = flatten_layer(Res70979, Fla27634), 
LDot85785 = dot_layer([[[0.2987, 0.2378, 0.9798], [0.0788, 0.1066, 0.9678]]], [[[0.657, 0.7431, 0.1901], [0.3866, 0.1819, 0.3573]]], 1, 1, Dot85785), 
LRes13879 = reshape_layer(Dot85785, [3, 3, 1], Res13879), 
LRes98542 = reshape_layer(Res13879, [3, 3, 1, 1], Res98542), 
LGlo43859 = global_max_pool3D_layer(Res98542, Glo43859), 
LDot90652 = dot_layer(Fla27634,Glo43859, 1, 1, Dot90652), 
LMul80503 = multiply_layer([Fla15681,Dot90652], Mul80503), 
exec_layers([LAdd362,LFla15681,LDep74315,LDen56314,LRes70979,LFla27634,LDot85785,LRes13879,LRes98542,LGlo43859,LDot90652,LMul80503],["Add362","Fla15681","Dep74315","Den56314","Res70979","Fla27634","Dot85785","Res13879","Res98542","Glo43859","Dot90652","Mul80503"],Mul80503,"Mul80503")

Actual (Unparsed): [[1.5514314]]

Expected (Unparsed): [[1.5514314614456273]]

Actual:   [[1.5515]]

Expected: [[1.5515]]