import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave21208 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave21208 = tf.keras.layers.Input(shape=([2, 2, 1]))

Ave21208 = keras.layers.Average(name = 'Ave21208', )([in0Ave21208,in1Ave21208])
Dep66592 = keras.layers.DepthwiseConv2D((2, 1),strides=(1, 1), padding='same', name = 'Dep66592', )(Ave21208)
Res10940 = keras.layers.Reshape((2, 2), name = 'Res10940', )(Dep66592)
Zer67942 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer67942', )(Res10940)
Sep65228 = keras.layers.SeparableConv1D(4, (1),strides=(1), padding='same', name = 'Sep65228', )(Zer67942)
Bat47823 = keras.layers.BatchNormalization(axis=2, epsilon=0.3473480082558672,  name = 'Bat47823', )(Sep65228)
model = tf.keras.models.Model(inputs=[in0Ave21208,in1Ave21208], outputs=Bat47823)
w = model.get_layer('Dep66592').get_weights() 
w[0] = np.array([[[[0.5924]]], [[[0.7869]]]])
w[1] = np.array([0])
model.get_layer('Dep66592').set_weights(w) 
w = model.get_layer('Sep65228').get_weights() 
w[0] = np.array([[[0.0137], [0.0393]]])
w[1] = np.array([[[0.2381, 0.8227, 0.6917, 0.0305], [0.3349, 0.1606, 0.3771, 0.471]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep65228').set_weights(w) 
w = model.get_layer('Bat47823').get_weights() 
w[0] = np.array([0.025, 0.0126, 0.4288, 0.4606])
w[1] = np.array([0.2183, 0.9576, 0.806, 0.0487])
w[2] = np.array([0.9411, 0.173, 0.8645, 0.2889])
w[3] = np.array([0.9291, 0.4926, 0.6595, 0.5839])
model.get_layer('Bat47823').set_weights(w) 
in0Ave21208 = tf.constant([[[[0.7595], [0.5662]], [[0.5589], [0.2395]]]])
in1Ave21208 = tf.constant([[[[0.646], [0.8944]], [[0.8245], [0.623]]]])
print (np.array2string(model.predict([in0Ave21208,in1Ave21208],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Bat47823.png')

LAve21208 = average_layer([[[[[0.7595], [0.5662]], [[0.5589], [0.2395]]]], [[[[0.646], [0.8944]], [[0.8245], [0.623]]]]], Ave21208), 
LDep66592 = depthwise_conv2D_layer(Ave21208, 2, 1,[[[[0.5924]]], [[[0.7869]]]],[0], 1, 1, true, Dep66592), 
LRes10940 = reshape_layer(Dep66592, [2, 2], Res10940), 
LZer67942 = zero_padding1D_layer(Res10940, 1, 1, Zer67942), 
LSep65228 = separable_conv1D_layer(Zer67942, 1,[[[[0.0137], [0.0393]]],[[[0.2381, 0.8227, 0.6917, 0.0305], [0.3349, 0.1606, 0.3771, 0.471]]]],[0, 0, 0, 0], 1, true, Sep65228), 
LBat47823 = batch_normalization_layer(Sep65228, 2, 0.3473480082558672, [0.025, 0.0126, 0.4288, 0.4606], [0.2183, 0.9576, 0.806, 0.0487], [0.9411, 0.173, 0.8645, 0.2889], [0.9291, 0.4926, 0.6595, 0.5839], Bat47823), 
exec_layers([LAve21208,LDep66592,LRes10940,LZer67942,LSep65228,LBat47823],["Ave21208","Dep66592","Res10940","Zer67942","Sep65228","Bat47823"],Bat47823,"Bat47823")

Actual (Unparsed): [[[0.1974755, 0.9552216, 0.4365652, -0.0891919], [0.1977697, 0.9554374, 0.4453443, -0.0821799], [0.1975795, 0.9553072, 0.4398425, -0.0868531], [0.1974755, 0.9552216, 0.4365652, -0.0891919]]]

Expected (Unparsed): [[[0.1974755175318162,0.9552215696067834,0.43656518811359596,-0.08919191310756155],[0.19776968347795426,0.9554374075861697,0.4453443482016738,-0.08217991231490715],[0.19757949730974864,0.9553072325677415,0.4398425145808069,-0.0868531001037797],[0.1974755175318162,0.9552215696067834,0.43656518811359596,-0.08919191310756155]]]

Actual:   [[[0.1975, 0.9553, 0.4366, -0.0891], [0.1978, 0.9555, 0.4454, -0.0821], [0.1976, 0.9554, 0.4399, -0.0868], [0.1975, 0.9553, 0.4366, -0.0891]]]

Expected: [[[0.1975, 0.9553, 0.4366, -0.0891], [0.1978, 0.9555, 0.4454, -0.0821], [0.1976, 0.9554, 0.4399, -0.0868], [0.1975, 0.9553, 0.4366, -0.0891]]]