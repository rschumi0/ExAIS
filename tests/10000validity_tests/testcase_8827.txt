import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dep14457 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con74140 = tf.keras.layers.Input(shape=([3, 2]))
in0Dot11210 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot11210 = tf.keras.layers.Input(shape=([3, 3]))
in0Glo73218 = tf.keras.layers.Input(shape=([1, 2]))

Dep14457 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='same', name = 'Dep14457', )(in0Dep14457)
Res82161 = keras.layers.Reshape((2, 1), name = 'Res82161', )(Dep14457)
Zer1131 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer1131', )(Res82161)
Con74140 = keras.layers.Concatenate(axis=2, name = 'Con74140', )([Zer1131,in0Con74140])
Dot11210 = keras.layers.Dot(axes=(1, 1), name = 'Dot11210', )([in0Dot11210,in1Dot11210])
Max25378 = keras.layers.Maximum(name = 'Max25378', )([Con74140,Dot11210])
Loc14762 = keras.layers.LocallyConnected1D(2, (3),strides=(1), name = 'Loc14762', )(Max25378)
Fla84353 = keras.layers.Flatten(name = 'Fla84353', )(Loc14762)
Glo73218 = keras.layers.GlobalAveragePooling1D(name = 'Glo73218', )(in0Glo73218)
Mul92437 = keras.layers.Multiply(name = 'Mul92437', )([Fla84353,Glo73218])
Res13688 = keras.layers.Reshape((2, 1), name = 'Res13688', )(Mul92437)
Res52049 = keras.layers.Reshape((2, 1, 1), name = 'Res52049', )(Res13688)
Max41867 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max41867', )(Res52049)
model = tf.keras.models.Model(inputs=[in0Dep14457,in0Con74140,in0Dot11210,in1Dot11210,in0Glo73218], outputs=Max41867)
w = model.get_layer('Dep14457').get_weights() 
w[0] = np.array([[[[0.4177]]]])
w[1] = np.array([0])
model.get_layer('Dep14457').set_weights(w) 
w = model.get_layer('Loc14762').get_weights() 
w[0] = np.array([[[0.6959, 0.7863], [0.6617, 0.2552], [0.1481, 0.5342], [0.4797, 0.0832], [0.0884, 0.9107], [0.2241, 0.9665], [0.4404, 0.6198], [0.4209, 0.8046], [0.3939, 0.0796]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc14762').set_weights(w) 
in0Dep14457 = tf.constant([[[[0.3255]], [[0.7076]]]])
in0Con74140 = tf.constant([[[0.0337, 0.4922], [0.8372, 0.8327], [0.7238, 0.9604]]])
in0Dot11210 = tf.constant([[[0.2709, 0.3592, 0.5432], [0.4947, 0.0115, 0.2417], [0.7012, 0.6163, 0.2082]]])
in1Dot11210 = tf.constant([[[0.9442, 0.7711, 0.7974], [0.155, 0.221, 0.81], [0.5444, 0.4883, 0.4478]]])
in0Glo73218 = tf.constant([[[1.7892, 1.623]]])
print (np.array2string(model.predict([in0Dep14457,in0Con74140,in0Dot11210,in1Dot11210,in0Glo73218],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max41867.png')

LDep14457 = depthwise_conv2D_layer([[[[0.3255]], [[0.7076]]]], 1, 1,[[[[0.4177]]]],[0], 1, 1, true, Dep14457), 
LRes82161 = reshape_layer(Dep14457, [2, 1], Res82161), 
LZer1131 = zero_padding1D_layer(Res82161, 1, 0, Zer1131), 
LCon74140 = concatenate_layer([Zer1131,[[[0.0337, 0.4922], [0.8372, 0.8327], [0.7238, 0.9604]]]], 2, Con74140), 
LDot11210 = dot_layer([[[0.2709, 0.3592, 0.5432], [0.4947, 0.0115, 0.2417], [0.7012, 0.6163, 0.2082]]], [[[0.9442, 0.7711, 0.7974], [0.155, 0.221, 0.81], [0.5444, 0.4883, 0.4478]]], 1, 1, Dot11210), 
LMax25378 = maximum_layer([Con74140,Dot11210], Max25378), 
LLoc14762 = locally_connected1D_layer(Max25378, 3,[[[0.6959, 0.7863], [0.6617, 0.2552], [0.1481, 0.5342], [0.4797, 0.0832], [0.0884, 0.9107], [0.2241, 0.9665], [0.4404, 0.6198], [0.4209, 0.8046], [0.3939, 0.0796]]],[[0, 0]], 1, Loc14762), 
LFla84353 = flatten_layer(Loc14762, Fla84353), 
LGlo73218 = global_average_pooling1D_layer([[[1.7892, 1.623]]], Glo73218), 
LMul92437 = multiply_layer([Fla84353,Glo73218], Mul92437), 
LRes13688 = reshape_layer(Mul92437, [2, 1], Res13688), 
LRes52049 = reshape_layer(Res13688, [2, 1, 1], Res52049), 
LMax41867 = max_pool2D_layer(Res52049, 1, 1, Max41867), 
exec_layers([LDep14457,LRes82161,LZer1131,LCon74140,LDot11210,LMax25378,LLoc14762,LFla84353,LGlo73218,LMul92437,LRes13688,LRes52049,LMax41867],["Dep14457","Res82161","Zer1131","Con74140","Dot11210","Max25378","Loc14762","Fla84353","Glo73218","Mul92437","Res13688","Res52049","Max41867"],Max41867,"Max41867")

Actual (Unparsed): [[[[4.7097644]], [[6.3638674]]]]

Expected (Unparsed): [[[[4.709764541356334]],[[6.363867263465821]]]]

Actual:   [[[[4.7098]], [[6.3639]]]]

Expected: [[[[4.7098]], [[6.3639]]]]