import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Den60927 = tf.keras.layers.Input(shape=([5, 3, 3]))

Den60927 = keras.layers.Dense(1,name = 'Den60927', )(in0Den60927)
Res55205 = keras.layers.Reshape((5, 3), name = 'Res55205', )(Den60927)
Per79958 = keras.layers.Permute((2,1), name = 'Per79958',)(Res55205)
Den93727 = keras.layers.Dense(4,name = 'Den93727', )(Per79958)
model = tf.keras.models.Model(inputs=[in0Den60927], outputs=Den93727)
w = model.get_layer('Den60927').get_weights() 
w[0] = np.array([[0.1434], [0.0775], [0.8686]])
w[1] = np.array([0.3814])
model.get_layer('Den60927').set_weights(w) 
w = model.get_layer('Den93727').get_weights() 
w[0] = np.array([[0.773, 0.7852, 0.5525, 0.9825], [0.31, 0.0354, 0.0869, 0.6834], [0.1816, 0.305, 0.9863, 0.7764], [0.5118, 0.9975, 0.4196, 0.242], [0.2253, 0.4206, 0.8709, 0.2462]])
w[1] = np.array([0.1676, 0.9642, 0.7919, 0.1962])
model.get_layer('Den93727').set_weights(w) 
in0Den60927 = tf.constant([[[[0.1757, 0.7935, 0.8871], [0.28, 0.2119, 0.8565], [0.202, 0.7546, 0.278]], [[0.2916, 0.6605, 0.823], [0.0265, 0.2014, 0.1191], [0.6714, 0.3634, 0.4964]], [[0.8667, 0.7217, 0.085], [0.2688, 0.7939, 0.8744], [0.1733, 0.2018, 0.9598]], [[0.1405, 0.8774, 0.869], [0.3635, 0.5991, 0.8941], [0.0734, 0.6854, 0.2956]], [[0.9303, 0.6917, 0.9966], [0.9097, 0.6835, 0.8469], [0.9511, 0.7638, 0.8052]]]])
print (np.array2string(model.predict([in0Den60927],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Den93727.png')

LDen60927 = dense_layer([[[[0.1757, 0.7935, 0.8871], [0.28, 0.2119, 0.8565], [0.202, 0.7546, 0.278]], [[0.2916, 0.6605, 0.823], [0.0265, 0.2014, 0.1191], [0.6714, 0.3634, 0.4964]], [[0.8667, 0.7217, 0.085], [0.2688, 0.7939, 0.8744], [0.1733, 0.2018, 0.9598]], [[0.1405, 0.8774, 0.869], [0.3635, 0.5991, 0.8941], [0.0734, 0.6854, 0.2956]], [[0.9303, 0.6917, 0.9966], [0.9097, 0.6835, 0.8469], [0.9511, 0.7638, 0.8052]]]], [[0.1434], [0.0775], [0.8686]],[0.3814], Den60927), 
LRes55205 = reshape_layer(Den60927, [5, 3], Res55205), 
LPer79958 = permute_layer(Res55205, 2,1, Per79958), 
LDen93727 = dense_layer(Per79958, [[0.773, 0.7852, 0.5525, 0.9825], [0.31, 0.0354, 0.0869, 0.6834], [0.1816, 0.305, 0.9863, 0.7764], [0.5118, 0.9975, 0.4196, 0.242], [0.2253, 0.4206, 0.8709, 0.2462]],[0.1676, 0.9642, 0.7919, 0.1962], Den93727), 
exec_layers([LDen60927,LRes55205,LPer79958,LDen93727],["Den60927","Res55205","Per79958","Den93727"],Den93727,"Den93727")

Actual (Unparsed): [[[2.5588475, 3.9971448, 3.9689928, 3.3686141], [2.3990160, 4.0889952, 4.3725223, 3.2898100], [1.8819140, 3.1749554, 3.9102242, 2.9933523]]]

Expected (Unparsed): [[[2.558847549807,3.997144766802,3.9689928739319997,3.3686140624689997],[2.3990159603250003,4.088995170091,4.372522312921,3.289809931217],[1.8819140199840003,3.1749553689659997,3.9102242299960004,2.993352286162]]]

Actual:   [[[2.5589, 3.9972, 3.969, 3.3687], [2.3991, 4.089, 4.3726, 3.2899], [1.882, 3.175, 3.9103, 2.9934]]]

Expected: [[[2.5589, 3.9972, 3.969, 3.3687], [2.3991, 4.089, 4.3726, 3.2899], [1.882, 3.175, 3.9103, 2.9934]]]