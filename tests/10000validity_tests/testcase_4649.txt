import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max72017 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Max72017 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con56221 = tf.keras.layers.Input(shape=([1]))
in0Sim25806 = tf.keras.layers.Input(shape=([2, 1]))
in0Con90831 = tf.keras.layers.Input(shape=([3, 1, 1]))
in0Sim20332 = tf.keras.layers.Input(shape=([2, 2]))
in0Ave56227 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Ave56227 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con61998 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Add8991 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Add8991 = tf.keras.layers.Input(shape=([1, 1, 2]))

Max72017 = keras.layers.Maximum(name = 'Max72017', )([in0Max72017,in1Max72017])
Res51192 = keras.layers.Reshape((1, 2), name = 'Res51192', )(Max72017)
Fla29348 = keras.layers.Flatten(name = 'Fla29348', )(Res51192)
Con56221 = keras.layers.Concatenate(axis=1, name = 'Con56221', )([Fla29348,in0Con56221])
Sim25806 = keras.layers.SimpleRNN(3,name = 'Sim25806', )(in0Sim25806)
Sub43636 = keras.layers.Subtract(name = 'Sub43636', )([Con56221,Sim25806])
Lea18320 = keras.layers.LeakyReLU(alpha=6.820733947224406, name = 'Lea18320', )(Sub43636)
Res44549 = keras.layers.Reshape((3, 1), name = 'Res44549', )(Lea18320)
Res79702 = keras.layers.Reshape((3, 1, 1), name = 'Res79702', )(Res44549)
Con90831 = keras.layers.Concatenate(axis=3, name = 'Con90831', )([Res79702,in0Con90831])
Sim20332 = keras.layers.SimpleRNN(2,name = 'Sim20332', )(in0Sim20332)
ReL86107 = keras.layers.ReLU(max_value=1.167025646253765, negative_slope=0.5789437476552352, threshold=7.67606427395342, name = 'ReL86107', )(Sim20332)
Ave56227 = keras.layers.Average(name = 'Ave56227', )([in0Ave56227,in1Ave56227])
Res88491 = keras.layers.Reshape((2, 4), name = 'Res88491', )(Ave56227)
LST53388 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST53388', )(Res88491)
Mul63550 = keras.layers.Multiply(name = 'Mul63550', )([ReL86107,LST53388])
Res99612 = keras.layers.Reshape((2, 1), name = 'Res99612', )(Mul63550)
Res86354 = keras.layers.Reshape((2, 1, 1), name = 'Res86354', )(Res99612)
Con61998 = keras.layers.Concatenate(axis=3, name = 'Con61998', )([Res86354,in0Con61998])
Add8991 = keras.layers.Add(name = 'Add8991', )([in0Add8991,in1Add8991])
Zer75897 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer75897', )(Add8991)
Min9881 = keras.layers.Minimum(name = 'Min9881', )([Con61998,Zer75897])
Zer37804 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer37804', )(Min9881)
Add81073 = keras.layers.Add(name = 'Add81073', )([Con90831,Zer37804])
model = tf.keras.models.Model(inputs=[in0Max72017,in1Max72017,in0Con56221,in0Sim25806,in0Con90831,in0Sim20332,in0Ave56227,in1Ave56227,in0Con61998,in0Add8991,in1Add8991], outputs=Add81073)
w = model.get_layer('Sim25806').get_weights() 
w[0] = np.array([[8, 1, 2]])
w[1] = np.array([[8, 8, 1], [9, 2, 3], [8, 8, 3]])
w[2] = np.array([10, 9, 5])
model.get_layer('Sim25806').set_weights(w) 
w = model.get_layer('Sim20332').get_weights() 
w[0] = np.array([[1, 10], [2, 5]])
w[1] = np.array([[8, 8], [7, 5]])
w[2] = np.array([6, 8])
model.get_layer('Sim20332').set_weights(w) 
w = model.get_layer('LST53388').get_weights() 
w[0] = np.array([[6, 8, 1, 1, 10, 2, 2, 4], [9, 2, 3, 2, 9, 9, 8, 8], [4, 9, 4, 1, 7, 6, 4, 7], [10, 9, 1, 10, 7, 7, 6, 5]])
w[1] = np.array([[6, 2, 5, 5, 9, 5, 2, 7], [7, 2, 4, 4, 1, 2, 5, 8]])
w[2] = np.array([10, 4, 1, 3, 5, 9, 10, 3])
model.get_layer('LST53388').set_weights(w) 
in0Max72017 = tf.constant([[[[0.2615], [0.991]]]])
in1Max72017 = tf.constant([[[[0.6101], [0.824]]]])
in0Con56221 = tf.constant([[0.3983]])
in0Sim25806 = tf.constant([[[5], [8]]])
in0Con90831 = tf.constant([[[[0.4158]], [[0.0146]], [[0.4975]]]])
in0Sim20332 = tf.constant([[[8, 9], [6, 6]]])
in0Ave56227 = tf.constant([[[[0.2292, 0.0532], [0.5721, 0.4247]], [[0.7409, 0.7985], [0.5592, 0.3205]]]])
in1Ave56227 = tf.constant([[[[0.8831, 0.4415], [0.567, 0.1493]], [[0.9797, 0.6429], [0.1198, 0.972]]]])
in0Con61998 = tf.constant([[[[0.0726]], [[0.8858]]]])
in0Add8991 = tf.constant([[[[0.9079, 0.3507]]]])
in1Add8991 = tf.constant([[[[0.789, 0.705]]]])
print (np.array2string(model.predict([in0Max72017,in1Max72017,in0Con56221,in0Sim25806,in0Con90831,in0Sim20332,in0Ave56227,in1Ave56227,in0Con61998,in0Add8991,in1Add8991],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add81073.png')

LMax72017 = maximum_layer([[[[[0.2615], [0.991]]]], [[[[0.6101], [0.824]]]]], Max72017), 
LRes51192 = reshape_layer(Max72017, [1, 2], Res51192), 
LFla29348 = flatten_layer(Res51192, Fla29348), 
LCon56221 = concatenate_layer([Fla29348,[[0.3983]]], 1, Con56221), 
LSim25806 = simple_rnn_layer([[[5], [8]]],[[8, 1, 2]],[[8, 8, 1], [9, 2, 3], [8, 8, 3]],[10, 9, 5], Sim25806), 
LSub43636 = subtract_layer(Con56221,Sim25806, Sub43636), 
LLea18320 = leaky_relu_layer(Sub43636, 6.820733947224406, Lea18320), 
LRes44549 = reshape_layer(Lea18320, [3, 1], Res44549), 
LRes79702 = reshape_layer(Res44549, [3, 1, 1], Res79702), 
LCon90831 = concatenate_layer([Res79702,[[[[0.4158]], [[0.0146]], [[0.4975]]]]], 3, Con90831), 
LSim20332 = simple_rnn_layer([[[8, 9], [6, 6]]],[[1, 10], [2, 5]],[[8, 8], [7, 5]],[6, 8], Sim20332), 
LReL86107 = relu_layer(Sim20332, 1.167025646253765, 0.5789437476552352, 7.67606427395342, ReL86107), 
LAve56227 = average_layer([[[[[0.2292, 0.0532], [0.5721, 0.4247]], [[0.7409, 0.7985], [0.5592, 0.3205]]]], [[[[0.8831, 0.4415], [0.567, 0.1493]], [[0.9797, 0.6429], [0.1198, 0.972]]]]], Ave56227), 
LRes88491 = reshape_layer(Ave56227, [2, 4], Res88491), 
LLST53388 = lstm_layer(Res88491,[[6, 8, 1, 1, 10, 2, 2, 4], [9, 2, 3, 2, 9, 9, 8, 8], [4, 9, 4, 1, 7, 6, 4, 7], [10, 9, 1, 10, 7, 7, 6, 5]],[[6, 2, 5, 5, 9, 5, 2, 7], [7, 2, 4, 4, 1, 2, 5, 8]],[10, 4, 1, 3, 5, 9, 10, 3], LST53388), 
LMul63550 = multiply_layer([ReL86107,LST53388], Mul63550), 
LRes99612 = reshape_layer(Mul63550, [2, 1], Res99612), 
LRes86354 = reshape_layer(Res99612, [2, 1, 1], Res86354), 
LCon61998 = concatenate_layer([Res86354,[[[[0.0726]], [[0.8858]]]]], 3, Con61998), 
LAdd8991 = add_layer([[[[[0.9079, 0.3507]]]], [[[[0.789, 0.705]]]]], Add8991), 
LZer75897 = zero_padding2D_layer(Add8991, 1, 0, 0, 0, Zer75897), 
LMin9881 = minimum_layer([Con61998,Zer75897], Min9881), 
LZer37804 = zero_padding2D_layer(Min9881, 1, 0, 0, 0, Zer37804), 
LAdd81073 = add_layer([Con90831,Zer37804], Add81073), 
exec_layers([LMax72017,LRes51192,LFla29348,LCon56221,LSim25806,LSub43636,LLea18320,LRes44549,LRes79702,LCon90831,LSim20332,LReL86107,LAve56227,LRes88491,LLST53388,LMul63550,LRes99612,LRes86354,LCon61998,LAdd8991,LZer75897,LMin9881,LZer37804,LAdd81073],["Max72017","Res51192","Fla29348","Con56221","Sim25806","Sub43636","Lea18320","Res44549","Res79702","Con90831","Sim20332","ReL86107","Ave56227","Res88491","LST53388","Mul63550","Res99612","Res86354","Con61998","Add8991","Zer75897","Min9881","Zer37804","Add81073"],Add81073,"Add81073")

Actual (Unparsed): [[[[-2.6594044, 0.4158000]], [[-3.7874158, 0.0146000]], [[-7.8300656, 1.3833000]]]]

Expected (Unparsed): [[[[-2.6594041660227963,0.4158]],[[-3.787415815031361,0.0146]],[[-7.830065503465207,1.3833]]]]

Actual:   [[[[-2.6594, 0.4158]], [[-3.7874, 0.0146]], [[-7.83, 1.3833]]]]

Expected: [[[[-2.6594, 0.4158]], [[-3.7874, 0.0146]], [[-7.83, 1.3833]]]]