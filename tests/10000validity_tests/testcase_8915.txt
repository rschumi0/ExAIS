import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max10817 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Max10817 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))

Max10817 = keras.layers.Maximum(name = 'Max10817', )([in0Max10817,in1Max10817])
Res85175 = keras.layers.Reshape((2, 2, 4), name = 'Res85175', )(Max10817)
Res95019 = keras.layers.Reshape((2, 8), name = 'Res95019', )(Res85175)
Loc69481 = keras.layers.LocallyConnected1D(4, (2),strides=(9), name = 'Loc69481', )(Res95019)
Res41198 = keras.layers.Reshape((1, 4, 1), name = 'Res41198', )(Loc69481)
PRe60803 = keras.layers.PReLU(name = 'PRe60803', )(Res41198)
model = tf.keras.models.Model(inputs=[in0Max10817,in1Max10817], outputs=PRe60803)
w = model.get_layer('Loc69481').get_weights() 
w[0] = np.array([[[0.6224, 0.0777, 0.2527, 0.3336], [0.6203, 0.5764, 0.6461, 0.3708], [0.9882, 0.5695, 0.0805, 0.0165], [0.1512, 0.5209, 0.9093, 0.3551], [0.4147, 0.6318, 0.8969, 0.6114], [0.8773, 0.9052, 0.5365, 0.1366], [0.4238, 0.4308, 0.1406, 0.9939], [0.7794, 0.4528, 0.618, 0.8309], [0.7635, 0.3796, 0.2101, 0.6471], [0.6852, 0.3995, 0.9683, 0.403], [0.2955, 0.7781, 0.4273, 0.1533], [0.8265, 0.2312, 0.7509, 0.5329], [0.4308, 0.9883, 0.6098, 0.9771], [0.7671, 0.2949, 0.1894, 0.0153], [0.5693, 0.135, 0.0181, 0.3394], [0.782, 0.8985, 0.7573, 0.1223]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc69481').set_weights(w) 
w = model.get_layer('PRe60803').get_weights() 
w[0] = np.array([[[0.2359], [0.0204], [0.7602], [0.4943]]])
model.get_layer('PRe60803').set_weights(w) 
in0Max10817 = tf.constant([[[[[0.0534, 0.8437], [0.9155, 0.7219]], [[0.0733, 0.6741], [0.2458, 0.2493]]], [[[0.5095, 0.4392], [0.4184, 0.7002]], [[0.3566, 0.362], [0.6005, 0.2666]]]]])
in1Max10817 = tf.constant([[[[[0.9639, 0.1151], [0.1979, 0.5249]], [[0.9417, 0.051], [0.5605, 0.5999]]], [[[0.7319, 0.4929], [0.9133, 0.5217]], [[0.5518, 0.3345], [0.0099, 0.3815]]]]])
print (np.array2string(model.predict([in0Max10817,in1Max10817],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='PRe60803.png')

LMax10817 = maximum_layer([[[[[[0.0534, 0.8437], [0.9155, 0.7219]], [[0.0733, 0.6741], [0.2458, 0.2493]]], [[[0.5095, 0.4392], [0.4184, 0.7002]], [[0.3566, 0.362], [0.6005, 0.2666]]]]], [[[[[0.9639, 0.1151], [0.1979, 0.5249]], [[0.9417, 0.051], [0.5605, 0.5999]]], [[[0.7319, 0.4929], [0.9133, 0.5217]], [[0.5518, 0.3345], [0.0099, 0.3815]]]]]], Max10817), 
LRes85175 = reshape_layer(Max10817, [2, 2, 4], Res85175), 
LRes95019 = reshape_layer(Res85175, [2, 8], Res95019), 
LLoc69481 = locally_connected1D_layer(Res95019, 2,[[[0.6224, 0.0777, 0.2527, 0.3336], [0.6203, 0.5764, 0.6461, 0.3708], [0.9882, 0.5695, 0.0805, 0.0165], [0.1512, 0.5209, 0.9093, 0.3551], [0.4147, 0.6318, 0.8969, 0.6114], [0.8773, 0.9052, 0.5365, 0.1366], [0.4238, 0.4308, 0.1406, 0.9939], [0.7794, 0.4528, 0.618, 0.8309], [0.7635, 0.3796, 0.2101, 0.6471], [0.6852, 0.3995, 0.9683, 0.403], [0.2955, 0.7781, 0.4273, 0.1533], [0.8265, 0.2312, 0.7509, 0.5329], [0.4308, 0.9883, 0.6098, 0.9771], [0.7671, 0.2949, 0.1894, 0.0153], [0.5693, 0.135, 0.0181, 0.3394], [0.782, 0.8985, 0.7573, 0.1223]]],[[0, 0, 0, 0]], 9, Loc69481), 
LRes41198 = reshape_layer(Loc69481, [1, 4, 1], Res41198), 
LPRe60803 = prelu_layer(Res41198, [[[0.2359], [0.0204], [0.7602], [0.4943]]], PRe60803), 
exec_layers([LMax10817,LRes85175,LRes95019,LLoc69481,LRes41198,LPRe60803],["Max10817","Res85175","Res95019","Loc69481","Res41198","PRe60803"],PRe60803,"PRe60803")

Actual (Unparsed): [[[[6.7248792], [5.6000889], [5.4265334], [4.6097950]]]]

Expected (Unparsed): [[[[6.724879199999999],[5.600088919999998],[5.42653337],[4.60979493]]]]

Actual:   [[[[6.7249], [5.6001], [5.4266], [4.6098]]]]

Expected: [[[[6.7249], [5.6001], [5.4266], [4.6098]]]]