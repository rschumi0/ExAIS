import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min80916 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Min80916 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Min89988 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Min89988 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Glo82016 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con73156 = tf.keras.layers.Input(shape=([3, 11]))

Min80916 = keras.layers.Minimum(name = 'Min80916', )([in0Min80916,in1Min80916])
Res1641 = keras.layers.Reshape((1, 2), name = 'Res1641', )(Min80916)
Res15978 = keras.layers.Reshape((1, 2, 1), name = 'Res15978', )(Res1641)
Res69122 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res69122', )(Res15978)
Zer39224 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer39224', )(Res69122)
Res88738 = keras.layers.Reshape((3, 4, 3), name = 'Res88738', )(Zer39224)
Res25837 = keras.layers.Reshape((3, 12), name = 'Res25837', )(Res88738)
Min89988 = keras.layers.Minimum(name = 'Min89988', )([in0Min89988,in1Min89988])
Res33520 = keras.layers.Reshape((2, 1), name = 'Res33520', )(Min89988)
Glo82016 = keras.layers.GlobalMaxPool2D(name = 'Glo82016', )(in0Glo82016)
Res78927 = keras.layers.Reshape((2, 1), name = 'Res78927', )(Glo82016)
PRe43043 = keras.layers.PReLU(name = 'PRe43043', )(Res78927)
Sub49712 = keras.layers.Subtract(name = 'Sub49712', )([Res33520,PRe43043])
Zer79430 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer79430', )(Sub49712)
Con73156 = keras.layers.Concatenate(axis=2, name = 'Con73156', )([Zer79430,in0Con73156])
Ave79682 = keras.layers.Average(name = 'Ave79682', )([Res25837,Con73156])
model = tf.keras.models.Model(inputs=[in0Min80916,in1Min80916,in0Min89988,in1Min89988,in0Glo82016,in0Con73156], outputs=Ave79682)
w = model.get_layer('PRe43043').get_weights() 
w[0] = np.array([[0.2983], [0.8645]])
model.get_layer('PRe43043').set_weights(w) 
in0Min80916 = tf.constant([[[[0.4493], [0.0177]]]])
in1Min80916 = tf.constant([[[[0.4899], [0.7035]]]])
in0Min89988 = tf.constant([[[[0.4995]], [[0.0066]]]])
in1Min89988 = tf.constant([[[[0.0176]], [[0.2358]]]])
in0Glo82016 = tf.constant([[[[1.4565, 1.7313]], [[1.5945, 1.0326]]]])
in0Con73156 = tf.constant([[[0.575, 0.9694, 0.22, 0.6033, 0.6235, 0.1452, 0.9391, 0.8759, 0.2979, 0.5171, 0.0755], [0.8619, 0.3256, 0.6687, 0.3049, 0.3032, 0.9959, 0.6502, 0.3584, 0.9773, 0.5904, 0.7734], [0.5216, 0.0107, 0.9287, 0.7589, 0.7867, 0.9155, 0.4327, 0.8894, 0.2076, 0.0946, 0.2027]]])
print (np.array2string(model.predict([in0Min80916,in1Min80916,in0Min89988,in1Min89988,in0Glo82016,in0Con73156],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave79682.png')

LMin80916 = minimum_layer([[[[[0.4493], [0.0177]]]], [[[[0.4899], [0.7035]]]]], Min80916), 
LRes1641 = reshape_layer(Min80916, [1, 2], Res1641), 
LRes15978 = reshape_layer(Res1641, [1, 2, 1], Res15978), 
LRes69122 = reshape_layer(Res15978, [1, 2, 1, 1], Res69122), 
LZer39224 = zero_padding3D_layer(Res69122, 1, 1, 1, 1, 1, 1, Zer39224), 
LRes88738 = reshape_layer(Zer39224, [3, 4, 3], Res88738), 
LRes25837 = reshape_layer(Res88738, [3, 12], Res25837), 
LMin89988 = minimum_layer([[[[[0.4995]], [[0.0066]]]], [[[[0.0176]], [[0.2358]]]]], Min89988), 
LRes33520 = reshape_layer(Min89988, [2, 1], Res33520), 
LGlo82016 = global_max_pool2D_layer([[[[1.4565, 1.7313]], [[1.5945, 1.0326]]]], Glo82016), 
LRes78927 = reshape_layer(Glo82016, [2, 1], Res78927), 
LPRe43043 = prelu_layer(Res78927, [[0.2983], [0.8645]], PRe43043), 
LSub49712 = subtract_layer(Res33520,PRe43043, Sub49712), 
LZer79430 = zero_padding1D_layer(Sub49712, 1, 0, Zer79430), 
LCon73156 = concatenate_layer([Zer79430,[[[0.575, 0.9694, 0.22, 0.6033, 0.6235, 0.1452, 0.9391, 0.8759, 0.2979, 0.5171, 0.0755], [0.8619, 0.3256, 0.6687, 0.3049, 0.3032, 0.9959, 0.6502, 0.3584, 0.9773, 0.5904, 0.7734], [0.5216, 0.0107, 0.9287, 0.7589, 0.7867, 0.9155, 0.4327, 0.8894, 0.2076, 0.0946, 0.2027]]]], 2, Con73156), 
LAve79682 = average_layer([Res25837,Con73156], Ave79682), 
exec_layers([LMin80916,LRes1641,LRes15978,LRes69122,LZer39224,LRes88738,LRes25837,LMin89988,LRes33520,LGlo82016,LRes78927,LPRe43043,LSub49712,LZer79430,LCon73156,LAve79682],["Min80916","Res1641","Res15978","Res69122","Zer39224","Res88738","Res25837","Min89988","Res33520","Glo82016","Res78927","PRe43043","Sub49712","Zer79430","Con73156","Ave79682"],Ave79682,"Ave79682")

Actual (Unparsed): [[[0.0000000, 0.2875000, 0.4847000, 0.1100000, 0.3016500, 0.3117500, 0.0726000, 0.4695500, 0.4379500, 0.1489500, 0.2585500, 0.0377500], [-0.7884500, 0.4309500, 0.1628000, 0.3343500, 0.3771000, 0.1516000, 0.4979500, 0.3339500, 0.1792000, 0.4886500, 0.2952000, 0.3867000], [-0.8623500, 0.2608000, 0.0053500, 0.4643500, 0.3794500, 0.3933500, 0.4577500, 0.2163500, 0.4447000, 0.1038000, 0.0473000, 0.1013500]]]

Expected (Unparsed): [[[0,0.2875,0.4847,0.11,0.30165,0.31175,0.0726,0.46955,0.43795,0.14895,0.25855,0.03775],[-0.78845,0.43095,0.1628,0.33435,0.3771,0.1516,0.49795,0.33395,0.1792,0.48865,0.2952,0.3867],[-0.8623500000000001,0.2608,0.00535,0.46435,0.37945,0.39335,0.45775,0.21635,0.4447,0.1038,0.0473,0.10135]]]

Actual:   [[[0, 0.2875, 0.4847, 0.11, 0.3017, 0.3118, 0.0726, 0.4696, 0.438, 0.149, 0.2586, 0.0378], [-0.7884, 0.431, 0.1628, 0.3344, 0.3771, 0.1516, 0.498, 0.334, 0.1792, 0.4887, 0.2952, 0.3867], [-0.8623, 0.2608, 0.0054, 0.4644, 0.3795, 0.3934, 0.4578, 0.2164, 0.4447, 0.1038, 0.0473, 0.1014]]]

Expected: [[[0, 0.2875, 0.4847, 0.11, 0.3017, 0.3118, 0.0726, 0.4696, 0.438, 0.149, 0.2586, 0.0378], [-0.7884, 0.431, 0.1628, 0.3344, 0.3771, 0.1516, 0.498, 0.334, 0.1792, 0.4887, 0.2952, 0.3867], [-0.8623, 0.2608, 0.0054, 0.4644, 0.3795, 0.3934, 0.4578, 0.2164, 0.4447, 0.1038, 0.0473, 0.1014]]]