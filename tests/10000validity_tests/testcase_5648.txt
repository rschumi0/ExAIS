import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub42627 = tf.keras.layers.Input(shape=([3, 2, 3, 2]))
in1Sub42627 = tf.keras.layers.Input(shape=([3, 2, 3, 2]))

Sub42627 = keras.layers.Subtract(name = 'Sub42627', )([in0Sub42627,in1Sub42627])
Den26992 = keras.layers.Dense(4,name = 'Den26992', )(Sub42627)
Mas27496 = keras.layers.Masking(mask_value=2, name = 'Mas27496', )(Den26992)
model = tf.keras.models.Model(inputs=[in0Sub42627,in1Sub42627], outputs=Mas27496)
w = model.get_layer('Den26992').get_weights() 
w[0] = np.array([[0.9032, 0.3686, 0.2113, 0.7923], [0.6275, 0.9845, 0.5128, 0.0692]])
w[1] = np.array([0.1194, 0.5968, 0.9686, 0.228])
model.get_layer('Den26992').set_weights(w) 
in0Sub42627 = tf.constant([[[[[0.6771, 0.6529], [0.7393, 0.687], [0.7554, 0.4882]], [[0.3397, 0.6909], [0.0545, 0.563], [0.9892, 0.7647]]], [[[0.3571, 0.1339], [0.2232, 0.2295], [0.6901, 0.4377]], [[0.6792, 0.925], [0.4798, 0.6641], [0.0323, 0.7205]]], [[[0.1209, 0.2957], [0.334, 0.037], [0.5079, 0.4295]], [[0.9775, 0.8385], [0.0582, 0.8314], [0.8807, 0.7122]]]]])
in1Sub42627 = tf.constant([[[[[0.7628, 0.902], [0.3763, 0.5914], [0.8407, 0.4334]], [[0.7306, 0.3988], [0.647, 0.0233], [0.1733, 0.3853]]], [[[0.5827, 0.2785], [0.8154, 0.2236], [0.8927, 0.4892]], [[0.8539, 0.9798], [0.3995, 0.283], [0.0211, 0.9284]]], [[[0.4198, 0.8787], [0.3205, 0.8054], [0.3363, 0.9508]], [[0.7104, 0.4988], [0.5565, 0.7904], [0.5465, 0.3657]]]]])
print (np.array2string(model.predict([in0Sub42627,in1Sub42627],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mas27496.png')

LSub42627 = subtract_layer([[[[[0.6771, 0.6529], [0.7393, 0.687], [0.7554, 0.4882]], [[0.3397, 0.6909], [0.0545, 0.563], [0.9892, 0.7647]]], [[[0.3571, 0.1339], [0.2232, 0.2295], [0.6901, 0.4377]], [[0.6792, 0.925], [0.4798, 0.6641], [0.0323, 0.7205]]], [[[0.1209, 0.2957], [0.334, 0.037], [0.5079, 0.4295]], [[0.9775, 0.8385], [0.0582, 0.8314], [0.8807, 0.7122]]]]], [[[[[0.7628, 0.902], [0.3763, 0.5914], [0.8407, 0.4334]], [[0.7306, 0.3988], [0.647, 0.0233], [0.1733, 0.3853]]], [[[0.5827, 0.2785], [0.8154, 0.2236], [0.8927, 0.4892]], [[0.8539, 0.9798], [0.3995, 0.283], [0.0211, 0.9284]]], [[[0.4198, 0.8787], [0.3205, 0.8054], [0.3363, 0.9508]], [[0.7104, 0.4988], [0.5565, 0.7904], [0.5465, 0.3657]]]]], Sub42627), 
LDen26992 = dense_layer(Sub42627, [[0.9032, 0.3686, 0.2113, 0.7923], [0.6275, 0.9845, 0.5128, 0.0692]],[0.1194, 0.5968, 0.9686, 0.228], Den26992), 
LMas27496 = masking_layer(Den26992, 2, Mas27496), 
exec_layers([LSub42627,LDen26992,LMas27496],["Sub42627","Den26992","Mas27496"],Mas27496,"Mas27496")

Actual (Unparsed): [[[[[-0.1143145, 0.3199720, 0.8227531, 0.1428622], [0.5072506, 0.8247200, 1.0943256, 0.5222204], [0.0767441, 0.6193090, 0.9786776, 0.1642090]], [[-0.0503681, 0.7402868, 1.0357917, -0.0614967], [-0.0770842, 0.9097392, 1.1201629, -0.2040905], [1.0943944, 1.2710600, 1.3355560, 0.9006920]]], [[[-0.1750984, 0.3712851, 0.8467798, 0.0392508], [-0.4117728, 0.3843236, 0.8464937, -0.2407918], [-0.0959046, 0.4714199, 0.8993814, 0.0639162]], [[-0.0727760, 0.4784550, 0.9035845, 0.0857930], [0.4310672, 1.0015915, 1.1809955, 0.3179938], [-0.0009414, 0.3962508, 0.8643554, 0.2224871]]], [[[-0.5163990, -0.0873380, 0.6064800, -0.0491621], [-0.3505778, -0.1547137, 0.5774170, 0.1855228], [-0.0527266, 0.1468319, 0.7375364, 0.3278847]], [[0.5738065, 1.0296877, 1.1992364, 0.4631306], [-0.3049371, 0.4534911, 0.8843340, -0.1639659], [0.6386781, 1.0611153, 1.2169016, 0.5167644]]]]]

Expected (Unparsed): [[[[[-0.11431448999999998,0.31997203,0.8227531100000001,0.14286217],[0.5072505999999999,0.82472,1.09432558,0.5222204199999999],[0.07674403999999999,0.61930902,0.97867755,0.16420896999999995]],[[-0.05036813000000004,0.74028671,1.03579171,-0.06149675],[-0.07708425000000008,0.90973915,1.12016291,-0.20409051000000003],[1.09439438,1.27106004,1.33555599,0.90069205]]],[[[-0.17509842000000003,0.3712851399999999,0.84677984,0.03925079999999999],[-0.41177279000000006,0.38432363,0.84649366,-0.24079178],[-0.09590457000000002,0.4714198899999999,0.89938142,0.06391622]],[[-0.07277603999999993,0.4784549800000001,0.90358445,0.08579303000000003],[0.43106721,1.0015915300000002,1.18099547,0.31799381],[-0.0009414099999999759,0.39625077,0.8643554400000001,0.22248708000000003]]],[[[-0.51639898,-0.08733803999999995,0.60648003,-0.04916206999999999],[-0.35057779999999994,-0.15471369999999995,0.5774170299999999,0.18552277000000003],[-0.05272662999999994,0.14683190999999995,0.7375364400000002,0.32788472]],[[0.5738064700000001,1.02968771,1.19923639,0.46313056999999996],[-0.3049370599999999,0.45349112,0.8843340100000001,-0.16396588999999995],[0.63867819,1.06111537,1.21690166,0.5167644600000001]]]]]

Actual:   [[[[[-0.1143, 0.32, 0.8228, 0.1429], [0.5073, 0.8248, 1.0944, 0.5223], [0.0768, 0.6194, 0.9787, 0.1643]], [[-0.0503, 0.7403, 1.0358, -0.0614], [-0.077, 0.9098, 1.1202, -0.204], [1.0944, 1.2711, 1.3356, 0.9007]]], [[[-0.175, 0.3713, 0.8468, 0.0393], [-0.4117, 0.3844, 0.8465, -0.2407], [-0.0959, 0.4715, 0.8994, 0.064]], [[-0.0727, 0.4785, 0.9036, 0.0858], [0.4311, 1.0016, 1.181, 0.318], [-0.0009, 0.3963, 0.8644, 0.2225]]], [[[-0.5163, -0.0873, 0.6065, -0.0491], [-0.3505, -0.1547, 0.5775, 0.1856], [-0.0527, 0.1469, 0.7376, 0.3279]], [[0.5739, 1.0297, 1.1993, 0.4632], [-0.3049, 0.4535, 0.8844, -0.1639], [0.6387, 1.0612, 1.217, 0.5168]]]]]

Expected: [[[[[-0.1143, 0.32, 0.8228, 0.1429], [0.5073, 0.8248, 1.0944, 0.5223], [0.0768, 0.6194, 0.9787, 0.1643]], [[-0.0503, 0.7403, 1.0358, -0.0614], [-0.077, 0.9098, 1.1202, -0.204], [1.0944, 1.2711, 1.3356, 0.9007]]], [[[-0.175, 0.3713, 0.8468, 0.0393], [-0.4117, 0.3844, 0.8465, -0.2407], [-0.0959, 0.4715, 0.8994, 0.064]], [[-0.0727, 0.4785, 0.9036, 0.0858], [0.4311, 1.0016, 1.181, 0.318], [-0.0009, 0.3963, 0.8644, 0.2225]]], [[[-0.5163, -0.0873, 0.6065, -0.0491], [-0.3505, -0.1547, 0.5775, 0.1856], [-0.0527, 0.1469, 0.7376, 0.3279]], [[0.5739, 1.0297, 1.1993, 0.4632], [-0.3049, 0.4535, 0.8844, -0.1639], [0.6387, 1.0612, 1.217, 0.5168]]]]]