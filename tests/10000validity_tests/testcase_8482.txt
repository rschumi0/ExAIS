import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST66909 = tf.keras.layers.Input(shape=([2, 3]))
in0Con5415 = tf.keras.layers.Input(shape=([2, 1, 3, 1]))
in0Min39176 = tf.keras.layers.Input(shape=([1, 1]))
in1Min39176 = tf.keras.layers.Input(shape=([1, 1]))

LST66909 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST66909', )(in0LST66909)
Fla89943 = keras.layers.Flatten(name = 'Fla89943', )(LST66909)
Res78506 = keras.layers.Reshape((2, 1), name = 'Res78506', )(Fla89943)
Res55944 = keras.layers.Reshape((2, 1, 1), name = 'Res55944', )(Res78506)
Res89059 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res89059', )(Res55944)
Zer33451 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer33451', )(Res89059)
Con5415 = keras.layers.Concatenate(axis=4, name = 'Con5415', )([Zer33451,in0Con5415])
Min39176 = keras.layers.Minimum(name = 'Min39176', )([in0Min39176,in1Min39176])
Res81945 = keras.layers.Reshape((1, 1, 1), name = 'Res81945', )(Min39176)
Sep64692 = keras.layers.SeparableConv2D(2, (1, 1),strides=(1, 1), padding='same', name = 'Sep64692', )(Res81945)
Res8034 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res8034', )(Sep64692)
Con85219 = keras.layers.Conv3D(2, (1, 1, 2),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con85219', )(Res8034)
Zer11786 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (1, 0)), name = 'Zer11786', )(Con85219)
Min69477 = keras.layers.Minimum(name = 'Min69477', )([Con5415,Zer11786])
model = tf.keras.models.Model(inputs=[in0LST66909,in0Con5415,in0Min39176,in1Min39176], outputs=Min69477)
w = model.get_layer('LST66909').get_weights() 
w[0] = np.array([[10, 1, 2, 2, 3, 1, 3, 1], [4, 9, 4, 10, 6, 7, 9, 4], [8, 9, 6, 7, 8, 9, 9, 4]])
w[1] = np.array([[8, 10, 5, 5, 4, 3, 7, 3], [3, 10, 10, 2, 8, 8, 5, 3]])
w[2] = np.array([10, 5, 1, 9, 1, 8, 5, 4])
model.get_layer('LST66909').set_weights(w) 
w = model.get_layer('Sep64692').get_weights() 
w[0] = np.array([[[[0.7412]]]])
w[1] = np.array([[[[0.6803, 0.8442]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep64692').set_weights(w) 
w = model.get_layer('Con85219').get_weights() 
w[0] = np.array([[[[[0.6144, 0.616]], [[0.4458, 0.4368]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con85219').set_weights(w) 
in0LST66909 = tf.constant([[[2, 4, 9], [10, 7, 8]]])
in0Con5415 = tf.constant([[[[[0.3769], [0.6189], [0.7453]]], [[[0.3614], [0.408], [0.7402]]]]])
in0Min39176 = tf.constant([[[0.278]]])
in1Min39176 = tf.constant([[[0.3238]]])
print (np.array2string(model.predict([in0LST66909,in0Con5415,in0Min39176,in1Min39176],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min69477.png')

LLST66909 = lstm_layer([[[2, 4, 9], [10, 7, 8]]],[[10, 1, 2, 2, 3, 1, 3, 1], [4, 9, 4, 10, 6, 7, 9, 4], [8, 9, 6, 7, 8, 9, 9, 4]],[[8, 10, 5, 5, 4, 3, 7, 3], [3, 10, 10, 2, 8, 8, 5, 3]],[10, 5, 1, 9, 1, 8, 5, 4], LST66909), 
LFla89943 = flatten_layer(LST66909, Fla89943), 
LRes78506 = reshape_layer(Fla89943, [2, 1], Res78506), 
LRes55944 = reshape_layer(Res78506, [2, 1, 1], Res55944), 
LRes89059 = reshape_layer(Res55944, [2, 1, 1, 1], Res89059), 
LZer33451 = zero_padding3D_layer(Res89059, 0, 0, 0, 0, 2, 0, Zer33451), 
LCon5415 = concatenate_layer([Zer33451,[[[[[0.3769], [0.6189], [0.7453]]], [[[0.3614], [0.408], [0.7402]]]]]], 4, Con5415), 
LMin39176 = minimum_layer([[[[0.278]]], [[[0.3238]]]], Min39176), 
LRes81945 = reshape_layer(Min39176, [1, 1, 1], Res81945), 
LSep64692 = separable_conv2D_layer(Res81945, 1, 1,[[[[[0.7412]]]],[[[[0.6803, 0.8442]]]]],[0, 0], 1, 1, true, Sep64692), 
LRes8034 = reshape_layer(Sep64692, [1, 1, 2, 1], Res8034), 
LCon85219 = conv3D_layer(Res8034, 1, 1, 2,[[[[[0.6144, 0.616]], [[0.4458, 0.4368]]]]],[0, 0], 1, 1, 1, true, 1, 1, 1, Con85219), 
LZer11786 = zero_padding3D_layer(Con85219, 1, 0, 0, 0, 1, 0, Zer11786), 
LMin69477 = minimum_layer([Con5415,Zer11786], Min69477), 
exec_layers([LLST66909,LFla89943,LRes78506,LRes55944,LRes89059,LZer33451,LCon5415,LMin39176,LRes81945,LSep64692,LRes8034,LCon85219,LZer11786,LMin69477],["LST66909","Fla89943","Res78506","Res55944","Res89059","Zer33451","Con5415","Min39176","Res81945","Sep64692","Res8034","Con85219","Zer11786","Min69477"],Min69477,"Min69477")

Actual (Unparsed): [[[[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000], [0.0000000, 0.1623314], [0.1068752, 0.1071535]]]]]

Expected (Unparsed): [[[[[0,0],[0,0],[0,0]]],[[[0,0],[0,0.16233136684889599],[0.10687515593932799,0.10715347665792]]]]]

Actual:   [[[[[0, 0], [0, 0], [0, 0]]], [[[0, 0], [0, 0.1624], [0.1069, 0.1072]]]]]

Expected: [[[[[0, 0], [0, 0], [0, 0]]], [[[0, 0], [0, 0.1624], [0.1069, 0.1072]]]]]