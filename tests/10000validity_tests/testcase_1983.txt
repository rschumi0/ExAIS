import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub50721 = tf.keras.layers.Input(shape=([3, 3, 3]))
in1Sub50721 = tf.keras.layers.Input(shape=([3, 3, 3]))
in0Ave79803 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave79803 = tf.keras.layers.Input(shape=([2, 2]))
in0Mul13683 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Mul13683 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))

Sub50721 = keras.layers.Subtract(name = 'Sub50721', )([in0Sub50721,in1Sub50721])
Res85065 = keras.layers.Reshape((3, 3, 3, 1), name = 'Res85065', )(Sub50721)
Ave79803 = keras.layers.Average(name = 'Ave79803', )([in0Ave79803,in1Ave79803])
Res1593 = keras.layers.Reshape((2, 2, 1), name = 'Res1593', )(Ave79803)
Res48254 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res48254', )(Res1593)
Zer91658 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer91658', )(Res48254)
Mul13683 = keras.layers.Multiply(name = 'Mul13683', )([in0Mul13683,in1Mul13683])
Zer97343 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (1, 0)), name = 'Zer97343', )(Mul13683)
Add38675 = keras.layers.Add(name = 'Add38675', )([Zer91658,Zer97343])
Zer9432 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (0, 0)), name = 'Zer9432', )(Add38675)
Add47547 = keras.layers.Add(name = 'Add47547', )([Res85065,Zer9432])
Con59144 = keras.layers.Conv3D(3, (2, 1, 2),strides=(1, 7, 8), padding='valid', dilation_rate=(1, 1, 1), name = 'Con59144', )(Add47547)
model = tf.keras.models.Model(inputs=[in0Sub50721,in1Sub50721,in0Ave79803,in1Ave79803,in0Mul13683,in1Mul13683], outputs=Con59144)
w = model.get_layer('Con59144').get_weights() 
w[0] = np.array([[[[[0.6194, 0.3369, 0.1116]], [[0.1802, 0.3361, 0.9815]]]], [[[[0.3374, 0.3036, 0.5713]], [[0.0891, 0.9985, 0.8256]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con59144').set_weights(w) 
in0Sub50721 = tf.constant([[[[0.9073, 0.5797, 0.108], [0.5889, 0.2006, 0.5059], [0.5897, 0.5014, 0.4041]], [[0.5434, 0.3398, 0.3602], [0.5753, 0.4803, 0.3273], [0.1027, 0.999, 0.9063]], [[0.9064, 0.1235, 0.3753], [0.0844, 0.8256, 0.9427], [0.8394, 0.8738, 0.2765]]]])
in1Sub50721 = tf.constant([[[[0.8184, 0.2234, 0.9232], [0.9603, 0.5025, 0.581], [0.3516, 0.3426, 0.0381]], [[0.0214, 0.7868, 0.3645], [0.355, 0.3219, 0.9416], [0.8853, 0.4308, 0.6222]], [[0.8733, 0.0403, 0.9557], [0.7455, 0.694, 0.5171], [0.7615, 0.3314, 0.7784]]]])
in0Ave79803 = tf.constant([[[0.4757, 0.7611], [0.0244, 0.4487]]])
in1Ave79803 = tf.constant([[[0.4689, 0.7781], [0.4129, 0.7087]]])
in0Mul13683 = tf.constant([[[[[0.2544], [0.442]]]]])
in1Mul13683 = tf.constant([[[[[0.2839], [0.8465]]]]])
print (np.array2string(model.predict([in0Sub50721,in1Sub50721,in0Ave79803,in1Ave79803,in0Mul13683,in1Mul13683],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con59144.png')

LSub50721 = subtract_layer([[[[0.9073, 0.5797, 0.108], [0.5889, 0.2006, 0.5059], [0.5897, 0.5014, 0.4041]], [[0.5434, 0.3398, 0.3602], [0.5753, 0.4803, 0.3273], [0.1027, 0.999, 0.9063]], [[0.9064, 0.1235, 0.3753], [0.0844, 0.8256, 0.9427], [0.8394, 0.8738, 0.2765]]]], [[[[0.8184, 0.2234, 0.9232], [0.9603, 0.5025, 0.581], [0.3516, 0.3426, 0.0381]], [[0.0214, 0.7868, 0.3645], [0.355, 0.3219, 0.9416], [0.8853, 0.4308, 0.6222]], [[0.8733, 0.0403, 0.9557], [0.7455, 0.694, 0.5171], [0.7615, 0.3314, 0.7784]]]], Sub50721), 
LRes85065 = reshape_layer(Sub50721, [3, 3, 3, 1], Res85065), 
LAve79803 = average_layer([[[[0.4757, 0.7611], [0.0244, 0.4487]]], [[[0.4689, 0.7781], [0.4129, 0.7087]]]], Ave79803), 
LRes1593 = reshape_layer(Ave79803, [2, 2, 1], Res1593), 
LRes48254 = reshape_layer(Res1593, [2, 2, 1, 1], Res48254), 
LZer91658 = zero_padding3D_layer(Res48254, 0, 0, 0, 0, 2, 0, Zer91658), 
LMul13683 = multiply_layer([[[[[[0.2544], [0.442]]]]], [[[[[0.2839], [0.8465]]]]]], Mul13683), 
LZer97343 = zero_padding3D_layer(Mul13683, 1, 0, 1, 0, 1, 0, Zer97343), 
LAdd38675 = add_layer([Zer91658,Zer97343], Add38675), 
LZer9432 = zero_padding3D_layer(Add38675, 1, 0, 1, 0, 0, 0, Zer9432), 
LAdd47547 = add_layer([Res85065,Zer9432], Add47547), 
LCon59144 = conv3D_layer(Add47547, 2, 1, 2,[[[[[0.6194, 0.3369, 0.1116]], [[0.1802, 0.3361, 0.9815]]]], [[[[0.3374, 0.3036, 0.5713]], [[0.0891, 0.9985, 0.8256]]]]],[0, 0, 0], 1, 7, 8, false, 1, 1, 1, Con59144), 
exec_layers([LSub50721,LRes85065,LAve79803,LRes1593,LRes48254,LZer91658,LMul13683,LZer97343,LAdd38675,LZer9432,LAdd47547,LCon59144],["Sub50721","Res85065","Ave79803","Res1593","Res48254","Zer91658","Mul13683","Zer97343","Add38675","Zer9432","Add47547","Con59144"],Con59144,"Con59144")

Actual (Unparsed): [[[[[0.2555650, -0.1381475, 0.2888051]]], [[[0.2613585, 0.1187494, -0.2928754]]]]]

Expected (Unparsed): [[[[[0.25556502,-0.1381474600000001,0.28880508999999993]]],[[[0.26135845999999996,0.11874945999999996,-0.29287535000000003]]]]]

Actual:   [[[[[0.2556, -0.1381, 0.2889]]], [[[0.2614, 0.1188, -0.2928]]]]]

Expected: [[[[[0.2556, -0.1381, 0.2889]]], [[[0.2614, 0.1188, -0.2928]]]]]