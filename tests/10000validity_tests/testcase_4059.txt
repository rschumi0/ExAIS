import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot88340 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot88340 = tf.keras.layers.Input(shape=([3, 3]))

Dot88340 = keras.layers.Dot(axes=(1, 1), name = 'Dot88340', )([in0Dot88340,in1Dot88340])
Fla82774 = keras.layers.Flatten(name = 'Fla82774', )(Dot88340)
Res21854 = keras.layers.Reshape((9, 1), name = 'Res21854', )(Fla82774)
Res14878 = keras.layers.Reshape((9, 1, 1), name = 'Res14878', )(Res21854)
Con19546 = keras.layers.Conv2D(3, (8, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con19546', )(Res14878)
Res48003 = keras.layers.Reshape((9, 3), name = 'Res48003', )(Con19546)
Per63934 = keras.layers.Permute((2,1), name = 'Per63934',)(Res48003)
model = tf.keras.models.Model(inputs=[in0Dot88340,in1Dot88340], outputs=Per63934)
w = model.get_layer('Con19546').get_weights() 
w[0] = np.array([[[[0.393, 0.3911, 0.7715]]], [[[0.5381, 0.5393, 0.4114]]], [[[0.0805, 0.6831, 0.0147]]], [[[0.529, 0.0667, 0.4015]]], [[[0.7212, 0.1659, 0.931]]], [[[0.6649, 0.3118, 0.0967]]], [[[0.0062, 0.3165, 0.5499]]], [[[0.3828, 0.0605, 0.7359]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con19546').set_weights(w) 
in0Dot88340 = tf.constant([[[0.2121, 0.569, 0.5021], [0.8639, 0.5328, 0.3788], [0.5288, 0.6748, 0.0229]]])
in1Dot88340 = tf.constant([[[0.017, 0.3418, 0.9702], [0.4016, 0.8727, 0.9311], [0.2323, 0.3609, 0.2835]]])
print (np.array2string(model.predict([in0Dot88340,in1Dot88340],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Per63934.png')

LDot88340 = dot_layer([[[0.2121, 0.569, 0.5021], [0.8639, 0.5328, 0.3788], [0.5288, 0.6748, 0.0229]]], [[[0.017, 0.3418, 0.9702], [0.4016, 0.8727, 0.9311], [0.2323, 0.3609, 0.2835]]], 1, 1, Dot88340), 
LFla82774 = flatten_layer(Dot88340, Fla82774), 
LRes21854 = reshape_layer(Fla82774, [9, 1], Res21854), 
LRes14878 = reshape_layer(Res21854, [9, 1, 1], Res14878), 
LCon19546 = conv2D_layer(Res14878, 8, 1,[[[[0.393, 0.3911, 0.7715]]], [[[0.5381, 0.5393, 0.4114]]], [[[0.0805, 0.6831, 0.0147]]], [[[0.529, 0.0667, 0.4015]]], [[[0.7212, 0.1659, 0.931]]], [[[0.6649, 0.3118, 0.0967]]], [[[0.0062, 0.3165, 0.5499]]], [[[0.3828, 0.0605, 0.7359]]]],[0, 0, 0], 1, 1, true, 1, 1, Con19546), 
LRes48003 = reshape_layer(Con19546, [9, 3], Res48003), 
LPer63934 = permute_layer(Res48003, 2,1, Per63934), 
exec_layers([LDot88340,LFla82774,LRes21854,LRes14878,LCon19546,LRes48003,LPer63934],["Dot88340","Fla82774","Res21854","Res14878","Con19546","Res48003","Per63934"],Per63934,"Per63934")

Actual (Unparsed): [[[2.1034302, 2.1458697, 1.8962664, 2.6998265, 2.8637110, 1.8533155, 1.7538476, 1.9155880, 1.0652152], [0.7370778, 1.0630719, 1.7745556, 2.1712509, 1.8137010, 1.8129220, 1.8420632, 1.3094267, 0.9794049], [2.1230143, 2.9408623, 1.9206614, 2.3809690, 3.7037034, 2.2316887, 1.3069123, 2.2018890, 1.3718179]]]

Expected (Unparsed): [[[2.103430201343,2.14586967162,1.896266424555,2.699826522576,2.8637109477519993,1.853315463427,1.7538475577030002,1.915587996623,1.06521523731],[0.737077813001,1.0630718410039999,1.7745555965609998,2.1712509241979996,1.8137009733659997,1.8129220232510002,1.842063226674,1.309426679787,0.9794048940729999],[2.123014337737,2.940862303989,1.9206613791409997,2.380969023145,3.703703335278,2.231688727419,1.306912318488,2.201888958862,1.3718178559299998]]]

Actual:   [[[2.1035, 2.1459, 1.8963, 2.6999, 2.8638, 1.8534, 1.7539, 1.9156, 1.0653], [0.7371, 1.0631, 1.7746, 2.1713, 1.8138, 1.813, 1.8421, 1.3095, 0.9795], [2.1231, 2.9409, 1.9207, 2.381, 3.7038, 2.2317, 1.307, 2.2019, 1.3719]]]

Expected: [[[2.1035, 2.1459, 1.8963, 2.6999, 2.8638, 1.8534, 1.7539, 1.9156, 1.0653], [0.7371, 1.0631, 1.7746, 2.1713, 1.8138, 1.813, 1.8421, 1.3095, 0.9795], [2.1231, 2.9409, 1.9207, 2.381, 3.7038, 2.2317, 1.307, 2.2019, 1.3719]]]