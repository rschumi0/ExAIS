import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub9612 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub9612 = tf.keras.layers.Input(shape=([2, 2]))
in0Cro27392 = tf.keras.layers.Input(shape=([1, 4]))
in0Con91317 = tf.keras.layers.Input(shape=([45]))

Sub9612 = keras.layers.Subtract(name = 'Sub9612', )([in0Sub9612,in1Sub9612])
Res86950 = keras.layers.Reshape((2, 2, 1), name = 'Res86950', )(Sub9612)
Res67186 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res67186', )(Res86950)
Zer36630 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer36630', )(Res67186)
Res585 = keras.layers.Reshape((4, 4, 3), name = 'Res585', )(Zer36630)
Res50154 = keras.layers.Reshape((4, 12), name = 'Res50154', )(Res585)
Fla44113 = keras.layers.Flatten(name = 'Fla44113', )(Res50154)
Cro27392 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro27392', )(in0Cro27392)
Res66264 = keras.layers.Reshape((1, 4, 1), name = 'Res66264', )(Cro27392)
Res69293 = keras.layers.Reshape((1, 4, 1, 1), name = 'Res69293', )(Res66264)
Up_75171 = keras.layers.UpSampling3D(size=(1, 2, 1), name = 'Up_75171', )(Res69293)
Res88789 = keras.layers.Reshape((1, 8, 1), name = 'Res88789', )(Up_75171)
Res76439 = keras.layers.Reshape((1, 8), name = 'Res76439', )(Res88789)
Sim63946 = keras.layers.SimpleRNN(3,name = 'Sim63946', )(Res76439)
Con91317 = keras.layers.Concatenate(axis=1, name = 'Con91317', )([Sim63946,in0Con91317])
Add97807 = keras.layers.Add(name = 'Add97807', )([Fla44113,Con91317])
model = tf.keras.models.Model(inputs=[in0Sub9612,in1Sub9612,in0Cro27392,in0Con91317], outputs=Add97807)
w = model.get_layer('Sim63946').get_weights() 
w[0] = np.array([[2, 1, 4], [8, 8, 2], [1, 1, 10], [3, 9, 1], [3, 4, 1], [1, 4, 1], [9, 6, 7], [8, 10, 10]])
w[1] = np.array([[5, 7, 10], [9, 10, 6], [5, 8, 5]])
w[2] = np.array([10, 5, 9])
model.get_layer('Sim63946').set_weights(w) 
in0Sub9612 = tf.constant([[[0.4856, 0.1408], [0.8036, 0.8628]]])
in1Sub9612 = tf.constant([[[0.4148, 0.7811], [0.035, 0.1725]]])
in0Cro27392 = tf.constant([[[1.3587, 1.1484, 1.1618, 1.6964]]])
in0Con91317 = tf.constant([[0.6008, 0.9337, 0.0789, 0.764, 0.6916, 0.7195, 0.0683, 0.5704, 0.5828, 0.7565, 0.0178, 0.3725, 0.6469, 0.244, 0.4729, 0.7902, 0.763, 0.9102, 0.1079, 0.8785, 0.6322, 0.8982, 0.5074, 0.9699, 0.7264, 0.5829, 0.034, 0.1405, 0.6594, 0.2533, 0.9374, 0.0879, 0.2633, 0.875, 0.9968, 0.7575, 0.6757, 0.2118, 0.1513, 0.8834, 0.3006, 0.4283, 0.7708, 0.7198, 0.593]])
print (np.array2string(model.predict([in0Sub9612,in1Sub9612,in0Cro27392,in0Con91317],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add97807.png')

LSub9612 = subtract_layer([[[0.4856, 0.1408], [0.8036, 0.8628]]], [[[0.4148, 0.7811], [0.035, 0.1725]]], Sub9612), 
LRes86950 = reshape_layer(Sub9612, [2, 2, 1], Res86950), 
LRes67186 = reshape_layer(Res86950, [2, 2, 1, 1], Res67186), 
LZer36630 = zero_padding3D_layer(Res67186, 1, 1, 1, 1, 1, 1, Zer36630), 
LRes585 = reshape_layer(Zer36630, [4, 4, 3], Res585), 
LRes50154 = reshape_layer(Res585, [4, 12], Res50154), 
LFla44113 = flatten_layer(Res50154, Fla44113), 
LCro27392 = cropping1D_layer([[[1.3587, 1.1484, 1.1618, 1.6964]]], 0, 0, Cro27392), 
LRes66264 = reshape_layer(Cro27392, [1, 4, 1], Res66264), 
LRes69293 = reshape_layer(Res66264, [1, 4, 1, 1], Res69293), 
LUp_75171 = up_sampling3D_layer(Res69293, 1, 2, 1, Up_75171), 
LRes88789 = reshape_layer(Up_75171, [1, 8, 1], Res88789), 
LRes76439 = reshape_layer(Res88789, [1, 8], Res76439), 
LSim63946 = simple_rnn_layer(Res76439,[[2, 1, 4], [8, 8, 2], [1, 1, 10], [3, 9, 1], [3, 4, 1], [1, 4, 1], [9, 6, 7], [8, 10, 10]],[[5, 7, 10], [9, 10, 6], [5, 8, 5]],[10, 5, 9], Sim63946), 
LCon91317 = concatenate_layer([Sim63946,[[0.6008, 0.9337, 0.0789, 0.764, 0.6916, 0.7195, 0.0683, 0.5704, 0.5828, 0.7565, 0.0178, 0.3725, 0.6469, 0.244, 0.4729, 0.7902, 0.763, 0.9102, 0.1079, 0.8785, 0.6322, 0.8982, 0.5074, 0.9699, 0.7264, 0.5829, 0.034, 0.1405, 0.6594, 0.2533, 0.9374, 0.0879, 0.2633, 0.875, 0.9968, 0.7575, 0.6757, 0.2118, 0.1513, 0.8834, 0.3006, 0.4283, 0.7708, 0.7198, 0.593]]], 1, Con91317), 
LAdd97807 = add_layer([Fla44113,Con91317], Add97807), 
exec_layers([LSub9612,LRes86950,LRes67186,LZer36630,LRes585,LRes50154,LFla44113,LCro27392,LRes66264,LRes69293,LUp_75171,LRes88789,LRes76439,LSim63946,LCon91317,LAdd97807],["Sub9612","Res86950","Res67186","Zer36630","Res585","Res50154","Fla44113","Cro27392","Res66264","Res69293","Up_75171","Res88789","Res76439","Sim63946","Con91317","Add97807"],Add97807,"Add97807")

Actual (Unparsed): [[1.0000000, 1.0000000, 1.0000000, 0.6008000, 0.9337000, 0.0789000, 0.7640000, 0.6916000, 0.7195000, 0.0683000, 0.5704000, 0.5828000, 0.7565000, 0.0178000, 0.3725000, 0.6469000, 0.3148000, 0.4729000, 0.7902000, 0.1227000, 0.9102000, 0.1079000, 0.8785000, 0.6322000, 0.8982000, 0.5074000, 0.9699000, 0.7264000, 1.3515000, 0.0340000, 0.1405000, 1.3497000, 0.2533000, 0.9374000, 0.0879000, 0.2633000, 0.8750000, 0.9968000, 0.7575000, 0.6757000, 0.2118000, 0.1513000, 0.8834000, 0.3006000, 0.4283000, 0.7708000, 0.7198000, 0.5930000]]

Expected (Unparsed): [[1.0,1.0,1.0,0.6008,0.9337,0.0789,0.764,0.6916,0.7195,0.0683,0.5704,0.5828,0.7565,0.0178,0.3725,0.6469,0.31479999999999997,0.4729,0.7902,0.12270000000000003,0.9102,0.1079,0.8785,0.6322,0.8982,0.5074,0.9699,0.7264,1.3515,0.034,0.1405,1.3497,0.2533,0.9374,0.0879,0.2633,0.875,0.9968,0.7575,0.6757,0.2118,0.1513,0.8834,0.3006,0.4283,0.7708,0.7198,0.593]]

Actual:   [[1, 1, 1, 0.6008, 0.9337, 0.0789, 0.764, 0.6916, 0.7195, 0.0683, 0.5704, 0.5828, 0.7565, 0.0178, 0.3725, 0.6469, 0.3148, 0.4729, 0.7902, 0.1227, 0.9102, 0.1079, 0.8785, 0.6322, 0.8982, 0.5074, 0.9699, 0.7264, 1.3515, 0.034, 0.1405, 1.3497, 0.2533, 0.9374, 0.0879, 0.2633, 0.875, 0.9968, 0.7575, 0.6757, 0.2118, 0.1513, 0.8834, 0.3006, 0.4283, 0.7708, 0.7198, 0.593]]

Expected: [[1, 1, 1, 0.6008, 0.9337, 0.0789, 0.764, 0.6916, 0.7195, 0.0683, 0.5704, 0.5828, 0.7565, 0.0178, 0.3725, 0.6469, 0.3148, 0.4729, 0.7902, 0.1228, 0.9102, 0.1079, 0.8785, 0.6322, 0.8982, 0.5074, 0.9699, 0.7264, 1.3515, 0.034, 0.1405, 1.3497, 0.2533, 0.9374, 0.0879, 0.2633, 0.875, 0.9968, 0.7575, 0.6757, 0.2118, 0.1513, 0.8834, 0.3006, 0.4283, 0.7708, 0.7198, 0.593]]