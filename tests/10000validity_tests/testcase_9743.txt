import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add29318 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Add29318 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Cro42623 = tf.keras.layers.Input(shape=([2, 4, 1]))
in0Con45189 = tf.keras.layers.Input(shape=([2, 7]))
in0Sub35040 = tf.keras.layers.Input(shape=([2]))
in1Sub35040 = tf.keras.layers.Input(shape=([2]))
in0Con94023 = tf.keras.layers.Input(shape=([14]))

Add29318 = keras.layers.Add(name = 'Add29318', )([in0Add29318,in1Add29318])
Res78533 = keras.layers.Reshape((2, 2, 4), name = 'Res78533', )(Add29318)
Res55256 = keras.layers.Reshape((2, 8), name = 'Res55256', )(Res78533)
Cro42623 = keras.layers.Cropping2D(cropping=((1, 0), (2, 1)), name = 'Cro42623', )(in0Cro42623)
Res56207 = keras.layers.Reshape((1, 1), name = 'Res56207', )(Cro42623)
PRe57354 = keras.layers.PReLU(name = 'PRe57354', )(Res56207)
Zer67313 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer67313', )(PRe57354)
Con45189 = keras.layers.Concatenate(axis=2, name = 'Con45189', )([Zer67313,in0Con45189])
Min47625 = keras.layers.Minimum(name = 'Min47625', )([Res55256,Con45189])
Fla38528 = keras.layers.Flatten(name = 'Fla38528', )(Min47625)
Sub35040 = keras.layers.Subtract(name = 'Sub35040', )([in0Sub35040,in1Sub35040])
Con94023 = keras.layers.Concatenate(axis=1, name = 'Con94023', )([Sub35040,in0Con94023])
Ave77160 = keras.layers.Average(name = 'Ave77160', )([Fla38528,Con94023])
model = tf.keras.models.Model(inputs=[in0Add29318,in1Add29318,in0Cro42623,in0Con45189,in0Sub35040,in1Sub35040,in0Con94023], outputs=Ave77160)
w = model.get_layer('PRe57354').get_weights() 
w[0] = np.array([[0.487]])
model.get_layer('PRe57354').set_weights(w) 
in0Add29318 = tf.constant([[[[[0.4245, 0.6096], [0.1887, 0.3362]], [[0.3507, 0.9843], [0.8718, 0.7354]]], [[[0.0878, 0.4231], [0.5581, 0.2633]], [[0.1816, 0.4208], [0.4418, 0.5867]]]]])
in1Add29318 = tf.constant([[[[[0.4915, 0.8945], [0.2416, 0.9116]], [[0.7685, 0.8042], [0.7765, 0.3281]]], [[[0.7901, 0.1315], [0.4424, 0.1352]], [[0.067, 0.9631], [0.6846, 0.6019]]]]])
in0Cro42623 = tf.constant([[[[1.9616], [1.5701], [1.341], [1.844]], [[1.042], [1.9259], [1.1651], [1.6247]]]])
in0Con45189 = tf.constant([[[0.1234, 0.6791, 0.6701, 0.291, 0.1709, 0.6448, 0.5352], [0.5431, 0.6113, 0.224, 0.889, 0.9129, 0.6117, 0.3546]]])
in0Sub35040 = tf.constant([[0.6288, 0.0651]])
in1Sub35040 = tf.constant([[0.9272, 0.9249]])
in0Con94023 = tf.constant([[0.2546, 0.9663, 0.558, 0.0638, 0.5199, 0.5359, 0.5015, 0.292, 0.8072, 0.0733, 0.4536, 0.5954, 0.3477, 0.5005]])
print (np.array2string(model.predict([in0Add29318,in1Add29318,in0Cro42623,in0Con45189,in0Sub35040,in1Sub35040,in0Con94023],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave77160.png')

LAdd29318 = add_layer([[[[[[0.4245, 0.6096], [0.1887, 0.3362]], [[0.3507, 0.9843], [0.8718, 0.7354]]], [[[0.0878, 0.4231], [0.5581, 0.2633]], [[0.1816, 0.4208], [0.4418, 0.5867]]]]], [[[[[0.4915, 0.8945], [0.2416, 0.9116]], [[0.7685, 0.8042], [0.7765, 0.3281]]], [[[0.7901, 0.1315], [0.4424, 0.1352]], [[0.067, 0.9631], [0.6846, 0.6019]]]]]], Add29318), 
LRes78533 = reshape_layer(Add29318, [2, 2, 4], Res78533), 
LRes55256 = reshape_layer(Res78533, [2, 8], Res55256), 
LCro42623 = cropping2D_layer([[[[1.9616], [1.5701], [1.341], [1.844]], [[1.042], [1.9259], [1.1651], [1.6247]]]], 1, 0, 2, 1, Cro42623), 
LRes56207 = reshape_layer(Cro42623, [1, 1], Res56207), 
LPRe57354 = prelu_layer(Res56207, [[0.487]], PRe57354), 
LZer67313 = zero_padding1D_layer(PRe57354, 1, 0, Zer67313), 
LCon45189 = concatenate_layer([Zer67313,[[[0.1234, 0.6791, 0.6701, 0.291, 0.1709, 0.6448, 0.5352], [0.5431, 0.6113, 0.224, 0.889, 0.9129, 0.6117, 0.3546]]]], 2, Con45189), 
LMin47625 = minimum_layer([Res55256,Con45189], Min47625), 
LFla38528 = flatten_layer(Min47625, Fla38528), 
LSub35040 = subtract_layer([[0.6288, 0.0651]], [[0.9272, 0.9249]], Sub35040), 
LCon94023 = concatenate_layer([Sub35040,[[0.2546, 0.9663, 0.558, 0.0638, 0.5199, 0.5359, 0.5015, 0.292, 0.8072, 0.0733, 0.4536, 0.5954, 0.3477, 0.5005]]], 1, Con94023), 
LAve77160 = average_layer([Fla38528,Con94023], Ave77160), 
exec_layers([LAdd29318,LRes78533,LRes55256,LCro42623,LRes56207,LPRe57354,LZer67313,LCon45189,LMin47625,LFla38528,LSub35040,LCon94023,LAve77160],["Add29318","Res78533","Res55256","Cro42623","Res56207","PRe57354","Zer67313","Con45189","Min47625","Fla38528","Sub35040","Con94023","Ave77160"],Ave77160,"Ave77160")

Actual (Unparsed): [[-0.1492000, -0.3682000, 0.3424500, 0.8182000, 0.4245000, 0.1173500, 0.5823500, 0.5355500, 0.6897000, 0.4175500, 0.7092500, 0.1486500, 0.3511000, 0.7541500, 0.4797000, 0.4275500]]

Expected (Unparsed): [[-0.1492,-0.3682,0.34245000000000003,0.8182,0.4245,0.11735,0.58235,0.53555,0.6897,0.41755,0.7092499999999999,0.14865,0.3511,0.7541500000000001,0.4797,0.42755]]

Actual:   [[-0.1492, -0.3682, 0.3425, 0.8182, 0.4245, 0.1174, 0.5824, 0.5356, 0.6897, 0.4176, 0.7093, 0.1487, 0.3511, 0.7542, 0.4797, 0.4276]]

Expected: [[-0.1492, -0.3682, 0.3425, 0.8182, 0.4245, 0.1174, 0.5824, 0.5356, 0.6897, 0.4176, 0.7093, 0.1487, 0.3511, 0.7542, 0.4797, 0.4276]]