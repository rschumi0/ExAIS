import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min84146 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Min84146 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Glo35218 = tf.keras.layers.Input(shape=([2, 2]))
in0Con63561 = tf.keras.layers.Input(shape=([2]))
in0Con22145 = tf.keras.layers.Input(shape=([4, 1]))
in0Dot51478 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot51478 = tf.keras.layers.Input(shape=([3, 2]))

Min84146 = keras.layers.Minimum(name = 'Min84146', )([in0Min84146,in1Min84146])
Res77043 = keras.layers.Reshape((2, 1, 2), name = 'Res77043', )(Min84146)
Res27890 = keras.layers.Reshape((2, 2), name = 'Res27890', )(Res77043)
Fla16330 = keras.layers.Flatten(name = 'Fla16330', )(Res27890)
Glo35218 = keras.layers.GlobalAveragePooling1D(name = 'Glo35218', )(in0Glo35218)
Con63561 = keras.layers.Concatenate(axis=1, name = 'Con63561', )([Glo35218,in0Con63561])
Ave85324 = keras.layers.Average(name = 'Ave85324', )([Fla16330,Con63561])
Res95625 = keras.layers.Reshape((4, 1), name = 'Res95625', )(Ave85324)
Max11902 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='same', name = 'Max11902', )(Res95625)
Con22145 = keras.layers.Concatenate(axis=2, name = 'Con22145', )([Max11902,in0Con22145])
Dot51478 = keras.layers.Dot(axes=(1, 1), name = 'Dot51478', )([in0Dot51478,in1Dot51478])
Zer21082 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer21082', )(Dot51478)
Max53503 = keras.layers.Maximum(name = 'Max53503', )([Con22145,Zer21082])
model = tf.keras.models.Model(inputs=[in0Min84146,in1Min84146,in0Glo35218,in0Con63561,in0Con22145,in0Dot51478,in1Dot51478], outputs=Max53503)
in0Min84146 = tf.constant([[[[[0.0591], [0.2805]]], [[[0.8523], [0.5477]]]]])
in1Min84146 = tf.constant([[[[[0.2208], [0.8522]]], [[[0.6582], [0.5525]]]]])
in0Glo35218 = tf.constant([[[1.3748, 1.4425], [1.7188, 1.453]]])
in0Con63561 = tf.constant([[0.8951, 0.4232]])
in0Con22145 = tf.constant([[[0.7747], [0.5264], [0.7832], [0.6989]]])
in0Dot51478 = tf.constant([[[0.1583, 0.0339], [0.4012, 0.8249], [0.533, 0.8673]]])
in1Dot51478 = tf.constant([[[0.1425, 0.2495], [0.7248, 0.8796], [0.6746, 0.8801]]])
print (np.array2string(model.predict([in0Min84146,in1Min84146,in0Glo35218,in0Con63561,in0Con22145,in0Dot51478,in1Dot51478],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max53503.png')

LMin84146 = minimum_layer([[[[[[0.0591], [0.2805]]], [[[0.8523], [0.5477]]]]], [[[[[0.2208], [0.8522]]], [[[0.6582], [0.5525]]]]]], Min84146), 
LRes77043 = reshape_layer(Min84146, [2, 1, 2], Res77043), 
LRes27890 = reshape_layer(Res77043, [2, 2], Res27890), 
LFla16330 = flatten_layer(Res27890, Fla16330), 
LGlo35218 = global_average_pooling1D_layer([[[1.3748, 1.4425], [1.7188, 1.453]]], Glo35218), 
LCon63561 = concatenate_layer([Glo35218,[[0.8951, 0.4232]]], 1, Con63561), 
LAve85324 = average_layer([Fla16330,Con63561], Ave85324), 
LRes95625 = reshape_layer(Ave85324, [4, 1], Res95625), 
LMax11902 = max_pool1D_layer(Res95625, 1, 1, true, Max11902), 
LCon22145 = concatenate_layer([Max11902,[[[0.7747], [0.5264], [0.7832], [0.6989]]]], 2, Con22145), 
LDot51478 = dot_layer([[[0.1583, 0.0339], [0.4012, 0.8249], [0.533, 0.8673]]], [[[0.1425, 0.2495], [0.7248, 0.8796], [0.6746, 0.8801]]], 1, 1, Dot51478), 
LZer21082 = zero_padding1D_layer(Dot51478, 2, 0, Zer21082), 
LMax53503 = maximum_layer([Con22145,Zer21082], Max53503), 
exec_layers([LMin84146,LRes77043,LRes27890,LFla16330,LGlo35218,LCon63561,LAve85324,LRes95625,LMax11902,LCon22145,LDot51478,LZer21082,LMax53503],["Min84146","Res77043","Res27890","Fla16330","Glo35218","Con63561","Ave85324","Res95625","Max11902","Con22145","Dot51478","Zer21082","Max53503"],Max53503,"Max53503")

Actual (Unparsed): [[[0.8029500, 0.7747000], [0.8641250, 0.5264000], [0.7766500, 0.8614847], [1.1877988, 1.4973508]]]

Expected (Unparsed): [[[0.80295,0.7747],[0.864125,0.5264],[0.7766500000000001,0.8614846700000001],[1.18779885,1.4973508199999999]]]

Actual:   [[[0.803, 0.7747], [0.8642, 0.5264], [0.7767, 0.8615], [1.1878, 1.4974]]]

Expected: [[[0.803, 0.7747], [0.8642, 0.5264], [0.7767, 0.8615], [1.1878, 1.4974]]]