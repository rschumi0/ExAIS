import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max92710 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Max92710 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Sub76101 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub76101 = tf.keras.layers.Input(shape=([2, 2]))
in0Con80220 = tf.keras.layers.Input(shape=([2, 6]))
in0Ave54925 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con76290 = tf.keras.layers.Input(shape=([2]))
in0Ave64107 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Ave64107 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con57976 = tf.keras.layers.Input(shape=([13]))

Max92710 = keras.layers.Maximum(name = 'Max92710', )([in0Max92710,in1Max92710])
Con99132 = keras.layers.Conv3D(2, (1, 1, 2),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con99132', )(Max92710)
Res7749 = keras.layers.Reshape((1, 2, 4), name = 'Res7749', )(Con99132)
Res94489 = keras.layers.Reshape((1, 8), name = 'Res94489', )(Res7749)
Zer33978 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer33978', )(Res94489)
Sub76101 = keras.layers.Subtract(name = 'Sub76101', )([in0Sub76101,in1Sub76101])
Con80220 = keras.layers.Concatenate(axis=2, name = 'Con80220', )([Sub76101,in0Con80220])
Min74107 = keras.layers.Minimum(name = 'Min74107', )([Zer33978,Con80220])
Fla31246 = keras.layers.Flatten(name = 'Fla31246', )(Min74107)
Ave54925 = keras.layers.AveragePooling2D(pool_size=(1, 1), name = 'Ave54925', )(in0Ave54925)
Res38201 = keras.layers.Reshape((1, 1), name = 'Res38201', )(Ave54925)
Fla29327 = keras.layers.Flatten(name = 'Fla29327', )(Res38201)
Con76290 = keras.layers.Concatenate(axis=1, name = 'Con76290', )([Fla29327,in0Con76290])
Ave64107 = keras.layers.Average(name = 'Ave64107', )([in0Ave64107,in1Ave64107])
Res85479 = keras.layers.Reshape((1, 2), name = 'Res85479', )(Ave64107)
LST99005 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST99005', )(Res85479)
Ave6381 = keras.layers.Average(name = 'Ave6381', )([Con76290,LST99005])
Con57976 = keras.layers.Concatenate(axis=1, name = 'Con57976', )([Ave6381,in0Con57976])
Add35247 = keras.layers.Add(name = 'Add35247', )([Fla31246,Con57976])
model = tf.keras.models.Model(inputs=[in0Max92710,in1Max92710,in0Sub76101,in1Sub76101,in0Con80220,in0Ave54925,in0Con76290,in0Ave64107,in1Ave64107,in0Con57976], outputs=Add35247)
w = model.get_layer('Con99132').get_weights() 
w[0] = np.array([[[[[0.8494, 0.7857]], [[0.6135, 0.6821]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con99132').set_weights(w) 
w = model.get_layer('LST99005').get_weights() 
w[0] = np.array([[6, 10, 8, 9, 10, 3, 8, 6, 2, 3, 5, 6], [8, 1, 6, 2, 10, 3, 7, 6, 9, 9, 5, 9]])
w[1] = np.array([[5, 8, 5, 2, 4, 8, 2, 9, 6, 4, 7, 10], [3, 7, 1, 4, 9, 6, 10, 7, 3, 1, 7, 10], [1, 1, 4, 8, 7, 10, 6, 8, 8, 10, 10, 8]])
w[2] = np.array([4, 9, 1, 10, 6, 9, 6, 8, 10, 1, 7, 9])
model.get_layer('LST99005').set_weights(w) 
in0Max92710 = tf.constant([[[[[0.2842], [0.4343]], [[0.8853], [0.6204]]]]])
in1Max92710 = tf.constant([[[[[0.3121], [0.7044]], [[0.6869], [0.2949]]]]])
in0Sub76101 = tf.constant([[[0.0715, 0.4823], [0.7495, 0.1835]]])
in1Sub76101 = tf.constant([[[0.2034, 0.7269], [0.2037, 0.0509]]])
in0Con80220 = tf.constant([[[0.9521, 0.8927, 0.8499, 0.4213, 0.6482, 0.7231], [0.9973, 0.8126, 0.7185, 0.6942, 0.0468, 0.1245]]])
in0Ave54925 = tf.constant([[[[1.9447]]]])
in0Con76290 = tf.constant([[0.4644, 0.9424]])
in0Ave64107 = tf.constant([[[[0.7245, 0.8483]]]])
in1Ave64107 = tf.constant([[[[0.4021, 0.6527]]]])
in0Con57976 = tf.constant([[0.1394, 0.5462, 0.9841, 0.8766, 0.2603, 0.878, 0.7598, 0.6575, 0.8561, 0.7567, 0.1348, 0.7332, 0.0744]])
print (np.array2string(model.predict([in0Max92710,in1Max92710,in0Sub76101,in1Sub76101,in0Con80220,in0Ave54925,in0Con76290,in0Ave64107,in1Ave64107,in0Con57976],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add35247.png')

LMax92710 = maximum_layer([[[[[[0.2842], [0.4343]], [[0.8853], [0.6204]]]]], [[[[[0.3121], [0.7044]], [[0.6869], [0.2949]]]]]], Max92710), 
LCon99132 = conv3D_layer(Max92710, 1, 1, 2,[[[[[0.8494, 0.7857]], [[0.6135, 0.6821]]]]],[0, 0], 1, 1, 1, true, 1, 1, 1, Con99132), 
LRes7749 = reshape_layer(Con99132, [1, 2, 4], Res7749), 
LRes94489 = reshape_layer(Res7749, [1, 8], Res94489), 
LZer33978 = zero_padding1D_layer(Res94489, 1, 0, Zer33978), 
LSub76101 = subtract_layer([[[0.0715, 0.4823], [0.7495, 0.1835]]], [[[0.2034, 0.7269], [0.2037, 0.0509]]], Sub76101), 
LCon80220 = concatenate_layer([Sub76101,[[[0.9521, 0.8927, 0.8499, 0.4213, 0.6482, 0.7231], [0.9973, 0.8126, 0.7185, 0.6942, 0.0468, 0.1245]]]], 2, Con80220), 
LMin74107 = minimum_layer([Zer33978,Con80220], Min74107), 
LFla31246 = flatten_layer(Min74107, Fla31246), 
LAve54925 = average_pooling2D_layer([[[[1.9447]]]], 1, 1, Ave54925), 
LRes38201 = reshape_layer(Ave54925, [1, 1], Res38201), 
LFla29327 = flatten_layer(Res38201, Fla29327), 
LCon76290 = concatenate_layer([Fla29327,[[0.4644, 0.9424]]], 1, Con76290), 
LAve64107 = average_layer([[[[[0.7245, 0.8483]]]], [[[[0.4021, 0.6527]]]]], Ave64107), 
LRes85479 = reshape_layer(Ave64107, [1, 2], Res85479), 
LLST99005 = lstm_layer(Res85479,[[6, 10, 8, 9, 10, 3, 8, 6, 2, 3, 5, 6], [8, 1, 6, 2, 10, 3, 7, 6, 9, 9, 5, 9]],[[5, 8, 5, 2, 4, 8, 2, 9, 6, 4, 7, 10], [3, 7, 1, 4, 9, 6, 10, 7, 3, 1, 7, 10], [1, 1, 4, 8, 7, 10, 6, 8, 8, 10, 10, 8]],[4, 9, 1, 10, 6, 9, 6, 8, 10, 1, 7, 9], LST99005), 
LAve6381 = average_layer([Con76290,LST99005], Ave6381), 
LCon57976 = concatenate_layer([Ave6381,[[0.1394, 0.5462, 0.9841, 0.8766, 0.2603, 0.878, 0.7598, 0.6575, 0.8561, 0.7567, 0.1348, 0.7332, 0.0744]]], 1, Con57976), 
LAdd35247 = add_layer([Fla31246,Con57976], Add35247), 
exec_layers([LMax92710,LCon99132,LRes7749,LRes94489,LZer33978,LSub76101,LCon80220,LMin74107,LFla31246,LAve54925,LRes38201,LFla29327,LCon76290,LAve64107,LRes85479,LLST99005,LAve6381,LCon57976,LAdd35247],["Max92710","Con99132","Res7749","Res94489","Zer33978","Sub76101","Con80220","Min74107","Fla31246","Ave54925","Res38201","Fla29327","Con76290","Ave64107","Res85479","LST99005","Ave6381","Con57976","Add35247"],Add35247,"Add35247")

Actual (Unparsed): [[1.2212166, 0.3683966, 0.8519876, 0.1394000, 0.5462000, 0.9841000, 0.8766000, 0.2603000, 1.4238000, 0.8924000, 1.2558174, 1.4095471, 1.4752000, 0.8290000, 0.7800000, 0.1989000]]

Expected (Unparsed): [[1.2212166240009692,0.3683965469538884,0.8519876320051063,0.1394,0.5462,0.9841,0.8766,0.2603,1.4238,0.8924000000000001,1.25581736,1.4095470799999998,1.4752,0.8290000000000001,0.7799999999999999,0.1989]]

Actual:   [[1.2213, 0.3684, 0.852, 0.1394, 0.5462, 0.9841, 0.8766, 0.2603, 1.4238, 0.8924, 1.2559, 1.4096, 1.4752, 0.829, 0.78, 0.1989]]

Expected: [[1.2213, 0.3684, 0.852, 0.1394, 0.5462, 0.9841, 0.8766, 0.2603, 1.4238, 0.8925, 1.2559, 1.4096, 1.4752, 0.8291, 0.78, 0.1989]]