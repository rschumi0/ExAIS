import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max22199 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Max22199 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Con79294 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0PRe84318 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))

Max22199 = keras.layers.Maximum(name = 'Max22199', )([in0Max22199,in1Max22199])
Con79294 = keras.layers.Concatenate(axis=4, name = 'Con79294', )([Max22199,in0Con79294])
PRe84318 = keras.layers.PReLU(name = 'PRe84318', input_shape=(1, 1, 2, 2))(in0PRe84318)
Zer471 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (0, 0)), name = 'Zer471', )(PRe84318)
Add64546 = keras.layers.Add(name = 'Add64546', )([Con79294,Zer471])
Mas56218 = keras.layers.Masking(mask_value=1, name = 'Mas56218', )(Add64546)
Res84814 = keras.layers.Reshape((1, 2, 4), name = 'Res84814', )(Mas56218)
Res82412 = keras.layers.Reshape((1, 8), name = 'Res82412', )(Res84814)
LST54792 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST54792', )(Res82412)
model = tf.keras.models.Model(inputs=[in0Max22199,in1Max22199,in0Con79294,in0PRe84318], outputs=LST54792)
w = model.get_layer('PRe84318').get_weights() 
w[0] = np.array([[[[0.9882, 0.2392], [0.391, 0.5685]]]])
model.get_layer('PRe84318').set_weights(w) 
w = model.get_layer('LST54792').get_weights() 
w[0] = np.array([[8, 8, 6, 10, 5, 10, 2, 1], [4, 8, 4, 2, 8, 10, 7, 3], [5, 6, 5, 8, 3, 1, 3, 6], [5, 8, 1, 4, 1, 6, 8, 7], [6, 8, 9, 9, 3, 5, 6, 5], [7, 2, 3, 8, 6, 10, 4, 9], [5, 6, 8, 5, 4, 8, 1, 3], [4, 3, 9, 1, 5, 3, 9, 10]])
w[1] = np.array([[10, 10, 6, 1, 8, 10, 3, 8], [9, 7, 1, 6, 10, 7, 9, 1]])
w[2] = np.array([8, 7, 10, 4, 7, 2, 3, 3])
model.get_layer('LST54792').set_weights(w) 
in0Max22199 = tf.constant([[[[[0.7443], [0.3861]], [[0.2819], [0.4953]]]]])
in1Max22199 = tf.constant([[[[[0.3688], [0.0878]], [[0.9443], [0.0691]]]]])
in0Con79294 = tf.constant([[[[[0.0877], [0.7499]], [[0.5994], [0.6928]]]]])
in0PRe84318 = tf.constant([[[[[0.9351, 0.8275], [0.8525, 0.2333]]]]])
print (np.array2string(model.predict([in0Max22199,in1Max22199,in0Con79294,in0PRe84318],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST54792.png')

LMax22199 = maximum_layer([[[[[[0.7443], [0.3861]], [[0.2819], [0.4953]]]]], [[[[[0.3688], [0.0878]], [[0.9443], [0.0691]]]]]], Max22199), 
LCon79294 = concatenate_layer([Max22199,[[[[[0.0877], [0.7499]], [[0.5994], [0.6928]]]]]], 4, Con79294), 
LPRe84318 = prelu_layer([[[[[0.9351, 0.8275], [0.8525, 0.2333]]]]], [[[[0.9882, 0.2392], [0.391, 0.5685]]]], PRe84318), 
LZer471 = zero_padding3D_layer(PRe84318, 0, 0, 1, 0, 0, 0, Zer471), 
LAdd64546 = add_layer([Con79294,Zer471], Add64546), 
LMas56218 = masking_layer(Add64546, 1, Mas56218), 
LRes84814 = reshape_layer(Mas56218, [1, 2, 4], Res84814), 
LRes82412 = reshape_layer(Res84814, [1, 8], Res82412), 
LLST54792 = lstm_layer(Res82412,[[8, 8, 6, 10, 5, 10, 2, 1], [4, 8, 4, 2, 8, 10, 7, 3], [5, 6, 5, 8, 3, 1, 3, 6], [5, 8, 1, 4, 1, 6, 8, 7], [6, 8, 9, 9, 3, 5, 6, 5], [7, 2, 3, 8, 6, 10, 4, 9], [5, 6, 8, 5, 4, 8, 1, 3], [4, 3, 9, 1, 5, 3, 9, 10]],[[10, 10, 6, 1, 8, 10, 3, 8], [9, 7, 1, 6, 10, 7, 9, 1]],[8, 7, 10, 4, 7, 2, 3, 3], LST54792), 
exec_layers([LMax22199,LCon79294,LPRe84318,LZer471,LAdd64546,LMas56218,LRes84814,LRes82412,LLST54792],["Max22199","Con79294","PRe84318","Zer471","Add64546","Mas56218","Res84814","Res82412","LST54792"],LST54792,"LST54792")

Actual (Unparsed): [[0.7615942, 0.7615942]]

Expected (Unparsed): [[0.7615941559557649,0.7615941559557649]]

Actual:   [[0.7616, 0.7616]]

Expected: [[0.7616, 0.7616]]