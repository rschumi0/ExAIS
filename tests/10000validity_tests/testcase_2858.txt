import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sof32238 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Per44507 = tf.keras.layers.Input(shape=([2, 4]))

Sof32238 = keras.layers.Softmax(axis=1, name = 'Sof32238', input_shape=(2, 2, 2))(in0Sof32238)
Mas35148 = keras.layers.Masking(mask_value=1, name = 'Mas35148', )(Sof32238)
Res87190 = keras.layers.Reshape((2, 4), name = 'Res87190', )(Mas35148)
Per44507 = keras.layers.Permute((1,2), name = 'Per44507',)(in0Per44507)
Ave28921 = keras.layers.Average(name = 'Ave28921', )([Res87190,Per44507])
Sim90961 = keras.layers.SimpleRNN(1,name = 'Sim90961', )(Ave28921)
model = tf.keras.models.Model(inputs=[in0Sof32238,in0Per44507], outputs=Sim90961)
w = model.get_layer('Sim90961').get_weights() 
w[0] = np.array([[10], [4], [5], [9]])
w[1] = np.array([[7]])
w[2] = np.array([6])
model.get_layer('Sim90961').set_weights(w) 
in0Sof32238 = tf.constant([[[[0.8626, 0.0695], [0.1561, 0.3036]], [[0.4641, 0.2848], [0.9857, 0.9983]]]])
in0Per44507 = tf.constant([[[1.3514, 1.3021, 1.549, 1.7854], [1.2937, 1.179, 1.3704, 1.6138]]])
print (np.array2string(model.predict([in0Sof32238,in0Per44507],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sim90961.png')

LSof32238 = softmax_layer([[[[0.8626, 0.0695], [0.1561, 0.3036]], [[0.4641, 0.2848], [0.9857, 0.9983]]]], 1, Sof32238), 
LMas35148 = masking_layer(Sof32238, 1, Mas35148), 
LRes87190 = reshape_layer(Mas35148, [2, 4], Res87190), 
LPer44507 = permute_layer([[[1.3514, 1.3021, 1.549, 1.7854], [1.2937, 1.179, 1.3704, 1.6138]]], 1,2, Per44507), 
LAve28921 = average_layer([Res87190,Per44507], Ave28921), 
LSim90961 = simple_rnn_layer(Ave28921,[[10], [4], [5], [9]],[[7]],[6], Sim90961), 
exec_layers([LSof32238,LMas35148,LRes87190,LPer44507,LAve28921,LSim90961],["Sof32238","Mas35148","Res87190","Per44507","Ave28921","Sim90961"],Sim90961,"Sim90961")

Actual (Unparsed): [[1.0000000]]

Expected (Unparsed): [[1.0]]

Actual:   [[1]]

Expected: [[1]]