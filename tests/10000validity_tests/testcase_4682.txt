import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo38972 = tf.keras.layers.Input(shape=([1, 2]))
in0Con59441 = tf.keras.layers.Input(shape=([3, 5, 3]))
in0Zer28739 = tf.keras.layers.Input(shape=([1, 3, 4]))
in0Con89701 = tf.keras.layers.Input(shape=([3, 2, 1]))
in0Loc6226 = tf.keras.layers.Input(shape=([1, 1]))
in0Con15458 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Ave29829 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Ave29829 = tf.keras.layers.Input(shape=([2, 2, 2]))

Glo38972 = keras.layers.GlobalMaxPool1D(name = 'Glo38972', )(in0Glo38972)
Res479 = keras.layers.Reshape((2, 1), name = 'Res479', )(Glo38972)
Res31263 = keras.layers.Reshape((2, 1, 1), name = 'Res31263', )(Res479)
Zer49296 = keras.layers.ZeroPadding2D(padding=((1, 0), (4, 0)), name = 'Zer49296', )(Res31263)
Con59441 = keras.layers.Concatenate(axis=3, name = 'Con59441', )([Zer49296,in0Con59441])
Zer28739 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer28739', )(in0Zer28739)
Sub95957 = keras.layers.Subtract(name = 'Sub95957', )([Con59441,Zer28739])
Res86608 = keras.layers.Reshape((3, 20), name = 'Res86608', )(Sub95957)
Con96544 = keras.layers.Conv1D(2, (2),strides=(1), padding='same', dilation_rate=(1), name = 'Con96544', )(Res86608)
Res49038 = keras.layers.Reshape((3, 2, 1), name = 'Res49038', )(Con96544)
Con89701 = keras.layers.Concatenate(axis=3, name = 'Con89701', )([Res49038,in0Con89701])
Loc6226 = keras.layers.LocallyConnected1D(2, (1),strides=(1), name = 'Loc6226', )(in0Loc6226)
Res93317 = keras.layers.Reshape((1, 2, 1), name = 'Res93317', )(Loc6226)
Zer90820 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer90820', )(Res93317)
Con15458 = keras.layers.Concatenate(axis=3, name = 'Con15458', )([Zer90820,in0Con15458])
Ave29829 = keras.layers.Average(name = 'Ave29829', )([in0Ave29829,in1Ave29829])
Con60182 = keras.layers.Conv2D(2, (1, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con60182', )(Ave29829)
Mul50429 = keras.layers.Multiply(name = 'Mul50429', )([Con15458,Con60182])
Zer97985 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer97985', )(Mul50429)
Sub2742 = keras.layers.Subtract(name = 'Sub2742', )([Con89701,Zer97985])
model = tf.keras.models.Model(inputs=[in0Glo38972,in0Con59441,in0Zer28739,in0Con89701,in0Loc6226,in0Con15458,in0Ave29829,in1Ave29829], outputs=Sub2742)
w = model.get_layer('Con96544').get_weights() 
w[0] = np.array([[[0.0573, 0.2382], [0.3192, 0.201], [0.9204, 0.5921], [0.1596, 0.6905], [0.7121, 0.1807], [0.8354, 0.2757], [0.2439, 0.5808], [0.198, 0.4191], [0.9068, 0.0603], [0.9125, 0.1539], [0.6679, 0.5723], [0.2092, 0.0746], [0.2813, 0.5035], [0.8236, 0.2932], [0.6433, 0.5982], [0.8779, 0.4236], [0.4046, 0.3591], [0.343, 0.3597], [0.7934, 0.012], [0.7637, 0.7323]], [[0.1028, 0.8148], [0.1317, 0.4471], [0.4438, 0.0876], [0.1451, 0.6334], [0.1812, 0.8493], [0.6076, 0.6673], [0.9311, 0.3527], [0.3891, 0.6712], [0.1212, 0.1321], [0.1939, 0.0376], [0.8968, 0.3966], [0.3652, 0.076], [0.5849, 0.736], [0.0914, 0.8416], [0.0234, 0.1399], [0.6741, 0.5668], [0.8091, 0.2739], [0.9682, 0.8879], [0.9188, 0.8052], [0.7098, 0.236]]])
w[1] = np.array([0, 0])
model.get_layer('Con96544').set_weights(w) 
w = model.get_layer('Loc6226').get_weights() 
w[0] = np.array([[[0.8873, 0.2368]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc6226').set_weights(w) 
w = model.get_layer('Con60182').get_weights() 
w[0] = np.array([[[[0.1206, 0.6597], [0.1893, 0.2772]]]])
w[1] = np.array([0, 0])
model.get_layer('Con60182').set_weights(w) 
in0Glo38972 = tf.constant([[[1.0522, 1.5358]]])
in0Con59441 = tf.constant([[[[0.7379, 0.0403, 0.526], [0.457, 0.4905, 0.9712], [0.7037, 0.3919, 0.8956], [0.8897, 0.0016, 0.8535], [0.0841, 0.0339, 0.1237]], [[0.6897, 0.0451, 0.5285], [0.8901, 0.3975, 0.8924], [0.8095, 0.0267, 0.9881], [0.3032, 0.5878, 0.1071], [0.1264, 0.4396, 0.3867]], [[0.2259, 0.1848, 0.3974], [0.4063, 0.2351, 0.7041], [0.2458, 0.7055, 0.4065], [0.6374, 0.0177, 0.4714], [0.199, 0.6695, 0.5892]]]])
in0Zer28739 = tf.constant([[[[1.3003, 1.9808, 1.7216, 1.9582], [1.8972, 1.0386, 1.4773, 1.7552], [1.9489, 1.4383, 1.2403, 1.7598]]]])
in0Con89701 = tf.constant([[[[0.4595], [0.5325]], [[0.4717], [0.964]], [[0.1096], [0.6606]]]])
in0Loc6226 = tf.constant([[[0.1681]]])
in0Con15458 = tf.constant([[[[0.0789], [0.2014]], [[0.332], [0.1008]]]])
in0Ave29829 = tf.constant([[[[0.8244, 0.8389], [0.7094, 0.7181]], [[0.6286, 0.4245], [0.8136, 0.3518]]]])
in1Ave29829 = tf.constant([[[[0.0442, 0.8516], [0.8588, 0.0576]], [[0.5232, 0.0334], [0.0774, 0.059]]]])
print (np.array2string(model.predict([in0Glo38972,in0Con59441,in0Zer28739,in0Con89701,in0Loc6226,in0Con15458,in0Ave29829,in1Ave29829],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub2742.png')

LGlo38972 = global_max_pool1D_layer([[[1.0522, 1.5358]]], Glo38972), 
LRes479 = reshape_layer(Glo38972, [2, 1], Res479), 
LRes31263 = reshape_layer(Res479, [2, 1, 1], Res31263), 
LZer49296 = zero_padding2D_layer(Res31263, 1, 0, 4, 0, Zer49296), 
LCon59441 = concatenate_layer([Zer49296,[[[[0.7379, 0.0403, 0.526], [0.457, 0.4905, 0.9712], [0.7037, 0.3919, 0.8956], [0.8897, 0.0016, 0.8535], [0.0841, 0.0339, 0.1237]], [[0.6897, 0.0451, 0.5285], [0.8901, 0.3975, 0.8924], [0.8095, 0.0267, 0.9881], [0.3032, 0.5878, 0.1071], [0.1264, 0.4396, 0.3867]], [[0.2259, 0.1848, 0.3974], [0.4063, 0.2351, 0.7041], [0.2458, 0.7055, 0.4065], [0.6374, 0.0177, 0.4714], [0.199, 0.6695, 0.5892]]]]], 3, Con59441), 
LZer28739 = zero_padding2D_layer([[[[1.3003, 1.9808, 1.7216, 1.9582], [1.8972, 1.0386, 1.4773, 1.7552], [1.9489, 1.4383, 1.2403, 1.7598]]]], 1, 1, 1, 1, Zer28739), 
LSub95957 = subtract_layer(Con59441,Zer28739, Sub95957), 
LRes86608 = reshape_layer(Sub95957, [3, 20], Res86608), 
LCon96544 = conv1D_layer(Res86608, 2,[[[0.0573, 0.2382], [0.3192, 0.201], [0.9204, 0.5921], [0.1596, 0.6905], [0.7121, 0.1807], [0.8354, 0.2757], [0.2439, 0.5808], [0.198, 0.4191], [0.9068, 0.0603], [0.9125, 0.1539], [0.6679, 0.5723], [0.2092, 0.0746], [0.2813, 0.5035], [0.8236, 0.2932], [0.6433, 0.5982], [0.8779, 0.4236], [0.4046, 0.3591], [0.343, 0.3597], [0.7934, 0.012], [0.7637, 0.7323]], [[0.1028, 0.8148], [0.1317, 0.4471], [0.4438, 0.0876], [0.1451, 0.6334], [0.1812, 0.8493], [0.6076, 0.6673], [0.9311, 0.3527], [0.3891, 0.6712], [0.1212, 0.1321], [0.1939, 0.0376], [0.8968, 0.3966], [0.3652, 0.076], [0.5849, 0.736], [0.0914, 0.8416], [0.0234, 0.1399], [0.6741, 0.5668], [0.8091, 0.2739], [0.9682, 0.8879], [0.9188, 0.8052], [0.7098, 0.236]]],[0, 0], 1, true, 1, Con96544), 
LRes49038 = reshape_layer(Con96544, [3, 2, 1], Res49038), 
LCon89701 = concatenate_layer([Res49038,[[[[0.4595], [0.5325]], [[0.4717], [0.964]], [[0.1096], [0.6606]]]]], 3, Con89701), 
LLoc6226 = locally_connected1D_layer([[[0.1681]]], 1,[[[0.8873, 0.2368]]],[[0, 0]], 1, Loc6226), 
LRes93317 = reshape_layer(Loc6226, [1, 2, 1], Res93317), 
LZer90820 = zero_padding2D_layer(Res93317, 1, 0, 0, 0, Zer90820), 
LCon15458 = concatenate_layer([Zer90820,[[[[0.0789], [0.2014]], [[0.332], [0.1008]]]]], 3, Con15458), 
LAve29829 = average_layer([[[[[0.8244, 0.8389], [0.7094, 0.7181]], [[0.6286, 0.4245], [0.8136, 0.3518]]]], [[[[0.0442, 0.8516], [0.8588, 0.0576]], [[0.5232, 0.0334], [0.0774, 0.059]]]]], Ave29829), 
LCon60182 = conv2D_layer(Ave29829, 1, 1,[[[[0.1206, 0.6597], [0.1893, 0.2772]]]],[0, 0], 1, 1, false, 1, 1, Con60182), 
LMul50429 = multiply_layer([Con15458,Con60182], Mul50429), 
LZer97985 = zero_padding2D_layer(Mul50429, 1, 0, 0, 0, Zer97985), 
LSub2742 = subtract_layer(Con89701,Zer97985, Sub2742), 
exec_layers([LGlo38972,LRes479,LRes31263,LZer49296,LCon59441,LZer28739,LSub95957,LRes86608,LCon96544,LRes49038,LCon89701,LLoc6226,LRes93317,LZer90820,LCon15458,LAve29829,LCon60182,LMul50429,LZer97985,LSub2742],["Glo38972","Res479","Res31263","Zer49296","Con59441","Zer28739","Sub95957","Res86608","Con96544","Res49038","Con89701","Loc6226","Res93317","Zer90820","Con15458","Ave29829","Con60182","Mul50429","Zer97985","Sub2742"],Sub2742,"Sub2742")

Actual (Unparsed): [[[[-1.1598720, 0.4595000], [-3.3351005, 0.5325000]], [[-2.7413722, 0.4306080], [-0.3538538, 0.8381687]], [[4.2264960, -0.0376042], [2.9008568, 0.6252360]]]]

Expected (Unparsed): [[[[-1.15987193,0.4595],[-3.3351005000000016,0.5325]],[[-2.741372200000001,0.430608011311],[-0.3538537699999995,0.8381687460939999]],[[4.226496059826684,-0.03760420844000001],[2.900856828038118,0.625236010416]]]]

Actual:   [[[[-1.1598, 0.4595], [-3.3351, 0.5325]], [[-2.7413, 0.4307], [-0.3538, 0.8382]], [[4.2265, -0.0376], [2.9009, 0.6253]]]]

Expected: [[[[-1.1598, 0.4595], [-3.3351, 0.5325]], [[-2.7413, 0.4307], [-0.3538, 0.8382]], [[4.2265, -0.0376], [2.9009, 0.6253]]]]