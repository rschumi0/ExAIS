import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub97789 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub97789 = tf.keras.layers.Input(shape=([3, 2]))
in0Ave90298 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Ave90298 = tf.keras.layers.Input(shape=([1, 1, 1]))

Sub97789 = keras.layers.Subtract(name = 'Sub97789', )([in0Sub97789,in1Sub97789])
Res20182 = keras.layers.Reshape((3, 2, 1), name = 'Res20182', )(Sub97789)
Res37972 = keras.layers.Reshape((3, 2, 1, 1), name = 'Res37972', )(Res20182)
Glo57362 = keras.layers.GlobalMaxPool3D(name = 'Glo57362', )(Res37972)
Res34878 = keras.layers.Reshape((1, 1), name = 'Res34878', )(Glo57362)
Ave90298 = keras.layers.Average(name = 'Ave90298', )([in0Ave90298,in1Ave90298])
Den60942 = keras.layers.Dense(1,name = 'Den60942', )(Ave90298)
Res42779 = keras.layers.Reshape((1, 1), name = 'Res42779', )(Den60942)
Dot39745 = keras.layers.Dot(axes=(1, 1), name = 'Dot39745', )([Res34878,Res42779])
model = tf.keras.models.Model(inputs=[in0Sub97789,in1Sub97789,in0Ave90298,in1Ave90298], outputs=Dot39745)
w = model.get_layer('Den60942').get_weights() 
w[0] = np.array([[0.3489]])
w[1] = np.array([0.3708])
model.get_layer('Den60942').set_weights(w) 
in0Sub97789 = tf.constant([[[0.4419, 0.3464], [0.6334, 0.9825], [0.9454, 0.416]]])
in1Sub97789 = tf.constant([[[0.2402, 0.2501], [0.8212, 0.0804], [0.1517, 0.9853]]])
in0Ave90298 = tf.constant([[[[0.6335]]]])
in1Ave90298 = tf.constant([[[[0.2884]]]])
print (np.array2string(model.predict([in0Sub97789,in1Sub97789,in0Ave90298,in1Ave90298],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot39745.png')

LSub97789 = subtract_layer([[[0.4419, 0.3464], [0.6334, 0.9825], [0.9454, 0.416]]], [[[0.2402, 0.2501], [0.8212, 0.0804], [0.1517, 0.9853]]], Sub97789), 
LRes20182 = reshape_layer(Sub97789, [3, 2, 1], Res20182), 
LRes37972 = reshape_layer(Res20182, [3, 2, 1, 1], Res37972), 
LGlo57362 = global_max_pool3D_layer(Res37972, Glo57362), 
LRes34878 = reshape_layer(Glo57362, [1, 1], Res34878), 
LAve90298 = average_layer([[[[[0.6335]]]], [[[[0.2884]]]]], Ave90298), 
LDen60942 = dense_layer(Ave90298, [[0.3489]],[0.3708], Den60942), 
LRes42779 = reshape_layer(Den60942, [1, 1], Res42779), 
LDot39745 = dot_layer(Res34878,Res42779, 1, 1, Dot39745), 
exec_layers([LSub97789,LRes20182,LRes37972,LGlo57362,LRes34878,LAve90298,LDen60942,LRes42779,LDot39745],["Sub97789","Res20182","Res37972","Glo57362","Res34878","Ave90298","Den60942","Res42779","Dot39745"],Dot39745,"Dot39745")

Actual (Unparsed): [[[0.4795793]]]

Expected (Unparsed): [[[0.47957932295550004]]]

Actual:   [[[0.4796]]]

Expected: [[[0.4796]]]