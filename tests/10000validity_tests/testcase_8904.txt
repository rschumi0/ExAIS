import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max32295 = tf.keras.layers.Input(shape=([1, 1]))
in0Con92831 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Con58596 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))

Max32295 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='valid', name = 'Max32295', )(in0Max32295)
Res85005 = keras.layers.Reshape((1, 1, 1), name = 'Res85005', )(Max32295)
Res88691 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res88691', )(Res85005)
Zer26811 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (0, 0)), name = 'Zer26811', )(Res88691)
Con92831 = keras.layers.Concatenate(axis=4, name = 'Con92831', )([Zer26811,in0Con92831])
Con58596 = keras.layers.Conv3D(3, (1, 1, 2),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con58596', )(in0Con58596)
Sub95892 = keras.layers.Subtract(name = 'Sub95892', )([Con92831,Con58596])
Res83126 = keras.layers.Reshape((2, 1, 3), name = 'Res83126', )(Sub95892)
Up_54641 = keras.layers.UpSampling2D(size=(2, 1), name = 'Up_54641', )(Res83126)
Res35508 = keras.layers.Reshape((4, 3), name = 'Res35508', )(Up_54641)
GRU28083 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU28083', )(Res35508)
model = tf.keras.models.Model(inputs=[in0Max32295,in0Con92831,in0Con58596], outputs=GRU28083)
w = model.get_layer('Con58596').get_weights() 
w[0] = np.array([[[[[0.7893, 0.1811, 0.3223]], [[0.0587, 0.1934, 0.0336]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con58596').set_weights(w) 
w = model.get_layer('GRU28083').get_weights() 
w[0] = np.array([[9, 9, 9, 1, 6, 2, 3, 10, 6], [2, 5, 2, 9, 6, 4, 10, 5, 3], [10, 9, 1, 8, 9, 4, 8, 9, 1]])
w[1] = np.array([[3, 1, 9, 6, 8, 10, 3, 7, 7], [10, 4, 6, 1, 10, 3, 3, 3, 6], [4, 3, 8, 10, 8, 4, 6, 8, 6]])
w[2] = np.array([[5, 2, 10, 3, 6, 9, 6, 4, 6], [9, 9, 4, 3, 9, 2, 6, 8, 3]])
model.get_layer('GRU28083').set_weights(w) 
in0Max32295 = tf.constant([[[1.4312]]])
in0Con92831 = tf.constant([[[[[0.8908, 0.2851]]], [[[0.7182, 0.0044]]]]])
in0Con58596 = tf.constant([[[[[0.2505], [0.4281]]], [[[0.241], [0.776]]]]])
print (np.array2string(model.predict([in0Max32295,in0Con92831,in0Con58596],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU28083.png')

LMax32295 = max_pool1D_layer([[[1.4312]]], 1, 1, false, Max32295), 
LRes85005 = reshape_layer(Max32295, [1, 1, 1], Res85005), 
LRes88691 = reshape_layer(Res85005, [1, 1, 1, 1], Res88691), 
LZer26811 = zero_padding3D_layer(Res88691, 1, 0, 0, 0, 0, 0, Zer26811), 
LCon92831 = concatenate_layer([Zer26811,[[[[[0.8908, 0.2851]]], [[[0.7182, 0.0044]]]]]], 4, Con92831), 
LCon58596 = conv3D_layer([[[[[0.2505], [0.4281]]], [[[0.241], [0.776]]]]], 1, 1, 2,[[[[[0.7893, 0.1811, 0.3223]], [[0.0587, 0.1934, 0.0336]]]]],[0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con58596), 
LSub95892 = subtract_layer(Con92831,Con58596, Sub95892), 
LRes83126 = reshape_layer(Sub95892, [2, 1, 3], Res83126), 
LUp_54641 = up_sampling2D_layer(Res83126, 2, 1, Up_54641), 
LRes35508 = reshape_layer(Up_54641, [4, 3], Res35508), 
LGRU28083 = gru_layer(Res35508,[[9, 9, 9, 1, 6, 2, 3, 10, 6], [2, 5, 2, 9, 6, 4, 10, 5, 3], [10, 9, 1, 8, 9, 4, 8, 9, 1]],[[3, 1, 9, 6, 8, 10, 3, 7, 7], [10, 4, 6, 1, 10, 3, 3, 3, 6], [4, 3, 8, 10, 8, 4, 6, 8, 6]],[[5, 2, 10, 3, 6, 9, 6, 4, 6], [9, 9, 4, 3, 9, 2, 6, 8, 3]], true, GRU28083), 
exec_layers([LMax32295,LRes85005,LRes88691,LZer26811,LCon92831,LCon58596,LSub95892,LRes83126,LUp_54641,LRes35508,LGRU28083],["Max32295","Res85005","Res88691","Zer26811","Con92831","Con58596","Sub95892","Res83126","Up_54641","Res35508","GRU28083"],GRU28083,"GRU28083")

Actual (Unparsed): [[0.0000004, 0.0000010, 0.0000022]]

Expected (Unparsed): [[4.0224293291752274e-7,9.914435661345745e-7,2.2234008771614914e-6]]

Actual:   [[0, 0, 0]]

Expected: [[0, 0, 0]]