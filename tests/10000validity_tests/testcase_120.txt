import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0GRU3086 = tf.keras.layers.Input(shape=([3, 2]))
in0Mul22635 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul22635 = tf.keras.layers.Input(shape=([2, 1]))
in0Glo88898 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con76359 = tf.keras.layers.Input(shape=([2]))
in0Ave52989 = tf.keras.layers.Input(shape=([1, 2]))

GRU3086 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU3086', )(in0GRU3086)
Res78485 = keras.layers.Reshape((3, 1), name = 'Res78485', )(GRU3086)
Mul22635 = keras.layers.Multiply(name = 'Mul22635', )([in0Mul22635,in1Mul22635])
Zer10910 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer10910', )(Mul22635)
Sub93221 = keras.layers.Subtract(name = 'Sub93221', )([Res78485,Zer10910])
Up_27649 = keras.layers.UpSampling1D(size=(1), name = 'Up_27649', )(Sub93221)
Fla21958 = keras.layers.Flatten(name = 'Fla21958', )(Up_27649)
Glo88898 = keras.layers.GlobalAveragePooling2D(name = 'Glo88898', )(in0Glo88898)
Con76359 = keras.layers.Concatenate(axis=1, name = 'Con76359', )([Glo88898,in0Con76359])
Ave61854 = keras.layers.Average(name = 'Ave61854', )([Fla21958,Con76359])
Res70373 = keras.layers.Reshape((3, 1), name = 'Res70373', )(Ave61854)
Res66936 = keras.layers.Reshape((3, 1, 1), name = 'Res66936', )(Res70373)
Ave52989 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='valid', name = 'Ave52989', )(in0Ave52989)
Con48234 = keras.layers.Conv1D(4, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con48234', )(Ave52989)
Res10107 = keras.layers.Reshape((1, 4, 1), name = 'Res10107', )(Con48234)
Max70346 = keras.layers.MaxPool2D(pool_size=(1, 3), strides=(1, 2), padding='valid', name = 'Max70346', )(Res10107)
Zer96850 = keras.layers.ZeroPadding2D(padding=((2, 0), (0, 0)), name = 'Zer96850', )(Max70346)
Sub13930 = keras.layers.Subtract(name = 'Sub13930', )([Res66936,Zer96850])
model = tf.keras.models.Model(inputs=[in0GRU3086,in0Mul22635,in1Mul22635,in0Glo88898,in0Con76359,in0Ave52989], outputs=Sub13930)
w = model.get_layer('GRU3086').get_weights() 
w[0] = np.array([[1, 3, 7, 5, 2, 7, 4, 8, 1], [6, 1, 7, 1, 1, 6, 3, 3, 5]])
w[1] = np.array([[6, 7, 8, 3, 9, 10, 4, 7, 1], [5, 2, 8, 6, 5, 10, 4, 4, 2], [6, 4, 9, 9, 6, 1, 8, 10, 7]])
w[2] = np.array([[5, 5, 8, 2, 8, 3, 9, 7, 9], [2, 1, 2, 6, 6, 10, 6, 1, 9]])
model.get_layer('GRU3086').set_weights(w) 
w = model.get_layer('Con48234').get_weights() 
w[0] = np.array([[[0.9715, 0.8565, 0.2614, 0.6007], [0.6322, 0.8118, 0.6008, 0.2902]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con48234').set_weights(w) 
in0GRU3086 = tf.constant([[[3, 3], [6, 6], [8, 10]]])
in0Mul22635 = tf.constant([[[0.3032], [0.1993]]])
in1Mul22635 = tf.constant([[[0.7373], [0.133]]])
in0Glo88898 = tf.constant([[[[1.1347], [1.0739]]]])
in0Con76359 = tf.constant([[0.9434, 0.7254]])
in0Ave52989 = tf.constant([[[1.4029, 1.2714]]])
print (np.array2string(model.predict([in0GRU3086,in0Mul22635,in1Mul22635,in0Glo88898,in0Con76359,in0Ave52989],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub13930.png')

LGRU3086 = gru_layer([[[3, 3], [6, 6], [8, 10]]],[[1, 3, 7, 5, 2, 7, 4, 8, 1], [6, 1, 7, 1, 1, 6, 3, 3, 5]],[[6, 7, 8, 3, 9, 10, 4, 7, 1], [5, 2, 8, 6, 5, 10, 4, 4, 2], [6, 4, 9, 9, 6, 1, 8, 10, 7]],[[5, 5, 8, 2, 8, 3, 9, 7, 9], [2, 1, 2, 6, 6, 10, 6, 1, 9]], true, GRU3086), 
LRes78485 = reshape_layer(GRU3086, [3, 1], Res78485), 
LMul22635 = multiply_layer([[[[0.3032], [0.1993]]], [[[0.7373], [0.133]]]], Mul22635), 
LZer10910 = zero_padding1D_layer(Mul22635, 1, 0, Zer10910), 
LSub93221 = subtract_layer(Res78485,Zer10910, Sub93221), 
LUp_27649 = up_sampling1D_layer(Sub93221, 1, Up_27649), 
LFla21958 = flatten_layer(Up_27649, Fla21958), 
LGlo88898 = global_average_pooling2D_layer([[[[1.1347], [1.0739]]]], Glo88898), 
LCon76359 = concatenate_layer([Glo88898,[[0.9434, 0.7254]]], 1, Con76359), 
LAve61854 = average_layer([Fla21958,Con76359], Ave61854), 
LRes70373 = reshape_layer(Ave61854, [3, 1], Res70373), 
LRes66936 = reshape_layer(Res70373, [3, 1, 1], Res66936), 
LAve52989 = average_pooling1D_layer([[[1.4029, 1.2714]]], 1, 1, false, Ave52989), 
LCon48234 = conv1D_layer(Ave52989, 1,[[[0.9715, 0.8565, 0.2614, 0.6007], [0.6322, 0.8118, 0.6008, 0.2902]]],[0, 0, 0, 0], 1, true, 1, Con48234), 
LRes10107 = reshape_layer(Con48234, [1, 4, 1], Res10107), 
LMax70346 = max_pool2D_layer(Res10107, 1, 3, 1, 2, false, Max70346), 
LZer96850 = zero_padding2D_layer(Max70346, 2, 0, 0, 0, Zer96850), 
LSub13930 = subtract_layer(Res66936,Zer96850, Sub13930), 
exec_layers([LGRU3086,LRes78485,LMul22635,LZer10910,LSub93221,LUp_27649,LFla21958,LGlo88898,LCon76359,LAve61854,LRes70373,LRes66936,LAve52989,LCon48234,LRes10107,LMax70346,LZer96850,LSub13930],["GRU3086","Res78485","Mul22635","Zer10910","Sub93221","Up_27649","Fla21958","Glo88898","Con76359","Ave61854","Res70373","Res66936","Ave52989","Con48234","Res10107","Max70346","Zer96850","Sub13930"],Sub13930,"Sub13930")

Actual (Unparsed): [[[[0.5521500]], [[0.3599253]], [[-1.8842598]]]]

Expected (Unparsed): [[[[0.5521500000003458]],[[0.3599253276150365]],[[-1.88425982]]]]

Actual:   [[[[0.5522]], [[0.36]], [[-1.8842]]]]

Expected: [[[[0.5522]], [[0.36]], [[-1.8842]]]]