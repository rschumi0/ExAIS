import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave89535 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Ave89535 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con13059 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con99530 = tf.keras.layers.Input(shape=([2, 2, 1]))

Ave89535 = keras.layers.Average(name = 'Ave89535', )([in0Ave89535,in1Ave89535])
Cro95594 = keras.layers.Cropping2D(cropping=((0, 0), (1, 0)), name = 'Cro95594', )(Ave89535)
Con13059 = keras.layers.Concatenate(axis=3, name = 'Con13059', )([Cro95594,in0Con13059])
Con99530 = keras.layers.Conv2D(4, (2, 2),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con99530', )(in0Con99530)
Bat80711 = keras.layers.BatchNormalization(axis=3, epsilon=0.8221163522823512,  name = 'Bat80711', )(Con99530)
Dep99839 = keras.layers.DepthwiseConv2D((2, 2),strides=(2, 2), padding='same', name = 'Dep99839', )(Bat80711)
Add3957 = keras.layers.Add(name = 'Add3957', )([Con13059,Dep99839])
Glo86824 = keras.layers.GlobalMaxPool2D(name = 'Glo86824', )(Add3957)
model = tf.keras.models.Model(inputs=[in0Ave89535,in1Ave89535,in0Con13059,in0Con99530], outputs=Glo86824)
w = model.get_layer('Con99530').get_weights() 
w[0] = np.array([[[[0.1292, 0.2958, 0.2984, 0.0927]], [[0.2453, 0.6721, 0.2744, 0.0176]]], [[[0.6119, 0.5758, 0.0377, 0.7954]], [[0.1852, 0.5184, 0.7699, 0.1031]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con99530').set_weights(w) 
w = model.get_layer('Bat80711').get_weights() 
w[0] = np.array([0.3917, 0.1516, 0.8659, 0.8029])
w[1] = np.array([0.4289, 0.4178, 0.9945, 0.2204])
w[2] = np.array([0.5551, 0.613, 0.7377, 0.6907])
w[3] = np.array([0.7281, 0.0395, 0.687, 0.3064])
model.get_layer('Bat80711').set_weights(w) 
w = model.get_layer('Dep99839').get_weights() 
w[0] = np.array([[[[0.7264], [0.7301], [0.6601], [0.2468]], [[0.7705], [0.1117], [0.0966], [0.9601]]], [[[0.2417], [0.8809], [0.622], [0.1611]], [[0.8718], [0.1175], [0.307], [0.5159]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Dep99839').set_weights(w) 
in0Ave89535 = tf.constant([[[[0.2779, 0.8842], [0.2899, 0.7656]]]])
in1Ave89535 = tf.constant([[[[0.9344, 0.5417], [0.6453, 0.7916]]]])
in0Con13059 = tf.constant([[[[0.463, 0.5167]]]])
in0Con99530 = tf.constant([[[[0.4033], [0.2221]], [[0.7916], [0.7396]]]])
print (np.array2string(model.predict([in0Ave89535,in1Ave89535,in0Con13059,in0Con99530],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo86824.png')

LAve89535 = average_layer([[[[[0.2779, 0.8842], [0.2899, 0.7656]]]], [[[[0.9344, 0.5417], [0.6453, 0.7916]]]]], Ave89535), 
LCro95594 = cropping2D_layer(Ave89535, 0, 0, 1, 0, Cro95594), 
LCon13059 = concatenate_layer([Cro95594,[[[[0.463, 0.5167]]]]], 3, Con13059), 
LCon99530 = conv2D_layer([[[[0.4033], [0.2221]], [[0.7916], [0.7396]]]], 2, 2,[[[[0.1292, 0.2958, 0.2984, 0.0927]], [[0.2453, 0.6721, 0.2744, 0.0176]]], [[[0.6119, 0.5758, 0.0377, 0.7954]], [[0.1852, 0.5184, 0.7699, 0.1031]]]],[0, 0, 0, 0], 1, 1, true, 1, 1, Con99530), 
LBat80711 = batch_normalization_layer(Con99530, 3, 0.8221163522823512, [0.3917, 0.1516, 0.8659, 0.8029], [0.4289, 0.4178, 0.9945, 0.2204], [0.5551, 0.613, 0.7377, 0.6907], [0.7281, 0.0395, 0.687, 0.3064], Bat80711), 
LDep99839 = depthwise_conv2D_layer(Bat80711, 2, 2,[[[[0.7264], [0.7301], [0.6601], [0.2468]], [[0.7705], [0.1117], [0.0966], [0.9601]]], [[[0.2417], [0.8809], [0.622], [0.1611]], [[0.8718], [0.1175], [0.307], [0.5159]]]],[0, 0, 0, 0], 2, 2, true, Dep99839), 
LAdd3957 = add_layer([Con13059,Dep99839], Add3957), 
LGlo86824 = global_max_pool2D_layer(Add3957, Glo86824), 
exec_layers([LAve89535,LCro95594,LCon13059,LCon99530,LBat80711,LDep99839,LAdd3957,LGlo86824],["Ave89535","Cro95594","Con13059","Con99530","Bat80711","Dep99839","Add3957","Glo86824"],Glo86824,"Glo86824")

Actual (Unparsed): [[1.4621247, 1.6136641, 1.8727830, 0.5669034]]

Expected (Unparsed): [[1.4621247087741234,1.6136641164144079,1.8727830210835252,0.5669033956665376]]

Actual:   [[1.4622, 1.6137, 1.8728, 0.567]]

Expected: [[1.4622, 1.6137, 1.8728, 0.567]]