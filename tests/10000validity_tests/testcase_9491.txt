import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot15349 = tf.keras.layers.Input(shape=([3]))
in1Dot15349 = tf.keras.layers.Input(shape=([3]))
in0Con16587 = tf.keras.layers.Input(shape=([1]))
in0Glo47791 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Con64569 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Mul54081 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Mul54081 = tf.keras.layers.Input(shape=([1, 1, 2]))

Dot15349 = keras.layers.Dot(axes=(1, 1), name = 'Dot15349', )([in0Dot15349,in1Dot15349])
Con16587 = keras.layers.Concatenate(axis=1, name = 'Con16587', )([Dot15349,in0Con16587])
Glo47791 = keras.layers.GlobalMaxPool3D(name = 'Glo47791', )(in0Glo47791)
Ave96758 = keras.layers.Average(name = 'Ave96758', )([Con16587,Glo47791])
Res4534 = keras.layers.Reshape((2, 1), name = 'Res4534', )(Ave96758)
Res34839 = keras.layers.Reshape((2, 1, 1), name = 'Res34839', )(Res4534)
Con64569 = keras.layers.Concatenate(axis=3, name = 'Con64569', )([Res34839,in0Con64569])
Mul54081 = keras.layers.Multiply(name = 'Mul54081', )([in0Mul54081,in1Mul54081])
Zer46766 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer46766', )(Mul54081)
Min24797 = keras.layers.Minimum(name = 'Min24797', )([Con64569,Zer46766])
Res41104 = keras.layers.Reshape((2, 2), name = 'Res41104', )(Min24797)
Glo29174 = keras.layers.GlobalMaxPool1D(name = 'Glo29174', )(Res41104)
Res38106 = keras.layers.Reshape((2, 1), name = 'Res38106', )(Glo29174)
Res3295 = keras.layers.Reshape((2, 1, 1), name = 'Res3295', )(Res38106)
Ave26169 = keras.layers.AveragePooling2D(pool_size=(1, 1), strides=(1, 1), padding='same', name = 'Ave26169', )(Res3295)
model = tf.keras.models.Model(inputs=[in0Dot15349,in1Dot15349,in0Con16587,in0Glo47791,in0Con64569,in0Mul54081,in1Mul54081], outputs=Ave26169)
in0Dot15349 = tf.constant([[0.7965, 0.4246, 0.0587]])
in1Dot15349 = tf.constant([[0.4289, 0.2883, 0.7005]])
in0Con16587 = tf.constant([[0.8362]])
in0Glo47791 = tf.constant([[[[[1.4461, 1.1346]], [[1.5992, 1.1158]]], [[[1.1711, 1.0517]], [[1.0489, 1.7348]]]]])
in0Con64569 = tf.constant([[[[0.3312]], [[0.4964]]]])
in0Mul54081 = tf.constant([[[[0.11, 0.9546]]]])
in1Mul54081 = tf.constant([[[[0.0266, 0.2037]]]])
print (np.array2string(model.predict([in0Dot15349,in1Dot15349,in0Con16587,in0Glo47791,in0Con64569,in0Mul54081,in1Mul54081],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave26169.png')

LDot15349 = dot_layer([[0.7965, 0.4246, 0.0587]], [[0.4289, 0.2883, 0.7005]], 1, 1, Dot15349), 
LCon16587 = concatenate_layer([Dot15349,[[0.8362]]], 1, Con16587), 
LGlo47791 = global_max_pool3D_layer([[[[[1.4461, 1.1346]], [[1.5992, 1.1158]]], [[[1.1711, 1.0517]], [[1.0489, 1.7348]]]]], Glo47791), 
LAve96758 = average_layer([Con16587,Glo47791], Ave96758), 
LRes4534 = reshape_layer(Ave96758, [2, 1], Res4534), 
LRes34839 = reshape_layer(Res4534, [2, 1, 1], Res34839), 
LCon64569 = concatenate_layer([Res34839,[[[[0.3312]], [[0.4964]]]]], 3, Con64569), 
LMul54081 = multiply_layer([[[[[0.11, 0.9546]]]], [[[[0.0266, 0.2037]]]]], Mul54081), 
LZer46766 = zero_padding2D_layer(Mul54081, 1, 0, 0, 0, Zer46766), 
LMin24797 = minimum_layer([Con64569,Zer46766], Min24797), 
LRes41104 = reshape_layer(Min24797, [2, 2], Res41104), 
LGlo29174 = global_max_pool1D_layer(Res41104, Glo29174), 
LRes38106 = reshape_layer(Glo29174, [2, 1], Res38106), 
LRes3295 = reshape_layer(Res38106, [2, 1, 1], Res3295), 
LAve26169 = average_pooling2D_layer(Res3295, 1, 1, 1, 1, true, Ave26169), 
exec_layers([LDot15349,LCon16587,LGlo47791,LAve96758,LRes4534,LRes34839,LCon64569,LMul54081,LZer46766,LMin24797,LRes41104,LGlo29174,LRes38106,LRes3295,LAve26169],["Dot15349","Con16587","Glo47791","Ave96758","Res4534","Res34839","Con64569","Mul54081","Zer46766","Min24797","Res41104","Glo29174","Res38106","Res3295","Ave26169"],Ave26169,"Ave26169")

Actual (Unparsed): [[[[0.0029260]], [[0.1944520]]]]

Expected (Unparsed): [[[[0.0029259999999999998]],[[0.19445202]]]]

Actual:   [[[[0.003]], [[0.1945]]]]

Expected: [[[[0.003]], [[0.1945]]]]