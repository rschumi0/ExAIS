import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add15355 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Add15355 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Per91798 = tf.keras.layers.Input(shape=([2, 1]))
in0Con10484 = tf.keras.layers.Input(shape=([8, 4, 1]))
in0Up_79634 = tf.keras.layers.Input(shape=([4, 2, 1, 2]))

Add15355 = keras.layers.Add(name = 'Add15355', )([in0Add15355,in1Add15355])
Res6769 = keras.layers.Reshape((1, 2), name = 'Res6769', )(Add15355)
Per91798 = keras.layers.Permute((2,1), name = 'Per91798',)(in0Per91798)
Ave1194 = keras.layers.Average(name = 'Ave1194', )([Res6769,Per91798])
Res61306 = keras.layers.Reshape((1, 2, 1), name = 'Res61306', )(Ave1194)
Zer92465 = keras.layers.ZeroPadding2D(padding=((7, 0), (2, 0)), name = 'Zer92465', )(Res61306)
Con10484 = keras.layers.Concatenate(axis=3, name = 'Con10484', )([Zer92465,in0Con10484])
Up_79634 = keras.layers.UpSampling3D(size=(2, 2, 1), name = 'Up_79634', )(in0Up_79634)
Res49241 = keras.layers.Reshape((8, 4, 2), name = 'Res49241', )(Up_79634)
PRe61538 = keras.layers.PReLU(name = 'PRe61538', )(Res49241)
Sub35425 = keras.layers.Subtract(name = 'Sub35425', )([Con10484,PRe61538])
Den75366 = keras.layers.Dense(2,name = 'Den75366', )(Sub35425)
Res4349 = keras.layers.Reshape((8, 8), name = 'Res4349', )(Den75366)
Max47064 = keras.layers.MaxPool1D(pool_size=(3), name = 'Max47064', )(Res4349)
model = tf.keras.models.Model(inputs=[in0Add15355,in1Add15355,in0Per91798,in0Con10484,in0Up_79634], outputs=Max47064)
w = model.get_layer('PRe61538').get_weights() 
w[0] = np.array([[[0.0509, 0.1587], [0.7182, 0.5068], [0.0882, 0.6696], [0.1506, 0.3508]], [[0.1357, 0.4895], [0.7702, 0.4591], [0.7847, 0.1985], [0.6137, 0.9327]], [[0.805, 0.3858], [0.9764, 0.8702], [0.4418, 0.4509], [0.9401, 0.1613]], [[0.4889, 0.3797], [0.8481, 0.3693], [0.6913, 0.3162], [0.4859, 0.1477]], [[0.5685, 0.9479], [0.6508, 0.8583], [0.3238, 0.2143], [0.2622, 0.0579]], [[0.1034, 0.6092], [0.1521, 0.3027], [0.5072, 0.3999], [0.2019, 0.2835]], [[0.916, 0.4123], [0.5488, 0.6496], [0.8947, 0.6432], [0.1684, 0.0052]], [[0.6628, 0.8504], [0.2622, 0.4685], [0.3774, 0.4483], [0.5242, 0.8736]]])
model.get_layer('PRe61538').set_weights(w) 
w = model.get_layer('Den75366').get_weights() 
w[0] = np.array([[0.6385, 0.8405], [0.9265, 0.1169]])
w[1] = np.array([0.2833, 0.889])
model.get_layer('Den75366').set_weights(w) 
in0Add15355 = tf.constant([[[[0.1819, 0.2486]]]])
in1Add15355 = tf.constant([[[[0.4836, 0.2467]]]])
in0Per91798 = tf.constant([[[1.5908], [1.2816]]])
in0Con10484 = tf.constant([[[[0.1988], [0.1002], [0.2858], [0.1019]], [[0.9254], [0.2723], [0.7168], [0.7756]], [[0.7791], [0.4368], [0.3115], [0.3663]], [[0.8713], [0.5762], [0.0949], [0.9429]], [[0.8498], [0.9297], [0.9003], [0.6636]], [[0.8284], [0.9687], [0.4209], [0.6445]], [[0.0394], [0.8878], [0.6537], [0.175]], [[0.5485], [0.9218], [0.0151], [0.7322]]]])
in0Up_79634 = tf.constant([[[[[1.3282, 1.8391]], [[1.2846, 1.1461]]], [[[1.2655, 1.8768]], [[1.0208, 1.906]]], [[[1.2807, 1.4258]], [[1.9867, 1.6619]]], [[[1.9841, 1.1594]], [[1.3219, 1.3137]]]]])
print (np.array2string(model.predict([in0Add15355,in1Add15355,in0Per91798,in0Con10484,in0Up_79634],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max47064.png')

LAdd15355 = add_layer([[[[[0.1819, 0.2486]]]], [[[[0.4836, 0.2467]]]]], Add15355), 
LRes6769 = reshape_layer(Add15355, [1, 2], Res6769), 
LPer91798 = permute_layer([[[1.5908], [1.2816]]], 2,1, Per91798), 
LAve1194 = average_layer([Res6769,Per91798], Ave1194), 
LRes61306 = reshape_layer(Ave1194, [1, 2, 1], Res61306), 
LZer92465 = zero_padding2D_layer(Res61306, 7, 0, 2, 0, Zer92465), 
LCon10484 = concatenate_layer([Zer92465,[[[[0.1988], [0.1002], [0.2858], [0.1019]], [[0.9254], [0.2723], [0.7168], [0.7756]], [[0.7791], [0.4368], [0.3115], [0.3663]], [[0.8713], [0.5762], [0.0949], [0.9429]], [[0.8498], [0.9297], [0.9003], [0.6636]], [[0.8284], [0.9687], [0.4209], [0.6445]], [[0.0394], [0.8878], [0.6537], [0.175]], [[0.5485], [0.9218], [0.0151], [0.7322]]]]], 3, Con10484), 
LUp_79634 = up_sampling3D_layer([[[[[1.3282, 1.8391]], [[1.2846, 1.1461]]], [[[1.2655, 1.8768]], [[1.0208, 1.906]]], [[[1.2807, 1.4258]], [[1.9867, 1.6619]]], [[[1.9841, 1.1594]], [[1.3219, 1.3137]]]]], 2, 2, 1, Up_79634), 
LRes49241 = reshape_layer(Up_79634, [8, 4, 2], Res49241), 
LPRe61538 = prelu_layer(Res49241, [[[0.0509, 0.1587], [0.7182, 0.5068], [0.0882, 0.6696], [0.1506, 0.3508]], [[0.1357, 0.4895], [0.7702, 0.4591], [0.7847, 0.1985], [0.6137, 0.9327]], [[0.805, 0.3858], [0.9764, 0.8702], [0.4418, 0.4509], [0.9401, 0.1613]], [[0.4889, 0.3797], [0.8481, 0.3693], [0.6913, 0.3162], [0.4859, 0.1477]], [[0.5685, 0.9479], [0.6508, 0.8583], [0.3238, 0.2143], [0.2622, 0.0579]], [[0.1034, 0.6092], [0.1521, 0.3027], [0.5072, 0.3999], [0.2019, 0.2835]], [[0.916, 0.4123], [0.5488, 0.6496], [0.8947, 0.6432], [0.1684, 0.0052]], [[0.6628, 0.8504], [0.2622, 0.4685], [0.3774, 0.4483], [0.5242, 0.8736]]], PRe61538), 
LSub35425 = subtract_layer(Con10484,PRe61538, Sub35425), 
LDen75366 = dense_layer(Sub35425, [[0.6385, 0.8405], [0.9265, 0.1169]],[0.2833, 0.889], Den75366), 
LRes4349 = reshape_layer(Den75366, [8, 8], Res4349), 
LMax47064 = max_pool1D_layer(Res4349, 3, Max47064), 
exec_layers([LAdd15355,LRes6769,LPer91798,LAve1194,LRes61306,LZer92465,LCon10484,LUp_79634,LRes49241,LPRe61538,LSub35425,LDen75366,LRes4349,LMax47064],["Add15355","Res6769","Per91798","Ave1194","Res61306","Zer92465","Con10484","Up_79634","Res49241","PRe61538","Sub35425","Den75366","Res4349","Max47064"],Max47064,"Max47064")

Actual (Unparsed): [[[-1.4112987, -0.3029738, -1.8588817, -0.3429887, -0.9346636, -0.1553794, -0.8801854, -0.1489733], [-1.0680909, -0.2547627, -0.9579301, -0.2408633, -1.6908304, -0.1807000, -1.2607930, -0.0815688]]]

Expected (Unparsed): [[[-1.4112987499999998,-0.30297388000000014,-1.85888175,-0.3429887500000001,-0.9346635499999998,-0.15537944999999992,-0.8801853499999999,-0.1489733299999999],[-1.0680909499999998,-0.25476275000000004,-0.9579300999999999,-0.24086334,-1.6908303499999997,-0.18069998999999992,-1.26079295,-0.0815687899999999]]]

Actual:   [[[-1.4112, -0.3029, -1.8588, -0.3429, -0.9346, -0.1553, -0.8801, -0.1489], [-1.068, -0.2547, -0.9579, -0.2408, -1.6908, -0.1807, -1.2607, -0.0815]]]

Expected: [[[-1.4112, -0.3029, -1.8588, -0.3429, -0.9346, -0.1553, -0.8801, -0.1489], [-1.068, -0.2547, -0.9579, -0.2408, -1.6908, -0.1806, -1.2607, -0.0815]]]