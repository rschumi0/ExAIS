import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max52736 = tf.keras.layers.Input(shape=([2, 2]))
in1Max52736 = tf.keras.layers.Input(shape=([2, 2]))

Max52736 = keras.layers.Maximum(name = 'Max52736', )([in0Max52736,in1Max52736])
GRU37021 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU37021', )(Max52736)
Res50256 = keras.layers.Reshape((1, 1), name = 'Res50256', )(GRU37021)
Res60560 = keras.layers.Reshape((1, 1, 1), name = 'Res60560', )(Res50256)
Loc97564 = keras.layers.LocallyConnected2D(4, (1, 1),strides=(1, 1), name = 'Loc97564', )(Res60560)
model = tf.keras.models.Model(inputs=[in0Max52736,in1Max52736], outputs=Loc97564)
w = model.get_layer('GRU37021').get_weights() 
w[0] = np.array([[7, 4, 2], [10, 9, 4]])
w[1] = np.array([[3, 5, 2]])
w[2] = np.array([4, 9, 2])
model.get_layer('GRU37021').set_weights(w) 
w = model.get_layer('Loc97564').get_weights() 
w[0] = np.array([[[0.2398, 0.217, 0.373, 0.29]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc97564').set_weights(w) 
in0Max52736 = tf.constant([[[0.7764, 0.7257], [0.2318, 0.2938]]])
in1Max52736 = tf.constant([[[0.2129, 0.8863], [0.0615, 0.9846]]])
print (np.array2string(model.predict([in0Max52736,in1Max52736],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc97564.png')

LMax52736 = maximum_layer([[[[0.7764, 0.7257], [0.2318, 0.2938]]], [[[0.2129, 0.8863], [0.0615, 0.9846]]]], Max52736), 
LGRU37021 = gru_layer(Max52736,[[7, 4, 2], [10, 9, 4]],[[3, 5, 2]],[4, 9, 2], false, GRU37021), 
LRes50256 = reshape_layer(GRU37021, [1, 1], Res50256), 
LRes60560 = reshape_layer(Res50256, [1, 1, 1], Res60560), 
LLoc97564 = locally_connected2D_layer(Res60560, 1, 1,[[[0.2398, 0.217, 0.373, 0.29]]],[[[0, 0, 0, 0]]], 1, 1, Loc97564), 
exec_layers([LMax52736,LGRU37021,LRes50256,LRes60560,LLoc97564],["Max52736","GRU37021","Res50256","Res60560","Loc97564"],Loc97564,"Loc97564")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000001, 0.0000001]]]]

Expected (Unparsed): [[[[4.8622778200410596e-8,4.39997617576693e-8,7.563092689221498e-8,5.8801524929604134e-8]]]]

Actual:   [[[[0, 0, 0, 0]]]]

Expected: [[[[0, 0, 0, 0]]]]