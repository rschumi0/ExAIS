import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Up_30512 = tf.keras.layers.Input(shape=([4, 1, 1, 2]))
in0Add43489 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Add43489 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))

Up_30512 = keras.layers.UpSampling3D(size=(1, 1, 2), name = 'Up_30512', )(in0Up_30512)
Add43489 = keras.layers.Add(name = 'Add43489', )([in0Add43489,in1Add43489])
Zer38104 = keras.layers.ZeroPadding3D(padding=((2, 0), (0, 0), (1, 0)), name = 'Zer38104', )(Add43489)
Add10050 = keras.layers.Add(name = 'Add10050', )([Up_30512,Zer38104])
Res80580 = keras.layers.Reshape((4, 1, 4), name = 'Res80580', )(Add10050)
Con798 = keras.layers.Conv2DTranspose(4, (2, 1),strides=(4, 1), padding='valid', name = 'Con798', )(Res80580)
Sof94749 = keras.layers.Softmax(axis=1, name = 'Sof94749', )(Con798)
model = tf.keras.models.Model(inputs=[in0Up_30512,in0Add43489,in1Add43489], outputs=Sof94749)
w = model.get_layer('Con798').get_weights() 
w[0] = np.array([[[[0.9626, 0.2584, 0.4671, 0.5483], [0.9512, 0.5296, 0.054, 0.1157], [0.6466, 0.9354, 0.5262, 0.7129], [0.6896, 0.6796, 0.3955, 0.2055]]], [[[0.4404, 0.9906, 0.4975, 0.8004], [0.5634, 0.5552, 0.8557, 0.6231], [0.2425, 0.1299, 0.0863, 0.5738], [0.3634, 0.734, 0.9687, 0.9277]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con798').set_weights(w) 
in0Up_30512 = tf.constant([[[[[1.1323, 1.0565]]], [[[1.6059, 1.5672]]], [[[1.9632, 1.3261]]], [[[1.2534, 1.0349]]]]])
in0Add43489 = tf.constant([[[[[0.8504, 0.2655]]], [[[0.3352, 0.009]]]]])
in1Add43489 = tf.constant([[[[[0.1249, 0.2632]]], [[[0.6867, 0.0984]]]]])
print (np.array2string(model.predict([in0Up_30512,in0Add43489,in1Add43489],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sof94749.png')

LUp_30512 = up_sampling3D_layer([[[[[1.1323, 1.0565]]], [[[1.6059, 1.5672]]], [[[1.9632, 1.3261]]], [[[1.2534, 1.0349]]]]], 1, 1, 2, Up_30512), 
LAdd43489 = add_layer([[[[[[0.8504, 0.2655]]], [[[0.3352, 0.009]]]]], [[[[[0.1249, 0.2632]]], [[[0.6867, 0.0984]]]]]], Add43489), 
LZer38104 = zero_padding3D_layer(Add43489, 2, 0, 0, 0, 1, 0, Zer38104), 
LAdd10050 = add_layer([Up_30512,Zer38104], Add10050), 
LRes80580 = reshape_layer(Add10050, [4, 1, 4], Res80580), 
LCon798 = conv2D_transpose_layer(Res80580, 2, 1,[[[[0.9626, 0.2584, 0.4671, 0.5483], [0.9512, 0.5296, 0.054, 0.1157], [0.6466, 0.9354, 0.5262, 0.7129], [0.6896, 0.6796, 0.3955, 0.2055]]], [[[0.4404, 0.9906, 0.4975, 0.8004], [0.5634, 0.5552, 0.8557, 0.6231], [0.2425, 0.1299, 0.0863, 0.5738], [0.3634, 0.734, 0.9687, 0.9277]]]],[0, 0, 0, 0], 4, 1, false, Con798), 
LSof94749 = softmax_layer(Con798, 1, Sof94749), 
exec_layers([LUp_30512,LAdd43489,LZer38104,LAdd10050,LRes80580,LCon798,LSof94749],["Up_30512","Add43489","Zer38104","Add10050","Res80580","Con798","Sof94749"],Sof94749,"Sof94749")

Actual (Unparsed): [[[[0.0246687, 0.0142629, 0.0543030, 0.0102601]], [[0.0399881, 0.0400223, 0.0076979, 0.0308278]], [[0.0020842, 0.0023111, 0.0025223, 0.0011788]], [[0.0020842, 0.0023111, 0.0025223, 0.0011788]], [[0.0733044, 0.0319216, 0.2195994, 0.0269554]], [[0.1556227, 0.1430624, 0.0128848, 0.1353588]], [[0.0020842, 0.0023111, 0.0025223, 0.0011788]], [[0.0020842, 0.0023111, 0.0025223, 0.0011788]], [[0.2119619, 0.0438465, 0.5465111, 0.0526082]], [[0.3504154, 0.5726269, 0.0180186, 0.6130831]], [[0.0020842, 0.0023111, 0.0025223, 0.0011788]], [[0.0020842, 0.0023111, 0.0025223, 0.0011788]], [[0.0492772, 0.0169975, 0.1116414, 0.0175803]], [[0.0780878, 0.1187713, 0.0091649, 0.1038960]], [[0.0020842, 0.0023111, 0.0025223, 0.0011788]], [[0.0020842, 0.0023111, 0.0025223, 0.0011788]]]]

Expected (Unparsed): [[[[0.02466865532732446,0.014262929851026616,0.05430304460150468,0.010260075249118188]],[[0.0399880729205604,0.04002232099220189,0.007697912555187025,0.030827778224844768]],[[0.0020842426725313818,0.0023110834563129837,0.0025223472221789552,0.0011787956644480234]],[[0.0020842426725313818,0.0023110834563129837,0.0025223472221789552,0.0011787956644480234]],[[0.07330442919628188,0.03192154849908492,0.2195994456736306,0.026955412280798195]],[[0.1556226820521993,0.14306239922226888,0.012884801846626171,0.13535878556633776]],[[0.0020842426725313818,0.0023110834563129837,0.0025223472221789552,0.0011787956644480234]],[[0.0020842426725313818,0.0023110834563129837,0.0025223472221789552,0.0011787956644480234]],[[0.21196185148711993,0.04384646953582636,0.5465110819085948,0.05260818541743627]],[[0.3504153526225051,0.5726269017332329,0.018018573470679873,0.6130830965566167]],[[0.0020842426725313818,0.0023110834563129837,0.0025223472221789552,0.0011787956644480234]],[[0.0020842426725313818,0.0023110834563129837,0.0025223472221789552,0.0011787956644480234]],[[0.04927723859564869,0.01699745918671539,0.11164144314714247,0.017580314362758122]],[[0.07808777641810924,0.11877130332913917,0.009164919019202767,0.1038959870265057]],[[0.0020842426725313818,0.0023110834563129837,0.0025223472221789552,0.0011787956644480234]],[[0.0020842426725313818,0.0023110834563129837,0.0025223472221789552,0.0011787956644480234]]]]

Actual:   [[[[0.0247, 0.0143, 0.0544, 0.0103]], [[0.04, 0.0401, 0.0077, 0.0309]], [[0.0021, 0.0024, 0.0026, 0.0012]], [[0.0021, 0.0024, 0.0026, 0.0012]], [[0.0734, 0.032, 0.2196, 0.027]], [[0.1557, 0.1431, 0.0129, 0.1354]], [[0.0021, 0.0024, 0.0026, 0.0012]], [[0.0021, 0.0024, 0.0026, 0.0012]], [[0.212, 0.0439, 0.5466, 0.0527]], [[0.3505, 0.5727, 0.0181, 0.6131]], [[0.0021, 0.0024, 0.0026, 0.0012]], [[0.0021, 0.0024, 0.0026, 0.0012]], [[0.0493, 0.017, 0.1117, 0.0176]], [[0.0781, 0.1188, 0.0092, 0.1039]], [[0.0021, 0.0024, 0.0026, 0.0012]], [[0.0021, 0.0024, 0.0026, 0.0012]]]]

Expected: [[[[0.0247, 0.0143, 0.0544, 0.0103]], [[0.04, 0.0401, 0.0077, 0.0309]], [[0.0021, 0.0024, 0.0026, 0.0012]], [[0.0021, 0.0024, 0.0026, 0.0012]], [[0.0734, 0.032, 0.2196, 0.027]], [[0.1557, 0.1431, 0.0129, 0.1354]], [[0.0021, 0.0024, 0.0026, 0.0012]], [[0.0021, 0.0024, 0.0026, 0.0012]], [[0.212, 0.0439, 0.5466, 0.0527]], [[0.3505, 0.5727, 0.0181, 0.6131]], [[0.0021, 0.0024, 0.0026, 0.0012]], [[0.0021, 0.0024, 0.0026, 0.0012]], [[0.0493, 0.017, 0.1117, 0.0176]], [[0.0781, 0.1188, 0.0092, 0.1039]], [[0.0021, 0.0024, 0.0026, 0.0012]], [[0.0021, 0.0024, 0.0026, 0.0012]]]]