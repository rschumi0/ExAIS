import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min44822 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Min44822 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Sim2705 = tf.keras.layers.Input(shape=([3, 1]))
in0Max51672 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Max51672 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con65844 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Max2892 = tf.keras.layers.Input(shape=([2, 1, 2]))

Min44822 = keras.layers.Minimum(name = 'Min44822', )([in0Min44822,in1Min44822])
Res87189 = keras.layers.Reshape((2, 2, 2), name = 'Res87189', )(Min44822)
Sim2705 = keras.layers.SimpleRNN(1,name = 'Sim2705', )(in0Sim2705)
Res10854 = keras.layers.Reshape((1, 1), name = 'Res10854', )(Sim2705)
Ave93890 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='same', name = 'Ave93890', )(Res10854)
Max51672 = keras.layers.Maximum(name = 'Max51672', )([in0Max51672,in1Max51672])
Res90917 = keras.layers.Reshape((1, 2), name = 'Res90917', )(Max51672)
Ave66479 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave66479', )(Res90917)
Dot99716 = keras.layers.Dot(axes=(1, 1), name = 'Dot99716', )([Ave93890,Ave66479])
Res32094 = keras.layers.Reshape((1, 2, 1), name = 'Res32094', )(Dot99716)
Con65844 = keras.layers.Concatenate(axis=3, name = 'Con65844', )([Res32094,in0Con65844])
Max2892 = keras.layers.MaxPool2D(pool_size=(2, 1), strides=(1, 1), padding='valid', name = 'Max2892', )(in0Max2892)
Zer60639 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer60639', )(Max2892)
Min26051 = keras.layers.Minimum(name = 'Min26051', )([Con65844,Zer60639])
Zer2815 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer2815', )(Min26051)
Max59567 = keras.layers.Maximum(name = 'Max59567', )([Res87189,Zer2815])
model = tf.keras.models.Model(inputs=[in0Min44822,in1Min44822,in0Sim2705,in0Max51672,in1Max51672,in0Con65844,in0Max2892], outputs=Max59567)
w = model.get_layer('Sim2705').get_weights() 
w[0] = np.array([[9]])
w[1] = np.array([[5]])
w[2] = np.array([4])
model.get_layer('Sim2705').set_weights(w) 
in0Min44822 = tf.constant([[[[[0.9844], [0.0677]], [[0.6499], [0.2153]]], [[[0.3285], [0.9591]], [[0.2736], [0.9005]]]]])
in1Min44822 = tf.constant([[[[[0.3562], [0.6036]], [[0.0678], [0.397]]], [[[0.9599], [0.8702]], [[0.2513], [0.4665]]]]])
in0Sim2705 = tf.constant([[[6], [4], [10]]])
in0Max51672 = tf.constant([[[[0.2043, 0.1861]]]])
in1Max51672 = tf.constant([[[[0.8041, 0.0696]]]])
in0Con65844 = tf.constant([[[[0.816], [0.4309]]]])
in0Max2892 = tf.constant([[[[1.9951, 1.8164]], [[1.5456, 1.8187]]]])
print (np.array2string(model.predict([in0Min44822,in1Min44822,in0Sim2705,in0Max51672,in1Max51672,in0Con65844,in0Max2892],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max59567.png')

LMin44822 = minimum_layer([[[[[[0.9844], [0.0677]], [[0.6499], [0.2153]]], [[[0.3285], [0.9591]], [[0.2736], [0.9005]]]]], [[[[[0.3562], [0.6036]], [[0.0678], [0.397]]], [[[0.9599], [0.8702]], [[0.2513], [0.4665]]]]]], Min44822), 
LRes87189 = reshape_layer(Min44822, [2, 2, 2], Res87189), 
LSim2705 = simple_rnn_layer([[[6], [4], [10]]],[[9]],[[5]],[4], Sim2705), 
LRes10854 = reshape_layer(Sim2705, [1, 1], Res10854), 
LAve93890 = average_pooling1D_layer(Res10854, 1, 1, true, Ave93890), 
LMax51672 = maximum_layer([[[[[0.2043, 0.1861]]]], [[[[0.8041, 0.0696]]]]], Max51672), 
LRes90917 = reshape_layer(Max51672, [1, 2], Res90917), 
LAve66479 = average_pooling1D_layer(Res90917, 1, Ave66479), 
LDot99716 = dot_layer(Ave93890,Ave66479, 1, 1, Dot99716), 
LRes32094 = reshape_layer(Dot99716, [1, 2, 1], Res32094), 
LCon65844 = concatenate_layer([Res32094,[[[[0.816], [0.4309]]]]], 3, Con65844), 
LMax2892 = max_pool2D_layer([[[[1.9951, 1.8164]], [[1.5456, 1.8187]]]], 2, 1, 1, 1, false, Max2892), 
LZer60639 = zero_padding2D_layer(Max2892, 0, 0, 1, 0, Zer60639), 
LMin26051 = minimum_layer([Con65844,Zer60639], Min26051), 
LZer2815 = zero_padding2D_layer(Min26051, 1, 0, 0, 0, Zer2815), 
LMax59567 = maximum_layer([Res87189,Zer2815], Max59567), 
exec_layers([LMin44822,LRes87189,LSim2705,LRes10854,LAve93890,LMax51672,LRes90917,LAve66479,LDot99716,LRes32094,LCon65844,LMax2892,LZer60639,LMin26051,LZer2815,LMax59567],["Min44822","Res87189","Sim2705","Res10854","Ave93890","Max51672","Res90917","Ave66479","Dot99716","Res32094","Con65844","Max2892","Zer60639","Min26051","Zer2815","Max59567"],Max59567,"Max59567")

Actual (Unparsed): [[[[0.3562000, 0.0677000], [0.0678000, 0.2153000]], [[0.3285000, 0.8702000], [0.2513000, 0.4665000]]]]

Expected (Unparsed): [[[[0.3562,0.0677],[0.0678,0.2153]],[[0.3285,0.8702],[0.2513,0.4665]]]]

Actual:   [[[[0.3562, 0.0677], [0.0678, 0.2153]], [[0.3285, 0.8702], [0.2513, 0.4665]]]]

Expected: [[[[0.3562, 0.0677], [0.0678, 0.2153]], [[0.3285, 0.8702], [0.2513, 0.4665]]]]