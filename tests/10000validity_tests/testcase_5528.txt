import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add21544 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Add21544 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con39636 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in0Min18276 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Min18276 = tf.keras.layers.Input(shape=([1, 1, 1]))

Add21544 = keras.layers.Add(name = 'Add21544', )([in0Add21544,in1Add21544])
Res40213 = keras.layers.Reshape((1, 4), name = 'Res40213', )(Add21544)
Ave23380 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave23380', )(Res40213)
Res39608 = keras.layers.Reshape((1, 4, 1), name = 'Res39608', )(Ave23380)
Cro40449 = keras.layers.Cropping2D(cropping=((0, 0), (3, 0)), name = 'Cro40449', )(Res39608)
Res69787 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res69787', )(Cro40449)
Con39636 = keras.layers.Concatenate(axis=4, name = 'Con39636', )([Res69787,in0Con39636])
Min18276 = keras.layers.Minimum(name = 'Min18276', )([in0Min18276,in1Min18276])
Zer68166 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer68166', )(Min18276)
Max59701 = keras.layers.MaxPool2D(pool_size=(2, 2), name = 'Max59701', )(Zer68166)
Res39924 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res39924', )(Max59701)
Con96521 = keras.layers.Conv3D(2, (1, 1, 1),strides=(1, 1, 4), padding='valid', dilation_rate=(1, 1, 1), name = 'Con96521', )(Res39924)
Sub14914 = keras.layers.Subtract(name = 'Sub14914', )([Con39636,Con96521])
model = tf.keras.models.Model(inputs=[in0Add21544,in1Add21544,in0Con39636,in0Min18276,in1Min18276], outputs=Sub14914)
w = model.get_layer('Con96521').get_weights() 
w[0] = np.array([[[[[0.7464, 0.4633]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con96521').set_weights(w) 
in0Add21544 = tf.constant([[[[0.2395, 0.6209], [0.8169, 0.1507]]]])
in1Add21544 = tf.constant([[[[0.3382, 0.0475], [0.7678, 0.0545]]]])
in0Con39636 = tf.constant([[[[[0.3243]]]]])
in0Min18276 = tf.constant([[[[0.6689]]]])
in1Min18276 = tf.constant([[[[0.0241]]]])
print (np.array2string(model.predict([in0Add21544,in1Add21544,in0Con39636,in0Min18276,in1Min18276],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub14914.png')

LAdd21544 = add_layer([[[[[0.2395, 0.6209], [0.8169, 0.1507]]]], [[[[0.3382, 0.0475], [0.7678, 0.0545]]]]], Add21544), 
LRes40213 = reshape_layer(Add21544, [1, 4], Res40213), 
LAve23380 = average_pooling1D_layer(Res40213, 1, Ave23380), 
LRes39608 = reshape_layer(Ave23380, [1, 4, 1], Res39608), 
LCro40449 = cropping2D_layer(Res39608, 0, 0, 3, 0, Cro40449), 
LRes69787 = reshape_layer(Cro40449, [1, 1, 1, 1], Res69787), 
LCon39636 = concatenate_layer([Res69787,[[[[[0.3243]]]]]], 4, Con39636), 
LMin18276 = minimum_layer([[[[[0.6689]]]], [[[[0.0241]]]]], Min18276), 
LZer68166 = zero_padding2D_layer(Min18276, 1, 1, 1, 1, Zer68166), 
LMax59701 = max_pool2D_layer(Zer68166, 2, 2, Max59701), 
LRes39924 = reshape_layer(Max59701, [1, 1, 1, 1], Res39924), 
LCon96521 = conv3D_layer(Res39924, 1, 1, 1,[[[[[0.7464, 0.4633]]]]],[0, 0], 1, 1, 4, false, 1, 1, 1, Con96521), 
LSub14914 = subtract_layer(Con39636,Con96521, Sub14914), 
exec_layers([LAdd21544,LRes40213,LAve23380,LRes39608,LCro40449,LRes69787,LCon39636,LMin18276,LZer68166,LMax59701,LRes39924,LCon96521,LSub14914],["Add21544","Res40213","Ave23380","Res39608","Cro40449","Res69787","Con39636","Min18276","Zer68166","Max59701","Res39924","Con96521","Sub14914"],Sub14914,"Sub14914")

Actual (Unparsed): [[[[[0.1872118, 0.3131345]]]]]

Expected (Unparsed): [[[[[0.18721176,0.31313447]]]]]

Actual:   [[[[[0.1873, 0.3132]]]]]

Expected: [[[[[0.1873, 0.3132]]]]]