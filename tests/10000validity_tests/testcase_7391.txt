import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub78222 = tf.keras.layers.Input(shape=([3]))
in1Sub78222 = tf.keras.layers.Input(shape=([3]))
in0Con10139 = tf.keras.layers.Input(shape=([3, 5, 1]))
in0Cro95661 = tf.keras.layers.Input(shape=([3, 2, 2, 1]))
in0Sep86427 = tf.keras.layers.Input(shape=([2, 2]))
in0Con71711 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Min80479 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Min80479 = tf.keras.layers.Input(shape=([1, 1, 2]))

Sub78222 = keras.layers.Subtract(name = 'Sub78222', )([in0Sub78222,in1Sub78222])
Res94772 = keras.layers.Reshape((3, 1), name = 'Res94772', )(Sub78222)
Res14057 = keras.layers.Reshape((3, 1, 1), name = 'Res14057', )(Res94772)
Ave45378 = keras.layers.AveragePooling2D(pool_size=(3, 1), strides=(1, 1), padding='same', name = 'Ave45378', )(Res14057)
Zer38684 = keras.layers.ZeroPadding2D(padding=((0, 0), (4, 0)), name = 'Zer38684', )(Ave45378)
Con10139 = keras.layers.Concatenate(axis=3, name = 'Con10139', )([Zer38684,in0Con10139])
Cro95661 = keras.layers.Cropping3D(cropping=((1, 0), (1, 0), (1, 0)), name = 'Cro95661', )(in0Cro95661)
Res88216 = keras.layers.Reshape((2, 1, 1), name = 'Res88216', )(Cro95661)
Loc10733 = keras.layers.LocallyConnected2D(2, (1, 1),strides=(1, 1), name = 'Loc10733', )(Res88216)
Zer6433 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer6433', )(Loc10733)
Sep86427 = keras.layers.SeparableConv1D(2, (2),strides=(1), padding='valid', name = 'Sep86427', )(in0Sep86427)
Res19749 = keras.layers.Reshape((1, 2, 1), name = 'Res19749', )(Sep86427)
Con71711 = keras.layers.Concatenate(axis=3, name = 'Con71711', )([Res19749,in0Con71711])
Min80479 = keras.layers.Minimum(name = 'Min80479', )([in0Min80479,in1Min80479])
Zer39264 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer39264', )(Min80479)
Mul30553 = keras.layers.Multiply(name = 'Mul30553', )([Con71711,Zer39264])
Zer50866 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer50866', )(Mul30553)
Min1315 = keras.layers.Minimum(name = 'Min1315', )([Zer6433,Zer50866])
Zer21054 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer21054', )(Min1315)
Sub26245 = keras.layers.Subtract(name = 'Sub26245', )([Con10139,Zer21054])
model = tf.keras.models.Model(inputs=[in0Sub78222,in1Sub78222,in0Con10139,in0Cro95661,in0Sep86427,in0Con71711,in0Min80479,in1Min80479], outputs=Sub26245)
w = model.get_layer('Loc10733').get_weights() 
w[0] = np.array([[[0.7153, 0.0315]], [[0.1887, 0.838]]])
w[1] = np.array([[[0, 0]], [[0, 0]]])
model.get_layer('Loc10733').set_weights(w) 
w = model.get_layer('Sep86427').get_weights() 
w[0] = np.array([[[0.5097], [0.8201]], [[0.7255], [0.5441]]])
w[1] = np.array([[[0.5664, 0.0245], [0.8985, 0.2124]]])
w[2] = np.array([0, 0])
model.get_layer('Sep86427').set_weights(w) 
in0Sub78222 = tf.constant([[0.0864, 0.8715, 0.8292]])
in1Sub78222 = tf.constant([[0.1763, 0.5521, 0.264]])
in0Con10139 = tf.constant([[[[0.0401], [0.5582], [0.0225], [0.1385], [0.3892]], [[0.5537], [0.3075], [0.2908], [0.2927], [0.2183]], [[0.0235], [0.3277], [0.7123], [0.0951], [0.0401]]]])
in0Cro95661 = tf.constant([[[[[1.4818], [1.9754]], [[1.7909], [1.5559]]], [[[1.7589], [1.8025]], [[1.613], [1.8779]]], [[[1.347], [1.0731]], [[1.2161], [1.573]]]]])
in0Sep86427 = tf.constant([[[0.2086, 0.1495], [0.1054, 0.7665]]])
in0Con71711 = tf.constant([[[[0.3901], [0.4086]]]])
in0Min80479 = tf.constant([[[[0.0178, 0.8358]]]])
in1Min80479 = tf.constant([[[[0.8293, 0.4357]]]])
print (np.array2string(model.predict([in0Sub78222,in1Sub78222,in0Con10139,in0Cro95661,in0Sep86427,in0Con71711,in0Min80479,in1Min80479],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub26245.png')

LSub78222 = subtract_layer([[0.0864, 0.8715, 0.8292]], [[0.1763, 0.5521, 0.264]], Sub78222), 
LRes94772 = reshape_layer(Sub78222, [3, 1], Res94772), 
LRes14057 = reshape_layer(Res94772, [3, 1, 1], Res14057), 
LAve45378 = average_pooling2D_layer(Res14057, 3, 1, 1, 1, true, Ave45378), 
LZer38684 = zero_padding2D_layer(Ave45378, 0, 0, 4, 0, Zer38684), 
LCon10139 = concatenate_layer([Zer38684,[[[[0.0401], [0.5582], [0.0225], [0.1385], [0.3892]], [[0.5537], [0.3075], [0.2908], [0.2927], [0.2183]], [[0.0235], [0.3277], [0.7123], [0.0951], [0.0401]]]]], 3, Con10139), 
LCro95661 = cropping3D_layer([[[[[1.4818], [1.9754]], [[1.7909], [1.5559]]], [[[1.7589], [1.8025]], [[1.613], [1.8779]]], [[[1.347], [1.0731]], [[1.2161], [1.573]]]]], 1, 0, 1, 0, 1, 0, Cro95661), 
LRes88216 = reshape_layer(Cro95661, [2, 1, 1], Res88216), 
LLoc10733 = locally_connected2D_layer(Res88216, 1, 1,[[[0.7153, 0.0315]], [[0.1887, 0.838]]],[[[0, 0]], [[0, 0]]], 1, 1, Loc10733), 
LZer6433 = zero_padding2D_layer(Loc10733, 0, 0, 2, 0, Zer6433), 
LSep86427 = separable_conv1D_layer([[[0.2086, 0.1495], [0.1054, 0.7665]]], 2,[[[[0.5097], [0.8201]], [[0.7255], [0.5441]]],[[[0.5664, 0.0245], [0.8985, 0.2124]]]],[0, 0], 1, false, Sep86427), 
LRes19749 = reshape_layer(Sep86427, [1, 2, 1], Res19749), 
LCon71711 = concatenate_layer([Res19749,[[[[0.3901], [0.4086]]]]], 3, Con71711), 
LMin80479 = minimum_layer([[[[[0.0178, 0.8358]]]], [[[[0.8293, 0.4357]]]]], Min80479), 
LZer39264 = zero_padding2D_layer(Min80479, 0, 0, 1, 0, Zer39264), 
LMul30553 = multiply_layer([Con71711,Zer39264], Mul30553), 
LZer50866 = zero_padding2D_layer(Mul30553, 1, 0, 1, 0, Zer50866), 
LMin1315 = minimum_layer([Zer6433,Zer50866], Min1315), 
LZer21054 = zero_padding2D_layer(Min1315, 1, 0, 2, 0, Zer21054), 
LSub26245 = subtract_layer(Con10139,Zer21054, Sub26245), 
exec_layers([LSub78222,LRes94772,LRes14057,LAve45378,LZer38684,LCon10139,LCro95661,LRes88216,LLoc10733,LZer6433,LSep86427,LRes19749,LCon71711,LMin80479,LZer39264,LMul30553,LZer50866,LMin1315,LZer21054,LSub26245],["Sub78222","Res94772","Res14057","Ave45378","Zer38684","Con10139","Cro95661","Res88216","Loc10733","Zer6433","Sep86427","Res19749","Con71711","Min80479","Zer39264","Mul30553","Zer50866","Min1315","Zer21054","Sub26245"],Sub26245,"Sub26245")

Actual (Unparsed): [[[[0.0000000, 0.0401000], [0.0000000, 0.5582000], [0.0000000, 0.0225000], [0.0000000, 0.1385000], [0.1147500, 0.3892000]], [[0.0000000, 0.5537000], [0.0000000, 0.3075000], [0.0000000, 0.2908000], [0.0000000, 0.2927000], [0.2649000, 0.2183000]], [[0.0000000, 0.0235000], [0.0000000, 0.3277000], [0.0000000, 0.7123000], [0.0000000, 0.0951000], [0.4401800, -0.1379270]]]]

Expected (Unparsed): [[[[0,0.0401],[0,0.5582],[0,0.0225],[0,0.1385],[0.11475,0.3892]],[[0,0.5537],[0,0.3075],[0,0.2908],[0,0.2927],[0.2649,0.2183]],[[0,0.0235],[0,0.3277],[0,0.7123],[0,0.0951],[0.440179990511096,-0.13792702]]]]

Actual:   [[[[0, 0.0401], [0, 0.5582], [0, 0.0225], [0, 0.1385], [0.1148, 0.3892]], [[0, 0.5537], [0, 0.3075], [0, 0.2908], [0, 0.2927], [0.2649, 0.2183]], [[0, 0.0235], [0, 0.3277], [0, 0.7123], [0, 0.0951], [0.4402, -0.1379]]]]

Expected: [[[[0, 0.0401], [0, 0.5582], [0, 0.0225], [0, 0.1385], [0.1148, 0.3892]], [[0, 0.5537], [0, 0.3075], [0, 0.2908], [0, 0.2927], [0.2649, 0.2183]], [[0, 0.0235], [0, 0.3277], [0, 0.7123], [0, 0.0951], [0.4402, -0.1379]]]]