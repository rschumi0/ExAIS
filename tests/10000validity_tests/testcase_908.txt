import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave88101 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Ave88101 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con98058 = tf.keras.layers.Input(shape=([3, 2]))
in0Max80524 = tf.keras.layers.Input(shape=([1, 1]))
in1Max80524 = tf.keras.layers.Input(shape=([1, 1]))
in0Con51869 = tf.keras.layers.Input(shape=([3, 2]))
in0Dot96224 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot96224 = tf.keras.layers.Input(shape=([3, 3]))

Ave88101 = keras.layers.Average(name = 'Ave88101', )([in0Ave88101,in1Ave88101])
Res86660 = keras.layers.Reshape((2, 1), name = 'Res86660', )(Ave88101)
Zer14713 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer14713', )(Res86660)
Con98058 = keras.layers.Concatenate(axis=2, name = 'Con98058', )([Zer14713,in0Con98058])
Max80524 = keras.layers.Maximum(name = 'Max80524', )([in0Max80524,in1Max80524])
Zer61687 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer61687', )(Max80524)
Con51869 = keras.layers.Concatenate(axis=2, name = 'Con51869', )([Zer61687,in0Con51869])
Dot96224 = keras.layers.Dot(axes=(1, 1), name = 'Dot96224', )([in0Dot96224,in1Dot96224])
Bat39865 = keras.layers.BatchNormalization(axis=1, epsilon=0.8266329101158133,  name = 'Bat39865', )(Dot96224)
Sub96477 = keras.layers.Subtract(name = 'Sub96477', )([Con51869,Bat39865])
Mul41080 = keras.layers.Multiply(name = 'Mul41080', )([Con98058,Sub96477])
model = tf.keras.models.Model(inputs=[in0Ave88101,in1Ave88101,in0Con98058,in0Max80524,in1Max80524,in0Con51869,in0Dot96224,in1Dot96224], outputs=Mul41080)
w = model.get_layer('Bat39865').get_weights() 
w[0] = np.array([0.0022, 0.9454, 0.812])
w[1] = np.array([0.4501, 0.0416, 0.8736])
w[2] = np.array([0.4952, 0.0605, 0.7371])
w[3] = np.array([0.2652, 0.1671, 0.4775])
model.get_layer('Bat39865').set_weights(w) 
in0Ave88101 = tf.constant([[[[0.5287]], [[0.9707]]]])
in1Ave88101 = tf.constant([[[[0.1898]], [[0.0691]]]])
in0Con98058 = tf.constant([[[0.3725, 0.9207], [0.4775, 0.2739], [0.5183, 0.7511]]])
in0Max80524 = tf.constant([[[0.9113]]])
in1Max80524 = tf.constant([[[0.002]]])
in0Con51869 = tf.constant([[[0.637, 0.7702], [0.0617, 0.5296], [0.3829, 0.4438]]])
in0Dot96224 = tf.constant([[[0.369, 0.4111, 0.3426], [0.1083, 0.4566, 0.4578], [0.7885, 0.1889, 0.0689]]])
in1Dot96224 = tf.constant([[[0.8957, 0.5305, 0.0175], [0.9465, 0.5258, 0.2458], [0.0512, 0.7314, 0.2415]]])
print (np.array2string(model.predict([in0Ave88101,in1Ave88101,in0Con98058,in0Max80524,in1Max80524,in0Con51869,in0Dot96224,in1Dot96224],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul41080.png')

LAve88101 = average_layer([[[[[0.5287]], [[0.9707]]]], [[[[0.1898]], [[0.0691]]]]], Ave88101), 
LRes86660 = reshape_layer(Ave88101, [2, 1], Res86660), 
LZer14713 = zero_padding1D_layer(Res86660, 1, 0, Zer14713), 
LCon98058 = concatenate_layer([Zer14713,[[[0.3725, 0.9207], [0.4775, 0.2739], [0.5183, 0.7511]]]], 2, Con98058), 
LMax80524 = maximum_layer([[[[0.9113]]], [[[0.002]]]], Max80524), 
LZer61687 = zero_padding1D_layer(Max80524, 2, 0, Zer61687), 
LCon51869 = concatenate_layer([Zer61687,[[[0.637, 0.7702], [0.0617, 0.5296], [0.3829, 0.4438]]]], 2, Con51869), 
LDot96224 = dot_layer([[[0.369, 0.4111, 0.3426], [0.1083, 0.4566, 0.4578], [0.7885, 0.1889, 0.0689]]], [[[0.8957, 0.5305, 0.0175], [0.9465, 0.5258, 0.2458], [0.0512, 0.7314, 0.2415]]], 1, 1, Dot96224), 
LBat39865 = batch_normalization_layer(Dot96224, 1, 0.8266329101158133, [0.0022, 0.9454, 0.812], [0.4501, 0.0416, 0.8736], [0.4952, 0.0605, 0.7371], [0.2652, 0.1671, 0.4775], Bat39865), 
LSub96477 = subtract_layer(Con51869,Bat39865, Sub96477), 
LMul41080 = multiply_layer([Con98058,Sub96477], Mul41080), 
exec_layers([LAve88101,LRes86660,LZer14713,LCon98058,LMax80524,LZer61687,LCon51869,LDot96224,LBat39865,LSub96477,LMul41080],["Ave88101","Res86660","Zer14713","Con98058","Max80524","Zer61687","Con51869","Dot96224","Bat39865","Sub96477","Mul41080"],Mul41080,"Mul41080")

Actual (Unparsed): [[[-0.0000000, 0.0693581, 0.2952428], [-0.2703251, -0.2330529, 0.1065063], [0.0171596, -0.1569464, -0.0013497]]]

Expected (Unparsed): [[[-0.0,0.0693581378750602,0.2952427559687729],[-0.27032506326569805,-0.2330528657323899,0.10650632980992178],[0.017159590725375387,-0.1569464549606152,-0.0013497379167568921]]]

Actual:   [[[-0, 0.0694, 0.2953], [-0.2703, -0.233, 0.1066], [0.0172, -0.1569, -0.0013]]]

Expected: [[[-0, 0.0694, 0.2953], [-0.2703, -0.233, 0.1066], [0.0172, -0.1569, -0.0013]]]