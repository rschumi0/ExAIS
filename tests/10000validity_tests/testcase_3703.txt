import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo84071 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con2303 = tf.keras.layers.Input(shape=([3, 1, 3]))
in0Loc34003 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Add30825 = tf.keras.layers.Input(shape=([2, 2]))
in1Add30825 = tf.keras.layers.Input(shape=([2, 2]))
in0Con89923 = tf.keras.layers.Input(shape=([3, 2]))

Glo84071 = keras.layers.GlobalMaxPool2D(name = 'Glo84071', )(in0Glo84071)
Mas43288 = keras.layers.Masking(mask_value=1, name = 'Mas43288', )(Glo84071)
Res22288 = keras.layers.Reshape((2, 1), name = 'Res22288', )(Mas43288)
GRU16930 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU16930', )(Res22288)
ReL98556 = keras.layers.ReLU(max_value=0.7058140137824548, negative_slope=6.014094552691974, threshold=7.024783506460432, name = 'ReL98556', )(GRU16930)
Res40472 = keras.layers.Reshape((3, 1), name = 'Res40472', )(ReL98556)
Res66647 = keras.layers.Reshape((3, 1, 1), name = 'Res66647', )(Res40472)
Con2303 = keras.layers.Concatenate(axis=3, name = 'Con2303', )([Res66647,in0Con2303])
Loc34003 = keras.layers.LocallyConnected2D(4, (1, 2),strides=(1, 1), name = 'Loc34003', )(in0Loc34003)
Zer14514 = keras.layers.ZeroPadding2D(padding=((2, 0), (0, 0)), name = 'Zer14514', )(Loc34003)
Max70790 = keras.layers.Maximum(name = 'Max70790', )([Con2303,Zer14514])
Res61640 = keras.layers.Reshape((3, 4), name = 'Res61640', )(Max70790)
Add30825 = keras.layers.Add(name = 'Add30825', )([in0Add30825,in1Add30825])
Zer80981 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer80981', )(Add30825)
Con89923 = keras.layers.Concatenate(axis=2, name = 'Con89923', )([Zer80981,in0Con89923])
Sub15446 = keras.layers.Subtract(name = 'Sub15446', )([Res61640,Con89923])
model = tf.keras.models.Model(inputs=[in0Glo84071,in0Con2303,in0Loc34003,in0Add30825,in1Add30825,in0Con89923], outputs=Sub15446)
w = model.get_layer('GRU16930').get_weights() 
w[0] = np.array([[1, 5, 10, 6, 5, 2, 3, 9, 8]])
w[1] = np.array([[5, 8, 10, 10, 4, 1, 8, 10, 8], [1, 1, 4, 10, 5, 6, 1, 6, 6], [3, 6, 1, 9, 5, 4, 4, 8, 5]])
w[2] = np.array([6, 10, 7, 7, 6, 8, 2, 5, 4])
model.get_layer('GRU16930').set_weights(w) 
w = model.get_layer('Loc34003').get_weights() 
w[0] = np.array([[[0.1592, 0.9564, 0.6198, 0.8186], [0.6976, 0.316, 0.1377, 0.7079], [0.3836, 0.7878, 0.2944, 0.3087], [0.17, 0.3842, 0.1589, 0.5774]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc34003').set_weights(w) 
in0Glo84071 = tf.constant([[[[1.4671, 1.2141]], [[1.5196, 1.7433]]]])
in0Con2303 = tf.constant([[[[0.2209, 0.8374, 0.0995]], [[0.6184, 0.0528, 0.6011]], [[0.552, 0.3517, 0.9052]]]])
in0Loc34003 = tf.constant([[[[0.0983, 0.3431], [0.9974, 0.5121]]]])
in0Add30825 = tf.constant([[[0.9333, 0.3699], [0.5149, 0.9023]]])
in1Add30825 = tf.constant([[[0.791, 0.742], [0.783, 0.1141]]])
in0Con89923 = tf.constant([[[0.3244, 0.9778], [0.819, 0.964], [0.6292, 0.4168]]])
print (np.array2string(model.predict([in0Glo84071,in0Con2303,in0Loc34003,in0Add30825,in1Add30825,in0Con89923],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub15446.png')

LGlo84071 = global_max_pool2D_layer([[[[1.4671, 1.2141]], [[1.5196, 1.7433]]]], Glo84071), 
LMas43288 = masking_layer(Glo84071, 1, Mas43288), 
LRes22288 = reshape_layer(Mas43288, [2, 1], Res22288), 
LGRU16930 = gru_layer(Res22288,[[1, 5, 10, 6, 5, 2, 3, 9, 8]],[[5, 8, 10, 10, 4, 1, 8, 10, 8], [1, 1, 4, 10, 5, 6, 1, 6, 6], [3, 6, 1, 9, 5, 4, 4, 8, 5]],[6, 10, 7, 7, 6, 8, 2, 5, 4], false, GRU16930), 
LReL98556 = relu_layer(GRU16930, 0.7058140137824548, 6.014094552691974, 7.024783506460432, ReL98556), 
LRes40472 = reshape_layer(ReL98556, [3, 1], Res40472), 
LRes66647 = reshape_layer(Res40472, [3, 1, 1], Res66647), 
LCon2303 = concatenate_layer([Res66647,[[[[0.2209, 0.8374, 0.0995]], [[0.6184, 0.0528, 0.6011]], [[0.552, 0.3517, 0.9052]]]]], 3, Con2303), 
LLoc34003 = locally_connected2D_layer([[[[0.0983, 0.3431], [0.9974, 0.5121]]]], 1, 2,[[[0.1592, 0.9564, 0.6198, 0.8186], [0.6976, 0.316, 0.1377, 0.7079], [0.3836, 0.7878, 0.2944, 0.3087], [0.17, 0.3842, 0.1589, 0.5774]]],[[[0, 0, 0, 0]]], 1, 1, Loc34003), 
LZer14514 = zero_padding2D_layer(Loc34003, 2, 0, 0, 0, Zer14514), 
LMax70790 = maximum_layer([Con2303,Zer14514], Max70790), 
LRes61640 = reshape_layer(Max70790, [3, 4], Res61640), 
LAdd30825 = add_layer([[[[0.9333, 0.3699], [0.5149, 0.9023]]], [[[0.791, 0.742], [0.783, 0.1141]]]], Add30825), 
LZer80981 = zero_padding1D_layer(Add30825, 1, 0, Zer80981), 
LCon89923 = concatenate_layer([Zer80981,[[[0.3244, 0.9778], [0.819, 0.964], [0.6292, 0.4168]]]], 2, Con89923), 
LSub15446 = subtract_layer(Res61640,Con89923, Sub15446), 
exec_layers([LGlo84071,LMas43288,LRes22288,LGRU16930,LReL98556,LRes40472,LRes66647,LCon2303,LLoc34003,LZer14514,LMax70790,LRes61640,LAdd30825,LZer80981,LCon89923,LSub15446],["Glo84071","Mas43288","Res22288","GRU16930","ReL98556","Res40472","Res66647","Con2303","Loc34003","Zer14514","Max70790","Res61640","Add30825","Zer80981","Con89923","Sub15446"],Sub15446,"Sub15446")

Actual (Unparsed): [[[0.0000000, 0.2209000, 0.5130000, -0.8783000], [-1.7243000, -0.4935000, -0.7662000, -0.3629000], [-0.5732445, 0.1685342, -0.1460215, 0.5101328]]]

Expected (Unparsed): [[[0,0.2209,0.513,-0.8783],[-1.7243,-0.49349999999999994,-0.7662,-0.3629],[-0.57324444,0.16853425999999994,-0.14602153999999995,0.5101327899999999]]]

Actual:   [[[0, 0.2209, 0.513, -0.8783], [-1.7243, -0.4935, -0.7662, -0.3629], [-0.5732, 0.1686, -0.146, 0.5102]]]

Expected: [[[0, 0.2209, 0.513, -0.8783], [-1.7243, -0.4934, -0.7662, -0.3629], [-0.5732, 0.1686, -0.146, 0.5102]]]