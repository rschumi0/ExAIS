import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub26901 = tf.keras.layers.Input(shape=([3, 3, 2, 2]))
in1Sub26901 = tf.keras.layers.Input(shape=([3, 3, 2, 2]))
in0Ave59232 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Ave59232 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Con95044 = tf.keras.layers.Input(shape=([3, 3, 2, 1]))

Sub26901 = keras.layers.Subtract(name = 'Sub26901', )([in0Sub26901,in1Sub26901])
Ave59232 = keras.layers.Average(name = 'Ave59232', )([in0Ave59232,in1Ave59232])
Zer38667 = keras.layers.ZeroPadding3D(padding=((2, 0), (2, 0), (0, 0)), name = 'Zer38667', )(Ave59232)
Con95044 = keras.layers.Concatenate(axis=4, name = 'Con95044', )([Zer38667,in0Con95044])
Mul71510 = keras.layers.Multiply(name = 'Mul71510', )([Sub26901,Con95044])
Res42095 = keras.layers.Reshape((3, 3, 4), name = 'Res42095', )(Mul71510)
Res85575 = keras.layers.Reshape((3, 12), name = 'Res85575', )(Res42095)
Ave27566 = keras.layers.AveragePooling1D(pool_size=(3), name = 'Ave27566', )(Res85575)
model = tf.keras.models.Model(inputs=[in0Sub26901,in1Sub26901,in0Ave59232,in1Ave59232,in0Con95044], outputs=Ave27566)
in0Sub26901 = tf.constant([[[[[0.8504, 0.3037], [0.2149, 0.0278]], [[0.0572, 0.1894], [0.0071, 0.6876]], [[0.5849, 0.8988], [0.7415, 0.2816]]], [[[0.8861, 0.2302], [0.671, 0.3931]], [[0.5238, 0.4718], [0.9677, 0.8877]], [[0.0425, 0.2752], [0.1303, 0.4838]]], [[[0.5987, 0.0589], [0.4486, 0.2474]], [[0.5149, 0.6478], [0.295, 0.1808]], [[0.6323, 0.1043], [0.8559, 0.0935]]]]])
in1Sub26901 = tf.constant([[[[[0.5789, 0.7399], [0.808, 0.2401]], [[0.8473, 0.109], [0.3546, 0.7885]], [[0.8796, 0.3831], [0.9843, 0.0451]]], [[[0.1944, 0.8752], [0.2938, 0.5011]], [[0.9607, 0.6479], [0.223, 0.1897]], [[0.3188, 0.0706], [0.091, 0.5478]]], [[[0.1845, 0.9164], [0.8956, 0.9606]], [[0.2298, 0.0852], [0.4369, 0.433]], [[0.2304, 0.3278], [0.9637, 0.3822]]]]])
in0Ave59232 = tf.constant([[[[[0.9906], [0.4019]]]]])
in1Ave59232 = tf.constant([[[[[0.2027], [0.3736]]]]])
in0Con95044 = tf.constant([[[[[0.9231], [0.7507]], [[0.7027], [0.8207]], [[0.4813], [0.5026]]], [[[0.8605], [0.9757]], [[0.4875], [0.3125]], [[0.845], [0.7325]]], [[[0.8692], [0.2201]], [[0.5913], [0.5256]], [[0.5214], [0.6057]]]]])
print (np.array2string(model.predict([in0Sub26901,in1Sub26901,in0Ave59232,in1Ave59232,in0Con95044],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave27566.png')

LSub26901 = subtract_layer([[[[[0.8504, 0.3037], [0.2149, 0.0278]], [[0.0572, 0.1894], [0.0071, 0.6876]], [[0.5849, 0.8988], [0.7415, 0.2816]]], [[[0.8861, 0.2302], [0.671, 0.3931]], [[0.5238, 0.4718], [0.9677, 0.8877]], [[0.0425, 0.2752], [0.1303, 0.4838]]], [[[0.5987, 0.0589], [0.4486, 0.2474]], [[0.5149, 0.6478], [0.295, 0.1808]], [[0.6323, 0.1043], [0.8559, 0.0935]]]]], [[[[[0.5789, 0.7399], [0.808, 0.2401]], [[0.8473, 0.109], [0.3546, 0.7885]], [[0.8796, 0.3831], [0.9843, 0.0451]]], [[[0.1944, 0.8752], [0.2938, 0.5011]], [[0.9607, 0.6479], [0.223, 0.1897]], [[0.3188, 0.0706], [0.091, 0.5478]]], [[[0.1845, 0.9164], [0.8956, 0.9606]], [[0.2298, 0.0852], [0.4369, 0.433]], [[0.2304, 0.3278], [0.9637, 0.3822]]]]], Sub26901), 
LAve59232 = average_layer([[[[[[0.9906], [0.4019]]]]], [[[[[0.2027], [0.3736]]]]]], Ave59232), 
LZer38667 = zero_padding3D_layer(Ave59232, 2, 0, 2, 0, 0, 0, Zer38667), 
LCon95044 = concatenate_layer([Zer38667,[[[[[0.9231], [0.7507]], [[0.7027], [0.8207]], [[0.4813], [0.5026]]], [[[0.8605], [0.9757]], [[0.4875], [0.3125]], [[0.845], [0.7325]]], [[[0.8692], [0.2201]], [[0.5913], [0.5256]], [[0.5214], [0.6057]]]]]], 4, Con95044), 
LMul71510 = multiply_layer([Sub26901,Con95044], Mul71510), 
LRes42095 = reshape_layer(Mul71510, [3, 3, 4], Res42095), 
LRes85575 = reshape_layer(Res42095, [3, 12], Res85575), 
LAve27566 = average_pooling1D_layer(Res85575, 3, Ave27566), 
exec_layers([LSub26901,LAve59232,LZer38667,LCon95044,LMul71510,LRes42095,LRes85575,LAve27566],["Sub26901","Ave59232","Zer38667","Con95044","Mul71510","Res42095","Res85575","Ave27566"],Ave27566,"Ave27566")

Actual (Unparsed): [[[0.0000000, -0.5676726, 0.0000000, -0.1405748, 0.0000000, 0.1011046, 0.0000000, 0.0009200, 0.0799312, 0.1015202, -0.0139332, -0.0342936]]]

Expected (Unparsed): [[[0.0,-0.5676725733333333,0.0,-0.14057484333333334,0.0,0.10110457,0.0,0.0009200166666666806,0.07993121166666667,0.10152017,-0.01393315,-0.03429356333333331]]]

Actual:   [[[0, -0.5676, 0, -0.1405, 0, 0.1012, 0, 0.001, 0.08, 0.1016, -0.0139, -0.0342]]]

Expected: [[[0, -0.5676, 0, -0.1405, 0, 0.1012, 0, 0.001, 0.08, 0.1016, -0.0139, -0.0342]]]