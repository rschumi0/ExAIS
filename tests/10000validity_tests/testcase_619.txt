import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Den45008 = tf.keras.layers.Input(shape=([2, 5, 3]))
in0Con47899 = tf.keras.layers.Input(shape=([2, 8]))
in0Max42939 = tf.keras.layers.Input(shape=([2, 2]))
in1Max42939 = tf.keras.layers.Input(shape=([2, 2]))
in0Con81050 = tf.keras.layers.Input(shape=([18, 2, 3]))
in0Max83358 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Max83358 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))

Den45008 = keras.layers.Dense(2,name = 'Den45008', )(in0Den45008)
Res22104 = keras.layers.Reshape((2, 10), name = 'Res22104', )(Den45008)
Con47899 = keras.layers.Concatenate(axis=2, name = 'Con47899', )([Res22104,in0Con47899])
Max42939 = keras.layers.Maximum(name = 'Max42939', )([in0Max42939,in1Max42939])
Dot95515 = keras.layers.Dot(axes=(1, 1), name = 'Dot95515', )([Con47899,Max42939])
Res40319 = keras.layers.Reshape((18, 2, 1), name = 'Res40319', )(Dot95515)
Con81050 = keras.layers.Concatenate(axis=3, name = 'Con81050', )([Res40319,in0Con81050])
Max83358 = keras.layers.Maximum(name = 'Max83358', )([in0Max83358,in1Max83358])
Res42249 = keras.layers.Reshape((1, 2, 4), name = 'Res42249', )(Max83358)
PRe33954 = keras.layers.PReLU(name = 'PRe33954', )(Res42249)
Zer49720 = keras.layers.ZeroPadding2D(padding=((17, 0), (0, 0)), name = 'Zer49720', )(PRe33954)
Sub34375 = keras.layers.Subtract(name = 'Sub34375', )([Con81050,Zer49720])
model = tf.keras.models.Model(inputs=[in0Den45008,in0Con47899,in0Max42939,in1Max42939,in0Con81050,in0Max83358,in1Max83358], outputs=Sub34375)
w = model.get_layer('Den45008').get_weights() 
w[0] = np.array([[0.7879, 0.5381], [0.5773, 0.568], [0.5014, 0.2174]])
w[1] = np.array([0.7936, 0.4281])
model.get_layer('Den45008').set_weights(w) 
w = model.get_layer('PRe33954').get_weights() 
w[0] = np.array([[[0.9366, 0.5906, 0.0859, 0.0527], [0.5284, 0.4236, 0.2308, 0.8689]]])
model.get_layer('PRe33954').set_weights(w) 
in0Den45008 = tf.constant([[[[0.1676, 0.363, 0.9076], [0.3835, 0.5067, 0.3897], [0.7114, 0.0695, 0.2899], [0.3204, 0.2028, 0.7036], [0.0136, 0.9417, 0.2615]], [[0.7246, 0.4025, 0.8222], [0.5581, 0.426, 0.5656], [0.3646, 0.853, 0.4185], [0.2431, 0.1575, 0.4884], [0.2601, 0.8278, 0.0653]]]])
in0Con47899 = tf.constant([[[0.5374, 0.5372, 0.8237, 0.4658, 0.6016, 0.5684, 0.8099, 0.5327], [0.2038, 0.1959, 0.0104, 0.3918, 0.6253, 0.5406, 0.4377, 0.2587]]])
in0Max42939 = tf.constant([[[0.1137, 0.5214], [0.6643, 0.8176]]])
in1Max42939 = tf.constant([[[0.3345, 0.8324], [0.8513, 0.342]]])
in0Con81050 = tf.constant([[[[0.6808, 0.4954, 0.1655], [0.0407, 0.4999, 0.3626]], [[0.7632, 0.2445, 0.9235], [0.2101, 0.2827, 0.4343]], [[0.2527, 0.8835, 0.5496], [0.5187, 0.7757, 0.7766]], [[0.1634, 0.2363, 0.2823], [0.7412, 0.4886, 0.228]], [[0.3007, 0.876, 0.091], [0.7954, 0.1273, 0.4799]], [[0.1117, 0.4309, 0.7281], [0.2849, 0.038, 0.1166]], [[0.7627, 0.3237, 0.9502], [0.2082, 0.3057, 0.4336]], [[0.6032, 0.4407, 0.3207], [0.449, 0.6366, 0.2255]], [[0.5822, 0.5929, 0.7966], [0.9427, 0.5329, 0.443]], [[0.3008, 0.3762, 0.5136], [0.1167, 0.3804, 0.7861]], [[0.9122, 0.9986, 0.5941], [0.3701, 0.0374, 0.4145]], [[0.722, 0.0236, 0.9441], [0.1467, 0.9235, 0.3797]], [[0.0115, 0.581, 0.367], [0.0795, 0.8073, 0.5766]], [[0.7276, 0.1069, 0.6587], [0.8581, 0.7882, 0.8049]], [[0.393, 0.8457, 0.8759], [0.8856, 0.9153, 0.3548]], [[0.0193, 0.3425, 0.6421], [0.5291, 0.5246, 0.6806]], [[0.3253, 0.7006, 0.1278], [0.2889, 0.4705, 0.6088]], [[0.0101, 0.0987, 0.3758], [0.5597, 0.7363, 0.8944]]]])
in0Max83358 = tf.constant([[[[[0.0251, 0.3917], [0.4043, 0.7222]], [[0.5021, 0.0086], [0.1677, 0.4566]]]]])
in1Max83358 = tf.constant([[[[[0.6214, 0.9976], [0.3149, 0.6434]], [[0.1325, 0.1466], [0.6153, 0.8229]]]]])
print (np.array2string(model.predict([in0Den45008,in0Con47899,in0Max42939,in1Max42939,in0Con81050,in0Max83358,in1Max83358],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub34375.png')

LDen45008 = dense_layer([[[[0.1676, 0.363, 0.9076], [0.3835, 0.5067, 0.3897], [0.7114, 0.0695, 0.2899], [0.3204, 0.2028, 0.7036], [0.0136, 0.9417, 0.2615]], [[0.7246, 0.4025, 0.8222], [0.5581, 0.426, 0.5656], [0.3646, 0.853, 0.4185], [0.2431, 0.1575, 0.4884], [0.2601, 0.8278, 0.0653]]]], [[0.7879, 0.5381], [0.5773, 0.568], [0.5014, 0.2174]],[0.7936, 0.4281], Den45008), 
LRes22104 = reshape_layer(Den45008, [2, 10], Res22104), 
LCon47899 = concatenate_layer([Res22104,[[[0.5374, 0.5372, 0.8237, 0.4658, 0.6016, 0.5684, 0.8099, 0.5327], [0.2038, 0.1959, 0.0104, 0.3918, 0.6253, 0.5406, 0.4377, 0.2587]]]], 2, Con47899), 
LMax42939 = maximum_layer([[[[0.1137, 0.5214], [0.6643, 0.8176]]], [[[0.3345, 0.8324], [0.8513, 0.342]]]], Max42939), 
LDot95515 = dot_layer(Con47899,Max42939, 1, 1, Dot95515), 
LRes40319 = reshape_layer(Dot95515, [18, 2, 1], Res40319), 
LCon81050 = concatenate_layer([Res40319,[[[[0.6808, 0.4954, 0.1655], [0.0407, 0.4999, 0.3626]], [[0.7632, 0.2445, 0.9235], [0.2101, 0.2827, 0.4343]], [[0.2527, 0.8835, 0.5496], [0.5187, 0.7757, 0.7766]], [[0.1634, 0.2363, 0.2823], [0.7412, 0.4886, 0.228]], [[0.3007, 0.876, 0.091], [0.7954, 0.1273, 0.4799]], [[0.1117, 0.4309, 0.7281], [0.2849, 0.038, 0.1166]], [[0.7627, 0.3237, 0.9502], [0.2082, 0.3057, 0.4336]], [[0.6032, 0.4407, 0.3207], [0.449, 0.6366, 0.2255]], [[0.5822, 0.5929, 0.7966], [0.9427, 0.5329, 0.443]], [[0.3008, 0.3762, 0.5136], [0.1167, 0.3804, 0.7861]], [[0.9122, 0.9986, 0.5941], [0.3701, 0.0374, 0.4145]], [[0.722, 0.0236, 0.9441], [0.1467, 0.9235, 0.3797]], [[0.0115, 0.581, 0.367], [0.0795, 0.8073, 0.5766]], [[0.7276, 0.1069, 0.6587], [0.8581, 0.7882, 0.8049]], [[0.393, 0.8457, 0.8759], [0.8856, 0.9153, 0.3548]], [[0.0193, 0.3425, 0.6421], [0.5291, 0.5246, 0.6806]], [[0.3253, 0.7006, 0.1278], [0.2889, 0.4705, 0.6088]], [[0.0101, 0.0987, 0.3758], [0.5597, 0.7363, 0.8944]]]]], 3, Con81050), 
LMax83358 = maximum_layer([[[[[[0.0251, 0.3917], [0.4043, 0.7222]], [[0.5021, 0.0086], [0.1677, 0.4566]]]]], [[[[[0.6214, 0.9976], [0.3149, 0.6434]], [[0.1325, 0.1466], [0.6153, 0.8229]]]]]], Max83358), 
LRes42249 = reshape_layer(Max83358, [1, 2, 4], Res42249), 
LPRe33954 = prelu_layer(Res42249, [[[0.9366, 0.5906, 0.0859, 0.0527], [0.5284, 0.4236, 0.2308, 0.8689]]], PRe33954), 
LZer49720 = zero_padding2D_layer(PRe33954, 17, 0, 0, 0, Zer49720), 
LSub34375 = subtract_layer(Con81050,Zer49720, Sub34375), 
exec_layers([LDen45008,LRes22104,LCon47899,LMax42939,LDot95515,LRes40319,LCon81050,LMax83358,LRes42249,LPRe33954,LZer49720,LSub34375],["Den45008","Res22104","Con47899","Max42939","Dot95515","Res40319","Con81050","Max83358","Res42249","PRe33954","Zer49720","Sub34375"],Sub34375,"Sub34375")

Actual (Unparsed): [[[[2.2423191, 0.6808000, 0.4954000, 0.1655000], [2.9664133, 0.0407000, 0.4999000, 0.3626000]], [[1.3514965, 0.7632000, 0.2445000, 0.9235000], [1.7691566, 0.2101000, 0.2827000, 0.4343000]], [[2.0304517, 0.2527000, 0.8835000, 0.5496000], [2.7595546, 0.5187000, 0.7757000, 0.7766000]], [[1.2676003, 0.1634000, 0.2363000, 0.2823000], [1.7321339, 0.7412000, 0.4886000, 0.2280000]], [[2.0329810, 0.3007000, 0.8760000, 0.0910000], [2.7394512, 0.7954000, 0.1273000, 0.4799000]], [[1.3269041, 0.1117000, 0.4309000, 0.7281000], [1.7412558, 0.2849000, 0.0380000, 0.1166000]], [[1.6315923, 0.7627000, 0.3237000, 0.9502000], [2.3418453, 0.2082000, 0.3057000, 0.4336000]], [[0.9329155, 0.6032000, 0.4407000, 0.3207000], [1.3399932, 0.4490000, 0.6366000, 0.2255000]], [[1.7795012, 0.5822000, 0.5929000, 0.7966000], [2.4650738, 0.9427000, 0.5329000, 0.4430000]], [[1.2395306, 0.3008000, 0.3762000, 0.5136000], [1.7154831, 0.1167000, 0.3804000, 0.7861000]], [[0.3532552, 0.9122000, 0.9986000, 0.5941000], [0.6139587, 0.3701000, 0.0374000, 0.4145000]], [[0.3464631, 0.7220000, 0.0236000, 0.9441000], [0.6073331, 0.1467000, 0.9235000, 0.3797000]], [[0.2843812, 0.0115000, 0.5810000, 0.3670000], [0.6941509, 0.0795000, 0.8073000, 0.5766000]], [[0.4893494, 0.7276000, 0.1069000, 0.6587000], [0.7080676, 0.8581000, 0.7882000, 0.8049000]], [[0.7335531, 0.3930000, 0.8457000, 0.8759000], [1.0120171, 0.8856000, 0.9153000, 0.3548000]], [[0.6503426, 0.0193000, 0.3425000, 0.6421000], [0.9151308, 0.5291000, 0.5246000, 0.6806000]], [[0.6435256, 0.3253000, 0.7006000, 0.1278000], [1.0320243, 0.2889000, 0.4705000, 0.6088000]], [[-0.2229805, -0.9875000, -0.3056000, -0.3464000], [0.1528326, 0.4131000, 0.1210000, 0.0715000]]]]

Expected (Unparsed): [[[[2.2423190571809997,0.6808,0.4954,0.1655],[2.966413184984,0.0407,0.4999,0.3626]],[[1.351496506702,0.7632,0.2445,0.9235],[1.7691565766239998,0.2101,0.2827,0.4343]],[[2.0304517040489998,0.2527,0.8835,0.5496],[2.7595545616240003,0.5187,0.7757,0.7766]],[[1.26760033415,0.1634,0.2363,0.2823],[1.7321338641320003,0.7412,0.4886,0.228]],[[2.0329809977969995,0.3007,0.876,0.091],[2.739451136812,0.7954,0.1273,0.4799]],[[1.326904135008,0.1117,0.4309,0.7281],[1.741255795056,0.2849,0.038,0.1166]],[[1.6315922831799998,0.7627,0.3237,0.9502],[2.3418452895360002,0.2082,0.3057,0.4336]],[[0.932915508511,0.6032,0.4407,0.3207],[1.339993117824,0.449,0.6366,0.2255]],[[1.77950116037,0.5822,0.5929,0.7966],[2.46507377982,0.9427,0.5329,0.443]],[[1.239530612029,0.3008,0.3762,0.5136],[1.715483074232,0.1167,0.3804,0.7861]],[[0.35325523999999997,0.9122,0.9986,0.5941],[0.61395864,0.3701,0.0374,0.4145]],[[0.34646307,0.722,0.0236,0.9441],[0.60733312,0.1467,0.9235,0.3797]],[[0.28438117,0.0115,0.581,0.367],[0.69415092,0.0795,0.8073,0.5766]],[[0.48934943999999997,0.7276,0.1069,0.6587],[0.7080675999999999,0.8581,0.7882,0.8049]],[[0.73355309,0.393,0.8457,0.8759],[1.01201712,0.8856,0.9153,0.3548]],[[0.65034258,0.0193,0.3425,0.6421],[0.9151307200000001,0.5291,0.5246,0.6806]],[[0.6435255599999999,0.3253,0.7006,0.1278],[1.03202428,0.2889,0.4705,0.6088]],[[-0.22298054,-0.9875,-0.3056,-0.34639999999999993],[0.15283259999999999,0.41309999999999997,0.121,0.07150000000000001]]]]

Actual:   [[[[2.2424, 0.6808, 0.4954, 0.1655], [2.9665, 0.0407, 0.4999, 0.3626]], [[1.3515, 0.7632, 0.2445, 0.9235], [1.7692, 0.2101, 0.2827, 0.4343]], [[2.0305, 0.2527, 0.8835, 0.5496], [2.7596, 0.5187, 0.7757, 0.7766]], [[1.2677, 0.1634, 0.2363, 0.2823], [1.7322, 0.7412, 0.4886, 0.228]], [[2.033, 0.3007, 0.876, 0.091], [2.7395, 0.7954, 0.1273, 0.4799]], [[1.327, 0.1117, 0.4309, 0.7281], [1.7413, 0.2849, 0.038, 0.1166]], [[1.6316, 0.7627, 0.3237, 0.9502], [2.3419, 0.2082, 0.3057, 0.4336]], [[0.933, 0.6032, 0.4407, 0.3207], [1.34, 0.449, 0.6366, 0.2255]], [[1.7796, 0.5822, 0.5929, 0.7966], [2.4651, 0.9427, 0.5329, 0.443]], [[1.2396, 0.3008, 0.3762, 0.5136], [1.7155, 0.1167, 0.3804, 0.7861]], [[0.3533, 0.9122, 0.9986, 0.5941], [0.614, 0.3701, 0.0374, 0.4145]], [[0.3465, 0.722, 0.0236, 0.9441], [0.6074, 0.1467, 0.9235, 0.3797]], [[0.2844, 0.0115, 0.581, 0.367], [0.6942, 0.0795, 0.8073, 0.5766]], [[0.4894, 0.7276, 0.1069, 0.6587], [0.7081, 0.8581, 0.7882, 0.8049]], [[0.7336, 0.393, 0.8457, 0.8759], [1.0121, 0.8856, 0.9153, 0.3548]], [[0.6504, 0.0193, 0.3425, 0.6421], [0.9152, 0.5291, 0.5246, 0.6806]], [[0.6436, 0.3253, 0.7006, 0.1278], [1.0321, 0.2889, 0.4705, 0.6088]], [[-0.2229, -0.9875, -0.3056, -0.3464], [0.1529, 0.4131, 0.121, 0.0715]]]]

Expected: [[[[2.2424, 0.6808, 0.4954, 0.1655], [2.9665, 0.0407, 0.4999, 0.3626]], [[1.3515, 0.7632, 0.2445, 0.9235], [1.7692, 0.2101, 0.2827, 0.4343]], [[2.0305, 0.2527, 0.8835, 0.5496], [2.7596, 0.5187, 0.7757, 0.7766]], [[1.2677, 0.1634, 0.2363, 0.2823], [1.7322, 0.7412, 0.4886, 0.228]], [[2.033, 0.3007, 0.876, 0.091], [2.7395, 0.7954, 0.1273, 0.4799]], [[1.327, 0.1117, 0.4309, 0.7281], [1.7413, 0.2849, 0.038, 0.1166]], [[1.6316, 0.7627, 0.3237, 0.9502], [2.3419, 0.2082, 0.3057, 0.4336]], [[0.933, 0.6032, 0.4407, 0.3207], [1.34, 0.449, 0.6366, 0.2255]], [[1.7796, 0.5822, 0.5929, 0.7966], [2.4651, 0.9427, 0.5329, 0.443]], [[1.2396, 0.3008, 0.3762, 0.5136], [1.7155, 0.1167, 0.3804, 0.7861]], [[0.3533, 0.9122, 0.9986, 0.5941], [0.614, 0.3701, 0.0374, 0.4145]], [[0.3465, 0.722, 0.0236, 0.9441], [0.6074, 0.1467, 0.9235, 0.3797]], [[0.2844, 0.0115, 0.581, 0.367], [0.6942, 0.0795, 0.8073, 0.5766]], [[0.4894, 0.7276, 0.1069, 0.6587], [0.7081, 0.8581, 0.7882, 0.8049]], [[0.7336, 0.393, 0.8457, 0.8759], [1.0121, 0.8856, 0.9153, 0.3548]], [[0.6504, 0.0193, 0.3425, 0.6421], [0.9152, 0.5291, 0.5246, 0.6806]], [[0.6436, 0.3253, 0.7006, 0.1278], [1.0321, 0.2889, 0.4705, 0.6088]], [[-0.2229, -0.9875, -0.3056, -0.3463], [0.1529, 0.4131, 0.121, 0.0716]]]]