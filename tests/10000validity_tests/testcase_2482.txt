import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot53890 = tf.keras.layers.Input(shape=([3]))
in1Dot53890 = tf.keras.layers.Input(shape=([3]))
in0Con62220 = tf.keras.layers.Input(shape=([5]))
in0Sub43050 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub43050 = tf.keras.layers.Input(shape=([2, 3]))
in0PRe10463 = tf.keras.layers.Input(shape=([1, 2]))
in0Dot93256 = tf.keras.layers.Input(shape=([2]))
in1Dot93256 = tf.keras.layers.Input(shape=([2]))
in0Con68451 = tf.keras.layers.Input(shape=([1]))
in0Con87167 = tf.keras.layers.Input(shape=([4]))
in0Con55950 = tf.keras.layers.Input(shape=([6, 3]))
in0Dep74018 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Max75157 = tf.keras.layers.Input(shape=([1, 2, 2]))

Dot53890 = keras.layers.Dot(axes=(1, 1), name = 'Dot53890', )([in0Dot53890,in1Dot53890])
Con62220 = keras.layers.Concatenate(axis=1, name = 'Con62220', )([Dot53890,in0Con62220])
Sub43050 = keras.layers.Subtract(name = 'Sub43050', )([in0Sub43050,in1Sub43050])
Fla53464 = keras.layers.Flatten(name = 'Fla53464', )(Sub43050)
PRe10463 = keras.layers.PReLU(name = 'PRe10463', input_shape=(1, 2))(in0PRe10463)
Fla6330 = keras.layers.Flatten(name = 'Fla6330', )(PRe10463)
Dot93256 = keras.layers.Dot(axes=(1, 1), name = 'Dot93256', )([in0Dot93256,in1Dot93256])
Con68451 = keras.layers.Concatenate(axis=1, name = 'Con68451', )([Dot93256,in0Con68451])
Sub43343 = keras.layers.Subtract(name = 'Sub43343', )([Fla6330,Con68451])
Con87167 = keras.layers.Concatenate(axis=1, name = 'Con87167', )([Sub43343,in0Con87167])
Sub49506 = keras.layers.Subtract(name = 'Sub49506', )([Fla53464,Con87167])
Sub45053 = keras.layers.Subtract(name = 'Sub45053', )([Con62220,Sub49506])
Res37483 = keras.layers.Reshape((6, 1), name = 'Res37483', )(Sub45053)
Con55950 = keras.layers.Concatenate(axis=2, name = 'Con55950', )([Res37483,in0Con55950])
Dep74018 = keras.layers.DepthwiseConv2D((2, 2),strides=(1, 1), padding='valid', name = 'Dep74018', )(in0Dep74018)
Res11916 = keras.layers.Reshape((1, 1), name = 'Res11916', )(Dep74018)
Max75157 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(5, 1), padding='same', name = 'Max75157', )(in0Max75157)
Res44939 = keras.layers.Reshape((1, 4), name = 'Res44939', )(Max75157)
Dot88776 = keras.layers.Dot(axes=(1, 1), name = 'Dot88776', )([Res11916,Res44939])
Lay82502 = keras.layers.LayerNormalization(axis=1, epsilon=2.51840337177092, name = 'Lay82502', )(Dot88776)
Zer50696 = keras.layers.ZeroPadding1D(padding=((5, 0)), name = 'Zer50696', )(Lay82502)
Max67963 = keras.layers.Maximum(name = 'Max67963', )([Con55950,Zer50696])
model = tf.keras.models.Model(inputs=[in0Dot53890,in1Dot53890,in0Con62220,in0Sub43050,in1Sub43050,in0PRe10463,in0Dot93256,in1Dot93256,in0Con68451,in0Con87167,in0Con55950,in0Dep74018,in0Max75157], outputs=Max67963)
w = model.get_layer('PRe10463').get_weights() 
w[0] = np.array([[0.2038, 0.851]])
model.get_layer('PRe10463').set_weights(w) 
w = model.get_layer('Dep74018').get_weights() 
w[0] = np.array([[[[0.3255]], [[0.2163]]], [[[0.187]], [[0.6151]]]])
w[1] = np.array([0])
model.get_layer('Dep74018').set_weights(w) 
in0Dot53890 = tf.constant([[0.578, 0.6579, 0.7755]])
in1Dot53890 = tf.constant([[0.612, 0.7047, 0.0821]])
in0Con62220 = tf.constant([[0.0277, 0.5779, 0.3366, 0.058, 0.2041]])
in0Sub43050 = tf.constant([[[0.4043, 0.4365, 0.5504], [0.0156, 0.6015, 0.8434]]])
in1Sub43050 = tf.constant([[[0.048, 0.2744, 0.8829], [0.2543, 0.7698, 0.4646]]])
in0PRe10463 = tf.constant([[[0.2596, 0.1555]]])
in0Dot93256 = tf.constant([[0.6389, 0.554]])
in1Dot93256 = tf.constant([[0.7633, 0.4214]])
in0Con68451 = tf.constant([[0.4028]])
in0Con87167 = tf.constant([[0.5014, 0.7869, 0.2487, 0.3131]])
in0Con55950 = tf.constant([[[0.1916, 0.9674, 0.6026], [0.6727, 0.5285, 0.6301], [0.7962, 0.4613, 0.745], [0.9586, 0.653, 0.0016], [0.0871, 0.2726, 0.6774], [0.489, 0.0369, 0.0311]]])
in0Dep74018 = tf.constant([[[[0.29], [0.3956]], [[0.6585], [0.8956]]]])
in0Max75157 = tf.constant([[[[1.6387, 1.5168], [1.2619, 1.3721]]]])
print (np.array2string(model.predict([in0Dot53890,in1Dot53890,in0Con62220,in0Sub43050,in1Sub43050,in0PRe10463,in0Dot93256,in1Dot93256,in0Con68451,in0Con87167,in0Con55950,in0Dep74018,in0Max75157],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max67963.png')

LDot53890 = dot_layer([[0.578, 0.6579, 0.7755]], [[0.612, 0.7047, 0.0821]], 1, 1, Dot53890), 
LCon62220 = concatenate_layer([Dot53890,[[0.0277, 0.5779, 0.3366, 0.058, 0.2041]]], 1, Con62220), 
LSub43050 = subtract_layer([[[0.4043, 0.4365, 0.5504], [0.0156, 0.6015, 0.8434]]], [[[0.048, 0.2744, 0.8829], [0.2543, 0.7698, 0.4646]]], Sub43050), 
LFla53464 = flatten_layer(Sub43050, Fla53464), 
LPRe10463 = prelu_layer([[[0.2596, 0.1555]]], [[0.2038, 0.851]], PRe10463), 
LFla6330 = flatten_layer(PRe10463, Fla6330), 
LDot93256 = dot_layer([[0.6389, 0.554]], [[0.7633, 0.4214]], 1, 1, Dot93256), 
LCon68451 = concatenate_layer([Dot93256,[[0.4028]]], 1, Con68451), 
LSub43343 = subtract_layer(Fla6330,Con68451, Sub43343), 
LCon87167 = concatenate_layer([Sub43343,[[0.5014, 0.7869, 0.2487, 0.3131]]], 1, Con87167), 
LSub49506 = subtract_layer(Fla53464,Con87167, Sub49506), 
LSub45053 = subtract_layer(Con62220,Sub49506, Sub45053), 
LRes37483 = reshape_layer(Sub45053, [6, 1], Res37483), 
LCon55950 = concatenate_layer([Res37483,[[[0.1916, 0.9674, 0.6026], [0.6727, 0.5285, 0.6301], [0.7962, 0.4613, 0.745], [0.9586, 0.653, 0.0016], [0.0871, 0.2726, 0.6774], [0.489, 0.0369, 0.0311]]]], 2, Con55950), 
LDep74018 = depthwise_conv2D_layer([[[[0.29], [0.3956]], [[0.6585], [0.8956]]]], 2, 2,[[[[0.3255]], [[0.2163]]], [[[0.187]], [[0.6151]]]],[0], 1, 1, false, Dep74018), 
LRes11916 = reshape_layer(Dep74018, [1, 1], Res11916), 
LMax75157 = max_pool2D_layer([[[[1.6387, 1.5168], [1.2619, 1.3721]]]], 1, 1, 5, 1, true, Max75157), 
LRes44939 = reshape_layer(Max75157, [1, 4], Res44939), 
LDot88776 = dot_layer(Res11916,Res44939, 1, 1, Dot88776), 
LLay82502 = layer_normalization_layer(Dot88776, 1, 2.51840337177092, Lay82502), 
LZer50696 = zero_padding1D_layer(Lay82502, 5, 0, Zer50696), 
LMax67963 = maximum_layer([Con55950,Zer50696], Max67963), 
exec_layers([LDot53890,LCon62220,LSub43050,LFla53464,LPRe10463,LFla6330,LDot93256,LCon68451,LSub43343,LCon87167,LSub49506,LSub45053,LRes37483,LCon55950,LDep74018,LRes11916,LMax75157,LRes44939,LDot88776,LLay82502,LZer50696,LMax67963],["Dot53890","Con62220","Sub43050","Fla53464","PRe10463","Fla6330","Dot93256","Con68451","Sub43343","Con87167","Sub49506","Sub45053","Res37483","Con55950","Dep74018","Res11916","Max75157","Res44939","Dot88776","Lay82502","Zer50696","Max67963"],Max67963,"Max67963")

Actual (Unparsed): [[[0.0631987, 0.1916000, 0.9674000, 0.6026000], [0.0000000, 0.6727000, 0.5285000, 0.6301000], [1.4118000, 0.7962000, 0.4613000, 0.7450000], [1.3622000, 0.9586000, 0.6530000, 0.0016000], [0.4750000, 0.0871000, 0.2726000, 0.6774000], [0.1384000, 0.4890000, 0.0369000, 0.0311000]]]

Expected (Unparsed): [[[0.06319870999999999,0.1916,0.9674,0.6026],[0,0.6727,0.5285,0.6301],[1.4118,0.7962,0.4613,0.745],[1.3622,0.9586,0.653,0.0016],[0.47500000000000003,0.0871,0.2726,0.6774],[0.13839999999999997,0.489,0.0369,0.0311]]]

Actual:   [[[0.0632, 0.1916, 0.9674, 0.6026], [0, 0.6727, 0.5285, 0.6301], [1.4118, 0.7962, 0.4613, 0.745], [1.3622, 0.9586, 0.653, 0.0016], [0.475, 0.0871, 0.2726, 0.6774], [0.1384, 0.489, 0.0369, 0.0311]]]

Expected: [[[0.0632, 0.1916, 0.9674, 0.6026], [0, 0.6727, 0.5285, 0.6301], [1.4118, 0.7962, 0.4613, 0.745], [1.3622, 0.9586, 0.653, 0.0016], [0.4751, 0.0871, 0.2726, 0.6774], [0.1384, 0.489, 0.0369, 0.0311]]]