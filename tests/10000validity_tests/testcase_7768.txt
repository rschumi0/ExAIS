import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sim72879 = tf.keras.layers.Input(shape=([3, 2]))
in0Loc69368 = tf.keras.layers.Input(shape=([2, 2, 2]))

Sim72879 = keras.layers.SimpleRNN(1,name = 'Sim72879', )(in0Sim72879)
Res30975 = keras.layers.Reshape((1, 1), name = 'Res30975', )(Sim72879)
Res10369 = keras.layers.Reshape((1, 1, 1), name = 'Res10369', )(Res30975)
Res11648 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res11648', )(Res10369)
Zer69664 = keras.layers.ZeroPadding3D(padding=((2, 0), (3, 0), (5, 0)), name = 'Zer69664', )(Res11648)
Loc69368 = keras.layers.LocallyConnected2D(4, (2, 1),strides=(1, 1), name = 'Loc69368', )(in0Loc69368)
Res95523 = keras.layers.Reshape((1, 2, 4, 1), name = 'Res95523', )(Loc69368)
Zer93459 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer93459', )(Res95523)
Sub17139 = keras.layers.Subtract(name = 'Sub17139', )([Zer69664,Zer93459])
model = tf.keras.models.Model(inputs=[in0Sim72879,in0Loc69368], outputs=Sub17139)
w = model.get_layer('Sim72879').get_weights() 
w[0] = np.array([[4], [4]])
w[1] = np.array([[2]])
w[2] = np.array([10])
model.get_layer('Sim72879').set_weights(w) 
w = model.get_layer('Loc69368').get_weights() 
w[0] = np.array([[[0.1468, 0.9783, 0.0452, 0.9635], [0.1898, 0.7122, 0.7352, 0.0685], [0.7367, 0.9447, 0.4356, 0.5162], [0.9141, 0.8833, 0.2993, 0.2591]], [[0.931, 0.948, 0.149, 0.4485], [0.1883, 0.7099, 0.11, 0.6812], [0.3536, 0.8526, 0.9174, 0.0786], [0.0046, 0.9086, 0.2837, 0.2816]]])
w[1] = np.array([[[0, 0, 0, 0], [0, 0, 0, 0]]])
model.get_layer('Loc69368').set_weights(w) 
in0Sim72879 = tf.constant([[[7, 7], [9, 3], [3, 4]]])
in0Loc69368 = tf.constant([[[[0.8526, 0.0114], [0.2013, 0.4904]], [[0.3986, 0.3491], [0.771, 0.2476]]]])
print (np.array2string(model.predict([in0Sim72879,in0Loc69368],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub17139.png')

LSim72879 = simple_rnn_layer([[[7, 7], [9, 3], [3, 4]]],[[4], [4]],[[2]],[10], Sim72879), 
LRes30975 = reshape_layer(Sim72879, [1, 1], Res30975), 
LRes10369 = reshape_layer(Res30975, [1, 1, 1], Res10369), 
LRes11648 = reshape_layer(Res10369, [1, 1, 1, 1], Res11648), 
LZer69664 = zero_padding3D_layer(Res11648, 2, 0, 3, 0, 5, 0, Zer69664), 
LLoc69368 = locally_connected2D_layer([[[[0.8526, 0.0114], [0.2013, 0.4904]], [[0.3986, 0.3491], [0.771, 0.2476]]]], 2, 1,[[[0.1468, 0.9783, 0.0452, 0.9635], [0.1898, 0.7122, 0.7352, 0.0685], [0.7367, 0.9447, 0.4356, 0.5162], [0.9141, 0.8833, 0.2993, 0.2591]], [[0.931, 0.948, 0.149, 0.4485], [0.1883, 0.7099, 0.11, 0.6812], [0.3536, 0.8526, 0.9174, 0.0786], [0.0046, 0.9086, 0.2837, 0.2816]]],[[[0, 0, 0, 0], [0, 0, 0, 0]]], 1, 1, Loc69368), 
LRes95523 = reshape_layer(Loc69368, [1, 2, 4, 1], Res95523), 
LZer93459 = zero_padding3D_layer(Res95523, 1, 1, 1, 1, 1, 1, Zer93459), 
LSub17139 = subtract_layer(Zer69664,Zer93459, Sub17139), 
exec_layers([LSim72879,LRes30975,LRes10369,LRes11648,LZer69664,LLoc69368,LRes95523,LZer93459,LSub17139],["Sim72879","Res30975","Res10369","Res11648","Zer69664","Loc69368","Res95523","Zer93459","Sub17139"],Sub17139,"Sub17139")

Actual (Unparsed): [[[[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [-0.7400863], [-1.5271351], [-0.3250346], [-1.1184701], [0.0000000]], [[0.0000000], [-0.5535172], [-1.4212913], [-0.8614972], [-0.5546683], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [1.0000000]]]]]

Expected (Unparsed): [[[[[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0]]],[[[0],[0],[0],[0],[0],[0]],[[0],[-0.74008633],[-1.52713511],[-0.32503459],[-1.1184701300000002],[0]],[[0],[-0.55351718],[-1.4212913200000001],[-0.8614972200000001],[-0.5546682900000001],[0]],[[0],[0],[0],[0],[0],[0]]],[[[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[0]],[[0],[0],[0],[0],[0],[1.0]]]]]

Actual:   [[[[[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]]], [[[0], [0], [0], [0], [0], [0]], [[0], [-0.74], [-1.5271], [-0.325], [-1.1184], [0]], [[0], [-0.5535], [-1.4212], [-0.8614], [-0.5546], [0]], [[0], [0], [0], [0], [0], [0]]], [[[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [1]]]]]

Expected: [[[[[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]]], [[[0], [0], [0], [0], [0], [0]], [[0], [-0.74], [-1.5271], [-0.325], [-1.1184], [0]], [[0], [-0.5535], [-1.4212], [-0.8614], [-0.5546], [0]], [[0], [0], [0], [0], [0], [0]]], [[[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [0]], [[0], [0], [0], [0], [0], [1]]]]]