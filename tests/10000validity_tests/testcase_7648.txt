import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub65113 = tf.keras.layers.Input(shape=([3, 3]))
in1Sub65113 = tf.keras.layers.Input(shape=([3, 3]))
in0ELU63475 = tf.keras.layers.Input(shape=([1, 1]))
in0Con7169 = tf.keras.layers.Input(shape=([3, 3, 2, 1]))
in0Sub5531 = tf.keras.layers.Input(shape=([3, 3, 2, 2]))
in1Sub5531 = tf.keras.layers.Input(shape=([3, 3, 2, 2]))
in0Up_60978 = tf.keras.layers.Input(shape=([3, 3]))

Sub65113 = keras.layers.Subtract(name = 'Sub65113', )([in0Sub65113,in1Sub65113])
Lay2629 = keras.layers.LayerNormalization(axis=2, epsilon=1.450415795362854, name = 'Lay2629', )(Sub65113)
Zer8489 = keras.layers.ZeroPadding1D(padding=((9, 0)), name = 'Zer8489', )(Lay2629)
ELU63475 = keras.layers.ELU(alpha=-8.281554950027735, name = 'ELU63475', input_shape=(1, 1))(in0ELU63475)
Res85152 = keras.layers.Reshape((1, 1, 1), name = 'Res85152', )(ELU63475)
Res31322 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res31322', )(Res85152)
Zer96542 = keras.layers.ZeroPadding3D(padding=((2, 0), (2, 0), (1, 0)), name = 'Zer96542', )(Res31322)
Con7169 = keras.layers.Concatenate(axis=4, name = 'Con7169', )([Zer96542,in0Con7169])
Sub5531 = keras.layers.Subtract(name = 'Sub5531', )([in0Sub5531,in1Sub5531])
Mul76703 = keras.layers.Multiply(name = 'Mul76703', )([Con7169,Sub5531])
Res76948 = keras.layers.Reshape((3, 3, 4), name = 'Res76948', )(Mul76703)
Res78873 = keras.layers.Reshape((3, 12), name = 'Res78873', )(Res76948)
Up_60978 = keras.layers.UpSampling1D(size=(1), name = 'Up_60978', )(in0Up_60978)
Dot73638 = keras.layers.Dot(axes=(1, 1), name = 'Dot73638', )([Res78873,Up_60978])
Max76505 = keras.layers.Maximum(name = 'Max76505', )([Zer8489,Dot73638])
model = tf.keras.models.Model(inputs=[in0Sub65113,in1Sub65113,in0ELU63475,in0Con7169,in0Sub5531,in1Sub5531,in0Up_60978], outputs=Max76505)
in0Sub65113 = tf.constant([[[0.0623, 0.3635, 0.5414], [0.4922, 0.7117, 0.5922], [0.3445, 0.9792, 0.5035]]])
in1Sub65113 = tf.constant([[[0.6966, 0.8585, 0.3628], [0.2013, 0.1285, 0.5668], [0.4079, 0.2984, 0.293]]])
in0ELU63475 = tf.constant([[[0.2161]]])
in0Con7169 = tf.constant([[[[[0.9444], [0.0742]], [[0.0874], [0.8277]], [[0.4888], [0.7876]]], [[[0.8517], [0.8467]], [[0.0193], [0.4965]], [[0.9739], [0.3797]]], [[[0.1772], [0.2023]], [[0.225], [0.8361]], [[0.8348], [0.3895]]]]])
in0Sub5531 = tf.constant([[[[[0.7159, 0.3686], [0.5006, 0.8655]], [[0.1395, 0.0168], [0.0864, 0.5476]], [[0.4484, 0.44], [0.4788, 0.9799]]], [[[0.2427, 0.6905], [0.2144, 0.9263]], [[0.5264, 0.2247], [0.7684, 0.8734]], [[0.9304, 0.2135], [0.5978, 0.6637]]], [[[0.3054, 0.3941], [0.9802, 0.6038]], [[0.2925, 0.9509], [0.0706, 0.3547]], [[0.5239, 0.0256], [0.0973, 0.6027]]]]])
in1Sub5531 = tf.constant([[[[[0.3056, 0.9801], [0.7685, 0.1072]], [[0.9908, 0.4603], [0.7748, 0.2281]], [[0.7651, 0.6412], [0.734, 0.4455]]], [[[0.2348, 0.7774], [0.0514, 0.7023]], [[0.0322, 0.3219], [0.9429, 0.6243]], [[0.6364, 0.4342], [0.3059, 0.8002]]], [[[0.7429, 0.6528], [0.2116, 0.3437]], [[0.8118, 0.8729], [0.5412, 0.899]], [[0.8718, 0.5397], [0.6904, 0.1007]]]]])
in0Up_60978 = tf.constant([[[1.2676, 1.1464, 1.3269], [1.2548, 1.7955, 1.7066], [1.901, 1.6678, 1.597]]])
print (np.array2string(model.predict([in0Sub65113,in1Sub65113,in0ELU63475,in0Con7169,in0Sub5531,in1Sub5531,in0Up_60978],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max76505.png')

LSub65113 = subtract_layer([[[0.0623, 0.3635, 0.5414], [0.4922, 0.7117, 0.5922], [0.3445, 0.9792, 0.5035]]], [[[0.6966, 0.8585, 0.3628], [0.2013, 0.1285, 0.5668], [0.4079, 0.2984, 0.293]]], Sub65113), 
LLay2629 = layer_normalization_layer(Sub65113, 2, 1.450415795362854, Lay2629), 
LZer8489 = zero_padding1D_layer(Lay2629, 9, 0, Zer8489), 
LELU63475 = elu_layer([[[0.2161]]], -8.281554950027735, ELU63475), 
LRes85152 = reshape_layer(ELU63475, [1, 1, 1], Res85152), 
LRes31322 = reshape_layer(Res85152, [1, 1, 1, 1], Res31322), 
LZer96542 = zero_padding3D_layer(Res31322, 2, 0, 2, 0, 1, 0, Zer96542), 
LCon7169 = concatenate_layer([Zer96542,[[[[[0.9444], [0.0742]], [[0.0874], [0.8277]], [[0.4888], [0.7876]]], [[[0.8517], [0.8467]], [[0.0193], [0.4965]], [[0.9739], [0.3797]]], [[[0.1772], [0.2023]], [[0.225], [0.8361]], [[0.8348], [0.3895]]]]]], 4, Con7169), 
LSub5531 = subtract_layer([[[[[0.7159, 0.3686], [0.5006, 0.8655]], [[0.1395, 0.0168], [0.0864, 0.5476]], [[0.4484, 0.44], [0.4788, 0.9799]]], [[[0.2427, 0.6905], [0.2144, 0.9263]], [[0.5264, 0.2247], [0.7684, 0.8734]], [[0.9304, 0.2135], [0.5978, 0.6637]]], [[[0.3054, 0.3941], [0.9802, 0.6038]], [[0.2925, 0.9509], [0.0706, 0.3547]], [[0.5239, 0.0256], [0.0973, 0.6027]]]]], [[[[[0.3056, 0.9801], [0.7685, 0.1072]], [[0.9908, 0.4603], [0.7748, 0.2281]], [[0.7651, 0.6412], [0.734, 0.4455]]], [[[0.2348, 0.7774], [0.0514, 0.7023]], [[0.0322, 0.3219], [0.9429, 0.6243]], [[0.6364, 0.4342], [0.3059, 0.8002]]], [[[0.7429, 0.6528], [0.2116, 0.3437]], [[0.8118, 0.8729], [0.5412, 0.899]], [[0.8718, 0.5397], [0.6904, 0.1007]]]]], Sub5531), 
LMul76703 = multiply_layer([Con7169,Sub5531], Mul76703), 
LRes76948 = reshape_layer(Mul76703, [3, 3, 4], Res76948), 
LRes78873 = reshape_layer(Res76948, [3, 12], Res78873), 
LUp_60978 = up_sampling1D_layer([[[1.2676, 1.1464, 1.3269], [1.2548, 1.7955, 1.7066], [1.901, 1.6678, 1.597]]], 1, Up_60978), 
LDot73638 = dot_layer(Res78873,Up_60978, 1, 1, Dot73638), 
LMax76505 = maximum_layer([Zer8489,Dot73638], Max76505), 
exec_layers([LSub65113,LLay2629,LZer8489,LELU63475,LRes85152,LRes31322,LZer96542,LCon7169,LSub5531,LMul76703,LRes76948,LRes78873,LUp_60978,LDot73638,LMax76505],["Sub65113","Lay2629","Zer8489","ELU63475","Res85152","Res31322","Zer96542","Con7169","Sub5531","Mul76703","Res76948","Res78873","Up_60978","Dot73638","Max76505"],Max76505,"Max76505")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.4093362, 0.4927958, 0.4823656], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [-0.2527973, -0.1418500, 0.3946473], [-0.0072884, 0.2311898, -0.2046858], [0.8401901, 0.7155564, 0.7822919]]]

Expected (Unparsed): [[[0,0,0],[0,0,0],[0,0,0],[0.409336231206,0.492795832298,0.482365604224],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[-0.2527972420258921,-0.14184999623444045,0.39464723826033254],[-0.007288420119121529,0.23118977400243426,-0.20468574927],[0.840190061604,0.715556446541,0.7822918618059999]]]

Actual:   [[[0, 0, 0], [0, 0, 0], [0, 0, 0], [0.4094, 0.4928, 0.4824], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [-0.2527, -0.1418, 0.3947], [-0.0072, 0.2312, -0.2046], [0.8402, 0.7156, 0.7823]]]

Expected: [[[0, 0, 0], [0, 0, 0], [0, 0, 0], [0.4094, 0.4928, 0.4824], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [-0.2527, -0.1418, 0.3947], [-0.0072, 0.2312, -0.2046], [0.8402, 0.7156, 0.7823]]]