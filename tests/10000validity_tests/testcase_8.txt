import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min95074 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Min95074 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Dot94663 = tf.keras.layers.Input(shape=([2]))
in1Dot94663 = tf.keras.layers.Input(shape=([2]))

Min95074 = keras.layers.Minimum(name = 'Min95074', )([in0Min95074,in1Min95074])
Res58561 = keras.layers.Reshape((2, 2, 2), name = 'Res58561', )(Min95074)
Res96335 = keras.layers.Reshape((2, 4), name = 'Res96335', )(Res58561)
Glo3634 = keras.layers.GlobalAveragePooling1D(name = 'Glo3634', )(Res96335)
Res79424 = keras.layers.Reshape((4, 1), name = 'Res79424', )(Glo3634)
Max33402 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max33402', )(Res79424)
Res39656 = keras.layers.Reshape((4, 1, 1), name = 'Res39656', )(Max33402)
Dot94663 = keras.layers.Dot(axes=(1, 1), name = 'Dot94663', )([in0Dot94663,in1Dot94663])
Res91650 = keras.layers.Reshape((1, 1), name = 'Res91650', )(Dot94663)
Res60901 = keras.layers.Reshape((1, 1, 1), name = 'Res60901', )(Res91650)
Max38983 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max38983', )(Res60901)
Zer71140 = keras.layers.ZeroPadding2D(padding=((3, 0), (0, 0)), name = 'Zer71140', )(Max38983)
Ave32119 = keras.layers.Average(name = 'Ave32119', )([Res39656,Zer71140])
model = tf.keras.models.Model(inputs=[in0Min95074,in1Min95074,in0Dot94663,in1Dot94663], outputs=Ave32119)
in0Min95074 = tf.constant([[[[[0.057], [0.6357]], [[0.2147], [0.8495]]], [[[0.1888], [0.475]], [[0.3005], [0.8868]]]]])
in1Min95074 = tf.constant([[[[[0.3401], [0.3672]], [[0.3651], [0.5174]]], [[[0.0704], [0.3531]], [[0.5105], [0.2082]]]]])
in0Dot94663 = tf.constant([[0.4019, 0.6463]])
in1Dot94663 = tf.constant([[0.1348, 0.2795]])
print (np.array2string(model.predict([in0Min95074,in1Min95074,in0Dot94663,in1Dot94663],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave32119.png')

LMin95074 = minimum_layer([[[[[[0.057], [0.6357]], [[0.2147], [0.8495]]], [[[0.1888], [0.475]], [[0.3005], [0.8868]]]]], [[[[[0.3401], [0.3672]], [[0.3651], [0.5174]]], [[[0.0704], [0.3531]], [[0.5105], [0.2082]]]]]], Min95074), 
LRes58561 = reshape_layer(Min95074, [2, 2, 2], Res58561), 
LRes96335 = reshape_layer(Res58561, [2, 4], Res96335), 
LGlo3634 = global_average_pooling1D_layer(Res96335, Glo3634), 
LRes79424 = reshape_layer(Glo3634, [4, 1], Res79424), 
LMax33402 = max_pool1D_layer(Res79424, 1, Max33402), 
LRes39656 = reshape_layer(Max33402, [4, 1, 1], Res39656), 
LDot94663 = dot_layer([[0.4019, 0.6463]], [[0.1348, 0.2795]], 1, 1, Dot94663), 
LRes91650 = reshape_layer(Dot94663, [1, 1], Res91650), 
LRes60901 = reshape_layer(Res91650, [1, 1, 1], Res60901), 
LMax38983 = max_pool2D_layer(Res60901, 1, 1, Max38983), 
LZer71140 = zero_padding2D_layer(Max38983, 3, 0, 0, 0, Zer71140), 
LAve32119 = average_layer([Res39656,Zer71140], Ave32119), 
exec_layers([LMin95074,LRes58561,LRes96335,LGlo3634,LRes79424,LMax33402,LRes39656,LDot94663,LRes91650,LRes60901,LMax38983,LZer71140,LAve32119],["Min95074","Res58561","Res96335","Glo3634","Res79424","Max33402","Res39656","Dot94663","Res91650","Res60901","Max38983","Zer71140","Ave32119"],Ave32119,"Ave32119")

Actual (Unparsed): [[[[0.0318500]], [[0.1800750]], [[0.1288000]], [[0.2988085]]]]

Expected (Unparsed): [[[[0.03185]],[[0.180075]],[[0.1288]],[[0.298808485]]]]

Actual:   [[[[0.0319]], [[0.1801]], [[0.1288]], [[0.2989]]]]

Expected: [[[[0.0319]], [[0.1801]], [[0.1288]], [[0.2989]]]]