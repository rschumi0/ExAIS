import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave67505 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave67505 = tf.keras.layers.Input(shape=([2, 1]))
in0Con67221 = tf.keras.layers.Input(shape=([2, 3, 7, 1]))
in0Loc82327 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con91976 = tf.keras.layers.Input(shape=([1, 2, 4, 1]))
in0Mul71032 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Mul71032 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))

Ave67505 = keras.layers.Average(name = 'Ave67505', )([in0Ave67505,in1Ave67505])
Res60382 = keras.layers.Reshape((2, 1, 1), name = 'Res60382', )(Ave67505)
Res80720 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res80720', )(Res60382)
Zer15221 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (6, 0)), name = 'Zer15221', )(Res80720)
Con67221 = keras.layers.Concatenate(axis=4, name = 'Con67221', )([Zer15221,in0Con67221])
Loc82327 = keras.layers.LocallyConnected2D(4, (2, 1),strides=(1, 1), name = 'Loc82327', )(in0Loc82327)
Res16392 = keras.layers.Reshape((1, 2, 4, 1), name = 'Res16392', )(Loc82327)
Con91976 = keras.layers.Concatenate(axis=4, name = 'Con91976', )([Res16392,in0Con91976])
Mul71032 = keras.layers.Multiply(name = 'Mul71032', )([in0Mul71032,in1Mul71032])
Zer12738 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (3, 0)), name = 'Zer12738', )(Mul71032)
Max84450 = keras.layers.Maximum(name = 'Max84450', )([Con91976,Zer12738])
ReL37969 = keras.layers.ReLU(max_value=4.922538795286262, negative_slope=6.381684878085631, threshold=3.922109307463415, name = 'ReL37969', )(Max84450)
Zer98304 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (3, 0)), name = 'Zer98304', )(ReL37969)
Add46790 = keras.layers.Add(name = 'Add46790', )([Con67221,Zer98304])
model = tf.keras.models.Model(inputs=[in0Ave67505,in1Ave67505,in0Con67221,in0Loc82327,in0Con91976,in0Mul71032,in1Mul71032], outputs=Add46790)
w = model.get_layer('Loc82327').get_weights() 
w[0] = np.array([[[0.7336, 0.0142, 0.958, 0.0438], [0.0404, 0.3151, 0.256, 0.6074]], [[0.2618, 0.5765, 0.667, 0.2109], [0.2489, 0.8698, 0.1291, 0.1387]]])
w[1] = np.array([[[0, 0, 0, 0], [0, 0, 0, 0]]])
model.get_layer('Loc82327').set_weights(w) 
in0Ave67505 = tf.constant([[[0.3115], [0.7835]]])
in1Ave67505 = tf.constant([[[0.6848], [0.8697]]])
in0Con67221 = tf.constant([[[[[0.5494], [0.9597], [0.5164], [0.4552], [0.1883], [0.8382], [0.8076]], [[0.3987], [0.0073], [0.2347], [0.1805], [0.8372], [0.0542], [0.7696]], [[0.285], [0.4079], [0.3292], [0.5022], [0.8164], [0.0441], [0.6385]]], [[[0.9711], [0.6257], [0.3673], [0.1408], [0.3284], [0.0052], [0.7062]], [[0.6546], [0.7561], [0.2903], [0.8188], [0.481], [0.7308], [0.3076]], [[0.6016], [0.8377], [0.9893], [0.7436], [0.6844], [0.994], [0.2411]]]]])
in0Loc82327 = tf.constant([[[[0.8458], [0.8427]], [[0.0038], [0.2748]]]])
in0Con91976 = tf.constant([[[[[0.4216], [0.881], [0.605], [0.0894]], [[0.6872], [0.4749], [0.5213], [0.09]]]]])
in0Mul71032 = tf.constant([[[[[0.4477, 0.2565]]]]])
in1Mul71032 = tf.constant([[[[[0.9314, 0.0977]]]]])
print (np.array2string(model.predict([in0Ave67505,in1Ave67505,in0Con67221,in0Loc82327,in0Con91976,in0Mul71032,in1Mul71032],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add46790.png')

LAve67505 = average_layer([[[[0.3115], [0.7835]]], [[[0.6848], [0.8697]]]], Ave67505), 
LRes60382 = reshape_layer(Ave67505, [2, 1, 1], Res60382), 
LRes80720 = reshape_layer(Res60382, [2, 1, 1, 1], Res80720), 
LZer15221 = zero_padding3D_layer(Res80720, 0, 0, 2, 0, 6, 0, Zer15221), 
LCon67221 = concatenate_layer([Zer15221,[[[[[0.5494], [0.9597], [0.5164], [0.4552], [0.1883], [0.8382], [0.8076]], [[0.3987], [0.0073], [0.2347], [0.1805], [0.8372], [0.0542], [0.7696]], [[0.285], [0.4079], [0.3292], [0.5022], [0.8164], [0.0441], [0.6385]]], [[[0.9711], [0.6257], [0.3673], [0.1408], [0.3284], [0.0052], [0.7062]], [[0.6546], [0.7561], [0.2903], [0.8188], [0.481], [0.7308], [0.3076]], [[0.6016], [0.8377], [0.9893], [0.7436], [0.6844], [0.994], [0.2411]]]]]], 4, Con67221), 
LLoc82327 = locally_connected2D_layer([[[[0.8458], [0.8427]], [[0.0038], [0.2748]]]], 2, 1,[[[0.7336, 0.0142, 0.958, 0.0438], [0.0404, 0.3151, 0.256, 0.6074]], [[0.2618, 0.5765, 0.667, 0.2109], [0.2489, 0.8698, 0.1291, 0.1387]]],[[[0, 0, 0, 0], [0, 0, 0, 0]]], 1, 1, Loc82327), 
LRes16392 = reshape_layer(Loc82327, [1, 2, 4, 1], Res16392), 
LCon91976 = concatenate_layer([Res16392,[[[[[0.4216], [0.881], [0.605], [0.0894]], [[0.6872], [0.4749], [0.5213], [0.09]]]]]], 4, Con91976), 
LMul71032 = multiply_layer([[[[[[0.4477, 0.2565]]]]], [[[[[0.9314, 0.0977]]]]]], Mul71032), 
LZer12738 = zero_padding3D_layer(Mul71032, 0, 0, 1, 0, 3, 0, Zer12738), 
LMax84450 = maximum_layer([Con91976,Zer12738], Max84450), 
LReL37969 = relu_layer(Max84450, 4.922538795286262, 6.381684878085631, 3.922109307463415, ReL37969), 
LZer98304 = zero_padding3D_layer(ReL37969, 1, 0, 1, 0, 3, 0, Zer98304), 
LAdd46790 = add_layer([Con67221,Zer98304], Add46790), 
exec_layers([LAve67505,LRes60382,LRes80720,LZer15221,LCon67221,LLoc82327,LRes16392,LCon91976,LMul71032,LZer12738,LMax84450,LReL37969,LZer98304,LAdd46790],["Ave67505","Res60382","Res80720","Zer15221","Con67221","Loc82327","Res16392","Con91976","Mul71032","Zer12738","Max84450","ReL37969","Zer98304","Add46790"],Add46790,"Add46790")

Actual (Unparsed): [[[[[0.0000000, 0.5494000], [0.0000000, 0.9597000], [0.0000000, 0.5164000], [0.0000000, 0.4552000], [0.0000000, 0.1883000], [0.0000000, 0.8382000], [0.0000000, 0.8076000]], [[0.0000000, 0.3987000], [0.0000000, 0.0073000], [0.0000000, 0.2347000], [0.0000000, 0.1805000], [0.0000000, 0.8372000], [0.0000000, 0.0542000], [0.0000000, 0.7696000]], [[0.0000000, 0.2850000], [0.0000000, 0.4079000], [0.0000000, 0.3292000], [0.0000000, 0.5022000], [0.0000000, 0.8164000], [0.0000000, 0.0441000], [0.4981500, 0.6385000]]], [[[0.0000000, 0.9711000], [0.0000000, 0.6257000], [0.0000000, 0.3673000], [0.0000000, 0.1408000], [0.0000000, 0.3284000], [0.0000000, 0.0052000], [0.0000000, 0.7062000]], [[0.0000000, 0.6546000], [0.0000000, 0.7561000], [0.0000000, 0.2903000], [-21.0689853, -21.5203473], [-24.9453780, -18.9264014], [-19.8525290, -20.4379462], [-24.7785198, -24.1515430]], [[0.0000000, 0.6016000], [0.0000000, 0.8377000], [0.0000000, 0.9893000], [-23.1852529, -19.9005717], [-20.4039805, -21.3146034], [-21.2162415, -20.7088932], [-21.5419811, -24.2142140]]]]]

Expected (Unparsed): [[[[[0,0.5494],[0,0.9597],[0,0.5164],[0,0.4552],[0,0.1883],[0,0.8382],[0,0.8076]],[[0,0.3987],[0,0.0073],[0,0.2347],[0,0.1805],[0,0.8372],[0,0.0542],[0,0.7696]],[[0,0.285],[0,0.4079],[0,0.3292],[0,0.5022],[0,0.8164],[0,0.0441],[0.49815,0.6385]]],[[[0,0.9711],[0,0.6257],[0,0.3673],[0,0.1408],[0,0.3284],[0,0.0052],[0,0.7062]],[[0,0.6546],[0,0.7561],[0,0.2903],[-21.06898525570819,-21.52034731303728],[-24.945378023006494,-18.926401280044736],[-19.852528905639115,-20.437946306396373],[-24.778519809876418,-24.151543029537322]],[[0,0.6016],[0,0.8377],[0,0.9893],[-23.185252919536154,-19.900571809417734],[-20.403980570467148,-21.314603509035315],[-21.216241485566734,-20.708893330692142],[-21.541981047665683,-24.214214018610473]]]]]

Actual:   [[[[[0, 0.5494], [0, 0.9597], [0, 0.5164], [0, 0.4552], [0, 0.1883], [0, 0.8382], [0, 0.8076]], [[0, 0.3987], [0, 0.0073], [0, 0.2347], [0, 0.1805], [0, 0.8372], [0, 0.0542], [0, 0.7696]], [[0, 0.285], [0, 0.4079], [0, 0.3292], [0, 0.5022], [0, 0.8164], [0, 0.0441], [0.4982, 0.6385]]], [[[0, 0.9711], [0, 0.6257], [0, 0.3673], [0, 0.1408], [0, 0.3284], [0, 0.0052], [0, 0.7062]], [[0, 0.6546], [0, 0.7561], [0, 0.2903], [-21.0689, -21.5203], [-24.9453, -18.9264], [-19.8525, -20.4379], [-24.7785, -24.1515]], [[0, 0.6016], [0, 0.8377], [0, 0.9893], [-23.1852, -19.9005], [-20.4039, -21.3146], [-21.2162, -20.7088], [-21.5419, -24.2142]]]]]

Expected: [[[[[0, 0.5494], [0, 0.9597], [0, 0.5164], [0, 0.4552], [0, 0.1883], [0, 0.8382], [0, 0.8076]], [[0, 0.3987], [0, 0.0073], [0, 0.2347], [0, 0.1805], [0, 0.8372], [0, 0.0542], [0, 0.7696]], [[0, 0.285], [0, 0.4079], [0, 0.3292], [0, 0.5022], [0, 0.8164], [0, 0.0441], [0.4982, 0.6385]]], [[[0, 0.9711], [0, 0.6257], [0, 0.3673], [0, 0.1408], [0, 0.3284], [0, 0.0052], [0, 0.7062]], [[0, 0.6546], [0, 0.7561], [0, 0.2903], [-21.0689, -21.5203], [-24.9453, -18.9264], [-19.8525, -20.4379], [-24.7785, -24.1515]], [[0, 0.6016], [0, 0.8377], [0, 0.9893], [-23.1852, -19.9005], [-20.4039, -21.3146], [-21.2162, -20.7088], [-21.5419, -24.2142]]]]]