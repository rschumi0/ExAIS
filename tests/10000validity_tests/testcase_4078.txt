import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave20708 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Ave20708 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con17049 = tf.keras.layers.Input(shape=([2, 4, 2, 3]))
in0Dot53299 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot53299 = tf.keras.layers.Input(shape=([3, 3]))
in0Add3807 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Add3807 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con96279 = tf.keras.layers.Input(shape=([1, 2]))
in0Con39769 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con13541 = tf.keras.layers.Input(shape=([2, 28]))

Ave20708 = keras.layers.Average(name = 'Ave20708', )([in0Ave20708,in1Ave20708])
Res66389 = keras.layers.Reshape((2, 2, 2, 1), name = 'Res66389', )(Ave20708)
Zer50963 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer50963', )(Res66389)
Con17049 = keras.layers.Concatenate(axis=4, name = 'Con17049', )([Zer50963,in0Con17049])
Dot53299 = keras.layers.Dot(axes=(1, 2), name = 'Dot53299', )([in0Dot53299,in1Dot53299])
Res99773 = keras.layers.Reshape((3, 3, 1), name = 'Res99773', )(Dot53299)
Res310 = keras.layers.Reshape((3, 3, 1, 1), name = 'Res310', )(Res99773)
Con16410 = keras.layers.Conv3D(4, (3, 2, 1),strides=(4, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con16410', )(Res310)
Zer46441 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (1, 0)), name = 'Zer46441', )(Con16410)
Mul71412 = keras.layers.Multiply(name = 'Mul71412', )([Con17049,Zer46441])
Res78657 = keras.layers.Reshape((2, 4, 8), name = 'Res78657', )(Mul71412)
Res1415 = keras.layers.Reshape((2, 32), name = 'Res1415', )(Res78657)
Add3807 = keras.layers.Add(name = 'Add3807', )([in0Add3807,in1Add3807])
Res68661 = keras.layers.Reshape((1, 2), name = 'Res68661', )(Add3807)
Con96279 = keras.layers.Concatenate(axis=2, name = 'Con96279', )([Res68661,in0Con96279])
Con39769 = keras.layers.Conv2D(2, (1, 1),strides=(5, 1), padding='valid', dilation_rate=(1, 1), name = 'Con39769', )(in0Con39769)
Res13759 = keras.layers.Reshape((1, 4), name = 'Res13759', )(Con39769)
Cro45671 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro45671', )(Res13759)
Max216 = keras.layers.Maximum(name = 'Max216', )([Con96279,Cro45671])
Zer92893 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer92893', )(Max216)
Con13541 = keras.layers.Concatenate(axis=2, name = 'Con13541', )([Zer92893,in0Con13541])
Mul58997 = keras.layers.Multiply(name = 'Mul58997', )([Res1415,Con13541])
model = tf.keras.models.Model(inputs=[in0Ave20708,in1Ave20708,in0Con17049,in0Dot53299,in1Dot53299,in0Add3807,in1Add3807,in0Con96279,in0Con39769,in0Con13541], outputs=Mul58997)
w = model.get_layer('Con16410').get_weights() 
w[0] = np.array([[[[[0.2266, 0.6581, 0.4612, 0.1843]]], [[[0.6114, 0.0839, 0.1008, 0.4383]]]], [[[[0.6327, 0.8445, 0.9202, 0.1185]]], [[[0.8874, 0.8154, 0.5379, 0.702]]]], [[[[0.0364, 0.3185, 0.6828, 0.3284]]], [[[0.2557, 0.5372, 0.2256, 0.1625]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con16410').set_weights(w) 
w = model.get_layer('Con39769').get_weights() 
w[0] = np.array([[[[0.5846, 0.5417], [0.6534, 0.8825]]]])
w[1] = np.array([0, 0])
model.get_layer('Con39769').set_weights(w) 
in0Ave20708 = tf.constant([[[[0.8048, 0.5599], [0.3236, 0.7773]], [[0.0147, 0.6301], [0.2083, 0.2277]]]])
in1Ave20708 = tf.constant([[[[0.656, 0.4502], [0.1127, 0.3996]], [[0.7035, 0.6939], [0.0175, 0.647]]]])
in0Con17049 = tf.constant([[[[[0.2715, 0.6772, 0.9642], [0.0135, 0.9424, 0.2592]], [[0.5082, 0.7395, 0.9382], [0.6811, 0.0316, 0.4503]], [[0.7932, 0.7138, 0.7556], [0.9235, 0.6575, 0.2196]], [[0.8243, 0.4566, 0.1335], [0.8174, 0.6766, 0.0733]]], [[[0.5458, 0.3644, 0.7735], [0.751, 0.6285, 0.2719]], [[0.8392, 0.831, 0.0596], [0.6257, 0.0405, 0.6775]], [[0.6186, 0.186, 0.2095], [0.2106, 0.9985, 0.606]], [[0.2953, 0.1536, 0.466], [0.6268, 0.7205, 0.7084]]]]])
in0Dot53299 = tf.constant([[[0.4228, 0.0846, 0.3121], [0.9994, 0.6173, 0.1875], [0.5672, 0.1596, 0.9455]]])
in1Dot53299 = tf.constant([[[0.906, 0.0556, 0.8741], [0.7487, 0.8822, 0.6475], [0.6565, 0.5516, 0.4822]]])
in0Add3807 = tf.constant([[[[0.7567, 0.7845]]]])
in1Add3807 = tf.constant([[[[0.03, 0.6867]]]])
in0Con96279 = tf.constant([[[0.9907, 0.473]]])
in0Con39769 = tf.constant([[[[0.476, 0.078], [0.7742, 0.998]], [[0.8983, 0.2147], [0.6215, 0.4286]]]])
in0Con13541 = tf.constant([[[0.1574, 0.9815, 0.522, 0.7911, 0.1643, 0.8697, 0.5714, 0.8345, 0.7758, 0.433, 0.4184, 0.9321, 0.9705, 0.7652, 0.0071, 0.3187, 0.9003, 0.7495, 0.8037, 0.8539, 0.7618, 0.6121, 0.553, 0.9925, 0.9259, 0.5524, 0.0917, 0.9793], [0.197, 0.8992, 0.4217, 0.4704, 0.8645, 0.6986, 0.4239, 0.2573, 0.0321, 0.3708, 0.3068, 0.0172, 0.5587, 0.0935, 0.1268, 0.0481, 0.8334, 0.8659, 0.4916, 0.7581, 0.5188, 0.7845, 0.8633, 0.2759, 0.3448, 0.9259, 0.716, 0.9225]]])
print (np.array2string(model.predict([in0Ave20708,in1Ave20708,in0Con17049,in0Dot53299,in1Dot53299,in0Add3807,in1Add3807,in0Con96279,in0Con39769,in0Con13541],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul58997.png')

LAve20708 = average_layer([[[[[0.8048, 0.5599], [0.3236, 0.7773]], [[0.0147, 0.6301], [0.2083, 0.2277]]]], [[[[0.656, 0.4502], [0.1127, 0.3996]], [[0.7035, 0.6939], [0.0175, 0.647]]]]], Ave20708), 
LRes66389 = reshape_layer(Ave20708, [2, 2, 2, 1], Res66389), 
LZer50963 = zero_padding3D_layer(Res66389, 0, 0, 2, 0, 0, 0, Zer50963), 
LCon17049 = concatenate_layer([Zer50963,[[[[[0.2715, 0.6772, 0.9642], [0.0135, 0.9424, 0.2592]], [[0.5082, 0.7395, 0.9382], [0.6811, 0.0316, 0.4503]], [[0.7932, 0.7138, 0.7556], [0.9235, 0.6575, 0.2196]], [[0.8243, 0.4566, 0.1335], [0.8174, 0.6766, 0.0733]]], [[[0.5458, 0.3644, 0.7735], [0.751, 0.6285, 0.2719]], [[0.8392, 0.831, 0.0596], [0.6257, 0.0405, 0.6775]], [[0.6186, 0.186, 0.2095], [0.2106, 0.9985, 0.606]], [[0.2953, 0.1536, 0.466], [0.6268, 0.7205, 0.7084]]]]]], 4, Con17049), 
LDot53299 = dot_layer([[[0.4228, 0.0846, 0.3121], [0.9994, 0.6173, 0.1875], [0.5672, 0.1596, 0.9455]]], [[[0.906, 0.0556, 0.8741], [0.7487, 0.8822, 0.6475], [0.6565, 0.5516, 0.4822]]], 1, 2, Dot53299), 
LRes99773 = reshape_layer(Dot53299, [3, 3, 1], Res99773), 
LRes310 = reshape_layer(Res99773, [3, 3, 1, 1], Res310), 
LCon16410 = conv3D_layer(Res310, 3, 2, 1,[[[[[0.2266, 0.6581, 0.4612, 0.1843]]], [[[0.6114, 0.0839, 0.1008, 0.4383]]]], [[[[0.6327, 0.8445, 0.9202, 0.1185]]], [[[0.8874, 0.8154, 0.5379, 0.702]]]], [[[[0.0364, 0.3185, 0.6828, 0.3284]]], [[[0.2557, 0.5372, 0.2256, 0.1625]]]]],[0, 0, 0, 0], 4, 1, 1, true, 1, 1, 1, Con16410), 
LZer46441 = zero_padding3D_layer(Con16410, 1, 0, 1, 0, 1, 0, Zer46441), 
LMul71412 = multiply_layer([Con17049,Zer46441], Mul71412), 
LRes78657 = reshape_layer(Mul71412, [2, 4, 8], Res78657), 
LRes1415 = reshape_layer(Res78657, [2, 32], Res1415), 
LAdd3807 = add_layer([[[[[0.7567, 0.7845]]]], [[[[0.03, 0.6867]]]]], Add3807), 
LRes68661 = reshape_layer(Add3807, [1, 2], Res68661), 
LCon96279 = concatenate_layer([Res68661,[[[0.9907, 0.473]]]], 2, Con96279), 
LCon39769 = conv2D_layer([[[[0.476, 0.078], [0.7742, 0.998]], [[0.8983, 0.2147], [0.6215, 0.4286]]]], 1, 1,[[[[0.5846, 0.5417], [0.6534, 0.8825]]]],[0, 0], 5, 1, false, 1, 1, Con39769), 
LRes13759 = reshape_layer(Con39769, [1, 4], Res13759), 
LCro45671 = cropping1D_layer(Res13759, 0, 0, Cro45671), 
LMax216 = maximum_layer([Con96279,Cro45671], Max216), 
LZer92893 = zero_padding1D_layer(Max216, 1, 0, Zer92893), 
LCon13541 = concatenate_layer([Zer92893,[[[0.1574, 0.9815, 0.522, 0.7911, 0.1643, 0.8697, 0.5714, 0.8345, 0.7758, 0.433, 0.4184, 0.9321, 0.9705, 0.7652, 0.0071, 0.3187, 0.9003, 0.7495, 0.8037, 0.8539, 0.7618, 0.6121, 0.553, 0.9925, 0.9259, 0.5524, 0.0917, 0.9793], [0.197, 0.8992, 0.4217, 0.4704, 0.8645, 0.6986, 0.4239, 0.2573, 0.0321, 0.3708, 0.3068, 0.0172, 0.5587, 0.0935, 0.1268, 0.0481, 0.8334, 0.8659, 0.4916, 0.7581, 0.5188, 0.7845, 0.8633, 0.2759, 0.3448, 0.9259, 0.716, 0.9225]]]], 2, Con13541), 
LMul58997 = multiply_layer([Res1415,Con13541], Mul58997), 
exec_layers([LAve20708,LRes66389,LZer50963,LCon17049,LDot53299,LRes99773,LRes310,LCon16410,LZer46441,LMul71412,LRes78657,LRes1415,LAdd3807,LRes68661,LCon96279,LCon39769,LRes13759,LCro45671,LMax216,LZer92893,LCon13541,LMul58997],["Ave20708","Res66389","Zer50963","Con17049","Dot53299","Res99773","Res310","Con16410","Zer46441","Mul71412","Res78657","Res1415","Add3807","Res68661","Con96279","Con39769","Res13759","Cro45671","Max216","Zer92893","Con13541","Mul58997"],Mul58997,"Mul58997")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.5655574, 0.0272672, 0.0223665, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 1.1755272, 0.5182126, 1.2786832, 0.7554073, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0869920, 0.7941047, 0.7560079, 0.3334075]]]

Expected (Unparsed): [[[0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.5655573668310435,0.027267197001307295,0.02236652920594281,0.0,0.0,0.0,0.0,1.1755272039910887,0.5182126298475156,1.2786832285217566,0.7554073584891935,0.0,0.0,0.0,0.0,0.0869920525581921,0.7941047186829817,0.7560079055641258,0.33340745759591095]]]

Actual:   [[[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.5656, 0.0273, 0.0224, 0, 0, 0, 0, 1.1756, 0.5183, 1.2787, 0.7555, 0, 0, 0, 0, 0.087, 0.7942, 0.7561, 0.3335]]]

Expected: [[[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.5656, 0.0273, 0.0224, 0, 0, 0, 0, 1.1756, 0.5183, 1.2787, 0.7555, 0, 0, 0, 0, 0.087, 0.7942, 0.7561, 0.3335]]]