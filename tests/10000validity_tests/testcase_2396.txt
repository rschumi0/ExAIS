import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot74667 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot74667 = tf.keras.layers.Input(shape=([3, 3]))

Dot74667 = keras.layers.Dot(axes=(2, 2), name = 'Dot74667', )([in0Dot74667,in1Dot74667])
Res80071 = keras.layers.Reshape((3, 3, 1), name = 'Res80071', )(Dot74667)
Res48522 = keras.layers.Reshape((3, 3, 1, 1), name = 'Res48522', )(Res80071)
Glo95274 = keras.layers.GlobalAveragePooling3D(name = 'Glo95274', )(Res48522)
Res20442 = keras.layers.Reshape((1, 1), name = 'Res20442', )(Glo95274)
Sim4594 = keras.layers.SimpleRNN(1,name = 'Sim4594', )(Res20442)
Res44857 = keras.layers.Reshape((1, 1), name = 'Res44857', )(Sim4594)
Max97627 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max97627', )(Res44857)
model = tf.keras.models.Model(inputs=[in0Dot74667,in1Dot74667], outputs=Max97627)
w = model.get_layer('Sim4594').get_weights() 
w[0] = np.array([[9]])
w[1] = np.array([[6]])
w[2] = np.array([9])
model.get_layer('Sim4594').set_weights(w) 
in0Dot74667 = tf.constant([[[0.2297, 0.1781, 0.286], [0.7251, 0.4354, 0.3673], [0.7659, 0.1391, 0.5726]]])
in1Dot74667 = tf.constant([[[0.7911, 0.2741, 0.3871], [0.4, 0.5912, 0.367], [0.7251, 0.1391, 0.0169]]])
print (np.array2string(model.predict([in0Dot74667,in1Dot74667],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max97627.png')

LDot74667 = dot_layer([[[0.2297, 0.1781, 0.286], [0.7251, 0.4354, 0.3673], [0.7659, 0.1391, 0.5726]]], [[[0.7911, 0.2741, 0.3871], [0.4, 0.5912, 0.367], [0.7251, 0.1391, 0.0169]]], 2, 2, Dot74667), 
LRes80071 = reshape_layer(Dot74667, [3, 3, 1], Res80071), 
LRes48522 = reshape_layer(Res80071, [3, 3, 1, 1], Res48522), 
LGlo95274 = global_average_pooling3D_layer(Res48522, Glo95274), 
LRes20442 = reshape_layer(Glo95274, [1, 1], Res20442), 
LSim4594 = simple_rnn_layer(Res20442,[[9]],[[6]],[9], Sim4594), 
LRes44857 = reshape_layer(Sim4594, [1, 1], Res44857), 
LMax97627 = max_pool1D_layer(Res44857, 1, Max97627), 
exec_layers([LDot74667,LRes80071,LRes48522,LGlo95274,LRes20442,LSim4594,LRes44857,LMax97627],["Dot74667","Res80071","Res48522","Glo95274","Res20442","Sim4594","Res44857","Max97627"],Max97627,"Max97627")

Actual (Unparsed): [[[1.0000000]]]

Expected (Unparsed): [[[0.9999999999986123]]]

Actual:   [[[1]]]

Expected: [[[1]]]