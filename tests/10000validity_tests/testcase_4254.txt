import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con28000 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in0Con11465 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Min51418 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Min51418 = tf.keras.layers.Input(shape=([2, 1, 2]))

Con28000 = keras.layers.Conv3D(2, (1, 1, 2),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con28000', )(in0Con28000)
Res571 = keras.layers.Reshape((1, 1, 2), name = 'Res571', )(Con28000)
Glo83992 = keras.layers.GlobalMaxPool2D(name = 'Glo83992', )(Res571)
Res14623 = keras.layers.Reshape((2, 1), name = 'Res14623', )(Glo83992)
Res9860 = keras.layers.Reshape((2, 1, 1), name = 'Res9860', )(Res14623)
Con11465 = keras.layers.Concatenate(axis=3, name = 'Con11465', )([Res9860,in0Con11465])
Min51418 = keras.layers.Minimum(name = 'Min51418', )([in0Min51418,in1Min51418])
Sub77083 = keras.layers.Subtract(name = 'Sub77083', )([Con11465,Min51418])
Sof68331 = keras.layers.Softmax(axis=1, name = 'Sof68331', )(Sub77083)
model = tf.keras.models.Model(inputs=[in0Con28000,in0Con11465,in0Min51418,in1Min51418], outputs=Sof68331)
w = model.get_layer('Con28000').get_weights() 
w[0] = np.array([[[[[0.2841, 0.4358], [0.8168, 0.0638]], [[0.3168, 0.5073], [0.6752, 0.5238]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con28000').set_weights(w) 
in0Con28000 = tf.constant([[[[[0.6088, 0.4762], [0.7522, 0.8252]]]]])
in0Con11465 = tf.constant([[[[0.1619]], [[0.9921]]]])
in0Min51418 = tf.constant([[[[0.8307, 0.6559]], [[0.6738, 0.5199]]]])
in1Min51418 = tf.constant([[[[0.4241, 0.2466]], [[0.3151, 0.1085]]]])
print (np.array2string(model.predict([in0Con28000,in0Con11465,in0Min51418,in1Min51418],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sof68331.png')

LCon28000 = conv3D_layer([[[[[0.6088, 0.4762], [0.7522, 0.8252]]]]], 1, 1, 2,[[[[[0.2841, 0.4358], [0.8168, 0.0638]], [[0.3168, 0.5073], [0.6752, 0.5238]]]]],[0, 0], 1, 1, 1, false, 1, 1, 1, Con28000), 
LRes571 = reshape_layer(Con28000, [1, 1, 2], Res571), 
LGlo83992 = global_max_pool2D_layer(Res571, Glo83992), 
LRes14623 = reshape_layer(Glo83992, [2, 1], Res14623), 
LRes9860 = reshape_layer(Res14623, [2, 1, 1], Res9860), 
LCon11465 = concatenate_layer([Res9860,[[[[0.1619]], [[0.9921]]]]], 3, Con11465), 
LMin51418 = minimum_layer([[[[[0.8307, 0.6559]], [[0.6738, 0.5199]]]], [[[[0.4241, 0.2466]], [[0.3151, 0.1085]]]]], Min51418), 
LSub77083 = subtract_layer(Con11465,Min51418, Sub77083), 
LSof68331 = softmax_layer(Sub77083, 1, Sof68331), 
exec_layers([LCon28000,LRes571,LGlo83992,LRes14623,LRes9860,LCon11465,LMin51418,LSub77083,LSof68331],["Con28000","Res571","Glo83992","Res14623","Res9860","Con11465","Min51418","Sub77083","Sof68331"],Sof68331,"Sof68331")

Actual (Unparsed): [[[[0.5346605, 0.2752195]], [[0.4653395, 0.7247805]]]]

Expected (Unparsed): [[[[0.5346605250513855,0.2752194779155245]],[[0.4653394749486146,0.7247805220844755]]]]

Actual:   [[[[0.5347, 0.2753]], [[0.4654, 0.7248]]]]

Expected: [[[[0.5347, 0.2753]], [[0.4654, 0.7248]]]]