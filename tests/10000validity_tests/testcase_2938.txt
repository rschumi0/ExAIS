import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot30846 = tf.keras.layers.Input(shape=([2]))
in1Dot30846 = tf.keras.layers.Input(shape=([2]))
in0Thr1944 = tf.keras.layers.Input(shape=([2, 1]))
in0Lay74289 = tf.keras.layers.Input(shape=([2, 3]))
in0Con71142 = tf.keras.layers.Input(shape=([2, 1]))

Dot30846 = keras.layers.Dot(axes=(1, 1), name = 'Dot30846', )([in0Dot30846,in1Dot30846])
Thr1944 = keras.layers.ThresholdedReLU(theta=1.928539793371454, name = 'Thr1944', input_shape=(2, 1))(in0Thr1944)
Ave27821 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='same', name = 'Ave27821', )(Thr1944)
Res67414 = keras.layers.Reshape((2, 1, 1), name = 'Res67414', )(Ave27821)
Res56149 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res56149', )(Res67414)
Con21722 = keras.layers.Conv3DTranspose(4, (1, 1, 1),strides=(1, 1, 1), padding='same', name = 'Con21722', )(Res56149)
Res14885 = keras.layers.Reshape((2, 1, 4), name = 'Res14885', )(Con21722)
Res14639 = keras.layers.Reshape((2, 4), name = 'Res14639', )(Res14885)
Lay74289 = keras.layers.LayerNormalization(axis=2, epsilon=2.752228645179064, name = 'Lay74289', )(in0Lay74289)
Con71142 = keras.layers.Concatenate(axis=2, name = 'Con71142', )([Lay74289,in0Con71142])
Max67675 = keras.layers.Maximum(name = 'Max67675', )([Res14639,Con71142])
Res70347 = keras.layers.Reshape((2, 4, 1), name = 'Res70347', )(Max67675)
Glo80791 = keras.layers.GlobalMaxPool2D(name = 'Glo80791', )(Res70347)
Max37684 = keras.layers.Maximum(name = 'Max37684', )([Dot30846,Glo80791])
model = tf.keras.models.Model(inputs=[in0Dot30846,in1Dot30846,in0Thr1944,in0Lay74289,in0Con71142], outputs=Max37684)
w = model.get_layer('Con21722').get_weights() 
w[0] = np.array([[[[[0.0389], [0.6196], [0.6999], [0.4981]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con21722').set_weights(w) 
in0Dot30846 = tf.constant([[0.9988, 0.1845]])
in1Dot30846 = tf.constant([[0.1826, 0.5553]])
in0Thr1944 = tf.constant([[[0.3454], [0.4096]]])
in0Lay74289 = tf.constant([[[1.6856, 1.4047, 1.1499], [1.5927, 1.9282, 1.2982]]])
in0Con71142 = tf.constant([[[0.028], [0.9904]]])
print (np.array2string(model.predict([in0Dot30846,in1Dot30846,in0Thr1944,in0Lay74289,in0Con71142],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max37684.png')

LDot30846 = dot_layer([[0.9988, 0.1845]], [[0.1826, 0.5553]], 1, 1, Dot30846), 
LThr1944 = thresholded_relu_layer([[[0.3454], [0.4096]]], 1.928539793371454, Thr1944), 
LAve27821 = average_pooling1D_layer(Thr1944, 1, 1, true, Ave27821), 
LRes67414 = reshape_layer(Ave27821, [2, 1, 1], Res67414), 
LRes56149 = reshape_layer(Res67414, [2, 1, 1, 1], Res56149), 
LCon21722 = conv3D_transpose_layer(Res56149, 1, 1, 1,[[[[[0.0389], [0.6196], [0.6999], [0.4981]]]]],[0, 0, 0, 0], 1, 1, 1, true, Con21722), 
LRes14885 = reshape_layer(Con21722, [2, 1, 4], Res14885), 
LRes14639 = reshape_layer(Res14885, [2, 4], Res14639), 
LLay74289 = layer_normalization_layer([[[1.6856, 1.4047, 1.1499], [1.5927, 1.9282, 1.2982]]], 2, 2.752228645179064, Lay74289), 
LCon71142 = concatenate_layer([Lay74289,[[[0.028], [0.9904]]]], 2, Con71142), 
LMax67675 = maximum_layer([Res14639,Con71142], Max67675), 
LRes70347 = reshape_layer(Max67675, [2, 4, 1], Res70347), 
LGlo80791 = global_max_pool2D_layer(Res70347, Glo80791), 
LMax37684 = maximum_layer([Dot30846,Glo80791], Max37684), 
exec_layers([LDot30846,LThr1944,LAve27821,LRes67414,LRes56149,LCon21722,LRes14885,LRes14639,LLay74289,LCon71142,LMax67675,LRes70347,LGlo80791,LMax37684],["Dot30846","Thr1944","Ave27821","Res67414","Res56149","Con21722","Res14885","Res14639","Lay74289","Con71142","Max67675","Res70347","Glo80791","Max37684"],Max37684,"Max37684")

Actual (Unparsed): [[0.9904000]]

Expected (Unparsed): [[0.9904]]

Actual:   [[0.9904]]

Expected: [[0.9904]]