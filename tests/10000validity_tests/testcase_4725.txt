import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul58579 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Mul58579 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con8050 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Ave45185 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Ave45185 = tf.keras.layers.Input(shape=([1, 2, 2]))

Mul58579 = keras.layers.Multiply(name = 'Mul58579', )([in0Mul58579,in1Mul58579])
Res64751 = keras.layers.Reshape((2, 1), name = 'Res64751', )(Mul58579)
LST77394 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST77394', )(Res64751)
Res94015 = keras.layers.Reshape((3, 1), name = 'Res94015', )(LST77394)
Res62682 = keras.layers.Reshape((3, 1, 1), name = 'Res62682', )(Res94015)
Glo39005 = keras.layers.GlobalMaxPool2D(name = 'Glo39005', )(Res62682)
Res86496 = keras.layers.Reshape((1, 1), name = 'Res86496', )(Glo39005)
Res47456 = keras.layers.Reshape((1, 1, 1), name = 'Res47456', )(Res86496)
Zer71637 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer71637', )(Res47456)
Con8050 = keras.layers.Concatenate(axis=3, name = 'Con8050', )([Zer71637,in0Con8050])
Ave45185 = keras.layers.Average(name = 'Ave45185', )([in0Ave45185,in1Ave45185])
Lay91360 = keras.layers.LayerNormalization(axis=2, epsilon=2.3261800286799668, name = 'Lay91360', )(Ave45185)
Add13345 = keras.layers.Add(name = 'Add13345', )([Con8050,Lay91360])
model = tf.keras.models.Model(inputs=[in0Mul58579,in1Mul58579,in0Con8050,in0Ave45185,in1Ave45185], outputs=Add13345)
w = model.get_layer('LST77394').get_weights() 
w[0] = np.array([[2, 6, 9, 4, 1, 6, 4, 9, 3, 9, 6, 8]])
w[1] = np.array([[2, 10, 6, 2, 4, 9, 9, 9, 8, 5, 8, 6], [10, 4, 6, 6, 4, 8, 2, 5, 4, 4, 9, 3], [6, 1, 8, 3, 3, 6, 6, 6, 4, 9, 2, 2]])
w[2] = np.array([9, 10, 4, 6, 10, 2, 10, 5, 1, 7, 9, 9])
model.get_layer('LST77394').set_weights(w) 
in0Mul58579 = tf.constant([[[[0.5148]], [[0.7933]]]])
in1Mul58579 = tf.constant([[[[0.7585]], [[0.4484]]]])
in0Con8050 = tf.constant([[[[0.0675], [0.2793]]]])
in0Ave45185 = tf.constant([[[[0.6393, 0.7393], [0.6544, 0.0813]]]])
in1Ave45185 = tf.constant([[[[0.1178, 0.4101], [0.3272, 0.178]]]])
print (np.array2string(model.predict([in0Mul58579,in1Mul58579,in0Con8050,in0Ave45185,in1Ave45185],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add13345.png')

LMul58579 = multiply_layer([[[[[0.5148]], [[0.7933]]]], [[[[0.7585]], [[0.4484]]]]], Mul58579), 
LRes64751 = reshape_layer(Mul58579, [2, 1], Res64751), 
LLST77394 = lstm_layer(Res64751,[[2, 6, 9, 4, 1, 6, 4, 9, 3, 9, 6, 8]],[[2, 10, 6, 2, 4, 9, 9, 9, 8, 5, 8, 6], [10, 4, 6, 6, 4, 8, 2, 5, 4, 4, 9, 3], [6, 1, 8, 3, 3, 6, 6, 6, 4, 9, 2, 2]],[9, 10, 4, 6, 10, 2, 10, 5, 1, 7, 9, 9], LST77394), 
LRes94015 = reshape_layer(LST77394, [3, 1], Res94015), 
LRes62682 = reshape_layer(Res94015, [3, 1, 1], Res62682), 
LGlo39005 = global_max_pool2D_layer(Res62682, Glo39005), 
LRes86496 = reshape_layer(Glo39005, [1, 1], Res86496), 
LRes47456 = reshape_layer(Res86496, [1, 1, 1], Res47456), 
LZer71637 = zero_padding2D_layer(Res47456, 0, 0, 1, 0, Zer71637), 
LCon8050 = concatenate_layer([Zer71637,[[[[0.0675], [0.2793]]]]], 3, Con8050), 
LAve45185 = average_layer([[[[[0.6393, 0.7393], [0.6544, 0.0813]]]], [[[[0.1178, 0.4101], [0.3272, 0.178]]]]], Ave45185), 
LLay91360 = layer_normalization_layer(Ave45185, 2, 2.3261800286799668, Lay91360), 
LAdd13345 = add_layer([Con8050,Lay91360], Add13345), 
exec_layers([LMul58579,LRes64751,LLST77394,LRes94015,LRes62682,LGlo39005,LRes86496,LRes47456,LZer71637,LCon8050,LAve45185,LLay91360,LAdd13345],["Mul58579","Res64751","LST77394","Res94015","Res62682","Glo39005","Res86496","Res47456","Zer71637","Con8050","Ave45185","Lay91360","Add13345"],Add13345,"Add13345")

Actual (Unparsed): [[[[-0.0367740, 0.2118721], [1.0008013, 0.1349279]]]]

Expected (Unparsed): [[[[-0.03677399729826947,0.21187209151106337],[1.0008012630484924,0.1349279084889366]]]]

Actual:   [[[[-0.0367, 0.2119], [1.0009, 0.135]]]]

Expected: [[[[-0.0367, 0.2119], [1.0009, 0.135]]]]