import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con6540 = tf.keras.layers.Input(shape=([1, 1]))
in0Con23490 = tf.keras.layers.Input(shape=([1, 12]))
in0Min42270 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Min42270 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con10916 = tf.keras.layers.Input(shape=([2, 2, 4, 1]))
in0Sep26066 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con32518 = tf.keras.layers.Input(shape=([2, 1, 3, 1]))
in0Mul48088 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in1Mul48088 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))

Con6540 = keras.layers.Conv1D(4, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con6540', )(in0Con6540)
Lay97679 = keras.layers.LayerNormalization(axis=1, epsilon=1.8595399276179168, name = 'Lay97679', )(Con6540)
Mas74769 = keras.layers.Masking(mask_value=2, name = 'Mas74769', )(Lay97679)
Con23490 = keras.layers.Concatenate(axis=2, name = 'Con23490', )([Mas74769,in0Con23490])
Min42270 = keras.layers.Minimum(name = 'Min42270', )([in0Min42270,in1Min42270])
Res14472 = keras.layers.Reshape((2, 2, 2, 1), name = 'Res14472', )(Min42270)
Zer94211 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer94211', )(Res14472)
Con10916 = keras.layers.Concatenate(axis=4, name = 'Con10916', )([Zer94211,in0Con10916])
Sep26066 = keras.layers.SeparableConv2D(3, (1, 1),strides=(1, 1), padding='valid', name = 'Sep26066', )(in0Sep26066)
Sof16970 = keras.layers.Softmax(axis=1, name = 'Sof16970', )(Sep26066)
Res10080 = keras.layers.Reshape((2, 1, 3, 1), name = 'Res10080', )(Sof16970)
Con32518 = keras.layers.Concatenate(axis=4, name = 'Con32518', )([Res10080,in0Con32518])
Mul48088 = keras.layers.Multiply(name = 'Mul48088', )([in0Mul48088,in1Mul48088])
Zer95716 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (1, 0)), name = 'Zer95716', )(Mul48088)
Max99462 = keras.layers.Maximum(name = 'Max99462', )([Con32518,Zer95716])
Zer23413 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (1, 0)), name = 'Zer23413', )(Max99462)
Min5536 = keras.layers.Minimum(name = 'Min5536', )([Con10916,Zer23413])
Res42780 = keras.layers.Reshape((2, 2, 8), name = 'Res42780', )(Min5536)
Res7721 = keras.layers.Reshape((2, 16), name = 'Res7721', )(Res42780)
Zer40984 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer40984', )(Res7721)
Dot24808 = keras.layers.Dot(axes=(2, 2), name = 'Dot24808', )([Con23490,Zer40984])
model = tf.keras.models.Model(inputs=[in0Con6540,in0Con23490,in0Min42270,in1Min42270,in0Con10916,in0Sep26066,in0Con32518,in0Mul48088,in1Mul48088], outputs=Dot24808)
w = model.get_layer('Con6540').get_weights() 
w[0] = np.array([[[0.6339, 0.1099, 0.5839, 0.1057]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con6540').set_weights(w) 
w = model.get_layer('Sep26066').get_weights() 
w[0] = np.array([[[[0.401]]]])
w[1] = np.array([[[[0.8088, 0.8998, 0.334]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep26066').set_weights(w) 
in0Con6540 = tf.constant([[[0.5357]]])
in0Con23490 = tf.constant([[[0.2113, 0.0394, 0.4915, 0.4368, 0.616, 0.5006, 0.6146, 0.0365, 0.8179, 0.5669, 0.6494, 0.1825]]])
in0Min42270 = tf.constant([[[[0.293, 0.6141], [0.9299, 0.0204]], [[0.4054, 0.5895], [0.804, 0.8106]]]])
in1Min42270 = tf.constant([[[[0.0865, 0.3829], [0.8842, 0.9665]], [[0.8498, 0.2164], [0.5582, 0.0089]]]])
in0Con10916 = tf.constant([[[[[0.8675], [0.5095], [0.289], [0.319]], [[0.8343], [0.0535], [0.1309], [0.5837]]], [[[0.2245], [0.9583], [0.9837], [0.0311]], [[0.3434], [0.1624], [0.1209], [0.5134]]]]])
in0Sep26066 = tf.constant([[[[0.4601]], [[0.5994]]]])
in0Con32518 = tf.constant([[[[[0.5938], [0.1912], [0.6654]]], [[[0.8249], [0.4158], [0.6034]]]]])
in0Mul48088 = tf.constant([[[[[0.4095, 0.1489], [0.8183, 0.8661]]], [[[0.5739, 0.8193], [0.793, 0.0401]]]]])
in1Mul48088 = tf.constant([[[[[0.0751, 0.8063], [0.7587, 0.2316]]], [[[0.3563, 0.4779], [0.7094, 0.8615]]]]])
print (np.array2string(model.predict([in0Con6540,in0Con23490,in0Min42270,in1Min42270,in0Con10916,in0Sep26066,in0Con32518,in0Mul48088,in1Mul48088],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot24808.png')

LCon6540 = conv1D_layer([[[0.5357]]], 1,[[[0.6339, 0.1099, 0.5839, 0.1057]]],[0, 0, 0, 0], 1, true, 1, Con6540), 
LLay97679 = layer_normalization_layer(Con6540, 1, 1.8595399276179168, Lay97679), 
LMas74769 = masking_layer(Lay97679, 2, Mas74769), 
LCon23490 = concatenate_layer([Mas74769,[[[0.2113, 0.0394, 0.4915, 0.4368, 0.616, 0.5006, 0.6146, 0.0365, 0.8179, 0.5669, 0.6494, 0.1825]]]], 2, Con23490), 
LMin42270 = minimum_layer([[[[[0.293, 0.6141], [0.9299, 0.0204]], [[0.4054, 0.5895], [0.804, 0.8106]]]], [[[[0.0865, 0.3829], [0.8842, 0.9665]], [[0.8498, 0.2164], [0.5582, 0.0089]]]]], Min42270), 
LRes14472 = reshape_layer(Min42270, [2, 2, 2, 1], Res14472), 
LZer94211 = zero_padding3D_layer(Res14472, 0, 0, 0, 0, 2, 0, Zer94211), 
LCon10916 = concatenate_layer([Zer94211,[[[[[0.8675], [0.5095], [0.289], [0.319]], [[0.8343], [0.0535], [0.1309], [0.5837]]], [[[0.2245], [0.9583], [0.9837], [0.0311]], [[0.3434], [0.1624], [0.1209], [0.5134]]]]]], 4, Con10916), 
LSep26066 = separable_conv2D_layer([[[[0.4601]], [[0.5994]]]], 1, 1,[[[[[0.401]]]],[[[[0.8088, 0.8998, 0.334]]]]],[0, 0, 0], 1, 1, false, Sep26066), 
LSof16970 = softmax_layer(Sep26066, 1, Sof16970), 
LRes10080 = reshape_layer(Sof16970, [2, 1, 3, 1], Res10080), 
LCon32518 = concatenate_layer([Res10080,[[[[[0.5938], [0.1912], [0.6654]]], [[[0.8249], [0.4158], [0.6034]]]]]], 4, Con32518), 
LMul48088 = multiply_layer([[[[[[0.4095, 0.1489], [0.8183, 0.8661]]], [[[0.5739, 0.8193], [0.793, 0.0401]]]]], [[[[[0.0751, 0.8063], [0.7587, 0.2316]]], [[[0.3563, 0.4779], [0.7094, 0.8615]]]]]], Mul48088), 
LZer95716 = zero_padding3D_layer(Mul48088, 0, 0, 0, 0, 1, 0, Zer95716), 
LMax99462 = maximum_layer([Con32518,Zer95716], Max99462), 
LZer23413 = zero_padding3D_layer(Max99462, 0, 0, 1, 0, 1, 0, Zer23413), 
LMin5536 = minimum_layer([Con10916,Zer23413], Min5536), 
LRes42780 = reshape_layer(Min5536, [2, 2, 8], Res42780), 
LRes7721 = reshape_layer(Res42780, [2, 16], Res7721), 
LZer40984 = zero_padding1D_layer(Res7721, 1, 0, Zer40984), 
LDot24808 = dot_layer(Con23490,Zer40984, 2, 2, Dot24808), 
exec_layers([LCon6540,LLay97679,LMas74769,LCon23490,LMin42270,LRes14472,LZer94211,LCon10916,LSep26066,LSof16970,LRes10080,LCon32518,LMul48088,LZer95716,LMax99462,LZer23413,LMin5536,LRes42780,LRes7721,LZer40984,LDot24808],["Con6540","Lay97679","Mas74769","Con23490","Min42270","Res14472","Zer94211","Con10916","Sep26066","Sof16970","Res10080","Con32518","Mul48088","Zer95716","Max99462","Zer23413","Min5536","Res42780","Res7721","Zer40984","Dot24808"],Dot24808,"Dot24808")

Actual (Unparsed): [[[0.0000000, 0.5946078, 0.5931662]]]

Expected (Unparsed): [[[0.0,0.5946077701209093,0.5931661698790907]]]

Actual:   [[[0, 0.5947, 0.5932]]]

Expected: [[[0, 0.5947, 0.5932]]]