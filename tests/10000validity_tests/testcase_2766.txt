import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max9659 = tf.keras.layers.Input(shape=([2, 2]))
in1Max9659 = tf.keras.layers.Input(shape=([2, 2]))
in0Sep4058 = tf.keras.layers.Input(shape=([1, 1]))
in0Con97573 = tf.keras.layers.Input(shape=([3, 2]))
in0Dot40873 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot40873 = tf.keras.layers.Input(shape=([3, 3]))
in0Con56037 = tf.keras.layers.Input(shape=([3, 1]))

Max9659 = keras.layers.Maximum(name = 'Max9659', )([in0Max9659,in1Max9659])
Res46452 = keras.layers.Reshape((2, 2, 1), name = 'Res46452', )(Max9659)
Sep86705 = keras.layers.SeparableConv2D(4, (2, 1),strides=(2, 2), padding='same', name = 'Sep86705', )(Res46452)
Res61497 = keras.layers.Reshape((1, 4), name = 'Res61497', )(Sep86705)
Zer30014 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer30014', )(Res61497)
Sep4058 = keras.layers.SeparableConv1D(2, (1),strides=(1), padding='valid', name = 'Sep4058', )(in0Sep4058)
GRU57937 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU57937', )(Sep4058)
Res97924 = keras.layers.Reshape((2, 1), name = 'Res97924', )(GRU57937)
Res51504 = keras.layers.Reshape((2, 1, 1), name = 'Res51504', )(Res97924)
Ave19535 = keras.layers.AveragePooling2D(pool_size=(1, 1), name = 'Ave19535', )(Res51504)
Res63137 = keras.layers.Reshape((2, 1), name = 'Res63137', )(Ave19535)
Zer5694 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer5694', )(Res63137)
Con97573 = keras.layers.Concatenate(axis=2, name = 'Con97573', )([Zer5694,in0Con97573])
Dot40873 = keras.layers.Dot(axes=(1, 1), name = 'Dot40873', )([in0Dot40873,in1Dot40873])
Max63111 = keras.layers.Maximum(name = 'Max63111', )([Con97573,Dot40873])
Con56037 = keras.layers.Concatenate(axis=2, name = 'Con56037', )([Max63111,in0Con56037])
Mul89709 = keras.layers.Multiply(name = 'Mul89709', )([Zer30014,Con56037])
model = tf.keras.models.Model(inputs=[in0Max9659,in1Max9659,in0Sep4058,in0Con97573,in0Dot40873,in1Dot40873,in0Con56037], outputs=Mul89709)
w = model.get_layer('Sep86705').get_weights() 
w[0] = np.array([[[[0.3025]]], [[[0.4967]]]])
w[1] = np.array([[[[0.6336, 0.0446, 0.5265, 0.8121]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep86705').set_weights(w) 
w = model.get_layer('Sep4058').get_weights() 
w[0] = np.array([[[0.7846]]])
w[1] = np.array([[[0.9175, 0.5286]]])
w[2] = np.array([0, 0])
model.get_layer('Sep4058').set_weights(w) 
w = model.get_layer('GRU57937').get_weights() 
w[0] = np.array([[1, 3, 9, 8, 7, 10], [5, 5, 9, 5, 2, 5]])
w[1] = np.array([[4, 6, 4, 4, 4, 3], [2, 10, 1, 5, 4, 1]])
w[2] = np.array([[4, 9, 2, 6, 6, 7], [8, 4, 5, 5, 5, 9]])
model.get_layer('GRU57937').set_weights(w) 
in0Max9659 = tf.constant([[[0.6683, 0.2008], [0.2095, 0.9146]]])
in1Max9659 = tf.constant([[[0.6031, 0.2668], [0.3028, 0.5054]]])
in0Sep4058 = tf.constant([[[0.3572]]])
in0Con97573 = tf.constant([[[0.204, 0.3716], [0.7636, 0.3252], [0.6632, 0.2643]]])
in0Dot40873 = tf.constant([[[0.4772, 0.3659, 0.1273], [0.7, 0.3443, 0.4118], [0.8983, 0.2095, 0.4852]]])
in1Dot40873 = tf.constant([[[0.9236, 0.3723, 0.863], [0.7935, 0.1118, 0.612], [0.2194, 0.8147, 0.3299]]])
in0Con56037 = tf.constant([[[0.0375], [0.111], [0.0339]]])
print (np.array2string(model.predict([in0Max9659,in1Max9659,in0Sep4058,in0Con97573,in0Dot40873,in1Dot40873,in0Con56037],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul89709.png')

LMax9659 = maximum_layer([[[[0.6683, 0.2008], [0.2095, 0.9146]]], [[[0.6031, 0.2668], [0.3028, 0.5054]]]], Max9659), 
LRes46452 = reshape_layer(Max9659, [2, 2, 1], Res46452), 
LSep86705 = separable_conv2D_layer(Res46452, 2, 1,[[[[[0.3025]]], [[[0.4967]]]],[[[[0.6336, 0.0446, 0.5265, 0.8121]]]]],[0, 0, 0, 0], 2, 2, true, Sep86705), 
LRes61497 = reshape_layer(Sep86705, [1, 4], Res61497), 
LZer30014 = zero_padding1D_layer(Res61497, 2, 0, Zer30014), 
LSep4058 = separable_conv1D_layer([[[0.3572]]], 1,[[[[0.7846]]],[[[0.9175, 0.5286]]]],[0, 0], 1, false, Sep4058), 
LGRU57937 = gru_layer(Sep4058,[[1, 3, 9, 8, 7, 10], [5, 5, 9, 5, 2, 5]],[[4, 6, 4, 4, 4, 3], [2, 10, 1, 5, 4, 1]],[[4, 9, 2, 6, 6, 7], [8, 4, 5, 5, 5, 9]], true, GRU57937), 
LRes97924 = reshape_layer(GRU57937, [2, 1], Res97924), 
LRes51504 = reshape_layer(Res97924, [2, 1, 1], Res51504), 
LAve19535 = average_pooling2D_layer(Res51504, 1, 1, Ave19535), 
LRes63137 = reshape_layer(Ave19535, [2, 1], Res63137), 
LZer5694 = zero_padding1D_layer(Res63137, 1, 0, Zer5694), 
LCon97573 = concatenate_layer([Zer5694,[[[0.204, 0.3716], [0.7636, 0.3252], [0.6632, 0.2643]]]], 2, Con97573), 
LDot40873 = dot_layer([[[0.4772, 0.3659, 0.1273], [0.7, 0.3443, 0.4118], [0.8983, 0.2095, 0.4852]]], [[[0.9236, 0.3723, 0.863], [0.7935, 0.1118, 0.612], [0.2194, 0.8147, 0.3299]]], 1, 1, Dot40873), 
LMax63111 = maximum_layer([Con97573,Dot40873], Max63111), 
LCon56037 = concatenate_layer([Max63111,[[[0.0375], [0.111], [0.0339]]]], 2, Con56037), 
LMul89709 = multiply_layer([Zer30014,Con56037], Mul89709), 
exec_layers([LMax9659,LRes46452,LSep86705,LRes61497,LZer30014,LSep4058,LGRU57937,LRes97924,LRes51504,LAve19535,LRes63137,LZer5694,LCon97573,LDot40873,LMax63111,LCon56037,LMul89709],["Max9659","Res46452","Sep86705","Res61497","Zer30014","Sep4058","GRU57937","Res97924","Res51504","Ave19535","Res63137","Zer5694","Con97573","Dot40873","Max63111","Con56037","Mul89709"],Mul89709,"Mul89709")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.1230372, 0.0104283, 0.0968861, 0.0097061]]]

Expected (Unparsed): [[[0.0,0.0,0.0,0.0],[0.0,0.0,0.0,0.0],[0.1230372103094289,0.0104283181870672,0.09688606695997153,0.009706085356986902]]]

Actual:   [[[0, 0, 0, 0], [0, 0, 0, 0], [0.1231, 0.0105, 0.0969, 0.0098]]]

Expected: [[[0, 0, 0, 0], [0, 0, 0, 0], [0.1231, 0.0105, 0.0969, 0.0098]]]