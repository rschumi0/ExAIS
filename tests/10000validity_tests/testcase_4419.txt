import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Per673 = tf.keras.layers.Input(shape=([3, 2]))
in0Dot98977 = tf.keras.layers.Input(shape=([3]))
in1Dot98977 = tf.keras.layers.Input(shape=([3]))
in0Con42468 = tf.keras.layers.Input(shape=([1, 2]))

Per673 = keras.layers.Permute((1,2), name = 'Per673',)(in0Per673)
Res60339 = keras.layers.Reshape((3, 2, 1), name = 'Res60339', )(Per673)
Sep8391 = keras.layers.SeparableConv2D(4, (3, 2),strides=(3, 3), padding='same', name = 'Sep8391', )(Res60339)
Cro81251 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro81251', )(Sep8391)
Dep49000 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='valid', name = 'Dep49000', )(Cro81251)
Res58222 = keras.layers.Reshape((1, 4), name = 'Res58222', )(Dep49000)
Dot98977 = keras.layers.Dot(axes=(1, 1), name = 'Dot98977', )([in0Dot98977,in1Dot98977])
Res64212 = keras.layers.Reshape((1, 1), name = 'Res64212', )(Dot98977)
Loc21797 = keras.layers.LocallyConnected1D(2, (1),strides=(1), name = 'Loc21797', )(Res64212)
Con42468 = keras.layers.Concatenate(axis=2, name = 'Con42468', )([Loc21797,in0Con42468])
Sub56343 = keras.layers.Subtract(name = 'Sub56343', )([Res58222,Con42468])
model = tf.keras.models.Model(inputs=[in0Per673,in0Dot98977,in1Dot98977,in0Con42468], outputs=Sub56343)
w = model.get_layer('Sep8391').get_weights() 
w[0] = np.array([[[[0.4305]], [[0.1263]]], [[[0.6014]], [[0.0535]]], [[[0.5861]], [[0.6403]]]])
w[1] = np.array([[[[0.0127, 0.3601, 0.6584, 0.374]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep8391').set_weights(w) 
w = model.get_layer('Dep49000').get_weights() 
w[0] = np.array([[[[0.2418], [0.8227], [0.6605], [0.8951]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Dep49000').set_weights(w) 
w = model.get_layer('Loc21797').get_weights() 
w[0] = np.array([[[0.203, 0.0796]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc21797').set_weights(w) 
in0Per673 = tf.constant([[[1.082, 1.8411], [1.2115, 1.9374], [1.4188, 1.4099]]])
in0Dot98977 = tf.constant([[0.8776, 0.3242, 0.7672]])
in1Dot98977 = tf.constant([[0.8268, 0.6291, 0.4259]])
in0Con42468 = tf.constant([[[0.763, 0.5908]]])
print (np.array2string(model.predict([in0Per673,in0Dot98977,in1Dot98977,in0Con42468],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub56343.png')

LPer673 = permute_layer([[[1.082, 1.8411], [1.2115, 1.9374], [1.4188, 1.4099]]], 1,2, Per673), 
LRes60339 = reshape_layer(Per673, [3, 2, 1], Res60339), 
LSep8391 = separable_conv2D_layer(Res60339, 3, 2,[[[[[0.4305]], [[0.1263]]], [[[0.6014]], [[0.0535]]], [[[0.5861]], [[0.6403]]]],[[[[0.0127, 0.3601, 0.6584, 0.374]]]]],[0, 0, 0, 0], 3, 3, true, Sep8391), 
LCro81251 = cropping2D_layer(Sep8391, 0, 0, 0, 0, Cro81251), 
LDep49000 = depthwise_conv2D_layer(Cro81251, 1, 1,[[[[0.2418], [0.8227], [0.6605], [0.8951]]]],[0, 0, 0, 0], 1, 1, false, Dep49000), 
LRes58222 = reshape_layer(Dep49000, [1, 4], Res58222), 
LDot98977 = dot_layer([[0.8776, 0.3242, 0.7672]], [[0.8268, 0.6291, 0.4259]], 1, 1, Dot98977), 
LRes64212 = reshape_layer(Dot98977, [1, 1], Res64212), 
LLoc21797 = locally_connected1D_layer(Res64212, 1,[[[0.203, 0.0796]]],[[0, 0]], 1, Loc21797), 
LCon42468 = concatenate_layer([Loc21797,[[[0.763, 0.5908]]]], 2, Con42468), 
LSub56343 = subtract_layer(Res58222,Con42468, Sub56343), 
exec_layers([LPer673,LRes60339,LSep8391,LCro81251,LDep49000,LRes58222,LDot98977,LRes64212,LLoc21797,LCon42468,LSub56343],["Per673","Res60339","Sep8391","Cro81251","Dep49000","Res58222","Dot98977","Res64212","Loc21797","Con42468","Sub56343"],Sub56343,"Sub56343")

Actual (Unparsed): [[[-0.2450038, 0.8672377, 0.6568160, 0.5021810]]]

Expected (Unparsed): [[[-0.24500374882834122,0.8672377242853967,0.6568160234136559,0.5021809393554919]]]

Actual:   [[[-0.245, 0.8673, 0.6569, 0.5022]]]

Expected: [[[-0.245, 0.8673, 0.6569, 0.5022]]]