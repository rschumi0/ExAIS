import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul79336 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul79336 = tf.keras.layers.Input(shape=([2, 2]))
in0Sof95665 = tf.keras.layers.Input(shape=([1, 2]))

Mul79336 = keras.layers.Multiply(name = 'Mul79336', )([in0Mul79336,in1Mul79336])
Glo53526 = keras.layers.GlobalMaxPool1D(name = 'Glo53526', )(Mul79336)
Res5086 = keras.layers.Reshape((2, 1), name = 'Res5086', )(Glo53526)
Res3516 = keras.layers.Reshape((2, 1, 1), name = 'Res3516', )(Res5086)
Max59799 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max59799', )(Res3516)
Res22467 = keras.layers.Reshape((2, 1), name = 'Res22467', )(Max59799)
Fla29938 = keras.layers.Flatten(name = 'Fla29938', )(Res22467)
Sof95665 = keras.layers.Softmax(axis=1, name = 'Sof95665', input_shape=(1, 2))(in0Sof95665)
Fla45053 = keras.layers.Flatten(name = 'Fla45053', )(Sof95665)
Ave29829 = keras.layers.Average(name = 'Ave29829', )([Fla29938,Fla45053])
model = tf.keras.models.Model(inputs=[in0Mul79336,in1Mul79336,in0Sof95665], outputs=Ave29829)
in0Mul79336 = tf.constant([[[0.9046, 0.137], [0.5334, 0.9341]]])
in1Mul79336 = tf.constant([[[0.9783, 0.0572], [0.3231, 0.153]]])
in0Sof95665 = tf.constant([[[0.1167, 0.3013]]])
print (np.array2string(model.predict([in0Mul79336,in1Mul79336,in0Sof95665],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave29829.png')

LMul79336 = multiply_layer([[[[0.9046, 0.137], [0.5334, 0.9341]]], [[[0.9783, 0.0572], [0.3231, 0.153]]]], Mul79336), 
LGlo53526 = global_max_pool1D_layer(Mul79336, Glo53526), 
LRes5086 = reshape_layer(Glo53526, [2, 1], Res5086), 
LRes3516 = reshape_layer(Res5086, [2, 1, 1], Res3516), 
LMax59799 = max_pool2D_layer(Res3516, 1, 1, Max59799), 
LRes22467 = reshape_layer(Max59799, [2, 1], Res22467), 
LFla29938 = flatten_layer(Res22467, Fla29938), 
LSof95665 = softmax_layer([[[0.1167, 0.3013]]], 1, Sof95665), 
LFla45053 = flatten_layer(Sof95665, Fla45053), 
LAve29829 = average_layer([Fla29938,Fla45053], Ave29829), 
exec_layers([LMul79336,LGlo53526,LRes5086,LRes3516,LMax59799,LRes22467,LFla29938,LSof95665,LFla45053,LAve29829],["Mul79336","Glo53526","Res5086","Res3516","Max59799","Res22467","Fla29938","Sof95665","Fla45053","Ave29829"],Ave29829,"Ave29829")

Actual (Unparsed): [[0.9424851, 0.5714586]]

Expected (Unparsed): [[0.9424850899999999,0.57145865]]

Actual:   [[0.9425, 0.5715]]

Expected: [[0.9425, 0.5715]]