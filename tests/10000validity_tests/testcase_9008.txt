import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave29367 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave29367 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con4474 = tf.keras.layers.Input(shape=([6, 31]))
in0Zer48522 = tf.keras.layers.Input(shape=([4, 2, 2, 2]))

Ave29367 = keras.layers.Average(name = 'Ave29367', )([in0Ave29367,in1Ave29367])
Res25401 = keras.layers.Reshape((2, 2), name = 'Res25401', )(Ave29367)
GRU45703 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU45703', )(Res25401)
Res72024 = keras.layers.Reshape((2, 1), name = 'Res72024', )(GRU45703)
Zer9077 = keras.layers.ZeroPadding1D(padding=((4, 0)), name = 'Zer9077', )(Res72024)
Con4474 = keras.layers.Concatenate(axis=2, name = 'Con4474', )([Zer9077,in0Con4474])
Zer48522 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer48522', )(in0Zer48522)
Res57684 = keras.layers.Reshape((6, 4, 8), name = 'Res57684', )(Zer48522)
Res71504 = keras.layers.Reshape((6, 32), name = 'Res71504', )(Res57684)
Max95793 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max95793', )(Res71504)
Thr74869 = keras.layers.ThresholdedReLU(theta=8.822918433377655, name = 'Thr74869', )(Max95793)
Max86709 = keras.layers.Maximum(name = 'Max86709', )([Con4474,Thr74869])
model = tf.keras.models.Model(inputs=[in0Ave29367,in1Ave29367,in0Con4474,in0Zer48522], outputs=Max86709)
w = model.get_layer('GRU45703').get_weights() 
w[0] = np.array([[4, 7, 3, 2, 4, 3], [8, 10, 3, 5, 6, 3]])
w[1] = np.array([[7, 9, 10, 9, 2, 4], [2, 4, 3, 8, 6, 8]])
w[2] = np.array([[7, 6, 4, 7, 5, 9], [5, 4, 6, 2, 9, 2]])
model.get_layer('GRU45703').set_weights(w) 
in0Ave29367 = tf.constant([[[[0.2172], [0.0496]], [[0.9903], [0.1854]]]])
in1Ave29367 = tf.constant([[[[0.5523], [0.9529]], [[0.9727], [0.5682]]]])
in0Con4474 = tf.constant([[[0.7109, 0.5758, 0.8746, 0.047, 0.4332, 0.8247, 0.556, 0.4991, 0.0056, 0.5849, 0.0907, 0.9961, 0.362, 0.5148, 0.9586, 0.157, 0.1273, 0.8466, 0.1056, 0.7883, 0.0734, 0.6084, 0.2106, 0.2518, 0.4887, 0.9285, 0.8034, 0.0362, 0.5242, 0.992, 0.7809], [0.6519, 0.5764, 0.4158, 0.5605, 0.9844, 0.4226, 0.9038, 0.9726, 0.6718, 0.1295, 0.0494, 0.0023, 0.9043, 0.7279, 0.0647, 0.663, 0.2804, 0.2617, 0.0325, 0.6064, 0.0046, 0.1036, 0.0003, 0.5573, 0.7576, 0.3602, 0.8667, 0.2987, 0.0334, 0.782, 0.545], [0.7251, 0.5984, 0.8422, 0.3331, 0.4354, 0.998, 0.5464, 0.7652, 0.4392, 0.7172, 0.1025, 0.4792, 0.8165, 0.6777, 0.7883, 0.7894, 0.5872, 0.251, 0.2324, 0.7277, 0.6246, 0.8559, 0.8473, 0.285, 0.1743, 0.5143, 0.3437, 0.4677, 0.4341, 0.447, 0.0891], [0.5684, 0.6867, 0.904, 0.5784, 0.7436, 0.6847, 0.944, 0.4301, 0.5881, 0.337, 0.8085, 0.1374, 0.904, 0.2646, 0.8621, 0.2654, 0.268, 0.4582, 0.818, 0.9092, 0.3246, 0.0969, 0.1048, 0.0064, 0.95, 0.5691, 0.7901, 0.5307, 0.5672, 0.8743, 0.4282], [0.6859, 0.9235, 0.8773, 0.5688, 0.9638, 0.5893, 0.3375, 0.4285, 0.3376, 0.2805, 0.2427, 0.4097, 0.9165, 0.8669, 0.7392, 0.7291, 0.1067, 0.5848, 0.8676, 0.4111, 0.6946, 0.5445, 0.3918, 0.2939, 0.2982, 0.0928, 0.2363, 0.5018, 0.3123, 0.9738, 0.44], [0.0401, 0.8218, 0.5146, 0.0708, 0.7874, 0.9463, 0.2571, 0.2553, 0.1794, 0.7382, 0.5545, 0.3242, 0.3037, 0.0643, 0.6563, 0.0954, 0.9607, 0.8648, 0.7173, 0.4801, 0.4812, 0.81, 0.982, 0.9238, 0.7423, 0.6483, 0.121, 0.6785, 0.8681, 0.4774, 0.3256]]])
in0Zer48522 = tf.constant([[[[[1.673, 1.8411], [1.4238, 1.2474]], [[1.6823, 1.53], [1.5373, 1.5162]]], [[[1.6117, 1.5636], [1.4984, 1.4278]], [[1.0215, 1.9389], [1.9187, 1.0809]]], [[[1.4384, 1.3647], [1.0911, 1.5654]], [[1.0516, 1.345], [1.8834, 1.2068]]], [[[1.6736, 1.9194], [1.8835, 1.6055]], [[1.2236, 1.3306], [1.3593, 1.2444]]]]])
print (np.array2string(model.predict([in0Ave29367,in1Ave29367,in0Con4474,in0Zer48522],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max86709.png')

LAve29367 = average_layer([[[[[0.2172], [0.0496]], [[0.9903], [0.1854]]]], [[[[0.5523], [0.9529]], [[0.9727], [0.5682]]]]], Ave29367), 
LRes25401 = reshape_layer(Ave29367, [2, 2], Res25401), 
LGRU45703 = gru_layer(Res25401,[[4, 7, 3, 2, 4, 3], [8, 10, 3, 5, 6, 3]],[[7, 9, 10, 9, 2, 4], [2, 4, 3, 8, 6, 8]],[[7, 6, 4, 7, 5, 9], [5, 4, 6, 2, 9, 2]], true, GRU45703), 
LRes72024 = reshape_layer(GRU45703, [2, 1], Res72024), 
LZer9077 = zero_padding1D_layer(Res72024, 4, 0, Zer9077), 
LCon4474 = concatenate_layer([Zer9077,[[[0.7109, 0.5758, 0.8746, 0.047, 0.4332, 0.8247, 0.556, 0.4991, 0.0056, 0.5849, 0.0907, 0.9961, 0.362, 0.5148, 0.9586, 0.157, 0.1273, 0.8466, 0.1056, 0.7883, 0.0734, 0.6084, 0.2106, 0.2518, 0.4887, 0.9285, 0.8034, 0.0362, 0.5242, 0.992, 0.7809], [0.6519, 0.5764, 0.4158, 0.5605, 0.9844, 0.4226, 0.9038, 0.9726, 0.6718, 0.1295, 0.0494, 0.0023, 0.9043, 0.7279, 0.0647, 0.663, 0.2804, 0.2617, 0.0325, 0.6064, 0.0046, 0.1036, 0.0003, 0.5573, 0.7576, 0.3602, 0.8667, 0.2987, 0.0334, 0.782, 0.545], [0.7251, 0.5984, 0.8422, 0.3331, 0.4354, 0.998, 0.5464, 0.7652, 0.4392, 0.7172, 0.1025, 0.4792, 0.8165, 0.6777, 0.7883, 0.7894, 0.5872, 0.251, 0.2324, 0.7277, 0.6246, 0.8559, 0.8473, 0.285, 0.1743, 0.5143, 0.3437, 0.4677, 0.4341, 0.447, 0.0891], [0.5684, 0.6867, 0.904, 0.5784, 0.7436, 0.6847, 0.944, 0.4301, 0.5881, 0.337, 0.8085, 0.1374, 0.904, 0.2646, 0.8621, 0.2654, 0.268, 0.4582, 0.818, 0.9092, 0.3246, 0.0969, 0.1048, 0.0064, 0.95, 0.5691, 0.7901, 0.5307, 0.5672, 0.8743, 0.4282], [0.6859, 0.9235, 0.8773, 0.5688, 0.9638, 0.5893, 0.3375, 0.4285, 0.3376, 0.2805, 0.2427, 0.4097, 0.9165, 0.8669, 0.7392, 0.7291, 0.1067, 0.5848, 0.8676, 0.4111, 0.6946, 0.5445, 0.3918, 0.2939, 0.2982, 0.0928, 0.2363, 0.5018, 0.3123, 0.9738, 0.44], [0.0401, 0.8218, 0.5146, 0.0708, 0.7874, 0.9463, 0.2571, 0.2553, 0.1794, 0.7382, 0.5545, 0.3242, 0.3037, 0.0643, 0.6563, 0.0954, 0.9607, 0.8648, 0.7173, 0.4801, 0.4812, 0.81, 0.982, 0.9238, 0.7423, 0.6483, 0.121, 0.6785, 0.8681, 0.4774, 0.3256]]]], 2, Con4474), 
LZer48522 = zero_padding3D_layer([[[[[1.673, 1.8411], [1.4238, 1.2474]], [[1.6823, 1.53], [1.5373, 1.5162]]], [[[1.6117, 1.5636], [1.4984, 1.4278]], [[1.0215, 1.9389], [1.9187, 1.0809]]], [[[1.4384, 1.3647], [1.0911, 1.5654]], [[1.0516, 1.345], [1.8834, 1.2068]]], [[[1.6736, 1.9194], [1.8835, 1.6055]], [[1.2236, 1.3306], [1.3593, 1.2444]]]]], 1, 1, 1, 1, 1, 1, Zer48522), 
LRes57684 = reshape_layer(Zer48522, [6, 4, 8], Res57684), 
LRes71504 = reshape_layer(Res57684, [6, 32], Res71504), 
LMax95793 = max_pool1D_layer(Res71504, 1, Max95793), 
LThr74869 = thresholded_relu_layer(Max95793, 8.822918433377655, Thr74869), 
LMax86709 = maximum_layer([Con4474,Thr74869], Max86709), 
exec_layers([LAve29367,LRes25401,LGRU45703,LRes72024,LZer9077,LCon4474,LZer48522,LRes57684,LRes71504,LMax95793,LThr74869,LMax86709],["Ave29367","Res25401","GRU45703","Res72024","Zer9077","Con4474","Zer48522","Res57684","Res71504","Max95793","Thr74869","Max86709"],Max86709,"Max86709")

Actual (Unparsed): [[[0.0000000, 0.7109000, 0.5758000, 0.8746000, 0.0470000, 0.4332000, 0.8247000, 0.5560000, 0.4991000, 0.0056000, 0.5849000, 0.0907000, 0.9961000, 0.3620000, 0.5148000, 0.9586000, 0.1570000, 0.1273000, 0.8466000, 0.1056000, 0.7883000, 0.0734000, 0.6084000, 0.2106000, 0.2518000, 0.4887000, 0.9285000, 0.8034000, 0.0362000, 0.5242000, 0.9920000, 0.7809000], [0.0000000, 0.6519000, 0.5764000, 0.4158000, 0.5605000, 0.9844000, 0.4226000, 0.9038000, 0.9726000, 0.6718000, 0.1295000, 0.0494000, 0.0023000, 0.9043000, 0.7279000, 0.0647000, 0.6630000, 0.2804000, 0.2617000, 0.0325000, 0.6064000, 0.0046000, 0.1036000, 0.0003000, 0.5573000, 0.7576000, 0.3602000, 0.8667000, 0.2987000, 0.0334000, 0.7820000, 0.5450000], [0.0000000, 0.7251000, 0.5984000, 0.8422000, 0.3331000, 0.4354000, 0.9980000, 0.5464000, 0.7652000, 0.4392000, 0.7172000, 0.1025000, 0.4792000, 0.8165000, 0.6777000, 0.7883000, 0.7894000, 0.5872000, 0.2510000, 0.2324000, 0.7277000, 0.6246000, 0.8559000, 0.8473000, 0.2850000, 0.1743000, 0.5143000, 0.3437000, 0.4677000, 0.4341000, 0.4470000, 0.0891000], [0.0000000, 0.5684000, 0.6867000, 0.9040000, 0.5784000, 0.7436000, 0.6847000, 0.9440000, 0.4301000, 0.5881000, 0.3370000, 0.8085000, 0.1374000, 0.9040000, 0.2646000, 0.8621000, 0.2654000, 0.2680000, 0.4582000, 0.8180000, 0.9092000, 0.3246000, 0.0969000, 0.1048000, 0.0064000, 0.9500000, 0.5691000, 0.7901000, 0.5307000, 0.5672000, 0.8743000, 0.4282000], [0.0000000, 0.6859000, 0.9235000, 0.8773000, 0.5688000, 0.9638000, 0.5893000, 0.3375000, 0.4285000, 0.3376000, 0.2805000, 0.2427000, 0.4097000, 0.9165000, 0.8669000, 0.7392000, 0.7291000, 0.1067000, 0.5848000, 0.8676000, 0.4111000, 0.6946000, 0.5445000, 0.3918000, 0.2939000, 0.2982000, 0.0928000, 0.2363000, 0.5018000, 0.3123000, 0.9738000, 0.4400000], [0.0000000, 0.0401000, 0.8218000, 0.5146000, 0.0708000, 0.7874000, 0.9463000, 0.2571000, 0.2553000, 0.1794000, 0.7382000, 0.5545000, 0.3242000, 0.3037000, 0.0643000, 0.6563000, 0.0954000, 0.9607000, 0.8648000, 0.7173000, 0.4801000, 0.4812000, 0.8100000, 0.9820000, 0.9238000, 0.7423000, 0.6483000, 0.1210000, 0.6785000, 0.8681000, 0.4774000, 0.3256000]]]

Expected (Unparsed): [[[0,0.7109,0.5758,0.8746,0.047,0.4332,0.8247,0.556,0.4991,0.0056,0.5849,0.0907,0.9961,0.362,0.5148,0.9586,0.157,0.1273,0.8466,0.1056,0.7883,0.0734,0.6084,0.2106,0.2518,0.4887,0.9285,0.8034,0.0362,0.5242,0.992,0.7809],[0,0.6519,0.5764,0.4158,0.5605,0.9844,0.4226,0.9038,0.9726,0.6718,0.1295,0.0494,0.0023,0.9043,0.7279,0.0647,0.663,0.2804,0.2617,0.0325,0.6064,0.0046,0.1036,0.0003,0.5573,0.7576,0.3602,0.8667,0.2987,0.0334,0.782,0.545],[0,0.7251,0.5984,0.8422,0.3331,0.4354,0.998,0.5464,0.7652,0.4392,0.7172,0.1025,0.4792,0.8165,0.6777,0.7883,0.7894,0.5872,0.251,0.2324,0.7277,0.6246,0.8559,0.8473,0.285,0.1743,0.5143,0.3437,0.4677,0.4341,0.447,0.0891],[0,0.5684,0.6867,0.904,0.5784,0.7436,0.6847,0.944,0.4301,0.5881,0.337,0.8085,0.1374,0.904,0.2646,0.8621,0.2654,0.268,0.4582,0.818,0.9092,0.3246,0.0969,0.1048,0.0064,0.95,0.5691,0.7901,0.5307,0.5672,0.8743,0.4282],[2.985613309017901e-8,0.6859,0.9235,0.8773,0.5688,0.9638,0.5893,0.3375,0.4285,0.3376,0.2805,0.2427,0.4097,0.9165,0.8669,0.7392,0.7291,0.1067,0.5848,0.8676,0.4111,0.6946,0.5445,0.3918,0.2939,0.2982,0.0928,0.2363,0.5018,0.3123,0.9738,0.44],[2.152891240826358e-8,0.0401,0.8218,0.5146,0.0708,0.7874,0.9463,0.2571,0.2553,0.1794,0.7382,0.5545,0.3242,0.3037,0.0643,0.6563,0.0954,0.9607,0.8648,0.7173,0.4801,0.4812,0.81,0.982,0.9238,0.7423,0.6483,0.121,0.6785,0.8681,0.4774,0.3256]]]

Actual:   [[[0, 0.7109, 0.5758, 0.8746, 0.047, 0.4332, 0.8247, 0.556, 0.4991, 0.0056, 0.5849, 0.0907, 0.9961, 0.362, 0.5148, 0.9586, 0.157, 0.1273, 0.8466, 0.1056, 0.7883, 0.0734, 0.6084, 0.2106, 0.2518, 0.4887, 0.9285, 0.8034, 0.0362, 0.5242, 0.992, 0.7809], [0, 0.6519, 0.5764, 0.4158, 0.5605, 0.9844, 0.4226, 0.9038, 0.9726, 0.6718, 0.1295, 0.0494, 0.0023, 0.9043, 0.7279, 0.0647, 0.663, 0.2804, 0.2617, 0.0325, 0.6064, 0.0046, 0.1036, 0.0003, 0.5573, 0.7576, 0.3602, 0.8667, 0.2987, 0.0334, 0.782, 0.545], [0, 0.7251, 0.5984, 0.8422, 0.3331, 0.4354, 0.998, 0.5464, 0.7652, 0.4392, 0.7172, 0.1025, 0.4792, 0.8165, 0.6777, 0.7883, 0.7894, 0.5872, 0.251, 0.2324, 0.7277, 0.6246, 0.8559, 0.8473, 0.285, 0.1743, 0.5143, 0.3437, 0.4677, 0.4341, 0.447, 0.0891], [0, 0.5684, 0.6867, 0.904, 0.5784, 0.7436, 0.6847, 0.944, 0.4301, 0.5881, 0.337, 0.8085, 0.1374, 0.904, 0.2646, 0.8621, 0.2654, 0.268, 0.4582, 0.818, 0.9092, 0.3246, 0.0969, 0.1048, 0.0064, 0.95, 0.5691, 0.7901, 0.5307, 0.5672, 0.8743, 0.4282], [0, 0.6859, 0.9235, 0.8773, 0.5688, 0.9638, 0.5893, 0.3375, 0.4285, 0.3376, 0.2805, 0.2427, 0.4097, 0.9165, 0.8669, 0.7392, 0.7291, 0.1067, 0.5848, 0.8676, 0.4111, 0.6946, 0.5445, 0.3918, 0.2939, 0.2982, 0.0928, 0.2363, 0.5018, 0.3123, 0.9738, 0.44], [0, 0.0401, 0.8218, 0.5146, 0.0708, 0.7874, 0.9463, 0.2571, 0.2553, 0.1794, 0.7382, 0.5545, 0.3242, 0.3037, 0.0643, 0.6563, 0.0954, 0.9607, 0.8648, 0.7173, 0.4801, 0.4812, 0.81, 0.982, 0.9238, 0.7423, 0.6483, 0.121, 0.6785, 0.8681, 0.4774, 0.3256]]]

Expected: [[[0, 0.7109, 0.5758, 0.8746, 0.047, 0.4332, 0.8247, 0.556, 0.4991, 0.0056, 0.5849, 0.0907, 0.9961, 0.362, 0.5148, 0.9586, 0.157, 0.1273, 0.8466, 0.1056, 0.7883, 0.0734, 0.6084, 0.2106, 0.2518, 0.4887, 0.9285, 0.8034, 0.0362, 0.5242, 0.992, 0.7809], [0, 0.6519, 0.5764, 0.4158, 0.5605, 0.9844, 0.4226, 0.9038, 0.9726, 0.6718, 0.1295, 0.0494, 0.0023, 0.9043, 0.7279, 0.0647, 0.663, 0.2804, 0.2617, 0.0325, 0.6064, 0.0046, 0.1036, 0.0003, 0.5573, 0.7576, 0.3602, 0.8667, 0.2987, 0.0334, 0.782, 0.545], [0, 0.7251, 0.5984, 0.8422, 0.3331, 0.4354, 0.998, 0.5464, 0.7652, 0.4392, 0.7172, 0.1025, 0.4792, 0.8165, 0.6777, 0.7883, 0.7894, 0.5872, 0.251, 0.2324, 0.7277, 0.6246, 0.8559, 0.8473, 0.285, 0.1743, 0.5143, 0.3437, 0.4677, 0.4341, 0.447, 0.0891], [0, 0.5684, 0.6867, 0.904, 0.5784, 0.7436, 0.6847, 0.944, 0.4301, 0.5881, 0.337, 0.8085, 0.1374, 0.904, 0.2646, 0.8621, 0.2654, 0.268, 0.4582, 0.818, 0.9092, 0.3246, 0.0969, 0.1048, 0.0064, 0.95, 0.5691, 0.7901, 0.5307, 0.5672, 0.8743, 0.4282], [0, 0.6859, 0.9235, 0.8773, 0.5688, 0.9638, 0.5893, 0.3375, 0.4285, 0.3376, 0.2805, 0.2427, 0.4097, 0.9165, 0.8669, 0.7392, 0.7291, 0.1067, 0.5848, 0.8676, 0.4111, 0.6946, 0.5445, 0.3918, 0.2939, 0.2982, 0.0928, 0.2363, 0.5018, 0.3123, 0.9738, 0.44], [0, 0.0401, 0.8218, 0.5146, 0.0708, 0.7874, 0.9463, 0.2571, 0.2553, 0.1794, 0.7382, 0.5545, 0.3242, 0.3037, 0.0643, 0.6563, 0.0954, 0.9607, 0.8648, 0.7173, 0.4801, 0.4812, 0.81, 0.982, 0.9238, 0.7423, 0.6483, 0.121, 0.6785, 0.8681, 0.4774, 0.3256]]]