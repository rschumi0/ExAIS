import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add69261 = tf.keras.layers.Input(shape=([2, 2]))
in1Add69261 = tf.keras.layers.Input(shape=([2, 2]))
in0Bat40908 = tf.keras.layers.Input(shape=([2, 2]))

Add69261 = keras.layers.Add(name = 'Add69261', )([in0Add69261,in1Add69261])
Bat40908 = keras.layers.BatchNormalization(axis=2, epsilon=0.154262573911261,  name = 'Bat40908', )(in0Bat40908)
Per44044 = keras.layers.Permute((1,2), name = 'Per44044',)(Bat40908)
Sub87205 = keras.layers.Subtract(name = 'Sub87205', )([Add69261,Per44044])
Max89991 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max89991', )(Sub87205)
model = tf.keras.models.Model(inputs=[in0Add69261,in1Add69261,in0Bat40908], outputs=Max89991)
w = model.get_layer('Bat40908').get_weights() 
w[0] = np.array([0.2956, 0.3794])
w[1] = np.array([0.5846, 0.8276])
w[2] = np.array([0.4777, 0.1834])
w[3] = np.array([0.4672, 0.0497])
model.get_layer('Bat40908').set_weights(w) 
in0Add69261 = tf.constant([[[0.7, 0.087], [0.5833, 0.0212]]])
in1Add69261 = tf.constant([[[0.416, 0.4788], [0.6229, 0.2822]]])
in0Bat40908 = tf.constant([[[1.5565, 1.1547], [1.7074, 1.2011]]])
print (np.array2string(model.predict([in0Add69261,in1Add69261,in0Bat40908],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max89991.png')

LAdd69261 = add_layer([[[[0.7, 0.087], [0.5833, 0.0212]]], [[[0.416, 0.4788], [0.6229, 0.2822]]]], Add69261), 
LBat40908 = batch_normalization_layer([[[1.5565, 1.1547], [1.7074, 1.2011]]], 2, 0.154262573911261, [0.2956, 0.3794], [0.5846, 0.8276], [0.4777, 0.1834], [0.4672, 0.0497], Bat40908), 
LPer44044 = permute_layer(Bat40908, 1,2, Per44044), 
LSub87205 = subtract_layer(Add69261,Per44044, Sub87205), 
LMax89991 = max_pool1D_layer(Sub87205, 1, Max89991), 
exec_layers([LAdd69261,LBat40908,LPer44044,LSub87205,LMax89991],["Add69261","Bat40908","Per44044","Sub87205","Max89991"],Max89991,"Max89991")

Actual (Unparsed): [[[0.1268820, -1.0777724], [0.1604990, -1.3791522]]]

Expected (Unparsed): [[[0.12688197537558943,-1.0777724078811053],[0.1604989480157235,-1.3791522490482868]]]

Actual:   [[[0.1269, -1.0777], [0.1605, -1.3791]]]

Expected: [[[0.1269, -1.0777], [0.1605, -1.3791]]]