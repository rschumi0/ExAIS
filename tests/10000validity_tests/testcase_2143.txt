import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul61170 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Mul61170 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))

Mul61170 = keras.layers.Multiply(name = 'Mul61170', )([in0Mul61170,in1Mul61170])
Sof69750 = keras.layers.Softmax(axis=1, name = 'Sof69750', )(Mul61170)
Res46353 = keras.layers.Reshape((2, 2, 4), name = 'Res46353', )(Sof69750)
Res35301 = keras.layers.Reshape((2, 8), name = 'Res35301', )(Res46353)
Per980 = keras.layers.Permute((2,1), name = 'Per980',)(Res35301)
model = tf.keras.models.Model(inputs=[in0Mul61170,in1Mul61170], outputs=Per980)
in0Mul61170 = tf.constant([[[[[0.3316, 0.7157], [0.9964, 0.689]], [[0.9416, 0.3325], [0.8808, 0.9325]]], [[[0.0266, 0.6907], [0.0703, 0.8365]], [[0.9526, 0.452], [0.1292, 0.6871]]]]])
in1Mul61170 = tf.constant([[[[[0.5525, 0.0566], [0.7264, 0.6502]], [[0.6653, 0.0104], [0.3146, 0.1293]]], [[[0.3457, 0.0588], [0.2933, 0.4059]], [[0.7897, 0.9725], [0.4001, 0.8036]]]]])
print (np.array2string(model.predict([in0Mul61170,in1Mul61170],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Per980.png')

LMul61170 = multiply_layer([[[[[[0.3316, 0.7157], [0.9964, 0.689]], [[0.9416, 0.3325], [0.8808, 0.9325]]], [[[0.0266, 0.6907], [0.0703, 0.8365]], [[0.9526, 0.452], [0.1292, 0.6871]]]]], [[[[[0.5525, 0.0566], [0.7264, 0.6502]], [[0.6653, 0.0104], [0.3146, 0.1293]]], [[[0.3457, 0.0588], [0.2933, 0.4059]], [[0.7897, 0.9725], [0.4001, 0.8036]]]]]], Mul61170), 
LSof69750 = softmax_layer(Mul61170, 1, Sof69750), 
LRes46353 = reshape_layer(Sof69750, [2, 2, 4], Res46353), 
LRes35301 = reshape_layer(Res46353, [2, 8], Res35301), 
LPer980 = permute_layer(Res35301, 2,1, Per980), 
exec_layers([LMul61170,LSof69750,LRes46353,LRes35301,LPer980],["Mul61170","Sof69750","Res46353","Res35301","Per980"],Per980,"Per980")

Actual (Unparsed): [[[0.5433939, 0.4566061], [0.4999739, 0.5000261], [0.6688893, 0.3311107], [0.5270866, 0.4729134], [0.4685860, 0.5314140], [0.3926678, 0.6073322], [0.5561143, 0.4438857], [0.3937488, 0.6062512]]]

Expected (Unparsed): [[[0.5433939005727154,0.4566060994272846],[0.49997386500002383,0.5000261349999762],[0.6688893343216046,0.33111066567839537],[0.5270865685006606,0.4729134314993394],[0.46858599728097305,0.5314140027190268],[0.3926677907664649,0.6073322092335351],[0.5561143020231877,0.44388569797681243],[0.3937487926274268,0.6062512073725732]]]

Actual:   [[[0.5434, 0.4567], [0.5, 0.5001], [0.6689, 0.3312], [0.5271, 0.473], [0.4686, 0.5315], [0.3927, 0.6074], [0.5562, 0.4439], [0.3938, 0.6063]]]

Expected: [[[0.5434, 0.4567], [0.5, 0.5001], [0.6689, 0.3312], [0.5271, 0.473], [0.4686, 0.5315], [0.3927, 0.6074], [0.5562, 0.4439], [0.3938, 0.6063]]]