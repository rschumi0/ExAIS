import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub46513 = tf.keras.layers.Input(shape=([3, 3]))
in1Sub46513 = tf.keras.layers.Input(shape=([3, 3]))
in0Con34244 = tf.keras.layers.Input(shape=([3, 1]))
in0Cro40490 = tf.keras.layers.Input(shape=([4, 4]))
in0Dot3489 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot3489 = tf.keras.layers.Input(shape=([2, 2]))
in0Con6787 = tf.keras.layers.Input(shape=([4]))

Sub46513 = keras.layers.Subtract(name = 'Sub46513', )([in0Sub46513,in1Sub46513])
Con34244 = keras.layers.Concatenate(axis=2, name = 'Con34244', )([Sub46513,in0Con34244])
Cro40490 = keras.layers.Cropping1D(cropping=((1, 1)), name = 'Cro40490', )(in0Cro40490)
Dot19250 = keras.layers.Dot(axes=(2, 2), name = 'Dot19250', )([Con34244,Cro40490])
Fla7190 = keras.layers.Flatten(name = 'Fla7190', )(Dot19250)
Dot3489 = keras.layers.Dot(axes=(1, 1), name = 'Dot3489', )([in0Dot3489,in1Dot3489])
Res98878 = keras.layers.Reshape((2, 2, 1), name = 'Res98878', )(Dot3489)
Loc52013 = keras.layers.LocallyConnected2D(3, (1, 1),strides=(1, 1), name = 'Loc52013', )(Res98878)
Res70605 = keras.layers.Reshape((2, 6), name = 'Res70605', )(Loc52013)
LST75682 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST75682', )(Res70605)
Con6787 = keras.layers.Concatenate(axis=1, name = 'Con6787', )([LST75682,in0Con6787])
Mul30100 = keras.layers.Multiply(name = 'Mul30100', )([Fla7190,Con6787])
model = tf.keras.models.Model(inputs=[in0Sub46513,in1Sub46513,in0Con34244,in0Cro40490,in0Dot3489,in1Dot3489,in0Con6787], outputs=Mul30100)
w = model.get_layer('Loc52013').get_weights() 
w[0] = np.array([[[0.933, 0.6151, 0.4457]], [[0.7377, 0.9578, 0.2396]], [[0.3497, 0.4807, 0.5617]], [[0.1714, 0.9584, 0.7878]]])
w[1] = np.array([[[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0, 0]]])
model.get_layer('Loc52013').set_weights(w) 
w = model.get_layer('LST75682').get_weights() 
w[0] = np.array([[1, 1, 7, 3, 3, 7, 7, 5], [9, 5, 2, 1, 5, 10, 6, 5], [1, 6, 3, 10, 3, 1, 1, 9], [7, 9, 5, 4, 1, 7, 9, 4], [8, 6, 10, 5, 8, 2, 9, 5], [8, 10, 1, 6, 1, 2, 10, 3]])
w[1] = np.array([[6, 10, 3, 9, 5, 2, 3, 2], [8, 2, 3, 1, 8, 2, 6, 3]])
w[2] = np.array([6, 10, 5, 1, 10, 8, 8, 5])
model.get_layer('LST75682').set_weights(w) 
in0Sub46513 = tf.constant([[[0.5999, 0.7783, 0.8275], [0.1411, 0.818, 0.9316], [0.7954, 0.2727, 0.7716]]])
in1Sub46513 = tf.constant([[[0.3618, 0.1644, 0.7379], [0.3018, 0.626, 0.9347], [0.8569, 0.5926, 0.2985]]])
in0Con34244 = tf.constant([[[0.3935], [0.5928], [0.5146]]])
in0Cro40490 = tf.constant([[[1.205, 1.0487, 1.0018, 1.9726], [1.2535, 1.6123, 1.9614, 1.3411], [1.5125, 1.6325, 1.5242, 1.9087], [1.3886, 1.0373, 1.2312, 1.75]]])
in0Dot3489 = tf.constant([[[0.3025, 0.1443], [0.981, 0.736]]])
in1Dot3489 = tf.constant([[[0.1609, 0.9951], [0.4907, 0.8239]]])
in0Con6787 = tf.constant([[0.0896, 0.9765, 0.1211, 0.8927]])
print (np.array2string(model.predict([in0Sub46513,in1Sub46513,in0Con34244,in0Cro40490,in0Dot3489,in1Dot3489,in0Con6787],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul30100.png')

LSub46513 = subtract_layer([[[0.5999, 0.7783, 0.8275], [0.1411, 0.818, 0.9316], [0.7954, 0.2727, 0.7716]]], [[[0.3618, 0.1644, 0.7379], [0.3018, 0.626, 0.9347], [0.8569, 0.5926, 0.2985]]], Sub46513), 
LCon34244 = concatenate_layer([Sub46513,[[[0.3935], [0.5928], [0.5146]]]], 2, Con34244), 
LCro40490 = cropping1D_layer([[[1.205, 1.0487, 1.0018, 1.9726], [1.2535, 1.6123, 1.9614, 1.3411], [1.5125, 1.6325, 1.5242, 1.9087], [1.3886, 1.0373, 1.2312, 1.75]]], 1, 1, Cro40490), 
LDot19250 = dot_layer(Con34244,Cro40490, 2, 2, Dot19250), 
LFla7190 = flatten_layer(Dot19250, Fla7190), 
LDot3489 = dot_layer([[[0.3025, 0.1443], [0.981, 0.736]]], [[[0.1609, 0.9951], [0.4907, 0.8239]]], 1, 1, Dot3489), 
LRes98878 = reshape_layer(Dot3489, [2, 2, 1], Res98878), 
LLoc52013 = locally_connected2D_layer(Res98878, 1, 1,[[[0.933, 0.6151, 0.4457]], [[0.7377, 0.9578, 0.2396]], [[0.3497, 0.4807, 0.5617]], [[0.1714, 0.9584, 0.7878]]],[[[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0, 0]]], 1, 1, Loc52013), 
LRes70605 = reshape_layer(Loc52013, [2, 6], Res70605), 
LLST75682 = lstm_layer(Res70605,[[1, 1, 7, 3, 3, 7, 7, 5], [9, 5, 2, 1, 5, 10, 6, 5], [1, 6, 3, 10, 3, 1, 1, 9], [7, 9, 5, 4, 1, 7, 9, 4], [8, 6, 10, 5, 8, 2, 9, 5], [8, 10, 1, 6, 1, 2, 10, 3]],[[6, 10, 3, 9, 5, 2, 3, 2], [8, 2, 3, 1, 8, 2, 6, 3]],[6, 10, 5, 1, 10, 8, 8, 5], LST75682), 
LCon6787 = concatenate_layer([LST75682,[[0.0896, 0.9765, 0.1211, 0.8927]]], 1, Con6787), 
LMul30100 = multiply_layer([Fla7190,Con6787], Mul30100), 
exec_layers([LSub46513,LCon34244,LCro40490,LDot19250,LFla7190,LDot3489,LRes98878,LLoc52013,LRes70605,LLST75682,LCon6787,LMul30100],["Sub46513","Con34244","Cro40490","Dot19250","Fla7190","Dot3489","Res98878","Loc52013","Res70605","LST75682","Con6787","Mul30100"],Mul30100,"Mul30100")

Actual (Unparsed): [[1.9200668, 2.1690232, 0.0803755, 1.1690009, 0.1241521, 0.9713117]]

Expected (Unparsed): [[1.920066851346384,2.169023245155537,0.080375490944,1.169000950635,0.12415212931799997,0.971311644058]]

Actual:   [[1.9201, 2.1691, 0.0804, 1.1691, 0.1242, 0.9714]]

Expected: [[1.9201, 2.1691, 0.0804, 1.1691, 0.1242, 0.9714]]