import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con72797 = tf.keras.layers.Input(shape=([2, 1]))
in0Con96432 = tf.keras.layers.Input(shape=([4]))
in0Sub28341 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub28341 = tf.keras.layers.Input(shape=([2, 3]))
in0Glo61202 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con2085 = tf.keras.layers.Input(shape=([4]))

Con72797 = keras.layers.Conv1D(2, (2),strides=(1), padding='valid', dilation_rate=(1), name = 'Con72797', )(in0Con72797)
Fla34751 = keras.layers.Flatten(name = 'Fla34751', )(Con72797)
Con96432 = keras.layers.Concatenate(axis=1, name = 'Con96432', )([Fla34751,in0Con96432])
Sub28341 = keras.layers.Subtract(name = 'Sub28341', )([in0Sub28341,in1Sub28341])
Fla47340 = keras.layers.Flatten(name = 'Fla47340', )(Sub28341)
Glo61202 = keras.layers.GlobalMaxPool2D(name = 'Glo61202', )(in0Glo61202)
Con2085 = keras.layers.Concatenate(axis=1, name = 'Con2085', )([Glo61202,in0Con2085])
Max58790 = keras.layers.Maximum(name = 'Max58790', )([Fla47340,Con2085])
Mul16213 = keras.layers.Multiply(name = 'Mul16213', )([Con96432,Max58790])
Res92070 = keras.layers.Reshape((6, 1), name = 'Res92070', )(Mul16213)
Res35211 = keras.layers.Reshape((6, 1, 1), name = 'Res35211', )(Res92070)
Res14276 = keras.layers.Reshape((6, 1, 1, 1), name = 'Res14276', )(Res35211)
Glo65651 = keras.layers.GlobalMaxPool3D(name = 'Glo65651', )(Res14276)
model = tf.keras.models.Model(inputs=[in0Con72797,in0Con96432,in0Sub28341,in1Sub28341,in0Glo61202,in0Con2085], outputs=Glo65651)
w = model.get_layer('Con72797').get_weights() 
w[0] = np.array([[[0.5372, 0.3569]], [[0.4701, 0.1015]]])
w[1] = np.array([0, 0])
model.get_layer('Con72797').set_weights(w) 
in0Con72797 = tf.constant([[[0.5959], [0.5643]]])
in0Con96432 = tf.constant([[0.6147, 0.6798, 0.7307, 0.7521]])
in0Sub28341 = tf.constant([[[0.5524, 0.6334, 0.8304], [0.0895, 0.7729, 0.2692]]])
in1Sub28341 = tf.constant([[[0.3903, 0.1533, 0.5104], [0.3331, 0.1584, 0.2205]]])
in0Glo61202 = tf.constant([[[[1.2079, 1.5411], [1.393, 1.1485]]]])
in0Con2085 = tf.constant([[0.4478, 0.2867, 0.1805, 0.2347]])
print (np.array2string(model.predict([in0Con72797,in0Con96432,in0Sub28341,in1Sub28341,in0Glo61202,in0Con2085],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo65651.png')

LCon72797 = conv1D_layer([[[0.5959], [0.5643]]], 2,[[[0.5372, 0.3569]], [[0.4701, 0.1015]]],[0, 0], 1, false, 1, Con72797), 
LFla34751 = flatten_layer(Con72797, Fla34751), 
LCon96432 = concatenate_layer([Fla34751,[[0.6147, 0.6798, 0.7307, 0.7521]]], 1, Con96432), 
LSub28341 = subtract_layer([[[0.5524, 0.6334, 0.8304], [0.0895, 0.7729, 0.2692]]], [[[0.3903, 0.1533, 0.5104], [0.3331, 0.1584, 0.2205]]], Sub28341), 
LFla47340 = flatten_layer(Sub28341, Fla47340), 
LGlo61202 = global_max_pool2D_layer([[[[1.2079, 1.5411], [1.393, 1.1485]]]], Glo61202), 
LCon2085 = concatenate_layer([Glo61202,[[0.4478, 0.2867, 0.1805, 0.2347]]], 1, Con2085), 
LMax58790 = maximum_layer([Fla47340,Con2085], Max58790), 
LMul16213 = multiply_layer([Con96432,Max58790], Mul16213), 
LRes92070 = reshape_layer(Mul16213, [6, 1], Res92070), 
LRes35211 = reshape_layer(Res92070, [6, 1, 1], Res35211), 
LRes14276 = reshape_layer(Res35211, [6, 1, 1, 1], Res14276), 
LGlo65651 = global_max_pool3D_layer(Res14276, Glo65651), 
exec_layers([LCon72797,LFla34751,LCon96432,LSub28341,LFla47340,LGlo61202,LCon2085,LMax58790,LMul16213,LRes92070,LRes35211,LRes14276,LGlo65651],["Con72797","Fla34751","Con96432","Sub28341","Fla47340","Glo61202","Con2085","Max58790","Mul16213","Res92070","Res35211","Res14276","Glo65651"],Glo65651,"Glo65651")

Actual (Unparsed): [[0.8154551]]

Expected (Unparsed): [[0.81545510963]]

Actual:   [[0.8155]]

Expected: [[0.8155]]