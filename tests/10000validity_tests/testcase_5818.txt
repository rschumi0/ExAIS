import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo4556 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Zer5899 = tf.keras.layers.Input(shape=([1, 4, 3]))

Glo4556 = keras.layers.GlobalMaxPool3D(name = 'Glo4556', )(in0Glo4556)
Res27079 = keras.layers.Reshape((2, 1), name = 'Res27079', )(Glo4556)
Res21547 = keras.layers.Reshape((2, 1, 1), name = 'Res21547', )(Res27079)
Res7432 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res7432', )(Res21547)
Glo78044 = keras.layers.GlobalMaxPool3D(name = 'Glo78044', )(Res7432)
Res30858 = keras.layers.Reshape((1, 1), name = 'Res30858', )(Glo78044)
Zer66429 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer66429', )(Res30858)
Zer5899 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer5899', )(in0Zer5899)
Den70974 = keras.layers.Dense(3,name = 'Den70974', )(Zer5899)
Res22821 = keras.layers.Reshape((3, 18), name = 'Res22821', )(Den70974)
Dot65536 = keras.layers.Dot(axes=(1, 1), name = 'Dot65536', )([Zer66429,Res22821])
model = tf.keras.models.Model(inputs=[in0Glo4556,in0Zer5899], outputs=Dot65536)
w = model.get_layer('Den70974').get_weights() 
w[0] = np.array([[0.7402, 0.4918, 0.1631], [0.6924, 0.553, 0.5298], [0.5789, 0.0915, 0.7221]])
w[1] = np.array([0.4343, 0.6757, 0.3685])
model.get_layer('Den70974').set_weights(w) 
in0Glo4556 = tf.constant([[[[[1.6984, 1.1567]]], [[[1.9088, 1.6283]]]]])
in0Zer5899 = tf.constant([[[[1.15, 1.6656, 1.7079], [1.0902, 1.9157, 1.5675], [1.7128, 1.5274, 1.571], [1.9935, 1.5604, 1.2694]]]])
print (np.array2string(model.predict([in0Glo4556,in0Zer5899],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot65536.png')

LGlo4556 = global_max_pool3D_layer([[[[[1.6984, 1.1567]]], [[[1.9088, 1.6283]]]]], Glo4556), 
LRes27079 = reshape_layer(Glo4556, [2, 1], Res27079), 
LRes21547 = reshape_layer(Res27079, [2, 1, 1], Res21547), 
LRes7432 = reshape_layer(Res21547, [2, 1, 1, 1], Res7432), 
LGlo78044 = global_max_pool3D_layer(Res7432, Glo78044), 
LRes30858 = reshape_layer(Glo78044, [1, 1], Res30858), 
LZer66429 = zero_padding1D_layer(Res30858, 2, 0, Zer66429), 
LZer5899 = zero_padding2D_layer([[[[1.15, 1.6656, 1.7079], [1.0902, 1.9157, 1.5675], [1.7128, 1.5274, 1.571], [1.9935, 1.5604, 1.2694]]]], 1, 1, 1, 1, Zer5899), 
LDen70974 = dense_layer(Zer5899, [[0.7402, 0.4918, 0.1631], [0.6924, 0.553, 0.5298], [0.5789, 0.0915, 0.7221]],[0.4343, 0.6757, 0.3685], Den70974), 
LRes22821 = reshape_layer(Den70974, [3, 18], Res22821), 
LDot65536 = dot_layer(Zer66429,Res22821, 1, 1, Dot65536), 
exec_layers([LGlo4556,LRes27079,LRes21547,LRes7432,LGlo78044,LRes30858,LZer66429,LZer5899,LDen70974,LRes22821,LDot65536],["Glo4556","Res27079","Res21547","Res7432","Glo78044","Res30858","Zer66429","Zer5899","Den70974","Res22821","Dot65536"],Dot65536,"Dot65536")

Actual (Unparsed): [[[0.8289918, 1.2897762, 0.7033928, 0.8289918, 1.2897762, 0.7033928, 0.8289918, 1.2897762, 0.7033928, 0.8289918, 1.2897762, 0.7033928, 0.8289918, 1.2897762, 0.7033928, 0.8289918, 1.2897762, 0.7033928]]]

Expected (Unparsed): [[[0.82899184,1.28977616,0.7033928,0.82899184,1.28977616,0.7033928,0.82899184,1.28977616,0.7033928,0.82899184,1.28977616,0.7033928,0.82899184,1.28977616,0.7033928,0.82899184,1.28977616,0.7033928]]]

Actual:   [[[0.829, 1.2898, 0.7034, 0.829, 1.2898, 0.7034, 0.829, 1.2898, 0.7034, 0.829, 1.2898, 0.7034, 0.829, 1.2898, 0.7034, 0.829, 1.2898, 0.7034]]]

Expected: [[[0.829, 1.2898, 0.7034, 0.829, 1.2898, 0.7034, 0.829, 1.2898, 0.7034, 0.829, 1.2898, 0.7034, 0.829, 1.2898, 0.7034, 0.829, 1.2898, 0.7034]]]