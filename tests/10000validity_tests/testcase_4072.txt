import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave85238 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Ave85238 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con92375 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Sub55360 = tf.keras.layers.Input(shape=([3, 3, 2]))
in1Sub55360 = tf.keras.layers.Input(shape=([3, 3, 2]))
in0Mul77694 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Mul77694 = tf.keras.layers.Input(shape=([2, 2, 2]))

Ave85238 = keras.layers.Average(name = 'Ave85238', )([in0Ave85238,in1Ave85238])
Zer22040 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer22040', )(Ave85238)
Con92375 = keras.layers.Concatenate(axis=3, name = 'Con92375', )([Zer22040,in0Con92375])
Sub55360 = keras.layers.Subtract(name = 'Sub55360', )([in0Sub55360,in1Sub55360])
Sub75286 = keras.layers.Subtract(name = 'Sub75286', )([Con92375,Sub55360])
Mul77694 = keras.layers.Multiply(name = 'Mul77694', )([in0Mul77694,in1Mul77694])
Loc26950 = keras.layers.LocallyConnected2D(2, (2, 1),strides=(1, 1), name = 'Loc26950', )(Mul77694)
Zer66974 = keras.layers.ZeroPadding2D(padding=((2, 0), (1, 0)), name = 'Zer66974', )(Loc26950)
Sub97334 = keras.layers.Subtract(name = 'Sub97334', )([Sub75286,Zer66974])
model = tf.keras.models.Model(inputs=[in0Ave85238,in1Ave85238,in0Con92375,in0Sub55360,in1Sub55360,in0Mul77694,in1Mul77694], outputs=Sub97334)
w = model.get_layer('Loc26950').get_weights() 
w[0] = np.array([[[0.2148, 0.5646], [0.4355, 0.7748], [0.1852, 0.0839], [0.5928, 0.92]], [[0.5271, 0.5495], [0.0014, 0.8478], [0.23, 0.645], [0.4165, 0.2962]]])
w[1] = np.array([[[0, 0], [0, 0]]])
model.get_layer('Loc26950').set_weights(w) 
in0Ave85238 = tf.constant([[[[0.795]], [[0.8738]]]])
in1Ave85238 = tf.constant([[[[0.8545]], [[0.8419]]]])
in0Con92375 = tf.constant([[[[0.6039], [0.481], [0.1262]], [[0.4868], [0.9842], [0.6519]], [[0.7716], [0.6856], [0.0234]]]])
in0Sub55360 = tf.constant([[[[0.9972, 0.4724], [0.5695, 0.4377], [0.5969, 0.9455]], [[0.3994, 0.5502], [0.1078, 0.5673], [0.3643, 0.0047]], [[0.2768, 0.85], [0.1119, 0.7976], [0.9883, 0.926]]]])
in1Sub55360 = tf.constant([[[[0.0887, 0.3851], [0.3958, 0.9646], [0.34, 0.2083]], [[0.7982, 0.9395], [0.7947, 0.1659], [0.8441, 0.0521]], [[0.8574, 0.2512], [0.7521, 0.3805], [0.6189, 0.8468]]]])
in0Mul77694 = tf.constant([[[[0.3704, 0.8707], [0.0259, 0.2398]], [[0.061, 0.6197], [0.901, 0.7593]]]])
in1Mul77694 = tf.constant([[[[0.5929, 0.5051], [0.7946, 0.5695]], [[0.4536, 0.6118], [0.2675, 0.5532]]]])
print (np.array2string(model.predict([in0Ave85238,in1Ave85238,in0Con92375,in0Sub55360,in1Sub55360,in0Mul77694,in1Mul77694],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub97334.png')

LAve85238 = average_layer([[[[[0.795]], [[0.8738]]]], [[[[0.8545]], [[0.8419]]]]], Ave85238), 
LZer22040 = zero_padding2D_layer(Ave85238, 1, 0, 2, 0, Zer22040), 
LCon92375 = concatenate_layer([Zer22040,[[[[0.6039], [0.481], [0.1262]], [[0.4868], [0.9842], [0.6519]], [[0.7716], [0.6856], [0.0234]]]]], 3, Con92375), 
LSub55360 = subtract_layer([[[[0.9972, 0.4724], [0.5695, 0.4377], [0.5969, 0.9455]], [[0.3994, 0.5502], [0.1078, 0.5673], [0.3643, 0.0047]], [[0.2768, 0.85], [0.1119, 0.7976], [0.9883, 0.926]]]], [[[[0.0887, 0.3851], [0.3958, 0.9646], [0.34, 0.2083]], [[0.7982, 0.9395], [0.7947, 0.1659], [0.8441, 0.0521]], [[0.8574, 0.2512], [0.7521, 0.3805], [0.6189, 0.8468]]]], Sub55360), 
LSub75286 = subtract_layer(Con92375,Sub55360, Sub75286), 
LMul77694 = multiply_layer([[[[[0.3704, 0.8707], [0.0259, 0.2398]], [[0.061, 0.6197], [0.901, 0.7593]]]], [[[[0.5929, 0.5051], [0.7946, 0.5695]], [[0.4536, 0.6118], [0.2675, 0.5532]]]]], Mul77694), 
LLoc26950 = locally_connected2D_layer(Mul77694, 2, 1,[[[0.2148, 0.5646], [0.4355, 0.7748], [0.1852, 0.0839], [0.5928, 0.92]], [[0.5271, 0.5495], [0.0014, 0.8478], [0.23, 0.645], [0.4165, 0.2962]]],[[[0, 0], [0, 0]]], 1, 1, Loc26950), 
LZer66974 = zero_padding2D_layer(Loc26950, 2, 0, 1, 0, Zer66974), 
LSub97334 = subtract_layer(Sub75286,Zer66974, Sub97334), 
exec_layers([LAve85238,LZer22040,LCon92375,LSub55360,LSub75286,LMul77694,LLoc26950,LZer66974,LSub97334],["Ave85238","Zer22040","Con92375","Sub55360","Sub75286","Mul77694","Loc26950","Zer66974","Sub97334"],Sub97334,"Sub97334")

Actual (Unparsed): [[[[-0.9085000, 0.5166000], [-0.1737000, 1.0079000], [-0.2569000, -0.6110000]], [[0.3988000, 0.8761000], [0.6869000, 0.5828000], [1.3045500, 0.6993000]], [[0.5806000, 0.1728000], [0.1716248, -0.5473650], [0.2470283, -0.4627631]]]]

Expected (Unparsed): [[[[-0.9085,0.5166],[-0.17370000000000002,1.0079],[-0.25689999999999996,-0.611]],[[0.39880000000000004,0.8761],[0.6869,0.5828],[1.30455,0.6993]],[[0.5806,0.17279999999999995],[0.171624812189,-0.547364972612],[0.24702834812600005,-0.46276307192200006]]]]

Actual:   [[[[-0.9085, 0.5166], [-0.1737, 1.0079], [-0.2569, -0.611]], [[0.3988, 0.8761], [0.6869, 0.5828], [1.3046, 0.6993]], [[0.5806, 0.1728], [0.1717, -0.5473], [0.2471, -0.4627]]]]

Expected: [[[[-0.9085, 0.5166], [-0.1737, 1.0079], [-0.2568, -0.611]], [[0.3989, 0.8761], [0.6869, 0.5828], [1.3046, 0.6993]], [[0.5806, 0.1728], [0.1717, -0.5473], [0.2471, -0.4627]]]]