import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo93386 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Loc64777 = tf.keras.layers.Input(shape=([2, 1]))
in0Con38122 = tf.keras.layers.Input(shape=([2, 3, 3]))

Glo93386 = keras.layers.GlobalMaxPool3D(name = 'Glo93386', )(in0Glo93386)
Res46043 = keras.layers.Reshape((1, 1), name = 'Res46043', )(Glo93386)
Zer13406 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer13406', )(Res46043)
Res64214 = keras.layers.Reshape((2, 1, 1), name = 'Res64214', )(Zer13406)
Res71181 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res71181', )(Res64214)
Con94557 = keras.layers.Conv3D(4, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con94557', )(Res71181)
Res93537 = keras.layers.Reshape((2, 1, 4), name = 'Res93537', )(Con94557)
Zer53937 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer53937', )(Res93537)
Loc64777 = keras.layers.LocallyConnected1D(3, (1),strides=(1), name = 'Loc64777', )(in0Loc64777)
Res99694 = keras.layers.Reshape((2, 3, 1), name = 'Res99694', )(Loc64777)
Up_56033 = keras.layers.UpSampling2D(size=(1, 1), name = 'Up_56033', )(Res99694)
Con38122 = keras.layers.Concatenate(axis=3, name = 'Con38122', )([Up_56033,in0Con38122])
Mul34281 = keras.layers.Multiply(name = 'Mul34281', )([Zer53937,Con38122])
Thr78547 = keras.layers.ThresholdedReLU(theta=6.401534343456281, name = 'Thr78547', )(Mul34281)
Res14938 = keras.layers.Reshape((2, 12), name = 'Res14938', )(Thr78547)
LST61641 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST61641', )(Res14938)
model = tf.keras.models.Model(inputs=[in0Glo93386,in0Loc64777,in0Con38122], outputs=LST61641)
w = model.get_layer('Con94557').get_weights() 
w[0] = np.array([[[[[0.3325, 0.8267, 0.251, 0.3893]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con94557').set_weights(w) 
w = model.get_layer('Loc64777').get_weights() 
w[0] = np.array([[[0.5715, 0.3108, 0.6211]], [[0.3783, 0.7022, 0.9311]]])
w[1] = np.array([[0, 0, 0], [0, 0, 0]])
model.get_layer('Loc64777').set_weights(w) 
w = model.get_layer('LST61641').get_weights() 
w[0] = np.array([[9, 7, 6, 7, 7, 6, 3, 6, 4, 1, 5, 6], [4, 2, 2, 10, 6, 1, 6, 6, 9, 1, 7, 1], [6, 3, 1, 2, 7, 9, 5, 7, 10, 5, 4, 2], [4, 8, 9, 6, 1, 2, 4, 3, 6, 6, 3, 7], [5, 1, 7, 3, 3, 2, 4, 1, 4, 7, 3, 9], [3, 8, 6, 2, 6, 10, 8, 10, 4, 10, 7, 10], [4, 5, 5, 7, 7, 3, 10, 5, 6, 5, 10, 3], [10, 1, 6, 3, 6, 8, 10, 5, 7, 10, 2, 3], [1, 1, 5, 10, 9, 8, 7, 1, 5, 10, 6, 7], [3, 9, 1, 3, 7, 1, 6, 7, 2, 3, 6, 7], [6, 9, 1, 6, 6, 2, 8, 7, 7, 7, 8, 8], [2, 6, 5, 3, 9, 6, 2, 7, 1, 10, 9, 7]])
w[1] = np.array([[9, 10, 4, 1, 4, 4, 9, 7, 8, 6, 9, 10], [8, 5, 4, 5, 3, 4, 6, 1, 9, 7, 3, 5], [4, 4, 1, 7, 4, 5, 3, 4, 9, 3, 7, 8]])
w[2] = np.array([5, 4, 5, 6, 2, 8, 9, 7, 9, 1, 3, 9])
model.get_layer('LST61641').set_weights(w) 
in0Glo93386 = tf.constant([[[[[1.9175]], [[1.4076]]]]])
in0Loc64777 = tf.constant([[[0.4279], [0.7801]]])
in0Con38122 = tf.constant([[[[0.8499, 0.7015, 0.0318], [0.9857, 0.7881, 0.4209], [0.2384, 0.4777, 0.133]], [[0.1507, 0.4583, 0.112], [0.6244, 0.7095, 0.9242], [0.216, 0.0769, 0.995]]]])
print (np.array2string(model.predict([in0Glo93386,in0Loc64777,in0Con38122],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST61641.png')

LGlo93386 = global_max_pool3D_layer([[[[[1.9175]], [[1.4076]]]]], Glo93386), 
LRes46043 = reshape_layer(Glo93386, [1, 1], Res46043), 
LZer13406 = zero_padding1D_layer(Res46043, 1, 0, Zer13406), 
LRes64214 = reshape_layer(Zer13406, [2, 1, 1], Res64214), 
LRes71181 = reshape_layer(Res64214, [2, 1, 1, 1], Res71181), 
LCon94557 = conv3D_layer(Res71181, 1, 1, 1,[[[[[0.3325, 0.8267, 0.251, 0.3893]]]]],[0, 0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con94557), 
LRes93537 = reshape_layer(Con94557, [2, 1, 4], Res93537), 
LZer53937 = zero_padding2D_layer(Res93537, 0, 0, 2, 0, Zer53937), 
LLoc64777 = locally_connected1D_layer([[[0.4279], [0.7801]]], 1,[[[0.5715, 0.3108, 0.6211]], [[0.3783, 0.7022, 0.9311]]],[[0, 0, 0], [0, 0, 0]], 1, Loc64777), 
LRes99694 = reshape_layer(Loc64777, [2, 3, 1], Res99694), 
LUp_56033 = up_sampling2D_layer(Res99694, 1, 1, Up_56033), 
LCon38122 = concatenate_layer([Up_56033,[[[[0.8499, 0.7015, 0.0318], [0.9857, 0.7881, 0.4209], [0.2384, 0.4777, 0.133]], [[0.1507, 0.4583, 0.112], [0.6244, 0.7095, 0.9242], [0.216, 0.0769, 0.995]]]]], 3, Con38122), 
LMul34281 = multiply_layer([Zer53937,Con38122], Mul34281), 
LThr78547 = thresholded_relu_layer(Mul34281, 6.401534343456281, Thr78547), 
LRes14938 = reshape_layer(Thr78547, [2, 12], Res14938), 
LLST61641 = lstm_layer(Res14938,[[9, 7, 6, 7, 7, 6, 3, 6, 4, 1, 5, 6], [4, 2, 2, 10, 6, 1, 6, 6, 9, 1, 7, 1], [6, 3, 1, 2, 7, 9, 5, 7, 10, 5, 4, 2], [4, 8, 9, 6, 1, 2, 4, 3, 6, 6, 3, 7], [5, 1, 7, 3, 3, 2, 4, 1, 4, 7, 3, 9], [3, 8, 6, 2, 6, 10, 8, 10, 4, 10, 7, 10], [4, 5, 5, 7, 7, 3, 10, 5, 6, 5, 10, 3], [10, 1, 6, 3, 6, 8, 10, 5, 7, 10, 2, 3], [1, 1, 5, 10, 9, 8, 7, 1, 5, 10, 6, 7], [3, 9, 1, 3, 7, 1, 6, 7, 2, 3, 6, 7], [6, 9, 1, 6, 6, 2, 8, 7, 7, 7, 8, 8], [2, 6, 5, 3, 9, 6, 2, 7, 1, 10, 9, 7]],[[9, 10, 4, 1, 4, 4, 9, 7, 8, 6, 9, 10], [8, 5, 4, 5, 3, 4, 6, 1, 9, 7, 3, 5], [4, 4, 1, 7, 4, 5, 3, 4, 9, 3, 7, 8]],[5, 4, 5, 6, 2, 8, 9, 7, 9, 1, 3, 9], LST61641), 
exec_layers([LGlo93386,LRes46043,LZer13406,LRes64214,LRes71181,LCon94557,LRes93537,LZer53937,LLoc64777,LRes99694,LUp_56033,LCon38122,LMul34281,LThr78547,LRes14938,LLST61641],["Glo93386","Res46043","Zer13406","Res64214","Res71181","Con94557","Res93537","Zer53937","Loc64777","Res99694","Up_56033","Con38122","Mul34281","Thr78547","Res14938","LST61641"],LST61641,"LST61641")

Actual (Unparsed): [[0.9635431, 0.9627284, 0.9635503]]

Expected (Unparsed): [[0.9635430866601532,0.9627283521589236,0.9635502671151207]]

Actual:   [[0.9636, 0.9628, 0.9636]]

Expected: [[0.9636, 0.9628, 0.9636]]