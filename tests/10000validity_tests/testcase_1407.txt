import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave77917 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Ave77917 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Loc83054 = tf.keras.layers.Input(shape=([1, 2]))
in0Dot56673 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot56673 = tf.keras.layers.Input(shape=([2, 2]))
in0Con9766 = tf.keras.layers.Input(shape=([2, 2]))
in0Mul30207 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Mul30207 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con42272 = tf.keras.layers.Input(shape=([2, 2, 3]))

Ave77917 = keras.layers.Average(name = 'Ave77917', )([in0Ave77917,in1Ave77917])
Res92865 = keras.layers.Reshape((1, 2, 4), name = 'Res92865', )(Ave77917)
Loc83054 = keras.layers.LocallyConnected1D(4, (1),strides=(1), name = 'Loc83054', )(in0Loc83054)
Zer90025 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer90025', )(Loc83054)
Dot56673 = keras.layers.Dot(axes=(2, 2), name = 'Dot56673', )([in0Dot56673,in1Dot56673])
Con9766 = keras.layers.Concatenate(axis=2, name = 'Con9766', )([Dot56673,in0Con9766])
Add62855 = keras.layers.Add(name = 'Add62855', )([Zer90025,Con9766])
Res26270 = keras.layers.Reshape((1, 2, 4), name = 'Res26270', )(Add62855)
Add91552 = keras.layers.Add(name = 'Add91552', )([Res92865,Res26270])
Zer47851 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer47851', )(Add91552)
Mul30207 = keras.layers.Multiply(name = 'Mul30207', )([in0Mul30207,in1Mul30207])
Dep78791 = keras.layers.DepthwiseConv2D((1, 2),strides=(1, 1), padding='same', name = 'Dep78791', )(Mul30207)
Thr79445 = keras.layers.ThresholdedReLU(theta=4.901974059826731, name = 'Thr79445', )(Dep78791)
Con42272 = keras.layers.Concatenate(axis=3, name = 'Con42272', )([Thr79445,in0Con42272])
Mul14783 = keras.layers.Multiply(name = 'Mul14783', )([Zer47851,Con42272])
model = tf.keras.models.Model(inputs=[in0Ave77917,in1Ave77917,in0Loc83054,in0Dot56673,in1Dot56673,in0Con9766,in0Mul30207,in1Mul30207,in0Con42272], outputs=Mul14783)
w = model.get_layer('Loc83054').get_weights() 
w[0] = np.array([[[0.7283, 0.2828, 0.5593, 0.9962], [0.6539, 0.2459, 0.2725, 0.3045]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc83054').set_weights(w) 
w = model.get_layer('Dep78791').get_weights() 
w[0] = np.array([[[[0.185]], [[0.317]]]])
w[1] = np.array([0])
model.get_layer('Dep78791').set_weights(w) 
in0Ave77917 = tf.constant([[[[[0.3676, 0.8242], [0.5534, 0.3541]], [[0.6134, 0.4602], [0.242, 0.7648]]]]])
in1Ave77917 = tf.constant([[[[[0.4744, 0.8926], [0.1099, 0.1909]], [[0.7643, 0.5669], [0.7904, 0.2661]]]]])
in0Loc83054 = tf.constant([[[0.6281, 0.422]]])
in0Dot56673 = tf.constant([[[0.2219, 0.4288], [0.1723, 0.7594]]])
in1Dot56673 = tf.constant([[[0.3528, 0.378], [0.0603, 0.7754]]])
in0Con9766 = tf.constant([[[0.688, 0.2824], [0.0902, 0.7882]]])
in0Mul30207 = tf.constant([[[[0.9822], [0.3055]], [[0.6235], [0.5757]]]])
in1Mul30207 = tf.constant([[[[0.4931], [0.3491]], [[0.5815], [0.6926]]]])
in0Con42272 = tf.constant([[[[0.5808, 0.0998, 0.9602], [0.3263, 0.0041, 0.0605]], [[0.8503, 0.5847, 0.2049], [0.5991, 0.2062, 0.536]]]])
print (np.array2string(model.predict([in0Ave77917,in1Ave77917,in0Loc83054,in0Dot56673,in1Dot56673,in0Con9766,in0Mul30207,in1Mul30207,in0Con42272],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul14783.png')

LAve77917 = average_layer([[[[[[0.3676, 0.8242], [0.5534, 0.3541]], [[0.6134, 0.4602], [0.242, 0.7648]]]]], [[[[[0.4744, 0.8926], [0.1099, 0.1909]], [[0.7643, 0.5669], [0.7904, 0.2661]]]]]], Ave77917), 
LRes92865 = reshape_layer(Ave77917, [1, 2, 4], Res92865), 
LLoc83054 = locally_connected1D_layer([[[0.6281, 0.422]]], 1,[[[0.7283, 0.2828, 0.5593, 0.9962], [0.6539, 0.2459, 0.2725, 0.3045]]],[[0, 0, 0, 0]], 1, Loc83054), 
LZer90025 = zero_padding1D_layer(Loc83054, 1, 0, Zer90025), 
LDot56673 = dot_layer([[[0.2219, 0.4288], [0.1723, 0.7594]]], [[[0.3528, 0.378], [0.0603, 0.7754]]], 2, 2, Dot56673), 
LCon9766 = concatenate_layer([Dot56673,[[[0.688, 0.2824], [0.0902, 0.7882]]]], 2, Con9766), 
LAdd62855 = add_layer([Zer90025,Con9766], Add62855), 
LRes26270 = reshape_layer(Add62855, [1, 2, 4], Res26270), 
LAdd91552 = add_layer([Res92865,Res26270], Add91552), 
LZer47851 = zero_padding2D_layer(Add91552, 1, 0, 0, 0, Zer47851), 
LMul30207 = multiply_layer([[[[[0.9822], [0.3055]], [[0.6235], [0.5757]]]], [[[[0.4931], [0.3491]], [[0.5815], [0.6926]]]]], Mul30207), 
LDep78791 = depthwise_conv2D_layer(Mul30207, 1, 2,[[[[0.185]], [[0.317]]]],[0], 1, 1, true, Dep78791), 
LThr79445 = thresholded_relu_layer(Dep78791, 4.901974059826731, Thr79445), 
LCon42272 = concatenate_layer([Thr79445,[[[[0.5808, 0.0998, 0.9602], [0.3263, 0.0041, 0.0605]], [[0.8503, 0.5847, 0.2049], [0.5991, 0.2062, 0.536]]]]], 3, Con42272), 
LMul14783 = multiply_layer([Zer47851,Con42272], Mul14783), 
exec_layers([LAve77917,LRes92865,LLoc83054,LZer90025,LDot56673,LCon9766,LAdd62855,LRes26270,LAdd91552,LZer47851,LMul30207,LDep78791,LThr79445,LCon42272,LMul14783],["Ave77917","Res92865","Loc83054","Zer90025","Dot56673","Con9766","Add62855","Res26270","Add91552","Zer47851","Mul30207","Dep78791","Thr79445","Con42272","Mul14783"],Mul14783,"Mul14783")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 1.0239925, 0.5961894, 0.1136990], [0.0000000, 0.8352502, 0.2211890, 1.1030142]]]]

Expected (Unparsed): [[[[0,0.0,0.0,0.0],[0,0.0,0.0,0.0]],[[0.0,1.023992558127,0.5961893549999999,0.11369900999999999],[0.0,0.8352502005629998,0.221188952246,1.1030141499200001]]]]

Actual:   [[[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 1.024, 0.5962, 0.1137], [0, 0.8353, 0.2212, 1.1031]]]]

Expected: [[[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 1.024, 0.5962, 0.1137], [0, 0.8353, 0.2212, 1.1031]]]]