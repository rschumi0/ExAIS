import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max30110 = tf.keras.layers.Input(shape=([1, 1]))
in1Max30110 = tf.keras.layers.Input(shape=([1, 1]))
in0Con76249 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Sub93128 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Sub93128 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Max99027 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Max99027 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Ave2904 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave2904 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con69474 = tf.keras.layers.Input(shape=([2, 3, 1]))

Max30110 = keras.layers.Maximum(name = 'Max30110', )([in0Max30110,in1Max30110])
Res34218 = keras.layers.Reshape((1, 1, 1), name = 'Res34218', )(Max30110)
Zer48793 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer48793', )(Res34218)
Con76249 = keras.layers.Concatenate(axis=3, name = 'Con76249', )([Zer48793,in0Con76249])
Sub93128 = keras.layers.Subtract(name = 'Sub93128', )([in0Sub93128,in1Sub93128])
Add74109 = keras.layers.Add(name = 'Add74109', )([Con76249,Sub93128])
Zer66672 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer66672', )(Add74109)
Max99027 = keras.layers.Maximum(name = 'Max99027', )([in0Max99027,in1Max99027])
Res3551 = keras.layers.Reshape((2, 1, 2), name = 'Res3551', )(Max99027)
Res98356 = keras.layers.Reshape((2, 2), name = 'Res98356', )(Res3551)
Loc93773 = keras.layers.LocallyConnected1D(3, (1),strides=(1), name = 'Loc93773', )(Res98356)
Res84890 = keras.layers.Reshape((2, 3, 1), name = 'Res84890', )(Loc93773)
Ave2904 = keras.layers.Average(name = 'Ave2904', )([in0Ave2904,in1Ave2904])
Zer46915 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer46915', )(Ave2904)
Max13119 = keras.layers.Maximum(name = 'Max13119', )([Res84890,Zer46915])
Con69474 = keras.layers.Concatenate(axis=3, name = 'Con69474', )([Max13119,in0Con69474])
Mul62865 = keras.layers.Multiply(name = 'Mul62865', )([Zer66672,Con69474])
model = tf.keras.models.Model(inputs=[in0Max30110,in1Max30110,in0Con76249,in0Sub93128,in1Sub93128,in0Max99027,in1Max99027,in0Ave2904,in1Ave2904,in0Con69474], outputs=Mul62865)
w = model.get_layer('Loc93773').get_weights() 
w[0] = np.array([[[0.5541, 0.3371, 0.2926], [0.4422, 0.8414, 0.6979]], [[0.1217, 0.1061, 0.5395], [0.7847, 0.7843, 0.1278]]])
w[1] = np.array([[0, 0, 0], [0, 0, 0]])
model.get_layer('Loc93773').set_weights(w) 
in0Max30110 = tf.constant([[[0.9903]]])
in1Max30110 = tf.constant([[[0.8498]]])
in0Con76249 = tf.constant([[[[0.0901], [0.7289]], [[0.9422], [0.1535]]]])
in0Sub93128 = tf.constant([[[[0.2154, 0.1826], [0.6006, 0.9391]], [[0.5678, 0.5226], [0.5368, 0.9841]]]])
in1Sub93128 = tf.constant([[[[0.8088, 0.1231], [0.0984, 0.2038]], [[0.1211, 0.7476], [0.8464, 0.526]]]])
in0Max99027 = tf.constant([[[[[0.2226], [0.8261]]], [[[0.715], [0.2143]]]]])
in1Max99027 = tf.constant([[[[[0.6921], [0.8954]]], [[[0.0528], [0.6746]]]]])
in0Ave2904 = tf.constant([[[[0.9791], [0.9067]], [[0.9916], [0.3812]]]])
in1Ave2904 = tf.constant([[[[0.7014], [0.1767]], [[0.6176], [0.2605]]]])
in0Con69474 = tf.constant([[[[0.7574], [0.9224], [0.4078]], [[0.5894], [0.5553], [0.9612]]]])
print (np.array2string(model.predict([in0Max30110,in1Max30110,in0Con76249,in0Sub93128,in1Sub93128,in0Max99027,in1Max99027,in0Ave2904,in1Ave2904,in0Con69474],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul62865.png')

LMax30110 = maximum_layer([[[[0.9903]]], [[[0.8498]]]], Max30110), 
LRes34218 = reshape_layer(Max30110, [1, 1, 1], Res34218), 
LZer48793 = zero_padding2D_layer(Res34218, 1, 0, 1, 0, Zer48793), 
LCon76249 = concatenate_layer([Zer48793,[[[[0.0901], [0.7289]], [[0.9422], [0.1535]]]]], 3, Con76249), 
LSub93128 = subtract_layer([[[[0.2154, 0.1826], [0.6006, 0.9391]], [[0.5678, 0.5226], [0.5368, 0.9841]]]], [[[[0.8088, 0.1231], [0.0984, 0.2038]], [[0.1211, 0.7476], [0.8464, 0.526]]]], Sub93128), 
LAdd74109 = add_layer([Con76249,Sub93128], Add74109), 
LZer66672 = zero_padding2D_layer(Add74109, 0, 0, 1, 0, Zer66672), 
LMax99027 = maximum_layer([[[[[[0.2226], [0.8261]]], [[[0.715], [0.2143]]]]], [[[[[0.6921], [0.8954]]], [[[0.0528], [0.6746]]]]]], Max99027), 
LRes3551 = reshape_layer(Max99027, [2, 1, 2], Res3551), 
LRes98356 = reshape_layer(Res3551, [2, 2], Res98356), 
LLoc93773 = locally_connected1D_layer(Res98356, 1,[[[0.5541, 0.3371, 0.2926], [0.4422, 0.8414, 0.6979]], [[0.1217, 0.1061, 0.5395], [0.7847, 0.7843, 0.1278]]],[[0, 0, 0], [0, 0, 0]], 1, Loc93773), 
LRes84890 = reshape_layer(Loc93773, [2, 3, 1], Res84890), 
LAve2904 = average_layer([[[[[0.9791], [0.9067]], [[0.9916], [0.3812]]]], [[[[0.7014], [0.1767]], [[0.6176], [0.2605]]]]], Ave2904), 
LZer46915 = zero_padding2D_layer(Ave2904, 0, 0, 1, 0, Zer46915), 
LMax13119 = maximum_layer([Res84890,Zer46915], Max13119), 
LCon69474 = concatenate_layer([Max13119,[[[[0.7574], [0.9224], [0.4078]], [[0.5894], [0.5553], [0.9612]]]]], 3, Con69474), 
LMul62865 = multiply_layer([Zer66672,Con69474], Mul62865), 
exec_layers([LMax30110,LRes34218,LZer48793,LCon76249,LSub93128,LAdd74109,LZer66672,LMax99027,LRes3551,LRes98356,LLoc93773,LRes84890,LAve2904,LZer46915,LMax13119,LCon69474,LMul62865],["Max30110","Res34218","Zer48793","Con76249","Sub93128","Add74109","Zer66672","Max99027","Res3551","Res98356","Loc93773","Res84890","Ave2904","Zer46915","Max13119","Con69474","Mul62865"],Mul62865,"Mul62865")

Actual (Unparsed): [[[[0.0000000, 0.0000000], [-0.5855057, 0.1379910], [0.4155244, 0.5971008]], [[0.0000000, 0.0000000], [0.3594148, 0.3982611], [0.3212607, 0.5878699]]]]

Expected (Unparsed): [[[[0.0,0.0],[-0.585505685298,0.13799104],[0.415524357864,0.59710076]],[[0.0,0.0],[0.35941481999999997,0.39826116],[0.321260707866,0.5878699199999999]]]]

Actual:   [[[[0, 0], [-0.5855, 0.138], [0.4156, 0.5972]], [[0, 0], [0.3595, 0.3983], [0.3213, 0.5879]]]]

Expected: [[[[0, 0], [-0.5855, 0.138], [0.4156, 0.5972]], [[0, 0], [0.3595, 0.3983], [0.3213, 0.5879]]]]