import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max89032 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Max89032 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Glo43698 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Mul11413 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Mul11413 = tf.keras.layers.Input(shape=([1, 1, 1]))

Max89032 = keras.layers.Maximum(name = 'Max89032', )([in0Max89032,in1Max89032])
Res91301 = keras.layers.Reshape((1, 2), name = 'Res91301', )(Max89032)
LST9844 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST9844', )(Res91301)
Glo43698 = keras.layers.GlobalMaxPool3D(name = 'Glo43698', )(in0Glo43698)
Res20691 = keras.layers.Reshape((1, 1), name = 'Res20691', )(Glo43698)
Res45058 = keras.layers.Reshape((1, 1, 1), name = 'Res45058', )(Res20691)
Dep49584 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='same', name = 'Dep49584', )(Res45058)
Res26265 = keras.layers.Reshape((1, 1), name = 'Res26265', )(Dep49584)
Fla82581 = keras.layers.Flatten(name = 'Fla82581', )(Res26265)
Mul11413 = keras.layers.Multiply(name = 'Mul11413', )([in0Mul11413,in1Mul11413])
Glo25613 = keras.layers.GlobalMaxPool2D(name = 'Glo25613', )(Mul11413)
Mul29998 = keras.layers.Multiply(name = 'Mul29998', )([Fla82581,Glo25613])
Min35723 = keras.layers.Minimum(name = 'Min35723', )([LST9844,Mul29998])
Res14678 = keras.layers.Reshape((1, 1), name = 'Res14678', )(Min35723)
Res32133 = keras.layers.Reshape((1, 1, 1), name = 'Res32133', )(Res14678)
Res6480 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res6480', )(Res32133)
Con4000 = keras.layers.Conv3D(2, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con4000', )(Res6480)
model = tf.keras.models.Model(inputs=[in0Max89032,in1Max89032,in0Glo43698,in0Mul11413,in1Mul11413], outputs=Con4000)
w = model.get_layer('LST9844').get_weights() 
w[0] = np.array([[5, 6, 9, 3], [2, 6, 6, 5]])
w[1] = np.array([[4, 1, 3, 4]])
w[2] = np.array([8, 9, 8, 1])
model.get_layer('LST9844').set_weights(w) 
w = model.get_layer('Dep49584').get_weights() 
w[0] = np.array([[[[0.7927]]]])
w[1] = np.array([0])
model.get_layer('Dep49584').set_weights(w) 
w = model.get_layer('Con4000').get_weights() 
w[0] = np.array([[[[[0.9813, 0.9319]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con4000').set_weights(w) 
in0Max89032 = tf.constant([[[[0.9402, 0.4737]]]])
in1Max89032 = tf.constant([[[[0.4338, 0.0193]]]])
in0Glo43698 = tf.constant([[[[[1.7314]]], [[[1.4031]]]]])
in0Mul11413 = tf.constant([[[[0.0978]]]])
in1Mul11413 = tf.constant([[[[0.9482]]]])
print (np.array2string(model.predict([in0Max89032,in1Max89032,in0Glo43698,in0Mul11413,in1Mul11413],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con4000.png')

LMax89032 = maximum_layer([[[[[0.9402, 0.4737]]]], [[[[0.4338, 0.0193]]]]], Max89032), 
LRes91301 = reshape_layer(Max89032, [1, 2], Res91301), 
LLST9844 = lstm_layer(Res91301,[[5, 6, 9, 3], [2, 6, 6, 5]],[[4, 1, 3, 4]],[8, 9, 8, 1], LST9844), 
LGlo43698 = global_max_pool3D_layer([[[[[1.7314]]], [[[1.4031]]]]], Glo43698), 
LRes20691 = reshape_layer(Glo43698, [1, 1], Res20691), 
LRes45058 = reshape_layer(Res20691, [1, 1, 1], Res45058), 
LDep49584 = depthwise_conv2D_layer(Res45058, 1, 1,[[[[0.7927]]]],[0], 1, 1, true, Dep49584), 
LRes26265 = reshape_layer(Dep49584, [1, 1], Res26265), 
LFla82581 = flatten_layer(Res26265, Fla82581), 
LMul11413 = multiply_layer([[[[[0.0978]]]], [[[[0.9482]]]]], Mul11413), 
LGlo25613 = global_max_pool2D_layer(Mul11413, Glo25613), 
LMul29998 = multiply_layer([Fla82581,Glo25613], Mul29998), 
LMin35723 = minimum_layer([LST9844,Mul29998], Min35723), 
LRes14678 = reshape_layer(Min35723, [1, 1], Res14678), 
LRes32133 = reshape_layer(Res14678, [1, 1, 1], Res32133), 
LRes6480 = reshape_layer(Res32133, [1, 1, 1, 1], Res6480), 
LCon4000 = conv3D_layer(Res6480, 1, 1, 1,[[[[[0.9813, 0.9319]]]]],[0, 0], 1, 1, 1, false, 1, 1, 1, Con4000), 
exec_layers([LMax89032,LRes91301,LLST9844,LGlo43698,LRes20691,LRes45058,LDep49584,LRes26265,LFla82581,LMul11413,LGlo25613,LMul29998,LMin35723,LRes14678,LRes32133,LRes6480,LCon4000],["Max89032","Res91301","LST9844","Glo43698","Res20691","Res45058","Dep49584","Res26265","Fla82581","Mul11413","Glo25613","Mul29998","Min35723","Res14678","Res32133","Res6480","Con4000"],Con4000,"Con4000")

Actual (Unparsed): [[[[[0.1248955, 0.1186081]]]]]

Expected (Unparsed): [[[[[0.12489552444930231,0.11860811090828985]]]]]

Actual:   [[[[[0.1249, 0.1187]]]]]

Expected: [[[[[0.1249, 0.1187]]]]]