import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add86567 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Add86567 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con44965 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0GRU64936 = tf.keras.layers.Input(shape=([2, 1]))
in0Con77616 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Mul82220 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Mul82220 = tf.keras.layers.Input(shape=([2, 2, 2]))

Add86567 = keras.layers.Add(name = 'Add86567', )([in0Add86567,in1Add86567])
Up_68058 = keras.layers.UpSampling2D(size=(2, 1), name = 'Up_68058', )(Add86567)
Res23456 = keras.layers.Reshape((4, 1), name = 'Res23456', )(Up_68058)
Ave39464 = keras.layers.AveragePooling1D(pool_size=(4), name = 'Ave39464', )(Res23456)
Lay26444 = keras.layers.LayerNormalization(axis=1, epsilon=1.3617767561695, name = 'Lay26444', )(Ave39464)
Res65043 = keras.layers.Reshape((1, 1, 1), name = 'Res65043', )(Lay26444)
Zer18274 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer18274', )(Res65043)
Con44965 = keras.layers.Concatenate(axis=3, name = 'Con44965', )([Zer18274,in0Con44965])
GRU64936 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU64936', )(in0GRU64936)
Res37697 = keras.layers.Reshape((2, 1), name = 'Res37697', )(GRU64936)
Res7659 = keras.layers.Reshape((2, 1, 1), name = 'Res7659', )(Res37697)
Zer83689 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer83689', )(Res7659)
Con77616 = keras.layers.Concatenate(axis=3, name = 'Con77616', )([Zer83689,in0Con77616])
Mul82220 = keras.layers.Multiply(name = 'Mul82220', )([in0Mul82220,in1Mul82220])
Max88490 = keras.layers.Maximum(name = 'Max88490', )([Con77616,Mul82220])
Max51336 = keras.layers.Maximum(name = 'Max51336', )([Con44965,Max88490])
model = tf.keras.models.Model(inputs=[in0Add86567,in1Add86567,in0Con44965,in0GRU64936,in0Con77616,in0Mul82220,in1Mul82220], outputs=Max51336)
w = model.get_layer('GRU64936').get_weights() 
w[0] = np.array([[4, 3, 10, 9, 3, 7]])
w[1] = np.array([[2, 8, 1, 9, 6, 5], [4, 1, 2, 4, 8, 9]])
w[2] = np.array([6, 7, 2, 9, 3, 1])
model.get_layer('GRU64936').set_weights(w) 
in0Add86567 = tf.constant([[[[0.6838]], [[0.6592]]]])
in1Add86567 = tf.constant([[[[0.5282]], [[0.4689]]]])
in0Con44965 = tf.constant([[[[0.6596], [0.7345]], [[0.7888], [0.5325]]]])
in0GRU64936 = tf.constant([[[10], [6]]])
in0Con77616 = tf.constant([[[[0.8752], [0.7455]], [[0.0696], [0.7915]]]])
in0Mul82220 = tf.constant([[[[0.7061, 0.9181], [0.4654, 0.7029]], [[0.5162, 0.0682], [0.459, 0.2967]]]])
in1Mul82220 = tf.constant([[[[0.2581, 0.536], [0.2, 0.7332]], [[0.2739, 0.2869], [0.8904, 0.1618]]]])
print (np.array2string(model.predict([in0Add86567,in1Add86567,in0Con44965,in0GRU64936,in0Con77616,in0Mul82220,in1Mul82220],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max51336.png')

LAdd86567 = add_layer([[[[[0.6838]], [[0.6592]]]], [[[[0.5282]], [[0.4689]]]]], Add86567), 
LUp_68058 = up_sampling2D_layer(Add86567, 2, 1, Up_68058), 
LRes23456 = reshape_layer(Up_68058, [4, 1], Res23456), 
LAve39464 = average_pooling1D_layer(Res23456, 4, Ave39464), 
LLay26444 = layer_normalization_layer(Ave39464, 1, 1.3617767561695, Lay26444), 
LRes65043 = reshape_layer(Lay26444, [1, 1, 1], Res65043), 
LZer18274 = zero_padding2D_layer(Res65043, 1, 0, 1, 0, Zer18274), 
LCon44965 = concatenate_layer([Zer18274,[[[[0.6596], [0.7345]], [[0.7888], [0.5325]]]]], 3, Con44965), 
LGRU64936 = gru_layer([[[10], [6]]],[[4, 3, 10, 9, 3, 7]],[[2, 8, 1, 9, 6, 5], [4, 1, 2, 4, 8, 9]],[6, 7, 2, 9, 3, 1], false, GRU64936), 
LRes37697 = reshape_layer(GRU64936, [2, 1], Res37697), 
LRes7659 = reshape_layer(Res37697, [2, 1, 1], Res7659), 
LZer83689 = zero_padding2D_layer(Res7659, 0, 0, 1, 0, Zer83689), 
LCon77616 = concatenate_layer([Zer83689,[[[[0.8752], [0.7455]], [[0.0696], [0.7915]]]]], 3, Con77616), 
LMul82220 = multiply_layer([[[[[0.7061, 0.9181], [0.4654, 0.7029]], [[0.5162, 0.0682], [0.459, 0.2967]]]], [[[[0.2581, 0.536], [0.2, 0.7332]], [[0.2739, 0.2869], [0.8904, 0.1618]]]]], Mul82220), 
LMax88490 = maximum_layer([Con77616,Mul82220], Max88490), 
LMax51336 = maximum_layer([Con44965,Max88490], Max51336), 
exec_layers([LAdd86567,LUp_68058,LRes23456,LAve39464,LLay26444,LRes65043,LZer18274,LCon44965,LGRU64936,LRes37697,LRes7659,LZer83689,LCon77616,LMul82220,LMax88490,LMax51336],["Add86567","Up_68058","Res23456","Ave39464","Lay26444","Res65043","Zer18274","Con44965","GRU64936","Res37697","Res7659","Zer83689","Con77616","Mul82220","Max88490","Max51336"],Max51336,"Max51336")

Actual (Unparsed): [[[[0.1822444, 0.8752000], [0.0930800, 0.7455000]], [[0.1413872, 0.7888000], [0.4086936, 0.7915000]]]]

Expected (Unparsed): [[[[0.18224441,0.8752],[0.09308,0.7455]],[[0.14138717999999997,0.7888],[0.4086936,0.7915]]]]

Actual:   [[[[0.1823, 0.8752], [0.0931, 0.7455]], [[0.1414, 0.7888], [0.4087, 0.7915]]]]

Expected: [[[[0.1823, 0.8752], [0.0931, 0.7455]], [[0.1414, 0.7888], [0.4087, 0.7915]]]]