import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max86171 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Max86171 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Mul47292 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Mul47292 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in0Con52329 = tf.keras.layers.Input(shape=([2]))

Max86171 = keras.layers.Maximum(name = 'Max86171', )([in0Max86171,in1Max86171])
Res84002 = keras.layers.Reshape((2, 1, 2), name = 'Res84002', )(Max86171)
Res54157 = keras.layers.Reshape((2, 2), name = 'Res54157', )(Res84002)
Fla17310 = keras.layers.Flatten(name = 'Fla17310', )(Res54157)
Mul47292 = keras.layers.Multiply(name = 'Mul47292', )([in0Mul47292,in1Mul47292])
Res56094 = keras.layers.Reshape((1, 1, 2), name = 'Res56094', )(Mul47292)
Res38981 = keras.layers.Reshape((1, 2), name = 'Res38981', )(Res56094)
Sim73188 = keras.layers.SimpleRNN(2,name = 'Sim73188', )(Res38981)
Con52329 = keras.layers.Concatenate(axis=1, name = 'Con52329', )([Sim73188,in0Con52329])
Mul9392 = keras.layers.Multiply(name = 'Mul9392', )([Fla17310,Con52329])
model = tf.keras.models.Model(inputs=[in0Max86171,in1Max86171,in0Mul47292,in1Mul47292,in0Con52329], outputs=Mul9392)
w = model.get_layer('Sim73188').get_weights() 
w[0] = np.array([[1, 2], [1, 3]])
w[1] = np.array([[7, 1], [8, 5]])
w[2] = np.array([6, 1])
model.get_layer('Sim73188').set_weights(w) 
in0Max86171 = tf.constant([[[[[0.8662], [0.1896]]], [[[0.6241], [0.477]]]]])
in1Max86171 = tf.constant([[[[[0.7621], [0.6845]]], [[[0.7494], [0.1198]]]]])
in0Mul47292 = tf.constant([[[[[0.3674, 0.7148]]]]])
in1Mul47292 = tf.constant([[[[[0.9024, 0.2544]]]]])
in0Con52329 = tf.constant([[0.792, 0.6434]])
print (np.array2string(model.predict([in0Max86171,in1Max86171,in0Mul47292,in1Mul47292,in0Con52329],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul9392.png')

LMax86171 = maximum_layer([[[[[[0.8662], [0.1896]]], [[[0.6241], [0.477]]]]], [[[[[0.7621], [0.6845]]], [[[0.7494], [0.1198]]]]]], Max86171), 
LRes84002 = reshape_layer(Max86171, [2, 1, 2], Res84002), 
LRes54157 = reshape_layer(Res84002, [2, 2], Res54157), 
LFla17310 = flatten_layer(Res54157, Fla17310), 
LMul47292 = multiply_layer([[[[[[0.3674, 0.7148]]]]], [[[[[0.9024, 0.2544]]]]]], Mul47292), 
LRes56094 = reshape_layer(Mul47292, [1, 1, 2], Res56094), 
LRes38981 = reshape_layer(Res56094, [1, 2], Res38981), 
LSim73188 = simple_rnn_layer(Res38981,[[1, 2], [1, 3]],[[7, 1], [8, 5]],[6, 1], Sim73188), 
LCon52329 = concatenate_layer([Sim73188,[[0.792, 0.6434]]], 1, Con52329), 
LMul9392 = multiply_layer([Fla17310,Con52329], Mul9392), 
exec_layers([LMax86171,LRes84002,LRes54157,LFla17310,LMul47292,LRes56094,LRes38981,LSim73188,LCon52329,LMul9392],["Max86171","Res84002","Res54157","Fla17310","Mul47292","Res56094","Res38981","Sim73188","Con52329","Mul9392"],Mul9392,"Mul9392")

Actual (Unparsed): [[0.8661962, 0.6681765, 0.5935248, 0.3069018]]

Expected (Unparsed): [[0.8661961876632257,0.6681765491291676,0.5935248,0.30690179999999995]]

Actual:   [[0.8662, 0.6682, 0.5936, 0.307]]

Expected: [[0.8662, 0.6682, 0.5936, 0.307]]