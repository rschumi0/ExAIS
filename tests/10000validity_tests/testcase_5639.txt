import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max21655 = tf.keras.layers.Input(shape=([1, 1]))
in1Max21655 = tf.keras.layers.Input(shape=([1, 1]))
in0Dot78048 = tf.keras.layers.Input(shape=([3]))
in1Dot78048 = tf.keras.layers.Input(shape=([3]))

Max21655 = keras.layers.Maximum(name = 'Max21655', )([in0Max21655,in1Max21655])
Fla35483 = keras.layers.Flatten(name = 'Fla35483', )(Max21655)
Dot78048 = keras.layers.Dot(axes=(1, 1), name = 'Dot78048', )([in0Dot78048,in1Dot78048])
Sof37721 = keras.layers.Softmax(axis=1, name = 'Sof37721', )(Dot78048)
Mul57619 = keras.layers.Multiply(name = 'Mul57619', )([Fla35483,Sof37721])
Res24593 = keras.layers.Reshape((1, 1), name = 'Res24593', )(Mul57619)
Res17099 = keras.layers.Reshape((1, 1, 1), name = 'Res17099', )(Res24593)
Con12203 = keras.layers.Conv2DTranspose(2, (1, 1),strides=(3, 11), padding='valid', name = 'Con12203', )(Res17099)
model = tf.keras.models.Model(inputs=[in0Max21655,in1Max21655,in0Dot78048,in1Dot78048], outputs=Con12203)
w = model.get_layer('Con12203').get_weights() 
w[0] = np.array([[[[0.4797], [0.5529]]]])
w[1] = np.array([0, 0])
model.get_layer('Con12203').set_weights(w) 
in0Max21655 = tf.constant([[[0.5648]]])
in1Max21655 = tf.constant([[[0.5431]]])
in0Dot78048 = tf.constant([[0.0773, 0.2688, 0.2247]])
in1Dot78048 = tf.constant([[0.8169, 0.6755, 0.8276]])
print (np.array2string(model.predict([in0Max21655,in1Max21655,in0Dot78048,in1Dot78048],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con12203.png')

LMax21655 = maximum_layer([[[[0.5648]]], [[[0.5431]]]], Max21655), 
LFla35483 = flatten_layer(Max21655, Fla35483), 
LDot78048 = dot_layer([[0.0773, 0.2688, 0.2247]], [[0.8169, 0.6755, 0.8276]], 1, 1, Dot78048), 
LSof37721 = softmax_layer(Dot78048, 1, Sof37721), 
LMul57619 = multiply_layer([Fla35483,Sof37721], Mul57619), 
LRes24593 = reshape_layer(Mul57619, [1, 1], Res24593), 
LRes17099 = reshape_layer(Res24593, [1, 1, 1], Res17099), 
LCon12203 = conv2D_transpose_layer(Res17099, 1, 1,[[[[0.4797], [0.5529]]]],[0, 0], 3, 11, false, Con12203), 
exec_layers([LMax21655,LFla35483,LDot78048,LSof37721,LMul57619,LRes24593,LRes17099,LCon12203],["Max21655","Fla35483","Dot78048","Sof37721","Mul57619","Res24593","Res17099","Con12203"],Con12203,"Con12203")

Actual (Unparsed): [[[[0.2709346, 0.3122779], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]]]]

Expected (Unparsed): [[[[0.27093456,0.31227791999999993],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]]]]

Actual:   [[[[0.271, 0.3123], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]]]

Expected: [[[[0.271, 0.3123], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]]]