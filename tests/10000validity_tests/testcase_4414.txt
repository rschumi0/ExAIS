import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave2295 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave2295 = tf.keras.layers.Input(shape=([2, 2]))
in0Sub78712 = tf.keras.layers.Input(shape=([3]))
in1Sub78712 = tf.keras.layers.Input(shape=([3]))
in0Con43768 = tf.keras.layers.Input(shape=([1]))
in0Min9109 = tf.keras.layers.Input(shape=([2, 1]))
in1Min9109 = tf.keras.layers.Input(shape=([2, 1]))
in0Con38177 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Ave59999 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Ave59999 = tf.keras.layers.Input(shape=([1, 1, 2]))

Ave2295 = keras.layers.Average(name = 'Ave2295', )([in0Ave2295,in1Ave2295])
Fla70764 = keras.layers.Flatten(name = 'Fla70764', )(Ave2295)
Sub78712 = keras.layers.Subtract(name = 'Sub78712', )([in0Sub78712,in1Sub78712])
Con43768 = keras.layers.Concatenate(axis=1, name = 'Con43768', )([Sub78712,in0Con43768])
Sub14948 = keras.layers.Subtract(name = 'Sub14948', )([Fla70764,Con43768])
Res1861 = keras.layers.Reshape((4, 1), name = 'Res1861', )(Sub14948)
Min9109 = keras.layers.Minimum(name = 'Min9109', )([in0Min9109,in1Min9109])
Res84211 = keras.layers.Reshape((2, 1, 1), name = 'Res84211', )(Min9109)
Con38177 = keras.layers.Concatenate(axis=3, name = 'Con38177', )([Res84211,in0Con38177])
Ave59999 = keras.layers.Average(name = 'Ave59999', )([in0Ave59999,in1Ave59999])
Zer8880 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer8880', )(Ave59999)
Ave98916 = keras.layers.Average(name = 'Ave98916', )([Con38177,Zer8880])
Res44917 = keras.layers.Reshape((4, 1), name = 'Res44917', )(Ave98916)
Max21017 = keras.layers.Maximum(name = 'Max21017', )([Res1861,Res44917])
Res27755 = keras.layers.Reshape((4, 1, 1), name = 'Res27755', )(Max21017)
Ave20138 = keras.layers.AveragePooling2D(pool_size=(4, 1), strides=(1, 1), padding='same', name = 'Ave20138', )(Res27755)
model = tf.keras.models.Model(inputs=[in0Ave2295,in1Ave2295,in0Sub78712,in1Sub78712,in0Con43768,in0Min9109,in1Min9109,in0Con38177,in0Ave59999,in1Ave59999], outputs=Ave20138)
in0Ave2295 = tf.constant([[[0.7417, 0.6779], [0.5111, 0.3949]]])
in1Ave2295 = tf.constant([[[0.8603, 0.5033], [0.5048, 0.8339]]])
in0Sub78712 = tf.constant([[0.3877, 0.3597, 0.3825]])
in1Sub78712 = tf.constant([[0.4692, 0.2571, 0.6517]])
in0Con43768 = tf.constant([[0.4427]])
in0Min9109 = tf.constant([[[0.8669], [0.0941]]])
in1Min9109 = tf.constant([[[0.5652], [0.55]]])
in0Con38177 = tf.constant([[[[0.6734]], [[0.1053]]]])
in0Ave59999 = tf.constant([[[[0.3885, 0.8361]]]])
in1Ave59999 = tf.constant([[[[0.5134, 0.5919]]]])
print (np.array2string(model.predict([in0Ave2295,in1Ave2295,in0Sub78712,in1Sub78712,in0Con43768,in0Min9109,in1Min9109,in0Con38177,in0Ave59999,in1Ave59999],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave20138.png')

LAve2295 = average_layer([[[[0.7417, 0.6779], [0.5111, 0.3949]]], [[[0.8603, 0.5033], [0.5048, 0.8339]]]], Ave2295), 
LFla70764 = flatten_layer(Ave2295, Fla70764), 
LSub78712 = subtract_layer([[0.3877, 0.3597, 0.3825]], [[0.4692, 0.2571, 0.6517]], Sub78712), 
LCon43768 = concatenate_layer([Sub78712,[[0.4427]]], 1, Con43768), 
LSub14948 = subtract_layer(Fla70764,Con43768, Sub14948), 
LRes1861 = reshape_layer(Sub14948, [4, 1], Res1861), 
LMin9109 = minimum_layer([[[[0.8669], [0.0941]]], [[[0.5652], [0.55]]]], Min9109), 
LRes84211 = reshape_layer(Min9109, [2, 1, 1], Res84211), 
LCon38177 = concatenate_layer([Res84211,[[[[0.6734]], [[0.1053]]]]], 3, Con38177), 
LAve59999 = average_layer([[[[[0.3885, 0.8361]]]], [[[[0.5134, 0.5919]]]]], Ave59999), 
LZer8880 = zero_padding2D_layer(Ave59999, 1, 0, 0, 0, Zer8880), 
LAve98916 = average_layer([Con38177,Zer8880], Ave98916), 
LRes44917 = reshape_layer(Ave98916, [4, 1], Res44917), 
LMax21017 = maximum_layer([Res1861,Res44917], Max21017), 
LRes27755 = reshape_layer(Max21017, [4, 1, 1], Res27755), 
LAve20138 = average_pooling2D_layer(Res27755, 4, 1, 1, 1, true, Ave20138), 
exec_layers([LAve2295,LFla70764,LSub78712,LCon43768,LSub14948,LRes1861,LMin9109,LRes84211,LCon38177,LAve59999,LZer8880,LAve98916,LRes44917,LMax21017,LRes27755,LAve20138],["Ave2295","Fla70764","Sub78712","Con43768","Sub14948","Res1861","Min9109","Res84211","Con38177","Ave59999","Zer8880","Ave98916","Res44917","Max21017","Res27755","Ave20138"],Ave20138,"Ave20138")

Actual (Unparsed): [[[[0.7158833]], [[0.6393250]], [[0.5582667]], [[0.5934000]]]]

Expected (Unparsed): [[[[0.7158833333333332]],[[0.6393249999999999]],[[0.5582666666666666]],[[0.5933999999999999]]]]

Actual:   [[[[0.7159]], [[0.6394]], [[0.5583]], [[0.5934]]]]

Expected: [[[[0.7159]], [[0.6394]], [[0.5583]], [[0.5934]]]]