import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max46888 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in1Max46888 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in0Con27322 = tf.keras.layers.Input(shape=([2, 5]))
in0Sub55977 = tf.keras.layers.Input(shape=([2, 3, 3]))
in1Sub55977 = tf.keras.layers.Input(shape=([2, 3, 3]))

Max46888 = keras.layers.Maximum(name = 'Max46888', )([in0Max46888,in1Max46888])
Res95791 = keras.layers.Reshape((2, 1, 4), name = 'Res95791', )(Max46888)
Res64971 = keras.layers.Reshape((2, 4), name = 'Res64971', )(Res95791)
Con27322 = keras.layers.Concatenate(axis=2, name = 'Con27322', )([Res64971,in0Con27322])
Sub55977 = keras.layers.Subtract(name = 'Sub55977', )([in0Sub55977,in1Sub55977])
Lea40454 = keras.layers.LeakyReLU(alpha=8.462243547848404, name = 'Lea40454', )(Sub55977)
Res74490 = keras.layers.Reshape((2, 9), name = 'Res74490', )(Lea40454)
Dot31407 = keras.layers.Dot(axes=(2, 2), name = 'Dot31407', )([Con27322,Res74490])
model = tf.keras.models.Model(inputs=[in0Max46888,in1Max46888,in0Con27322,in0Sub55977,in1Sub55977], outputs=Dot31407)
in0Max46888 = tf.constant([[[[[0.2753, 0.9015], [0.1329, 0.1591]]], [[[0.8892, 0.6949], [0.1748, 0.9398]]]]])
in1Max46888 = tf.constant([[[[[0.0778, 0.8479], [0.3928, 0.0864]]], [[[0.3863, 0.3292], [0.2881, 0.1908]]]]])
in0Con27322 = tf.constant([[[0.535, 0.7038, 0.7352, 0.5441, 0.9293], [0.3839, 0.2288, 0.2108, 0.0995, 0.0536]]])
in0Sub55977 = tf.constant([[[[0.2833, 0.8822, 0.6077], [0.617, 0.2331, 0.0095], [0.8278, 0.6288, 0.1226]], [[0.7773, 0.4258, 0.7903], [0.9079, 0.3934, 0.9766], [0.147, 0.8565, 0.8486]]]])
in1Sub55977 = tf.constant([[[[0.582, 0.1083, 0.4332], [0.6468, 0.2567, 0.2665], [0.701, 0.7983, 0.6796]], [[0.6131, 0.0901, 0.7997], [0.1477, 0.7436, 0.5252], [0.283, 0.6651, 0.6758]]]])
print (np.array2string(model.predict([in0Max46888,in1Max46888,in0Con27322,in0Sub55977,in1Sub55977],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot31407.png')

LMax46888 = maximum_layer([[[[[[0.2753, 0.9015], [0.1329, 0.1591]]], [[[0.8892, 0.6949], [0.1748, 0.9398]]]]], [[[[[0.0778, 0.8479], [0.3928, 0.0864]]], [[[0.3863, 0.3292], [0.2881, 0.1908]]]]]], Max46888), 
LRes95791 = reshape_layer(Max46888, [2, 1, 4], Res95791), 
LRes64971 = reshape_layer(Res95791, [2, 4], Res64971), 
LCon27322 = concatenate_layer([Res64971,[[[0.535, 0.7038, 0.7352, 0.5441, 0.9293], [0.3839, 0.2288, 0.2108, 0.0995, 0.0536]]]], 2, Con27322), 
LSub55977 = subtract_layer([[[[0.2833, 0.8822, 0.6077], [0.617, 0.2331, 0.0095], [0.8278, 0.6288, 0.1226]], [[0.7773, 0.4258, 0.7903], [0.9079, 0.3934, 0.9766], [0.147, 0.8565, 0.8486]]]], [[[[0.582, 0.1083, 0.4332], [0.6468, 0.2567, 0.2665], [0.701, 0.7983, 0.6796]], [[0.6131, 0.0901, 0.7997], [0.1477, 0.7436, 0.5252], [0.283, 0.6651, 0.6758]]]], Sub55977), 
LLea40454 = leaky_relu_layer(Sub55977, 8.462243547848404, Lea40454), 
LRes74490 = reshape_layer(Lea40454, [2, 9], Res74490), 
LDot31407 = dot_layer(Con27322,Res74490, 2, 2, Dot31407), 
exec_layers([LMax46888,LRes95791,LRes64971,LCon27322,LSub55977,LLea40454,LRes74490,LDot31407],["Max46888","Res95791","Res64971","Con27322","Sub55977","Lea40454","Res74490","Dot31407"],Dot31407,"Dot31407")

Actual (Unparsed): [[[-6.6746748, -1.4116171], [-2.8394354, -0.1778911]]]

Expected (Unparsed): [[[-6.674674820029326,-1.4116171835582527],[-2.8394355568647387,-0.17789116343248096]]]

Actual:   [[[-6.6746, -1.4116], [-2.8394, -0.1778]]]

Expected: [[[-6.6746, -1.4116], [-2.8394, -0.1778]]]