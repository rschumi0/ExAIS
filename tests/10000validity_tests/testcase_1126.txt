import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max60161 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Max60161 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))

Max60161 = keras.layers.Maximum(name = 'Max60161', )([in0Max60161,in1Max60161])
Glo59079 = keras.layers.GlobalAveragePooling3D(name = 'Glo59079', )(Max60161)
Res36578 = keras.layers.Reshape((2, 1), name = 'Res36578', )(Glo59079)
Res39515 = keras.layers.Reshape((2, 1, 1), name = 'Res39515', )(Res36578)
Res87480 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res87480', )(Res39515)
Con49089 = keras.layers.Conv3DTranspose(3, (1, 1, 1),strides=(1, 3, 1), padding='valid', name = 'Con49089', )(Res87480)
Res48026 = keras.layers.Reshape((2, 3, 3), name = 'Res48026', )(Con49089)
Res5921 = keras.layers.Reshape((2, 9), name = 'Res5921', )(Res48026)
LST8006 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST8006', )(Res5921)
model = tf.keras.models.Model(inputs=[in0Max60161,in1Max60161], outputs=LST8006)
w = model.get_layer('Con49089').get_weights() 
w[0] = np.array([[[[[0.1586], [0.2217], [0.2225]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con49089').set_weights(w) 
w = model.get_layer('LST8006').get_weights() 
w[0] = np.array([[8, 2, 5, 5], [9, 9, 10, 7], [4, 4, 10, 9], [6, 7, 9, 8], [5, 5, 7, 7], [10, 2, 8, 2], [9, 1, 5, 10], [5, 8, 5, 5], [2, 10, 9, 1]])
w[1] = np.array([[1, 4, 1, 2]])
w[2] = np.array([5, 1, 6, 3])
model.get_layer('LST8006').set_weights(w) 
in0Max60161 = tf.constant([[[[[0.3756, 0.3474]], [[0.7334, 0.0166]]]]])
in1Max60161 = tf.constant([[[[[0.7255, 0.052]], [[0.5195, 0.4193]]]]])
print (np.array2string(model.predict([in0Max60161,in1Max60161],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST8006.png')

LMax60161 = maximum_layer([[[[[[0.3756, 0.3474]], [[0.7334, 0.0166]]]]], [[[[[0.7255, 0.052]], [[0.5195, 0.4193]]]]]], Max60161), 
LGlo59079 = global_average_pooling3D_layer(Max60161, Glo59079), 
LRes36578 = reshape_layer(Glo59079, [2, 1], Res36578), 
LRes39515 = reshape_layer(Res36578, [2, 1, 1], Res39515), 
LRes87480 = reshape_layer(Res39515, [2, 1, 1, 1], Res87480), 
LCon49089 = conv3D_transpose_layer(Res87480, 1, 1, 1,[[[[[0.1586], [0.2217], [0.2225]]]]],[0, 0, 0], 1, 3, 1, false, Con49089), 
LRes48026 = reshape_layer(Con49089, [2, 3, 3], Res48026), 
LRes5921 = reshape_layer(Res48026, [2, 9], Res5921), 
LLST8006 = lstm_layer(Res5921,[[8, 2, 5, 5], [9, 9, 10, 7], [4, 4, 10, 9], [6, 7, 9, 8], [5, 5, 7, 7], [10, 2, 8, 2], [9, 1, 5, 10], [5, 8, 5, 5], [2, 10, 9, 1]],[[1, 4, 1, 2]],[5, 1, 6, 3], LST8006), 
exec_layers([LMax60161,LGlo59079,LRes36578,LRes39515,LRes87480,LCon49089,LRes48026,LRes5921,LLST8006],["Max60161","Glo59079","Res36578","Res39515","Res87480","Con49089","Res48026","Res5921","LST8006"],LST8006,"LST8006")

Actual (Unparsed): [[0.9616159]]

Expected (Unparsed): [[0.9616159170800405]]

Actual:   [[0.9617]]

Expected: [[0.9617]]