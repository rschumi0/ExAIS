import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Bat44539 = tf.keras.layers.Input(shape=([2, 4, 3]))

Bat44539 = keras.layers.BatchNormalization(axis=2, epsilon=0.22074180124226278,  name = 'Bat44539', )(in0Bat44539)
Ave72134 = keras.layers.AveragePooling2D(pool_size=(1, 1), strides=(1, 2), padding='valid', name = 'Ave72134', )(Bat44539)
Res31222 = keras.layers.Reshape((2, 2, 3, 1), name = 'Res31222', )(Ave72134)
Con93136 = keras.layers.Conv3D(4, (1, 1, 3),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con93136', )(Res31222)
Res88654 = keras.layers.Reshape((2, 2, 4), name = 'Res88654', )(Con93136)
Res3285 = keras.layers.Reshape((2, 8), name = 'Res3285', )(Res88654)
Glo27784 = keras.layers.GlobalMaxPool1D(name = 'Glo27784', )(Res3285)
model = tf.keras.models.Model(inputs=[in0Bat44539], outputs=Glo27784)
w = model.get_layer('Bat44539').get_weights() 
w[0] = np.array([0.5743, 0.0859, 0.6282, 0.7851])
w[1] = np.array([0.3957, 0.481, 0.1798, 0.4515])
w[2] = np.array([0.1906, 0.8703, 0.2213, 0.9681])
w[3] = np.array([0.2752, 0.0835, 0.314, 0.0704])
model.get_layer('Bat44539').set_weights(w) 
w = model.get_layer('Con93136').get_weights() 
w[0] = np.array([[[[[0.3536, 0.4547, 0.1598, 0.4862]], [[0.8521, 0.4271, 0.9554, 0.3898]], [[0.3032, 0.0718, 0.4407, 0.7141]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con93136').set_weights(w) 
in0Bat44539 = tf.constant([[[[1.6979, 1.4545, 1.5616], [1.698, 1.4338, 1.7673], [1.3497, 1.7105, 1.4079], [1.8187, 1.7186, 1.0437]], [[1.046, 1.3177, 1.9558], [1.329, 1.1067, 1.6595], [1.2493, 1.2584, 1.4468], [1.2343, 1.5877, 1.3774]]]])
print (np.array2string(model.predict([in0Bat44539],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo27784.png')

LBat44539 = batch_normalization_layer([[[[1.6979, 1.4545, 1.5616], [1.698, 1.4338, 1.7673], [1.3497, 1.7105, 1.4079], [1.8187, 1.7186, 1.0437]], [[1.046, 1.3177, 1.9558], [1.329, 1.1067, 1.6595], [1.2493, 1.2584, 1.4468], [1.2343, 1.5877, 1.3774]]]], 2, 0.22074180124226278, [0.5743, 0.0859, 0.6282, 0.7851], [0.3957, 0.481, 0.1798, 0.4515], [0.1906, 0.8703, 0.2213, 0.9681], [0.2752, 0.0835, 0.314, 0.0704], Bat44539), 
LAve72134 = average_pooling2D_layer(Bat44539, 1, 1, 1, 2, false, Ave72134), 
LRes31222 = reshape_layer(Ave72134, [2, 2, 3, 1], Res31222), 
LCon93136 = conv3D_layer(Res31222, 1, 1, 3,[[[[[0.3536, 0.4547, 0.1598, 0.4862]], [[0.8521, 0.4271, 0.9554, 0.3898]], [[0.3032, 0.0718, 0.4407, 0.7141]]]]],[0, 0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con93136), 
LRes88654 = reshape_layer(Con93136, [2, 2, 4], Res88654), 
LRes3285 = reshape_layer(Res88654, [2, 8], Res3285), 
LGlo27784 = global_max_pool1D_layer(Res3285, Glo27784), 
exec_layers([LBat44539,LAve72134,LRes31222,LCon93136,LRes88654,LRes3285,LGlo27784],["Bat44539","Ave72134","Res31222","Con93136","Res88654","Res3285","Glo27784"],Glo27784,"Glo27784")

Actual (Unparsed): [[2.2489773, 1.4567494, 2.2895599, 2.4270098, 2.0132486, 1.2318169, 2.1061521, 1.9838149]]

Expected (Unparsed): [[2.248977322907193,1.4567493922488248,2.289559960026599,2.427009839815243,2.0132485960792983,1.2318168646508973,2.1061520753197596,1.9838149512157397]]

Actual:   [[2.249, 1.4568, 2.2896, 2.4271, 2.0133, 1.2319, 2.1062, 1.9839]]

Expected: [[2.249, 1.4568, 2.2896, 2.4271, 2.0133, 1.2319, 2.1062, 1.9839]]