import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max15668 = tf.keras.layers.Input(shape=([1, 1]))
in1Max15668 = tf.keras.layers.Input(shape=([1, 1]))
in0Ave96503 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Ave96503 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Con98260 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Ave50482 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Ave50482 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))

Max15668 = keras.layers.Maximum(name = 'Max15668', )([in0Max15668,in1Max15668])
Glo78228 = keras.layers.GlobalMaxPool1D(name = 'Glo78228', )(Max15668)
Res90544 = keras.layers.Reshape((1, 1), name = 'Res90544', )(Glo78228)
Res99965 = keras.layers.Reshape((1, 1, 1), name = 'Res99965', )(Res90544)
Res70010 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res70010', )(Res99965)
Zer17445 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (1, 0)), name = 'Zer17445', )(Res70010)
Ave96503 = keras.layers.Average(name = 'Ave96503', )([in0Ave96503,in1Ave96503])
Sub79802 = keras.layers.Subtract(name = 'Sub79802', )([Zer17445,Ave96503])
Con98260 = keras.layers.Concatenate(axis=4, name = 'Con98260', )([Sub79802,in0Con98260])
Ave50482 = keras.layers.Average(name = 'Ave50482', )([in0Ave50482,in1Ave50482])
Zer82923 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (1, 0)), name = 'Zer82923', )(Ave50482)
Ave21236 = keras.layers.Average(name = 'Ave21236', )([Con98260,Zer82923])
model = tf.keras.models.Model(inputs=[in0Max15668,in1Max15668,in0Ave96503,in1Ave96503,in0Con98260,in0Ave50482,in1Ave50482], outputs=Ave21236)
in0Max15668 = tf.constant([[[0.5713]]])
in1Max15668 = tf.constant([[[0.9437]]])
in0Ave96503 = tf.constant([[[[[0.8757], [0.7943]], [[0.2823], [0.6374]]]]])
in1Ave96503 = tf.constant([[[[[0.3102], [0.4931]], [[0.698], [0.4456]]]]])
in0Con98260 = tf.constant([[[[[0.0053], [0.7403]], [[0.3832], [0.9367]]]]])
in0Ave50482 = tf.constant([[[[[0.9105, 0.6666]]]]])
in1Ave50482 = tf.constant([[[[[0.0577, 0.6818]]]]])
print (np.array2string(model.predict([in0Max15668,in1Max15668,in0Ave96503,in1Ave96503,in0Con98260,in0Ave50482,in1Ave50482],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave21236.png')

LMax15668 = maximum_layer([[[[0.5713]]], [[[0.9437]]]], Max15668), 
LGlo78228 = global_max_pool1D_layer(Max15668, Glo78228), 
LRes90544 = reshape_layer(Glo78228, [1, 1], Res90544), 
LRes99965 = reshape_layer(Res90544, [1, 1, 1], Res99965), 
LRes70010 = reshape_layer(Res99965, [1, 1, 1, 1], Res70010), 
LZer17445 = zero_padding3D_layer(Res70010, 0, 0, 1, 0, 1, 0, Zer17445), 
LAve96503 = average_layer([[[[[[0.8757], [0.7943]], [[0.2823], [0.6374]]]]], [[[[[0.3102], [0.4931]], [[0.698], [0.4456]]]]]], Ave96503), 
LSub79802 = subtract_layer(Zer17445,Ave96503, Sub79802), 
LCon98260 = concatenate_layer([Sub79802,[[[[[0.0053], [0.7403]], [[0.3832], [0.9367]]]]]], 4, Con98260), 
LAve50482 = average_layer([[[[[[0.9105, 0.6666]]]]], [[[[[0.0577, 0.6818]]]]]], Ave50482), 
LZer82923 = zero_padding3D_layer(Ave50482, 0, 0, 1, 0, 1, 0, Zer82923), 
LAve21236 = average_layer([Con98260,Zer82923], Ave21236), 
exec_layers([LMax15668,LGlo78228,LRes90544,LRes99965,LRes70010,LZer17445,LAve96503,LSub79802,LCon98260,LAve50482,LZer82923,LAve21236],["Max15668","Glo78228","Res90544","Res99965","Res70010","Zer17445","Ave96503","Sub79802","Con98260","Ave50482","Zer82923","Ave21236"],Ave21236,"Ave21236")

Actual (Unparsed): [[[[[-0.2964750, 0.0026500], [-0.3218500, 0.3701500]], [[-0.2450750, 0.1916000], [0.4431500, 0.8054500]]]]]

Expected (Unparsed): [[[[[-0.296475,0.00265],[-0.32184999999999997,0.37015]],[[-0.245075,0.1916],[0.44315,0.80545]]]]]

Actual:   [[[[[-0.2964, 0.0027], [-0.3218, 0.3702]], [[-0.245, 0.1916], [0.4432, 0.8055]]]]]

Expected: [[[[[-0.2964, 0.0027], [-0.3218, 0.3702]], [[-0.245, 0.1916], [0.4432, 0.8055]]]]]