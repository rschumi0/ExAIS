import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Bat45064 = tf.keras.layers.Input(shape=([2, 3, 3]))
in0Ave36470 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave36470 = tf.keras.layers.Input(shape=([2, 2]))
in0Con97846 = tf.keras.layers.Input(shape=([2, 7]))
in0ReL14280 = tf.keras.layers.Input(shape=([2, 2]))
in0Con73353 = tf.keras.layers.Input(shape=([2, 7]))

Bat45064 = keras.layers.BatchNormalization(axis=1, epsilon=0.665832378491714,  name = 'Bat45064', )(in0Bat45064)
Res37026 = keras.layers.Reshape((2, 9), name = 'Res37026', )(Bat45064)
Ave36470 = keras.layers.Average(name = 'Ave36470', )([in0Ave36470,in1Ave36470])
Con97846 = keras.layers.Concatenate(axis=2, name = 'Con97846', )([Ave36470,in0Con97846])
Ave6586 = keras.layers.Average(name = 'Ave6586', )([Res37026,Con97846])
ReL14280 = keras.layers.ReLU(max_value=0.03635360498168685, negative_slope=6.097422615487711, threshold=0.8600986888193429, name = 'ReL14280', input_shape=(2, 2))(in0ReL14280)
Con73353 = keras.layers.Concatenate(axis=2, name = 'Con73353', )([ReL14280,in0Con73353])
Ave50728 = keras.layers.Average(name = 'Ave50728', )([Ave6586,Con73353])
model = tf.keras.models.Model(inputs=[in0Bat45064,in0Ave36470,in1Ave36470,in0Con97846,in0ReL14280,in0Con73353], outputs=Ave50728)
w = model.get_layer('Bat45064').get_weights() 
w[0] = np.array([0.4679, 0.4276])
w[1] = np.array([0.9679, 0.4281])
w[2] = np.array([0.5833, 0.1016])
w[3] = np.array([0.5446, 0.0407])
model.get_layer('Bat45064').set_weights(w) 
in0Bat45064 = tf.constant([[[[1.1563, 1.0496, 1.1826], [1.0801, 1.3863, 1.9302], [1.5263, 1.6639, 1.8992]], [[1.8332, 1.0646, 1.1259], [1.811, 1.179, 1.8841], [1.3163, 1.2134, 1.8178]]]])
in0Ave36470 = tf.constant([[[0.719, 0.8329], [0.625, 0.7717]]])
in1Ave36470 = tf.constant([[[0.6297, 0.3382], [0.3142, 0.7907]]])
in0Con97846 = tf.constant([[[0.6805, 0.7429, 0.2709, 0.5343, 0.9529, 0.4579, 0.0853], [0.5025, 0.9757, 0.6676, 0.5804, 0.9626, 0.4552, 0.0935]]])
in0ReL14280 = tf.constant([[[0.0316, 0.3202], [0.9095, 0.0156]]])
in0Con73353 = tf.constant([[[0.9832, 0.7246, 0.7737, 0.9175, 0.9805, 0.9901, 0.4946], [0.2089, 0.8263, 0.7445, 0.2297, 0.8098, 0.7432, 0.6233]]])
print (np.array2string(model.predict([in0Bat45064,in0Ave36470,in1Ave36470,in0Con97846,in0ReL14280,in0Con73353],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave50728.png')

LBat45064 = batch_normalization_layer([[[[1.1563, 1.0496, 1.1826], [1.0801, 1.3863, 1.9302], [1.5263, 1.6639, 1.8992]], [[1.8332, 1.0646, 1.1259], [1.811, 1.179, 1.8841], [1.3163, 1.2134, 1.8178]]]], 1, 0.665832378491714, [0.4679, 0.4276], [0.9679, 0.4281], [0.5833, 0.1016], [0.5446, 0.0407], Bat45064), 
LRes37026 = reshape_layer(Bat45064, [2, 9], Res37026), 
LAve36470 = average_layer([[[[0.719, 0.8329], [0.625, 0.7717]]], [[[0.6297, 0.3382], [0.3142, 0.7907]]]], Ave36470), 
LCon97846 = concatenate_layer([Ave36470,[[[0.6805, 0.7429, 0.2709, 0.5343, 0.9529, 0.4579, 0.0853], [0.5025, 0.9757, 0.6676, 0.5804, 0.9626, 0.4552, 0.0935]]]], 2, Con97846), 
LAve6586 = average_layer([Res37026,Con97846], Ave6586), 
LReL14280 = relu_layer([[[0.0316, 0.3202], [0.9095, 0.0156]]], 0.03635360498168685, 6.097422615487711, 0.8600986888193429, ReL14280), 
LCon73353 = concatenate_layer([ReL14280,[[[0.9832, 0.7246, 0.7737, 0.9175, 0.9805, 0.9901, 0.4946], [0.2089, 0.8263, 0.7445, 0.2297, 0.8098, 0.7432, 0.6233]]]], 2, Con73353), 
LAve50728 = average_layer([Ave6586,Con73353], Ave50728), 
exec_layers([LBat45064,LRes37026,LAve36470,LCon97846,LAve6586,LReL14280,LCon73353,LAve50728],["Bat45064","Res37026","Ave36470","Con97846","Ave6586","ReL14280","Con73353","Ave50728"],Ave50728,"Ave50728")

Actual (Unparsed): [[[-2.0543684, -1.2080548, 0.9674187, 0.8428207, 0.7819265, 0.9775050, 1.0707115, 0.9663915, 0.6505090], [0.4628231, -2.1498354, 0.4673683, 0.9814979, 0.7831965, 0.5936696, 0.9070580, 0.7338214, 0.6603127]]]

Expected (Unparsed): [[[-2.0543683641153385,-1.2080548289646977,0.9674187232873175,0.8428207270634729,0.7819264972463139,0.9775049864770363,1.07071156525937,0.9663914606779163,0.6505090071312882],[0.4628230648330488,-2.1498353783265407,0.46736832930071665,0.9814979128249978,0.7831964761189029,0.5936696177667944,0.9070580026374895,0.733821396091513,0.6603127225870252]]]

Actual:   [[[-2.0543, -1.208, 0.9675, 0.8429, 0.782, 0.9776, 1.0708, 0.9664, 0.6506], [0.4629, -2.1498, 0.4674, 0.9815, 0.7832, 0.5937, 0.9071, 0.7339, 0.6604]]]

Expected: [[[-2.0543, -1.208, 0.9675, 0.8429, 0.782, 0.9776, 1.0708, 0.9664, 0.6506], [0.4629, -2.1498, 0.4674, 0.9815, 0.7832, 0.5937, 0.9071, 0.7339, 0.6604]]]