import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min86977 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Min86977 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Sub53543 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub53543 = tf.keras.layers.Input(shape=([2, 2]))
in0Dot18321 = tf.keras.layers.Input(shape=([2]))
in1Dot18321 = tf.keras.layers.Input(shape=([2]))
in0Con89765 = tf.keras.layers.Input(shape=([1]))
in0Con57383 = tf.keras.layers.Input(shape=([5, 1]))
in0Sub41342 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub41342 = tf.keras.layers.Input(shape=([3, 2]))

Min86977 = keras.layers.Minimum(name = 'Min86977', )([in0Min86977,in1Min86977])
Res78171 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res78171', )(Min86977)
Glo96654 = keras.layers.GlobalMaxPool3D(name = 'Glo96654', )(Res78171)
Res39282 = keras.layers.Reshape((1, 1), name = 'Res39282', )(Glo96654)
Zer56878 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer56878', )(Res39282)
Sub53543 = keras.layers.Subtract(name = 'Sub53543', )([in0Sub53543,in1Sub53543])
Dot69733 = keras.layers.Dot(axes=(1, 1), name = 'Dot69733', )([Zer56878,Sub53543])
Fla97967 = keras.layers.Flatten(name = 'Fla97967', )(Dot69733)
Dot18321 = keras.layers.Dot(axes=(1, 1), name = 'Dot18321', )([in0Dot18321,in1Dot18321])
Con89765 = keras.layers.Concatenate(axis=1, name = 'Con89765', )([Dot18321,in0Con89765])
Mul97131 = keras.layers.Multiply(name = 'Mul97131', )([Fla97967,Con89765])
Res60861 = keras.layers.Reshape((2, 1), name = 'Res60861', )(Mul97131)
Zer95103 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer95103', )(Res60861)
Con57383 = keras.layers.Concatenate(axis=2, name = 'Con57383', )([Zer95103,in0Con57383])
Sub41342 = keras.layers.Subtract(name = 'Sub41342', )([in0Sub41342,in1Sub41342])
Loc41159 = keras.layers.LocallyConnected1D(2, (1),strides=(1), name = 'Loc41159', )(Sub41342)
Zer21517 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer21517', )(Loc41159)
Max83961 = keras.layers.Maximum(name = 'Max83961', )([Con57383,Zer21517])
model = tf.keras.models.Model(inputs=[in0Min86977,in1Min86977,in0Sub53543,in1Sub53543,in0Dot18321,in1Dot18321,in0Con89765,in0Con57383,in0Sub41342,in1Sub41342], outputs=Max83961)
w = model.get_layer('Loc41159').get_weights() 
w[0] = np.array([[[0.8244, 0.3518], [0.8959, 0.9623]], [[0.7434, 0.0419], [0.0103, 0.9965]], [[0.6247, 0.1459], [0.2535, 0.5651]]])
w[1] = np.array([[0, 0], [0, 0], [0, 0]])
model.get_layer('Loc41159').set_weights(w) 
in0Min86977 = tf.constant([[[[0.7434], [0.689]], [[0.5098], [0.5871]]]])
in1Min86977 = tf.constant([[[[0.1849], [0.1682]], [[0.3184], [0.2524]]]])
in0Sub53543 = tf.constant([[[0.5319, 0.9932], [0.9206, 0.2422]]])
in1Sub53543 = tf.constant([[[0.4285, 0.8431], [0.5042, 0.7143]]])
in0Dot18321 = tf.constant([[0.3166, 0.4901]])
in1Dot18321 = tf.constant([[0.8157, 0.8561]])
in0Con89765 = tf.constant([[0.9435]])
in0Con57383 = tf.constant([[[0.3715], [0.7774], [0.1023], [0.2458], [0.6172]]])
in0Sub41342 = tf.constant([[[0.7832, 0.4538], [0.3001, 0.6425], [0.3709, 0.4502]]])
in1Sub41342 = tf.constant([[[0.6336, 0.5389], [0.5411, 0.9524], [0.252, 0.1562]]])
print (np.array2string(model.predict([in0Min86977,in1Min86977,in0Sub53543,in1Sub53543,in0Dot18321,in1Dot18321,in0Con89765,in0Con57383,in0Sub41342,in1Sub41342],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max83961.png')

LMin86977 = minimum_layer([[[[[0.7434], [0.689]], [[0.5098], [0.5871]]]], [[[[0.1849], [0.1682]], [[0.3184], [0.2524]]]]], Min86977), 
LRes78171 = reshape_layer(Min86977, [2, 2, 1, 1], Res78171), 
LGlo96654 = global_max_pool3D_layer(Res78171, Glo96654), 
LRes39282 = reshape_layer(Glo96654, [1, 1], Res39282), 
LZer56878 = zero_padding1D_layer(Res39282, 1, 0, Zer56878), 
LSub53543 = subtract_layer([[[0.5319, 0.9932], [0.9206, 0.2422]]], [[[0.4285, 0.8431], [0.5042, 0.7143]]], Sub53543), 
LDot69733 = dot_layer(Zer56878,Sub53543, 1, 1, Dot69733), 
LFla97967 = flatten_layer(Dot69733, Fla97967), 
LDot18321 = dot_layer([[0.3166, 0.4901]], [[0.8157, 0.8561]], 1, 1, Dot18321), 
LCon89765 = concatenate_layer([Dot18321,[[0.9435]]], 1, Con89765), 
LMul97131 = multiply_layer([Fla97967,Con89765], Mul97131), 
LRes60861 = reshape_layer(Mul97131, [2, 1], Res60861), 
LZer95103 = zero_padding1D_layer(Res60861, 3, 0, Zer95103), 
LCon57383 = concatenate_layer([Zer95103,[[[0.3715], [0.7774], [0.1023], [0.2458], [0.6172]]]], 2, Con57383), 
LSub41342 = subtract_layer([[[0.7832, 0.4538], [0.3001, 0.6425], [0.3709, 0.4502]]], [[[0.6336, 0.5389], [0.5411, 0.9524], [0.252, 0.1562]]], Sub41342), 
LLoc41159 = locally_connected1D_layer(Sub41342, 1,[[[0.8244, 0.3518], [0.8959, 0.9623]], [[0.7434, 0.0419], [0.0103, 0.9965]], [[0.6247, 0.1459], [0.2535, 0.5651]]],[[0, 0], [0, 0], [0, 0]], 1, Loc41159), 
LZer21517 = zero_padding1D_layer(Loc41159, 1, 1, Zer21517), 
LMax83961 = maximum_layer([Con57383,Zer21517], Max83961), 
exec_layers([LMin86977,LRes78171,LGlo96654,LRes39282,LZer56878,LSub53543,LDot69733,LFla97967,LDot18321,LCon89765,LMul97131,LRes60861,LZer95103,LCon57383,LSub41342,LLoc41159,LZer21517,LMax83961],["Min86977","Res78171","Glo96654","Res39282","Zer56878","Sub53543","Dot69733","Fla97967","Dot18321","Con89765","Mul97131","Res60861","Zer95103","Con57383","Sub41342","Loc41159","Zer21517","Max83961"],Max83961,"Max83961")

Actual (Unparsed): [[[0.0000000, 0.3715000], [0.0470892, 0.7774000], [0.0000000, 0.1023000], [0.1488058, 0.2458000], [0.0000000, 0.6172000]]]

Expected (Unparsed): [[[0,0.3715],[0.0470891499999999,0.7774],[0,0.1023],[0.14880583,0.2458],[0,0.6172]]]

Actual:   [[[0, 0.3715], [0.0471, 0.7774], [0, 0.1023], [0.1489, 0.2458], [0, 0.6172]]]

Expected: [[[0, 0.3715], [0.0471, 0.7774], [0, 0.1023], [0.1489, 0.2458], [0, 0.6172]]]