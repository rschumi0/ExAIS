import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add84113 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Add84113 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con74802 = tf.keras.layers.Input(shape=([2, 1]))
in0Con85870 = tf.keras.layers.Input(shape=([2, 2]))
in0ReL28028 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in0Max65990 = tf.keras.layers.Input(shape=([2, 2]))
in0Con44028 = tf.keras.layers.Input(shape=([2, 2]))

Add84113 = keras.layers.Add(name = 'Add84113', )([in0Add84113,in1Add84113])
Res8999 = keras.layers.Reshape((2, 2), name = 'Res8999', )(Add84113)
Con74802 = keras.layers.Conv1D(2, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con74802', )(in0Con74802)
ELU64002 = keras.layers.ELU(alpha=-3.0444097708346813, name = 'ELU64002', )(Con74802)
Min88229 = keras.layers.Minimum(name = 'Min88229', )([Res8999,ELU64002])
Con85870 = keras.layers.Concatenate(axis=2, name = 'Con85870', )([Min88229,in0Con85870])
ReL28028 = keras.layers.ReLU(max_value=8.635163824304238, negative_slope=4.837670957755731, threshold=3.6459288645158816, name = 'ReL28028', input_shape=(2, 1, 2, 2))(in0ReL28028)
Sof60603 = keras.layers.Softmax(axis=1, name = 'Sof60603', )(ReL28028)
Res4235 = keras.layers.Reshape((2, 1, 4), name = 'Res4235', )(Sof60603)
Res49438 = keras.layers.Reshape((2, 4), name = 'Res49438', )(Res4235)
Dot69357 = keras.layers.Dot(axes=(2, 2), name = 'Dot69357', )([Con85870,Res49438])
Res9485 = keras.layers.Reshape((2, 2, 1), name = 'Res9485', )(Dot69357)
Sep2277 = keras.layers.SeparableConv2D(4, (2, 1),strides=(2, 2), padding='valid', name = 'Sep2277', )(Res9485)
Res25619 = keras.layers.Reshape((1, 4), name = 'Res25619', )(Sep2277)
Zer5032 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer5032', )(Res25619)
Max65990 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='same', name = 'Max65990', )(in0Max65990)
Con44028 = keras.layers.Concatenate(axis=2, name = 'Con44028', )([Max65990,in0Con44028])
Sub2086 = keras.layers.Subtract(name = 'Sub2086', )([Zer5032,Con44028])
model = tf.keras.models.Model(inputs=[in0Add84113,in1Add84113,in0Con74802,in0Con85870,in0ReL28028,in0Max65990,in0Con44028], outputs=Sub2086)
w = model.get_layer('Con74802').get_weights() 
w[0] = np.array([[[0.2077, 0.9243]]])
w[1] = np.array([0, 0])
model.get_layer('Con74802').set_weights(w) 
w = model.get_layer('Sep2277').get_weights() 
w[0] = np.array([[[[0.4382]]], [[[0.2861]]]])
w[1] = np.array([[[[0.6898, 0.6406, 0.294, 0.3557]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep2277').set_weights(w) 
in0Add84113 = tf.constant([[[[0.2468, 0.8186]], [[0.4796, 0.1213]]]])
in1Add84113 = tf.constant([[[[0.0265, 0.3986]], [[0.1842, 0.0993]]]])
in0Con74802 = tf.constant([[[0.475], [0.1019]]])
in0Con85870 = tf.constant([[[0.0774, 0.3989], [0.7307, 0.7205]]])
in0ReL28028 = tf.constant([[[[[0.4764, 0.5028], [0.0226, 0.837]]], [[[0.1813, 0.7313], [0.119, 0.9923]]]]])
in0Max65990 = tf.constant([[[1.5281, 1.3701], [1.7536, 1.6311]]])
in0Con44028 = tf.constant([[[0.9456, 0.3581], [0.9147, 0.4299]]])
print (np.array2string(model.predict([in0Add84113,in1Add84113,in0Con74802,in0Con85870,in0ReL28028,in0Max65990,in0Con44028],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub2086.png')

LAdd84113 = add_layer([[[[[0.2468, 0.8186]], [[0.4796, 0.1213]]]], [[[[0.0265, 0.3986]], [[0.1842, 0.0993]]]]], Add84113), 
LRes8999 = reshape_layer(Add84113, [2, 2], Res8999), 
LCon74802 = conv1D_layer([[[0.475], [0.1019]]], 1,[[[0.2077, 0.9243]]],[0, 0], 1, false, 1, Con74802), 
LELU64002 = elu_layer(Con74802, -3.0444097708346813, ELU64002), 
LMin88229 = minimum_layer([Res8999,ELU64002], Min88229), 
LCon85870 = concatenate_layer([Min88229,[[[0.0774, 0.3989], [0.7307, 0.7205]]]], 2, Con85870), 
LReL28028 = relu_layer([[[[[0.4764, 0.5028], [0.0226, 0.837]]], [[[0.1813, 0.7313], [0.119, 0.9923]]]]], 8.635163824304238, 4.837670957755731, 3.6459288645158816, ReL28028), 
LSof60603 = softmax_layer(ReL28028, 1, Sof60603), 
LRes4235 = reshape_layer(Sof60603, [2, 1, 4], Res4235), 
LRes49438 = reshape_layer(Res4235, [2, 4], Res49438), 
LDot69357 = dot_layer(Con85870,Res49438, 2, 2, Dot69357), 
LRes9485 = reshape_layer(Dot69357, [2, 2, 1], Res9485), 
LSep2277 = separable_conv2D_layer(Res9485, 2, 1,[[[[[0.4382]]], [[[0.2861]]]],[[[[0.6898, 0.6406, 0.294, 0.3557]]]]],[0, 0, 0, 0], 2, 2, false, Sep2277), 
LRes25619 = reshape_layer(Sep2277, [1, 4], Res25619), 
LZer5032 = zero_padding1D_layer(Res25619, 1, 0, Zer5032), 
LMax65990 = max_pool1D_layer([[[1.5281, 1.3701], [1.7536, 1.6311]]], 1, 1, true, Max65990), 
LCon44028 = concatenate_layer([Max65990,[[[0.9456, 0.3581], [0.9147, 0.4299]]]], 2, Con44028), 
LSub2086 = subtract_layer(Zer5032,Con44028, Sub2086), 
exec_layers([LAdd84113,LRes8999,LCon74802,LELU64002,LMin88229,LCon85870,LReL28028,LSof60603,LRes4235,LRes49438,LDot69357,LRes9485,LSep2277,LRes25619,LZer5032,LMax65990,LCon44028,LSub2086],["Add84113","Res8999","Con74802","ELU64002","Min88229","Con85870","ReL28028","Sof60603","Res4235","Res49438","Dot69357","Res9485","Sep2277","Res25619","Zer5032","Max65990","Con44028","Sub2086"],Sub2086,"Sub2086")

Actual (Unparsed): [[[-1.5281000, -1.3701000, -0.9456000, -0.3581000], [-1.5397134, -1.4324689, -0.8235393, -0.3196079]]]

Expected (Unparsed): [[[-1.5281,-1.3701,-0.9456,-0.3581],[-1.5397134114991846,-1.4324688770750618,-0.8235392910709773,-0.31960794501342404]]]

Actual:   [[[-1.5281, -1.3701, -0.9456, -0.3581], [-1.5397, -1.4324, -0.8235, -0.3196]]]

Expected: [[[-1.5281, -1.3701, -0.9456, -0.3581], [-1.5397, -1.4324, -0.8235, -0.3196]]]