import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot3110 = tf.keras.layers.Input(shape=([2]))
in1Dot3110 = tf.keras.layers.Input(shape=([2]))
in0Con73802 = tf.keras.layers.Input(shape=([4, 3]))
in0Min92924 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Min92924 = tf.keras.layers.Input(shape=([2, 2, 2]))

Dot3110 = keras.layers.Dot(axes=(1, 1), name = 'Dot3110', )([in0Dot3110,in1Dot3110])
Res34678 = keras.layers.Reshape((1, 1), name = 'Res34678', )(Dot3110)
GRU4940 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU4940', )(Res34678)
Res6122 = keras.layers.Reshape((1, 1), name = 'Res6122', )(GRU4940)
Zer85394 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer85394', )(Res6122)
Con73802 = keras.layers.Concatenate(axis=2, name = 'Con73802', )([Zer85394,in0Con73802])
Min92924 = keras.layers.Minimum(name = 'Min92924', )([in0Min92924,in1Min92924])
Res11135 = keras.layers.Reshape((2, 4), name = 'Res11135', )(Min92924)
Zer37143 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer37143', )(Res11135)
Sub19597 = keras.layers.Subtract(name = 'Sub19597', )([Con73802,Zer37143])
model = tf.keras.models.Model(inputs=[in0Dot3110,in1Dot3110,in0Con73802,in0Min92924,in1Min92924], outputs=Sub19597)
w = model.get_layer('GRU4940').get_weights() 
w[0] = np.array([[1, 3, 10]])
w[1] = np.array([[8, 5, 8]])
w[2] = np.array([[7, 6, 1], [7, 10, 8]])
model.get_layer('GRU4940').set_weights(w) 
in0Dot3110 = tf.constant([[0.3612, 0.8104]])
in1Dot3110 = tf.constant([[0.8431, 0.9968]])
in0Con73802 = tf.constant([[[0.7058, 0.8066, 0.8982], [0.4212, 0.8808, 0.3622], [0.2737, 0.0397, 0.3095], [0.7045, 0.7687, 0.7348]]])
in0Min92924 = tf.constant([[[[0.3945, 0.6016], [0.6818, 0.6231]], [[0.3963, 0.3612], [0.1469, 0.555]]]])
in1Min92924 = tf.constant([[[[0.3853, 0.8912], [0.4937, 0.723]], [[0.4179, 0.1365], [0.8527, 0.1586]]]])
print (np.array2string(model.predict([in0Dot3110,in1Dot3110,in0Con73802,in0Min92924,in1Min92924],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub19597.png')

LDot3110 = dot_layer([[0.3612, 0.8104]], [[0.8431, 0.9968]], 1, 1, Dot3110), 
LRes34678 = reshape_layer(Dot3110, [1, 1], Res34678), 
LGRU4940 = gru_layer(Res34678,[[1, 3, 10]],[[8, 5, 8]],[[7, 6, 1], [7, 10, 8]], true, GRU4940), 
LRes6122 = reshape_layer(GRU4940, [1, 1], Res6122), 
LZer85394 = zero_padding1D_layer(Res6122, 3, 0, Zer85394), 
LCon73802 = concatenate_layer([Zer85394,[[[0.7058, 0.8066, 0.8982], [0.4212, 0.8808, 0.3622], [0.2737, 0.0397, 0.3095], [0.7045, 0.7687, 0.7348]]]], 2, Con73802), 
LMin92924 = minimum_layer([[[[[0.3945, 0.6016], [0.6818, 0.6231]], [[0.3963, 0.3612], [0.1469, 0.555]]]], [[[[0.3853, 0.8912], [0.4937, 0.723]], [[0.4179, 0.1365], [0.8527, 0.1586]]]]], Min92924), 
LRes11135 = reshape_layer(Min92924, [2, 4], Res11135), 
LZer37143 = zero_padding1D_layer(Res11135, 1, 1, Zer37143), 
LSub19597 = subtract_layer(Con73802,Zer37143, Sub19597), 
exec_layers([LDot3110,LRes34678,LGRU4940,LRes6122,LZer85394,LCon73802,LMin92924,LRes11135,LZer37143,LSub19597],["Dot3110","Res34678","GRU4940","Res6122","Zer85394","Con73802","Min92924","Res11135","Zer37143","Sub19597"],Sub19597,"Sub19597")

Actual (Unparsed): [[[0.0000000, 0.7058000, 0.8066000, 0.8982000], [-0.3853000, -0.1804000, 0.3871000, -0.2609000], [-0.3963000, 0.1372000, -0.1072000, 0.1509000], [0.0000003, 0.7045000, 0.7687000, 0.7348000]]]

Expected (Unparsed): [[[0,0.7058,0.8066,0.8982],[-0.3853,-0.1804,0.3871,-0.26089999999999997],[-0.3963,0.1372,-0.1072,0.1509],[2.733986875780303e-7,0.7045,0.7687,0.7348]]]

Actual:   [[[0, 0.7058, 0.8066, 0.8982], [-0.3853, -0.1804, 0.3871, -0.2609], [-0.3963, 0.1372, -0.1072, 0.1509], [0, 0.7045, 0.7687, 0.7348]]]

Expected: [[[0, 0.7058, 0.8066, 0.8982], [-0.3853, -0.1804, 0.3871, -0.2608], [-0.3963, 0.1372, -0.1072, 0.1509], [0, 0.7045, 0.7687, 0.7348]]]