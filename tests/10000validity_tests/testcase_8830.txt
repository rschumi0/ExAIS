import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul19752 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul19752 = tf.keras.layers.Input(shape=([2, 1]))
in0Con96359 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Sub54760 = tf.keras.layers.Input(shape=([3, 3, 2]))
in1Sub54760 = tf.keras.layers.Input(shape=([3, 3, 2]))
in0Dot8115 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot8115 = tf.keras.layers.Input(shape=([2, 3]))
in0Con43649 = tf.keras.layers.Input(shape=([3, 3]))

Mul19752 = keras.layers.Multiply(name = 'Mul19752', )([in0Mul19752,in1Mul19752])
Res49543 = keras.layers.Reshape((2, 1, 1), name = 'Res49543', )(Mul19752)
Zer16337 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer16337', )(Res49543)
Con96359 = keras.layers.Concatenate(axis=3, name = 'Con96359', )([Zer16337,in0Con96359])
Sub54760 = keras.layers.Subtract(name = 'Sub54760', )([in0Sub54760,in1Sub54760])
Add53406 = keras.layers.Add(name = 'Add53406', )([Con96359,Sub54760])
Res95082 = keras.layers.Reshape((3, 6), name = 'Res95082', )(Add53406)
PRe40514 = keras.layers.PReLU(name = 'PRe40514', )(Res95082)
Dot8115 = keras.layers.Dot(axes=(1, 1), name = 'Dot8115', )([in0Dot8115,in1Dot8115])
Con43649 = keras.layers.Concatenate(axis=2, name = 'Con43649', )([Dot8115,in0Con43649])
Ave61706 = keras.layers.Average(name = 'Ave61706', )([PRe40514,Con43649])
model = tf.keras.models.Model(inputs=[in0Mul19752,in1Mul19752,in0Con96359,in0Sub54760,in1Sub54760,in0Dot8115,in1Dot8115,in0Con43649], outputs=Ave61706)
w = model.get_layer('PRe40514').get_weights() 
w[0] = np.array([[0.9005, 0.1871, 0.8268, 0.024, 0.5319, 0.0524], [0.0797, 0.3133, 0.1207, 0.1629, 0.0756, 0.5793], [0.8217, 0.6707, 0.3688, 0.2934, 0.3033, 0.3505]])
model.get_layer('PRe40514').set_weights(w) 
in0Mul19752 = tf.constant([[[0.0772], [0.4452]]])
in1Mul19752 = tf.constant([[[0.1429], [0.2827]]])
in0Con96359 = tf.constant([[[[0.46], [0.9164], [0.7613]], [[0.4084], [0.1271], [0.6072]], [[0.5174], [0.4025], [0.3609]]]])
in0Sub54760 = tf.constant([[[[0.4685, 0.3975], [0.3204, 0.521], [0.6758, 0.5751]], [[0.466, 0.2997], [0.4044, 0.5757], [0.652, 0.9558]], [[0.6128, 0.9981], [0.6946, 0.7397], [0.4002, 0.5202]]]])
in1Sub54760 = tf.constant([[[[0.6229, 0.9576], [0.2933, 0.199], [0.3214, 0.2371]], [[0.1666, 0.6336], [0.8971, 0.0827], [0.6115, 0.9408]], [[0.9176, 0.8339], [0.4283, 0.3271], [0.0438, 0.116]]]])
in0Dot8115 = tf.constant([[[0.057, 0.4119, 0.7364], [0.8838, 0.1867, 0.3535]]])
in1Dot8115 = tf.constant([[[0.6555, 0.196, 0.4856], [0.262, 0.0905, 0.9321]]])
in0Con43649 = tf.constant([[[0.0577, 0.9889, 0.2242], [0.954, 0.2134, 0.4359], [0.9647, 0.8339, 0.4171]]])
print (np.array2string(model.predict([in0Mul19752,in1Mul19752,in0Con96359,in0Sub54760,in1Sub54760,in0Dot8115,in1Dot8115,in0Con43649],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave61706.png')

LMul19752 = multiply_layer([[[[0.0772], [0.4452]]], [[[0.1429], [0.2827]]]], Mul19752), 
LRes49543 = reshape_layer(Mul19752, [2, 1, 1], Res49543), 
LZer16337 = zero_padding2D_layer(Res49543, 1, 0, 2, 0, Zer16337), 
LCon96359 = concatenate_layer([Zer16337,[[[[0.46], [0.9164], [0.7613]], [[0.4084], [0.1271], [0.6072]], [[0.5174], [0.4025], [0.3609]]]]], 3, Con96359), 
LSub54760 = subtract_layer([[[[0.4685, 0.3975], [0.3204, 0.521], [0.6758, 0.5751]], [[0.466, 0.2997], [0.4044, 0.5757], [0.652, 0.9558]], [[0.6128, 0.9981], [0.6946, 0.7397], [0.4002, 0.5202]]]], [[[[0.6229, 0.9576], [0.2933, 0.199], [0.3214, 0.2371]], [[0.1666, 0.6336], [0.8971, 0.0827], [0.6115, 0.9408]], [[0.9176, 0.8339], [0.4283, 0.3271], [0.0438, 0.116]]]], Sub54760), 
LAdd53406 = add_layer([Con96359,Sub54760], Add53406), 
LRes95082 = reshape_layer(Add53406, [3, 6], Res95082), 
LPRe40514 = prelu_layer(Res95082, [[0.9005, 0.1871, 0.8268, 0.024, 0.5319, 0.0524], [0.0797, 0.3133, 0.1207, 0.1629, 0.0756, 0.5793], [0.8217, 0.6707, 0.3688, 0.2934, 0.3033, 0.3505]], PRe40514), 
LDot8115 = dot_layer([[[0.057, 0.4119, 0.7364], [0.8838, 0.1867, 0.3535]]], [[[0.6555, 0.196, 0.4856], [0.262, 0.0905, 0.9321]]], 1, 1, Dot8115), 
LCon43649 = concatenate_layer([Dot8115,[[[0.0577, 0.9889, 0.2242], [0.954, 0.2134, 0.4359], [0.9647, 0.8339, 0.4171]]]], 2, Con43649), 
LAve61706 = average_layer([PRe40514,Con43649], Ave61706), 
exec_layers([LMul19752,LRes49543,LZer16337,LCon96359,LSub54760,LAdd53406,LRes95082,LPRe40514,LDot8115,LCon43649,LAve61706],["Mul19752","Res49543","Zer16337","Con96359","Sub54760","Add53406","Res95082","PRe40514","Dot8115","Con43649","Ave61706"],Ave61706,"Ave61706")

Actual (Unparsed): [[[0.0649409, 0.0362136, 0.4392846, 0.6480500, 0.6716500, 0.6617500], [0.3091579, 0.0860644, 0.1572864, 0.7870500, 0.1324659, 0.5290500], [0.1624365, 0.4289631, 0.4766966, 0.8899000, 0.6580790, 0.5911000]]]

Expected (Unparsed): [[[0.06494095000000003,0.036213595,0.43928459000000003,0.64805,0.67165,0.66175],[0.309157925,0.08606437499999997,0.15728641,0.78705,0.13246594,0.52905],[0.16243652000000003,0.42896307499999997,0.476696595,0.8899,0.65807902,0.5911]]]

Actual:   [[[0.065, 0.0363, 0.4393, 0.6481, 0.6717, 0.6618], [0.3092, 0.0861, 0.1573, 0.7871, 0.1325, 0.5291], [0.1625, 0.429, 0.4767, 0.8899, 0.6581, 0.5911]]]

Expected: [[[0.065, 0.0363, 0.4393, 0.6481, 0.6717, 0.6618], [0.3092, 0.0861, 0.1573, 0.7871, 0.1325, 0.5291], [0.1625, 0.429, 0.4767, 0.8899, 0.6581, 0.5911]]]