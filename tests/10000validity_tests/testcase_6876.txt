import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub27800 = tf.keras.layers.Input(shape=([2]))
in1Sub27800 = tf.keras.layers.Input(shape=([2]))
in0Con55480 = tf.keras.layers.Input(shape=([2, 5]))
in0Cro5147 = tf.keras.layers.Input(shape=([2, 4]))
in0Con32137 = tf.keras.layers.Input(shape=([2, 2]))
in0Sub81603 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub81603 = tf.keras.layers.Input(shape=([2, 3]))
in0Dot15823 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot15823 = tf.keras.layers.Input(shape=([2, 2]))
in0Con96395 = tf.keras.layers.Input(shape=([2, 4]))

Sub27800 = keras.layers.Subtract(name = 'Sub27800', )([in0Sub27800,in1Sub27800])
Lay90167 = keras.layers.LayerNormalization(axis=1, epsilon=1.386681566541737, name = 'Lay90167', )(Sub27800)
Res53888 = keras.layers.Reshape((2, 1), name = 'Res53888', )(Lay90167)
Con55480 = keras.layers.Concatenate(axis=2, name = 'Con55480', )([Res53888,in0Con55480])
Cro5147 = keras.layers.Cropping1D(cropping=((1, 0)), name = 'Cro5147', )(in0Cro5147)
Zer65624 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer65624', )(Cro5147)
Con32137 = keras.layers.Concatenate(axis=2, name = 'Con32137', )([Zer65624,in0Con32137])
Sub81603 = keras.layers.Subtract(name = 'Sub81603', )([in0Sub81603,in1Sub81603])
Res86743 = keras.layers.Reshape((2, 3, 1), name = 'Res86743', )(Sub81603)
Con14179 = keras.layers.Conv2D(2, (2, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con14179', )(Res86743)
Res9506 = keras.layers.Reshape((2, 6), name = 'Res9506', )(Con14179)
Dot15823 = keras.layers.Dot(axes=(2, 1), name = 'Dot15823', )([in0Dot15823,in1Dot15823])
Con96395 = keras.layers.Concatenate(axis=2, name = 'Con96395', )([Dot15823,in0Con96395])
Sub95500 = keras.layers.Subtract(name = 'Sub95500', )([Res9506,Con96395])
Max78113 = keras.layers.Maximum(name = 'Max78113', )([Con32137,Sub95500])
Sub44184 = keras.layers.Subtract(name = 'Sub44184', )([Con55480,Max78113])
model = tf.keras.models.Model(inputs=[in0Sub27800,in1Sub27800,in0Con55480,in0Cro5147,in0Con32137,in0Sub81603,in1Sub81603,in0Dot15823,in1Dot15823,in0Con96395], outputs=Sub44184)
w = model.get_layer('Con14179').get_weights() 
w[0] = np.array([[[[0.8429, 0.9308]]], [[[0.902, 0.7416]]]])
w[1] = np.array([0, 0])
model.get_layer('Con14179').set_weights(w) 
in0Sub27800 = tf.constant([[0.5555, 0.828]])
in1Sub27800 = tf.constant([[0.9917, 0.9403]])
in0Con55480 = tf.constant([[[0.7586, 0.8279, 0.6124, 0.1834, 0.9336], [0.3778, 0.9274, 0.6036, 0.0284, 0.8682]]])
in0Cro5147 = tf.constant([[[1.1822, 1.7321, 1.6248, 1.0342], [1.9805, 1.0063, 1.7769, 1.0903]]])
in0Con32137 = tf.constant([[[0.2076, 0.6146], [0.0835, 0.6222]]])
in0Sub81603 = tf.constant([[[0.5528, 0.5289, 0.281], [0.3726, 0.075, 0.519]]])
in1Sub81603 = tf.constant([[[0.245, 0.4622, 0.0899], [0.4756, 0.6147, 0.2491]]])
in0Dot15823 = tf.constant([[[0.9267, 0.088], [0.0012, 0.6643]]])
in1Dot15823 = tf.constant([[[0.015, 0.6788], [0.5459, 0.3117]]])
in0Con96395 = tf.constant([[[0.749, 0.4531, 0.2873, 0.0506], [0.6445, 0.9401, 0.876, 0.5314]]])
print (np.array2string(model.predict([in0Sub27800,in1Sub27800,in0Con55480,in0Cro5147,in0Con32137,in0Sub81603,in1Sub81603,in0Dot15823,in1Dot15823,in0Con96395],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub44184.png')

LSub27800 = subtract_layer([[0.5555, 0.828]], [[0.9917, 0.9403]], Sub27800), 
LLay90167 = layer_normalization_layer(Sub27800, 1, 1.386681566541737, Lay90167), 
LRes53888 = reshape_layer(Lay90167, [2, 1], Res53888), 
LCon55480 = concatenate_layer([Res53888,[[[0.7586, 0.8279, 0.6124, 0.1834, 0.9336], [0.3778, 0.9274, 0.6036, 0.0284, 0.8682]]]], 2, Con55480), 
LCro5147 = cropping1D_layer([[[1.1822, 1.7321, 1.6248, 1.0342], [1.9805, 1.0063, 1.7769, 1.0903]]], 1, 0, Cro5147), 
LZer65624 = zero_padding1D_layer(Cro5147, 1, 0, Zer65624), 
LCon32137 = concatenate_layer([Zer65624,[[[0.2076, 0.6146], [0.0835, 0.6222]]]], 2, Con32137), 
LSub81603 = subtract_layer([[[0.5528, 0.5289, 0.281], [0.3726, 0.075, 0.519]]], [[[0.245, 0.4622, 0.0899], [0.4756, 0.6147, 0.2491]]], Sub81603), 
LRes86743 = reshape_layer(Sub81603, [2, 3, 1], Res86743), 
LCon14179 = conv2D_layer(Res86743, 2, 1,[[[[0.8429, 0.9308]]], [[[0.902, 0.7416]]]],[0, 0], 1, 1, true, 1, 1, Con14179), 
LRes9506 = reshape_layer(Con14179, [2, 6], Res9506), 
LDot15823 = dot_layer([[[0.9267, 0.088], [0.0012, 0.6643]]], [[[0.015, 0.6788], [0.5459, 0.3117]]], 2, 1, Dot15823), 
LCon96395 = concatenate_layer([Dot15823,[[[0.749, 0.4531, 0.2873, 0.0506], [0.6445, 0.9401, 0.876, 0.5314]]]], 2, Con96395), 
LSub95500 = subtract_layer(Res9506,Con96395, Sub95500), 
LMax78113 = maximum_layer([Con32137,Sub95500], Max78113), 
LSub44184 = subtract_layer(Con55480,Max78113, Sub44184), 
exec_layers([LSub27800,LLay90167,LRes53888,LCon55480,LCro5147,LZer65624,LCon32137,LSub81603,LRes86743,LCon14179,LRes9506,LDot15823,LCon96395,LSub95500,LMax78113,LSub44184],["Sub27800","Lay90167","Res53888","Con55480","Cro5147","Zer65624","Con32137","Sub81603","Res86743","Con14179","Res9506","Dot15823","Con96395","Sub95500","Max78113","Sub44184"],Sub44184,"Sub44184")

Actual (Unparsed): [[[-0.2408449, 0.7586000, 0.8279000, 0.6124000, -0.0242000, 0.3190000], [-1.8442540, -0.6285000, -0.8495001, -0.4866999, -0.0551000, 0.2460000]]]

Expected (Unparsed): [[[-0.24084493224623243,0.7586,0.8279,0.6124,-0.0242,0.31899999999999995],[-1.8442539877537674,-0.6285,-0.8494999999999999,-0.4867,-0.0551,0.246]]]

Actual:   [[[-0.2408, 0.7586, 0.8279, 0.6124, -0.0242, 0.319], [-1.8442, -0.6285, -0.8495, -0.4866, -0.0551, 0.246]]]

Expected: [[[-0.2408, 0.7586, 0.8279, 0.6124, -0.0242, 0.319], [-1.8442, -0.6285, -0.8494, -0.4867, -0.0551, 0.246]]]