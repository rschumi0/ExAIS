import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub37835 = tf.keras.layers.Input(shape=([3, 3]))
in1Sub37835 = tf.keras.layers.Input(shape=([3, 3]))
in0Con22706 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Min94580 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Min94580 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))

Sub37835 = keras.layers.Subtract(name = 'Sub37835', )([in0Sub37835,in1Sub37835])
Res5075 = keras.layers.Reshape((3, 3, 1), name = 'Res5075', )(Sub37835)
Con22706 = keras.layers.Concatenate(axis=3, name = 'Con22706', )([Res5075,in0Con22706])
Min94580 = keras.layers.Minimum(name = 'Min94580', )([in0Min94580,in1Min94580])
Res71633 = keras.layers.Reshape((1, 1, 2), name = 'Res71633', )(Min94580)
Dep79745 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='same', name = 'Dep79745', )(Res71633)
Zer54253 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer54253', )(Dep79745)
Max7084 = keras.layers.Maximum(name = 'Max7084', )([Con22706,Zer54253])
Fla99699 = keras.layers.Flatten(name = 'Fla99699', )(Max7084)
Res57611 = keras.layers.Reshape((18, 1), name = 'Res57611', )(Fla99699)
PRe22144 = keras.layers.PReLU(name = 'PRe22144', )(Res57611)
model = tf.keras.models.Model(inputs=[in0Sub37835,in1Sub37835,in0Con22706,in0Min94580,in1Min94580], outputs=PRe22144)
w = model.get_layer('Dep79745').get_weights() 
w[0] = np.array([[[[0.8504], [0.9755]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep79745').set_weights(w) 
w = model.get_layer('PRe22144').get_weights() 
w[0] = np.array([[0.0472], [0.6064], [0.117], [0.8161], [0.1762], [0.2644], [0.0092], [0.1611], [0.4257], [0.0374], [0.6144], [0.906], [0.2766], [0.911], [0.2782], [0.5246], [0.3722], [0.7602]])
model.get_layer('PRe22144').set_weights(w) 
in0Sub37835 = tf.constant([[[0.9983, 0.7321, 0.4808], [0.912, 0.7875, 0.3379], [0.2308, 0.705, 0.7153]]])
in1Sub37835 = tf.constant([[[0.3828, 0.1133, 0.0542], [0.4392, 0.5353, 0.5624], [0.3441, 0.2317, 0.3216]]])
in0Con22706 = tf.constant([[[[0.8014], [0.259], [0.2991]], [[0.4407], [0.1502], [0.061]], [[0.0695], [0.6144], [0.8632]]]])
in0Min94580 = tf.constant([[[[[0.7661, 0.8756]]]]])
in1Min94580 = tf.constant([[[[[0.9565, 0.9823]]]]])
print (np.array2string(model.predict([in0Sub37835,in1Sub37835,in0Con22706,in0Min94580,in1Min94580],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='PRe22144.png')

LSub37835 = subtract_layer([[[0.9983, 0.7321, 0.4808], [0.912, 0.7875, 0.3379], [0.2308, 0.705, 0.7153]]], [[[0.3828, 0.1133, 0.0542], [0.4392, 0.5353, 0.5624], [0.3441, 0.2317, 0.3216]]], Sub37835), 
LRes5075 = reshape_layer(Sub37835, [3, 3, 1], Res5075), 
LCon22706 = concatenate_layer([Res5075,[[[[0.8014], [0.259], [0.2991]], [[0.4407], [0.1502], [0.061]], [[0.0695], [0.6144], [0.8632]]]]], 3, Con22706), 
LMin94580 = minimum_layer([[[[[[0.7661, 0.8756]]]]], [[[[[0.9565, 0.9823]]]]]], Min94580), 
LRes71633 = reshape_layer(Min94580, [1, 1, 2], Res71633), 
LDep79745 = depthwise_conv2D_layer(Res71633, 1, 1,[[[[0.8504], [0.9755]]]],[0, 0], 1, 1, true, Dep79745), 
LZer54253 = zero_padding2D_layer(Dep79745, 2, 0, 2, 0, Zer54253), 
LMax7084 = maximum_layer([Con22706,Zer54253], Max7084), 
LFla99699 = flatten_layer(Max7084, Fla99699), 
LRes57611 = reshape_layer(Fla99699, [18, 1], Res57611), 
LPRe22144 = prelu_layer(Res57611, [[0.0472], [0.6064], [0.117], [0.8161], [0.1762], [0.2644], [0.0092], [0.1611], [0.4257], [0.0374], [0.6144], [0.906], [0.2766], [0.911], [0.2782], [0.5246], [0.3722], [0.7602]], PRe22144), 
exec_layers([LSub37835,LRes5075,LCon22706,LMin94580,LRes71633,LDep79745,LZer54253,LMax7084,LFla99699,LRes57611,LPRe22144],["Sub37835","Res5075","Con22706","Min94580","Res71633","Dep79745","Zer54253","Max7084","Fla99699","Res57611","PRe22144"],PRe22144,"PRe22144")

Actual (Unparsed): [[[0.6155000], [0.8014000], [0.6188000], [0.2590000], [0.4266000], [0.2991000], [0.4728000], [0.4407000], [0.2522000], [0.1502000], [0.0000000], [0.0610000], [0.0000000], [0.0695000], [0.4733000], [0.6144000], [0.6514914], [0.8632000]]]

Expected (Unparsed): [[[0.6154999999999999],[0.8014],[0.6188],[0.259],[0.4266],[0.2991],[0.47280000000000005],[0.4407],[0.2522],[0.1502],[0],[0.061],[0],[0.0695],[0.47329999999999994],[0.6144],[0.65149144],[0.8632]]]

Actual:   [[[0.6155], [0.8014], [0.6188], [0.259], [0.4266], [0.2991], [0.4728], [0.4407], [0.2522], [0.1502], [0], [0.061], [0], [0.0695], [0.4733], [0.6144], [0.6515], [0.8632]]]

Expected: [[[0.6155], [0.8014], [0.6188], [0.259], [0.4266], [0.2991], [0.4729], [0.4407], [0.2522], [0.1502], [0], [0.061], [0], [0.0695], [0.4733], [0.6144], [0.6515], [0.8632]]]