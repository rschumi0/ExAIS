import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add55622 = tf.keras.layers.Input(shape=([2, 1]))
in1Add55622 = tf.keras.layers.Input(shape=([2, 1]))
in0Con44624 = tf.keras.layers.Input(shape=([5, 3, 4, 2]))
in0Lay29657 = tf.keras.layers.Input(shape=([4, 2, 4]))

Add55622 = keras.layers.Add(name = 'Add55622', )([in0Add55622,in1Add55622])
Res91689 = keras.layers.Reshape((2, 1, 1), name = 'Res91689', )(Add55622)
Res7695 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res7695', )(Res91689)
Glo21139 = keras.layers.GlobalMaxPool3D(name = 'Glo21139', )(Res7695)
Res44322 = keras.layers.Reshape((1, 1), name = 'Res44322', )(Glo21139)
Res62997 = keras.layers.Reshape((1, 1, 1), name = 'Res62997', )(Res44322)
Res22494 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res22494', )(Res62997)
Zer85163 = keras.layers.ZeroPadding3D(padding=((4, 0), (2, 0), (3, 0)), name = 'Zer85163', )(Res22494)
Con44624 = keras.layers.Concatenate(axis=4, name = 'Con44624', )([Zer85163,in0Con44624])
Lay29657 = keras.layers.LayerNormalization(axis=1, epsilon=2.9994514377883066, name = 'Lay29657', )(in0Lay29657)
Res70703 = keras.layers.Reshape((4, 2, 4, 1), name = 'Res70703', )(Lay29657)
Con3663 = keras.layers.Conv3DTranspose(3, (2, 2, 1),strides=(1, 1, 1), padding='valid', name = 'Con3663', )(Res70703)
Sub60930 = keras.layers.Subtract(name = 'Sub60930', )([Con44624,Con3663])
model = tf.keras.models.Model(inputs=[in0Add55622,in1Add55622,in0Con44624,in0Lay29657], outputs=Sub60930)
w = model.get_layer('Con3663').get_weights() 
w[0] = np.array([[[[[0.3418], [0.8951], [0.8237]]], [[[0.3386], [0.7014], [0.023]]]], [[[[0.6331], [0.7717], [0.061]]], [[[0.7026], [0.1113], [0.1529]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con3663').set_weights(w) 
in0Add55622 = tf.constant([[[0.3992], [0.3529]]])
in1Add55622 = tf.constant([[[0.571], [0.9617]]])
in0Con44624 = tf.constant([[[[[0.1161, 0.7148], [0.0396, 0.4317], [0.3018, 0.7626], [0.0533, 0.6464]], [[0.8021, 0.6435], [0.162, 0.1624], [0.1628, 0.5722], [0.4313, 0.3268]], [[0.3564, 0.6969], [0.681, 0.8267], [0.9309, 0.8558], [0.1824, 0.0696]]], [[[0.0217, 0.9923], [0.1873, 0.1035], [0.4734, 0.2479], [0.5636, 0.6758]], [[0.76, 0.111], [0.1523, 0.9085], [0.8745, 0.6387], [0.326, 0.721]], [[0.8627, 0.696], [0.631, 0.5736], [0.2204, 0.3577], [0.3235, 0.322]]], [[[0.9421, 0.1046], [0.0744, 0.9755], [0.6115, 0.2124], [0.1086, 0.933]], [[0.5601, 0.7794], [0.5694, 0.8352], [0.7826, 0.168], [0.9567, 0.5161]], [[0.9965, 0.2457], [0.0699, 0.6606], [0.9586, 0.7028], [0.0097, 0.687]]], [[[0.9117, 0.8961], [0.4383, 0.0558], [0.8244, 0.1244], [0.4809, 0.6813]], [[0.9068, 0.9725], [0.3619, 0.3692], [0.7398, 0.3826], [0.1124, 0.2396]], [[0.237, 0.4052], [0.4613, 0.9032], [0.576, 0.163], [0.3262, 0.7601]]], [[[0.1791, 0.4207], [0.1577, 0.1582], [0.8039, 0.2972], [0.7611, 0.3147]], [[0.8101, 0.0757], [0.1141, 0.8334], [0.7127, 0.7753], [0.1357, 0.3777]], [[0.1984, 0.1306], [0.3181, 0.5569], [0.8886, 0.894], [0.6301, 0.3635]]]]])
in0Lay29657 = tf.constant([[[[1.5587, 1.8057, 1.2594, 1.3481], [1.8862, 1.8151, 1.3258, 1.9802]], [[1.1363, 1.5735, 1.1268, 1.8304], [1.8925, 1.3576, 1.5799, 1.1312]], [[1.2813, 1.4235, 1.3127, 1.5098], [1.7653, 1.5312, 1.9104, 1.1445]], [[1.6211, 1.0065, 1.007, 1.5076], [1.0548, 1.9454, 1.5718, 1.8484]]]])
print (np.array2string(model.predict([in0Add55622,in1Add55622,in0Con44624,in0Lay29657],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub60930.png')

LAdd55622 = add_layer([[[[0.3992], [0.3529]]], [[[0.571], [0.9617]]]], Add55622), 
LRes91689 = reshape_layer(Add55622, [2, 1, 1], Res91689), 
LRes7695 = reshape_layer(Res91689, [2, 1, 1, 1], Res7695), 
LGlo21139 = global_max_pool3D_layer(Res7695, Glo21139), 
LRes44322 = reshape_layer(Glo21139, [1, 1], Res44322), 
LRes62997 = reshape_layer(Res44322, [1, 1, 1], Res62997), 
LRes22494 = reshape_layer(Res62997, [1, 1, 1, 1], Res22494), 
LZer85163 = zero_padding3D_layer(Res22494, 4, 0, 2, 0, 3, 0, Zer85163), 
LCon44624 = concatenate_layer([Zer85163,[[[[[0.1161, 0.7148], [0.0396, 0.4317], [0.3018, 0.7626], [0.0533, 0.6464]], [[0.8021, 0.6435], [0.162, 0.1624], [0.1628, 0.5722], [0.4313, 0.3268]], [[0.3564, 0.6969], [0.681, 0.8267], [0.9309, 0.8558], [0.1824, 0.0696]]], [[[0.0217, 0.9923], [0.1873, 0.1035], [0.4734, 0.2479], [0.5636, 0.6758]], [[0.76, 0.111], [0.1523, 0.9085], [0.8745, 0.6387], [0.326, 0.721]], [[0.8627, 0.696], [0.631, 0.5736], [0.2204, 0.3577], [0.3235, 0.322]]], [[[0.9421, 0.1046], [0.0744, 0.9755], [0.6115, 0.2124], [0.1086, 0.933]], [[0.5601, 0.7794], [0.5694, 0.8352], [0.7826, 0.168], [0.9567, 0.5161]], [[0.9965, 0.2457], [0.0699, 0.6606], [0.9586, 0.7028], [0.0097, 0.687]]], [[[0.9117, 0.8961], [0.4383, 0.0558], [0.8244, 0.1244], [0.4809, 0.6813]], [[0.9068, 0.9725], [0.3619, 0.3692], [0.7398, 0.3826], [0.1124, 0.2396]], [[0.237, 0.4052], [0.4613, 0.9032], [0.576, 0.163], [0.3262, 0.7601]]], [[[0.1791, 0.4207], [0.1577, 0.1582], [0.8039, 0.2972], [0.7611, 0.3147]], [[0.8101, 0.0757], [0.1141, 0.8334], [0.7127, 0.7753], [0.1357, 0.3777]], [[0.1984, 0.1306], [0.3181, 0.5569], [0.8886, 0.894], [0.6301, 0.3635]]]]]], 4, Con44624), 
LLay29657 = layer_normalization_layer([[[[1.5587, 1.8057, 1.2594, 1.3481], [1.8862, 1.8151, 1.3258, 1.9802]], [[1.1363, 1.5735, 1.1268, 1.8304], [1.8925, 1.3576, 1.5799, 1.1312]], [[1.2813, 1.4235, 1.3127, 1.5098], [1.7653, 1.5312, 1.9104, 1.1445]], [[1.6211, 1.0065, 1.007, 1.5076], [1.0548, 1.9454, 1.5718, 1.8484]]]], 1, 2.9994514377883066, Lay29657), 
LRes70703 = reshape_layer(Lay29657, [4, 2, 4, 1], Res70703), 
LCon3663 = conv3D_transpose_layer(Res70703, 2, 2, 1,[[[[[0.3418], [0.8951], [0.8237]]], [[[0.3386], [0.7014], [0.023]]]], [[[[0.6331], [0.7717], [0.061]]], [[[0.7026], [0.1113], [0.1529]]]]],[0, 0, 0], 1, 1, 1, false, Con3663), 
LSub60930 = subtract_layer(Con44624,Con3663, Sub60930), 
exec_layers([LAdd55622,LRes91689,LRes7695,LGlo21139,LRes44322,LRes62997,LRes22494,LZer85163,LCon44624,LLay29657,LRes70703,LCon3663,LSub60930],["Add55622","Res91689","Res7695","Glo21139","Res44322","Res62997","Res22494","Zer85163","Con44624","Lay29657","Res70703","Con3663","Sub60930"],Sub60930,"Sub60930")

Actual (Unparsed): [[[[[-0.0312441, 0.0342785, 0.6395053], [-0.0687804, -0.1405209, 0.2659469], [-0.0163273, 0.2590424, 0.7232530], [0.0394426, 0.1565917, 0.7414523]], [[-0.0767158, 0.6181381, 0.5311107], [-0.0980228, -0.0574085, 0.0857490], [0.0369626, 0.2684496, 0.6991557], [-0.0483504, 0.2832956, 0.1187726]], [[-0.0453358, 0.2624882, 0.6938205], [-0.0296065, 0.6196709, 0.8246889], [0.0526396, 1.0399413, 0.8593756], [-0.0866053, 0.0029997, 0.0637172]]], [[[-0.0062952, 0.0862269, 1.1110181], [-0.1509872, -0.0297624, 0.0343792], [-0.0204616, 0.4621503, 0.2685564], [0.0177988, 0.5079405, 0.5496713]], [[-0.1448814, 0.6293018, -0.0208981], [-0.1604976, 0.1701307, 1.0144676], [0.0778960, 1.0179864, 0.6496007], [-0.0595772, 0.2271402, 0.9025173]], [[-0.1406160, 0.7513843, 0.6723664], [-0.0023808, 0.7435951, 0.5642420], [0.1125424, 0.2445689, 0.3816953], [-0.1044014, 0.4510261, 0.2880074]]], [[[0.1186795, 1.1191627, 0.1695848], [-0.0380867, 0.0358217, 0.9847981], [-0.0087055, 0.5633422, 0.1495083], [-0.0946614, 0.0039831, 0.9416754]], [[0.0195557, 0.4597356, 0.7417371], [0.0931307, 0.7749835, 0.8974801], [-0.0616842, 0.5774637, 0.0231618], [0.1082912, 1.3184880, 0.6824883]], [[-0.1187384, 0.9352972, 0.2231773], [0.1479473, 0.1419492, 0.6889925], [-0.0539633, 0.8336591, 0.7001640], [0.2290301, 0.1851932, 0.7259485]]], [[[-0.0006062, 0.8500967, 0.7954514], [0.0971460, 0.6781705, 0.2658912], [-0.0163122, 0.8512277, 0.2000272], [0.0223720, 0.5195424, 0.7022511]], [[0.0781907, 1.0760768, 1.2533555], [0.0896096, 0.4546670, 0.2486735], [-0.1309032, 0.6737969, 0.3737745], [0.0978703, 0.1349264, 0.1071616]], [[0.0680571, 0.4659448, 0.4029397], [-0.0021295, 0.3560168, 0.9109484], [-0.1213591, 0.5661242, 0.1358583], [0.0895276, 0.2227866, 0.7887847]]], [[[-0.0805340, 0.0809352, 0.4129405], [0.1607083, 0.3535910, 0.1736844], [0.0618066, 0.8792374, 0.3031551], [0.0150480, 0.7794423, 0.3161499]], [[0.1238509, 1.0558477, 0.0767948], [0.0757800, 0.0173273, 0.8623299], [0.0777288, 0.7347034, 0.7911073], [-0.0982340, -0.0017501, 0.3702602]], [[0.2366331, 0.2358854, 0.1820962], [-0.1138304, 0.3000680, 0.5321282], [0.0101404, 0.8902063, 0.8962067], [1.1870490, 0.6098944, 0.3357423]]]]]

Expected (Unparsed): [[[[[-0.031244074609067272,0.034278551250508715,0.6395052537873356],[-0.06878038927893551,-0.1405209082608987,0.265946908575017],[-0.016327294025081436,0.25904236137551084,0.7232530366048578],[0.03944262662377879,0.15659167668503332,0.7414523450848642]],[[-0.07671583944121167,0.6181380360794306,0.5311107384548671],[-0.09802280427081794,-0.05740853600325985,0.08574892897955227],[0.036962616984853626,0.2684495344417858,0.6991557099281516],[-0.0483503700850553,0.28329555390647504,0.11877266391911012]],[[-0.045335823781218344,0.2624881665677893,0.6938204845039337],[-0.029606548763851985,0.6196708998731076,0.8246889231495316],[0.052639571905045805,1.039941334123447,0.859375635421784],[-0.08660524851860335,0.002999759861345569,0.06371718630854141]]],[[[-0.006295182108480284,0.08622688508538622,1.1110181795591854],[-0.15098718781194392,-0.029762349903600327,0.034379262242373976],[-0.02046165070708677,0.4621503354771661,0.26855633675397056],[0.017798766700764718,0.5079405223233762,0.5496712834471704]],[[-0.14488145681155418,0.6293017976474863,-0.020898115281775945],[-0.1604975913047612,0.17013072871388332,1.0144675630318754],[0.07789598349753056,1.0179863948941252,0.6496007048604849],[-0.05957715813915582,0.2271401591174911,0.9025172140183036]],[[-0.14061600492253507,0.7513843211162302,0.6723663674488173],[-0.0023808066181109297,0.7435951538977995,0.5642420045390714],[0.11254243014262462,0.24456894122839545,0.3816953484649039],[-0.10440136716211237,0.4510260650732204,0.28800735663436433]]],[[[0.11867946422894314,1.1191626841739462,0.16958475452850474],[-0.03808670983208775,0.03582172884374042,0.9847981209161316],[-0.008705463747689064,0.5633421479174687,0.14950831485944255],[-0.09466136894601089,0.003983066812394118,0.9416753821460324]],[[0.0195557129757408,0.4597355719476362,0.7417371333784346],[0.09313075973511278,0.774983484073549,0.897480107760279],[-0.06168420615034986,0.57746375057038,0.023161815289864884],[0.10829124166072705,1.3184879575343151,0.6824882759292701]],[[-0.11873837274074356,0.9352972238496781,0.22317731986050873],[0.14794725734973754,0.14194922445338531,0.6889924666213326],[-0.053963276922310524,0.8336591610587563,0.7001639999059441],[0.22903003859951918,0.1851931588544447,0.725948473353212]]],[[[-0.0006061682603391363,0.8500966529699256,0.7954513704796017],[0.09714595120601927,0.6781704810301745,0.2658912532376765],[-0.01631215987362787,0.8512277222834248,0.2000271693562628],[0.02237199578588974,0.5195424090502826,0.702251097093264]],[[0.07819065898046199,1.0760768616483043,1.253355444079394],[0.08960965042498746,0.45466702581974944,0.24867352258142894],[-0.1309032127749646,0.6737969717095817,0.3737744738258832],[0.09787028266767789,0.13492641990686038,0.1071616375175502]],[[0.06805708299146992,0.465944854245093,0.40293966563127787],[-0.002129518235232844,0.3560167765856024,0.9109484042563974],[-0.12135908506249685,0.5661242128051664,0.13585826836451537],[0.08952761132235569,0.22278658141315388,0.788784673905239]]],[[[-0.0805340392510563,0.08093522652023354,0.4129404416453729],[0.16070833571694784,0.35359104829058385,0.17368445502880087],[0.061806568353485,0.8792374329464292,0.3031551424254661],[0.015047979835577529,0.7794423251289135,0.3161498922286688]],[[0.12385092429656346,1.0558477326771434,0.07679479936908053],[0.07577998541547908,0.017327297396078425,0.8623298776468648],[0.07772881844293,0.734703348384127,0.7911072960956154],[-0.0982339961041943,-0.0017500904651424065,0.37026020861576564]],[[0.2366331184530273,0.2358854342212097,0.1820961625554624],[-0.11383038373254153,0.3000679451901055,0.5321282014336669],[0.010140359937136828,0.8902063507842347,0.8962067478428526],[1.1870489657588406,0.6098944347978351,0.33574230979864317]]]]]

Actual:   [[[[[-0.0312, 0.0343, 0.6396], [-0.0687, -0.1405, 0.266], [-0.0163, 0.2591, 0.7233], [0.0395, 0.1566, 0.7415]], [[-0.0767, 0.6182, 0.5312], [-0.098, -0.0574, 0.0858], [0.037, 0.2685, 0.6992], [-0.0483, 0.2833, 0.1188]], [[-0.0453, 0.2625, 0.6939], [-0.0296, 0.6197, 0.8247], [0.0527, 1.04, 0.8594], [-0.0866, 0.003, 0.0638]]], [[[-0.0062, 0.0863, 1.1111], [-0.1509, -0.0297, 0.0344], [-0.0204, 0.4622, 0.2686], [0.0178, 0.508, 0.5497]], [[-0.1448, 0.6294, -0.0208], [-0.1604, 0.1702, 1.0145], [0.0779, 1.018, 0.6497], [-0.0595, 0.2272, 0.9026]], [[-0.1406, 0.7514, 0.6724], [-0.0023, 0.7436, 0.5643], [0.1126, 0.2446, 0.3817], [-0.1044, 0.4511, 0.2881]]], [[[0.1187, 1.1192, 0.1696], [-0.038, 0.0359, 0.9848], [-0.0087, 0.5634, 0.1496], [-0.0946, 0.004, 0.9417]], [[0.0196, 0.4598, 0.7418], [0.0932, 0.775, 0.8975], [-0.0616, 0.5775, 0.0232], [0.1083, 1.3185, 0.6825]], [[-0.1187, 0.9353, 0.2232], [0.148, 0.142, 0.689], [-0.0539, 0.8337, 0.7002], [0.2291, 0.1852, 0.726]]], [[[-0.0006, 0.8501, 0.7955], [0.0972, 0.6782, 0.2659], [-0.0163, 0.8513, 0.2001], [0.0224, 0.5196, 0.7023]], [[0.0782, 1.0761, 1.2534], [0.0897, 0.4547, 0.2487], [-0.1309, 0.6738, 0.3738], [0.0979, 0.135, 0.1072]], [[0.0681, 0.466, 0.403], [-0.0021, 0.3561, 0.911], [-0.1213, 0.5662, 0.1359], [0.0896, 0.2228, 0.7888]]], [[[-0.0805, 0.081, 0.413], [0.1608, 0.3536, 0.1737], [0.0619, 0.8793, 0.3032], [0.0151, 0.7795, 0.3162]], [[0.1239, 1.0559, 0.0768], [0.0758, 0.0174, 0.8624], [0.0778, 0.7348, 0.7912], [-0.0982, -0.0017, 0.3703]], [[0.2367, 0.2359, 0.1821], [-0.1138, 0.3001, 0.5322], [0.0102, 0.8903, 0.8963], [1.1871, 0.6099, 0.3358]]]]]

Expected: [[[[[-0.0312, 0.0343, 0.6396], [-0.0687, -0.1405, 0.266], [-0.0163, 0.2591, 0.7233], [0.0395, 0.1566, 0.7415]], [[-0.0767, 0.6182, 0.5312], [-0.098, -0.0574, 0.0858], [0.037, 0.2685, 0.6992], [-0.0483, 0.2833, 0.1188]], [[-0.0453, 0.2625, 0.6939], [-0.0296, 0.6197, 0.8247], [0.0527, 1.04, 0.8594], [-0.0866, 0.003, 0.0638]]], [[[-0.0062, 0.0863, 1.1111], [-0.1509, -0.0297, 0.0344], [-0.0204, 0.4622, 0.2686], [0.0178, 0.508, 0.5497]], [[-0.1448, 0.6294, -0.0208], [-0.1604, 0.1702, 1.0145], [0.0779, 1.018, 0.6497], [-0.0595, 0.2272, 0.9026]], [[-0.1406, 0.7514, 0.6724], [-0.0023, 0.7436, 0.5643], [0.1126, 0.2446, 0.3817], [-0.1044, 0.4511, 0.2881]]], [[[0.1187, 1.1192, 0.1696], [-0.038, 0.0359, 0.9848], [-0.0087, 0.5634, 0.1496], [-0.0946, 0.004, 0.9417]], [[0.0196, 0.4598, 0.7418], [0.0932, 0.775, 0.8975], [-0.0616, 0.5775, 0.0232], [0.1083, 1.3185, 0.6825]], [[-0.1187, 0.9353, 0.2232], [0.148, 0.142, 0.689], [-0.0539, 0.8337, 0.7002], [0.2291, 0.1852, 0.726]]], [[[-0.0006, 0.8501, 0.7955], [0.0972, 0.6782, 0.2659], [-0.0163, 0.8513, 0.2001], [0.0224, 0.5196, 0.7023]], [[0.0782, 1.0761, 1.2534], [0.0897, 0.4547, 0.2487], [-0.1309, 0.6738, 0.3738], [0.0979, 0.135, 0.1072]], [[0.0681, 0.466, 0.403], [-0.0021, 0.3561, 0.911], [-0.1213, 0.5662, 0.1359], [0.0896, 0.2228, 0.7888]]], [[[-0.0805, 0.081, 0.413], [0.1608, 0.3536, 0.1737], [0.0619, 0.8793, 0.3032], [0.0151, 0.7795, 0.3162]], [[0.1239, 1.0559, 0.0768], [0.0758, 0.0174, 0.8624], [0.0778, 0.7348, 0.7912], [-0.0982, -0.0017, 0.3703]], [[0.2367, 0.2359, 0.1821], [-0.1138, 0.3001, 0.5322], [0.0102, 0.8903, 0.8963], [1.1871, 0.6099, 0.3358]]]]]