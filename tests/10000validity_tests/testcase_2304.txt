import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave34089 = tf.keras.layers.Input(shape=([1, 1]))
in1Ave34089 = tf.keras.layers.Input(shape=([1, 1]))
in0Con89355 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Min5478 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Min5478 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con41034 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Sub38053 = tf.keras.layers.Input(shape=([3, 3, 2]))
in1Sub38053 = tf.keras.layers.Input(shape=([3, 3, 2]))

Ave34089 = keras.layers.Average(name = 'Ave34089', )([in0Ave34089,in1Ave34089])
Res48776 = keras.layers.Reshape((1, 1, 1), name = 'Res48776', )(Ave34089)
Zer52607 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer52607', )(Res48776)
Con89355 = keras.layers.Concatenate(axis=3, name = 'Con89355', )([Zer52607,in0Con89355])
Min5478 = keras.layers.Minimum(name = 'Min5478', )([in0Min5478,in1Min5478])
Zer32099 = keras.layers.ZeroPadding2D(padding=((2, 0), (1, 0)), name = 'Zer32099', )(Min5478)
Con41034 = keras.layers.Concatenate(axis=3, name = 'Con41034', )([Zer32099,in0Con41034])
Sub38053 = keras.layers.Subtract(name = 'Sub38053', )([in0Sub38053,in1Sub38053])
Min55480 = keras.layers.Minimum(name = 'Min55480', )([Con41034,Sub38053])
Max8771 = keras.layers.Maximum(name = 'Max8771', )([Con89355,Min55480])
model = tf.keras.models.Model(inputs=[in0Ave34089,in1Ave34089,in0Con89355,in0Min5478,in1Min5478,in0Con41034,in0Sub38053,in1Sub38053], outputs=Max8771)
in0Ave34089 = tf.constant([[[0.1311]]])
in1Ave34089 = tf.constant([[[0.2591]]])
in0Con89355 = tf.constant([[[[0.1829], [0.6683], [0.437]], [[0.422], [0.2275], [0.8325]], [[0.7412], [0.3372], [0.9286]]]])
in0Min5478 = tf.constant([[[[0.186], [0.2346]]]])
in1Min5478 = tf.constant([[[[0.3866], [0.744]]]])
in0Con41034 = tf.constant([[[[0.8084], [0.3297], [0.537]], [[0.2534], [0.8812], [0.9313]], [[0.9263], [0.877], [0.5674]]]])
in0Sub38053 = tf.constant([[[[0.555, 0.314], [0.6222, 0.9301], [0.6387, 0.1773]], [[0.229, 0.4354], [0.1189, 0.8063], [0.5149, 0.2179]], [[0.2491, 0.2616], [0.7613, 0.7283], [0.8081, 0.1326]]]])
in1Sub38053 = tf.constant([[[[0.7232, 0.3585], [0.6421, 0.7141], [0.2057, 0.3906]], [[0.3238, 0.5387], [0.8704, 0.7976], [0.0564, 0.2592]], [[0.3506, 0.0631], [0.4574, 0.38], [0.0903, 0.6476]]]])
print (np.array2string(model.predict([in0Ave34089,in1Ave34089,in0Con89355,in0Min5478,in1Min5478,in0Con41034,in0Sub38053,in1Sub38053],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max8771.png')

LAve34089 = average_layer([[[[0.1311]]], [[[0.2591]]]], Ave34089), 
LRes48776 = reshape_layer(Ave34089, [1, 1, 1], Res48776), 
LZer52607 = zero_padding2D_layer(Res48776, 2, 0, 2, 0, Zer52607), 
LCon89355 = concatenate_layer([Zer52607,[[[[0.1829], [0.6683], [0.437]], [[0.422], [0.2275], [0.8325]], [[0.7412], [0.3372], [0.9286]]]]], 3, Con89355), 
LMin5478 = minimum_layer([[[[[0.186], [0.2346]]]], [[[[0.3866], [0.744]]]]], Min5478), 
LZer32099 = zero_padding2D_layer(Min5478, 2, 0, 1, 0, Zer32099), 
LCon41034 = concatenate_layer([Zer32099,[[[[0.8084], [0.3297], [0.537]], [[0.2534], [0.8812], [0.9313]], [[0.9263], [0.877], [0.5674]]]]], 3, Con41034), 
LSub38053 = subtract_layer([[[[0.555, 0.314], [0.6222, 0.9301], [0.6387, 0.1773]], [[0.229, 0.4354], [0.1189, 0.8063], [0.5149, 0.2179]], [[0.2491, 0.2616], [0.7613, 0.7283], [0.8081, 0.1326]]]], [[[[0.7232, 0.3585], [0.6421, 0.7141], [0.2057, 0.3906]], [[0.3238, 0.5387], [0.8704, 0.7976], [0.0564, 0.2592]], [[0.3506, 0.0631], [0.4574, 0.38], [0.0903, 0.6476]]]], Sub38053), 
LMin55480 = minimum_layer([Con41034,Sub38053], Min55480), 
LMax8771 = maximum_layer([Con89355,Min55480], Max8771), 
exec_layers([LAve34089,LRes48776,LZer52607,LCon89355,LMin5478,LZer32099,LCon41034,LSub38053,LMin55480,LMax8771],["Ave34089","Res48776","Zer52607","Con89355","Min5478","Zer32099","Con41034","Sub38053","Min55480","Max8771"],Max8771,"Max8771")

Actual (Unparsed): [[[[0.0000000, 0.1829000], [0.0000000, 0.6683000], [0.0000000, 0.4370000]], [[0.0000000, 0.4220000], [0.0000000, 0.2275000], [0.0000000, 0.8325000]], [[0.0000000, 0.7412000], [0.1860000, 0.3483000], [0.2346000, 0.9286000]]]]

Expected (Unparsed): [[[[0,0.1829],[0,0.6683],[0,0.437]],[[0,0.422],[0,0.2275],[0,0.8325]],[[0,0.7412],[0.186,0.34829999999999994],[0.2346,0.9286]]]]

Actual:   [[[[0, 0.1829], [0, 0.6683], [0, 0.437]], [[0, 0.422], [0, 0.2275], [0, 0.8325]], [[0, 0.7412], [0.186, 0.3483], [0.2346, 0.9286]]]]

Expected: [[[[0, 0.1829], [0, 0.6683], [0, 0.437]], [[0, 0.422], [0, 0.2275], [0, 0.8325]], [[0, 0.7412], [0.186, 0.3483], [0.2346, 0.9286]]]]