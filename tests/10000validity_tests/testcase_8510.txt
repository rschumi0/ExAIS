import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max73371 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Max73371 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Cro9729 = tf.keras.layers.Input(shape=([1, 3]))
in0Con63646 = tf.keras.layers.Input(shape=([3]))
in0Add85961 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Add85961 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Min12807 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Min12807 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0LST62942 = tf.keras.layers.Input(shape=([2, 1]))
in0Con70469 = tf.keras.layers.Input(shape=([2]))

Max73371 = keras.layers.Maximum(name = 'Max73371', )([in0Max73371,in1Max73371])
Res65607 = keras.layers.Reshape((1, 1, 2), name = 'Res65607', )(Max73371)
Con95721 = keras.layers.Conv2D(3, (1, 1),strides=(1, 6), padding='valid', dilation_rate=(1, 1), name = 'Con95721', )(Res65607)
Res98356 = keras.layers.Reshape((1, 3), name = 'Res98356', )(Con95721)
Cro9729 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro9729', )(in0Cro9729)
Mul48928 = keras.layers.Multiply(name = 'Mul48928', )([Res98356,Cro9729])
Res97789 = keras.layers.Reshape((1, 3, 1), name = 'Res97789', )(Mul48928)
Glo96169 = keras.layers.GlobalMaxPool2D(name = 'Glo96169', )(Res97789)
Con63646 = keras.layers.Concatenate(axis=1, name = 'Con63646', )([Glo96169,in0Con63646])
Add85961 = keras.layers.Add(name = 'Add85961', )([in0Add85961,in1Add85961])
Min12807 = keras.layers.Minimum(name = 'Min12807', )([in0Min12807,in1Min12807])
Sub68062 = keras.layers.Subtract(name = 'Sub68062', )([Add85961,Min12807])
Res94140 = keras.layers.Reshape((1, 4), name = 'Res94140', )(Sub68062)
Fla66672 = keras.layers.Flatten(name = 'Fla66672', )(Res94140)
LST62942 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST62942', )(in0LST62942)
Con70469 = keras.layers.Concatenate(axis=1, name = 'Con70469', )([LST62942,in0Con70469])
Ave50796 = keras.layers.Average(name = 'Ave50796', )([Fla66672,Con70469])
Max9574 = keras.layers.Maximum(name = 'Max9574', )([Con63646,Ave50796])
model = tf.keras.models.Model(inputs=[in0Max73371,in1Max73371,in0Cro9729,in0Con63646,in0Add85961,in1Add85961,in0Min12807,in1Min12807,in0LST62942,in0Con70469], outputs=Max9574)
w = model.get_layer('Con95721').get_weights() 
w[0] = np.array([[[[0.3997, 0.3465, 0.5699], [0.5773, 0.5907, 0.4886]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con95721').set_weights(w) 
w = model.get_layer('LST62942').get_weights() 
w[0] = np.array([[8, 6, 9, 4, 3, 7, 6, 10]])
w[1] = np.array([[9, 3, 10, 4, 4, 2, 8, 6], [2, 2, 6, 6, 10, 5, 3, 6]])
w[2] = np.array([1, 4, 9, 6, 1, 6, 1, 5])
model.get_layer('LST62942').set_weights(w) 
in0Max73371 = tf.constant([[[[[0.3576], [0.0633]]]]])
in1Max73371 = tf.constant([[[[[0.9534], [0.7982]]]]])
in0Cro9729 = tf.constant([[[1.339, 1.7693, 1.6079]]])
in0Con63646 = tf.constant([[0.2224, 0.1941, 0.9325]])
in0Add85961 = tf.constant([[[[0.0388, 0.4167], [0.0273, 0.8688]]]])
in1Add85961 = tf.constant([[[[0.9749, 0.4691], [0.4814, 0.4813]]]])
in0Min12807 = tf.constant([[[[0.989, 0.0214], [0.7633, 0.9293]]]])
in1Min12807 = tf.constant([[[[0.7654, 0.6275], [0.449, 0.8726]]]])
in0LST62942 = tf.constant([[[4], [6]]])
in0Con70469 = tf.constant([[0.4557, 0.5188]])
print (np.array2string(model.predict([in0Max73371,in1Max73371,in0Cro9729,in0Con63646,in0Add85961,in1Add85961,in0Min12807,in1Min12807,in0LST62942,in0Con70469],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max9574.png')

LMax73371 = maximum_layer([[[[[[0.3576], [0.0633]]]]], [[[[[0.9534], [0.7982]]]]]], Max73371), 
LRes65607 = reshape_layer(Max73371, [1, 1, 2], Res65607), 
LCon95721 = conv2D_layer(Res65607, 1, 1,[[[[0.3997, 0.3465, 0.5699], [0.5773, 0.5907, 0.4886]]]],[0, 0, 0], 1, 6, false, 1, 1, Con95721), 
LRes98356 = reshape_layer(Con95721, [1, 3], Res98356), 
LCro9729 = cropping1D_layer([[[1.339, 1.7693, 1.6079]]], 0, 0, Cro9729), 
LMul48928 = multiply_layer([Res98356,Cro9729], Mul48928), 
LRes97789 = reshape_layer(Mul48928, [1, 3, 1], Res97789), 
LGlo96169 = global_max_pool2D_layer(Res97789, Glo96169), 
LCon63646 = concatenate_layer([Glo96169,[[0.2224, 0.1941, 0.9325]]], 1, Con63646), 
LAdd85961 = add_layer([[[[[0.0388, 0.4167], [0.0273, 0.8688]]]], [[[[0.9749, 0.4691], [0.4814, 0.4813]]]]], Add85961), 
LMin12807 = minimum_layer([[[[[0.989, 0.0214], [0.7633, 0.9293]]]], [[[[0.7654, 0.6275], [0.449, 0.8726]]]]], Min12807), 
LSub68062 = subtract_layer(Add85961,Min12807, Sub68062), 
LRes94140 = reshape_layer(Sub68062, [1, 4], Res94140), 
LFla66672 = flatten_layer(Res94140, Fla66672), 
LLST62942 = lstm_layer([[[4], [6]]],[[8, 6, 9, 4, 3, 7, 6, 10]],[[9, 3, 10, 4, 4, 2, 8, 6], [2, 2, 6, 6, 10, 5, 3, 6]],[1, 4, 9, 6, 1, 6, 1, 5], LST62942), 
LCon70469 = concatenate_layer([LST62942,[[0.4557, 0.5188]]], 1, Con70469), 
LAve50796 = average_layer([Fla66672,Con70469], Ave50796), 
LMax9574 = maximum_layer([Con63646,Ave50796], Max9574), 
exec_layers([LMax73371,LRes65607,LCon95721,LRes98356,LCro9729,LMul48928,LRes97789,LGlo96169,LCon63646,LAdd85961,LMin12807,LSub68062,LRes94140,LFla66672,LLST62942,LCon70469,LAve50796,LMax9574],["Max73371","Res65607","Con95721","Res98356","Cro9729","Mul48928","Res97789","Glo96169","Con63646","Add85961","Min12807","Sub68062","Res94140","Fla66672","LST62942","Con70469","Ave50796","Max9574"],Max9574,"Max9574")

Actual (Unparsed): [[1.5007225, 0.9142138, 0.2577000, 0.9325000]]

Expected (Unparsed): [[1.5007224991220003,0.914213790037884,0.25770000000000004,0.9325]]

Actual:   [[1.5008, 0.9143, 0.2577, 0.9325]]

Expected: [[1.5008, 0.9143, 0.2578, 0.9325]]