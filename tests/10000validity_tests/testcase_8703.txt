import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max62969 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Max62969 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con39671 = tf.keras.layers.Input(shape=([2]))
in0Sub30899 = tf.keras.layers.Input(shape=([3]))
in1Sub30899 = tf.keras.layers.Input(shape=([3]))
in0Dep52922 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Min56214 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Min56214 = tf.keras.layers.Input(shape=([2, 1, 1]))

Max62969 = keras.layers.Maximum(name = 'Max62969', )([in0Max62969,in1Max62969])
Res31267 = keras.layers.Reshape((1, 1), name = 'Res31267', )(Max62969)
Fla26589 = keras.layers.Flatten(name = 'Fla26589', )(Res31267)
Con39671 = keras.layers.Concatenate(axis=1, name = 'Con39671', )([Fla26589,in0Con39671])
Sub30899 = keras.layers.Subtract(name = 'Sub30899', )([in0Sub30899,in1Sub30899])
Add15794 = keras.layers.Add(name = 'Add15794', )([Con39671,Sub30899])
Res12638 = keras.layers.Reshape((3, 1), name = 'Res12638', )(Add15794)
Dep52922 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='same', name = 'Dep52922', )(in0Dep52922)
Zer12759 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer12759', )(Dep52922)
Min56214 = keras.layers.Minimum(name = 'Min56214', )([in0Min56214,in1Min56214])
Sub59359 = keras.layers.Subtract(name = 'Sub59359', )([Zer12759,Min56214])
Res83559 = keras.layers.Reshape((2, 1), name = 'Res83559', )(Sub59359)
Dot37241 = keras.layers.Dot(axes=(2, 2), name = 'Dot37241', )([Res12638,Res83559])
model = tf.keras.models.Model(inputs=[in0Max62969,in1Max62969,in0Con39671,in0Sub30899,in1Sub30899,in0Dep52922,in0Min56214,in1Min56214], outputs=Dot37241)
w = model.get_layer('Dep52922').get_weights() 
w[0] = np.array([[[[0.8448]]]])
w[1] = np.array([0])
model.get_layer('Dep52922').set_weights(w) 
in0Max62969 = tf.constant([[[[0.0977]]]])
in1Max62969 = tf.constant([[[[0.2037]]]])
in0Con39671 = tf.constant([[0.0776, 0.1521]])
in0Sub30899 = tf.constant([[0.1228, 0.671, 0.4095]])
in1Sub30899 = tf.constant([[0.0189, 0.1914, 0.2352]])
in0Dep52922 = tf.constant([[[[0.175]]]])
in0Min56214 = tf.constant([[[[0.229]], [[0.4993]]]])
in1Min56214 = tf.constant([[[[0.3421]], [[0.4596]]]])
print (np.array2string(model.predict([in0Max62969,in1Max62969,in0Con39671,in0Sub30899,in1Sub30899,in0Dep52922,in0Min56214,in1Min56214],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot37241.png')

LMax62969 = maximum_layer([[[[[0.0977]]]], [[[[0.2037]]]]], Max62969), 
LRes31267 = reshape_layer(Max62969, [1, 1], Res31267), 
LFla26589 = flatten_layer(Res31267, Fla26589), 
LCon39671 = concatenate_layer([Fla26589,[[0.0776, 0.1521]]], 1, Con39671), 
LSub30899 = subtract_layer([[0.1228, 0.671, 0.4095]], [[0.0189, 0.1914, 0.2352]], Sub30899), 
LAdd15794 = add_layer([Con39671,Sub30899], Add15794), 
LRes12638 = reshape_layer(Add15794, [3, 1], Res12638), 
LDep52922 = depthwise_conv2D_layer([[[[0.175]]]], 1, 1,[[[[0.8448]]]],[0], 1, 1, true, Dep52922), 
LZer12759 = zero_padding2D_layer(Dep52922, 1, 0, 0, 0, Zer12759), 
LMin56214 = minimum_layer([[[[[0.229]], [[0.4993]]]], [[[[0.3421]], [[0.4596]]]]], Min56214), 
LSub59359 = subtract_layer(Zer12759,Min56214, Sub59359), 
LRes83559 = reshape_layer(Sub59359, [2, 1], Res83559), 
LDot37241 = dot_layer(Res12638,Res83559, 2, 2, Dot37241), 
exec_layers([LMax62969,LRes31267,LFla26589,LCon39671,LSub30899,LAdd15794,LRes12638,LDep52922,LZer12759,LMin56214,LSub59359,LRes83559,LDot37241],["Max62969","Res31267","Fla26589","Con39671","Sub30899","Add15794","Res12638","Dep52922","Zer12759","Min56214","Sub59359","Res83559","Dot37241"],Dot37241,"Dot37241")

Actual (Unparsed): [[[-0.0704404, -0.0958974], [-0.1275988, -0.1737127], [-0.0747456, -0.1017585]]]

Expected (Unparsed): [[[-0.0704404,-0.095897376],[-0.1275988,-0.17371267200000004],[-0.07474560000000001,-0.10175846400000002]]]

Actual:   [[[-0.0704, -0.0958], [-0.1275, -0.1737], [-0.0747, -0.1017]]]

Expected: [[[-0.0704, -0.0958], [-0.1275, -0.1737], [-0.0747, -0.1017]]]