import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min57455 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Min57455 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Con16473 = tf.keras.layers.Input(shape=([2, 3, 3]))
in0Min55912 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Min55912 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))

Min57455 = keras.layers.Minimum(name = 'Min57455', )([in0Min57455,in1Min57455])
Glo3728 = keras.layers.GlobalAveragePooling3D(name = 'Glo3728', )(Min57455)
Res57194 = keras.layers.Reshape((2, 1), name = 'Res57194', )(Glo3728)
Res16686 = keras.layers.Reshape((2, 1, 1), name = 'Res16686', )(Res57194)
Zer52061 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer52061', )(Res16686)
Con16473 = keras.layers.Concatenate(axis=3, name = 'Con16473', )([Zer52061,in0Con16473])
Min55912 = keras.layers.Minimum(name = 'Min55912', )([in0Min55912,in1Min55912])
Res90705 = keras.layers.Reshape((2, 2, 1), name = 'Res90705', )(Min55912)
Con61062 = keras.layers.Conv2DTranspose(4, (1, 2),strides=(1, 1), padding='valid', name = 'Con61062', )(Res90705)
Min77469 = keras.layers.Minimum(name = 'Min77469', )([Con16473,Con61062])
model = tf.keras.models.Model(inputs=[in0Min57455,in1Min57455,in0Con16473,in0Min55912,in1Min55912], outputs=Min77469)
w = model.get_layer('Con61062').get_weights() 
w[0] = np.array([[[[0.9555], [0.0226], [0.0181], [0.0731]], [[0.979], [0.6837], [0.0744], [0.036]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con61062').set_weights(w) 
in0Min57455 = tf.constant([[[[[0.3541, 0.3457], [0.9904, 0.2078]], [[0.2954, 0.6413], [0.5168, 0.5361]]], [[[0.8812, 0.2196], [0.8793, 0.2701]], [[0.1022, 0.5551], [0.1987, 0.9269]]]]])
in1Min57455 = tf.constant([[[[[0.1954, 0.9452], [0.2058, 0.6045]], [[0.3563, 0.4448], [0.472, 0.3683]]], [[[0.8725, 0.6383], [0.2166, 0.6672]], [[0.153, 0.5098], [0.0594, 0.2711]]]]])
in0Con16473 = tf.constant([[[[0.2626, 0.0997, 0.5391], [0.9877, 0.0031, 0.0661], [0.555, 0.263, 0.0126]], [[0.1769, 0.9374, 0.1442], [0.3486, 0.9458, 0.7196], [0.7084, 0.2508, 0.3143]]]])
in0Min55912 = tf.constant([[[[[0.1131]], [[0.6417]]], [[[0.5896]], [[0.3225]]]]])
in1Min55912 = tf.constant([[[[[0.641]], [[0.4586]]], [[[0.9041]], [[0.2326]]]]])
print (np.array2string(model.predict([in0Min57455,in1Min57455,in0Con16473,in0Min55912,in1Min55912],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min77469.png')

LMin57455 = minimum_layer([[[[[[0.3541, 0.3457], [0.9904, 0.2078]], [[0.2954, 0.6413], [0.5168, 0.5361]]], [[[0.8812, 0.2196], [0.8793, 0.2701]], [[0.1022, 0.5551], [0.1987, 0.9269]]]]], [[[[[0.1954, 0.9452], [0.2058, 0.6045]], [[0.3563, 0.4448], [0.472, 0.3683]]], [[[0.8725, 0.6383], [0.2166, 0.6672]], [[0.153, 0.5098], [0.0594, 0.2711]]]]]], Min57455), 
LGlo3728 = global_average_pooling3D_layer(Min57455, Glo3728), 
LRes57194 = reshape_layer(Glo3728, [2, 1], Res57194), 
LRes16686 = reshape_layer(Res57194, [2, 1, 1], Res16686), 
LZer52061 = zero_padding2D_layer(Res16686, 0, 0, 2, 0, Zer52061), 
LCon16473 = concatenate_layer([Zer52061,[[[[0.2626, 0.0997, 0.5391], [0.9877, 0.0031, 0.0661], [0.555, 0.263, 0.0126]], [[0.1769, 0.9374, 0.1442], [0.3486, 0.9458, 0.7196], [0.7084, 0.2508, 0.3143]]]]], 3, Con16473), 
LMin55912 = minimum_layer([[[[[[0.1131]], [[0.6417]]], [[[0.5896]], [[0.3225]]]]], [[[[[0.641]], [[0.4586]]], [[[0.9041]], [[0.2326]]]]]], Min55912), 
LRes90705 = reshape_layer(Min55912, [2, 2, 1], Res90705), 
LCon61062 = conv2D_transpose_layer(Res90705, 1, 2,[[[[0.9555], [0.0226], [0.0181], [0.0731]], [[0.979], [0.6837], [0.0744], [0.036]]]],[0, 0, 0, 0], 1, 1, false, Con61062), 
LMin77469 = minimum_layer([Con16473,Con61062], Min77469), 
exec_layers([LMin57455,LGlo3728,LRes57194,LRes16686,LZer52061,LCon16473,LMin55912,LRes90705,LCon61062,LMin77469],["Min57455","Glo3728","Res57194","Res16686","Zer52061","Con16473","Min55912","Res90705","Con61062","Min77469"],Min77469,"Min77469")

Actual (Unparsed): [[[[0.0000000, 0.0025561, 0.0020471, 0.0082676], [0.0000000, 0.0876908, 0.0031000, 0.0375953], [0.3024125, 0.3135448, 0.0341198, 0.0126000]], [[0.0000000, 0.0133250, 0.0106718, 0.0430998], [0.0000000, 0.3486000, 0.0480763, 0.0382287], [0.2277154, 0.1590286, 0.0173054, 0.0083736]]]]

Expected (Unparsed): [[[[0,0.00255606,0.0020471100000000004,0.00826761],[0,0.08769083,0.0031,0.03759526],[0.30241250000000003,0.31354482,0.03411984,0.0126]],[[0,0.01332496,0.01067176,0.04309976],[0,0.3486,0.0480763,0.03822866],[0.22771539999999998,0.15902861999999998,0.01730544,0.0083736]]]]

Actual:   [[[[0, 0.0026, 0.0021, 0.0083], [0, 0.0877, 0.0031, 0.0376], [0.3025, 0.3136, 0.0342, 0.0126]], [[0, 0.0134, 0.0107, 0.0431], [0, 0.3486, 0.0481, 0.0383], [0.2278, 0.1591, 0.0174, 0.0084]]]]

Expected: [[[[0, 0.0026, 0.0021, 0.0083], [0, 0.0877, 0.0031, 0.0376], [0.3025, 0.3136, 0.0342, 0.0126]], [[0, 0.0134, 0.0107, 0.0431], [0, 0.3486, 0.0481, 0.0383], [0.2278, 0.1591, 0.0174, 0.0084]]]]