import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0PRe18601 = tf.keras.layers.Input(shape=([2, 2]))
in0Ave44229 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave44229 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con52200 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Ave56515 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave56515 = tf.keras.layers.Input(shape=([2, 2]))
in0Con28289 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Glo26851 = tf.keras.layers.Input(shape=([1, 2]))

PRe18601 = keras.layers.PReLU(name = 'PRe18601', input_shape=(2, 2))(in0PRe18601)
Res8894 = keras.layers.Reshape((2, 2, 1), name = 'Res8894', )(PRe18601)
Loc3407 = keras.layers.LocallyConnected2D(2, (1, 2),strides=(1, 1), name = 'Loc3407', )(Res8894)
Zer48290 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer48290', )(Loc3407)
Ave44229 = keras.layers.Average(name = 'Ave44229', )([in0Ave44229,in1Ave44229])
Zer77935 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer77935', )(Ave44229)
Con52200 = keras.layers.Concatenate(axis=3, name = 'Con52200', )([Zer77935,in0Con52200])
Ave56515 = keras.layers.Average(name = 'Ave56515', )([in0Ave56515,in1Ave56515])
Res77624 = keras.layers.Reshape((2, 2, 1), name = 'Res77624', )(Ave56515)
Zer61285 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer61285', )(Res77624)
Con28289 = keras.layers.Concatenate(axis=3, name = 'Con28289', )([Zer61285,in0Con28289])
Glo26851 = keras.layers.GlobalMaxPool1D(name = 'Glo26851', )(in0Glo26851)
Res9891 = keras.layers.Reshape((2, 1), name = 'Res9891', )(Glo26851)
Res36724 = keras.layers.Reshape((2, 1, 1), name = 'Res36724', )(Res9891)
Con53763 = keras.layers.Conv2DTranspose(2, (2, 1),strides=(1, 1), padding='valid', name = 'Con53763', )(Res36724)
Zer77598 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer77598', )(Con53763)
Max47447 = keras.layers.Maximum(name = 'Max47447', )([Con28289,Zer77598])
Mul28005 = keras.layers.Multiply(name = 'Mul28005', )([Con52200,Max47447])
Max37774 = keras.layers.Maximum(name = 'Max37774', )([Zer48290,Mul28005])
model = tf.keras.models.Model(inputs=[in0PRe18601,in0Ave44229,in1Ave44229,in0Con52200,in0Ave56515,in1Ave56515,in0Con28289,in0Glo26851], outputs=Max37774)
w = model.get_layer('PRe18601').get_weights() 
w[0] = np.array([[0.3776, 0.937], [0.8666, 0.2238]])
model.get_layer('PRe18601').set_weights(w) 
w = model.get_layer('Loc3407').get_weights() 
w[0] = np.array([[[0.8037, 0.383], [0.992, 0.7791]], [[0.516, 0.867], [0.678, 0.7594]]])
w[1] = np.array([[[0, 0]], [[0, 0]]])
model.get_layer('Loc3407').set_weights(w) 
w = model.get_layer('Con53763').get_weights() 
w[0] = np.array([[[[0.7258], [0.1144]]], [[[0.4465], [0.996]]]])
w[1] = np.array([0, 0])
model.get_layer('Con53763').set_weights(w) 
in0PRe18601 = tf.constant([[[0.7685, 0.4028], [0.3612, 0.7741]]])
in0Ave44229 = tf.constant([[[[0.1167], [0.3434]], [[0.7789], [0.5876]]]])
in1Ave44229 = tf.constant([[[[0.2896], [0.36]], [[0.2365], [0.7245]]]])
in0Con52200 = tf.constant([[[[0.1345], [0.2688], [0.1601]], [[0.3638], [0.1823], [0.5394]], [[0.936], [0.0275], [0.9517]]]])
in0Ave56515 = tf.constant([[[0.538, 0.583], [0.4956, 0.0599]]])
in1Ave56515 = tf.constant([[[0.3834, 0.0187], [0.7099, 0.5184]]])
in0Con28289 = tf.constant([[[[0.3623], [0.175], [0.8618]], [[0.9198], [0.1742], [0.2973]], [[0.4291], [0.7113], [0.846]]]])
in0Glo26851 = tf.constant([[[1.4134, 1.0901]]])
print (np.array2string(model.predict([in0PRe18601,in0Ave44229,in1Ave44229,in0Con52200,in0Ave56515,in1Ave56515,in0Con28289,in0Glo26851],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max37774.png')

LPRe18601 = prelu_layer([[[0.7685, 0.4028], [0.3612, 0.7741]]], [[0.3776, 0.937], [0.8666, 0.2238]], PRe18601), 
LRes8894 = reshape_layer(PRe18601, [2, 2, 1], Res8894), 
LLoc3407 = locally_connected2D_layer(Res8894, 1, 2,[[[0.8037, 0.383], [0.992, 0.7791]], [[0.516, 0.867], [0.678, 0.7594]]],[[[0, 0]], [[0, 0]]], 1, 1, Loc3407), 
LZer48290 = zero_padding2D_layer(Loc3407, 1, 0, 2, 0, Zer48290), 
LAve44229 = average_layer([[[[[0.1167], [0.3434]], [[0.7789], [0.5876]]]], [[[[0.2896], [0.36]], [[0.2365], [0.7245]]]]], Ave44229), 
LZer77935 = zero_padding2D_layer(Ave44229, 1, 0, 1, 0, Zer77935), 
LCon52200 = concatenate_layer([Zer77935,[[[[0.1345], [0.2688], [0.1601]], [[0.3638], [0.1823], [0.5394]], [[0.936], [0.0275], [0.9517]]]]], 3, Con52200), 
LAve56515 = average_layer([[[[0.538, 0.583], [0.4956, 0.0599]]], [[[0.3834, 0.0187], [0.7099, 0.5184]]]], Ave56515), 
LRes77624 = reshape_layer(Ave56515, [2, 2, 1], Res77624), 
LZer61285 = zero_padding2D_layer(Res77624, 1, 0, 1, 0, Zer61285), 
LCon28289 = concatenate_layer([Zer61285,[[[[0.3623], [0.175], [0.8618]], [[0.9198], [0.1742], [0.2973]], [[0.4291], [0.7113], [0.846]]]]], 3, Con28289), 
LGlo26851 = global_max_pool1D_layer([[[1.4134, 1.0901]]], Glo26851), 
LRes9891 = reshape_layer(Glo26851, [2, 1], Res9891), 
LRes36724 = reshape_layer(Res9891, [2, 1, 1], Res36724), 
LCon53763 = conv2D_transpose_layer(Res36724, 2, 1,[[[[0.7258], [0.1144]]], [[[0.4465], [0.996]]]],[0, 0], 1, 1, false, Con53763), 
LZer77598 = zero_padding2D_layer(Con53763, 0, 0, 2, 0, Zer77598), 
LMax47447 = maximum_layer([Con28289,Zer77598], Max47447), 
LMul28005 = multiply_layer([Con52200,Max47447], Mul28005), 
LMax37774 = maximum_layer([Zer48290,Mul28005], Max37774), 
exec_layers([LPRe18601,LRes8894,LLoc3407,LZer48290,LAve44229,LZer77935,LCon52200,LAve56515,LRes77624,LZer61285,LCon28289,LGlo26851,LRes9891,LRes36724,LCon53763,LZer77598,LMax47447,LMul28005,LMax37774],["PRe18601","Res8894","Loc3407","Zer48290","Ave44229","Zer77935","Con52200","Ave56515","Res77624","Zer61285","Con28289","Glo26851","Res9891","Res36724","Con53763","Zer77598","Max47447","Mul28005","Max37774"],Max37774,"Max37774")

Actual (Unparsed): [[[[0.0000000, 0.0487294], [0.0000000, 0.0470400], [0.0000000, 0.1379742]], [[0.0000000, 0.3346232], [0.0935912, 0.0317567], [1.0172210, 0.8266056]], [[0.0000000, 0.4016376], [0.3060162, 0.0195608], [0.7112190, 1.0332984]]]]

Expected (Unparsed): [[[[0,0.048729350000000005],[0,0.04703999999999999],[0,0.13797418]],[[0,0.33462324],[0.093591205,0.03175666],[1.0172210499999998,0.826605601296]],[[0,0.4016376],[0.306016175,0.019560750000000002],[0.711219,1.0332983773200002]]]]

Actual:   [[[[0, 0.0488], [0, 0.0471], [0, 0.138]], [[0, 0.3347], [0.0936, 0.0318], [1.0173, 0.8267]], [[0, 0.4017], [0.3061, 0.0196], [0.7113, 1.0333]]]]

Expected: [[[[0, 0.0488], [0, 0.0471], [0, 0.138]], [[0, 0.3347], [0.0936, 0.0318], [1.0173, 0.8267]], [[0, 0.4017], [0.3061, 0.0196], [0.7113, 1.0333]]]]