import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sep18606 = tf.keras.layers.Input(shape=([1, 1]))
in0Add28030 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Add28030 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))

Sep18606 = keras.layers.SeparableConv1D(4, (1),strides=(1), padding='valid', name = 'Sep18606', )(in0Sep18606)
GRU91463 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU91463', )(Sep18606)
Res1024 = keras.layers.Reshape((3, 1), name = 'Res1024', )(GRU91463)
Ave95677 = keras.layers.AveragePooling1D(pool_size=(3), name = 'Ave95677', )(Res1024)
Fla11510 = keras.layers.Flatten(name = 'Fla11510', )(Ave95677)
Add28030 = keras.layers.Add(name = 'Add28030', )([in0Add28030,in1Add28030])
Fla85261 = keras.layers.Flatten(name = 'Fla85261', )(Add28030)
Res27821 = keras.layers.Reshape((8, 1), name = 'Res27821', )(Fla85261)
Res96151 = keras.layers.Reshape((8, 1, 1), name = 'Res96151', )(Res27821)
Glo96951 = keras.layers.GlobalMaxPool2D(name = 'Glo96951', )(Res96151)
Res52666 = keras.layers.Reshape((1, 1), name = 'Res52666', )(Glo96951)
Glo94899 = keras.layers.GlobalMaxPool1D(name = 'Glo94899', )(Res52666)
Ave69919 = keras.layers.Average(name = 'Ave69919', )([Fla11510,Glo94899])
model = tf.keras.models.Model(inputs=[in0Sep18606,in0Add28030,in1Add28030], outputs=Ave69919)
w = model.get_layer('Sep18606').get_weights() 
w[0] = np.array([[[0.6179]]])
w[1] = np.array([[[0.9209, 0.359, 0.4271, 0.2553]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep18606').set_weights(w) 
w = model.get_layer('GRU91463').get_weights() 
w[0] = np.array([[9, 8, 1, 3, 5, 4, 4, 1, 6], [10, 7, 2, 7, 8, 6, 4, 9, 4], [1, 9, 1, 1, 9, 9, 9, 4, 7], [10, 1, 1, 4, 4, 5, 9, 8, 4]])
w[1] = np.array([[6, 3, 3, 6, 8, 9, 3, 10, 10], [7, 1, 10, 6, 5, 7, 5, 7, 8], [6, 1, 3, 1, 3, 5, 10, 2, 8]])
w[2] = np.array([5, 4, 4, 9, 1, 3, 6, 1, 2])
model.get_layer('GRU91463').set_weights(w) 
in0Sep18606 = tf.constant([[[0.564]]])
in0Add28030 = tf.constant([[[[[0.5537, 0.3518], [0.8125, 0.7954]], [[0.4443, 0.6051], [0.619, 0.4998]]]]])
in1Add28030 = tf.constant([[[[[0.5033, 0.2469], [0.8163, 0.2613]], [[0.8478, 0.4383], [0.2914, 0.3788]]]]])
print (np.array2string(model.predict([in0Sep18606,in0Add28030,in1Add28030],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave69919.png')

LSep18606 = separable_conv1D_layer([[[0.564]]], 1,[[[[0.6179]]],[[[0.9209, 0.359, 0.4271, 0.2553]]]],[0, 0, 0, 0], 1, false, Sep18606), 
LGRU91463 = gru_layer(Sep18606,[[9, 8, 1, 3, 5, 4, 4, 1, 6], [10, 7, 2, 7, 8, 6, 4, 9, 4], [1, 9, 1, 1, 9, 9, 9, 4, 7], [10, 1, 1, 4, 4, 5, 9, 8, 4]],[[6, 3, 3, 6, 8, 9, 3, 10, 10], [7, 1, 10, 6, 5, 7, 5, 7, 8], [6, 1, 3, 1, 3, 5, 10, 2, 8]],[5, 4, 4, 9, 1, 3, 6, 1, 2], false, GRU91463), 
LRes1024 = reshape_layer(GRU91463, [3, 1], Res1024), 
LAve95677 = average_pooling1D_layer(Res1024, 3, Ave95677), 
LFla11510 = flatten_layer(Ave95677, Fla11510), 
LAdd28030 = add_layer([[[[[[0.5537, 0.3518], [0.8125, 0.7954]], [[0.4443, 0.6051], [0.619, 0.4998]]]]], [[[[[0.5033, 0.2469], [0.8163, 0.2613]], [[0.8478, 0.4383], [0.2914, 0.3788]]]]]], Add28030), 
LFla85261 = flatten_layer(Add28030, Fla85261), 
LRes27821 = reshape_layer(Fla85261, [8, 1], Res27821), 
LRes96151 = reshape_layer(Res27821, [8, 1, 1], Res96151), 
LGlo96951 = global_max_pool2D_layer(Res96151, Glo96951), 
LRes52666 = reshape_layer(Glo96951, [1, 1], Res52666), 
LGlo94899 = global_max_pool1D_layer(Res52666, Glo94899), 
LAve69919 = average_layer([Fla11510,Glo94899], Ave69919), 
exec_layers([LSep18606,LGRU91463,LRes1024,LAve95677,LFla11510,LAdd28030,LFla85261,LRes27821,LRes96151,LGlo96951,LRes52666,LGlo94899,LAve69919],["Sep18606","GRU91463","Res1024","Ave95677","Fla11510","Add28030","Fla85261","Res27821","Res96151","Glo96951","Res52666","Glo94899","Ave69919"],Ave69919,"Ave69919")

Actual (Unparsed): [[0.8157780]]

Expected (Unparsed): [[0.8157780505200889]]

Actual:   [[0.8158]]

Expected: [[0.8158]]