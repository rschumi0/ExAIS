import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST85664 = tf.keras.layers.Input(shape=([2, 3]))
in0Mul67866 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Mul67866 = tf.keras.layers.Input(shape=([2, 1, 1]))

LST85664 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST85664', )(in0LST85664)
Res31048 = keras.layers.Reshape((2, 1), name = 'Res31048', )(LST85664)
LST93641 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST93641', )(Res31048)
Res88488 = keras.layers.Reshape((3, 1), name = 'Res88488', )(LST93641)
Mul67866 = keras.layers.Multiply(name = 'Mul67866', )([in0Mul67866,in1Mul67866])
Res85517 = keras.layers.Reshape((2, 1), name = 'Res85517', )(Mul67866)
Cro2226 = keras.layers.Cropping1D(cropping=((1, 0)), name = 'Cro2226', )(Res85517)
Zer45934 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer45934', )(Cro2226)
Min23743 = keras.layers.Minimum(name = 'Min23743', )([Res88488,Zer45934])
Res91798 = keras.layers.Reshape((3, 1, 1), name = 'Res91798', )(Min23743)
Dep8696 = keras.layers.DepthwiseConv2D((2, 1),strides=(3, 3), padding='valid', name = 'Dep8696', )(Res91798)
model = tf.keras.models.Model(inputs=[in0LST85664,in0Mul67866,in1Mul67866], outputs=Dep8696)
w = model.get_layer('LST85664').get_weights() 
w[0] = np.array([[4, 6, 3, 7, 9, 1, 1, 7], [3, 1, 1, 10, 1, 9, 6, 2], [4, 10, 2, 9, 10, 9, 5, 5]])
w[1] = np.array([[7, 1, 10, 9, 9, 5, 4, 2], [7, 10, 7, 1, 1, 6, 2, 3]])
w[2] = np.array([7, 1, 10, 3, 8, 7, 5, 3])
model.get_layer('LST85664').set_weights(w) 
w = model.get_layer('LST93641').get_weights() 
w[0] = np.array([[1, 10, 6, 9, 3, 5, 6, 9, 10, 10, 10, 4]])
w[1] = np.array([[1, 9, 9, 4, 3, 5, 8, 8, 5, 4, 9, 6], [7, 8, 10, 8, 9, 5, 4, 2, 8, 2, 10, 4], [4, 1, 2, 4, 10, 5, 5, 5, 9, 8, 5, 4]])
w[2] = np.array([7, 5, 1, 9, 6, 1, 1, 8, 6, 7, 4, 3])
model.get_layer('LST93641').set_weights(w) 
w = model.get_layer('Dep8696').get_weights() 
w[0] = np.array([[[[0.2954]]], [[[0.9172]]]])
w[1] = np.array([0])
model.get_layer('Dep8696').set_weights(w) 
in0LST85664 = tf.constant([[[9, 2, 1], [5, 9, 6]]])
in0Mul67866 = tf.constant([[[[0.2988]], [[0.7251]]]])
in1Mul67866 = tf.constant([[[[0.4706]], [[0.2482]]]])
print (np.array2string(model.predict([in0LST85664,in0Mul67866,in1Mul67866],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dep8696.png')

LLST85664 = lstm_layer([[[9, 2, 1], [5, 9, 6]]],[[4, 6, 3, 7, 9, 1, 1, 7], [3, 1, 1, 10, 1, 9, 6, 2], [4, 10, 2, 9, 10, 9, 5, 5]],[[7, 1, 10, 9, 9, 5, 4, 2], [7, 10, 7, 1, 1, 6, 2, 3]],[7, 1, 10, 3, 8, 7, 5, 3], LST85664), 
LRes31048 = reshape_layer(LST85664, [2, 1], Res31048), 
LLST93641 = lstm_layer(Res31048,[[1, 10, 6, 9, 3, 5, 6, 9, 10, 10, 10, 4]],[[1, 9, 9, 4, 3, 5, 8, 8, 5, 4, 9, 6], [7, 8, 10, 8, 9, 5, 4, 2, 8, 2, 10, 4], [4, 1, 2, 4, 10, 5, 5, 5, 9, 8, 5, 4]],[7, 5, 1, 9, 6, 1, 1, 8, 6, 7, 4, 3], LST93641), 
LRes88488 = reshape_layer(LST93641, [3, 1], Res88488), 
LMul67866 = multiply_layer([[[[[0.2988]], [[0.7251]]]], [[[[0.4706]], [[0.2482]]]]], Mul67866), 
LRes85517 = reshape_layer(Mul67866, [2, 1], Res85517), 
LCro2226 = cropping1D_layer(Res85517, 1, 0, Cro2226), 
LZer45934 = zero_padding1D_layer(Cro2226, 2, 0, Zer45934), 
LMin23743 = minimum_layer([Res88488,Zer45934], Min23743), 
LRes91798 = reshape_layer(Min23743, [3, 1, 1], Res91798), 
LDep8696 = depthwise_conv2D_layer(Res91798, 2, 1,[[[[0.2954]]], [[[0.9172]]]],[0], 3, 3, false, Dep8696), 
exec_layers([LLST85664,LRes31048,LLST93641,LRes88488,LMul67866,LRes85517,LCro2226,LZer45934,LMin23743,LRes91798,LDep8696],["LST85664","Res31048","LST93641","Res88488","Mul67866","Res85517","Cro2226","Zer45934","Min23743","Res91798","Dep8696"],Dep8696,"Dep8696")

Actual (Unparsed): [[[[0.0000000]]]]

Expected (Unparsed): [[[[0.0]]]]

Actual:   [[[[0]]]]

Expected: [[[[0]]]]