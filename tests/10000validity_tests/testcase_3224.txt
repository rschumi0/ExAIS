import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot74822 = tf.keras.layers.Input(shape=([3]))
in1Dot74822 = tf.keras.layers.Input(shape=([3]))
in0Con55044 = tf.keras.layers.Input(shape=([2]))
in0Zer49043 = tf.keras.layers.Input(shape=([2, 4, 1]))

Dot74822 = keras.layers.Dot(axes=(1, 1), name = 'Dot74822', )([in0Dot74822,in1Dot74822])
Con55044 = keras.layers.Concatenate(axis=1, name = 'Con55044', )([Dot74822,in0Con55044])
Zer49043 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer49043', )(in0Zer49043)
Res20816 = keras.layers.Reshape((4, 6), name = 'Res20816', )(Zer49043)
LST36481 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST36481', )(Res20816)
Dot6183 = keras.layers.Dot(axes=(1, 1), name = 'Dot6183', )([Con55044,LST36481])
Res77669 = keras.layers.Reshape((1, 1), name = 'Res77669', )(Dot6183)
Res99847 = keras.layers.Reshape((1, 1, 1), name = 'Res99847', )(Res77669)
Loc153 = keras.layers.LocallyConnected2D(2, (1, 1),strides=(1, 1), name = 'Loc153', )(Res99847)
model = tf.keras.models.Model(inputs=[in0Dot74822,in1Dot74822,in0Con55044,in0Zer49043], outputs=Loc153)
w = model.get_layer('LST36481').get_weights() 
w[0] = np.array([[3, 6, 3, 8, 2, 6, 7, 9, 6, 5, 9, 2], [9, 8, 8, 2, 7, 3, 2, 10, 4, 1, 2, 9], [4, 3, 2, 7, 5, 5, 3, 5, 10, 7, 1, 2], [1, 10, 9, 8, 9, 4, 7, 7, 5, 6, 10, 6], [5, 6, 6, 3, 9, 5, 10, 3, 4, 3, 9, 7], [2, 8, 4, 6, 1, 2, 3, 1, 4, 4, 3, 5]])
w[1] = np.array([[7, 3, 1, 3, 6, 2, 5, 5, 6, 4, 2, 10], [5, 3, 1, 3, 1, 1, 10, 8, 1, 10, 7, 7], [4, 1, 7, 6, 1, 2, 5, 2, 4, 2, 5, 1]])
w[2] = np.array([10, 9, 9, 4, 9, 10, 2, 10, 5, 10, 5, 1])
model.get_layer('LST36481').set_weights(w) 
w = model.get_layer('Loc153').get_weights() 
w[0] = np.array([[[0.3656, 0.7335]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc153').set_weights(w) 
in0Dot74822 = tf.constant([[0.6471, 0.4999, 0.9276]])
in1Dot74822 = tf.constant([[0.0067, 0.4682, 0.5725]])
in0Con55044 = tf.constant([[0.64, 0.2159]])
in0Zer49043 = tf.constant([[[[1.8494], [1.9763], [1.1238], [1.695]], [[1.8056], [1.9213], [1.2006], [1.793]]]])
print (np.array2string(model.predict([in0Dot74822,in1Dot74822,in0Con55044,in0Zer49043],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc153.png')

LDot74822 = dot_layer([[0.6471, 0.4999, 0.9276]], [[0.0067, 0.4682, 0.5725]], 1, 1, Dot74822), 
LCon55044 = concatenate_layer([Dot74822,[[0.64, 0.2159]]], 1, Con55044), 
LZer49043 = zero_padding2D_layer([[[[1.8494], [1.9763], [1.1238], [1.695]], [[1.8056], [1.9213], [1.2006], [1.793]]]], 1, 1, 1, 1, Zer49043), 
LRes20816 = reshape_layer(Zer49043, [4, 6], Res20816), 
LLST36481 = lstm_layer(Res20816,[[3, 6, 3, 8, 2, 6, 7, 9, 6, 5, 9, 2], [9, 8, 8, 2, 7, 3, 2, 10, 4, 1, 2, 9], [4, 3, 2, 7, 5, 5, 3, 5, 10, 7, 1, 2], [1, 10, 9, 8, 9, 4, 7, 7, 5, 6, 10, 6], [5, 6, 6, 3, 9, 5, 10, 3, 4, 3, 9, 7], [2, 8, 4, 6, 1, 2, 3, 1, 4, 4, 3, 5]],[[7, 3, 1, 3, 6, 2, 5, 5, 6, 4, 2, 10], [5, 3, 1, 3, 1, 1, 10, 8, 1, 10, 7, 7], [4, 1, 7, 6, 1, 2, 5, 2, 4, 2, 5, 1]],[10, 9, 9, 4, 9, 10, 2, 10, 5, 10, 5, 1], LST36481), 
LDot6183 = dot_layer(Con55044,LST36481, 1, 1, Dot6183), 
LRes77669 = reshape_layer(Dot6183, [1, 1], Res77669), 
LRes99847 = reshape_layer(Res77669, [1, 1, 1], Res99847), 
LLoc153 = locally_connected2D_layer(Res99847, 1, 1,[[[0.3656, 0.7335]]],[[[0, 0]]], 1, 1, Loc153), 
exec_layers([LDot74822,LCon55044,LZer49043,LRes20816,LLST36481,LDot6183,LRes77669,LRes99847,LLoc153],["Dot74822","Con55044","Zer49043","Res20816","LST36481","Dot6183","Res77669","Res99847","Loc153"],Loc153,"Loc153")

Actual (Unparsed): [[[[0.5938115, 1.1913587]]]]

Expected (Unparsed): [[[[0.5938115157375852,1.1913587166124693]]]]

Actual:   [[[[0.5939, 1.1914]]]]

Expected: [[[[0.5939, 1.1914]]]]