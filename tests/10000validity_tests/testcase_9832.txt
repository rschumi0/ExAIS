import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sim18229 = tf.keras.layers.Input(shape=([2, 1]))
in0Con53227 = tf.keras.layers.Input(shape=([1]))
in0Sub42668 = tf.keras.layers.Input(shape=([3, 2, 3, 2]))
in1Sub42668 = tf.keras.layers.Input(shape=([3, 2, 3, 2]))

Sim18229 = keras.layers.SimpleRNN(1,name = 'Sim18229', )(in0Sim18229)
Res47872 = keras.layers.Reshape((1, 1), name = 'Res47872', )(Sim18229)
Per87285 = keras.layers.Permute((2,1), name = 'Per87285',)(Res47872)
Fla15702 = keras.layers.Flatten(name = 'Fla15702', )(Per87285)
Con53227 = keras.layers.Concatenate(axis=1, name = 'Con53227', )([Fla15702,in0Con53227])
Sub42668 = keras.layers.Subtract(name = 'Sub42668', )([in0Sub42668,in1Sub42668])
Res66566 = keras.layers.Reshape((3, 2, 6), name = 'Res66566', )(Sub42668)
Res81509 = keras.layers.Reshape((3, 12), name = 'Res81509', )(Res66566)
LST78809 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST78809', )(Res81509)
Max21314 = keras.layers.Maximum(name = 'Max21314', )([Con53227,LST78809])
model = tf.keras.models.Model(inputs=[in0Sim18229,in0Con53227,in0Sub42668,in1Sub42668], outputs=Max21314)
w = model.get_layer('Sim18229').get_weights() 
w[0] = np.array([[2]])
w[1] = np.array([[7]])
w[2] = np.array([7])
model.get_layer('Sim18229').set_weights(w) 
w = model.get_layer('LST78809').get_weights() 
w[0] = np.array([[5, 8, 3, 8, 2, 4, 1, 2], [4, 2, 8, 8, 6, 8, 5, 1], [5, 1, 1, 2, 8, 4, 6, 3], [10, 9, 8, 9, 9, 9, 9, 10], [10, 2, 3, 1, 6, 4, 1, 5], [4, 8, 6, 2, 8, 5, 3, 2], [4, 4, 1, 7, 10, 9, 9, 4], [1, 3, 7, 9, 3, 2, 4, 8], [7, 1, 5, 5, 8, 8, 3, 8], [1, 6, 6, 4, 10, 9, 10, 1], [6, 9, 1, 9, 6, 7, 2, 2], [3, 5, 5, 4, 5, 4, 7, 2]])
w[1] = np.array([[6, 7, 6, 10, 1, 5, 2, 3], [8, 7, 2, 10, 7, 5, 5, 5]])
w[2] = np.array([7, 4, 5, 9, 10, 8, 6, 5])
model.get_layer('LST78809').set_weights(w) 
in0Sim18229 = tf.constant([[[7], [4]]])
in0Con53227 = tf.constant([[0.9932]])
in0Sub42668 = tf.constant([[[[[0.2199, 0.7135], [0.2926, 0.091], [0.5973, 0.9641]], [[0.2021, 0.1581], [0.6621, 0.5807], [0.5462, 0.7796]]], [[[0.7562, 0.9322], [0.7941, 0.8616], [0.0002, 0.1833]], [[0.4726, 0.9849], [0.4161, 0.0226], [0.3702, 0.763]]], [[[0.5514, 0.3691], [0.1533, 0.044], [0.1956, 0.8427]], [[0.542, 0.9015], [0.2479, 0.0164], [0.9978, 0.044]]]]])
in1Sub42668 = tf.constant([[[[[0.1798, 0.8547], [0.0825, 0.6108], [0.8204, 0.2871]], [[0.2603, 0.3235], [0.3841, 0.5665], [0.9387, 0.6124]]], [[[0.7598, 0.9167], [0.9666, 0.6473], [0.0861, 0.9884]], [[0.6464, 0.1689], [0.5462, 0.8106], [0.549, 0.6388]]], [[[0.1363, 0.2491], [0.074, 0.5029], [0.8824, 0.4669]], [[0.7422, 0.3005], [0.6119, 0.5169], [0.6701, 0.9395]]]]])
print (np.array2string(model.predict([in0Sim18229,in0Con53227,in0Sub42668,in1Sub42668],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max21314.png')

LSim18229 = simple_rnn_layer([[[7], [4]]],[[2]],[[7]],[7], Sim18229), 
LRes47872 = reshape_layer(Sim18229, [1, 1], Res47872), 
LPer87285 = permute_layer(Res47872, 2,1, Per87285), 
LFla15702 = flatten_layer(Per87285, Fla15702), 
LCon53227 = concatenate_layer([Fla15702,[[0.9932]]], 1, Con53227), 
LSub42668 = subtract_layer([[[[[0.2199, 0.7135], [0.2926, 0.091], [0.5973, 0.9641]], [[0.2021, 0.1581], [0.6621, 0.5807], [0.5462, 0.7796]]], [[[0.7562, 0.9322], [0.7941, 0.8616], [0.0002, 0.1833]], [[0.4726, 0.9849], [0.4161, 0.0226], [0.3702, 0.763]]], [[[0.5514, 0.3691], [0.1533, 0.044], [0.1956, 0.8427]], [[0.542, 0.9015], [0.2479, 0.0164], [0.9978, 0.044]]]]], [[[[[0.1798, 0.8547], [0.0825, 0.6108], [0.8204, 0.2871]], [[0.2603, 0.3235], [0.3841, 0.5665], [0.9387, 0.6124]]], [[[0.7598, 0.9167], [0.9666, 0.6473], [0.0861, 0.9884]], [[0.6464, 0.1689], [0.5462, 0.8106], [0.549, 0.6388]]], [[[0.1363, 0.2491], [0.074, 0.5029], [0.8824, 0.4669]], [[0.7422, 0.3005], [0.6119, 0.5169], [0.6701, 0.9395]]]]], Sub42668), 
LRes66566 = reshape_layer(Sub42668, [3, 2, 6], Res66566), 
LRes81509 = reshape_layer(Res66566, [3, 12], Res81509), 
LLST78809 = lstm_layer(Res81509,[[5, 8, 3, 8, 2, 4, 1, 2], [4, 2, 8, 8, 6, 8, 5, 1], [5, 1, 1, 2, 8, 4, 6, 3], [10, 9, 8, 9, 9, 9, 9, 10], [10, 2, 3, 1, 6, 4, 1, 5], [4, 8, 6, 2, 8, 5, 3, 2], [4, 4, 1, 7, 10, 9, 9, 4], [1, 3, 7, 9, 3, 2, 4, 8], [7, 1, 5, 5, 8, 8, 3, 8], [1, 6, 6, 4, 10, 9, 10, 1], [6, 9, 1, 9, 6, 7, 2, 2], [3, 5, 5, 4, 5, 4, 7, 2]],[[6, 7, 6, 10, 1, 5, 2, 3], [8, 7, 2, 10, 7, 5, 5, 5]],[7, 4, 5, 9, 10, 8, 6, 5], LST78809), 
LMax21314 = maximum_layer([Con53227,LST78809], Max21314), 
exec_layers([LSim18229,LRes47872,LPer87285,LFla15702,LCon53227,LSub42668,LRes66566,LRes81509,LLST78809,LMax21314],["Sim18229","Res47872","Per87285","Fla15702","Con53227","Sub42668","Res66566","Res81509","LST78809","Max21314"],Max21314,"Max21314")

Actual (Unparsed): [[1.0000000, 0.9932000]]

Expected (Unparsed): [[1.0,0.9932]]

Actual:   [[1, 0.9932]]

Expected: [[1, 0.9932]]