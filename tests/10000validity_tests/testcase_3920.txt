import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave67850 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Ave67850 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Max4993 = tf.keras.layers.Input(shape=([2, 1]))
in1Max4993 = tf.keras.layers.Input(shape=([2, 1]))
in0Con65230 = tf.keras.layers.Input(shape=([2, 1]))
in0Dot73816 = tf.keras.layers.Input(shape=([2]))
in1Dot73816 = tf.keras.layers.Input(shape=([2]))
in0Con1991 = tf.keras.layers.Input(shape=([2, 1]))
in0Add18835 = tf.keras.layers.Input(shape=([1, 1]))
in1Add18835 = tf.keras.layers.Input(shape=([1, 1]))
in0Con90053 = tf.keras.layers.Input(shape=([2, 1]))
in0Loc55491 = tf.keras.layers.Input(shape=([2, 2]))
in0Con8856 = tf.keras.layers.Input(shape=([2, 1]))

Ave67850 = keras.layers.Average(name = 'Ave67850', )([in0Ave67850,in1Ave67850])
Res1930 = keras.layers.Reshape((1, 4), name = 'Res1930', )(Ave67850)
Loc21053 = keras.layers.LocallyConnected1D(3, (1),strides=(1), name = 'Loc21053', )(Res1930)
Zer72161 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer72161', )(Loc21053)
Max4993 = keras.layers.Maximum(name = 'Max4993', )([in0Max4993,in1Max4993])
Res57561 = keras.layers.Reshape((2, 1, 1), name = 'Res57561', )(Max4993)
Dep1361 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='valid', name = 'Dep1361', )(Res57561)
Res72990 = keras.layers.Reshape((2, 1), name = 'Res72990', )(Dep1361)
Con65230 = keras.layers.Concatenate(axis=2, name = 'Con65230', )([Res72990,in0Con65230])
Dot73816 = keras.layers.Dot(axes=(1, 1), name = 'Dot73816', )([in0Dot73816,in1Dot73816])
Res34568 = keras.layers.Reshape((1, 1), name = 'Res34568', )(Dot73816)
Zer50464 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer50464', )(Res34568)
Con1991 = keras.layers.Concatenate(axis=2, name = 'Con1991', )([Zer50464,in0Con1991])
Add18835 = keras.layers.Add(name = 'Add18835', )([in0Add18835,in1Add18835])
Zer86501 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer86501', )(Add18835)
Con90053 = keras.layers.Concatenate(axis=2, name = 'Con90053', )([Zer86501,in0Con90053])
Loc55491 = keras.layers.LocallyConnected1D(2, (1),strides=(1), name = 'Loc55491', )(in0Loc55491)
Ave60162 = keras.layers.Average(name = 'Ave60162', )([Con90053,Loc55491])
Add22808 = keras.layers.Add(name = 'Add22808', )([Con1991,Ave60162])
Max60511 = keras.layers.Maximum(name = 'Max60511', )([Con65230,Add22808])
Con8856 = keras.layers.Concatenate(axis=2, name = 'Con8856', )([Max60511,in0Con8856])
Sub78993 = keras.layers.Subtract(name = 'Sub78993', )([Zer72161,Con8856])
model = tf.keras.models.Model(inputs=[in0Ave67850,in1Ave67850,in0Max4993,in1Max4993,in0Con65230,in0Dot73816,in1Dot73816,in0Con1991,in0Add18835,in1Add18835,in0Con90053,in0Loc55491,in0Con8856], outputs=Sub78993)
w = model.get_layer('Loc21053').get_weights() 
w[0] = np.array([[[0.3033, 0.8525, 0.7374], [0.805, 0.1139, 0.1179], [0.6695, 0.2676, 0.7061], [0.0913, 0.7607, 0.1419]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc21053').set_weights(w) 
w = model.get_layer('Dep1361').get_weights() 
w[0] = np.array([[[[0.3352]]]])
w[1] = np.array([0])
model.get_layer('Dep1361').set_weights(w) 
w = model.get_layer('Loc55491').get_weights() 
w[0] = np.array([[[0.2983, 0.373], [0.1026, 0.697]], [[0.6793, 0.7523], [0.7447, 0.5028]]])
w[1] = np.array([[0, 0], [0, 0]])
model.get_layer('Loc55491').set_weights(w) 
in0Ave67850 = tf.constant([[[[0.3557, 0.6856], [0.3773, 0.8586]]]])
in1Ave67850 = tf.constant([[[[0.7039, 0.0732], [0.8278, 0.488]]]])
in0Max4993 = tf.constant([[[0.9667], [0.337]]])
in1Max4993 = tf.constant([[[0.5304], [0.4785]]])
in0Con65230 = tf.constant([[[0.339], [0.5868]]])
in0Dot73816 = tf.constant([[0.4844, 0.2724]])
in1Dot73816 = tf.constant([[0.6868, 0.7165]])
in0Con1991 = tf.constant([[[0.3328], [0.2143]]])
in0Add18835 = tf.constant([[[0.6482]]])
in1Add18835 = tf.constant([[[0.017]]])
in0Con90053 = tf.constant([[[0.7196], [0.4029]]])
in0Loc55491 = tf.constant([[[0.5586, 0.4806], [0.3431, 0.3067]]])
in0Con8856 = tf.constant([[[0.6356], [0.3214]]])
print (np.array2string(model.predict([in0Ave67850,in1Ave67850,in0Max4993,in1Max4993,in0Con65230,in0Dot73816,in1Dot73816,in0Con1991,in0Add18835,in1Add18835,in0Con90053,in0Loc55491,in0Con8856],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub78993.png')

LAve67850 = average_layer([[[[[0.3557, 0.6856], [0.3773, 0.8586]]]], [[[[0.7039, 0.0732], [0.8278, 0.488]]]]], Ave67850), 
LRes1930 = reshape_layer(Ave67850, [1, 4], Res1930), 
LLoc21053 = locally_connected1D_layer(Res1930, 1,[[[0.3033, 0.8525, 0.7374], [0.805, 0.1139, 0.1179], [0.6695, 0.2676, 0.7061], [0.0913, 0.7607, 0.1419]]],[[0, 0, 0]], 1, Loc21053), 
LZer72161 = zero_padding1D_layer(Loc21053, 1, 0, Zer72161), 
LMax4993 = maximum_layer([[[[0.9667], [0.337]]], [[[0.5304], [0.4785]]]], Max4993), 
LRes57561 = reshape_layer(Max4993, [2, 1, 1], Res57561), 
LDep1361 = depthwise_conv2D_layer(Res57561, 1, 1,[[[[0.3352]]]],[0], 1, 1, false, Dep1361), 
LRes72990 = reshape_layer(Dep1361, [2, 1], Res72990), 
LCon65230 = concatenate_layer([Res72990,[[[0.339], [0.5868]]]], 2, Con65230), 
LDot73816 = dot_layer([[0.4844, 0.2724]], [[0.6868, 0.7165]], 1, 1, Dot73816), 
LRes34568 = reshape_layer(Dot73816, [1, 1], Res34568), 
LZer50464 = zero_padding1D_layer(Res34568, 1, 0, Zer50464), 
LCon1991 = concatenate_layer([Zer50464,[[[0.3328], [0.2143]]]], 2, Con1991), 
LAdd18835 = add_layer([[[[0.6482]]], [[[0.017]]]], Add18835), 
LZer86501 = zero_padding1D_layer(Add18835, 1, 0, Zer86501), 
LCon90053 = concatenate_layer([Zer86501,[[[0.7196], [0.4029]]]], 2, Con90053), 
LLoc55491 = locally_connected1D_layer([[[0.5586, 0.4806], [0.3431, 0.3067]]], 1,[[[0.2983, 0.373], [0.1026, 0.697]], [[0.6793, 0.7523], [0.7447, 0.5028]]],[[0, 0], [0, 0]], 1, Loc55491), 
LAve60162 = average_layer([Con90053,Loc55491], Ave60162), 
LAdd22808 = add_layer([Con1991,Ave60162], Add22808), 
LMax60511 = maximum_layer([Con65230,Add22808], Max60511), 
LCon8856 = concatenate_layer([Max60511,[[[0.6356], [0.3214]]]], 2, Con8856), 
LSub78993 = subtract_layer(Zer72161,Con8856, Sub78993), 
exec_layers([LAve67850,LRes1930,LLoc21053,LZer72161,LMax4993,LRes57561,LDep1361,LRes72990,LCon65230,LDot73816,LRes34568,LZer50464,LCon1991,LAdd18835,LZer86501,LCon90053,LLoc55491,LAve60162,LAdd22808,LMax60511,LCon8856,LSub78993],["Ave67850","Res1930","Loc21053","Zer72161","Max4993","Res57561","Dep1361","Res72990","Con65230","Dot73816","Res34568","Zer50464","Con1991","Add18835","Zer86501","Con90053","Loc55491","Ave60162","Add22808","Max60511","Con8856","Sub78993"],Sub78993,"Sub78993")

Actual (Unparsed): [[[-0.3240378, -0.9642680, -0.6356000], [-0.1602093, 0.5463784, 0.6350076]]]

Expected (Unparsed): [[[-0.32403784,-0.964268,-0.6356],[-0.16020932499999996,0.546378405,0.6350076050000001]]]

Actual:   [[[-0.324, -0.9642, -0.6356], [-0.1602, 0.5464, 0.6351]]]

Expected: [[[-0.324, -0.9642, -0.6356], [-0.1602, 0.5464, 0.6351]]]