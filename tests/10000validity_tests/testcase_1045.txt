import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0ReL55140 = tf.keras.layers.Input(shape=([2, 2]))
in0Con93234 = tf.keras.layers.Input(shape=([2, 1]))
in0Add97285 = tf.keras.layers.Input(shape=([1, 2]))
in1Add97285 = tf.keras.layers.Input(shape=([1, 2]))
in0Con43713 = tf.keras.layers.Input(shape=([4, 4, 1]))
in0Add35549 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Add35549 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in0Con73039 = tf.keras.layers.Input(shape=([4, 4, 1]))
in0Mul71114 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Mul71114 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))

ReL55140 = keras.layers.ReLU(max_value=2.2004880292112063, negative_slope=7.219238720807826, threshold=2.8661707173362316, name = 'ReL55140', input_shape=(2, 2))(in0ReL55140)
Sof18417 = keras.layers.Softmax(axis=1, name = 'Sof18417', )(ReL55140)
GRU65723 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU65723', )(Sof18417)
Res75662 = keras.layers.Reshape((2, 1), name = 'Res75662', )(GRU65723)
Con93234 = keras.layers.Concatenate(axis=2, name = 'Con93234', )([Res75662,in0Con93234])
Add97285 = keras.layers.Add(name = 'Add97285', )([in0Add97285,in1Add97285])
Zer4543 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer4543', )(Add97285)
Sub71922 = keras.layers.Subtract(name = 'Sub71922', )([Con93234,Zer4543])
Res72994 = keras.layers.Reshape((2, 2, 1), name = 'Res72994', )(Sub71922)
Zer85599 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer85599', )(Res72994)
Con43713 = keras.layers.Concatenate(axis=3, name = 'Con43713', )([Zer85599,in0Con43713])
Add35549 = keras.layers.Add(name = 'Add35549', )([in0Add35549,in1Add35549])
Glo82447 = keras.layers.GlobalMaxPool3D(name = 'Glo82447', )(Add35549)
Res5029 = keras.layers.Reshape((1, 1), name = 'Res5029', )(Glo82447)
Res44219 = keras.layers.Reshape((1, 1, 1), name = 'Res44219', )(Res5029)
Zer22793 = keras.layers.ZeroPadding2D(padding=((3, 0), (3, 0)), name = 'Zer22793', )(Res44219)
Con73039 = keras.layers.Concatenate(axis=3, name = 'Con73039', )([Zer22793,in0Con73039])
Mul71114 = keras.layers.Multiply(name = 'Mul71114', )([in0Mul71114,in1Mul71114])
Res28195 = keras.layers.Reshape((2, 2, 2), name = 'Res28195', )(Mul71114)
Up_35624 = keras.layers.UpSampling2D(size=(2, 2), name = 'Up_35624', )(Res28195)
Ave80145 = keras.layers.Average(name = 'Ave80145', )([Con73039,Up_35624])
Mul96896 = keras.layers.Multiply(name = 'Mul96896', )([Con43713,Ave80145])
model = tf.keras.models.Model(inputs=[in0ReL55140,in0Con93234,in0Add97285,in1Add97285,in0Con43713,in0Add35549,in1Add35549,in0Con73039,in0Mul71114,in1Mul71114], outputs=Mul96896)
w = model.get_layer('GRU65723').get_weights() 
w[0] = np.array([[10, 5, 4, 2, 4, 9], [2, 3, 2, 4, 3, 5]])
w[1] = np.array([[3, 5, 7, 2, 8, 3], [9, 3, 4, 1, 3, 7]])
w[2] = np.array([10, 4, 3, 5, 10, 5])
model.get_layer('GRU65723').set_weights(w) 
in0ReL55140 = tf.constant([[[0.2133, 0.0155], [0.6487, 0.8846]]])
in0Con93234 = tf.constant([[[0.8835], [0.5333]]])
in0Add97285 = tf.constant([[[0.619, 0.4516]]])
in1Add97285 = tf.constant([[[0.2662, 0.876]]])
in0Con43713 = tf.constant([[[[0.0673], [0.1634], [0.9376], [0.0663]], [[0.7583], [0.9842], [0.6479], [0.3967]], [[0.9457], [0.2901], [0.4669], [0.299]], [[0.5435], [0.8215], [0.9462], [0.8848]]]])
in0Add35549 = tf.constant([[[[[0.6966]]]]])
in1Add35549 = tf.constant([[[[[0.3342]]]]])
in0Con73039 = tf.constant([[[[0.0223], [0.529], [0.5245], [0.0412]], [[0.1931], [0.5769], [0.8864], [0.6006]], [[0.1402], [0.0466], [0.9987], [0.9119]], [[0.2578], [0.7413], [0.9605], [0.689]]]])
in0Mul71114 = tf.constant([[[[[0.3097], [0.1757]], [[0.7461], [0.1104]]], [[[0.5939], [0.701]], [[0.3849], [0.9584]]]]])
in1Mul71114 = tf.constant([[[[[0.0851], [0.9465]], [[0.0319], [0.0907]]], [[[0.5588], [0.7101]], [[0.6957], [0.0402]]]]])
print (np.array2string(model.predict([in0ReL55140,in0Con93234,in0Add97285,in1Add97285,in0Con43713,in0Add35549,in1Add35549,in0Con73039,in0Mul71114,in1Mul71114],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul96896.png')

LReL55140 = relu_layer([[[0.2133, 0.0155], [0.6487, 0.8846]]], 2.2004880292112063, 7.219238720807826, 2.8661707173362316, ReL55140), 
LSof18417 = softmax_layer(ReL55140, 1, Sof18417), 
LGRU65723 = gru_layer(Sof18417,[[10, 5, 4, 2, 4, 9], [2, 3, 2, 4, 3, 5]],[[3, 5, 7, 2, 8, 3], [9, 3, 4, 1, 3, 7]],[10, 4, 3, 5, 10, 5], false, GRU65723), 
LRes75662 = reshape_layer(GRU65723, [2, 1], Res75662), 
LCon93234 = concatenate_layer([Res75662,[[[0.8835], [0.5333]]]], 2, Con93234), 
LAdd97285 = add_layer([[[[0.619, 0.4516]]], [[[0.2662, 0.876]]]], Add97285), 
LZer4543 = zero_padding1D_layer(Add97285, 1, 0, Zer4543), 
LSub71922 = subtract_layer(Con93234,Zer4543, Sub71922), 
LRes72994 = reshape_layer(Sub71922, [2, 2, 1], Res72994), 
LZer85599 = zero_padding2D_layer(Res72994, 2, 0, 2, 0, Zer85599), 
LCon43713 = concatenate_layer([Zer85599,[[[[0.0673], [0.1634], [0.9376], [0.0663]], [[0.7583], [0.9842], [0.6479], [0.3967]], [[0.9457], [0.2901], [0.4669], [0.299]], [[0.5435], [0.8215], [0.9462], [0.8848]]]]], 3, Con43713), 
LAdd35549 = add_layer([[[[[[0.6966]]]]], [[[[[0.3342]]]]]], Add35549), 
LGlo82447 = global_max_pool3D_layer(Add35549, Glo82447), 
LRes5029 = reshape_layer(Glo82447, [1, 1], Res5029), 
LRes44219 = reshape_layer(Res5029, [1, 1, 1], Res44219), 
LZer22793 = zero_padding2D_layer(Res44219, 3, 0, 3, 0, Zer22793), 
LCon73039 = concatenate_layer([Zer22793,[[[[0.0223], [0.529], [0.5245], [0.0412]], [[0.1931], [0.5769], [0.8864], [0.6006]], [[0.1402], [0.0466], [0.9987], [0.9119]], [[0.2578], [0.7413], [0.9605], [0.689]]]]], 3, Con73039), 
LMul71114 = multiply_layer([[[[[[0.3097], [0.1757]], [[0.7461], [0.1104]]], [[[0.5939], [0.701]], [[0.3849], [0.9584]]]]], [[[[[0.0851], [0.9465]], [[0.0319], [0.0907]]], [[[0.5588], [0.7101]], [[0.6957], [0.0402]]]]]], Mul71114), 
LRes28195 = reshape_layer(Mul71114, [2, 2, 2], Res28195), 
LUp_35624 = up_sampling2D_layer(Res28195, 2, 2, Up_35624), 
LAve80145 = average_layer([Con73039,Up_35624], Ave80145), 
LMul96896 = multiply_layer([Con43713,Ave80145], Mul96896), 
exec_layers([LReL55140,LSof18417,LGRU65723,LRes75662,LCon93234,LAdd97285,LZer4543,LSub71922,LRes72994,LZer85599,LCon43713,LAdd35549,LGlo82447,LRes5029,LRes44219,LZer22793,LCon73039,LMul71114,LRes28195,LUp_35624,LAve80145,LMul96896],["ReL55140","Sof18417","GRU65723","Res75662","Con93234","Add97285","Zer4543","Sub71922","Res72994","Zer85599","Con43713","Add35549","Glo82447","Res5029","Res44219","Zer22793","Con73039","Mul71114","Res28195","Up_35624","Ave80145","Mul96896"],Mul96896,"Mul96896")

Actual (Unparsed): [[[[0.0000000, 0.0063464], [0.0000000, 0.0568060], [0.0000000, 0.2505798], [0.0000000, 0.0016977]], [[0.0000000, 0.1362665], [0.0000000, 0.3657287], [0.0000000, 0.2903931], [0.0000000, 0.1211151]], [[0.0000000, 0.3016689], [0.0000000, 0.0789623], [0.0000040, 0.2421408], [0.1182896, 0.1420889]], [[0.0000000, 0.2053289], [0.0000000, 0.5089521], [-0.1165623, 0.4726400], [-0.5157290, 0.3218583]]]]

Expected (Unparsed): [[[[0.0,0.006346391682500001],[0.0,0.056806014085],[0.0,0.250579825664],[0.0,0.001697720232]],[[0.0,0.1362665289575],[0.0,0.365728744605],[0.0,0.290393082056],[0.0,0.121115144088]],[[0.0,0.301668890285],[0.0,0.078962333505],[4.004416695748818e-6,0.24214080189599999],[0.11828957532750001,0.14208893815999998]],[[0.0,0.205328892175],[0.0,0.5089521510749999],[-0.11656233026152243,0.472639995408],[-0.5157290334494999,0.32185824563199994]]]]

Actual:   [[[[0, 0.0064], [0, 0.0569], [0, 0.2506], [0, 0.0017]], [[0, 0.1363], [0, 0.3658], [0, 0.2904], [0, 0.1212]], [[0, 0.3017], [0, 0.079], [0, 0.2422], [0.1183, 0.1421]], [[0, 0.2054], [0, 0.509], [-0.1165, 0.4727], [-0.5157, 0.3219]]]]

Expected: [[[[0, 0.0064], [0, 0.0569], [0, 0.2506], [0, 0.0017]], [[0, 0.1363], [0, 0.3658], [0, 0.2904], [0, 0.1212]], [[0, 0.3017], [0, 0.079], [0, 0.2422], [0.1183, 0.1421]], [[0, 0.2054], [0, 0.509], [-0.1165, 0.4727], [-0.5157, 0.3219]]]]