import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max71520 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Max71520 = tf.keras.layers.Input(shape=([2, 1, 2]))

Max71520 = keras.layers.Maximum(name = 'Max71520', )([in0Max71520,in1Max71520])
Res89584 = keras.layers.Reshape((2, 2), name = 'Res89584', )(Max71520)
Fla29711 = keras.layers.Flatten(name = 'Fla29711', )(Res89584)
Res34887 = keras.layers.Reshape((4, 1), name = 'Res34887', )(Fla29711)
LST69129 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST69129', )(Res34887)
model = tf.keras.models.Model(inputs=[in0Max71520,in1Max71520], outputs=LST69129)
w = model.get_layer('LST69129').get_weights() 
w[0] = np.array([[2, 9, 1, 3, 6, 6, 7, 4, 4, 1, 7, 3]])
w[1] = np.array([[6, 3, 5, 3, 9, 7, 5, 3, 1, 9, 9, 3], [3, 9, 6, 8, 5, 1, 8, 10, 1, 3, 7, 1], [1, 2, 8, 6, 4, 1, 7, 7, 10, 4, 10, 5]])
w[2] = np.array([4, 10, 4, 2, 10, 7, 3, 1, 6, 3, 4, 10])
model.get_layer('LST69129').set_weights(w) 
in0Max71520 = tf.constant([[[[0.6981, 0.6781]], [[0.1024, 0.0931]]]])
in1Max71520 = tf.constant([[[[0.7841, 0.1073]], [[0.5677, 0.2966]]]])
print (np.array2string(model.predict([in0Max71520,in1Max71520],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST69129.png')

LMax71520 = maximum_layer([[[[[0.6981, 0.6781]], [[0.1024, 0.0931]]]], [[[[0.7841, 0.1073]], [[0.5677, 0.2966]]]]], Max71520), 
LRes89584 = reshape_layer(Max71520, [2, 2], Res89584), 
LFla29711 = flatten_layer(Res89584, Fla29711), 
LRes34887 = reshape_layer(Fla29711, [4, 1], Res34887), 
LLST69129 = lstm_layer(Res34887,[[2, 9, 1, 3, 6, 6, 7, 4, 4, 1, 7, 3]],[[6, 3, 5, 3, 9, 7, 5, 3, 1, 9, 9, 3], [3, 9, 6, 8, 5, 1, 8, 10, 1, 3, 7, 1], [1, 2, 8, 6, 4, 1, 7, 7, 10, 4, 10, 5]],[4, 10, 4, 2, 10, 7, 3, 1, 6, 3, 4, 10], LST69129), 
exec_layers([LMax71520,LRes89584,LFla29711,LRes34887,LLST69129],["Max71520","Res89584","Fla29711","Res34887","LST69129"],LST69129,"LST69129")

Actual (Unparsed): [[0.9993242, 0.9993286, 0.9993181]]

Expected (Unparsed): [[0.9993241715114308,0.9993286146367721,0.9993180849412199]]

Actual:   [[0.9994, 0.9994, 0.9994]]

Expected: [[0.9994, 0.9994, 0.9994]]