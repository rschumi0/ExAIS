import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min21083 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Min21083 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con69164 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))

Min21083 = keras.layers.Minimum(name = 'Min21083', )([in0Min21083,in1Min21083])
Loc52959 = keras.layers.LocallyConnected2D(3, (2, 2),strides=(1, 1), name = 'Loc52959', )(Min21083)
Res87271 = keras.layers.Reshape((1, 3), name = 'Res87271', )(Loc52959)
Fla41257 = keras.layers.Flatten(name = 'Fla41257', )(Res87271)
Con69164 = keras.layers.Conv3D(3, (1, 1, 2),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con69164', )(in0Con69164)
Res59665 = keras.layers.Reshape((1, 1, 6), name = 'Res59665', )(Con69164)
Res221 = keras.layers.Reshape((1, 6), name = 'Res221', )(Res59665)
Sep80360 = keras.layers.SeparableConv1D(3, (1),strides=(1), padding='valid', name = 'Sep80360', )(Res221)
GRU58881 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU58881', )(Sep80360)
Dot17757 = keras.layers.Dot(axes=(1, 1), name = 'Dot17757', )([Fla41257,GRU58881])
model = tf.keras.models.Model(inputs=[in0Min21083,in1Min21083,in0Con69164], outputs=Dot17757)
w = model.get_layer('Loc52959').get_weights() 
w[0] = np.array([[[0.377, 0.0716, 0.903], [0.2449, 0.6199, 0.3574], [0.1415, 0.4909, 0.6334], [0.1369, 0.0177, 0.3078], [0.8251, 0.3071, 0.4653], [0.2901, 0.1751, 0.5113], [0.9498, 0.1713, 0.1988], [0.0271, 0.6057, 0.5695]]])
w[1] = np.array([[[0, 0, 0]]])
model.get_layer('Loc52959').set_weights(w) 
w = model.get_layer('Con69164').get_weights() 
w[0] = np.array([[[[[0.8807, 0.007, 0.2341]], [[0.4057, 0.1214, 0.9627]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con69164').set_weights(w) 
w = model.get_layer('Sep80360').get_weights() 
w[0] = np.array([[[0.2931], [0.7155], [0.9269], [0.5498], [0.3183], [0.5659]]])
w[1] = np.array([[[0.2618, 0.1572, 0.0521], [0.3781, 0.6182, 0.7769], [0.5163, 0.9807, 0.4483], [0.6798, 0.0361, 0.0012], [0.1775, 0.9174, 0.6405], [0.185, 0.6793, 0.6727]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep80360').set_weights(w) 
w = model.get_layer('GRU58881').get_weights() 
w[0] = np.array([[9, 6, 8, 4, 2, 1, 6, 3, 4], [8, 2, 8, 1, 9, 9, 8, 5, 5], [9, 8, 4, 9, 6, 9, 6, 1, 1]])
w[1] = np.array([[1, 2, 6, 1, 1, 4, 4, 7, 8], [3, 5, 8, 2, 2, 4, 9, 7, 7], [9, 9, 8, 9, 10, 4, 7, 1, 4]])
w[2] = np.array([2, 5, 8, 10, 2, 4, 5, 1, 8])
model.get_layer('GRU58881').set_weights(w) 
in0Min21083 = tf.constant([[[[0.8972, 0.8871], [0.7202, 0.6666]], [[0.8148, 0.5447], [0.3954, 0.774]]]])
in1Min21083 = tf.constant([[[[0.1097, 0.2325], [0.0481, 0.4365]], [[0.5233, 0.5172], [0.2252, 0.2798]]]])
in0Con69164 = tf.constant([[[[[0.6589], [0.7946]]]]])
print (np.array2string(model.predict([in0Min21083,in1Min21083,in0Con69164],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot17757.png')

LMin21083 = minimum_layer([[[[[0.8972, 0.8871], [0.7202, 0.6666]], [[0.8148, 0.5447], [0.3954, 0.774]]]], [[[[0.1097, 0.2325], [0.0481, 0.4365]], [[0.5233, 0.5172], [0.2252, 0.2798]]]]], Min21083), 
LLoc52959 = locally_connected2D_layer(Min21083, 2, 2,[[[0.377, 0.0716, 0.903], [0.2449, 0.6199, 0.3574], [0.1415, 0.4909, 0.6334], [0.1369, 0.0177, 0.3078], [0.8251, 0.3071, 0.4653], [0.2901, 0.1751, 0.5113], [0.9498, 0.1713, 0.1988], [0.0271, 0.6057, 0.5695]]],[[[0, 0, 0]]], 1, 1, Loc52959), 
LRes87271 = reshape_layer(Loc52959, [1, 3], Res87271), 
LFla41257 = flatten_layer(Res87271, Fla41257), 
LCon69164 = conv3D_layer([[[[[0.6589], [0.7946]]]]], 1, 1, 2,[[[[[0.8807, 0.007, 0.2341]], [[0.4057, 0.1214, 0.9627]]]]],[0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con69164), 
LRes59665 = reshape_layer(Con69164, [1, 1, 6], Res59665), 
LRes221 = reshape_layer(Res59665, [1, 6], Res221), 
LSep80360 = separable_conv1D_layer(Res221, 1,[[[[0.2931], [0.7155], [0.9269], [0.5498], [0.3183], [0.5659]]],[[[0.2618, 0.1572, 0.0521], [0.3781, 0.6182, 0.7769], [0.5163, 0.9807, 0.4483], [0.6798, 0.0361, 0.0012], [0.1775, 0.9174, 0.6405], [0.185, 0.6793, 0.6727]]]],[0, 0, 0], 1, false, Sep80360), 
LGRU58881 = gru_layer(Sep80360,[[9, 6, 8, 4, 2, 1, 6, 3, 4], [8, 2, 8, 1, 9, 9, 8, 5, 5], [9, 8, 4, 9, 6, 9, 6, 1, 1]],[[1, 2, 6, 1, 1, 4, 4, 7, 8], [3, 5, 8, 2, 2, 4, 9, 7, 7], [9, 9, 8, 9, 10, 4, 7, 1, 4]],[2, 5, 8, 10, 2, 4, 5, 1, 8], false, GRU58881), 
LDot17757 = dot_layer(Fla41257,GRU58881, 1, 1, Dot17757), 
exec_layers([LMin21083,LLoc52959,LRes87271,LFla41257,LCon69164,LRes59665,LRes221,LSep80360,LGRU58881,LDot17757],["Min21083","Loc52959","Res87271","Fla41257","Con69164","Res59665","Res221","Sep80360","GRU58881","Dot17757"],Dot17757,"Dot17757")

Actual (Unparsed): [[0.0000001]]

Expected (Unparsed): [[6.44213682800616e-8]]

Actual:   [[0]]

Expected: [[0]]