import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min21807 = tf.keras.layers.Input(shape=([1, 2]))
in1Min21807 = tf.keras.layers.Input(shape=([1, 2]))
in0Dot63487 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot63487 = tf.keras.layers.Input(shape=([3, 3]))
in0Con34212 = tf.keras.layers.Input(shape=([7]))

Min21807 = keras.layers.Minimum(name = 'Min21807', )([in0Min21807,in1Min21807])
Res55250 = keras.layers.Reshape((1, 2, 1), name = 'Res55250', )(Min21807)
Sep46488 = keras.layers.SeparableConv2D(4, (1, 2),strides=(1, 1), padding='same', name = 'Sep46488', )(Res55250)
Res22960 = keras.layers.Reshape((1, 8), name = 'Res22960', )(Sep46488)
Fla93729 = keras.layers.Flatten(name = 'Fla93729', )(Res22960)
Dot63487 = keras.layers.Dot(axes=(2, 1), name = 'Dot63487', )([in0Dot63487,in1Dot63487])
Res70914 = keras.layers.Reshape((3, 3, 1), name = 'Res70914', )(Dot63487)
Glo83040 = keras.layers.GlobalAveragePooling2D(name = 'Glo83040', )(Res70914)
Fla78580 = keras.layers.Flatten(name = 'Fla78580', )(Glo83040)
Con34212 = keras.layers.Concatenate(axis=1, name = 'Con34212', )([Fla78580,in0Con34212])
Add22146 = keras.layers.Add(name = 'Add22146', )([Fla93729,Con34212])
model = tf.keras.models.Model(inputs=[in0Min21807,in1Min21807,in0Dot63487,in1Dot63487,in0Con34212], outputs=Add22146)
w = model.get_layer('Sep46488').get_weights() 
w[0] = np.array([[[[0.3223]], [[0.2732]]]])
w[1] = np.array([[[[0.5819, 0.6414, 0.6629, 0.8368]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep46488').set_weights(w) 
in0Min21807 = tf.constant([[[0.6493, 0.4297]]])
in1Min21807 = tf.constant([[[0.4453, 0.6878]]])
in0Dot63487 = tf.constant([[[0.7283, 0.5689, 0.2946], [0.2295, 0.1069, 0.0477], [0.0685, 0.5354, 0.3528]]])
in1Dot63487 = tf.constant([[[0.248, 0.1356, 0.2473], [0.9104, 0.2647, 0.3806], [0.9138, 0.3922, 0.7664]]])
in0Con34212 = tf.constant([[0.9773, 0.8123, 0.3385, 0.31, 0.0033, 0.2074, 0.7151]])
print (np.array2string(model.predict([in0Min21807,in1Min21807,in0Dot63487,in1Dot63487,in0Con34212],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add22146.png')

LMin21807 = minimum_layer([[[[0.6493, 0.4297]]], [[[0.4453, 0.6878]]]], Min21807), 
LRes55250 = reshape_layer(Min21807, [1, 2, 1], Res55250), 
LSep46488 = separable_conv2D_layer(Res55250, 1, 2,[[[[[0.3223]], [[0.2732]]]],[[[[0.5819, 0.6414, 0.6629, 0.8368]]]]],[0, 0, 0, 0], 1, 1, true, Sep46488), 
LRes22960 = reshape_layer(Sep46488, [1, 8], Res22960), 
LFla93729 = flatten_layer(Res22960, Fla93729), 
LDot63487 = dot_layer([[[0.7283, 0.5689, 0.2946], [0.2295, 0.1069, 0.0477], [0.0685, 0.5354, 0.3528]]], [[[0.248, 0.1356, 0.2473], [0.9104, 0.2647, 0.3806], [0.9138, 0.3922, 0.7664]]], 2, 1, Dot63487), 
LRes70914 = reshape_layer(Dot63487, [3, 3, 1], Res70914), 
LGlo83040 = global_average_pooling2D_layer(Res70914, Glo83040), 
LFla78580 = flatten_layer(Glo83040, Fla78580), 
LCon34212 = concatenate_layer([Fla78580,[[0.9773, 0.8123, 0.3385, 0.31, 0.0033, 0.2074, 0.7151]]], 1, Con34212), 
LAdd22146 = add_layer([Fla93729,Con34212], Add22146), 
exec_layers([LMin21807,LRes55250,LSep46488,LRes22960,LFla93729,LDot63487,LRes70914,LGlo83040,LFla78580,LCon34212,LAdd22146],["Min21807","Res55250","Sep46488","Res22960","Fla93729","Dot63487","Res70914","Glo83040","Fla78580","Con34212","Add22146"],Add22146,"Add22146")

Actual (Unparsed): [[0.5931906, 1.1446504, 0.9852601, 0.5568330, 0.3905887, 0.0921290, 0.2992065, 0.8309904]]

Expected (Unparsed): [[0.5931906293258888,1.144650387122,0.985260043067,0.556833027664,0.390588675189,0.092128967634,0.299206552299,0.8309903650079999]]

Actual:   [[0.5932, 1.1447, 0.9853, 0.5569, 0.3906, 0.0922, 0.2993, 0.831]]

Expected: [[0.5932, 1.1447, 0.9853, 0.5569, 0.3906, 0.0922, 0.2993, 0.831]]