import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con51424 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in0Add66883 = tf.keras.layers.Input(shape=([2, 2]))
in1Add66883 = tf.keras.layers.Input(shape=([2, 2]))

Con51424 = keras.layers.Conv3D(2, (2, 1, 2),strides=(5, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con51424', )(in0Con51424)
Res45476 = keras.layers.Reshape((1, 1, 2), name = 'Res45476', )(Con51424)
Res57954 = keras.layers.Reshape((1, 2), name = 'Res57954', )(Res45476)
Zer39568 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer39568', )(Res57954)
Add66883 = keras.layers.Add(name = 'Add66883', )([in0Add66883,in1Add66883])
Mul31316 = keras.layers.Multiply(name = 'Mul31316', )([Zer39568,Add66883])
GRU82496 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU82496', )(Mul31316)
model = tf.keras.models.Model(inputs=[in0Con51424,in0Add66883,in1Add66883], outputs=GRU82496)
w = model.get_layer('Con51424').get_weights() 
w[0] = np.array([[[[[0.5032, 0.0703], [0.3977, 0.9957]], [[0.5735, 0.3579], [0.2362, 0.9129]]]], [[[[0.644, 0.17], [0.3204, 0.6095]], [[0.1117, 0.2704], [0.3842, 0.5392]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con51424').set_weights(w) 
w = model.get_layer('GRU82496').get_weights() 
w[0] = np.array([[6, 5, 6, 1, 10, 1, 6, 9, 4], [8, 1, 3, 6, 4, 7, 5, 2, 9]])
w[1] = np.array([[10, 3, 8, 1, 9, 3, 9, 3, 8], [10, 7, 7, 3, 1, 6, 8, 6, 7], [8, 4, 7, 9, 7, 6, 10, 6, 9]])
w[2] = np.array([[4, 10, 1, 6, 7, 3, 2, 4, 4], [10, 5, 6, 6, 3, 4, 3, 9, 1]])
model.get_layer('GRU82496').set_weights(w) 
in0Con51424 = tf.constant([[[[[0.9151, 0.4335], [0.6827, 0.2734]]], [[[0.2513, 0.1559], [0.8459, 0.1687]]]]])
in0Add66883 = tf.constant([[[0.0087, 0.4561], [0.0003, 0.3089]]])
in1Add66883 = tf.constant([[[0.1417, 0.1018], [0.6035, 0.6145]]])
print (np.array2string(model.predict([in0Con51424,in0Add66883,in1Add66883],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU82496.png')

LCon51424 = conv3D_layer([[[[[0.9151, 0.4335], [0.6827, 0.2734]]], [[[0.2513, 0.1559], [0.8459, 0.1687]]]]], 2, 1, 2,[[[[[0.5032, 0.0703], [0.3977, 0.9957]], [[0.5735, 0.3579], [0.2362, 0.9129]]]], [[[[0.644, 0.17], [0.3204, 0.6095]], [[0.1117, 0.2704], [0.3842, 0.5392]]]]],[0, 0], 5, 1, 1, false, 1, 1, 1, Con51424), 
LRes45476 = reshape_layer(Con51424, [1, 1, 2], Res45476), 
LRes57954 = reshape_layer(Res45476, [1, 2], Res57954), 
LZer39568 = zero_padding1D_layer(Res57954, 1, 0, Zer39568), 
LAdd66883 = add_layer([[[[0.0087, 0.4561], [0.0003, 0.3089]]], [[[0.1417, 0.1018], [0.6035, 0.6145]]]], Add66883), 
LMul31316 = multiply_layer([Zer39568,Add66883], Mul31316), 
LGRU82496 = gru_layer(Mul31316,[[6, 5, 6, 1, 10, 1, 6, 9, 4], [8, 1, 3, 6, 4, 7, 5, 2, 9]],[[10, 3, 8, 1, 9, 3, 9, 3, 8], [10, 7, 7, 3, 1, 6, 8, 6, 7], [8, 4, 7, 9, 7, 6, 10, 6, 9]],[[4, 10, 1, 6, 7, 3, 2, 4, 4], [10, 5, 6, 6, 3, 4, 3, 9, 1]], true, GRU82496), 
exec_layers([LCon51424,LRes45476,LRes57954,LZer39568,LAdd66883,LMul31316,LGRU82496],["Con51424","Res45476","Res57954","Zer39568","Add66883","Mul31316","GRU82496"],GRU82496,"GRU82496")

Actual (Unparsed): [[0.0000008, 0.0000003, 0.0009111]]

Expected (Unparsed): [[8.314526231575613e-7,3.068777163810551e-7,0.0009110513234143495]]

Actual:   [[0, 0, 0.001]]

Expected: [[0, 0, 0.001]]