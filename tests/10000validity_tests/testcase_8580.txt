import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0ELU2304 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0GRU5597 = tf.keras.layers.Input(shape=([2, 2]))

ELU2304 = keras.layers.ELU(alpha=-1.5488421969871862, name = 'ELU2304', input_shape=(1, 2, 2, 2))(in0ELU2304)
Res69986 = keras.layers.Reshape((1, 2, 4), name = 'Res69986', )(ELU2304)
GRU5597 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU5597', )(in0GRU5597)
Res5478 = keras.layers.Reshape((3, 1), name = 'Res5478', )(GRU5597)
Res62193 = keras.layers.Reshape((3, 1, 1), name = 'Res62193', )(Res5478)
Sep36815 = keras.layers.SeparableConv2D(4, (2, 1),strides=(2, 2), padding='valid', name = 'Sep36815', )(Res62193)
Zer33429 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer33429', )(Sep36815)
Add9181 = keras.layers.Add(name = 'Add9181', )([Res69986,Zer33429])
model = tf.keras.models.Model(inputs=[in0ELU2304,in0GRU5597], outputs=Add9181)
w = model.get_layer('GRU5597').get_weights() 
w[0] = np.array([[1, 3, 5, 5, 5, 1, 6, 10, 7], [3, 2, 1, 5, 2, 1, 5, 7, 6]])
w[1] = np.array([[10, 3, 6, 6, 6, 2, 7, 9, 9], [8, 8, 5, 2, 10, 5, 2, 5, 1], [10, 7, 8, 9, 9, 1, 10, 5, 3]])
w[2] = np.array([9, 2, 1, 9, 1, 5, 9, 9, 10])
model.get_layer('GRU5597').set_weights(w) 
w = model.get_layer('Sep36815').get_weights() 
w[0] = np.array([[[[0.5325]]], [[[0.5389]]]])
w[1] = np.array([[[[0.2035, 0.1142, 0.523, 0.7863]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep36815').set_weights(w) 
in0ELU2304 = tf.constant([[[[[0.8074, 0.4543], [0.4955, 0.9366]], [[0.4762, 0.1354], [0.4862, 0.616]]]]])
in0GRU5597 = tf.constant([[[6, 7], [5, 5]]])
print (np.array2string(model.predict([in0ELU2304,in0GRU5597],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add9181.png')

LELU2304 = elu_layer([[[[[0.8074, 0.4543], [0.4955, 0.9366]], [[0.4762, 0.1354], [0.4862, 0.616]]]]], -1.5488421969871862, ELU2304), 
LRes69986 = reshape_layer(ELU2304, [1, 2, 4], Res69986), 
LGRU5597 = gru_layer([[[6, 7], [5, 5]]],[[1, 3, 5, 5, 5, 1, 6, 10, 7], [3, 2, 1, 5, 2, 1, 5, 7, 6]],[[10, 3, 6, 6, 6, 2, 7, 9, 9], [8, 8, 5, 2, 10, 5, 2, 5, 1], [10, 7, 8, 9, 9, 1, 10, 5, 3]],[9, 2, 1, 9, 1, 5, 9, 9, 10], false, GRU5597), 
LRes5478 = reshape_layer(GRU5597, [3, 1], Res5478), 
LRes62193 = reshape_layer(Res5478, [3, 1, 1], Res62193), 
LSep36815 = separable_conv2D_layer(Res62193, 2, 1,[[[[[0.5325]]], [[[0.5389]]]],[[[[0.2035, 0.1142, 0.523, 0.7863]]]]],[0, 0, 0, 0], 2, 2, false, Sep36815), 
LZer33429 = zero_padding2D_layer(Sep36815, 0, 0, 1, 0, Zer33429), 
LAdd9181 = add_layer([Res69986,Zer33429], Add9181), 
exec_layers([LELU2304,LRes69986,LGRU5597,LRes5478,LRes62193,LSep36815,LZer33429,LAdd9181],["ELU2304","Res69986","GRU5597","Res5478","Res62193","Sep36815","Zer33429","Add9181"],Add9181,"Add9181")

Actual (Unparsed): [[[[0.8074000, 0.4543000, 0.4955000, 0.9366000], [0.4762000, 0.1354000, 0.4862000, 0.6160000]]]]

Expected (Unparsed): [[[[0.8074,0.4543,0.4955,0.9366],[0.47620000000023394,0.13540000000013128,0.4862000000006012,0.6160000000009038]]]]

Actual:   [[[[0.8074, 0.4543, 0.4955, 0.9366], [0.4762, 0.1354, 0.4862, 0.616]]]]

Expected: [[[[0.8074, 0.4543, 0.4955, 0.9366], [0.4763, 0.1355, 0.4863, 0.6161]]]]