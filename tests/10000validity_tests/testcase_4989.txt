import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con33024 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Dot1856 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot1856 = tf.keras.layers.Input(shape=([2, 2]))
in0Dot8816 = tf.keras.layers.Input(shape=([3]))
in1Dot8816 = tf.keras.layers.Input(shape=([3]))
in0Con7308 = tf.keras.layers.Input(shape=([3]))
in0Con2159 = tf.keras.layers.Input(shape=([6, 5]))

Con33024 = keras.layers.Conv3D(3, (2, 2, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con33024', )(in0Con33024)
Sof37059 = keras.layers.Softmax(axis=1, name = 'Sof37059', )(Con33024)
Res25234 = keras.layers.Reshape((2, 2, 3), name = 'Res25234', )(Sof37059)
Res7871 = keras.layers.Reshape((2, 6), name = 'Res7871', )(Res25234)
Zer70527 = keras.layers.ZeroPadding1D(padding=((4, 0)), name = 'Zer70527', )(Res7871)
Dot1856 = keras.layers.Dot(axes=(1, 1), name = 'Dot1856', )([in0Dot1856,in1Dot1856])
Res94293 = keras.layers.Reshape((2, 2, 1), name = 'Res94293', )(Dot1856)
Res14319 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res14319', )(Res94293)
Con62882 = keras.layers.Conv3D(2, (2, 2, 1),strides=(1, 6, 3), padding='same', dilation_rate=(1, 1, 1), name = 'Con62882', )(Res14319)
Res65540 = keras.layers.Reshape((2, 1, 2), name = 'Res65540', )(Con62882)
Res94606 = keras.layers.Reshape((2, 2), name = 'Res94606', )(Res65540)
Fla42698 = keras.layers.Flatten(name = 'Fla42698', )(Res94606)
Dot8816 = keras.layers.Dot(axes=(1, 1), name = 'Dot8816', )([in0Dot8816,in1Dot8816])
Con7308 = keras.layers.Concatenate(axis=1, name = 'Con7308', )([Dot8816,in0Con7308])
Sub49802 = keras.layers.Subtract(name = 'Sub49802', )([Fla42698,Con7308])
Res16354 = keras.layers.Reshape((4, 1), name = 'Res16354', )(Sub49802)
Zer4081 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer4081', )(Res16354)
Con2159 = keras.layers.Concatenate(axis=2, name = 'Con2159', )([Zer4081,in0Con2159])
Min74411 = keras.layers.Minimum(name = 'Min74411', )([Zer70527,Con2159])
model = tf.keras.models.Model(inputs=[in0Con33024,in0Dot1856,in1Dot1856,in0Dot8816,in1Dot8816,in0Con7308,in0Con2159], outputs=Min74411)
w = model.get_layer('Con33024').get_weights() 
w[0] = np.array([[[[[0.3749, 0.0047, 0.5048], [0.601, 0.8013, 0.1655]]], [[[0.3171, 0.9741, 0.4286], [0.6863, 0.0068, 0.9511]]]], [[[[0.6928, 0.2776, 0.3843], [0.5231, 0.374, 0.3021]]], [[[0.2933, 0.2886, 0.4405], [0.1121, 0.1161, 0.7986]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con33024').set_weights(w) 
w = model.get_layer('Con62882').get_weights() 
w[0] = np.array([[[[[0.4337, 0.3256]]], [[[0.6015, 0.0462]]]], [[[[0.1881, 0.6096]]], [[[0.3275, 0.6707]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con62882').set_weights(w) 
in0Con33024 = tf.constant([[[[[0.6263, 0.9763]], [[0.5579, 0.3449]]], [[[0.979, 0.4747]], [[0.4004, 0.2235]]]]])
in0Dot1856 = tf.constant([[[0.857, 0.8441], [0.8934, 0.625]]])
in1Dot1856 = tf.constant([[[0.1097, 0.7181], [0.548, 0.2175]]])
in0Dot8816 = tf.constant([[0.0581, 0.3795, 0.4861]])
in1Dot8816 = tf.constant([[0.3016, 0.54, 0.0193]])
in0Con7308 = tf.constant([[0.7392, 0.7845, 0.3279]])
in0Con2159 = tf.constant([[[0.4396, 0.6073, 0.1935, 0.2644, 0.348], [0.1538, 0.3067, 0.2572, 0.0955, 0.145], [0.5386, 0.6917, 0.5882, 0.8788, 0.4627], [0.8071, 0.229, 0.1506, 0.1375, 0.8804], [0.5486, 0.0412, 0.5769, 0.3904, 0.4588], [0.5883, 0.1649, 0.4818, 0.4321, 0.5361]]])
print (np.array2string(model.predict([in0Con33024,in0Dot1856,in1Dot1856,in0Dot8816,in1Dot8816,in0Con7308,in0Con2159],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min74411.png')

LCon33024 = conv3D_layer([[[[[0.6263, 0.9763]], [[0.5579, 0.3449]]], [[[0.979, 0.4747]], [[0.4004, 0.2235]]]]], 2, 2, 1,[[[[[0.3749, 0.0047, 0.5048], [0.601, 0.8013, 0.1655]]], [[[0.3171, 0.9741, 0.4286], [0.6863, 0.0068, 0.9511]]]], [[[[0.6928, 0.2776, 0.3843], [0.5231, 0.374, 0.3021]]], [[[0.2933, 0.2886, 0.4405], [0.1121, 0.1161, 0.7986]]]]],[0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con33024), 
LSof37059 = softmax_layer(Con33024, 1, Sof37059), 
LRes25234 = reshape_layer(Sof37059, [2, 2, 3], Res25234), 
LRes7871 = reshape_layer(Res25234, [2, 6], Res7871), 
LZer70527 = zero_padding1D_layer(Res7871, 4, 0, Zer70527), 
LDot1856 = dot_layer([[[0.857, 0.8441], [0.8934, 0.625]]], [[[0.1097, 0.7181], [0.548, 0.2175]]], 1, 1, Dot1856), 
LRes94293 = reshape_layer(Dot1856, [2, 2, 1], Res94293), 
LRes14319 = reshape_layer(Res94293, [2, 2, 1, 1], Res14319), 
LCon62882 = conv3D_layer(Res14319, 2, 2, 1,[[[[[0.4337, 0.3256]]], [[[0.6015, 0.0462]]]], [[[[0.1881, 0.6096]]], [[[0.3275, 0.6707]]]]],[0, 0], 1, 6, 3, true, 1, 1, 1, Con62882), 
LRes65540 = reshape_layer(Con62882, [2, 1, 2], Res65540), 
LRes94606 = reshape_layer(Res65540, [2, 2], Res94606), 
LFla42698 = flatten_layer(Res94606, Fla42698), 
LDot8816 = dot_layer([[0.0581, 0.3795, 0.4861]], [[0.3016, 0.54, 0.0193]], 1, 1, Dot8816), 
LCon7308 = concatenate_layer([Dot8816,[[0.7392, 0.7845, 0.3279]]], 1, Con7308), 
LSub49802 = subtract_layer(Fla42698,Con7308, Sub49802), 
LRes16354 = reshape_layer(Sub49802, [4, 1], Res16354), 
LZer4081 = zero_padding1D_layer(Res16354, 1, 1, Zer4081), 
LCon2159 = concatenate_layer([Zer4081,[[[0.4396, 0.6073, 0.1935, 0.2644, 0.348], [0.1538, 0.3067, 0.2572, 0.0955, 0.145], [0.5386, 0.6917, 0.5882, 0.8788, 0.4627], [0.8071, 0.229, 0.1506, 0.1375, 0.8804], [0.5486, 0.0412, 0.5769, 0.3904, 0.4588], [0.5883, 0.1649, 0.4818, 0.4321, 0.5361]]]], 2, Con2159), 
LMin74411 = minimum_layer([Zer70527,Con2159], Min74411), 
exec_layers([LCon33024,LSof37059,LRes25234,LRes7871,LZer70527,LDot1856,LRes94293,LRes14319,LCon62882,LRes65540,LRes94606,LFla42698,LDot8816,LCon7308,LSub49802,LRes16354,LZer4081,LCon2159,LMin74411],["Con33024","Sof37059","Res25234","Res7871","Zer70527","Dot1856","Res94293","Res14319","Con62882","Res65540","Res94606","Fla42698","Dot8816","Con7308","Sub49802","Res16354","Zer4081","Con2159","Min74411"],Min74411,"Min74411")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [-0.1494335, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [-0.1519478, 0.5486000, 0.0412000, 0.5769000, 0.3904000, 0.4588000], [0.0000000, 0.2413426, 0.1649000, 0.3713760, 0.4273288, 0.4204343]]]

Expected (Unparsed): [[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[-0.14943354258599995,0,0,0,0,0],[-0.151947806286,0.5486,0.0412,0.5769,0.3904,0.4588],[0,0.24134262587550326,0.1649,0.3713760367091012,0.4273287705589626,0.4204343086049242]]]

Actual:   [[[0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [-0.1494, 0, 0, 0, 0, 0], [-0.1519, 0.5486, 0.0412, 0.5769, 0.3904, 0.4588], [0, 0.2414, 0.1649, 0.3714, 0.4274, 0.4205]]]

Expected: [[[0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [-0.1494, 0, 0, 0, 0, 0], [-0.1519, 0.5486, 0.0412, 0.5769, 0.3904, 0.4588], [0, 0.2414, 0.1649, 0.3714, 0.4274, 0.4205]]]