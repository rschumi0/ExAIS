import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sim24238 = tf.keras.layers.Input(shape=([1, 1]))
in0Con63363 = tf.keras.layers.Input(shape=([2, 3]))
in0Loc27161 = tf.keras.layers.Input(shape=([1, 2]))
in0Ave22722 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave22722 = tf.keras.layers.Input(shape=([2, 1]))
in0Con59991 = tf.keras.layers.Input(shape=([2, 3]))

Sim24238 = keras.layers.SimpleRNN(1,name = 'Sim24238', )(in0Sim24238)
Res60986 = keras.layers.Reshape((1, 1), name = 'Res60986', )(Sim24238)
Zer49632 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer49632', )(Res60986)
Con63363 = keras.layers.Concatenate(axis=2, name = 'Con63363', )([Zer49632,in0Con63363])
Loc27161 = keras.layers.LocallyConnected1D(4, (1),strides=(4), name = 'Loc27161', )(in0Loc27161)
Zer73131 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer73131', )(Loc27161)
Ave22722 = keras.layers.Average(name = 'Ave22722', )([in0Ave22722,in1Ave22722])
Con59991 = keras.layers.Concatenate(axis=2, name = 'Con59991', )([Ave22722,in0Con59991])
Min81262 = keras.layers.Minimum(name = 'Min81262', )([Zer73131,Con59991])
Sub25743 = keras.layers.Subtract(name = 'Sub25743', )([Con63363,Min81262])
model = tf.keras.models.Model(inputs=[in0Sim24238,in0Con63363,in0Loc27161,in0Ave22722,in1Ave22722,in0Con59991], outputs=Sub25743)
w = model.get_layer('Sim24238').get_weights() 
w[0] = np.array([[6]])
w[1] = np.array([[10]])
w[2] = np.array([1])
model.get_layer('Sim24238').set_weights(w) 
w = model.get_layer('Loc27161').get_weights() 
w[0] = np.array([[[0.9847, 0.1789, 0.657, 0.3407], [0.8933, 0.3504, 0.2103, 0.7658]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc27161').set_weights(w) 
in0Sim24238 = tf.constant([[[3]]])
in0Con63363 = tf.constant([[[0.2209, 0.974, 0.2817], [0.0733, 0.4921, 0.4313]]])
in0Loc27161 = tf.constant([[[0.8712, 0.3573]]])
in0Ave22722 = tf.constant([[[0.1373], [0.4811]]])
in1Ave22722 = tf.constant([[[0.626], [0.3495]]])
in0Con59991 = tf.constant([[[0.9528, 0.9579, 0.4588], [0.5279, 0.6814, 0.5109]]])
print (np.array2string(model.predict([in0Sim24238,in0Con63363,in0Loc27161,in0Ave22722,in1Ave22722,in0Con59991],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub25743.png')

LSim24238 = simple_rnn_layer([[[3]]],[[6]],[[10]],[1], Sim24238), 
LRes60986 = reshape_layer(Sim24238, [1, 1], Res60986), 
LZer49632 = zero_padding1D_layer(Res60986, 1, 0, Zer49632), 
LCon63363 = concatenate_layer([Zer49632,[[[0.2209, 0.974, 0.2817], [0.0733, 0.4921, 0.4313]]]], 2, Con63363), 
LLoc27161 = locally_connected1D_layer([[[0.8712, 0.3573]]], 1,[[[0.9847, 0.1789, 0.657, 0.3407], [0.8933, 0.3504, 0.2103, 0.7658]]],[[0, 0, 0, 0]], 4, Loc27161), 
LZer73131 = zero_padding1D_layer(Loc27161, 1, 0, Zer73131), 
LAve22722 = average_layer([[[[0.1373], [0.4811]]], [[[0.626], [0.3495]]]], Ave22722), 
LCon59991 = concatenate_layer([Ave22722,[[[0.9528, 0.9579, 0.4588], [0.5279, 0.6814, 0.5109]]]], 2, Con59991), 
LMin81262 = minimum_layer([Zer73131,Con59991], Min81262), 
LSub25743 = subtract_layer(Con63363,Min81262, Sub25743), 
exec_layers([LSim24238,LRes60986,LZer49632,LCon63363,LLoc27161,LZer73131,LAve22722,LCon59991,LMin81262,LSub25743],["Sim24238","Res60986","Zer49632","Con63363","Loc27161","Zer73131","Ave22722","Con59991","Min81262","Sub25743"],Sub25743,"Sub25743")

Actual (Unparsed): [[[0.0000000, 0.2209000, 0.9740000, 0.2817000], [0.5847000, -0.2077556, -0.1554186, -0.0796000]]]

Expected (Unparsed): [[[0,0.2209,0.974,0.2817],[0.5846999999999999,-0.20775559999999996,-0.15541859000000002,-0.0796]]]

Actual:   [[[0, 0.2209, 0.974, 0.2817], [0.5847, -0.2077, -0.1554, -0.0796]]]

Expected: [[[0, 0.2209, 0.974, 0.2817], [0.5847, -0.2077, -0.1554, -0.0796]]]