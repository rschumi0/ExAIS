import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add91791 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Add91791 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Con50401 = tf.keras.layers.Input(shape=([4, 1, 1, 3]))
in0Zer79495 = tf.keras.layers.Input(shape=([3, 2]))
in0Con90266 = tf.keras.layers.Input(shape=([2, 1, 1, 3]))
in0Con61372 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))

Add91791 = keras.layers.Add(name = 'Add91791', )([in0Add91791,in1Add91791])
Res9019 = keras.layers.Reshape((2, 2, 2), name = 'Res9019', )(Add91791)
Res12391 = keras.layers.Reshape((2, 4), name = 'Res12391', )(Res9019)
Loc45394 = keras.layers.LocallyConnected1D(4, (1),strides=(1), name = 'Loc45394', )(Res12391)
Lay50266 = keras.layers.LayerNormalization(axis=1, epsilon=1.6926427042372763, name = 'Lay50266', )(Loc45394)
Glo32514 = keras.layers.GlobalMaxPool1D(name = 'Glo32514', )(Lay50266)
Res41103 = keras.layers.Reshape((4, 1), name = 'Res41103', )(Glo32514)
Res91648 = keras.layers.Reshape((4, 1, 1), name = 'Res91648', )(Res41103)
Res21570 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res21570', )(Res91648)
Con50401 = keras.layers.Concatenate(axis=4, name = 'Con50401', )([Res21570,in0Con50401])
Zer79495 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer79495', )(in0Zer79495)
Lea34500 = keras.layers.LeakyReLU(alpha=3.826142959664667, name = 'Lea34500', )(Zer79495)
Res37924 = keras.layers.Reshape((5, 2, 1), name = 'Res37924', )(Lea34500)
Res28014 = keras.layers.Reshape((5, 2, 1, 1), name = 'Res28014', )(Res37924)
Glo77683 = keras.layers.GlobalMaxPool3D(name = 'Glo77683', )(Res28014)
Res43687 = keras.layers.Reshape((1, 1), name = 'Res43687', )(Glo77683)
Res73912 = keras.layers.Reshape((1, 1, 1), name = 'Res73912', )(Res43687)
Res41557 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res41557', )(Res73912)
Zer110 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (0, 0)), name = 'Zer110', )(Res41557)
Con90266 = keras.layers.Concatenate(axis=4, name = 'Con90266', )([Zer110,in0Con90266])
Con61372 = keras.layers.Conv3D(4, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con61372', )(in0Con61372)
Sof86359 = keras.layers.Softmax(axis=1, name = 'Sof86359', )(Con61372)
Add68984 = keras.layers.Add(name = 'Add68984', )([Con90266,Sof86359])
Zer57601 = keras.layers.ZeroPadding3D(padding=((2, 0), (0, 0), (0, 0)), name = 'Zer57601', )(Add68984)
Sub31590 = keras.layers.Subtract(name = 'Sub31590', )([Con50401,Zer57601])
model = tf.keras.models.Model(inputs=[in0Add91791,in1Add91791,in0Con50401,in0Zer79495,in0Con90266,in0Con61372], outputs=Sub31590)
w = model.get_layer('Loc45394').get_weights() 
w[0] = np.array([[[0.6939, 0.9169, 0.3113, 0.8585], [0.1642, 0.8536, 0.1848, 0.214], [0.9867, 0.8027, 0.9295, 0.9748], [0.7932, 0.8985, 0.0088, 0.9418]], [[0.7844, 0.1558, 0.7218, 0.3791], [0.1579, 0.0926, 0.2211, 0.1867], [0.6577, 0.1246, 0.7294, 0.3238], [0.7686, 0.7022, 0.3323, 0.3728]]])
w[1] = np.array([[0, 0, 0, 0], [0, 0, 0, 0]])
model.get_layer('Loc45394').set_weights(w) 
w = model.get_layer('Con61372').get_weights() 
w[0] = np.array([[[[[0.026, 0.8687, 0.3636, 0.15], [0.2449, 0.8523, 0.2106, 0.1991]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con61372').set_weights(w) 
in0Add91791 = tf.constant([[[[[0.3465], [0.9954]], [[0.2683], [0.4483]]], [[[0.346], [0.5712]], [[0.1568], [0.4278]]]]])
in1Add91791 = tf.constant([[[[[0.1186], [0.946]], [[0.0094], [0.8044]]], [[[0.9532], [0.0251]], [[0.35], [0.5981]]]]])
in0Con50401 = tf.constant([[[[[0.2122, 0.2988, 0.8621]]], [[[0.4359, 0.549, 0.2581]]], [[[0.9941, 0.249, 0.1782]]], [[[0.3476, 0.7329, 0.6298]]]]])
in0Zer79495 = tf.constant([[[1.8544, 1.5775], [1.8762, 1.152], [1.0259, 1.1713]]])
in0Con90266 = tf.constant([[[[[0.5215, 0.466, 0.8085]]], [[[0.1037, 0.8727, 0.0521]]]]])
in0Con61372 = tf.constant([[[[[0.3636, 0.6703]]], [[[0.4736, 0.6978]]]]])
print (np.array2string(model.predict([in0Add91791,in1Add91791,in0Con50401,in0Zer79495,in0Con90266,in0Con61372],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub31590.png')

LAdd91791 = add_layer([[[[[[0.3465], [0.9954]], [[0.2683], [0.4483]]], [[[0.346], [0.5712]], [[0.1568], [0.4278]]]]], [[[[[0.1186], [0.946]], [[0.0094], [0.8044]]], [[[0.9532], [0.0251]], [[0.35], [0.5981]]]]]], Add91791), 
LRes9019 = reshape_layer(Add91791, [2, 2, 2], Res9019), 
LRes12391 = reshape_layer(Res9019, [2, 4], Res12391), 
LLoc45394 = locally_connected1D_layer(Res12391, 1,[[[0.6939, 0.9169, 0.3113, 0.8585], [0.1642, 0.8536, 0.1848, 0.214], [0.9867, 0.8027, 0.9295, 0.9748], [0.7932, 0.8985, 0.0088, 0.9418]], [[0.7844, 0.1558, 0.7218, 0.3791], [0.1579, 0.0926, 0.2211, 0.1867], [0.6577, 0.1246, 0.7294, 0.3238], [0.7686, 0.7022, 0.3323, 0.3728]]],[[0, 0, 0, 0], [0, 0, 0, 0]], 1, Loc45394), 
LLay50266 = layer_normalization_layer(Loc45394, 1, 1.6926427042372763, Lay50266), 
LGlo32514 = global_max_pool1D_layer(Lay50266, Glo32514), 
LRes41103 = reshape_layer(Glo32514, [4, 1], Res41103), 
LRes91648 = reshape_layer(Res41103, [4, 1, 1], Res91648), 
LRes21570 = reshape_layer(Res91648, [4, 1, 1, 1], Res21570), 
LCon50401 = concatenate_layer([Res21570,[[[[[0.2122, 0.2988, 0.8621]]], [[[0.4359, 0.549, 0.2581]]], [[[0.9941, 0.249, 0.1782]]], [[[0.3476, 0.7329, 0.6298]]]]]], 4, Con50401), 
LZer79495 = zero_padding1D_layer([[[1.8544, 1.5775], [1.8762, 1.152], [1.0259, 1.1713]]], 1, 1, Zer79495), 
LLea34500 = leaky_relu_layer(Zer79495, 3.826142959664667, Lea34500), 
LRes37924 = reshape_layer(Lea34500, [5, 2, 1], Res37924), 
LRes28014 = reshape_layer(Res37924, [5, 2, 1, 1], Res28014), 
LGlo77683 = global_max_pool3D_layer(Res28014, Glo77683), 
LRes43687 = reshape_layer(Glo77683, [1, 1], Res43687), 
LRes73912 = reshape_layer(Res43687, [1, 1, 1], Res73912), 
LRes41557 = reshape_layer(Res73912, [1, 1, 1, 1], Res41557), 
LZer110 = zero_padding3D_layer(Res41557, 1, 0, 0, 0, 0, 0, Zer110), 
LCon90266 = concatenate_layer([Zer110,[[[[[0.5215, 0.466, 0.8085]]], [[[0.1037, 0.8727, 0.0521]]]]]], 4, Con90266), 
LCon61372 = conv3D_layer([[[[[0.3636, 0.6703]]], [[[0.4736, 0.6978]]]]], 1, 1, 1,[[[[[0.026, 0.8687, 0.3636, 0.15], [0.2449, 0.8523, 0.2106, 0.1991]]]]],[0, 0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con61372), 
LSof86359 = softmax_layer(Con61372, 1, Sof86359), 
LAdd68984 = add_layer([Con90266,Sof86359], Add68984), 
LZer57601 = zero_padding3D_layer(Add68984, 2, 0, 0, 0, 0, 0, Zer57601), 
LSub31590 = subtract_layer(Con50401,Zer57601, Sub31590), 
exec_layers([LAdd91791,LRes9019,LRes12391,LLoc45394,LLay50266,LGlo32514,LRes41103,LRes91648,LRes21570,LCon50401,LZer79495,LLea34500,LRes37924,LRes28014,LGlo77683,LRes43687,LRes73912,LRes41557,LZer110,LCon90266,LCon61372,LSof86359,LAdd68984,LZer57601,LSub31590],["Add91791","Res9019","Res12391","Loc45394","Lay50266","Glo32514","Res41103","Res91648","Res21570","Con50401","Zer79495","Lea34500","Res37924","Res28014","Glo77683","Res43687","Res73912","Res41557","Zer110","Con90266","Con61372","Sof86359","Add68984","Zer57601","Sub31590"],Sub31590,"Sub31590")

Actual (Unparsed): [[[[[0.1242842, 0.2122000, 0.2988000, 0.8621000]]], [[[0.6766048, 0.4359000, 0.5490000, 0.2581000]]], [[[-0.1365354, 0.0023137, -0.7055551, -1.1248064]]], [[[-1.9847769, -0.2858137, -0.6512448, 0.0722064]]]]]

Expected (Unparsed): [[[[[0.12428417063765972,0.2122,0.2988,0.8621]]],[[[0.6766048040793414,0.4359,0.549,0.2581]]],[[[-0.1365353844258188,0.0023137588593735714,-0.7055551244406518,-1.124806408574812]]],[[[-1.9847769974830358,-0.28581375885937355,-0.6512448755593482,0.07220640857481175]]]]]

Actual:   [[[[[0.1243, 0.2122, 0.2988, 0.8621]]], [[[0.6767, 0.4359, 0.549, 0.2581]]], [[[-0.1365, 0.0024, -0.7055, -1.1248]]], [[[-1.9847, -0.2858, -0.6512, 0.0723]]]]]

Expected: [[[[[0.1243, 0.2122, 0.2988, 0.8621]]], [[[0.6767, 0.4359, 0.549, 0.2581]]], [[[-0.1365, 0.0024, -0.7055, -1.1248]]], [[[-1.9847, -0.2858, -0.6512, 0.0723]]]]]