import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0GRU13653 = tf.keras.layers.Input(shape=([3, 3]))
in0Con13090 = tf.keras.layers.Input(shape=([2, 4, 2, 1]))
in0Max78166 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Max78166 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))

GRU13653 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU13653', )(in0GRU13653)
Res1814 = keras.layers.Reshape((3, 1), name = 'Res1814', )(GRU13653)
Sep92896 = keras.layers.SeparableConv1D(3, (1),strides=(3), padding='valid', name = 'Sep92896', )(Res1814)
Res37649 = keras.layers.Reshape((1, 3, 1), name = 'Res37649', )(Sep92896)
Res53568 = keras.layers.Reshape((1, 3, 1, 1), name = 'Res53568', )(Res37649)
Zer17861 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (1, 0)), name = 'Zer17861', )(Res53568)
Con13090 = keras.layers.Concatenate(axis=4, name = 'Con13090', )([Zer17861,in0Con13090])
Max78166 = keras.layers.Maximum(name = 'Max78166', )([in0Max78166,in1Max78166])
Zer78591 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer78591', )(Max78166)
Add18007 = keras.layers.Add(name = 'Add18007', )([Con13090,Zer78591])
model = tf.keras.models.Model(inputs=[in0GRU13653,in0Con13090,in0Max78166,in1Max78166], outputs=Add18007)
w = model.get_layer('GRU13653').get_weights() 
w[0] = np.array([[8, 3, 9, 6, 2, 1, 8, 6, 10], [7, 9, 10, 10, 6, 6, 10, 4, 5], [1, 1, 7, 9, 3, 2, 10, 2, 10]])
w[1] = np.array([[8, 9, 9, 6, 6, 8, 4, 7, 6], [2, 2, 10, 8, 3, 3, 5, 6, 3], [5, 7, 4, 8, 7, 4, 6, 3, 8]])
w[2] = np.array([10, 6, 2, 3, 3, 4, 10, 10, 1])
model.get_layer('GRU13653').set_weights(w) 
w = model.get_layer('Sep92896').get_weights() 
w[0] = np.array([[[0.6448]]])
w[1] = np.array([[[0.5009, 0.6186, 0.3073]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep92896').set_weights(w) 
in0GRU13653 = tf.constant([[[3, 9, 10], [6, 5, 7], [6, 9, 10]]])
in0Con13090 = tf.constant([[[[[0.5859], [0.4427]], [[0.088], [0.5442]], [[0.5901], [0.1861]], [[0.4015], [0.4417]]], [[[0.0716], [0.9147]], [[0.5627], [0.9133]], [[0.196], [0.8522]], [[0.3104], [0.0345]]]]])
in0Max78166 = tf.constant([[[[[0.091, 0.8767], [0.0956, 0.6242]], [[0.1771, 0.2757], [0.053, 0.5722]]], [[[0.8542, 0.3794], [0.914, 0.7033]], [[0.5241, 0.8589], [0.0248, 0.3191]]]]])
in1Max78166 = tf.constant([[[[[0.9859, 0.7529], [0.3663, 0.5188]], [[0.3909, 0.4972], [0.475, 0.9082]]], [[[0.2287, 0.4347], [0.3349, 0.9852]], [[0.6694, 0.2069], [0.2894, 0.9874]]]]])
print (np.array2string(model.predict([in0GRU13653,in0Con13090,in0Max78166,in1Max78166],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add18007.png')

LGRU13653 = gru_layer([[[3, 9, 10], [6, 5, 7], [6, 9, 10]]],[[8, 3, 9, 6, 2, 1, 8, 6, 10], [7, 9, 10, 10, 6, 6, 10, 4, 5], [1, 1, 7, 9, 3, 2, 10, 2, 10]],[[8, 9, 9, 6, 6, 8, 4, 7, 6], [2, 2, 10, 8, 3, 3, 5, 6, 3], [5, 7, 4, 8, 7, 4, 6, 3, 8]],[10, 6, 2, 3, 3, 4, 10, 10, 1], false, GRU13653), 
LRes1814 = reshape_layer(GRU13653, [3, 1], Res1814), 
LSep92896 = separable_conv1D_layer(Res1814, 1,[[[[0.6448]]],[[[0.5009, 0.6186, 0.3073]]]],[0, 0, 0], 3, false, Sep92896), 
LRes37649 = reshape_layer(Sep92896, [1, 3, 1], Res37649), 
LRes53568 = reshape_layer(Res37649, [1, 3, 1, 1], Res53568), 
LZer17861 = zero_padding3D_layer(Res53568, 1, 0, 1, 0, 1, 0, Zer17861), 
LCon13090 = concatenate_layer([Zer17861,[[[[[0.5859], [0.4427]], [[0.088], [0.5442]], [[0.5901], [0.1861]], [[0.4015], [0.4417]]], [[[0.0716], [0.9147]], [[0.5627], [0.9133]], [[0.196], [0.8522]], [[0.3104], [0.0345]]]]]], 4, Con13090), 
LMax78166 = maximum_layer([[[[[[0.091, 0.8767], [0.0956, 0.6242]], [[0.1771, 0.2757], [0.053, 0.5722]]], [[[0.8542, 0.3794], [0.914, 0.7033]], [[0.5241, 0.8589], [0.0248, 0.3191]]]]], [[[[[0.9859, 0.7529], [0.3663, 0.5188]], [[0.3909, 0.4972], [0.475, 0.9082]]], [[[0.2287, 0.4347], [0.3349, 0.9852]], [[0.6694, 0.2069], [0.2894, 0.9874]]]]]], Max78166), 
LZer78591 = zero_padding3D_layer(Max78166, 0, 0, 2, 0, 0, 0, Zer78591), 
LAdd18007 = add_layer([Con13090,Zer78591], Add18007), 
exec_layers([LGRU13653,LRes1814,LSep92896,LRes37649,LRes53568,LZer17861,LCon13090,LMax78166,LZer78591,LAdd18007],["GRU13653","Res1814","Sep92896","Res37649","Res53568","Zer17861","Con13090","Max78166","Zer78591","Add18007"],Add18007,"Add18007")

Actual (Unparsed): [[[[[0.0000000, 0.5859000], [0.0000000, 0.4427000]], [[0.0000000, 0.0880000], [0.0000000, 0.5442000]], [[0.9859000, 1.4668000], [0.3663000, 0.8103000]], [[0.3909000, 0.8987000], [0.4750000, 1.3499000]]], [[[0.0000000, 0.0716000], [0.0000000, 0.9147000]], [[0.0000000, 0.5627000], [0.0000000, 0.9133000]], [[0.8542000, 0.6307000], [0.9140000, 1.8374000]], [[0.6694000, 1.1693000], [0.2894000, 1.0219000]]]]]

Expected (Unparsed): [[[[[0,0.5859],[0,0.4427]],[[0,0.088],[0,0.5442]],[[0.9859,1.4668],[0.3663,0.8103]],[[0.3909,0.8987],[0.475,1.3498999999999999]]],[[[0,0.0716],[0,0.9147]],[[0,0.5627],[0.0,0.9133]],[[0.8542,0.6307],[0.914,1.8374]],[[0.6694,1.1693],[0.2894,1.0219]]]]]

Actual:   [[[[[0, 0.5859], [0, 0.4427]], [[0, 0.088], [0, 0.5442]], [[0.9859, 1.4668], [0.3663, 0.8103]], [[0.3909, 0.8987], [0.475, 1.3499]]], [[[0, 0.0716], [0, 0.9147]], [[0, 0.5627], [0, 0.9133]], [[0.8542, 0.6307], [0.914, 1.8374]], [[0.6694, 1.1693], [0.2894, 1.0219]]]]]

Expected: [[[[[0, 0.5859], [0, 0.4427]], [[0, 0.088], [0, 0.5442]], [[0.9859, 1.4668], [0.3663, 0.8103]], [[0.3909, 0.8987], [0.475, 1.3499]]], [[[0, 0.0716], [0, 0.9147]], [[0, 0.5627], [0, 0.9133]], [[0.8542, 0.6307], [0.914, 1.8374]], [[0.6694, 1.1693], [0.2894, 1.0219]]]]]