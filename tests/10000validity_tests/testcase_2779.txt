import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc23380 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con62180 = tf.keras.layers.Input(shape=([1, 2]))
in0GRU47267 = tf.keras.layers.Input(shape=([1, 3]))

Loc23380 = keras.layers.LocallyConnected2D(2, (1, 1),strides=(12, 11), name = 'Loc23380', )(in0Loc23380)
Res68443 = keras.layers.Reshape((1, 2), name = 'Res68443', )(Loc23380)
Con62180 = keras.layers.Concatenate(axis=2, name = 'Con62180', )([Res68443,in0Con62180])
GRU47267 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU47267', )(in0GRU47267)
Res64147 = keras.layers.Reshape((3, 1), name = 'Res64147', )(GRU47267)
Res31927 = keras.layers.Reshape((3, 1, 1), name = 'Res31927', )(Res64147)
Res40456 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res40456', )(Res31927)
Con88131 = keras.layers.Conv3D(4, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con88131', )(Res40456)
Res37117 = keras.layers.Reshape((3, 1, 4), name = 'Res37117', )(Con88131)
Res50067 = keras.layers.Reshape((3, 4), name = 'Res50067', )(Res37117)
Dot23253 = keras.layers.Dot(axes=(2, 2), name = 'Dot23253', )([Con62180,Res50067])
model = tf.keras.models.Model(inputs=[in0Loc23380,in0Con62180,in0GRU47267], outputs=Dot23253)
w = model.get_layer('Loc23380').get_weights() 
w[0] = np.array([[[0.3486, 0.1628], [0.1196, 0.165]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc23380').set_weights(w) 
w = model.get_layer('GRU47267').get_weights() 
w[0] = np.array([[4, 9, 5, 9, 3, 7, 7, 10, 5], [1, 5, 6, 6, 7, 9, 6, 1, 2], [8, 1, 10, 7, 6, 8, 1, 9, 5]])
w[1] = np.array([[1, 9, 4, 8, 4, 4, 7, 6, 3], [5, 5, 10, 6, 4, 1, 2, 10, 4], [1, 3, 4, 10, 8, 1, 6, 9, 6]])
w[2] = np.array([[7, 2, 3, 8, 1, 1, 8, 9, 6], [3, 2, 3, 8, 8, 5, 2, 9, 6]])
model.get_layer('GRU47267').set_weights(w) 
w = model.get_layer('Con88131').get_weights() 
w[0] = np.array([[[[[0.9213, 0.959, 0.4773, 0.375]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con88131').set_weights(w) 
in0Loc23380 = tf.constant([[[[0.5949, 0.1]]]])
in0Con62180 = tf.constant([[[0.1415, 0.1317]]])
in0GRU47267 = tf.constant([[[9, 8, 10]]])
print (np.array2string(model.predict([in0Loc23380,in0Con62180,in0GRU47267],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot23253.png')

LLoc23380 = locally_connected2D_layer([[[[0.5949, 0.1]]]], 1, 1,[[[0.3486, 0.1628], [0.1196, 0.165]]],[[[0, 0]]], 12, 11, Loc23380), 
LRes68443 = reshape_layer(Loc23380, [1, 2], Res68443), 
LCon62180 = concatenate_layer([Res68443,[[[0.1415, 0.1317]]]], 2, Con62180), 
LGRU47267 = gru_layer([[[9, 8, 10]]],[[4, 9, 5, 9, 3, 7, 7, 10, 5], [1, 5, 6, 6, 7, 9, 6, 1, 2], [8, 1, 10, 7, 6, 8, 1, 9, 5]],[[1, 9, 4, 8, 4, 4, 7, 6, 3], [5, 5, 10, 6, 4, 1, 2, 10, 4], [1, 3, 4, 10, 8, 1, 6, 9, 6]],[[7, 2, 3, 8, 1, 1, 8, 9, 6], [3, 2, 3, 8, 8, 5, 2, 9, 6]], true, GRU47267), 
LRes64147 = reshape_layer(GRU47267, [3, 1], Res64147), 
LRes31927 = reshape_layer(Res64147, [3, 1, 1], Res31927), 
LRes40456 = reshape_layer(Res31927, [3, 1, 1, 1], Res40456), 
LCon88131 = conv3D_layer(Res40456, 1, 1, 1,[[[[[0.9213, 0.959, 0.4773, 0.375]]]]],[0, 0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con88131), 
LRes37117 = reshape_layer(Con88131, [3, 1, 4], Res37117), 
LRes50067 = reshape_layer(Res37117, [3, 4], Res50067), 
LDot23253 = dot_layer(Con62180,Res50067, 2, 2, Dot23253), 
exec_layers([LLoc23380,LRes68443,LCon62180,LGRU47267,LRes64147,LRes31927,LRes40456,LCon88131,LRes37117,LRes50067,LDot23253],["Loc23380","Res68443","Con62180","GRU47267","Res64147","Res31927","Res40456","Con88131","Res37117","Res50067","Dot23253"],Dot23253,"Dot23253")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000]]]

Expected (Unparsed): [[[0.0,0.0,0.0]]]

Actual:   [[[0, 0, 0]]]

Expected: [[[0, 0, 0]]]