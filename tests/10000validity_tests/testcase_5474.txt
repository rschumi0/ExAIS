import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add89904 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Add89904 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Min20645 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Min20645 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con27585 = tf.keras.layers.Input(shape=([3, 5, 1, 1]))
in0LST58137 = tf.keras.layers.Input(shape=([1, 1]))
in0Con66431 = tf.keras.layers.Input(shape=([3, 5, 1, 1]))
in0Sub81608 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub81608 = tf.keras.layers.Input(shape=([2, 2]))

Add89904 = keras.layers.Add(name = 'Add89904', )([in0Add89904,in1Add89904])
Min20645 = keras.layers.Minimum(name = 'Min20645', )([in0Min20645,in1Min20645])
Zer44707 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer44707', )(Min20645)
Max42748 = keras.layers.Maximum(name = 'Max42748', )([Add89904,Zer44707])
Max86755 = keras.layers.MaxPool2D(pool_size=(1, 2), name = 'Max86755', )(Max42748)
Res15337 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res15337', )(Max86755)
Zer3978 = keras.layers.ZeroPadding3D(padding=((1, 0), (4, 0), (0, 0)), name = 'Zer3978', )(Res15337)
Con27585 = keras.layers.Concatenate(axis=4, name = 'Con27585', )([Zer3978,in0Con27585])
LST58137 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST58137', )(in0LST58137)
Res97114 = keras.layers.Reshape((3, 1), name = 'Res97114', )(LST58137)
Res78663 = keras.layers.Reshape((3, 1, 1), name = 'Res78663', )(Res97114)
Res23406 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res23406', )(Res78663)
Zer28058 = keras.layers.ZeroPadding3D(padding=((0, 0), (4, 0), (0, 0)), name = 'Zer28058', )(Res23406)
Con66431 = keras.layers.Concatenate(axis=4, name = 'Con66431', )([Zer28058,in0Con66431])
Sub81608 = keras.layers.Subtract(name = 'Sub81608', )([in0Sub81608,in1Sub81608])
Res5847 = keras.layers.Reshape((2, 2, 1), name = 'Res5847', )(Sub81608)
Res69783 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res69783', )(Res5847)
Con48195 = keras.layers.Conv3DTranspose(2, (1, 2, 1),strides=(1, 1, 1), padding='valid', name = 'Con48195', )(Res69783)
Zer87328 = keras.layers.ZeroPadding3D(padding=((1, 0), (2, 0), (0, 0)), name = 'Zer87328', )(Con48195)
Sub54892 = keras.layers.Subtract(name = 'Sub54892', )([Con66431,Zer87328])
Max24757 = keras.layers.Maximum(name = 'Max24757', )([Con27585,Sub54892])
model = tf.keras.models.Model(inputs=[in0Add89904,in1Add89904,in0Min20645,in1Min20645,in0Con27585,in0LST58137,in0Con66431,in0Sub81608,in1Sub81608], outputs=Max24757)
w = model.get_layer('LST58137').get_weights() 
w[0] = np.array([[7, 3, 3, 9, 5, 5, 6, 1, 7, 2, 9, 6]])
w[1] = np.array([[8, 5, 4, 5, 6, 6, 7, 8, 3, 3, 1, 6], [4, 9, 4, 9, 5, 4, 2, 8, 3, 7, 7, 8], [9, 2, 3, 7, 4, 3, 1, 2, 3, 2, 6, 2]])
w[2] = np.array([10, 8, 4, 5, 10, 3, 2, 7, 5, 7, 5, 8])
model.get_layer('LST58137').set_weights(w) 
w = model.get_layer('Con48195').get_weights() 
w[0] = np.array([[[[[0.9643], [0.1601]]], [[[0.4702], [0.0503]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con48195').set_weights(w) 
in0Add89904 = tf.constant([[[[0.5569], [0.1845]], [[0.6457], [0.2818]]]])
in1Add89904 = tf.constant([[[[0.574], [0.6459]], [[0.6267], [0.7427]]]])
in0Min20645 = tf.constant([[[[0.6256]]]])
in1Min20645 = tf.constant([[[[0.2034]]]])
in0Con27585 = tf.constant([[[[[0.2257]], [[0.4659]], [[0.1206]], [[0.3861]], [[0.4309]]], [[[0.286]], [[0.1129]], [[0.3618]], [[0.1938]], [[0.8614]]], [[[0.0409]], [[0.2729]], [[0.3935]], [[0.5859]], [[0.0346]]]]])
in0LST58137 = tf.constant([[[2]]])
in0Con66431 = tf.constant([[[[[0.9043]], [[0.8121]], [[0.0455]], [[0.3283]], [[0.6731]]], [[[0.7436]], [[0.8621]], [[0.0539]], [[0.8589]], [[0.4358]]], [[[0.774]], [[0.0706]], [[0.6976]], [[0.6625]], [[0.1943]]]]])
in0Sub81608 = tf.constant([[[0.8909, 0.078], [0.8291, 0.1825]]])
in1Sub81608 = tf.constant([[[0.8564, 0.2992], [0.0545, 0.3812]]])
print (np.array2string(model.predict([in0Add89904,in1Add89904,in0Min20645,in1Min20645,in0Con27585,in0LST58137,in0Con66431,in0Sub81608,in1Sub81608],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max24757.png')

LAdd89904 = add_layer([[[[[0.5569], [0.1845]], [[0.6457], [0.2818]]]], [[[[0.574], [0.6459]], [[0.6267], [0.7427]]]]], Add89904), 
LMin20645 = minimum_layer([[[[[0.6256]]]], [[[[0.2034]]]]], Min20645), 
LZer44707 = zero_padding2D_layer(Min20645, 1, 0, 1, 0, Zer44707), 
LMax42748 = maximum_layer([Add89904,Zer44707], Max42748), 
LMax86755 = max_pool2D_layer(Max42748, 1, 2, Max86755), 
LRes15337 = reshape_layer(Max86755, [2, 1, 1, 1], Res15337), 
LZer3978 = zero_padding3D_layer(Res15337, 1, 0, 4, 0, 0, 0, Zer3978), 
LCon27585 = concatenate_layer([Zer3978,[[[[[0.2257]], [[0.4659]], [[0.1206]], [[0.3861]], [[0.4309]]], [[[0.286]], [[0.1129]], [[0.3618]], [[0.1938]], [[0.8614]]], [[[0.0409]], [[0.2729]], [[0.3935]], [[0.5859]], [[0.0346]]]]]], 4, Con27585), 
LLST58137 = lstm_layer([[[2]]],[[7, 3, 3, 9, 5, 5, 6, 1, 7, 2, 9, 6]],[[8, 5, 4, 5, 6, 6, 7, 8, 3, 3, 1, 6], [4, 9, 4, 9, 5, 4, 2, 8, 3, 7, 7, 8], [9, 2, 3, 7, 4, 3, 1, 2, 3, 2, 6, 2]],[10, 8, 4, 5, 10, 3, 2, 7, 5, 7, 5, 8], LST58137), 
LRes97114 = reshape_layer(LST58137, [3, 1], Res97114), 
LRes78663 = reshape_layer(Res97114, [3, 1, 1], Res78663), 
LRes23406 = reshape_layer(Res78663, [3, 1, 1, 1], Res23406), 
LZer28058 = zero_padding3D_layer(Res23406, 0, 0, 4, 0, 0, 0, Zer28058), 
LCon66431 = concatenate_layer([Zer28058,[[[[[0.9043]], [[0.8121]], [[0.0455]], [[0.3283]], [[0.6731]]], [[[0.7436]], [[0.8621]], [[0.0539]], [[0.8589]], [[0.4358]]], [[[0.774]], [[0.0706]], [[0.6976]], [[0.6625]], [[0.1943]]]]]], 4, Con66431), 
LSub81608 = subtract_layer([[[0.8909, 0.078], [0.8291, 0.1825]]], [[[0.8564, 0.2992], [0.0545, 0.3812]]], Sub81608), 
LRes5847 = reshape_layer(Sub81608, [2, 2, 1], Res5847), 
LRes69783 = reshape_layer(Res5847, [2, 2, 1, 1], Res69783), 
LCon48195 = conv3D_transpose_layer(Res69783, 1, 2, 1,[[[[[0.9643], [0.1601]]], [[[0.4702], [0.0503]]]]],[0, 0], 1, 1, 1, false, Con48195), 
LZer87328 = zero_padding3D_layer(Con48195, 1, 0, 2, 0, 0, 0, Zer87328), 
LSub54892 = subtract_layer(Con66431,Zer87328, Sub54892), 
LMax24757 = maximum_layer([Con27585,Sub54892], Max24757), 
exec_layers([LAdd89904,LMin20645,LZer44707,LMax42748,LMax86755,LRes15337,LZer3978,LCon27585,LLST58137,LRes97114,LRes78663,LRes23406,LZer28058,LCon66431,LSub81608,LRes5847,LRes69783,LCon48195,LZer87328,LSub54892,LMax24757],["Add89904","Min20645","Zer44707","Max42748","Max86755","Res15337","Zer3978","Con27585","LST58137","Res97114","Res78663","Res23406","Zer28058","Con66431","Sub81608","Res5847","Res69783","Con48195","Zer87328","Sub54892","Max24757"],Max24757,"Max24757")

Actual (Unparsed): [[[[[0.0000000, 0.9043000]], [[0.0000000, 0.8121000]], [[0.0000000, 0.1206000]], [[0.0000000, 0.3861000]], [[0.7615814, 0.6731000]]], [[[0.0000000, 0.7436000]], [[0.0000000, 0.8621000]], [[0.0000000, 0.3618000]], [[0.1970813, 0.8925788]], [[1.1309000, 0.8614000]]], [[[0.0000000, 0.7740000]], [[0.0000000, 0.2729000]], [[0.0000000, 0.5735865]], [[0.0000000, 0.6553495]], [[1.2724000, 0.2042946]]]]]

Expected (Unparsed): [[[[[0,0.9043]],[[0,0.8121]],[[0,0.1206]],[[0,0.3861]],[[0.7615814362340542,0.6731]]],[[[0,0.7436]],[[0,0.8621]],[[0,0.3618]],[[0.19708126000000004,0.89257877]],[[1.1309,0.8614]]],[[[0,0.774]],[[0,0.2729]],[[0,0.57358654]],[[0,0.65534949]],[[1.2724000000000002,0.20429461]]]]]

Actual:   [[[[[0, 0.9043]], [[0, 0.8121]], [[0, 0.1206]], [[0, 0.3861]], [[0.7616, 0.6731]]], [[[0, 0.7436]], [[0, 0.8621]], [[0, 0.3618]], [[0.1971, 0.8926]], [[1.1309, 0.8614]]], [[[0, 0.774]], [[0, 0.2729]], [[0, 0.5736]], [[0, 0.6554]], [[1.2724, 0.2043]]]]]

Expected: [[[[[0, 0.9043]], [[0, 0.8121]], [[0, 0.1206]], [[0, 0.3861]], [[0.7616, 0.6731]]], [[[0, 0.7436]], [[0, 0.8621]], [[0, 0.3618]], [[0.1971, 0.8926]], [[1.1309, 0.8614]]], [[[0, 0.774]], [[0, 0.2729]], [[0, 0.5736]], [[0, 0.6554]], [[1.2725, 0.2043]]]]]