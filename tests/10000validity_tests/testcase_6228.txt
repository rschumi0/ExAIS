import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave18979 = tf.keras.layers.Input(shape=([1, 1]))
in1Ave18979 = tf.keras.layers.Input(shape=([1, 1]))
in0Con88142 = tf.keras.layers.Input(shape=([8]))
in0Per40042 = tf.keras.layers.Input(shape=([4, 3]))

Ave18979 = keras.layers.Average(name = 'Ave18979', )([in0Ave18979,in1Ave18979])
Res56541 = keras.layers.Reshape((1, 1, 1), name = 'Res56541', )(Ave18979)
Res50274 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res50274', )(Res56541)
Con51245 = keras.layers.Conv3D(4, (1, 1, 1),strides=(3, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con51245', )(Res50274)
Res42071 = keras.layers.Reshape((1, 1, 4), name = 'Res42071', )(Con51245)
Res7964 = keras.layers.Reshape((1, 4), name = 'Res7964', )(Res42071)
Fla77773 = keras.layers.Flatten(name = 'Fla77773', )(Res7964)
Con88142 = keras.layers.Concatenate(axis=1, name = 'Con88142', )([Fla77773,in0Con88142])
Per40042 = keras.layers.Permute((1,2), name = 'Per40042',)(in0Per40042)
Fla83645 = keras.layers.Flatten(name = 'Fla83645', )(Per40042)
Dot61119 = keras.layers.Dot(axes=(1, 1), name = 'Dot61119', )([Con88142,Fla83645])
Res70371 = keras.layers.Reshape((1, 1), name = 'Res70371', )(Dot61119)
Per33838 = keras.layers.Permute((2,1), name = 'Per33838',)(Res70371)
model = tf.keras.models.Model(inputs=[in0Ave18979,in1Ave18979,in0Con88142,in0Per40042], outputs=Per33838)
w = model.get_layer('Con51245').get_weights() 
w[0] = np.array([[[[[0.5346, 0.4457, 0.0654, 0.6206]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con51245').set_weights(w) 
in0Ave18979 = tf.constant([[[0.6737]]])
in1Ave18979 = tf.constant([[[0.8344]]])
in0Con88142 = tf.constant([[0.0124, 0.9404, 0.3998, 0.8721, 0.5258, 0.0039, 0.0571, 0.0167]])
in0Per40042 = tf.constant([[[1.4639, 1.9424, 1.8993], [1.8533, 1.3095, 1.1916], [1.9788, 1.7059, 1.5562], [1.6632, 1.049, 1.1642]]])
print (np.array2string(model.predict([in0Ave18979,in1Ave18979,in0Con88142,in0Per40042],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Per33838.png')

LAve18979 = average_layer([[[[0.6737]]], [[[0.8344]]]], Ave18979), 
LRes56541 = reshape_layer(Ave18979, [1, 1, 1], Res56541), 
LRes50274 = reshape_layer(Res56541, [1, 1, 1, 1], Res50274), 
LCon51245 = conv3D_layer(Res50274, 1, 1, 1,[[[[[0.5346, 0.4457, 0.0654, 0.6206]]]]],[0, 0, 0, 0], 3, 1, 1, true, 1, 1, 1, Con51245), 
LRes42071 = reshape_layer(Con51245, [1, 1, 4], Res42071), 
LRes7964 = reshape_layer(Res42071, [1, 4], Res7964), 
LFla77773 = flatten_layer(Res7964, Fla77773), 
LCon88142 = concatenate_layer([Fla77773,[[0.0124, 0.9404, 0.3998, 0.8721, 0.5258, 0.0039, 0.0571, 0.0167]]], 1, Con88142), 
LPer40042 = permute_layer([[[1.4639, 1.9424, 1.8993], [1.8533, 1.3095, 1.1916], [1.9788, 1.7059, 1.5562], [1.6632, 1.049, 1.1642]]], 1,2, Per40042), 
LFla83645 = flatten_layer(Per40042, Fla83645), 
LDot61119 = dot_layer(Con88142,Fla83645, 1, 1, Dot61119), 
LRes70371 = reshape_layer(Dot61119, [1, 1], Res70371), 
LPer33838 = permute_layer(Res70371, 2,1, Per33838), 
exec_layers([LAve18979,LRes56541,LRes50274,LCon51245,LRes42071,LRes7964,LFla77773,LCon88142,LPer40042,LFla83645,LDot61119,LRes70371,LPer33838],["Ave18979","Res56541","Res50274","Con51245","Res42071","Res7964","Fla77773","Con88142","Per40042","Fla83645","Dot61119","Res70371","Per33838"],Per33838,"Per33838")

Actual (Unparsed): [[[6.5235970]]]

Expected (Unparsed): [[[6.523597103321]]]

Actual:   [[[6.5236]]]

Expected: [[[6.5236]]]