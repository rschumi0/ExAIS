import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min96770 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Min96770 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Con78791 = tf.keras.layers.Input(shape=([3, 2]))
in0Mas35622 = tf.keras.layers.Input(shape=([3, 4]))

Min96770 = keras.layers.Minimum(name = 'Min96770', )([in0Min96770,in1Min96770])
Res5781 = keras.layers.Reshape((2, 1, 2), name = 'Res5781', )(Min96770)
Res3289 = keras.layers.Reshape((2, 2), name = 'Res3289', )(Res5781)
Zer81782 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer81782', )(Res3289)
Con78791 = keras.layers.Concatenate(axis=2, name = 'Con78791', )([Zer81782,in0Con78791])
Mas35622 = keras.layers.Masking(mask_value=2, name = 'Mas35622', )(in0Mas35622)
Sub90330 = keras.layers.Subtract(name = 'Sub90330', )([Con78791,Mas35622])
Res28526 = keras.layers.Reshape((3, 4, 1), name = 'Res28526', )(Sub90330)
Con7956 = keras.layers.Conv2DTranspose(2, (3, 3),strides=(4, 1), padding='valid', name = 'Con7956', )(Res28526)
model = tf.keras.models.Model(inputs=[in0Min96770,in1Min96770,in0Con78791,in0Mas35622], outputs=Con7956)
w = model.get_layer('Con7956').get_weights() 
w[0] = np.array([[[[0.5732], [0.5484]], [[0.6717], [0.1659]], [[0.138], [0.2491]]], [[[0.7261], [0.9412]], [[0.4335], [0.2406]], [[0.2594], [0.9089]]], [[[0.2131], [0.2587]], [[0.2507], [0.322]], [[0.531], [0.9249]]]])
w[1] = np.array([0, 0])
model.get_layer('Con7956').set_weights(w) 
in0Min96770 = tf.constant([[[[[0.7012], [0.3939]]], [[[0.5017], [0.0237]]]]])
in1Min96770 = tf.constant([[[[[0.9652], [0.9783]]], [[[0.4403], [0.5361]]]]])
in0Con78791 = tf.constant([[[0.4241, 0.9345], [0.1578, 0.0155], [0.0657, 0.9362]]])
in0Mas35622 = tf.constant([[[1.6349, 1.9924, 1.4977, 1.6561], [1.232, 1.2011, 1.0475, 1.6271], [1.2794, 1.1463, 1.89, 1.4677]]])
print (np.array2string(model.predict([in0Min96770,in1Min96770,in0Con78791,in0Mas35622],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con7956.png')

LMin96770 = minimum_layer([[[[[[0.7012], [0.3939]]], [[[0.5017], [0.0237]]]]], [[[[[0.9652], [0.9783]]], [[[0.4403], [0.5361]]]]]], Min96770), 
LRes5781 = reshape_layer(Min96770, [2, 1, 2], Res5781), 
LRes3289 = reshape_layer(Res5781, [2, 2], Res3289), 
LZer81782 = zero_padding1D_layer(Res3289, 1, 0, Zer81782), 
LCon78791 = concatenate_layer([Zer81782,[[[0.4241, 0.9345], [0.1578, 0.0155], [0.0657, 0.9362]]]], 2, Con78791), 
LMas35622 = masking_layer([[[1.6349, 1.9924, 1.4977, 1.6561], [1.232, 1.2011, 1.0475, 1.6271], [1.2794, 1.1463, 1.89, 1.4677]]], 2, Mas35622), 
LSub90330 = subtract_layer(Con78791,Mas35622, Sub90330), 
LRes28526 = reshape_layer(Sub90330, [3, 4, 1], Res28526), 
LCon7956 = conv2D_transpose_layer(Res28526, 3, 3,[[[[0.5732], [0.5484]], [[0.6717], [0.1659]], [[0.138], [0.2491]]], [[[0.7261], [0.9412]], [[0.4335], [0.2406]], [[0.2594], [0.9089]]], [[[0.2131], [0.2587]], [[0.2507], [0.322]], [[0.531], [0.9249]]]],[0, 0], 4, 1, false, Con7956), 
exec_layers([LMin96770,LRes5781,LRes3289,LZer81782,LCon78791,LMas35622,LSub90330,LRes28526,LCon7956],["Min96770","Res5781","Res3289","Zer81782","Con78791","Mas35622","Sub90330","Res28526","Con7956"],Con7956,"Con7956")

Actual (Unparsed): [[[[-0.9371247, -0.8965791], [-2.2402060, -1.3638621], [-2.1792988, -1.3265550], [-1.4097095, -1.0701426], [-0.6328556, -0.3871472], [-0.0995808, -0.1797506]], [[-1.1871009, -1.5387679], [-2.1554108, -2.2686039], [-2.0673394, -2.9758043], [-1.5061880, -2.7483705], [-0.5913055, -1.1494120], [-0.1871831, -0.6558623]], [[-0.3483972, -0.4229486], [-0.8344499, -1.0418717], [-1.5964107, -2.4314121], [-1.4808889, -2.3751479], [-0.7509867, -1.2253278], [-0.3831696, -0.6674079]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[-0.3042546, -0.2910907], [-0.8192254, -0.5307282], [-1.1254227, -0.7540482], [-1.6327742, -1.2324762], [-1.2052903, -0.4889887], [-0.2224008, -0.4014496]], [[-0.3854139, -0.4995889], [-0.8162097, -0.8874471], [-1.1336219, -1.5140421], [-1.7652554, -2.4645638], [-0.9294168, -1.1963993], [-0.4180490, -1.4647832]], [[-0.1131135, -0.1373180], [-0.3050859, -0.3797402], [-0.6738149, -0.9810207], [-0.9951029, -1.4499836], [-0.8764588, -1.3418187], [-0.8557596, -1.4905688]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[-0.4809721, -0.4601624], [-1.2070978, -0.7548405], [-1.9155349, -1.3957053], [-1.6849569, -0.8737656], [-0.6087619, -0.5426090], [-0.0733470, -0.1323966]], [[-0.6092705, -0.7897609], [-1.1788697, -1.2584785], [-2.0289338, -2.7497867], [-1.4679586, -1.9595055], [-0.7036287, -1.7859852], [-0.1378711, -0.4830803]], [[-0.1788122, -0.2170752], [-0.4495884, -0.5606068], [-1.1157562, -1.6095072], [-1.1667152, -1.7632163], [-1.1019503, -1.8584380], [-0.2822265, -0.4915843]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]]]]

Expected (Unparsed): [[[[-0.93712468,-0.89657916],[-2.2402060099999996,-1.36386207],[-2.1792987999999998,-1.32655499],[-1.40970944,-1.0701425199999999],[-0.6328555199999999,-0.3871472],[-0.0995808,-0.17975055999999998]],[[-1.18710089,-1.53876788],[-2.15541079,-2.26860382],[-2.0673394199999997,-2.97580437],[-1.50618792,-2.74837044],[-0.59130544,-1.149412],[-0.18718304,-0.6558622399999999]],[[-0.34839719,-0.42294863],[-0.83444987,-1.04187168],[-1.59641074,-2.43141213],[-1.4808888800000002,-2.37514788],[-0.75098672,-1.2253278400000003],[-0.38316959999999994,-0.66740784]],[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],[[-0.30425456,-0.29109071999999997],[-0.8192254000000001,-0.5307282000000001],[-1.1254226800000002,-0.75404824],[-1.63277421,-1.2324761899999999],[-1.2052903199999998,-0.48898871],[-0.2224008,-0.40144956]],[[-0.38541387999999993,-0.49958895999999997],[-0.81620972,-0.8874471200000001],[-1.1336218900000001,-1.5140420800000003],[-1.76525539,-2.4645638200000004],[-0.9294167799999999,-1.19639929],[-0.41804904000000004,-1.46478324]],[[-0.11311347999999999,-0.13731796],[-0.30508588000000003,-0.37974024],[-0.6738149099999999,-0.9810207100000001],[-0.9951029500000002,-1.4499836000000002],[-0.8764588200000001,-1.3418187300000002],[-0.8557596,-1.4905688400000001]],[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],[[-0.48097212000000006,-0.46016244000000006],[-1.2070977900000002,-0.75484053],[-1.9155349799999999,-1.3957052699999999],[-1.68495691,-0.8737656299999998],[-0.60876195,-0.5426089799999999],[-0.073347,-0.13239664999999998]],[[-0.60927051,-0.7897609200000001],[-1.17886971,-1.25847858],[-2.02893387,-2.74978671],[-1.46795864,-1.95950552],[-0.70362867,-1.78598517],[-0.1378711,-0.48308035]],[[-0.17881221000000003,-0.21707517],[-0.44958843000000004,-0.5606068200000001],[-1.11575625,-1.6095072000000001],[-1.16671526,-1.76321639],[-1.1019503499999999,-1.85843807],[-0.2822265,-0.49158435]],[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]]]]

Actual:   [[[[-0.9371, -0.8965], [-2.2402, -1.3638], [-2.1792, -1.3265], [-1.4097, -1.0701], [-0.6328, -0.3871], [-0.0995, -0.1797]], [[-1.1871, -1.5387], [-2.1554, -2.2686], [-2.0673, -2.9758], [-1.5061, -2.7483], [-0.5913, -1.1494], [-0.1871, -0.6558]], [[-0.3483, -0.4229], [-0.8344, -1.0418], [-1.5964, -2.4314], [-1.4808, -2.3751], [-0.7509, -1.2253], [-0.3831, -0.6674]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[-0.3042, -0.291], [-0.8192, -0.5307], [-1.1254, -0.754], [-1.6327, -1.2324], [-1.2052, -0.4889], [-0.2224, -0.4014]], [[-0.3854, -0.4995], [-0.8162, -0.8874], [-1.1336, -1.514], [-1.7652, -2.4645], [-0.9294, -1.1963], [-0.418, -1.4647]], [[-0.1131, -0.1373], [-0.305, -0.3797], [-0.6738, -0.981], [-0.9951, -1.4499], [-0.8764, -1.3418], [-0.8557, -1.4905]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[-0.4809, -0.4601], [-1.207, -0.7548], [-1.9155, -1.3957], [-1.6849, -0.8737], [-0.6087, -0.5426], [-0.0733, -0.1323]], [[-0.6092, -0.7897], [-1.1788, -1.2584], [-2.0289, -2.7497], [-1.4679, -1.9595], [-0.7036, -1.7859], [-0.1378, -0.483]], [[-0.1788, -0.217], [-0.4495, -0.5606], [-1.1157, -1.6095], [-1.1667, -1.7632], [-1.1019, -1.8584], [-0.2822, -0.4915]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]]]

Expected: [[[[-0.9371, -0.8965], [-2.2402, -1.3638], [-2.1792, -1.3265], [-1.4097, -1.0701], [-0.6328, -0.3871], [-0.0995, -0.1797]], [[-1.1871, -1.5387], [-2.1554, -2.2686], [-2.0673, -2.9758], [-1.5061, -2.7483], [-0.5913, -1.1494], [-0.1871, -0.6558]], [[-0.3483, -0.4229], [-0.8344, -1.0418], [-1.5964, -2.4314], [-1.4808, -2.3751], [-0.7509, -1.2253], [-0.3831, -0.6674]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[-0.3042, -0.291], [-0.8192, -0.5307], [-1.1254, -0.754], [-1.6327, -1.2324], [-1.2052, -0.4889], [-0.2224, -0.4014]], [[-0.3854, -0.4995], [-0.8162, -0.8874], [-1.1336, -1.514], [-1.7652, -2.4645], [-0.9294, -1.1963], [-0.418, -1.4647]], [[-0.1131, -0.1373], [-0.305, -0.3797], [-0.6738, -0.981], [-0.9951, -1.4499], [-0.8764, -1.3418], [-0.8557, -1.4905]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[-0.4809, -0.4601], [-1.207, -0.7548], [-1.9155, -1.3957], [-1.6849, -0.8737], [-0.6087, -0.5426], [-0.0733, -0.1323]], [[-0.6092, -0.7897], [-1.1788, -1.2584], [-2.0289, -2.7497], [-1.4679, -1.9595], [-0.7036, -1.7859], [-0.1378, -0.483]], [[-0.1788, -0.217], [-0.4495, -0.5606], [-1.1157, -1.6095], [-1.1667, -1.7632], [-1.1019, -1.8584], [-0.2822, -0.4915]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]]]]