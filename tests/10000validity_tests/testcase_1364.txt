import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max71158 = tf.keras.layers.Input(shape=([1, 1]))
in1Max71158 = tf.keras.layers.Input(shape=([1, 1]))
in0Con78231 = tf.keras.layers.Input(shape=([2, 7]))
in0Con83524 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))

Max71158 = keras.layers.Maximum(name = 'Max71158', )([in0Max71158,in1Max71158])
Zer28607 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer28607', )(Max71158)
Con78231 = keras.layers.Concatenate(axis=2, name = 'Con78231', )([Zer28607,in0Con78231])
Con83524 = keras.layers.Conv3DTranspose(4, (2, 1, 2),strides=(1, 1, 1), padding='same', name = 'Con83524', )(in0Con83524)
Res39192 = keras.layers.Reshape((2, 1, 8), name = 'Res39192', )(Con83524)
Res91889 = keras.layers.Reshape((2, 8), name = 'Res91889', )(Res39192)
Dot44022 = keras.layers.Dot(axes=(2, 2), name = 'Dot44022', )([Con78231,Res91889])
Res3975 = keras.layers.Reshape((2, 2, 1), name = 'Res3975', )(Dot44022)
Con93133 = keras.layers.Conv2DTranspose(2, (1, 1),strides=(1, 1), padding='valid', name = 'Con93133', )(Res3975)
model = tf.keras.models.Model(inputs=[in0Max71158,in1Max71158,in0Con78231,in0Con83524], outputs=Con93133)
w = model.get_layer('Con83524').get_weights() 
w[0] = np.array([[[[[0.0875, 0.7745], [0.7409, 0.4496], [0.9184, 0.6434], [0.2742, 0.4474]], [[0.8399, 0.2322], [0.2166, 0.5797], [0.8619, 0.4329], [0.3169, 0.7144]]]], [[[[0.6712, 0.569], [0.3687, 0.7574], [0.793, 0.2572], [0.623, 0.5616]], [[0.1705, 0.728], [0.2781, 0.6995], [0.5911, 0.5503], [0.3868, 0.9129]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con83524').set_weights(w) 
w = model.get_layer('Con93133').get_weights() 
w[0] = np.array([[[[0.4001], [0.6811]]]])
w[1] = np.array([0, 0])
model.get_layer('Con93133').set_weights(w) 
in0Max71158 = tf.constant([[[0.1981]]])
in1Max71158 = tf.constant([[[0.8011]]])
in0Con78231 = tf.constant([[[0.6796, 0.8379, 0.272, 0.0536, 0.5567, 0.0993, 0.3898], [0.1679, 0.0284, 0.7264, 0.7569, 0.2333, 0.9366, 0.5953]]])
in0Con83524 = tf.constant([[[[[0.1854, 0.5253], [0.9229, 0.84]]], [[[0.5514, 0.5434], [0.9496, 0.2106]]]]])
print (np.array2string(model.predict([in0Max71158,in1Max71158,in0Con78231,in0Con83524],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con93133.png')

LMax71158 = maximum_layer([[[[0.1981]]], [[[0.8011]]]], Max71158), 
LZer28607 = zero_padding1D_layer(Max71158, 1, 0, Zer28607), 
LCon78231 = concatenate_layer([Zer28607,[[[0.6796, 0.8379, 0.272, 0.0536, 0.5567, 0.0993, 0.3898], [0.1679, 0.0284, 0.7264, 0.7569, 0.2333, 0.9366, 0.5953]]]], 2, Con78231), 
LCon83524 = conv3D_transpose_layer([[[[[0.1854, 0.5253], [0.9229, 0.84]]], [[[0.5514, 0.5434], [0.9496, 0.2106]]]]], 2, 1, 2,[[[[[0.0875, 0.7745], [0.7409, 0.4496], [0.9184, 0.6434], [0.2742, 0.4474]], [[0.8399, 0.2322], [0.2166, 0.5797], [0.8619, 0.4329], [0.3169, 0.7144]]]], [[[[0.6712, 0.569], [0.3687, 0.7574], [0.793, 0.2572], [0.623, 0.5616]], [[0.1705, 0.728], [0.2781, 0.6995], [0.5911, 0.5503], [0.3868, 0.9129]]]]],[0, 0, 0, 0], 1, 1, 1, true, Con83524), 
LRes39192 = reshape_layer(Con83524, [2, 1, 8], Res39192), 
LRes91889 = reshape_layer(Res39192, [2, 8], Res91889), 
LDot44022 = dot_layer(Con78231,Res91889, 2, 2, Dot44022), 
LRes3975 = reshape_layer(Dot44022, [2, 2, 1], Res3975), 
LCon93133 = conv2D_transpose_layer(Res3975, 1, 1,[[[[0.4001], [0.6811]]]],[0, 0], 1, 1, false, Con93133), 
exec_layers([LMax71158,LZer28607,LCon78231,LCon83524,LRes39192,LRes91889,LDot44022,LRes3975,LCon93133],["Max71158","Zer28607","Con78231","Con83524","Res39192","Res91889","Dot44022","Res3975","Con93133"],Con93133,"Con93133")

Actual (Unparsed): [[[[0.8741947, 1.4881630], [1.9232273, 3.2739569]], [[1.6047755, 2.7318485], [3.3117034, 5.6375935]]]]

Expected (Unparsed): [[[[0.8741946736108915,1.4881629397560066],[1.9232273453314668,3.2739568730448942]],[[1.6047754484791223,2.7318484327896284],[3.311703292176121,5.637593382407288]]]]

Actual:   [[[[0.8742, 1.4882], [1.9233, 3.274]], [[1.6048, 2.7319], [3.3118, 5.6376]]]]

Expected: [[[[0.8742, 1.4882], [1.9233, 3.274]], [[1.6048, 2.7319], [3.3118, 5.6376]]]]