import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sep95078 = tf.keras.layers.Input(shape=([2, 2, 1]))

Sep95078 = keras.layers.SeparableConv2D(2, (2, 2),strides=(1, 1), padding='same', name = 'Sep95078', )(in0Sep95078)
Res28942 = keras.layers.Reshape((2, 4), name = 'Res28942', )(Sep95078)
Glo80627 = keras.layers.GlobalMaxPool1D(name = 'Glo80627', )(Res28942)
Res96391 = keras.layers.Reshape((4, 1), name = 'Res96391', )(Glo80627)
Res75863 = keras.layers.Reshape((4, 1, 1), name = 'Res75863', )(Res96391)
Loc7322 = keras.layers.LocallyConnected2D(3, (1, 1),strides=(12, 1), name = 'Loc7322', )(Res75863)
Res98167 = keras.layers.Reshape((1, 1, 3, 1), name = 'Res98167', )(Loc7322)
Con47187 = keras.layers.Conv3D(3, (1, 1, 2),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con47187', )(Res98167)
model = tf.keras.models.Model(inputs=[in0Sep95078], outputs=Con47187)
w = model.get_layer('Sep95078').get_weights() 
w[0] = np.array([[[[0.1589]], [[0.6312]]], [[[0.6172]], [[0.6606]]]])
w[1] = np.array([[[[0.5325, 0.2075]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep95078').set_weights(w) 
w = model.get_layer('Loc7322').get_weights() 
w[0] = np.array([[[0.1795, 0.9688, 0.5854]]])
w[1] = np.array([[[0, 0, 0]]])
model.get_layer('Loc7322').set_weights(w) 
w = model.get_layer('Con47187').get_weights() 
w[0] = np.array([[[[[0.7147, 0.8363, 0.6119]], [[0.6236, 0.9926, 0.6694]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con47187').set_weights(w) 
in0Sep95078 = tf.constant([[[[0.6488], [0.6516]], [[0.6971], [0.6816]]]])
print (np.array2string(model.predict([in0Sep95078],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con47187.png')

LSep95078 = separable_conv2D_layer([[[[0.6488], [0.6516]], [[0.6971], [0.6816]]]], 2, 2,[[[[[0.1589]], [[0.6312]]], [[[0.6172]], [[0.6606]]]],[[[[0.5325, 0.2075]]]]],[0, 0], 1, 1, true, Sep95078), 
LRes28942 = reshape_layer(Sep95078, [2, 4], Res28942), 
LGlo80627 = global_max_pool1D_layer(Res28942, Glo80627), 
LRes96391 = reshape_layer(Glo80627, [4, 1], Res96391), 
LRes75863 = reshape_layer(Res96391, [4, 1, 1], Res75863), 
LLoc7322 = locally_connected2D_layer(Res75863, 1, 1,[[[0.1795, 0.9688, 0.5854]]],[[[0, 0, 0]]], 12, 1, Loc7322), 
LRes98167 = reshape_layer(Loc7322, [1, 1, 3, 1], Res98167), 
LCon47187 = conv3D_layer(Res98167, 1, 1, 2,[[[[[0.7147, 0.8363, 0.6119]], [[0.6236, 0.9926, 0.6694]]]]],[0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con47187), 
exec_layers([LSep95078,LRes28942,LGlo80627,LRes96391,LRes75863,LLoc7322,LRes98167,LCon47187],["Sep95078","Res28942","Glo80627","Res96391","Res75863","Loc7322","Res98167","Con47187"],Con47187,"Con47187")

Actual (Unparsed): [[[[[0.5440389, 0.8257875, 0.5632907], [0.7854619, 1.0334170, 0.7314011], [0.3107699, 0.3636447, 0.2660698]]]]]

Expected (Unparsed): [[[[[0.5440389337010558,0.8257875584695115,0.5632907333325586],[0.7854618731902926,1.0334170101743387,0.7314010813541987],[0.3107699191969189,0.36364472285488075,0.26606983847291826]]]]]

Actual:   [[[[[0.5441, 0.8258, 0.5633], [0.7855, 1.0335, 0.7315], [0.3108, 0.3637, 0.2661]]]]]

Expected: [[[[[0.5441, 0.8258, 0.5633], [0.7855, 1.0335, 0.7315], [0.3108, 0.3637, 0.2661]]]]]