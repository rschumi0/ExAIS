import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc99193 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con74265 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con20062 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Add91440 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Add91440 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Ave85107 = tf.keras.layers.Input(shape=([1, 1]))
in0Con47262 = tf.keras.layers.Input(shape=([1, 5]))
in0Sof84248 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Con3527 = tf.keras.layers.Input(shape=([2, 2]))
in0Sub92854 = tf.keras.layers.Input(shape=([2, 2, 3]))
in1Sub92854 = tf.keras.layers.Input(shape=([2, 2, 3]))
in0Con46697 = tf.keras.layers.Input(shape=([2, 9]))

Loc99193 = keras.layers.LocallyConnected2D(4, (1, 2),strides=(1, 1), name = 'Loc99193', )(in0Loc99193)
Zer65796 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer65796', )(Loc99193)
Con74265 = keras.layers.Conv2D(2, (1, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con74265', )(in0Con74265)
Con20062 = keras.layers.Concatenate(axis=3, name = 'Con20062', )([Con74265,in0Con20062])
Mul55571 = keras.layers.Multiply(name = 'Mul55571', )([Zer65796,Con20062])
Res50910 = keras.layers.Reshape((1, 2, 4, 1), name = 'Res50910', )(Mul55571)
Zer163 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (2, 0)), name = 'Zer163', )(Res50910)
Add91440 = keras.layers.Add(name = 'Add91440', )([in0Add91440,in1Add91440])
Zer64881 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (4, 0)), name = 'Zer64881', )(Add91440)
Add80501 = keras.layers.Add(name = 'Add80501', )([Zer163,Zer64881])
Res87337 = keras.layers.Reshape((2, 2, 6), name = 'Res87337', )(Add80501)
Res37773 = keras.layers.Reshape((2, 12), name = 'Res37773', )(Res87337)
Ave85107 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave85107', )(in0Ave85107)
Con47262 = keras.layers.Concatenate(axis=2, name = 'Con47262', )([Ave85107,in0Con47262])
Sof84248 = keras.layers.Softmax(axis=1, name = 'Sof84248', input_shape=(2, 2, 2, 1))(in0Sof84248)
Res77527 = keras.layers.Reshape((2, 2, 2), name = 'Res77527', )(Sof84248)
Res15333 = keras.layers.Reshape((2, 4), name = 'Res15333', )(Res77527)
Con3527 = keras.layers.Concatenate(axis=2, name = 'Con3527', )([Res15333,in0Con3527])
Sub92854 = keras.layers.Subtract(name = 'Sub92854', )([in0Sub92854,in1Sub92854])
Res97171 = keras.layers.Reshape((2, 6), name = 'Res97171', )(Sub92854)
Cro92715 = keras.layers.Cropping1D(cropping=((0, 1)), name = 'Cro92715', )(Res97171)
Zer29623 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer29623', )(Cro92715)
Sub3480 = keras.layers.Subtract(name = 'Sub3480', )([Con3527,Zer29623])
Zer6538 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer6538', )(Sub3480)
Dot91052 = keras.layers.Dot(axes=(2, 2), name = 'Dot91052', )([Con47262,Zer6538])
Zer25467 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer25467', )(Dot91052)
Con46697 = keras.layers.Concatenate(axis=2, name = 'Con46697', )([Zer25467,in0Con46697])
Min58132 = keras.layers.Minimum(name = 'Min58132', )([Res37773,Con46697])
model = tf.keras.models.Model(inputs=[in0Loc99193,in0Con74265,in0Con20062,in0Add91440,in1Add91440,in0Ave85107,in0Con47262,in0Sof84248,in0Con3527,in0Sub92854,in1Sub92854,in0Con46697], outputs=Min58132)
w = model.get_layer('Loc99193').get_weights() 
w[0] = np.array([[[0.9323, 0.4955, 0.1266, 0.5463], [0.726, 0.6198, 0.9107, 0.2138]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc99193').set_weights(w) 
w = model.get_layer('Con74265').get_weights() 
w[0] = np.array([[[[0.3069, 0.537], [0.9008, 0.8855]]]])
w[1] = np.array([0, 0])
model.get_layer('Con74265').set_weights(w) 
in0Loc99193 = tf.constant([[[[0.374], [0.1025]]]])
in0Con74265 = tf.constant([[[[0.2092, 0.4328], [0.2808, 0.3535]]]])
in0Con20062 = tf.constant([[[[0.0678, 0.8925], [0.6862, 0.2189]]]])
in0Add91440 = tf.constant([[[[[0.264], [0.6605]], [[0.3834], [0.261]]], [[[0.7418], [0.593]], [[0.9718], [0.4061]]]]])
in1Add91440 = tf.constant([[[[[0.2399], [0.7545]], [[0.2509], [0.4418]]], [[[0.7181], [0.5548]], [[0.6055], [0.9133]]]]])
in0Ave85107 = tf.constant([[[1.3703]]])
in0Con47262 = tf.constant([[[0.3002, 0.3276, 0.6882, 0.4372, 0.2472]]])
in0Sof84248 = tf.constant([[[[[0.3579], [0.9235]], [[0.4995], [0.2917]]], [[[0.368], [0.1509]], [[0.9352], [0.8765]]]]])
in0Con3527 = tf.constant([[[0.4857, 0.8126], [0.3491, 0.3578]]])
in0Sub92854 = tf.constant([[[[0.6721, 0.3142, 0.6303], [0.6457, 0.3573, 0.9605]], [[0.6647, 0.1194, 0.6164], [0.3367, 0.4008, 0.4276]]]])
in1Sub92854 = tf.constant([[[[0.1434, 0.6602, 0.4344], [0.5825, 0.9302, 0.5143]], [[0.9802, 0.7224, 0.7768], [0.7467, 0.0769, 0.1845]]]])
in0Con46697 = tf.constant([[[0.153, 0.1903, 0.0854, 0.9921, 0.7888, 0.1584, 0.0754, 0.3127, 0.0718], [0.9231, 0.7345, 0.1104, 0.1744, 0.7228, 0.351, 0.8848, 0.1438, 0.7419]]])
print (np.array2string(model.predict([in0Loc99193,in0Con74265,in0Con20062,in0Add91440,in1Add91440,in0Ave85107,in0Con47262,in0Sof84248,in0Con3527,in0Sub92854,in1Sub92854,in0Con46697],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min58132.png')

LLoc99193 = locally_connected2D_layer([[[[0.374], [0.1025]]]], 1, 2,[[[0.9323, 0.4955, 0.1266, 0.5463], [0.726, 0.6198, 0.9107, 0.2138]]],[[[0, 0, 0, 0]]], 1, 1, Loc99193), 
LZer65796 = zero_padding2D_layer(Loc99193, 0, 0, 1, 0, Zer65796), 
LCon74265 = conv2D_layer([[[[0.2092, 0.4328], [0.2808, 0.3535]]]], 1, 1,[[[[0.3069, 0.537], [0.9008, 0.8855]]]],[0, 0], 1, 1, true, 1, 1, Con74265), 
LCon20062 = concatenate_layer([Con74265,[[[[0.0678, 0.8925], [0.6862, 0.2189]]]]], 3, Con20062), 
LMul55571 = multiply_layer([Zer65796,Con20062], Mul55571), 
LRes50910 = reshape_layer(Mul55571, [1, 2, 4, 1], Res50910), 
LZer163 = zero_padding3D_layer(Res50910, 1, 0, 0, 0, 2, 0, Zer163), 
LAdd91440 = add_layer([[[[[[0.264], [0.6605]], [[0.3834], [0.261]]], [[[0.7418], [0.593]], [[0.9718], [0.4061]]]]], [[[[[0.2399], [0.7545]], [[0.2509], [0.4418]]], [[[0.7181], [0.5548]], [[0.6055], [0.9133]]]]]], Add91440), 
LZer64881 = zero_padding3D_layer(Add91440, 0, 0, 0, 0, 4, 0, Zer64881), 
LAdd80501 = add_layer([Zer163,Zer64881], Add80501), 
LRes87337 = reshape_layer(Add80501, [2, 2, 6], Res87337), 
LRes37773 = reshape_layer(Res87337, [2, 12], Res37773), 
LAve85107 = average_pooling1D_layer([[[1.3703]]], 1, Ave85107), 
LCon47262 = concatenate_layer([Ave85107,[[[0.3002, 0.3276, 0.6882, 0.4372, 0.2472]]]], 2, Con47262), 
LSof84248 = softmax_layer([[[[[0.3579], [0.9235]], [[0.4995], [0.2917]]], [[[0.368], [0.1509]], [[0.9352], [0.8765]]]]], 1, Sof84248), 
LRes77527 = reshape_layer(Sof84248, [2, 2, 2], Res77527), 
LRes15333 = reshape_layer(Res77527, [2, 4], Res15333), 
LCon3527 = concatenate_layer([Res15333,[[[0.4857, 0.8126], [0.3491, 0.3578]]]], 2, Con3527), 
LSub92854 = subtract_layer([[[[0.6721, 0.3142, 0.6303], [0.6457, 0.3573, 0.9605]], [[0.6647, 0.1194, 0.6164], [0.3367, 0.4008, 0.4276]]]], [[[[0.1434, 0.6602, 0.4344], [0.5825, 0.9302, 0.5143]], [[0.9802, 0.7224, 0.7768], [0.7467, 0.0769, 0.1845]]]], Sub92854), 
LRes97171 = reshape_layer(Sub92854, [2, 6], Res97171), 
LCro92715 = cropping1D_layer(Res97171, 0, 1, Cro92715), 
LZer29623 = zero_padding1D_layer(Cro92715, 1, 0, Zer29623), 
LSub3480 = subtract_layer(Con3527,Zer29623, Sub3480), 
LZer6538 = zero_padding1D_layer(Sub3480, 1, 0, Zer6538), 
LDot91052 = dot_layer(Con47262,Zer6538, 2, 2, Dot91052), 
LZer25467 = zero_padding1D_layer(Dot91052, 1, 0, Zer25467), 
LCon46697 = concatenate_layer([Zer25467,[[[0.153, 0.1903, 0.0854, 0.9921, 0.7888, 0.1584, 0.0754, 0.3127, 0.0718], [0.9231, 0.7345, 0.1104, 0.1744, 0.7228, 0.351, 0.8848, 0.1438, 0.7419]]]], 2, Con46697), 
LMin58132 = minimum_layer([Res37773,Con46697], Min58132), 
exec_layers([LLoc99193,LZer65796,LCon74265,LCon20062,LMul55571,LRes50910,LZer163,LAdd91440,LZer64881,LAdd80501,LRes87337,LRes37773,LAve85107,LCon47262,LSof84248,LRes77527,LRes15333,LCon3527,LSub92854,LRes97171,LCro92715,LZer29623,LSub3480,LZer6538,LDot91052,LZer25467,LCon46697,LMin58132],["Loc99193","Zer65796","Con74265","Con20062","Mul55571","Res50910","Zer163","Add91440","Zer64881","Add80501","Res87337","Res37773","Ave85107","Con47262","Sof84248","Res77527","Res15333","Con3527","Sub92854","Res97171","Cro92715","Zer29623","Sub3480","Zer6538","Dot91052","Zer25467","Con46697","Min58132"],Min58132,"Min58132")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.1903000, 0.0854000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.3127000, 0.0718000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.7345000, 0.1104000, 0.0000000, 0.0000000, 0.1711887, 0.1154185, 0.1438000, 0.7419000]]]

Expected (Unparsed): [[[0,0,0,0,0.1903,0.0854,0,0,0,0,0.3127,0.0718],[0,0,0.0,0.0,0.7345,0.1104,0,0,0.171188684262464,0.11541845322402501,0.1438,0.7419]]]

Actual:   [[[0, 0, 0, 0, 0.1903, 0.0854, 0, 0, 0, 0, 0.3127, 0.0718], [0, 0, 0, 0, 0.7345, 0.1104, 0, 0, 0.1712, 0.1155, 0.1438, 0.7419]]]

Expected: [[[0, 0, 0, 0, 0.1903, 0.0854, 0, 0, 0, 0, 0.3127, 0.0718], [0, 0, 0, 0, 0.7345, 0.1104, 0, 0, 0.1712, 0.1155, 0.1438, 0.7419]]]