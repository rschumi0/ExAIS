import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max27424 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Max27424 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in0GRU70567 = tf.keras.layers.Input(shape=([3, 2]))

Max27424 = keras.layers.Maximum(name = 'Max27424', )([in0Max27424,in1Max27424])
Res12483 = keras.layers.Reshape((1, 1, 1), name = 'Res12483', )(Max27424)
Up_7843 = keras.layers.UpSampling2D(size=(2, 1), name = 'Up_7843', )(Res12483)
Max11284 = keras.layers.MaxPool2D(pool_size=(2, 1), name = 'Max11284', )(Up_7843)
Zer7963 = keras.layers.ZeroPadding2D(padding=((4, 0), (2, 0)), name = 'Zer7963', )(Max11284)
GRU70567 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU70567', )(in0GRU70567)
Res14362 = keras.layers.Reshape((3, 1), name = 'Res14362', )(GRU70567)
Res2541 = keras.layers.Reshape((3, 1, 1), name = 'Res2541', )(Res14362)
Zer37976 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer37976', )(Res2541)
Ave61707 = keras.layers.Average(name = 'Ave61707', )([Zer7963,Zer37976])
model = tf.keras.models.Model(inputs=[in0Max27424,in1Max27424,in0GRU70567], outputs=Ave61707)
w = model.get_layer('GRU70567').get_weights() 
w[0] = np.array([[5, 9, 2, 1, 2, 10, 1, 2, 6], [4, 5, 6, 10, 9, 6, 4, 3, 7]])
w[1] = np.array([[8, 7, 6, 1, 8, 7, 5, 4, 9], [4, 10, 8, 1, 5, 3, 8, 2, 8], [9, 8, 7, 5, 3, 5, 3, 5, 1]])
w[2] = np.array([5, 4, 7, 9, 2, 10, 3, 9, 3])
model.get_layer('GRU70567').set_weights(w) 
in0Max27424 = tf.constant([[[[[0.0726]]]]])
in1Max27424 = tf.constant([[[[[0.3502]]]]])
in0GRU70567 = tf.constant([[[4, 9], [2, 6], [1, 8]]])
print (np.array2string(model.predict([in0Max27424,in1Max27424,in0GRU70567],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave61707.png')

LMax27424 = maximum_layer([[[[[[0.0726]]]]], [[[[[0.3502]]]]]], Max27424), 
LRes12483 = reshape_layer(Max27424, [1, 1, 1], Res12483), 
LUp_7843 = up_sampling2D_layer(Res12483, 2, 1, Up_7843), 
LMax11284 = max_pool2D_layer(Up_7843, 2, 1, Max11284), 
LZer7963 = zero_padding2D_layer(Max11284, 4, 0, 2, 0, Zer7963), 
LGRU70567 = gru_layer([[[4, 9], [2, 6], [1, 8]]],[[5, 9, 2, 1, 2, 10, 1, 2, 6], [4, 5, 6, 10, 9, 6, 4, 3, 7]],[[8, 7, 6, 1, 8, 7, 5, 4, 9], [4, 10, 8, 1, 5, 3, 8, 2, 8], [9, 8, 7, 5, 3, 5, 3, 5, 1]],[5, 4, 7, 9, 2, 10, 3, 9, 3], false, GRU70567), 
LRes14362 = reshape_layer(GRU70567, [3, 1], Res14362), 
LRes2541 = reshape_layer(Res14362, [3, 1, 1], Res2541), 
LZer37976 = zero_padding2D_layer(Res2541, 1, 1, 1, 1, Zer37976), 
LAve61707 = average_layer([Zer7963,Zer37976], Ave61707), 
exec_layers([LMax27424,LRes12483,LUp_7843,LMax11284,LZer7963,LGRU70567,LRes14362,LRes2541,LZer37976,LAve61707],["Max27424","Res12483","Up_7843","Max11284","Zer7963","GRU70567","Res14362","Res2541","Zer37976","Ave61707"],Ave61707,"Ave61707")

Actual (Unparsed): [[[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.1751000]]]]

Expected (Unparsed): [[[[0],[0],[0]],[[0],[0.0],[0]],[[0],[0.0],[0]],[[0],[0.0],[0]],[[0],[0],[0.1751]]]]

Actual:   [[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0.1751]]]]

Expected: [[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0.1751]]]]