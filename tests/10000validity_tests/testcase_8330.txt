import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0GRU79154 = tf.keras.layers.Input(shape=([1, 1]))
in0Ave19852 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Ave19852 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))

GRU79154 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU79154', )(in0GRU79154)
Res13735 = keras.layers.Reshape((3, 1), name = 'Res13735', )(GRU79154)
Res98293 = keras.layers.Reshape((3, 1, 1), name = 'Res98293', )(Res13735)
Zer15850 = keras.layers.ZeroPadding2D(padding=((0, 0), (4, 0)), name = 'Zer15850', )(Res98293)
Ave19852 = keras.layers.Average(name = 'Ave19852', )([in0Ave19852,in1Ave19852])
Res8771 = keras.layers.Reshape((2, 2, 1), name = 'Res8771', )(Ave19852)
Res8519 = keras.layers.Reshape((2, 2), name = 'Res8519', )(Res8771)
Con48217 = keras.layers.Conv1D(3, (2),strides=(1), padding='same', dilation_rate=(1), name = 'Con48217', )(Res8519)
Res34717 = keras.layers.Reshape((2, 3, 1), name = 'Res34717', )(Con48217)
PRe228 = keras.layers.PReLU(name = 'PRe228', )(Res34717)
Zer86336 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer86336', )(PRe228)
Add71162 = keras.layers.Add(name = 'Add71162', )([Zer15850,Zer86336])
model = tf.keras.models.Model(inputs=[in0GRU79154,in0Ave19852,in1Ave19852], outputs=Add71162)
w = model.get_layer('GRU79154').get_weights() 
w[0] = np.array([[7, 5, 6, 8, 1, 10, 7, 5, 2]])
w[1] = np.array([[6, 9, 7, 2, 2, 10, 4, 2, 10], [4, 5, 2, 8, 8, 6, 10, 5, 9], [1, 9, 4, 2, 1, 5, 2, 1, 4]])
w[2] = np.array([[1, 7, 8, 2, 9, 1, 2, 4, 6], [6, 8, 10, 4, 10, 1, 7, 3, 5]])
model.get_layer('GRU79154').set_weights(w) 
w = model.get_layer('Con48217').get_weights() 
w[0] = np.array([[[0.1607, 0.2021, 0.2388], [0.9462, 0.8418, 0.2852]], [[0.6442, 0.3882, 0.7822], [0.7915, 0.8812, 0.0817]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con48217').set_weights(w) 
w = model.get_layer('PRe228').get_weights() 
w[0] = np.array([[[0.0189], [0.9066], [0.3843]], [[0.7366], [0.5445], [0.9644]]])
model.get_layer('PRe228').set_weights(w) 
in0GRU79154 = tf.constant([[[1]]])
in0Ave19852 = tf.constant([[[[[0.5451]], [[0.1575]]], [[[0.9864]], [[0.7883]]]]])
in1Ave19852 = tf.constant([[[[[0.9098]], [[0.49]]], [[[0.4362]], [[0.4021]]]]])
print (np.array2string(model.predict([in0GRU79154,in0Ave19852,in1Ave19852],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add71162.png')

LGRU79154 = gru_layer([[[1]]],[[7, 5, 6, 8, 1, 10, 7, 5, 2]],[[6, 9, 7, 2, 2, 10, 4, 2, 10], [4, 5, 2, 8, 8, 6, 10, 5, 9], [1, 9, 4, 2, 1, 5, 2, 1, 4]],[[1, 7, 8, 2, 9, 1, 2, 4, 6], [6, 8, 10, 4, 10, 1, 7, 3, 5]], true, GRU79154), 
LRes13735 = reshape_layer(GRU79154, [3, 1], Res13735), 
LRes98293 = reshape_layer(Res13735, [3, 1, 1], Res98293), 
LZer15850 = zero_padding2D_layer(Res98293, 0, 0, 4, 0, Zer15850), 
LAve19852 = average_layer([[[[[[0.5451]], [[0.1575]]], [[[0.9864]], [[0.7883]]]]], [[[[[0.9098]], [[0.49]]], [[[0.4362]], [[0.4021]]]]]], Ave19852), 
LRes8771 = reshape_layer(Ave19852, [2, 2, 1], Res8771), 
LRes8519 = reshape_layer(Res8771, [2, 2], Res8519), 
LCon48217 = conv1D_layer(Res8519, 2,[[[0.1607, 0.2021, 0.2388], [0.9462, 0.8418, 0.2852]], [[0.6442, 0.3882, 0.7822], [0.7915, 0.8812, 0.0817]]],[0, 0, 0], 1, true, 1, Con48217), 
LRes34717 = reshape_layer(Con48217, [2, 3, 1], Res34717), 
LPRe228 = prelu_layer(Res34717, [[[0.0189], [0.9066], [0.3843]], [[0.7366], [0.5445], [0.9644]]], PRe228), 
LZer86336 = zero_padding2D_layer(PRe228, 1, 0, 2, 0, Zer86336), 
LAdd71162 = add_layer([Zer15850,Zer86336], Add71162), 
exec_layers([LGRU79154,LRes13735,LRes98293,LZer15850,LAve19852,LRes8771,LRes8519,LCon48217,LRes34717,LPRe228,LZer86336,LAdd71162],["GRU79154","Res13735","Res98293","Zer15850","Ave19852","Res8771","Res8519","Con48217","Res34717","PRe228","Zer86336","Add71162"],Add71162,"Add71162")

Actual (Unparsed): [[[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000008]], [[0.0000000], [0.0000000], [1.3525537], [1.2201673], [0.8710553]], [[0.0000000], [0.0000000], [0.6774841], [0.6447931], [0.3396095]]]]

Expected (Unparsed): [[[[0],[0],[0],[0],[8.315280277670712e-7]],[[0],[0],[1.352553725],[1.220167295],[0.8710552620611537]],[[0],[0],[0.67748415],[0.64479309],[0.3396094800377514]]]]

Actual:   [[[[0], [0], [0], [0], [0]], [[0], [0], [1.3526], [1.2202], [0.8711]], [[0], [0], [0.6775], [0.6448], [0.3397]]]]

Expected: [[[[0], [0], [0], [0], [0]], [[0], [0], [1.3526], [1.2202], [0.8711]], [[0], [0], [0.6775], [0.6448], [0.3397]]]]