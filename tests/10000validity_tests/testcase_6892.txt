import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul39290 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Mul39290 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Ave24540 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Ave24540 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Glo63855 = tf.keras.layers.Input(shape=([2, 2]))
in0Con28716 = tf.keras.layers.Input(shape=([2]))

Mul39290 = keras.layers.Multiply(name = 'Mul39290', )([in0Mul39290,in1Mul39290])
Res34317 = keras.layers.Reshape((2, 1, 2), name = 'Res34317', )(Mul39290)
Res57536 = keras.layers.Reshape((2, 2), name = 'Res57536', )(Res34317)
Fla67973 = keras.layers.Flatten(name = 'Fla67973', )(Res57536)
Ave24540 = keras.layers.Average(name = 'Ave24540', )([in0Ave24540,in1Ave24540])
Res81123 = keras.layers.Reshape((2, 1, 2), name = 'Res81123', )(Ave24540)
Res98590 = keras.layers.Reshape((2, 2), name = 'Res98590', )(Res81123)
Fla92492 = keras.layers.Flatten(name = 'Fla92492', )(Res98590)
Glo63855 = keras.layers.GlobalMaxPool1D(name = 'Glo63855', )(in0Glo63855)
Con28716 = keras.layers.Concatenate(axis=1, name = 'Con28716', )([Glo63855,in0Con28716])
Max40792 = keras.layers.Maximum(name = 'Max40792', )([Fla92492,Con28716])
Ave48490 = keras.layers.Average(name = 'Ave48490', )([Fla67973,Max40792])
model = tf.keras.models.Model(inputs=[in0Mul39290,in1Mul39290,in0Ave24540,in1Ave24540,in0Glo63855,in0Con28716], outputs=Ave48490)
in0Mul39290 = tf.constant([[[[[0.4317], [0.4674]]], [[[0.3553], [0.1476]]]]])
in1Mul39290 = tf.constant([[[[[0.3333], [0.5742]]], [[[0.3861], [0.0643]]]]])
in0Ave24540 = tf.constant([[[[[0.4033], [0.7552]]], [[[0.912], [0.1609]]]]])
in1Ave24540 = tf.constant([[[[[0.2124], [0.8917]]], [[[0.1451], [0.2678]]]]])
in0Glo63855 = tf.constant([[[1.7271, 1.1808], [1.5314, 1.5983]]])
in0Con28716 = tf.constant([[0.3846, 0.8801]])
print (np.array2string(model.predict([in0Mul39290,in1Mul39290,in0Ave24540,in1Ave24540,in0Glo63855,in0Con28716],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave48490.png')

LMul39290 = multiply_layer([[[[[[0.4317], [0.4674]]], [[[0.3553], [0.1476]]]]], [[[[[0.3333], [0.5742]]], [[[0.3861], [0.0643]]]]]], Mul39290), 
LRes34317 = reshape_layer(Mul39290, [2, 1, 2], Res34317), 
LRes57536 = reshape_layer(Res34317, [2, 2], Res57536), 
LFla67973 = flatten_layer(Res57536, Fla67973), 
LAve24540 = average_layer([[[[[[0.4033], [0.7552]]], [[[0.912], [0.1609]]]]], [[[[[0.2124], [0.8917]]], [[[0.1451], [0.2678]]]]]], Ave24540), 
LRes81123 = reshape_layer(Ave24540, [2, 1, 2], Res81123), 
LRes98590 = reshape_layer(Res81123, [2, 2], Res98590), 
LFla92492 = flatten_layer(Res98590, Fla92492), 
LGlo63855 = global_max_pool1D_layer([[[1.7271, 1.1808], [1.5314, 1.5983]]], Glo63855), 
LCon28716 = concatenate_layer([Glo63855,[[0.3846, 0.8801]]], 1, Con28716), 
LMax40792 = maximum_layer([Fla92492,Con28716], Max40792), 
LAve48490 = average_layer([Fla67973,Max40792], Ave48490), 
exec_layers([LMul39290,LRes34317,LRes57536,LFla67973,LAve24540,LRes81123,LRes98590,LFla92492,LGlo63855,LCon28716,LMax40792,LAve48490],["Mul39290","Res34317","Res57536","Fla67973","Ave24540","Res81123","Res98590","Fla92492","Glo63855","Con28716","Max40792","Ave48490"],Ave48490,"Ave48490")

Actual (Unparsed): [[0.9354928, 0.9333405, 0.3328657, 0.4447953]]

Expected (Unparsed): [[0.935492805,0.93334054,0.33286566500000003,0.44479534]]

Actual:   [[0.9355, 0.9334, 0.3329, 0.4448]]

Expected: [[0.9355, 0.9334, 0.3329, 0.4448]]