import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub31186 = tf.keras.layers.Input(shape=([3]))
in1Sub31186 = tf.keras.layers.Input(shape=([3]))
in0Add80146 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Add80146 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Dot53105 = tf.keras.layers.Input(shape=([2]))
in1Dot53105 = tf.keras.layers.Input(shape=([2]))
in0Con61423 = tf.keras.layers.Input(shape=([2, 1]))
in0Con52250 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Zer64163 = tf.keras.layers.Input(shape=([1, 1, 1, 3]))

Sub31186 = keras.layers.Subtract(name = 'Sub31186', )([in0Sub31186,in1Sub31186])
Res29273 = keras.layers.Reshape((3, 1), name = 'Res29273', )(Sub31186)
Res80713 = keras.layers.Reshape((3, 1, 1), name = 'Res80713', )(Res29273)
Glo36145 = keras.layers.GlobalMaxPool2D(name = 'Glo36145', )(Res80713)
Res46031 = keras.layers.Reshape((1, 1), name = 'Res46031', )(Glo36145)
Zer21091 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer21091', )(Res46031)
Add80146 = keras.layers.Add(name = 'Add80146', )([in0Add80146,in1Add80146])
Res92443 = keras.layers.Reshape((2, 2, 1), name = 'Res92443', )(Add80146)
Res62909 = keras.layers.Reshape((2, 2), name = 'Res62909', )(Res92443)
Dot53105 = keras.layers.Dot(axes=(1, 1), name = 'Dot53105', )([in0Dot53105,in1Dot53105])
Res48585 = keras.layers.Reshape((1, 1), name = 'Res48585', )(Dot53105)
Per57207 = keras.layers.Permute((1,2), name = 'Per57207',)(Res48585)
Zer42696 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer42696', )(Per57207)
Con61423 = keras.layers.Concatenate(axis=2, name = 'Con61423', )([Zer42696,in0Con61423])
Min66810 = keras.layers.Minimum(name = 'Min66810', )([Res62909,Con61423])
Res89203 = keras.layers.Reshape((2, 2, 1), name = 'Res89203', )(Min66810)
Zer77386 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer77386', )(Res89203)
Con52250 = keras.layers.Concatenate(axis=3, name = 'Con52250', )([Zer77386,in0Con52250])
Zer64163 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer64163', )(in0Zer64163)
Res80504 = keras.layers.Reshape((3, 3, 9), name = 'Res80504', )(Zer64163)
Con5928 = keras.layers.Conv2DTranspose(2, (2, 2),strides=(1, 1), padding='same', name = 'Con5928', )(Res80504)
ELU62448 = keras.layers.ELU(alpha=5.80613449841654, name = 'ELU62448', )(Con5928)
Mul12294 = keras.layers.Multiply(name = 'Mul12294', )([Con52250,ELU62448])
Res36356 = keras.layers.Reshape((3, 6), name = 'Res36356', )(Mul12294)
Dot99118 = keras.layers.Dot(axes=(1, 1), name = 'Dot99118', )([Zer21091,Res36356])
model = tf.keras.models.Model(inputs=[in0Sub31186,in1Sub31186,in0Add80146,in1Add80146,in0Dot53105,in1Dot53105,in0Con61423,in0Con52250,in0Zer64163], outputs=Dot99118)
w = model.get_layer('Con5928').get_weights() 
w[0] = np.array([[[[0.9721, 0.9227, 0.0707, 0.8411, 0.5679, 0.5589, 0.9764, 0.1001, 0.1651], [0.3264, 0.5209, 0.8862, 0.6855, 0.1543, 0.3721, 0.5281, 0.2471, 0.6246]], [[0.2024, 0.0822, 0.7076, 0.4754, 0.017, 0.0735, 0.2571, 0.0073, 0.3183], [0.6716, 0.7418, 0.5896, 0.6945, 0.3622, 0.6611, 0.9536, 0.7045, 0.3142]]], [[[0.333, 0.9877, 0.993, 0.8007, 0.5487, 0.3002, 0.4167, 0.2357, 0.1494], [0.908, 0.5857, 0.6088, 0.3491, 0.0232, 0.6343, 0.3646, 0.3001, 0.0614]], [[0.2212, 0.0608, 0.3524, 0.6751, 0.7307, 0.4602, 0.6934, 0.8276, 0.3968], [0.0652, 0.5704, 0.6676, 0.6047, 0.4874, 0.0969, 0.2356, 0.9363, 0.4591]]]])
w[1] = np.array([0, 0])
model.get_layer('Con5928').set_weights(w) 
in0Sub31186 = tf.constant([[0.0452, 0.1008, 0.6521]])
in1Sub31186 = tf.constant([[0.3664, 0.0044, 0.783]])
in0Add80146 = tf.constant([[[[[0.9793]], [[0.3251]]], [[[0.9273]], [[0.1195]]]]])
in1Add80146 = tf.constant([[[[[0.3757]], [[0.0943]]], [[[0.2883]], [[0.9456]]]]])
in0Dot53105 = tf.constant([[0.9303, 0.6941]])
in1Dot53105 = tf.constant([[0.9506, 0.4028]])
in0Con61423 = tf.constant([[[0.0181], [0.782]]])
in0Con52250 = tf.constant([[[[0.0221], [0.7737], [0.4674]], [[0.0956], [0.5086], [0.875]], [[0.4776], [0.5673], [0.4776]]]])
in0Zer64163 = tf.constant([[[[[1.2487, 1.0528, 1.2615]]]]])
print (np.array2string(model.predict([in0Sub31186,in1Sub31186,in0Add80146,in1Add80146,in0Dot53105,in1Dot53105,in0Con61423,in0Con52250,in0Zer64163],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot99118.png')

LSub31186 = subtract_layer([[0.0452, 0.1008, 0.6521]], [[0.3664, 0.0044, 0.783]], Sub31186), 
LRes29273 = reshape_layer(Sub31186, [3, 1], Res29273), 
LRes80713 = reshape_layer(Res29273, [3, 1, 1], Res80713), 
LGlo36145 = global_max_pool2D_layer(Res80713, Glo36145), 
LRes46031 = reshape_layer(Glo36145, [1, 1], Res46031), 
LZer21091 = zero_padding1D_layer(Res46031, 2, 0, Zer21091), 
LAdd80146 = add_layer([[[[[[0.9793]], [[0.3251]]], [[[0.9273]], [[0.1195]]]]], [[[[[0.3757]], [[0.0943]]], [[[0.2883]], [[0.9456]]]]]], Add80146), 
LRes92443 = reshape_layer(Add80146, [2, 2, 1], Res92443), 
LRes62909 = reshape_layer(Res92443, [2, 2], Res62909), 
LDot53105 = dot_layer([[0.9303, 0.6941]], [[0.9506, 0.4028]], 1, 1, Dot53105), 
LRes48585 = reshape_layer(Dot53105, [1, 1], Res48585), 
LPer57207 = permute_layer(Res48585, 1,2, Per57207), 
LZer42696 = zero_padding1D_layer(Per57207, 1, 0, Zer42696), 
LCon61423 = concatenate_layer([Zer42696,[[[0.0181], [0.782]]]], 2, Con61423), 
LMin66810 = minimum_layer([Res62909,Con61423], Min66810), 
LRes89203 = reshape_layer(Min66810, [2, 2, 1], Res89203), 
LZer77386 = zero_padding2D_layer(Res89203, 1, 0, 1, 0, Zer77386), 
LCon52250 = concatenate_layer([Zer77386,[[[[0.0221], [0.7737], [0.4674]], [[0.0956], [0.5086], [0.875]], [[0.4776], [0.5673], [0.4776]]]]], 3, Con52250), 
LZer64163 = zero_padding3D_layer([[[[[1.2487, 1.0528, 1.2615]]]]], 1, 1, 1, 1, 1, 1, Zer64163), 
LRes80504 = reshape_layer(Zer64163, [3, 3, 9], Res80504), 
LCon5928 = conv2D_transpose_layer(Res80504, 2, 2,[[[[0.9721, 0.9227, 0.0707, 0.8411, 0.5679, 0.5589, 0.9764, 0.1001, 0.1651], [0.3264, 0.5209, 0.8862, 0.6855, 0.1543, 0.3721, 0.5281, 0.2471, 0.6246]], [[0.2024, 0.0822, 0.7076, 0.4754, 0.017, 0.0735, 0.2571, 0.0073, 0.3183], [0.6716, 0.7418, 0.5896, 0.6945, 0.3622, 0.6611, 0.9536, 0.7045, 0.3142]]], [[[0.333, 0.9877, 0.993, 0.8007, 0.5487, 0.3002, 0.4167, 0.2357, 0.1494], [0.908, 0.5857, 0.6088, 0.3491, 0.0232, 0.6343, 0.3646, 0.3001, 0.0614]], [[0.2212, 0.0608, 0.3524, 0.6751, 0.7307, 0.4602, 0.6934, 0.8276, 0.3968], [0.0652, 0.5704, 0.6676, 0.6047, 0.4874, 0.0969, 0.2356, 0.9363, 0.4591]]]],[0, 0], 1, 1, true, Con5928), 
LELU62448 = elu_layer(Con5928, 5.80613449841654, ELU62448), 
LMul12294 = multiply_layer([Con52250,ELU62448], Mul12294), 
LRes36356 = reshape_layer(Mul12294, [3, 6], Res36356), 
LDot99118 = dot_layer(Zer21091,Res36356, 1, 1, Dot99118), 
exec_layers([LSub31186,LRes29273,LRes80713,LGlo36145,LRes46031,LZer21091,LAdd80146,LRes92443,LRes62909,LDot53105,LRes48585,LPer57207,LZer42696,LCon61423,LMin66810,LRes89203,LZer77386,LCon52250,LZer64163,LRes80504,LCon5928,LELU62448,LMul12294,LRes36356,LDot99118],["Sub31186","Res29273","Res80713","Glo36145","Res46031","Zer21091","Add80146","Res92443","Res62909","Dot53105","Res48585","Per57207","Zer42696","Con61423","Min66810","Res89203","Zer77386","Con52250","Zer64163","Res80504","Con5928","ELU62448","Mul12294","Res36356","Dot99118"],Dot99118,"Dot99118")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.2194915, 0.0689347, 0.1653054, 0.0640178]]]

Expected (Unparsed): [[[0.0,0.0,0.21949145880255647,0.0689347230946776,0.165305344628424,0.06401780457469441]]]

Actual:   [[[0, 0, 0.2195, 0.069, 0.1654, 0.0641]]]

Expected: [[[0, 0, 0.2195, 0.069, 0.1654, 0.0641]]]