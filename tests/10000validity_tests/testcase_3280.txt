import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave81997 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Ave81997 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Ave59484 = tf.keras.layers.Input(shape=([1, 2]))

Ave81997 = keras.layers.Average(name = 'Ave81997', )([in0Ave81997,in1Ave81997])
Res46423 = keras.layers.Reshape((1, 2, 1), name = 'Res46423', )(Ave81997)
Ave59484 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave59484', )(in0Ave59484)
GRU76897 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU76897', )(Ave59484)
Res27883 = keras.layers.Reshape((2, 1), name = 'Res27883', )(GRU76897)
LST38325 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST38325', )(Res27883)
Res59462 = keras.layers.Reshape((1, 2, 1), name = 'Res59462', )(LST38325)
Ave21162 = keras.layers.Average(name = 'Ave21162', )([Res46423,Res59462])
model = tf.keras.models.Model(inputs=[in0Ave81997,in1Ave81997,in0Ave59484], outputs=Ave21162)
w = model.get_layer('GRU76897').get_weights() 
w[0] = np.array([[4, 7, 5, 1, 9, 3], [5, 8, 7, 1, 10, 1]])
w[1] = np.array([[8, 9, 1, 3, 5, 9], [8, 10, 3, 4, 3, 4]])
w[2] = np.array([10, 2, 5, 3, 10, 5])
model.get_layer('GRU76897').set_weights(w) 
w = model.get_layer('LST38325').get_weights() 
w[0] = np.array([[1, 2, 10, 1, 7, 9, 1, 8]])
w[1] = np.array([[10, 3, 5, 8, 6, 7, 7, 3], [6, 1, 2, 7, 5, 9, 6, 10]])
w[2] = np.array([3, 8, 4, 7, 1, 10, 3, 5])
model.get_layer('LST38325').set_weights(w) 
in0Ave81997 = tf.constant([[[[[0.6509]], [[0.8306]]]]])
in1Ave81997 = tf.constant([[[[[0.0087]], [[0.0354]]]]])
in0Ave59484 = tf.constant([[[1.5737, 1.6779]]])
print (np.array2string(model.predict([in0Ave81997,in1Ave81997,in0Ave59484],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave21162.png')

LAve81997 = average_layer([[[[[[0.6509]], [[0.8306]]]]], [[[[[0.0087]], [[0.0354]]]]]], Ave81997), 
LRes46423 = reshape_layer(Ave81997, [1, 2, 1], Res46423), 
LAve59484 = average_pooling1D_layer([[[1.5737, 1.6779]]], 1, Ave59484), 
LGRU76897 = gru_layer(Ave59484,[[4, 7, 5, 1, 9, 3], [5, 8, 7, 1, 10, 1]],[[8, 9, 1, 3, 5, 9], [8, 10, 3, 4, 3, 4]],[10, 2, 5, 3, 10, 5], false, GRU76897), 
LRes27883 = reshape_layer(GRU76897, [2, 1], Res27883), 
LLST38325 = lstm_layer(Res27883,[[1, 2, 10, 1, 7, 9, 1, 8]],[[10, 3, 5, 8, 6, 7, 7, 3], [6, 1, 2, 7, 5, 9, 6, 10]],[3, 8, 4, 7, 1, 10, 3, 5], LST38325), 
LRes59462 = reshape_layer(LST38325, [1, 2, 1], Res59462), 
LAve21162 = average_layer([Res46423,Res59462], Ave21162), 
exec_layers([LAve81997,LRes46423,LAve59484,LGRU76897,LRes27883,LLST38325,LRes59462,LAve21162],["Ave81997","Res46423","Ave59484","GRU76897","Res27883","LST38325","Res59462","Ave21162"],Ave21162,"Ave21162")

Actual (Unparsed): [[[[0.6341463], [0.6985007]]]]

Expected (Unparsed): [[[[0.6341462756463283],[0.6985007063119193]]]]

Actual:   [[[[0.6342], [0.6986]]]]

Expected: [[[[0.6342], [0.6986]]]]