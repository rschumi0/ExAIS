import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub65037 = tf.keras.layers.Input(shape=([3, 3, 3]))
in1Sub65037 = tf.keras.layers.Input(shape=([3, 3, 3]))

Sub65037 = keras.layers.Subtract(name = 'Sub65037', )([in0Sub65037,in1Sub65037])
Res44250 = keras.layers.Reshape((3, 9), name = 'Res44250', )(Sub65037)
GRU29191 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU29191', )(Res44250)
model = tf.keras.models.Model(inputs=[in0Sub65037,in1Sub65037], outputs=GRU29191)
w = model.get_layer('GRU29191').get_weights() 
w[0] = np.array([[3, 5, 9, 10, 9, 1], [6, 8, 2, 9, 10, 10], [5, 5, 3, 3, 3, 1], [9, 7, 4, 7, 6, 6], [5, 10, 9, 4, 7, 7], [3, 4, 10, 8, 8, 4], [6, 2, 10, 2, 1, 7], [7, 2, 6, 6, 2, 10], [1, 7, 2, 2, 3, 6]])
w[1] = np.array([[2, 2, 3, 3, 1, 3], [2, 10, 9, 10, 2, 6]])
w[2] = np.array([[5, 4, 5, 5, 6, 6], [3, 2, 4, 7, 2, 2]])
model.get_layer('GRU29191').set_weights(w) 
in0Sub65037 = tf.constant([[[[0.5968, 0.7876, 0.2918], [0.12, 0.7415, 0.8787], [0.6899, 0.1362, 0.0997]], [[0.1739, 0.2585, 0.6723], [0.434, 0.2248, 0.5285], [0.1334, 0.7239, 0.2539]], [[0.0959, 0.4372, 0.3932], [0.9021, 0.7378, 0.1769], [0.6059, 0.2552, 0.6021]]]])
in1Sub65037 = tf.constant([[[[0.4852, 0.8579, 0.8043], [0.2786, 0.0514, 0.8527], [0.7548, 0.1411, 0.4612]], [[0.3046, 0.0224, 0.3385], [0.4007, 0.8828, 0.3237], [0.2098, 0.2932, 0.9852]], [[0.0065, 0.6991, 0.6241], [0.4064, 0.6477, 0.5549], [0.5471, 0.2544, 0.9942]]]])
print (np.array2string(model.predict([in0Sub65037,in1Sub65037],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU29191.png')

LSub65037 = subtract_layer([[[[0.5968, 0.7876, 0.2918], [0.12, 0.7415, 0.8787], [0.6899, 0.1362, 0.0997]], [[0.1739, 0.2585, 0.6723], [0.434, 0.2248, 0.5285], [0.1334, 0.7239, 0.2539]], [[0.0959, 0.4372, 0.3932], [0.9021, 0.7378, 0.1769], [0.6059, 0.2552, 0.6021]]]], [[[[0.4852, 0.8579, 0.8043], [0.2786, 0.0514, 0.8527], [0.7548, 0.1411, 0.4612]], [[0.3046, 0.0224, 0.3385], [0.4007, 0.8828, 0.3237], [0.2098, 0.2932, 0.9852]], [[0.0065, 0.6991, 0.6241], [0.4064, 0.6477, 0.5549], [0.5471, 0.2544, 0.9942]]]], Sub65037), 
LRes44250 = reshape_layer(Sub65037, [3, 9], Res44250), 
LGRU29191 = gru_layer(Res44250,[[3, 5, 9, 10, 9, 1], [6, 8, 2, 9, 10, 10], [5, 5, 3, 3, 3, 1], [9, 7, 4, 7, 6, 6], [5, 10, 9, 4, 7, 7], [3, 4, 10, 8, 8, 4], [6, 2, 10, 2, 1, 7], [7, 2, 6, 6, 2, 10], [1, 7, 2, 2, 3, 6]],[[2, 2, 3, 3, 1, 3], [2, 10, 9, 10, 2, 6]],[[5, 4, 5, 5, 6, 6], [3, 2, 4, 7, 2, 2]], true, GRU29191), 
exec_layers([LSub65037,LRes44250,LGRU29191],["Sub65037","Res44250","GRU29191"],GRU29191,"GRU29191")

Actual (Unparsed): [[0.0013317, 0.7350283]]

Expected (Unparsed): [[0.0013316843979531729,0.7350283869153442]]

Actual:   [[0.0014, 0.7351]]

Expected: [[0.0014, 0.7351]]