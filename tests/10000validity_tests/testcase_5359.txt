import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave27497 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Ave27497 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con54447 = tf.keras.layers.Input(shape=([2]))
in0Add54071 = tf.keras.layers.Input(shape=([1, 1]))
in1Add54071 = tf.keras.layers.Input(shape=([1, 1]))

Ave27497 = keras.layers.Average(name = 'Ave27497', )([in0Ave27497,in1Ave27497])
Glo36935 = keras.layers.GlobalAveragePooling2D(name = 'Glo36935', )(Ave27497)
Con54447 = keras.layers.Concatenate(axis=1, name = 'Con54447', )([Glo36935,in0Con54447])
Add54071 = keras.layers.Add(name = 'Add54071', )([in0Add54071,in1Add54071])
LST3233 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST3233', )(Add54071)
Sub92463 = keras.layers.Subtract(name = 'Sub92463', )([Con54447,LST3233])
Lea55377 = keras.layers.LeakyReLU(alpha=6.147666630918498, name = 'Lea55377', )(Sub92463)
Res28321 = keras.layers.Reshape((3, 1), name = 'Res28321', )(Lea55377)
LST99402 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST99402', )(Res28321)
model = tf.keras.models.Model(inputs=[in0Ave27497,in1Ave27497,in0Con54447,in0Add54071,in1Add54071], outputs=LST99402)
w = model.get_layer('LST3233').get_weights() 
w[0] = np.array([[4, 2, 1, 8, 7, 7, 2, 9, 2, 7, 4, 8]])
w[1] = np.array([[8, 10, 7, 6, 8, 10, 4, 6, 5, 2, 7, 2], [5, 2, 2, 1, 4, 5, 5, 4, 2, 6, 9, 5], [7, 1, 6, 5, 2, 6, 7, 7, 2, 1, 7, 1]])
w[2] = np.array([10, 2, 3, 1, 7, 4, 10, 7, 9, 1, 6, 6])
model.get_layer('LST3233').set_weights(w) 
w = model.get_layer('LST99402').get_weights() 
w[0] = np.array([[9, 6, 4, 6, 6, 2, 10, 3, 4, 10, 7, 9]])
w[1] = np.array([[7, 4, 6, 2, 6, 9, 10, 10, 4, 3, 7, 9], [6, 5, 8, 10, 5, 7, 3, 3, 1, 3, 9, 1], [5, 1, 10, 9, 3, 8, 8, 8, 9, 10, 8, 1]])
w[2] = np.array([8, 2, 10, 9, 9, 10, 4, 10, 5, 7, 10, 4])
model.get_layer('LST99402').set_weights(w) 
in0Ave27497 = tf.constant([[[[0.8335], [0.9499]]]])
in1Ave27497 = tf.constant([[[[0.5749], [0.0634]]]])
in0Con54447 = tf.constant([[0.2342, 0.4409]])
in0Add54071 = tf.constant([[[0.2147]]])
in1Add54071 = tf.constant([[[0.7059]]])
print (np.array2string(model.predict([in0Ave27497,in1Ave27497,in0Con54447,in0Add54071,in1Add54071],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST99402.png')

LAve27497 = average_layer([[[[[0.8335], [0.9499]]]], [[[[0.5749], [0.0634]]]]], Ave27497), 
LGlo36935 = global_average_pooling2D_layer(Ave27497, Glo36935), 
LCon54447 = concatenate_layer([Glo36935,[[0.2342, 0.4409]]], 1, Con54447), 
LAdd54071 = add_layer([[[[0.2147]]], [[[0.7059]]]], Add54071), 
LLST3233 = lstm_layer(Add54071,[[4, 2, 1, 8, 7, 7, 2, 9, 2, 7, 4, 8]],[[8, 10, 7, 6, 8, 10, 4, 6, 5, 2, 7, 2], [5, 2, 2, 1, 4, 5, 5, 4, 2, 6, 9, 5], [7, 1, 6, 5, 2, 6, 7, 7, 2, 1, 7, 1]],[10, 2, 3, 1, 7, 4, 10, 7, 9, 1, 6, 6], LST3233), 
LSub92463 = subtract_layer(Con54447,LST3233, Sub92463), 
LLea55377 = leaky_relu_layer(Sub92463, 6.147666630918498, Lea55377), 
LRes28321 = reshape_layer(Lea55377, [3, 1], Res28321), 
LLST99402 = lstm_layer(Res28321,[[9, 6, 4, 6, 6, 2, 10, 3, 4, 10, 7, 9]],[[7, 4, 6, 2, 6, 9, 10, 10, 4, 3, 7, 9], [6, 5, 8, 10, 5, 7, 3, 3, 1, 3, 9, 1], [5, 1, 10, 9, 3, 8, 8, 8, 9, 10, 8, 1]],[8, 2, 10, 9, 9, 10, 4, 10, 5, 7, 10, 4], LST99402), 
exec_layers([LAve27497,LGlo36935,LCon54447,LAdd54071,LLST3233,LSub92463,LLea55377,LRes28321,LLST99402],["Ave27497","Glo36935","Con54447","Add54071","LST3233","Sub92463","Lea55377","Res28321","LST99402"],LST99402,"LST99402")

Actual (Unparsed): [[-0.0000000, 0.0000023, -0.0000003]]

Expected (Unparsed): [[-4.707685934762849e-10,2.2641199766084522e-6,-2.8343276275904285e-7]]

Actual:   [[-0, 0, -0]]

Expected: [[-0, 0, -0]]