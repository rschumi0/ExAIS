import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max47560 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Max47560 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Sub39138 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Sub39138 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Con66124 = tf.keras.layers.Input(shape=([2]))
in0Max35441 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Max35441 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con49414 = tf.keras.layers.Input(shape=([2]))

Max47560 = keras.layers.Maximum(name = 'Max47560', )([in0Max47560,in1Max47560])
Res14273 = keras.layers.Reshape((1, 2, 2), name = 'Res14273', )(Max47560)
Res82417 = keras.layers.Reshape((1, 4), name = 'Res82417', )(Res14273)
Fla89085 = keras.layers.Flatten(name = 'Fla89085', )(Res82417)
Sub39138 = keras.layers.Subtract(name = 'Sub39138', )([in0Sub39138,in1Sub39138])
Res63561 = keras.layers.Reshape((2, 2, 4), name = 'Res63561', )(Sub39138)
Res65370 = keras.layers.Reshape((2, 8), name = 'Res65370', )(Res63561)
Sim26946 = keras.layers.SimpleRNN(2,name = 'Sim26946', )(Res65370)
Con66124 = keras.layers.Concatenate(axis=1, name = 'Con66124', )([Sim26946,in0Con66124])
Add87388 = keras.layers.Add(name = 'Add87388', )([Fla89085,Con66124])
Max35441 = keras.layers.Maximum(name = 'Max35441', )([in0Max35441,in1Max35441])
Con25151 = keras.layers.Conv2DTranspose(4, (1, 1),strides=(5, 1), padding='same', name = 'Con25151', )(Max35441)
Res24306 = keras.layers.Reshape((10, 8), name = 'Res24306', )(Con25151)
LST42566 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST42566', )(Res24306)
Con49414 = keras.layers.Concatenate(axis=1, name = 'Con49414', )([LST42566,in0Con49414])
Max16304 = keras.layers.Maximum(name = 'Max16304', )([Add87388,Con49414])
model = tf.keras.models.Model(inputs=[in0Max47560,in1Max47560,in0Sub39138,in1Sub39138,in0Con66124,in0Max35441,in1Max35441,in0Con49414], outputs=Max16304)
w = model.get_layer('Sim26946').get_weights() 
w[0] = np.array([[1, 1], [6, 5], [10, 7], [10, 8], [10, 6], [1, 5], [2, 6], [7, 2]])
w[1] = np.array([[1, 2], [5, 1]])
w[2] = np.array([9, 8])
model.get_layer('Sim26946').set_weights(w) 
w = model.get_layer('Con25151').get_weights() 
w[0] = np.array([[[[0.2933], [0.586], [0.9267], [0.9915]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con25151').set_weights(w) 
w = model.get_layer('LST42566').get_weights() 
w[0] = np.array([[4, 1, 7, 7, 1, 3, 1, 1], [4, 1, 8, 3, 10, 1, 1, 8], [10, 3, 2, 3, 9, 5, 2, 6], [1, 3, 1, 4, 1, 6, 1, 5], [8, 1, 1, 3, 3, 1, 9, 4], [1, 8, 2, 3, 2, 1, 5, 8], [8, 2, 7, 3, 5, 3, 8, 6], [4, 10, 4, 4, 10, 3, 2, 5]])
w[1] = np.array([[9, 8, 7, 4, 6, 8, 8, 5], [10, 4, 1, 3, 6, 2, 1, 4]])
w[2] = np.array([1, 6, 9, 3, 3, 7, 6, 5])
model.get_layer('LST42566').set_weights(w) 
in0Max47560 = tf.constant([[[[[0.3917], [0.3188]], [[0.4287], [0.4005]]]]])
in1Max47560 = tf.constant([[[[[0.7995], [0.3756]], [[0.8097], [0.4942]]]]])
in0Sub39138 = tf.constant([[[[[0.8015, 0.1482], [0.89, 0.6571]], [[0.2585, 0.1936], [0.0885, 0.5316]]], [[[0.2794, 0.0127], [0.0259, 0.979]], [[0.1268, 0.1491], [0.7817, 0.4218]]]]])
in1Sub39138 = tf.constant([[[[[0.0659, 0.2633], [0.3313, 0.733]], [[0.3587, 0.8686], [0.1558, 0.3069]]], [[[0.1603, 0.8495], [0.1437, 0.084]], [[0.0315, 0.975], [0.9458, 0.5948]]]]])
in0Con66124 = tf.constant([[0.944, 0.0959]])
in0Max35441 = tf.constant([[[[0.1445], [0.3665]], [[0.8789], [0.5411]]]])
in1Max35441 = tf.constant([[[[0.0313], [0.2817]], [[0.3308], [0.0342]]]])
in0Con49414 = tf.constant([[0.5916, 0.401]])
print (np.array2string(model.predict([in0Max47560,in1Max47560,in0Sub39138,in1Sub39138,in0Con66124,in0Max35441,in1Max35441,in0Con49414],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max16304.png')

LMax47560 = maximum_layer([[[[[[0.3917], [0.3188]], [[0.4287], [0.4005]]]]], [[[[[0.7995], [0.3756]], [[0.8097], [0.4942]]]]]], Max47560), 
LRes14273 = reshape_layer(Max47560, [1, 2, 2], Res14273), 
LRes82417 = reshape_layer(Res14273, [1, 4], Res82417), 
LFla89085 = flatten_layer(Res82417, Fla89085), 
LSub39138 = subtract_layer([[[[[0.8015, 0.1482], [0.89, 0.6571]], [[0.2585, 0.1936], [0.0885, 0.5316]]], [[[0.2794, 0.0127], [0.0259, 0.979]], [[0.1268, 0.1491], [0.7817, 0.4218]]]]], [[[[[0.0659, 0.2633], [0.3313, 0.733]], [[0.3587, 0.8686], [0.1558, 0.3069]]], [[[0.1603, 0.8495], [0.1437, 0.084]], [[0.0315, 0.975], [0.9458, 0.5948]]]]], Sub39138), 
LRes63561 = reshape_layer(Sub39138, [2, 2, 4], Res63561), 
LRes65370 = reshape_layer(Res63561, [2, 8], Res65370), 
LSim26946 = simple_rnn_layer(Res65370,[[1, 1], [6, 5], [10, 7], [10, 8], [10, 6], [1, 5], [2, 6], [7, 2]],[[1, 2], [5, 1]],[9, 8], Sim26946), 
LCon66124 = concatenate_layer([Sim26946,[[0.944, 0.0959]]], 1, Con66124), 
LAdd87388 = add_layer([Fla89085,Con66124], Add87388), 
LMax35441 = maximum_layer([[[[[0.1445], [0.3665]], [[0.8789], [0.5411]]]], [[[[0.0313], [0.2817]], [[0.3308], [0.0342]]]]], Max35441), 
LCon25151 = conv2D_transpose_layer(Max35441, 1, 1,[[[[0.2933], [0.586], [0.9267], [0.9915]]]],[0, 0, 0, 0], 5, 1, true, Con25151), 
LRes24306 = reshape_layer(Con25151, [10, 8], Res24306), 
LLST42566 = lstm_layer(Res24306,[[4, 1, 7, 7, 1, 3, 1, 1], [4, 1, 8, 3, 10, 1, 1, 8], [10, 3, 2, 3, 9, 5, 2, 6], [1, 3, 1, 4, 1, 6, 1, 5], [8, 1, 1, 3, 3, 1, 9, 4], [1, 8, 2, 3, 2, 1, 5, 8], [8, 2, 7, 3, 5, 3, 8, 6], [4, 10, 4, 4, 10, 3, 2, 5]],[[9, 8, 7, 4, 6, 8, 8, 5], [10, 4, 1, 3, 6, 2, 1, 4]],[1, 6, 9, 3, 3, 7, 6, 5], LST42566), 
LCon49414 = concatenate_layer([LST42566,[[0.5916, 0.401]]], 1, Con49414), 
LMax16304 = maximum_layer([Add87388,Con49414], Max16304), 
exec_layers([LMax47560,LRes14273,LRes82417,LFla89085,LSub39138,LRes63561,LRes65370,LSim26946,LCon66124,LAdd87388,LMax35441,LCon25151,LRes24306,LLST42566,LCon49414,LMax16304],["Max47560","Res14273","Res82417","Fla89085","Sub39138","Res63561","Res65370","Sim26946","Con66124","Add87388","Max35441","Con25151","Res24306","LST42566","Con49414","Max16304"],Max16304,"Max16304")

Actual (Unparsed): [[1.7995000, 1.3755999, 1.7537000, 0.5901000]]

Expected (Unparsed): [[1.7994999999999899,1.3755998952041564,1.7536999999999998,0.5901]]

Actual:   [[1.7995, 1.3756, 1.7537, 0.5901]]

Expected: [[1.7995, 1.3756, 1.7537, 0.5901]]