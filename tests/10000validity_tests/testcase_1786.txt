import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot78492 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot78492 = tf.keras.layers.Input(shape=([2, 3]))
in0Mul12827 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Mul12827 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))

Dot78492 = keras.layers.Dot(axes=(2, 2), name = 'Dot78492', )([in0Dot78492,in1Dot78492])
Res43412 = keras.layers.Reshape((2, 2, 1), name = 'Res43412', )(Dot78492)
Mul12827 = keras.layers.Multiply(name = 'Mul12827', )([in0Mul12827,in1Mul12827])
Res11949 = keras.layers.Reshape((2, 2, 4), name = 'Res11949', )(Mul12827)
Res59208 = keras.layers.Reshape((2, 8), name = 'Res59208', )(Res11949)
LST27739 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST27739', )(Res59208)
Res2299 = keras.layers.Reshape((2, 1), name = 'Res2299', )(LST27739)
Res44999 = keras.layers.Reshape((2, 1, 1), name = 'Res44999', )(Res2299)
Max28859 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 3), padding='valid', name = 'Max28859', )(Res44999)
Zer75209 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer75209', )(Max28859)
Mul93441 = keras.layers.Multiply(name = 'Mul93441', )([Res43412,Zer75209])
Res72705 = keras.layers.Reshape((2, 2), name = 'Res72705', )(Mul93441)
Con34826 = keras.layers.Conv1D(2, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con34826', )(Res72705)
model = tf.keras.models.Model(inputs=[in0Dot78492,in1Dot78492,in0Mul12827,in1Mul12827], outputs=Con34826)
w = model.get_layer('LST27739').get_weights() 
w[0] = np.array([[8, 5, 5, 4, 5, 6, 10, 5], [8, 10, 5, 3, 4, 3, 8, 9], [3, 4, 4, 4, 3, 1, 8, 9], [2, 5, 4, 6, 1, 3, 9, 7], [8, 1, 9, 10, 9, 7, 7, 7], [7, 3, 2, 8, 10, 1, 7, 3], [9, 6, 1, 2, 2, 4, 7, 6], [4, 4, 8, 8, 7, 3, 7, 10]])
w[1] = np.array([[5, 2, 7, 1, 2, 2, 6, 5], [1, 8, 10, 2, 3, 8, 2, 3]])
w[2] = np.array([9, 8, 9, 6, 5, 10, 4, 8])
model.get_layer('LST27739').set_weights(w) 
w = model.get_layer('Con34826').get_weights() 
w[0] = np.array([[[0.328, 0.2055], [0.5023, 0.6626]]])
w[1] = np.array([0, 0])
model.get_layer('Con34826').set_weights(w) 
in0Dot78492 = tf.constant([[[0.4961, 0.3421, 0.9672], [0.6901, 0.9519, 0.2499]]])
in1Dot78492 = tf.constant([[[0.9896, 0.6919, 0.626], [0.6203, 0.9098, 0.156]]])
in0Mul12827 = tf.constant([[[[[0.3651, 0.6352], [0.5718, 0.8396]], [[0.1218, 0.6347], [0.6019, 0.9953]]], [[[0.9098, 0.9313], [0.509, 0.0448]], [[0.6139, 0.2976], [0.0333, 0.9528]]]]])
in1Mul12827 = tf.constant([[[[[0.8434, 0.678], [0.8838, 0.0255]], [[0.526, 0.1912], [0.3416, 0.3286]]], [[[0.3487, 0.156], [0.9425, 0.0375]], [[0.4695, 0.701], [0.6004, 0.8133]]]]])
print (np.array2string(model.predict([in0Dot78492,in1Dot78492,in0Mul12827,in1Mul12827],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con34826.png')

LDot78492 = dot_layer([[[0.4961, 0.3421, 0.9672], [0.6901, 0.9519, 0.2499]]], [[[0.9896, 0.6919, 0.626], [0.6203, 0.9098, 0.156]]], 2, 2, Dot78492), 
LRes43412 = reshape_layer(Dot78492, [2, 2, 1], Res43412), 
LMul12827 = multiply_layer([[[[[[0.3651, 0.6352], [0.5718, 0.8396]], [[0.1218, 0.6347], [0.6019, 0.9953]]], [[[0.9098, 0.9313], [0.509, 0.0448]], [[0.6139, 0.2976], [0.0333, 0.9528]]]]], [[[[[0.8434, 0.678], [0.8838, 0.0255]], [[0.526, 0.1912], [0.3416, 0.3286]]], [[[0.3487, 0.156], [0.9425, 0.0375]], [[0.4695, 0.701], [0.6004, 0.8133]]]]]], Mul12827), 
LRes11949 = reshape_layer(Mul12827, [2, 2, 4], Res11949), 
LRes59208 = reshape_layer(Res11949, [2, 8], Res59208), 
LLST27739 = lstm_layer(Res59208,[[8, 5, 5, 4, 5, 6, 10, 5], [8, 10, 5, 3, 4, 3, 8, 9], [3, 4, 4, 4, 3, 1, 8, 9], [2, 5, 4, 6, 1, 3, 9, 7], [8, 1, 9, 10, 9, 7, 7, 7], [7, 3, 2, 8, 10, 1, 7, 3], [9, 6, 1, 2, 2, 4, 7, 6], [4, 4, 8, 8, 7, 3, 7, 10]],[[5, 2, 7, 1, 2, 2, 6, 5], [1, 8, 10, 2, 3, 8, 2, 3]],[9, 8, 9, 6, 5, 10, 4, 8], LST27739), 
LRes2299 = reshape_layer(LST27739, [2, 1], Res2299), 
LRes44999 = reshape_layer(Res2299, [2, 1, 1], Res44999), 
LMax28859 = max_pool2D_layer(Res44999, 1, 1, 1, 3, false, Max28859), 
LZer75209 = zero_padding2D_layer(Max28859, 0, 0, 1, 0, Zer75209), 
LMul93441 = multiply_layer([Res43412,Zer75209], Mul93441), 
LRes72705 = reshape_layer(Mul93441, [2, 2], Res72705), 
LCon34826 = conv1D_layer(Res72705, 1,[[[0.328, 0.2055], [0.5023, 0.6626]]],[0, 0], 1, true, 1, Con34826), 
exec_layers([LDot78492,LRes43412,LMul12827,LRes11949,LRes59208,LLST27739,LRes2299,LRes44999,LMax28859,LZer75209,LMul93441,LRes72705,LCon34826],["Dot78492","Res43412","Mul12827","Res11949","Res59208","LST27739","Res2299","Res44999","Max28859","Zer75209","Mul93441","Res72705","Con34826"],Con34826,"Con34826")

Actual (Unparsed): [[[0.3727885, 0.4917572], [0.6455246, 0.8515321]]]

Expected (Unparsed): [[[0.37278847726108105,0.4917572069145775],[0.6455245674592681,0.8515321090951843]]]

Actual:   [[[0.3728, 0.4918], [0.6456, 0.8516]]]

Expected: [[[0.3728, 0.4918], [0.6456, 0.8516]]]