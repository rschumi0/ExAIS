import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul92626 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Mul92626 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in0Ave28157 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave28157 = tf.keras.layers.Input(shape=([1, 2]))

Mul92626 = keras.layers.Multiply(name = 'Mul92626', )([in0Mul92626,in1Mul92626])
Res84872 = keras.layers.Reshape((1, 1, 1), name = 'Res84872', )(Mul92626)
Res96947 = keras.layers.Reshape((1, 1), name = 'Res96947', )(Res84872)
Ave28157 = keras.layers.Average(name = 'Ave28157', )([in0Ave28157,in1Ave28157])
Den77997 = keras.layers.Dense(1,name = 'Den77997', )(Ave28157)
Bat26234 = keras.layers.BatchNormalization(axis=1, epsilon=0.26525521687961096,  name = 'Bat26234', )(Den77997)
Mul15170 = keras.layers.Multiply(name = 'Mul15170', )([Res96947,Bat26234])
Res52699 = keras.layers.Reshape((1, 1, 1), name = 'Res52699', )(Mul15170)
Ave32926 = keras.layers.AveragePooling2D(pool_size=(1, 1), name = 'Ave32926', )(Res52699)
model = tf.keras.models.Model(inputs=[in0Mul92626,in1Mul92626,in0Ave28157,in1Ave28157], outputs=Ave32926)
w = model.get_layer('Den77997').get_weights() 
w[0] = np.array([[0.9832], [0.8225]])
w[1] = np.array([0.214])
model.get_layer('Den77997').set_weights(w) 
w = model.get_layer('Bat26234').get_weights() 
w[0] = np.array([0.3814])
w[1] = np.array([0.574])
w[2] = np.array([0.4321])
w[3] = np.array([0.1574])
model.get_layer('Bat26234').set_weights(w) 
in0Mul92626 = tf.constant([[[[[0.126]]]]])
in1Mul92626 = tf.constant([[[[[0.9227]]]]])
in0Ave28157 = tf.constant([[[0.4632, 0.5948]]])
in1Ave28157 = tf.constant([[[0.1331, 0.3203]]])
print (np.array2string(model.predict([in0Mul92626,in1Mul92626,in0Ave28157,in1Ave28157],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave32926.png')

LMul92626 = multiply_layer([[[[[[0.126]]]]], [[[[[0.9227]]]]]], Mul92626), 
LRes84872 = reshape_layer(Mul92626, [1, 1, 1], Res84872), 
LRes96947 = reshape_layer(Res84872, [1, 1], Res96947), 
LAve28157 = average_layer([[[[0.4632, 0.5948]]], [[[0.1331, 0.3203]]]], Ave28157), 
LDen77997 = dense_layer(Ave28157, [[0.9832], [0.8225]],[0.214], Den77997), 
LBat26234 = batch_normalization_layer(Den77997, 1, 0.26525521687961096, [0.3814], [0.574], [0.4321], [0.1574], Bat26234), 
LMul15170 = multiply_layer([Res96947,Bat26234], Mul15170), 
LRes52699 = reshape_layer(Mul15170, [1, 1, 1], Res52699), 
LAve32926 = average_pooling2D_layer(Res52699, 1, 1, Ave32926), 
exec_layers([LMul92626,LRes84872,LRes96947,LAve28157,LDen77997,LBat26234,LMul15170,LRes52699,LAve32926],["Mul92626","Res84872","Res96947","Ave28157","Den77997","Bat26234","Mul15170","Res52699","Ave32926"],Ave32926,"Ave32926")

Actual (Unparsed): [[[[0.0975196]]]]

Expected (Unparsed): [[[[0.0975196236593628]]]]

Actual:   [[[[0.0976]]]]

Expected: [[[[0.0976]]]]