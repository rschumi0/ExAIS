import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Cro76293 = tf.keras.layers.Input(shape=([1, 4, 4]))
in0Max63658 = tf.keras.layers.Input(shape=([1, 1, 2]))

Cro76293 = keras.layers.Cropping2D(cropping=((0, 0), (2, 0)), name = 'Cro76293', )(in0Cro76293)
Res52482 = keras.layers.Reshape((1, 2, 4, 1), name = 'Res52482', )(Cro76293)
Max63658 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max63658', )(in0Max63658)
Bat76305 = keras.layers.BatchNormalization(axis=2, epsilon=0.8763149729821773,  name = 'Bat76305', )(Max63658)
Res48448 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res48448', )(Bat76305)
Cro89356 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro89356', )(Res48448)
Zer32888 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (2, 0)), name = 'Zer32888', )(Cro89356)
Min78384 = keras.layers.Minimum(name = 'Min78384', )([Res52482,Zer32888])
Res40402 = keras.layers.Reshape((1, 2, 4), name = 'Res40402', )(Min78384)
Res60791 = keras.layers.Reshape((1, 8), name = 'Res60791', )(Res40402)
Loc45065 = keras.layers.LocallyConnected1D(4, (1),strides=(1), name = 'Loc45065', )(Res60791)
model = tf.keras.models.Model(inputs=[in0Cro76293,in0Max63658], outputs=Loc45065)
w = model.get_layer('Bat76305').get_weights() 
w[0] = np.array([0.336])
w[1] = np.array([0.672])
w[2] = np.array([0.2291])
w[3] = np.array([0.6239])
model.get_layer('Bat76305').set_weights(w) 
w = model.get_layer('Loc45065').get_weights() 
w[0] = np.array([[[0.9785, 0.0441, 0.2753, 0.9768], [0.0235, 0.526, 0.8962, 0.9059], [0.4143, 0.2165, 0.4305, 0.254], [0.5771, 0.4528, 0.396, 0.4879], [0.7205, 0.3143, 0.4462, 0.5764], [0.4864, 0.4944, 0.1123, 0.0844], [0.2996, 0.1557, 0.2109, 0.1736], [0.7114, 0.1904, 0.324, 0.5098]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc45065').set_weights(w) 
in0Cro76293 = tf.constant([[[[1.0874, 1.4178, 1.7398, 1.2592], [1.2797, 1.3922, 1.8885, 1.8206], [1.5011, 1.3764, 1.7092, 1.9918], [1.7633, 1.1129, 1.7973, 1.9991]]]])
in0Max63658 = tf.constant([[[[1.4035, 1.6269]]]])
print (np.array2string(model.predict([in0Cro76293,in0Max63658],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc45065.png')

LCro76293 = cropping2D_layer([[[[1.0874, 1.4178, 1.7398, 1.2592], [1.2797, 1.3922, 1.8885, 1.8206], [1.5011, 1.3764, 1.7092, 1.9918], [1.7633, 1.1129, 1.7973, 1.9991]]]], 0, 0, 2, 0, Cro76293), 
LRes52482 = reshape_layer(Cro76293, [1, 2, 4, 1], Res52482), 
LMax63658 = max_pool2D_layer([[[[1.4035, 1.6269]]]], 1, 1, Max63658), 
LBat76305 = batch_normalization_layer(Max63658, 2, 0.8763149729821773, [0.336], [0.672], [0.2291], [0.6239], Bat76305), 
LRes48448 = reshape_layer(Bat76305, [1, 1, 2, 1], Res48448), 
LCro89356 = cropping3D_layer(Res48448, 0, 0, 0, 0, 0, 0, Cro89356), 
LZer32888 = zero_padding3D_layer(Cro89356, 0, 0, 1, 0, 2, 0, Zer32888), 
LMin78384 = minimum_layer([Res52482,Zer32888], Min78384), 
LRes40402 = reshape_layer(Min78384, [1, 2, 4], Res40402), 
LRes60791 = reshape_layer(Res40402, [1, 8], Res60791), 
LLoc45065 = locally_connected1D_layer(Res60791, 1,[[[0.9785, 0.0441, 0.2753, 0.9768], [0.0235, 0.526, 0.8962, 0.9059], [0.4143, 0.2165, 0.4305, 0.254], [0.5771, 0.4528, 0.396, 0.4879], [0.7205, 0.3143, 0.4462, 0.5764], [0.4864, 0.4944, 0.1123, 0.0844], [0.2996, 0.1557, 0.2109, 0.1736], [0.7114, 0.1904, 0.324, 0.5098]]],[[0, 0, 0, 0]], 1, Loc45065), 
exec_layers([LCro76293,LRes52482,LMax63658,LBat76305,LRes48448,LCro89356,LZer32888,LMin78384,LRes40402,LRes60791,LLoc45065],["Cro76293","Res52482","Max63658","Bat76305","Res48448","Cro89356","Zer32888","Min78384","Res40402","Res60791","Loc45065"],Loc45065,"Loc45065")

Actual (Unparsed): [[[1.0486983, 0.3557490, 0.5516349, 0.7106549]]]

Expected (Unparsed): [[[1.0486982729219316,0.35574899759603174,0.5516348956425021,0.7106549522011124]]]

Actual:   [[[1.0487, 0.3558, 0.5517, 0.7107]]]

Expected: [[[1.0487, 0.3558, 0.5517, 0.7107]]]