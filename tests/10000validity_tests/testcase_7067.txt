import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max65568 = tf.keras.layers.Input(shape=([2, 2]))
in1Max65568 = tf.keras.layers.Input(shape=([2, 2]))
in0Con66276 = tf.keras.layers.Input(shape=([2, 2, 3]))
in0Mul14425 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Mul14425 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Min23222 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Min23222 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con89675 = tf.keras.layers.Input(shape=([2, 2, 3]))

Max65568 = keras.layers.Maximum(name = 'Max65568', )([in0Max65568,in1Max65568])
Res47849 = keras.layers.Reshape((2, 2, 1), name = 'Res47849', )(Max65568)
Zer52920 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer52920', )(Res47849)
Max3156 = keras.layers.MaxPool2D(pool_size=(2, 2), name = 'Max3156', )(Zer52920)
Con66276 = keras.layers.Concatenate(axis=3, name = 'Con66276', )([Max3156,in0Con66276])
Mul14425 = keras.layers.Multiply(name = 'Mul14425', )([in0Mul14425,in1Mul14425])
Con31211 = keras.layers.Conv2DTranspose(4, (1, 1),strides=(1, 1), padding='same', name = 'Con31211', )(Mul14425)
Zer88958 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer88958', )(Con31211)
Mul55756 = keras.layers.Multiply(name = 'Mul55756', )([Con66276,Zer88958])
Min23222 = keras.layers.Minimum(name = 'Min23222', )([in0Min23222,in1Min23222])
Zer12093 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer12093', )(Min23222)
Con89675 = keras.layers.Concatenate(axis=3, name = 'Con89675', )([Zer12093,in0Con89675])
Add84741 = keras.layers.Add(name = 'Add84741', )([Mul55756,Con89675])
model = tf.keras.models.Model(inputs=[in0Max65568,in1Max65568,in0Con66276,in0Mul14425,in1Mul14425,in0Min23222,in1Min23222,in0Con89675], outputs=Add84741)
w = model.get_layer('Con31211').get_weights() 
w[0] = np.array([[[[0.5906], [0.0163], [0.9544], [0.551]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con31211').set_weights(w) 
in0Max65568 = tf.constant([[[0.7568, 0.1046], [0.1302, 0.3012]]])
in1Max65568 = tf.constant([[[0.5572, 0.344], [0.742, 0.8484]]])
in0Con66276 = tf.constant([[[[0.1979, 0.26, 0.2804], [0.2197, 0.8966, 0.0122]], [[0.3981, 0.952, 0.0153], [0.3341, 0.0827, 0.6254]]]])
in0Mul14425 = tf.constant([[[[0.0015]]]])
in1Mul14425 = tf.constant([[[[0.9593]]]])
in0Min23222 = tf.constant([[[[0.196], [0.2767]]]])
in1Min23222 = tf.constant([[[[0.7122], [0.6675]]]])
in0Con89675 = tf.constant([[[[0.5118, 0.6359, 0.7098], [0.4923, 0.4046, 0.8692]], [[0.2543, 0.4795, 0.7471], [0.2718, 0.1148, 0.8794]]]])
print (np.array2string(model.predict([in0Max65568,in1Max65568,in0Con66276,in0Mul14425,in1Mul14425,in0Min23222,in1Min23222,in0Con89675],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add84741.png')

LMax65568 = maximum_layer([[[[0.7568, 0.1046], [0.1302, 0.3012]]], [[[0.5572, 0.344], [0.742, 0.8484]]]], Max65568), 
LRes47849 = reshape_layer(Max65568, [2, 2, 1], Res47849), 
LZer52920 = zero_padding2D_layer(Res47849, 1, 1, 1, 1, Zer52920), 
LMax3156 = max_pool2D_layer(Zer52920, 2, 2, Max3156), 
LCon66276 = concatenate_layer([Max3156,[[[[0.1979, 0.26, 0.2804], [0.2197, 0.8966, 0.0122]], [[0.3981, 0.952, 0.0153], [0.3341, 0.0827, 0.6254]]]]], 3, Con66276), 
LMul14425 = multiply_layer([[[[[0.0015]]]], [[[[0.9593]]]]], Mul14425), 
LCon31211 = conv2D_transpose_layer(Mul14425, 1, 1,[[[[0.5906], [0.0163], [0.9544], [0.551]]]],[0, 0, 0, 0], 1, 1, true, Con31211), 
LZer88958 = zero_padding2D_layer(Con31211, 1, 0, 1, 0, Zer88958), 
LMul55756 = multiply_layer([Con66276,Zer88958], Mul55756), 
LMin23222 = minimum_layer([[[[[0.196], [0.2767]]]], [[[[0.7122], [0.6675]]]]], Min23222), 
LZer12093 = zero_padding2D_layer(Min23222, 1, 0, 0, 0, Zer12093), 
LCon89675 = concatenate_layer([Zer12093,[[[[0.5118, 0.6359, 0.7098], [0.4923, 0.4046, 0.8692]], [[0.2543, 0.4795, 0.7471], [0.2718, 0.1148, 0.8794]]]]], 3, Con89675), 
LAdd84741 = add_layer([Mul55756,Con89675], Add84741), 
exec_layers([LMax65568,LRes47849,LZer52920,LMax3156,LCon66276,LMul14425,LCon31211,LZer88958,LMul55756,LMin23222,LZer12093,LCon89675,LAdd84741],["Max65568","Res47849","Zer52920","Max3156","Con66276","Mul14425","Con31211","Zer88958","Mul55756","Min23222","Zer12093","Con89675","Add84741"],Add84741,"Add84741")

Actual (Unparsed): [[[[0.0000000, 0.5118000, 0.6359000, 0.7098000], [0.0000000, 0.4923000, 0.4046000, 0.8692000]], [[0.1960000, 0.2543000, 0.4795000, 0.7471000], [0.2774210, 0.2718078, 0.1149136, 0.8798959]]]]

Expected (Unparsed): [[[[0.0,0.5118,0.6359,0.7098],[0.0,0.4923,0.4046,0.8692]],[[0.196,0.2543,0.4795,0.7471],[0.277421007539308,0.2718078362770785,0.114913574711876,0.8798958555508299]]]]

Actual:   [[[[0, 0.5118, 0.6359, 0.7098], [0, 0.4923, 0.4046, 0.8692]], [[0.196, 0.2543, 0.4795, 0.7471], [0.2775, 0.2719, 0.115, 0.8799]]]]

Expected: [[[[0, 0.5118, 0.6359, 0.7098], [0, 0.4923, 0.4046, 0.8692]], [[0.196, 0.2543, 0.4795, 0.7471], [0.2775, 0.2719, 0.115, 0.8799]]]]