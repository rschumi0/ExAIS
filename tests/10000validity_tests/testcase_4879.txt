import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave89369 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave89369 = tf.keras.layers.Input(shape=([1, 2]))
in0Con64123 = tf.keras.layers.Input(shape=([3, 1]))
in0Dot69003 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot69003 = tf.keras.layers.Input(shape=([2, 3]))

Ave89369 = keras.layers.Average(name = 'Ave89369', )([in0Ave89369,in1Ave89369])
Res88536 = keras.layers.Reshape((1, 2, 1), name = 'Res88536', )(Ave89369)
Res98491 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res98491', )(Res88536)
Con73138 = keras.layers.Conv3D(2, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con73138', )(Res98491)
Res66747 = keras.layers.Reshape((1, 2, 2), name = 'Res66747', )(Con73138)
Res21732 = keras.layers.Reshape((1, 4), name = 'Res21732', )(Res66747)
Con97489 = keras.layers.Conv1D(2, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con97489', )(Res21732)
Zer45213 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer45213', )(Con97489)
Con64123 = keras.layers.Concatenate(axis=2, name = 'Con64123', )([Zer45213,in0Con64123])
Dot69003 = keras.layers.Dot(axes=(1, 1), name = 'Dot69003', )([in0Dot69003,in1Dot69003])
Sub70818 = keras.layers.Subtract(name = 'Sub70818', )([Con64123,Dot69003])
Res94532 = keras.layers.Reshape((3, 3, 1), name = 'Res94532', )(Sub70818)
Res56195 = keras.layers.Reshape((3, 3, 1, 1), name = 'Res56195', )(Res94532)
Glo6351 = keras.layers.GlobalMaxPool3D(name = 'Glo6351', )(Res56195)
model = tf.keras.models.Model(inputs=[in0Ave89369,in1Ave89369,in0Con64123,in0Dot69003,in1Dot69003], outputs=Glo6351)
w = model.get_layer('Con73138').get_weights() 
w[0] = np.array([[[[[0.3072, 0.9044]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con73138').set_weights(w) 
w = model.get_layer('Con97489').get_weights() 
w[0] = np.array([[[0.3942, 0.0473], [0.1009, 0.4672], [0.4751, 0.0945], [0.1962, 0.4446]]])
w[1] = np.array([0, 0])
model.get_layer('Con97489').set_weights(w) 
in0Ave89369 = tf.constant([[[0.095, 0.77]]])
in1Ave89369 = tf.constant([[[0.1548, 0.1322]]])
in0Con64123 = tf.constant([[[0.506], [0.2465], [0.401]]])
in0Dot69003 = tf.constant([[[0.6903, 0.7522, 0.813], [0.268, 0.2886, 0.073]]])
in1Dot69003 = tf.constant([[[0.8521, 0.3468, 0.2301], [0.4046, 0.5899, 0.3887]]])
print (np.array2string(model.predict([in0Ave89369,in1Ave89369,in0Con64123,in0Dot69003,in1Dot69003],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo6351.png')

LAve89369 = average_layer([[[[0.095, 0.77]]], [[[0.1548, 0.1322]]]], Ave89369), 
LRes88536 = reshape_layer(Ave89369, [1, 2, 1], Res88536), 
LRes98491 = reshape_layer(Res88536, [1, 2, 1, 1], Res98491), 
LCon73138 = conv3D_layer(Res98491, 1, 1, 1,[[[[[0.3072, 0.9044]]]]],[0, 0], 1, 1, 1, false, 1, 1, 1, Con73138), 
LRes66747 = reshape_layer(Con73138, [1, 2, 2], Res66747), 
LRes21732 = reshape_layer(Res66747, [1, 4], Res21732), 
LCon97489 = conv1D_layer(Res21732, 1,[[[0.3942, 0.0473], [0.1009, 0.4672], [0.4751, 0.0945], [0.1962, 0.4446]]],[0, 0], 1, true, 1, Con97489), 
LZer45213 = zero_padding1D_layer(Con97489, 2, 0, Zer45213), 
LCon64123 = concatenate_layer([Zer45213,[[[0.506], [0.2465], [0.401]]]], 2, Con64123), 
LDot69003 = dot_layer([[[0.6903, 0.7522, 0.813], [0.268, 0.2886, 0.073]]], [[[0.8521, 0.3468, 0.2301], [0.4046, 0.5899, 0.3887]]], 1, 1, Dot69003), 
LSub70818 = subtract_layer(Con64123,Dot69003, Sub70818), 
LRes94532 = reshape_layer(Sub70818, [3, 3, 1], Res94532), 
LRes56195 = reshape_layer(Res94532, [3, 3, 1, 1], Res56195), 
LGlo6351 = global_max_pool3D_layer(Res56195, Glo6351), 
exec_layers([LAve89369,LRes88536,LRes98491,LCon73138,LRes66747,LRes21732,LCon97489,LZer45213,LCon64123,LDot69003,LSub70818,LRes94532,LRes56195,LGlo6351],["Ave89369","Res88536","Res98491","Con73138","Res66747","Res21732","Con97489","Zer45213","Con64123","Dot69003","Sub70818","Res94532","Res56195","Glo6351"],Glo6351,"Glo6351")

Actual (Unparsed): [[0.2429903]]

Expected (Unparsed): [[0.24299037]]

Actual:   [[0.243]]

Expected: [[0.243]]