import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave62951 = tf.keras.layers.Input(shape=([1, 1]))
in1Ave62951 = tf.keras.layers.Input(shape=([1, 1]))
in0Con42484 = tf.keras.layers.Input(shape=([5, 1]))
in0Zer75766 = tf.keras.layers.Input(shape=([3, 4]))
in0Mul1767 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul1767 = tf.keras.layers.Input(shape=([2, 2]))
in0Con7408 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Ave92914 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Ave92914 = tf.keras.layers.Input(shape=([2, 2, 2]))

Ave62951 = keras.layers.Average(name = 'Ave62951', )([in0Ave62951,in1Ave62951])
Res47628 = keras.layers.Reshape((1, 1, 1), name = 'Res47628', )(Ave62951)
Glo84036 = keras.layers.GlobalAveragePooling2D(name = 'Glo84036', )(Res47628)
Res26624 = keras.layers.Reshape((1, 1), name = 'Res26624', )(Glo84036)
Zer51740 = keras.layers.ZeroPadding1D(padding=((4, 0)), name = 'Zer51740', )(Res26624)
Con42484 = keras.layers.Concatenate(axis=2, name = 'Con42484', )([Zer51740,in0Con42484])
Zer75766 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer75766', )(in0Zer75766)
Mul1767 = keras.layers.Multiply(name = 'Mul1767', )([in0Mul1767,in1Mul1767])
Res85871 = keras.layers.Reshape((2, 2, 1), name = 'Res85871', )(Mul1767)
Con7408 = keras.layers.Concatenate(axis=3, name = 'Con7408', )([Res85871,in0Con7408])
Ave92914 = keras.layers.Average(name = 'Ave92914', )([in0Ave92914,in1Ave92914])
Ave65658 = keras.layers.Average(name = 'Ave65658', )([Con7408,Ave92914])
Res3214 = keras.layers.Reshape((2, 4), name = 'Res3214', )(Ave65658)
Dot78169 = keras.layers.Dot(axes=(2, 2), name = 'Dot78169', )([Zer75766,Res3214])
Ave43935 = keras.layers.Average(name = 'Ave43935', )([Con42484,Dot78169])
model = tf.keras.models.Model(inputs=[in0Ave62951,in1Ave62951,in0Con42484,in0Zer75766,in0Mul1767,in1Mul1767,in0Con7408,in0Ave92914,in1Ave92914], outputs=Ave43935)
in0Ave62951 = tf.constant([[[0.506]]])
in1Ave62951 = tf.constant([[[0.4784]]])
in0Con42484 = tf.constant([[[0.3115], [0.48], [0.0853], [0.8588], [0.6328]]])
in0Zer75766 = tf.constant([[[1.9168, 1.6307, 1.1017, 1.4418], [1.0953, 1.1492, 1.487, 1.678], [1.2704, 1.8349, 1.2769, 1.2137]]])
in0Mul1767 = tf.constant([[[0.9445, 0.7797], [0.7812, 0.4002]]])
in1Mul1767 = tf.constant([[[0.0212, 0.5869], [0.9229, 0.1201]]])
in0Con7408 = tf.constant([[[[0.1924], [0.4476]], [[0.1978], [0.7834]]]])
in0Ave92914 = tf.constant([[[[0.3895, 0.1016], [0.0609, 0.9537]], [[0.3456, 0.4038], [0.6397, 0.1121]]]])
in1Ave92914 = tf.constant([[[[0.0041, 0.1663], [0.088, 0.6344]], [[0.0504, 0.999], [0.5378, 0.9469]]]])
print (np.array2string(model.predict([in0Ave62951,in1Ave62951,in0Con42484,in0Zer75766,in0Mul1767,in1Mul1767,in0Con7408,in0Ave92914,in1Ave92914],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave43935.png')

LAve62951 = average_layer([[[[0.506]]], [[[0.4784]]]], Ave62951), 
LRes47628 = reshape_layer(Ave62951, [1, 1, 1], Res47628), 
LGlo84036 = global_average_pooling2D_layer(Res47628, Glo84036), 
LRes26624 = reshape_layer(Glo84036, [1, 1], Res26624), 
LZer51740 = zero_padding1D_layer(Res26624, 4, 0, Zer51740), 
LCon42484 = concatenate_layer([Zer51740,[[[0.3115], [0.48], [0.0853], [0.8588], [0.6328]]]], 2, Con42484), 
LZer75766 = zero_padding1D_layer([[[1.9168, 1.6307, 1.1017, 1.4418], [1.0953, 1.1492, 1.487, 1.678], [1.2704, 1.8349, 1.2769, 1.2137]]], 1, 1, Zer75766), 
LMul1767 = multiply_layer([[[[0.9445, 0.7797], [0.7812, 0.4002]]], [[[0.0212, 0.5869], [0.9229, 0.1201]]]], Mul1767), 
LRes85871 = reshape_layer(Mul1767, [2, 2, 1], Res85871), 
LCon7408 = concatenate_layer([Res85871,[[[[0.1924], [0.4476]], [[0.1978], [0.7834]]]]], 3, Con7408), 
LAve92914 = average_layer([[[[[0.3895, 0.1016], [0.0609, 0.9537]], [[0.3456, 0.4038], [0.6397, 0.1121]]]], [[[[0.0041, 0.1663], [0.088, 0.6344]], [[0.0504, 0.999], [0.5378, 0.9469]]]]], Ave92914), 
LAve65658 = average_layer([Con7408,Ave92914], Ave65658), 
LRes3214 = reshape_layer(Ave65658, [2, 4], Res3214), 
LDot78169 = dot_layer(Zer75766,Res3214, 2, 2, Dot78169), 
LAve43935 = average_layer([Con42484,Dot78169], Ave43935), 
exec_layers([LAve62951,LRes47628,LGlo84036,LRes26624,LZer51740,LCon42484,LZer75766,LMul1767,LRes85871,LCon7408,LAve92914,LAve65658,LRes3214,LDot78169,LAve43935],["Ave62951","Res47628","Glo84036","Res26624","Zer51740","Con42484","Zer75766","Mul1767","Res85871","Con7408","Ave92914","Ave65658","Res3214","Dot78169","Ave43935"],Ave43935,"Ave43935")

Actual (Unparsed): [[[0.0000000, 0.1557500], [0.8310407, 1.6955808], [0.8717960, 1.3401241], [0.7651612, 1.7354039], [0.2461000, 0.3164000]]]

Expected (Unparsed): [[[0.0,0.15575],[0.83104075655025,1.6955808412745002],[0.8717959894824999,1.340124139796],[0.76516122109425,1.7354038648825],[0.24609999999999999,0.3164]]]

Actual:   [[[0, 0.1558], [0.8311, 1.6956], [0.8718, 1.3402], [0.7652, 1.7355], [0.2461, 0.3164]]]

Expected: [[[0, 0.1558], [0.8311, 1.6956], [0.8718, 1.3402], [0.7652, 1.7355], [0.2461, 0.3164]]]