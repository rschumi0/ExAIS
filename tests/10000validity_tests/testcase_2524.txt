import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max91888 = tf.keras.layers.Input(shape=([1, 2]))
in1Max91888 = tf.keras.layers.Input(shape=([1, 2]))
in0Mul3697 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Mul3697 = tf.keras.layers.Input(shape=([1, 1, 2]))

Max91888 = keras.layers.Maximum(name = 'Max91888', )([in0Max91888,in1Max91888])
Res32205 = keras.layers.Reshape((1, 2, 1), name = 'Res32205', )(Max91888)
Con88903 = keras.layers.Conv2D(4, (1, 1),strides=(1, 4), padding='same', dilation_rate=(1, 1), name = 'Con88903', )(Res32205)
Res51533 = keras.layers.Reshape((1, 4), name = 'Res51533', )(Con88903)
Glo34905 = keras.layers.GlobalAveragePooling1D(name = 'Glo34905', )(Res51533)
Res36890 = keras.layers.Reshape((4, 1), name = 'Res36890', )(Glo34905)
Res50975 = keras.layers.Reshape((4, 1, 1), name = 'Res50975', )(Res36890)
Res78382 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res78382', )(Res50975)
Zer27341 = keras.layers.ZeroPadding3D(padding=((0, 0), (4, 0), (6, 0)), name = 'Zer27341', )(Res78382)
Mul3697 = keras.layers.Multiply(name = 'Mul3697', )([in0Mul3697,in1Mul3697])
Bat63828 = keras.layers.BatchNormalization(axis=1, epsilon=0.8082718379484799,  name = 'Bat63828', )(Mul3697)
Res81515 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res81515', )(Bat63828)
Zer54642 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer54642', )(Res81515)
Lea89728 = keras.layers.LeakyReLU(alpha=0.5791956177664978, name = 'Lea89728', )(Zer54642)
Zer79941 = keras.layers.ZeroPadding3D(padding=((1, 0), (2, 0), (3, 0)), name = 'Zer79941', )(Lea89728)
Sub96482 = keras.layers.Subtract(name = 'Sub96482', )([Zer27341,Zer79941])
Res76813 = keras.layers.Reshape((4, 5, 7), name = 'Res76813', )(Sub96482)
Res50402 = keras.layers.Reshape((4, 35), name = 'Res50402', )(Res76813)
GRU57546 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU57546', )(Res50402)
model = tf.keras.models.Model(inputs=[in0Max91888,in1Max91888,in0Mul3697,in1Mul3697], outputs=GRU57546)
w = model.get_layer('Con88903').get_weights() 
w[0] = np.array([[[[0.5267, 0.8201, 0.6958, 0.746]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con88903').set_weights(w) 
w = model.get_layer('Bat63828').get_weights() 
w[0] = np.array([0.5926])
w[1] = np.array([0.1779])
w[2] = np.array([0.2812])
w[3] = np.array([0.7396])
model.get_layer('Bat63828').set_weights(w) 
w = model.get_layer('GRU57546').get_weights() 
w[0] = np.array([[1, 8, 6], [7, 1, 6], [5, 1, 10], [9, 9, 10], [1, 8, 2], [9, 4, 2], [2, 6, 7], [3, 7, 9], [10, 9, 8], [4, 4, 9], [9, 1, 8], [8, 5, 5], [4, 5, 8], [2, 8, 9], [1, 1, 9], [3, 4, 4], [4, 6, 8], [5, 2, 4], [8, 9, 3], [1, 10, 1], [2, 10, 9], [8, 9, 5], [1, 3, 4], [9, 5, 6], [1, 7, 2], [2, 4, 6], [2, 7, 5], [9, 9, 10], [5, 3, 8], [1, 2, 2], [5, 8, 10], [7, 9, 3], [10, 1, 4], [10, 6, 5], [6, 10, 9]])
w[1] = np.array([[7, 6, 9]])
w[2] = np.array([[4, 3, 8], [4, 7, 5]])
model.get_layer('GRU57546').set_weights(w) 
in0Max91888 = tf.constant([[[0.1559, 0.1148]]])
in1Max91888 = tf.constant([[[0.5201, 0.9162]]])
in0Mul3697 = tf.constant([[[[0.0716, 0.7919]]]])
in1Mul3697 = tf.constant([[[[0.8236, 0.3216]]]])
print (np.array2string(model.predict([in0Max91888,in1Max91888,in0Mul3697,in1Mul3697],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU57546.png')

LMax91888 = maximum_layer([[[[0.1559, 0.1148]]], [[[0.5201, 0.9162]]]], Max91888), 
LRes32205 = reshape_layer(Max91888, [1, 2, 1], Res32205), 
LCon88903 = conv2D_layer(Res32205, 1, 1,[[[[0.5267, 0.8201, 0.6958, 0.746]]]],[0, 0, 0, 0], 1, 4, true, 1, 1, Con88903), 
LRes51533 = reshape_layer(Con88903, [1, 4], Res51533), 
LGlo34905 = global_average_pooling1D_layer(Res51533, Glo34905), 
LRes36890 = reshape_layer(Glo34905, [4, 1], Res36890), 
LRes50975 = reshape_layer(Res36890, [4, 1, 1], Res50975), 
LRes78382 = reshape_layer(Res50975, [4, 1, 1, 1], Res78382), 
LZer27341 = zero_padding3D_layer(Res78382, 0, 0, 4, 0, 6, 0, Zer27341), 
LMul3697 = multiply_layer([[[[[0.0716, 0.7919]]]], [[[[0.8236, 0.3216]]]]], Mul3697), 
LBat63828 = batch_normalization_layer(Mul3697, 1, 0.8082718379484799, [0.5926], [0.1779], [0.2812], [0.7396], Bat63828), 
LRes81515 = reshape_layer(Bat63828, [1, 1, 2, 1], Res81515), 
LZer54642 = zero_padding3D_layer(Res81515, 1, 1, 1, 1, 1, 1, Zer54642), 
LLea89728 = leaky_relu_layer(Zer54642, 0.5791956177664978, Lea89728), 
LZer79941 = zero_padding3D_layer(Lea89728, 1, 0, 2, 0, 3, 0, Zer79941), 
LSub96482 = subtract_layer(Zer27341,Zer79941, Sub96482), 
LRes76813 = reshape_layer(Sub96482, [4, 5, 7], Res76813), 
LRes50402 = reshape_layer(Res76813, [4, 35], Res50402), 
LGRU57546 = gru_layer(Res50402,[[1, 8, 6], [7, 1, 6], [5, 1, 10], [9, 9, 10], [1, 8, 2], [9, 4, 2], [2, 6, 7], [3, 7, 9], [10, 9, 8], [4, 4, 9], [9, 1, 8], [8, 5, 5], [4, 5, 8], [2, 8, 9], [1, 1, 9], [3, 4, 4], [4, 6, 8], [5, 2, 4], [8, 9, 3], [1, 10, 1], [2, 10, 9], [8, 9, 5], [1, 3, 4], [9, 5, 6], [1, 7, 2], [2, 4, 6], [2, 7, 5], [9, 9, 10], [5, 3, 8], [1, 2, 2], [5, 8, 10], [7, 9, 3], [10, 1, 4], [10, 6, 5], [6, 10, 9]],[[7, 6, 9]],[[4, 3, 8], [4, 7, 5]], true, GRU57546), 
exec_layers([LMax91888,LRes32205,LCon88903,LRes51533,LGlo34905,LRes36890,LRes50975,LRes78382,LZer27341,LMul3697,LBat63828,LRes81515,LZer54642,LLea89728,LZer79941,LSub96482,LRes76813,LRes50402,LGRU57546],["Max91888","Res32205","Con88903","Res51533","Glo34905","Res36890","Res50975","Res78382","Zer27341","Mul3697","Bat63828","Res81515","Zer54642","Lea89728","Zer79941","Sub96482","Res76813","Res50402","GRU57546"],GRU57546,"GRU57546")

Actual (Unparsed): [[0.0001849]]

Expected (Unparsed): [[0.00018487627400185977]]

Actual:   [[0.0002]]

Expected: [[0.0002]]