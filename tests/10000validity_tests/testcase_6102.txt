import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Zer2189 = tf.keras.layers.Input(shape=([1, 1, 3]))
in0Min31599 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Min31599 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))

Zer2189 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer2189', )(in0Zer2189)
Res28106 = keras.layers.Reshape((3, 9), name = 'Res28106', )(Zer2189)
LST1444 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST1444', )(Res28106)
Res21668 = keras.layers.Reshape((2, 1), name = 'Res21668', )(LST1444)
Res98149 = keras.layers.Reshape((2, 1, 1), name = 'Res98149', )(Res21668)
Res78694 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res78694', )(Res98149)
Zer81527 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (1, 0)), name = 'Zer81527', )(Res78694)
Min31599 = keras.layers.Minimum(name = 'Min31599', )([in0Min31599,in1Min31599])
Sub68497 = keras.layers.Subtract(name = 'Sub68497', )([Zer81527,Min31599])
model = tf.keras.models.Model(inputs=[in0Zer2189,in0Min31599,in1Min31599], outputs=Sub68497)
w = model.get_layer('LST1444').get_weights() 
w[0] = np.array([[2, 1, 2, 3, 8, 3, 5, 2], [5, 8, 10, 2, 9, 6, 1, 4], [4, 9, 5, 8, 9, 8, 6, 6], [3, 4, 2, 8, 7, 2, 8, 1], [2, 1, 10, 1, 9, 6, 10, 10], [10, 9, 1, 2, 10, 1, 2, 9], [1, 10, 6, 6, 3, 9, 4, 4], [4, 1, 1, 6, 9, 6, 1, 5], [3, 1, 4, 6, 10, 8, 6, 2]])
w[1] = np.array([[7, 3, 2, 8, 8, 1, 9, 3], [6, 4, 2, 8, 6, 1, 6, 5]])
w[2] = np.array([6, 9, 1, 4, 8, 5, 9, 8])
model.get_layer('LST1444').set_weights(w) 
in0Zer2189 = tf.constant([[[[1.1351, 1.3983, 1.4781]]]])
in0Min31599 = tf.constant([[[[[0.1401], [0.5985]]], [[[0.9929], [0.3343]]]]])
in1Min31599 = tf.constant([[[[[0.9386], [0.3415]]], [[[0.4069], [0.9807]]]]])
print (np.array2string(model.predict([in0Zer2189,in0Min31599,in1Min31599],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub68497.png')

LZer2189 = zero_padding2D_layer([[[[1.1351, 1.3983, 1.4781]]]], 1, 1, 1, 1, Zer2189), 
LRes28106 = reshape_layer(Zer2189, [3, 9], Res28106), 
LLST1444 = lstm_layer(Res28106,[[2, 1, 2, 3, 8, 3, 5, 2], [5, 8, 10, 2, 9, 6, 1, 4], [4, 9, 5, 8, 9, 8, 6, 6], [3, 4, 2, 8, 7, 2, 8, 1], [2, 1, 10, 1, 9, 6, 10, 10], [10, 9, 1, 2, 10, 1, 2, 9], [1, 10, 6, 6, 3, 9, 4, 4], [4, 1, 1, 6, 9, 6, 1, 5], [3, 1, 4, 6, 10, 8, 6, 2]],[[7, 3, 2, 8, 8, 1, 9, 3], [6, 4, 2, 8, 6, 1, 6, 5]],[6, 9, 1, 4, 8, 5, 9, 8], LST1444), 
LRes21668 = reshape_layer(LST1444, [2, 1], Res21668), 
LRes98149 = reshape_layer(Res21668, [2, 1, 1], Res98149), 
LRes78694 = reshape_layer(Res98149, [2, 1, 1, 1], Res78694), 
LZer81527 = zero_padding3D_layer(Res78694, 0, 0, 0, 0, 1, 0, Zer81527), 
LMin31599 = minimum_layer([[[[[[0.1401], [0.5985]]], [[[0.9929], [0.3343]]]]], [[[[[0.9386], [0.3415]]], [[[0.4069], [0.9807]]]]]], Min31599), 
LSub68497 = subtract_layer(Zer81527,Min31599, Sub68497), 
exec_layers([LZer2189,LRes28106,LLST1444,LRes21668,LRes98149,LRes78694,LZer81527,LMin31599,LSub68497],["Zer2189","Res28106","LST1444","Res21668","Res98149","Res78694","Zer81527","Min31599","Sub68497"],Sub68497,"Sub68497")

Actual (Unparsed): [[[[[-0.1401000], [0.6533749]]], [[[-0.4069000], [0.6607525]]]]]

Expected (Unparsed): [[[[[-0.1401],[0.6533749600863723]]],[[[-0.4069],[0.6607524702640126]]]]]

Actual:   [[[[[-0.1401], [0.6534]]], [[[-0.4069], [0.6608]]]]]

Expected: [[[[[-0.1401], [0.6534]]], [[[-0.4069], [0.6608]]]]]