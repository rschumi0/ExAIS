import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub33140 = tf.keras.layers.Input(shape=([2, 2, 3, 2]))
in1Sub33140 = tf.keras.layers.Input(shape=([2, 2, 3, 2]))
in0Glo78758 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Con86416 = tf.keras.layers.Input(shape=([23]))

Sub33140 = keras.layers.Subtract(name = 'Sub33140', )([in0Sub33140,in1Sub33140])
Res92668 = keras.layers.Reshape((2, 2, 6), name = 'Res92668', )(Sub33140)
Res84254 = keras.layers.Reshape((2, 12), name = 'Res84254', )(Res92668)
Fla10470 = keras.layers.Flatten(name = 'Fla10470', )(Res84254)
Glo78758 = keras.layers.GlobalMaxPool3D(name = 'Glo78758', )(in0Glo78758)
Con86416 = keras.layers.Concatenate(axis=1, name = 'Con86416', )([Glo78758,in0Con86416])
Sub69376 = keras.layers.Subtract(name = 'Sub69376', )([Fla10470,Con86416])
model = tf.keras.models.Model(inputs=[in0Sub33140,in1Sub33140,in0Glo78758,in0Con86416], outputs=Sub69376)
in0Sub33140 = tf.constant([[[[[0.0106, 0.1185], [0.9177, 0.4002], [0.9181, 0.4697]], [[0.275, 0.1155], [0.239, 0.1944], [0.2104, 0.0876]]], [[[0.3177, 0.1], [0.7609, 0.3084], [0.1344, 0.0346]], [[0.8695, 0.7465], [0.2851, 0.5374], [0.4489, 0.8373]]]]])
in1Sub33140 = tf.constant([[[[[0.901, 0.0879], [0.1274, 0.3531], [0.6652, 0.3197]], [[0.6366, 0.6122], [0.9168, 0.5329], [0.7156, 0.1484]]], [[[0.0748, 0.4609], [0.2194, 0.2943], [0.256, 0.5233]], [[0.8467, 0.6056], [0.0148, 0.7355], [0.5296, 0.6997]]]]])
in0Glo78758 = tf.constant([[[[[1.5914], [1.0316]], [[1.0646], [1.8678]]]]])
in0Con86416 = tf.constant([[0.5621, 0.6873, 0.9439, 0.8763, 0.2641, 0.8202, 0.4428, 0.1359, 0.1433, 0.4496, 0.5146, 0.448, 0.166, 0.5206, 0.7308, 0.3435, 0.9357, 0.8164, 0.1458, 0.5395, 0.2345, 0.0366, 0.0966]])
print (np.array2string(model.predict([in0Sub33140,in1Sub33140,in0Glo78758,in0Con86416],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub69376.png')

LSub33140 = subtract_layer([[[[[0.0106, 0.1185], [0.9177, 0.4002], [0.9181, 0.4697]], [[0.275, 0.1155], [0.239, 0.1944], [0.2104, 0.0876]]], [[[0.3177, 0.1], [0.7609, 0.3084], [0.1344, 0.0346]], [[0.8695, 0.7465], [0.2851, 0.5374], [0.4489, 0.8373]]]]], [[[[[0.901, 0.0879], [0.1274, 0.3531], [0.6652, 0.3197]], [[0.6366, 0.6122], [0.9168, 0.5329], [0.7156, 0.1484]]], [[[0.0748, 0.4609], [0.2194, 0.2943], [0.256, 0.5233]], [[0.8467, 0.6056], [0.0148, 0.7355], [0.5296, 0.6997]]]]], Sub33140), 
LRes92668 = reshape_layer(Sub33140, [2, 2, 6], Res92668), 
LRes84254 = reshape_layer(Res92668, [2, 12], Res84254), 
LFla10470 = flatten_layer(Res84254, Fla10470), 
LGlo78758 = global_max_pool3D_layer([[[[[1.5914], [1.0316]], [[1.0646], [1.8678]]]]], Glo78758), 
LCon86416 = concatenate_layer([Glo78758,[[0.5621, 0.6873, 0.9439, 0.8763, 0.2641, 0.8202, 0.4428, 0.1359, 0.1433, 0.4496, 0.5146, 0.448, 0.166, 0.5206, 0.7308, 0.3435, 0.9357, 0.8164, 0.1458, 0.5395, 0.2345, 0.0366, 0.0966]]], 1, Con86416), 
LSub69376 = subtract_layer(Fla10470,Con86416, Sub69376), 
exec_layers([LSub33140,LRes92668,LRes84254,LFla10470,LGlo78758,LCon86416,LSub69376],["Sub33140","Res92668","Res84254","Fla10470","Glo78758","Con86416","Sub69376"],Sub69376,"Sub69376")

Actual (Unparsed): [[-2.7582000, -0.5315000, 0.1030000, -0.8968000, -0.6234000, -0.1141000, -1.1818000, -0.9395000, -0.8137000, -0.4818000, -0.9548000, -0.5754000, -0.2051000, -0.5269000, 0.0209000, -0.7167000, -0.4651000, -1.4244000, -0.7936000, -0.0049000, -0.2692000, -0.4326000, -0.1173000, 0.0410000]]

Expected (Unparsed): [[-2.7582,-0.5315000000000001,0.10299999999999998,-0.8968,-0.6234,-0.11409999999999998,-1.1818,-0.9395,-0.8137,-0.4818,-0.9548,-0.5753999999999999,-0.20510000000000003,-0.5269,0.02090000000000003,-0.7167,-0.46510000000000007,-1.4243999999999999,-0.7936,-0.004899999999999988,-0.26919999999999994,-0.43260000000000004,-0.11729999999999993,0.04100000000000005]]

Actual:   [[-2.7582, -0.5315, 0.103, -0.8968, -0.6234, -0.1141, -1.1818, -0.9395, -0.8137, -0.4818, -0.9548, -0.5754, -0.2051, -0.5269, 0.0209, -0.7167, -0.4651, -1.4244, -0.7936, -0.0049, -0.2692, -0.4326, -0.1173, 0.041]]

Expected: [[-2.7582, -0.5315, 0.103, -0.8968, -0.6234, -0.114, -1.1818, -0.9395, -0.8137, -0.4818, -0.9548, -0.5753, -0.2051, -0.5269, 0.021, -0.7167, -0.4651, -1.4243, -0.7936, -0.0048, -0.2691, -0.4326, -0.1172, 0.0411]]