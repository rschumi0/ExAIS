import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot96123 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot96123 = tf.keras.layers.Input(shape=([2, 3]))
in0Con15141 = tf.keras.layers.Input(shape=([2, 2]))
in0Mas56743 = tf.keras.layers.Input(shape=([2, 3, 1]))
in0Con86850 = tf.keras.layers.Input(shape=([2, 3, 1]))
in0Con71402 = tf.keras.layers.Input(shape=([2, 1, 1]))

Dot96123 = keras.layers.Dot(axes=(2, 2), name = 'Dot96123', )([in0Dot96123,in1Dot96123])
Con15141 = keras.layers.Concatenate(axis=2, name = 'Con15141', )([Dot96123,in0Con15141])
Mas56743 = keras.layers.Masking(mask_value=2, name = 'Mas56743', )(in0Mas56743)
Con86850 = keras.layers.Concatenate(axis=3, name = 'Con86850', )([Mas56743,in0Con86850])
Con71402 = keras.layers.Conv2DTranspose(2, (1, 1),strides=(1, 1), padding='same', name = 'Con71402', )(in0Con71402)
Zer9451 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer9451', )(Con71402)
Sub55391 = keras.layers.Subtract(name = 'Sub55391', )([Con86850,Zer9451])
Dep27698 = keras.layers.DepthwiseConv2D((1, 1),strides=(2, 2), padding='same', name = 'Dep27698', )(Sub55391)
Res43044 = keras.layers.Reshape((1, 4), name = 'Res43044', )(Dep27698)
Dot90279 = keras.layers.Dot(axes=(2, 2), name = 'Dot90279', )([Con15141,Res43044])
model = tf.keras.models.Model(inputs=[in0Dot96123,in1Dot96123,in0Con15141,in0Mas56743,in0Con86850,in0Con71402], outputs=Dot90279)
w = model.get_layer('Con71402').get_weights() 
w[0] = np.array([[[[0.9962], [0.2053]]]])
w[1] = np.array([0, 0])
model.get_layer('Con71402').set_weights(w) 
w = model.get_layer('Dep27698').get_weights() 
w[0] = np.array([[[[0.7917], [0.0887]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep27698').set_weights(w) 
in0Dot96123 = tf.constant([[[0.1258, 0.131, 0.529], [0.6557, 0.8284, 0.5156]]])
in1Dot96123 = tf.constant([[[0.8212, 0.5814, 0.0465], [0.951, 0.0161, 0.4614]]])
in0Con15141 = tf.constant([[[0.4479, 0.6039], [0.9074, 0.1085]]])
in0Mas56743 = tf.constant([[[[1.8714], [1.2508], [1.8492]], [[1.8586], [1.6147], [1.1622]]]])
in0Con86850 = tf.constant([[[[0.2556], [0.5886], [0.7932]], [[0.9706], [0.1884], [0.1242]]]])
in0Con71402 = tf.constant([[[[0.5439]], [[0.5098]]]])
print (np.array2string(model.predict([in0Dot96123,in1Dot96123,in0Con15141,in0Mas56743,in0Con86850,in0Con71402],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot90279.png')

LDot96123 = dot_layer([[[0.1258, 0.131, 0.529], [0.6557, 0.8284, 0.5156]]], [[[0.8212, 0.5814, 0.0465], [0.951, 0.0161, 0.4614]]], 2, 2, Dot96123), 
LCon15141 = concatenate_layer([Dot96123,[[[0.4479, 0.6039], [0.9074, 0.1085]]]], 2, Con15141), 
LMas56743 = masking_layer([[[[1.8714], [1.2508], [1.8492]], [[1.8586], [1.6147], [1.1622]]]], 2, Mas56743), 
LCon86850 = concatenate_layer([Mas56743,[[[[0.2556], [0.5886], [0.7932]], [[0.9706], [0.1884], [0.1242]]]]], 3, Con86850), 
LCon71402 = conv2D_transpose_layer([[[[0.5439]], [[0.5098]]]], 1, 1,[[[[0.9962], [0.2053]]]],[0, 0], 1, 1, true, Con71402), 
LZer9451 = zero_padding2D_layer(Con71402, 0, 0, 2, 0, Zer9451), 
LSub55391 = subtract_layer(Con86850,Zer9451, Sub55391), 
LDep27698 = depthwise_conv2D_layer(Sub55391, 1, 1,[[[[0.7917], [0.0887]]]],[0, 0], 2, 2, true, Dep27698), 
LRes43044 = reshape_layer(Dep27698, [1, 4], Res43044), 
LDot90279 = dot_layer(Con15141,Res43044, 2, 2, Dot90279), 
exec_layers([LDot96123,LCon15141,LMas56743,LCon86850,LCon71402,LZer9451,LSub55391,LDep27698,LRes43044,LDot90279],["Dot96123","Con15141","Mas56743","Con86850","Con71402","Zer9451","Sub55391","Dep27698","Res43044","Dot90279"],Dot90279,"Dot90279")

Actual (Unparsed): [[[0.8107424], [2.5124678]]]

Expected (Unparsed): [[[0.8107423731163862],[2.5124677989063504]]]

Actual:   [[[0.8108], [2.5125]]]

Expected: [[[0.8108], [2.5125]]]