import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Fla79797 = tf.keras.layers.Input(shape=([2, 1, 4]))
in0Con2043 = tf.keras.layers.Input(shape=([8, 1, 1, 1]))
in0GRU21833 = tf.keras.layers.Input(shape=([1, 1]))
in0Con51866 = tf.keras.layers.Input(shape=([3, 1, 1, 1]))
in0Mul24766 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Mul24766 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in0Sub3763 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub3763 = tf.keras.layers.Input(shape=([2, 2]))

Fla79797 = keras.layers.Flatten(name = 'Fla79797', )(in0Fla79797)
Res34460 = keras.layers.Reshape((8, 1), name = 'Res34460', )(Fla79797)
Res36556 = keras.layers.Reshape((8, 1, 1), name = 'Res36556', )(Res34460)
Res82219 = keras.layers.Reshape((8, 1, 1, 1), name = 'Res82219', )(Res36556)
Con2043 = keras.layers.Concatenate(axis=4, name = 'Con2043', )([Res82219,in0Con2043])
GRU21833 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU21833', )(in0GRU21833)
Res84786 = keras.layers.Reshape((3, 1), name = 'Res84786', )(GRU21833)
Res59697 = keras.layers.Reshape((3, 1, 1), name = 'Res59697', )(Res84786)
Res60616 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res60616', )(Res59697)
Con51866 = keras.layers.Concatenate(axis=4, name = 'Con51866', )([Res60616,in0Con51866])
Mul24766 = keras.layers.Multiply(name = 'Mul24766', )([in0Mul24766,in1Mul24766])
Zer54046 = keras.layers.ZeroPadding3D(padding=((2, 0), (0, 0), (0, 0)), name = 'Zer54046', )(Mul24766)
Add62843 = keras.layers.Add(name = 'Add62843', )([Con51866,Zer54046])
Zer12532 = keras.layers.ZeroPadding3D(padding=((5, 0), (0, 0), (0, 0)), name = 'Zer12532', )(Add62843)
Max3559 = keras.layers.Maximum(name = 'Max3559', )([Con2043,Zer12532])
Res73109 = keras.layers.Reshape((8, 1, 2), name = 'Res73109', )(Max3559)
Res22889 = keras.layers.Reshape((8, 2), name = 'Res22889', )(Res73109)
Sub3763 = keras.layers.Subtract(name = 'Sub3763', )([in0Sub3763,in1Sub3763])
Zer65253 = keras.layers.ZeroPadding1D(padding=((6, 0)), name = 'Zer65253', )(Sub3763)
Ave18548 = keras.layers.Average(name = 'Ave18548', )([Res22889,Zer65253])
Res10934 = keras.layers.Reshape((8, 2, 1), name = 'Res10934', )(Ave18548)
Loc69861 = keras.layers.LocallyConnected2D(4, (2, 2),strides=(1, 1), name = 'Loc69861', )(Res10934)
model = tf.keras.models.Model(inputs=[in0Fla79797,in0Con2043,in0GRU21833,in0Con51866,in0Mul24766,in1Mul24766,in0Sub3763,in1Sub3763], outputs=Loc69861)
w = model.get_layer('GRU21833').get_weights() 
w[0] = np.array([[8, 5, 3, 2, 2, 5, 9, 10, 2]])
w[1] = np.array([[5, 6, 7, 8, 5, 1, 4, 5, 1], [9, 4, 6, 2, 10, 9, 3, 7, 4], [7, 8, 9, 6, 1, 5, 1, 10, 7]])
w[2] = np.array([6, 9, 8, 6, 10, 7, 2, 1, 9])
model.get_layer('GRU21833').set_weights(w) 
w = model.get_layer('Loc69861').get_weights() 
w[0] = np.array([[[0.5142, 0.2132, 0.6619, 0.0003], [0.5802, 0.3562, 0.4123, 0.8374], [0.352, 0.3845, 0.2619, 0.0244], [0.4994, 0.4354, 0.4551, 0.8453]], [[0.6522, 0.2952, 0.0812, 0.373], [0.5714, 0.8479, 0.1454, 0.4635], [0.3147, 0.4935, 0.3939, 0.5609], [0.0324, 0.9669, 0.0445, 0.1839]], [[0.1912, 0.8153, 0.1275, 0.8108], [0.2226, 0.9058, 0.2319, 0.508], [0.8193, 0.7235, 0.0649, 0.0492], [0.3607, 0.8955, 0.3892, 0.4668]], [[0.24, 0.3274, 0.5758, 0.9425], [0.1865, 0.579, 0.2277, 0.6974], [0.028, 0.6162, 0.07, 0.0717], [0.7239, 0.881, 0.577, 0.3015]], [[0.9131, 0.6933, 0.6131, 0.5908], [0.6678, 0.3651, 0.7005, 0.9553], [0.6218, 0.0452, 0.3957, 0.9704], [0.1502, 0.2364, 0.6546, 0.9964]], [[0.8184, 0.1317, 0.9992, 0.6701], [0.8884, 0.4016, 0.7578, 0.4578], [0.274, 0.8302, 0.6472, 0.8406], [0.9696, 0.2458, 0.4859, 0.2739]], [[0.6425, 0.5222, 0.8864, 0.4009], [0.7755, 0.0358, 0.3603, 0.1296], [0.4726, 0.8547, 0.3864, 0.0901], [0.8014, 0.1116, 0.6453, 0.6753]]])
w[1] = np.array([[[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0, 0, 0, 0]]])
model.get_layer('Loc69861').set_weights(w) 
in0Fla79797 = tf.constant([[[[1.3262, 1.8704, 1.2018, 1.9585]], [[1.8216, 1.495, 1.7088, 1.6644]]]])
in0Con2043 = tf.constant([[[[[0.7894]]], [[[0.1659]]], [[[0.3258]]], [[[0.734]]], [[[0.4933]]], [[[0.6237]]], [[[0.1655]]], [[[0.6827]]]]])
in0GRU21833 = tf.constant([[[8]]])
in0Con51866 = tf.constant([[[[[0.0089]]], [[[0.0808]]], [[[0.047]]]]])
in0Mul24766 = tf.constant([[[[[0.508, 0.8459]]]]])
in1Mul24766 = tf.constant([[[[[0.3581, 0.706]]]]])
in0Sub3763 = tf.constant([[[0.8795, 0.0211], [0.4338, 0.0974]]])
in1Sub3763 = tf.constant([[[0.8012, 0.6597], [0.7857, 0.6535]]])
print (np.array2string(model.predict([in0Fla79797,in0Con2043,in0GRU21833,in0Con51866,in0Mul24766,in1Mul24766,in0Sub3763,in1Sub3763],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc69861.png')

LFla79797 = flatten_layer([[[[1.3262, 1.8704, 1.2018, 1.9585]], [[1.8216, 1.495, 1.7088, 1.6644]]]], Fla79797), 
LRes34460 = reshape_layer(Fla79797, [8, 1], Res34460), 
LRes36556 = reshape_layer(Res34460, [8, 1, 1], Res36556), 
LRes82219 = reshape_layer(Res36556, [8, 1, 1, 1], Res82219), 
LCon2043 = concatenate_layer([Res82219,[[[[[0.7894]]], [[[0.1659]]], [[[0.3258]]], [[[0.734]]], [[[0.4933]]], [[[0.6237]]], [[[0.1655]]], [[[0.6827]]]]]], 4, Con2043), 
LGRU21833 = gru_layer([[[8]]],[[8, 5, 3, 2, 2, 5, 9, 10, 2]],[[5, 6, 7, 8, 5, 1, 4, 5, 1], [9, 4, 6, 2, 10, 9, 3, 7, 4], [7, 8, 9, 6, 1, 5, 1, 10, 7]],[6, 9, 8, 6, 10, 7, 2, 1, 9], false, GRU21833), 
LRes84786 = reshape_layer(GRU21833, [3, 1], Res84786), 
LRes59697 = reshape_layer(Res84786, [3, 1, 1], Res59697), 
LRes60616 = reshape_layer(Res59697, [3, 1, 1, 1], Res60616), 
LCon51866 = concatenate_layer([Res60616,[[[[[0.0089]]], [[[0.0808]]], [[[0.047]]]]]], 4, Con51866), 
LMul24766 = multiply_layer([[[[[[0.508, 0.8459]]]]], [[[[[0.3581, 0.706]]]]]], Mul24766), 
LZer54046 = zero_padding3D_layer(Mul24766, 2, 0, 0, 0, 0, 0, Zer54046), 
LAdd62843 = add_layer([Con51866,Zer54046], Add62843), 
LZer12532 = zero_padding3D_layer(Add62843, 5, 0, 0, 0, 0, 0, Zer12532), 
LMax3559 = maximum_layer([Con2043,Zer12532], Max3559), 
LRes73109 = reshape_layer(Max3559, [8, 1, 2], Res73109), 
LRes22889 = reshape_layer(Res73109, [8, 2], Res22889), 
LSub3763 = subtract_layer([[[0.8795, 0.0211], [0.4338, 0.0974]]], [[[0.8012, 0.6597], [0.7857, 0.6535]]], Sub3763), 
LZer65253 = zero_padding1D_layer(Sub3763, 6, 0, Zer65253), 
LAve18548 = average_layer([Res22889,Zer65253], Ave18548), 
LRes10934 = reshape_layer(Ave18548, [8, 2, 1], Res10934), 
LLoc69861 = locally_connected2D_layer(Res10934, 2, 2,[[[0.5142, 0.2132, 0.6619, 0.0003], [0.5802, 0.3562, 0.4123, 0.8374], [0.352, 0.3845, 0.2619, 0.0244], [0.4994, 0.4354, 0.4551, 0.8453]], [[0.6522, 0.2952, 0.0812, 0.373], [0.5714, 0.8479, 0.1454, 0.4635], [0.3147, 0.4935, 0.3939, 0.5609], [0.0324, 0.9669, 0.0445, 0.1839]], [[0.1912, 0.8153, 0.1275, 0.8108], [0.2226, 0.9058, 0.2319, 0.508], [0.8193, 0.7235, 0.0649, 0.0492], [0.3607, 0.8955, 0.3892, 0.4668]], [[0.24, 0.3274, 0.5758, 0.9425], [0.1865, 0.579, 0.2277, 0.6974], [0.028, 0.6162, 0.07, 0.0717], [0.7239, 0.881, 0.577, 0.3015]], [[0.9131, 0.6933, 0.6131, 0.5908], [0.6678, 0.3651, 0.7005, 0.9553], [0.6218, 0.0452, 0.3957, 0.9704], [0.1502, 0.2364, 0.6546, 0.9964]], [[0.8184, 0.1317, 0.9992, 0.6701], [0.8884, 0.4016, 0.7578, 0.4578], [0.274, 0.8302, 0.6472, 0.8406], [0.9696, 0.2458, 0.4859, 0.2739]], [[0.6425, 0.5222, 0.8864, 0.4009], [0.7755, 0.0358, 0.3603, 0.1296], [0.4726, 0.8547, 0.3864, 0.0901], [0.8014, 0.1116, 0.6453, 0.6753]]],[[[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0, 0, 0, 0]]], 1, 1, Loc69861), 
exec_layers([LFla79797,LRes34460,LRes36556,LRes82219,LCon2043,LGRU21833,LRes84786,LRes59697,LRes60616,LCon51866,LMul24766,LZer54046,LAdd62843,LZer12532,LMax3559,LRes73109,LRes22889,LSub3763,LZer65253,LAve18548,LRes10934,LLoc69861],["Fla79797","Res34460","Res36556","Res82219","Con2043","GRU21833","Res84786","Res59697","Res60616","Con51866","Mul24766","Zer54046","Add62843","Zer12532","Max3559","Res73109","Res22889","Sub3763","Zer65253","Ave18548","Res10934","Loc69861"],Loc69861,"Loc69861")

Actual (Unparsed): [[[[0.9405866, 0.6776659, 0.8843201, 0.4236572]], [[0.8517162, 0.8004565, 0.3319427, 0.7542790]], [[1.0858301, 1.6746045, 0.3207810, 0.7894576]], [[0.5075178, 1.3116331, 0.8534911, 1.3185583]], [[1.5079997, 0.8290179, 1.2311126, 1.8098267]], [[0.9042754, 0.9073659, 1.4465878, 1.3299918]], [[0.7515337, 1.0261044, 1.0012362, 0.4294419]]]]

Expected (Unparsed): [[[[0.94058659,0.67766589,0.884320125,0.423657225]],[[0.85171626,0.8004565050000001,0.33194272999999996,0.7542790450000001]],[[1.085830045,1.674604465,0.32078098499999996,0.78945762]],[[0.507517835,1.3116330600000001,0.8534911000000001,1.31855826]],[[1.5079997200000004,0.829017895,1.2311125649999999,1.8098267250000002]],[[0.9042753600000002,0.9073659300000001,1.446587845,1.3299917650000002]],[[0.7515337200000001,1.0261044750000001,1.001236245,0.4294419300000001]]]]

Actual:   [[[[0.9406, 0.6777, 0.8844, 0.4237]], [[0.8518, 0.8005, 0.332, 0.7543]], [[1.0859, 1.6747, 0.3208, 0.7895]], [[0.5076, 1.3117, 0.8535, 1.3186]], [[1.508, 0.8291, 1.2312, 1.8099]], [[0.9043, 0.9074, 1.4466, 1.33]], [[0.7516, 1.0262, 1.0013, 0.4295]]]]

Expected: [[[[0.9406, 0.6777, 0.8844, 0.4237]], [[0.8518, 0.8005, 0.332, 0.7543]], [[1.0859, 1.6747, 0.3208, 0.7895]], [[0.5076, 1.3117, 0.8535, 1.3186]], [[1.508, 0.8291, 1.2312, 1.8099]], [[0.9043, 0.9074, 1.4466, 1.33]], [[0.7516, 1.0262, 1.0013, 0.4295]]]]