import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max41119 = tf.keras.layers.Input(shape=([2, 1]))
in0Con1036 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Max14046 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Max14046 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Add78716 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Add78716 = tf.keras.layers.Input(shape=([2, 2, 2]))

Max41119 = keras.layers.MaxPool1D(pool_size=(2), strides=(1), padding='valid', name = 'Max41119', )(in0Max41119)
Res46839 = keras.layers.Reshape((1, 1, 1), name = 'Res46839', )(Max41119)
Res90393 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res90393', )(Res46839)
Zer30574 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (0, 0)), name = 'Zer30574', )(Res90393)
Con1036 = keras.layers.Concatenate(axis=4, name = 'Con1036', )([Zer30574,in0Con1036])
Max14046 = keras.layers.Maximum(name = 'Max14046', )([in0Max14046,in1Max14046])
Ave28812 = keras.layers.Average(name = 'Ave28812', )([Con1036,Max14046])
Glo21342 = keras.layers.GlobalAveragePooling3D(name = 'Glo21342', )(Ave28812)
Lay91248 = keras.layers.LayerNormalization(axis=1, epsilon=2.6885599923816605, name = 'Lay91248', )(Glo21342)
Res29216 = keras.layers.Reshape((2, 1), name = 'Res29216', )(Lay91248)
Res6316 = keras.layers.Reshape((2, 1, 1), name = 'Res6316', )(Res29216)
Res26434 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res26434', )(Res6316)
Zer31013 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (1, 0)), name = 'Zer31013', )(Res26434)
Add78716 = keras.layers.Add(name = 'Add78716', )([in0Add78716,in1Add78716])
Lay28083 = keras.layers.LayerNormalization(axis=2, epsilon=1.2849267286509203, name = 'Lay28083', )(Add78716)
Res22087 = keras.layers.Reshape((2, 2, 2, 1), name = 'Res22087', )(Lay28083)
PRe20347 = keras.layers.PReLU(name = 'PRe20347', )(Res22087)
Sub22680 = keras.layers.Subtract(name = 'Sub22680', )([Zer31013,PRe20347])
model = tf.keras.models.Model(inputs=[in0Max41119,in0Con1036,in0Max14046,in1Max14046,in0Add78716,in1Add78716], outputs=Sub22680)
w = model.get_layer('PRe20347').get_weights() 
w[0] = np.array([[[[0.8294], [0.289]], [[0.3227], [0.5412]]], [[[0.7382], [0.4646]], [[0.355], [0.6355]]]])
model.get_layer('PRe20347').set_weights(w) 
in0Max41119 = tf.constant([[[1.2347], [1.5701]]])
in0Con1036 = tf.constant([[[[[0.874]], [[0.1719]]]]])
in0Max14046 = tf.constant([[[[[0.4692, 0.9805]], [[0.9201, 0.4008]]]]])
in1Max14046 = tf.constant([[[[[0.8426, 0.7036]], [[0.2632, 0.3685]]]]])
in0Add78716 = tf.constant([[[[0.82, 0.4605], [0.5823, 0.1402]], [[0.1268, 0.3421], [0.5628, 0.2352]]]])
in1Add78716 = tf.constant([[[[0.7854, 0.4674], [0.7668, 0.9949]], [[0.9454, 0.1319], [0.7937, 0.8661]]]])
print (np.array2string(model.predict([in0Max41119,in0Con1036,in0Max14046,in1Max14046,in0Add78716,in1Add78716],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub22680.png')

LMax41119 = max_pool1D_layer([[[1.2347], [1.5701]]], 2, 1, false, Max41119), 
LRes46839 = reshape_layer(Max41119, [1, 1, 1], Res46839), 
LRes90393 = reshape_layer(Res46839, [1, 1, 1, 1], Res90393), 
LZer30574 = zero_padding3D_layer(Res90393, 0, 0, 1, 0, 0, 0, Zer30574), 
LCon1036 = concatenate_layer([Zer30574,[[[[[0.874]], [[0.1719]]]]]], 4, Con1036), 
LMax14046 = maximum_layer([[[[[[0.4692, 0.9805]], [[0.9201, 0.4008]]]]], [[[[[0.8426, 0.7036]], [[0.2632, 0.3685]]]]]], Max14046), 
LAve28812 = average_layer([Con1036,Max14046], Ave28812), 
LGlo21342 = global_average_pooling3D_layer(Ave28812, Glo21342), 
LLay91248 = layer_normalization_layer(Glo21342, 1, 2.6885599923816605, Lay91248), 
LRes29216 = reshape_layer(Lay91248, [2, 1], Res29216), 
LRes6316 = reshape_layer(Res29216, [2, 1, 1], Res6316), 
LRes26434 = reshape_layer(Res6316, [2, 1, 1, 1], Res26434), 
LZer31013 = zero_padding3D_layer(Res26434, 0, 0, 1, 0, 1, 0, Zer31013), 
LAdd78716 = add_layer([[[[[0.82, 0.4605], [0.5823, 0.1402]], [[0.1268, 0.3421], [0.5628, 0.2352]]]], [[[[0.7854, 0.4674], [0.7668, 0.9949]], [[0.9454, 0.1319], [0.7937, 0.8661]]]]], Add78716), 
LLay28083 = layer_normalization_layer(Add78716, 2, 1.2849267286509203, Lay28083), 
LRes22087 = reshape_layer(Lay28083, [2, 2, 2, 1], Res22087), 
LPRe20347 = prelu_layer(Res22087, [[[[0.8294], [0.289]], [[0.3227], [0.5412]]], [[[0.7382], [0.4646]], [[0.355], [0.6355]]]], PRe20347), 
LSub22680 = subtract_layer(Zer31013,PRe20347, Sub22680), 
exec_layers([LMax41119,LRes46839,LRes90393,LZer30574,LCon1036,LMax14046,LAve28812,LGlo21342,LLay91248,LRes29216,LRes6316,LRes26434,LZer31013,LAdd78716,LLay28083,LRes22087,LPRe20347,LSub22680],["Max41119","Res46839","Res90393","Zer30574","Con1036","Max14046","Ave28812","Glo21342","Lay91248","Res29216","Res6316","Res26434","Zer31013","Add78716","Lay28083","Res22087","PRe20347","Sub22680"],Sub22680,"Sub22680")

Actual (Unparsed): [[[[[-0.1123367], [0.0263034]], [[0.0362511], [-0.0221415]]], [[[0.0918530], [0.1238984]], [[-0.1244284], [-0.3355515]]]]]

Expected (Unparsed): [[[[[-0.11233670829061387],[0.02630341425107052]],[[0.036251055765381096],[-0.022141473393576777]]],[[[0.09185302447534961],[0.12389843762608296]],[[-0.12442837235891305],[-0.3355514539225902]]]]]

Actual:   [[[[[-0.1123], [0.0264]], [[0.0363], [-0.0221]]], [[[0.0919], [0.1239]], [[-0.1244], [-0.3355]]]]]

Expected: [[[[[-0.1123], [0.0264]], [[0.0363], [-0.0221]]], [[[0.0919], [0.1239]], [[-0.1244], [-0.3355]]]]]