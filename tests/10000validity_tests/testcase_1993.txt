import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST36053 = tf.keras.layers.Input(shape=([1, 3]))

LST36053 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST36053', )(in0LST36053)
Res68439 = keras.layers.Reshape((1, 1), name = 'Res68439', )(LST36053)
Res14678 = keras.layers.Reshape((1, 1, 1), name = 'Res14678', )(Res68439)
Con83264 = keras.layers.Conv2DTranspose(4, (1, 1),strides=(1, 1), padding='same', name = 'Con83264', )(Res14678)
Res1111 = keras.layers.Reshape((1, 4), name = 'Res1111', )(Con83264)
Sep21090 = keras.layers.SeparableConv1D(2, (1),strides=(1), padding='valid', name = 'Sep21090', )(Res1111)
PRe90266 = keras.layers.PReLU(name = 'PRe90266', )(Sep21090)
Res65521 = keras.layers.Reshape((1, 2, 1), name = 'Res65521', )(PRe90266)
Sep34426 = keras.layers.SeparableConv2D(4, (1, 1),strides=(1, 1), padding='same', name = 'Sep34426', )(Res65521)
model = tf.keras.models.Model(inputs=[in0LST36053], outputs=Sep34426)
w = model.get_layer('LST36053').get_weights() 
w[0] = np.array([[7, 5, 2, 4], [3, 5, 10, 2], [4, 2, 7, 6]])
w[1] = np.array([[4, 2, 6, 4]])
w[2] = np.array([9, 5, 8, 9])
model.get_layer('LST36053').set_weights(w) 
w = model.get_layer('Con83264').get_weights() 
w[0] = np.array([[[[0.3915], [0.2468], [0.3797], [0.2756]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con83264').set_weights(w) 
w = model.get_layer('Sep21090').get_weights() 
w[0] = np.array([[[0.4803], [0.0266], [0.3168], [0.1978]]])
w[1] = np.array([[[0.5713, 0.1148], [0.8918, 0.642], [0.8569, 0.8734], [0.5176, 0.6376]]])
w[2] = np.array([0, 0])
model.get_layer('Sep21090').set_weights(w) 
w = model.get_layer('PRe90266').get_weights() 
w[0] = np.array([[0.4924, 0.8769]])
model.get_layer('PRe90266').set_weights(w) 
w = model.get_layer('Sep34426').get_weights() 
w[0] = np.array([[[[0.3271]]]])
w[1] = np.array([[[[0.2641, 0.918, 0.7934, 0.6004]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep34426').set_weights(w) 
in0LST36053 = tf.constant([[[8, 1, 2]]])
print (np.array2string(model.predict([in0LST36053],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sep34426.png')

LLST36053 = lstm_layer([[[8, 1, 2]]],[[7, 5, 2, 4], [3, 5, 10, 2], [4, 2, 7, 6]],[[4, 2, 6, 4]],[9, 5, 8, 9], LST36053), 
LRes68439 = reshape_layer(LST36053, [1, 1], Res68439), 
LRes14678 = reshape_layer(Res68439, [1, 1, 1], Res14678), 
LCon83264 = conv2D_transpose_layer(Res14678, 1, 1,[[[[0.3915], [0.2468], [0.3797], [0.2756]]]],[0, 0, 0, 0], 1, 1, true, Con83264), 
LRes1111 = reshape_layer(Con83264, [1, 4], Res1111), 
LSep21090 = separable_conv1D_layer(Res1111, 1,[[[[0.4803], [0.0266], [0.3168], [0.1978]]],[[[0.5713, 0.1148], [0.8918, 0.642], [0.8569, 0.8734], [0.5176, 0.6376]]]],[0, 0], 1, false, Sep21090), 
LPRe90266 = prelu_layer(Sep21090, [[0.4924, 0.8769]], PRe90266), 
LRes65521 = reshape_layer(PRe90266, [1, 2, 1], Res65521), 
LSep34426 = separable_conv2D_layer(Res65521, 1, 1,[[[[[0.3271]]]],[[[[0.2641, 0.918, 0.7934, 0.6004]]]]],[0, 0, 0, 0], 1, 1, true, Sep34426), 
exec_layers([LLST36053,LRes68439,LRes14678,LCon83264,LRes1111,LSep21090,LPRe90266,LRes65521,LSep34426],["LST36053","Res68439","Res14678","Con83264","Res1111","Sep21090","PRe90266","Res65521","Sep34426"],Sep34426,"Sep34426")

Actual (Unparsed): [[[[0.0160909, 0.0559312, 0.0483397, 0.0365807], [0.0108964, 0.0378755, 0.0327347, 0.0247718]]]]

Expected (Unparsed): [[[[0.01609087716897712,0.0559311822836842,0.04833965144212967,0.03658069917551633],[0.01089643460100491,0.037875528071649026,0.03273468842270843,0.024771750603723393]]]]

Actual:   [[[[0.0161, 0.056, 0.0484, 0.0366], [0.0109, 0.0379, 0.0328, 0.0248]]]]

Expected: [[[[0.0161, 0.056, 0.0484, 0.0366], [0.0109, 0.0379, 0.0328, 0.0248]]]]