import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc37276 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Add94952 = tf.keras.layers.Input(shape=([2, 1]))
in1Add94952 = tf.keras.layers.Input(shape=([2, 1]))
in0Con44358 = tf.keras.layers.Input(shape=([2, 2]))
in0Glo10277 = tf.keras.layers.Input(shape=([2, 2]))
in0Con77790 = tf.keras.layers.Input(shape=([2, 2]))
in0Dot67533 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot67533 = tf.keras.layers.Input(shape=([3, 2]))

Loc37276 = keras.layers.LocallyConnected2D(2, (1, 1),strides=(7, 1), name = 'Loc37276', )(in0Loc37276)
Add94952 = keras.layers.Add(name = 'Add94952', )([in0Add94952,in1Add94952])
Res9916 = keras.layers.Reshape((2, 1, 1), name = 'Res9916', )(Add94952)
Loc29713 = keras.layers.LocallyConnected2D(2, (2, 1),strides=(9, 1), name = 'Loc29713', )(Res9916)
Add39369 = keras.layers.Add(name = 'Add39369', )([Loc37276,Loc29713])
Res12311 = keras.layers.Reshape((1, 2), name = 'Res12311', )(Add39369)
Zer72450 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer72450', )(Res12311)
Con44358 = keras.layers.Concatenate(axis=2, name = 'Con44358', )([Zer72450,in0Con44358])
Glo10277 = keras.layers.GlobalMaxPool1D(name = 'Glo10277', )(in0Glo10277)
Res54555 = keras.layers.Reshape((2, 1), name = 'Res54555', )(Glo10277)
Con77790 = keras.layers.Concatenate(axis=2, name = 'Con77790', )([Res54555,in0Con77790])
Dot67533 = keras.layers.Dot(axes=(2, 2), name = 'Dot67533', )([in0Dot67533,in1Dot67533])
Zer4081 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer4081', )(Dot67533)
Dot17768 = keras.layers.Dot(axes=(2, 2), name = 'Dot17768', )([Con77790,Zer4081])
Mul50227 = keras.layers.Multiply(name = 'Mul50227', )([Con44358,Dot17768])
model = tf.keras.models.Model(inputs=[in0Loc37276,in0Add94952,in1Add94952,in0Con44358,in0Glo10277,in0Con77790,in0Dot67533,in1Dot67533], outputs=Mul50227)
w = model.get_layer('Loc37276').get_weights() 
w[0] = np.array([[[0.9927, 0.1551]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc37276').set_weights(w) 
w = model.get_layer('Loc29713').get_weights() 
w[0] = np.array([[[0.7855, 0.8341], [0.1242, 0.4257]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc29713').set_weights(w) 
in0Loc37276 = tf.constant([[[[0.6826]], [[0.9294]]]])
in0Add94952 = tf.constant([[[0.3619], [0.8906]]])
in1Add94952 = tf.constant([[[0.1598], [0.6736]]])
in0Con44358 = tf.constant([[[0.9907, 0.3984], [0.5511, 0.5175]]])
in0Glo10277 = tf.constant([[[1.6795, 1.1483], [1.2878, 1.4844]]])
in0Con77790 = tf.constant([[[0.0182, 0.5512], [0.96, 0.8643]]])
in0Dot67533 = tf.constant([[[0.3891, 0.8343], [0.6958, 0.3187], [0.8804, 0.1784]]])
in1Dot67533 = tf.constant([[[0.0045, 0.8154], [0.9125, 0.6135], [0.5212, 0.73]]])
print (np.array2string(model.predict([in0Loc37276,in0Add94952,in1Add94952,in0Con44358,in0Glo10277,in0Con77790,in0Dot67533,in1Dot67533],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul50227.png')

LLoc37276 = locally_connected2D_layer([[[[0.6826]], [[0.9294]]]], 1, 1,[[[0.9927, 0.1551]]],[[[0, 0]]], 7, 1, Loc37276), 
LAdd94952 = add_layer([[[[0.3619], [0.8906]]], [[[0.1598], [0.6736]]]], Add94952), 
LRes9916 = reshape_layer(Add94952, [2, 1, 1], Res9916), 
LLoc29713 = locally_connected2D_layer(Res9916, 2, 1,[[[0.7855, 0.8341], [0.1242, 0.4257]]],[[[0, 0]]], 9, 1, Loc29713), 
LAdd39369 = add_layer([Loc37276,Loc29713], Add39369), 
LRes12311 = reshape_layer(Add39369, [1, 2], Res12311), 
LZer72450 = zero_padding1D_layer(Res12311, 1, 0, Zer72450), 
LCon44358 = concatenate_layer([Zer72450,[[[0.9907, 0.3984], [0.5511, 0.5175]]]], 2, Con44358), 
LGlo10277 = global_max_pool1D_layer([[[1.6795, 1.1483], [1.2878, 1.4844]]], Glo10277), 
LRes54555 = reshape_layer(Glo10277, [2, 1], Res54555), 
LCon77790 = concatenate_layer([Res54555,[[[0.0182, 0.5512], [0.96, 0.8643]]]], 2, Con77790), 
LDot67533 = dot_layer([[[0.3891, 0.8343], [0.6958, 0.3187], [0.8804, 0.1784]]], [[[0.0045, 0.8154], [0.9125, 0.6135], [0.5212, 0.73]]], 2, 2, Dot67533), 
LZer4081 = zero_padding1D_layer(Dot67533, 1, 0, Zer4081), 
LDot17768 = dot_layer(Con77790,Zer4081, 2, 2, Dot17768), 
LMul50227 = multiply_layer([Con44358,Dot17768], Mul50227), 
exec_layers([LLoc37276,LAdd94952,LRes9916,LLoc29713,LAdd39369,LRes12311,LZer72450,LCon44358,LGlo10277,LRes54555,LCon77790,LDot67533,LZer4081,LDot17768,LMul50227],["Loc37276","Add94952","Res9916","Loc29713","Add39369","Res12311","Zer72450","Con44358","Glo10277","Res54555","Con77790","Dot67533","Zer4081","Dot17768","Mul50227"],Mul50227,"Mul50227")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.7776513, 0.2359681], [0.0000000, 3.0731462, 0.9380481, 0.8317620]]]

Expected (Unparsed): [[[0.0,0.0,0.7776513542605913,0.23596812001779838],[0.0,3.07314619119393,0.9380480701464179,0.83176201632744]]]

Actual:   [[[0, 0, 0.7777, 0.236], [0, 3.0732, 0.9381, 0.8318]]]

Expected: [[[0, 0, 0.7777, 0.236], [0, 3.0732, 0.9381, 0.8318]]]