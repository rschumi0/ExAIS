import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con26860 = tf.keras.layers.Input(shape=([2, 1]))
in0Mul54224 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Mul54224 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Ave44585 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con80353 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0PRe90280 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con13130 = tf.keras.layers.Input(shape=([3, 3, 2]))

Con26860 = keras.layers.Conv1D(4, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con26860', )(in0Con26860)
Res42635 = keras.layers.Reshape((2, 4, 1), name = 'Res42635', )(Con26860)
Res18538 = keras.layers.Reshape((2, 4, 1, 1), name = 'Res18538', )(Res42635)
Mul54224 = keras.layers.Multiply(name = 'Mul54224', )([in0Mul54224,in1Mul54224])
Zer62898 = keras.layers.ZeroPadding3D(padding=((1, 0), (2, 0), (0, 0)), name = 'Zer62898', )(Mul54224)
Max21003 = keras.layers.Maximum(name = 'Max21003', )([Res18538,Zer62898])
Con71242 = keras.layers.Conv3D(4, (2, 3, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con71242', )(Max21003)
Res31051 = keras.layers.Reshape((1, 2, 4), name = 'Res31051', )(Con71242)
Zer79731 = keras.layers.ZeroPadding2D(padding=((2, 0), (1, 0)), name = 'Zer79731', )(Res31051)
Ave44585 = keras.layers.AveragePooling2D(pool_size=(2, 1), name = 'Ave44585', )(in0Ave44585)
Zer5530 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer5530', )(Ave44585)
Con80353 = keras.layers.Concatenate(axis=3, name = 'Con80353', )([Zer5530,in0Con80353])
PRe90280 = keras.layers.PReLU(name = 'PRe90280', input_shape=(2, 1, 2))(in0PRe90280)
Zer50181 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer50181', )(PRe90280)
Sub10738 = keras.layers.Subtract(name = 'Sub10738', )([Con80353,Zer50181])
Con13130 = keras.layers.Concatenate(axis=3, name = 'Con13130', )([Sub10738,in0Con13130])
Add97117 = keras.layers.Add(name = 'Add97117', )([Zer79731,Con13130])
model = tf.keras.models.Model(inputs=[in0Con26860,in0Mul54224,in1Mul54224,in0Ave44585,in0Con80353,in0PRe90280,in0Con13130], outputs=Add97117)
w = model.get_layer('Con26860').get_weights() 
w[0] = np.array([[[0.5749, 0.6435, 0.1308, 0.0539]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con26860').set_weights(w) 
w = model.get_layer('Con71242').get_weights() 
w[0] = np.array([[[[[0.0402, 0.7354, 0.6992, 0.5399]]], [[[0.9874, 0.6867, 0.528, 0.1628]]], [[[0.424, 0.3404, 0.4323, 0.3288]]]], [[[[0.6245, 0.7303, 0.1352, 0.2569]]], [[[0.4483, 0.8123, 0.8034, 0.7665]]], [[[0.9095, 0.9907, 0.6049, 0.297]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con71242').set_weights(w) 
w = model.get_layer('PRe90280').get_weights() 
w[0] = np.array([[[0.0885, 0.5431]], [[0.498, 0.6774]]])
model.get_layer('PRe90280').set_weights(w) 
in0Con26860 = tf.constant([[[0.242], [0.0261]]])
in0Mul54224 = tf.constant([[[[[0.4327]], [[0.3049]]]]])
in1Mul54224 = tf.constant([[[[[0.4707]], [[0.4489]]]]])
in0Ave44585 = tf.constant([[[[1.6051]], [[1.4774]]]])
in0Con80353 = tf.constant([[[[0.4608], [0.1848], [0.7413]], [[0.627], [0.838], [0.0281]], [[0.3054], [0.6936], [0.0959]]]])
in0PRe90280 = tf.constant([[[[0.7449, 0.1367]], [[0.5337, 0.3414]]]])
in0Con13130 = tf.constant([[[[0.9197, 0.215], [0.1995, 0.018], [0.4731, 0.2649]], [[0.105, 0.7632], [0.0097, 0.5735], [0.9664, 0.0911]], [[0.3601, 0.0549], [0.365, 0.0326], [0.8878, 0.7689]]]])
print (np.array2string(model.predict([in0Con26860,in0Mul54224,in1Mul54224,in0Ave44585,in0Con80353,in0PRe90280,in0Con13130],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add97117.png')

LCon26860 = conv1D_layer([[[0.242], [0.0261]]], 1,[[[0.5749, 0.6435, 0.1308, 0.0539]]],[0, 0, 0, 0], 1, false, 1, Con26860), 
LRes42635 = reshape_layer(Con26860, [2, 4, 1], Res42635), 
LRes18538 = reshape_layer(Res42635, [2, 4, 1, 1], Res18538), 
LMul54224 = multiply_layer([[[[[[0.4327]], [[0.3049]]]]], [[[[[0.4707]], [[0.4489]]]]]], Mul54224), 
LZer62898 = zero_padding3D_layer(Mul54224, 1, 0, 2, 0, 0, 0, Zer62898), 
LMax21003 = maximum_layer([Res18538,Zer62898], Max21003), 
LCon71242 = conv3D_layer(Max21003, 2, 3, 1,[[[[[0.0402, 0.7354, 0.6992, 0.5399]]], [[[0.9874, 0.6867, 0.528, 0.1628]]], [[[0.424, 0.3404, 0.4323, 0.3288]]]], [[[[0.6245, 0.7303, 0.1352, 0.2569]]], [[[0.4483, 0.8123, 0.8034, 0.7665]]], [[[0.9095, 0.9907, 0.6049, 0.297]]]]],[0, 0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con71242), 
LRes31051 = reshape_layer(Con71242, [1, 2, 4], Res31051), 
LZer79731 = zero_padding2D_layer(Res31051, 2, 0, 1, 0, Zer79731), 
LAve44585 = average_pooling2D_layer([[[[1.6051]], [[1.4774]]]], 2, 1, Ave44585), 
LZer5530 = zero_padding2D_layer(Ave44585, 1, 1, 1, 1, Zer5530), 
LCon80353 = concatenate_layer([Zer5530,[[[[0.4608], [0.1848], [0.7413]], [[0.627], [0.838], [0.0281]], [[0.3054], [0.6936], [0.0959]]]]], 3, Con80353), 
LPRe90280 = prelu_layer([[[[0.7449, 0.1367]], [[0.5337, 0.3414]]]], [[[0.0885, 0.5431]], [[0.498, 0.6774]]], PRe90280), 
LZer50181 = zero_padding2D_layer(PRe90280, 1, 0, 2, 0, Zer50181), 
LSub10738 = subtract_layer(Con80353,Zer50181, Sub10738), 
LCon13130 = concatenate_layer([Sub10738,[[[[0.9197, 0.215], [0.1995, 0.018], [0.4731, 0.2649]], [[0.105, 0.7632], [0.0097, 0.5735], [0.9664, 0.0911]], [[0.3601, 0.0549], [0.365, 0.0326], [0.8878, 0.7689]]]]], 3, Con13130), 
LAdd97117 = add_layer([Zer79731,Con13130], Add97117), 
exec_layers([LCon26860,LRes42635,LRes18538,LMul54224,LZer62898,LMax21003,LCon71242,LRes31051,LZer79731,LAve44585,LZer5530,LCon80353,LPRe90280,LZer50181,LSub10738,LCon13130,LAdd97117],["Con26860","Res42635","Res18538","Mul54224","Zer62898","Max21003","Con71242","Res31051","Zer79731","Ave44585","Zer5530","Con80353","PRe90280","Zer50181","Sub10738","Con13130","Add97117"],Add97117,"Add97117")

Actual (Unparsed): [[[[0.0000000, 0.4608000, 0.9197000, 0.2150000], [0.0000000, 0.1848000, 0.1995000, 0.0180000], [0.0000000, 0.7413000, 0.4731000, 0.2649000]], [[0.0000000, 0.6270000, 0.1050000, 0.7632000], [1.5412500, 0.8380000, 0.0097000, 0.5735000], [-0.7449000, -0.1086000, 0.9664000, 0.0911000]], [[0.0000000, 0.3054000, 0.3601000, 0.0549000], [0.3749183, 1.1400044, 0.6969076, 0.2206930], [-0.2643767, 0.2085033, 1.2677294, 1.0634985]]]]

Expected (Unparsed): [[[[0,0.4608,0.9197,0.215],[0,0.1848,0.1995,0.018],[0,0.7413,0.4731,0.2649]],[[0,0.627,0.105,0.7632],[1.54125,0.838,0.0097,0.5735],[-0.7449,-0.10859999999999999,0.9664,0.0911]],[[0,0.3054,0.3601,0.0549],[0.37491831652499996,1.140004405055,0.696907638219,0.220693022046],[-0.26437672410299995,0.20850331541899997,1.267729408775,1.06349851809]]]]

Actual:   [[[[0, 0.4608, 0.9197, 0.215], [0, 0.1848, 0.1995, 0.018], [0, 0.7413, 0.4731, 0.2649]], [[0, 0.627, 0.105, 0.7632], [1.5413, 0.838, 0.0097, 0.5735], [-0.7449, -0.1086, 0.9664, 0.0911]], [[0, 0.3054, 0.3601, 0.0549], [0.375, 1.1401, 0.697, 0.2207], [-0.2643, 0.2086, 1.2678, 1.0635]]]]

Expected: [[[[0, 0.4608, 0.9197, 0.215], [0, 0.1848, 0.1995, 0.018], [0, 0.7413, 0.4731, 0.2649]], [[0, 0.627, 0.105, 0.7632], [1.5413, 0.838, 0.0097, 0.5735], [-0.7449, -0.1085, 0.9664, 0.0911]], [[0, 0.3054, 0.3601, 0.0549], [0.375, 1.1401, 0.697, 0.2207], [-0.2643, 0.2086, 1.2678, 1.0635]]]]