import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max15276 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Max15276 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Cro71024 = tf.keras.layers.Input(shape=([4, 3, 1]))
in0Con41151 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Min25777 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Min25777 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con50003 = tf.keras.layers.Input(shape=([2]))

Max15276 = keras.layers.Maximum(name = 'Max15276', )([in0Max15276,in1Max15276])
Res26093 = keras.layers.Reshape((2, 1, 2), name = 'Res26093', )(Max15276)
Cro71024 = keras.layers.Cropping2D(cropping=((2, 1), (2, 0)), name = 'Cro71024', )(in0Cro71024)
Zer19117 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer19117', )(Cro71024)
Con41151 = keras.layers.Concatenate(axis=3, name = 'Con41151', )([Zer19117,in0Con41151])
Min58853 = keras.layers.Minimum(name = 'Min58853', )([Res26093,Con41151])
Res44187 = keras.layers.Reshape((2, 2), name = 'Res44187', )(Min58853)
Fla38166 = keras.layers.Flatten(name = 'Fla38166', )(Res44187)
Min25777 = keras.layers.Minimum(name = 'Min25777', )([in0Min25777,in1Min25777])
Res66901 = keras.layers.Reshape((2, 2), name = 'Res66901', )(Min25777)
GRU21363 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU21363', )(Res66901)
Con50003 = keras.layers.Concatenate(axis=1, name = 'Con50003', )([GRU21363,in0Con50003])
Ave35551 = keras.layers.Average(name = 'Ave35551', )([Fla38166,Con50003])
Res83493 = keras.layers.Reshape((4, 1), name = 'Res83493', )(Ave35551)
Con67907 = keras.layers.Conv1D(2, (2),strides=(1), padding='same', dilation_rate=(1), name = 'Con67907', )(Res83493)
model = tf.keras.models.Model(inputs=[in0Max15276,in1Max15276,in0Cro71024,in0Con41151,in0Min25777,in1Min25777,in0Con50003], outputs=Con67907)
w = model.get_layer('GRU21363').get_weights() 
w[0] = np.array([[4, 2, 6, 3, 3, 9], [3, 3, 8, 8, 2, 2]])
w[1] = np.array([[2, 5, 7, 4, 3, 7], [8, 7, 7, 4, 7, 3]])
w[2] = np.array([5, 9, 9, 8, 1, 7])
model.get_layer('GRU21363').set_weights(w) 
w = model.get_layer('Con67907').get_weights() 
w[0] = np.array([[[0.2647, 0.5972]], [[0.9186, 0.7543]]])
w[1] = np.array([0, 0])
model.get_layer('Con67907').set_weights(w) 
in0Max15276 = tf.constant([[[[[0.8514, 0.8148]]], [[[0.8523, 0.5083]]]]])
in1Max15276 = tf.constant([[[[[0.5199, 0.1077]]], [[[0.8641, 0.2918]]]]])
in0Cro71024 = tf.constant([[[[1.6094], [1.1525], [1.3863]], [[1.4384], [1.7741], [1.1475]], [[1.4169], [1.0838], [1.987]], [[1.6379], [1.5297], [1.5935]]]])
in0Con41151 = tf.constant([[[[0.7945]], [[0.5068]]]])
in0Min25777 = tf.constant([[[[0.6462, 0.5072]], [[0.3102, 0.378]]]])
in1Min25777 = tf.constant([[[[0.607, 0.2676]], [[0.8488, 0.9913]]]])
in0Con50003 = tf.constant([[0.9265, 0.5684]])
print (np.array2string(model.predict([in0Max15276,in1Max15276,in0Cro71024,in0Con41151,in0Min25777,in1Min25777,in0Con50003],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con67907.png')

LMax15276 = maximum_layer([[[[[[0.8514, 0.8148]]], [[[0.8523, 0.5083]]]]], [[[[[0.5199, 0.1077]]], [[[0.8641, 0.2918]]]]]], Max15276), 
LRes26093 = reshape_layer(Max15276, [2, 1, 2], Res26093), 
LCro71024 = cropping2D_layer([[[[1.6094], [1.1525], [1.3863]], [[1.4384], [1.7741], [1.1475]], [[1.4169], [1.0838], [1.987]], [[1.6379], [1.5297], [1.5935]]]], 2, 1, 2, 0, Cro71024), 
LZer19117 = zero_padding2D_layer(Cro71024, 1, 0, 0, 0, Zer19117), 
LCon41151 = concatenate_layer([Zer19117,[[[[0.7945]], [[0.5068]]]]], 3, Con41151), 
LMin58853 = minimum_layer([Res26093,Con41151], Min58853), 
LRes44187 = reshape_layer(Min58853, [2, 2], Res44187), 
LFla38166 = flatten_layer(Res44187, Fla38166), 
LMin25777 = minimum_layer([[[[[0.6462, 0.5072]], [[0.3102, 0.378]]]], [[[[0.607, 0.2676]], [[0.8488, 0.9913]]]]], Min25777), 
LRes66901 = reshape_layer(Min25777, [2, 2], Res66901), 
LGRU21363 = gru_layer(Res66901,[[4, 2, 6, 3, 3, 9], [3, 3, 8, 8, 2, 2]],[[2, 5, 7, 4, 3, 7], [8, 7, 7, 4, 7, 3]],[5, 9, 9, 8, 1, 7], false, GRU21363), 
LCon50003 = concatenate_layer([GRU21363,[[0.9265, 0.5684]]], 1, Con50003), 
LAve35551 = average_layer([Fla38166,Con50003], Ave35551), 
LRes83493 = reshape_layer(Ave35551, [4, 1], Res83493), 
LCon67907 = conv1D_layer(Res83493, 2,[[[0.2647, 0.5972]], [[0.9186, 0.7543]]],[0, 0], 1, true, 1, Con67907), 
exec_layers([LMax15276,LRes26093,LCro71024,LZer19117,LCon41151,LMin58853,LRes44187,LFla38166,LMin25777,LRes66901,LGRU21363,LCon50003,LAve35551,LRes83493,LCon67907],["Max15276","Res26093","Cro71024","Zer19117","Con41151","Min58853","Res44187","Fla38166","Min25777","Res66901","GRU21363","Con50003","Ave35551","Res83493","Con67907"],Con67907,"Con67907")

Actual (Unparsed): [[[0.3650484, 0.2999244], [0.9275797, 0.9125738], [0.7308253, 0.9401848], [0.1423027, 0.3210547]]]

Expected (Unparsed): [[[0.3650484093534801,0.2999243834979794],[0.9275796502661882,0.912573760014989],[0.7308252700000001,0.94018484],[0.14230272000000002,0.32105472]]]

Actual:   [[[0.3651, 0.3], [0.9276, 0.9126], [0.7309, 0.9402], [0.1424, 0.3211]]]

Expected: [[[0.3651, 0.3], [0.9276, 0.9126], [0.7309, 0.9402], [0.1424, 0.3211]]]