import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min86374 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Min86374 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0PRe42818 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))

Min86374 = keras.layers.Minimum(name = 'Min86374', )([in0Min86374,in1Min86374])
Res85380 = keras.layers.Reshape((2, 2, 4), name = 'Res85380', )(Min86374)
Res67842 = keras.layers.Reshape((2, 8), name = 'Res67842', )(Res85380)
PRe42818 = keras.layers.PReLU(name = 'PRe42818', input_shape=(2, 1, 2, 2))(in0PRe42818)
Res67292 = keras.layers.Reshape((2, 1, 4), name = 'Res67292', )(PRe42818)
Res5537 = keras.layers.Reshape((2, 4), name = 'Res5537', )(Res67292)
Dot34191 = keras.layers.Dot(axes=(1, 1), name = 'Dot34191', )([Res67842,Res5537])
Loc83939 = keras.layers.LocallyConnected1D(2, (2),strides=(1), name = 'Loc83939', )(Dot34191)
Res86972 = keras.layers.Reshape((7, 2, 1), name = 'Res86972', )(Loc83939)
Res69047 = keras.layers.Reshape((7, 2, 1, 1), name = 'Res69047', )(Res86972)
Cro98165 = keras.layers.Cropping3D(cropping=((5, 0), (0, 1), (0, 0)), name = 'Cro98165', )(Res69047)
Glo28028 = keras.layers.GlobalAveragePooling3D(name = 'Glo28028', )(Cro98165)
model = tf.keras.models.Model(inputs=[in0Min86374,in1Min86374,in0PRe42818], outputs=Glo28028)
w = model.get_layer('PRe42818').get_weights() 
w[0] = np.array([[[[0.7932, 0.6853], [0.5917, 0.8246]]], [[[0.2816, 0.2801], [0.4692, 0.7546]]]])
model.get_layer('PRe42818').set_weights(w) 
w = model.get_layer('Loc83939').get_weights() 
w[0] = np.array([[[0.6367, 0.6756], [0.2911, 0.2113], [0.7734, 0.3729], [0.706, 0.0212], [0.9202, 0.7891], [0.9289, 0.4826], [0.351, 0.0221], [0.5119, 0.8545]], [[0.5185, 0.9127], [0.6818, 0.6246], [0.1606, 0.9566], [0.2908, 0.6534], [0.9273, 0.5043], [0.7329, 0.8021], [0.15, 0.9895], [0.5354, 0.5184]], [[0.8712, 0.03], [0.6036, 0.3535], [0.5392, 0.3805], [0.6412, 0.4013], [0.8323, 0.879], [0.1006, 0.2115], [0.9245, 0.7271], [0.1262, 0.8127]], [[0.1286, 0.671], [0.3462, 0.1003], [0.2617, 0.9078], [0.0418, 0.9941], [0.2644, 0.8349], [0.1745, 0.4497], [0.5772, 0.0778], [0.9897, 0.6218]], [[0.5262, 0.5867], [0.4316, 0.2183], [0.5043, 0.9747], [0.4001, 0.3599], [0.0465, 0.687], [0.9618, 0.0667], [0.9926, 0.0347], [0.9858, 0.8265]], [[0.808, 0.6059], [0.3179, 0.5725], [0.7876, 0.0757], [0.5292, 0.7925], [0.3106, 0.9748], [0.4783, 0.4278], [0.5287, 0.5503], [0.4137, 0.6763]], [[0.8753, 0.4533], [0.1075, 0.8118], [0.5634, 0.6217], [0.56, 0.6537], [0.8048, 0.3916], [0.1453, 0.3781], [0.8246, 0.5685], [0.6759, 0.9468]]])
w[1] = np.array([[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]])
model.get_layer('Loc83939').set_weights(w) 
in0Min86374 = tf.constant([[[[[0.4817, 0.4505], [0.6556, 0.5756]], [[0.346, 0.0015], [0.4135, 0.9115]]], [[[0.0457, 0.4431], [0.2821, 0.6619]], [[0.2289, 0.983], [0.6978, 0.4766]]]]])
in1Min86374 = tf.constant([[[[[0.2235, 0.2451], [0.9594, 0.1184]], [[0.8391, 0.3303], [0.7989, 0.4555]]], [[[0.3235, 0.5423], [0.315, 0.1749]], [[0.3704, 0.7841], [0.22, 0.2659]]]]])
in0PRe42818 = tf.constant([[[[[0.9379, 0.2898], [0.8575, 0.248]]], [[[0.0431, 0.7943], [0.991, 0.3204]]]]])
print (np.array2string(model.predict([in0Min86374,in1Min86374,in0PRe42818],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo28028.png')

LMin86374 = minimum_layer([[[[[[0.4817, 0.4505], [0.6556, 0.5756]], [[0.346, 0.0015], [0.4135, 0.9115]]], [[[0.0457, 0.4431], [0.2821, 0.6619]], [[0.2289, 0.983], [0.6978, 0.4766]]]]], [[[[[0.2235, 0.2451], [0.9594, 0.1184]], [[0.8391, 0.3303], [0.7989, 0.4555]]], [[[0.3235, 0.5423], [0.315, 0.1749]], [[0.3704, 0.7841], [0.22, 0.2659]]]]]], Min86374), 
LRes85380 = reshape_layer(Min86374, [2, 2, 4], Res85380), 
LRes67842 = reshape_layer(Res85380, [2, 8], Res67842), 
LPRe42818 = prelu_layer([[[[[0.9379, 0.2898], [0.8575, 0.248]]], [[[0.0431, 0.7943], [0.991, 0.3204]]]]], [[[[0.7932, 0.6853], [0.5917, 0.8246]]], [[[0.2816, 0.2801], [0.4692, 0.7546]]]], PRe42818), 
LRes67292 = reshape_layer(PRe42818, [2, 1, 4], Res67292), 
LRes5537 = reshape_layer(Res67292, [2, 4], Res5537), 
LDot34191 = dot_layer(Res67842,Res5537, 1, 1, Dot34191), 
LLoc83939 = locally_connected1D_layer(Dot34191, 2,[[[0.6367, 0.6756], [0.2911, 0.2113], [0.7734, 0.3729], [0.706, 0.0212], [0.9202, 0.7891], [0.9289, 0.4826], [0.351, 0.0221], [0.5119, 0.8545]], [[0.5185, 0.9127], [0.6818, 0.6246], [0.1606, 0.9566], [0.2908, 0.6534], [0.9273, 0.5043], [0.7329, 0.8021], [0.15, 0.9895], [0.5354, 0.5184]], [[0.8712, 0.03], [0.6036, 0.3535], [0.5392, 0.3805], [0.6412, 0.4013], [0.8323, 0.879], [0.1006, 0.2115], [0.9245, 0.7271], [0.1262, 0.8127]], [[0.1286, 0.671], [0.3462, 0.1003], [0.2617, 0.9078], [0.0418, 0.9941], [0.2644, 0.8349], [0.1745, 0.4497], [0.5772, 0.0778], [0.9897, 0.6218]], [[0.5262, 0.5867], [0.4316, 0.2183], [0.5043, 0.9747], [0.4001, 0.3599], [0.0465, 0.687], [0.9618, 0.0667], [0.9926, 0.0347], [0.9858, 0.8265]], [[0.808, 0.6059], [0.3179, 0.5725], [0.7876, 0.0757], [0.5292, 0.7925], [0.3106, 0.9748], [0.4783, 0.4278], [0.5287, 0.5503], [0.4137, 0.6763]], [[0.8753, 0.4533], [0.1075, 0.8118], [0.5634, 0.6217], [0.56, 0.6537], [0.8048, 0.3916], [0.1453, 0.3781], [0.8246, 0.5685], [0.6759, 0.9468]]],[[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], 1, Loc83939), 
LRes86972 = reshape_layer(Loc83939, [7, 2, 1], Res86972), 
LRes69047 = reshape_layer(Res86972, [7, 2, 1, 1], Res69047), 
LCro98165 = cropping3D_layer(Res69047, 5, 0, 0, 1, 0, 0, Cro98165), 
LGlo28028 = global_average_pooling3D_layer(Cro98165, Glo28028), 
exec_layers([LMin86374,LRes85380,LRes67842,LPRe42818,LRes67292,LRes5537,LDot34191,LLoc83939,LRes86972,LRes69047,LCro98165,LGlo28028],["Min86374","Res85380","Res67842","PRe42818","Res67292","Res5537","Dot34191","Loc83939","Res86972","Res69047","Cro98165","Glo28028"],Glo28028,"Glo28028")

Actual (Unparsed): [[1.7432457]]

Expected (Unparsed): [[1.743245730066]]

Actual:   [[1.7433]]

Expected: [[1.7433]]