import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add91241 = tf.keras.layers.Input(shape=([1, 1]))
in1Add91241 = tf.keras.layers.Input(shape=([1, 1]))
in0Con79618 = tf.keras.layers.Input(shape=([2, 3, 1]))
in0Sub52136 = tf.keras.layers.Input(shape=([2, 3, 2]))
in1Sub52136 = tf.keras.layers.Input(shape=([2, 3, 2]))
in0Add15223 = tf.keras.layers.Input(shape=([1, 1]))
in1Add15223 = tf.keras.layers.Input(shape=([1, 1]))
in0GRU53602 = tf.keras.layers.Input(shape=([1, 3]))
in0Con1277 = tf.keras.layers.Input(shape=([11]))

Add91241 = keras.layers.Add(name = 'Add91241', )([in0Add91241,in1Add91241])
Res32539 = keras.layers.Reshape((1, 1, 1), name = 'Res32539', )(Add91241)
Zer73459 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer73459', )(Res32539)
Con79618 = keras.layers.Concatenate(axis=3, name = 'Con79618', )([Zer73459,in0Con79618])
Sub52136 = keras.layers.Subtract(name = 'Sub52136', )([in0Sub52136,in1Sub52136])
Add8445 = keras.layers.Add(name = 'Add8445', )([Con79618,Sub52136])
Res73195 = keras.layers.Reshape((2, 6), name = 'Res73195', )(Add8445)
Fla60159 = keras.layers.Flatten(name = 'Fla60159', )(Res73195)
Add15223 = keras.layers.Add(name = 'Add15223', )([in0Add15223,in1Add15223])
Fla4797 = keras.layers.Flatten(name = 'Fla4797', )(Add15223)
GRU53602 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU53602', )(in0GRU53602)
Mul51438 = keras.layers.Multiply(name = 'Mul51438', )([Fla4797,GRU53602])
Con1277 = keras.layers.Concatenate(axis=1, name = 'Con1277', )([Mul51438,in0Con1277])
Ave93582 = keras.layers.Average(name = 'Ave93582', )([Fla60159,Con1277])
model = tf.keras.models.Model(inputs=[in0Add91241,in1Add91241,in0Con79618,in0Sub52136,in1Sub52136,in0Add15223,in1Add15223,in0GRU53602,in0Con1277], outputs=Ave93582)
w = model.get_layer('GRU53602').get_weights() 
w[0] = np.array([[5, 8, 5], [1, 1, 9], [2, 6, 9]])
w[1] = np.array([[6, 3, 1]])
w[2] = np.array([[5, 4, 9], [7, 4, 1]])
model.get_layer('GRU53602').set_weights(w) 
in0Add91241 = tf.constant([[[0.0652]]])
in1Add91241 = tf.constant([[[0.1177]]])
in0Con79618 = tf.constant([[[[0.4913], [0.6601], [0.1621]], [[0.731], [0.1748], [0.0621]]]])
in0Sub52136 = tf.constant([[[[0.9933, 0.9462], [0.6341, 0.6178], [0.9445, 0.7537]], [[0.5293, 0.2722], [0.3266, 0.3491], [0.8017, 0.0661]]]])
in1Sub52136 = tf.constant([[[[0.0642, 0.5659], [0.8661, 0.9687], [0.7259, 0.7698]], [[0.1357, 0.2466], [0.9922, 0.9148], [0.7457, 0.8819]]]])
in0Add15223 = tf.constant([[[0.8751]]])
in1Add15223 = tf.constant([[[0.1957]]])
in0GRU53602 = tf.constant([[[6, 2, 1]]])
in0Con1277 = tf.constant([[0.2031, 0.3387, 0.8381, 0.0167, 0.5079, 0.4952, 0.7444, 0.7143, 0.453, 0.9828, 0.8764]])
print (np.array2string(model.predict([in0Add91241,in1Add91241,in0Con79618,in0Sub52136,in1Sub52136,in0Add15223,in1Add15223,in0GRU53602,in0Con1277],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave93582.png')

LAdd91241 = add_layer([[[[0.0652]]], [[[0.1177]]]], Add91241), 
LRes32539 = reshape_layer(Add91241, [1, 1, 1], Res32539), 
LZer73459 = zero_padding2D_layer(Res32539, 1, 0, 2, 0, Zer73459), 
LCon79618 = concatenate_layer([Zer73459,[[[[0.4913], [0.6601], [0.1621]], [[0.731], [0.1748], [0.0621]]]]], 3, Con79618), 
LSub52136 = subtract_layer([[[[0.9933, 0.9462], [0.6341, 0.6178], [0.9445, 0.7537]], [[0.5293, 0.2722], [0.3266, 0.3491], [0.8017, 0.0661]]]], [[[[0.0642, 0.5659], [0.8661, 0.9687], [0.7259, 0.7698]], [[0.1357, 0.2466], [0.9922, 0.9148], [0.7457, 0.8819]]]], Sub52136), 
LAdd8445 = add_layer([Con79618,Sub52136], Add8445), 
LRes73195 = reshape_layer(Add8445, [2, 6], Res73195), 
LFla60159 = flatten_layer(Res73195, Fla60159), 
LAdd15223 = add_layer([[[[0.8751]]], [[[0.1957]]]], Add15223), 
LFla4797 = flatten_layer(Add15223, Fla4797), 
LGRU53602 = gru_layer([[[6, 2, 1]]],[[5, 8, 5], [1, 1, 9], [2, 6, 9]],[[6, 3, 1]],[[5, 4, 9], [7, 4, 1]], true, GRU53602), 
LMul51438 = multiply_layer([Fla4797,GRU53602], Mul51438), 
LCon1277 = concatenate_layer([Mul51438,[[0.2031, 0.3387, 0.8381, 0.0167, 0.5079, 0.4952, 0.7444, 0.7143, 0.453, 0.9828, 0.8764]]], 1, Con1277), 
LAve93582 = average_layer([Fla60159,Con1277], Ave93582), 
exec_layers([LAdd91241,LRes32539,LZer73459,LCon79618,LSub52136,LAdd8445,LRes73195,LFla60159,LAdd15223,LFla4797,LGRU53602,LMul51438,LCon1277,LAve93582],["Add91241","Res32539","Zer73459","Con79618","Sub52136","Add8445","Res73195","Fla60159","Add15223","Fla4797","GRU53602","Mul51438","Con1277","Ave93582"],Ave93582,"Ave93582")

Actual (Unparsed): [[0.4645500, 0.5373500, 0.0533500, 0.5736500, 0.1176500, 0.3269500, 0.4444000, 0.7505000, 0.0243500, 0.0310500, 0.6108500, 0.0613500]]

Expected (Unparsed): [[0.46454999999999996,0.5373500000000001,0.05335000000000001,0.57365,0.11765,0.32695,0.4444,0.7505,0.02435000000000004,0.031050000000000078,0.61085,0.061350000000000016]]

Actual:   [[0.4646, 0.5374, 0.0534, 0.5737, 0.1177, 0.327, 0.4444, 0.7505, 0.0244, 0.0311, 0.6109, 0.0614]]

Expected: [[0.4646, 0.5374, 0.0534, 0.5737, 0.1177, 0.327, 0.4444, 0.7505, 0.0244, 0.0311, 0.6109, 0.0614]]