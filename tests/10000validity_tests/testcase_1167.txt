import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave66427 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Ave66427 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Con28046 = tf.keras.layers.Input(shape=([3, 1]))
in0Sub80474 = tf.keras.layers.Input(shape=([3, 3]))
in1Sub80474 = tf.keras.layers.Input(shape=([3, 3]))
in0Mul92678 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul92678 = tf.keras.layers.Input(shape=([2, 2]))
in0Con94524 = tf.keras.layers.Input(shape=([3, 1]))

Ave66427 = keras.layers.Average(name = 'Ave66427', )([in0Ave66427,in1Ave66427])
Res83703 = keras.layers.Reshape((2, 1, 2), name = 'Res83703', )(Ave66427)
Res87034 = keras.layers.Reshape((2, 2), name = 'Res87034', )(Res83703)
Zer68746 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer68746', )(Res87034)
Con28046 = keras.layers.Concatenate(axis=2, name = 'Con28046', )([Zer68746,in0Con28046])
Sub80474 = keras.layers.Subtract(name = 'Sub80474', )([in0Sub80474,in1Sub80474])
Sub20568 = keras.layers.Subtract(name = 'Sub20568', )([Con28046,Sub80474])
Mul92678 = keras.layers.Multiply(name = 'Mul92678', )([in0Mul92678,in1Mul92678])
Ave4137 = keras.layers.AveragePooling1D(pool_size=(2), name = 'Ave4137', )(Mul92678)
Zer43614 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer43614', )(Ave4137)
Con94524 = keras.layers.Concatenate(axis=2, name = 'Con94524', )([Zer43614,in0Con94524])
Mul40763 = keras.layers.Multiply(name = 'Mul40763', )([Sub20568,Con94524])
Res17686 = keras.layers.Reshape((3, 3, 1), name = 'Res17686', )(Mul40763)
Ave17463 = keras.layers.AveragePooling2D(pool_size=(2, 1), name = 'Ave17463', )(Res17686)
model = tf.keras.models.Model(inputs=[in0Ave66427,in1Ave66427,in0Con28046,in0Sub80474,in1Sub80474,in0Mul92678,in1Mul92678,in0Con94524], outputs=Ave17463)
in0Ave66427 = tf.constant([[[[[0.2338, 0.6582]]], [[[0.0561, 0.9326]]]]])
in1Ave66427 = tf.constant([[[[[0.2674, 0.741]]], [[[0.8808, 0.8235]]]]])
in0Con28046 = tf.constant([[[0.752], [0.82], [0.9711]]])
in0Sub80474 = tf.constant([[[0.8966, 0.2301, 0.4495], [0.6348, 0.9678, 0.4017], [0.768, 0.2768, 0.3736]]])
in1Sub80474 = tf.constant([[[0.4024, 0.2548, 0.6122], [0.5254, 0.5304, 0.0947], [0.732, 0.6628, 0.1413]]])
in0Mul92678 = tf.constant([[[0.8599, 0.4775], [0.4773, 0.0705]]])
in1Mul92678 = tf.constant([[[0.6236, 0.9481], [0.3712, 0.0707]]])
in0Con94524 = tf.constant([[[0.4513], [0.3104], [0.0832]]])
print (np.array2string(model.predict([in0Ave66427,in1Ave66427,in0Con28046,in0Sub80474,in1Sub80474,in0Mul92678,in1Mul92678,in0Con94524],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave17463.png')

LAve66427 = average_layer([[[[[[0.2338, 0.6582]]], [[[0.0561, 0.9326]]]]], [[[[[0.2674, 0.741]]], [[[0.8808, 0.8235]]]]]], Ave66427), 
LRes83703 = reshape_layer(Ave66427, [2, 1, 2], Res83703), 
LRes87034 = reshape_layer(Res83703, [2, 2], Res87034), 
LZer68746 = zero_padding1D_layer(Res87034, 1, 0, Zer68746), 
LCon28046 = concatenate_layer([Zer68746,[[[0.752], [0.82], [0.9711]]]], 2, Con28046), 
LSub80474 = subtract_layer([[[0.8966, 0.2301, 0.4495], [0.6348, 0.9678, 0.4017], [0.768, 0.2768, 0.3736]]], [[[0.4024, 0.2548, 0.6122], [0.5254, 0.5304, 0.0947], [0.732, 0.6628, 0.1413]]], Sub80474), 
LSub20568 = subtract_layer(Con28046,Sub80474, Sub20568), 
LMul92678 = multiply_layer([[[[0.8599, 0.4775], [0.4773, 0.0705]]], [[[0.6236, 0.9481], [0.3712, 0.0707]]]], Mul92678), 
LAve4137 = average_pooling1D_layer(Mul92678, 2, Ave4137), 
LZer43614 = zero_padding1D_layer(Ave4137, 2, 0, Zer43614), 
LCon94524 = concatenate_layer([Zer43614,[[[0.4513], [0.3104], [0.0832]]]], 2, Con94524), 
LMul40763 = multiply_layer([Sub20568,Con94524], Mul40763), 
LRes17686 = reshape_layer(Mul40763, [3, 3, 1], Res17686), 
LAve17463 = average_pooling2D_layer(Res17686, 2, 1, Ave17463), 
exec_layers([LAve66427,LRes83703,LRes87034,LZer68746,LCon28046,LSub80474,LSub20568,LMul92678,LAve4137,LZer43614,LCon94524,LMul40763,LRes17686,LAve17463],["Ave66427","Res83703","Res87034","Zer68746","Con28046","Sub80474","Sub20568","Mul92678","Ave4137","Zer43614","Con94524","Mul40763","Res17686","Ave17463"],Ave17463,"Ave17463")

Actual (Unparsed): [[[[0.0000000], [0.0000000], [0.2860197]]]]

Expected (Unparsed): [[[[0.0],[0.0],[0.28601965499999993]]]]

Actual:   [[[[0], [0], [0.2861]]]]

Expected: [[[[0], [0], [0.2861]]]]