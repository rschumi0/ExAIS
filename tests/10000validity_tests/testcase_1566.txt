import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot15715 = tf.keras.layers.Input(shape=([2]))
in1Dot15715 = tf.keras.layers.Input(shape=([2]))
in0Con88 = tf.keras.layers.Input(shape=([4]))
in0Con88509 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Loc17262 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con4210 = tf.keras.layers.Input(shape=([1, 2, 5]))

Dot15715 = keras.layers.Dot(axes=(1, 1), name = 'Dot15715', )([in0Dot15715,in1Dot15715])
Res43199 = keras.layers.Reshape((1, 1), name = 'Res43199', )(Dot15715)
Res87776 = keras.layers.Reshape((1, 1, 1), name = 'Res87776', )(Res43199)
Up_67138 = keras.layers.UpSampling2D(size=(2, 2), name = 'Up_67138', )(Res87776)
Res68791 = keras.layers.Reshape((2, 2), name = 'Res68791', )(Up_67138)
Fla81188 = keras.layers.Flatten(name = 'Fla81188', )(Res68791)
Con88 = keras.layers.Concatenate(axis=1, name = 'Con88', )([Fla81188,in0Con88])
Con88509 = keras.layers.Conv3DTranspose(4, (1, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con88509', )(in0Con88509)
Bat1311 = keras.layers.BatchNormalization(axis=3, epsilon=0.7236897961543132,  name = 'Bat1311', )(Con88509)
Res44815 = keras.layers.Reshape((1, 2, 8), name = 'Res44815', )(Bat1311)
Loc17262 = keras.layers.LocallyConnected2D(3, (1, 1),strides=(1, 7), name = 'Loc17262', )(in0Loc17262)
ReL33194 = keras.layers.ReLU(max_value=8.889852231104642, negative_slope=4.204845602416039, threshold=1.9459670676132457, name = 'ReL33194', )(Loc17262)
Zer91187 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer91187', )(ReL33194)
Con4210 = keras.layers.Concatenate(axis=3, name = 'Con4210', )([Zer91187,in0Con4210])
Mul50064 = keras.layers.Multiply(name = 'Mul50064', )([Res44815,Con4210])
Glo16129 = keras.layers.GlobalMaxPool2D(name = 'Glo16129', )(Mul50064)
Mul4177 = keras.layers.Multiply(name = 'Mul4177', )([Con88,Glo16129])
model = tf.keras.models.Model(inputs=[in0Dot15715,in1Dot15715,in0Con88,in0Con88509,in0Loc17262,in0Con4210], outputs=Mul4177)
w = model.get_layer('Con88509').get_weights() 
w[0] = np.array([[[[[0.4627], [0.8313], [0.6037], [0.6052]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con88509').set_weights(w) 
w = model.get_layer('Bat1311').get_weights() 
w[0] = np.array([0.3192, 0.4274])
w[1] = np.array([0.2656, 0.0891])
w[2] = np.array([0.3541, 0.0622])
w[3] = np.array([0.1487, 0.5119])
model.get_layer('Bat1311').set_weights(w) 
w = model.get_layer('Loc17262').get_weights() 
w[0] = np.array([[[0.0063, 0.4873, 0.9502]]])
w[1] = np.array([[[0, 0, 0]]])
model.get_layer('Loc17262').set_weights(w) 
in0Dot15715 = tf.constant([[0.9898, 0.6309]])
in1Dot15715 = tf.constant([[0.4527, 0.5372]])
in0Con88 = tf.constant([[0.9515, 0.5926, 0.6534, 0.7018]])
in0Con88509 = tf.constant([[[[[0.6231], [0.861]], [[0.2222], [0.3688]]]]])
in0Loc17262 = tf.constant([[[[0.5931]]]])
in0Con4210 = tf.constant([[[[0.1893, 0.4815, 0.817, 0.3116, 0.2789], [0.1474, 0.0512, 0.3652, 0.4233, 0.2895]]]])
print (np.array2string(model.predict([in0Dot15715,in1Dot15715,in0Con88,in0Con88509,in0Loc17262,in0Con4210],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul4177.png')

LDot15715 = dot_layer([[0.9898, 0.6309]], [[0.4527, 0.5372]], 1, 1, Dot15715), 
LRes43199 = reshape_layer(Dot15715, [1, 1], Res43199), 
LRes87776 = reshape_layer(Res43199, [1, 1, 1], Res87776), 
LUp_67138 = up_sampling2D_layer(Res87776, 2, 2, Up_67138), 
LRes68791 = reshape_layer(Up_67138, [2, 2], Res68791), 
LFla81188 = flatten_layer(Res68791, Fla81188), 
LCon88 = concatenate_layer([Fla81188,[[0.9515, 0.5926, 0.6534, 0.7018]]], 1, Con88), 
LCon88509 = conv3D_transpose_layer([[[[[0.6231], [0.861]], [[0.2222], [0.3688]]]]], 1, 1, 1,[[[[[0.4627], [0.8313], [0.6037], [0.6052]]]]],[0, 0, 0, 0], 1, 1, 1, false, Con88509), 
LBat1311 = batch_normalization_layer(Con88509, 3, 0.7236897961543132, [0.3192, 0.4274], [0.2656, 0.0891], [0.3541, 0.0622], [0.1487, 0.5119], Bat1311), 
LRes44815 = reshape_layer(Bat1311, [1, 2, 8], Res44815), 
LLoc17262 = locally_connected2D_layer([[[[0.5931]]]], 1, 1,[[[0.0063, 0.4873, 0.9502]]],[[[0, 0, 0]]], 1, 7, Loc17262), 
LReL33194 = relu_layer(Loc17262, 8.889852231104642, 4.204845602416039, 1.9459670676132457, ReL33194), 
LZer91187 = zero_padding2D_layer(ReL33194, 0, 0, 1, 0, Zer91187), 
LCon4210 = concatenate_layer([Zer91187,[[[[0.1893, 0.4815, 0.817, 0.3116, 0.2789], [0.1474, 0.0512, 0.3652, 0.4233, 0.2895]]]]], 3, Con4210), 
LMul50064 = multiply_layer([Res44815,Con4210], Mul50064), 
LGlo16129 = global_max_pool2D_layer(Mul50064, Glo16129), 
LMul4177 = multiply_layer([Con88,Glo16129], Mul4177), 
exec_layers([LDot15715,LRes43199,LRes87776,LUp_67138,LRes68791,LFla81188,LCon88,LCon88509,LBat1311,LRes44815,LLoc17262,LReL33194,LZer91187,LCon4210,LMul50064,LGlo16129,LMul4177],["Dot15715","Res43199","Res87776","Up_67138","Res68791","Fla81188","Con88","Con88509","Bat1311","Res44815","Loc17262","ReL33194","Zer91187","Con4210","Mul50064","Glo16129","Mul4177"],Mul4177,"Mul4177")

Actual (Unparsed): [[0.0000000, 0.0000000, 0.0000000, 0.0407400, 0.1000426, 0.1648014, 0.0539624, 0.0519744]]

Expected (Unparsed): [[0.0,0.0,0.0,0.04073996596108918,0.10004255450770647,0.16480139066279345,0.05396242592805148,0.051974425478457494]]

Actual:   [[0, 0, 0, 0.0408, 0.1001, 0.1649, 0.054, 0.052]]

Expected: [[0, 0, 0, 0.0408, 0.1001, 0.1649, 0.054, 0.052]]