import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot15035 = tf.keras.layers.Input(shape=([3]))
in1Dot15035 = tf.keras.layers.Input(shape=([3]))
in0Con9278 = tf.keras.layers.Input(shape=([7]))
in0Fla31093 = tf.keras.layers.Input(shape=([2, 1, 4]))

Dot15035 = keras.layers.Dot(axes=(1, 1), name = 'Dot15035', )([in0Dot15035,in1Dot15035])
Con9278 = keras.layers.Concatenate(axis=1, name = 'Con9278', )([Dot15035,in0Con9278])
Fla31093 = keras.layers.Flatten(name = 'Fla31093', )(in0Fla31093)
Mul12594 = keras.layers.Multiply(name = 'Mul12594', )([Con9278,Fla31093])
Res58540 = keras.layers.Reshape((8, 1), name = 'Res58540', )(Mul12594)
Loc91653 = keras.layers.LocallyConnected1D(4, (1),strides=(1), name = 'Loc91653', )(Res58540)
model = tf.keras.models.Model(inputs=[in0Dot15035,in1Dot15035,in0Con9278,in0Fla31093], outputs=Loc91653)
w = model.get_layer('Loc91653').get_weights() 
w[0] = np.array([[[0.5602, 0.9359, 0.3137, 0.5882]], [[0.6585, 0.9345, 0.7623, 0.1025]], [[0.8869, 0.3173, 0.6662, 0.7451]], [[0.2511, 0.4759, 0.5425, 0.6269]], [[0.8537, 0.4523, 0.9445, 0.646]], [[0.2493, 0.6339, 0.876, 0.8747]], [[0.1613, 0.9756, 0.1029, 0.6103]], [[0.2164, 0.7866, 0.4388, 0.3138]]])
w[1] = np.array([[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]])
model.get_layer('Loc91653').set_weights(w) 
in0Dot15035 = tf.constant([[0.5145, 0.2878, 0.6186]])
in1Dot15035 = tf.constant([[0.2132, 0.331, 0.1431]])
in0Con9278 = tf.constant([[0.4607, 0.0961, 0.9239, 0.7113, 0.5784, 0.169, 0.8802]])
in0Fla31093 = tf.constant([[[[1.5083, 1.728, 1.5804, 1.9425]], [[1.8004, 1.2188, 1.7747, 1.0634]]]])
print (np.array2string(model.predict([in0Dot15035,in1Dot15035,in0Con9278,in0Fla31093],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc91653.png')

LDot15035 = dot_layer([[0.5145, 0.2878, 0.6186]], [[0.2132, 0.331, 0.1431]], 1, 1, Dot15035), 
LCon9278 = concatenate_layer([Dot15035,[[0.4607, 0.0961, 0.9239, 0.7113, 0.5784, 0.169, 0.8802]]], 1, Con9278), 
LFla31093 = flatten_layer([[[[1.5083, 1.728, 1.5804, 1.9425]], [[1.8004, 1.2188, 1.7747, 1.0634]]]], Fla31093), 
LMul12594 = multiply_layer([Con9278,Fla31093], Mul12594), 
LRes58540 = reshape_layer(Mul12594, [8, 1], Res58540), 
LLoc91653 = locally_connected1D_layer(Res58540, 1,[[[0.5602, 0.9359, 0.3137, 0.5882]], [[0.6585, 0.9345, 0.7623, 0.1025]], [[0.8869, 0.3173, 0.6662, 0.7451]], [[0.2511, 0.4759, 0.5425, 0.6269]], [[0.8537, 0.4523, 0.9445, 0.646]], [[0.2493, 0.6339, 0.876, 0.8747]], [[0.1613, 0.9756, 0.1029, 0.6103]], [[0.2164, 0.7866, 0.4388, 0.3138]]],[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], 1, Loc91653), 
exec_layers([LDot15035,LCon9278,LFla31093,LMul12594,LRes58540,LLoc91653],["Dot15035","Con9278","Fla31093","Mul12594","Res58540","Loc91653"],Loc91653,"Loc91653")

Actual (Unparsed): [[[0.2479715, 0.4142744, 0.1388587, 0.2603656], [0.5242250, 0.7439458, 0.6068591, 0.0815992], [0.1346992, 0.0481904, 0.1011801, 0.1131631], [0.4506431, 0.8540862, 0.9736116, 1.1250822], [1.0932692, 0.5792265, 1.2095499, 0.8272835], [0.1757450, 0.4468703, 0.6175396, 0.6166232], [0.0483778, 0.2926062, 0.0308622, 0.1830438], [0.2025514, 0.7362613, 0.4107189, 0.2937183]]]

Expected (Unparsed): [[[0.24797148317554762,0.4142743861192342,0.13885871880073059,0.26036563085301156],[0.5242250016,0.7439457312,0.6068591020799999,0.08159918399999999],[0.13469921463600001,0.048190394412,0.101180084328,0.113163135444],[0.45064308082499993,0.8540861894249999,0.9736115943749999,1.1250822276749999],[1.0932691527240002,0.5792264703960001,1.2095498591400002,0.8272834399200001],[0.17574501225600003,0.4468702898880001,0.6175396339200001,0.6166231938240001],[0.048377789590000005,0.29260614708000005,0.030862210470000005,0.18304380029],[0.202551412752,0.736261281288,0.410718853584,0.293718268584]]]

Actual:   [[[0.248, 0.4143, 0.1389, 0.2604], [0.5243, 0.744, 0.6069, 0.0816], [0.1347, 0.0482, 0.1012, 0.1132], [0.4507, 0.8541, 0.9737, 1.1251], [1.0933, 0.5793, 1.2096, 0.8273], [0.1758, 0.4469, 0.6176, 0.6167], [0.0484, 0.2927, 0.0309, 0.1831], [0.2026, 0.7363, 0.4108, 0.2938]]]

Expected: [[[0.248, 0.4143, 0.1389, 0.2604], [0.5243, 0.744, 0.6069, 0.0816], [0.1347, 0.0482, 0.1012, 0.1132], [0.4507, 0.8541, 0.9737, 1.1251], [1.0933, 0.5793, 1.2096, 0.8273], [0.1758, 0.4469, 0.6176, 0.6167], [0.0484, 0.2927, 0.0309, 0.1831], [0.2026, 0.7363, 0.4108, 0.2938]]]