import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave94127 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave94127 = tf.keras.layers.Input(shape=([1, 2]))
in0Con20153 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Ave59357 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Ave59357 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Con6434 = tf.keras.layers.Input(shape=([2, 7, 1]))
in0Min57374 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Min57374 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Con65415 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Loc11425 = tf.keras.layers.Input(shape=([1, 1, 1]))

Ave94127 = keras.layers.Average(name = 'Ave94127', )([in0Ave94127,in1Ave94127])
Res25570 = keras.layers.Reshape((1, 2, 1), name = 'Res25570', )(Ave94127)
Res43337 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res43337', )(Res25570)
Con20153 = keras.layers.Concatenate(axis=4, name = 'Con20153', )([Res43337,in0Con20153])
Ave59357 = keras.layers.Average(name = 'Ave59357', )([in0Ave59357,in1Ave59357])
Min41032 = keras.layers.Minimum(name = 'Min41032', )([Con20153,Ave59357])
Res14990 = keras.layers.Reshape((1, 2, 2), name = 'Res14990', )(Min41032)
Res63375 = keras.layers.Reshape((1, 4), name = 'Res63375', )(Res14990)
Loc15505 = keras.layers.LocallyConnected1D(4, (1),strides=(1), name = 'Loc15505', )(Res63375)
Res4887 = keras.layers.Reshape((1, 4, 1), name = 'Res4887', )(Loc15505)
Zer80655 = keras.layers.ZeroPadding2D(padding=((1, 0), (3, 0)), name = 'Zer80655', )(Res4887)
Con6434 = keras.layers.Concatenate(axis=3, name = 'Con6434', )([Zer80655,in0Con6434])
Min57374 = keras.layers.Minimum(name = 'Min57374', )([in0Min57374,in1Min57374])
Lay92522 = keras.layers.LayerNormalization(axis=1, epsilon=1.00848325711213, name = 'Lay92522', )(Min57374)
Res11329 = keras.layers.Reshape((2, 1, 1), name = 'Res11329', )(Lay92522)
Con65415 = keras.layers.Concatenate(axis=3, name = 'Con65415', )([Res11329,in0Con65415])
Loc11425 = keras.layers.LocallyConnected2D(2, (1, 1),strides=(8, 1), name = 'Loc11425', )(in0Loc11425)
Max96699 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 1), padding='same', name = 'Max96699', )(Loc11425)
Zer57959 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer57959', )(Max96699)
Add53673 = keras.layers.Add(name = 'Add53673', )([Con65415,Zer57959])
Zer78769 = keras.layers.ZeroPadding2D(padding=((0, 0), (6, 0)), name = 'Zer78769', )(Add53673)
Mul73906 = keras.layers.Multiply(name = 'Mul73906', )([Con6434,Zer78769])
model = tf.keras.models.Model(inputs=[in0Ave94127,in1Ave94127,in0Con20153,in0Ave59357,in1Ave59357,in0Con6434,in0Min57374,in1Min57374,in0Con65415,in0Loc11425], outputs=Mul73906)
w = model.get_layer('Loc15505').get_weights() 
w[0] = np.array([[[0.8729, 0.845, 0.6494, 0.0907], [0.9704, 0.2231, 0.2089, 0.7618], [0.6703, 0.0543, 0.416, 0.5853], [0.9124, 0.5485, 0.5929, 0.6457]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc15505').set_weights(w) 
w = model.get_layer('Loc11425').get_weights() 
w[0] = np.array([[[0.7828, 0.369]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc11425').set_weights(w) 
in0Ave94127 = tf.constant([[[0.562, 0.6922]]])
in1Ave94127 = tf.constant([[[0.779, 0.0882]]])
in0Con20153 = tf.constant([[[[[0.8752]], [[0.85]]]]])
in0Ave59357 = tf.constant([[[[[0.19, 0.8971]], [[0.5662, 0.8378]]]]])
in1Ave59357 = tf.constant([[[[[0.1747, 0.9513]], [[0.3534, 0.0754]]]]])
in0Con6434 = tf.constant([[[[0.7586], [0.4399], [0.6756], [0.9767], [0.4864], [0.8963], [0.4]], [[0.1316], [0.4417], [0.0948], [0.8381], [0.0833], [0.1102], [0.6943]]]])
in0Min57374 = tf.constant([[[[[0.1906]]], [[[0.9202]]]]])
in1Min57374 = tf.constant([[[[[0.2404]]], [[[0.3751]]]]])
in0Con65415 = tf.constant([[[[0.0688]], [[0.6366]]]])
in0Loc11425 = tf.constant([[[[0.8319]]]])
print (np.array2string(model.predict([in0Ave94127,in1Ave94127,in0Con20153,in0Ave59357,in1Ave59357,in0Con6434,in0Min57374,in1Min57374,in0Con65415,in0Loc11425],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul73906.png')

LAve94127 = average_layer([[[[0.562, 0.6922]]], [[[0.779, 0.0882]]]], Ave94127), 
LRes25570 = reshape_layer(Ave94127, [1, 2, 1], Res25570), 
LRes43337 = reshape_layer(Res25570, [1, 2, 1, 1], Res43337), 
LCon20153 = concatenate_layer([Res43337,[[[[[0.8752]], [[0.85]]]]]], 4, Con20153), 
LAve59357 = average_layer([[[[[[0.19, 0.8971]], [[0.5662, 0.8378]]]]], [[[[[0.1747, 0.9513]], [[0.3534, 0.0754]]]]]], Ave59357), 
LMin41032 = minimum_layer([Con20153,Ave59357], Min41032), 
LRes14990 = reshape_layer(Min41032, [1, 2, 2], Res14990), 
LRes63375 = reshape_layer(Res14990, [1, 4], Res63375), 
LLoc15505 = locally_connected1D_layer(Res63375, 1,[[[0.8729, 0.845, 0.6494, 0.0907], [0.9704, 0.2231, 0.2089, 0.7618], [0.6703, 0.0543, 0.416, 0.5853], [0.9124, 0.5485, 0.5929, 0.6457]]],[[0, 0, 0, 0]], 1, Loc15505), 
LRes4887 = reshape_layer(Loc15505, [1, 4, 1], Res4887), 
LZer80655 = zero_padding2D_layer(Res4887, 1, 0, 3, 0, Zer80655), 
LCon6434 = concatenate_layer([Zer80655,[[[[0.7586], [0.4399], [0.6756], [0.9767], [0.4864], [0.8963], [0.4]], [[0.1316], [0.4417], [0.0948], [0.8381], [0.0833], [0.1102], [0.6943]]]]], 3, Con6434), 
LMin57374 = minimum_layer([[[[[[0.1906]]], [[[0.9202]]]]], [[[[[0.2404]]], [[[0.3751]]]]]], Min57374), 
LLay92522 = layer_normalization_layer(Min57374, 1, 1.00848325711213, Lay92522), 
LRes11329 = reshape_layer(Lay92522, [2, 1, 1], Res11329), 
LCon65415 = concatenate_layer([Res11329,[[[[0.0688]], [[0.6366]]]]], 3, Con65415), 
LLoc11425 = locally_connected2D_layer([[[[0.8319]]]], 1, 1,[[[0.7828, 0.369]]],[[[0, 0]]], 8, 1, Loc11425), 
LMax96699 = max_pool2D_layer(Loc11425, 1, 1, 1, 1, true, Max96699), 
LZer57959 = zero_padding2D_layer(Max96699, 1, 0, 0, 0, Zer57959), 
LAdd53673 = add_layer([Con65415,Zer57959], Add53673), 
LZer78769 = zero_padding2D_layer(Add53673, 0, 0, 6, 0, Zer78769), 
LMul73906 = multiply_layer([Con6434,Zer78769], Mul73906), 
exec_layers([LAve94127,LRes25570,LRes43337,LCon20153,LAve59357,LMin41032,LRes14990,LRes63375,LLoc15505,LRes4887,LZer80655,LCon6434,LMin57374,LLay92522,LRes11329,LCon65415,LLoc11425,LMax96699,LZer57959,LAdd53673,LZer78769,LMul73906],["Ave94127","Res25570","Res43337","Con20153","Ave59357","Min41032","Res14990","Res63375","Loc15505","Res4887","Zer80655","Con6434","Min57374","Lay92522","Res11329","Con65415","Loc11425","Max96699","Zer57959","Add53673","Zer78769","Mul73906"],Mul73906,"Mul73906")

Actual (Unparsed): [[[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [-0.0000000, 0.0275200]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.8960353, 0.6551214]]]]

Expected (Unparsed): [[[[0,0.0],[0,0.0],[0,0.0],[0,0.0],[0,0.0],[0,0.0],[-0.0,0.027520000000000003]],[[0,0.0],[0,0.0],[0,0.0],[0.0,0.0],[0.0,0.0],[0.0,0.0],[0.8960353475579336,0.6551214147300001]]]]

Actual:   [[[[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-0, 0.0276]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0.8961, 0.6552]]]]

Expected: [[[[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-0, 0.0276]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0.8961, 0.6552]]]]