import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot48744 = tf.keras.layers.Input(shape=([2]))
in1Dot48744 = tf.keras.layers.Input(shape=([2]))
in0Con10778 = tf.keras.layers.Input(shape=([3, 3, 2]))
in0Sub37508 = tf.keras.layers.Input(shape=([3, 3, 3]))
in1Sub37508 = tf.keras.layers.Input(shape=([3, 3, 3]))
in0Sub7160 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub7160 = tf.keras.layers.Input(shape=([2, 2]))
in0Con73318 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Loc75228 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con8962 = tf.keras.layers.Input(shape=([3, 2, 1]))

Dot48744 = keras.layers.Dot(axes=(1, 1), name = 'Dot48744', )([in0Dot48744,in1Dot48744])
Res81328 = keras.layers.Reshape((1, 1), name = 'Res81328', )(Dot48744)
Res37649 = keras.layers.Reshape((1, 1, 1), name = 'Res37649', )(Res81328)
Zer31090 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer31090', )(Res37649)
Con10778 = keras.layers.Concatenate(axis=3, name = 'Con10778', )([Zer31090,in0Con10778])
Sub37508 = keras.layers.Subtract(name = 'Sub37508', )([in0Sub37508,in1Sub37508])
Sub72573 = keras.layers.Subtract(name = 'Sub72573', )([Con10778,Sub37508])
Loc29891 = keras.layers.LocallyConnected2D(4, (1, 2),strides=(1, 1), name = 'Loc29891', )(Sub72573)
Sub7160 = keras.layers.Subtract(name = 'Sub7160', )([in0Sub7160,in1Sub7160])
Res40079 = keras.layers.Reshape((2, 2, 1), name = 'Res40079', )(Sub7160)
Con73318 = keras.layers.Concatenate(axis=3, name = 'Con73318', )([Res40079,in0Con73318])
Loc75228 = keras.layers.LocallyConnected2D(3, (1, 1),strides=(1, 1), name = 'Loc75228', )(in0Loc75228)
Zer88005 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer88005', )(Loc75228)
Mul74423 = keras.layers.Multiply(name = 'Mul74423', )([Con73318,Zer88005])
Zer31193 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer31193', )(Mul74423)
Con8962 = keras.layers.Concatenate(axis=3, name = 'Con8962', )([Zer31193,in0Con8962])
Ave33634 = keras.layers.Average(name = 'Ave33634', )([Loc29891,Con8962])
model = tf.keras.models.Model(inputs=[in0Dot48744,in1Dot48744,in0Con10778,in0Sub37508,in1Sub37508,in0Sub7160,in1Sub7160,in0Con73318,in0Loc75228,in0Con8962], outputs=Ave33634)
w = model.get_layer('Loc29891').get_weights() 
w[0] = np.array([[[0.9107, 0.1175, 0.6978, 0.4557], [0.3894, 0.7476, 0.2192, 0.0473], [0.9443, 0.3032, 0.9916, 0.3525], [0.4826, 0.3937, 0.1352, 0.174], [0.4533, 0.0991, 0.1684, 0.7439], [0.0607, 0.5907, 0.4493, 0.0876]], [[0.4126, 0.4885, 0.245, 0.1555], [0.5295, 0.6653, 0.2314, 0.8118], [0.3061, 0.4468, 0.8476, 0.591], [0.8451, 0.802, 0.2063, 0.8525], [0.0627, 0.1705, 0.1983, 0.5972], [0.1039, 0.0307, 0.0181, 0.7425]], [[0.899, 0.1787, 0.5848, 0.0981], [0.1437, 0.9554, 0.2381, 0.6305], [0.0901, 0.3393, 0.6451, 0.8612], [0.8014, 0.9026, 0.0725, 0.4031], [0.9377, 0.1198, 0.05, 0.7088], [0.7212, 0.4125, 0.9773, 0.0764]], [[0.4542, 0.6141, 0.4149, 0.8385], [0.8574, 0.2511, 0.6368, 0.4482], [0.5335, 0.1452, 0.5221, 0.8651], [0.0677, 0.3672, 0.0141, 0.2463], [0.6272, 0.4959, 0.1876, 0.4485], [0.4398, 0.4711, 0.4285, 0.2634]], [[0.1959, 0.0672, 0.3526, 0.6196], [0.2475, 0.1605, 0.8697, 0.2153], [0.4559, 0.5152, 0.2326, 0.1682], [0.6798, 0.7691, 0.0023, 0.3118], [0.1889, 0.6681, 0.606, 0.7058], [0.7371, 0.3642, 0.5711, 0.7775]], [[0.637, 0.7734, 0.574, 0.2675], [0.941, 0.5689, 0.1619, 0.8121], [0.7501, 0.3764, 0.3747, 0.5645], [0.7502, 0.1342, 0.5258, 0.7272], [0.3059, 0.38, 0.0816, 0.2524], [0.8274, 0.4376, 0.9235, 0.2486]]])
w[1] = np.array([[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]]])
model.get_layer('Loc29891').set_weights(w) 
w = model.get_layer('Loc75228').get_weights() 
w[0] = np.array([[[0.3644, 0.7883, 0.2973]]])
w[1] = np.array([[[0, 0, 0]]])
model.get_layer('Loc75228').set_weights(w) 
in0Dot48744 = tf.constant([[0.2818, 0.852]])
in1Dot48744 = tf.constant([[0.5296, 0.5435]])
in0Con10778 = tf.constant([[[[0.7131, 0.6955], [0.7894, 0.1691], [0.2098, 0.1926]], [[0.1724, 0.2565], [0.7272, 0.2177], [0.1687, 0.0267]], [[0.3045, 0.9084], [0.3007, 0.9048], [0.9471, 0.0366]]]])
in0Sub37508 = tf.constant([[[[0.0554, 0.9182, 0.1088], [0.2328, 0.0981, 0.5324], [0.9898, 0.5309, 0.4671]], [[0.516, 0.9461, 0.7727], [0.4544, 0.0721, 0.6903], [0.8688, 0.6576, 0.6767]], [[0.7089, 0.2403, 0.7717], [0.3128, 0.8484, 0.2128], [0.5012, 0.6158, 0.1099]]]])
in1Sub37508 = tf.constant([[[[0.8935, 0.9293, 0.5395], [0.8137, 0.9817, 0.4011], [0.2195, 0.2818, 0.928]], [[0.4794, 0.8179, 0.4515], [0.3485, 0.8118, 0.2639], [0.3825, 0.6269, 0.8144]], [[0.9704, 0.4477, 0.1905], [0.9188, 0.805, 0.109], [0.035, 0.7584, 0.8184]]]])
in0Sub7160 = tf.constant([[[0.5711, 0.691], [0.0734, 0.4939]]])
in1Sub7160 = tf.constant([[[0.279, 0.9725], [0.3068, 0.5718]]])
in0Con73318 = tf.constant([[[[0.9516, 0.2955], [0.0017, 0.3953]], [[0.0364, 0.6213], [0.0368, 0.371]]]])
in0Loc75228 = tf.constant([[[[0.1778]]]])
in0Con8962 = tf.constant([[[[0.9053], [0.5264]], [[0.4213], [0.3646]], [[0.7861], [0.8021]]]])
print (np.array2string(model.predict([in0Dot48744,in1Dot48744,in0Con10778,in0Sub37508,in1Sub37508,in0Sub7160,in1Sub7160,in0Con73318,in0Loc75228,in0Con8962],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave33634.png')

LDot48744 = dot_layer([[0.2818, 0.852]], [[0.5296, 0.5435]], 1, 1, Dot48744), 
LRes81328 = reshape_layer(Dot48744, [1, 1], Res81328), 
LRes37649 = reshape_layer(Res81328, [1, 1, 1], Res37649), 
LZer31090 = zero_padding2D_layer(Res37649, 2, 0, 2, 0, Zer31090), 
LCon10778 = concatenate_layer([Zer31090,[[[[0.7131, 0.6955], [0.7894, 0.1691], [0.2098, 0.1926]], [[0.1724, 0.2565], [0.7272, 0.2177], [0.1687, 0.0267]], [[0.3045, 0.9084], [0.3007, 0.9048], [0.9471, 0.0366]]]]], 3, Con10778), 
LSub37508 = subtract_layer([[[[0.0554, 0.9182, 0.1088], [0.2328, 0.0981, 0.5324], [0.9898, 0.5309, 0.4671]], [[0.516, 0.9461, 0.7727], [0.4544, 0.0721, 0.6903], [0.8688, 0.6576, 0.6767]], [[0.7089, 0.2403, 0.7717], [0.3128, 0.8484, 0.2128], [0.5012, 0.6158, 0.1099]]]], [[[[0.8935, 0.9293, 0.5395], [0.8137, 0.9817, 0.4011], [0.2195, 0.2818, 0.928]], [[0.4794, 0.8179, 0.4515], [0.3485, 0.8118, 0.2639], [0.3825, 0.6269, 0.8144]], [[0.9704, 0.4477, 0.1905], [0.9188, 0.805, 0.109], [0.035, 0.7584, 0.8184]]]], Sub37508), 
LSub72573 = subtract_layer(Con10778,Sub37508, Sub72573), 
LLoc29891 = locally_connected2D_layer(Sub72573, 1, 2,[[[0.9107, 0.1175, 0.6978, 0.4557], [0.3894, 0.7476, 0.2192, 0.0473], [0.9443, 0.3032, 0.9916, 0.3525], [0.4826, 0.3937, 0.1352, 0.174], [0.4533, 0.0991, 0.1684, 0.7439], [0.0607, 0.5907, 0.4493, 0.0876]], [[0.4126, 0.4885, 0.245, 0.1555], [0.5295, 0.6653, 0.2314, 0.8118], [0.3061, 0.4468, 0.8476, 0.591], [0.8451, 0.802, 0.2063, 0.8525], [0.0627, 0.1705, 0.1983, 0.5972], [0.1039, 0.0307, 0.0181, 0.7425]], [[0.899, 0.1787, 0.5848, 0.0981], [0.1437, 0.9554, 0.2381, 0.6305], [0.0901, 0.3393, 0.6451, 0.8612], [0.8014, 0.9026, 0.0725, 0.4031], [0.9377, 0.1198, 0.05, 0.7088], [0.7212, 0.4125, 0.9773, 0.0764]], [[0.4542, 0.6141, 0.4149, 0.8385], [0.8574, 0.2511, 0.6368, 0.4482], [0.5335, 0.1452, 0.5221, 0.8651], [0.0677, 0.3672, 0.0141, 0.2463], [0.6272, 0.4959, 0.1876, 0.4485], [0.4398, 0.4711, 0.4285, 0.2634]], [[0.1959, 0.0672, 0.3526, 0.6196], [0.2475, 0.1605, 0.8697, 0.2153], [0.4559, 0.5152, 0.2326, 0.1682], [0.6798, 0.7691, 0.0023, 0.3118], [0.1889, 0.6681, 0.606, 0.7058], [0.7371, 0.3642, 0.5711, 0.7775]], [[0.637, 0.7734, 0.574, 0.2675], [0.941, 0.5689, 0.1619, 0.8121], [0.7501, 0.3764, 0.3747, 0.5645], [0.7502, 0.1342, 0.5258, 0.7272], [0.3059, 0.38, 0.0816, 0.2524], [0.8274, 0.4376, 0.9235, 0.2486]]],[[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]]], 1, 1, Loc29891), 
LSub7160 = subtract_layer([[[0.5711, 0.691], [0.0734, 0.4939]]], [[[0.279, 0.9725], [0.3068, 0.5718]]], Sub7160), 
LRes40079 = reshape_layer(Sub7160, [2, 2, 1], Res40079), 
LCon73318 = concatenate_layer([Res40079,[[[[0.9516, 0.2955], [0.0017, 0.3953]], [[0.0364, 0.6213], [0.0368, 0.371]]]]], 3, Con73318), 
LLoc75228 = locally_connected2D_layer([[[[0.1778]]]], 1, 1,[[[0.3644, 0.7883, 0.2973]]],[[[0, 0, 0]]], 1, 1, Loc75228), 
LZer88005 = zero_padding2D_layer(Loc75228, 1, 0, 1, 0, Zer88005), 
LMul74423 = multiply_layer([Con73318,Zer88005], Mul74423), 
LZer31193 = zero_padding2D_layer(Mul74423, 1, 0, 0, 0, Zer31193), 
LCon8962 = concatenate_layer([Zer31193,[[[[0.9053], [0.5264]], [[0.4213], [0.3646]], [[0.7861], [0.8021]]]]], 3, Con8962), 
LAve33634 = average_layer([Loc29891,Con8962], Ave33634), 
exec_layers([LDot48744,LRes81328,LRes37649,LZer31090,LCon10778,LSub37508,LSub72573,LLoc29891,LSub7160,LRes40079,LCon73318,LLoc75228,LZer88005,LMul74423,LZer31193,LCon8962,LAve33634],["Dot48744","Res81328","Res37649","Zer31090","Con10778","Sub37508","Sub72573","Loc29891","Sub7160","Res40079","Con73318","Loc75228","Zer88005","Mul74423","Zer31193","Con8962","Ave33634"],Ave33634,"Ave33634")

Actual (Unparsed): [[[[1.5748697, 0.6990878, 1.1187826, 1.5336975], [0.2757787, 0.4046434, 0.2033071, 0.9011421]], [[0.5538741, 0.0038981, -0.0954564, 0.6854819], [0.6121065, 0.1201579, 0.4353496, 0.3690707]], [[0.6890367, 0.5990036, 0.6141399, 1.0533516], [1.1416830, 0.8407307, 0.7815436, 1.0959206]]]]

Expected (Unparsed): [[[[1.574869755,0.6990877999999999,1.11878258,1.533697455],[0.27577871499999995,0.404643395,0.20330712499999998,0.901142095]],[[0.55387405,0.003898039999999922,-0.09545644500000003,0.6854818749999998],[0.61210652,0.12015791999999997,0.43534955499999994,0.36907066499999996]],[[0.689036725,0.59900356,0.614139875,1.0533515750000002],[1.1416829423639998,0.840730734304,0.7815435411819999,1.0959206376080002]]]]

Actual:   [[[[1.5749, 0.6991, 1.1188, 1.5337], [0.2758, 0.4047, 0.2034, 0.9012]], [[0.5539, 0.0039, -0.0954, 0.6855], [0.6122, 0.1202, 0.4354, 0.3691]], [[0.6891, 0.5991, 0.6142, 1.0534], [1.1417, 0.8408, 0.7816, 1.096]]]]

Expected: [[[[1.5749, 0.6991, 1.1188, 1.5337], [0.2758, 0.4047, 0.2034, 0.9012]], [[0.5539, 0.0039, -0.0954, 0.6855], [0.6122, 0.1202, 0.4354, 0.3691]], [[0.6891, 0.5991, 0.6142, 1.0534], [1.1417, 0.8408, 0.7816, 1.096]]]]