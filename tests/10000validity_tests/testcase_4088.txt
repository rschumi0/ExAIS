import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max6525 = tf.keras.layers.Input(shape=([2, 2]))
in1Max6525 = tf.keras.layers.Input(shape=([2, 2]))
in0Ave82778 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave82778 = tf.keras.layers.Input(shape=([2, 2, 1]))

Max6525 = keras.layers.Maximum(name = 'Max6525', )([in0Max6525,in1Max6525])
Res46172 = keras.layers.Reshape((2, 2, 1), name = 'Res46172', )(Max6525)
PRe94602 = keras.layers.PReLU(name = 'PRe94602', )(Res46172)
Ave82778 = keras.layers.Average(name = 'Ave82778', )([in0Ave82778,in1Ave82778])
Sub30660 = keras.layers.Subtract(name = 'Sub30660', )([PRe94602,Ave82778])
model = tf.keras.models.Model(inputs=[in0Max6525,in1Max6525,in0Ave82778,in1Ave82778], outputs=Sub30660)
w = model.get_layer('PRe94602').get_weights() 
w[0] = np.array([[[0.952], [0.0043]], [[0.437], [0.1098]]])
model.get_layer('PRe94602').set_weights(w) 
in0Max6525 = tf.constant([[[0.6332, 0.7404], [0.3212, 0.1453]]])
in1Max6525 = tf.constant([[[0.1159, 0.825], [0.0329, 0.0391]]])
in0Ave82778 = tf.constant([[[[0.3144], [0.6826]], [[0.1972], [0.1571]]]])
in1Ave82778 = tf.constant([[[[0.9678], [0.3312]], [[0.6932], [0.4258]]]])
print (np.array2string(model.predict([in0Max6525,in1Max6525,in0Ave82778,in1Ave82778],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub30660.png')

LMax6525 = maximum_layer([[[[0.6332, 0.7404], [0.3212, 0.1453]]], [[[0.1159, 0.825], [0.0329, 0.0391]]]], Max6525), 
LRes46172 = reshape_layer(Max6525, [2, 2, 1], Res46172), 
LPRe94602 = prelu_layer(Res46172, [[[0.952], [0.0043]], [[0.437], [0.1098]]], PRe94602), 
LAve82778 = average_layer([[[[[0.3144], [0.6826]], [[0.1972], [0.1571]]]], [[[[0.9678], [0.3312]], [[0.6932], [0.4258]]]]], Ave82778), 
LSub30660 = subtract_layer(PRe94602,Ave82778, Sub30660), 
exec_layers([LMax6525,LRes46172,LPRe94602,LAve82778,LSub30660],["Max6525","Res46172","PRe94602","Ave82778","Sub30660"],Sub30660,"Sub30660")

Actual (Unparsed): [[[[-0.0079000], [0.3181000]], [[-0.1240000], [-0.1461500]]]]

Expected (Unparsed): [[[[-0.007900000000000018],[0.31809999999999994]],[[-0.12400000000000005],[-0.14614999999999997]]]]

Actual:   [[[[-0.0079], [0.3181]], [[-0.124], [-0.1461]]]]

Expected: [[[[-0.0079], [0.3181]], [[-0.124], [-0.1461]]]]