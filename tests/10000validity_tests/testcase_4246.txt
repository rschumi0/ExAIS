import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave80789 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Ave80789 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Con26537 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Min33786 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Min33786 = tf.keras.layers.Input(shape=([1, 2, 1]))

Ave80789 = keras.layers.Average(name = 'Ave80789', )([in0Ave80789,in1Ave80789])
Res38107 = keras.layers.Reshape((2, 2, 1), name = 'Res38107', )(Ave80789)
Con26537 = keras.layers.Concatenate(axis=3, name = 'Con26537', )([Res38107,in0Con26537])
Min33786 = keras.layers.Minimum(name = 'Min33786', )([in0Min33786,in1Min33786])
Res76954 = keras.layers.Reshape((1, 2), name = 'Res76954', )(Min33786)
Res18837 = keras.layers.Reshape((1, 2, 1), name = 'Res18837', )(Res76954)
Sep68998 = keras.layers.SeparableConv2D(3, (1, 1),strides=(1, 1), padding='valid', name = 'Sep68998', )(Res18837)
Zer41921 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer41921', )(Sep68998)
Ave29983 = keras.layers.Average(name = 'Ave29983', )([Con26537,Zer41921])
model = tf.keras.models.Model(inputs=[in0Ave80789,in1Ave80789,in0Con26537,in0Min33786,in1Min33786], outputs=Ave29983)
w = model.get_layer('Sep68998').get_weights() 
w[0] = np.array([[[[0.9062]]]])
w[1] = np.array([[[[0.9243, 0.712, 0.4434]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep68998').set_weights(w) 
in0Ave80789 = tf.constant([[[[[0.0539]], [[0.1012]]], [[[0.8299]], [[0.7822]]]]])
in1Ave80789 = tf.constant([[[[[0.4545]], [[0.3183]]], [[[0.2529]], [[0.1923]]]]])
in0Con26537 = tf.constant([[[[0.9893, 0.0316], [0.8507, 0.2288]], [[0.4507, 0.6654], [0.4535, 0.9988]]]])
in0Min33786 = tf.constant([[[[0.5701], [0.8012]]]])
in1Min33786 = tf.constant([[[[0.8431], [0.7154]]]])
print (np.array2string(model.predict([in0Ave80789,in1Ave80789,in0Con26537,in0Min33786,in1Min33786],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave29983.png')

LAve80789 = average_layer([[[[[[0.0539]], [[0.1012]]], [[[0.8299]], [[0.7822]]]]], [[[[[0.4545]], [[0.3183]]], [[[0.2529]], [[0.1923]]]]]], Ave80789), 
LRes38107 = reshape_layer(Ave80789, [2, 2, 1], Res38107), 
LCon26537 = concatenate_layer([Res38107,[[[[0.9893, 0.0316], [0.8507, 0.2288]], [[0.4507, 0.6654], [0.4535, 0.9988]]]]], 3, Con26537), 
LMin33786 = minimum_layer([[[[[0.5701], [0.8012]]]], [[[[0.8431], [0.7154]]]]], Min33786), 
LRes76954 = reshape_layer(Min33786, [1, 2], Res76954), 
LRes18837 = reshape_layer(Res76954, [1, 2, 1], Res18837), 
LSep68998 = separable_conv2D_layer(Res18837, 1, 1,[[[[[0.9062]]]],[[[[0.9243, 0.712, 0.4434]]]]],[0, 0, 0], 1, 1, false, Sep68998), 
LZer41921 = zero_padding2D_layer(Sep68998, 1, 0, 0, 0, Zer41921), 
LAve29983 = average_layer([Con26537,Zer41921], Ave29983), 
exec_layers([LAve80789,LRes38107,LCon26537,LMin33786,LRes76954,LRes18837,LSep68998,LZer41921,LAve29983],["Ave80789","Res38107","Con26537","Min33786","Res76954","Res18837","Sep68998","Zer41921","Ave29983"],Ave29983,"Ave29983")

Actual (Unparsed): [[[[0.1271000, 0.4946500, 0.0158000], [0.1048750, 0.4253500, 0.1144000]], [[0.5094581, 0.4092684, 0.4472357], [0.5432347, 0.4575432, 0.6431271]]]]

Expected (Unparsed): [[[[0.1271,0.49465,0.0158],[0.10487500000000001,0.42535,0.1144]],[[0.5094580681330001,0.40926836472000006,0.447235678254],[0.543234756082,0.45754319088,0.643127107916]]]]

Actual:   [[[[0.1271, 0.4947, 0.0158], [0.1049, 0.4254, 0.1144]], [[0.5095, 0.4093, 0.4473], [0.5433, 0.4576, 0.6432]]]]

Expected: [[[[0.1271, 0.4947, 0.0158], [0.1049, 0.4254, 0.1144]], [[0.5095, 0.4093, 0.4473], [0.5433, 0.4576, 0.6432]]]]