import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot95471 = tf.keras.layers.Input(shape=([3]))
in1Dot95471 = tf.keras.layers.Input(shape=([3]))
in0Con53783 = tf.keras.layers.Input(shape=([3, 2, 1, 2]))
in0Add53423 = tf.keras.layers.Input(shape=([2, 2]))
in1Add53423 = tf.keras.layers.Input(shape=([2, 2]))
in0Add55187 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Add55187 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Con64809 = tf.keras.layers.Input(shape=([3, 2, 3, 2]))

Dot95471 = keras.layers.Dot(axes=(1, 1), name = 'Dot95471', )([in0Dot95471,in1Dot95471])
Res15960 = keras.layers.Reshape((1, 1), name = 'Res15960', )(Dot95471)
Res48873 = keras.layers.Reshape((1, 1, 1), name = 'Res48873', )(Res15960)
Dep51456 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='valid', name = 'Dep51456', )(Res48873)
Res28221 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res28221', )(Dep51456)
Cro86554 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro86554', )(Res28221)
Zer77181 = keras.layers.ZeroPadding3D(padding=((2, 0), (1, 0), (0, 0)), name = 'Zer77181', )(Cro86554)
Con53783 = keras.layers.Concatenate(axis=4, name = 'Con53783', )([Zer77181,in0Con53783])
Add53423 = keras.layers.Add(name = 'Add53423', )([in0Add53423,in1Add53423])
Res83616 = keras.layers.Reshape((2, 2, 1), name = 'Res83616', )(Add53423)
Res82310 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res82310', )(Res83616)
Con3904 = keras.layers.Conv3DTranspose(3, (2, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con3904', )(Res82310)
Sub89323 = keras.layers.Subtract(name = 'Sub89323', )([Con53783,Con3904])
Zer31878 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer31878', )(Sub89323)
Add55187 = keras.layers.Add(name = 'Add55187', )([in0Add55187,in1Add55187])
Zer45157 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (1, 0)), name = 'Zer45157', )(Add55187)
Con64809 = keras.layers.Concatenate(axis=4, name = 'Con64809', )([Zer45157,in0Con64809])
Ave912 = keras.layers.Average(name = 'Ave912', )([Zer31878,Con64809])
Res5721 = keras.layers.Reshape((3, 2, 9), name = 'Res5721', )(Ave912)
Res60711 = keras.layers.Reshape((3, 18), name = 'Res60711', )(Res5721)
Zer51604 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer51604', )(Res60711)
model = tf.keras.models.Model(inputs=[in0Dot95471,in1Dot95471,in0Con53783,in0Add53423,in1Add53423,in0Add55187,in1Add55187,in0Con64809], outputs=Zer51604)
w = model.get_layer('Dep51456').get_weights() 
w[0] = np.array([[[[0.3754]]]])
w[1] = np.array([0])
model.get_layer('Dep51456').set_weights(w) 
w = model.get_layer('Con3904').get_weights() 
w[0] = np.array([[[[[0.9447], [0.4615], [0.9702]]]], [[[[0.8621], [0.7215], [0.9947]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con3904').set_weights(w) 
in0Dot95471 = tf.constant([[0.1268, 0.5936, 0.8519]])
in1Dot95471 = tf.constant([[0.321, 0.1971, 0.3262]])
in0Con53783 = tf.constant([[[[[0.4108, 0.5873]], [[0.9929, 0.3112]]], [[[0.7847, 0.7833]], [[0.0617, 0.0219]]], [[[0.8708, 0.5832]], [[0.0808, 0.7869]]]]])
in0Add53423 = tf.constant([[[0.5439, 0.2011], [0.2106, 0.6027]]])
in1Add53423 = tf.constant([[[0.342, 0.767], [0.5611, 0.1076]]])
in0Add55187 = tf.constant([[[[[0.1941], [0.6859]]], [[[0.9718], [0.8027]]]]])
in1Add55187 = tf.constant([[[[[0.0125], [0.15]]], [[[0.8054], [0.577]]]]])
in0Con64809 = tf.constant([[[[[0.4897, 0.4661], [0.3167, 0.9199], [0.0802, 0.1324]], [[0.5453, 0.0397], [0.6213, 0.4629], [0.5526, 0.7912]]], [[[0.306, 0.2588], [0.8057, 0.221], [0.1867, 0.4097]], [[0.6784, 0.5971], [0.642, 0.3136], [0.2189, 0.2277]]], [[[0.716, 0.7972], [0.4551, 0.7331], [0.2285, 0.3742]], [[0.5729, 0.0535], [0.8453, 0.0451], [0.0527, 0.4188]]]]])
print (np.array2string(model.predict([in0Dot95471,in1Dot95471,in0Con53783,in0Add53423,in1Add53423,in0Add55187,in1Add55187,in0Con64809],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Zer51604.png')

LDot95471 = dot_layer([[0.1268, 0.5936, 0.8519]], [[0.321, 0.1971, 0.3262]], 1, 1, Dot95471), 
LRes15960 = reshape_layer(Dot95471, [1, 1], Res15960), 
LRes48873 = reshape_layer(Res15960, [1, 1, 1], Res48873), 
LDep51456 = depthwise_conv2D_layer(Res48873, 1, 1,[[[[0.3754]]]],[0], 1, 1, false, Dep51456), 
LRes28221 = reshape_layer(Dep51456, [1, 1, 1, 1], Res28221), 
LCro86554 = cropping3D_layer(Res28221, 0, 0, 0, 0, 0, 0, Cro86554), 
LZer77181 = zero_padding3D_layer(Cro86554, 2, 0, 1, 0, 0, 0, Zer77181), 
LCon53783 = concatenate_layer([Zer77181,[[[[[0.4108, 0.5873]], [[0.9929, 0.3112]]], [[[0.7847, 0.7833]], [[0.0617, 0.0219]]], [[[0.8708, 0.5832]], [[0.0808, 0.7869]]]]]], 4, Con53783), 
LAdd53423 = add_layer([[[[0.5439, 0.2011], [0.2106, 0.6027]]], [[[0.342, 0.767], [0.5611, 0.1076]]]], Add53423), 
LRes83616 = reshape_layer(Add53423, [2, 2, 1], Res83616), 
LRes82310 = reshape_layer(Res83616, [2, 2, 1, 1], Res82310), 
LCon3904 = conv3D_transpose_layer(Res82310, 2, 1, 1,[[[[[0.9447], [0.4615], [0.9702]]]], [[[[0.8621], [0.7215], [0.9947]]]]],[0, 0, 0], 1, 1, 1, false, Con3904), 
LSub89323 = subtract_layer(Con53783,Con3904, Sub89323), 
LZer31878 = zero_padding3D_layer(Sub89323, 0, 0, 0, 0, 2, 0, Zer31878), 
LAdd55187 = add_layer([[[[[[0.1941], [0.6859]]], [[[0.9718], [0.8027]]]]], [[[[[0.0125], [0.15]]], [[[0.8054], [0.577]]]]]], Add55187), 
LZer45157 = zero_padding3D_layer(Add55187, 1, 0, 1, 0, 1, 0, Zer45157), 
LCon64809 = concatenate_layer([Zer45157,[[[[[0.4897, 0.4661], [0.3167, 0.9199], [0.0802, 0.1324]], [[0.5453, 0.0397], [0.6213, 0.4629], [0.5526, 0.7912]]], [[[0.306, 0.2588], [0.8057, 0.221], [0.1867, 0.4097]], [[0.6784, 0.5971], [0.642, 0.3136], [0.2189, 0.2277]]], [[[0.716, 0.7972], [0.4551, 0.7331], [0.2285, 0.3742]], [[0.5729, 0.0535], [0.8453, 0.0451], [0.0527, 0.4188]]]]]], 4, Con64809), 
LAve912 = average_layer([Zer31878,Con64809], Ave912), 
LRes5721 = reshape_layer(Ave912, [3, 2, 9], Res5721), 
LRes60711 = reshape_layer(Res5721, [3, 18], Res60711), 
LZer51604 = zero_padding1D_layer(Res60711, 1, 1, Zer51604), 
exec_layers([LDot95471,LRes15960,LRes48873,LDep51456,LRes28221,LCro86554,LZer77181,LCon53783,LAdd53423,LRes83616,LRes82310,LCon3904,LSub89323,LZer31878,LAdd55187,LZer45157,LCon64809,LAve912,LRes5721,LRes60711,LZer51604],["Dot95471","Res15960","Res48873","Dep51456","Res28221","Cro86554","Zer77181","Con53783","Add53423","Res83616","Res82310","Con3904","Sub89323","Zer31878","Add55187","Zer45157","Con64809","Ave912","Res5721","Res60711","Zer51604"],Zer51604,"Zer51604")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.2448500, 0.2330500, 0.0000000, 0.1583500, 0.4599500, -0.4184549, 0.0410786, -0.0699001, 0.0000000, 0.2726500, 0.0198500, 0.0000000, 0.3106500, 0.2314500, -0.4572820, 0.5493609, 0.0815747], [0.0000000, 0.1530000, 0.1294000, 0.0000000, 0.4028500, 0.1105000, -0.7463797, -0.0119582, -0.2184541, 0.0000000, 0.3392000, 0.2985500, 0.1033000, 0.3210000, 0.1568000, -0.3348597, -0.3728438, -0.7012511], [0.0000000, 0.3580000, 0.3986000, 0.0000000, 0.2275500, 0.3665500, -0.3326413, 0.2712592, 0.0948950, 0.0000000, 0.2864500, 0.0267500, 0.8886000, 0.4226500, 0.0225500, 0.4654356, -0.1894907, 0.2495823], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000]]]

Expected (Unparsed): [[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0.24485,0.23305,0,0.15835,0.45995,-0.41845486500000006,0.04107857499999995,-0.06990009000000001,0,0.27265,0.01985,0,0.31065,0.23145,-0.457282035,0.549360925,0.08157469],[0,0.153,0.1294,0,0.40285,0.1105,-0.74637969,-0.011958200000000072,-0.21845403500000007,0,0.3392,0.29855,0.1033,0.321,0.1568,-0.33485971,-0.37284380000000006,-0.7012510649999999],[0,0.358,0.3986,0,0.22755,0.36655,-0.332641285,0.271259225,0.09489500499999998,0,0.28645,0.02675,0.8886000000000001,0.42265,0.02255,0.46543564197799997,-0.18949072500000003,0.24958229499999998],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]

Actual:   [[[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0.2449, 0.2331, 0, 0.1584, 0.46, -0.4184, 0.0411, -0.0699, 0, 0.2727, 0.0199, 0, 0.3107, 0.2315, -0.4572, 0.5494, 0.0816], [0, 0.153, 0.1294, 0, 0.4029, 0.1105, -0.7463, -0.0119, -0.2184, 0, 0.3392, 0.2986, 0.1033, 0.321, 0.1568, -0.3348, -0.3728, -0.7012], [0, 0.358, 0.3986, 0, 0.2276, 0.3666, -0.3326, 0.2713, 0.0949, 0, 0.2865, 0.0268, 0.8886, 0.4227, 0.0226, 0.4655, -0.1894, 0.2496], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]]

Expected: [[[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0.2449, 0.2331, 0, 0.1584, 0.46, -0.4184, 0.0411, -0.0699, 0, 0.2727, 0.0199, 0, 0.3107, 0.2315, -0.4572, 0.5494, 0.0816], [0, 0.153, 0.1294, 0, 0.4029, 0.1105, -0.7463, -0.0119, -0.2184, 0, 0.3392, 0.2986, 0.1033, 0.321, 0.1568, -0.3348, -0.3728, -0.7012], [0, 0.358, 0.3986, 0, 0.2276, 0.3666, -0.3326, 0.2713, 0.0949, 0, 0.2865, 0.0268, 0.8887, 0.4227, 0.0226, 0.4655, -0.1894, 0.2496], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]]