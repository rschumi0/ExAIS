import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub61798 = tf.keras.layers.Input(shape=([2, 3, 2]))
in1Sub61798 = tf.keras.layers.Input(shape=([2, 3, 2]))
in0Max29929 = tf.keras.layers.Input(shape=([1, 1]))
in0Sof96787 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Max58181 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Max58181 = tf.keras.layers.Input(shape=([1, 2, 1]))

Sub61798 = keras.layers.Subtract(name = 'Sub61798', )([in0Sub61798,in1Sub61798])
Res1174 = keras.layers.Reshape((2, 6), name = 'Res1174', )(Sub61798)
LST33081 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST33081', )(Res1174)
Res28609 = keras.layers.Reshape((1, 1), name = 'Res28609', )(LST33081)
Max29929 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='valid', name = 'Max29929', )(in0Max29929)
Min25422 = keras.layers.Minimum(name = 'Min25422', )([Res28609,Max29929])
Res68760 = keras.layers.Reshape((1, 1, 1), name = 'Res68760', )(Min25422)
Res23467 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res23467', )(Res68760)
Glo11997 = keras.layers.GlobalMaxPool3D(name = 'Glo11997', )(Res23467)
Sof96787 = keras.layers.Softmax(axis=1, name = 'Sof96787', input_shape=(2, 2, 2))(in0Sof96787)
Res44479 = keras.layers.Reshape((2, 4), name = 'Res44479', )(Sof96787)
Zer5691 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer5691', )(Res44479)
Max58181 = keras.layers.Maximum(name = 'Max58181', )([in0Max58181,in1Max58181])
Res30361 = keras.layers.Reshape((1, 2), name = 'Res30361', )(Max58181)
Zer10266 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer10266', )(Res30361)
Dot98640 = keras.layers.Dot(axes=(1, 1), name = 'Dot98640', )([Zer5691,Zer10266])
Res36021 = keras.layers.Reshape((4, 2, 1), name = 'Res36021', )(Dot98640)
Glo28887 = keras.layers.GlobalMaxPool2D(name = 'Glo28887', )(Res36021)
Ave11895 = keras.layers.Average(name = 'Ave11895', )([Glo11997,Glo28887])
model = tf.keras.models.Model(inputs=[in0Sub61798,in1Sub61798,in0Max29929,in0Sof96787,in0Max58181,in1Max58181], outputs=Ave11895)
w = model.get_layer('LST33081').get_weights() 
w[0] = np.array([[2, 1, 3, 9], [9, 1, 2, 8], [2, 1, 6, 10], [7, 8, 8, 9], [3, 8, 7, 1], [3, 9, 4, 7]])
w[1] = np.array([[8, 3, 8, 5]])
w[2] = np.array([1, 5, 6, 9])
model.get_layer('LST33081').set_weights(w) 
in0Sub61798 = tf.constant([[[[0.4421, 0.0207], [0.0791, 0.5538], [0.5434, 0.1643]], [[0.7174, 0.621], [0.2256, 0.7292], [0.7736, 0.5786]]]])
in1Sub61798 = tf.constant([[[[0.6348, 0.289], [0.7825, 0.0857], [0.4105, 0.4605]], [[0.1231, 0.6238], [0.8467, 0.4679], [0.2245, 0.2757]]]])
in0Max29929 = tf.constant([[[1.6201]]])
in0Sof96787 = tf.constant([[[[0.4922, 0.8594], [0.9891, 0.9935]], [[0.4991, 0.9177], [0.7706, 0.9363]]]])
in0Max58181 = tf.constant([[[[0.6268], [0.8478]]]])
in1Max58181 = tf.constant([[[[0.5307], [0.9181]]]])
print (np.array2string(model.predict([in0Sub61798,in1Sub61798,in0Max29929,in0Sof96787,in0Max58181,in1Max58181],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave11895.png')

LSub61798 = subtract_layer([[[[0.4421, 0.0207], [0.0791, 0.5538], [0.5434, 0.1643]], [[0.7174, 0.621], [0.2256, 0.7292], [0.7736, 0.5786]]]], [[[[0.6348, 0.289], [0.7825, 0.0857], [0.4105, 0.4605]], [[0.1231, 0.6238], [0.8467, 0.4679], [0.2245, 0.2757]]]], Sub61798), 
LRes1174 = reshape_layer(Sub61798, [2, 6], Res1174), 
LLST33081 = lstm_layer(Res1174,[[2, 1, 3, 9], [9, 1, 2, 8], [2, 1, 6, 10], [7, 8, 8, 9], [3, 8, 7, 1], [3, 9, 4, 7]],[[8, 3, 8, 5]],[1, 5, 6, 9], LST33081), 
LRes28609 = reshape_layer(LST33081, [1, 1], Res28609), 
LMax29929 = max_pool1D_layer([[[1.6201]]], 1, 1, false, Max29929), 
LMin25422 = minimum_layer([Res28609,Max29929], Min25422), 
LRes68760 = reshape_layer(Min25422, [1, 1, 1], Res68760), 
LRes23467 = reshape_layer(Res68760, [1, 1, 1, 1], Res23467), 
LGlo11997 = global_max_pool3D_layer(Res23467, Glo11997), 
LSof96787 = softmax_layer([[[[0.4922, 0.8594], [0.9891, 0.9935]], [[0.4991, 0.9177], [0.7706, 0.9363]]]], 1, Sof96787), 
LRes44479 = reshape_layer(Sof96787, [2, 4], Res44479), 
LZer5691 = zero_padding1D_layer(Res44479, 1, 0, Zer5691), 
LMax58181 = maximum_layer([[[[[0.6268], [0.8478]]]], [[[[0.5307], [0.9181]]]]], Max58181), 
LRes30361 = reshape_layer(Max58181, [1, 2], Res30361), 
LZer10266 = zero_padding1D_layer(Res30361, 1, 1, Zer10266), 
LDot98640 = dot_layer(Zer5691,Zer10266, 1, 1, Dot98640), 
LRes36021 = reshape_layer(Dot98640, [4, 2, 1], Res36021), 
LGlo28887 = global_max_pool2D_layer(Res36021, Glo28887), 
LAve11895 = average_layer([Glo11997,Glo28887], Ave11895), 
exec_layers([LSub61798,LRes1174,LLST33081,LRes28609,LMax29929,LMin25422,LRes68760,LRes23467,LGlo11997,LSof96787,LRes44479,LZer5691,LMax58181,LRes30361,LZer10266,LDot98640,LRes36021,LGlo28887,LAve11895],["Sub61798","Res1174","LST33081","Res28609","Max29929","Min25422","Res68760","Res23467","Glo11997","Sof96787","Res44479","Zer5691","Max58181","Res30361","Zer10266","Dot98640","Res36021","Glo28887","Ave11895"],Ave11895,"Ave11895")

Actual (Unparsed): [[0.6966838]]

Expected (Unparsed): [[0.6966838534289099]]

Actual:   [[0.6967]]

Expected: [[0.6967]]