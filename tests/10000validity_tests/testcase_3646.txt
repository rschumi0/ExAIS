import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub57165 = tf.keras.layers.Input(shape=([3, 3, 3]))
in1Sub57165 = tf.keras.layers.Input(shape=([3, 3, 3]))
in0Ave12502 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con34362 = tf.keras.layers.Input(shape=([3, 3, 1]))

Sub57165 = keras.layers.Subtract(name = 'Sub57165', )([in0Sub57165,in1Sub57165])
Ave12502 = keras.layers.AveragePooling2D(pool_size=(1, 1), name = 'Ave12502', )(in0Ave12502)
Zer89846 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer89846', )(Ave12502)
Con34362 = keras.layers.Concatenate(axis=3, name = 'Con34362', )([Zer89846,in0Con34362])
Sub96508 = keras.layers.Subtract(name = 'Sub96508', )([Sub57165,Con34362])
Res73724 = keras.layers.Reshape((3, 3, 3, 1), name = 'Res73724', )(Sub96508)
PRe73415 = keras.layers.PReLU(name = 'PRe73415', )(Res73724)
Con10588 = keras.layers.Conv3D(3, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con10588', )(PRe73415)
model = tf.keras.models.Model(inputs=[in0Sub57165,in1Sub57165,in0Ave12502,in0Con34362], outputs=Con10588)
w = model.get_layer('PRe73415').get_weights() 
w[0] = np.array([[[[0.1073], [0.254], [0.6604]], [[0.9759], [0.9142], [0.9471]], [[0.3261], [0.9759], [0.8409]]], [[[0.7322], [0.8075], [0.7661]], [[0.9702], [0.9671], [0.5752]], [[0.8098], [0.0156], [0.053]]], [[[0.3507], [0.414], [0.3935]], [[0.5259], [0.3151], [0.7443]], [[0.0525], [0.0382], [0.465]]]])
model.get_layer('PRe73415').set_weights(w) 
w = model.get_layer('Con10588').get_weights() 
w[0] = np.array([[[[[0.7952, 0.9515, 0.8499]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con10588').set_weights(w) 
in0Sub57165 = tf.constant([[[[0.8834, 0.5336, 0.7561], [0.149, 0.8125, 0.1471], [0.0887, 0.0649, 0.8357]], [[0.5334, 0.905, 0.4491], [0.2491, 0.4658, 0.4604], [0.9475, 0.2891, 0.6236]], [[0.8801, 0.1227, 0.1369], [0.1803, 0.5981, 0.9381], [0.4887, 0.3818, 0.0312]]]])
in1Sub57165 = tf.constant([[[[0.5701, 0.5738, 0.0596], [0.8512, 0.4523, 0.5681], [0.5986, 0.1143, 0.9786]], [[0.3226, 0.6125, 0.8074], [0.4791, 0.2103, 0.4641], [0.0807, 0.9231, 0.6774]], [[0.8163, 0.5483, 0.3004], [0.779, 0.5945, 0.5614], [0.7864, 0.5773, 0.1023]]]])
in0Ave12502 = tf.constant([[[[1.2823, 1.603], [1.7863, 1.5426]], [[1.7236, 1.9588], [1.456, 1.8651]]]])
in0Con34362 = tf.constant([[[[0.6467], [0.8313], [0.3779]], [[0.7573], [0.362], [0.352]], [[0.9199], [0.3187], [0.6071]]]])
print (np.array2string(model.predict([in0Sub57165,in1Sub57165,in0Ave12502,in0Con34362],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con10588.png')

LSub57165 = subtract_layer([[[[0.8834, 0.5336, 0.7561], [0.149, 0.8125, 0.1471], [0.0887, 0.0649, 0.8357]], [[0.5334, 0.905, 0.4491], [0.2491, 0.4658, 0.4604], [0.9475, 0.2891, 0.6236]], [[0.8801, 0.1227, 0.1369], [0.1803, 0.5981, 0.9381], [0.4887, 0.3818, 0.0312]]]], [[[[0.5701, 0.5738, 0.0596], [0.8512, 0.4523, 0.5681], [0.5986, 0.1143, 0.9786]], [[0.3226, 0.6125, 0.8074], [0.4791, 0.2103, 0.4641], [0.0807, 0.9231, 0.6774]], [[0.8163, 0.5483, 0.3004], [0.779, 0.5945, 0.5614], [0.7864, 0.5773, 0.1023]]]], Sub57165), 
LAve12502 = average_pooling2D_layer([[[[1.2823, 1.603], [1.7863, 1.5426]], [[1.7236, 1.9588], [1.456, 1.8651]]]], 1, 1, Ave12502), 
LZer89846 = zero_padding2D_layer(Ave12502, 1, 0, 1, 0, Zer89846), 
LCon34362 = concatenate_layer([Zer89846,[[[[0.6467], [0.8313], [0.3779]], [[0.7573], [0.362], [0.352]], [[0.9199], [0.3187], [0.6071]]]]], 3, Con34362), 
LSub96508 = subtract_layer(Sub57165,Con34362, Sub96508), 
LRes73724 = reshape_layer(Sub96508, [3, 3, 3, 1], Res73724), 
LPRe73415 = prelu_layer(Res73724, [[[[0.1073], [0.254], [0.6604]], [[0.9759], [0.9142], [0.9471]], [[0.3261], [0.9759], [0.8409]]], [[[0.7322], [0.8075], [0.7661]], [[0.9702], [0.9671], [0.5752]], [[0.8098], [0.0156], [0.053]]], [[[0.3507], [0.414], [0.3935]], [[0.5259], [0.3151], [0.7443]], [[0.0525], [0.0382], [0.465]]]], PRe73415), 
LCon10588 = conv3D_layer(PRe73415, 1, 1, 1,[[[[[0.7952, 0.9515, 0.8499]]]]],[0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con10588), 
exec_layers([LSub57165,LAve12502,LZer89846,LCon34362,LSub96508,LRes73724,LPRe73415,LCon10588],["Sub57165","Ave12502","Zer89846","Con34362","Sub96508","Res73724","PRe73415","Con10588"],Con10588,"Con10588")

Actual (Unparsed): [[[[[0.2491362, 0.2981050, 0.2662737], [-0.0081196, -0.0097156, -0.0086782], [0.0396009, 0.0473847, 0.0423250]], [[-0.5449322, -0.6520410, -0.5824169], [0.2864310, 0.3427303, 0.3061340], [-0.9431496, -1.1285297, -1.0080267]], [[-0.1322246, -0.1582139, -0.1413200], [-0.0383362, -0.0458713, -0.0409732], [-0.3482505, -0.4167006, -0.3722059]]], [[[0.1676282, 0.2005762, 0.1791589], [0.2325960, 0.2783137, 0.2485957], [-0.6796266, -0.8132101, -0.7263765]], [[-1.1667440, -1.3960726, -1.2470017], [-1.0362786, -1.2399637, -1.1075619], [-0.1672708, -0.2001486, -0.1787770]], [[-0.5921147, -0.7084974, -0.6328449], [-0.0270010, -0.0323081, -0.0288583], [-0.0171027, -0.0204643, -0.0182791]]], [[[0.0507338, 0.0607057, 0.0542237], [-0.1401130, -0.1676528, -0.1497510], [-0.3390080, -0.4056415, -0.3623276]], [[-0.9711758, -1.1620646, -1.0379808], [-0.4899096, -0.5862035, -0.5236094], [0.0461216, 0.0551870, 0.0492942]], [[-0.0732135, -0.0876039, -0.0782497], [-0.0625941, -0.0748972, -0.0668998], [-0.2507767, -0.3000679, -0.2680270]]]]]

Expected (Unparsed): [[[[[0.24913615999999994,0.2981049499999999,0.2662736699999999],[-0.008119628160000003,-0.009715576200000004,-0.008678158920000003],[0.03960095999999996,0.04738469999999996,0.04232501999999996]],[[-0.5449322544959999,-0.6520410464699999,-0.582416905302],[0.28643104,0.34273030000000004,0.30613398],[-0.943149608016,-1.1285297434950001,-1.008026725167]],[[-0.132224575728,-0.158213888085,-0.141320003661],[-0.038336162592,-0.04587130119,-0.040973220054],[-0.348250460544,-0.41670059508,-0.372205817928]]],[[[0.16762816,0.20057619999999998,0.17915892],[0.232596,0.27831374999999997,0.24859574999999998],[-0.6796265544319999,-0.81321009374,-0.7263765198839999]],[[-1.1667440473919999,-1.3960726371899999,-1.2470017176539998],[-1.0362785972,-1.239963638375,-1.1075618457749998],[-0.16727082892800002,-0.20014863396000004,-0.17877700893600001]],[[-0.59211474672,-0.7084974616499999,-0.6328449738899999],[-0.027000984192,-0.03230814444,-0.028858320503999998],[-0.017102684479999998,-0.020464291099999997,-0.018279139259999997]]],[[[0.050733759999999975,0.060705699999999974,0.05422361999999997],[-0.14011296767999998,-0.16765277759999997,-0.14975102015999997],[-0.3390079940800001,-0.4056414818500001,-0.3623275832100001]],[[-0.9711758276640001,-1.1620646378550001,-1.0379808047430001],[-0.489909615104,-0.58620346928,-0.523609383648],[0.04612160000000004,0.05518700000000005,0.049294200000000045]],[[-0.0732134676,-0.08760389137499999,-0.078249655575],[-0.062594104384,-0.07489724637999999,-0.066899810508],[-0.25077665759999995,-0.30006789449999993,-0.2680270136999999]]]]]

Actual:   [[[[[0.2492, 0.2982, 0.2663], [-0.0081, -0.0097, -0.0086], [0.0397, 0.0474, 0.0424]], [[-0.5449, -0.652, -0.5824], [0.2865, 0.3428, 0.3062], [-0.9431, -1.1285, -1.008]], [[-0.1322, -0.1582, -0.1413], [-0.0383, -0.0458, -0.0409], [-0.3482, -0.4167, -0.3722]]], [[[0.1677, 0.2006, 0.1792], [0.2326, 0.2784, 0.2486], [-0.6796, -0.8132, -0.7263]], [[-1.1667, -1.396, -1.247], [-1.0362, -1.2399, -1.1075], [-0.1672, -0.2001, -0.1787]], [[-0.5921, -0.7084, -0.6328], [-0.027, -0.0323, -0.0288], [-0.0171, -0.0204, -0.0182]]], [[[0.0508, 0.0608, 0.0543], [-0.1401, -0.1676, -0.1497], [-0.339, -0.4056, -0.3623]], [[-0.9711, -1.162, -1.0379], [-0.4899, -0.5862, -0.5236], [0.0462, 0.0552, 0.0493]], [[-0.0732, -0.0876, -0.0782], [-0.0625, -0.0748, -0.0668], [-0.2507, -0.3, -0.268]]]]]

Expected: [[[[[0.2492, 0.2982, 0.2663], [-0.0081, -0.0097, -0.0086], [0.0397, 0.0474, 0.0424]], [[-0.5449, -0.652, -0.5824], [0.2865, 0.3428, 0.3062], [-0.9431, -1.1285, -1.008]], [[-0.1322, -0.1582, -0.1413], [-0.0383, -0.0458, -0.0409], [-0.3482, -0.4167, -0.3722]]], [[[0.1677, 0.2006, 0.1792], [0.2326, 0.2784, 0.2486], [-0.6796, -0.8132, -0.7263]], [[-1.1667, -1.396, -1.247], [-1.0362, -1.2399, -1.1075], [-0.1672, -0.2001, -0.1787]], [[-0.5921, -0.7084, -0.6328], [-0.027, -0.0323, -0.0288], [-0.0171, -0.0204, -0.0182]]], [[[0.0508, 0.0608, 0.0543], [-0.1401, -0.1676, -0.1497], [-0.339, -0.4056, -0.3623]], [[-0.9711, -1.162, -1.0379], [-0.4899, -0.5862, -0.5236], [0.0462, 0.0552, 0.0493]], [[-0.0732, -0.0876, -0.0782], [-0.0625, -0.0748, -0.0668], [-0.2507, -0.3, -0.268]]]]]