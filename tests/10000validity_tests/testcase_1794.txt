import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Bat89315 = tf.keras.layers.Input(shape=([3, 3, 2]))

Bat89315 = keras.layers.BatchNormalization(axis=2, epsilon=0.1491112646136356,  name = 'Bat89315', )(in0Bat89315)
Dep97347 = keras.layers.DepthwiseConv2D((3, 1),strides=(2, 2), padding='valid', name = 'Dep97347', )(Bat89315)
Glo98602 = keras.layers.GlobalAveragePooling2D(name = 'Glo98602', )(Dep97347)
model = tf.keras.models.Model(inputs=[in0Bat89315], outputs=Glo98602)
w = model.get_layer('Bat89315').get_weights() 
w[0] = np.array([0.4168, 0.8466, 0.5266])
w[1] = np.array([0.3973, 0.8768, 0.8173])
w[2] = np.array([0.0406, 0.7809, 0.2284])
w[3] = np.array([0.7819, 0.8268, 0.245])
model.get_layer('Bat89315').set_weights(w) 
w = model.get_layer('Dep97347').get_weights() 
w[0] = np.array([[[[0.4326], [0.3756]]], [[[0.4385], [0.0076]]], [[[0.9706], [0.0798]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep97347').set_weights(w) 
in0Bat89315 = tf.constant([[[[1.4464, 1.2138], [1.435, 1.9385], [1.4431, 1.4054]], [[1.8079, 1.8824], [1.3955, 1.7135], [1.489, 1.7421]], [[1.2019, 1.9995], [1.6581, 1.3557], [1.4848, 1.2432]]]])
print (np.array2string(model.predict([in0Bat89315],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo98602.png')

LBat89315 = batch_normalization_layer([[[[1.4464, 1.2138], [1.435, 1.9385], [1.4431, 1.4054]], [[1.8079, 1.8824], [1.3955, 1.7135], [1.489, 1.7421]], [[1.2019, 1.9995], [1.6581, 1.3557], [1.4848, 1.2432]]]], 2, 0.1491112646136356, [0.4168, 0.8466, 0.5266], [0.3973, 0.8768, 0.8173], [0.0406, 0.7809, 0.2284], [0.7819, 0.8268, 0.245], Bat89315), 
LDep97347 = depthwise_conv2D_layer(Bat89315, 3, 1,[[[[0.4326], [0.3756]]], [[[0.4385], [0.0076]]], [[[0.9706], [0.0798]]]],[0, 0], 2, 2, false, Dep97347), 
LGlo98602 = global_average_pooling2D_layer(Dep97347, Glo98602), 
exec_layers([LBat89315,LDep97347,LGlo98602],["Bat89315","Dep97347","Glo98602"],Glo98602,"Glo98602")

Actual (Unparsed): [[2.6243306, 0.6373435]]

Expected (Unparsed): [[2.6243306345856987,0.6373434795746671]]

Actual:   [[2.6244, 0.6374]]

Expected: [[2.6244, 0.6374]]