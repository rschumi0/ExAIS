import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max63873 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Max63873 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con50588 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con54323 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))

Max63873 = keras.layers.Maximum(name = 'Max63873', )([in0Max63873,in1Max63873])
Con50588 = keras.layers.Concatenate(axis=3, name = 'Con50588', )([Max63873,in0Con50588])
Con54323 = keras.layers.Conv3DTranspose(2, (2, 1, 2),strides=(1, 1, 1), padding='same', name = 'Con54323', )(in0Con54323)
Res2365 = keras.layers.Reshape((2, 2, 4), name = 'Res2365', )(Con54323)
Dep31067 = keras.layers.DepthwiseConv2D((2, 2),strides=(2, 2), padding='same', name = 'Dep31067', )(Res2365)
Zer96624 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer96624', )(Dep31067)
Sub52755 = keras.layers.Subtract(name = 'Sub52755', )([Con50588,Zer96624])
Sep50829 = keras.layers.SeparableConv2D(3, (1, 1),strides=(1, 1), padding='valid', name = 'Sep50829', )(Sub52755)
model = tf.keras.models.Model(inputs=[in0Max63873,in1Max63873,in0Con50588,in0Con54323], outputs=Sep50829)
w = model.get_layer('Con54323').get_weights() 
w[0] = np.array([[[[[0.7605, 0.8731], [0.5215, 0.8369]], [[0.9769, 0.3988], [0.6164, 0.2603]]]], [[[[0.9202, 0.3681], [0.1299, 0.9858]], [[0.6084, 0.2536], [0.438, 0.8341]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con54323').set_weights(w) 
w = model.get_layer('Dep31067').get_weights() 
w[0] = np.array([[[[0.0463], [0.7779], [0.7449], [0.2401]], [[0.6907], [0.0158], [0.7327], [0.4079]]], [[[0.1336], [0.3242], [0.2054], [0.601]], [[0.8353], [0.8877], [0.9846], [0.6801]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Dep31067').set_weights(w) 
w = model.get_layer('Sep50829').get_weights() 
w[0] = np.array([[[[0.075], [0.9808], [0.7446], [0.572]]]])
w[1] = np.array([[[[0.1191, 0.3543, 0.1442], [0.3673, 0.2165, 0.6149], [0.9619, 0.4079, 0.8907], [0.8172, 0.6634, 0.6935]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep50829').set_weights(w) 
in0Max63873 = tf.constant([[[[0.5157, 0.9017]], [[0.3814, 0.3414]]]])
in1Max63873 = tf.constant([[[[0.0922, 0.2431]], [[0.3623, 0.2363]]]])
in0Con50588 = tf.constant([[[[0.2824, 0.1902]], [[0.3296, 0.5382]]]])
in0Con54323 = tf.constant([[[[[0.097, 0.4991], [0.3307, 0.8809]], [[0.8598, 0.5671], [0.7465, 0.2464]]], [[[0.0182, 0.4826], [0.3843, 0.2962]], [[0.4976, 0.4757], [0.7148, 0.7952]]]]])
print (np.array2string(model.predict([in0Max63873,in1Max63873,in0Con50588,in0Con54323],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sep50829.png')

LMax63873 = maximum_layer([[[[[0.5157, 0.9017]], [[0.3814, 0.3414]]]], [[[[0.0922, 0.2431]], [[0.3623, 0.2363]]]]], Max63873), 
LCon50588 = concatenate_layer([Max63873,[[[[0.2824, 0.1902]], [[0.3296, 0.5382]]]]], 3, Con50588), 
LCon54323 = conv3D_transpose_layer([[[[[0.097, 0.4991], [0.3307, 0.8809]], [[0.8598, 0.5671], [0.7465, 0.2464]]], [[[0.0182, 0.4826], [0.3843, 0.2962]], [[0.4976, 0.4757], [0.7148, 0.7952]]]]], 2, 1, 2,[[[[[0.7605, 0.8731], [0.5215, 0.8369]], [[0.9769, 0.3988], [0.6164, 0.2603]]]], [[[[0.9202, 0.3681], [0.1299, 0.9858]], [[0.6084, 0.2536], [0.438, 0.8341]]]]],[0, 0], 1, 1, 1, true, Con54323), 
LRes2365 = reshape_layer(Con54323, [2, 2, 4], Res2365), 
LDep31067 = depthwise_conv2D_layer(Res2365, 2, 2,[[[[0.0463], [0.7779], [0.7449], [0.2401]], [[0.6907], [0.0158], [0.7327], [0.4079]]], [[[0.1336], [0.3242], [0.2054], [0.601]], [[0.8353], [0.8877], [0.9846], [0.6801]]]],[0, 0, 0, 0], 2, 2, true, Dep31067), 
LZer96624 = zero_padding2D_layer(Dep31067, 1, 0, 0, 0, Zer96624), 
LSub52755 = subtract_layer(Con50588,Zer96624, Sub52755), 
LSep50829 = separable_conv2D_layer(Sub52755, 1, 1,[[[[[0.075], [0.9808], [0.7446], [0.572]]]],[[[[0.1191, 0.3543, 0.1442], [0.3673, 0.2165, 0.6149], [0.9619, 0.4079, 0.8907], [0.8172, 0.6634, 0.6935]]]]],[0, 0, 0], 1, 1, false, Sep50829), 
exec_layers([LMax63873,LCon50588,LCon54323,LRes2365,LDep31067,LZer96624,LSub52755,LSep50829],["Max63873","Con50588","Con54323","Res2365","Dep31067","Zer96624","Sub52755","Sep50829"],Sep50829,"Sep50829")

Actual (Unparsed): [[[[0.6206123, 0.3631187, 0.8121280]], [[-6.1080383, -3.3116666, -5.9524712]]]]

Expected (Unparsed): [[[[0.620612312234,0.363118695466,0.812127977692]],[[-6.108038368682705,-3.311666626249873,-5.952471206271845]]]]

Actual:   [[[[0.6207, 0.3632, 0.8122]], [[-6.108, -3.3116, -5.9524]]]]

Expected: [[[[0.6207, 0.3632, 0.8122]], [[-6.108, -3.3116, -5.9524]]]]