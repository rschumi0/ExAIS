import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max265 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Max265 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Max67131 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Max67131 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Lay81266 = tf.keras.layers.Input(shape=([4, 4]))
in0Con73123 = tf.keras.layers.Input(shape=([2]))

Max265 = keras.layers.Maximum(name = 'Max265', )([in0Max265,in1Max265])
Res40937 = keras.layers.Reshape((1, 2, 1), name = 'Res40937', )(Max265)
Res76413 = keras.layers.Reshape((1, 2), name = 'Res76413', )(Res40937)
Cro58032 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro58032', )(Res76413)
Con55021 = keras.layers.Conv1D(3, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con55021', )(Cro58032)
Fla2721 = keras.layers.Flatten(name = 'Fla2721', )(Con55021)
Max67131 = keras.layers.Maximum(name = 'Max67131', )([in0Max67131,in1Max67131])
Res19364 = keras.layers.Reshape((2, 2), name = 'Res19364', )(Max67131)
Sim5660 = keras.layers.SimpleRNN(1,name = 'Sim5660', )(Res19364)
Lay81266 = keras.layers.LayerNormalization(axis=1, epsilon=2.8991665112761025, name = 'Lay81266', )(in0Lay81266)
Res86384 = keras.layers.Reshape((4, 4, 1), name = 'Res86384', )(Lay81266)
Res6544 = keras.layers.Reshape((4, 4, 1, 1), name = 'Res6544', )(Res86384)
Glo34446 = keras.layers.GlobalAveragePooling3D(name = 'Glo34446', )(Res6544)
Ave97798 = keras.layers.Average(name = 'Ave97798', )([Sim5660,Glo34446])
Con73123 = keras.layers.Concatenate(axis=1, name = 'Con73123', )([Ave97798,in0Con73123])
Mul75129 = keras.layers.Multiply(name = 'Mul75129', )([Fla2721,Con73123])
model = tf.keras.models.Model(inputs=[in0Max265,in1Max265,in0Max67131,in1Max67131,in0Lay81266,in0Con73123], outputs=Mul75129)
w = model.get_layer('Con55021').get_weights() 
w[0] = np.array([[[0.8282, 0.1517, 0.6153], [0.5238, 0.879, 0.2383]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con55021').set_weights(w) 
w = model.get_layer('Sim5660').get_weights() 
w[0] = np.array([[3], [7]])
w[1] = np.array([[2]])
w[2] = np.array([7])
model.get_layer('Sim5660').set_weights(w) 
in0Max265 = tf.constant([[[[[0.5336]], [[0.6335]]]]])
in1Max265 = tf.constant([[[[[0.5734]], [[0.8936]]]]])
in0Max67131 = tf.constant([[[[0.2317], [0.124]], [[0.9623], [0.4324]]]])
in1Max67131 = tf.constant([[[[0.4892], [0.2864]], [[0.8646], [0.3125]]]])
in0Lay81266 = tf.constant([[[1.2985, 1.916, 1.3194, 1.9522], [1.6179, 1.0687, 1.4561, 1.9041], [1.5071, 1.3446, 1.2797, 1.5031], [1.1192, 1.0429, 1.0458, 1.2104]]])
in0Con73123 = tf.constant([[0.7618, 0.9117]])
print (np.array2string(model.predict([in0Max265,in1Max265,in0Max67131,in1Max67131,in0Lay81266,in0Con73123],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul75129.png')

LMax265 = maximum_layer([[[[[[0.5336]], [[0.6335]]]]], [[[[[0.5734]], [[0.8936]]]]]], Max265), 
LRes40937 = reshape_layer(Max265, [1, 2, 1], Res40937), 
LRes76413 = reshape_layer(Res40937, [1, 2], Res76413), 
LCro58032 = cropping1D_layer(Res76413, 0, 0, Cro58032), 
LCon55021 = conv1D_layer(Cro58032, 1,[[[0.8282, 0.1517, 0.6153], [0.5238, 0.879, 0.2383]]],[0, 0, 0], 1, false, 1, Con55021), 
LFla2721 = flatten_layer(Con55021, Fla2721), 
LMax67131 = maximum_layer([[[[[0.2317], [0.124]], [[0.9623], [0.4324]]]], [[[[0.4892], [0.2864]], [[0.8646], [0.3125]]]]], Max67131), 
LRes19364 = reshape_layer(Max67131, [2, 2], Res19364), 
LSim5660 = simple_rnn_layer(Res19364,[[3], [7]],[[2]],[7], Sim5660), 
LLay81266 = layer_normalization_layer([[[1.2985, 1.916, 1.3194, 1.9522], [1.6179, 1.0687, 1.4561, 1.9041], [1.5071, 1.3446, 1.2797, 1.5031], [1.1192, 1.0429, 1.0458, 1.2104]]], 1, 2.8991665112761025, Lay81266), 
LRes86384 = reshape_layer(Lay81266, [4, 4, 1], Res86384), 
LRes6544 = reshape_layer(Res86384, [4, 4, 1, 1], Res6544), 
LGlo34446 = global_average_pooling3D_layer(Res6544, Glo34446), 
LAve97798 = average_layer([Sim5660,Glo34446], Ave97798), 
LCon73123 = concatenate_layer([Ave97798,[[0.7618, 0.9117]]], 1, Con73123), 
LMul75129 = multiply_layer([Fla2721,Con73123], Mul75129), 
exec_layers([LMax265,LRes40937,LRes76413,LCro58032,LCon55021,LFla2721,LMax67131,LRes19364,LSim5660,LLay81266,LRes86384,LRes6544,LGlo34446,LAve97798,LCon73123,LMul75129],["Max265","Res40937","Res76413","Cro58032","Con55021","Fla2721","Max67131","Res19364","Sim5660","Lay81266","Res86384","Res6544","Glo34446","Ave97798","Con73123","Mul75129"],Mul75129,"Mul75129")

Actual (Unparsed): [[0.4714788, 0.6646394, 0.5158015]]

Expected (Unparsed): [[0.4714787799998951,0.664639403324,0.5158014774299999]]

Actual:   [[0.4715, 0.6647, 0.5159]]

Expected: [[0.4715, 0.6647, 0.5159]]