import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min29331 = tf.keras.layers.Input(shape=([1, 1]))
in1Min29331 = tf.keras.layers.Input(shape=([1, 1]))
in0Per20254 = tf.keras.layers.Input(shape=([4, 2]))

Min29331 = keras.layers.Minimum(name = 'Min29331', )([in0Min29331,in1Min29331])
Res6367 = keras.layers.Reshape((1, 1, 1), name = 'Res6367', )(Min29331)
Zer77667 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer77667', )(Res6367)
Per20254 = keras.layers.Permute((1,2), name = 'Per20254',)(in0Per20254)
GRU53483 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU53483', )(Per20254)
Res27170 = keras.layers.Reshape((2, 1), name = 'Res27170', )(GRU53483)
Res13132 = keras.layers.Reshape((2, 1, 1), name = 'Res13132', )(Res27170)
Max48016 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 1), padding='same', name = 'Max48016', )(Res13132)
Mul72820 = keras.layers.Multiply(name = 'Mul72820', )([Zer77667,Max48016])
Res82693 = keras.layers.Reshape((2, 1), name = 'Res82693', )(Mul72820)
Glo41944 = keras.layers.GlobalMaxPool1D(name = 'Glo41944', )(Res82693)
model = tf.keras.models.Model(inputs=[in0Min29331,in1Min29331,in0Per20254], outputs=Glo41944)
w = model.get_layer('GRU53483').get_weights() 
w[0] = np.array([[6, 4, 10, 9, 3, 1], [4, 2, 3, 9, 4, 3]])
w[1] = np.array([[1, 6, 3, 10, 5, 5], [2, 6, 8, 5, 6, 4]])
w[2] = np.array([1, 1, 1, 6, 6, 9])
model.get_layer('GRU53483').set_weights(w) 
in0Min29331 = tf.constant([[[0.3879]]])
in1Min29331 = tf.constant([[[0.2356]]])
in0Per20254 = tf.constant([[[1.595, 1.8154], [1.0693, 1.8398], [1.2519, 1.6504], [1.4352, 1.5364]]])
print (np.array2string(model.predict([in0Min29331,in1Min29331,in0Per20254],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo41944.png')

LMin29331 = minimum_layer([[[[0.3879]]], [[[0.2356]]]], Min29331), 
LRes6367 = reshape_layer(Min29331, [1, 1, 1], Res6367), 
LZer77667 = zero_padding2D_layer(Res6367, 1, 0, 0, 0, Zer77667), 
LPer20254 = permute_layer([[[1.595, 1.8154], [1.0693, 1.8398], [1.2519, 1.6504], [1.4352, 1.5364]]], 1,2, Per20254), 
LGRU53483 = gru_layer(Per20254,[[6, 4, 10, 9, 3, 1], [4, 2, 3, 9, 4, 3]],[[1, 6, 3, 10, 5, 5], [2, 6, 8, 5, 6, 4]],[1, 1, 1, 6, 6, 9], false, GRU53483), 
LRes27170 = reshape_layer(GRU53483, [2, 1], Res27170), 
LRes13132 = reshape_layer(Res27170, [2, 1, 1], Res13132), 
LMax48016 = max_pool2D_layer(Res13132, 1, 1, 1, 1, true, Max48016), 
LMul72820 = multiply_layer([Zer77667,Max48016], Mul72820), 
LRes82693 = reshape_layer(Mul72820, [2, 1], Res82693), 
LGlo41944 = global_max_pool1D_layer(Res82693, Glo41944), 
exec_layers([LMin29331,LRes6367,LZer77667,LPer20254,LGRU53483,LRes27170,LRes13132,LMax48016,LMul72820,LRes82693,LGlo41944],["Min29331","Res6367","Zer77667","Per20254","GRU53483","Res27170","Res13132","Max48016","Mul72820","Res82693","Glo41944"],Glo41944,"Glo41944")

Actual (Unparsed): [[0.0000684]]

Expected (Unparsed): [[6.844566690184931e-5]]

Actual:   [[0.0001]]

Expected: [[0.0001]]