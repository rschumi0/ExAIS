import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con71136 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Up_87451 = tf.keras.layers.Input(shape=([4, 3]))
in0Con48520 = tf.keras.layers.Input(shape=([1]))
in0Con33053 = tf.keras.layers.Input(shape=([3, 1, 1, 1]))
in0PRe89672 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))

Con71136 = keras.layers.Conv2D(3, (1, 2),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con71136', )(in0Con71136)
Max45083 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(12, 2), padding='same', name = 'Max45083', )(Con71136)
Res95988 = keras.layers.Reshape((1, 3), name = 'Res95988', )(Max45083)
Fla62562 = keras.layers.Flatten(name = 'Fla62562', )(Res95988)
Up_87451 = keras.layers.UpSampling1D(size=(1), name = 'Up_87451', )(in0Up_87451)
GRU86683 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU86683', )(Up_87451)
Con48520 = keras.layers.Concatenate(axis=1, name = 'Con48520', )([GRU86683,in0Con48520])
Add26728 = keras.layers.Add(name = 'Add26728', )([Fla62562,Con48520])
Res5946 = keras.layers.Reshape((3, 1), name = 'Res5946', )(Add26728)
Res38577 = keras.layers.Reshape((3, 1, 1), name = 'Res38577', )(Res5946)
Res35334 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res35334', )(Res38577)
Con33053 = keras.layers.Concatenate(axis=4, name = 'Con33053', )([Res35334,in0Con33053])
PRe89672 = keras.layers.PReLU(name = 'PRe89672', input_shape=(2, 1, 1, 2))(in0PRe89672)
Zer1394 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (0, 0)), name = 'Zer1394', )(PRe89672)
Mul53049 = keras.layers.Multiply(name = 'Mul53049', )([Con33053,Zer1394])
model = tf.keras.models.Model(inputs=[in0Con71136,in0Up_87451,in0Con48520,in0Con33053,in0PRe89672], outputs=Mul53049)
w = model.get_layer('Con71136').get_weights() 
w[0] = np.array([[[[0.9988, 0.7756, 0.8514], [0.4243, 0.8308, 0.3807]], [[0.8973, 0.5445, 0.5404], [0.8183, 0.0163, 0.9288]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con71136').set_weights(w) 
w = model.get_layer('GRU86683').get_weights() 
w[0] = np.array([[10, 3, 7, 8, 8, 7], [4, 1, 3, 4, 4, 1], [3, 5, 5, 2, 5, 9]])
w[1] = np.array([[9, 2, 9, 4, 9, 7], [5, 3, 10, 3, 8, 6]])
w[2] = np.array([6, 4, 4, 7, 6, 4])
model.get_layer('GRU86683').set_weights(w) 
w = model.get_layer('PRe89672').get_weights() 
w[0] = np.array([[[[0.0961, 0.6099]]], [[[0.325, 0.1049]]]])
model.get_layer('PRe89672').set_weights(w) 
in0Con71136 = tf.constant([[[[0.2916, 0.2804], [0.2334, 0.1088]]]])
in0Up_87451 = tf.constant([[[1.9817, 1.6061, 1.3424], [1.3836, 1.0174, 1.1213], [1.3668, 1.7108, 1.945], [1.6063, 1.739, 1.8003]]])
in0Con48520 = tf.constant([[0.7735]])
in0Con33053 = tf.constant([[[[[0.9861]]], [[[0.5323]]], [[[0.2568]]]]])
in0PRe89672 = tf.constant([[[[[0.9082, 0.2573]]], [[[0.6245, 0.4563]]]]])
print (np.array2string(model.predict([in0Con71136,in0Up_87451,in0Con48520,in0Con33053,in0PRe89672],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul53049.png')

LCon71136 = conv2D_layer([[[[0.2916, 0.2804], [0.2334, 0.1088]]]], 1, 2,[[[[0.9988, 0.7756, 0.8514], [0.4243, 0.8308, 0.3807]], [[0.8973, 0.5445, 0.5404], [0.8183, 0.0163, 0.9288]]]],[0, 0, 0], 1, 1, true, 1, 1, Con71136), 
LMax45083 = max_pool2D_layer(Con71136, 1, 1, 12, 2, true, Max45083), 
LRes95988 = reshape_layer(Max45083, [1, 3], Res95988), 
LFla62562 = flatten_layer(Res95988, Fla62562), 
LUp_87451 = up_sampling1D_layer([[[1.9817, 1.6061, 1.3424], [1.3836, 1.0174, 1.1213], [1.3668, 1.7108, 1.945], [1.6063, 1.739, 1.8003]]], 1, Up_87451), 
LGRU86683 = gru_layer(Up_87451,[[10, 3, 7, 8, 8, 7], [4, 1, 3, 4, 4, 1], [3, 5, 5, 2, 5, 9]],[[9, 2, 9, 4, 9, 7], [5, 3, 10, 3, 8, 6]],[6, 4, 4, 7, 6, 4], false, GRU86683), 
LCon48520 = concatenate_layer([GRU86683,[[0.7735]]], 1, Con48520), 
LAdd26728 = add_layer([Fla62562,Con48520], Add26728), 
LRes5946 = reshape_layer(Add26728, [3, 1], Res5946), 
LRes38577 = reshape_layer(Res5946, [3, 1, 1], Res38577), 
LRes35334 = reshape_layer(Res38577, [3, 1, 1, 1], Res35334), 
LCon33053 = concatenate_layer([Res35334,[[[[[0.9861]]], [[[0.5323]]], [[[0.2568]]]]]], 4, Con33053), 
LPRe89672 = prelu_layer([[[[[0.9082, 0.2573]]], [[[0.6245, 0.4563]]]]], [[[[0.0961, 0.6099]]], [[[0.325, 0.1049]]]], PRe89672), 
LZer1394 = zero_padding3D_layer(PRe89672, 1, 0, 0, 0, 0, 0, Zer1394), 
LMul53049 = multiply_layer([Con33053,Zer1394], Mul53049), 
exec_layers([LCon71136,LMax45083,LRes95988,LFla62562,LUp_87451,LGRU86683,LCon48520,LAdd26728,LRes5946,LRes38577,LRes35334,LCon33053,LPRe89672,LZer1394,LMul53049],["Con71136","Max45083","Res95988","Fla62562","Up_87451","GRU86683","Con48520","Add26728","Res5946","Res38577","Res35334","Con33053","PRe89672","Zer1394","Mul53049"],Mul53049,"Mul53049")

Actual (Unparsed): [[[[[0.0000000, 0.0000000]]], [[[0.5340047, 0.1369608]]], [[[0.8466342, 0.1171778]]]]]

Expected (Unparsed): [[[[[0.0,0.0]]],[[[0.5340047269050494,0.13696078999999997]]],[[[0.84663422534,0.11717783999999998]]]]]

Actual:   [[[[[0, 0]]], [[[0.5341, 0.137]]], [[[0.8467, 0.1172]]]]]

Expected: [[[[[0, 0]]], [[[0.5341, 0.137]]], [[[0.8467, 0.1172]]]]]