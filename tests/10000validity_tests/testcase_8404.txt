import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con99424 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Sub43215 = tf.keras.layers.Input(shape=([2]))
in1Sub43215 = tf.keras.layers.Input(shape=([2]))
in0Con29704 = tf.keras.layers.Input(shape=([1]))

Con99424 = keras.layers.Conv2D(3, (1, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con99424', )(in0Con99424)
Res42597 = keras.layers.Reshape((1, 3), name = 'Res42597', )(Con99424)
Fla65689 = keras.layers.Flatten(name = 'Fla65689', )(Res42597)
Sub43215 = keras.layers.Subtract(name = 'Sub43215', )([in0Sub43215,in1Sub43215])
Con29704 = keras.layers.Concatenate(axis=1, name = 'Con29704', )([Sub43215,in0Con29704])
Mul61517 = keras.layers.Multiply(name = 'Mul61517', )([Fla65689,Con29704])
Res10645 = keras.layers.Reshape((3, 1), name = 'Res10645', )(Mul61517)
Res20409 = keras.layers.Reshape((3, 1, 1), name = 'Res20409', )(Res10645)
Res4985 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res4985', )(Res20409)
Con54912 = keras.layers.Conv3DTranspose(4, (2, 1, 1),strides=(1, 1, 1), padding='same', name = 'Con54912', )(Res4985)
model = tf.keras.models.Model(inputs=[in0Con99424,in0Sub43215,in1Sub43215,in0Con29704], outputs=Con54912)
w = model.get_layer('Con99424').get_weights() 
w[0] = np.array([[[[0.3969, 0.4536, 0.3423]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con99424').set_weights(w) 
w = model.get_layer('Con54912').get_weights() 
w[0] = np.array([[[[[0.3891], [0.2308], [0.7927], [0.0921]]]], [[[[0.2101], [0.682], [0.3358], [0.2971]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con54912').set_weights(w) 
in0Con99424 = tf.constant([[[[0.3914]]]])
in0Sub43215 = tf.constant([[0.1583, 0.2762]])
in1Sub43215 = tf.constant([[0.1171, 0.7416]])
in0Con29704 = tf.constant([[0.8343]])
print (np.array2string(model.predict([in0Con99424,in0Sub43215,in1Sub43215,in0Con29704],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con54912.png')

LCon99424 = conv2D_layer([[[[0.3914]]]], 1, 1,[[[[0.3969, 0.4536, 0.3423]]]],[0, 0, 0], 1, 1, false, 1, 1, Con99424), 
LRes42597 = reshape_layer(Con99424, [1, 3], Res42597), 
LFla65689 = flatten_layer(Res42597, Fla65689), 
LSub43215 = subtract_layer([[0.1583, 0.2762]], [[0.1171, 0.7416]], Sub43215), 
LCon29704 = concatenate_layer([Sub43215,[[0.8343]]], 1, Con29704), 
LMul61517 = multiply_layer([Fla65689,Con29704], Mul61517), 
LRes10645 = reshape_layer(Mul61517, [3, 1], Res10645), 
LRes20409 = reshape_layer(Res10645, [3, 1, 1], Res20409), 
LRes4985 = reshape_layer(Res20409, [3, 1, 1, 1], Res4985), 
LCon54912 = conv3D_transpose_layer(Res4985, 2, 1, 1,[[[[[0.3891], [0.2308], [0.7927], [0.0921]]]], [[[[0.2101], [0.682], [0.3358], [0.2971]]]]],[0, 0, 0, 0], 1, 1, 1, true, Con54912), 
exec_layers([LCon99424,LRes42597,LFla65689,LSub43215,LCon29704,LMul61517,LRes10645,LRes20409,LRes4985,LCon54912],["Con99424","Res42597","Fla65689","Sub43215","Con29704","Mul61517","Res10645","Res20409","Res4985","Con54912"],Con54912,"Con54912")

Actual (Unparsed): [[[[[0.0024903, 0.0014772, 0.0050735, 0.0005895]]], [[[-0.0308053, -0.0147052, -0.0633489, -0.0057084]]], [[[0.0261323, -0.0305534, 0.0608591, -0.0142538]]]]]

Expected (Unparsed): [[[[[0.0024903498787272,0.0014771851760736001,0.0050735038521384,0.0005894660083032]]],[[[-0.030805337661386403,-0.014705242663708804,-0.06334894586028961,-0.005708392336130401]]],[[[0.026132318608347,-0.030553404437455207,0.060859085323541395,-0.014253780636206997]]]]]

Actual:   [[[[[0.0025, 0.0015, 0.0051, 0.0006]]], [[[-0.0308, -0.0147, -0.0633, -0.0057]]], [[[0.0262, -0.0305, 0.0609, -0.0142]]]]]

Expected: [[[[[0.0025, 0.0015, 0.0051, 0.0006]]], [[[-0.0308, -0.0147, -0.0633, -0.0057]]], [[[0.0262, -0.0305, 0.0609, -0.0142]]]]]