import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave37343 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Ave37343 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in0Con22858 = tf.keras.layers.Input(shape=([3, 2, 1, 2]))
in0Ave47254 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave47254 = tf.keras.layers.Input(shape=([1, 2]))

Ave37343 = keras.layers.Average(name = 'Ave37343', )([in0Ave37343,in1Ave37343])
Res86368 = keras.layers.Reshape((1, 1, 4), name = 'Res86368', )(Ave37343)
Glo86420 = keras.layers.GlobalAveragePooling2D(name = 'Glo86420', )(Res86368)
ReL15297 = keras.layers.ReLU(max_value=5.059855561955555, negative_slope=3.187117970717533, threshold=4.210834867496863, name = 'ReL15297', )(Glo86420)
Res30002 = keras.layers.Reshape((4, 1), name = 'Res30002', )(ReL15297)
Res77063 = keras.layers.Reshape((4, 1, 1), name = 'Res77063', )(Res30002)
Glo42241 = keras.layers.GlobalMaxPool2D(name = 'Glo42241', )(Res77063)
Res18347 = keras.layers.Reshape((1, 1), name = 'Res18347', )(Glo42241)
Res35857 = keras.layers.Reshape((1, 1, 1), name = 'Res35857', )(Res18347)
Res48559 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res48559', )(Res35857)
Zer30829 = keras.layers.ZeroPadding3D(padding=((2, 0), (1, 0), (0, 0)), name = 'Zer30829', )(Res48559)
Con22858 = keras.layers.Concatenate(axis=4, name = 'Con22858', )([Zer30829,in0Con22858])
Ave47254 = keras.layers.Average(name = 'Ave47254', )([in0Ave47254,in1Ave47254])
Res9562 = keras.layers.Reshape((1, 2, 1), name = 'Res9562', )(Ave47254)
Res9628 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res9628', )(Res9562)
Con13313 = keras.layers.Conv3DTranspose(3, (1, 1, 1),strides=(3, 1, 1), padding='same', name = 'Con13313', )(Res9628)
Sub16743 = keras.layers.Subtract(name = 'Sub16743', )([Con22858,Con13313])
model = tf.keras.models.Model(inputs=[in0Ave37343,in1Ave37343,in0Con22858,in0Ave47254,in1Ave47254], outputs=Sub16743)
w = model.get_layer('Con13313').get_weights() 
w[0] = np.array([[[[[0.0624], [0.5917], [0.1152]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con13313').set_weights(w) 
in0Ave37343 = tf.constant([[[[[0.5024, 0.5725], [0.0899, 0.748]]]]])
in1Ave37343 = tf.constant([[[[[0.689, 0.1348], [0.305, 0.041]]]]])
in0Con22858 = tf.constant([[[[[0.0804, 0.6749]], [[0.2425, 0.4549]]], [[[0.5888, 0.1093]], [[0.4316, 0.1976]]], [[[0.9269, 0.7449]], [[0.9163, 0.8352]]]]])
in0Ave47254 = tf.constant([[[0.6758, 0.3752]]])
in1Ave47254 = tf.constant([[[0.6138, 0.1133]]])
print (np.array2string(model.predict([in0Ave37343,in1Ave37343,in0Con22858,in0Ave47254,in1Ave47254],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub16743.png')

LAve37343 = average_layer([[[[[[0.5024, 0.5725], [0.0899, 0.748]]]]], [[[[[0.689, 0.1348], [0.305, 0.041]]]]]], Ave37343), 
LRes86368 = reshape_layer(Ave37343, [1, 1, 4], Res86368), 
LGlo86420 = global_average_pooling2D_layer(Res86368, Glo86420), 
LReL15297 = relu_layer(Glo86420, 5.059855561955555, 3.187117970717533, 4.210834867496863, ReL15297), 
LRes30002 = reshape_layer(ReL15297, [4, 1], Res30002), 
LRes77063 = reshape_layer(Res30002, [4, 1, 1], Res77063), 
LGlo42241 = global_max_pool2D_layer(Res77063, Glo42241), 
LRes18347 = reshape_layer(Glo42241, [1, 1], Res18347), 
LRes35857 = reshape_layer(Res18347, [1, 1, 1], Res35857), 
LRes48559 = reshape_layer(Res35857, [1, 1, 1, 1], Res48559), 
LZer30829 = zero_padding3D_layer(Res48559, 2, 0, 1, 0, 0, 0, Zer30829), 
LCon22858 = concatenate_layer([Zer30829,[[[[[0.0804, 0.6749]], [[0.2425, 0.4549]]], [[[0.5888, 0.1093]], [[0.4316, 0.1976]]], [[[0.9269, 0.7449]], [[0.9163, 0.8352]]]]]], 4, Con22858), 
LAve47254 = average_layer([[[[0.6758, 0.3752]]], [[[0.6138, 0.1133]]]], Ave47254), 
LRes9562 = reshape_layer(Ave47254, [1, 2, 1], Res9562), 
LRes9628 = reshape_layer(Res9562, [1, 2, 1, 1], Res9628), 
LCon13313 = conv3D_transpose_layer(Res9628, 1, 1, 1,[[[[[0.0624], [0.5917], [0.1152]]]]],[0, 0, 0], 3, 1, 1, true, Con13313), 
LSub16743 = subtract_layer(Con22858,Con13313, Sub16743), 
exec_layers([LAve37343,LRes86368,LGlo86420,LReL15297,LRes30002,LRes77063,LGlo42241,LRes18347,LRes35857,LRes48559,LZer30829,LCon22858,LAve47254,LRes9562,LRes9628,LCon13313,LSub16743],["Ave37343","Res86368","Glo86420","ReL15297","Res30002","Res77063","Glo42241","Res18347","Res35857","Res48559","Zer30829","Con22858","Ave47254","Res9562","Res9628","Con13313","Sub16743"],Sub16743,"Sub16743")

Actual (Unparsed): [[[[[-0.0402355, -0.3011282, 0.6006190]], [[-0.0152412, 0.0979773, 0.4267624]]], [[[0.0000000, 0.5888000, 0.1093000]], [[0.0000000, 0.4316000, 0.1976000]]], [[[0.0000000, 0.9269000, 0.7449000]], [[-11.5218613, 0.9163000, 0.8352000]]]]]

Expected (Unparsed): [[[[[-0.040235520000000004,-0.30112816,0.60061904]],[[-0.015241199999999998,0.097977275,0.42676240000000004]]],[[[0,0.5888,0.1093]],[[0,0.4316,0.1976]]],[[[0,0.9269,0.7449]],[[-11.521861302766801,0.9163,0.8352]]]]]

Actual:   [[[[[-0.0402, -0.3011, 0.6007]], [[-0.0152, 0.098, 0.4268]]], [[[0, 0.5888, 0.1093]], [[0, 0.4316, 0.1976]]], [[[0, 0.9269, 0.7449]], [[-11.5218, 0.9163, 0.8352]]]]]

Expected: [[[[[-0.0402, -0.3011, 0.6007]], [[-0.0152, 0.098, 0.4268]]], [[[0, 0.5888, 0.1093]], [[0, 0.4316, 0.1976]]], [[[0, 0.9269, 0.7449]], [[-11.5218, 0.9163, 0.8352]]]]]