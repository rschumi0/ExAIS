import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min68609 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Min68609 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Lay63010 = tf.keras.layers.Input(shape=([2, 2, 3]))
in0PRe92542 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))

Min68609 = keras.layers.Minimum(name = 'Min68609', )([in0Min68609,in1Min68609])
Res36645 = keras.layers.Reshape((2, 2, 2, 1), name = 'Res36645', )(Min68609)
PRe89175 = keras.layers.PReLU(name = 'PRe89175', )(Res36645)
Res4609 = keras.layers.Reshape((2, 2, 2), name = 'Res4609', )(PRe89175)
Res9372 = keras.layers.Reshape((2, 4), name = 'Res9372', )(Res4609)
Lay63010 = keras.layers.LayerNormalization(axis=2, epsilon=1.8179943717387732, name = 'Lay63010', )(in0Lay63010)
Res18047 = keras.layers.Reshape((2, 6), name = 'Res18047', )(Lay63010)
Loc30730 = keras.layers.LocallyConnected1D(4, (1),strides=(1), name = 'Loc30730', )(Res18047)
Res94145 = keras.layers.Reshape((2, 4, 1), name = 'Res94145', )(Loc30730)
Res75114 = keras.layers.Reshape((2, 4, 1, 1), name = 'Res75114', )(Res94145)
PRe92542 = keras.layers.PReLU(name = 'PRe92542', input_shape=(1, 2, 1, 1))(in0PRe92542)
Zer1600 = keras.layers.ZeroPadding3D(padding=((1, 0), (2, 0), (0, 0)), name = 'Zer1600', )(PRe92542)
Min28887 = keras.layers.Minimum(name = 'Min28887', )([Res75114,Zer1600])
Res39084 = keras.layers.Reshape((2, 2, 2), name = 'Res39084', )(Min28887)
Res89675 = keras.layers.Reshape((2, 4), name = 'Res89675', )(Res39084)
Dot1154 = keras.layers.Dot(axes=(1, 1), name = 'Dot1154', )([Res9372,Res89675])
model = tf.keras.models.Model(inputs=[in0Min68609,in1Min68609,in0Lay63010,in0PRe92542], outputs=Dot1154)
w = model.get_layer('PRe89175').get_weights() 
w[0] = np.array([[[[0.1017], [0.9069]], [[0.5521], [0.562]]], [[[0.6762], [0.6123]], [[0.2837], [0.4674]]]])
model.get_layer('PRe89175').set_weights(w) 
w = model.get_layer('Loc30730').get_weights() 
w[0] = np.array([[[0.1644, 0.1619, 0.7483, 0.3185], [0.4485, 0.69, 0.805, 0.2228], [0.368, 0.6328, 0.9703, 0.5929], [0.5356, 0.8903, 0.6856, 0.7585], [0.2022, 0.9905, 0.5688, 0.8251], [0.2505, 0.4993, 0.0527, 0.4953]], [[0.1194, 0.0852, 0.7818, 0.6536], [0.2451, 0.3246, 0.7997, 0.6532], [0.9745, 0.0822, 0.5026, 0.6982], [0.6726, 0.7039, 0.1822, 0.3182], [0.9252, 0.3201, 0.737, 0.6952], [0.3196, 0.2702, 0.7906, 0.5231]]])
w[1] = np.array([[0, 0, 0, 0], [0, 0, 0, 0]])
model.get_layer('Loc30730').set_weights(w) 
w = model.get_layer('PRe92542').get_weights() 
w[0] = np.array([[[[0.1528]], [[0.7607]]]])
model.get_layer('PRe92542').set_weights(w) 
in0Min68609 = tf.constant([[[[0.4937, 0.616], [0.599, 0.1822]], [[0.9813, 0.4599], [0.6379, 0.6333]]]])
in1Min68609 = tf.constant([[[[0.2298, 0.4538], [0.6236, 0.0724]], [[0.9748, 0.6639], [0.0573, 0.6855]]]])
in0Lay63010 = tf.constant([[[[1.2212, 1.7936, 1.2808], [1.9577, 1.4449, 1.2719]], [[1.9645, 1.782, 1.8007], [1.3381, 1.3046, 1.8759]]]])
in0PRe92542 = tf.constant([[[[[0.6451]], [[0.5371]]]]])
print (np.array2string(model.predict([in0Min68609,in1Min68609,in0Lay63010,in0PRe92542],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot1154.png')

LMin68609 = minimum_layer([[[[[0.4937, 0.616], [0.599, 0.1822]], [[0.9813, 0.4599], [0.6379, 0.6333]]]], [[[[0.2298, 0.4538], [0.6236, 0.0724]], [[0.9748, 0.6639], [0.0573, 0.6855]]]]], Min68609), 
LRes36645 = reshape_layer(Min68609, [2, 2, 2, 1], Res36645), 
LPRe89175 = prelu_layer(Res36645, [[[[0.1017], [0.9069]], [[0.5521], [0.562]]], [[[0.6762], [0.6123]], [[0.2837], [0.4674]]]], PRe89175), 
LRes4609 = reshape_layer(PRe89175, [2, 2, 2], Res4609), 
LRes9372 = reshape_layer(Res4609, [2, 4], Res9372), 
LLay63010 = layer_normalization_layer([[[[1.2212, 1.7936, 1.2808], [1.9577, 1.4449, 1.2719]], [[1.9645, 1.782, 1.8007], [1.3381, 1.3046, 1.8759]]]], 2, 1.8179943717387732, Lay63010), 
LRes18047 = reshape_layer(Lay63010, [2, 6], Res18047), 
LLoc30730 = locally_connected1D_layer(Res18047, 1,[[[0.1644, 0.1619, 0.7483, 0.3185], [0.4485, 0.69, 0.805, 0.2228], [0.368, 0.6328, 0.9703, 0.5929], [0.5356, 0.8903, 0.6856, 0.7585], [0.2022, 0.9905, 0.5688, 0.8251], [0.2505, 0.4993, 0.0527, 0.4953]], [[0.1194, 0.0852, 0.7818, 0.6536], [0.2451, 0.3246, 0.7997, 0.6532], [0.9745, 0.0822, 0.5026, 0.6982], [0.6726, 0.7039, 0.1822, 0.3182], [0.9252, 0.3201, 0.737, 0.6952], [0.3196, 0.2702, 0.7906, 0.5231]]],[[0, 0, 0, 0], [0, 0, 0, 0]], 1, Loc30730), 
LRes94145 = reshape_layer(Loc30730, [2, 4, 1], Res94145), 
LRes75114 = reshape_layer(Res94145, [2, 4, 1, 1], Res75114), 
LPRe92542 = prelu_layer([[[[[0.6451]], [[0.5371]]]]], [[[[0.1528]], [[0.7607]]]], PRe92542), 
LZer1600 = zero_padding3D_layer(PRe92542, 1, 0, 2, 0, 0, 0, Zer1600), 
LMin28887 = minimum_layer([Res75114,Zer1600], Min28887), 
LRes39084 = reshape_layer(Min28887, [2, 2, 2], Res39084), 
LRes89675 = reshape_layer(Res39084, [2, 4], Res89675), 
LDot1154 = dot_layer(Res9372,Res89675, 1, 1, Dot1154), 
exec_layers([LMin68609,LRes36645,LPRe89175,LRes4609,LRes9372,LLay63010,LRes18047,LLoc30730,LRes94145,LRes75114,LPRe92542,LZer1600,LMin28887,LRes39084,LRes89675,LDot1154],["Min68609","Res36645","PRe89175","Res4609","Res9372","Lay63010","Res18047","Loc30730","Res94145","Res75114","PRe92542","Zer1600","Min28887","Res39084","Res89675","Dot1154"],Dot1154,"Dot1154")

Actual (Unparsed): [[[-0.2553797, -0.1305881, 0.1507291, 0.0620812], [-0.1204854, -0.0616100, 0.0711123, 0.0292892], [-0.0150115, -0.0076761, 0.0088600, 0.0036492], [-0.1659130, -0.0848394, 0.0979244, 0.0403324]]]

Expected (Unparsed): [[[-0.2553797058674235,-0.130588110324497,0.15072906572101866,0.06208122032690501],[-0.1204853577435659,-0.06161004507410358,0.07111232799045597,0.02928924213002012],[-0.015011548159831108,-0.007676137383661959,0.008860048692874814,0.0036492141205700214],[-0.16591297468797628,-0.08483940322989736,0.09792441251653787,0.04033241365719013]]]

Actual:   [[[-0.2553, -0.1305, 0.1508, 0.0621], [-0.1204, -0.0616, 0.0712, 0.0293], [-0.015, -0.0076, 0.0089, 0.0037], [-0.1659, -0.0848, 0.098, 0.0404]]]

Expected: [[[-0.2553, -0.1305, 0.1508, 0.0621], [-0.1204, -0.0616, 0.0712, 0.0293], [-0.015, -0.0076, 0.0089, 0.0037], [-0.1659, -0.0848, 0.098, 0.0404]]]