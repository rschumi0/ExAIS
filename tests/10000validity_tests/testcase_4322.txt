import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con5455 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Max18334 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Max18334 = tf.keras.layers.Input(shape=([1, 1, 2]))

Con5455 = keras.layers.Conv2D(2, (2, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con5455', )(in0Con5455)
Zer70675 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer70675', )(Con5455)
Max18334 = keras.layers.Maximum(name = 'Max18334', )([in0Max18334,in1Max18334])
Zer3867 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer3867', )(Max18334)
Ave70576 = keras.layers.Average(name = 'Ave70576', )([Zer70675,Zer3867])
model = tf.keras.models.Model(inputs=[in0Con5455,in0Max18334,in1Max18334], outputs=Ave70576)
w = model.get_layer('Con5455').get_weights() 
w[0] = np.array([[[[0.6149, 0.2194], [0.7148, 0.136]]], [[[0.196, 0.4661], [0.8128, 0.1179]]]])
w[1] = np.array([0, 0])
model.get_layer('Con5455').set_weights(w) 
in0Con5455 = tf.constant([[[[0.4377, 0.1046]], [[0.4924, 0.5864]]]])
in0Max18334 = tf.constant([[[[0.1377, 0.9024]]]])
in1Max18334 = tf.constant([[[[0.1823, 0.1536]]]])
print (np.array2string(model.predict([in0Con5455,in0Max18334,in1Max18334],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave70576.png')

LCon5455 = conv2D_layer([[[[0.4377, 0.1046]], [[0.4924, 0.5864]]]], 2, 1,[[[[0.6149, 0.2194], [0.7148, 0.136]]], [[[0.196, 0.4661], [0.8128, 0.1179]]]],[0, 0], 1, 1, false, 1, 1, Con5455), 
LZer70675 = zero_padding2D_layer(Con5455, 1, 1, 1, 1, Zer70675), 
LMax18334 = maximum_layer([[[[[0.1377, 0.9024]]]], [[[[0.1823, 0.1536]]]]], Max18334), 
LZer3867 = zero_padding2D_layer(Max18334, 2, 0, 2, 0, Zer3867), 
LAve70576 = average_layer([Zer70675,Zer3867], Ave70576), 
exec_layers([LCon5455,LZer70675,LMax18334,LZer3867,LAve70576],["Con5455","Zer70675","Max18334","Zer3867","Ave70576"],Ave70576,"Ave70576")

Actual (Unparsed): [[[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.4585231, 0.2044506], [0.0000000, 0.0000000]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0911500, 0.4512000]]]]

Expected (Unparsed): [[[[0,0],[0,0],[0,0]],[[0,0],[0.45852306499999995,0.20445059000000002],[0,0]],[[0,0],[0,0],[0.09115,0.4512]]]]

Actual:   [[[[0, 0], [0, 0], [0, 0]], [[0, 0], [0.4586, 0.2045], [0, 0]], [[0, 0], [0, 0], [0.0912, 0.4512]]]]

Expected: [[[[0, 0], [0, 0], [0, 0]], [[0, 0], [0.4586, 0.2045], [0, 0]], [[0, 0], [0, 0], [0.0912, 0.4512]]]]