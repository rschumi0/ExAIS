import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc22464 = tf.keras.layers.Input(shape=([2, 2]))

Loc22464 = keras.layers.LocallyConnected1D(3, (2),strides=(1), name = 'Loc22464', )(in0Loc22464)
Glo93778 = keras.layers.GlobalMaxPool1D(name = 'Glo93778', )(Loc22464)
Res20595 = keras.layers.Reshape((3, 1), name = 'Res20595', )(Glo93778)
Res4581 = keras.layers.Reshape((3, 1, 1), name = 'Res4581', )(Res20595)
Con22079 = keras.layers.Conv2D(4, (3, 1),strides=(3, 4), padding='same', dilation_rate=(1, 1), name = 'Con22079', )(Res4581)
model = tf.keras.models.Model(inputs=[in0Loc22464], outputs=Con22079)
w = model.get_layer('Loc22464').get_weights() 
w[0] = np.array([[[0.8561, 0.8204, 0.22], [0.1084, 0.4123, 0.4988], [0.3188, 0.7383, 0.2545], [0.9637, 0.4581, 0.4747]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc22464').set_weights(w) 
w = model.get_layer('Con22079').get_weights() 
w[0] = np.array([[[[0.9534, 0.2596, 0.265, 0.7766]]], [[[0.4053, 0.1889, 0.5809, 0.1338]]], [[[0.0111, 0.6834, 0.4701, 0.5005]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con22079').set_weights(w) 
in0Loc22464 = tf.constant([[[0.3296, 0.6257], [0.4449, 0.7804]]])
print (np.array2string(model.predict([in0Loc22464],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con22079.png')

LLoc22464 = locally_connected1D_layer([[[0.3296, 0.6257], [0.4449, 0.7804]]], 2,[[[0.8561, 0.8204, 0.22], [0.1084, 0.4123, 0.4988], [0.3188, 0.7383, 0.2545], [0.9637, 0.4581, 0.4747]]],[[0, 0, 0]], 1, Loc22464), 
LGlo93778 = global_max_pool1D_layer(Loc22464, Glo93778), 
LRes20595 = reshape_layer(Glo93778, [3, 1], Res20595), 
LRes4581 = reshape_layer(Res20595, [3, 1, 1], Res4581), 
LCon22079 = conv2D_layer(Res4581, 3, 1,[[[[0.9534, 0.2596, 0.265, 0.7766]]], [[[0.4053, 0.1889, 0.5809, 0.1338]]], [[[0.0111, 0.6834, 0.4701, 0.5005]]]],[0, 0, 0, 0], 3, 4, true, 1, 1, Con22079), 
exec_layers([LLoc22464,LGlo93778,LRes20595,LRes4581,LCon22079],["Loc22464","Glo93778","Res20595","Res4581","Con22079"],Con22079,"Con22079")

Actual (Unparsed): [[[[1.6877507, 1.1457000, 1.4432355, 1.5630756]]]]

Expected (Unparsed): [[[[1.687750672893,1.1457000281440002,1.4432355068829998,1.563075661377]]]]

Actual:   [[[[1.6878, 1.1457, 1.4433, 1.5631]]]]

Expected: [[[[1.6878, 1.1458, 1.4433, 1.5631]]]]