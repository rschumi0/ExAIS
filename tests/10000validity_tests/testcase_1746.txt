import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add34204 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Add34204 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Max26306 = tf.keras.layers.Input(shape=([2, 2]))
in1Max26306 = tf.keras.layers.Input(shape=([2, 2]))
in0Con64330 = tf.keras.layers.Input(shape=([3]))

Add34204 = keras.layers.Add(name = 'Add34204', )([in0Add34204,in1Add34204])
Res47712 = keras.layers.Reshape((2, 2), name = 'Res47712', )(Add34204)
Fla20098 = keras.layers.Flatten(name = 'Fla20098', )(Res47712)
Max26306 = keras.layers.Maximum(name = 'Max26306', )([in0Max26306,in1Max26306])
GRU50172 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU50172', )(Max26306)
Con64330 = keras.layers.Concatenate(axis=1, name = 'Con64330', )([GRU50172,in0Con64330])
Sub77306 = keras.layers.Subtract(name = 'Sub77306', )([Fla20098,Con64330])
model = tf.keras.models.Model(inputs=[in0Add34204,in1Add34204,in0Max26306,in1Max26306,in0Con64330], outputs=Sub77306)
w = model.get_layer('GRU50172').get_weights() 
w[0] = np.array([[1, 2, 9], [5, 8, 1]])
w[1] = np.array([[3, 3, 4]])
w[2] = np.array([[3, 9, 5], [1, 4, 6]])
model.get_layer('GRU50172').set_weights(w) 
in0Add34204 = tf.constant([[[[0.72, 0.3698]], [[0.3637, 0.0036]]]])
in1Add34204 = tf.constant([[[[0.5228, 0.6035]], [[0.6615, 0.2102]]]])
in0Max26306 = tf.constant([[[0.6789, 0.8143], [0.5483, 0.6554]]])
in1Max26306 = tf.constant([[[0.8185, 0.923], [0.7473, 0.1317]]])
in0Con64330 = tf.constant([[0.1824, 0.993, 0.7332]])
print (np.array2string(model.predict([in0Add34204,in1Add34204,in0Max26306,in1Max26306,in0Con64330],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub77306.png')

LAdd34204 = add_layer([[[[[0.72, 0.3698]], [[0.3637, 0.0036]]]], [[[[0.5228, 0.6035]], [[0.6615, 0.2102]]]]], Add34204), 
LRes47712 = reshape_layer(Add34204, [2, 2], Res47712), 
LFla20098 = flatten_layer(Res47712, Fla20098), 
LMax26306 = maximum_layer([[[[0.6789, 0.8143], [0.5483, 0.6554]]], [[[0.8185, 0.923], [0.7473, 0.1317]]]], Max26306), 
LGRU50172 = gru_layer(Max26306,[[1, 2, 9], [5, 8, 1]],[[3, 3, 4]],[[3, 9, 5], [1, 4, 6]], true, GRU50172), 
LCon64330 = concatenate_layer([GRU50172,[[0.1824, 0.993, 0.7332]]], 1, Con64330), 
LSub77306 = subtract_layer(Fla20098,Con64330, Sub77306), 
exec_layers([LAdd34204,LRes47712,LFla20098,LMax26306,LGRU50172,LCon64330,LSub77306],["Add34204","Res47712","Fla20098","Max26306","GRU50172","Con64330","Sub77306"],Sub77306,"Sub77306")

Actual (Unparsed): [[1.2423929, 0.7909000, 0.0322000, -0.5194000]]

Expected (Unparsed): [[1.2423928103999247,0.7909,0.032199999999999895,-0.5194]]

Actual:   [[1.2424, 0.7909, 0.0322, -0.5194]]

Expected: [[1.2424, 0.7909, 0.0322, -0.5194]]