import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot17337 = tf.keras.layers.Input(shape=([3]))
in1Dot17337 = tf.keras.layers.Input(shape=([3]))
in0Con60206 = tf.keras.layers.Input(shape=([14]))
in0Sub28570 = tf.keras.layers.Input(shape=([3, 3]))
in1Sub28570 = tf.keras.layers.Input(shape=([3, 3]))
in0Min3114 = tf.keras.layers.Input(shape=([2, 1]))
in1Min3114 = tf.keras.layers.Input(shape=([2, 1]))
in0Con96864 = tf.keras.layers.Input(shape=([2, 7]))
in0Dep68980 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con44698 = tf.keras.layers.Input(shape=([14]))

Dot17337 = keras.layers.Dot(axes=(1, 1), name = 'Dot17337', )([in0Dot17337,in1Dot17337])
Res14469 = keras.layers.Reshape((1, 1), name = 'Res14469', )(Dot17337)
Up_25940 = keras.layers.UpSampling1D(size=(2), name = 'Up_25940', )(Res14469)
Fla88801 = keras.layers.Flatten(name = 'Fla88801', )(Up_25940)
Con60206 = keras.layers.Concatenate(axis=1, name = 'Con60206', )([Fla88801,in0Con60206])
Sub28570 = keras.layers.Subtract(name = 'Sub28570', )([in0Sub28570,in1Sub28570])
Res43473 = keras.layers.Reshape((3, 3, 1), name = 'Res43473', )(Sub28570)
Res52699 = keras.layers.Reshape((3, 3, 1, 1), name = 'Res52699', )(Res43473)
Con10607 = keras.layers.Conv3D(4, (2, 2, 1),strides=(1, 1, 5), padding='valid', dilation_rate=(1, 1, 1), name = 'Con10607', )(Res52699)
Res74769 = keras.layers.Reshape((2, 2, 4), name = 'Res74769', )(Con10607)
Res96698 = keras.layers.Reshape((2, 8), name = 'Res96698', )(Res74769)
Min3114 = keras.layers.Minimum(name = 'Min3114', )([in0Min3114,in1Min3114])
Con96864 = keras.layers.Concatenate(axis=2, name = 'Con96864', )([Min3114,in0Con96864])
Mul91539 = keras.layers.Multiply(name = 'Mul91539', )([Res96698,Con96864])
Fla59109 = keras.layers.Flatten(name = 'Fla59109', )(Mul91539)
Dep68980 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='same', name = 'Dep68980', )(in0Dep68980)
Glo2685 = keras.layers.GlobalMaxPool2D(name = 'Glo2685', )(Dep68980)
Con44698 = keras.layers.Concatenate(axis=1, name = 'Con44698', )([Glo2685,in0Con44698])
Max29925 = keras.layers.Maximum(name = 'Max29925', )([Fla59109,Con44698])
Ave21708 = keras.layers.Average(name = 'Ave21708', )([Con60206,Max29925])
model = tf.keras.models.Model(inputs=[in0Dot17337,in1Dot17337,in0Con60206,in0Sub28570,in1Sub28570,in0Min3114,in1Min3114,in0Con96864,in0Dep68980,in0Con44698], outputs=Ave21708)
w = model.get_layer('Con10607').get_weights() 
w[0] = np.array([[[[[0.2586, 0.1132, 0.8148, 0.1444]]], [[[0.8273, 0.1352, 0.4632, 0.8603]]]], [[[[0.8504, 0.861, 0.317, 0.3096]]], [[[0.9125, 0.363, 0.0331, 0.2437]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con10607').set_weights(w) 
w = model.get_layer('Dep68980').get_weights() 
w[0] = np.array([[[[0.9823], [0.6409]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep68980').set_weights(w) 
in0Dot17337 = tf.constant([[0.2999, 0.0714, 0.6955]])
in1Dot17337 = tf.constant([[0.425, 0.7238, 0.3475]])
in0Con60206 = tf.constant([[0.9528, 0.1851, 0.0567, 0.4547, 0.7554, 0.1742, 0.2167, 0.8026, 0.0097, 0.7887, 0.5791, 0.459, 0.4266, 0.832]])
in0Sub28570 = tf.constant([[[0.0285, 0.7961, 0.507], [0.9995, 0.936, 0.4289], [0.6069, 0.2928, 0.5015]]])
in1Sub28570 = tf.constant([[[0.0563, 0.0683, 0.5741], [0.989, 0.4124, 0.7], [0.4413, 0.6577, 0.1217]]])
in0Min3114 = tf.constant([[[0.073], [0.3811]]])
in1Min3114 = tf.constant([[[0.7964], [0.0408]]])
in0Con96864 = tf.constant([[[0.4037, 0.5402, 0.6675, 0.6986, 0.1539, 0.2089, 0.6013], [0.3636, 0.8952, 0.6084, 0.1187, 0.7104, 0.3195, 0.2316]]])
in0Dep68980 = tf.constant([[[[0.2756, 0.3629], [0.6512, 0.0675]]]])
in0Con44698 = tf.constant([[0.7227, 0.2822, 0.7296, 0.1333, 0.3681, 0.2621, 0.6801, 0.6417, 0.7178, 0.439, 0.2185, 0.9165, 0.5126, 0.7205]])
print (np.array2string(model.predict([in0Dot17337,in1Dot17337,in0Con60206,in0Sub28570,in1Sub28570,in0Min3114,in1Min3114,in0Con96864,in0Dep68980,in0Con44698],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave21708.png')

LDot17337 = dot_layer([[0.2999, 0.0714, 0.6955]], [[0.425, 0.7238, 0.3475]], 1, 1, Dot17337), 
LRes14469 = reshape_layer(Dot17337, [1, 1], Res14469), 
LUp_25940 = up_sampling1D_layer(Res14469, 2, Up_25940), 
LFla88801 = flatten_layer(Up_25940, Fla88801), 
LCon60206 = concatenate_layer([Fla88801,[[0.9528, 0.1851, 0.0567, 0.4547, 0.7554, 0.1742, 0.2167, 0.8026, 0.0097, 0.7887, 0.5791, 0.459, 0.4266, 0.832]]], 1, Con60206), 
LSub28570 = subtract_layer([[[0.0285, 0.7961, 0.507], [0.9995, 0.936, 0.4289], [0.6069, 0.2928, 0.5015]]], [[[0.0563, 0.0683, 0.5741], [0.989, 0.4124, 0.7], [0.4413, 0.6577, 0.1217]]], Sub28570), 
LRes43473 = reshape_layer(Sub28570, [3, 3, 1], Res43473), 
LRes52699 = reshape_layer(Res43473, [3, 3, 1, 1], Res52699), 
LCon10607 = conv3D_layer(Res52699, 2, 2, 1,[[[[[0.2586, 0.1132, 0.8148, 0.1444]]], [[[0.8273, 0.1352, 0.4632, 0.8603]]]], [[[[0.8504, 0.861, 0.317, 0.3096]]], [[[0.9125, 0.363, 0.0331, 0.2437]]]]],[0, 0, 0, 0], 1, 1, 5, false, 1, 1, 1, Con10607), 
LRes74769 = reshape_layer(Con10607, [2, 2, 4], Res74769), 
LRes96698 = reshape_layer(Res74769, [2, 8], Res96698), 
LMin3114 = minimum_layer([[[[0.073], [0.3811]]], [[[0.7964], [0.0408]]]], Min3114), 
LCon96864 = concatenate_layer([Min3114,[[[0.4037, 0.5402, 0.6675, 0.6986, 0.1539, 0.2089, 0.6013], [0.3636, 0.8952, 0.6084, 0.1187, 0.7104, 0.3195, 0.2316]]]], 2, Con96864), 
LMul91539 = multiply_layer([Res96698,Con96864], Mul91539), 
LFla59109 = flatten_layer(Mul91539, Fla59109), 
LDep68980 = depthwise_conv2D_layer([[[[0.2756, 0.3629], [0.6512, 0.0675]]]], 1, 1,[[[[0.9823], [0.6409]]]],[0, 0], 1, 1, true, Dep68980), 
LGlo2685 = global_max_pool2D_layer(Dep68980, Glo2685), 
LCon44698 = concatenate_layer([Glo2685,[[0.7227, 0.2822, 0.7296, 0.1333, 0.3681, 0.2621, 0.6801, 0.6417, 0.7178, 0.439, 0.2185, 0.9165, 0.5126, 0.7205]]], 1, Con44698), 
LMax29925 = maximum_layer([Fla59109,Con44698], Max29925), 
LAve21708 = average_layer([Con60206,Max29925], Ave21708), 
exec_layers([LDot17337,LRes14469,LUp_25940,LFla88801,LCon60206,LSub28570,LRes43473,LRes52699,LCon10607,LRes74769,LRes96698,LMin3114,LCon96864,LMul91539,LFla59109,LDep68980,LGlo2685,LCon44698,LMax29925,LAve21708],["Dot17337","Res14469","Up_25940","Fla88801","Con60206","Sub28570","Res43473","Res52699","Con10607","Res74769","Res96698","Min3114","Con96864","Mul91539","Fla59109","Dep68980","Glo2685","Con44698","Max29925","Ave21708"],Ave21708,"Ave21708")

Actual (Unparsed): [[0.5302484, 0.3267028, 0.8377500, 0.3438518, 0.3931500, 0.2940000, 0.5617500, 0.2181500, 0.4484000, 0.7221500, 0.3637500, 0.6138500, 0.3988000, 0.6877500, 0.4696000, 0.7762500]]

Expected (Unparsed): [[0.530248415,0.32670284,0.83775,0.34385178172499997,0.39315,0.294,0.56175,0.21815,0.4484,0.7221500000000001,0.36375,0.61385,0.3988,0.68775,0.46959999999999996,0.77625]]

Actual:   [[0.5303, 0.3268, 0.8378, 0.3439, 0.3932, 0.294, 0.5618, 0.2182, 0.4484, 0.7222, 0.3638, 0.6139, 0.3988, 0.6878, 0.4696, 0.7763]]

Expected: [[0.5303, 0.3268, 0.8378, 0.3439, 0.3932, 0.294, 0.5618, 0.2182, 0.4484, 0.7222, 0.3638, 0.6139, 0.3988, 0.6878, 0.4696, 0.7763]]