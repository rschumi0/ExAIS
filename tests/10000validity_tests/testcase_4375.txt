import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Up_85695 = tf.keras.layers.Input(shape=([4, 3, 4]))

Up_85695 = keras.layers.UpSampling2D(size=(1, 1), name = 'Up_85695', )(in0Up_85695)
Res20104 = keras.layers.Reshape((4, 12), name = 'Res20104', )(Up_85695)
Sim31586 = keras.layers.SimpleRNN(3,name = 'Sim31586', )(Res20104)
Res5381 = keras.layers.Reshape((3, 1), name = 'Res5381', )(Sim31586)
GRU44005 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU44005', )(Res5381)
model = tf.keras.models.Model(inputs=[in0Up_85695], outputs=GRU44005)
w = model.get_layer('Sim31586').get_weights() 
w[0] = np.array([[5, 9, 4], [4, 5, 9], [9, 2, 9], [6, 6, 9], [5, 1, 3], [1, 9, 8], [2, 3, 3], [10, 10, 1], [1, 5, 6], [8, 6, 8], [2, 2, 3], [8, 9, 7]])
w[1] = np.array([[10, 7, 8], [8, 6, 5], [9, 3, 2]])
w[2] = np.array([6, 3, 1])
model.get_layer('Sim31586').set_weights(w) 
w = model.get_layer('GRU44005').get_weights() 
w[0] = np.array([[9, 7, 2, 9, 9, 3]])
w[1] = np.array([[1, 2, 7, 5, 6, 3], [9, 10, 7, 3, 1, 7]])
w[2] = np.array([4, 7, 10, 4, 6, 6])
model.get_layer('GRU44005').set_weights(w) 
in0Up_85695 = tf.constant([[[[1.4093, 1.8079, 1.3645, 1.1427], [1.8558, 1.1623, 1.736, 1.8231], [1.641, 1.575, 1.0302, 1.8123]], [[1.7892, 1.6511, 1.0189, 1.0095], [1.1261, 1.3508, 1.1419, 1.6917], [1.7696, 1.2098, 1.9046, 1.6775]], [[1.7583, 1.9058, 1.6684, 1.8633], [1.7311, 1.3272, 1.464, 1.0564], [1.3903, 1.0307, 1.1731, 1.2804]], [[1.3358, 1.9967, 1.6638, 1.7605], [1.7412, 1.8838, 1.2426, 1.6087], [1.2549, 1.5676, 1.0884, 1.8246]]]])
print (np.array2string(model.predict([in0Up_85695],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU44005.png')

LUp_85695 = up_sampling2D_layer([[[[1.4093, 1.8079, 1.3645, 1.1427], [1.8558, 1.1623, 1.736, 1.8231], [1.641, 1.575, 1.0302, 1.8123]], [[1.7892, 1.6511, 1.0189, 1.0095], [1.1261, 1.3508, 1.1419, 1.6917], [1.7696, 1.2098, 1.9046, 1.6775]], [[1.7583, 1.9058, 1.6684, 1.8633], [1.7311, 1.3272, 1.464, 1.0564], [1.3903, 1.0307, 1.1731, 1.2804]], [[1.3358, 1.9967, 1.6638, 1.7605], [1.7412, 1.8838, 1.2426, 1.6087], [1.2549, 1.5676, 1.0884, 1.8246]]]], 1, 1, Up_85695), 
LRes20104 = reshape_layer(Up_85695, [4, 12], Res20104), 
LSim31586 = simple_rnn_layer(Res20104,[[5, 9, 4], [4, 5, 9], [9, 2, 9], [6, 6, 9], [5, 1, 3], [1, 9, 8], [2, 3, 3], [10, 10, 1], [1, 5, 6], [8, 6, 8], [2, 2, 3], [8, 9, 7]],[[10, 7, 8], [8, 6, 5], [9, 3, 2]],[6, 3, 1], Sim31586), 
LRes5381 = reshape_layer(Sim31586, [3, 1], Res5381), 
LGRU44005 = gru_layer(Res5381,[[9, 7, 2, 9, 9, 3]],[[1, 2, 7, 5, 6, 3], [9, 10, 7, 3, 1, 7]],[4, 7, 10, 4, 6, 6], false, GRU44005), 
exec_layers([LUp_85695,LRes20104,LSim31586,LRes5381,LGRU44005],["Up_85695","Res20104","Sim31586","Res5381","GRU44005"],GRU44005,"GRU44005")

Actual (Unparsed): [[0.0000068, 0.0000025]]

Expected (Unparsed): [[6.780891493491749e-6,2.4945499131142907e-6]]

Actual:   [[0, 0]]

Expected: [[0, 0]]