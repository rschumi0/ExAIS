import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub55574 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub55574 = tf.keras.layers.Input(shape=([2, 2]))
in0Add52109 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Add52109 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con77739 = tf.keras.layers.Input(shape=([2]))
in0Sub52075 = tf.keras.layers.Input(shape=([3]))
in1Sub52075 = tf.keras.layers.Input(shape=([3]))
in0Con23984 = tf.keras.layers.Input(shape=([1]))

Sub55574 = keras.layers.Subtract(name = 'Sub55574', )([in0Sub55574,in1Sub55574])
Fla20708 = keras.layers.Flatten(name = 'Fla20708', )(Sub55574)
Add52109 = keras.layers.Add(name = 'Add52109', )([in0Add52109,in1Add52109])
Res26928 = keras.layers.Reshape((2, 2), name = 'Res26928', )(Add52109)
Sim11899 = keras.layers.SimpleRNN(2,name = 'Sim11899', )(Res26928)
Con77739 = keras.layers.Concatenate(axis=1, name = 'Con77739', )([Sim11899,in0Con77739])
Mul7935 = keras.layers.Multiply(name = 'Mul7935', )([Fla20708,Con77739])
Sub52075 = keras.layers.Subtract(name = 'Sub52075', )([in0Sub52075,in1Sub52075])
Con23984 = keras.layers.Concatenate(axis=1, name = 'Con23984', )([Sub52075,in0Con23984])
Add4655 = keras.layers.Add(name = 'Add4655', )([Mul7935,Con23984])
Res48441 = keras.layers.Reshape((4, 1), name = 'Res48441', )(Add4655)
Res65262 = keras.layers.Reshape((4, 1, 1), name = 'Res65262', )(Res48441)
Loc15519 = keras.layers.LocallyConnected2D(3, (3, 1),strides=(1, 1), name = 'Loc15519', )(Res65262)
model = tf.keras.models.Model(inputs=[in0Sub55574,in1Sub55574,in0Add52109,in1Add52109,in0Con77739,in0Sub52075,in1Sub52075,in0Con23984], outputs=Loc15519)
w = model.get_layer('Sim11899').get_weights() 
w[0] = np.array([[5, 5], [8, 4]])
w[1] = np.array([[10, 3], [9, 6]])
w[2] = np.array([10, 9])
model.get_layer('Sim11899').set_weights(w) 
w = model.get_layer('Loc15519').get_weights() 
w[0] = np.array([[[0.9396, 0.4077, 0.6606], [0.062, 0.5358, 0.9588], [0.0142, 0.3395, 0.9672]], [[0.8323, 0.4666, 0.6307], [0.4751, 0.4613, 0.79], [0.0565, 0.2772, 0.1117]]])
w[1] = np.array([[[0, 0, 0]], [[0, 0, 0]]])
model.get_layer('Loc15519').set_weights(w) 
in0Sub55574 = tf.constant([[[0.0105, 0.4815], [0.6303, 0.7881]]])
in1Sub55574 = tf.constant([[[0.8589, 0.4874], [0.1281, 0.8523]]])
in0Add52109 = tf.constant([[[[0.3703, 0.4734]], [[0.8005, 0.4612]]]])
in1Add52109 = tf.constant([[[[0.8621, 0.3718]], [[0.6626, 0.8416]]]])
in0Con77739 = tf.constant([[0.6823, 0.0668]])
in0Sub52075 = tf.constant([[0.4507, 0.026, 0.7657]])
in1Sub52075 = tf.constant([[0.0501, 0.8368, 0.3928]])
in0Con23984 = tf.constant([[0.8461]])
print (np.array2string(model.predict([in0Sub55574,in1Sub55574,in0Add52109,in1Add52109,in0Con77739,in0Sub52075,in1Sub52075,in0Con23984],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc15519.png')

LSub55574 = subtract_layer([[[0.0105, 0.4815], [0.6303, 0.7881]]], [[[0.8589, 0.4874], [0.1281, 0.8523]]], Sub55574), 
LFla20708 = flatten_layer(Sub55574, Fla20708), 
LAdd52109 = add_layer([[[[[0.3703, 0.4734]], [[0.8005, 0.4612]]]], [[[[0.8621, 0.3718]], [[0.6626, 0.8416]]]]], Add52109), 
LRes26928 = reshape_layer(Add52109, [2, 2], Res26928), 
LSim11899 = simple_rnn_layer(Res26928,[[5, 5], [8, 4]],[[10, 3], [9, 6]],[10, 9], Sim11899), 
LCon77739 = concatenate_layer([Sim11899,[[0.6823, 0.0668]]], 1, Con77739), 
LMul7935 = multiply_layer([Fla20708,Con77739], Mul7935), 
LSub52075 = subtract_layer([[0.4507, 0.026, 0.7657]], [[0.0501, 0.8368, 0.3928]], Sub52075), 
LCon23984 = concatenate_layer([Sub52075,[[0.8461]]], 1, Con23984), 
LAdd4655 = add_layer([Mul7935,Con23984], Add4655), 
LRes48441 = reshape_layer(Add4655, [4, 1], Res48441), 
LRes65262 = reshape_layer(Res48441, [4, 1, 1], Res65262), 
LLoc15519 = locally_connected2D_layer(Res65262, 3, 1,[[[0.9396, 0.4077, 0.6606], [0.062, 0.5358, 0.9588], [0.0142, 0.3395, 0.9672]], [[0.8323, 0.4666, 0.6307], [0.4751, 0.4613, 0.79], [0.0565, 0.2772, 0.1117]]],[[[0, 0, 0]], [[0, 0, 0]]], 1, 1, Loc15519), 
exec_layers([LSub55574,LFla20708,LAdd52109,LRes26928,LSim11899,LCon77739,LMul7935,LSub52075,LCon23984,LAdd4655,LRes48441,LRes65262,LLoc15519],["Sub55574","Fla20708","Add52109","Res26928","Sim11899","Con77739","Mul7935","Sub52075","Con23984","Add4655","Res48441","Res65262","Loc15519"],Loc15519,"Loc15519")

Actual (Unparsed): [[[[-0.4612274, -0.3772263, -0.3867877]], [[-0.2922188, 0.1823616, 0.1442230]]]]

Expected (Unparsed): [[[[-0.46122745494800005,-0.37722633513000003,-0.3867876547679999]],[[-0.29221875503399997,0.18236161514600005,0.14422298524800006]]]]

Actual:   [[[[-0.4612, -0.3772, -0.3867]], [[-0.2922, 0.1824, 0.1443]]]]

Expected: [[[[-0.4612, -0.3772, -0.3867]], [[-0.2922, 0.1824, 0.1443]]]]