import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Lay51322 = tf.keras.layers.Input(shape=([4, 2]))
in0Con50281 = tf.keras.layers.Input(shape=([1, 1]))
in0Ave25236 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave25236 = tf.keras.layers.Input(shape=([2, 1]))
in0Mul32173 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Mul32173 = tf.keras.layers.Input(shape=([1, 2, 1]))

Lay51322 = keras.layers.LayerNormalization(axis=2, epsilon=1.8374719697343613, name = 'Lay51322', )(in0Lay51322)
Loc56056 = keras.layers.LocallyConnected1D(2, (4),strides=(1), name = 'Loc56056', )(Lay51322)
Con50281 = keras.layers.Concatenate(axis=2, name = 'Con50281', )([Loc56056,in0Con50281])
Ave25236 = keras.layers.Average(name = 'Ave25236', )([in0Ave25236,in1Ave25236])
Res58965 = keras.layers.Reshape((2, 1, 1), name = 'Res58965', )(Ave25236)
Zer90092 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer90092', )(Res58965)
Mul32173 = keras.layers.Multiply(name = 'Mul32173', )([in0Mul32173,in1Mul32173])
Zer94176 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer94176', )(Mul32173)
Max17417 = keras.layers.Maximum(name = 'Max17417', )([Zer90092,Zer94176])
Res57075 = keras.layers.Reshape((2, 3), name = 'Res57075', )(Max17417)
Zer15640 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer15640', )(Res57075)
Dot68423 = keras.layers.Dot(axes=(2, 2), name = 'Dot68423', )([Con50281,Zer15640])
Res67360 = keras.layers.Reshape((1, 3, 1), name = 'Res67360', )(Dot68423)
Max8451 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max8451', )(Res67360)
model = tf.keras.models.Model(inputs=[in0Lay51322,in0Con50281,in0Ave25236,in1Ave25236,in0Mul32173,in1Mul32173], outputs=Max8451)
w = model.get_layer('Loc56056').get_weights() 
w[0] = np.array([[[0.2749, 0.8998], [0.1956, 0.0735], [0.7969, 0.7334], [0.0573, 0.3429], [0.2468, 0.3045], [0.662, 0.0685], [0.8202, 0.6992], [0.0719, 0.4472]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc56056').set_weights(w) 
in0Lay51322 = tf.constant([[[1.8995, 1.5951], [1.9076, 1.2191], [1.653, 1.0996], [1.4982, 1.2158]]])
in0Con50281 = tf.constant([[[0.8278]]])
in0Ave25236 = tf.constant([[[0.5933], [0.9654]]])
in1Ave25236 = tf.constant([[[0.8751], [0.1194]]])
in0Mul32173 = tf.constant([[[[0.6628], [0.1837]]]])
in1Mul32173 = tf.constant([[[[0.2516], [0.8764]]]])
print (np.array2string(model.predict([in0Lay51322,in0Con50281,in0Ave25236,in1Ave25236,in0Mul32173,in1Mul32173],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max8451.png')

LLay51322 = layer_normalization_layer([[[1.8995, 1.5951], [1.9076, 1.2191], [1.653, 1.0996], [1.4982, 1.2158]]], 2, 1.8374719697343613, Lay51322), 
LLoc56056 = locally_connected1D_layer(Lay51322, 4,[[[0.2749, 0.8998], [0.1956, 0.0735], [0.7969, 0.7334], [0.0573, 0.3429], [0.2468, 0.3045], [0.662, 0.0685], [0.8202, 0.6992], [0.0719, 0.4472]]],[[0, 0]], 1, Loc56056), 
LCon50281 = concatenate_layer([Loc56056,[[[0.8278]]]], 2, Con50281), 
LAve25236 = average_layer([[[[0.5933], [0.9654]]], [[[0.8751], [0.1194]]]], Ave25236), 
LRes58965 = reshape_layer(Ave25236, [2, 1, 1], Res58965), 
LZer90092 = zero_padding2D_layer(Res58965, 0, 0, 2, 0, Zer90092), 
LMul32173 = multiply_layer([[[[[0.6628], [0.1837]]]], [[[[0.2516], [0.8764]]]]], Mul32173), 
LZer94176 = zero_padding2D_layer(Mul32173, 1, 0, 1, 0, Zer94176), 
LMax17417 = maximum_layer([Zer90092,Zer94176], Max17417), 
LRes57075 = reshape_layer(Max17417, [2, 3], Res57075), 
LZer15640 = zero_padding1D_layer(Res57075, 1, 0, Zer15640), 
LDot68423 = dot_layer(Con50281,Zer15640, 2, 2, Dot68423), 
LRes67360 = reshape_layer(Dot68423, [1, 3, 1], Res67360), 
LMax8451 = max_pool2D_layer(Res67360, 1, 1, Max8451), 
exec_layers([LLay51322,LLoc56056,LCon50281,LAve25236,LRes58965,LZer90092,LMul32173,LZer94176,LMax17417,LRes57075,LZer15640,LDot68423,LRes67360,LMax8451],["Lay51322","Loc56056","Con50281","Ave25236","Res58965","Zer90092","Mul32173","Zer94176","Max17417","Res57075","Zer15640","Dot68423","Res67360","Max8451"],Max8451,"Max8451")

Actual (Unparsed): [[[[0.0000000], [0.6077707], [0.4926277]]]]

Expected (Unparsed): [[[[0.0],[0.60777076],[0.4926277198101817]]]]

Actual:   [[[[0], [0.6078], [0.4927]]]]

Expected: [[[[0], [0.6078], [0.4927]]]]