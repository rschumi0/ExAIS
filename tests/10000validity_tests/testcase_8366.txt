import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave68210 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave68210 = tf.keras.layers.Input(shape=([1, 2]))
in0Dot89163 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot89163 = tf.keras.layers.Input(shape=([2, 3]))
in0Max80642 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Max80642 = tf.keras.layers.Input(shape=([2, 1, 1]))

Ave68210 = keras.layers.Average(name = 'Ave68210', )([in0Ave68210,in1Ave68210])
Res21212 = keras.layers.Reshape((1, 2, 1), name = 'Res21212', )(Ave68210)
Glo83946 = keras.layers.GlobalAveragePooling2D(name = 'Glo83946', )(Res21212)
Res85066 = keras.layers.Reshape((1, 1), name = 'Res85066', )(Glo83946)
Res90099 = keras.layers.Reshape((1, 1, 1), name = 'Res90099', )(Res85066)
Zer2702 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer2702', )(Res90099)
Dot89163 = keras.layers.Dot(axes=(2, 2), name = 'Dot89163', )([in0Dot89163,in1Dot89163])
Res92524 = keras.layers.Reshape((2, 2, 1), name = 'Res92524', )(Dot89163)
Max80642 = keras.layers.Maximum(name = 'Max80642', )([in0Max80642,in1Max80642])
Zer98302 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer98302', )(Max80642)
Sub89649 = keras.layers.Subtract(name = 'Sub89649', )([Res92524,Zer98302])
Max51189 = keras.layers.Maximum(name = 'Max51189', )([Zer2702,Sub89649])
model = tf.keras.models.Model(inputs=[in0Ave68210,in1Ave68210,in0Dot89163,in1Dot89163,in0Max80642,in1Max80642], outputs=Max51189)
in0Ave68210 = tf.constant([[[0.0978, 0.669]]])
in1Ave68210 = tf.constant([[[0.8977, 0.0335]]])
in0Dot89163 = tf.constant([[[0.7784, 0.6424, 0.0089], [0.0065, 0.1852, 0.5072]]])
in1Dot89163 = tf.constant([[[0.6514, 0.3398, 0.1129], [0.7808, 0.3105, 0.6852]]])
in0Max80642 = tf.constant([[[[0.861]], [[0.6557]]]])
in1Max80642 = tf.constant([[[[0.9303]], [[0.054]]]])
print (np.array2string(model.predict([in0Ave68210,in1Ave68210,in0Dot89163,in1Dot89163,in0Max80642,in1Max80642],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max51189.png')

LAve68210 = average_layer([[[[0.0978, 0.669]]], [[[0.8977, 0.0335]]]], Ave68210), 
LRes21212 = reshape_layer(Ave68210, [1, 2, 1], Res21212), 
LGlo83946 = global_average_pooling2D_layer(Res21212, Glo83946), 
LRes85066 = reshape_layer(Glo83946, [1, 1], Res85066), 
LRes90099 = reshape_layer(Res85066, [1, 1, 1], Res90099), 
LZer2702 = zero_padding2D_layer(Res90099, 1, 0, 1, 0, Zer2702), 
LDot89163 = dot_layer([[[0.7784, 0.6424, 0.0089], [0.0065, 0.1852, 0.5072]]], [[[0.6514, 0.3398, 0.1129], [0.7808, 0.3105, 0.6852]]], 2, 2, Dot89163), 
LRes92524 = reshape_layer(Dot89163, [2, 2, 1], Res92524), 
LMax80642 = maximum_layer([[[[[0.861]], [[0.6557]]]], [[[[0.9303]], [[0.054]]]]], Max80642), 
LZer98302 = zero_padding2D_layer(Max80642, 0, 0, 1, 0, Zer98302), 
LSub89649 = subtract_layer(Res92524,Zer98302, Sub89649), 
LMax51189 = maximum_layer([Zer2702,Sub89649], Max51189), 
exec_layers([LAve68210,LRes21212,LGlo83946,LRes85066,LRes90099,LZer2702,LDot89163,LRes92524,LMax80642,LZer98302,LSub89649,LMax51189],["Ave68210","Res21212","Glo83946","Res85066","Res90099","Zer2702","Dot89163","Res92524","Max80642","Zer98302","Sub89649","Max51189"],Max51189,"Max51189")

Actual (Unparsed): [[[[0.7263421], [0.0000000]], [[0.1244279], [0.4245000]]]]

Expected (Unparsed): [[[[0.7263420899999999],[0]],[[0.12442793999999999],[0.4245]]]]

Actual:   [[[[0.7264], [0]], [[0.1245], [0.4245]]]]

Expected: [[[[0.7264], [0]], [[0.1245], [0.4245]]]]