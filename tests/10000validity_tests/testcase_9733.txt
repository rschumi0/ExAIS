import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Bat67582 = tf.keras.layers.Input(shape=([3, 1, 1]))
in0Con57748 = tf.keras.layers.Input(shape=([3, 1, 1, 3]))
in0Con12751 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Add9757 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Add9757 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con49591 = tf.keras.layers.Input(shape=([3, 3, 2]))
in0Max33765 = tf.keras.layers.Input(shape=([2, 1]))
in1Max33765 = tf.keras.layers.Input(shape=([2, 1]))

Bat67582 = keras.layers.BatchNormalization(axis=3, epsilon=0.3957708501412426,  name = 'Bat67582', )(in0Bat67582)
Res95305 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res95305', )(Bat67582)
Con57748 = keras.layers.Concatenate(axis=4, name = 'Con57748', )([Res95305,in0Con57748])
Con12751 = keras.layers.Conv3D(4, (1, 1, 1),strides=(1, 5, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con12751', )(in0Con12751)
Zer41042 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (0, 0)), name = 'Zer41042', )(Con12751)
Add34139 = keras.layers.Add(name = 'Add34139', )([Con57748,Zer41042])
Res99213 = keras.layers.Reshape((3, 1, 4), name = 'Res99213', )(Add34139)
Zer89441 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer89441', )(Res99213)
Add9757 = keras.layers.Add(name = 'Add9757', )([in0Add9757,in1Add9757])
Zer24726 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer24726', )(Add9757)
Con49591 = keras.layers.Concatenate(axis=3, name = 'Con49591', )([Zer24726,in0Con49591])
Sub21828 = keras.layers.Subtract(name = 'Sub21828', )([Zer89441,Con49591])
Res98547 = keras.layers.Reshape((3, 12), name = 'Res98547', )(Sub21828)
Glo72203 = keras.layers.GlobalAveragePooling1D(name = 'Glo72203', )(Res98547)
Res15112 = keras.layers.Reshape((12, 1), name = 'Res15112', )(Glo72203)
Max33765 = keras.layers.Maximum(name = 'Max33765', )([in0Max33765,in1Max33765])
Zer75430 = keras.layers.ZeroPadding1D(padding=((10, 0)), name = 'Zer75430', )(Max33765)
Sub24221 = keras.layers.Subtract(name = 'Sub24221', )([Res15112,Zer75430])
model = tf.keras.models.Model(inputs=[in0Bat67582,in0Con57748,in0Con12751,in0Add9757,in1Add9757,in0Con49591,in0Max33765,in1Max33765], outputs=Sub24221)
w = model.get_layer('Bat67582').get_weights() 
w[0] = np.array([0.8771])
w[1] = np.array([0.4546])
w[2] = np.array([0.7219])
w[3] = np.array([0.1355])
model.get_layer('Bat67582').set_weights(w) 
w = model.get_layer('Con12751').get_weights() 
w[0] = np.array([[[[[0.0414, 0.4258, 0.7388, 0.7736], [0.6531, 0.1488, 0.0674, 0.4256]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con12751').set_weights(w) 
in0Bat67582 = tf.constant([[[[1.2768]], [[1.8075]], [[1.5994]]]])
in0Con57748 = tf.constant([[[[[0.0135, 0.9383, 0.1397]]], [[[0.0622, 0.4827, 0.0418]]], [[[0.1552, 0.84, 0.2567]]]]])
in0Con12751 = tf.constant([[[[[0.1037, 0.3258]], [[0.6986, 0.9864]]], [[[0.7051, 0.8891]], [[0.3706, 0.9521]]]]])
in0Add9757 = tf.constant([[[[0.7835, 0.0474], [0.6834, 0.5239]], [[0.1886, 0.2765], [0.6353, 0.2112]]]])
in1Add9757 = tf.constant([[[[0.442, 0.7283], [0.3036, 0.3764]], [[0.4969, 0.7858], [0.3675, 0.4974]]]])
in0Con49591 = tf.constant([[[[0.9468, 0.909], [0.6934, 0.7463], [0.4041, 0.3951]], [[0.5265, 0.2533], [0.7069, 0.1366], [0.5497, 0.1286]], [[0.537, 0.8928], [0.122, 0.8243], [0.2178, 0.7515]]]])
in0Max33765 = tf.constant([[[0.5097], [0.1802]]])
in1Max33765 = tf.constant([[[0.8641], [0.7653]]])
print (np.array2string(model.predict([in0Bat67582,in0Con57748,in0Con12751,in0Add9757,in1Add9757,in0Con49591,in0Max33765,in1Max33765],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub24221.png')

LBat67582 = batch_normalization_layer([[[[1.2768]], [[1.8075]], [[1.5994]]]], 3, 0.3957708501412426, [0.8771], [0.4546], [0.7219], [0.1355], Bat67582), 
LRes95305 = reshape_layer(Bat67582, [3, 1, 1, 1], Res95305), 
LCon57748 = concatenate_layer([Res95305,[[[[[0.0135, 0.9383, 0.1397]]], [[[0.0622, 0.4827, 0.0418]]], [[[0.1552, 0.84, 0.2567]]]]]], 4, Con57748), 
LCon12751 = conv3D_layer([[[[[0.1037, 0.3258]], [[0.6986, 0.9864]]], [[[0.7051, 0.8891]], [[0.3706, 0.9521]]]]], 1, 1, 1,[[[[[0.0414, 0.4258, 0.7388, 0.7736], [0.6531, 0.1488, 0.0674, 0.4256]]]]],[0, 0, 0, 0], 1, 5, 1, false, 1, 1, 1, Con12751), 
LZer41042 = zero_padding3D_layer(Con12751, 1, 0, 0, 0, 0, 0, Zer41042), 
LAdd34139 = add_layer([Con57748,Zer41042], Add34139), 
LRes99213 = reshape_layer(Add34139, [3, 1, 4], Res99213), 
LZer89441 = zero_padding2D_layer(Res99213, 0, 0, 2, 0, Zer89441), 
LAdd9757 = add_layer([[[[[0.7835, 0.0474], [0.6834, 0.5239]], [[0.1886, 0.2765], [0.6353, 0.2112]]]], [[[[0.442, 0.7283], [0.3036, 0.3764]], [[0.4969, 0.7858], [0.3675, 0.4974]]]]], Add9757), 
LZer24726 = zero_padding2D_layer(Add9757, 1, 0, 1, 0, Zer24726), 
LCon49591 = concatenate_layer([Zer24726,[[[[0.9468, 0.909], [0.6934, 0.7463], [0.4041, 0.3951]], [[0.5265, 0.2533], [0.7069, 0.1366], [0.5497, 0.1286]], [[0.537, 0.8928], [0.122, 0.8243], [0.2178, 0.7515]]]]], 3, Con49591), 
LSub21828 = subtract_layer(Zer89441,Con49591, Sub21828), 
LRes98547 = reshape_layer(Sub21828, [3, 12], Res98547), 
LGlo72203 = global_average_pooling1D_layer(Res98547, Glo72203), 
LRes15112 = reshape_layer(Glo72203, [12, 1], Res15112), 
LMax33765 = maximum_layer([[[[0.5097], [0.1802]]], [[[0.8641], [0.7653]]]], Max33765), 
LZer75430 = zero_padding1D_layer(Max33765, 10, 0, Zer75430), 
LSub24221 = subtract_layer(Res15112,Zer75430, Sub24221), 
exec_layers([LBat67582,LRes95305,LCon57748,LCon12751,LZer41042,LAdd34139,LRes99213,LZer89441,LAdd9757,LZer24726,LCon49591,LSub21828,LRes98547,LGlo72203,LRes15112,LMax33765,LZer75430,LSub24221],["Bat67582","Res95305","Con57748","Con12751","Zer41042","Add34139","Res99213","Zer89441","Add9757","Zer24726","Con49591","Sub21828","Res98547","Glo72203","Res15112","Max33765","Zer75430","Sub24221"],Sub24221,"Sub24221")

Actual (Unparsed): [[[0.0000000], [0.0000000], [-0.6701000], [-0.6850333], [-0.6370000], [-0.6126666], [-0.5074333], [-0.5690667], [1.0769884], [-0.2842786], [-0.2744914], [-0.6633836]]]

Expected (Unparsed): [[[0],[0],[-0.6701],[-0.6850333333333335],[-0.637],[-0.6126666666666667],[-0.5074333333333333],[-0.5690666666666667],[1.076988304593159],[-0.28427861333333343],[-0.27449143333333326],[-0.6633836266666667]]]

Actual:   [[[0], [0], [-0.6701], [-0.685], [-0.637], [-0.6126], [-0.5074], [-0.569], [1.077], [-0.2842], [-0.2744], [-0.6633]]]

Expected: [[[0], [0], [-0.6701], [-0.685], [-0.637], [-0.6126], [-0.5074], [-0.569], [1.077], [-0.2842], [-0.2744], [-0.6633]]]