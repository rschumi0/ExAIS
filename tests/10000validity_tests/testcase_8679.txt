import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave92638 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Ave92638 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Mul89492 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Mul89492 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Add3627 = tf.keras.layers.Input(shape=([1, 2]))
in1Add3627 = tf.keras.layers.Input(shape=([1, 2]))

Ave92638 = keras.layers.Average(name = 'Ave92638', )([in0Ave92638,in1Ave92638])
Res54841 = keras.layers.Reshape((2, 1), name = 'Res54841', )(Ave92638)
Loc65340 = keras.layers.LocallyConnected1D(2, (1),strides=(1), name = 'Loc65340', )(Res54841)
Res75522 = keras.layers.Reshape((2, 2, 1), name = 'Res75522', )(Loc65340)
Mul89492 = keras.layers.Multiply(name = 'Mul89492', )([in0Mul89492,in1Mul89492])
Res90685 = keras.layers.Reshape((2, 2), name = 'Res90685', )(Mul89492)
Per48688 = keras.layers.Permute((2,1), name = 'Per48688',)(Res90685)
Res85251 = keras.layers.Reshape((2, 2, 1), name = 'Res85251', )(Per48688)
Res54991 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res54991', )(Res85251)
Cro27913 = keras.layers.Cropping3D(cropping=((0, 0), (1, 0), (0, 0)), name = 'Cro27913', )(Res54991)
Res48640 = keras.layers.Reshape((2, 1, 1), name = 'Res48640', )(Cro27913)
Add3627 = keras.layers.Add(name = 'Add3627', )([in0Add3627,in1Add3627])
Sep95185 = keras.layers.SeparableConv1D(2, (1),strides=(1), padding='valid', name = 'Sep95185', )(Add3627)
Res91900 = keras.layers.Reshape((2, 1, 1), name = 'Res91900', )(Sep95185)
Max60671 = keras.layers.Maximum(name = 'Max60671', )([Res48640,Res91900])
Zer24892 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer24892', )(Max60671)
Sub88886 = keras.layers.Subtract(name = 'Sub88886', )([Res75522,Zer24892])
model = tf.keras.models.Model(inputs=[in0Ave92638,in1Ave92638,in0Mul89492,in1Mul89492,in0Add3627,in1Add3627], outputs=Sub88886)
w = model.get_layer('Loc65340').get_weights() 
w[0] = np.array([[[0.5487, 0.6343]], [[0.2619, 0.3288]]])
w[1] = np.array([[0, 0], [0, 0]])
model.get_layer('Loc65340').set_weights(w) 
w = model.get_layer('Sep95185').get_weights() 
w[0] = np.array([[[0.9292], [0.8078]]])
w[1] = np.array([[[0.5245, 0.1832], [0.289, 0.3945]]])
w[2] = np.array([0, 0])
model.get_layer('Sep95185').set_weights(w) 
in0Ave92638 = tf.constant([[[[0.9623]], [[0.1182]]]])
in1Ave92638 = tf.constant([[[[0.3084]], [[0.4047]]]])
in0Mul89492 = tf.constant([[[[0.96], [0.6041]], [[0.6719], [0.1819]]]])
in1Mul89492 = tf.constant([[[[0.4128], [0.9226]], [[0.3001], [0.5824]]]])
in0Add3627 = tf.constant([[[0.2472, 0.5549]]])
in1Add3627 = tf.constant([[[0.4776, 0.8887]]])
print (np.array2string(model.predict([in0Ave92638,in1Ave92638,in0Mul89492,in1Mul89492,in0Add3627,in1Add3627],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub88886.png')

LAve92638 = average_layer([[[[[0.9623]], [[0.1182]]]], [[[[0.3084]], [[0.4047]]]]], Ave92638), 
LRes54841 = reshape_layer(Ave92638, [2, 1], Res54841), 
LLoc65340 = locally_connected1D_layer(Res54841, 1,[[[0.5487, 0.6343]], [[0.2619, 0.3288]]],[[0, 0], [0, 0]], 1, Loc65340), 
LRes75522 = reshape_layer(Loc65340, [2, 2, 1], Res75522), 
LMul89492 = multiply_layer([[[[[0.96], [0.6041]], [[0.6719], [0.1819]]]], [[[[0.4128], [0.9226]], [[0.3001], [0.5824]]]]], Mul89492), 
LRes90685 = reshape_layer(Mul89492, [2, 2], Res90685), 
LPer48688 = permute_layer(Res90685, 2,1, Per48688), 
LRes85251 = reshape_layer(Per48688, [2, 2, 1], Res85251), 
LRes54991 = reshape_layer(Res85251, [2, 2, 1, 1], Res54991), 
LCro27913 = cropping3D_layer(Res54991, 0, 0, 1, 0, 0, 0, Cro27913), 
LRes48640 = reshape_layer(Cro27913, [2, 1, 1], Res48640), 
LAdd3627 = add_layer([[[[0.2472, 0.5549]]], [[[0.4776, 0.8887]]]], Add3627), 
LSep95185 = separable_conv1D_layer(Add3627, 1,[[[[0.9292], [0.8078]]],[[[0.5245, 0.1832], [0.289, 0.3945]]]],[0, 0], 1, false, Sep95185), 
LRes91900 = reshape_layer(Sep95185, [2, 1, 1], Res91900), 
LMax60671 = maximum_layer([Res48640,Res91900], Max60671), 
LZer24892 = zero_padding2D_layer(Max60671, 0, 0, 1, 0, Zer24892), 
LSub88886 = subtract_layer(Res75522,Zer24892, Sub88886), 
exec_layers([LAve92638,LRes54841,LLoc65340,LRes75522,LMul89492,LRes90685,LPer48688,LRes85251,LRes54991,LCro27913,LRes48640,LAdd3627,LSep95185,LRes91900,LMax60671,LZer24892,LSub88886],["Ave92638","Res54841","Loc65340","Res75522","Mul89492","Res90685","Per48688","Res85251","Res54991","Cro27913","Res48640","Add3627","Sep95185","Res91900","Max60671","Zer24892","Sub88886"],Sub88886,"Sub88886")

Actual (Unparsed): [[[[0.3486165], [-0.2872544]], [[0.0684738], [-0.4974598]]]]

Expected (Unparsed): [[[[0.348616545],[-0.2872544200399999]],[[0.06847375500000001],[-0.49745979967200005]]]]

Actual:   [[[[0.3487], [-0.2872]], [[0.0685], [-0.4974]]]]

Expected: [[[[0.3487], [-0.2872]], [[0.0685], [-0.4974]]]]