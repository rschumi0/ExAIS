import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0ELU67466 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Sof36447 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con19051 = tf.keras.layers.Input(shape=([4, 3, 1, 2]))
in0Min3208 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Min3208 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con41743 = tf.keras.layers.Input(shape=([4, 1, 1, 2]))
in0Con49064 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))

ELU67466 = keras.layers.ELU(alpha=-5.160519388077455, name = 'ELU67466', input_shape=(2, 1, 2))(in0ELU67466)
Res49640 = keras.layers.Reshape((2, 2), name = 'Res49640', )(ELU67466)
Sof36447 = keras.layers.Softmax(axis=1, name = 'Sof36447', input_shape=(2, 1, 2))(in0Sof36447)
Res51062 = keras.layers.Reshape((2, 2), name = 'Res51062', )(Sof36447)
Dot63691 = keras.layers.Dot(axes=(2, 1), name = 'Dot63691', )([Res49640,Res51062])
Res12064 = keras.layers.Reshape((2, 2, 1), name = 'Res12064', )(Dot63691)
Res35344 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res35344', )(Res12064)
Zer82587 = keras.layers.ZeroPadding3D(padding=((2, 0), (1, 0), (0, 0)), name = 'Zer82587', )(Res35344)
Con19051 = keras.layers.Concatenate(axis=4, name = 'Con19051', )([Zer82587,in0Con19051])
Min3208 = keras.layers.Minimum(name = 'Min3208', )([in0Min3208,in1Min3208])
Res17663 = keras.layers.Reshape((1, 4), name = 'Res17663', )(Min3208)
Glo16696 = keras.layers.GlobalAveragePooling1D(name = 'Glo16696', )(Res17663)
Res53121 = keras.layers.Reshape((4, 1), name = 'Res53121', )(Glo16696)
Res40131 = keras.layers.Reshape((4, 1, 1), name = 'Res40131', )(Res53121)
Res31343 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res31343', )(Res40131)
Con41743 = keras.layers.Concatenate(axis=4, name = 'Con41743', )([Res31343,in0Con41743])
Con49064 = keras.layers.Conv3DTranspose(3, (1, 1, 1),strides=(1, 1, 1), padding='same', name = 'Con49064', )(in0Con49064)
Zer12824 = keras.layers.ZeroPadding3D(padding=((2, 0), (0, 0), (0, 0)), name = 'Zer12824', )(Con49064)
Min14093 = keras.layers.Minimum(name = 'Min14093', )([Con41743,Zer12824])
Zer25679 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer25679', )(Min14093)
Add24173 = keras.layers.Add(name = 'Add24173', )([Con19051,Zer25679])
Res17551 = keras.layers.Reshape((4, 3, 3), name = 'Res17551', )(Add24173)
PRe37720 = keras.layers.PReLU(name = 'PRe37720', )(Res17551)
model = tf.keras.models.Model(inputs=[in0ELU67466,in0Sof36447,in0Con19051,in0Min3208,in1Min3208,in0Con41743,in0Con49064], outputs=PRe37720)
w = model.get_layer('Con49064').get_weights() 
w[0] = np.array([[[[[0.755], [0.5604], [0.7958]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con49064').set_weights(w) 
w = model.get_layer('PRe37720').get_weights() 
w[0] = np.array([[[0.9032, 0.4523, 0.68], [0.1172, 0.1707, 0.4074], [0.871, 0.2961, 0.3325]], [[0.0621, 0.0945, 0.2433], [0.6633, 0.1832, 0.8802], [0.9807, 0.4515, 0.9752]], [[0.7725, 0.7125, 0.6101], [0.8748, 0.3491, 0.7435], [0.6785, 0.037, 0.072]], [[0.1588, 0.6871, 0.0421], [0.2989, 0.5335, 0.2407], [0.0611, 0.6314, 0.729]]])
model.get_layer('PRe37720').set_weights(w) 
in0ELU67466 = tf.constant([[[[0.1573, 0.8741]], [[0.5684, 0.8925]]]])
in0Sof36447 = tf.constant([[[[0.4048, 0.3421]], [[0.0147, 0.0753]]]])
in0Con19051 = tf.constant([[[[[0.3646, 0.024]], [[0.3973, 0.8042]], [[0.6948, 0.9198]]], [[[0.2873, 0.3796]], [[0.1504, 0.5694]], [[0.9545, 0.7586]]], [[[0.1404, 0.2038]], [[0.3031, 0.3954]], [[0.498, 0.8456]]], [[[0.8448, 0.5165]], [[0.7661, 0.9175]], [[0.3915, 0.5509]]]]])
in0Min3208 = tf.constant([[[[0.6833, 0.5358], [0.8866, 0.4166]]]])
in1Min3208 = tf.constant([[[[0.583, 0.2776], [0.7998, 0.6559]]]])
in0Con41743 = tf.constant([[[[[0.9433, 0.9696]]], [[[0.2917, 0.9356]]], [[[0.1116, 0.1378]]], [[[0.0538, 0.6123]]]]])
in0Con49064 = tf.constant([[[[[0.9603]]], [[[0.0384]]]]])
print (np.array2string(model.predict([in0ELU67466,in0Sof36447,in0Con19051,in0Min3208,in1Min3208,in0Con41743,in0Con49064],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='PRe37720.png')

LELU67466 = elu_layer([[[[0.1573, 0.8741]], [[0.5684, 0.8925]]]], -5.160519388077455, ELU67466), 
LRes49640 = reshape_layer(ELU67466, [2, 2], Res49640), 
LSof36447 = softmax_layer([[[[0.4048, 0.3421]], [[0.0147, 0.0753]]]], 1, Sof36447), 
LRes51062 = reshape_layer(Sof36447, [2, 2], Res51062), 
LDot63691 = dot_layer(Res49640,Res51062, 2, 1, Dot63691), 
LRes12064 = reshape_layer(Dot63691, [2, 2, 1], Res12064), 
LRes35344 = reshape_layer(Res12064, [2, 2, 1, 1], Res35344), 
LZer82587 = zero_padding3D_layer(Res35344, 2, 0, 1, 0, 0, 0, Zer82587), 
LCon19051 = concatenate_layer([Zer82587,[[[[[0.3646, 0.024]], [[0.3973, 0.8042]], [[0.6948, 0.9198]]], [[[0.2873, 0.3796]], [[0.1504, 0.5694]], [[0.9545, 0.7586]]], [[[0.1404, 0.2038]], [[0.3031, 0.3954]], [[0.498, 0.8456]]], [[[0.8448, 0.5165]], [[0.7661, 0.9175]], [[0.3915, 0.5509]]]]]], 4, Con19051), 
LMin3208 = minimum_layer([[[[[0.6833, 0.5358], [0.8866, 0.4166]]]], [[[[0.583, 0.2776], [0.7998, 0.6559]]]]], Min3208), 
LRes17663 = reshape_layer(Min3208, [1, 4], Res17663), 
LGlo16696 = global_average_pooling1D_layer(Res17663, Glo16696), 
LRes53121 = reshape_layer(Glo16696, [4, 1], Res53121), 
LRes40131 = reshape_layer(Res53121, [4, 1, 1], Res40131), 
LRes31343 = reshape_layer(Res40131, [4, 1, 1, 1], Res31343), 
LCon41743 = concatenate_layer([Res31343,[[[[[0.9433, 0.9696]]], [[[0.2917, 0.9356]]], [[[0.1116, 0.1378]]], [[[0.0538, 0.6123]]]]]], 4, Con41743), 
LCon49064 = conv3D_transpose_layer([[[[[0.9603]]], [[[0.0384]]]]], 1, 1, 1,[[[[[0.755], [0.5604], [0.7958]]]]],[0, 0, 0], 1, 1, 1, true, Con49064), 
LZer12824 = zero_padding3D_layer(Con49064, 2, 0, 0, 0, 0, 0, Zer12824), 
LMin14093 = minimum_layer([Con41743,Zer12824], Min14093), 
LZer25679 = zero_padding3D_layer(Min14093, 0, 0, 2, 0, 0, 0, Zer25679), 
LAdd24173 = add_layer([Con19051,Zer25679], Add24173), 
LRes17551 = reshape_layer(Add24173, [4, 3, 3], Res17551), 
LPRe37720 = prelu_layer(Res17551, [[[0.9032, 0.4523, 0.68], [0.1172, 0.1707, 0.4074], [0.871, 0.2961, 0.3325]], [[0.0621, 0.0945, 0.2433], [0.6633, 0.1832, 0.8802], [0.9807, 0.4515, 0.9752]], [[0.7725, 0.7125, 0.6101], [0.8748, 0.3491, 0.7435], [0.6785, 0.037, 0.072]], [[0.1588, 0.6871, 0.0421], [0.2989, 0.5335, 0.2407], [0.0611, 0.6314, 0.729]]], PRe37720), 
exec_layers([LELU67466,LRes49640,LSof36447,LRes51062,LDot63691,LRes12064,LRes35344,LZer82587,LCon19051,LMin3208,LRes17663,LGlo16696,LRes53121,LRes40131,LRes31343,LCon41743,LCon49064,LZer12824,LMin14093,LZer25679,LAdd24173,LRes17551,LPRe37720],["ELU67466","Res49640","Sof36447","Res51062","Dot63691","Res12064","Res35344","Zer82587","Con19051","Min3208","Res17663","Glo16696","Res53121","Res40131","Res31343","Con41743","Con49064","Zer12824","Min14093","Zer25679","Add24173","Res17551","PRe37720"],PRe37720,"PRe37720")

Actual (Unparsed): [[[[0.0000000, 0.3646000, 0.0240000], [0.0000000, 0.3973000, 0.8042000], [0.0000000, 0.6948000, 0.9198000]], [[0.0000000, 0.2873000, 0.3796000], [0.0000000, 0.1504000, 0.5694000], [0.0000000, 0.9545000, 0.7586000]], [[0.0000000, 0.1404000, 0.2038000], [0.4466673, 0.3031000, 0.3954000], [1.1931976, 0.6096000, 0.9834000]], [[0.0000000, 0.8448000, 0.5165000], [0.6992370, 0.7661000, 0.9175000], [0.7379519, 0.4130194, 0.5814587]]]]

Expected (Unparsed): [[[[0,0.3646,0.024],[0,0.3973,0.8042],[0,0.6948,0.9198]],[[0,0.2873,0.3796],[0,0.1504,0.5694],[0,0.9545,0.7586]],[[0,0.1404,0.2038],[0.44666730580949043,0.3031,0.3954],[1.1931975409011402,0.6096,0.9834]],[[0,0.8448,0.5165],[0.6992369751853458,0.7661,0.9175],[0.7379518554074492,0.41301936,0.58145872]]]]

Actual:   [[[[0, 0.3646, 0.024], [0, 0.3973, 0.8042], [0, 0.6948, 0.9198]], [[0, 0.2873, 0.3796], [0, 0.1504, 0.5694], [0, 0.9545, 0.7586]], [[0, 0.1404, 0.2038], [0.4467, 0.3031, 0.3954], [1.1932, 0.6096, 0.9834]], [[0, 0.8448, 0.5165], [0.6993, 0.7661, 0.9175], [0.738, 0.4131, 0.5815]]]]

Expected: [[[[0, 0.3646, 0.024], [0, 0.3973, 0.8042], [0, 0.6948, 0.9198]], [[0, 0.2873, 0.3796], [0, 0.1504, 0.5694], [0, 0.9545, 0.7586]], [[0, 0.1404, 0.2038], [0.4467, 0.3031, 0.3954], [1.1932, 0.6096, 0.9834]], [[0, 0.8448, 0.5165], [0.6993, 0.7661, 0.9175], [0.738, 0.4131, 0.5815]]]]