import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max2640 = tf.keras.layers.Input(shape=([2, 1]))
in1Max2640 = tf.keras.layers.Input(shape=([2, 1]))
in0Up_86656 = tf.keras.layers.Input(shape=([1, 4]))
in0Con29760 = tf.keras.layers.Input(shape=([1]))

Max2640 = keras.layers.Maximum(name = 'Max2640', )([in0Max2640,in1Max2640])
Res82455 = keras.layers.Reshape((2, 1, 1), name = 'Res82455', )(Max2640)
Res24340 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res24340', )(Res82455)
Up_7607 = keras.layers.UpSampling3D(size=(1, 1, 2), name = 'Up_7607', )(Res24340)
Res14419 = keras.layers.Reshape((2, 1, 2), name = 'Res14419', )(Up_7607)
Res95814 = keras.layers.Reshape((2, 2), name = 'Res95814', )(Res14419)
Fla81280 = keras.layers.Flatten(name = 'Fla81280', )(Res95814)
Up_86656 = keras.layers.UpSampling1D(size=(1), name = 'Up_86656', )(in0Up_86656)
Res27114 = keras.layers.Reshape((1, 4, 1), name = 'Res27114', )(Up_86656)
Res58470 = keras.layers.Reshape((1, 4, 1, 1), name = 'Res58470', )(Res27114)
Con69872 = keras.layers.Conv3DTranspose(3, (1, 2, 1),strides=(1, 1, 1), padding='valid', name = 'Con69872', )(Res58470)
Glo44987 = keras.layers.GlobalMaxPool3D(name = 'Glo44987', )(Con69872)
Con29760 = keras.layers.Concatenate(axis=1, name = 'Con29760', )([Glo44987,in0Con29760])
Ave63504 = keras.layers.Average(name = 'Ave63504', )([Fla81280,Con29760])
ReL45741 = keras.layers.ReLU(max_value=9.68246489083985, negative_slope=0.4521438977936402, threshold=1.105436706443691, name = 'ReL45741', )(Ave63504)
Res23598 = keras.layers.Reshape((4, 1), name = 'Res23598', )(ReL45741)
Res42415 = keras.layers.Reshape((4, 1, 1), name = 'Res42415', )(Res23598)
Up_82009 = keras.layers.UpSampling2D(size=(1, 1), name = 'Up_82009', )(Res42415)
model = tf.keras.models.Model(inputs=[in0Max2640,in1Max2640,in0Up_86656,in0Con29760], outputs=Up_82009)
w = model.get_layer('Con69872').get_weights() 
w[0] = np.array([[[[[0.4882], [0.8109], [0.1837]]], [[[0.7673], [0.2679], [0.4722]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con69872').set_weights(w) 
in0Max2640 = tf.constant([[[0.6251], [0.7825]]])
in1Max2640 = tf.constant([[[0.6597], [0.9307]]])
in0Up_86656 = tf.constant([[[1.4132, 1.5294, 1.309, 1.5556]]])
in0Con29760 = tf.constant([[0.6328]])
print (np.array2string(model.predict([in0Max2640,in1Max2640,in0Up_86656,in0Con29760],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Up_82009.png')

LMax2640 = maximum_layer([[[[0.6251], [0.7825]]], [[[0.6597], [0.9307]]]], Max2640), 
LRes82455 = reshape_layer(Max2640, [2, 1, 1], Res82455), 
LRes24340 = reshape_layer(Res82455, [2, 1, 1, 1], Res24340), 
LUp_7607 = up_sampling3D_layer(Res24340, 1, 1, 2, Up_7607), 
LRes14419 = reshape_layer(Up_7607, [2, 1, 2], Res14419), 
LRes95814 = reshape_layer(Res14419, [2, 2], Res95814), 
LFla81280 = flatten_layer(Res95814, Fla81280), 
LUp_86656 = up_sampling1D_layer([[[1.4132, 1.5294, 1.309, 1.5556]]], 1, Up_86656), 
LRes27114 = reshape_layer(Up_86656, [1, 4, 1], Res27114), 
LRes58470 = reshape_layer(Res27114, [1, 4, 1, 1], Res58470), 
LCon69872 = conv3D_transpose_layer(Res58470, 1, 2, 1,[[[[[0.4882], [0.8109], [0.1837]]], [[[0.7673], [0.2679], [0.4722]]]]],[0, 0, 0], 1, 1, 1, false, Con69872), 
LGlo44987 = global_max_pool3D_layer(Con69872, Glo44987), 
LCon29760 = concatenate_layer([Glo44987,[[0.6328]]], 1, Con29760), 
LAve63504 = average_layer([Fla81280,Con29760], Ave63504), 
LReL45741 = relu_layer(Ave63504, 9.68246489083985, 0.4521438977936402, 1.105436706443691, ReL45741), 
LRes23598 = reshape_layer(ReL45741, [4, 1], Res23598), 
LRes42415 = reshape_layer(Res23598, [4, 1, 1], Res42415), 
LUp_82009 = up_sampling2D_layer(Res42415, 1, 1, Up_82009), 
exec_layers([LMax2640,LRes82455,LRes24340,LUp_7607,LRes14419,LRes95814,LFla81280,LUp_86656,LRes27114,LRes58470,LCon69872,LGlo44987,LCon29760,LAve63504,LReL45741,LRes23598,LRes42415,LUp_82009],["Max2640","Res82455","Res24340","Up_7607","Res14419","Res95814","Fla81280","Up_86656","Res27114","Res58470","Con69872","Glo44987","Con29760","Ave63504","ReL45741","Res23598","Res42415","Up_82009"],Up_82009,"Up_82009")

Actual (Unparsed): [[[[1.2453507]], [[1.1392434]], [[-0.0717840]], [[-0.1463530]]]]

Expected (Unparsed): [[[[1.24535072]],[[1.13924337]],[[-0.07178404558105467]],[[-0.14635296911543622]]]]

Actual:   [[[[1.2454]], [[1.1393]], [[-0.0717]], [[-0.1463]]]]

Expected: [[[[1.2454]], [[1.1393]], [[-0.0717]], [[-0.1463]]]]