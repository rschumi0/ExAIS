import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave12998 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Ave12998 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Ave76101 = tf.keras.layers.Input(shape=([1, 1]))
in1Ave76101 = tf.keras.layers.Input(shape=([1, 1]))
in0Con52419 = tf.keras.layers.Input(shape=([2, 2]))
in0Cro35525 = tf.keras.layers.Input(shape=([3, 3]))

Ave12998 = keras.layers.Average(name = 'Ave12998', )([in0Ave12998,in1Ave12998])
Res96195 = keras.layers.Reshape((2, 2, 4), name = 'Res96195', )(Ave12998)
Res60201 = keras.layers.Reshape((2, 8), name = 'Res60201', )(Res96195)
LST18159 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST18159', )(Res60201)
Res70984 = keras.layers.Reshape((2, 1), name = 'Res70984', )(LST18159)
Ave76101 = keras.layers.Average(name = 'Ave76101', )([in0Ave76101,in1Ave76101])
Zer21909 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer21909', )(Ave76101)
Add95734 = keras.layers.Add(name = 'Add95734', )([Res70984,Zer21909])
Con52419 = keras.layers.Concatenate(axis=2, name = 'Con52419', )([Add95734,in0Con52419])
Cro35525 = keras.layers.Cropping1D(cropping=((0, 1)), name = 'Cro35525', )(in0Cro35525)
Max29662 = keras.layers.Maximum(name = 'Max29662', )([Con52419,Cro35525])
model = tf.keras.models.Model(inputs=[in0Ave12998,in1Ave12998,in0Ave76101,in1Ave76101,in0Con52419,in0Cro35525], outputs=Max29662)
w = model.get_layer('LST18159').get_weights() 
w[0] = np.array([[7, 10, 7, 2, 10, 9, 3, 8], [9, 10, 7, 10, 2, 7, 5, 6], [7, 8, 9, 3, 5, 2, 4, 8], [4, 5, 6, 3, 10, 3, 3, 1], [2, 3, 10, 7, 7, 6, 10, 3], [3, 3, 7, 8, 6, 7, 1, 2], [3, 9, 8, 10, 9, 8, 10, 6], [9, 2, 9, 6, 9, 1, 9, 4]])
w[1] = np.array([[4, 10, 1, 1, 8, 3, 6, 9], [1, 5, 7, 4, 7, 3, 1, 9]])
w[2] = np.array([5, 7, 2, 7, 7, 8, 3, 3])
model.get_layer('LST18159').set_weights(w) 
in0Ave12998 = tf.constant([[[[[0.7422, 0.3392], [0.5059, 0.5448]], [[0.5926, 0.3931], [0.0711, 0.8269]]], [[[0.7611, 0.4592], [0.0216, 0.0055]], [[0.2299, 0.0018], [0.9491, 0.2406]]]]])
in1Ave12998 = tf.constant([[[[[0.3426, 0.4625], [0.2632, 0.7119]], [[0.5806, 0.0898], [0.6783, 0.7297]]], [[[0.892, 0.9055], [0.7203, 0.5911]], [[0.4368, 0.2919], [0.7962, 0.9234]]]]])
in0Ave76101 = tf.constant([[[0.6672]]])
in1Ave76101 = tf.constant([[[0.2097]]])
in0Con52419 = tf.constant([[[0.2524, 0.6619], [0.949, 0.4672]]])
in0Cro35525 = tf.constant([[[1.9334, 1.9259, 1.9836], [1.1131, 1.6406, 1.6124], [1.8223, 1.213, 1.4668]]])
print (np.array2string(model.predict([in0Ave12998,in1Ave12998,in0Ave76101,in1Ave76101,in0Con52419,in0Cro35525],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max29662.png')

LAve12998 = average_layer([[[[[[0.7422, 0.3392], [0.5059, 0.5448]], [[0.5926, 0.3931], [0.0711, 0.8269]]], [[[0.7611, 0.4592], [0.0216, 0.0055]], [[0.2299, 0.0018], [0.9491, 0.2406]]]]], [[[[[0.3426, 0.4625], [0.2632, 0.7119]], [[0.5806, 0.0898], [0.6783, 0.7297]]], [[[0.892, 0.9055], [0.7203, 0.5911]], [[0.4368, 0.2919], [0.7962, 0.9234]]]]]], Ave12998), 
LRes96195 = reshape_layer(Ave12998, [2, 2, 4], Res96195), 
LRes60201 = reshape_layer(Res96195, [2, 8], Res60201), 
LLST18159 = lstm_layer(Res60201,[[7, 10, 7, 2, 10, 9, 3, 8], [9, 10, 7, 10, 2, 7, 5, 6], [7, 8, 9, 3, 5, 2, 4, 8], [4, 5, 6, 3, 10, 3, 3, 1], [2, 3, 10, 7, 7, 6, 10, 3], [3, 3, 7, 8, 6, 7, 1, 2], [3, 9, 8, 10, 9, 8, 10, 6], [9, 2, 9, 6, 9, 1, 9, 4]],[[4, 10, 1, 1, 8, 3, 6, 9], [1, 5, 7, 4, 7, 3, 1, 9]],[5, 7, 2, 7, 7, 8, 3, 3], LST18159), 
LRes70984 = reshape_layer(LST18159, [2, 1], Res70984), 
LAve76101 = average_layer([[[[0.6672]]], [[[0.2097]]]], Ave76101), 
LZer21909 = zero_padding1D_layer(Ave76101, 1, 0, Zer21909), 
LAdd95734 = add_layer([Res70984,Zer21909], Add95734), 
LCon52419 = concatenate_layer([Add95734,[[[0.2524, 0.6619], [0.949, 0.4672]]]], 2, Con52419), 
LCro35525 = cropping1D_layer([[[1.9334, 1.9259, 1.9836], [1.1131, 1.6406, 1.6124], [1.8223, 1.213, 1.4668]]], 0, 1, Cro35525), 
LMax29662 = maximum_layer([Con52419,Cro35525], Max29662), 
exec_layers([LAve12998,LRes96195,LRes60201,LLST18159,LRes70984,LAve76101,LZer21909,LAdd95734,LCon52419,LCro35525,LMax29662],["Ave12998","Res96195","Res60201","LST18159","Res70984","Ave76101","Zer21909","Add95734","Con52419","Cro35525","Max29662"],Max29662,"Max29662")

Actual (Unparsed): [[[1.9334000, 1.9259000, 1.9836000], [1.4024776, 1.6406000, 1.6124001]]]

Expected (Unparsed): [[[1.9334,1.9259,1.9836],[1.4024775800758107,1.6406,1.6124]]]

Actual:   [[[1.9334, 1.9259, 1.9836], [1.4025, 1.6406, 1.6125]]]

Expected: [[[1.9334, 1.9259, 1.9836], [1.4025, 1.6406, 1.6124]]]