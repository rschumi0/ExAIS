import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add22369 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Add22369 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Ave90861 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Ave90861 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Den71472 = tf.keras.layers.Input(shape=([4, 5]))

Add22369 = keras.layers.Add(name = 'Add22369', )([in0Add22369,in1Add22369])
Res62043 = keras.layers.Reshape((2, 2), name = 'Res62043', )(Add22369)
Ave90861 = keras.layers.Average(name = 'Ave90861', )([in0Ave90861,in1Ave90861])
Res6183 = keras.layers.Reshape((2, 2), name = 'Res6183', )(Ave90861)
Dot1541 = keras.layers.Dot(axes=(2, 1), name = 'Dot1541', )([Res62043,Res6183])
Den71472 = keras.layers.Dense(2,name = 'Den71472', )(in0Den71472)
Dot93166 = keras.layers.Dot(axes=(2, 2), name = 'Dot93166', )([Dot1541,Den71472])
model = tf.keras.models.Model(inputs=[in0Add22369,in1Add22369,in0Ave90861,in1Ave90861,in0Den71472], outputs=Dot93166)
w = model.get_layer('Den71472').get_weights() 
w[0] = np.array([[0.4605, 0.9518], [0.5568, 0.8749], [0.3652, 0.0141], [0.0424, 0.4146], [0.9157, 0.6548]])
w[1] = np.array([0.0098, 0.7164])
model.get_layer('Den71472').set_weights(w) 
in0Add22369 = tf.constant([[[[0.3035, 0.8773]], [[0.4004, 0.4817]]]])
in1Add22369 = tf.constant([[[[0.9702, 0.2152]], [[0.8211, 0.6314]]]])
in0Ave90861 = tf.constant([[[[[0.8469, 0.8634]]], [[[0.374, 0.4582]]]]])
in1Ave90861 = tf.constant([[[[[0.0366, 0.236]]], [[[0.0324, 0.0135]]]]])
in0Den71472 = tf.constant([[[0.3764, 0.0579, 0.734, 0.4405, 0.9486], [0.0068, 0.6285, 0.8531, 0.2783, 0.9927], [0.8711, 0.2237, 0.4091, 0.0965, 0.5994], [0.7712, 0.012, 0.5117, 0.9694, 0.5509]]])
print (np.array2string(model.predict([in0Add22369,in1Add22369,in0Ave90861,in1Ave90861,in0Den71472],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot93166.png')

LAdd22369 = add_layer([[[[[0.3035, 0.8773]], [[0.4004, 0.4817]]]], [[[[0.9702, 0.2152]], [[0.8211, 0.6314]]]]], Add22369), 
LRes62043 = reshape_layer(Add22369, [2, 2], Res62043), 
LAve90861 = average_layer([[[[[[0.8469, 0.8634]]], [[[0.374, 0.4582]]]]], [[[[[0.0366, 0.236]]], [[[0.0324, 0.0135]]]]]], Ave90861), 
LRes6183 = reshape_layer(Ave90861, [2, 2], Res6183), 
LDot1541 = dot_layer(Res62043,Res6183, 2, 1, Dot1541), 
LDen71472 = dense_layer([[[0.3764, 0.0579, 0.734, 0.4405, 0.9486], [0.0068, 0.6285, 0.8531, 0.2783, 0.9927], [0.8711, 0.2237, 0.4091, 0.0965, 0.5994], [0.7712, 0.012, 0.5117, 0.9694, 0.5509]]], [[0.4605, 0.9518], [0.5568, 0.8749], [0.3652, 0.0141], [0.0424, 0.4146], [0.9157, 0.6548]],[0.0098, 0.7164], Den71472), 
LDot93166 = dot_layer(Dot1541,Den71472, 2, 2, Dot93166), 
exec_layers([LAdd22369,LRes62043,LAve90861,LRes6183,LDot1541,LDen71472,LDot93166],["Add22369","Res62043","Ave90861","Res6183","Dot1541","Den71472","Dot93166"],Dot93166,"Dot93166")

Actual (Unparsed): [[[2.9331844, 3.2154159, 3.0588524, 3.0029868], [2.8610857, 3.1364404, 2.9835396, 2.9289769]]]

Expected (Unparsed): [[[2.9331843985219344,3.21541598006194,3.058852352450296,3.0029868466934238],[2.861085752493936,3.136440473668215,2.983539616520661,2.9289769660337535]]]

Actual:   [[[2.9332, 3.2155, 3.0589, 3.003], [2.8611, 3.1365, 2.9836, 2.929]]]

Expected: [[[2.9332, 3.2155, 3.0589, 3.003], [2.8611, 3.1365, 2.9836, 2.929]]]