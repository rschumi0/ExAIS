import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub30178 = tf.keras.layers.Input(shape=([3]))
in1Sub30178 = tf.keras.layers.Input(shape=([3]))
in0Con76396 = tf.keras.layers.Input(shape=([3, 1, 3, 1]))
in0Con13604 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Ave27074 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Ave27074 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con1854 = tf.keras.layers.Input(shape=([3, 1, 4]))

Sub30178 = keras.layers.Subtract(name = 'Sub30178', )([in0Sub30178,in1Sub30178])
Res39146 = keras.layers.Reshape((3, 1), name = 'Res39146', )(Sub30178)
Res37232 = keras.layers.Reshape((3, 1, 1), name = 'Res37232', )(Res39146)
Res84510 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res84510', )(Res37232)
Zer19279 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer19279', )(Res84510)
Con76396 = keras.layers.Concatenate(axis=4, name = 'Con76396', )([Zer19279,in0Con76396])
Con13604 = keras.layers.Conv3DTranspose(2, (1, 1, 1),strides=(1, 1, 1), padding='same', name = 'Con13604', )(in0Con13604)
Zer21022 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (1, 0)), name = 'Zer21022', )(Con13604)
Add36652 = keras.layers.Add(name = 'Add36652', )([Con76396,Zer21022])
Res58261 = keras.layers.Reshape((3, 1, 6), name = 'Res58261', )(Add36652)
Ave27074 = keras.layers.Average(name = 'Ave27074', )([in0Ave27074,in1Ave27074])
Zer78138 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer78138', )(Ave27074)
Con1854 = keras.layers.Concatenate(axis=3, name = 'Con1854', )([Zer78138,in0Con1854])
Sub77085 = keras.layers.Subtract(name = 'Sub77085', )([Res58261,Con1854])
Zer66167 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer66167', )(Sub77085)
model = tf.keras.models.Model(inputs=[in0Sub30178,in1Sub30178,in0Con76396,in0Con13604,in0Ave27074,in1Ave27074,in0Con1854], outputs=Zer66167)
w = model.get_layer('Con13604').get_weights() 
w[0] = np.array([[[[[0.9019], [0.659]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con13604').set_weights(w) 
in0Sub30178 = tf.constant([[0.7281, 0.3269, 0.4363]])
in1Sub30178 = tf.constant([[0.3431, 0.5493, 0.4182]])
in0Con76396 = tf.constant([[[[[0.748], [0.8677], [0.1909]]], [[[0.8094], [0.3882], [0.3918]]], [[[0.8956], [0.8236], [0.7095]]]]])
in0Con13604 = tf.constant([[[[[0.6989], [0.2306]]], [[[0.3705], [0.5518]]]]])
in0Ave27074 = tf.constant([[[[0.6602, 0.7764]], [[0.5162, 0.1431]]]])
in1Ave27074 = tf.constant([[[[0.6171, 0.7677]], [[0.4773, 0.6077]]]])
in0Con1854 = tf.constant([[[[0.9344, 0.8123, 0.2036, 0.1282]], [[0.5458, 0.4293, 0.6801, 0.5083]], [[0.7691, 0.5685, 0.7775, 0.1547]]]])
print (np.array2string(model.predict([in0Sub30178,in1Sub30178,in0Con76396,in0Con13604,in0Ave27074,in1Ave27074,in0Con1854],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Zer66167.png')

LSub30178 = subtract_layer([[0.7281, 0.3269, 0.4363]], [[0.3431, 0.5493, 0.4182]], Sub30178), 
LRes39146 = reshape_layer(Sub30178, [3, 1], Res39146), 
LRes37232 = reshape_layer(Res39146, [3, 1, 1], Res37232), 
LRes84510 = reshape_layer(Res37232, [3, 1, 1, 1], Res84510), 
LZer19279 = zero_padding3D_layer(Res84510, 0, 0, 0, 0, 2, 0, Zer19279), 
LCon76396 = concatenate_layer([Zer19279,[[[[[0.748], [0.8677], [0.1909]]], [[[0.8094], [0.3882], [0.3918]]], [[[0.8956], [0.8236], [0.7095]]]]]], 4, Con76396), 
LCon13604 = conv3D_transpose_layer([[[[[0.6989], [0.2306]]], [[[0.3705], [0.5518]]]]], 1, 1, 1,[[[[[0.9019], [0.659]]]]],[0, 0], 1, 1, 1, true, Con13604), 
LZer21022 = zero_padding3D_layer(Con13604, 1, 0, 0, 0, 1, 0, Zer21022), 
LAdd36652 = add_layer([Con76396,Zer21022], Add36652), 
LRes58261 = reshape_layer(Add36652, [3, 1, 6], Res58261), 
LAve27074 = average_layer([[[[[0.6602, 0.7764]], [[0.5162, 0.1431]]]], [[[[0.6171, 0.7677]], [[0.4773, 0.6077]]]]], Ave27074), 
LZer78138 = zero_padding2D_layer(Ave27074, 1, 0, 0, 0, Zer78138), 
LCon1854 = concatenate_layer([Zer78138,[[[[0.9344, 0.8123, 0.2036, 0.1282]], [[0.5458, 0.4293, 0.6801, 0.5083]], [[0.7691, 0.5685, 0.7775, 0.1547]]]]], 3, Con1854), 
LSub77085 = subtract_layer(Res58261,Con1854, Sub77085), 
LZer66167 = zero_padding2D_layer(Sub77085, 1, 1, 1, 1, Zer66167), 
exec_layers([LSub30178,LRes39146,LRes37232,LRes84510,LZer19279,LCon76396,LCon13604,LZer21022,LAdd36652,LRes58261,LAve27074,LZer78138,LCon1854,LSub77085,LZer66167],["Sub30178","Res39146","Res37232","Res84510","Zer19279","Con76396","Con13604","Zer21022","Add36652","Res58261","Ave27074","Zer78138","Con1854","Sub77085","Zer66167"],Zer66167,"Zer66167")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.7480000, -0.9344000, 0.0554000, 0.1814000, 0.0627000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [-0.6386500, 0.0373500, 0.0845379, 0.4194751, -0.6945219, 0.0354654], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [-0.4967500, 0.5202000, -0.4349461, 0.4992595, -0.2617315, 0.9184362], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000]]]]

Expected (Unparsed): [[[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]],[[0,0,0,0,0,0],[0,0.748,-0.9344,0.055400000000000005,0.18139999999999995,0.06269999999999998],[0,0,0,0,0,0]],[[0,0,0,0,0,0],[-0.6386499999999999,0.037349999999999994,0.08453791,0.4194751,-0.69452186,0.03546539999999998],[0,0,0,0,0,0]],[[0,0,0,0,0,0],[-0.49675,0.5202,-0.43494605,0.49925949999999997,-0.26173157999999996,0.9184361999999999],[0,0,0,0,0,0]],[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]]]]

Actual:   [[[[0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0]], [[0, 0, 0, 0, 0, 0], [0, 0.748, -0.9344, 0.0554, 0.1814, 0.0627], [0, 0, 0, 0, 0, 0]], [[0, 0, 0, 0, 0, 0], [-0.6386, 0.0374, 0.0846, 0.4195, -0.6945, 0.0355], [0, 0, 0, 0, 0, 0]], [[0, 0, 0, 0, 0, 0], [-0.4967, 0.5202, -0.4349, 0.4993, -0.2617, 0.9185], [0, 0, 0, 0, 0, 0]], [[0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0]]]]

Expected: [[[[0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0]], [[0, 0, 0, 0, 0, 0], [0, 0.748, -0.9344, 0.0555, 0.1814, 0.0627], [0, 0, 0, 0, 0, 0]], [[0, 0, 0, 0, 0, 0], [-0.6386, 0.0374, 0.0846, 0.4195, -0.6945, 0.0355], [0, 0, 0, 0, 0, 0]], [[0, 0, 0, 0, 0, 0], [-0.4967, 0.5202, -0.4349, 0.4993, -0.2617, 0.9185], [0, 0, 0, 0, 0, 0]], [[0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0]]]]