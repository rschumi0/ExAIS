import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sep38055 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Dot89335 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot89335 = tf.keras.layers.Input(shape=([3, 3]))

Sep38055 = keras.layers.SeparableConv2D(3, (1, 1),strides=(1, 1), padding='valid', name = 'Sep38055', )(in0Sep38055)
Res41489 = keras.layers.Reshape((1, 6), name = 'Res41489', )(Sep38055)
Con59345 = keras.layers.Conv1D(4, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con59345', )(Res41489)
Res62757 = keras.layers.Reshape((1, 4, 1), name = 'Res62757', )(Con59345)
Dot89335 = keras.layers.Dot(axes=(1, 2), name = 'Dot89335', )([in0Dot89335,in1Dot89335])
Mas20146 = keras.layers.Masking(mask_value=1, name = 'Mas20146', )(Dot89335)
Res54924 = keras.layers.Reshape((3, 3, 1), name = 'Res54924', )(Mas20146)
Ave87015 = keras.layers.AveragePooling2D(pool_size=(3, 1), strides=(11, 2), padding='same', name = 'Ave87015', )(Res54924)
Zer40691 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer40691', )(Ave87015)
Max25461 = keras.layers.Maximum(name = 'Max25461', )([Res62757,Zer40691])
Res61096 = keras.layers.Reshape((1, 4), name = 'Res61096', )(Max25461)
LST60972 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST60972', )(Res61096)
model = tf.keras.models.Model(inputs=[in0Sep38055,in0Dot89335,in1Dot89335], outputs=LST60972)
w = model.get_layer('Sep38055').get_weights() 
w[0] = np.array([[[[0.1029], [0.4307]]]])
w[1] = np.array([[[[0.5205, 0.4467, 0.8605], [0.9671, 0.0067, 0.7907]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep38055').set_weights(w) 
w = model.get_layer('Con59345').get_weights() 
w[0] = np.array([[[0.1694, 0.3914, 0.7241, 0.4598], [0.7066, 0.6627, 0.2103, 0.563], [0.8385, 0.6784, 0.4923, 0.4732], [0.86, 0.1515, 0.7963, 0.0246], [0.666, 0.3147, 0.8057, 0.2125], [0.8422, 0.2382, 0.7799, 0.272]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con59345').set_weights(w) 
w = model.get_layer('LST60972').get_weights() 
w[0] = np.array([[6, 9, 6, 3, 2, 1, 7, 7, 1, 2, 5, 8], [10, 2, 7, 10, 8, 9, 6, 1, 8, 7, 6, 2], [8, 9, 8, 1, 4, 1, 7, 3, 5, 7, 5, 4], [4, 5, 5, 8, 8, 1, 1, 3, 1, 1, 6, 4]])
w[1] = np.array([[6, 2, 2, 5, 7, 6, 10, 9, 7, 6, 4, 4], [5, 9, 7, 2, 6, 10, 7, 6, 7, 9, 6, 3], [1, 10, 1, 4, 10, 8, 3, 4, 9, 4, 2, 1]])
w[2] = np.array([5, 10, 5, 3, 3, 10, 9, 5, 8, 1, 4, 1])
model.get_layer('LST60972').set_weights(w) 
in0Sep38055 = tf.constant([[[[0.8852, 0.3064], [0.1706, 0.6461]]]])
in0Dot89335 = tf.constant([[[0.5442, 0.0134, 0.5367], [0.4281, 0.2141, 0.2268], [0.0292, 0.9733, 0.9421]]])
in1Dot89335 = tf.constant([[[0.4022, 0.8558, 0.0155], [0.3908, 0.9501, 0.3553], [0.0881, 0.104, 0.9355]]])
print (np.array2string(model.predict([in0Sep38055,in0Dot89335,in1Dot89335],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST60972.png')

LSep38055 = separable_conv2D_layer([[[[0.8852, 0.3064], [0.1706, 0.6461]]]], 1, 1,[[[[[0.1029], [0.4307]]]],[[[[0.5205, 0.4467, 0.8605], [0.9671, 0.0067, 0.7907]]]]],[0, 0, 0], 1, 1, false, Sep38055), 
LRes41489 = reshape_layer(Sep38055, [1, 6], Res41489), 
LCon59345 = conv1D_layer(Res41489, 1,[[[0.1694, 0.3914, 0.7241, 0.4598], [0.7066, 0.6627, 0.2103, 0.563], [0.8385, 0.6784, 0.4923, 0.4732], [0.86, 0.1515, 0.7963, 0.0246], [0.666, 0.3147, 0.8057, 0.2125], [0.8422, 0.2382, 0.7799, 0.272]]],[0, 0, 0, 0], 1, false, 1, Con59345), 
LRes62757 = reshape_layer(Con59345, [1, 4, 1], Res62757), 
LDot89335 = dot_layer([[[0.5442, 0.0134, 0.5367], [0.4281, 0.2141, 0.2268], [0.0292, 0.9733, 0.9421]]], [[[0.4022, 0.8558, 0.0155], [0.3908, 0.9501, 0.3553], [0.0881, 0.104, 0.9355]]], 1, 2, Dot89335), 
LMas20146 = masking_layer(Dot89335, 1, Mas20146), 
LRes54924 = reshape_layer(Mas20146, [3, 3, 1], Res54924), 
LAve87015 = average_pooling2D_layer(Res54924, 3, 1, 11, 2, true, Ave87015), 
LZer40691 = zero_padding2D_layer(Ave87015, 0, 0, 2, 0, Zer40691), 
LMax25461 = maximum_layer([Res62757,Zer40691], Max25461), 
LRes61096 = reshape_layer(Max25461, [1, 4], Res61096), 
LLST60972 = lstm_layer(Res61096,[[6, 9, 6, 3, 2, 1, 7, 7, 1, 2, 5, 8], [10, 2, 7, 10, 8, 9, 6, 1, 8, 7, 6, 2], [8, 9, 8, 1, 4, 1, 7, 3, 5, 7, 5, 4], [4, 5, 5, 8, 8, 1, 1, 3, 1, 1, 6, 4]],[[6, 2, 2, 5, 7, 6, 10, 9, 7, 6, 4, 4], [5, 9, 7, 2, 6, 10, 7, 6, 7, 9, 6, 3], [1, 10, 1, 4, 10, 8, 3, 4, 9, 4, 2, 1]],[5, 10, 5, 3, 3, 10, 9, 5, 8, 1, 4, 1], LST60972), 
exec_layers([LSep38055,LRes41489,LCon59345,LRes62757,LDot89335,LMas20146,LRes54924,LAve87015,LZer40691,LMax25461,LRes61096,LLST60972],["Sep38055","Res41489","Con59345","Res62757","Dot89335","Mas20146","Res54924","Ave87015","Zer40691","Max25461","Res61096","LST60972"],LST60972,"LST60972")

Actual (Unparsed): [[0.7615473, 0.7615941, 0.7615900]]

Expected (Unparsed): [[0.761547343741382,0.7615940991117433,0.761589997471956]]

Actual:   [[0.7616, 0.7616, 0.7616]]

Expected: [[0.7616, 0.7616, 0.7616]]