import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul32408 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Mul32408 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))

Mul32408 = keras.layers.Multiply(name = 'Mul32408', )([in0Mul32408,in1Mul32408])
Res18934 = keras.layers.Reshape((1, 2, 2), name = 'Res18934', )(Mul32408)
Res14832 = keras.layers.Reshape((1, 4), name = 'Res14832', )(Res18934)
Ave94494 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='same', name = 'Ave94494', )(Res14832)
LST50385 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST50385', )(Ave94494)
model = tf.keras.models.Model(inputs=[in0Mul32408,in1Mul32408], outputs=LST50385)
w = model.get_layer('LST50385').get_weights() 
w[0] = np.array([[7, 4, 3, 6], [6, 9, 2, 8], [10, 8, 4, 9], [8, 6, 1, 7]])
w[1] = np.array([[4, 6, 4, 4]])
w[2] = np.array([5, 9, 8, 4])
model.get_layer('LST50385').set_weights(w) 
in0Mul32408 = tf.constant([[[[[0.5557], [0.864]], [[0.0634], [0.5887]]]]])
in1Mul32408 = tf.constant([[[[[0.2089], [0.6353]], [[0.0273], [0.6964]]]]])
print (np.array2string(model.predict([in0Mul32408,in1Mul32408],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST50385.png')

LMul32408 = multiply_layer([[[[[[0.5557], [0.864]], [[0.0634], [0.5887]]]]], [[[[[0.2089], [0.6353]], [[0.0273], [0.6964]]]]]], Mul32408), 
LRes18934 = reshape_layer(Mul32408, [1, 2, 2], Res18934), 
LRes14832 = reshape_layer(Res18934, [1, 4], Res14832), 
LAve94494 = average_pooling1D_layer(Res14832, 1, 1, true, Ave94494), 
LLST50385 = lstm_layer(Ave94494,[[7, 4, 3, 6], [6, 9, 2, 8], [10, 8, 4, 9], [8, 6, 1, 7]],[[4, 6, 4, 4]],[5, 9, 8, 4], LST50385), 
exec_layers([LMul32408,LRes18934,LRes14832,LAve94494,LLST50385],["Mul32408","Res18934","Res14832","Ave94494","LST50385"],LST50385,"LST50385")

Actual (Unparsed): [[0.7615876]]

Expected (Unparsed): [[0.7615876222442689]]

Actual:   [[0.7616]]

Expected: [[0.7616]]