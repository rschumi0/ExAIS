import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave53453 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Ave53453 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Glo40828 = tf.keras.layers.Input(shape=([1, 1]))
in0Con95940 = tf.keras.layers.Input(shape=([23]))

Ave53453 = keras.layers.Average(name = 'Ave53453', )([in0Ave53453,in1Ave53453])
Res23165 = keras.layers.Reshape((2, 2, 1), name = 'Res23165', )(Ave53453)
Con61208 = keras.layers.Conv2DTranspose(4, (1, 2),strides=(1, 1), padding='valid', name = 'Con61208', )(Res23165)
Res7324 = keras.layers.Reshape((2, 12), name = 'Res7324', )(Con61208)
Fla62562 = keras.layers.Flatten(name = 'Fla62562', )(Res7324)
Glo40828 = keras.layers.GlobalMaxPool1D(name = 'Glo40828', )(in0Glo40828)
Con95940 = keras.layers.Concatenate(axis=1, name = 'Con95940', )([Glo40828,in0Con95940])
Min78529 = keras.layers.Minimum(name = 'Min78529', )([Fla62562,Con95940])
model = tf.keras.models.Model(inputs=[in0Ave53453,in1Ave53453,in0Glo40828,in0Con95940], outputs=Min78529)
w = model.get_layer('Con61208').get_weights() 
w[0] = np.array([[[[0.5341], [0.7868], [0.4882], [0.477]], [[0.3748], [0.8547], [0.3937], [0.281]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con61208').set_weights(w) 
in0Ave53453 = tf.constant([[[[[0.6033]], [[0.5301]]], [[[0.7951]], [[0.6608]]]]])
in1Ave53453 = tf.constant([[[[[0.9212]], [[0.3785]]], [[[0.0616]], [[0.7233]]]]])
in0Glo40828 = tf.constant([[[1.3415]]])
in0Con95940 = tf.constant([[0.7485, 0.6758, 0.3807, 0.5533, 0.4211, 0.982, 0.0886, 0.59, 0.6681, 0.8244, 0.2286, 0.7017, 0.085, 0.2956, 0.3502, 0.0091, 0.9058, 0.5454, 0.2068, 0.7362, 0.2286, 0.0348, 0.2082]])
print (np.array2string(model.predict([in0Ave53453,in1Ave53453,in0Glo40828,in0Con95940],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min78529.png')

LAve53453 = average_layer([[[[[[0.6033]], [[0.5301]]], [[[0.7951]], [[0.6608]]]]], [[[[[0.9212]], [[0.3785]]], [[[0.0616]], [[0.7233]]]]]], Ave53453), 
LRes23165 = reshape_layer(Ave53453, [2, 2, 1], Res23165), 
LCon61208 = conv2D_transpose_layer(Res23165, 1, 2,[[[[0.5341], [0.7868], [0.4882], [0.477]], [[0.3748], [0.8547], [0.3937], [0.281]]]],[0, 0, 0, 0], 1, 1, false, Con61208), 
LRes7324 = reshape_layer(Con61208, [2, 12], Res7324), 
LFla62562 = flatten_layer(Res7324, Fla62562), 
LGlo40828 = global_max_pool1D_layer([[[1.3415]]], Glo40828), 
LCon95940 = concatenate_layer([Glo40828,[[0.7485, 0.6758, 0.3807, 0.5533, 0.4211, 0.982, 0.0886, 0.59, 0.6681, 0.8244, 0.2286, 0.7017, 0.085, 0.2956, 0.3502, 0.0091, 0.9058, 0.5454, 0.2068, 0.7362, 0.2286, 0.0348, 0.2082]]], 1, Con95940), 
LMin78529 = minimum_layer([Fla62562,Con95940], Min78529), 
exec_layers([LAve53453,LRes23165,LCon61208,LRes7324,LFla62562,LGlo40828,LCon95940,LMin78529],["Ave53453","Res23165","Con61208","Res7324","Fla62562","Glo40828","Con95940","Min78529"],Min78529,"Min78529")

Actual (Unparsed): [[0.4071177, 0.5997383, 0.3721304, 0.3635932, 0.5283329, 0.4211000, 0.5218871, 0.0886000, 0.1702716, 0.3882902, 0.1788579, 0.1276583, 0.2287817, 0.0850000, 0.2091205, 0.2043229, 0.0091000, 0.9058000, 0.5065002, 0.2068000, 0.2593803, 0.2286000, 0.0348000, 0.1944660]]

Expected (Unparsed): [[0.407117725,0.5997383000000001,0.37213045,0.36359325,0.52833293,0.4211,0.521887085,0.0886,0.17027164000000003,0.38829021,0.17885791,0.12765830000000003,0.228781735,0.085,0.20912047,0.20432295,0.0091,0.9058,0.506500205,0.2068,0.25938034000000004,0.2286,0.0348,0.19446605000000003]]

Actual:   [[0.4072, 0.5998, 0.3722, 0.3636, 0.5284, 0.4211, 0.5219, 0.0886, 0.1703, 0.3883, 0.1789, 0.1277, 0.2288, 0.085, 0.2092, 0.2044, 0.0091, 0.9058, 0.5066, 0.2068, 0.2594, 0.2286, 0.0348, 0.1945]]

Expected: [[0.4072, 0.5998, 0.3722, 0.3636, 0.5284, 0.4211, 0.5219, 0.0886, 0.1703, 0.3883, 0.1789, 0.1277, 0.2288, 0.085, 0.2092, 0.2044, 0.0091, 0.9058, 0.5066, 0.2068, 0.2594, 0.2286, 0.0348, 0.1945]]