import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot67780 = tf.keras.layers.Input(shape=([3]))
in1Dot67780 = tf.keras.layers.Input(shape=([3]))
in0Con60573 = tf.keras.layers.Input(shape=([1, 2]))
in0Loc38056 = tf.keras.layers.Input(shape=([2, 2]))

Dot67780 = keras.layers.Dot(axes=(1, 1), name = 'Dot67780', )([in0Dot67780,in1Dot67780])
Res32328 = keras.layers.Reshape((1, 1), name = 'Res32328', )(Dot67780)
GRU78054 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU78054', )(Res32328)
Res26943 = keras.layers.Reshape((1, 1), name = 'Res26943', )(GRU78054)
Con60573 = keras.layers.Concatenate(axis=2, name = 'Con60573', )([Res26943,in0Con60573])
Loc38056 = keras.layers.LocallyConnected1D(3, (2),strides=(1), name = 'Loc38056', )(in0Loc38056)
Mul32146 = keras.layers.Multiply(name = 'Mul32146', )([Con60573,Loc38056])
LST59851 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST59851', )(Mul32146)
model = tf.keras.models.Model(inputs=[in0Dot67780,in1Dot67780,in0Con60573,in0Loc38056], outputs=LST59851)
w = model.get_layer('GRU78054').get_weights() 
w[0] = np.array([[8, 10, 9]])
w[1] = np.array([[2, 5, 3]])
w[2] = np.array([[9, 1, 1], [9, 4, 9]])
model.get_layer('GRU78054').set_weights(w) 
w = model.get_layer('Loc38056').get_weights() 
w[0] = np.array([[[0.9533, 0.0865, 0.1356], [0.0754, 0.9701, 0.6383], [0.8584, 0.1656, 0.0359], [0.075, 0.5779, 0.3023]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc38056').set_weights(w) 
w = model.get_layer('LST59851').get_weights() 
w[0] = np.array([[1, 1, 9, 6], [5, 6, 4, 4], [9, 8, 10, 1]])
w[1] = np.array([[1, 3, 5, 1]])
w[2] = np.array([10, 5, 5, 9])
model.get_layer('LST59851').set_weights(w) 
in0Dot67780 = tf.constant([[0.0596, 0.152, 0.8866]])
in1Dot67780 = tf.constant([[0.606, 0.3716, 0.3687]])
in0Con60573 = tf.constant([[[0.911, 0.0685]]])
in0Loc38056 = tf.constant([[[0.5248, 0.0604], [0.3554, 0.0262]]])
print (np.array2string(model.predict([in0Dot67780,in1Dot67780,in0Con60573,in0Loc38056],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST59851.png')

LDot67780 = dot_layer([[0.0596, 0.152, 0.8866]], [[0.606, 0.3716, 0.3687]], 1, 1, Dot67780), 
LRes32328 = reshape_layer(Dot67780, [1, 1], Res32328), 
LGRU78054 = gru_layer(Res32328,[[8, 10, 9]],[[2, 5, 3]],[[9, 1, 1], [9, 4, 9]], true, GRU78054), 
LRes26943 = reshape_layer(GRU78054, [1, 1], Res26943), 
LCon60573 = concatenate_layer([Res26943,[[[0.911, 0.0685]]]], 2, Con60573), 
LLoc38056 = locally_connected1D_layer([[[0.5248, 0.0604], [0.3554, 0.0262]]], 2,[[[0.9533, 0.0865, 0.1356], [0.0754, 0.9701, 0.6383], [0.8584, 0.1656, 0.0359], [0.075, 0.5779, 0.3023]]],[[0, 0, 0]], 1, Loc38056), 
LMul32146 = multiply_layer([Con60573,Loc38056], Mul32146), 
LLST59851 = lstm_layer(Mul32146,[[1, 1, 9, 6], [5, 6, 4, 4], [9, 8, 10, 1]],[[1, 3, 5, 1]],[10, 5, 5, 9], LST59851), 
exec_layers([LDot67780,LRes32328,LGRU78054,LRes26943,LCon60573,LLoc38056,LMul32146,LLST59851],["Dot67780","Res32328","GRU78054","Res26943","Con60573","Loc38056","Mul32146","LST59851"],LST59851,"LST59851")

Actual (Unparsed): [[0.7615289]]

Expected (Unparsed): [[0.7615289224041466]]

Actual:   [[0.7616]]

Expected: [[0.7616]]