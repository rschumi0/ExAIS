import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Per21160 = tf.keras.layers.Input(shape=([1, 3]))
in0Glo99552 = tf.keras.layers.Input(shape=([1, 2]))
in0Con22591 = tf.keras.layers.Input(shape=([3, 1]))
in0Sub6267 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub6267 = tf.keras.layers.Input(shape=([3, 2]))
in0Con5988 = tf.keras.layers.Input(shape=([3, 1]))

Per21160 = keras.layers.Permute((1,2), name = 'Per21160',)(in0Per21160)
Zer39772 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer39772', )(Per21160)
Glo99552 = keras.layers.GlobalMaxPool1D(name = 'Glo99552', )(in0Glo99552)
Res42688 = keras.layers.Reshape((2, 1), name = 'Res42688', )(Glo99552)
Zer1910 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer1910', )(Res42688)
Con22591 = keras.layers.Concatenate(axis=2, name = 'Con22591', )([Zer1910,in0Con22591])
Sub6267 = keras.layers.Subtract(name = 'Sub6267', )([in0Sub6267,in1Sub6267])
Sub56429 = keras.layers.Subtract(name = 'Sub56429', )([Con22591,Sub6267])
Max45366 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='same', name = 'Max45366', )(Sub56429)
Lay16517 = keras.layers.LayerNormalization(axis=1, epsilon=1.1407832495920205, name = 'Lay16517', )(Max45366)
Con5988 = keras.layers.Concatenate(axis=2, name = 'Con5988', )([Lay16517,in0Con5988])
Max61988 = keras.layers.Maximum(name = 'Max61988', )([Zer39772,Con5988])
model = tf.keras.models.Model(inputs=[in0Per21160,in0Glo99552,in0Con22591,in0Sub6267,in1Sub6267,in0Con5988], outputs=Max61988)
in0Per21160 = tf.constant([[[1.0592, 1.9527, 1.8876]]])
in0Glo99552 = tf.constant([[[1.3543, 1.24]]])
in0Con22591 = tf.constant([[[0.1517], [0.4631], [0.4597]]])
in0Sub6267 = tf.constant([[[0.9085, 0.3933], [0.9491, 0.2857], [0.7789, 0.3443]]])
in1Sub6267 = tf.constant([[[0.6963, 0.9598], [0.3746, 0.2709], [0.7044, 0.4563]]])
in0Con5988 = tf.constant([[[0.2043], [0.2797], [0.6007]]])
print (np.array2string(model.predict([in0Per21160,in0Glo99552,in0Con22591,in0Sub6267,in1Sub6267,in0Con5988],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max61988.png')

LPer21160 = permute_layer([[[1.0592, 1.9527, 1.8876]]], 1,2, Per21160), 
LZer39772 = zero_padding1D_layer(Per21160, 2, 0, Zer39772), 
LGlo99552 = global_max_pool1D_layer([[[1.3543, 1.24]]], Glo99552), 
LRes42688 = reshape_layer(Glo99552, [2, 1], Res42688), 
LZer1910 = zero_padding1D_layer(Res42688, 1, 0, Zer1910), 
LCon22591 = concatenate_layer([Zer1910,[[[0.1517], [0.4631], [0.4597]]]], 2, Con22591), 
LSub6267 = subtract_layer([[[0.9085, 0.3933], [0.9491, 0.2857], [0.7789, 0.3443]]], [[[0.6963, 0.9598], [0.3746, 0.2709], [0.7044, 0.4563]]], Sub6267), 
LSub56429 = subtract_layer(Con22591,Sub6267, Sub56429), 
LMax45366 = max_pool1D_layer(Sub56429, 1, 1, true, Max45366), 
LLay16517 = layer_normalization_layer(Max45366, 1, 1.1407832495920205, Lay16517), 
LCon5988 = concatenate_layer([Lay16517,[[[0.2043], [0.2797], [0.6007]]]], 2, Con5988), 
LMax61988 = maximum_layer([Zer39772,Con5988], Max61988), 
exec_layers([LPer21160,LZer39772,LGlo99552,LRes42688,LZer1910,LCon22591,LSub6267,LSub56429,LMax45366,LLay16517,LCon5988,LMax61988],["Per21160","Zer39772","Glo99552","Res42688","Zer1910","Con22591","Sub6267","Sub56429","Max45366","Lay16517","Con5988","Max61988"],Max61988,"Max61988")

Actual (Unparsed): [[[0.0000000, 0.1292658, 0.2043000], [0.1662629, 0.0000000, 0.2797000], [1.0592000, 1.9527000, 1.8875999]]]

Expected (Unparsed): [[[0,0.12926575749059344,0.2043],[0.16626294348930284,0,0.2797],[1.0592,1.9527,1.8876]]]

Actual:   [[[0, 0.1293, 0.2043], [0.1663, 0, 0.2797], [1.0592, 1.9527, 1.8876]]]

Expected: [[[0, 0.1293, 0.2043], [0.1663, 0, 0.2797], [1.0592, 1.9527, 1.8876]]]