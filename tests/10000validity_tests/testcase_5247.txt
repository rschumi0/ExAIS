import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul16571 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul16571 = tf.keras.layers.Input(shape=([1, 1]))
in0Con61836 = tf.keras.layers.Input(shape=([1, 3]))
in0Ave74672 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Ave74672 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))

Mul16571 = keras.layers.Multiply(name = 'Mul16571', )([in0Mul16571,in1Mul16571])
Res3616 = keras.layers.Reshape((1, 1, 1), name = 'Res3616', )(Mul16571)
Cro98987 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro98987', )(Res3616)
Res90883 = keras.layers.Reshape((1, 1), name = 'Res90883', )(Cro98987)
Con61836 = keras.layers.Concatenate(axis=2, name = 'Con61836', )([Res90883,in0Con61836])
Ave74672 = keras.layers.Average(name = 'Ave74672', )([in0Ave74672,in1Ave74672])
Res11393 = keras.layers.Reshape((1, 2, 2), name = 'Res11393', )(Ave74672)
Res84365 = keras.layers.Reshape((1, 4), name = 'Res84365', )(Res11393)
Dot75560 = keras.layers.Dot(axes=(1, 1), name = 'Dot75560', )([Con61836,Res84365])
model = tf.keras.models.Model(inputs=[in0Mul16571,in1Mul16571,in0Con61836,in0Ave74672,in1Ave74672], outputs=Dot75560)
in0Mul16571 = tf.constant([[[0.3163]]])
in1Mul16571 = tf.constant([[[0.166]]])
in0Con61836 = tf.constant([[[0.5703, 0.0057, 0.4848]]])
in0Ave74672 = tf.constant([[[[[0.2374, 0.9743]], [[0.4417, 0.6908]]]]])
in1Ave74672 = tf.constant([[[[[0.0342, 0.0102]], [[0.5718, 0.7073]]]]])
print (np.array2string(model.predict([in0Mul16571,in1Mul16571,in0Con61836,in0Ave74672,in1Ave74672],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot75560.png')

LMul16571 = multiply_layer([[[[0.3163]]], [[[0.166]]]], Mul16571), 
LRes3616 = reshape_layer(Mul16571, [1, 1, 1], Res3616), 
LCro98987 = cropping2D_layer(Res3616, 0, 0, 0, 0, Cro98987), 
LRes90883 = reshape_layer(Cro98987, [1, 1], Res90883), 
LCon61836 = concatenate_layer([Res90883,[[[0.5703, 0.0057, 0.4848]]]], 2, Con61836), 
LAve74672 = average_layer([[[[[[0.2374, 0.9743]], [[0.4417, 0.6908]]]]], [[[[[0.0342, 0.0102]], [[0.5718, 0.7073]]]]]], Ave74672), 
LRes11393 = reshape_layer(Ave74672, [1, 2, 2], Res11393), 
LRes84365 = reshape_layer(Res11393, [1, 4], Res84365), 
LDot75560 = dot_layer(Con61836,Res84365, 1, 1, Dot75560), 
exec_layers([LMul16571,LRes3616,LCro98987,LRes90883,LCon61836,LAve74672,LRes11393,LRes84365,LDot75560],["Mul16571","Res3616","Cro98987","Res90883","Con61836","Ave74672","Res11393","Res84365","Dot75560"],Dot75560,"Dot75560")

Actual (Unparsed): [[[0.0071303, 0.0258460, 0.0266073, 0.0367042], [0.0774467, 0.2807302, 0.2889995, 0.3986682], [0.0007741, 0.0028058, 0.0028885, 0.0039846], [0.0658358, 0.2386428, 0.2456724, 0.3388995]]]

Expected (Unparsed): [[[0.007130287640000001,0.025845980050000005,0.026607314150000005,0.03670417949],[0.07744674,0.280730175,0.28899952500000003,0.398668215],[0.00077406,0.002805825,0.002888475,0.003984585],[0.06583584,0.23864280000000002,0.2456724,0.33889944]]]

Actual:   [[[0.0072, 0.0259, 0.0267, 0.0368], [0.0775, 0.2808, 0.289, 0.3987], [0.0008, 0.0029, 0.0029, 0.004], [0.0659, 0.2387, 0.2457, 0.3389]]]

Expected: [[[0.0072, 0.0259, 0.0267, 0.0368], [0.0775, 0.2808, 0.289, 0.3987], [0.0008, 0.0029, 0.0029, 0.004], [0.0659, 0.2387, 0.2457, 0.3389]]]