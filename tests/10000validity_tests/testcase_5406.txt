import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add43041 = tf.keras.layers.Input(shape=([2, 2]))
in1Add43041 = tf.keras.layers.Input(shape=([2, 2]))
in0Min18595 = tf.keras.layers.Input(shape=([2, 1]))
in1Min18595 = tf.keras.layers.Input(shape=([2, 1]))
in0Con38085 = tf.keras.layers.Input(shape=([2]))
in0Con61200 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

Add43041 = keras.layers.Add(name = 'Add43041', )([in0Add43041,in1Add43041])
Fla75169 = keras.layers.Flatten(name = 'Fla75169', )(Add43041)
Min18595 = keras.layers.Minimum(name = 'Min18595', )([in0Min18595,in1Min18595])
Fla66421 = keras.layers.Flatten(name = 'Fla66421', )(Min18595)
Con38085 = keras.layers.Concatenate(axis=1, name = 'Con38085', )([Fla66421,in0Con38085])
Sub61897 = keras.layers.Subtract(name = 'Sub61897', )([Fla75169,Con38085])
Res4782 = keras.layers.Reshape((4, 1), name = 'Res4782', )(Sub61897)
Con61200 = keras.layers.Conv3DTranspose(2, (1, 2, 1),strides=(1, 1, 1), padding='valid', name = 'Con61200', )(in0Con61200)
Res48702 = keras.layers.Reshape((2, 3, 2), name = 'Res48702', )(Con61200)
Loc75344 = keras.layers.LocallyConnected2D(4, (2, 1),strides=(1, 7), name = 'Loc75344', )(Res48702)
Res9514 = keras.layers.Reshape((4, 1), name = 'Res9514', )(Loc75344)
Sub73501 = keras.layers.Subtract(name = 'Sub73501', )([Res4782,Res9514])
model = tf.keras.models.Model(inputs=[in0Add43041,in1Add43041,in0Min18595,in1Min18595,in0Con38085,in0Con61200], outputs=Sub73501)
w = model.get_layer('Con61200').get_weights() 
w[0] = np.array([[[[[0.7164, 0.0742], [0.9737, 0.2087]]], [[[0.8319, 0.7586], [0.4994, 0.4773]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con61200').set_weights(w) 
w = model.get_layer('Loc75344').get_weights() 
w[0] = np.array([[[0.5929, 0.7917, 0.038, 0.3754], [0.1171, 0.4645, 0.7015, 0.7071], [0.8873, 0.271, 0.7307, 0.1011], [0.5114, 0.7312, 0.9288, 0.1271]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc75344').set_weights(w) 
in0Add43041 = tf.constant([[[0.9493, 0.2809], [0.8959, 0.0404]]])
in1Add43041 = tf.constant([[[0.2772, 0.4147], [0.838, 0.7934]]])
in0Min18595 = tf.constant([[[0.3505], [0.7621]]])
in1Min18595 = tf.constant([[[0.7599], [0.7751]]])
in0Con38085 = tf.constant([[0.4443, 0.4871]])
in0Con61200 = tf.constant([[[[[0.6577, 0.9225]], [[0.5071, 0.2897]]], [[[0.1505, 0.9939]], [[0.754, 0.9374]]]]])
print (np.array2string(model.predict([in0Add43041,in1Add43041,in0Min18595,in1Min18595,in0Con38085,in0Con61200],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub73501.png')

LAdd43041 = add_layer([[[[0.9493, 0.2809], [0.8959, 0.0404]]], [[[0.2772, 0.4147], [0.838, 0.7934]]]], Add43041), 
LFla75169 = flatten_layer(Add43041, Fla75169), 
LMin18595 = minimum_layer([[[[0.3505], [0.7621]]], [[[0.7599], [0.7751]]]], Min18595), 
LFla66421 = flatten_layer(Min18595, Fla66421), 
LCon38085 = concatenate_layer([Fla66421,[[0.4443, 0.4871]]], 1, Con38085), 
LSub61897 = subtract_layer(Fla75169,Con38085, Sub61897), 
LRes4782 = reshape_layer(Sub61897, [4, 1], Res4782), 
LCon61200 = conv3D_transpose_layer([[[[[0.6577, 0.9225]], [[0.5071, 0.2897]]], [[[0.1505, 0.9939]], [[0.754, 0.9374]]]]], 1, 2, 1,[[[[[0.7164, 0.0742], [0.9737, 0.2087]]], [[[0.8319, 0.7586], [0.4994, 0.4773]]]]],[0, 0], 1, 1, 1, false, Con61200), 
LRes48702 = reshape_layer(Con61200, [2, 3, 2], Res48702), 
LLoc75344 = locally_connected2D_layer(Res48702, 2, 1,[[[0.5929, 0.7917, 0.038, 0.3754], [0.1171, 0.4645, 0.7015, 0.7071], [0.8873, 0.271, 0.7307, 0.1011], [0.5114, 0.7312, 0.9288, 0.1271]]],[[[0, 0, 0, 0]]], 1, 7, Loc75344), 
LRes9514 = reshape_layer(Loc75344, [4, 1], Res9514), 
LSub73501 = subtract_layer(Res4782,Res9514, Sub73501), 
exec_layers([LAdd43041,LFla75169,LMin18595,LFla66421,LCon38085,LSub61897,LRes4782,LCon61200,LRes48702,LLoc75344,LRes9514,LSub73501],["Add43041","Fla75169","Min18595","Fla66421","Con38085","Sub61897","Res4782","Con61200","Res48702","Loc75344","Res9514","Sub73501"],Sub73501,"Sub73501")

Actual (Unparsed): [[[0.1163972], [-1.1886431], [0.2233589], [-0.5081848]]]

Expected (Unparsed): [[[0.1163972049080002],[-1.1886431416219998],[0.22335888783000013],[-0.5081847883919999]]]

Actual:   [[[0.1164], [-1.1886], [0.2234], [-0.5081]]]

Expected: [[[0.1164], [-1.1886], [0.2234], [-0.5081]]]