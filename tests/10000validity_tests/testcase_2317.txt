import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add89313 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Add89313 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Up_79773 = tf.keras.layers.Input(shape=([1, 1]))
in0Mul36887 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Mul36887 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))

Add89313 = keras.layers.Add(name = 'Add89313', )([in0Add89313,in1Add89313])
Res37670 = keras.layers.Reshape((1, 1, 2), name = 'Res37670', )(Add89313)
Glo72730 = keras.layers.GlobalMaxPool2D(name = 'Glo72730', )(Res37670)
Res48814 = keras.layers.Reshape((2, 1), name = 'Res48814', )(Glo72730)
Res28629 = keras.layers.Reshape((2, 1, 1), name = 'Res28629', )(Res48814)
Con33652 = keras.layers.Conv2D(3, (2, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con33652', )(Res28629)
Sep30027 = keras.layers.SeparableConv2D(2, (2, 1),strides=(2, 2), padding='same', name = 'Sep30027', )(Con33652)
Res62386 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res62386', )(Sep30027)
Zer62405 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (0, 0)), name = 'Zer62405', )(Res62386)
Up_79773 = keras.layers.UpSampling1D(size=(1), name = 'Up_79773', )(in0Up_79773)
Res84292 = keras.layers.Reshape((1, 1, 1), name = 'Res84292', )(Up_79773)
Res96806 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res96806', )(Res84292)
Zer25734 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (1, 0)), name = 'Zer25734', )(Res96806)
Mul36887 = keras.layers.Multiply(name = 'Mul36887', )([in0Mul36887,in1Mul36887])
Sub52964 = keras.layers.Subtract(name = 'Sub52964', )([Zer25734,Mul36887])
Max36993 = keras.layers.Maximum(name = 'Max36993', )([Zer62405,Sub52964])
model = tf.keras.models.Model(inputs=[in0Add89313,in1Add89313,in0Up_79773,in0Mul36887,in1Mul36887], outputs=Max36993)
w = model.get_layer('Con33652').get_weights() 
w[0] = np.array([[[[0.159, 0.6325, 0.8942]]], [[[0.6166, 0.4149, 0.4713]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con33652').set_weights(w) 
w = model.get_layer('Sep30027').get_weights() 
w[0] = np.array([[[[0.5779], [0.469], [0.7992]]], [[[0.5268], [0.286], [0.9329]]]])
w[1] = np.array([[[[0.207, 0.9849], [0.9574, 0.4697], [0.6165, 0.3483]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep30027').set_weights(w) 
in0Add89313 = tf.constant([[[[[0.8067], [0.2587]]]]])
in1Add89313 = tf.constant([[[[[0.2594], [0.6399]]]]])
in0Up_79773 = tf.constant([[[1.7945]]])
in0Mul36887 = tf.constant([[[[[0.9743], [0.131]], [[0.0687], [0.6935]]], [[[0.6883], [0.3979]], [[0.7157], [0.5035]]]]])
in1Mul36887 = tf.constant([[[[[0.172], [0.9184]], [[0.4555], [0.9677]]], [[[0.4606], [0.3823]], [[0.0348], [0.3218]]]]])
print (np.array2string(model.predict([in0Add89313,in1Add89313,in0Up_79773,in0Mul36887,in1Mul36887],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max36993.png')

LAdd89313 = add_layer([[[[[[0.8067], [0.2587]]]]], [[[[[0.2594], [0.6399]]]]]], Add89313), 
LRes37670 = reshape_layer(Add89313, [1, 1, 2], Res37670), 
LGlo72730 = global_max_pool2D_layer(Res37670, Glo72730), 
LRes48814 = reshape_layer(Glo72730, [2, 1], Res48814), 
LRes28629 = reshape_layer(Res48814, [2, 1, 1], Res28629), 
LCon33652 = conv2D_layer(Res28629, 2, 1,[[[[0.159, 0.6325, 0.8942]]], [[[0.6166, 0.4149, 0.4713]]]],[0, 0, 0], 1, 1, true, 1, 1, Con33652), 
LSep30027 = separable_conv2D_layer(Con33652, 2, 1,[[[[[0.5779], [0.469], [0.7992]]], [[[0.5268], [0.286], [0.9329]]]],[[[[0.207, 0.9849], [0.9574, 0.4697], [0.6165, 0.3483]]]]],[0, 0], 2, 2, true, Sep30027), 
LRes62386 = reshape_layer(Sep30027, [1, 1, 2, 1], Res62386), 
LZer62405 = zero_padding3D_layer(Res62386, 1, 0, 1, 0, 0, 0, Zer62405), 
LUp_79773 = up_sampling1D_layer([[[1.7945]]], 1, Up_79773), 
LRes84292 = reshape_layer(Up_79773, [1, 1, 1], Res84292), 
LRes96806 = reshape_layer(Res84292, [1, 1, 1, 1], Res96806), 
LZer25734 = zero_padding3D_layer(Res96806, 1, 0, 1, 0, 1, 0, Zer25734), 
LMul36887 = multiply_layer([[[[[[0.9743], [0.131]], [[0.0687], [0.6935]]], [[[0.6883], [0.3979]], [[0.7157], [0.5035]]]]], [[[[[0.172], [0.9184]], [[0.4555], [0.9677]]], [[[0.4606], [0.3823]], [[0.0348], [0.3218]]]]]], Mul36887), 
LSub52964 = subtract_layer(Zer25734,Mul36887, Sub52964), 
LMax36993 = maximum_layer([Zer62405,Sub52964], Max36993), 
exec_layers([LAdd89313,LRes37670,LGlo72730,LRes48814,LRes28629,LCon33652,LSep30027,LRes62386,LZer62405,LUp_79773,LRes84292,LRes96806,LZer25734,LMul36887,LSub52964,LMax36993],["Add89313","Res37670","Glo72730","Res48814","Res28629","Con33652","Sep30027","Res62386","Zer62405","Up_79773","Res84292","Res96806","Zer25734","Mul36887","Sub52964","Max36993"],Max36993,"Max36993")

Actual (Unparsed): [[[[[0.0000000], [0.0000000]], [[0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000]], [[1.8684560], [1.6324737]]]]]

Expected (Unparsed): [[[[[0],[0]],[[0],[0]]],[[[0],[0]],[[1.868455906685754],[1.6324737]]]]]

Actual:   [[[[[0], [0]], [[0], [0]]], [[[0], [0]], [[1.8685], [1.6325]]]]]

Expected: [[[[[0], [0]], [[0], [0]]], [[[0], [0]], [[1.8685], [1.6325]]]]]