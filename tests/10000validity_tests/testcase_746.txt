import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Thr18792 = tf.keras.layers.Input(shape=([1, 1]))
in0Con25825 = tf.keras.layers.Input(shape=([3]))
in0Con48650 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0GRU82399 = tf.keras.layers.Input(shape=([1, 2]))
in0Con50564 = tf.keras.layers.Input(shape=([1]))
in0Dot55113 = tf.keras.layers.Input(shape=([2]))
in1Dot55113 = tf.keras.layers.Input(shape=([2]))
in0Con41611 = tf.keras.layers.Input(shape=([3]))

Thr18792 = keras.layers.ThresholdedReLU(theta=9.963256322686883, name = 'Thr18792', input_shape=(1, 1))(in0Thr18792)
Fla81784 = keras.layers.Flatten(name = 'Fla81784', )(Thr18792)
Con25825 = keras.layers.Concatenate(axis=1, name = 'Con25825', )([Fla81784,in0Con25825])
Con48650 = keras.layers.Conv3DTranspose(2, (1, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con48650', )(in0Con48650)
Res38368 = keras.layers.Reshape((1, 1, 4), name = 'Res38368', )(Con48650)
Res29063 = keras.layers.Reshape((1, 4), name = 'Res29063', )(Res38368)
Fla60837 = keras.layers.Flatten(name = 'Fla60837', )(Res29063)
GRU82399 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU82399', )(in0GRU82399)
Con50564 = keras.layers.Concatenate(axis=1, name = 'Con50564', )([GRU82399,in0Con50564])
Max26626 = keras.layers.Maximum(name = 'Max26626', )([Fla60837,Con50564])
Dot55113 = keras.layers.Dot(axes=(1, 1), name = 'Dot55113', )([in0Dot55113,in1Dot55113])
Con41611 = keras.layers.Concatenate(axis=1, name = 'Con41611', )([Dot55113,in0Con41611])
Min66830 = keras.layers.Minimum(name = 'Min66830', )([Max26626,Con41611])
Mul16525 = keras.layers.Multiply(name = 'Mul16525', )([Con25825,Min66830])
model = tf.keras.models.Model(inputs=[in0Thr18792,in0Con25825,in0Con48650,in0GRU82399,in0Con50564,in0Dot55113,in1Dot55113,in0Con41611], outputs=Mul16525)
w = model.get_layer('Con48650').get_weights() 
w[0] = np.array([[[[[0.1844], [0.8232]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con48650').set_weights(w) 
w = model.get_layer('GRU82399').get_weights() 
w[0] = np.array([[8, 9, 8, 1, 8, 9, 8, 5, 7], [10, 8, 7, 1, 10, 2, 9, 10, 6]])
w[1] = np.array([[3, 4, 9, 2, 1, 8, 5, 9, 10], [8, 5, 7, 9, 2, 2, 4, 1, 7], [3, 5, 6, 6, 8, 9, 4, 8, 8]])
w[2] = np.array([[8, 5, 6, 9, 7, 5, 9, 3, 10], [3, 6, 10, 6, 10, 3, 10, 6, 6]])
model.get_layer('GRU82399').set_weights(w) 
in0Thr18792 = tf.constant([[[0.677]]])
in0Con25825 = tf.constant([[0.8365, 0.3251, 0.3716]])
in0Con48650 = tf.constant([[[[[0.8323], [0.9261]]]]])
in0GRU82399 = tf.constant([[[4, 1]]])
in0Con50564 = tf.constant([[0.7092]])
in0Dot55113 = tf.constant([[0.3495, 0.8796]])
in1Dot55113 = tf.constant([[0.5445, 0.1133]])
in0Con41611 = tf.constant([[0.4414, 0.3085, 0.5202]])
print (np.array2string(model.predict([in0Thr18792,in0Con25825,in0Con48650,in0GRU82399,in0Con50564,in0Dot55113,in1Dot55113,in0Con41611],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul16525.png')

LThr18792 = thresholded_relu_layer([[[0.677]]], 9.963256322686883, Thr18792), 
LFla81784 = flatten_layer(Thr18792, Fla81784), 
LCon25825 = concatenate_layer([Fla81784,[[0.8365, 0.3251, 0.3716]]], 1, Con25825), 
LCon48650 = conv3D_transpose_layer([[[[[0.8323], [0.9261]]]]], 1, 1, 1,[[[[[0.1844], [0.8232]]]]],[0, 0], 1, 1, 1, false, Con48650), 
LRes38368 = reshape_layer(Con48650, [1, 1, 4], Res38368), 
LRes29063 = reshape_layer(Res38368, [1, 4], Res29063), 
LFla60837 = flatten_layer(Res29063, Fla60837), 
LGRU82399 = gru_layer([[[4, 1]]],[[8, 9, 8, 1, 8, 9, 8, 5, 7], [10, 8, 7, 1, 10, 2, 9, 10, 6]],[[3, 4, 9, 2, 1, 8, 5, 9, 10], [8, 5, 7, 9, 2, 2, 4, 1, 7], [3, 5, 6, 6, 8, 9, 4, 8, 8]],[[8, 5, 6, 9, 7, 5, 9, 3, 10], [3, 6, 10, 6, 10, 3, 10, 6, 6]], true, GRU82399), 
LCon50564 = concatenate_layer([GRU82399,[[0.7092]]], 1, Con50564), 
LMax26626 = maximum_layer([Fla60837,Con50564], Max26626), 
LDot55113 = dot_layer([[0.3495, 0.8796]], [[0.5445, 0.1133]], 1, 1, Dot55113), 
LCon41611 = concatenate_layer([Dot55113,[[0.4414, 0.3085, 0.5202]]], 1, Con41611), 
LMin66830 = minimum_layer([Max26626,Con41611], Min66830), 
LMul16525 = multiply_layer([Con25825,Min66830], Mul16525), 
exec_layers([LThr18792,LFla81784,LCon25825,LCon48650,LRes38368,LRes29063,LFla60837,LGRU82399,LCon50564,LMax26626,LDot55113,LCon41611,LMin66830,LMul16525],["Thr18792","Fla81784","Con25825","Con48650","Res38368","Res29063","Fla60837","GRU82399","Con50564","Max26626","Dot55113","Con41611","Min66830","Mul16525"],Mul16525,"Mul16525")

Actual (Unparsed): [[0.0000000, 0.3692311, 0.0555183, 0.1933063]]

Expected (Unparsed): [[0.0,0.36923110000000003,0.055518250284,0.19330632]]

Actual:   [[0, 0.3693, 0.0556, 0.1934]]

Expected: [[0, 0.3693, 0.0556, 0.1934]]