import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave97466 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Ave97466 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Dot64382 = tf.keras.layers.Input(shape=([3]))
in1Dot64382 = tf.keras.layers.Input(shape=([3]))
in0Con15266 = tf.keras.layers.Input(shape=([3, 3, 2]))
in0Min74630 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Min74630 = tf.keras.layers.Input(shape=([2, 2, 1]))

Ave97466 = keras.layers.Average(name = 'Ave97466', )([in0Ave97466,in1Ave97466])
Zer2668 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer2668', )(Ave97466)
Dot64382 = keras.layers.Dot(axes=(1, 1), name = 'Dot64382', )([in0Dot64382,in1Dot64382])
Res73997 = keras.layers.Reshape((1, 1), name = 'Res73997', )(Dot64382)
Res15470 = keras.layers.Reshape((1, 1, 1), name = 'Res15470', )(Res73997)
Zer38186 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer38186', )(Res15470)
Mul26812 = keras.layers.Multiply(name = 'Mul26812', )([Zer2668,Zer38186])
Con15266 = keras.layers.Concatenate(axis=3, name = 'Con15266', )([Mul26812,in0Con15266])
Min74630 = keras.layers.Minimum(name = 'Min74630', )([in0Min74630,in1Min74630])
Sep58091 = keras.layers.SeparableConv2D(3, (2, 1),strides=(2, 2), padding='same', name = 'Sep58091', )(Min74630)
Zer39709 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer39709', )(Sep58091)
Add86166 = keras.layers.Add(name = 'Add86166', )([Con15266,Zer39709])
model = tf.keras.models.Model(inputs=[in0Ave97466,in1Ave97466,in0Dot64382,in1Dot64382,in0Con15266,in0Min74630,in1Min74630], outputs=Add86166)
w = model.get_layer('Sep58091').get_weights() 
w[0] = np.array([[[[0.1495]]], [[[0.4345]]]])
w[1] = np.array([[[[0.4223, 0.7871, 0.6643]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep58091').set_weights(w) 
in0Ave97466 = tf.constant([[[[0.1163]]]])
in1Ave97466 = tf.constant([[[[0.487]]]])
in0Dot64382 = tf.constant([[0.6127, 0.208, 0.0483]])
in1Dot64382 = tf.constant([[0.0037, 0.1788, 0.1087]])
in0Con15266 = tf.constant([[[[0.453, 0.5949], [0.3954, 0.9986], [0.4041, 0.6253]], [[0.6076, 0.2603], [0.4895, 0.5494], [0.3085, 0.9479]], [[0.7494, 0.6762], [0.9331, 0.1175], [0.9338, 0.1625]]]])
in0Min74630 = tf.constant([[[[0.125], [0.8052]], [[0.6238], [0.696]]]])
in1Min74630 = tf.constant([[[[0.6006], [0.8159]], [[0.0002], [0.8776]]]])
print (np.array2string(model.predict([in0Ave97466,in1Ave97466,in0Dot64382,in1Dot64382,in0Con15266,in0Min74630,in1Min74630],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add86166.png')

LAve97466 = average_layer([[[[[0.1163]]]], [[[[0.487]]]]], Ave97466), 
LZer2668 = zero_padding2D_layer(Ave97466, 2, 0, 2, 0, Zer2668), 
LDot64382 = dot_layer([[0.6127, 0.208, 0.0483]], [[0.0037, 0.1788, 0.1087]], 1, 1, Dot64382), 
LRes73997 = reshape_layer(Dot64382, [1, 1], Res73997), 
LRes15470 = reshape_layer(Res73997, [1, 1, 1], Res15470), 
LZer38186 = zero_padding2D_layer(Res15470, 1, 1, 1, 1, Zer38186), 
LMul26812 = multiply_layer([Zer2668,Zer38186], Mul26812), 
LCon15266 = concatenate_layer([Mul26812,[[[[0.453, 0.5949], [0.3954, 0.9986], [0.4041, 0.6253]], [[0.6076, 0.2603], [0.4895, 0.5494], [0.3085, 0.9479]], [[0.7494, 0.6762], [0.9331, 0.1175], [0.9338, 0.1625]]]]], 3, Con15266), 
LMin74630 = minimum_layer([[[[[0.125], [0.8052]], [[0.6238], [0.696]]]], [[[[0.6006], [0.8159]], [[0.0002], [0.8776]]]]], Min74630), 
LSep58091 = separable_conv2D_layer(Min74630, 2, 1,[[[[[0.1495]]], [[[0.4345]]]],[[[[0.4223, 0.7871, 0.6643]]]]],[0, 0, 0], 2, 2, true, Sep58091), 
LZer39709 = zero_padding2D_layer(Sep58091, 2, 0, 2, 0, Zer39709), 
LAdd86166 = add_layer([Con15266,Zer39709], Add86166), 
exec_layers([LAve97466,LZer2668,LDot64382,LRes73997,LRes15470,LZer38186,LMul26812,LCon15266,LMin74630,LSep58091,LZer39709,LAdd86166],["Ave97466","Zer2668","Dot64382","Res73997","Res15470","Zer38186","Mul26812","Con15266","Min74630","Sep58091","Zer39709","Add86166"],Add86166,"Add86166")

Actual (Unparsed): [[[[0.0000000, 0.4530000, 0.5949000], [0.0000000, 0.3954000, 0.9986000], [0.0000000, 0.4041000, 0.6253000]], [[0.0000000, 0.6076000, 0.2603000], [0.0000000, 0.4895000, 0.5494000], [0.0000000, 0.3085000, 0.9479000]], [[0.0000000, 0.7494000, 0.6762000], [0.0000000, 0.9331000, 0.1175000], [0.0079284, 0.9485773, 0.1749718]]]]

Expected (Unparsed): [[[[0,0.453,0.5949],[0,0.3954,0.9986],[0,0.4041,0.6253]],[[0,0.6076,0.2603],[0.0,0.4895,0.5494],[0,0.3085,0.9479]],[[0,0.7494,0.6762],[0,0.9331,0.1175],[0.00792842912,0.94857733024,0.17497183392000001]]]]

Actual:   [[[[0, 0.453, 0.5949], [0, 0.3954, 0.9986], [0, 0.4041, 0.6253]], [[0, 0.6076, 0.2603], [0, 0.4895, 0.5494], [0, 0.3085, 0.9479]], [[0, 0.7494, 0.6762], [0, 0.9331, 0.1175], [0.008, 0.9486, 0.175]]]]

Expected: [[[[0, 0.453, 0.5949], [0, 0.3954, 0.9986], [0, 0.4041, 0.6253]], [[0, 0.6076, 0.2603], [0, 0.4895, 0.5494], [0, 0.3085, 0.9479]], [[0, 0.7494, 0.6762], [0, 0.9331, 0.1175], [0.008, 0.9486, 0.175]]]]