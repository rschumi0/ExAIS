import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con19099 = tf.keras.layers.Input(shape=([2, 1]))
in0Con11781 = tf.keras.layers.Input(shape=([2, 1]))
in0Max94646 = tf.keras.layers.Input(shape=([2, 1]))
in1Max94646 = tf.keras.layers.Input(shape=([2, 1]))
in0Con40406 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Mul10993 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Mul10993 = tf.keras.layers.Input(shape=([2, 1, 2]))

Con19099 = keras.layers.Conv1D(3, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con19099', )(in0Con19099)
Con11781 = keras.layers.Concatenate(axis=2, name = 'Con11781', )([Con19099,in0Con11781])
Max94646 = keras.layers.Maximum(name = 'Max94646', )([in0Max94646,in1Max94646])
Res18093 = keras.layers.Reshape((2, 1, 1), name = 'Res18093', )(Max94646)
Con40406 = keras.layers.Concatenate(axis=3, name = 'Con40406', )([Res18093,in0Con40406])
Mul10993 = keras.layers.Multiply(name = 'Mul10993', )([in0Mul10993,in1Mul10993])
Mul85261 = keras.layers.Multiply(name = 'Mul85261', )([Con40406,Mul10993])
Res39150 = keras.layers.Reshape((2, 2), name = 'Res39150', )(Mul85261)
Dot16156 = keras.layers.Dot(axes=(1, 1), name = 'Dot16156', )([Con11781,Res39150])
Den92219 = keras.layers.Dense(1,name = 'Den92219', )(Dot16156)
model = tf.keras.models.Model(inputs=[in0Con19099,in0Con11781,in0Max94646,in1Max94646,in0Con40406,in0Mul10993,in1Mul10993], outputs=Den92219)
w = model.get_layer('Con19099').get_weights() 
w[0] = np.array([[[0.835, 0.3179, 0.7112]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con19099').set_weights(w) 
w = model.get_layer('Den92219').get_weights() 
w[0] = np.array([[0.0232], [0.7067]])
w[1] = np.array([0.5515])
model.get_layer('Den92219').set_weights(w) 
in0Con19099 = tf.constant([[[0.6746], [0.8399]]])
in0Con11781 = tf.constant([[[0.7128], [0.0429]]])
in0Max94646 = tf.constant([[[0.8417], [0.2941]]])
in1Max94646 = tf.constant([[[0.3271], [0.0152]]])
in0Con40406 = tf.constant([[[[0.7605]], [[0.7771]]]])
in0Mul10993 = tf.constant([[[[0.176, 0.2142]], [[0.377, 0.4848]]]])
in1Mul10993 = tf.constant([[[[0.6774, 0.6558]], [[0.7847, 0.0497]]]])
print (np.array2string(model.predict([in0Con19099,in0Con11781,in0Max94646,in1Max94646,in0Con40406,in0Mul10993,in1Mul10993],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Den92219.png')

LCon19099 = conv1D_layer([[[0.6746], [0.8399]]], 1,[[[0.835, 0.3179, 0.7112]]],[0, 0, 0], 1, false, 1, Con19099), 
LCon11781 = concatenate_layer([Con19099,[[[0.7128], [0.0429]]]], 2, Con11781), 
LMax94646 = maximum_layer([[[[0.8417], [0.2941]]], [[[0.3271], [0.0152]]]], Max94646), 
LRes18093 = reshape_layer(Max94646, [2, 1, 1], Res18093), 
LCon40406 = concatenate_layer([Res18093,[[[[0.7605]], [[0.7771]]]]], 3, Con40406), 
LMul10993 = multiply_layer([[[[[0.176, 0.2142]], [[0.377, 0.4848]]]], [[[[0.6774, 0.6558]], [[0.7847, 0.0497]]]]], Mul10993), 
LMul85261 = multiply_layer([Con40406,Mul10993], Mul85261), 
LRes39150 = reshape_layer(Mul85261, [2, 2], Res39150), 
LDot16156 = dot_layer(Con11781,Res39150, 1, 1, Dot16156), 
LDen92219 = dense_layer(Dot16156, [[0.0232], [0.7067]],[0.5515], Den92219), 
exec_layers([LCon19099,LCon11781,LMax94646,LRes18093,LCon40406,LMul10993,LMul85261,LRes39150,LDot16156,LDen92219],["Con19099","Con11781","Max94646","Res18093","Con40406","Mul10993","Mul85261","Res39150","Dot16156","Den92219"],Den92219,"Den92219")

Actual (Unparsed): [[[0.6060333], [0.5722618], [0.5979480], [0.6076274]]]

Expected (Unparsed): [[[0.6060332843830205],[0.5722618336591164],[0.5979479902433583],[0.6076274323245365]]]

Actual:   [[[0.6061], [0.5723], [0.598], [0.6077]]]

Expected: [[[0.6061], [0.5723], [0.598], [0.6077]]]