import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul91959 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul91959 = tf.keras.layers.Input(shape=([2, 1]))

Mul91959 = keras.layers.Multiply(name = 'Mul91959', )([in0Mul91959,in1Mul91959])
Res21118 = keras.layers.Reshape((2, 1, 1), name = 'Res21118', )(Mul91959)
Res26167 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res26167', )(Res21118)
Con12830 = keras.layers.Conv3D(4, (2, 1, 1),strides=(1, 11, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con12830', )(Res26167)
Con31679 = keras.layers.Conv3DTranspose(3, (1, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con31679', )(Con12830)
model = tf.keras.models.Model(inputs=[in0Mul91959,in1Mul91959], outputs=Con31679)
w = model.get_layer('Con12830').get_weights() 
w[0] = np.array([[[[[0.0977, 0.2589, 0.5727, 0.2329]]]], [[[[0.0944, 0.7901, 0.8997, 0.4482]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con12830').set_weights(w) 
w = model.get_layer('Con31679').get_weights() 
w[0] = np.array([[[[[0.1904, 0.5986, 0.1936, 0.3566], [0.0816, 0.8929, 0.3869, 0.6379], [0.361, 0.8742, 0.9318, 0.392]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con31679').set_weights(w) 
in0Mul91959 = tf.constant([[[0.3854], [0.5418]]])
in1Mul91959 = tf.constant([[[0.9429], [0.5273]]])
print (np.array2string(model.predict([in0Mul91959,in1Mul91959],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con31679.png')

LMul91959 = multiply_layer([[[[0.3854], [0.5418]]], [[[0.9429], [0.5273]]]], Mul91959), 
LRes21118 = reshape_layer(Mul91959, [2, 1, 1], Res21118), 
LRes26167 = reshape_layer(Res21118, [2, 1, 1, 1], Res26167), 
LCon12830 = conv3D_layer(Res26167, 2, 1, 1,[[[[[0.0977, 0.2589, 0.5727, 0.2329]]]], [[[[0.0944, 0.7901, 0.8997, 0.4482]]]]],[0, 0, 0, 0], 1, 11, 1, true, 1, 1, 1, Con12830), 
LCon31679 = conv3D_transpose_layer(Con12830, 1, 1, 1,[[[[[0.1904, 0.5986, 0.1936, 0.3566], [0.0816, 0.8929, 0.3869, 0.6379], [0.361, 0.8742, 0.9318, 0.392]]]]],[0, 0, 0], 1, 1, 1, false, Con31679), 
exec_layers([LMul91959,LRes21118,LRes26167,LCon12830,LCon31679],["Mul91959","Res21118","Res26167","Con12830","Con31679"],Con31679,"Con31679")

Actual (Unparsed): [[[[[0.3692269, 0.6062902, 0.8189277]]], [[[0.1049933, 0.1740684, 0.2532763]]]]]

Expected (Unparsed): [[[[[0.36922690535524916,0.6062901839652378,0.8189276484028835]]],[[[0.10499334522858718,0.17406837472138376,0.25327626328476355]]]]]

Actual:   [[[[[0.3693, 0.6063, 0.819]]], [[[0.105, 0.1741, 0.2533]]]]]

Expected: [[[[[0.3693, 0.6063, 0.819]]], [[[0.105, 0.1741, 0.2533]]]]]