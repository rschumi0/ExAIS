import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sof26727 = tf.keras.layers.Input(shape=([1, 2]))
in0Dot66937 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot66937 = tf.keras.layers.Input(shape=([3, 2]))
in0Con84964 = tf.keras.layers.Input(shape=([1]))

Sof26727 = keras.layers.Softmax(axis=1, name = 'Sof26727', input_shape=(1, 2))(in0Sof26727)
Fla25608 = keras.layers.Flatten(name = 'Fla25608', )(Sof26727)
Dot66937 = keras.layers.Dot(axes=(2, 2), name = 'Dot66937', )([in0Dot66937,in1Dot66937])
Res8127 = keras.layers.Reshape((3, 3, 1), name = 'Res8127', )(Dot66937)
Glo30066 = keras.layers.GlobalMaxPool2D(name = 'Glo30066', )(Res8127)
Res45473 = keras.layers.Reshape((1, 1), name = 'Res45473', )(Glo30066)
Glo73796 = keras.layers.GlobalMaxPool1D(name = 'Glo73796', )(Res45473)
Con84964 = keras.layers.Concatenate(axis=1, name = 'Con84964', )([Glo73796,in0Con84964])
Mul75701 = keras.layers.Multiply(name = 'Mul75701', )([Fla25608,Con84964])
Res54148 = keras.layers.Reshape((2, 1), name = 'Res54148', )(Mul75701)
Max73120 = keras.layers.MaxPool1D(pool_size=(1), strides=(2), padding='valid', name = 'Max73120', )(Res54148)
model = tf.keras.models.Model(inputs=[in0Sof26727,in0Dot66937,in1Dot66937,in0Con84964], outputs=Max73120)
in0Sof26727 = tf.constant([[[0.6376, 0.5865]]])
in0Dot66937 = tf.constant([[[0.9078, 0.6469], [0.3411, 0.3111], [0.2551, 0.2879]]])
in1Dot66937 = tf.constant([[[0.7859, 0.8948], [0.4787, 0.0246], [0.2946, 0.6443]]])
in0Con84964 = tf.constant([[0.775]])
print (np.array2string(model.predict([in0Sof26727,in0Dot66937,in1Dot66937,in0Con84964],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max73120.png')

LSof26727 = softmax_layer([[[0.6376, 0.5865]]], 1, Sof26727), 
LFla25608 = flatten_layer(Sof26727, Fla25608), 
LDot66937 = dot_layer([[[0.9078, 0.6469], [0.3411, 0.3111], [0.2551, 0.2879]]], [[[0.7859, 0.8948], [0.4787, 0.0246], [0.2946, 0.6443]]], 2, 2, Dot66937), 
LRes8127 = reshape_layer(Dot66937, [3, 3, 1], Res8127), 
LGlo30066 = global_max_pool2D_layer(Res8127, Glo30066), 
LRes45473 = reshape_layer(Glo30066, [1, 1], Res45473), 
LGlo73796 = global_max_pool1D_layer(Res45473, Glo73796), 
LCon84964 = concatenate_layer([Glo73796,[[0.775]]], 1, Con84964), 
LMul75701 = multiply_layer([Fla25608,Con84964], Mul75701), 
LRes54148 = reshape_layer(Mul75701, [2, 1], Res54148), 
LMax73120 = max_pool1D_layer(Res54148, 1, 2, false, Max73120), 
exec_layers([LSof26727,LFla25608,LDot66937,LRes8127,LGlo30066,LRes45473,LGlo73796,LCon84964,LMul75701,LRes54148,LMax73120],["Sof26727","Fla25608","Dot66937","Res8127","Glo30066","Res45473","Glo73796","Con84964","Mul75701","Res54148","Max73120"],Max73120,"Max73120")

Actual (Unparsed): [[[1.2922862]]]

Expected (Unparsed): [[[1.29228614]]]

Actual:   [[[1.2923]]]

Expected: [[[1.2923]]]