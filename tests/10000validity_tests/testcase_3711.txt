import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sep80971 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Mul51768 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Mul51768 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Mul4677 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Mul4677 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Add28626 = tf.keras.layers.Input(shape=([2, 2]))
in1Add28626 = tf.keras.layers.Input(shape=([2, 2]))

Sep80971 = keras.layers.SeparableConv2D(2, (1, 1),strides=(1, 1), padding='valid', name = 'Sep80971', )(in0Sep80971)
Res54955 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res54955', )(Sep80971)
Zer20909 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (0, 0)), name = 'Zer20909', )(Res54955)
Mul51768 = keras.layers.Multiply(name = 'Mul51768', )([in0Mul51768,in1Mul51768])
Min49314 = keras.layers.Minimum(name = 'Min49314', )([Zer20909,Mul51768])
Res92570 = keras.layers.Reshape((2, 1, 2), name = 'Res92570', )(Min49314)
Res58057 = keras.layers.Reshape((2, 2), name = 'Res58057', )(Res92570)
Mul4677 = keras.layers.Multiply(name = 'Mul4677', )([in0Mul4677,in1Mul4677])
Res15076 = keras.layers.Reshape((1, 2, 1), name = 'Res15076', )(Mul4677)
Res83412 = keras.layers.Reshape((1, 2), name = 'Res83412', )(Res15076)
Zer19711 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer19711', )(Res83412)
Dot46175 = keras.layers.Dot(axes=(2, 2), name = 'Dot46175', )([Res58057,Zer19711])
Add28626 = keras.layers.Add(name = 'Add28626', )([in0Add28626,in1Add28626])
Mul47768 = keras.layers.Multiply(name = 'Mul47768', )([Dot46175,Add28626])
Res60187 = keras.layers.Reshape((2, 2, 1), name = 'Res60187', )(Mul47768)
Res43417 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res43417', )(Res60187)
Con2906 = keras.layers.Conv3D(2, (1, 2, 1),strides=(1, 2, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con2906', )(Res43417)
model = tf.keras.models.Model(inputs=[in0Sep80971,in0Mul51768,in1Mul51768,in0Mul4677,in1Mul4677,in0Add28626,in1Add28626], outputs=Con2906)
w = model.get_layer('Sep80971').get_weights() 
w[0] = np.array([[[[0.3007], [0.2588]]]])
w[1] = np.array([[[[0.642, 0.966], [0.9519, 0.283]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep80971').set_weights(w) 
w = model.get_layer('Con2906').get_weights() 
w[0] = np.array([[[[[0.6542, 0.0172]]], [[[0.884, 0.9598]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con2906').set_weights(w) 
in0Sep80971 = tf.constant([[[[0.5535, 0.4806]]]])
in0Mul51768 = tf.constant([[[[[0.8011], [0.3754]]], [[[0.0035], [0.3419]]]]])
in1Mul51768 = tf.constant([[[[[0.2715], [0.1617]]], [[[0.6726], [0.0395]]]]])
in0Mul4677 = tf.constant([[[[[0.2062]], [[0.3001]]]]])
in1Mul4677 = tf.constant([[[[[0.2515]], [[0.8616]]]]])
in0Add28626 = tf.constant([[[0.7595, 0.6022], [0.6626, 0.0137]]])
in1Add28626 = tf.constant([[[0.0979, 0.7337], [0.8105, 0.0282]]])
print (np.array2string(model.predict([in0Sep80971,in0Mul51768,in1Mul51768,in0Mul4677,in1Mul4677,in0Add28626,in1Add28626],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con2906.png')

LSep80971 = separable_conv2D_layer([[[[0.5535, 0.4806]]]], 1, 1,[[[[[0.3007], [0.2588]]]],[[[[0.642, 0.966], [0.9519, 0.283]]]]],[0, 0], 1, 1, false, Sep80971), 
LRes54955 = reshape_layer(Sep80971, [1, 1, 2, 1], Res54955), 
LZer20909 = zero_padding3D_layer(Res54955, 1, 0, 0, 0, 0, 0, Zer20909), 
LMul51768 = multiply_layer([[[[[[0.8011], [0.3754]]], [[[0.0035], [0.3419]]]]], [[[[[0.2715], [0.1617]]], [[[0.6726], [0.0395]]]]]], Mul51768), 
LMin49314 = minimum_layer([Zer20909,Mul51768], Min49314), 
LRes92570 = reshape_layer(Min49314, [2, 1, 2], Res92570), 
LRes58057 = reshape_layer(Res92570, [2, 2], Res58057), 
LMul4677 = multiply_layer([[[[[[0.2062]], [[0.3001]]]]], [[[[[0.2515]], [[0.8616]]]]]], Mul4677), 
LRes15076 = reshape_layer(Mul4677, [1, 2, 1], Res15076), 
LRes83412 = reshape_layer(Res15076, [1, 2], Res83412), 
LZer19711 = zero_padding1D_layer(Res83412, 1, 0, Zer19711), 
LDot46175 = dot_layer(Res58057,Zer19711, 2, 2, Dot46175), 
LAdd28626 = add_layer([[[[0.7595, 0.6022], [0.6626, 0.0137]]], [[[0.0979, 0.7337], [0.8105, 0.0282]]]], Add28626), 
LMul47768 = multiply_layer([Dot46175,Add28626], Mul47768), 
LRes60187 = reshape_layer(Mul47768, [2, 2, 1], Res60187), 
LRes43417 = reshape_layer(Res60187, [2, 2, 1, 1], Res43417), 
LCon2906 = conv3D_layer(Res43417, 1, 2, 1,[[[[[0.6542, 0.0172]]], [[[0.884, 0.9598]]]]],[0, 0], 1, 2, 1, false, 1, 1, 1, Con2906), 
exec_layers([LSep80971,LRes54955,LZer20909,LMul51768,LMin49314,LRes92570,LRes58057,LMul4677,LRes15076,LRes83412,LZer19711,LDot46175,LAdd28626,LMul47768,LRes60187,LRes43417,LCon2906],["Sep80971","Res54955","Zer20909","Mul51768","Min49314","Res92570","Res58057","Mul4677","Res15076","Res83412","Zer19711","Dot46175","Add28626","Mul47768","Res60187","Res43417","Con2906"],Con2906,"Con2906")

Actual (Unparsed): [[[[[0.0000000, 0.0000000]]], [[[0.0001339, 0.0001453]]]]]

Expected (Unparsed): [[[[[0.0,0.0]]],[[[0.00013386225882133662,0.00014534049323158246]]]]]

Actual:   [[[[[0, 0]]], [[[0.0002, 0.0002]]]]]

Expected: [[[[[0, 0]]], [[[0.0002, 0.0002]]]]]