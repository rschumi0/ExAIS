import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave52349 = tf.keras.layers.Input(shape=([1, 1]))
in1Ave52349 = tf.keras.layers.Input(shape=([1, 1]))
in0Max78506 = tf.keras.layers.Input(shape=([1, 2]))
in1Max78506 = tf.keras.layers.Input(shape=([1, 2]))
in0Con68496 = tf.keras.layers.Input(shape=([3, 1]))

Ave52349 = keras.layers.Average(name = 'Ave52349', )([in0Ave52349,in1Ave52349])
Res16693 = keras.layers.Reshape((1, 1, 1), name = 'Res16693', )(Ave52349)
Zer41499 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer41499', )(Res16693)
Res87409 = keras.layers.Reshape((3, 3), name = 'Res87409', )(Zer41499)
Max78506 = keras.layers.Maximum(name = 'Max78506', )([in0Max78506,in1Max78506])
Zer2622 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer2622', )(Max78506)
Con68496 = keras.layers.Concatenate(axis=2, name = 'Con68496', )([Zer2622,in0Con68496])
Sub71516 = keras.layers.Subtract(name = 'Sub71516', )([Res87409,Con68496])
Res15753 = keras.layers.Reshape((3, 3, 1), name = 'Res15753', )(Sub71516)
Res26331 = keras.layers.Reshape((3, 3, 1, 1), name = 'Res26331', )(Res15753)
Con11856 = keras.layers.Conv3DTranspose(4, (1, 3, 1),strides=(1, 1, 1), padding='valid', name = 'Con11856', )(Res26331)
model = tf.keras.models.Model(inputs=[in0Ave52349,in1Ave52349,in0Max78506,in1Max78506,in0Con68496], outputs=Con11856)
w = model.get_layer('Con11856').get_weights() 
w[0] = np.array([[[[[0.3458], [0.6926], [0.2841], [0.038]]], [[[0.8116], [0.5479], [0.7082], [0.8136]]], [[[0.6168], [0.0184], [0.5368], [0.35]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con11856').set_weights(w) 
in0Ave52349 = tf.constant([[[0.9012]]])
in1Ave52349 = tf.constant([[[0.3157]]])
in0Max78506 = tf.constant([[[0.4772, 0.3428]]])
in1Max78506 = tf.constant([[[0.0284, 0.5217]]])
in0Con68496 = tf.constant([[[0.3603], [0.8661], [0.3844]]])
print (np.array2string(model.predict([in0Ave52349,in1Ave52349,in0Max78506,in1Max78506,in0Con68496],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con11856.png')

LAve52349 = average_layer([[[[0.9012]]], [[[0.3157]]]], Ave52349), 
LRes16693 = reshape_layer(Ave52349, [1, 1, 1], Res16693), 
LZer41499 = zero_padding2D_layer(Res16693, 1, 1, 1, 1, Zer41499), 
LRes87409 = reshape_layer(Zer41499, [3, 3], Res87409), 
LMax78506 = maximum_layer([[[[0.4772, 0.3428]]], [[[0.0284, 0.5217]]]], Max78506), 
LZer2622 = zero_padding1D_layer(Max78506, 2, 0, Zer2622), 
LCon68496 = concatenate_layer([Zer2622,[[[0.3603], [0.8661], [0.3844]]]], 2, Con68496), 
LSub71516 = subtract_layer(Res87409,Con68496, Sub71516), 
LRes15753 = reshape_layer(Sub71516, [3, 3, 1], Res15753), 
LRes26331 = reshape_layer(Res15753, [3, 3, 1, 1], Res26331), 
LCon11856 = conv3D_transpose_layer(Res26331, 1, 3, 1,[[[[[0.3458], [0.6926], [0.2841], [0.038]]], [[[0.8116], [0.5479], [0.7082], [0.8136]]], [[[0.6168], [0.0184], [0.5368], [0.35]]]]],[0, 0, 0, 0], 1, 1, 1, false, Con11856), 
exec_layers([LAve52349,LRes16693,LZer41499,LRes87409,LMax78506,LZer2622,LCon68496,LSub71516,LRes15753,LRes26331,LCon11856],["Ave52349","Res16693","Zer41499","Res87409","Max78506","Zer2622","Con68496","Sub71516","Res15753","Res26331","Con11856"],Con11856,"Con11856")

Actual (Unparsed): [[[[[0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[-0.1245917, -0.2495438, -0.1023612, -0.0136914]], [[-0.2924195, -0.1974084, -0.2551645, -0.2931401]], [[-0.2222330, -0.0066295, -0.1934090, -0.1261050]]], [[[0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.2104020, 0.4214125, 0.1728606, 0.0231211]], [[0.1943206, -0.2664911, 0.1848453, 0.4621231]], [[-0.3276348, -0.4633407, -0.2867561, -0.4917015]], [[-0.5342105, -0.0159362, -0.4649225, -0.3031350]]], [[[-0.1650158, -0.3305087, -0.1355725, -0.0181336]], [[-0.5676994, -0.6227873, -0.4861680, -0.4080745]], [[-0.8506742, -0.5608554, -0.7348370, -0.6060823]], [[-0.6337636, -0.2202120, -0.5522807, -0.4953429]], [[-0.2370979, -0.0070730, -0.2063459, -0.1345400]]]]]

Expected (Unparsed): [[[[[0.0,0.0,0.0,0.0]],[[0.0,0.0,0.0,0.0]],[[-0.12459174,-0.24954378,-0.10236123000000001,-0.0136914]],[[-0.29241948,-0.19740837000000003,-0.25516446000000004,-0.29314008]],[[-0.22223304000000002,-0.00662952,-0.19340904000000003,-0.126105]]],[[[0.0,0.0,0.0,0.0]],[[0.21040200999999997,0.42141246999999993,0.17286064499999998,0.0231211]],[[0.19432063999999993,-0.26649110499999995,0.18484527999999995,0.46212311999999994]],[[-0.3276348,-0.46334071000000004,-0.28675606000000003,-0.49170146]],[[-0.53421048,-0.01593624,-0.46492248,-0.303135]]],[[[-0.16501576,-0.33050872000000003,-0.13557252,-0.0181336]],[[-0.5676993800000001,-0.6227873,-0.4861680100000001,-0.40807452000000005]],[[-0.8506742000000002,-0.56085535,-0.7348369400000001,-0.6060823200000001]],[[-0.6337636,-0.22021204000000003,-0.5522806400000001,-0.49534284]],[[-0.23709792000000002,-0.0070729600000000005,-0.20634592000000004,-0.13454]]]]]

Actual:   [[[[[0, 0, 0, 0]], [[0, 0, 0, 0]], [[-0.1245, -0.2495, -0.1023, -0.0136]], [[-0.2924, -0.1974, -0.2551, -0.2931]], [[-0.2222, -0.0066, -0.1934, -0.1261]]], [[[0, 0, 0, 0]], [[0.2105, 0.4215, 0.1729, 0.0232]], [[0.1944, -0.2664, 0.1849, 0.4622]], [[-0.3276, -0.4633, -0.2867, -0.4917]], [[-0.5342, -0.0159, -0.4649, -0.3031]]], [[[-0.165, -0.3305, -0.1355, -0.0181]], [[-0.5676, -0.6227, -0.4861, -0.408]], [[-0.8506, -0.5608, -0.7348, -0.606]], [[-0.6337, -0.2202, -0.5522, -0.4953]], [[-0.237, -0.007, -0.2063, -0.1345]]]]]

Expected: [[[[[0, 0, 0, 0]], [[0, 0, 0, 0]], [[-0.1245, -0.2495, -0.1023, -0.0136]], [[-0.2924, -0.1974, -0.2551, -0.2931]], [[-0.2222, -0.0066, -0.1934, -0.1261]]], [[[0, 0, 0, 0]], [[0.2105, 0.4215, 0.1729, 0.0232]], [[0.1944, -0.2664, 0.1849, 0.4622]], [[-0.3276, -0.4633, -0.2867, -0.4917]], [[-0.5342, -0.0159, -0.4649, -0.3031]]], [[[-0.165, -0.3305, -0.1355, -0.0181]], [[-0.5676, -0.6227, -0.4861, -0.408]], [[-0.8506, -0.5608, -0.7348, -0.606]], [[-0.6337, -0.2202, -0.5522, -0.4953]], [[-0.237, -0.007, -0.2063, -0.1345]]]]]