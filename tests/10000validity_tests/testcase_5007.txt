import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max17130 = tf.keras.layers.Input(shape=([2, 2]))
in1Max17130 = tf.keras.layers.Input(shape=([2, 2]))
in0Sep2989 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con6049 = tf.keras.layers.Input(shape=([4]))

Max17130 = keras.layers.Maximum(name = 'Max17130', )([in0Max17130,in1Max17130])
Up_71288 = keras.layers.UpSampling1D(size=(2), name = 'Up_71288', )(Max17130)
Fla78909 = keras.layers.Flatten(name = 'Fla78909', )(Up_71288)
Sep2989 = keras.layers.SeparableConv2D(4, (1, 1),strides=(2, 2), padding='valid', name = 'Sep2989', )(in0Sep2989)
Glo85631 = keras.layers.GlobalMaxPool2D(name = 'Glo85631', )(Sep2989)
Con6049 = keras.layers.Concatenate(axis=1, name = 'Con6049', )([Glo85631,in0Con6049])
Ave37906 = keras.layers.Average(name = 'Ave37906', )([Fla78909,Con6049])
model = tf.keras.models.Model(inputs=[in0Max17130,in1Max17130,in0Sep2989,in0Con6049], outputs=Ave37906)
w = model.get_layer('Sep2989').get_weights() 
w[0] = np.array([[[[0.4129], [0.5394]]]])
w[1] = np.array([[[[0.6239, 0.7948, 0.3225, 0.0935], [0.2933, 0.8732, 0.6639, 0.9316]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep2989').set_weights(w) 
in0Max17130 = tf.constant([[[0.8454, 0.2507], [0.7032, 0.5955]]])
in1Max17130 = tf.constant([[[0.1237, 0.6], [0.19, 0.2357]]])
in0Sep2989 = tf.constant([[[[0.9899, 0.0988], [0.9884, 0.0913]], [[0.7507, 0.6492], [0.2632, 0.0919]]]])
in0Con6049 = tf.constant([[0.1909, 0.1829, 0.6311, 0.8496]])
print (np.array2string(model.predict([in0Max17130,in1Max17130,in0Sep2989,in0Con6049],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave37906.png')

LMax17130 = maximum_layer([[[[0.8454, 0.2507], [0.7032, 0.5955]]], [[[0.1237, 0.6], [0.19, 0.2357]]]], Max17130), 
LUp_71288 = up_sampling1D_layer(Max17130, 2, Up_71288), 
LFla78909 = flatten_layer(Up_71288, Fla78909), 
LSep2989 = separable_conv2D_layer([[[[0.9899, 0.0988], [0.9884, 0.0913]], [[0.7507, 0.6492], [0.2632, 0.0919]]]], 1, 1,[[[[[0.4129], [0.5394]]]],[[[[0.6239, 0.7948, 0.3225, 0.0935], [0.2933, 0.8732, 0.6639, 0.9316]]]]],[0, 0, 0, 0], 2, 2, false, Sep2989), 
LGlo85631 = global_max_pool2D_layer(Sep2989, Glo85631), 
LCon6049 = concatenate_layer([Glo85631,[[0.1909, 0.1829, 0.6311, 0.8496]]], 1, Con6049), 
LAve37906 = average_layer([Fla78909,Con6049], Ave37906), 
exec_layers([LMax17130,LUp_71288,LFla78909,LSep2989,LGlo85631,LCon6049,LAve37906],["Max17130","Up_71288","Fla78909","Sep2989","Glo85631","Con6049","Ave37906"],Ave37906,"Ave37906")

Actual (Unparsed): [[0.5580186, 0.4856968, 0.5062982, 0.3439319, 0.4470500, 0.3892000, 0.6671500, 0.7225500]]

Expected (Unparsed): [[0.5580186104225,0.48569678830599994,0.5062981841415,0.3439318629185,0.44705,0.3892,0.66715,0.72255]]

Actual:   [[0.5581, 0.4857, 0.5063, 0.344, 0.4471, 0.3892, 0.6672, 0.7226]]

Expected: [[0.5581, 0.4857, 0.5063, 0.344, 0.4471, 0.3892, 0.6672, 0.7226]]