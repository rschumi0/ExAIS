import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min98625 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Min98625 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Max31929 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Max31929 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Dot40241 = tf.keras.layers.Input(shape=([3]))
in1Dot40241 = tf.keras.layers.Input(shape=([3]))
in0Con29882 = tf.keras.layers.Input(shape=([3]))

Min98625 = keras.layers.Minimum(name = 'Min98625', )([in0Min98625,in1Min98625])
Zer2379 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer2379', )(Min98625)
Max31929 = keras.layers.Maximum(name = 'Max31929', )([in0Max31929,in1Max31929])
Zer13603 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer13603', )(Max31929)
Ave43717 = keras.layers.Average(name = 'Ave43717', )([Zer2379,Zer13603])
Res19281 = keras.layers.Reshape((2, 3), name = 'Res19281', )(Ave43717)
Fla10460 = keras.layers.Flatten(name = 'Fla10460', )(Res19281)
Dot40241 = keras.layers.Dot(axes=(1, 1), name = 'Dot40241', )([in0Dot40241,in1Dot40241])
Res87671 = keras.layers.Reshape((1, 1), name = 'Res87671', )(Dot40241)
GRU37835 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU37835', )(Res87671)
Con29882 = keras.layers.Concatenate(axis=1, name = 'Con29882', )([GRU37835,in0Con29882])
Ave8012 = keras.layers.Average(name = 'Ave8012', )([Fla10460,Con29882])
model = tf.keras.models.Model(inputs=[in0Min98625,in1Min98625,in0Max31929,in1Max31929,in0Dot40241,in1Dot40241,in0Con29882], outputs=Ave8012)
w = model.get_layer('GRU37835').get_weights() 
w[0] = np.array([[8, 10, 4, 6, 7, 4, 10, 3, 7]])
w[1] = np.array([[7, 10, 4, 1, 10, 7, 2, 8, 4], [8, 1, 1, 5, 3, 3, 1, 1, 10], [4, 4, 4, 3, 7, 9, 8, 10, 9]])
w[2] = np.array([2, 8, 4, 10, 5, 5, 9, 2, 6])
model.get_layer('GRU37835').set_weights(w) 
in0Min98625 = tf.constant([[[[0.6687]], [[0.7916]]]])
in1Min98625 = tf.constant([[[[0.5468]], [[0.466]]]])
in0Max31929 = tf.constant([[[[0.6981], [0.9015]]]])
in1Max31929 = tf.constant([[[[0.8896], [0.2365]]]])
in0Dot40241 = tf.constant([[0.0887, 0.8337, 0.7732]])
in1Dot40241 = tf.constant([[0.8289, 0.0133, 0.7514]])
in0Con29882 = tf.constant([[0.7314, 0.3293, 0.8441]])
print (np.array2string(model.predict([in0Min98625,in1Min98625,in0Max31929,in1Max31929,in0Dot40241,in1Dot40241,in0Con29882],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave8012.png')

LMin98625 = minimum_layer([[[[[0.6687]], [[0.7916]]]], [[[[0.5468]], [[0.466]]]]], Min98625), 
LZer2379 = zero_padding2D_layer(Min98625, 0, 0, 2, 0, Zer2379), 
LMax31929 = maximum_layer([[[[[0.6981], [0.9015]]]], [[[[0.8896], [0.2365]]]]], Max31929), 
LZer13603 = zero_padding2D_layer(Max31929, 1, 0, 1, 0, Zer13603), 
LAve43717 = average_layer([Zer2379,Zer13603], Ave43717), 
LRes19281 = reshape_layer(Ave43717, [2, 3], Res19281), 
LFla10460 = flatten_layer(Res19281, Fla10460), 
LDot40241 = dot_layer([[0.0887, 0.8337, 0.7732]], [[0.8289, 0.0133, 0.7514]], 1, 1, Dot40241), 
LRes87671 = reshape_layer(Dot40241, [1, 1], Res87671), 
LGRU37835 = gru_layer(Res87671,[[8, 10, 4, 6, 7, 4, 10, 3, 7]],[[7, 10, 4, 1, 10, 7, 2, 8, 4], [8, 1, 1, 5, 3, 3, 1, 1, 10], [4, 4, 4, 3, 7, 9, 8, 10, 9]],[2, 8, 4, 10, 5, 5, 9, 2, 6], false, GRU37835), 
LCon29882 = concatenate_layer([GRU37835,[[0.7314, 0.3293, 0.8441]]], 1, Con29882), 
LAve8012 = average_layer([Fla10460,Con29882], Ave8012), 
exec_layers([LMin98625,LZer2379,LMax31929,LZer13603,LAve43717,LRes19281,LFla10460,LDot40241,LRes87671,LGRU37835,LCon29882,LAve8012],["Min98625","Zer2379","Max31929","Zer13603","Ave43717","Res19281","Fla10460","Dot40241","Res87671","GRU37835","Con29882","Ave8012"],Ave8012,"Ave8012")

Actual (Unparsed): [[0.0003293, 0.0000002, 0.1373382, 0.3657000, 0.3870500, 0.7639250]]

Expected (Unparsed): [[0.00032929421182418823,2.156165865134969e-7,0.13733823694849187,0.3657,0.38705,0.763925]]

Actual:   [[0.0004, 0, 0.1374, 0.3657, 0.3871, 0.764]]

Expected: [[0.0004, 0, 0.1374, 0.3657, 0.3871, 0.764]]