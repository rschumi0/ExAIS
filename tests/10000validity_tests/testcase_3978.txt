import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul11746 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Mul11746 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Add48690 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Add48690 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Mul47984 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Mul47984 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con34485 = tf.keras.layers.Input(shape=([4, 3, 1]))

Mul11746 = keras.layers.Multiply(name = 'Mul11746', )([in0Mul11746,in1Mul11746])
Res10088 = keras.layers.Reshape((1, 2, 2), name = 'Res10088', )(Mul11746)
Zer21556 = keras.layers.ZeroPadding2D(padding=((3, 0), (1, 0)), name = 'Zer21556', )(Res10088)
Add48690 = keras.layers.Add(name = 'Add48690', )([in0Add48690,in1Add48690])
Res20730 = keras.layers.Reshape((1, 2, 4), name = 'Res20730', )(Add48690)
Res58836 = keras.layers.Reshape((1, 8), name = 'Res58836', )(Res20730)
Con78706 = keras.layers.Conv1D(2, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con78706', )(Res58836)
Res95013 = keras.layers.Reshape((1, 2, 1), name = 'Res95013', )(Con78706)
Sep17454 = keras.layers.SeparableConv2D(4, (1, 1),strides=(1, 1), padding='same', name = 'Sep17454', )(Res95013)
Glo80992 = keras.layers.GlobalMaxPool2D(name = 'Glo80992', )(Sep17454)
Res9960 = keras.layers.Reshape((4, 1), name = 'Res9960', )(Glo80992)
Res29172 = keras.layers.Reshape((4, 1, 1), name = 'Res29172', )(Res9960)
Mul47984 = keras.layers.Multiply(name = 'Mul47984', )([in0Mul47984,in1Mul47984])
Zer18069 = keras.layers.ZeroPadding2D(padding=((3, 0), (0, 0)), name = 'Zer18069', )(Mul47984)
Max18347 = keras.layers.Maximum(name = 'Max18347', )([Res29172,Zer18069])
Zer3742 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer3742', )(Max18347)
Con34485 = keras.layers.Concatenate(axis=3, name = 'Con34485', )([Zer3742,in0Con34485])
Max18410 = keras.layers.Maximum(name = 'Max18410', )([Zer21556,Con34485])
model = tf.keras.models.Model(inputs=[in0Mul11746,in1Mul11746,in0Add48690,in1Add48690,in0Mul47984,in1Mul47984,in0Con34485], outputs=Max18410)
w = model.get_layer('Con78706').get_weights() 
w[0] = np.array([[[0.559, 0.1872], [0.5684, 0.0371], [0.4038, 0.5126], [0.4582, 0.8219], [0.2093, 0.4644], [0.3644, 0.248], [0.4323, 0.4105], [0.733, 0.6413]]])
w[1] = np.array([0, 0])
model.get_layer('Con78706').set_weights(w) 
w = model.get_layer('Sep17454').get_weights() 
w[0] = np.array([[[[0.8639]]]])
w[1] = np.array([[[[0.1709, 0.9318, 0.4277, 0.2006]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep17454').set_weights(w) 
in0Mul11746 = tf.constant([[[[[0.2471, 0.1278]], [[0.5425, 0.7634]]]]])
in1Mul11746 = tf.constant([[[[[0.245, 0.6338]], [[0.1255, 0.7799]]]]])
in0Add48690 = tf.constant([[[[[0.8007, 0.9575], [0.4293, 0.3382]], [[0.2206, 0.3771], [0.622, 0.0962]]]]])
in1Add48690 = tf.constant([[[[[0.0285, 0.9159], [0.6836, 0.2546]], [[0.4967, 0.4347], [0.2742, 0.2125]]]]])
in0Mul47984 = tf.constant([[[[0.1458]]]])
in1Mul47984 = tf.constant([[[[0.1765]]]])
in0Con34485 = tf.constant([[[[0.1541], [0.8076], [0.301]], [[0.1831], [0.061], [0.6472]], [[0.9177], [0.3966], [0.0354]], [[0.6262], [0.6813], [0.3891]]]])
print (np.array2string(model.predict([in0Mul11746,in1Mul11746,in0Add48690,in1Add48690,in0Mul47984,in1Mul47984,in0Con34485],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max18410.png')

LMul11746 = multiply_layer([[[[[[0.2471, 0.1278]], [[0.5425, 0.7634]]]]], [[[[[0.245, 0.6338]], [[0.1255, 0.7799]]]]]], Mul11746), 
LRes10088 = reshape_layer(Mul11746, [1, 2, 2], Res10088), 
LZer21556 = zero_padding2D_layer(Res10088, 3, 0, 1, 0, Zer21556), 
LAdd48690 = add_layer([[[[[[0.8007, 0.9575], [0.4293, 0.3382]], [[0.2206, 0.3771], [0.622, 0.0962]]]]], [[[[[0.0285, 0.9159], [0.6836, 0.2546]], [[0.4967, 0.4347], [0.2742, 0.2125]]]]]], Add48690), 
LRes20730 = reshape_layer(Add48690, [1, 2, 4], Res20730), 
LRes58836 = reshape_layer(Res20730, [1, 8], Res58836), 
LCon78706 = conv1D_layer(Res58836, 1,[[[0.559, 0.1872], [0.5684, 0.0371], [0.4038, 0.5126], [0.4582, 0.8219], [0.2093, 0.4644], [0.3644, 0.248], [0.4323, 0.4105], [0.733, 0.6413]]],[0, 0], 1, true, 1, Con78706), 
LRes95013 = reshape_layer(Con78706, [1, 2, 1], Res95013), 
LSep17454 = separable_conv2D_layer(Res95013, 1, 1,[[[[[0.8639]]]],[[[[0.1709, 0.9318, 0.4277, 0.2006]]]]],[0, 0, 0, 0], 1, 1, true, Sep17454), 
LGlo80992 = global_max_pool2D_layer(Sep17454, Glo80992), 
LRes9960 = reshape_layer(Glo80992, [4, 1], Res9960), 
LRes29172 = reshape_layer(Res9960, [4, 1, 1], Res29172), 
LMul47984 = multiply_layer([[[[[0.1458]]]], [[[[0.1765]]]]], Mul47984), 
LZer18069 = zero_padding2D_layer(Mul47984, 3, 0, 0, 0, Zer18069), 
LMax18347 = maximum_layer([Res29172,Zer18069], Max18347), 
LZer3742 = zero_padding2D_layer(Max18347, 0, 0, 2, 0, Zer3742), 
LCon34485 = concatenate_layer([Zer3742,[[[[0.1541], [0.8076], [0.301]], [[0.1831], [0.061], [0.6472]], [[0.9177], [0.3966], [0.0354]], [[0.6262], [0.6813], [0.3891]]]]], 3, Con34485), 
LMax18410 = maximum_layer([Zer21556,Con34485], Max18410), 
exec_layers([LMul11746,LRes10088,LZer21556,LAdd48690,LRes20730,LRes58836,LCon78706,LRes95013,LSep17454,LGlo80992,LRes9960,LRes29172,LMul47984,LZer18069,LMax18347,LZer3742,LCon34485,LMax18410],["Mul11746","Res10088","Zer21556","Add48690","Res20730","Res58836","Con78706","Res95013","Sep17454","Glo80992","Res9960","Res29172","Mul47984","Zer18069","Max18347","Zer3742","Con34485","Max18410"],Max18410,"Max18410")

Actual (Unparsed): [[[[0.0000000, 0.1541000], [0.0000000, 0.8076000], [0.4885467, 0.3010000]], [[0.0000000, 0.1831000], [0.0000000, 0.0610000], [2.6637084, 0.6472000]], [[0.0000000, 0.9177000], [0.0000000, 0.3966000], [1.2226530, 0.0354000]], [[0.0000000, 0.6262000], [0.0605395, 0.6813000], [0.5734491, 0.5953757]]]]

Expected (Unparsed): [[[[0,0.1541],[0,0.8076],[0.48854665682094006,0.301]],[[0,0.1831],[0,0.061],[2.66370845421739,0.6472]],[[0,0.9177],[0,0.3966],[1.2226530434307552,0.0354]],[[0,0.6262],[0.060539499999999996,0.6813],[0.5734491477956734,0.59537566]]]]

Actual:   [[[[0, 0.1541], [0, 0.8076], [0.4886, 0.301]], [[0, 0.1831], [0, 0.061], [2.6638, 0.6472]], [[0, 0.9177], [0, 0.3966], [1.2227, 0.0354]], [[0, 0.6262], [0.0606, 0.6813], [0.5735, 0.5954]]]]

Expected: [[[[0, 0.1541], [0, 0.8076], [0.4886, 0.301]], [[0, 0.1831], [0, 0.061], [2.6638, 0.6472]], [[0, 0.9177], [0, 0.3966], [1.2227, 0.0354]], [[0, 0.6262], [0.0606, 0.6813], [0.5735, 0.5954]]]]