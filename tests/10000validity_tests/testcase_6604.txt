import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo61792 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con54981 = tf.keras.layers.Input(shape=([1, 1]))
in0Up_97892 = tf.keras.layers.Input(shape=([3, 4, 2]))
in0Add36085 = tf.keras.layers.Input(shape=([2, 2]))
in1Add36085 = tf.keras.layers.Input(shape=([2, 2]))

Glo61792 = keras.layers.GlobalMaxPool2D(name = 'Glo61792', )(in0Glo61792)
Sof75516 = keras.layers.Softmax(axis=1, name = 'Sof75516', )(Glo61792)
Res22041 = keras.layers.Reshape((2, 1), name = 'Res22041', )(Sof75516)
Zer33428 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer33428', )(Res22041)
Con54981 = keras.layers.Conv1D(2, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con54981', )(in0Con54981)
Dot14306 = keras.layers.Dot(axes=(2, 1), name = 'Dot14306', )([Zer33428,Con54981])
Res18229 = keras.layers.Reshape((3, 2, 1), name = 'Res18229', )(Dot14306)
Res42491 = keras.layers.Reshape((3, 2, 1, 1), name = 'Res42491', )(Res18229)
Zer53191 = keras.layers.ZeroPadding3D(padding=((1, 0), (2, 0), (2, 0)), name = 'Zer53191', )(Res42491)
Up_97892 = keras.layers.UpSampling2D(size=(1, 1), name = 'Up_97892', )(in0Up_97892)
Res21832 = keras.layers.Reshape((3, 8), name = 'Res21832', )(Up_97892)
Con4152 = keras.layers.Conv1D(3, (1),strides=(12), padding='same', dilation_rate=(1), name = 'Con4152', )(Res21832)
Bat56181 = keras.layers.BatchNormalization(axis=1, epsilon=0.7302805481924726,  name = 'Bat56181', )(Con4152)
Res55063 = keras.layers.Reshape((1, 3, 1), name = 'Res55063', )(Bat56181)
Res82324 = keras.layers.Reshape((1, 3, 1, 1), name = 'Res82324', )(Res55063)
Zer61812 = keras.layers.ZeroPadding3D(padding=((3, 0), (1, 0), (2, 0)), name = 'Zer61812', )(Res82324)
Add36085 = keras.layers.Add(name = 'Add36085', )([in0Add36085,in1Add36085])
Res35766 = keras.layers.Reshape((2, 2, 1), name = 'Res35766', )(Add36085)
Res76522 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res76522', )(Res35766)
Zer8999 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer8999', )(Res76522)
Min73757 = keras.layers.Minimum(name = 'Min73757', )([Zer61812,Zer8999])
Mul16205 = keras.layers.Multiply(name = 'Mul16205', )([Zer53191,Min73757])
model = tf.keras.models.Model(inputs=[in0Glo61792,in0Con54981,in0Up_97892,in0Add36085,in1Add36085], outputs=Mul16205)
w = model.get_layer('Con54981').get_weights() 
w[0] = np.array([[[0.922, 0.8371]]])
w[1] = np.array([0, 0])
model.get_layer('Con54981').set_weights(w) 
w = model.get_layer('Con4152').get_weights() 
w[0] = np.array([[[0.665, 0.4292, 0.4408], [0.222, 0.5757, 0.4782], [0.7964, 0.6525, 0.3059], [0.6744, 0.3179, 0.2245], [0.7325, 0.5563, 0.6078], [0.4603, 0.1733, 0.2934], [0.0845, 0.2501, 0.7535], [0.8305, 0.8487, 0.6209]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con4152').set_weights(w) 
w = model.get_layer('Bat56181').get_weights() 
w[0] = np.array([0.6139])
w[1] = np.array([0.5122])
w[2] = np.array([0.9608])
w[3] = np.array([0.3723])
model.get_layer('Bat56181').set_weights(w) 
in0Glo61792 = tf.constant([[[[1.7655, 1.8221], [1.418, 1.2335]]]])
in0Con54981 = tf.constant([[[0.9637]]])
in0Up_97892 = tf.constant([[[[1.158, 1.7518], [1.0438, 1.2389], [1.8958, 1.817], [1.9703, 1.7569]], [[1.1537, 1.7881], [1.4762, 1.3281], [1.9232, 1.1526], [1.1967, 1.8515]], [[1.2683, 1.157], [1.8933, 1.6938], [1.9261, 1.8174], [1.5121, 1.5501]]]])
in0Add36085 = tf.constant([[[0.5103, 0.6519], [0.8334, 0.1855]]])
in1Add36085 = tf.constant([[[0.537, 0.5326], [0.2325, 0.3399]]])
print (np.array2string(model.predict([in0Glo61792,in0Con54981,in0Up_97892,in0Add36085,in1Add36085],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul16205.png')

LGlo61792 = global_max_pool2D_layer([[[[1.7655, 1.8221], [1.418, 1.2335]]]], Glo61792), 
LSof75516 = softmax_layer(Glo61792, 1, Sof75516), 
LRes22041 = reshape_layer(Sof75516, [2, 1], Res22041), 
LZer33428 = zero_padding1D_layer(Res22041, 1, 0, Zer33428), 
LCon54981 = conv1D_layer([[[0.9637]]], 1,[[[0.922, 0.8371]]],[0, 0], 1, false, 1, Con54981), 
LDot14306 = dot_layer(Zer33428,Con54981, 2, 1, Dot14306), 
LRes18229 = reshape_layer(Dot14306, [3, 2, 1], Res18229), 
LRes42491 = reshape_layer(Res18229, [3, 2, 1, 1], Res42491), 
LZer53191 = zero_padding3D_layer(Res42491, 1, 0, 2, 0, 2, 0, Zer53191), 
LUp_97892 = up_sampling2D_layer([[[[1.158, 1.7518], [1.0438, 1.2389], [1.8958, 1.817], [1.9703, 1.7569]], [[1.1537, 1.7881], [1.4762, 1.3281], [1.9232, 1.1526], [1.1967, 1.8515]], [[1.2683, 1.157], [1.8933, 1.6938], [1.9261, 1.8174], [1.5121, 1.5501]]]], 1, 1, Up_97892), 
LRes21832 = reshape_layer(Up_97892, [3, 8], Res21832), 
LCon4152 = conv1D_layer(Res21832, 1,[[[0.665, 0.4292, 0.4408], [0.222, 0.5757, 0.4782], [0.7964, 0.6525, 0.3059], [0.6744, 0.3179, 0.2245], [0.7325, 0.5563, 0.6078], [0.4603, 0.1733, 0.2934], [0.0845, 0.2501, 0.7535], [0.8305, 0.8487, 0.6209]]],[0, 0, 0], 12, true, 1, Con4152), 
LBat56181 = batch_normalization_layer(Con4152, 1, 0.7302805481924726, [0.6139], [0.5122], [0.9608], [0.3723], Bat56181), 
LRes55063 = reshape_layer(Bat56181, [1, 3, 1], Res55063), 
LRes82324 = reshape_layer(Res55063, [1, 3, 1, 1], Res82324), 
LZer61812 = zero_padding3D_layer(Res82324, 3, 0, 1, 0, 2, 0, Zer61812), 
LAdd36085 = add_layer([[[[0.5103, 0.6519], [0.8334, 0.1855]]], [[[0.537, 0.5326], [0.2325, 0.3399]]]], Add36085), 
LRes35766 = reshape_layer(Add36085, [2, 2, 1], Res35766), 
LRes76522 = reshape_layer(Res35766, [2, 2, 1, 1], Res76522), 
LZer8999 = zero_padding3D_layer(Res76522, 1, 1, 1, 1, 1, 1, Zer8999), 
LMin73757 = minimum_layer([Zer61812,Zer8999], Min73757), 
LMul16205 = multiply_layer([Zer53191,Min73757], Mul16205), 
exec_layers([LGlo61792,LSof75516,LRes22041,LZer33428,LCon54981,LDot14306,LRes18229,LRes42491,LZer53191,LUp_97892,LRes21832,LCon4152,LBat56181,LRes55063,LRes82324,LZer61812,LAdd36085,LRes35766,LRes76522,LZer8999,LMin73757,LMul16205],["Glo61792","Sof75516","Res22041","Zer33428","Con54981","Dot14306","Res18229","Res42491","Zer53191","Up_97892","Res21832","Con4152","Bat56181","Res55063","Res82324","Zer61812","Add36085","Res35766","Res76522","Zer8999","Min73757","Mul16205"],Mul16205,"Mul16205")

Actual (Unparsed): [[[[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]]]]

Expected (Unparsed): [[[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]]],[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0.0]],[[0],[0],[0.0]]],[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0.0]],[[0],[0],[0.0]]],[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0.0]],[[0],[0],[0.0]]]]]

Actual:   [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]]]]

Expected: [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]]]]