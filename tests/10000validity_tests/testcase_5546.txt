import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0GRU54992 = tf.keras.layers.Input(shape=([3, 3]))
in0Dot29384 = tf.keras.layers.Input(shape=([3]))
in1Dot29384 = tf.keras.layers.Input(shape=([3]))
in0Con51904 = tf.keras.layers.Input(shape=([1]))
in0Glo78460 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Dot39532 = tf.keras.layers.Input(shape=([3]))
in1Dot39532 = tf.keras.layers.Input(shape=([3]))
in0Con67221 = tf.keras.layers.Input(shape=([1]))

GRU54992 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU54992', )(in0GRU54992)
Dot29384 = keras.layers.Dot(axes=(1, 1), name = 'Dot29384', )([in0Dot29384,in1Dot29384])
Con51904 = keras.layers.Concatenate(axis=1, name = 'Con51904', )([Dot29384,in0Con51904])
Add3794 = keras.layers.Add(name = 'Add3794', )([GRU54992,Con51904])
Glo78460 = keras.layers.GlobalAveragePooling2D(name = 'Glo78460', )(in0Glo78460)
Dot39532 = keras.layers.Dot(axes=(1, 1), name = 'Dot39532', )([in0Dot39532,in1Dot39532])
Con67221 = keras.layers.Concatenate(axis=1, name = 'Con67221', )([Dot39532,in0Con67221])
Add54683 = keras.layers.Add(name = 'Add54683', )([Glo78460,Con67221])
Ave44397 = keras.layers.Average(name = 'Ave44397', )([Add3794,Add54683])
model = tf.keras.models.Model(inputs=[in0GRU54992,in0Dot29384,in1Dot29384,in0Con51904,in0Glo78460,in0Dot39532,in1Dot39532,in0Con67221], outputs=Ave44397)
w = model.get_layer('GRU54992').get_weights() 
w[0] = np.array([[7, 2, 3, 3, 1, 7], [3, 8, 1, 10, 8, 2], [3, 4, 2, 10, 7, 7]])
w[1] = np.array([[5, 9, 5, 2, 10, 1], [3, 9, 6, 6, 4, 9]])
w[2] = np.array([5, 1, 4, 9, 8, 1])
model.get_layer('GRU54992').set_weights(w) 
in0GRU54992 = tf.constant([[[8, 1, 1], [3, 9, 7], [9, 1, 7]]])
in0Dot29384 = tf.constant([[0.5826, 0.9214, 0.6962]])
in1Dot29384 = tf.constant([[0.151, 0.4146, 0.6707]])
in0Con51904 = tf.constant([[0.807]])
in0Glo78460 = tf.constant([[[[1.0247, 1.1048]]]])
in0Dot39532 = tf.constant([[0.7013, 0.9439, 0.5075]])
in1Dot39532 = tf.constant([[0.2543, 0.749, 0.9523]])
in0Con67221 = tf.constant([[0.6031]])
print (np.array2string(model.predict([in0GRU54992,in0Dot29384,in1Dot29384,in0Con51904,in0Glo78460,in0Dot39532,in1Dot39532,in0Con67221],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave44397.png')

LGRU54992 = gru_layer([[[8, 1, 1], [3, 9, 7], [9, 1, 7]]],[[7, 2, 3, 3, 1, 7], [3, 8, 1, 10, 8, 2], [3, 4, 2, 10, 7, 7]],[[5, 9, 5, 2, 10, 1], [3, 9, 6, 6, 4, 9]],[5, 1, 4, 9, 8, 1], false, GRU54992), 
LDot29384 = dot_layer([[0.5826, 0.9214, 0.6962]], [[0.151, 0.4146, 0.6707]], 1, 1, Dot29384), 
LCon51904 = concatenate_layer([Dot29384,[[0.807]]], 1, Con51904), 
LAdd3794 = add_layer([GRU54992,Con51904], Add3794), 
LGlo78460 = global_average_pooling2D_layer([[[[1.0247, 1.1048]]]], Glo78460), 
LDot39532 = dot_layer([[0.7013, 0.9439, 0.5075]], [[0.2543, 0.749, 0.9523]], 1, 1, Dot39532), 
LCon67221 = concatenate_layer([Dot39532,[[0.6031]]], 1, Con67221), 
LAdd54683 = add_layer([Glo78460,Con67221], Add54683), 
LAve44397 = average_layer([Add3794,Add54683], Ave44397), 
exec_layers([LGRU54992,LDot29384,LCon51904,LAdd3794,LGlo78460,LDot39532,LCon67221,LAdd54683,LAve44397],["GRU54992","Dot29384","Con51904","Add3794","Glo78460","Dot39532","Con67221","Add54683","Ave44397"],Ave44397,"Ave44397")

Actual (Unparsed): [[1.6651202, 1.2574500]]

Expected (Unparsed): [[1.6651201599999998,1.2574500000001272]]

Actual:   [[1.6652, 1.2575]]

Expected: [[1.6652, 1.2575]]