import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add21013 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Add21013 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con59757 = tf.keras.layers.Input(shape=([2]))
in0Add83461 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Add83461 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))

Add21013 = keras.layers.Add(name = 'Add21013', )([in0Add21013,in1Add21013])
Res12123 = keras.layers.Reshape((2, 1), name = 'Res12123', )(Add21013)
Fla75499 = keras.layers.Flatten(name = 'Fla75499', )(Res12123)
Con59757 = keras.layers.Concatenate(axis=1, name = 'Con59757', )([Fla75499,in0Con59757])
Add83461 = keras.layers.Add(name = 'Add83461', )([in0Add83461,in1Add83461])
Fla3959 = keras.layers.Flatten(name = 'Fla3959', )(Add83461)
Mul91572 = keras.layers.Multiply(name = 'Mul91572', )([Con59757,Fla3959])
Res8359 = keras.layers.Reshape((4, 1), name = 'Res8359', )(Mul91572)
Per44860 = keras.layers.Permute((1,2), name = 'Per44860',)(Res8359)
model = tf.keras.models.Model(inputs=[in0Add21013,in1Add21013,in0Con59757,in0Add83461,in1Add83461], outputs=Per44860)
in0Add21013 = tf.constant([[[[0.3675]], [[0.7347]]]])
in1Add21013 = tf.constant([[[[0.2402]], [[0.0042]]]])
in0Con59757 = tf.constant([[0.7843, 0.5765]])
in0Add83461 = tf.constant([[[[[0.473, 0.5216]], [[0.9816, 0.5976]]]]])
in1Add83461 = tf.constant([[[[[0.6467, 0.6691]], [[0.2956, 0.6006]]]]])
print (np.array2string(model.predict([in0Add21013,in1Add21013,in0Con59757,in0Add83461,in1Add83461],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Per44860.png')

LAdd21013 = add_layer([[[[[0.3675]], [[0.7347]]]], [[[[0.2402]], [[0.0042]]]]], Add21013), 
LRes12123 = reshape_layer(Add21013, [2, 1], Res12123), 
LFla75499 = flatten_layer(Res12123, Fla75499), 
LCon59757 = concatenate_layer([Fla75499,[[0.7843, 0.5765]]], 1, Con59757), 
LAdd83461 = add_layer([[[[[[0.473, 0.5216]], [[0.9816, 0.5976]]]]], [[[[[0.6467, 0.6691]], [[0.2956, 0.6006]]]]]], Add83461), 
LFla3959 = flatten_layer(Add83461, Fla3959), 
LMul91572 = multiply_layer([Con59757,Fla3959], Mul91572), 
LRes8359 = reshape_layer(Mul91572, [4, 1], Res8359), 
LPer44860 = permute_layer(Res8359, 1,2, Per44860), 
exec_layers([LAdd21013,LRes12123,LFla75499,LCon59757,LAdd83461,LFla3959,LMul91572,LRes8359,LPer44860],["Add21013","Res12123","Fla75499","Con59757","Add83461","Fla3959","Mul91572","Res8359","Per44860"],Per44860,"Per44860")

Actual (Unparsed): [[[0.6804417], [0.8798083], [1.0017080], [0.6907623]]]

Expected (Unparsed): [[[0.68044169],[0.8798082300000001],[1.00170796],[0.6907622999999999]]]

Actual:   [[[0.6805], [0.8799], [1.0018], [0.6908]]]

Expected: [[[0.6805], [0.8799], [1.0018], [0.6908]]]