import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave31963 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave31963 = tf.keras.layers.Input(shape=([2, 1]))
in0Con74290 = tf.keras.layers.Input(shape=([1]))
in0GRU82088 = tf.keras.layers.Input(shape=([2, 1]))

Ave31963 = keras.layers.Average(name = 'Ave31963', )([in0Ave31963,in1Ave31963])
Fla72707 = keras.layers.Flatten(name = 'Fla72707', )(Ave31963)
Con74290 = keras.layers.Concatenate(axis=1, name = 'Con74290', )([Fla72707,in0Con74290])
GRU82088 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU82088', )(in0GRU82088)
Max47796 = keras.layers.Maximum(name = 'Max47796', )([Con74290,GRU82088])
Res65488 = keras.layers.Reshape((3, 1), name = 'Res65488', )(Max47796)
Res17968 = keras.layers.Reshape((3, 1, 1), name = 'Res17968', )(Res65488)
Up_98969 = keras.layers.UpSampling2D(size=(2, 1), name = 'Up_98969', )(Res17968)
model = tf.keras.models.Model(inputs=[in0Ave31963,in1Ave31963,in0Con74290,in0GRU82088], outputs=Up_98969)
w = model.get_layer('GRU82088').get_weights() 
w[0] = np.array([[2, 10, 2, 8, 5, 9, 1, 8, 8]])
w[1] = np.array([[8, 8, 8, 10, 1, 4, 1, 1, 4], [8, 2, 5, 10, 9, 8, 2, 9, 4], [1, 5, 9, 4, 8, 1, 8, 3, 8]])
w[2] = np.array([[8, 4, 1, 10, 10, 2, 8, 5, 9], [1, 5, 4, 4, 9, 2, 1, 5, 6]])
model.get_layer('GRU82088').set_weights(w) 
in0Ave31963 = tf.constant([[[0.5116], [0.4759]]])
in1Ave31963 = tf.constant([[[0.631], [0.7134]]])
in0Con74290 = tf.constant([[0.4533]])
in0GRU82088 = tf.constant([[[5], [9]]])
print (np.array2string(model.predict([in0Ave31963,in1Ave31963,in0Con74290,in0GRU82088],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Up_98969.png')

LAve31963 = average_layer([[[[0.5116], [0.4759]]], [[[0.631], [0.7134]]]], Ave31963), 
LFla72707 = flatten_layer(Ave31963, Fla72707), 
LCon74290 = concatenate_layer([Fla72707,[[0.4533]]], 1, Con74290), 
LGRU82088 = gru_layer([[[5], [9]]],[[2, 10, 2, 8, 5, 9, 1, 8, 8]],[[8, 8, 8, 10, 1, 4, 1, 1, 4], [8, 2, 5, 10, 9, 8, 2, 9, 4], [1, 5, 9, 4, 8, 1, 8, 3, 8]],[[8, 4, 1, 10, 10, 2, 8, 5, 9], [1, 5, 4, 4, 9, 2, 1, 5, 6]], true, GRU82088), 
LMax47796 = maximum_layer([Con74290,GRU82088], Max47796), 
LRes65488 = reshape_layer(Max47796, [3, 1], Res65488), 
LRes17968 = reshape_layer(Res65488, [3, 1, 1], Res17968), 
LUp_98969 = up_sampling2D_layer(Res17968, 2, 1, Up_98969), 
exec_layers([LAve31963,LFla72707,LCon74290,LGRU82088,LMax47796,LRes65488,LRes17968,LUp_98969],["Ave31963","Fla72707","Con74290","GRU82088","Max47796","Res65488","Res17968","Up_98969"],Up_98969,"Up_98969")

Actual (Unparsed): [[[[0.5713000]], [[0.5713000]], [[0.5946500]], [[0.5946500]], [[0.4533000]], [[0.4533000]]]]

Expected (Unparsed): [[[[0.5713]],[[0.5713]],[[0.59465]],[[0.59465]],[[0.4533]],[[0.4533]]]]

Actual:   [[[[0.5713]], [[0.5713]], [[0.5947]], [[0.5947]], [[0.4533]], [[0.4533]]]]

Expected: [[[[0.5713]], [[0.5713]], [[0.5947]], [[0.5947]], [[0.4533]], [[0.4533]]]]