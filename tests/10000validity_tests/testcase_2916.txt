import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo72630 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))

Glo72630 = keras.layers.GlobalMaxPool3D(name = 'Glo72630', )(in0Glo72630)
Res15870 = keras.layers.Reshape((1, 1), name = 'Res15870', )(Glo72630)
Res37590 = keras.layers.Reshape((1, 1, 1), name = 'Res37590', )(Res15870)
Con27305 = keras.layers.Conv2DTranspose(2, (1, 1),strides=(1, 2), padding='valid', name = 'Con27305', )(Res37590)
Glo74536 = keras.layers.GlobalMaxPool2D(name = 'Glo74536', )(Con27305)
Res27816 = keras.layers.Reshape((2, 1), name = 'Res27816', )(Glo74536)
LST27939 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST27939', )(Res27816)
model = tf.keras.models.Model(inputs=[in0Glo72630], outputs=LST27939)
w = model.get_layer('Con27305').get_weights() 
w[0] = np.array([[[[0.7104], [0.8926]]]])
w[1] = np.array([0, 0])
model.get_layer('Con27305').set_weights(w) 
w = model.get_layer('LST27939').get_weights() 
w[0] = np.array([[3, 9, 7, 6, 3, 8, 3, 7, 9, 5, 7, 3]])
w[1] = np.array([[5, 8, 4, 5, 7, 7, 5, 7, 5, 5, 4, 10], [1, 2, 5, 3, 7, 9, 3, 4, 1, 4, 10, 6], [10, 1, 7, 1, 5, 10, 3, 10, 5, 7, 8, 6]])
w[2] = np.array([2, 6, 1, 2, 10, 5, 9, 3, 7, 2, 2, 2])
model.get_layer('LST27939').set_weights(w) 
in0Glo72630 = tf.constant([[[[[1.0961], [1.5923]], [[1.9659], [1.016]]], [[[1.1559], [1.7732]], [[1.2898], [1.6156]]]]])
print (np.array2string(model.predict([in0Glo72630],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST27939.png')

LGlo72630 = global_max_pool3D_layer([[[[[1.0961], [1.5923]], [[1.9659], [1.016]]], [[[1.1559], [1.7732]], [[1.2898], [1.6156]]]]], Glo72630), 
LRes15870 = reshape_layer(Glo72630, [1, 1], Res15870), 
LRes37590 = reshape_layer(Res15870, [1, 1, 1], Res37590), 
LCon27305 = conv2D_transpose_layer(Res37590, 1, 1,[[[[0.7104], [0.8926]]]],[0, 0], 1, 2, false, Con27305), 
LGlo74536 = global_max_pool2D_layer(Con27305, Glo74536), 
LRes27816 = reshape_layer(Glo74536, [2, 1], Res27816), 
LLST27939 = lstm_layer(Res27816,[[3, 9, 7, 6, 3, 8, 3, 7, 9, 5, 7, 3]],[[5, 8, 4, 5, 7, 7, 5, 7, 5, 5, 4, 10], [1, 2, 5, 3, 7, 9, 3, 4, 1, 4, 10, 6], [10, 1, 7, 1, 5, 10, 3, 10, 5, 7, 8, 6]],[2, 6, 1, 2, 10, 5, 9, 3, 7, 2, 2, 2], LST27939), 
exec_layers([LGlo72630,LRes15870,LRes37590,LCon27305,LGlo74536,LRes27816,LLST27939],["Glo72630","Res15870","Res37590","Con27305","Glo74536","Res27816","LST27939"],LST27939,"LST27939")

Actual (Unparsed): [[0.9638827, 0.9640276, 0.9640261]]

Expected (Unparsed): [[0.9638827287002292,0.9640275794656284,0.9640261038305864]]

Actual:   [[0.9639, 0.9641, 0.9641]]

Expected: [[0.9639, 0.9641, 0.9641]]