import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc73148 = tf.keras.layers.Input(shape=([1, 1]))
in0Con19485 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in0Con32239 = tf.keras.layers.Input(shape=([2, 4, 1]))
in0Per59628 = tf.keras.layers.Input(shape=([1, 2]))
in0Min16185 = tf.keras.layers.Input(shape=([1, 1]))
in1Min16185 = tf.keras.layers.Input(shape=([1, 1]))
in0Con8597 = tf.keras.layers.Input(shape=([1, 1]))
in0Max82758 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Max82758 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con61394 = tf.keras.layers.Input(shape=([2, 2]))
in0Con20844 = tf.keras.layers.Input(shape=([1, 2]))
in0Con10158 = tf.keras.layers.Input(shape=([2, 4, 1]))
in0Max72024 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Max72024 = tf.keras.layers.Input(shape=([2, 1, 2]))

Loc73148 = keras.layers.LocallyConnected1D(2, (1),strides=(1), name = 'Loc73148', )(in0Loc73148)
Con19485 = keras.layers.Conv3D(3, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con19485', )(in0Con19485)
Res21867 = keras.layers.Reshape((1, 1, 3), name = 'Res21867', )(Con19485)
Res39774 = keras.layers.Reshape((1, 3), name = 'Res39774', )(Res21867)
Dot65091 = keras.layers.Dot(axes=(1, 1), name = 'Dot65091', )([Loc73148,Res39774])
Res6557 = keras.layers.Reshape((2, 3, 1), name = 'Res6557', )(Dot65091)
Zer56624 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer56624', )(Res6557)
Con32239 = keras.layers.Concatenate(axis=3, name = 'Con32239', )([Zer56624,in0Con32239])
Per59628 = keras.layers.Permute((1,2), name = 'Per59628',)(in0Per59628)
Min16185 = keras.layers.Minimum(name = 'Min16185', )([in0Min16185,in1Min16185])
Con8597 = keras.layers.Concatenate(axis=2, name = 'Con8597', )([Min16185,in0Con8597])
Min76167 = keras.layers.Minimum(name = 'Min76167', )([Per59628,Con8597])
Max82758 = keras.layers.Maximum(name = 'Max82758', )([in0Max82758,in1Max82758])
Res68113 = keras.layers.Reshape((1, 4), name = 'Res68113', )(Max82758)
Con61394 = keras.layers.Conv1D(2, (1),strides=(2), padding='same', dilation_rate=(1), name = 'Con61394', )(in0Con61394)
Con20844 = keras.layers.Concatenate(axis=2, name = 'Con20844', )([Con61394,in0Con20844])
Ave46676 = keras.layers.Average(name = 'Ave46676', )([Res68113,Con20844])
Dot18118 = keras.layers.Dot(axes=(1, 1), name = 'Dot18118', )([Min76167,Ave46676])
Res91128 = keras.layers.Reshape((2, 4, 1), name = 'Res91128', )(Dot18118)
Con10158 = keras.layers.Concatenate(axis=3, name = 'Con10158', )([Res91128,in0Con10158])
Max72024 = keras.layers.Maximum(name = 'Max72024', )([in0Max72024,in1Max72024])
Zer66748 = keras.layers.ZeroPadding2D(padding=((0, 0), (3, 0)), name = 'Zer66748', )(Max72024)
Add13921 = keras.layers.Add(name = 'Add13921', )([Con10158,Zer66748])
Add65191 = keras.layers.Add(name = 'Add65191', )([Con32239,Add13921])
model = tf.keras.models.Model(inputs=[in0Loc73148,in0Con19485,in0Con32239,in0Per59628,in0Min16185,in1Min16185,in0Con8597,in0Max82758,in1Max82758,in0Con61394,in0Con20844,in0Con10158,in0Max72024,in1Max72024], outputs=Add65191)
w = model.get_layer('Loc73148').get_weights() 
w[0] = np.array([[[0.3105, 0.0248]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc73148').set_weights(w) 
w = model.get_layer('Con19485').get_weights() 
w[0] = np.array([[[[[0.3731, 0.9355, 0.4882]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con19485').set_weights(w) 
w = model.get_layer('Con61394').get_weights() 
w[0] = np.array([[[0.0258, 0.4744], [0.3695, 0.0125]]])
w[1] = np.array([0, 0])
model.get_layer('Con61394').set_weights(w) 
in0Loc73148 = tf.constant([[[0.3433]]])
in0Con19485 = tf.constant([[[[[0.8356]]]]])
in0Con32239 = tf.constant([[[[0.8241], [0.9016], [0.389], [0.2923]], [[0.6385], [0.7023], [0.0732], [0.0731]]]])
in0Per59628 = tf.constant([[[1.6711, 1.1695]]])
in0Min16185 = tf.constant([[[0.4952]]])
in1Min16185 = tf.constant([[[0.1262]]])
in0Con8597 = tf.constant([[[0.991]]])
in0Max82758 = tf.constant([[[[0.2363, 0.174], [0.6025, 0.9105]]]])
in1Max82758 = tf.constant([[[[0.1226, 0.5269], [0.8562, 0.6146]]]])
in0Con61394 = tf.constant([[[0.6398, 0.2697], [0.4559, 0.9991]]])
in0Con20844 = tf.constant([[[0.4771, 0.1026]]])
in0Con10158 = tf.constant([[[[0.1712], [0.2662], [0.7661], [0.0277]], [[0.3946], [0.9904], [0.5369], [0.2024]]]])
in0Max72024 = tf.constant([[[[0.7826, 0.3876]], [[0.2987, 0.8215]]]])
in1Max72024 = tf.constant([[[[0.6592, 0.2201]], [[0.3222, 0.8366]]]])
print (np.array2string(model.predict([in0Loc73148,in0Con19485,in0Con32239,in0Per59628,in0Min16185,in1Min16185,in0Con8597,in0Max82758,in1Max82758,in0Con61394,in0Con20844,in0Con10158,in0Max72024,in1Max72024],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add65191.png')

LLoc73148 = locally_connected1D_layer([[[0.3433]]], 1,[[[0.3105, 0.0248]]],[[0, 0]], 1, Loc73148), 
LCon19485 = conv3D_layer([[[[[0.8356]]]]], 1, 1, 1,[[[[[0.3731, 0.9355, 0.4882]]]]],[0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con19485), 
LRes21867 = reshape_layer(Con19485, [1, 1, 3], Res21867), 
LRes39774 = reshape_layer(Res21867, [1, 3], Res39774), 
LDot65091 = dot_layer(Loc73148,Res39774, 1, 1, Dot65091), 
LRes6557 = reshape_layer(Dot65091, [2, 3, 1], Res6557), 
LZer56624 = zero_padding2D_layer(Res6557, 0, 0, 1, 0, Zer56624), 
LCon32239 = concatenate_layer([Zer56624,[[[[0.8241], [0.9016], [0.389], [0.2923]], [[0.6385], [0.7023], [0.0732], [0.0731]]]]], 3, Con32239), 
LPer59628 = permute_layer([[[1.6711, 1.1695]]], 1,2, Per59628), 
LMin16185 = minimum_layer([[[[0.4952]]], [[[0.1262]]]], Min16185), 
LCon8597 = concatenate_layer([Min16185,[[[0.991]]]], 2, Con8597), 
LMin76167 = minimum_layer([Per59628,Con8597], Min76167), 
LMax82758 = maximum_layer([[[[[0.2363, 0.174], [0.6025, 0.9105]]]], [[[[0.1226, 0.5269], [0.8562, 0.6146]]]]], Max82758), 
LRes68113 = reshape_layer(Max82758, [1, 4], Res68113), 
LCon61394 = conv1D_layer([[[0.6398, 0.2697], [0.4559, 0.9991]]], 1,[[[0.0258, 0.4744], [0.3695, 0.0125]]],[0, 0], 2, true, 1, Con61394), 
LCon20844 = concatenate_layer([Con61394,[[[0.4771, 0.1026]]]], 2, Con20844), 
LAve46676 = average_layer([Res68113,Con20844], Ave46676), 
LDot18118 = dot_layer(Min76167,Ave46676, 1, 1, Dot18118), 
LRes91128 = reshape_layer(Dot18118, [2, 4, 1], Res91128), 
LCon10158 = concatenate_layer([Res91128,[[[[0.1712], [0.2662], [0.7661], [0.0277]], [[0.3946], [0.9904], [0.5369], [0.2024]]]]], 3, Con10158), 
LMax72024 = maximum_layer([[[[[0.7826, 0.3876]], [[0.2987, 0.8215]]]], [[[[0.6592, 0.2201]], [[0.3222, 0.8366]]]]], Max72024), 
LZer66748 = zero_padding2D_layer(Max72024, 0, 0, 3, 0, Zer66748), 
LAdd13921 = add_layer([Con10158,Zer66748], Add13921), 
LAdd65191 = add_layer([Con32239,Add13921], Add65191), 
exec_layers([LLoc73148,LCon19485,LRes21867,LRes39774,LDot65091,LRes6557,LZer56624,LCon32239,LPer59628,LMin16185,LCon8597,LMin76167,LMax82758,LRes68113,LCon61394,LCon20844,LAve46676,LDot18118,LRes91128,LCon10158,LMax72024,LZer66748,LAdd13921,LAdd65191],["Loc73148","Con19485","Res21867","Res39774","Dot65091","Res6557","Zer56624","Con32239","Per59628","Min16185","Con8597","Min76167","Max82758","Res68113","Con61394","Con20844","Ave46676","Dot18118","Res91128","Con10158","Max72024","Zer66748","Add13921","Add65191"],Add65191,"Add65191")

Actual (Unparsed): [[[[0.0222403, 0.9953000], [0.0858445, 1.1678000], [0.1674567, 1.1551000], [0.8900108, 0.7076000]], [[0.1746444, 1.0331000], [0.4157984, 1.6927000], [0.6673054, 0.6101000], [0.8276642, 1.1121000]]]]

Expected (Unparsed): [[[[0.022240288469,0.9953000000000001],[0.08584449819437401,1.1678],[0.16745667296467,1.1551],[0.8900108229934279,0.7076]],[[0.17464442054499998,1.0331],[0.4157984141860624,1.6926999999999999],[0.6673054510805919,0.6101000000000001],[0.8276641852084928,1.1120999999999999]]]]

Actual:   [[[[0.0223, 0.9953], [0.0859, 1.1678], [0.1675, 1.1551], [0.8901, 0.7076]], [[0.1747, 1.0331], [0.4158, 1.6927], [0.6674, 0.6101], [0.8277, 1.1121]]]]

Expected: [[[[0.0223, 0.9954], [0.0859, 1.1678], [0.1675, 1.1551], [0.8901, 0.7076]], [[0.1747, 1.0331], [0.4158, 1.6927], [0.6674, 0.6102], [0.8277, 1.1121]]]]