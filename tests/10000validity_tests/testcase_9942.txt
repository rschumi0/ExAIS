import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot48924 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot48924 = tf.keras.layers.Input(shape=([2, 2]))
in0Add72223 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Add72223 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con44372 = tf.keras.layers.Input(shape=([3]))
in0Con8637 = tf.keras.layers.Input(shape=([4, 1, 1, 3]))
in0Loc57294 = tf.keras.layers.Input(shape=([2, 2]))

Dot48924 = keras.layers.Dot(axes=(1, 1), name = 'Dot48924', )([in0Dot48924,in1Dot48924])
Fla45517 = keras.layers.Flatten(name = 'Fla45517', )(Dot48924)
Add72223 = keras.layers.Add(name = 'Add72223', )([in0Add72223,in1Add72223])
Res29143 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res29143', )(Add72223)
Glo67854 = keras.layers.GlobalMaxPool3D(name = 'Glo67854', )(Res29143)
Con44372 = keras.layers.Concatenate(axis=1, name = 'Con44372', )([Glo67854,in0Con44372])
Min9672 = keras.layers.Minimum(name = 'Min9672', )([Fla45517,Con44372])
Res67848 = keras.layers.Reshape((4, 1), name = 'Res67848', )(Min9672)
Res57581 = keras.layers.Reshape((4, 1, 1), name = 'Res57581', )(Res67848)
Res44238 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res44238', )(Res57581)
Con8637 = keras.layers.Concatenate(axis=4, name = 'Con8637', )([Res44238,in0Con8637])
Loc57294 = keras.layers.LocallyConnected1D(2, (2),strides=(1), name = 'Loc57294', )(in0Loc57294)
Res76744 = keras.layers.Reshape((1, 2, 1), name = 'Res76744', )(Loc57294)
Res52200 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res52200', )(Res76744)
Con92129 = keras.layers.Conv3D(4, (1, 1, 1),strides=(8, 5, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con92129', )(Res52200)
Zer46048 = keras.layers.ZeroPadding3D(padding=((3, 0), (0, 0), (0, 0)), name = 'Zer46048', )(Con92129)
Min32268 = keras.layers.Minimum(name = 'Min32268', )([Con8637,Zer46048])
model = tf.keras.models.Model(inputs=[in0Dot48924,in1Dot48924,in0Add72223,in1Add72223,in0Con44372,in0Con8637,in0Loc57294], outputs=Min32268)
w = model.get_layer('Loc57294').get_weights() 
w[0] = np.array([[[0.0215, 0.3993], [0.0213, 0.8513], [0.6775, 0.1672], [0.4334, 0.8053]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc57294').set_weights(w) 
w = model.get_layer('Con92129').get_weights() 
w[0] = np.array([[[[[0.6274, 0.8526, 0.0985, 0.8144]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con92129').set_weights(w) 
in0Dot48924 = tf.constant([[[0.3132, 0.6282], [0.828, 0.0828]]])
in1Dot48924 = tf.constant([[[0.9233, 0.0862], [0.6151, 0.351]]])
in0Add72223 = tf.constant([[[[0.8369]], [[0.7154]]]])
in1Add72223 = tf.constant([[[[0.5717]], [[0.956]]]])
in0Con44372 = tf.constant([[0.8738, 0.7338, 0.1586]])
in0Con8637 = tf.constant([[[[[0.8785, 0.925, 0.0734]]], [[[0.554, 0.2782, 0.2236]]], [[[0.1906, 0.2119, 0.9183]]], [[[0.8045, 0.1094, 0.6667]]]]])
in0Loc57294 = tf.constant([[[0.0277, 0.783], [0.7431, 0.575]]])
print (np.array2string(model.predict([in0Dot48924,in1Dot48924,in0Add72223,in1Add72223,in0Con44372,in0Con8637,in0Loc57294],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min32268.png')

LDot48924 = dot_layer([[[0.3132, 0.6282], [0.828, 0.0828]]], [[[0.9233, 0.0862], [0.6151, 0.351]]], 1, 1, Dot48924), 
LFla45517 = flatten_layer(Dot48924, Fla45517), 
LAdd72223 = add_layer([[[[[0.8369]], [[0.7154]]]], [[[[0.5717]], [[0.956]]]]], Add72223), 
LRes29143 = reshape_layer(Add72223, [2, 1, 1, 1], Res29143), 
LGlo67854 = global_max_pool3D_layer(Res29143, Glo67854), 
LCon44372 = concatenate_layer([Glo67854,[[0.8738, 0.7338, 0.1586]]], 1, Con44372), 
LMin9672 = minimum_layer([Fla45517,Con44372], Min9672), 
LRes67848 = reshape_layer(Min9672, [4, 1], Res67848), 
LRes57581 = reshape_layer(Res67848, [4, 1, 1], Res57581), 
LRes44238 = reshape_layer(Res57581, [4, 1, 1, 1], Res44238), 
LCon8637 = concatenate_layer([Res44238,[[[[[0.8785, 0.925, 0.0734]]], [[[0.554, 0.2782, 0.2236]]], [[[0.1906, 0.2119, 0.9183]]], [[[0.8045, 0.1094, 0.6667]]]]]], 4, Con8637), 
LLoc57294 = locally_connected1D_layer([[[0.0277, 0.783], [0.7431, 0.575]]], 2,[[[0.0215, 0.3993], [0.0213, 0.8513], [0.6775, 0.1672], [0.4334, 0.8053]]],[[0, 0]], 1, Loc57294), 
LRes76744 = reshape_layer(Loc57294, [1, 2, 1], Res76744), 
LRes52200 = reshape_layer(Res76744, [1, 2, 1, 1], Res52200), 
LCon92129 = conv3D_layer(Res52200, 1, 1, 1,[[[[[0.6274, 0.8526, 0.0985, 0.8144]]]]],[0, 0, 0, 0], 8, 5, 1, true, 1, 1, 1, Con92129), 
LZer46048 = zero_padding3D_layer(Con92129, 3, 0, 0, 0, 0, 0, Zer46048), 
LMin32268 = minimum_layer([Con8637,Zer46048], Min32268), 
exec_layers([LDot48924,LFla45517,LAdd72223,LRes29143,LGlo67854,LCon44372,LMin9672,LRes67848,LRes57581,LRes44238,LCon8637,LLoc57294,LRes76744,LRes52200,LCon92129,LZer46048,LMin32268],["Dot48924","Fla45517","Add72223","Res29143","Glo67854","Con44372","Min9672","Res67848","Res57581","Res44238","Con8637","Loc57294","Res76744","Res52200","Con92129","Zer46048","Min32268"],Min32268,"Min32268")

Actual (Unparsed): [[[[[0.0000000, 0.0000000, 0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000, 0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000, 0.0000000, 0.0000000]]], [[[0.0832136, 0.6564412, 0.0758380, 0.6270299]]]]]

Expected (Unparsed): [[[[[0,0,0,0]]],[[[0,0,0,0]]],[[[0,0,0,0]]],[[[0.08321363999999999,0.6564412096200001,0.07583797695000001,0.62702993328]]]]]

Actual:   [[[[[0, 0, 0, 0]]], [[[0, 0, 0, 0]]], [[[0, 0, 0, 0]]], [[[0.0833, 0.6565, 0.0759, 0.6271]]]]]

Expected: [[[[[0, 0, 0, 0]]], [[[0, 0, 0, 0]]], [[[0, 0, 0, 0]]], [[[0.0833, 0.6565, 0.0759, 0.6271]]]]]