import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul78294 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Mul78294 = tf.keras.layers.Input(shape=([1, 2, 2]))

Mul78294 = keras.layers.Multiply(name = 'Mul78294', )([in0Mul78294,in1Mul78294])
Res99647 = keras.layers.Reshape((1, 4), name = 'Res99647', )(Mul78294)
Con56520 = keras.layers.Conv1D(2, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con56520', )(Res99647)
Res97431 = keras.layers.Reshape((1, 2, 1), name = 'Res97431', )(Con56520)
Up_892 = keras.layers.UpSampling2D(size=(2, 2), name = 'Up_892', )(Res97431)
Res88363 = keras.layers.Reshape((2, 4), name = 'Res88363', )(Up_892)
LST79469 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST79469', )(Res88363)
model = tf.keras.models.Model(inputs=[in0Mul78294,in1Mul78294], outputs=LST79469)
w = model.get_layer('Con56520').get_weights() 
w[0] = np.array([[[0.8878, 0.6216], [0.4211, 0.302], [0.4113, 0.3784], [0.077, 0.7538]]])
w[1] = np.array([0, 0])
model.get_layer('Con56520').set_weights(w) 
w = model.get_layer('LST79469').get_weights() 
w[0] = np.array([[2, 9, 2, 9, 3, 2, 3, 3, 7, 10, 5, 9], [2, 4, 4, 9, 10, 5, 5, 10, 7, 9, 10, 5], [6, 1, 4, 9, 4, 9, 2, 6, 4, 6, 6, 3], [7, 9, 1, 6, 5, 7, 1, 6, 8, 9, 8, 4]])
w[1] = np.array([[5, 6, 10, 5, 7, 10, 4, 8, 5, 7, 5, 1], [10, 3, 3, 5, 7, 5, 10, 4, 6, 8, 1, 5], [10, 7, 1, 8, 1, 7, 7, 3, 9, 9, 2, 6]])
w[2] = np.array([7, 3, 5, 9, 3, 1, 2, 3, 5, 7, 5, 1])
model.get_layer('LST79469').set_weights(w) 
in0Mul78294 = tf.constant([[[[0.0798, 0.098], [0.0161, 0.7803]]]])
in1Mul78294 = tf.constant([[[[0.5086, 0.5814], [0.3318, 0.2309]]]])
print (np.array2string(model.predict([in0Mul78294,in1Mul78294],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST79469.png')

LMul78294 = multiply_layer([[[[[0.0798, 0.098], [0.0161, 0.7803]]]], [[[[0.5086, 0.5814], [0.3318, 0.2309]]]]], Mul78294), 
LRes99647 = reshape_layer(Mul78294, [1, 4], Res99647), 
LCon56520 = conv1D_layer(Res99647, 1,[[[0.8878, 0.6216], [0.4211, 0.302], [0.4113, 0.3784], [0.077, 0.7538]]],[0, 0], 1, true, 1, Con56520), 
LRes97431 = reshape_layer(Con56520, [1, 2, 1], Res97431), 
LUp_892 = up_sampling2D_layer(Res97431, 2, 2, Up_892), 
LRes88363 = reshape_layer(Up_892, [2, 4], Res88363), 
LLST79469 = lstm_layer(Res88363,[[2, 9, 2, 9, 3, 2, 3, 3, 7, 10, 5, 9], [2, 4, 4, 9, 10, 5, 5, 10, 7, 9, 10, 5], [6, 1, 4, 9, 4, 9, 2, 6, 4, 6, 6, 3], [7, 9, 1, 6, 5, 7, 1, 6, 8, 9, 8, 4]],[[5, 6, 10, 5, 7, 10, 4, 8, 5, 7, 5, 1], [10, 3, 3, 5, 7, 5, 10, 4, 6, 8, 1, 5], [10, 7, 1, 8, 1, 7, 7, 3, 9, 9, 2, 6]],[7, 3, 5, 9, 3, 1, 2, 3, 5, 7, 5, 1], LST79469), 
exec_layers([LMul78294,LRes99647,LCon56520,LRes97431,LUp_892,LRes88363,LLST79469],["Mul78294","Res99647","Con56520","Res97431","Up_892","Res88363","LST79469"],LST79469,"LST79469")

Actual (Unparsed): [[0.9637629, 0.9638109, 0.9639007]]

Expected (Unparsed): [[0.9637628685907967,0.9638109295562249,0.9639007310911775]]

Actual:   [[0.9638, 0.9639, 0.964]]

Expected: [[0.9638, 0.9639, 0.964]]