import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul21577 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Mul21577 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Dot53679 = tf.keras.layers.Input(shape=([3]))
in1Dot53679 = tf.keras.layers.Input(shape=([3]))
in0Con68024 = tf.keras.layers.Input(shape=([2, 1]))
in0Ave7584 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave7584 = tf.keras.layers.Input(shape=([2, 2]))
in0Zer80744 = tf.keras.layers.Input(shape=([4, 3, 1]))

Mul21577 = keras.layers.Multiply(name = 'Mul21577', )([in0Mul21577,in1Mul21577])
Res94562 = keras.layers.Reshape((2, 2, 1), name = 'Res94562', )(Mul21577)
Res66475 = keras.layers.Reshape((2, 2), name = 'Res66475', )(Res94562)
Dot53679 = keras.layers.Dot(axes=(1, 1), name = 'Dot53679', )([in0Dot53679,in1Dot53679])
Res87071 = keras.layers.Reshape((1, 1), name = 'Res87071', )(Dot53679)
Zer68985 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer68985', )(Res87071)
Con68024 = keras.layers.Concatenate(axis=2, name = 'Con68024', )([Zer68985,in0Con68024])
Ave7584 = keras.layers.Average(name = 'Ave7584', )([in0Ave7584,in1Ave7584])
Ave81254 = keras.layers.Average(name = 'Ave81254', )([Con68024,Ave7584])
Min58045 = keras.layers.Minimum(name = 'Min58045', )([Res66475,Ave81254])
Res7599 = keras.layers.Reshape((2, 2, 1), name = 'Res7599', )(Min58045)
Zer6452 = keras.layers.ZeroPadding2D(padding=((4, 0), (3, 0)), name = 'Zer6452', )(Res7599)
Zer80744 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer80744', )(in0Zer80744)
Ave29859 = keras.layers.Average(name = 'Ave29859', )([Zer6452,Zer80744])
model = tf.keras.models.Model(inputs=[in0Mul21577,in1Mul21577,in0Dot53679,in1Dot53679,in0Con68024,in0Ave7584,in1Ave7584,in0Zer80744], outputs=Ave29859)
in0Mul21577 = tf.constant([[[[[0.8286]], [[0.626]]], [[[0.509]], [[0.1027]]]]])
in1Mul21577 = tf.constant([[[[[0.8032]], [[0.0337]]], [[[0.2518]], [[0.5544]]]]])
in0Dot53679 = tf.constant([[0.8048, 0.3028, 0.6019]])
in1Dot53679 = tf.constant([[0.774, 0.5441, 0.9996]])
in0Con68024 = tf.constant([[[0.3079], [0.2876]]])
in0Ave7584 = tf.constant([[[0.9494, 0.0508], [0.6495, 0.1982]]])
in1Ave7584 = tf.constant([[[0.8085, 0.5953], [0.4857, 0.968]]])
in0Zer80744 = tf.constant([[[[1.3495], [1.3488], [1.9618]], [[1.541], [1.0569], [1.8939]], [[1.2488], [1.5305], [1.5101]], [[1.3399], [1.6147], [1.5277]]]])
print (np.array2string(model.predict([in0Mul21577,in1Mul21577,in0Dot53679,in1Dot53679,in0Con68024,in0Ave7584,in1Ave7584,in0Zer80744],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave29859.png')

LMul21577 = multiply_layer([[[[[[0.8286]], [[0.626]]], [[[0.509]], [[0.1027]]]]], [[[[[0.8032]], [[0.0337]]], [[[0.2518]], [[0.5544]]]]]], Mul21577), 
LRes94562 = reshape_layer(Mul21577, [2, 2, 1], Res94562), 
LRes66475 = reshape_layer(Res94562, [2, 2], Res66475), 
LDot53679 = dot_layer([[0.8048, 0.3028, 0.6019]], [[0.774, 0.5441, 0.9996]], 1, 1, Dot53679), 
LRes87071 = reshape_layer(Dot53679, [1, 1], Res87071), 
LZer68985 = zero_padding1D_layer(Res87071, 1, 0, Zer68985), 
LCon68024 = concatenate_layer([Zer68985,[[[0.3079], [0.2876]]]], 2, Con68024), 
LAve7584 = average_layer([[[[0.9494, 0.0508], [0.6495, 0.1982]]], [[[0.8085, 0.5953], [0.4857, 0.968]]]], Ave7584), 
LAve81254 = average_layer([Con68024,Ave7584], Ave81254), 
LMin58045 = minimum_layer([Res66475,Ave81254], Min58045), 
LRes7599 = reshape_layer(Min58045, [2, 2, 1], Res7599), 
LZer6452 = zero_padding2D_layer(Res7599, 4, 0, 3, 0, Zer6452), 
LZer80744 = zero_padding2D_layer([[[[1.3495], [1.3488], [1.9618]], [[1.541], [1.0569], [1.8939]], [[1.2488], [1.5305], [1.5101]], [[1.3399], [1.6147], [1.5277]]]], 1, 1, 1, 1, Zer80744), 
LAve29859 = average_layer([Zer6452,Zer80744], Ave29859), 
exec_layers([LMul21577,LRes94562,LRes66475,LDot53679,LRes87071,LZer68985,LCon68024,LAve7584,LAve81254,LMin58045,LRes7599,LZer6452,LZer80744,LAve29859],["Mul21577","Res94562","Res66475","Dot53679","Res87071","Zer68985","Con68024","Ave7584","Ave81254","Min58045","Res7599","Zer6452","Zer80744","Ave29859"],Ave29859,"Ave29859")

Actual (Unparsed): [[[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.6747500], [0.6744000], [0.9809000], [0.0000000]], [[0.0000000], [0.7705000], [0.5284500], [0.9469500], [0.0000000]], [[0.0000000], [0.6244000], [0.7652500], [0.7550500], [0.0000000]], [[0.0000000], [0.6699500], [0.8073500], [0.9835875], [0.0105481]], [[0.0000000], [0.0000000], [0.0000000], [0.0640831], [0.0284684]]]]

Expected (Unparsed): [[[[0],[0],[0],[0],[0]],[[0],[0.67475],[0.6744],[0.9809],[0]],[[0],[0.7705],[0.52845],[0.94695],[0]],[[0],[0.6244],[0.76525],[0.75505],[0]],[[0],[0.66995],[0.80735],[0.9835875000000001],[0.0105481]],[[0],[0],[0],[0.0640831],[0.02846844]]]]

Actual:   [[[[0], [0], [0], [0], [0]], [[0], [0.6748], [0.6744], [0.9809], [0]], [[0], [0.7705], [0.5285], [0.947], [0]], [[0], [0.6244], [0.7653], [0.7551], [0]], [[0], [0.67], [0.8074], [0.9836], [0.0106]], [[0], [0], [0], [0.0641], [0.0285]]]]

Expected: [[[[0], [0], [0], [0], [0]], [[0], [0.6748], [0.6744], [0.9809], [0]], [[0], [0.7705], [0.5285], [0.947], [0]], [[0], [0.6244], [0.7653], [0.7551], [0]], [[0], [0.67], [0.8074], [0.9836], [0.0106]], [[0], [0], [0], [0.0641], [0.0285]]]]