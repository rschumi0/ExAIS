import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add89150 = tf.keras.layers.Input(shape=([1, 2]))
in1Add89150 = tf.keras.layers.Input(shape=([1, 2]))
in0Add97911 = tf.keras.layers.Input(shape=([2, 2]))
in1Add97911 = tf.keras.layers.Input(shape=([2, 2]))

Add89150 = keras.layers.Add(name = 'Add89150', )([in0Add89150,in1Add89150])
Res58785 = keras.layers.Reshape((1, 2, 1), name = 'Res58785', )(Add89150)
Res74043 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res74043', )(Res58785)
Glo80547 = keras.layers.GlobalMaxPool3D(name = 'Glo80547', )(Res74043)
Res52969 = keras.layers.Reshape((1, 1), name = 'Res52969', )(Glo80547)
Res40978 = keras.layers.Reshape((1, 1, 1), name = 'Res40978', )(Res52969)
Res13602 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res13602', )(Res40978)
Zer72243 = keras.layers.ZeroPadding3D(padding=((3, 0), (1, 0), (1, 0)), name = 'Zer72243', )(Res13602)
Add97911 = keras.layers.Add(name = 'Add97911', )([in0Add97911,in1Add97911])
Fla13218 = keras.layers.Flatten(name = 'Fla13218', )(Add97911)
Res80273 = keras.layers.Reshape((4, 1), name = 'Res80273', )(Fla13218)
Res88034 = keras.layers.Reshape((4, 1, 1), name = 'Res88034', )(Res80273)
Res41514 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res41514', )(Res88034)
Up_167 = keras.layers.UpSampling3D(size=(1, 2, 2), name = 'Up_167', )(Res41514)
Sub95627 = keras.layers.Subtract(name = 'Sub95627', )([Zer72243,Up_167])
model = tf.keras.models.Model(inputs=[in0Add89150,in1Add89150,in0Add97911,in1Add97911], outputs=Sub95627)
in0Add89150 = tf.constant([[[0.4053, 0.5007]]])
in1Add89150 = tf.constant([[[0.8022, 0.3148]]])
in0Add97911 = tf.constant([[[0.3743, 0.7517], [0.7971, 0.6959]]])
in1Add97911 = tf.constant([[[0.7572, 0.1669], [0.2303, 0.1624]]])
print (np.array2string(model.predict([in0Add89150,in1Add89150,in0Add97911,in1Add97911],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub95627.png')

LAdd89150 = add_layer([[[[0.4053, 0.5007]]], [[[0.8022, 0.3148]]]], Add89150), 
LRes58785 = reshape_layer(Add89150, [1, 2, 1], Res58785), 
LRes74043 = reshape_layer(Res58785, [1, 2, 1, 1], Res74043), 
LGlo80547 = global_max_pool3D_layer(Res74043, Glo80547), 
LRes52969 = reshape_layer(Glo80547, [1, 1], Res52969), 
LRes40978 = reshape_layer(Res52969, [1, 1, 1], Res40978), 
LRes13602 = reshape_layer(Res40978, [1, 1, 1, 1], Res13602), 
LZer72243 = zero_padding3D_layer(Res13602, 3, 0, 1, 0, 1, 0, Zer72243), 
LAdd97911 = add_layer([[[[0.3743, 0.7517], [0.7971, 0.6959]]], [[[0.7572, 0.1669], [0.2303, 0.1624]]]], Add97911), 
LFla13218 = flatten_layer(Add97911, Fla13218), 
LRes80273 = reshape_layer(Fla13218, [4, 1], Res80273), 
LRes88034 = reshape_layer(Res80273, [4, 1, 1], Res88034), 
LRes41514 = reshape_layer(Res88034, [4, 1, 1, 1], Res41514), 
LUp_167 = up_sampling3D_layer(Res41514, 1, 2, 2, Up_167), 
LSub95627 = subtract_layer(Zer72243,Up_167, Sub95627), 
exec_layers([LAdd89150,LRes58785,LRes74043,LGlo80547,LRes52969,LRes40978,LRes13602,LZer72243,LAdd97911,LFla13218,LRes80273,LRes88034,LRes41514,LUp_167,LSub95627],["Add89150","Res58785","Res74043","Glo80547","Res52969","Res40978","Res13602","Zer72243","Add97911","Fla13218","Res80273","Res88034","Res41514","Up_167","Sub95627"],Sub95627,"Sub95627")

Actual (Unparsed): [[[[[-1.1315000], [-1.1315000]], [[-1.1315000], [-1.1315000]]], [[[-0.9186000], [-0.9186000]], [[-0.9186000], [-0.9186000]]], [[[-1.0274000], [-1.0274000]], [[-1.0274000], [-1.0274000]]], [[[-0.8583000], [-0.8583000]], [[-0.8583000], [0.3492000]]]]]

Expected (Unparsed): [[[[[-1.1315],[-1.1315]],[[-1.1315],[-1.1315]]],[[[-0.9186000000000001],[-0.9186000000000001]],[[-0.9186000000000001],[-0.9186000000000001]]],[[[-1.0274],[-1.0274]],[[-1.0274],[-1.0274]]],[[[-0.8583],[-0.8583]],[[-0.8583],[0.34920000000000007]]]]]

Actual:   [[[[[-1.1315], [-1.1315]], [[-1.1315], [-1.1315]]], [[[-0.9186], [-0.9186]], [[-0.9186], [-0.9186]]], [[[-1.0274], [-1.0274]], [[-1.0274], [-1.0274]]], [[[-0.8583], [-0.8583]], [[-0.8583], [0.3492]]]]]

Expected: [[[[[-1.1315], [-1.1315]], [[-1.1315], [-1.1315]]], [[[-0.9186], [-0.9186]], [[-0.9186], [-0.9186]]], [[[-1.0274], [-1.0274]], [[-1.0274], [-1.0274]]], [[[-0.8583], [-0.8583]], [[-0.8583], [0.3493]]]]]