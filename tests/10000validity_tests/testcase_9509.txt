import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul74211 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Mul74211 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Mul85887 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Mul85887 = tf.keras.layers.Input(shape=([2, 1, 2]))

Mul74211 = keras.layers.Multiply(name = 'Mul74211', )([in0Mul74211,in1Mul74211])
Res7978 = keras.layers.Reshape((2, 1, 2), name = 'Res7978', )(Mul74211)
Res85654 = keras.layers.Reshape((2, 2), name = 'Res85654', )(Res7978)
Glo19672 = keras.layers.GlobalAveragePooling1D(name = 'Glo19672', )(Res85654)
Res13167 = keras.layers.Reshape((2, 1), name = 'Res13167', )(Glo19672)
Res41259 = keras.layers.Reshape((2, 1, 1), name = 'Res41259', )(Res13167)
Con8925 = keras.layers.Conv2D(2, (2, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con8925', )(Res41259)
Mul85887 = keras.layers.Multiply(name = 'Mul85887', )([in0Mul85887,in1Mul85887])
Ave87032 = keras.layers.Average(name = 'Ave87032', )([Con8925,Mul85887])
model = tf.keras.models.Model(inputs=[in0Mul74211,in1Mul74211,in0Mul85887,in1Mul85887], outputs=Ave87032)
w = model.get_layer('Con8925').get_weights() 
w[0] = np.array([[[[0.3909, 0.4038]]], [[[0.9346, 0.8954]]]])
w[1] = np.array([0, 0])
model.get_layer('Con8925').set_weights(w) 
in0Mul74211 = tf.constant([[[[[0.8335, 0.8637]]], [[[0.6183, 0.6875]]]]])
in1Mul74211 = tf.constant([[[[[0.3792, 0.2207]]], [[[0.9772, 0.846]]]]])
in0Mul85887 = tf.constant([[[[0.1485, 0.8475]], [[0.0147, 0.413]]]])
in1Mul85887 = tf.constant([[[[0.5879, 0.038]], [[0.6395, 0.3957]]]])
print (np.array2string(model.predict([in0Mul74211,in1Mul74211,in0Mul85887,in1Mul85887],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave87032.png')

LMul74211 = multiply_layer([[[[[[0.8335, 0.8637]]], [[[0.6183, 0.6875]]]]], [[[[[0.3792, 0.2207]]], [[[0.9772, 0.846]]]]]], Mul74211), 
LRes7978 = reshape_layer(Mul74211, [2, 1, 2], Res7978), 
LRes85654 = reshape_layer(Res7978, [2, 2], Res85654), 
LGlo19672 = global_average_pooling1D_layer(Res85654, Glo19672), 
LRes13167 = reshape_layer(Glo19672, [2, 1], Res13167), 
LRes41259 = reshape_layer(Res13167, [2, 1, 1], Res41259), 
LCon8925 = conv2D_layer(Res41259, 2, 1,[[[[0.3909, 0.4038]]], [[[0.9346, 0.8954]]]],[0, 0], 1, 1, true, 1, 1, Con8925), 
LMul85887 = multiply_layer([[[[[0.1485, 0.8475]], [[0.0147, 0.413]]]], [[[[0.5879, 0.038]], [[0.6395, 0.3957]]]]], Mul85887), 
LAve87032 = average_layer([Con8925,Mul85887], Ave87032), 
exec_layers([LMul74211,LRes7978,LRes85654,LGlo19672,LRes13167,LRes41259,LCon8925,LMul85887,LAve87032],["Mul74211","Res7978","Res85654","Glo19672","Res13167","Res41259","Con8925","Mul85887","Ave87032"],Ave87032,"Ave87032")

Actual (Unparsed): [[[[0.3140193, 0.2818701]], [[0.0801678, 0.1596700]]]]

Expected (Unparsed): [[[[0.3140192807445,0.2818700762835]],[[0.08016782983275,0.15967004041049998]]]]

Actual:   [[[[0.3141, 0.2819]], [[0.0802, 0.1597]]]]

Expected: [[[[0.3141, 0.2819]], [[0.0802, 0.1597]]]]