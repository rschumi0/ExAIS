import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con87289 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Mul20616 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul20616 = tf.keras.layers.Input(shape=([2, 2]))
in0Con33096 = tf.keras.layers.Input(shape=([2, 2]))
in0Ave9298 = tf.keras.layers.Input(shape=([2, 1]))
in0Con29074 = tf.keras.layers.Input(shape=([3, 2]))
in0Dot89622 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot89622 = tf.keras.layers.Input(shape=([3, 3]))
in0Con72328 = tf.keras.layers.Input(shape=([3, 1]))

Con87289 = keras.layers.Conv2DTranspose(4, (1, 1),strides=(1, 1), padding='valid', name = 'Con87289', )(in0Con87289)
Res34796 = keras.layers.Reshape((1, 4), name = 'Res34796', )(Con87289)
Zer73623 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer73623', )(Res34796)
Mul20616 = keras.layers.Multiply(name = 'Mul20616', )([in0Mul20616,in1Mul20616])
Con33096 = keras.layers.Concatenate(axis=2, name = 'Con33096', )([Mul20616,in0Con33096])
Max69244 = keras.layers.Maximum(name = 'Max69244', )([Zer73623,Con33096])
Den68807 = keras.layers.Dense(4,name = 'Den68807', )(Max69244)
Zer34231 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer34231', )(Den68807)
Ave9298 = keras.layers.AveragePooling1D(pool_size=(2), name = 'Ave9298', )(in0Ave9298)
LST65995 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST65995', )(Ave9298)
Res28265 = keras.layers.Reshape((3, 1), name = 'Res28265', )(LST65995)
Con29074 = keras.layers.Concatenate(axis=2, name = 'Con29074', )([Res28265,in0Con29074])
Dot89622 = keras.layers.Dot(axes=(1, 1), name = 'Dot89622', )([in0Dot89622,in1Dot89622])
Max83967 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='same', name = 'Max83967', )(Dot89622)
Dot62863 = keras.layers.Dot(axes=(1, 1), name = 'Dot62863', )([Con29074,Max83967])
Con72328 = keras.layers.Concatenate(axis=2, name = 'Con72328', )([Dot62863,in0Con72328])
Mul83977 = keras.layers.Multiply(name = 'Mul83977', )([Zer34231,Con72328])
model = tf.keras.models.Model(inputs=[in0Con87289,in0Mul20616,in1Mul20616,in0Con33096,in0Ave9298,in0Con29074,in0Dot89622,in1Dot89622,in0Con72328], outputs=Mul83977)
w = model.get_layer('Con87289').get_weights() 
w[0] = np.array([[[[0.9087], [0.8769], [0.6903], [0.9916]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con87289').set_weights(w) 
w = model.get_layer('Den68807').get_weights() 
w[0] = np.array([[0.1238, 0.7418, 0.4917, 0.8662], [0.7342, 0.7805, 0.6201, 0.9459], [0.9518, 0.2646, 0.6845, 0.6918], [0.6936, 0.5083, 0.3873, 0.711]])
w[1] = np.array([0.3893, 0.3438, 0.0838, 0.2502])
model.get_layer('Den68807').set_weights(w) 
w = model.get_layer('LST65995').get_weights() 
w[0] = np.array([[7, 9, 7, 3, 8, 5, 7, 5, 2, 2, 1, 9]])
w[1] = np.array([[6, 2, 10, 8, 8, 3, 6, 2, 1, 8, 5, 9], [10, 4, 8, 10, 8, 4, 8, 3, 1, 7, 9, 2], [6, 5, 7, 10, 9, 8, 10, 8, 6, 2, 2, 8]])
w[2] = np.array([3, 10, 6, 9, 6, 2, 5, 1, 9, 8, 2, 7])
model.get_layer('LST65995').set_weights(w) 
in0Con87289 = tf.constant([[[[0.9621]]]])
in0Mul20616 = tf.constant([[[0.7467, 0.2665], [0.5802, 0.6742]]])
in1Mul20616 = tf.constant([[[0.2664, 0.0757], [0.6592, 0.0798]]])
in0Con33096 = tf.constant([[[0.9342, 0.4425], [0.2323, 0.7724]]])
in0Ave9298 = tf.constant([[[1.0326], [1.157]]])
in0Con29074 = tf.constant([[[0.3904, 0.3156], [0.3539, 0.8952], [0.0835, 0.0589]]])
in0Dot89622 = tf.constant([[[0.4512, 0.2545, 0.0666], [0.3063, 0.7227, 0.6644], [0.3633, 0.658, 0.325]]])
in1Dot89622 = tf.constant([[[0.5869, 0.72, 0.8108], [0.4776, 0.8172, 0.7858], [0.3701, 0.4034, 0.946]]])
in0Con72328 = tf.constant([[[0.6107], [0.8202], [0.136]]])
print (np.array2string(model.predict([in0Con87289,in0Mul20616,in1Mul20616,in0Con33096,in0Ave9298,in0Con29074,in0Dot89622,in1Dot89622,in0Con72328],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul83977.png')

LCon87289 = conv2D_transpose_layer([[[[0.9621]]]], 1, 1,[[[[0.9087], [0.8769], [0.6903], [0.9916]]]],[0, 0, 0, 0], 1, 1, false, Con87289), 
LRes34796 = reshape_layer(Con87289, [1, 4], Res34796), 
LZer73623 = zero_padding1D_layer(Res34796, 1, 0, Zer73623), 
LMul20616 = multiply_layer([[[[0.7467, 0.2665], [0.5802, 0.6742]]], [[[0.2664, 0.0757], [0.6592, 0.0798]]]], Mul20616), 
LCon33096 = concatenate_layer([Mul20616,[[[0.9342, 0.4425], [0.2323, 0.7724]]]], 2, Con33096), 
LMax69244 = maximum_layer([Zer73623,Con33096], Max69244), 
LDen68807 = dense_layer(Max69244, [[0.1238, 0.7418, 0.4917, 0.8662], [0.7342, 0.7805, 0.6201, 0.9459], [0.9518, 0.2646, 0.6845, 0.6918], [0.6936, 0.5083, 0.3873, 0.711]],[0.3893, 0.3438, 0.0838, 0.2502], Den68807), 
LZer34231 = zero_padding1D_layer(Den68807, 1, 0, Zer34231), 
LAve9298 = average_pooling1D_layer([[[1.0326], [1.157]]], 2, Ave9298), 
LLST65995 = lstm_layer(Ave9298,[[7, 9, 7, 3, 8, 5, 7, 5, 2, 2, 1, 9]],[[6, 2, 10, 8, 8, 3, 6, 2, 1, 8, 5, 9], [10, 4, 8, 10, 8, 4, 8, 3, 1, 7, 9, 2], [6, 5, 7, 10, 9, 8, 10, 8, 6, 2, 2, 8]],[3, 10, 6, 9, 6, 2, 5, 1, 9, 8, 2, 7], LST65995), 
LRes28265 = reshape_layer(LST65995, [3, 1], Res28265), 
LCon29074 = concatenate_layer([Res28265,[[[0.3904, 0.3156], [0.3539, 0.8952], [0.0835, 0.0589]]]], 2, Con29074), 
LDot89622 = dot_layer([[[0.4512, 0.2545, 0.0666], [0.3063, 0.7227, 0.6644], [0.3633, 0.658, 0.325]]], [[[0.5869, 0.72, 0.8108], [0.4776, 0.8172, 0.7858], [0.3701, 0.4034, 0.946]]], 1, 1, Dot89622), 
LMax83967 = max_pool1D_layer(Dot89622, 1, 1, true, Max83967), 
LDot62863 = dot_layer(Con29074,Max83967, 1, 1, Dot62863), 
LCon72328 = concatenate_layer([Dot62863,[[[0.6107], [0.8202], [0.136]]]], 2, Con72328), 
LMul83977 = multiply_layer([Zer34231,Con72328], Mul83977), 
exec_layers([LCon87289,LRes34796,LZer73623,LMul20616,LCon33096,LMax69244,LDen68807,LZer34231,LAve9298,LLST65995,LRes28265,LCon29074,LDot89622,LMax83967,LDot62863,LCon72328,LMul83977],["Con87289","Res34796","Zer73623","Mul20616","Con33096","Max69244","Den68807","Zer34231","Ave9298","LST65995","Res28265","Con29074","Dot89622","Max83967","Dot62863","Con72328","Mul83977"],Mul83977,"Mul83977")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.8351376, 0.6950942, 0.9436895, 1.1503182], [2.0755894, 2.7752744, 2.9816913, 0.4002841]]]

Expected (Unparsed): [[[0.0,0.0,0.0,0.0],[0.835137670002207,0.6950942143095903,0.9436895897451981,1.1503181643158502],[2.0755892681306594,2.775274246693896,2.9816912062256726,0.40028402629922394]]]

Actual:   [[[0, 0, 0, 0], [0.8352, 0.6951, 0.9437, 1.1504], [2.0756, 2.7753, 2.9817, 0.4003]]]

Expected: [[[0, 0, 0, 0], [0.8352, 0.6951, 0.9437, 1.1504], [2.0756, 2.7753, 2.9817, 0.4003]]]