import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave69678 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Ave69678 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))

Ave69678 = keras.layers.Average(name = 'Ave69678', )([in0Ave69678,in1Ave69678])
Res34912 = keras.layers.Reshape((1, 2, 2), name = 'Res34912', )(Ave69678)
Res10167 = keras.layers.Reshape((1, 4), name = 'Res10167', )(Res34912)
Fla65069 = keras.layers.Flatten(name = 'Fla65069', )(Res10167)
Res98812 = keras.layers.Reshape((4, 1), name = 'Res98812', )(Fla65069)
Res18497 = keras.layers.Reshape((4, 1, 1), name = 'Res18497', )(Res98812)
Loc88115 = keras.layers.LocallyConnected2D(3, (3, 1),strides=(1, 6), name = 'Loc88115', )(Res18497)
model = tf.keras.models.Model(inputs=[in0Ave69678,in1Ave69678], outputs=Loc88115)
w = model.get_layer('Loc88115').get_weights() 
w[0] = np.array([[[0.8375, 0.9644, 0.7063], [0.8965, 0.8818, 0.7282], [0.6386, 0.036, 0.7609]], [[0.8815, 0.5402, 0.2392], [0.2362, 0.6616, 0.3742], [0.4794, 0.0424, 0.9272]]])
w[1] = np.array([[[0, 0, 0]], [[0, 0, 0]]])
model.get_layer('Loc88115').set_weights(w) 
in0Ave69678 = tf.constant([[[[[0.9484], [0.3257]], [[0.4151], [0.7047]]]]])
in1Ave69678 = tf.constant([[[[[0.4832], [0.0904]], [[0.5113], [0.0279]]]]])
print (np.array2string(model.predict([in0Ave69678,in1Ave69678],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc88115.png')

LAve69678 = average_layer([[[[[[0.9484], [0.3257]], [[0.4151], [0.7047]]]]], [[[[[0.4832], [0.0904]], [[0.5113], [0.0279]]]]]], Ave69678), 
LRes34912 = reshape_layer(Ave69678, [1, 2, 2], Res34912), 
LRes10167 = reshape_layer(Res34912, [1, 4], Res10167), 
LFla65069 = flatten_layer(Res10167, Fla65069), 
LRes98812 = reshape_layer(Fla65069, [4, 1], Res98812), 
LRes18497 = reshape_layer(Res98812, [4, 1, 1], Res18497), 
LLoc88115 = locally_connected2D_layer(Res18497, 3, 1,[[[0.8375, 0.9644, 0.7063], [0.8965, 0.8818, 0.7282], [0.6386, 0.036, 0.7609]], [[0.8815, 0.5402, 0.2392], [0.2362, 0.6616, 0.3742], [0.4794, 0.0424, 0.9272]]],[[[0, 0, 0]], [[0, 0, 0]]], 1, 6, Loc88115), 
exec_layers([LAve69678,LRes34912,LRes10167,LFla65069,LRes98812,LRes18497,LLoc88115],["Ave69678","Res34912","Res10167","Fla65069","Res98812","Res18497","Loc88115"],Loc88115,"Loc88115")

Actual (Unparsed): [[[[1.0817989, 0.8904512, 1.0095205]], [[0.4684081, 0.4343729, 0.5627284]]]]

Expected (Unparsed): [[[[1.081798845,0.89045121,1.00952043]],[[0.468408135,0.43437285,0.5627283599999999]]]]

Actual:   [[[[1.0818, 0.8905, 1.0096]], [[0.4685, 0.4344, 0.5628]]]]

Expected: [[[[1.0818, 0.8905, 1.0096]], [[0.4685, 0.4344, 0.5628]]]]