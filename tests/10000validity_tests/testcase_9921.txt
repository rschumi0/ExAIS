import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Zer98688 = tf.keras.layers.Input(shape=([2, 3, 3]))
in0Max40511 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Max40511 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con43673 = tf.keras.layers.Input(shape=([2, 2, 1]))

Zer98688 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer98688', )(in0Zer98688)
Res79923 = keras.layers.Reshape((4, 15), name = 'Res79923', )(Zer98688)
Con39921 = keras.layers.Conv1D(2, (1),strides=(3), padding='valid', dilation_rate=(1), name = 'Con39921', )(Res79923)
Res87280 = keras.layers.Reshape((2, 2, 1), name = 'Res87280', )(Con39921)
Sep53822 = keras.layers.SeparableConv2D(4, (2, 1),strides=(2, 2), padding='same', name = 'Sep53822', )(Res87280)
Zer91402 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer91402', )(Sep53822)
Max40511 = keras.layers.Maximum(name = 'Max40511', )([in0Max40511,in1Max40511])
Den52117 = keras.layers.Dense(3,name = 'Den52117', )(Max40511)
Sof51702 = keras.layers.Softmax(axis=1, name = 'Sof51702', )(Den52117)
Con43673 = keras.layers.Concatenate(axis=3, name = 'Con43673', )([Sof51702,in0Con43673])
Add8461 = keras.layers.Add(name = 'Add8461', )([Zer91402,Con43673])
model = tf.keras.models.Model(inputs=[in0Zer98688,in0Max40511,in1Max40511,in0Con43673], outputs=Add8461)
w = model.get_layer('Con39921').get_weights() 
w[0] = np.array([[[0.3507, 0.8203], [0.1716, 0.8302], [0.4011, 0.2221], [0.7154, 0.6878], [0.6818, 0.4185], [0.8217, 0.6189], [0.4212, 0.1798], [0.3187, 0.7112], [0.7666, 0.1096], [0.7173, 0.8971], [0.7579, 0.4833], [0.7431, 0.7719], [0.7131, 0.7069], [0.3045, 0.2074], [0.8489, 0.8144]]])
w[1] = np.array([0, 0])
model.get_layer('Con39921').set_weights(w) 
w = model.get_layer('Sep53822').get_weights() 
w[0] = np.array([[[[0.9398]]], [[[0.4893]]]])
w[1] = np.array([[[[0.5096, 0.0354, 0.764, 0.9632]]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep53822').set_weights(w) 
w = model.get_layer('Den52117').get_weights() 
w[0] = np.array([[0.8585, 0.4897, 0.4907]])
w[1] = np.array([0.9549, 0.1138, 0.6488])
model.get_layer('Den52117').set_weights(w) 
in0Zer98688 = tf.constant([[[[1.7012, 1.0474, 1.5173], [1.3481, 1.8619, 1.9985], [1.5892, 1.2066, 1.8307]], [[1.9731, 1.1114, 1.3678], [1.2641, 1.816, 1.6737], [1.5162, 1.8967, 1.3238]]]])
in0Max40511 = tf.constant([[[[0.663], [0.7372]], [[0.4818], [0.878]]]])
in1Max40511 = tf.constant([[[[0.7759], [0.0133]], [[0.619], [0.4855]]]])
in0Con43673 = tf.constant([[[[0.0479], [0.3747]], [[0.1578], [0.1283]]]])
print (np.array2string(model.predict([in0Zer98688,in0Max40511,in1Max40511,in0Con43673],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add8461.png')

LZer98688 = zero_padding2D_layer([[[[1.7012, 1.0474, 1.5173], [1.3481, 1.8619, 1.9985], [1.5892, 1.2066, 1.8307]], [[1.9731, 1.1114, 1.3678], [1.2641, 1.816, 1.6737], [1.5162, 1.8967, 1.3238]]]], 1, 1, 1, 1, Zer98688), 
LRes79923 = reshape_layer(Zer98688, [4, 15], Res79923), 
LCon39921 = conv1D_layer(Res79923, 1,[[[0.3507, 0.8203], [0.1716, 0.8302], [0.4011, 0.2221], [0.7154, 0.6878], [0.6818, 0.4185], [0.8217, 0.6189], [0.4212, 0.1798], [0.3187, 0.7112], [0.7666, 0.1096], [0.7173, 0.8971], [0.7579, 0.4833], [0.7431, 0.7719], [0.7131, 0.7069], [0.3045, 0.2074], [0.8489, 0.8144]]],[0, 0], 3, false, 1, Con39921), 
LRes87280 = reshape_layer(Con39921, [2, 2, 1], Res87280), 
LSep53822 = separable_conv2D_layer(Res87280, 2, 1,[[[[[0.9398]]], [[[0.4893]]]],[[[[0.5096, 0.0354, 0.764, 0.9632]]]]],[0, 0, 0, 0], 2, 2, true, Sep53822), 
LZer91402 = zero_padding2D_layer(Sep53822, 1, 0, 1, 0, Zer91402), 
LMax40511 = maximum_layer([[[[[0.663], [0.7372]], [[0.4818], [0.878]]]], [[[[0.7759], [0.0133]], [[0.619], [0.4855]]]]], Max40511), 
LDen52117 = dense_layer(Max40511, [[0.8585, 0.4897, 0.4907]],[0.9549, 0.1138, 0.6488], Den52117), 
LSof51702 = softmax_layer(Den52117, 1, Sof51702), 
LCon43673 = concatenate_layer([Sof51702,[[[[0.0479], [0.3747]], [[0.1578], [0.1283]]]]], 3, Con43673), 
LAdd8461 = add_layer([Zer91402,Con43673], Add8461), 
exec_layers([LZer98688,LRes79923,LCon39921,LRes87280,LSep53822,LZer91402,LMax40511,LDen52117,LSof51702,LCon43673,LAdd8461],["Zer98688","Res79923","Con39921","Res87280","Sep53822","Zer91402","Max40511","Den52117","Sof51702","Con43673","Add8461"],Add8461,"Add8461")

Actual (Unparsed): [[[[0.5336238, 0.5191990, 0.5192382, 0.0479000], [0.4698175, 0.4827694, 0.4827342, 0.3747000]], [[0.4663762, 0.4808010, 0.4807618, 0.1578000], [0.5301825, 0.5172306, 0.5172658, 0.1283000]]]]

Expected (Unparsed): [[[[0.5336238393884012,0.5191990383777718,0.5192382054258851,0.0479],[0.46981754121748287,0.48276938575385,0.4827342276418888,0.3747]],[[0.46637616061159887,0.4808009616222282,0.48076179457411505,0.1578],[0.5301824587825171,0.51723061424615,0.5172657723581112,0.1283]]]]

Actual:   [[[[0.5337, 0.5192, 0.5193, 0.0479], [0.4699, 0.4828, 0.4828, 0.3747]], [[0.4664, 0.4809, 0.4808, 0.1578], [0.5302, 0.5173, 0.5173, 0.1283]]]]

Expected: [[[[0.5337, 0.5192, 0.5193, 0.0479], [0.4699, 0.4828, 0.4828, 0.3747]], [[0.4664, 0.4809, 0.4808, 0.1578], [0.5302, 0.5173, 0.5173, 0.1283]]]]