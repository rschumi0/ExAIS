import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot49497 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot49497 = tf.keras.layers.Input(shape=([2, 2]))
in0Con43698 = tf.keras.layers.Input(shape=([5]))
in0Con48056 = tf.keras.layers.Input(shape=([2, 1]))
in0Mul47231 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Mul47231 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Con5425 = tf.keras.layers.Input(shape=([1]))
in0Dot52468 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot52468 = tf.keras.layers.Input(shape=([3, 3]))
in0Dot47723 = tf.keras.layers.Input(shape=([2]))
in1Dot47723 = tf.keras.layers.Input(shape=([2]))
in0Con19746 = tf.keras.layers.Input(shape=([8]))

Dot49497 = keras.layers.Dot(axes=(1, 2), name = 'Dot49497', )([in0Dot49497,in1Dot49497])
Res27252 = keras.layers.Reshape((2, 2, 1), name = 'Res27252', )(Dot49497)
Res66282 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res66282', )(Res27252)
Cro39347 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro39347', )(Res66282)
Res2124 = keras.layers.Reshape((2, 2, 1), name = 'Res2124', )(Cro39347)
Res77966 = keras.layers.Reshape((2, 2), name = 'Res77966', )(Res2124)
Fla59374 = keras.layers.Flatten(name = 'Fla59374', )(Res77966)
Con43698 = keras.layers.Concatenate(axis=1, name = 'Con43698', )([Fla59374,in0Con43698])
Con48056 = keras.layers.Conv1D(4, (2),strides=(1), padding='same', dilation_rate=(1), name = 'Con48056', )(in0Con48056)
Res91436 = keras.layers.Reshape((2, 4, 1), name = 'Res91436', )(Con48056)
Mul47231 = keras.layers.Multiply(name = 'Mul47231', )([in0Mul47231,in1Mul47231])
Res11590 = keras.layers.Reshape((2, 4, 1), name = 'Res11590', )(Mul47231)
Sub40516 = keras.layers.Subtract(name = 'Sub40516', )([Res91436,Res11590])
Res57923 = keras.layers.Reshape((2, 4), name = 'Res57923', )(Sub40516)
Fla84824 = keras.layers.Flatten(name = 'Fla84824', )(Res57923)
Con5425 = keras.layers.Concatenate(axis=1, name = 'Con5425', )([Fla84824,in0Con5425])
Dot52468 = keras.layers.Dot(axes=(1, 2), name = 'Dot52468', )([in0Dot52468,in1Dot52468])
Res25037 = keras.layers.Reshape((3, 3, 1), name = 'Res25037', )(Dot52468)
PRe8136 = keras.layers.PReLU(name = 'PRe8136', )(Res25037)
Res11765 = keras.layers.Reshape((3, 3), name = 'Res11765', )(PRe8136)
Fla70155 = keras.layers.Flatten(name = 'Fla70155', )(Res11765)
Dot47723 = keras.layers.Dot(axes=(1, 1), name = 'Dot47723', )([in0Dot47723,in1Dot47723])
Con19746 = keras.layers.Concatenate(axis=1, name = 'Con19746', )([Dot47723,in0Con19746])
Mul9650 = keras.layers.Multiply(name = 'Mul9650', )([Fla70155,Con19746])
Ave28586 = keras.layers.Average(name = 'Ave28586', )([Con5425,Mul9650])
Mul40017 = keras.layers.Multiply(name = 'Mul40017', )([Con43698,Ave28586])
model = tf.keras.models.Model(inputs=[in0Dot49497,in1Dot49497,in0Con43698,in0Con48056,in0Mul47231,in1Mul47231,in0Con5425,in0Dot52468,in1Dot52468,in0Dot47723,in1Dot47723,in0Con19746], outputs=Mul40017)
w = model.get_layer('Con48056').get_weights() 
w[0] = np.array([[[0.5585, 0.5363, 0.2189, 0.9852]], [[0.9247, 0.9132, 0.6753, 0.1851]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con48056').set_weights(w) 
w = model.get_layer('PRe8136').get_weights() 
w[0] = np.array([[[0.4689], [0.6714], [0.9937]], [[0.0203], [0.0114], [0.7918]], [[0.4563], [0.4265], [0.0643]]])
model.get_layer('PRe8136').set_weights(w) 
in0Dot49497 = tf.constant([[[0.7372, 0.0385], [0.3662, 0.7283]]])
in1Dot49497 = tf.constant([[[0.2686, 0.732], [0.2721, 0.3896]]])
in0Con43698 = tf.constant([[0.4879, 0.2635, 0.4385, 0.1236, 0.3658]])
in0Con48056 = tf.constant([[[0.3808], [0.6319]]])
in0Mul47231 = tf.constant([[[[[0.2598, 0.8446], [0.8188, 0.1961]], [[0.8131, 0.3148], [0.0185, 0.3595]]]]])
in1Mul47231 = tf.constant([[[[[0.5364, 0.6328], [0.5472, 0.6052]], [[0.1104, 0.673], [0.7079, 0.9889]]]]])
in0Con5425 = tf.constant([[0.7822]])
in0Dot52468 = tf.constant([[[0.3039, 0.0592, 0.9632], [0.4806, 0.0861, 0.6202], [0.2147, 0.3689, 0.092]]])
in1Dot52468 = tf.constant([[[0.4087, 0.2589, 0.0233], [0.3084, 0.0929, 0.9339], [0.0061, 0.8677, 0.1858]]])
in0Dot47723 = tf.constant([[0.5706, 0.3829]])
in1Dot47723 = tf.constant([[0.2643, 0.8848]])
in0Con19746 = tf.constant([[0.2832, 0.8798, 0.0997, 0.2553, 0.5133, 0.6791, 0.2648, 0.7195]])
print (np.array2string(model.predict([in0Dot49497,in1Dot49497,in0Con43698,in0Con48056,in0Mul47231,in1Mul47231,in0Con5425,in0Dot52468,in1Dot52468,in0Dot47723,in1Dot47723,in0Con19746],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul40017.png')

LDot49497 = dot_layer([[[0.7372, 0.0385], [0.3662, 0.7283]]], [[[0.2686, 0.732], [0.2721, 0.3896]]], 1, 2, Dot49497), 
LRes27252 = reshape_layer(Dot49497, [2, 2, 1], Res27252), 
LRes66282 = reshape_layer(Res27252, [2, 2, 1, 1], Res66282), 
LCro39347 = cropping3D_layer(Res66282, 0, 0, 0, 0, 0, 0, Cro39347), 
LRes2124 = reshape_layer(Cro39347, [2, 2, 1], Res2124), 
LRes77966 = reshape_layer(Res2124, [2, 2], Res77966), 
LFla59374 = flatten_layer(Res77966, Fla59374), 
LCon43698 = concatenate_layer([Fla59374,[[0.4879, 0.2635, 0.4385, 0.1236, 0.3658]]], 1, Con43698), 
LCon48056 = conv1D_layer([[[0.3808], [0.6319]]], 2,[[[0.5585, 0.5363, 0.2189, 0.9852]], [[0.9247, 0.9132, 0.6753, 0.1851]]],[0, 0, 0, 0], 1, true, 1, Con48056), 
LRes91436 = reshape_layer(Con48056, [2, 4, 1], Res91436), 
LMul47231 = multiply_layer([[[[[[0.2598, 0.8446], [0.8188, 0.1961]], [[0.8131, 0.3148], [0.0185, 0.3595]]]]], [[[[[0.5364, 0.6328], [0.5472, 0.6052]], [[0.1104, 0.673], [0.7079, 0.9889]]]]]], Mul47231), 
LRes11590 = reshape_layer(Mul47231, [2, 4, 1], Res11590), 
LSub40516 = subtract_layer(Res91436,Res11590, Sub40516), 
LRes57923 = reshape_layer(Sub40516, [2, 4], Res57923), 
LFla84824 = flatten_layer(Res57923, Fla84824), 
LCon5425 = concatenate_layer([Fla84824,[[0.7822]]], 1, Con5425), 
LDot52468 = dot_layer([[[0.3039, 0.0592, 0.9632], [0.4806, 0.0861, 0.6202], [0.2147, 0.3689, 0.092]]], [[[0.4087, 0.2589, 0.0233], [0.3084, 0.0929, 0.9339], [0.0061, 0.8677, 0.1858]]], 1, 2, Dot52468), 
LRes25037 = reshape_layer(Dot52468, [3, 3, 1], Res25037), 
LPRe8136 = prelu_layer(Res25037, [[[0.4689], [0.6714], [0.9937]], [[0.0203], [0.0114], [0.7918]], [[0.4563], [0.4265], [0.0643]]], PRe8136), 
LRes11765 = reshape_layer(PRe8136, [3, 3], Res11765), 
LFla70155 = flatten_layer(Res11765, Fla70155), 
LDot47723 = dot_layer([[0.5706, 0.3829]], [[0.2643, 0.8848]], 1, 1, Dot47723), 
LCon19746 = concatenate_layer([Dot47723,[[0.2832, 0.8798, 0.0997, 0.2553, 0.5133, 0.6791, 0.2648, 0.7195]]], 1, Con19746), 
LMul9650 = multiply_layer([Fla70155,Con19746], Mul9650), 
LAve28586 = average_layer([Con5425,Mul9650], Ave28586), 
LMul40017 = multiply_layer([Con43698,Ave28586], Mul40017), 
exec_layers([LDot49497,LRes27252,LRes66282,LCro39347,LRes2124,LRes77966,LFla59374,LCon43698,LCon48056,LRes91436,LMul47231,LRes11590,LSub40516,LRes57923,LFla84824,LCon5425,LDot52468,LRes25037,LPRe8136,LRes11765,LFla70155,LDot47723,LCon19746,LMul9650,LAve28586,LMul40017],["Dot49497","Res27252","Res66282","Cro39347","Res2124","Res77966","Fla59374","Con43698","Con48056","Res91436","Mul47231","Res11590","Sub40516","Res57923","Fla84824","Con5425","Dot52468","Res25037","PRe8136","Res11765","Fla70155","Dot47723","Con19746","Mul9650","Ave28586","Mul40017"],Mul40017,"Mul40017")

Actual (Unparsed): [[0.1821908, 0.0588323, 0.1265304, 0.0557463, 0.0872872, 0.0264480, 0.1102959, 0.0237130, 0.2169054]]

Expected (Unparsed): [[0.18219084546105124,0.05883225126544815,0.1265304005395172,0.05574626737202715,0.08728724206058079,0.026447950952890244,0.11029586415416351,0.023713004327846395,0.216905396603523]]

Actual:   [[0.1822, 0.0589, 0.1266, 0.0558, 0.0873, 0.0265, 0.1103, 0.0238, 0.217]]

Expected: [[0.1822, 0.0589, 0.1266, 0.0558, 0.0873, 0.0265, 0.1103, 0.0238, 0.217]]