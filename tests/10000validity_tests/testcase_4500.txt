import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max1460 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Max1460 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con55541 = tf.keras.layers.Input(shape=([2, 1]))
in0Con80922 = tf.keras.layers.Input(shape=([1, 1]))
in0Ave28205 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Ave28205 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Mul87619 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul87619 = tf.keras.layers.Input(shape=([1, 1]))
in0Con84298 = tf.keras.layers.Input(shape=([1, 1]))
in0Con54526 = tf.keras.layers.Input(shape=([1, 2]))

Max1460 = keras.layers.Maximum(name = 'Max1460', )([in0Max1460,in1Max1460])
Res3395 = keras.layers.Reshape((1, 4), name = 'Res3395', )(Max1460)
Con55541 = keras.layers.Conv1D(3, (1),strides=(2), padding='valid', dilation_rate=(1), name = 'Con55541', )(in0Con55541)
Con80922 = keras.layers.Concatenate(axis=2, name = 'Con80922', )([Con55541,in0Con80922])
Ave28205 = keras.layers.Average(name = 'Ave28205', )([in0Ave28205,in1Ave28205])
Res43245 = keras.layers.Reshape((2, 2, 2), name = 'Res43245', )(Ave28205)
Res45864 = keras.layers.Reshape((2, 4), name = 'Res45864', )(Res43245)
Dot69927 = keras.layers.Dot(axes=(2, 2), name = 'Dot69927', )([Con80922,Res45864])
Mul87619 = keras.layers.Multiply(name = 'Mul87619', )([in0Mul87619,in1Mul87619])
Con84298 = keras.layers.Concatenate(axis=2, name = 'Con84298', )([Mul87619,in0Con84298])
Mul72466 = keras.layers.Multiply(name = 'Mul72466', )([Dot69927,Con84298])
Con54526 = keras.layers.Concatenate(axis=2, name = 'Con54526', )([Mul72466,in0Con54526])
Mul34571 = keras.layers.Multiply(name = 'Mul34571', )([Res3395,Con54526])
Res17592 = keras.layers.Reshape((1, 4, 1), name = 'Res17592', )(Mul34571)
Cro53523 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro53523', )(Res17592)
model = tf.keras.models.Model(inputs=[in0Max1460,in1Max1460,in0Con55541,in0Con80922,in0Ave28205,in1Ave28205,in0Mul87619,in1Mul87619,in0Con84298,in0Con54526], outputs=Cro53523)
w = model.get_layer('Con55541').get_weights() 
w[0] = np.array([[[0.2998, 0.4013, 0.192]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con55541').set_weights(w) 
in0Max1460 = tf.constant([[[[0.7986, 0.5793], [0.471, 0.6909]]]])
in1Max1460 = tf.constant([[[[0.7194, 0.3366], [0.9049, 0.8]]]])
in0Con55541 = tf.constant([[[0.9193], [0.043]]])
in0Con80922 = tf.constant([[[0.3058]]])
in0Ave28205 = tf.constant([[[[[0.7185, 0.9409]], [[0.8331, 0.8495]]], [[[0.4323, 0.0249]], [[0.1432, 0.491]]]]])
in1Ave28205 = tf.constant([[[[[0.0589, 0.6236]], [[0.5182, 0.876]]], [[[0.8017, 0.3434]], [[0.7251, 0.9163]]]]])
in0Mul87619 = tf.constant([[[0.7303]]])
in1Mul87619 = tf.constant([[[0.5247]]])
in0Con84298 = tf.constant([[[0.4654]]])
in0Con54526 = tf.constant([[[0.7724, 0.8271]]])
print (np.array2string(model.predict([in0Max1460,in1Max1460,in0Con55541,in0Con80922,in0Ave28205,in1Ave28205,in0Mul87619,in1Mul87619,in0Con84298,in0Con54526],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Cro53523.png')

LMax1460 = maximum_layer([[[[[0.7986, 0.5793], [0.471, 0.6909]]]], [[[[0.7194, 0.3366], [0.9049, 0.8]]]]], Max1460), 
LRes3395 = reshape_layer(Max1460, [1, 4], Res3395), 
LCon55541 = conv1D_layer([[[0.9193], [0.043]]], 1,[[[0.2998, 0.4013, 0.192]]],[0, 0, 0], 2, false, 1, Con55541), 
LCon80922 = concatenate_layer([Con55541,[[[0.3058]]]], 2, Con80922), 
LAve28205 = average_layer([[[[[[0.7185, 0.9409]], [[0.8331, 0.8495]]], [[[0.4323, 0.0249]], [[0.1432, 0.491]]]]], [[[[[0.0589, 0.6236]], [[0.5182, 0.876]]], [[[0.8017, 0.3434]], [[0.7251, 0.9163]]]]]], Ave28205), 
LRes43245 = reshape_layer(Ave28205, [2, 2, 2], Res43245), 
LRes45864 = reshape_layer(Res43245, [2, 4], Res45864), 
LDot69927 = dot_layer(Con80922,Res45864, 2, 2, Dot69927), 
LMul87619 = multiply_layer([[[[0.7303]]], [[[0.5247]]]], Mul87619), 
LCon84298 = concatenate_layer([Mul87619,[[[0.4654]]]], 2, Con84298), 
LMul72466 = multiply_layer([Dot69927,Con84298], Mul72466), 
LCon54526 = concatenate_layer([Mul72466,[[[0.7724, 0.8271]]]], 2, Con54526), 
LMul34571 = multiply_layer([Res3395,Con54526], Mul34571), 
LRes17592 = reshape_layer(Mul34571, [1, 4, 1], Res17592), 
LCro53523 = cropping2D_layer(Res17592, 0, 0, 0, 0, Cro53523), 
exec_layers([LMax1460,LRes3395,LCon55541,LCon80922,LAve28205,LRes43245,LRes45864,LDot69927,LMul87619,LCon84298,LMul72466,LCon54526,LMul34571,LRes17592,LCro53523],["Max1460","Res3395","Con55541","Con80922","Ave28205","Res43245","Res45864","Dot69927","Mul87619","Con84298","Mul72466","Con54526","Mul34571","Res17592","Cro53523"],Cro53523,"Cro53523")

Actual (Unparsed): [[[[0.2383230], [0.1428349], [0.6989448], [0.6616800]]]]

Expected (Unparsed): [[[[0.238322958624523],[0.1428348891670095],[0.69894476],[0.66168]]]]

Actual:   [[[[0.2384], [0.1429], [0.699], [0.6617]]]]

Expected: [[[[0.2384], [0.1429], [0.699], [0.6617]]]]