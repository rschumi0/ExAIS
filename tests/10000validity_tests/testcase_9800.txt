import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add22987 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Add22987 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con27752 = tf.keras.layers.Input(shape=([6, 3, 2]))
in0Dep47945 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con71003 = tf.keras.layers.Input(shape=([6, 3, 3]))
in0Zer99508 = tf.keras.layers.Input(shape=([4, 1, 4]))

Add22987 = keras.layers.Add(name = 'Add22987', )([in0Add22987,in1Add22987])
Lea6271 = keras.layers.LeakyReLU(alpha=6.2850552090083545, name = 'Lea6271', )(Add22987)
Zer71531 = keras.layers.ZeroPadding2D(padding=((5, 0), (1, 0)), name = 'Zer71531', )(Lea6271)
Con27752 = keras.layers.Concatenate(axis=3, name = 'Con27752', )([Zer71531,in0Con27752])
Dep47945 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='same', name = 'Dep47945', )(in0Dep47945)
Res79662 = keras.layers.Reshape((1, 2), name = 'Res79662', )(Dep47945)
Glo46438 = keras.layers.GlobalAveragePooling1D(name = 'Glo46438', )(Res79662)
Res23686 = keras.layers.Reshape((2, 1), name = 'Res23686', )(Glo46438)
Res73539 = keras.layers.Reshape((2, 1, 1), name = 'Res73539', )(Res23686)
Zer72956 = keras.layers.ZeroPadding2D(padding=((4, 0), (2, 0)), name = 'Zer72956', )(Res73539)
Con71003 = keras.layers.Concatenate(axis=3, name = 'Con71003', )([Zer72956,in0Con71003])
Zer99508 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer99508', )(in0Zer99508)
Mul80466 = keras.layers.Multiply(name = 'Mul80466', )([Con71003,Zer99508])
Ave54293 = keras.layers.Average(name = 'Ave54293', )([Con27752,Mul80466])
Res24570 = keras.layers.Reshape((6, 12), name = 'Res24570', )(Ave54293)
LST66030 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST66030', )(Res24570)
model = tf.keras.models.Model(inputs=[in0Add22987,in1Add22987,in0Con27752,in0Dep47945,in0Con71003,in0Zer99508], outputs=LST66030)
w = model.get_layer('Dep47945').get_weights() 
w[0] = np.array([[[[0.5818], [0.1122]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep47945').set_weights(w) 
w = model.get_layer('LST66030').get_weights() 
w[0] = np.array([[7, 1, 4, 3, 8, 4, 3, 4], [10, 3, 6, 4, 2, 2, 1, 8], [9, 8, 8, 8, 9, 6, 6, 1], [1, 3, 10, 1, 6, 7, 4, 2], [7, 8, 6, 7, 3, 7, 3, 1], [4, 10, 9, 4, 3, 5, 1, 10], [2, 2, 9, 4, 10, 3, 7, 2], [7, 3, 4, 9, 9, 7, 8, 3], [7, 5, 8, 5, 2, 1, 2, 3], [6, 5, 4, 7, 7, 1, 3, 5], [5, 7, 4, 9, 1, 2, 10, 9], [9, 8, 2, 9, 9, 1, 4, 7]])
w[1] = np.array([[3, 6, 1, 2, 4, 5, 8, 5], [5, 6, 3, 5, 3, 1, 10, 8]])
w[2] = np.array([9, 7, 2, 8, 4, 7, 1, 3])
model.get_layer('LST66030').set_weights(w) 
in0Add22987 = tf.constant([[[[0.2946, 0.3811], [0.9418, 0.6569]]]])
in1Add22987 = tf.constant([[[[0.9785, 0.0776], [0.1373, 0.2209]]]])
in0Con27752 = tf.constant([[[[0.7722, 0.8271], [0.5472, 0.7542], [0.6071, 0.6462]], [[0.7763, 0.8776], [0.3804, 0.5326], [0.8877, 0.2813]], [[0.7025, 0.5198], [0.8234, 0.5675], [0.8949, 0.6052]], [[0.5127, 0.217], [0.391, 0.6294], [0.3366, 0.6691]], [[0.5965, 0.8797], [0.4945, 0.3216], [0.8273, 0.1606]], [[0.9857, 0.9283], [0.4477, 0.1742], [0.1795, 0.3634]]]])
in0Dep47945 = tf.constant([[[[0.629, 0.5389]]]])
in0Con71003 = tf.constant([[[[0.3097, 0.798, 0.9272], [0.8073, 0.9287, 0.1418], [0.0836, 0.5236, 0.4545]], [[0.9485, 0.931, 0.5865], [0.0567, 0.0034, 0.9822], [0.8928, 0.029, 0.6019]], [[0.3395, 0.4622, 0.8044], [0.9306, 0.3169, 0.0527], [0.0658, 0.9389, 0.244]], [[0.0771, 0.1632, 0.0765], [0.3048, 0.1739, 0.5289], [0.7313, 0.2671, 0.3848]], [[0.5546, 0.199, 0.7376], [0.5256, 0.4359, 0.5354], [0.1455, 0.006, 0.8242]], [[0.7028, 0.9983, 0.0425], [0.7326, 0.0047, 0.0809], [0.9454, 0.0364, 0.9253]]]])
in0Zer99508 = tf.constant([[[[1.8491, 1.4029, 1.5321, 1.9193]], [[1.8558, 1.5678, 1.2836, 1.8796]], [[1.0124, 1.4787, 1.3599, 1.966]], [[1.9937, 1.2361, 1.7135, 1.7748]]]])
print (np.array2string(model.predict([in0Add22987,in1Add22987,in0Con27752,in0Dep47945,in0Con71003,in0Zer99508],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST66030.png')

LAdd22987 = add_layer([[[[[0.2946, 0.3811], [0.9418, 0.6569]]]], [[[[0.9785, 0.0776], [0.1373, 0.2209]]]]], Add22987), 
LLea6271 = leaky_relu_layer(Add22987, 6.2850552090083545, Lea6271), 
LZer71531 = zero_padding2D_layer(Lea6271, 5, 0, 1, 0, Zer71531), 
LCon27752 = concatenate_layer([Zer71531,[[[[0.7722, 0.8271], [0.5472, 0.7542], [0.6071, 0.6462]], [[0.7763, 0.8776], [0.3804, 0.5326], [0.8877, 0.2813]], [[0.7025, 0.5198], [0.8234, 0.5675], [0.8949, 0.6052]], [[0.5127, 0.217], [0.391, 0.6294], [0.3366, 0.6691]], [[0.5965, 0.8797], [0.4945, 0.3216], [0.8273, 0.1606]], [[0.9857, 0.9283], [0.4477, 0.1742], [0.1795, 0.3634]]]]], 3, Con27752), 
LDep47945 = depthwise_conv2D_layer([[[[0.629, 0.5389]]]], 1, 1,[[[[0.5818], [0.1122]]]],[0, 0], 1, 1, true, Dep47945), 
LRes79662 = reshape_layer(Dep47945, [1, 2], Res79662), 
LGlo46438 = global_average_pooling1D_layer(Res79662, Glo46438), 
LRes23686 = reshape_layer(Glo46438, [2, 1], Res23686), 
LRes73539 = reshape_layer(Res23686, [2, 1, 1], Res73539), 
LZer72956 = zero_padding2D_layer(Res73539, 4, 0, 2, 0, Zer72956), 
LCon71003 = concatenate_layer([Zer72956,[[[[0.3097, 0.798, 0.9272], [0.8073, 0.9287, 0.1418], [0.0836, 0.5236, 0.4545]], [[0.9485, 0.931, 0.5865], [0.0567, 0.0034, 0.9822], [0.8928, 0.029, 0.6019]], [[0.3395, 0.4622, 0.8044], [0.9306, 0.3169, 0.0527], [0.0658, 0.9389, 0.244]], [[0.0771, 0.1632, 0.0765], [0.3048, 0.1739, 0.5289], [0.7313, 0.2671, 0.3848]], [[0.5546, 0.199, 0.7376], [0.5256, 0.4359, 0.5354], [0.1455, 0.006, 0.8242]], [[0.7028, 0.9983, 0.0425], [0.7326, 0.0047, 0.0809], [0.9454, 0.0364, 0.9253]]]]], 3, Con71003), 
LZer99508 = zero_padding2D_layer([[[[1.8491, 1.4029, 1.5321, 1.9193]], [[1.8558, 1.5678, 1.2836, 1.8796]], [[1.0124, 1.4787, 1.3599, 1.966]], [[1.9937, 1.2361, 1.7135, 1.7748]]]], 1, 1, 1, 1, Zer99508), 
LMul80466 = multiply_layer([Con71003,Zer99508], Mul80466), 
LAve54293 = average_layer([Con27752,Mul80466], Ave54293), 
LRes24570 = reshape_layer(Ave54293, [6, 12], Res24570), 
LLST66030 = lstm_layer(Res24570,[[7, 1, 4, 3, 8, 4, 3, 4], [10, 3, 6, 4, 2, 2, 1, 8], [9, 8, 8, 8, 9, 6, 6, 1], [1, 3, 10, 1, 6, 7, 4, 2], [7, 8, 6, 7, 3, 7, 3, 1], [4, 10, 9, 4, 3, 5, 1, 10], [2, 2, 9, 4, 10, 3, 7, 2], [7, 3, 4, 9, 9, 7, 8, 3], [7, 5, 8, 5, 2, 1, 2, 3], [6, 5, 4, 7, 7, 1, 3, 5], [5, 7, 4, 9, 1, 2, 10, 9], [9, 8, 2, 9, 9, 1, 4, 7]],[[3, 6, 1, 2, 4, 5, 8, 5], [5, 6, 3, 5, 3, 1, 10, 8]],[9, 7, 2, 8, 4, 7, 1, 3], LST66030), 
exec_layers([LAdd22987,LLea6271,LZer71531,LCon27752,LDep47945,LRes79662,LGlo46438,LRes23686,LRes73539,LZer72956,LCon71003,LZer99508,LMul80466,LAve54293,LRes24570,LLST66030],["Add22987","Lea6271","Zer71531","Con27752","Dep47945","Res79662","Glo46438","Res23686","Res73539","Zer72956","Con71003","Zer99508","Mul80466","Ave54293","Res24570","LST66030"],LST66030,"LST66030")

Actual (Unparsed): [[0.9999877, 0.9999877]]

Expected (Unparsed): [[0.999987711650156,0.9999877116483269]]

Actual:   [[1, 1]]

Expected: [[1, 1]]