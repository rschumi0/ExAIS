import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max58461 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Max58461 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Sub86728 = tf.keras.layers.Input(shape=([3]))
in1Sub86728 = tf.keras.layers.Input(shape=([3]))
in0Min40458 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Min40458 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))

Max58461 = keras.layers.Maximum(name = 'Max58461', )([in0Max58461,in1Max58461])
Res47465 = keras.layers.Reshape((1, 1, 2), name = 'Res47465', )(Max58461)
Res52188 = keras.layers.Reshape((1, 2), name = 'Res52188', )(Res47465)
Con96085 = keras.layers.Conv1D(3, (1),strides=(10), padding='same', dilation_rate=(1), name = 'Con96085', )(Res52188)
Res37007 = keras.layers.Reshape((1, 3, 1), name = 'Res37007', )(Con96085)
Res99276 = keras.layers.Reshape((1, 3, 1, 1), name = 'Res99276', )(Res37007)
Zer6053 = keras.layers.ZeroPadding3D(padding=((2, 0), (0, 0), (0, 0)), name = 'Zer6053', )(Res99276)
Sub86728 = keras.layers.Subtract(name = 'Sub86728', )([in0Sub86728,in1Sub86728])
Res63673 = keras.layers.Reshape((3, 1), name = 'Res63673', )(Sub86728)
Res70302 = keras.layers.Reshape((3, 1, 1), name = 'Res70302', )(Res63673)
Res3727 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res3727', )(Res70302)
Zer82831 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer82831', )(Res3727)
Min40458 = keras.layers.Minimum(name = 'Min40458', )([in0Min40458,in1Min40458])
Res39434 = keras.layers.Reshape((1, 2, 2), name = 'Res39434', )(Min40458)
Res42995 = keras.layers.Reshape((1, 4), name = 'Res42995', )(Res39434)
Loc81948 = keras.layers.LocallyConnected1D(3, (1),strides=(1), name = 'Loc81948', )(Res42995)
Res82173 = keras.layers.Reshape((1, 3, 1), name = 'Res82173', )(Loc81948)
Res24964 = keras.layers.Reshape((1, 3, 1, 1), name = 'Res24964', )(Res82173)
Cro41038 = keras.layers.Cropping3D(cropping=((0, 0), (1, 0), (0, 0)), name = 'Cro41038', )(Res24964)
Zer50140 = keras.layers.ZeroPadding3D(padding=((2, 0), (1, 0), (0, 0)), name = 'Zer50140', )(Cro41038)
Add8616 = keras.layers.Add(name = 'Add8616', )([Zer82831,Zer50140])
Max97831 = keras.layers.Maximum(name = 'Max97831', )([Zer6053,Add8616])
model = tf.keras.models.Model(inputs=[in0Max58461,in1Max58461,in0Sub86728,in1Sub86728,in0Min40458,in1Min40458], outputs=Max97831)
w = model.get_layer('Con96085').get_weights() 
w[0] = np.array([[[0.6059, 0.4215, 0.4055], [0.8243, 0.5468, 0.0905]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con96085').set_weights(w) 
w = model.get_layer('Loc81948').get_weights() 
w[0] = np.array([[[0.4814, 0.5024, 0.0945], [0.4208, 0.9917, 0.0629], [0.6633, 0.5454, 0.2457], [0.5658, 0.4859, 0.6664]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc81948').set_weights(w) 
in0Max58461 = tf.constant([[[[[0.5532], [0.7134]]]]])
in1Max58461 = tf.constant([[[[[0.4295], [0.0618]]]]])
in0Sub86728 = tf.constant([[0.9506, 0.1959, 0.6678]])
in1Sub86728 = tf.constant([[0.7111, 0.5287, 0.0431]])
in0Min40458 = tf.constant([[[[[0.6731, 0.0769]], [[0.9813, 0.6477]]]]])
in1Min40458 = tf.constant([[[[[0.0303, 0.1538]], [[0.8298, 0.8615]]]]])
print (np.array2string(model.predict([in0Max58461,in1Max58461,in0Sub86728,in1Sub86728,in0Min40458,in1Min40458],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max97831.png')

LMax58461 = maximum_layer([[[[[[0.5532], [0.7134]]]]], [[[[[0.4295], [0.0618]]]]]], Max58461), 
LRes47465 = reshape_layer(Max58461, [1, 1, 2], Res47465), 
LRes52188 = reshape_layer(Res47465, [1, 2], Res52188), 
LCon96085 = conv1D_layer(Res52188, 1,[[[0.6059, 0.4215, 0.4055], [0.8243, 0.5468, 0.0905]]],[0, 0, 0], 10, true, 1, Con96085), 
LRes37007 = reshape_layer(Con96085, [1, 3, 1], Res37007), 
LRes99276 = reshape_layer(Res37007, [1, 3, 1, 1], Res99276), 
LZer6053 = zero_padding3D_layer(Res99276, 2, 0, 0, 0, 0, 0, Zer6053), 
LSub86728 = subtract_layer([[0.9506, 0.1959, 0.6678]], [[0.7111, 0.5287, 0.0431]], Sub86728), 
LRes63673 = reshape_layer(Sub86728, [3, 1], Res63673), 
LRes70302 = reshape_layer(Res63673, [3, 1, 1], Res70302), 
LRes3727 = reshape_layer(Res70302, [3, 1, 1, 1], Res3727), 
LZer82831 = zero_padding3D_layer(Res3727, 0, 0, 2, 0, 0, 0, Zer82831), 
LMin40458 = minimum_layer([[[[[[0.6731, 0.0769]], [[0.9813, 0.6477]]]]], [[[[[0.0303, 0.1538]], [[0.8298, 0.8615]]]]]], Min40458), 
LRes39434 = reshape_layer(Min40458, [1, 2, 2], Res39434), 
LRes42995 = reshape_layer(Res39434, [1, 4], Res42995), 
LLoc81948 = locally_connected1D_layer(Res42995, 1,[[[0.4814, 0.5024, 0.0945], [0.4208, 0.9917, 0.0629], [0.6633, 0.5454, 0.2457], [0.5658, 0.4859, 0.6664]]],[[0, 0, 0]], 1, Loc81948), 
LRes82173 = reshape_layer(Loc81948, [1, 3, 1], Res82173), 
LRes24964 = reshape_layer(Res82173, [1, 3, 1, 1], Res24964), 
LCro41038 = cropping3D_layer(Res24964, 0, 0, 1, 0, 0, 0, Cro41038), 
LZer50140 = zero_padding3D_layer(Cro41038, 2, 0, 1, 0, 0, 0, Zer50140), 
LAdd8616 = add_layer([Zer82831,Zer50140], Add8616), 
LMax97831 = maximum_layer([Zer6053,Add8616], Max97831), 
exec_layers([LMax58461,LRes47465,LRes52188,LCon96085,LRes37007,LRes99276,LZer6053,LSub86728,LRes63673,LRes70302,LRes3727,LZer82831,LMin40458,LRes39434,LRes42995,LLoc81948,LRes82173,LRes24964,LCro41038,LZer50140,LAdd8616,LMax97831],["Max58461","Res47465","Res52188","Con96085","Res37007","Res99276","Zer6053","Sub86728","Res63673","Res70302","Res3727","Zer82831","Min40458","Res39434","Res42995","Loc81948","Res82173","Res24964","Cro41038","Zer50140","Add8616","Max97831"],Max97831,"Max97831")

Actual (Unparsed): [[[[[0.0000000]], [[0.0000000]], [[0.2395000]]], [[[0.0000000]], [[0.0000000]], [[0.0000000]]], [[[0.9232395]], [[0.8587748]], [[1.2679095]]]]]

Expected (Unparsed): [[[[[0]],[[0]],[[0.23950000000000005]]],[[[0]],[[0]],[[0]]],[[[0.9232395]],[[0.8587748]],[[1.2679095]]]]]

Actual:   [[[[[0]], [[0]], [[0.2395]]], [[[0]], [[0]], [[0]]], [[[0.9233]], [[0.8588]], [[1.268]]]]]

Expected: [[[[[0]], [[0]], [[0.2396]]], [[[0]], [[0]], [[0]]], [[[0.9233]], [[0.8588]], [[1.268]]]]]