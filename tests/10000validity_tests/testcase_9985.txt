import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave45902 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Mul6925 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Mul6925 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Con96358 = tf.keras.layers.Input(shape=([1]))
in0Mul94345 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in1Mul94345 = tf.keras.layers.Input(shape=([2, 1, 2, 1]))
in0Con44016 = tf.keras.layers.Input(shape=([1]))

Ave45902 = keras.layers.AveragePooling2D(pool_size=(1, 1), name = 'Ave45902', )(in0Ave45902)
Res21371 = keras.layers.Reshape((2, 2, 2, 1), name = 'Res21371', )(Ave45902)
Cro93398 = keras.layers.Cropping3D(cropping=((0, 1), (0, 0), (0, 1)), name = 'Cro93398', )(Res21371)
Res46218 = keras.layers.Reshape((1, 2, 1), name = 'Res46218', )(Cro93398)
Res56744 = keras.layers.Reshape((1, 2), name = 'Res56744', )(Res46218)
Fla20342 = keras.layers.Flatten(name = 'Fla20342', )(Res56744)
Mul6925 = keras.layers.Multiply(name = 'Mul6925', )([in0Mul6925,in1Mul6925])
Glo99897 = keras.layers.GlobalMaxPool3D(name = 'Glo99897', )(Mul6925)
Res78335 = keras.layers.Reshape((1, 1), name = 'Res78335', )(Glo99897)
Res68628 = keras.layers.Reshape((1, 1, 1), name = 'Res68628', )(Res78335)
Res69604 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res69604', )(Res68628)
Glo13278 = keras.layers.GlobalMaxPool3D(name = 'Glo13278', )(Res69604)
Res96992 = keras.layers.Reshape((1, 1), name = 'Res96992', )(Glo13278)
Glo92668 = keras.layers.GlobalMaxPool1D(name = 'Glo92668', )(Res96992)
Con96358 = keras.layers.Concatenate(axis=1, name = 'Con96358', )([Glo92668,in0Con96358])
Mul48166 = keras.layers.Multiply(name = 'Mul48166', )([Fla20342,Con96358])
Mul94345 = keras.layers.Multiply(name = 'Mul94345', )([in0Mul94345,in1Mul94345])
Res43692 = keras.layers.Reshape((2, 1, 2), name = 'Res43692', )(Mul94345)
Res84754 = keras.layers.Reshape((2, 2), name = 'Res84754', )(Res43692)
LST2268 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST2268', )(Res84754)
Con44016 = keras.layers.Concatenate(axis=1, name = 'Con44016', )([LST2268,in0Con44016])
Min43136 = keras.layers.Minimum(name = 'Min43136', )([Mul48166,Con44016])
model = tf.keras.models.Model(inputs=[in0Ave45902,in0Mul6925,in1Mul6925,in0Con96358,in0Mul94345,in1Mul94345,in0Con44016], outputs=Min43136)
w = model.get_layer('LST2268').get_weights() 
w[0] = np.array([[7, 10, 9, 6], [2, 2, 5, 9]])
w[1] = np.array([[2, 1, 5, 2]])
w[2] = np.array([8, 2, 9, 1])
model.get_layer('LST2268').set_weights(w) 
in0Ave45902 = tf.constant([[[[1.8126, 1.6689], [1.5349, 1.6825]], [[1.8504, 1.5541], [1.3248, 1.8444]]]])
in0Mul6925 = tf.constant([[[[[0.8123], [0.1374]], [[0.6981], [0.6806]]], [[[0.5896], [0.8339]], [[0.1892], [0.5233]]]]])
in1Mul6925 = tf.constant([[[[[0.8171], [0.6303]], [[0.6796], [0.9206]]], [[[0.94], [0.6668]], [[0.2174], [0.4568]]]]])
in0Con96358 = tf.constant([[0.7999]])
in0Mul94345 = tf.constant([[[[[0.6571], [0.9064]]], [[[0.8688], [0.6761]]]]])
in1Mul94345 = tf.constant([[[[[0.0609], [0.5833]]], [[[0.7066], [0.9238]]]]])
in0Con44016 = tf.constant([[0.1255]])
print (np.array2string(model.predict([in0Ave45902,in0Mul6925,in1Mul6925,in0Con96358,in0Mul94345,in1Mul94345,in0Con44016],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min43136.png')

LAve45902 = average_pooling2D_layer([[[[1.8126, 1.6689], [1.5349, 1.6825]], [[1.8504, 1.5541], [1.3248, 1.8444]]]], 1, 1, Ave45902), 
LRes21371 = reshape_layer(Ave45902, [2, 2, 2, 1], Res21371), 
LCro93398 = cropping3D_layer(Res21371, 0, 1, 0, 0, 0, 1, Cro93398), 
LRes46218 = reshape_layer(Cro93398, [1, 2, 1], Res46218), 
LRes56744 = reshape_layer(Res46218, [1, 2], Res56744), 
LFla20342 = flatten_layer(Res56744, Fla20342), 
LMul6925 = multiply_layer([[[[[[0.8123], [0.1374]], [[0.6981], [0.6806]]], [[[0.5896], [0.8339]], [[0.1892], [0.5233]]]]], [[[[[0.8171], [0.6303]], [[0.6796], [0.9206]]], [[[0.94], [0.6668]], [[0.2174], [0.4568]]]]]], Mul6925), 
LGlo99897 = global_max_pool3D_layer(Mul6925, Glo99897), 
LRes78335 = reshape_layer(Glo99897, [1, 1], Res78335), 
LRes68628 = reshape_layer(Res78335, [1, 1, 1], Res68628), 
LRes69604 = reshape_layer(Res68628, [1, 1, 1, 1], Res69604), 
LGlo13278 = global_max_pool3D_layer(Res69604, Glo13278), 
LRes96992 = reshape_layer(Glo13278, [1, 1], Res96992), 
LGlo92668 = global_max_pool1D_layer(Res96992, Glo92668), 
LCon96358 = concatenate_layer([Glo92668,[[0.7999]]], 1, Con96358), 
LMul48166 = multiply_layer([Fla20342,Con96358], Mul48166), 
LMul94345 = multiply_layer([[[[[[0.6571], [0.9064]]], [[[0.8688], [0.6761]]]]], [[[[[0.0609], [0.5833]]], [[[0.7066], [0.9238]]]]]], Mul94345), 
LRes43692 = reshape_layer(Mul94345, [2, 1, 2], Res43692), 
LRes84754 = reshape_layer(Res43692, [2, 2], Res84754), 
LLST2268 = lstm_layer(Res84754,[[7, 10, 9, 6], [2, 2, 5, 9]],[[2, 1, 5, 2]],[8, 2, 9, 1], LST2268), 
LCon44016 = concatenate_layer([LST2268,[[0.1255]]], 1, Con44016), 
LMin43136 = minimum_layer([Mul48166,Con44016], Min43136), 
exec_layers([LAve45902,LRes21371,LCro93398,LRes46218,LRes56744,LFla20342,LMul6925,LGlo99897,LRes78335,LRes68628,LRes69604,LGlo13278,LRes96992,LGlo92668,LCon96358,LMul48166,LMul94345,LRes43692,LRes84754,LLST2268,LCon44016,LMin43136],["Ave45902","Res21371","Cro93398","Res46218","Res56744","Fla20342","Mul6925","Glo99897","Res78335","Res68628","Res69604","Glo13278","Res96992","Glo92668","Con96358","Mul48166","Mul94345","Res43692","Res84754","LST2268","Con44016","Min43136"],Min43136,"Min43136")

Actual (Unparsed): [[0.9640115, 0.1255000]]

Expected (Unparsed): [[0.9640115080675398,0.1255]]

Actual:   [[0.9641, 0.1255]]

Expected: [[0.9641, 0.1255]]