import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub17584 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub17584 = tf.keras.layers.Input(shape=([3, 2]))
in0PRe37121 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Sub49649 = tf.keras.layers.Input(shape=([2]))
in1Sub49649 = tf.keras.layers.Input(shape=([2]))
in0Con67163 = tf.keras.layers.Input(shape=([11]))

Sub17584 = keras.layers.Subtract(name = 'Sub17584', )([in0Sub17584,in1Sub17584])
PRe37121 = keras.layers.PReLU(name = 'PRe37121', input_shape=(2, 2, 2, 2))(in0PRe37121)
Res56755 = keras.layers.Reshape((2, 2, 4), name = 'Res56755', )(PRe37121)
Loc24991 = keras.layers.LocallyConnected2D(3, (1, 1),strides=(1, 1), name = 'Loc24991', )(Res56755)
Res15942 = keras.layers.Reshape((2, 6), name = 'Res15942', )(Loc24991)
Zer25716 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer25716', )(Res15942)
Dot46312 = keras.layers.Dot(axes=(1, 1), name = 'Dot46312', )([Sub17584,Zer25716])
Fla4662 = keras.layers.Flatten(name = 'Fla4662', )(Dot46312)
Sub49649 = keras.layers.Subtract(name = 'Sub49649', )([in0Sub49649,in1Sub49649])
Res11861 = keras.layers.Reshape((2, 1), name = 'Res11861', )(Sub49649)
Res98481 = keras.layers.Reshape((2, 1, 1), name = 'Res98481', )(Res11861)
Max7013 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 9), padding='same', name = 'Max7013', )(Res98481)
Res2999 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res2999', )(Max7013)
Glo66320 = keras.layers.GlobalMaxPool3D(name = 'Glo66320', )(Res2999)
Con67163 = keras.layers.Concatenate(axis=1, name = 'Con67163', )([Glo66320,in0Con67163])
Ave15302 = keras.layers.Average(name = 'Ave15302', )([Fla4662,Con67163])
model = tf.keras.models.Model(inputs=[in0Sub17584,in1Sub17584,in0PRe37121,in0Sub49649,in1Sub49649,in0Con67163], outputs=Ave15302)
w = model.get_layer('PRe37121').get_weights() 
w[0] = np.array([[[[0.1645, 0.0353], [0.0032, 0.5145]], [[0.9806, 0.5124], [0.3202, 0.4526]]], [[[0.6575, 0.5411], [0.7947, 0.4021]], [[0.0789, 0.3953], [0.2145, 0.1873]]]])
model.get_layer('PRe37121').set_weights(w) 
w = model.get_layer('Loc24991').get_weights() 
w[0] = np.array([[[0.4274, 0.9835, 0.3463], [0.82, 0.8748, 0.8685], [0.6161, 0.2571, 0.0657], [0.3926, 0.1986, 0.4032]], [[0.7138, 0.6362, 0.7596], [0.0112, 0.3581, 0.3561], [0.912, 0.087, 0.7374], [0.5681, 0.84, 0.8347]], [[0.4264, 0.8157, 0.3881], [0.7942, 0.161, 0.2376], [0.5695, 0.7526, 0.1197], [0.3344, 0.4882, 0.1242]], [[0.9235, 0.0255, 0.8711], [0.0163, 0.2732, 0.1891], [0.7624, 0.1203, 0.9498], [0.3785, 0.4458, 0.9074]]])
w[1] = np.array([[[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0, 0]]])
model.get_layer('Loc24991').set_weights(w) 
in0Sub17584 = tf.constant([[[0.1423, 0.0468], [0.6104, 0.3935], [0.7121, 0.7001]]])
in1Sub17584 = tf.constant([[[0.1504, 0.7107], [0.1958, 0.6029], [0.8005, 0.3445]]])
in0PRe37121 = tf.constant([[[[[0.5054, 0.5967], [0.0018, 0.006]], [[0.7719, 0.8246], [0.7767, 0.3818]]], [[[0.7544, 0.7333], [0.0878, 0.4362]], [[0.1231, 0.4853], [0.1872, 0.0061]]]]])
in0Sub49649 = tf.constant([[0.7267, 0.8777]])
in1Sub49649 = tf.constant([[0.0621, 0.4701]])
in0Con67163 = tf.constant([[0.8959, 0.5247, 0.5933, 0.6883, 0.2839, 0.6072, 0.9445, 0.4823, 0.8941, 0.0406, 0.2594]])
print (np.array2string(model.predict([in0Sub17584,in1Sub17584,in0PRe37121,in0Sub49649,in1Sub49649,in0Con67163],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave15302.png')

LSub17584 = subtract_layer([[[0.1423, 0.0468], [0.6104, 0.3935], [0.7121, 0.7001]]], [[[0.1504, 0.7107], [0.1958, 0.6029], [0.8005, 0.3445]]], Sub17584), 
LPRe37121 = prelu_layer([[[[[0.5054, 0.5967], [0.0018, 0.006]], [[0.7719, 0.8246], [0.7767, 0.3818]]], [[[0.7544, 0.7333], [0.0878, 0.4362]], [[0.1231, 0.4853], [0.1872, 0.0061]]]]], [[[[0.1645, 0.0353], [0.0032, 0.5145]], [[0.9806, 0.5124], [0.3202, 0.4526]]], [[[0.6575, 0.5411], [0.7947, 0.4021]], [[0.0789, 0.3953], [0.2145, 0.1873]]]], PRe37121), 
LRes56755 = reshape_layer(PRe37121, [2, 2, 4], Res56755), 
LLoc24991 = locally_connected2D_layer(Res56755, 1, 1,[[[0.4274, 0.9835, 0.3463], [0.82, 0.8748, 0.8685], [0.6161, 0.2571, 0.0657], [0.3926, 0.1986, 0.4032]], [[0.7138, 0.6362, 0.7596], [0.0112, 0.3581, 0.3561], [0.912, 0.087, 0.7374], [0.5681, 0.84, 0.8347]], [[0.4264, 0.8157, 0.3881], [0.7942, 0.161, 0.2376], [0.5695, 0.7526, 0.1197], [0.3344, 0.4882, 0.1242]], [[0.9235, 0.0255, 0.8711], [0.0163, 0.2732, 0.1891], [0.7624, 0.1203, 0.9498], [0.3785, 0.4458, 0.9074]]],[[[0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0, 0]]], 1, 1, Loc24991), 
LRes15942 = reshape_layer(Loc24991, [2, 6], Res15942), 
LZer25716 = zero_padding1D_layer(Res15942, 1, 0, Zer25716), 
LDot46312 = dot_layer(Sub17584,Zer25716, 1, 1, Dot46312), 
LFla4662 = flatten_layer(Dot46312, Fla4662), 
LSub49649 = subtract_layer([[0.7267, 0.8777]], [[0.0621, 0.4701]], Sub49649), 
LRes11861 = reshape_layer(Sub49649, [2, 1], Res11861), 
LRes98481 = reshape_layer(Res11861, [2, 1, 1], Res98481), 
LMax7013 = max_pool2D_layer(Res98481, 1, 1, 1, 9, true, Max7013), 
LRes2999 = reshape_layer(Max7013, [2, 1, 1, 1], Res2999), 
LGlo66320 = global_max_pool3D_layer(Res2999, Glo66320), 
LCon67163 = concatenate_layer([Glo66320,[[0.8959, 0.5247, 0.5933, 0.6883, 0.2839, 0.6072, 0.9445, 0.4823, 0.8941, 0.0406, 0.2594]]], 1, Con67163), 
LAve15302 = average_layer([Fla4662,Con67163], Ave15302), 
exec_layers([LSub17584,LPRe37121,LRes56755,LLoc24991,LRes15942,LZer25716,LDot46312,LFla4662,LSub49649,LRes11861,LRes98481,LMax7013,LRes2999,LGlo66320,LCon67163,LAve15302],["Sub17584","PRe37121","Res56755","Loc24991","Res15942","Zer25716","Dot46312","Fla4662","Sub49649","Res11861","Res98481","Max7013","Res2999","Glo66320","Con67163","Ave15302"],Ave15302,"Ave15302")

Actual (Unparsed): [[0.4306104, 0.6147923, 0.3830864, 0.5928029, 0.5805419, 0.4922623, 0.4249598, 0.5453966, 0.2628370, 0.3389270, -0.0740675, 0.0122143]]

Expected (Unparsed): [[0.43061038006200003,0.614792282312,0.383086404875,0.592802912702,0.5805418389520001,0.49226226205400003,0.42495976838199995,0.545396592032,0.262836971955,0.33892706020200003,-0.07406744022799998,0.012214287454000008]]

Actual:   [[0.4307, 0.6148, 0.3831, 0.5929, 0.5806, 0.4923, 0.425, 0.5454, 0.2629, 0.339, -0.074, 0.0123]]

Expected: [[0.4307, 0.6148, 0.3831, 0.5929, 0.5806, 0.4923, 0.425, 0.5454, 0.2629, 0.339, -0.074, 0.0123]]