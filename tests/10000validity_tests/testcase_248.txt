import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con75806 = tf.keras.layers.Input(shape=([2, 2]))
in0Mul82377 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Mul82377 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Sof8209 = tf.keras.layers.Input(shape=([2, 1]))
in0Con18993 = tf.keras.layers.Input(shape=([2, 1]))
in0Dot74118 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot74118 = tf.keras.layers.Input(shape=([2, 2]))
in0Con45293 = tf.keras.layers.Input(shape=([2, 1]))
in0Thr57873 = tf.keras.layers.Input(shape=([2, 1]))
in0Con7883 = tf.keras.layers.Input(shape=([5]))

Con75806 = keras.layers.Conv1D(3, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con75806', )(in0Con75806)
Res8717 = keras.layers.Reshape((2, 3, 1), name = 'Res8717', )(Con75806)
Mul82377 = keras.layers.Multiply(name = 'Mul82377', )([in0Mul82377,in1Mul82377])
Zer69134 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer69134', )(Mul82377)
Add30733 = keras.layers.Add(name = 'Add30733', )([Res8717,Zer69134])
Res10359 = keras.layers.Reshape((2, 3), name = 'Res10359', )(Add30733)
Sof8209 = keras.layers.Softmax(axis=1, name = 'Sof8209', input_shape=(2, 1))(in0Sof8209)
Con18993 = keras.layers.Concatenate(axis=2, name = 'Con18993', )([Sof8209,in0Con18993])
Dot74118 = keras.layers.Dot(axes=(1, 2), name = 'Dot74118', )([in0Dot74118,in1Dot74118])
Mul91813 = keras.layers.Multiply(name = 'Mul91813', )([Con18993,Dot74118])
Con45293 = keras.layers.Concatenate(axis=2, name = 'Con45293', )([Mul91813,in0Con45293])
Ave95208 = keras.layers.Average(name = 'Ave95208', )([Res10359,Con45293])
Fla37389 = keras.layers.Flatten(name = 'Fla37389', )(Ave95208)
Thr57873 = keras.layers.ThresholdedReLU(theta=2.361232151318064, name = 'Thr57873', input_shape=(2, 1))(in0Thr57873)
Res81931 = keras.layers.Reshape((2, 1, 1), name = 'Res81931', )(Thr57873)
Res28741 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res28741', )(Res81931)
Glo88090 = keras.layers.GlobalMaxPool3D(name = 'Glo88090', )(Res28741)
Den7097 = keras.layers.Dense(1,name = 'Den7097', )(Glo88090)
Con7883 = keras.layers.Concatenate(axis=1, name = 'Con7883', )([Den7097,in0Con7883])
Ave97634 = keras.layers.Average(name = 'Ave97634', )([Fla37389,Con7883])
model = tf.keras.models.Model(inputs=[in0Con75806,in0Mul82377,in1Mul82377,in0Sof8209,in0Con18993,in0Dot74118,in1Dot74118,in0Con45293,in0Thr57873,in0Con7883], outputs=Ave97634)
w = model.get_layer('Con75806').get_weights() 
w[0] = np.array([[[0.6086, 0.3838, 0.659], [0.247, 0.239, 0.2292]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con75806').set_weights(w) 
w = model.get_layer('Den7097').get_weights() 
w[0] = np.array([[0.2094]])
w[1] = np.array([0.9249])
model.get_layer('Den7097').set_weights(w) 
in0Con75806 = tf.constant([[[0.6138, 0.4109], [0.6196, 0.3612]]])
in0Mul82377 = tf.constant([[[[0.9742]], [[0.9921]]]])
in1Mul82377 = tf.constant([[[[0.8811]], [[0.3928]]]])
in0Sof8209 = tf.constant([[[0.4728], [0.4884]]])
in0Con18993 = tf.constant([[[0.4877], [0.6667]]])
in0Dot74118 = tf.constant([[[0.5515, 0.59], [0.1638, 0.6503]]])
in1Dot74118 = tf.constant([[[0.1794, 0.9027], [0.2425, 0.228]]])
in0Con45293 = tf.constant([[[0.966], [0.7609]]])
in0Thr57873 = tf.constant([[[0.1678], [0.4287]]])
in0Con7883 = tf.constant([[0.3521, 0.1178, 0.008, 0.138, 0.7639]])
print (np.array2string(model.predict([in0Con75806,in0Mul82377,in1Mul82377,in0Sof8209,in0Con18993,in0Dot74118,in1Dot74118,in0Con45293,in0Thr57873,in0Con7883],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave97634.png')

LCon75806 = conv1D_layer([[[0.6138, 0.4109], [0.6196, 0.3612]]], 1,[[[0.6086, 0.3838, 0.659], [0.247, 0.239, 0.2292]]],[0, 0, 0], 1, true, 1, Con75806), 
LRes8717 = reshape_layer(Con75806, [2, 3, 1], Res8717), 
LMul82377 = multiply_layer([[[[[0.9742]], [[0.9921]]]], [[[[0.8811]], [[0.3928]]]]], Mul82377), 
LZer69134 = zero_padding2D_layer(Mul82377, 0, 0, 2, 0, Zer69134), 
LAdd30733 = add_layer([Res8717,Zer69134], Add30733), 
LRes10359 = reshape_layer(Add30733, [2, 3], Res10359), 
LSof8209 = softmax_layer([[[0.4728], [0.4884]]], 1, Sof8209), 
LCon18993 = concatenate_layer([Sof8209,[[[0.4877], [0.6667]]]], 2, Con18993), 
LDot74118 = dot_layer([[[0.5515, 0.59], [0.1638, 0.6503]]], [[[0.1794, 0.9027], [0.2425, 0.228]]], 1, 2, Dot74118), 
LMul91813 = multiply_layer([Con18993,Dot74118], Mul91813), 
LCon45293 = concatenate_layer([Mul91813,[[[0.966], [0.7609]]]], 2, Con45293), 
LAve95208 = average_layer([Res10359,Con45293], Ave95208), 
LFla37389 = flatten_layer(Ave95208, Fla37389), 
LThr57873 = thresholded_relu_layer([[[0.1678], [0.4287]]], 2.361232151318064, Thr57873), 
LRes81931 = reshape_layer(Thr57873, [2, 1, 1], Res81931), 
LRes28741 = reshape_layer(Res81931, [2, 1, 1, 1], Res28741), 
LGlo88090 = global_max_pool3D_layer(Res28741, Glo88090), 
LDen7097 = dense_layer(Glo88090, [[0.2094]],[0.9249], Den7097), 
LCon7883 = concatenate_layer([Den7097,[[0.3521, 0.1178, 0.008, 0.138, 0.7639]]], 1, Con7883), 
LAve97634 = average_layer([Fla37389,Con7883], Ave97634), 
exec_layers([LCon75806,LRes8717,LMul82377,LZer69134,LAdd30733,LRes10359,LSof8209,LCon18993,LDot74118,LMul91813,LCon45293,LAve95208,LFla37389,LThr57873,LRes81931,LRes28741,LGlo88090,LDen7097,LCon7883,LAve97634],["Con75806","Res8717","Mul82377","Zer69134","Add30733","Res10359","Sof8209","Con18993","Dot74118","Mul91813","Con45293","Ave95208","Fla37389","Thr57873","Res81931","Res28741","Glo88090","Den7097","Con7883","Ave97634"],Ave97634,"Ave97634")

Actual (Unparsed): [[0.6118223, 0.2803549, 0.6396600, 0.2078608, 0.1985920, 0.7923751]]

Expected (Unparsed): [[0.6118222885538845,0.28035494191375,0.639660025,0.20786075256492909,0.198591981195,0.79237508]]

Actual:   [[0.6119, 0.2804, 0.6397, 0.2079, 0.1986, 0.7924]]

Expected: [[0.6119, 0.2804, 0.6397, 0.2079, 0.1986, 0.7924]]