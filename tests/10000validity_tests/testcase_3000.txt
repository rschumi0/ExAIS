import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave87686 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Ave87686 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con49499 = tf.keras.layers.Input(shape=([3, 1]))
in0Dot25750 = tf.keras.layers.Input(shape=([2, 3]))
in1Dot25750 = tf.keras.layers.Input(shape=([2, 3]))

Ave87686 = keras.layers.Average(name = 'Ave87686', )([in0Ave87686,in1Ave87686])
Lay7064 = keras.layers.LayerNormalization(axis=1, epsilon=2.6742657295065495, name = 'Lay7064', )(Ave87686)
Res32532 = keras.layers.Reshape((2, 4), name = 'Res32532', )(Lay7064)
LST57998 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST57998', )(Res32532)
Res42509 = keras.layers.Reshape((3, 1), name = 'Res42509', )(LST57998)
Con49499 = keras.layers.Concatenate(axis=2, name = 'Con49499', )([Res42509,in0Con49499])
Dot25750 = keras.layers.Dot(axes=(2, 2), name = 'Dot25750', )([in0Dot25750,in1Dot25750])
Zer99922 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer99922', )(Dot25750)
Min91704 = keras.layers.Minimum(name = 'Min91704', )([Con49499,Zer99922])
Bat92837 = keras.layers.BatchNormalization(axis=2, epsilon=0.9152197912610974,  name = 'Bat92837', )(Min91704)
model = tf.keras.models.Model(inputs=[in0Ave87686,in1Ave87686,in0Con49499,in0Dot25750,in1Dot25750], outputs=Bat92837)
w = model.get_layer('LST57998').get_weights() 
w[0] = np.array([[6, 7, 4, 7, 6, 9, 2, 3, 2, 3, 9, 10], [6, 5, 3, 10, 6, 9, 4, 8, 1, 4, 9, 10], [5, 4, 5, 5, 10, 10, 1, 1, 3, 8, 6, 4], [1, 3, 1, 7, 10, 2, 2, 1, 4, 10, 2, 4]])
w[1] = np.array([[9, 8, 7, 9, 1, 5, 1, 2, 5, 2, 6, 10], [2, 7, 8, 2, 4, 2, 3, 3, 9, 1, 1, 9], [10, 7, 4, 6, 4, 1, 6, 3, 2, 4, 4, 8]])
w[2] = np.array([4, 10, 6, 9, 4, 10, 6, 7, 4, 5, 3, 5])
model.get_layer('LST57998').set_weights(w) 
w = model.get_layer('Bat92837').get_weights() 
w[0] = np.array([0.1302, 0.5869])
w[1] = np.array([0.2458, 0.1572])
w[2] = np.array([0.0292, 0.2413])
w[3] = np.array([0.8372, 0.9843])
model.get_layer('Bat92837').set_weights(w) 
in0Ave87686 = tf.constant([[[[0.9511, 0.2642], [0.6045, 0.6258]], [[0.2669, 0.7133], [0.2578, 0.8744]]]])
in1Ave87686 = tf.constant([[[[0.1996, 0.6844], [0.2147, 0.589]], [[0.5208, 0.1309], [0.7952, 0.9007]]]])
in0Con49499 = tf.constant([[[0.0083], [0.4651], [0.3803]]])
in0Dot25750 = tf.constant([[[0.8554, 0.4767, 0.0299], [0.1516, 0.2857, 0.3381]]])
in1Dot25750 = tf.constant([[[0.1594, 0.7034, 0.674], [0.3549, 0.2992, 0.6978]]])
print (np.array2string(model.predict([in0Ave87686,in1Ave87686,in0Con49499,in0Dot25750,in1Dot25750],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Bat92837.png')

LAve87686 = average_layer([[[[[0.9511, 0.2642], [0.6045, 0.6258]], [[0.2669, 0.7133], [0.2578, 0.8744]]]], [[[[0.1996, 0.6844], [0.2147, 0.589]], [[0.5208, 0.1309], [0.7952, 0.9007]]]]], Ave87686), 
LLay7064 = layer_normalization_layer(Ave87686, 1, 2.6742657295065495, Lay7064), 
LRes32532 = reshape_layer(Lay7064, [2, 4], Res32532), 
LLST57998 = lstm_layer(Res32532,[[6, 7, 4, 7, 6, 9, 2, 3, 2, 3, 9, 10], [6, 5, 3, 10, 6, 9, 4, 8, 1, 4, 9, 10], [5, 4, 5, 5, 10, 10, 1, 1, 3, 8, 6, 4], [1, 3, 1, 7, 10, 2, 2, 1, 4, 10, 2, 4]],[[9, 8, 7, 9, 1, 5, 1, 2, 5, 2, 6, 10], [2, 7, 8, 2, 4, 2, 3, 3, 9, 1, 1, 9], [10, 7, 4, 6, 4, 1, 6, 3, 2, 4, 4, 8]],[4, 10, 6, 9, 4, 10, 6, 7, 4, 5, 3, 5], LST57998), 
LRes42509 = reshape_layer(LST57998, [3, 1], Res42509), 
LCon49499 = concatenate_layer([Res42509,[[[0.0083], [0.4651], [0.3803]]]], 2, Con49499), 
LDot25750 = dot_layer([[[0.8554, 0.4767, 0.0299], [0.1516, 0.2857, 0.3381]]], [[[0.1594, 0.7034, 0.674], [0.3549, 0.2992, 0.6978]]], 2, 2, Dot25750), 
LZer99922 = zero_padding1D_layer(Dot25750, 1, 0, Zer99922), 
LMin91704 = minimum_layer([Con49499,Zer99922], Min91704), 
LBat92837 = batch_normalization_layer(Min91704, 2, 0.9152197912610974, [0.1302, 0.5869], [0.2458, 0.1572], [0.0292, 0.2413], [0.8372, 0.9843], Bat92837), 
exec_layers([LAve87686,LLay7064,LRes32532,LLST57998,LRes42509,LCon49499,LDot25750,LZer99922,LMin91704,LBat92837],["Ave87686","Lay7064","Res32532","LST57998","Res42509","Con49499","Dot25750","Zer99922","Min91704","Bat92837"],Bat92837,"Bat92837")

Actual (Unparsed): [[[0.2429281, 0.0544458], [0.2912999, 0.2525021], [0.2874830, 0.2142239]]]

Expected (Unparsed): [[[0.24292806397730357,0.05444581475893415],[0.2912999388107781,0.25250205825507893],[0.28748298633857505,0.214223871581253]]]

Actual:   [[[0.243, 0.0545], [0.2913, 0.2526], [0.2875, 0.2143]]]

Expected: [[[0.243, 0.0545], [0.2913, 0.2526], [0.2875, 0.2143]]]