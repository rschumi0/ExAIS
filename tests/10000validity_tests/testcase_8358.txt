import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave66925 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Ave2242 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave2242 = tf.keras.layers.Input(shape=([2, 1]))
in0Ave99437 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave99437 = tf.keras.layers.Input(shape=([2, 1]))

Ave66925 = keras.layers.AveragePooling2D(pool_size=(2, 1), strides=(1, 1), padding='valid', name = 'Ave66925', )(in0Ave66925)
Res6558 = keras.layers.Reshape((1, 4), name = 'Res6558', )(Ave66925)
Per80510 = keras.layers.Permute((2,1), name = 'Per80510',)(Res6558)
Zer26481 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer26481', )(Per80510)
Ave2242 = keras.layers.Average(name = 'Ave2242', )([in0Ave2242,in1Ave2242])
Ave99437 = keras.layers.Average(name = 'Ave99437', )([in0Ave99437,in1Ave99437])
Mul48794 = keras.layers.Multiply(name = 'Mul48794', )([Ave2242,Ave99437])
Mas20995 = keras.layers.Masking(mask_value=1, name = 'Mas20995', )(Mul48794)
Dot92066 = keras.layers.Dot(axes=(2, 2), name = 'Dot92066', )([Zer26481,Mas20995])
model = tf.keras.models.Model(inputs=[in0Ave66925,in0Ave2242,in1Ave2242,in0Ave99437,in1Ave99437], outputs=Dot92066)
in0Ave66925 = tf.constant([[[[1.5715, 1.9328], [1.8066, 1.2629]], [[1.631, 1.8642], [1.6458, 1.8212]]]])
in0Ave2242 = tf.constant([[[0.886], [0.5848]]])
in1Ave2242 = tf.constant([[[0.4364], [0.7741]]])
in0Ave99437 = tf.constant([[[0.4582], [0.4364]]])
in1Ave99437 = tf.constant([[[0.2336], [0.8026]]])
print (np.array2string(model.predict([in0Ave66925,in0Ave2242,in1Ave2242,in0Ave99437,in1Ave99437],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot92066.png')

LAve66925 = average_pooling2D_layer([[[[1.5715, 1.9328], [1.8066, 1.2629]], [[1.631, 1.8642], [1.6458, 1.8212]]]], 2, 1, 1, 1, false, Ave66925), 
LRes6558 = reshape_layer(Ave66925, [1, 4], Res6558), 
LPer80510 = permute_layer(Res6558, 2,1, Per80510), 
LZer26481 = zero_padding1D_layer(Per80510, 2, 0, Zer26481), 
LAve2242 = average_layer([[[[0.886], [0.5848]]], [[[0.4364], [0.7741]]]], Ave2242), 
LAve99437 = average_layer([[[[0.4582], [0.4364]]], [[[0.2336], [0.8026]]]], Ave99437), 
LMul48794 = multiply_layer([Ave2242,Ave99437], Mul48794), 
LMas20995 = masking_layer(Mul48794, 1, Mas20995), 
LDot92066 = dot_layer(Zer26481,Mas20995, 2, 2, Dot92066), 
exec_layers([LAve66925,LRes6558,LPer80510,LZer26481,LAve2242,LAve99437,LMul48794,LMas20995,LDot92066],["Ave66925","Res6558","Per80510","Zer26481","Ave2242","Ave99437","Mul48794","Mas20995","Dot92066"],Dot92066,"Dot92066")

Actual (Unparsed): [[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.3662204, 0.6739970], [0.4342042, 0.7991153], [0.3947976, 0.7265909], [0.3526808, 0.6490786]]]

Expected (Unparsed): [[[0.0,0.0],[0.0,0.0],[0.3662204143499999,0.6739969890937499],[0.43420418837999997,0.7991152435875],[0.39479761389599993,0.726590852505],[0.352680836814,0.64907856801375]]]

Actual:   [[[0, 0], [0, 0], [0.3663, 0.674], [0.4343, 0.7992], [0.3948, 0.7266], [0.3527, 0.6491]]]

Expected: [[[0, 0], [0, 0], [0.3663, 0.674], [0.4343, 0.7992], [0.3948, 0.7266], [0.3527, 0.6491]]]