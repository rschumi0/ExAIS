import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub45151 = tf.keras.layers.Input(shape=([3, 2, 3, 2]))
in1Sub45151 = tf.keras.layers.Input(shape=([3, 2, 3, 2]))

Sub45151 = keras.layers.Subtract(name = 'Sub45151', )([in0Sub45151,in1Sub45151])
Den23766 = keras.layers.Dense(4,name = 'Den23766', )(Sub45151)
Res58289 = keras.layers.Reshape((3, 2, 12), name = 'Res58289', )(Den23766)
Res54110 = keras.layers.Reshape((3, 24), name = 'Res54110', )(Res58289)
GRU96557 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU96557', )(Res54110)
model = tf.keras.models.Model(inputs=[in0Sub45151,in1Sub45151], outputs=GRU96557)
w = model.get_layer('Den23766').get_weights() 
w[0] = np.array([[0.2704, 0.5214, 0.4871, 0.5948], [0.4722, 0.4268, 0.9385, 0.1816]])
w[1] = np.array([0.0892, 0.8553, 0.9067, 0.4027])
model.get_layer('Den23766').set_weights(w) 
w = model.get_layer('GRU96557').get_weights() 
w[0] = np.array([[2, 6, 4, 10, 3, 7], [7, 6, 3, 7, 10, 4], [10, 9, 7, 2, 4, 9], [10, 6, 8, 3, 9, 9], [7, 8, 5, 8, 6, 9], [3, 10, 10, 7, 9, 1], [5, 10, 10, 9, 4, 5], [9, 10, 9, 6, 4, 7], [4, 10, 4, 2, 7, 5], [4, 3, 3, 3, 6, 4], [1, 8, 8, 2, 4, 2], [1, 6, 7, 6, 6, 4], [8, 4, 8, 10, 5, 1], [9, 6, 3, 9, 9, 5], [8, 10, 5, 2, 1, 2], [3, 10, 6, 3, 3, 5], [4, 4, 3, 1, 6, 1], [5, 5, 7, 4, 7, 8], [7, 5, 1, 10, 9, 10], [3, 5, 2, 1, 10, 5], [3, 7, 7, 8, 2, 4], [5, 5, 4, 5, 5, 6], [10, 8, 3, 9, 6, 5], [2, 1, 7, 7, 5, 6]])
w[1] = np.array([[2, 9, 9, 6, 6, 2], [10, 1, 3, 6, 4, 9]])
w[2] = np.array([[8, 10, 3, 5, 10, 9], [7, 3, 4, 8, 2, 2]])
model.get_layer('GRU96557').set_weights(w) 
in0Sub45151 = tf.constant([[[[[0.9357, 0.5011], [0.3464, 0.6074], [0.9507, 0.9365]], [[0.4883, 0.5616], [0.3603, 0.4346], [0.5164, 0.1075]]], [[[0.2331, 0.0638], [0.5893, 0.5886], [0.6788, 0.6071]], [[0.9217, 0.1391], [0.0198, 0.8105], [0.4088, 0.6825]]], [[[0.4394, 0.767], [0.8626, 0.3483], [0.6267, 0.2994]], [[0.0564, 0.222], [0.453, 0.5353], [0.2378, 0.7533]]]]])
in1Sub45151 = tf.constant([[[[[0.3822, 0.6075], [0.8942, 0.4658], [0.1436, 0.5598]], [[0.3318, 0.8347], [0.175, 0.0878], [0.0657, 0.3289]]], [[[0.4857, 0.7047], [0.1062, 0.6502], [0.8784, 0.2836]], [[0.9773, 0.1451], [0.9218, 0.7016], [0.7034, 0.2117]]], [[[0.6722, 0.4846], [0.0626, 0.2816], [0.9041, 0.9369]], [[0.1183, 0.6149], [0.5287, 0.2278], [0.414, 0.7171]]]]])
print (np.array2string(model.predict([in0Sub45151,in1Sub45151],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU96557.png')

LSub45151 = subtract_layer([[[[[0.9357, 0.5011], [0.3464, 0.6074], [0.9507, 0.9365]], [[0.4883, 0.5616], [0.3603, 0.4346], [0.5164, 0.1075]]], [[[0.2331, 0.0638], [0.5893, 0.5886], [0.6788, 0.6071]], [[0.9217, 0.1391], [0.0198, 0.8105], [0.4088, 0.6825]]], [[[0.4394, 0.767], [0.8626, 0.3483], [0.6267, 0.2994]], [[0.0564, 0.222], [0.453, 0.5353], [0.2378, 0.7533]]]]], [[[[[0.3822, 0.6075], [0.8942, 0.4658], [0.1436, 0.5598]], [[0.3318, 0.8347], [0.175, 0.0878], [0.0657, 0.3289]]], [[[0.4857, 0.7047], [0.1062, 0.6502], [0.8784, 0.2836]], [[0.9773, 0.1451], [0.9218, 0.7016], [0.7034, 0.2117]]], [[[0.6722, 0.4846], [0.0626, 0.2816], [0.9041, 0.9369]], [[0.1183, 0.6149], [0.5287, 0.2278], [0.414, 0.7171]]]]], Sub45151), 
LDen23766 = dense_layer(Sub45151, [[0.2704, 0.5214, 0.4871, 0.5948], [0.4722, 0.4268, 0.9385, 0.1816]],[0.0892, 0.8553, 0.9067, 0.4027], Den23766), 
LRes58289 = reshape_layer(Den23766, [3, 2, 12], Res58289), 
LRes54110 = reshape_layer(Res58289, [3, 24], Res54110), 
LGRU96557 = gru_layer(Res54110,[[2, 6, 4, 10, 3, 7], [7, 6, 3, 7, 10, 4], [10, 9, 7, 2, 4, 9], [10, 6, 8, 3, 9, 9], [7, 8, 5, 8, 6, 9], [3, 10, 10, 7, 9, 1], [5, 10, 10, 9, 4, 5], [9, 10, 9, 6, 4, 7], [4, 10, 4, 2, 7, 5], [4, 3, 3, 3, 6, 4], [1, 8, 8, 2, 4, 2], [1, 6, 7, 6, 6, 4], [8, 4, 8, 10, 5, 1], [9, 6, 3, 9, 9, 5], [8, 10, 5, 2, 1, 2], [3, 10, 6, 3, 3, 5], [4, 4, 3, 1, 6, 1], [5, 5, 7, 4, 7, 8], [7, 5, 1, 10, 9, 10], [3, 5, 2, 1, 10, 5], [3, 7, 7, 8, 2, 4], [5, 5, 4, 5, 5, 6], [10, 8, 3, 9, 6, 5], [2, 1, 7, 7, 5, 6]],[[2, 9, 9, 6, 6, 2], [10, 1, 3, 6, 4, 9]],[[8, 10, 3, 5, 10, 9], [7, 3, 4, 8, 2, 2]], true, GRU96557), 
exec_layers([LSub45151,LDen23766,LRes58289,LRes54110,LGRU96557],["Sub45151","Den23766","Res58289","Res54110","GRU96557"],GRU96557,"GRU96557")

Actual (Unparsed): [[0.0000000, 0.0000000]]

Expected (Unparsed): [[0.0,0.0]]

Actual:   [[0, 0]]

Expected: [[0, 0]]