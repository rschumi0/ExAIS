import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave99030 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave99030 = tf.keras.layers.Input(shape=([1, 2]))
in0Sim86859 = tf.keras.layers.Input(shape=([1, 2]))
in0Con45121 = tf.keras.layers.Input(shape=([1]))

Ave99030 = keras.layers.Average(name = 'Ave99030', )([in0Ave99030,in1Ave99030])
Fla54241 = keras.layers.Flatten(name = 'Fla54241', )(Ave99030)
Sim86859 = keras.layers.SimpleRNN(1,name = 'Sim86859', )(in0Sim86859)
Con45121 = keras.layers.Concatenate(axis=1, name = 'Con45121', )([Sim86859,in0Con45121])
Mul41722 = keras.layers.Multiply(name = 'Mul41722', )([Fla54241,Con45121])
Res65128 = keras.layers.Reshape((2, 1), name = 'Res65128', )(Mul41722)
Res20705 = keras.layers.Reshape((2, 1, 1), name = 'Res20705', )(Res65128)
Glo31623 = keras.layers.GlobalAveragePooling2D(name = 'Glo31623', )(Res20705)
model = tf.keras.models.Model(inputs=[in0Ave99030,in1Ave99030,in0Sim86859,in0Con45121], outputs=Glo31623)
w = model.get_layer('Sim86859').get_weights() 
w[0] = np.array([[7], [1]])
w[1] = np.array([[4]])
w[2] = np.array([10])
model.get_layer('Sim86859').set_weights(w) 
in0Ave99030 = tf.constant([[[0.2542, 0.1857]]])
in1Ave99030 = tf.constant([[[0.0751, 0.8659]]])
in0Sim86859 = tf.constant([[[7, 1]]])
in0Con45121 = tf.constant([[0.3431]])
print (np.array2string(model.predict([in0Ave99030,in1Ave99030,in0Sim86859,in0Con45121],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo31623.png')

LAve99030 = average_layer([[[[0.2542, 0.1857]]], [[[0.0751, 0.8659]]]], Ave99030), 
LFla54241 = flatten_layer(Ave99030, Fla54241), 
LSim86859 = simple_rnn_layer([[[7, 1]]],[[7], [1]],[[4]],[10], Sim86859), 
LCon45121 = concatenate_layer([Sim86859,[[0.3431]]], 1, Con45121), 
LMul41722 = multiply_layer([Fla54241,Con45121], Mul41722), 
LRes65128 = reshape_layer(Mul41722, [2, 1], Res65128), 
LRes20705 = reshape_layer(Res65128, [2, 1, 1], Res20705), 
LGlo31623 = global_average_pooling2D_layer(Res20705, Glo31623), 
exec_layers([LAve99030,LFla54241,LSim86859,LCon45121,LMul41722,LRes65128,LRes20705,LGlo31623],["Ave99030","Fla54241","Sim86859","Con45121","Mul41722","Res65128","Res20705","Glo31623"],Glo31623,"Glo31623")

Actual (Unparsed): [[0.1725260]]

Expected (Unparsed): [[0.17252599000000002]]

Actual:   [[0.1726]]

Expected: [[0.1726]]