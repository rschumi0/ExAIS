import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add99902 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Add99902 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Up_17547 = tf.keras.layers.Input(shape=([2, 2]))
in0Ave37409 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Ave37409 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Con2189 = tf.keras.layers.Input(shape=([4, 2, 1, 2]))

Add99902 = keras.layers.Add(name = 'Add99902', )([in0Add99902,in1Add99902])
Res82787 = keras.layers.Reshape((2, 2), name = 'Res82787', )(Add99902)
Glo57322 = keras.layers.GlobalMaxPool1D(name = 'Glo57322', )(Res82787)
Res48983 = keras.layers.Reshape((2, 1), name = 'Res48983', )(Glo57322)
LST94348 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST94348', )(Res48983)
Res65738 = keras.layers.Reshape((1, 1), name = 'Res65738', )(LST94348)
Res33535 = keras.layers.Reshape((1, 1, 1), name = 'Res33535', )(Res65738)
Res472 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res472', )(Res33535)
Con33069 = keras.layers.Conv3D(3, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con33069', )(Res472)
Zer55681 = keras.layers.ZeroPadding3D(padding=((3, 0), (1, 0), (0, 0)), name = 'Zer55681', )(Con33069)
Up_17547 = keras.layers.UpSampling1D(size=(2), name = 'Up_17547', )(in0Up_17547)
Res89274 = keras.layers.Reshape((4, 2, 1), name = 'Res89274', )(Up_17547)
Res17340 = keras.layers.Reshape((4, 2, 1, 1), name = 'Res17340', )(Res89274)
Ave37409 = keras.layers.Average(name = 'Ave37409', )([in0Ave37409,in1Ave37409])
Zer90516 = keras.layers.ZeroPadding3D(padding=((2, 0), (1, 0), (0, 0)), name = 'Zer90516', )(Ave37409)
Ave86111 = keras.layers.Average(name = 'Ave86111', )([Res17340,Zer90516])
Con2189 = keras.layers.Concatenate(axis=4, name = 'Con2189', )([Ave86111,in0Con2189])
Mul2561 = keras.layers.Multiply(name = 'Mul2561', )([Zer55681,Con2189])
model = tf.keras.models.Model(inputs=[in0Add99902,in1Add99902,in0Up_17547,in0Ave37409,in1Ave37409,in0Con2189], outputs=Mul2561)
w = model.get_layer('LST94348').get_weights() 
w[0] = np.array([[5, 10, 9, 5]])
w[1] = np.array([[2, 1, 6, 6]])
w[2] = np.array([9, 9, 7, 7])
model.get_layer('LST94348').set_weights(w) 
w = model.get_layer('Con33069').get_weights() 
w[0] = np.array([[[[[0.828, 0.669, 0.6139]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con33069').set_weights(w) 
in0Add99902 = tf.constant([[[[0.7924, 0.0886]], [[0.3929, 0.3292]]]])
in1Add99902 = tf.constant([[[[0.1356, 0.7262]], [[0.6797, 0.6977]]]])
in0Up_17547 = tf.constant([[[1.2846, 1.8221], [1.8746, 1.3419]]])
in0Ave37409 = tf.constant([[[[[0.7691]]], [[[0.5295]]]]])
in1Ave37409 = tf.constant([[[[[0.0235]]], [[[0.0759]]]]])
in0Con2189 = tf.constant([[[[[0.8686, 0.0799]], [[0.0217, 0.1009]]], [[[0.5976, 0.971]], [[0.1547, 0.0531]]], [[[0.0722, 0.908]], [[0.4345, 0.2225]]], [[[0.867, 0.6592]], [[0.0538, 0.7685]]]]])
print (np.array2string(model.predict([in0Add99902,in1Add99902,in0Up_17547,in0Ave37409,in1Ave37409,in0Con2189],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul2561.png')

LAdd99902 = add_layer([[[[[0.7924, 0.0886]], [[0.3929, 0.3292]]]], [[[[0.1356, 0.7262]], [[0.6797, 0.6977]]]]], Add99902), 
LRes82787 = reshape_layer(Add99902, [2, 2], Res82787), 
LGlo57322 = global_max_pool1D_layer(Res82787, Glo57322), 
LRes48983 = reshape_layer(Glo57322, [2, 1], Res48983), 
LLST94348 = lstm_layer(Res48983,[[5, 10, 9, 5]],[[2, 1, 6, 6]],[9, 9, 7, 7], LST94348), 
LRes65738 = reshape_layer(LST94348, [1, 1], Res65738), 
LRes33535 = reshape_layer(Res65738, [1, 1, 1], Res33535), 
LRes472 = reshape_layer(Res33535, [1, 1, 1, 1], Res472), 
LCon33069 = conv3D_layer(Res472, 1, 1, 1,[[[[[0.828, 0.669, 0.6139]]]]],[0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con33069), 
LZer55681 = zero_padding3D_layer(Con33069, 3, 0, 1, 0, 0, 0, Zer55681), 
LUp_17547 = up_sampling1D_layer([[[1.2846, 1.8221], [1.8746, 1.3419]]], 2, Up_17547), 
LRes89274 = reshape_layer(Up_17547, [4, 2, 1], Res89274), 
LRes17340 = reshape_layer(Res89274, [4, 2, 1, 1], Res17340), 
LAve37409 = average_layer([[[[[[0.7691]]], [[[0.5295]]]]], [[[[[0.0235]]], [[[0.0759]]]]]], Ave37409), 
LZer90516 = zero_padding3D_layer(Ave37409, 2, 0, 1, 0, 0, 0, Zer90516), 
LAve86111 = average_layer([Res17340,Zer90516], Ave86111), 
LCon2189 = concatenate_layer([Ave86111,[[[[[0.8686, 0.0799]], [[0.0217, 0.1009]]], [[[0.5976, 0.971]], [[0.1547, 0.0531]]], [[[0.0722, 0.908]], [[0.4345, 0.2225]]], [[[0.867, 0.6592]], [[0.0538, 0.7685]]]]]], 4, Con2189), 
LMul2561 = multiply_layer([Zer55681,Con2189], Mul2561), 
exec_layers([LAdd99902,LRes82787,LGlo57322,LRes48983,LLST94348,LRes65738,LRes33535,LRes472,LCon33069,LZer55681,LUp_17547,LRes89274,LRes17340,LAve37409,LZer90516,LAve86111,LCon2189,LMul2561],["Add99902","Res82787","Glo57322","Res48983","LST94348","Res65738","Res33535","Res472","Con33069","Zer55681","Up_17547","Res89274","Res17340","Ave37409","Zer90516","Ave86111","Con2189","Mul2561"],Mul2561,"Mul2561")

Actual (Unparsed): [[[[[0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000]]], [[[0.0000000, 0.0000000, 0.0000000]], [[0.6563720, 0.0346975, 0.4548109]]]]]

Expected (Unparsed): [[[[[0.0,0.0,0.0]],[[0.0,0.0,0.0]]],[[[0.0,0.0,0.0]],[[0.0,0.0,0.0]]],[[[0.0,0.0,0.0]],[[0.0,0.0,0.0]]],[[[0.0,0.0,0.0]],[[0.6563719878171205,0.0346974696575579,0.45481095444575287]]]]]

Actual:   [[[[[0, 0, 0]], [[0, 0, 0]]], [[[0, 0, 0]], [[0, 0, 0]]], [[[0, 0, 0]], [[0, 0, 0]]], [[[0, 0, 0]], [[0.6564, 0.0347, 0.4549]]]]]

Expected: [[[[[0, 0, 0]], [[0, 0, 0]]], [[[0, 0, 0]], [[0, 0, 0]]], [[[0, 0, 0]], [[0, 0, 0]]], [[[0, 0, 0]], [[0.6564, 0.0347, 0.4549]]]]]