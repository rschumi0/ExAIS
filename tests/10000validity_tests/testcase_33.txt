import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max51592 = tf.keras.layers.Input(shape=([1, 2]))
in0Mul12998 = tf.keras.layers.Input(shape=([1, 2]))
in1Mul12998 = tf.keras.layers.Input(shape=([1, 2]))
in0Ave16069 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave16069 = tf.keras.layers.Input(shape=([2, 1]))
in0Add21324 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Add21324 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con53775 = tf.keras.layers.Input(shape=([2, 1]))
in0Con11705 = tf.keras.layers.Input(shape=([1]))

Max51592 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='same', name = 'Max51592', )(in0Max51592)
Den91621 = keras.layers.Dense(4,name = 'Den91621', )(Max51592)
Res89074 = keras.layers.Reshape((1, 4, 1), name = 'Res89074', )(Den91621)
Loc3731 = keras.layers.LocallyConnected2D(2, (1, 4),strides=(1, 1), name = 'Loc3731', )(Res89074)
Res29119 = keras.layers.Reshape((1, 2), name = 'Res29119', )(Loc3731)
Mul12998 = keras.layers.Multiply(name = 'Mul12998', )([in0Mul12998,in1Mul12998])
Mul5995 = keras.layers.Multiply(name = 'Mul5995', )([Res29119,Mul12998])
Fla55102 = keras.layers.Flatten(name = 'Fla55102', )(Mul5995)
Ave16069 = keras.layers.Average(name = 'Ave16069', )([in0Ave16069,in1Ave16069])
Con76198 = keras.layers.Conv1D(2, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con76198', )(Ave16069)
Add21324 = keras.layers.Add(name = 'Add21324', )([in0Add21324,in1Add21324])
Res82897 = keras.layers.Reshape((2, 1), name = 'Res82897', )(Add21324)
PRe28610 = keras.layers.PReLU(name = 'PRe28610', )(Res82897)
Con53775 = keras.layers.Concatenate(axis=2, name = 'Con53775', )([PRe28610,in0Con53775])
Ave78873 = keras.layers.Average(name = 'Ave78873', )([Con76198,Con53775])
Res40276 = keras.layers.Reshape((2, 2, 1), name = 'Res40276', )(Ave78873)
Res17508 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res17508', )(Res40276)
Glo62013 = keras.layers.GlobalMaxPool3D(name = 'Glo62013', )(Res17508)
Con11705 = keras.layers.Concatenate(axis=1, name = 'Con11705', )([Glo62013,in0Con11705])
Ave27791 = keras.layers.Average(name = 'Ave27791', )([Fla55102,Con11705])
model = tf.keras.models.Model(inputs=[in0Max51592,in0Mul12998,in1Mul12998,in0Ave16069,in1Ave16069,in0Add21324,in1Add21324,in0Con53775,in0Con11705], outputs=Ave27791)
w = model.get_layer('Den91621').get_weights() 
w[0] = np.array([[0.7109, 0.4195, 0.412, 0.8387], [0.9628, 0.6492, 0.7832, 0.005]])
w[1] = np.array([0.2922, 0.8384, 0.8041, 0.1325])
model.get_layer('Den91621').set_weights(w) 
w = model.get_layer('Loc3731').get_weights() 
w[0] = np.array([[[0.9139, 0.0887], [0.7294, 0.716], [0.4672, 0.7826], [0.222, 0.6172]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc3731').set_weights(w) 
w = model.get_layer('Con76198').get_weights() 
w[0] = np.array([[[0.1886, 0.4083]]])
w[1] = np.array([0, 0])
model.get_layer('Con76198').set_weights(w) 
w = model.get_layer('PRe28610').get_weights() 
w[0] = np.array([[0.4076], [0.9497]])
model.get_layer('PRe28610').set_weights(w) 
in0Max51592 = tf.constant([[[1.1396, 1.1957]]])
in0Mul12998 = tf.constant([[[0.9577, 0.6991]]])
in1Mul12998 = tf.constant([[[0.8068, 0.2725]]])
in0Ave16069 = tf.constant([[[0.0269], [0.3177]]])
in1Ave16069 = tf.constant([[[0.1361], [0.9479]]])
in0Add21324 = tf.constant([[[[0.8076]], [[0.1947]]]])
in1Add21324 = tf.constant([[[[0.4504]], [[0.2399]]]])
in0Con53775 = tf.constant([[[0.3479], [0.4749]]])
in0Con11705 = tf.constant([[0.4766]])
print (np.array2string(model.predict([in0Max51592,in0Mul12998,in1Mul12998,in0Ave16069,in1Ave16069,in0Add21324,in1Add21324,in0Con53775,in0Con11705],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave27791.png')

LMax51592 = max_pool1D_layer([[[1.1396, 1.1957]]], 1, 1, true, Max51592), 
LDen91621 = dense_layer(Max51592, [[0.7109, 0.4195, 0.412, 0.8387], [0.9628, 0.6492, 0.7832, 0.005]],[0.2922, 0.8384, 0.8041, 0.1325], Den91621), 
LRes89074 = reshape_layer(Den91621, [1, 4, 1], Res89074), 
LLoc3731 = locally_connected2D_layer(Res89074, 1, 4,[[[0.9139, 0.0887], [0.7294, 0.716], [0.4672, 0.7826], [0.222, 0.6172]]],[[[0, 0]]], 1, 1, Loc3731), 
LRes29119 = reshape_layer(Loc3731, [1, 2], Res29119), 
LMul12998 = multiply_layer([[[[0.9577, 0.6991]]], [[[0.8068, 0.2725]]]], Mul12998), 
LMul5995 = multiply_layer([Res29119,Mul12998], Mul5995), 
LFla55102 = flatten_layer(Mul5995, Fla55102), 
LAve16069 = average_layer([[[[0.0269], [0.3177]]], [[[0.1361], [0.9479]]]], Ave16069), 
LCon76198 = conv1D_layer(Ave16069, 1,[[[0.1886, 0.4083]]],[0, 0], 1, true, 1, Con76198), 
LAdd21324 = add_layer([[[[[0.8076]], [[0.1947]]]], [[[[0.4504]], [[0.2399]]]]], Add21324), 
LRes82897 = reshape_layer(Add21324, [2, 1], Res82897), 
LPRe28610 = prelu_layer(Res82897, [[0.4076], [0.9497]], PRe28610), 
LCon53775 = concatenate_layer([PRe28610,[[[0.3479], [0.4749]]]], 2, Con53775), 
LAve78873 = average_layer([Con76198,Con53775], Ave78873), 
LRes40276 = reshape_layer(Ave78873, [2, 2, 1], Res40276), 
LRes17508 = reshape_layer(Res40276, [2, 2, 1, 1], Res17508), 
LGlo62013 = global_max_pool3D_layer(Res17508, Glo62013), 
LCon11705 = concatenate_layer([Glo62013,[[0.4766]]], 1, Con11705), 
LAve27791 = average_layer([Fla55102,Con11705], Ave27791), 
exec_layers([LMax51592,LDen91621,LRes89074,LLoc3731,LRes29119,LMul12998,LMul5995,LFla55102,LAve16069,LCon76198,LAdd21324,LRes82897,LPRe28610,LCon53775,LAve78873,LRes40276,LRes17508,LGlo62013,LCon11705,LAve27791],["Max51592","Den91621","Res89074","Loc3731","Res29119","Mul12998","Mul5995","Fla55102","Ave16069","Con76198","Add21324","Res82897","PRe28610","Con53775","Ave78873","Res40276","Res17508","Glo62013","Con11705","Ave27791"],Ave27791,"Ave27791")

Actual (Unparsed): [[2.1964899, 0.6291457]]

Expected (Unparsed): [[2.196489748960359,0.6291456473717747]]

Actual:   [[2.1965, 0.6292]]

Expected: [[2.1965, 0.6292]]