import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0ELU99844 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con48445 = tf.keras.layers.Input(shape=([6, 3]))
in0Dot13877 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot13877 = tf.keras.layers.Input(shape=([3, 2]))
in0Con45563 = tf.keras.layers.Input(shape=([6, 1]))
in0Up_2048 = tf.keras.layers.Input(shape=([4, 2, 1]))

ELU99844 = keras.layers.ELU(alpha=-7.305672780683537, name = 'ELU99844', input_shape=(2, 1, 2))(in0ELU99844)
Res20733 = keras.layers.Reshape((2, 1, 2, 1), name = 'Res20733', )(ELU99844)
Cro31735 = keras.layers.Cropping3D(cropping=((1, 0), (0, 0), (1, 0)), name = 'Cro31735', )(Res20733)
Res90591 = keras.layers.Reshape((1, 1, 1), name = 'Res90591', )(Cro31735)
Res507 = keras.layers.Reshape((1, 1), name = 'Res507', )(Res90591)
Zer80588 = keras.layers.ZeroPadding1D(padding=((5, 0)), name = 'Zer80588', )(Res507)
Con48445 = keras.layers.Concatenate(axis=2, name = 'Con48445', )([Zer80588,in0Con48445])
Dot13877 = keras.layers.Dot(axes=(2, 2), name = 'Dot13877', )([in0Dot13877,in1Dot13877])
Zer79674 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer79674', )(Dot13877)
Con45563 = keras.layers.Concatenate(axis=2, name = 'Con45563', )([Zer79674,in0Con45563])
Up_2048 = keras.layers.UpSampling2D(size=(2, 2), name = 'Up_2048', )(in0Up_2048)
Res84599 = keras.layers.Reshape((8, 4), name = 'Res84599', )(Up_2048)
Max29723 = keras.layers.MaxPool1D(pool_size=(3), strides=(1), padding='valid', name = 'Max29723', )(Res84599)
Ave63634 = keras.layers.Average(name = 'Ave63634', )([Con45563,Max29723])
Max91395 = keras.layers.Maximum(name = 'Max91395', )([Con48445,Ave63634])
Res72124 = keras.layers.Reshape((6, 4, 1), name = 'Res72124', )(Max91395)
Sep56140 = keras.layers.SeparableConv2D(3, (4, 4),strides=(1, 1), padding='valid', name = 'Sep56140', )(Res72124)
model = tf.keras.models.Model(inputs=[in0ELU99844,in0Con48445,in0Dot13877,in1Dot13877,in0Con45563,in0Up_2048], outputs=Sep56140)
w = model.get_layer('Sep56140').get_weights() 
w[0] = np.array([[[[0.411]], [[0.6724]], [[0.2083]], [[0.395]]], [[[0.2796]], [[0.7364]], [[0.296]], [[0.406]]], [[[0.9843]], [[0.233]], [[0.252]], [[0.5903]]], [[[0.6121]], [[0.6084]], [[0.6509]], [[0.1517]]]])
w[1] = np.array([[[[0.9196, 0.2234, 0.6553]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep56140').set_weights(w) 
in0ELU99844 = tf.constant([[[[0.9581, 0.6912]], [[0.7563, 0.1442]]]])
in0Con48445 = tf.constant([[[0.4236, 0.5162, 0.1707], [0.8069, 0.0342, 0.8664], [0.7006, 0.1474, 0.0086], [0.2261, 0.825, 0.8189], [0.7828, 0.6411, 0.5083], [0.6932, 0.0583, 0.9724]]])
in0Dot13877 = tf.constant([[[0.5406, 0.6764], [0.8311, 0.5159], [0.3395, 0.326]]])
in1Dot13877 = tf.constant([[[0.0461, 0.5441], [0.9343, 0.0677], [0.9676, 0.0069]]])
in0Con45563 = tf.constant([[[0.2079], [0.6966], [0.5925], [0.5805], [0.9167], [0.3677]]])
in0Up_2048 = tf.constant([[[[1.8226], [1.9148]], [[1.5732], [1.015]], [[1.8499], [1.4145]], [[1.0236], [1.8159]]]])
print (np.array2string(model.predict([in0ELU99844,in0Con48445,in0Dot13877,in1Dot13877,in0Con45563,in0Up_2048],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sep56140.png')

LELU99844 = elu_layer([[[[0.9581, 0.6912]], [[0.7563, 0.1442]]]], -7.305672780683537, ELU99844), 
LRes20733 = reshape_layer(ELU99844, [2, 1, 2, 1], Res20733), 
LCro31735 = cropping3D_layer(Res20733, 1, 0, 0, 0, 1, 0, Cro31735), 
LRes90591 = reshape_layer(Cro31735, [1, 1, 1], Res90591), 
LRes507 = reshape_layer(Res90591, [1, 1], Res507), 
LZer80588 = zero_padding1D_layer(Res507, 5, 0, Zer80588), 
LCon48445 = concatenate_layer([Zer80588,[[[0.4236, 0.5162, 0.1707], [0.8069, 0.0342, 0.8664], [0.7006, 0.1474, 0.0086], [0.2261, 0.825, 0.8189], [0.7828, 0.6411, 0.5083], [0.6932, 0.0583, 0.9724]]]], 2, Con48445), 
LDot13877 = dot_layer([[[0.5406, 0.6764], [0.8311, 0.5159], [0.3395, 0.326]]], [[[0.0461, 0.5441], [0.9343, 0.0677], [0.9676, 0.0069]]], 2, 2, Dot13877), 
LZer79674 = zero_padding1D_layer(Dot13877, 3, 0, Zer79674), 
LCon45563 = concatenate_layer([Zer79674,[[[0.2079], [0.6966], [0.5925], [0.5805], [0.9167], [0.3677]]]], 2, Con45563), 
LUp_2048 = up_sampling2D_layer([[[[1.8226], [1.9148]], [[1.5732], [1.015]], [[1.8499], [1.4145]], [[1.0236], [1.8159]]]], 2, 2, Up_2048), 
LRes84599 = reshape_layer(Up_2048, [8, 4], Res84599), 
LMax29723 = max_pool1D_layer(Res84599, 3, 1, false, Max29723), 
LAve63634 = average_layer([Con45563,Max29723], Ave63634), 
LMax91395 = maximum_layer([Con48445,Ave63634], Max91395), 
LRes72124 = reshape_layer(Max91395, [6, 4, 1], Res72124), 
LSep56140 = separable_conv2D_layer(Res72124, 4, 4,[[[[[0.411]], [[0.6724]], [[0.2083]], [[0.395]]], [[[0.2796]], [[0.7364]], [[0.296]], [[0.406]]], [[[0.9843]], [[0.233]], [[0.252]], [[0.5903]]], [[[0.6121]], [[0.6084]], [[0.6509]], [[0.1517]]]],[[[[0.9196, 0.2234, 0.6553]]]]],[0, 0, 0], 1, 1, false, Sep56140), 
exec_layers([LELU99844,LRes20733,LCro31735,LRes90591,LRes507,LZer80588,LCon48445,LDot13877,LZer79674,LCon45563,LUp_2048,LRes84599,LMax29723,LAve63634,LMax91395,LRes72124,LSep56140],["ELU99844","Res20733","Cro31735","Res90591","Res507","Zer80588","Con48445","Dot13877","Zer79674","Con45563","Up_2048","Res84599","Max29723","Ave63634","Max91395","Res72124","Sep56140"],Sep56140,"Sep56140")

Actual (Unparsed): [[[[6.8437083, 1.6625538, 4.8767747]], [[7.3665050, 1.7895577, 5.2493157]], [[7.4540596, 1.8108274, 5.3117064]]]]

Expected (Unparsed): [[[[6.843708239829468,1.6625537416027654,4.876774695041596]],[[7.366505022457643,1.789557657695778,5.249315725550776]],[[7.454059584022527,1.8108274370059074,5.311706443464509]]]]

Actual:   [[[[6.8438, 1.6626, 4.8768]], [[7.3666, 1.7896, 5.2494]], [[7.4541, 1.8109, 5.3118]]]]

Expected: [[[[6.8438, 1.6626, 4.8768]], [[7.3666, 1.7896, 5.2494]], [[7.4541, 1.8109, 5.3118]]]]