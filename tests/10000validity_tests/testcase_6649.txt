import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con68865 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Ave98862 = tf.keras.layers.Input(shape=([1, 2]))

Con68865 = keras.layers.Conv3DTranspose(3, (1, 1, 1),strides=(1, 1, 1), padding='valid', name = 'Con68865', )(in0Con68865)
Mas73288 = keras.layers.Masking(mask_value=2, name = 'Mas73288', )(Con68865)
Res2920 = keras.layers.Reshape((2, 1, 3), name = 'Res2920', )(Mas73288)
Res23849 = keras.layers.Reshape((2, 3), name = 'Res23849', )(Res2920)
Ave98862 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='valid', name = 'Ave98862', )(in0Ave98862)
Up_10628 = keras.layers.UpSampling1D(size=(2), name = 'Up_10628', )(Ave98862)
Loc25847 = keras.layers.LocallyConnected1D(3, (1),strides=(1), name = 'Loc25847', )(Up_10628)
Dot71873 = keras.layers.Dot(axes=(1, 1), name = 'Dot71873', )([Res23849,Loc25847])
model = tf.keras.models.Model(inputs=[in0Con68865,in0Ave98862], outputs=Dot71873)
w = model.get_layer('Con68865').get_weights() 
w[0] = np.array([[[[[0.9578], [0.4268], [0.021]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con68865').set_weights(w) 
w = model.get_layer('Loc25847').get_weights() 
w[0] = np.array([[[0.5753, 0.3135, 0.8962], [0.1884, 0.8096, 0.2508]], [[0.0963, 0.0541, 0.8168], [0.3624, 0.8797, 0.127]]])
w[1] = np.array([[0, 0, 0], [0, 0, 0]])
model.get_layer('Loc25847').set_weights(w) 
in0Con68865 = tf.constant([[[[[0.7874]]], [[[0.0335]]]]])
in0Ave98862 = tf.constant([[[1.1182, 1.9449]]])
print (np.array2string(model.predict([in0Con68865,in0Ave98862],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot71873.png')

LCon68865 = conv3D_transpose_layer([[[[[0.7874]]], [[[0.0335]]]]], 1, 1, 1,[[[[[0.9578], [0.4268], [0.021]]]]],[0, 0, 0], 1, 1, 1, false, Con68865), 
LMas73288 = masking_layer(Con68865, 2, Mas73288), 
LRes2920 = reshape_layer(Mas73288, [2, 1, 3], Res2920), 
LRes23849 = reshape_layer(Res2920, [2, 3], Res23849), 
LAve98862 = average_pooling1D_layer([[[1.1182, 1.9449]]], 1, 1, false, Ave98862), 
LUp_10628 = up_sampling1D_layer(Ave98862, 2, Up_10628), 
LLoc25847 = locally_connected1D_layer(Up_10628, 1,[[[0.5753, 0.3135, 0.8962], [0.1884, 0.8096, 0.2508]], [[0.0963, 0.0541, 0.8168], [0.3624, 0.8797, 0.127]]],[[0, 0, 0], [0, 0, 0]], 1, Loc25847), 
LDot71873 = dot_layer(Res23849,Loc25847, 1, 1, Dot71873), 
exec_layers([LCon68865,LMas73288,LRes2920,LRes23849,LAve98862,LUp_10628,LLoc25847,LDot71873],["Con68865","Mas73288","Res2920","Res23849","Ave98862","Up_10628","Loc25847","Dot71873"],Dot71873,"Dot71873")

Actual (Unparsed): [[[0.7875726, 1.5087297, 1.1608806], [0.3509459, 0.6722967, 0.5172936], [0.0172677, 0.0330793, 0.0254526]]]

Expected (Unparsed): [[[0.7875725639675923,1.508729642776038,1.160880590645005],[0.3509458867209944,0.6722967336989069,0.5172936271531512],[0.017267721699018003,0.033079267590621006,0.025452591776514006]]]

Actual:   [[[0.7876, 1.5088, 1.1609], [0.351, 0.6723, 0.5173], [0.0173, 0.0331, 0.0255]]]

Expected: [[[0.7876, 1.5088, 1.1609], [0.351, 0.6723, 0.5173], [0.0173, 0.0331, 0.0255]]]