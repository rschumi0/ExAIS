import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub55980 = tf.keras.layers.Input(shape=([3]))
in1Sub55980 = tf.keras.layers.Input(shape=([3]))
in0Con90588 = tf.keras.layers.Input(shape=([3, 1, 3]))
in0Loc61236 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con72635 = tf.keras.layers.Input(shape=([4]))
in0Sub50007 = tf.keras.layers.Input(shape=([2, 3, 3, 2]))
in1Sub50007 = tf.keras.layers.Input(shape=([2, 3, 3, 2]))

Sub55980 = keras.layers.Subtract(name = 'Sub55980', )([in0Sub55980,in1Sub55980])
Res50459 = keras.layers.Reshape((3, 1), name = 'Res50459', )(Sub55980)
Res2659 = keras.layers.Reshape((3, 1, 1), name = 'Res2659', )(Res50459)
Con90588 = keras.layers.Concatenate(axis=3, name = 'Con90588', )([Res2659,in0Con90588])
Loc61236 = keras.layers.LocallyConnected2D(4, (1, 1),strides=(6, 2), name = 'Loc61236', )(in0Loc61236)
Zer21802 = keras.layers.ZeroPadding2D(padding=((2, 0), (0, 0)), name = 'Zer21802', )(Loc61236)
Mul35610 = keras.layers.Multiply(name = 'Mul35610', )([Con90588,Zer21802])
Res5070 = keras.layers.Reshape((3, 4), name = 'Res5070', )(Mul35610)
Per10092 = keras.layers.Permute((1,2), name = 'Per10092',)(Res5070)
LST64083 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST64083', )(Per10092)
Con72635 = keras.layers.Concatenate(axis=1, name = 'Con72635', )([LST64083,in0Con72635])
Sub50007 = keras.layers.Subtract(name = 'Sub50007', )([in0Sub50007,in1Sub50007])
Res3463 = keras.layers.Reshape((2, 3, 6), name = 'Res3463', )(Sub50007)
Up_56810 = keras.layers.UpSampling2D(size=(1, 1), name = 'Up_56810', )(Res3463)
Glo63754 = keras.layers.GlobalMaxPool2D(name = 'Glo63754', )(Up_56810)
Dot36874 = keras.layers.Dot(axes=(1, 1), name = 'Dot36874', )([Con72635,Glo63754])
model = tf.keras.models.Model(inputs=[in0Sub55980,in1Sub55980,in0Con90588,in0Loc61236,in0Con72635,in0Sub50007,in1Sub50007], outputs=Dot36874)
w = model.get_layer('Loc61236').get_weights() 
w[0] = np.array([[[0.2939, 0.2094, 0.4496, 0.6736], [0.0364, 0.8246, 0.9287, 0.5196]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc61236').set_weights(w) 
w = model.get_layer('LST64083').get_weights() 
w[0] = np.array([[7, 1, 4, 10, 1, 5, 9, 6], [8, 9, 7, 10, 7, 10, 10, 6], [8, 7, 4, 3, 6, 5, 8, 2], [7, 2, 9, 6, 3, 9, 10, 1]])
w[1] = np.array([[5, 1, 4, 2, 7, 9, 7, 2], [9, 5, 10, 3, 9, 4, 6, 3]])
w[2] = np.array([8, 7, 1, 7, 9, 2, 9, 4])
model.get_layer('LST64083').set_weights(w) 
in0Sub55980 = tf.constant([[0.7804, 0.2303, 0.6254]])
in1Sub55980 = tf.constant([[0.0511, 0.2982, 0.4521]])
in0Con90588 = tf.constant([[[[0.6146, 0.1932, 0.306]], [[0.8726, 0.0214, 0.3861]], [[0.7294, 0.4483, 0.6335]]]])
in0Loc61236 = tf.constant([[[[0.1017, 0.9026], [0.4894, 0.9542]], [[0.0763, 0.4893], [0.5374, 0.0734]]]])
in0Con72635 = tf.constant([[0.4419, 0.3098, 0.6577, 0.2641]])
in0Sub50007 = tf.constant([[[[[0.9034, 0.1929], [0.8513, 0.1004], [0.1464, 0.2042]], [[0.22, 0.5185], [0.4098, 0.999], [0.9919, 0.5008]], [[0.262, 0.2536], [0.4567, 0.8056], [0.7432, 0.276]]], [[[0.2556, 0.9015], [0.7498, 0.4802], [0.8276, 0.6191]], [[0.4011, 0.1691], [0.6096, 0.8808], [0.3516, 0.907]], [[0.9527, 0.0903], [0.894, 0.0598], [0.4911, 0.5781]]]]])
in1Sub50007 = tf.constant([[[[[0.6118, 0.6625], [0.0061, 0.0933], [0.2901, 0.63]], [[0.6624, 0.7076], [0.7667, 0.4735], [0.8663, 0.6564]], [[0.4186, 0.1039], [0.8905, 0.5784], [0.0141, 0.009]]], [[[0.8427, 0.3351], [0.7376, 0.0781], [0.5187, 0.0948]], [[0.2918, 0.6109], [0.1701, 0.6443], [0.1188, 0.5993]], [[0.2451, 0.9582], [0.9454, 0.1966], [0.7134, 0.8984]]]]])
print (np.array2string(model.predict([in0Sub55980,in1Sub55980,in0Con90588,in0Loc61236,in0Con72635,in0Sub50007,in1Sub50007],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot36874.png')

LSub55980 = subtract_layer([[0.7804, 0.2303, 0.6254]], [[0.0511, 0.2982, 0.4521]], Sub55980), 
LRes50459 = reshape_layer(Sub55980, [3, 1], Res50459), 
LRes2659 = reshape_layer(Res50459, [3, 1, 1], Res2659), 
LCon90588 = concatenate_layer([Res2659,[[[[0.6146, 0.1932, 0.306]], [[0.8726, 0.0214, 0.3861]], [[0.7294, 0.4483, 0.6335]]]]], 3, Con90588), 
LLoc61236 = locally_connected2D_layer([[[[0.1017, 0.9026], [0.4894, 0.9542]], [[0.0763, 0.4893], [0.5374, 0.0734]]]], 1, 1,[[[0.2939, 0.2094, 0.4496, 0.6736], [0.0364, 0.8246, 0.9287, 0.5196]]],[[[0, 0, 0, 0]]], 6, 2, Loc61236), 
LZer21802 = zero_padding2D_layer(Loc61236, 2, 0, 0, 0, Zer21802), 
LMul35610 = multiply_layer([Con90588,Zer21802], Mul35610), 
LRes5070 = reshape_layer(Mul35610, [3, 4], Res5070), 
LPer10092 = permute_layer(Res5070, 1,2, Per10092), 
LLST64083 = lstm_layer(Per10092,[[7, 1, 4, 10, 1, 5, 9, 6], [8, 9, 7, 10, 7, 10, 10, 6], [8, 7, 4, 3, 6, 5, 8, 2], [7, 2, 9, 6, 3, 9, 10, 1]],[[5, 1, 4, 2, 7, 9, 7, 2], [9, 5, 10, 3, 9, 4, 6, 3]],[8, 7, 1, 7, 9, 2, 9, 4], LST64083), 
LCon72635 = concatenate_layer([LST64083,[[0.4419, 0.3098, 0.6577, 0.2641]]], 1, Con72635), 
LSub50007 = subtract_layer([[[[[0.9034, 0.1929], [0.8513, 0.1004], [0.1464, 0.2042]], [[0.22, 0.5185], [0.4098, 0.999], [0.9919, 0.5008]], [[0.262, 0.2536], [0.4567, 0.8056], [0.7432, 0.276]]], [[[0.2556, 0.9015], [0.7498, 0.4802], [0.8276, 0.6191]], [[0.4011, 0.1691], [0.6096, 0.8808], [0.3516, 0.907]], [[0.9527, 0.0903], [0.894, 0.0598], [0.4911, 0.5781]]]]], [[[[[0.6118, 0.6625], [0.0061, 0.0933], [0.2901, 0.63]], [[0.6624, 0.7076], [0.7667, 0.4735], [0.8663, 0.6564]], [[0.4186, 0.1039], [0.8905, 0.5784], [0.0141, 0.009]]], [[[0.8427, 0.3351], [0.7376, 0.0781], [0.5187, 0.0948]], [[0.2918, 0.6109], [0.1701, 0.6443], [0.1188, 0.5993]], [[0.2451, 0.9582], [0.9454, 0.1966], [0.7134, 0.8984]]]]], Sub50007), 
LRes3463 = reshape_layer(Sub50007, [2, 3, 6], Res3463), 
LUp_56810 = up_sampling2D_layer(Res3463, 1, 1, Up_56810), 
LGlo63754 = global_max_pool2D_layer(Up_56810, Glo63754), 
LDot36874 = dot_layer(Con72635,Glo63754, 1, 1, Dot36874), 
exec_layers([LSub55980,LRes50459,LRes2659,LCon90588,LLoc61236,LZer21802,LMul35610,LRes5070,LPer10092,LLST64083,LCon72635,LSub50007,LRes3463,LUp_56810,LGlo63754,LDot36874],["Sub55980","Res50459","Res2659","Con90588","Loc61236","Zer21802","Mul35610","Res5070","Per10092","LST64083","Con72635","Sub50007","Res3463","Up_56810","Glo63754","Dot36874"],Dot36874,"Dot36874")

Actual (Unparsed): [[2.4217731]]

Expected (Unparsed): [[2.421773066213064]]

Actual:   [[2.4218]]

Expected: [[2.4218]]