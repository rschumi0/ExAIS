import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub27709 = tf.keras.layers.Input(shape=([3]))
in1Sub27709 = tf.keras.layers.Input(shape=([3]))
in0Cro4952 = tf.keras.layers.Input(shape=([4, 4, 2]))
in0Max71140 = tf.keras.layers.Input(shape=([2, 1]))
in1Max71140 = tf.keras.layers.Input(shape=([2, 1]))
in0Con17159 = tf.keras.layers.Input(shape=([2, 7]))

Sub27709 = keras.layers.Subtract(name = 'Sub27709', )([in0Sub27709,in1Sub27709])
Res87964 = keras.layers.Reshape((3, 1), name = 'Res87964', )(Sub27709)
LST98143 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST98143', )(Res87964)
Cro4952 = keras.layers.Cropping2D(cropping=((1, 1), (0, 0)), name = 'Cro4952', )(in0Cro4952)
Res66731 = keras.layers.Reshape((2, 8), name = 'Res66731', )(Cro4952)
Max71140 = keras.layers.Maximum(name = 'Max71140', )([in0Max71140,in1Max71140])
Con17159 = keras.layers.Concatenate(axis=2, name = 'Con17159', )([Max71140,in0Con17159])
Add5010 = keras.layers.Add(name = 'Add5010', )([Res66731,Con17159])
Res97438 = keras.layers.Reshape((2, 8, 1), name = 'Res97438', )(Add5010)
Res5172 = keras.layers.Reshape((2, 8, 1, 1), name = 'Res5172', )(Res97438)
Glo91223 = keras.layers.GlobalMaxPool3D(name = 'Glo91223', )(Res5172)
Min65917 = keras.layers.Minimum(name = 'Min65917', )([LST98143,Glo91223])
model = tf.keras.models.Model(inputs=[in0Sub27709,in1Sub27709,in0Cro4952,in0Max71140,in1Max71140,in0Con17159], outputs=Min65917)
w = model.get_layer('LST98143').get_weights() 
w[0] = np.array([[5, 7, 4, 7]])
w[1] = np.array([[2, 9, 8, 6]])
w[2] = np.array([6, 1, 10, 5])
model.get_layer('LST98143').set_weights(w) 
in0Sub27709 = tf.constant([[0.6965, 0.5418, 0.5209]])
in1Sub27709 = tf.constant([[0.4958, 0.4909, 0.4458]])
in0Cro4952 = tf.constant([[[[1.096, 1.7586], [1.7403, 1.626], [1.7926, 1.359], [1.3488, 1.1621]], [[1.7521, 1.1045], [1.281, 1.5139], [1.5452, 1.2411], [1.118, 1.211]], [[1.0798, 1.7557], [1.1872, 1.3566], [1.7778, 1.377], [1.6682, 1.9958]], [[1.8087, 1.0286], [1.3863, 1.4025], [1.1792, 1.3188], [1.9688, 1.2526]]]])
in0Max71140 = tf.constant([[[0.6471], [0.8905]]])
in1Max71140 = tf.constant([[[0.6652], [0.4654]]])
in0Con17159 = tf.constant([[[0.0708, 0.6321, 0.3435, 0.3576, 0.6037, 0.0842, 0.9835], [0.611, 0.7342, 0.0736, 0.6581, 0.0148, 0.8284, 0.2517]]])
print (np.array2string(model.predict([in0Sub27709,in1Sub27709,in0Cro4952,in0Max71140,in1Max71140,in0Con17159],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min65917.png')

LSub27709 = subtract_layer([[0.6965, 0.5418, 0.5209]], [[0.4958, 0.4909, 0.4458]], Sub27709), 
LRes87964 = reshape_layer(Sub27709, [3, 1], Res87964), 
LLST98143 = lstm_layer(Res87964,[[5, 7, 4, 7]],[[2, 9, 8, 6]],[6, 1, 10, 5], LST98143), 
LCro4952 = cropping2D_layer([[[[1.096, 1.7586], [1.7403, 1.626], [1.7926, 1.359], [1.3488, 1.1621]], [[1.7521, 1.1045], [1.281, 1.5139], [1.5452, 1.2411], [1.118, 1.211]], [[1.0798, 1.7557], [1.1872, 1.3566], [1.7778, 1.377], [1.6682, 1.9958]], [[1.8087, 1.0286], [1.3863, 1.4025], [1.1792, 1.3188], [1.9688, 1.2526]]]], 1, 1, 0, 0, Cro4952), 
LRes66731 = reshape_layer(Cro4952, [2, 8], Res66731), 
LMax71140 = maximum_layer([[[[0.6471], [0.8905]]], [[[0.6652], [0.4654]]]], Max71140), 
LCon17159 = concatenate_layer([Max71140,[[[0.0708, 0.6321, 0.3435, 0.3576, 0.6037, 0.0842, 0.9835], [0.611, 0.7342, 0.0736, 0.6581, 0.0148, 0.8284, 0.2517]]]], 2, Con17159), 
LAdd5010 = add_layer([Res66731,Con17159], Add5010), 
LRes97438 = reshape_layer(Add5010, [2, 8, 1], Res97438), 
LRes5172 = reshape_layer(Res97438, [2, 8, 1, 1], Res5172), 
LGlo91223 = global_max_pool3D_layer(Res5172, Glo91223), 
LMin65917 = minimum_layer([LST98143,Glo91223], Min65917), 
exec_layers([LSub27709,LRes87964,LLST98143,LCro4952,LRes66731,LMax71140,LCon17159,LAdd5010,LRes97438,LRes5172,LGlo91223,LMin65917],["Sub27709","Res87964","LST98143","Cro4952","Res66731","Max71140","Con17159","Add5010","Res97438","Res5172","Glo91223","Min65917"],Min65917,"Min65917")

Actual (Unparsed): [[0.9950235]]

Expected (Unparsed): [[0.9950235189161175]]

Actual:   [[0.9951]]

Expected: [[0.9951]]