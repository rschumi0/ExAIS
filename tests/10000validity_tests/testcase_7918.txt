import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Bat93504 = tf.keras.layers.Input(shape=([4, 1, 2]))
in0Loc5981 = tf.keras.layers.Input(shape=([2, 1]))
in0Mul49714 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Mul49714 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con62018 = tf.keras.layers.Input(shape=([4, 1, 1]))

Bat93504 = keras.layers.BatchNormalization(axis=2, epsilon=0.4797367691080493,  name = 'Bat93504', )(in0Bat93504)
Loc5981 = keras.layers.LocallyConnected1D(3, (2),strides=(1), name = 'Loc5981', )(in0Loc5981)
Res18461 = keras.layers.Reshape((1, 3, 1), name = 'Res18461', )(Loc5981)
Glo7976 = keras.layers.GlobalAveragePooling2D(name = 'Glo7976', )(Res18461)
Res20934 = keras.layers.Reshape((1, 1), name = 'Res20934', )(Glo7976)
Res83785 = keras.layers.Reshape((1, 1, 1), name = 'Res83785', )(Res20934)
Mul49714 = keras.layers.Multiply(name = 'Mul49714', )([in0Mul49714,in1Mul49714])
Min10283 = keras.layers.Minimum(name = 'Min10283', )([Res83785,Mul49714])
Bat91382 = keras.layers.BatchNormalization(axis=2, epsilon=0.44703094425804035,  name = 'Bat91382', )(Min10283)
Zer89951 = keras.layers.ZeroPadding2D(padding=((3, 0), (0, 0)), name = 'Zer89951', )(Bat91382)
Con62018 = keras.layers.Concatenate(axis=3, name = 'Con62018', )([Zer89951,in0Con62018])
Min50094 = keras.layers.Minimum(name = 'Min50094', )([Bat93504,Con62018])
model = tf.keras.models.Model(inputs=[in0Bat93504,in0Loc5981,in0Mul49714,in1Mul49714,in0Con62018], outputs=Min50094)
w = model.get_layer('Bat93504').get_weights() 
w[0] = np.array([0.8581])
w[1] = np.array([0.2647])
w[2] = np.array([0.1215])
w[3] = np.array([0.7946])
model.get_layer('Bat93504').set_weights(w) 
w = model.get_layer('Loc5981').get_weights() 
w[0] = np.array([[[0.0831, 0.1129, 0.4622], [0.9981, 0.5758, 0.8847]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc5981').set_weights(w) 
w = model.get_layer('Bat91382').get_weights() 
w[0] = np.array([0.4107])
w[1] = np.array([0.3014])
w[2] = np.array([0.5193])
w[3] = np.array([0.5219])
model.get_layer('Bat91382').set_weights(w) 
in0Bat93504 = tf.constant([[[[1.2117, 1.7166]], [[1.1325, 1.5023]], [[1.7223, 1.634]], [[1.7314, 1.1692]]]])
in0Loc5981 = tf.constant([[[0.1423], [0.877]]])
in0Mul49714 = tf.constant([[[[0.7315]]]])
in1Mul49714 = tf.constant([[[[0.7937]]]])
in0Con62018 = tf.constant([[[[0.0142]], [[0.6587]], [[0.5917]], [[0.1993]]]])
print (np.array2string(model.predict([in0Bat93504,in0Loc5981,in0Mul49714,in1Mul49714,in0Con62018],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min50094.png')

LBat93504 = batch_normalization_layer([[[[1.2117, 1.7166]], [[1.1325, 1.5023]], [[1.7223, 1.634]], [[1.7314, 1.1692]]]], 2, 0.4797367691080493, [0.8581], [0.2647], [0.1215], [0.7946], Bat93504), 
LLoc5981 = locally_connected1D_layer([[[0.1423], [0.877]]], 2,[[[0.0831, 0.1129, 0.4622], [0.9981, 0.5758, 0.8847]]],[[0, 0, 0]], 1, Loc5981), 
LRes18461 = reshape_layer(Loc5981, [1, 3, 1], Res18461), 
LGlo7976 = global_average_pooling2D_layer(Res18461, Glo7976), 
LRes20934 = reshape_layer(Glo7976, [1, 1], Res20934), 
LRes83785 = reshape_layer(Res20934, [1, 1, 1], Res83785), 
LMul49714 = multiply_layer([[[[[0.7315]]]], [[[[0.7937]]]]], Mul49714), 
LMin10283 = minimum_layer([Res83785,Mul49714], Min10283), 
LBat91382 = batch_normalization_layer(Min10283, 2, 0.44703094425804035, [0.4107], [0.3014], [0.5193], [0.5219], Bat91382), 
LZer89951 = zero_padding2D_layer(Bat91382, 3, 0, 0, 0, Zer89951), 
LCon62018 = concatenate_layer([Zer89951,[[[[0.0142]], [[0.6587]], [[0.5917]], [[0.1993]]]]], 3, Con62018), 
LMin50094 = minimum_layer([Bat93504,Con62018], Min50094), 
exec_layers([LBat93504,LLoc5981,LRes18461,LGlo7976,LRes20934,LRes83785,LMul49714,LMin10283,LBat91382,LZer89951,LCon62018,LMin50094],["Bat93504","Loc5981","Res18461","Glo7976","Res20934","Res83785","Mul49714","Min10283","Bat91382","Zer89951","Con62018","Min50094"],Min50094,"Min50094")

Actual (Unparsed): [[[[0.0000000, 0.0142000]], [[0.0000000, 0.6587000]], [[0.0000000, 0.5917000]], [[0.3269728, 0.1993000]]]]

Expected (Unparsed): [[[[0,0.0142]],[[0,0.6587]],[[0,0.5917]],[[0.3269728360429942,0.1993]]]]

Actual:   [[[[0, 0.0142]], [[0, 0.6587]], [[0, 0.5917]], [[0.327, 0.1993]]]]

Expected: [[[[0, 0.0142]], [[0, 0.6587]], [[0, 0.5917]], [[0.327, 0.1993]]]]