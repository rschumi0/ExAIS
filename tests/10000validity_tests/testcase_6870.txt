import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave52409 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Ave52409 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Add48043 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Add48043 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Con72667 = tf.keras.layers.Input(shape=([5]))

Ave52409 = keras.layers.Average(name = 'Ave52409', )([in0Ave52409,in1Ave52409])
Res78419 = keras.layers.Reshape((1, 2, 1), name = 'Res78419', )(Ave52409)
Con85567 = keras.layers.Conv2D(3, (1, 1),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con85567', )(Res78419)
Res45227 = keras.layers.Reshape((1, 6), name = 'Res45227', )(Con85567)
Fla376 = keras.layers.Flatten(name = 'Fla376', )(Res45227)
Add48043 = keras.layers.Add(name = 'Add48043', )([in0Add48043,in1Add48043])
Res31473 = keras.layers.Reshape((2, 2, 1), name = 'Res31473', )(Add48043)
Res28201 = keras.layers.Reshape((2, 2), name = 'Res28201', )(Res31473)
LST38106 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST38106', )(Res28201)
Con72667 = keras.layers.Concatenate(axis=1, name = 'Con72667', )([LST38106,in0Con72667])
Max69403 = keras.layers.Maximum(name = 'Max69403', )([Fla376,Con72667])
model = tf.keras.models.Model(inputs=[in0Ave52409,in1Ave52409,in0Add48043,in1Add48043,in0Con72667], outputs=Max69403)
w = model.get_layer('Con85567').get_weights() 
w[0] = np.array([[[[0.86, 0.2185, 0.9162]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con85567').set_weights(w) 
w = model.get_layer('LST38106').get_weights() 
w[0] = np.array([[4, 10, 5, 8], [10, 4, 9, 4]])
w[1] = np.array([[10, 1, 4, 7]])
w[2] = np.array([8, 8, 3, 8])
model.get_layer('LST38106').set_weights(w) 
in0Ave52409 = tf.constant([[[[[0.3113]], [[0.678]]]]])
in1Ave52409 = tf.constant([[[[[0.8734]], [[0.8902]]]]])
in0Add48043 = tf.constant([[[[[0.8287]], [[0.3572]]], [[[0.109]], [[0.3]]]]])
in1Add48043 = tf.constant([[[[[0.2967]], [[0.2402]]], [[[0.8183]], [[0.1222]]]]])
in0Con72667 = tf.constant([[0.6695, 0.9956, 0.0424, 0.9268, 0.8515]])
print (np.array2string(model.predict([in0Ave52409,in1Ave52409,in0Add48043,in1Add48043,in0Con72667],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max69403.png')

LAve52409 = average_layer([[[[[[0.3113]], [[0.678]]]]], [[[[[0.8734]], [[0.8902]]]]]], Ave52409), 
LRes78419 = reshape_layer(Ave52409, [1, 2, 1], Res78419), 
LCon85567 = conv2D_layer(Res78419, 1, 1,[[[[0.86, 0.2185, 0.9162]]]],[0, 0, 0], 1, 1, false, 1, 1, Con85567), 
LRes45227 = reshape_layer(Con85567, [1, 6], Res45227), 
LFla376 = flatten_layer(Res45227, Fla376), 
LAdd48043 = add_layer([[[[[[0.8287]], [[0.3572]]], [[[0.109]], [[0.3]]]]], [[[[[0.2967]], [[0.2402]]], [[[0.8183]], [[0.1222]]]]]], Add48043), 
LRes31473 = reshape_layer(Add48043, [2, 2, 1], Res31473), 
LRes28201 = reshape_layer(Res31473, [2, 2], Res28201), 
LLST38106 = lstm_layer(Res28201,[[4, 10, 5, 8], [10, 4, 9, 4]],[[10, 1, 4, 7]],[8, 8, 3, 8], LST38106), 
LCon72667 = concatenate_layer([LST38106,[[0.6695, 0.9956, 0.0424, 0.9268, 0.8515]]], 1, Con72667), 
LMax69403 = maximum_layer([Fla376,Con72667], Max69403), 
exec_layers([LAve52409,LRes78419,LCon85567,LRes45227,LFla376,LAdd48043,LRes31473,LRes28201,LLST38106,LCon72667,LMax69403],["Ave52409","Res78419","Con85567","Res45227","Fla376","Add48043","Res31473","Res28201","LST38106","Con72667","Max69403"],Max69403,"Max69403")

Actual (Unparsed): [[0.9640276, 0.6695000, 0.9956000, 0.6743260, 0.9268000, 0.8515000]]

Expected (Unparsed): [[0.9640275790372362,0.6695,0.9956,0.674326,0.9268,0.8515]]

Actual:   [[0.9641, 0.6695, 0.9956, 0.6744, 0.9268, 0.8515]]

Expected: [[0.9641, 0.6695, 0.9956, 0.6744, 0.9268, 0.8515]]