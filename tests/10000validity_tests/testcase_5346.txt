import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave50681 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Ave50681 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Dot37355 = tf.keras.layers.Input(shape=([2]))
in1Dot37355 = tf.keras.layers.Input(shape=([2]))

Ave50681 = keras.layers.Average(name = 'Ave50681', )([in0Ave50681,in1Ave50681])
Res58638 = keras.layers.Reshape((2, 1), name = 'Res58638', )(Ave50681)
GRU46792 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU46792', )(Res58638)
Dot37355 = keras.layers.Dot(axes=(1, 1), name = 'Dot37355', )([in0Dot37355,in1Dot37355])
Dot18868 = keras.layers.Dot(axes=(1, 1), name = 'Dot18868', )([GRU46792,Dot37355])
model = tf.keras.models.Model(inputs=[in0Ave50681,in1Ave50681,in0Dot37355,in1Dot37355], outputs=Dot18868)
w = model.get_layer('GRU46792').get_weights() 
w[0] = np.array([[9, 8, 9]])
w[1] = np.array([[7, 7, 5]])
w[2] = np.array([8, 4, 10])
model.get_layer('GRU46792').set_weights(w) 
in0Ave50681 = tf.constant([[[[0.2164]], [[0.5071]]]])
in1Ave50681 = tf.constant([[[[0.682]], [[0.2584]]]])
in0Dot37355 = tf.constant([[0.2084, 0.0972]])
in1Dot37355 = tf.constant([[0.8891, 0.1579]])
print (np.array2string(model.predict([in0Ave50681,in1Ave50681,in0Dot37355,in1Dot37355],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot18868.png')

LAve50681 = average_layer([[[[[0.2164]], [[0.5071]]]], [[[[0.682]], [[0.2584]]]]], Ave50681), 
LRes58638 = reshape_layer(Ave50681, [2, 1], Res58638), 
LGRU46792 = gru_layer(Res58638,[[9, 8, 9]],[[7, 7, 5]],[8, 4, 10], false, GRU46792), 
LDot37355 = dot_layer([[0.2084, 0.0972]], [[0.8891, 0.1579]], 1, 1, Dot37355), 
LDot18868 = dot_layer(GRU46792,Dot37355, 1, 1, Dot18868), 
exec_layers([LAve50681,LRes58638,LGRU46792,LDot37355,LDot18868],["Ave50681","Res58638","GRU46792","Dot37355","Dot18868"],Dot18868,"Dot18868")

Actual (Unparsed): [[0.0000033]]

Expected (Unparsed): [[3.328890848219208e-6]]

Actual:   [[0]]

Expected: [[0]]