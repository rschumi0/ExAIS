import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max14383 = tf.keras.layers.Input(shape=([1, 1]))
in1Max14383 = tf.keras.layers.Input(shape=([1, 1]))
in0Con1800 = tf.keras.layers.Input(shape=([4, 1, 1, 1]))
in0Fla6096 = tf.keras.layers.Input(shape=([2, 2]))

Max14383 = keras.layers.Maximum(name = 'Max14383', )([in0Max14383,in1Max14383])
Res32237 = keras.layers.Reshape((1, 1, 1), name = 'Res32237', )(Max14383)
Res19620 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res19620', )(Res32237)
Zer20865 = keras.layers.ZeroPadding3D(padding=((3, 0), (0, 0), (0, 0)), name = 'Zer20865', )(Res19620)
Con1800 = keras.layers.Concatenate(axis=4, name = 'Con1800', )([Zer20865,in0Con1800])
Fla6096 = keras.layers.Flatten(name = 'Fla6096', )(in0Fla6096)
Lay66341 = keras.layers.LayerNormalization(axis=1, epsilon=1.4390335507550585, name = 'Lay66341', )(Fla6096)
Res3380 = keras.layers.Reshape((4, 1), name = 'Res3380', )(Lay66341)
Res26773 = keras.layers.Reshape((4, 1, 1), name = 'Res26773', )(Res3380)
Res58517 = keras.layers.Reshape((4, 1, 1, 1), name = 'Res58517', )(Res26773)
Con77219 = keras.layers.Conv3D(2, (4, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con77219', )(Res58517)
Sub97041 = keras.layers.Subtract(name = 'Sub97041', )([Con1800,Con77219])
model = tf.keras.models.Model(inputs=[in0Max14383,in1Max14383,in0Con1800,in0Fla6096], outputs=Sub97041)
w = model.get_layer('Con77219').get_weights() 
w[0] = np.array([[[[[0.6989, 0.8187]]]], [[[[0.1007, 0.1172]]]], [[[[0.8159, 0.256]]]], [[[[0.3733, 0.5443]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con77219').set_weights(w) 
in0Max14383 = tf.constant([[[0.6451]]])
in1Max14383 = tf.constant([[[0.0971]]])
in0Con1800 = tf.constant([[[[[0.3429]]], [[[0.7848]]], [[[0.0928]]], [[[0.135]]]]])
in0Fla6096 = tf.constant([[[1.8703, 1.6441], [1.8029, 1.489]]])
print (np.array2string(model.predict([in0Max14383,in1Max14383,in0Con1800,in0Fla6096],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub97041.png')

LMax14383 = maximum_layer([[[[0.6451]]], [[[0.0971]]]], Max14383), 
LRes32237 = reshape_layer(Max14383, [1, 1, 1], Res32237), 
LRes19620 = reshape_layer(Res32237, [1, 1, 1, 1], Res19620), 
LZer20865 = zero_padding3D_layer(Res19620, 3, 0, 0, 0, 0, 0, Zer20865), 
LCon1800 = concatenate_layer([Zer20865,[[[[[0.3429]]], [[[0.7848]]], [[[0.0928]]], [[[0.135]]]]]], 4, Con1800), 
LFla6096 = flatten_layer([[[1.8703, 1.6441], [1.8029, 1.489]]], Fla6096), 
LLay66341 = layer_normalization_layer(Fla6096, 1, 1.4390335507550585, Lay66341), 
LRes3380 = reshape_layer(Lay66341, [4, 1], Res3380), 
LRes26773 = reshape_layer(Res3380, [4, 1, 1], Res26773), 
LRes58517 = reshape_layer(Res26773, [4, 1, 1, 1], Res58517), 
LCon77219 = conv3D_layer(Res58517, 4, 1, 1,[[[[[0.6989, 0.8187]]]], [[[[0.1007, 0.1172]]]], [[[[0.8159, 0.256]]]], [[[[0.3733, 0.5443]]]]],[0, 0], 1, 1, 1, true, 1, 1, 1, Con77219), 
LSub97041 = subtract_layer(Con1800,Con77219, Sub97041), 
exec_layers([LMax14383,LRes32237,LRes19620,LZer20865,LCon1800,LFla6096,LLay66341,LRes3380,LRes26773,LRes58517,LCon77219,LSub97041],["Max14383","Res32237","Res19620","Zer20865","Con1800","Fla6096","Lay66341","Res3380","Res26773","Res58517","Con77219","Sub97041"],Sub97041,"Sub97041")

Actual (Unparsed): [[[[[-0.0065539, 0.2930824]]], [[[-0.0955205, 0.7503536]]], [[[0.1682914, 0.1669311]]], [[[0.6042200, 0.0869788]]]]]

Expected (Unparsed): [[[[[-0.0065538932381410675,0.2930823871628293]]],[[[-0.09552043980957951,0.7503536018555866]]],[[[0.16829141750465804,0.16693107946465677]]],[[[0.6042199686059256,0.08697875173714575]]]]]

Actual:   [[[[[-0.0065, 0.2931]]], [[[-0.0955, 0.7504]]], [[[0.1683, 0.167]]], [[[0.6043, 0.087]]]]]

Expected: [[[[[-0.0065, 0.2931]]], [[[-0.0955, 0.7504]]], [[[0.1683, 0.167]]], [[[0.6043, 0.087]]]]]