import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave15552 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Ave15552 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in0GRU59316 = tf.keras.layers.Input(shape=([3, 2]))

Ave15552 = keras.layers.Average(name = 'Ave15552', )([in0Ave15552,in1Ave15552])
Res93461 = keras.layers.Reshape((1, 1, 1), name = 'Res93461', )(Ave15552)
Dep49738 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='same', name = 'Dep49738', )(Res93461)
Res36358 = keras.layers.Reshape((1, 1), name = 'Res36358', )(Dep49738)
GRU59316 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU59316', )(in0GRU59316)
Res79649 = keras.layers.Reshape((1, 1), name = 'Res79649', )(GRU59316)
Sub90190 = keras.layers.Subtract(name = 'Sub90190', )([Res36358,Res79649])
Cro25851 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro25851', )(Sub90190)
model = tf.keras.models.Model(inputs=[in0Ave15552,in1Ave15552,in0GRU59316], outputs=Cro25851)
w = model.get_layer('Dep49738').get_weights() 
w[0] = np.array([[[[0.7382]]]])
w[1] = np.array([0])
model.get_layer('Dep49738').set_weights(w) 
w = model.get_layer('GRU59316').get_weights() 
w[0] = np.array([[3, 5, 7], [4, 6, 9]])
w[1] = np.array([[7, 7, 7]])
w[2] = np.array([[8, 2, 1], [2, 1, 3]])
model.get_layer('GRU59316').set_weights(w) 
in0Ave15552 = tf.constant([[[[[0.6695]]]]])
in1Ave15552 = tf.constant([[[[[0.7483]]]]])
in0GRU59316 = tf.constant([[[1, 8], [8, 2], [5, 9]]])
print (np.array2string(model.predict([in0Ave15552,in1Ave15552,in0GRU59316],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Cro25851.png')

LAve15552 = average_layer([[[[[[0.6695]]]]], [[[[[0.7483]]]]]], Ave15552), 
LRes93461 = reshape_layer(Ave15552, [1, 1, 1], Res93461), 
LDep49738 = depthwise_conv2D_layer(Res93461, 1, 1,[[[[0.7382]]]],[0], 1, 1, true, Dep49738), 
LRes36358 = reshape_layer(Dep49738, [1, 1], Res36358), 
LGRU59316 = gru_layer([[[1, 8], [8, 2], [5, 9]]],[[3, 5, 7], [4, 6, 9]],[[7, 7, 7]],[[8, 2, 1], [2, 1, 3]], true, GRU59316), 
LRes79649 = reshape_layer(GRU59316, [1, 1], Res79649), 
LSub90190 = subtract_layer(Res36358,Res79649, Sub90190), 
LCro25851 = cropping1D_layer(Sub90190, 0, 0, Cro25851), 
exec_layers([LAve15552,LRes93461,LDep49738,LRes36358,LGRU59316,LRes79649,LSub90190,LCro25851],["Ave15552","Res93461","Dep49738","Res36358","GRU59316","Res79649","Sub90190","Cro25851"],Cro25851,"Cro25851")

Actual (Unparsed): [[[0.5233100]]]

Expected (Unparsed): [[[0.52330998]]]

Actual:   [[[0.5234]]]

Expected: [[[0.5234]]]