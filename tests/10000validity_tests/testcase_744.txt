import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub7422 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub7422 = tf.keras.layers.Input(shape=([3, 2]))
in0Add88564 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Add88564 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Mul64703 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Mul64703 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))

Sub7422 = keras.layers.Subtract(name = 'Sub7422', )([in0Sub7422,in1Sub7422])
Res46925 = keras.layers.Reshape((3, 2, 1), name = 'Res46925', )(Sub7422)
Res36621 = keras.layers.Reshape((3, 2, 1, 1), name = 'Res36621', )(Res46925)
Add88564 = keras.layers.Add(name = 'Add88564', )([in0Add88564,in1Add88564])
Res98125 = keras.layers.Reshape((2, 2), name = 'Res98125', )(Add88564)
Cro77375 = keras.layers.Cropping1D(cropping=((0, 1)), name = 'Cro77375', )(Res98125)
Res37866 = keras.layers.Reshape((1, 2, 1), name = 'Res37866', )(Cro77375)
Res2535 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res2535', )(Res37866)
Mul64703 = keras.layers.Multiply(name = 'Mul64703', )([in0Mul64703,in1Mul64703])
Zer92822 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (0, 0)), name = 'Zer92822', )(Mul64703)
Min52926 = keras.layers.Minimum(name = 'Min52926', )([Res2535,Zer92822])
Zer78631 = keras.layers.ZeroPadding3D(padding=((2, 0), (0, 0), (0, 0)), name = 'Zer78631', )(Min52926)
Ave65630 = keras.layers.Average(name = 'Ave65630', )([Res36621,Zer78631])
model = tf.keras.models.Model(inputs=[in0Sub7422,in1Sub7422,in0Add88564,in1Add88564,in0Mul64703,in1Mul64703], outputs=Ave65630)
in0Sub7422 = tf.constant([[[0.3916, 0.2548], [0.413, 0.7541], [0.6019, 0.4671]]])
in1Sub7422 = tf.constant([[[0.5196, 0.1149], [0.5724, 0.9981], [0.0894, 0.5703]]])
in0Add88564 = tf.constant([[[[0.6854, 0.9009]], [[0.459, 0.9848]]]])
in1Add88564 = tf.constant([[[[0.2263, 0.812]], [[0.9384, 0.8802]]]])
in0Mul64703 = tf.constant([[[[[0.6544]]]]])
in1Mul64703 = tf.constant([[[[[0.201]]]]])
print (np.array2string(model.predict([in0Sub7422,in1Sub7422,in0Add88564,in1Add88564,in0Mul64703,in1Mul64703],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave65630.png')

LSub7422 = subtract_layer([[[0.3916, 0.2548], [0.413, 0.7541], [0.6019, 0.4671]]], [[[0.5196, 0.1149], [0.5724, 0.9981], [0.0894, 0.5703]]], Sub7422), 
LRes46925 = reshape_layer(Sub7422, [3, 2, 1], Res46925), 
LRes36621 = reshape_layer(Res46925, [3, 2, 1, 1], Res36621), 
LAdd88564 = add_layer([[[[[0.6854, 0.9009]], [[0.459, 0.9848]]]], [[[[0.2263, 0.812]], [[0.9384, 0.8802]]]]], Add88564), 
LRes98125 = reshape_layer(Add88564, [2, 2], Res98125), 
LCro77375 = cropping1D_layer(Res98125, 0, 1, Cro77375), 
LRes37866 = reshape_layer(Cro77375, [1, 2, 1], Res37866), 
LRes2535 = reshape_layer(Res37866, [1, 2, 1, 1], Res2535), 
LMul64703 = multiply_layer([[[[[[0.6544]]]]], [[[[[0.201]]]]]], Mul64703), 
LZer92822 = zero_padding3D_layer(Mul64703, 0, 0, 1, 0, 0, 0, Zer92822), 
LMin52926 = minimum_layer([Res2535,Zer92822], Min52926), 
LZer78631 = zero_padding3D_layer(Min52926, 2, 0, 0, 0, 0, 0, Zer78631), 
LAve65630 = average_layer([Res36621,Zer78631], Ave65630), 
exec_layers([LSub7422,LRes46925,LRes36621,LAdd88564,LRes98125,LCro77375,LRes37866,LRes2535,LMul64703,LZer92822,LMin52926,LZer78631,LAve65630],["Sub7422","Res46925","Res36621","Add88564","Res98125","Cro77375","Res37866","Res2535","Mul64703","Zer92822","Min52926","Zer78631","Ave65630"],Ave65630,"Ave65630")

Actual (Unparsed): [[[[[-0.0640000]], [[0.0699500]]], [[[-0.0797000]], [[-0.1220000]]], [[[0.2562500]], [[0.0141672]]]]]

Expected (Unparsed): [[[[[-0.06399999999999997]],[[0.06995000000000001]]],[[[-0.07970000000000002]],[[-0.122]]],[[[0.25625]],[[0.014167199999999991]]]]]

Actual:   [[[[[-0.064]], [[0.07]]], [[[-0.0797]], [[-0.122]]], [[[0.2563]], [[0.0142]]]]]

Expected: [[[[[-0.0639]], [[0.07]]], [[[-0.0797]], [[-0.122]]], [[[0.2563]], [[0.0142]]]]]