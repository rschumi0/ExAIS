import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sim9125 = tf.keras.layers.Input(shape=([2, 1]))
in0Dot87871 = tf.keras.layers.Input(shape=([3]))
in1Dot87871 = tf.keras.layers.Input(shape=([3]))
in0Con66688 = tf.keras.layers.Input(shape=([2]))

Sim9125 = keras.layers.SimpleRNN(3,name = 'Sim9125', )(in0Sim9125)
Dot87871 = keras.layers.Dot(axes=(1, 1), name = 'Dot87871', )([in0Dot87871,in1Dot87871])
Con66688 = keras.layers.Concatenate(axis=1, name = 'Con66688', )([Dot87871,in0Con66688])
Sub12845 = keras.layers.Subtract(name = 'Sub12845', )([Sim9125,Con66688])
Res79110 = keras.layers.Reshape((3, 1), name = 'Res79110', )(Sub12845)
Glo15053 = keras.layers.GlobalAveragePooling1D(name = 'Glo15053', )(Res79110)
model = tf.keras.models.Model(inputs=[in0Sim9125,in0Dot87871,in1Dot87871,in0Con66688], outputs=Glo15053)
w = model.get_layer('Sim9125').get_weights() 
w[0] = np.array([[7, 4, 7]])
w[1] = np.array([[8, 10, 1], [2, 6, 2], [3, 3, 5]])
w[2] = np.array([10, 6, 4])
model.get_layer('Sim9125').set_weights(w) 
in0Sim9125 = tf.constant([[[10], [3]]])
in0Dot87871 = tf.constant([[0.8017, 0.3125, 0.9791]])
in1Dot87871 = tf.constant([[0.2973, 0.504, 0.302]])
in0Con66688 = tf.constant([[0.6016, 0.5762]])
print (np.array2string(model.predict([in0Sim9125,in0Dot87871,in1Dot87871,in0Con66688],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo15053.png')

LSim9125 = simple_rnn_layer([[[10], [3]]],[[7, 4, 7]],[[8, 10, 1], [2, 6, 2], [3, 3, 5]],[10, 6, 4], Sim9125), 
LDot87871 = dot_layer([[0.8017, 0.3125, 0.9791]], [[0.2973, 0.504, 0.302]], 1, 1, Dot87871), 
LCon66688 = concatenate_layer([Dot87871,[[0.6016, 0.5762]]], 1, Con66688), 
LSub12845 = subtract_layer(Sim9125,Con66688, Sub12845), 
LRes79110 = reshape_layer(Sub12845, [3, 1], Res79110), 
LGlo15053 = global_average_pooling1D_layer(Res79110, Glo15053), 
exec_layers([LSim9125,LDot87871,LCon66688,LSub12845,LRes79110,LGlo15053],["Sim9125","Dot87871","Con66688","Sub12845","Res79110","Glo15053"],Glo15053,"Glo15053")

Actual (Unparsed): [[0.3768888]]

Expected (Unparsed): [[0.3768887966666667]]

Actual:   [[0.3769]]

Expected: [[0.3769]]