import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave11964 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave11964 = tf.keras.layers.Input(shape=([2, 1]))

Ave11964 = keras.layers.Average(name = 'Ave11964', )([in0Ave11964,in1Ave11964])
Res81095 = keras.layers.Reshape((2, 1, 1), name = 'Res81095', )(Ave11964)
Con98008 = keras.layers.Conv2DTranspose(2, (1, 1),strides=(1, 1), padding='same', name = 'Con98008', )(Res81095)
Res68030 = keras.layers.Reshape((2, 2), name = 'Res68030', )(Con98008)
Fla5243 = keras.layers.Flatten(name = 'Fla5243', )(Res68030)
Res42091 = keras.layers.Reshape((4, 1), name = 'Res42091', )(Fla5243)
Res8780 = keras.layers.Reshape((4, 1, 1), name = 'Res8780', )(Res42091)
Max79038 = keras.layers.MaxPool2D(pool_size=(3, 1), name = 'Max79038', )(Res8780)
model = tf.keras.models.Model(inputs=[in0Ave11964,in1Ave11964], outputs=Max79038)
w = model.get_layer('Con98008').get_weights() 
w[0] = np.array([[[[0.9275], [0.4729]]]])
w[1] = np.array([0, 0])
model.get_layer('Con98008').set_weights(w) 
in0Ave11964 = tf.constant([[[0.4705], [0.148]]])
in1Ave11964 = tf.constant([[[0.5432], [0.6791]]])
print (np.array2string(model.predict([in0Ave11964,in1Ave11964],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max79038.png')

LAve11964 = average_layer([[[[0.4705], [0.148]]], [[[0.5432], [0.6791]]]], Ave11964), 
LRes81095 = reshape_layer(Ave11964, [2, 1, 1], Res81095), 
LCon98008 = conv2D_transpose_layer(Res81095, 1, 1,[[[[0.9275], [0.4729]]]],[0, 0], 1, 1, true, Con98008), 
LRes68030 = reshape_layer(Con98008, [2, 2], Res68030), 
LFla5243 = flatten_layer(Res68030, Fla5243), 
LRes42091 = reshape_layer(Fla5243, [4, 1], Res42091), 
LRes8780 = reshape_layer(Res42091, [4, 1, 1], Res8780), 
LMax79038 = max_pool2D_layer(Res8780, 3, 1, Max79038), 
exec_layers([LAve11964,LRes81095,LCon98008,LRes68030,LFla5243,LRes42091,LRes8780,LMax79038],["Ave11964","Res81095","Con98008","Res68030","Fla5243","Res42091","Res8780","Max79038"],Max79038,"Max79038")

Actual (Unparsed): [[[[0.4701034]]]]

Expected (Unparsed): [[[[0.470103375]]]]

Actual:   [[[[0.4702]]]]

Expected: [[[[0.4702]]]]