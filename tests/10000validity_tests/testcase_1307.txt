import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add5497 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Add5497 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Ave81603 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Ave81603 = tf.keras.layers.Input(shape=([1, 1, 2]))

Add5497 = keras.layers.Add(name = 'Add5497', )([in0Add5497,in1Add5497])
Lea58244 = keras.layers.LeakyReLU(alpha=5.214959658382503, name = 'Lea58244', )(Add5497)
Res94144 = keras.layers.Reshape((2, 4), name = 'Res94144', )(Lea58244)
Ave81603 = keras.layers.Average(name = 'Ave81603', )([in0Ave81603,in1Ave81603])
Res73717 = keras.layers.Reshape((1, 1, 2, 1), name = 'Res73717', )(Ave81603)
Con37267 = keras.layers.Conv3D(2, (1, 1, 1),strides=(1, 8, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con37267', )(Res73717)
Res75241 = keras.layers.Reshape((1, 1, 4), name = 'Res75241', )(Con37267)
PRe90987 = keras.layers.PReLU(name = 'PRe90987', )(Res75241)
Res62995 = keras.layers.Reshape((1, 4), name = 'Res62995', )(PRe90987)
Dot55560 = keras.layers.Dot(axes=(2, 2), name = 'Dot55560', )([Res94144,Res62995])
model = tf.keras.models.Model(inputs=[in0Add5497,in1Add5497,in0Ave81603,in1Ave81603], outputs=Dot55560)
w = model.get_layer('Con37267').get_weights() 
w[0] = np.array([[[[[0.8207, 0.7087]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con37267').set_weights(w) 
w = model.get_layer('PRe90987').get_weights() 
w[0] = np.array([[[0.2671, 0.6438, 0.0067, 0.2858]]])
model.get_layer('PRe90987').set_weights(w) 
in0Add5497 = tf.constant([[[[0.8152, 0.5571], [0.5404, 0.6234]], [[0.4459, 0.1706], [0.1215, 0.3337]]]])
in1Add5497 = tf.constant([[[[0.4578, 0.3629], [0.9778, 0.7141]], [[0.7086, 0.9168], [0.1808, 0.968]]]])
in0Ave81603 = tf.constant([[[[0.0575, 0.3403]]]])
in1Ave81603 = tf.constant([[[[0.9384, 0.6204]]]])
print (np.array2string(model.predict([in0Add5497,in1Add5497,in0Ave81603,in1Ave81603],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot55560.png')

LAdd5497 = add_layer([[[[[0.8152, 0.5571], [0.5404, 0.6234]], [[0.4459, 0.1706], [0.1215, 0.3337]]]], [[[[0.4578, 0.3629], [0.9778, 0.7141]], [[0.7086, 0.9168], [0.1808, 0.968]]]]], Add5497), 
LLea58244 = leaky_relu_layer(Add5497, 5.214959658382503, Lea58244), 
LRes94144 = reshape_layer(Lea58244, [2, 4], Res94144), 
LAve81603 = average_layer([[[[[0.0575, 0.3403]]]], [[[[0.9384, 0.6204]]]]], Ave81603), 
LRes73717 = reshape_layer(Ave81603, [1, 1, 2, 1], Res73717), 
LCon37267 = conv3D_layer(Res73717, 1, 1, 1,[[[[[0.8207, 0.7087]]]]],[0, 0], 1, 8, 1, true, 1, 1, 1, Con37267), 
LRes75241 = reshape_layer(Con37267, [1, 1, 4], Res75241), 
LPRe90987 = prelu_layer(Res75241, [[[0.2671, 0.6438, 0.0067, 0.2858]]], PRe90987), 
LRes62995 = reshape_layer(PRe90987, [1, 4], Res62995), 
LDot55560 = dot_layer(Res94144,Res62995, 2, 2, Dot55560), 
exec_layers([LAdd5497,LLea58244,LRes94144,LAve81603,LRes73717,LCon37267,LRes75241,LPRe90987,LRes62995,LDot55560],["Add5497","Lea58244","Res94144","Ave81603","Res73717","Con37267","Res75241","PRe90987","Res62995","Dot55560"],Dot55560,"Dot55560")

Actual (Unparsed): [[[1.8987261], [1.4178507]]]

Expected (Unparsed): [[[1.8987260927915],[1.4178507473534998]]]

Actual:   [[[1.8988], [1.4179]]]

Expected: [[[1.8988], [1.4179]]]