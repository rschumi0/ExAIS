import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0PRe44118 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Mul28387 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Mul28387 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con26951 = tf.keras.layers.Input(shape=([3, 3, 1]))

PRe44118 = keras.layers.PReLU(name = 'PRe44118', input_shape=(1, 2, 1, 2))(in0PRe44118)
Con89257 = keras.layers.Conv3D(3, (1, 1, 1),strides=(1, 2, 8), padding='valid', dilation_rate=(1, 1, 1), name = 'Con89257', )(PRe44118)
Res6943 = keras.layers.Reshape((1, 1, 3), name = 'Res6943', )(Con89257)
Zer60335 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer60335', )(Res6943)
Mul28387 = keras.layers.Multiply(name = 'Mul28387', )([in0Mul28387,in1Mul28387])
Res57809 = keras.layers.Reshape((2, 2), name = 'Res57809', )(Mul28387)
Zer10336 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer10336', )(Res57809)
Res70459 = keras.layers.Reshape((4, 2, 1), name = 'Res70459', )(Zer10336)
Con59609 = keras.layers.Conv2DTranspose(2, (1, 2),strides=(1, 1), padding='valid', name = 'Con59609', )(Res70459)
Cro68093 = keras.layers.Cropping2D(cropping=((0, 1), (0, 0)), name = 'Cro68093', )(Con59609)
Con26951 = keras.layers.Concatenate(axis=3, name = 'Con26951', )([Cro68093,in0Con26951])
Add1313 = keras.layers.Add(name = 'Add1313', )([Zer60335,Con26951])
model = tf.keras.models.Model(inputs=[in0PRe44118,in0Mul28387,in1Mul28387,in0Con26951], outputs=Add1313)
w = model.get_layer('PRe44118').get_weights() 
w[0] = np.array([[[[0.5236, 0.4937]], [[0.6186, 0.1355]]]])
model.get_layer('PRe44118').set_weights(w) 
w = model.get_layer('Con89257').get_weights() 
w[0] = np.array([[[[[0.9923, 0.2998, 0.1375], [0.3203, 0.6848, 0.1752]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con89257').set_weights(w) 
w = model.get_layer('Con59609').get_weights() 
w[0] = np.array([[[[0.0211], [0.7362]], [[0.5226], [0.2213]]]])
w[1] = np.array([0, 0])
model.get_layer('Con59609').set_weights(w) 
in0PRe44118 = tf.constant([[[[[0.3988, 0.9096]], [[0.9653, 0.7638]]]]])
in0Mul28387 = tf.constant([[[[0.281, 0.9398]], [[0.432, 0.5351]]]])
in1Mul28387 = tf.constant([[[[0.6761, 0.1836]], [[0.5227, 0.4293]]]])
in0Con26951 = tf.constant([[[[0.4079], [0.4157], [0.9437]], [[0.0675], [0.9288], [0.6799]], [[0.7296], [0.4336], [0.4192]]]])
print (np.array2string(model.predict([in0PRe44118,in0Mul28387,in1Mul28387,in0Con26951],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add1313.png')

LPRe44118 = prelu_layer([[[[[0.3988, 0.9096]], [[0.9653, 0.7638]]]]], [[[[0.5236, 0.4937]], [[0.6186, 0.1355]]]], PRe44118), 
LCon89257 = conv3D_layer(PRe44118, 1, 1, 1,[[[[[0.9923, 0.2998, 0.1375], [0.3203, 0.6848, 0.1752]]]]],[0, 0, 0], 1, 2, 8, false, 1, 1, 1, Con89257), 
LRes6943 = reshape_layer(Con89257, [1, 1, 3], Res6943), 
LZer60335 = zero_padding2D_layer(Res6943, 2, 0, 2, 0, Zer60335), 
LMul28387 = multiply_layer([[[[[0.281, 0.9398]], [[0.432, 0.5351]]]], [[[[0.6761, 0.1836]], [[0.5227, 0.4293]]]]], Mul28387), 
LRes57809 = reshape_layer(Mul28387, [2, 2], Res57809), 
LZer10336 = zero_padding1D_layer(Res57809, 1, 1, Zer10336), 
LRes70459 = reshape_layer(Zer10336, [4, 2, 1], Res70459), 
LCon59609 = conv2D_transpose_layer(Res70459, 1, 2,[[[[0.0211], [0.7362]], [[0.5226], [0.2213]]]],[0, 0], 1, 1, false, Con59609), 
LCro68093 = cropping2D_layer(Con59609, 0, 1, 0, 0, Cro68093), 
LCon26951 = concatenate_layer([Cro68093,[[[[0.4079], [0.4157], [0.9437]], [[0.0675], [0.9288], [0.6799]], [[0.7296], [0.4336], [0.4192]]]]], 3, Con26951), 
LAdd1313 = add_layer([Zer60335,Con26951], Add1313), 
exec_layers([LPRe44118,LCon89257,LRes6943,LZer60335,LMul28387,LRes57809,LZer10336,LRes70459,LCon59609,LCro68093,LCon26951,LAdd1313],["PRe44118","Con89257","Res6943","Zer60335","Mul28387","Res57809","Zer10336","Res70459","Con59609","Cro68093","Con26951","Add1313"],Add1313,"Add1313")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.4079000], [0.0000000, 0.0000000, 0.4157000], [0.0000000, 0.0000000, 0.9437000]], [[0.0040087, 0.1398663, 0.0675000], [0.1029264, 0.1690728, 0.9288000], [0.0901732, 0.0381847, 0.6799000]], [[0.0047645, 0.1662387, 0.7296000], [0.1228535, 0.2190897, 0.4336000], [0.8071250, 0.7932910, 0.6333969]]]]

Expected (Unparsed): [[[[0.0,0.0,0.4079],[0.0,0.0,0.4157],[0.0,0.0,0.9437]],[[0.004008664510000001,0.13986629442,0.0675],[0.10292643826799999,0.169072788866,0.9288],[0.090173208528,0.038184713064,0.6799]],[[0.00476451504,0.16623867168,0.7296],[0.122853483513,0.21908966448600004,0.4336],[0.8071249715179999,0.7932910085589999,0.63339692]]]]

Actual:   [[[[0, 0, 0.4079], [0, 0, 0.4157], [0, 0, 0.9437]], [[0.0041, 0.1399, 0.0675], [0.103, 0.1691, 0.9288], [0.0902, 0.0382, 0.6799]], [[0.0048, 0.1663, 0.7296], [0.1229, 0.2191, 0.4336], [0.8072, 0.7933, 0.6334]]]]

Expected: [[[[0, 0, 0.4079], [0, 0, 0.4157], [0, 0, 0.9437]], [[0.0041, 0.1399, 0.0675], [0.103, 0.1691, 0.9288], [0.0902, 0.0382, 0.6799]], [[0.0048, 0.1663, 0.7296], [0.1229, 0.2191, 0.4336], [0.8072, 0.7933, 0.6334]]]]