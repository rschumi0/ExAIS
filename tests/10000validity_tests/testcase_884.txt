import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min29244 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Min29244 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Sim5415 = tf.keras.layers.Input(shape=([3, 2]))
in0Con15342 = tf.keras.layers.Input(shape=([7]))

Min29244 = keras.layers.Minimum(name = 'Min29244', )([in0Min29244,in1Min29244])
Res59833 = keras.layers.Reshape((2, 4), name = 'Res59833', )(Min29244)
Fla31681 = keras.layers.Flatten(name = 'Fla31681', )(Res59833)
Sim5415 = keras.layers.SimpleRNN(1,name = 'Sim5415', )(in0Sim5415)
Con15342 = keras.layers.Concatenate(axis=1, name = 'Con15342', )([Sim5415,in0Con15342])
Sub15698 = keras.layers.Subtract(name = 'Sub15698', )([Fla31681,Con15342])
model = tf.keras.models.Model(inputs=[in0Min29244,in1Min29244,in0Sim5415,in0Con15342], outputs=Sub15698)
w = model.get_layer('Sim5415').get_weights() 
w[0] = np.array([[7], [3]])
w[1] = np.array([[5]])
w[2] = np.array([6])
model.get_layer('Sim5415').set_weights(w) 
in0Min29244 = tf.constant([[[[0.7548, 0.9566], [0.5266, 0.2881]], [[0.2159, 0.8152], [0.2074, 0.0323]]]])
in1Min29244 = tf.constant([[[[0.9712, 0.8623], [0.7225, 0.0587]], [[0.1774, 0.8547], [0.2043, 0.0323]]]])
in0Sim5415 = tf.constant([[[8, 9], [9, 8], [2, 1]]])
in0Con15342 = tf.constant([[0.6796, 0.1696, 0.3742, 0.5656, 0.3291, 0.7258, 0.72]])
print (np.array2string(model.predict([in0Min29244,in1Min29244,in0Sim5415,in0Con15342],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub15698.png')

LMin29244 = minimum_layer([[[[[0.7548, 0.9566], [0.5266, 0.2881]], [[0.2159, 0.8152], [0.2074, 0.0323]]]], [[[[0.9712, 0.8623], [0.7225, 0.0587]], [[0.1774, 0.8547], [0.2043, 0.0323]]]]], Min29244), 
LRes59833 = reshape_layer(Min29244, [2, 4], Res59833), 
LFla31681 = flatten_layer(Res59833, Fla31681), 
LSim5415 = simple_rnn_layer([[[8, 9], [9, 8], [2, 1]]],[[7], [3]],[[5]],[6], Sim5415), 
LCon15342 = concatenate_layer([Sim5415,[[0.6796, 0.1696, 0.3742, 0.5656, 0.3291, 0.7258, 0.72]]], 1, Con15342), 
LSub15698 = subtract_layer(Fla31681,Con15342, Sub15698), 
exec_layers([LMin29244,LRes59833,LFla31681,LSim5415,LCon15342,LSub15698],["Min29244","Res59833","Fla31681","Sim5415","Con15342","Sub15698"],Sub15698,"Sub15698")

Actual (Unparsed): [[-0.2452000, 0.1827000, 0.3570000, -0.3155000, -0.3882000, 0.4861000, -0.5215000, -0.6877000]]

Expected (Unparsed): [[-0.24519999999999997,0.18269999999999997,0.357,-0.3155,-0.3882,0.48610000000000003,-0.5215,-0.6877]]

Actual:   [[-0.2452, 0.1827, 0.357, -0.3155, -0.3882, 0.4861, -0.5215, -0.6877]]

Expected: [[-0.2451, 0.1827, 0.357, -0.3155, -0.3882, 0.4862, -0.5215, -0.6877]]