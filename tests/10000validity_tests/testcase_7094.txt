import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub34564 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub34564 = tf.keras.layers.Input(shape=([2, 3]))

Sub34564 = keras.layers.Subtract(name = 'Sub34564', )([in0Sub34564,in1Sub34564])
Ave32284 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave32284', )(Sub34564)
Res98008 = keras.layers.Reshape((2, 3, 1), name = 'Res98008', )(Ave32284)
Cro45528 = keras.layers.Cropping2D(cropping=((0, 0), (0, 1)), name = 'Cro45528', )(Res98008)
Res52119 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res52119', )(Cro45528)
Zer82645 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer82645', )(Res52119)
Res97653 = keras.layers.Reshape((4, 4, 3), name = 'Res97653', )(Zer82645)
Loc1761 = keras.layers.LocallyConnected2D(4, (2, 3),strides=(1, 1), name = 'Loc1761', )(Res97653)
Bat37598 = keras.layers.BatchNormalization(axis=3, epsilon=0.25823397960852545,  name = 'Bat37598', )(Loc1761)
model = tf.keras.models.Model(inputs=[in0Sub34564,in1Sub34564], outputs=Bat37598)
w = model.get_layer('Loc1761').get_weights() 
w[0] = np.array([[[0.1506, 0.5518, 0.5666, 0.3821], [0.161, 0.6155, 0.6161, 0.3311], [0.1363, 0.7275, 0.2835, 0.4804], [0.3816, 0.7301, 0.4841, 0.7687], [0.4103, 0.7521, 0.3691, 0.4258], [0.977, 0.1496, 0.0275, 0.9908], [0.6081, 0.4478, 0.2345, 0.4407], [0.6637, 0.5777, 0.2601, 0.765], [0.9578, 0.8869, 0.4479, 0.3426], [0.6229, 0.5095, 0.1321, 0.9043], [0.2076, 0.6781, 0.4747, 0.6961], [0.9683, 0.4781, 0.9715, 0.701], [0.9344, 0.3574, 0.7018, 0.4169], [0.6043, 0.4308, 0.8784, 0.7464], [0.0671, 0.2474, 0.892, 0.0066], [0.9332, 0.2245, 0.8377, 0.9358], [0.7043, 0.3974, 0.4618, 0.8411], [0.1181, 0.477, 0.5734, 0.7102]], [[0.5609, 0.469, 0.2285, 0.191], [0.8579, 0.264, 0.4119, 0.8357], [0.6236, 0.6785, 0.5197, 0.8973], [0.8816, 0.399, 0.6741, 0.271], [0.8489, 0.1615, 0.7911, 0.8808], [0.6201, 0.2852, 0.3669, 0.9237], [0.9845, 0.3714, 0.1458, 0.9083], [0.7608, 0.5769, 0.1924, 0.3464], [0.8467, 0.3762, 0.4007, 0.2938], [0.6428, 0.1391, 0.1444, 0.6733], [0.6357, 0.1654, 0.594, 0.4584], [0.7006, 0.044, 0.2132, 0.3488], [0.121, 0.3326, 0.0787, 0.5267], [0.4115, 0.5913, 0.9666, 0.4469], [0.7784, 0.7441, 0.5959, 0.3835], [0.4555, 0.5926, 0.0265, 0.6346], [0.2115, 0.0601, 0.9731, 0.8678], [0.0433, 0.4062, 0.7128, 0.0785]], [[0.4384, 0.2185, 0.3425, 0.0303], [0.6207, 0.4619, 0.3714, 0.8461], [0.8776, 0.2472, 0.0219, 0.6285], [0.4057, 0.2636, 0.1577, 0.6017], [0.113, 0.0168, 0.4552, 0.2865], [0.4647, 0.1079, 0.2946, 0.6491], [0.7718, 0.7973, 0.8552, 0.9952], [0.287, 0.0071, 0.0738, 0.6209], [0.0954, 0.7321, 0.4439, 0.8784], [0.0619, 0.5553, 0.1216, 0.3646], [0.0382, 0.5923, 0.4353, 0.4001], [0.1173, 0.7246, 0.6967, 0.8285], [0.973, 0.4258, 0.1541, 0.44], [0.2264, 0.8317, 0.0415, 0.995], [0.3374, 0.9621, 0.9357, 0.9117], [0.7393, 0.1608, 0.0544, 0.1656], [0.8028, 0.8891, 0.7022, 0.8504], [0.7467, 0.9833, 0.8048, 0.145]], [[0.7966, 0.3622, 0.3575, 0.145], [0.732, 0.9614, 0.6586, 0.1277], [0.462, 0.3612, 0.3987, 0.3413], [0.4209, 0.1734, 0.0344, 0.3366], [0.3855, 0.7576, 0.3848, 0.191], [0.7827, 0.2504, 0.0605, 0.7146], [0.6747, 0.2045, 0.1605, 0.8737], [0.3928, 0.3619, 0.6505, 0.2197], [0.2189, 0.2143, 0.9779, 0.066], [0.6117, 0.0381, 0.7695, 0.5253], [0.214, 0.0364, 0.9105, 0.2846], [0.2887, 0.068, 0.9079, 0.1756], [0.2838, 0.1974, 0.2053, 0.1797], [0.9468, 0.9618, 0.0346, 0.497], [0.78, 0.8192, 0.466, 0.7025], [0.6553, 0.714, 0.5472, 0.8167], [0.0929, 0.0762, 0.8133, 0.3243], [0.0489, 0.8587, 0.9902, 0.7889]], [[0.054, 0.4061, 0.4156, 0.7331], [0.1978, 0.0515, 0.5594, 0.8795], [0.7642, 0.337, 0.0348, 0.6814], [0.2884, 0.6704, 0.6639, 0.3103], [0.4279, 0.0445, 0.4836, 0.9143], [0.3194, 0.1698, 0.0629, 0.0128], [0.026, 0.0018, 0.1352, 0.3498], [0.2722, 0.1798, 0.3488, 0.3934], [0.9097, 0.3363, 0.8838, 0.9407], [0.461, 0.5859, 0.7949, 0.9601], [0.6471, 0.7553, 0.1976, 0.8917], [0.0214, 0.0796, 0.8382, 0.1109], [0.7045, 0.1554, 0.1605, 0.1576], [0.7423, 0.9168, 0.7154, 0.6367], [0.7943, 0.2777, 0.6459, 0.3997], [0.7005, 0.8732, 0.0239, 0.7371], [0.972, 0.0223, 0.0182, 0.8246], [0.4032, 0.6342, 0.2246, 0.6013]], [[0.8141, 0.2858, 0.0059, 0.5823], [0.3964, 0.1079, 0.3581, 0.855], [0.2587, 0.4351, 0.6402, 0.6488], [0.546, 0.4002, 0.4933, 0.4224], [0.9412, 0.7799, 0.4055, 0.3691], [0.4487, 0.4389, 0.6776, 0.6068], [0.1068, 0.6583, 0.9942, 0.0871], [0.6789, 0.4861, 0.4078, 0.4382], [0.4323, 0.9985, 0.312, 0.5362], [0.8308, 0.027, 0.8928, 0.5895], [0.3384, 0.4685, 0.6272, 0.9189], [0.5595, 0.7728, 0.6261, 0.4127], [0.6258, 0.5799, 0.0088, 0.8499], [0.0817, 0.7671, 0.0384, 0.8947], [0.5156, 0.3562, 0.4485, 0.5875], [0.8397, 0.8329, 0.2492, 0.5847], [0.4275, 0.4308, 0.3098, 0.2315], [0.2885, 0.8492, 0.1883, 0.7929]]])
w[1] = np.array([[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]]])
model.get_layer('Loc1761').set_weights(w) 
w = model.get_layer('Bat37598').get_weights() 
w[0] = np.array([0.0795, 0.1575, 0.4295, 0.3333])
w[1] = np.array([0.0334, 0.4601, 0.6928, 0.9851])
w[2] = np.array([0.6145, 0.2798, 0.092, 0.5834])
w[3] = np.array([0.6799, 0.6403, 0.9468, 0.145])
model.get_layer('Bat37598').set_weights(w) 
in0Sub34564 = tf.constant([[[0.3737, 0.4064, 0.3178], [0.2495, 0.8487, 0.6625]]])
in1Sub34564 = tf.constant([[[0.082, 0.0994, 0.6153], [0.0915, 0.6359, 0.4132]]])
print (np.array2string(model.predict([in0Sub34564,in1Sub34564],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Bat37598.png')

LSub34564 = subtract_layer([[[0.3737, 0.4064, 0.3178], [0.2495, 0.8487, 0.6625]]], [[[0.082, 0.0994, 0.6153], [0.0915, 0.6359, 0.4132]]], Sub34564), 
LAve32284 = average_pooling1D_layer(Sub34564, 1, Ave32284), 
LRes98008 = reshape_layer(Ave32284, [2, 3, 1], Res98008), 
LCro45528 = cropping2D_layer(Res98008, 0, 0, 0, 1, Cro45528), 
LRes52119 = reshape_layer(Cro45528, [2, 2, 1, 1], Res52119), 
LZer82645 = zero_padding3D_layer(Res52119, 1, 1, 1, 1, 1, 1, Zer82645), 
LRes97653 = reshape_layer(Zer82645, [4, 4, 3], Res97653), 
LLoc1761 = locally_connected2D_layer(Res97653, 2, 3,[[[0.1506, 0.5518, 0.5666, 0.3821], [0.161, 0.6155, 0.6161, 0.3311], [0.1363, 0.7275, 0.2835, 0.4804], [0.3816, 0.7301, 0.4841, 0.7687], [0.4103, 0.7521, 0.3691, 0.4258], [0.977, 0.1496, 0.0275, 0.9908], [0.6081, 0.4478, 0.2345, 0.4407], [0.6637, 0.5777, 0.2601, 0.765], [0.9578, 0.8869, 0.4479, 0.3426], [0.6229, 0.5095, 0.1321, 0.9043], [0.2076, 0.6781, 0.4747, 0.6961], [0.9683, 0.4781, 0.9715, 0.701], [0.9344, 0.3574, 0.7018, 0.4169], [0.6043, 0.4308, 0.8784, 0.7464], [0.0671, 0.2474, 0.892, 0.0066], [0.9332, 0.2245, 0.8377, 0.9358], [0.7043, 0.3974, 0.4618, 0.8411], [0.1181, 0.477, 0.5734, 0.7102]], [[0.5609, 0.469, 0.2285, 0.191], [0.8579, 0.264, 0.4119, 0.8357], [0.6236, 0.6785, 0.5197, 0.8973], [0.8816, 0.399, 0.6741, 0.271], [0.8489, 0.1615, 0.7911, 0.8808], [0.6201, 0.2852, 0.3669, 0.9237], [0.9845, 0.3714, 0.1458, 0.9083], [0.7608, 0.5769, 0.1924, 0.3464], [0.8467, 0.3762, 0.4007, 0.2938], [0.6428, 0.1391, 0.1444, 0.6733], [0.6357, 0.1654, 0.594, 0.4584], [0.7006, 0.044, 0.2132, 0.3488], [0.121, 0.3326, 0.0787, 0.5267], [0.4115, 0.5913, 0.9666, 0.4469], [0.7784, 0.7441, 0.5959, 0.3835], [0.4555, 0.5926, 0.0265, 0.6346], [0.2115, 0.0601, 0.9731, 0.8678], [0.0433, 0.4062, 0.7128, 0.0785]], [[0.4384, 0.2185, 0.3425, 0.0303], [0.6207, 0.4619, 0.3714, 0.8461], [0.8776, 0.2472, 0.0219, 0.6285], [0.4057, 0.2636, 0.1577, 0.6017], [0.113, 0.0168, 0.4552, 0.2865], [0.4647, 0.1079, 0.2946, 0.6491], [0.7718, 0.7973, 0.8552, 0.9952], [0.287, 0.0071, 0.0738, 0.6209], [0.0954, 0.7321, 0.4439, 0.8784], [0.0619, 0.5553, 0.1216, 0.3646], [0.0382, 0.5923, 0.4353, 0.4001], [0.1173, 0.7246, 0.6967, 0.8285], [0.973, 0.4258, 0.1541, 0.44], [0.2264, 0.8317, 0.0415, 0.995], [0.3374, 0.9621, 0.9357, 0.9117], [0.7393, 0.1608, 0.0544, 0.1656], [0.8028, 0.8891, 0.7022, 0.8504], [0.7467, 0.9833, 0.8048, 0.145]], [[0.7966, 0.3622, 0.3575, 0.145], [0.732, 0.9614, 0.6586, 0.1277], [0.462, 0.3612, 0.3987, 0.3413], [0.4209, 0.1734, 0.0344, 0.3366], [0.3855, 0.7576, 0.3848, 0.191], [0.7827, 0.2504, 0.0605, 0.7146], [0.6747, 0.2045, 0.1605, 0.8737], [0.3928, 0.3619, 0.6505, 0.2197], [0.2189, 0.2143, 0.9779, 0.066], [0.6117, 0.0381, 0.7695, 0.5253], [0.214, 0.0364, 0.9105, 0.2846], [0.2887, 0.068, 0.9079, 0.1756], [0.2838, 0.1974, 0.2053, 0.1797], [0.9468, 0.9618, 0.0346, 0.497], [0.78, 0.8192, 0.466, 0.7025], [0.6553, 0.714, 0.5472, 0.8167], [0.0929, 0.0762, 0.8133, 0.3243], [0.0489, 0.8587, 0.9902, 0.7889]], [[0.054, 0.4061, 0.4156, 0.7331], [0.1978, 0.0515, 0.5594, 0.8795], [0.7642, 0.337, 0.0348, 0.6814], [0.2884, 0.6704, 0.6639, 0.3103], [0.4279, 0.0445, 0.4836, 0.9143], [0.3194, 0.1698, 0.0629, 0.0128], [0.026, 0.0018, 0.1352, 0.3498], [0.2722, 0.1798, 0.3488, 0.3934], [0.9097, 0.3363, 0.8838, 0.9407], [0.461, 0.5859, 0.7949, 0.9601], [0.6471, 0.7553, 0.1976, 0.8917], [0.0214, 0.0796, 0.8382, 0.1109], [0.7045, 0.1554, 0.1605, 0.1576], [0.7423, 0.9168, 0.7154, 0.6367], [0.7943, 0.2777, 0.6459, 0.3997], [0.7005, 0.8732, 0.0239, 0.7371], [0.972, 0.0223, 0.0182, 0.8246], [0.4032, 0.6342, 0.2246, 0.6013]], [[0.8141, 0.2858, 0.0059, 0.5823], [0.3964, 0.1079, 0.3581, 0.855], [0.2587, 0.4351, 0.6402, 0.6488], [0.546, 0.4002, 0.4933, 0.4224], [0.9412, 0.7799, 0.4055, 0.3691], [0.4487, 0.4389, 0.6776, 0.6068], [0.1068, 0.6583, 0.9942, 0.0871], [0.6789, 0.4861, 0.4078, 0.4382], [0.4323, 0.9985, 0.312, 0.5362], [0.8308, 0.027, 0.8928, 0.5895], [0.3384, 0.4685, 0.6272, 0.9189], [0.5595, 0.7728, 0.6261, 0.4127], [0.6258, 0.5799, 0.0088, 0.8499], [0.0817, 0.7671, 0.0384, 0.8947], [0.5156, 0.3562, 0.4485, 0.5875], [0.8397, 0.8329, 0.2492, 0.5847], [0.4275, 0.4308, 0.3098, 0.2315], [0.2885, 0.8492, 0.1883, 0.7929]]],[[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]]], 1, 1, Loc1761), 
LBat37598 = batch_normalization_layer(Loc1761, 3, 0.25823397960852545, [0.0795, 0.1575, 0.4295, 0.3333], [0.0334, 0.4601, 0.6928, 0.9851], [0.6145, 0.2798, 0.092, 0.5834], [0.6799, 0.6403, 0.9468, 0.145], Bat37598), 
exec_layers([LSub34564,LAve32284,LRes98008,LCro45528,LRes52119,LZer82645,LRes97653,LLoc1761,LBat37598],["Sub34564","Ave32284","Res98008","Cro45528","Res52119","Zer82645","Res97653","Loc1761","Bat37598"],Bat37598,"Bat37598")

Actual (Unparsed): [[[[0.0151779, 0.4547608, 0.8125258, 0.9286982], [0.0085516, 0.4517883, 0.8407019, 0.8210834]], [[0.0098578, 0.4680570, 0.7786513, 1.0003022], [0.0295147, 0.5338139, 0.8373578, 0.8083299]], [[-0.0067342, 0.4211354, 0.7157408, 0.7986509], [0.0045424, 0.4440180, 0.7127034, 0.7910189]]]]

Expected (Unparsed): [[[[0.015177892462401844,0.454760803158729,0.8125257637572699,0.9286981743372495],[0.00855159647420643,0.45178831089553495,0.8407018831925743,0.821083363616798]],[[0.00985780551267235,0.46805705128483094,0.7786512963919362,1.0003022315958106],[0.029514679924382982,0.5338139526675638,0.8373578379525353,0.8083298782258607]],[[-0.006734218775687487,0.42113540617597645,0.7157408178332632,0.7986508647686072],[0.004542371649724628,0.44401801446059597,0.7127033860428735,0.7910189361224542]]]]

Actual:   [[[[0.0152, 0.4548, 0.8126, 0.9287], [0.0086, 0.4518, 0.8408, 0.8211]], [[0.0099, 0.4681, 0.7787, 1.0004], [0.0296, 0.5339, 0.8374, 0.8084]], [[-0.0067, 0.4212, 0.7158, 0.7987], [0.0046, 0.4441, 0.7128, 0.7911]]]]

Expected: [[[[0.0152, 0.4548, 0.8126, 0.9287], [0.0086, 0.4518, 0.8408, 0.8211]], [[0.0099, 0.4681, 0.7787, 1.0004], [0.0296, 0.5339, 0.8374, 0.8084]], [[-0.0067, 0.4212, 0.7158, 0.7987], [0.0046, 0.4441, 0.7128, 0.7911]]]]