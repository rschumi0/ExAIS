import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0GRU56152 = tf.keras.layers.Input(shape=([2, 3]))
in0Con33072 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Min13730 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Min13730 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Mul59523 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Mul59523 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Glo23271 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Ave41864 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave41864 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con87334 = tf.keras.layers.Input(shape=([1]))
in0Con93354 = tf.keras.layers.Input(shape=([14]))

GRU56152 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU56152', )(in0GRU56152)
Res90612 = keras.layers.Reshape((1, 1), name = 'Res90612', )(GRU56152)
Res52552 = keras.layers.Reshape((1, 1, 1), name = 'Res52552', )(Res90612)
Res52546 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res52546', )(Res52552)
Cro60142 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro60142', )(Res52546)
Zer53169 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (0, 0)), name = 'Zer53169', )(Cro60142)
Con33072 = keras.layers.Concatenate(axis=4, name = 'Con33072', )([Zer53169,in0Con33072])
Min13730 = keras.layers.Minimum(name = 'Min13730', )([in0Min13730,in1Min13730])
Ave25946 = keras.layers.Average(name = 'Ave25946', )([Con33072,Min13730])
Res38267 = keras.layers.Reshape((2, 2, 2), name = 'Res38267', )(Ave25946)
Res96138 = keras.layers.Reshape((2, 4), name = 'Res96138', )(Res38267)
Max9900 = keras.layers.MaxPool1D(pool_size=(1), strides=(1), padding='same', name = 'Max9900', )(Res96138)
Res70954 = keras.layers.Reshape((2, 4, 1), name = 'Res70954', )(Max9900)
Res56971 = keras.layers.Reshape((2, 4, 1, 1), name = 'Res56971', )(Res70954)
Up_57355 = keras.layers.UpSampling3D(size=(1, 1, 2), name = 'Up_57355', )(Res56971)
Res36689 = keras.layers.Reshape((2, 4, 2), name = 'Res36689', )(Up_57355)
Res89194 = keras.layers.Reshape((2, 8), name = 'Res89194', )(Res36689)
Fla42167 = keras.layers.Flatten(name = 'Fla42167', )(Res89194)
Mul59523 = keras.layers.Multiply(name = 'Mul59523', )([in0Mul59523,in1Mul59523])
Res12474 = keras.layers.Reshape((1, 2), name = 'Res12474', )(Mul59523)
Fla92796 = keras.layers.Flatten(name = 'Fla92796', )(Res12474)
Glo23271 = keras.layers.GlobalAveragePooling2D(name = 'Glo23271', )(in0Glo23271)
Ave41864 = keras.layers.Average(name = 'Ave41864', )([in0Ave41864,in1Ave41864])
Glo95880 = keras.layers.GlobalMaxPool2D(name = 'Glo95880', )(Ave41864)
Con87334 = keras.layers.Concatenate(axis=1, name = 'Con87334', )([Glo95880,in0Con87334])
Mul44037 = keras.layers.Multiply(name = 'Mul44037', )([Glo23271,Con87334])
Sub5936 = keras.layers.Subtract(name = 'Sub5936', )([Fla92796,Mul44037])
Con93354 = keras.layers.Concatenate(axis=1, name = 'Con93354', )([Sub5936,in0Con93354])
Mul62012 = keras.layers.Multiply(name = 'Mul62012', )([Fla42167,Con93354])
model = tf.keras.models.Model(inputs=[in0GRU56152,in0Con33072,in0Min13730,in1Min13730,in0Mul59523,in1Mul59523,in0Glo23271,in0Ave41864,in1Ave41864,in0Con87334,in0Con93354], outputs=Mul62012)
w = model.get_layer('GRU56152').get_weights() 
w[0] = np.array([[5, 6, 7], [4, 7, 8], [3, 3, 9]])
w[1] = np.array([[1, 6, 5]])
w[2] = np.array([8, 7, 2])
model.get_layer('GRU56152').set_weights(w) 
in0GRU56152 = tf.constant([[[10, 5, 3], [6, 2, 6]]])
in0Con33072 = tf.constant([[[[[0.9959]], [[0.8611]]], [[[0.3174]], [[0.6276]]]]])
in0Min13730 = tf.constant([[[[[0.302, 0.9528]], [[0.9682, 0.3584]]], [[[0.4621, 0.5625]], [[0.979, 0.7093]]]]])
in1Min13730 = tf.constant([[[[[0.8837, 0.0243]], [[0.2327, 0.8896]]], [[[0.385, 0.446]], [[0.6758, 0.9067]]]]])
in0Mul59523 = tf.constant([[[[0.586, 0.2744]]]])
in1Mul59523 = tf.constant([[[[0.1184, 0.347]]]])
in0Glo23271 = tf.constant([[[[1.0357, 1.987]]]])
in0Ave41864 = tf.constant([[[[0.3316], [0.6935]], [[0.4267], [0.7784]]]])
in1Ave41864 = tf.constant([[[[0.4866], [0.5426]], [[0.3739], [0.012]]]])
in0Con87334 = tf.constant([[0.5144]])
in0Con93354 = tf.constant([[0.8361, 0.9502, 0.2797, 0.0578, 0.8592, 0.1926, 0.765, 0.5683, 0.241, 0.9861, 0.3712, 0.3339, 0.8508, 0.58]])
print (np.array2string(model.predict([in0GRU56152,in0Con33072,in0Min13730,in1Min13730,in0Mul59523,in1Mul59523,in0Glo23271,in0Ave41864,in1Ave41864,in0Con87334,in0Con93354],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul62012.png')

LGRU56152 = gru_layer([[[10, 5, 3], [6, 2, 6]]],[[5, 6, 7], [4, 7, 8], [3, 3, 9]],[[1, 6, 5]],[8, 7, 2], false, GRU56152), 
LRes90612 = reshape_layer(GRU56152, [1, 1], Res90612), 
LRes52552 = reshape_layer(Res90612, [1, 1, 1], Res52552), 
LRes52546 = reshape_layer(Res52552, [1, 1, 1, 1], Res52546), 
LCro60142 = cropping3D_layer(Res52546, 0, 0, 0, 0, 0, 0, Cro60142), 
LZer53169 = zero_padding3D_layer(Cro60142, 1, 0, 1, 0, 0, 0, Zer53169), 
LCon33072 = concatenate_layer([Zer53169,[[[[[0.9959]], [[0.8611]]], [[[0.3174]], [[0.6276]]]]]], 4, Con33072), 
LMin13730 = minimum_layer([[[[[[0.302, 0.9528]], [[0.9682, 0.3584]]], [[[0.4621, 0.5625]], [[0.979, 0.7093]]]]], [[[[[0.8837, 0.0243]], [[0.2327, 0.8896]]], [[[0.385, 0.446]], [[0.6758, 0.9067]]]]]], Min13730), 
LAve25946 = average_layer([Con33072,Min13730], Ave25946), 
LRes38267 = reshape_layer(Ave25946, [2, 2, 2], Res38267), 
LRes96138 = reshape_layer(Res38267, [2, 4], Res96138), 
LMax9900 = max_pool1D_layer(Res96138, 1, 1, true, Max9900), 
LRes70954 = reshape_layer(Max9900, [2, 4, 1], Res70954), 
LRes56971 = reshape_layer(Res70954, [2, 4, 1, 1], Res56971), 
LUp_57355 = up_sampling3D_layer(Res56971, 1, 1, 2, Up_57355), 
LRes36689 = reshape_layer(Up_57355, [2, 4, 2], Res36689), 
LRes89194 = reshape_layer(Res36689, [2, 8], Res89194), 
LFla42167 = flatten_layer(Res89194, Fla42167), 
LMul59523 = multiply_layer([[[[[0.586, 0.2744]]]], [[[[0.1184, 0.347]]]]], Mul59523), 
LRes12474 = reshape_layer(Mul59523, [1, 2], Res12474), 
LFla92796 = flatten_layer(Res12474, Fla92796), 
LGlo23271 = global_average_pooling2D_layer([[[[1.0357, 1.987]]]], Glo23271), 
LAve41864 = average_layer([[[[[0.3316], [0.6935]], [[0.4267], [0.7784]]]], [[[[0.4866], [0.5426]], [[0.3739], [0.012]]]]], Ave41864), 
LGlo95880 = global_max_pool2D_layer(Ave41864, Glo95880), 
LCon87334 = concatenate_layer([Glo95880,[[0.5144]]], 1, Con87334), 
LMul44037 = multiply_layer([Glo23271,Con87334], Mul44037), 
LSub5936 = subtract_layer(Fla92796,Mul44037, Sub5936), 
LCon93354 = concatenate_layer([Sub5936,[[0.8361, 0.9502, 0.2797, 0.0578, 0.8592, 0.1926, 0.765, 0.5683, 0.241, 0.9861, 0.3712, 0.3339, 0.8508, 0.58]]], 1, Con93354), 
LMul62012 = multiply_layer([Fla42167,Con93354], Mul62012), 
exec_layers([LGRU56152,LRes90612,LRes52552,LRes52546,LCro60142,LZer53169,LCon33072,LMin13730,LAve25946,LRes38267,LRes96138,LMax9900,LRes70954,LRes56971,LUp_57355,LRes36689,LRes89194,LFla42167,LMul59523,LRes12474,LFla92796,LGlo23271,LAve41864,LGlo95880,LCon87334,LMul44037,LSub5936,LCon93354,LMul62012],["GRU56152","Res90612","Res52552","Res52546","Cro60142","Zer53169","Con33072","Min13730","Ave25946","Res38267","Res96138","Max9900","Res70954","Res56971","Up_57355","Res36689","Res89194","Fla42167","Mul59523","Res12474","Fla92796","Glo23271","Ave41864","Glo95880","Con87334","Mul44037","Sub5936","Con93354","Mul62012"],Mul62012,"Mul62012")

Actual (Unparsed): [[-0.0861805, -0.1399613, 0.4264946, 0.4846970, 0.0325431, 0.0067250, 0.5238972, 0.1174378, 0.1472625, 0.1093977, 0.0919897, 0.3763944, 0.1254285, 0.1128248, 0.5687172, 0.3877010]]

Expected (Unparsed): [[-0.08618052973500001,-0.13996129599999999,0.42649461,0.48469702000000003,0.032543095,0.006725029999999999,0.5238972,0.11743785,0.14726250000000002,0.10939775,0.09198970000000001,0.37639437000000003,0.12542847999999998,0.11282480999999998,0.56871726,0.38770099999999996]]

Actual:   [[-0.0861, -0.1399, 0.4265, 0.4847, 0.0326, 0.0068, 0.5239, 0.1175, 0.1473, 0.1094, 0.092, 0.3764, 0.1255, 0.1129, 0.5688, 0.3878]]

Expected: [[-0.0861, -0.1399, 0.4265, 0.4847, 0.0326, 0.0068, 0.5239, 0.1175, 0.1473, 0.1094, 0.092, 0.3764, 0.1255, 0.1129, 0.5688, 0.3878]]