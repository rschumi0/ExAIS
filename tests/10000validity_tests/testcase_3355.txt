import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min31623 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Min31623 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Con77099 = tf.keras.layers.Input(shape=([1]))
in0Sub1016 = tf.keras.layers.Input(shape=([3]))
in1Sub1016 = tf.keras.layers.Input(shape=([3]))
in0Sim28980 = tf.keras.layers.Input(shape=([3, 1]))
in0Con91664 = tf.keras.layers.Input(shape=([2]))

Min31623 = keras.layers.Minimum(name = 'Min31623', )([in0Min31623,in1Min31623])
Res67655 = keras.layers.Reshape((1, 1, 2), name = 'Res67655', )(Min31623)
Res12576 = keras.layers.Reshape((1, 2), name = 'Res12576', )(Res67655)
Fla82840 = keras.layers.Flatten(name = 'Fla82840', )(Res12576)
Con77099 = keras.layers.Concatenate(axis=1, name = 'Con77099', )([Fla82840,in0Con77099])
Sub1016 = keras.layers.Subtract(name = 'Sub1016', )([in0Sub1016,in1Sub1016])
Ave71176 = keras.layers.Average(name = 'Ave71176', )([Con77099,Sub1016])
Sim28980 = keras.layers.SimpleRNN(1,name = 'Sim28980', )(in0Sim28980)
Con91664 = keras.layers.Concatenate(axis=1, name = 'Con91664', )([Sim28980,in0Con91664])
Sub32888 = keras.layers.Subtract(name = 'Sub32888', )([Ave71176,Con91664])
model = tf.keras.models.Model(inputs=[in0Min31623,in1Min31623,in0Con77099,in0Sub1016,in1Sub1016,in0Sim28980,in0Con91664], outputs=Sub32888)
w = model.get_layer('Sim28980').get_weights() 
w[0] = np.array([[1]])
w[1] = np.array([[5]])
w[2] = np.array([3])
model.get_layer('Sim28980').set_weights(w) 
in0Min31623 = tf.constant([[[[[0.8308], [0.2891]]]]])
in1Min31623 = tf.constant([[[[[0.0363], [0.6957]]]]])
in0Con77099 = tf.constant([[0.3181]])
in0Sub1016 = tf.constant([[0.1979, 0.3047, 0.2784]])
in1Sub1016 = tf.constant([[0.9273, 0.3886, 0.7013]])
in0Sim28980 = tf.constant([[[1], [9], [4]]])
in0Con91664 = tf.constant([[0.8919, 0.9271]])
print (np.array2string(model.predict([in0Min31623,in1Min31623,in0Con77099,in0Sub1016,in1Sub1016,in0Sim28980,in0Con91664],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub32888.png')

LMin31623 = minimum_layer([[[[[[0.8308], [0.2891]]]]], [[[[[0.0363], [0.6957]]]]]], Min31623), 
LRes67655 = reshape_layer(Min31623, [1, 1, 2], Res67655), 
LRes12576 = reshape_layer(Res67655, [1, 2], Res12576), 
LFla82840 = flatten_layer(Res12576, Fla82840), 
LCon77099 = concatenate_layer([Fla82840,[[0.3181]]], 1, Con77099), 
LSub1016 = subtract_layer([[0.1979, 0.3047, 0.2784]], [[0.9273, 0.3886, 0.7013]], Sub1016), 
LAve71176 = average_layer([Con77099,Sub1016], Ave71176), 
LSim28980 = simple_rnn_layer([[[1], [9], [4]]],[[1]],[[5]],[3], Sim28980), 
LCon91664 = concatenate_layer([Sim28980,[[0.8919, 0.9271]]], 1, Con91664), 
LSub32888 = subtract_layer(Ave71176,Con91664, Sub32888), 
exec_layers([LMin31623,LRes67655,LRes12576,LFla82840,LCon77099,LSub1016,LAve71176,LSim28980,LCon91664,LSub32888],["Min31623","Res67655","Res12576","Fla82840","Con77099","Sub1016","Ave71176","Sim28980","Con91664","Sub32888"],Sub32888,"Sub32888")

Actual (Unparsed): [[-1.3465500, -0.7893000, -0.9795000]]

Expected (Unparsed): [[-1.3465499999244974,-0.7893,-0.9795]]

Actual:   [[-1.3465, -0.7893, -0.9795]]

Expected: [[-1.3465, -0.7893, -0.9795]]