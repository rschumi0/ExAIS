import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con58725 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Add81633 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Add81633 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con5142 = tf.keras.layers.Input(shape=([1, 2, 3]))
in0Per7669 = tf.keras.layers.Input(shape=([2, 1]))
in0Con89107 = tf.keras.layers.Input(shape=([2, 7]))

Con58725 = keras.layers.Conv2D(4, (1, 1),strides=(2, 1), padding='valid', dilation_rate=(1, 1), name = 'Con58725', )(in0Con58725)
Add81633 = keras.layers.Add(name = 'Add81633', )([in0Add81633,in1Add81633])
Con5142 = keras.layers.Concatenate(axis=3, name = 'Con5142', )([Add81633,in0Con5142])
Add80578 = keras.layers.Add(name = 'Add80578', )([Con58725,Con5142])
Res98292 = keras.layers.Reshape((1, 8), name = 'Res98292', )(Add80578)
Zer3696 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer3696', )(Res98292)
Per7669 = keras.layers.Permute((1,2), name = 'Per7669',)(in0Per7669)
Con89107 = keras.layers.Concatenate(axis=2, name = 'Con89107', )([Per7669,in0Con89107])
Mul43896 = keras.layers.Multiply(name = 'Mul43896', )([Zer3696,Con89107])
Res67331 = keras.layers.Reshape((2, 8, 1), name = 'Res67331', )(Mul43896)
Sep35776 = keras.layers.SeparableConv2D(3, (2, 7),strides=(2, 2), padding='same', name = 'Sep35776', )(Res67331)
model = tf.keras.models.Model(inputs=[in0Con58725,in0Add81633,in1Add81633,in0Con5142,in0Per7669,in0Con89107], outputs=Sep35776)
w = model.get_layer('Con58725').get_weights() 
w[0] = np.array([[[[0.501, 0.1628, 0.4021, 0.185], [0.2273, 0.5135, 0.3754, 0.9819]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con58725').set_weights(w) 
w = model.get_layer('Sep35776').get_weights() 
w[0] = np.array([[[[0.6497]], [[0.0252]], [[0.8918]], [[0.1105]], [[0.9103]], [[0.8266]], [[0.0532]]], [[[0.4848]], [[0.2372]], [[0.3105]], [[0.9525]], [[0.0085]], [[0.3845]], [[0.699]]]])
w[1] = np.array([[[[0.5394, 0.9401, 0.4426]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep35776').set_weights(w) 
in0Con58725 = tf.constant([[[[0.8252, 0.5647], [0.0483, 0.0922]], [[0.5202, 0.162], [0.398, 0.7182]]]])
in0Add81633 = tf.constant([[[[0.7446], [0.4691]]]])
in1Add81633 = tf.constant([[[[0.2845], [0.9051]]]])
in0Con5142 = tf.constant([[[[0.2694, 0.4608, 0.4244], [0.6698, 0.4258, 0.6025]]]])
in0Per7669 = tf.constant([[[1.1225], [1.028]]])
in0Con89107 = tf.constant([[[0.8998, 0.4645, 0.6978, 0.6441, 0.1188, 0.0218, 0.0709], [0.3675, 0.6029, 0.3192, 0.8242, 0.1796, 0.2232, 0.441]]])
print (np.array2string(model.predict([in0Con58725,in0Add81633,in1Add81633,in0Con5142,in0Per7669,in0Con89107],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sep35776.png')

LCon58725 = conv2D_layer([[[[0.8252, 0.5647], [0.0483, 0.0922]], [[0.5202, 0.162], [0.398, 0.7182]]]], 1, 1,[[[[0.501, 0.1628, 0.4021, 0.185], [0.2273, 0.5135, 0.3754, 0.9819]]]],[0, 0, 0, 0], 2, 1, false, 1, 1, Con58725), 
LAdd81633 = add_layer([[[[[0.7446], [0.4691]]]], [[[[0.2845], [0.9051]]]]], Add81633), 
LCon5142 = concatenate_layer([Add81633,[[[[0.2694, 0.4608, 0.4244], [0.6698, 0.4258, 0.6025]]]]], 3, Con5142), 
LAdd80578 = add_layer([Con58725,Con5142], Add80578), 
LRes98292 = reshape_layer(Add80578, [1, 8], Res98292), 
LZer3696 = zero_padding1D_layer(Res98292, 1, 0, Zer3696), 
LPer7669 = permute_layer([[[1.1225], [1.028]]], 1,2, Per7669), 
LCon89107 = concatenate_layer([Per7669,[[[0.8998, 0.4645, 0.6978, 0.6441, 0.1188, 0.0218, 0.0709], [0.3675, 0.6029, 0.3192, 0.8242, 0.1796, 0.2232, 0.441]]]], 2, Con89107), 
LMul43896 = multiply_layer([Zer3696,Con89107], Mul43896), 
LRes67331 = reshape_layer(Mul43896, [2, 8, 1], Res67331), 
LSep35776 = separable_conv2D_layer(Res67331, 2, 7,[[[[[0.6497]], [[0.0252]], [[0.8918]], [[0.1105]], [[0.9103]], [[0.8266]], [[0.0532]]], [[[0.4848]], [[0.2372]], [[0.3105]], [[0.9525]], [[0.0085]], [[0.3845]], [[0.699]]]],[[[[0.5394, 0.9401, 0.4426]]]]],[0, 0, 0], 2, 2, true, Sep35776), 
exec_layers([LCon58725,LAdd81633,LCon5142,LAdd80578,LRes98292,LZer3696,LPer7669,LCon89107,LMul43896,LRes67331,LSep35776],["Con58725","Add81633","Con5142","Add80578","Res98292","Zer3696","Per7669","Con89107","Mul43896","Res67331","Sep35776"],Sep35776,"Sep35776")

Actual (Unparsed): [[[[0.9202083, 1.6037964, 0.7550689], [0.8146689, 1.4198558, 0.6684695], [0.5321197, 0.9274115, 0.4366262], [0.4995589, 0.8706624, 0.4099087]]]]

Expected (Unparsed): [[[[0.9202082653508041,1.603796422425456,0.7550689251840301],[0.8146688916806328,1.4198558121411993,0.6684695058543717],[0.5321197065686843,0.9274114500282169,0.43662621825602466],[0.49955887597708115,0.8706624013831183,0.4099087106181982]]]]

Actual:   [[[[0.9203, 1.6038, 0.7551], [0.8147, 1.4199, 0.6685], [0.5322, 0.9275, 0.4367], [0.4996, 0.8707, 0.41]]]]

Expected: [[[[0.9203, 1.6038, 0.7551], [0.8147, 1.4199, 0.6685], [0.5322, 0.9275, 0.4367], [0.4996, 0.8707, 0.41]]]]