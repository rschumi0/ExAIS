import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max16208 = tf.keras.layers.Input(shape=([1, 2]))
in1Max16208 = tf.keras.layers.Input(shape=([1, 2]))
in0Mul3056 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Mul3056 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Sep33503 = tf.keras.layers.Input(shape=([1, 2]))

Max16208 = keras.layers.Maximum(name = 'Max16208', )([in0Max16208,in1Max16208])
Res40534 = keras.layers.Reshape((1, 2, 1), name = 'Res40534', )(Max16208)
Zer8172 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer8172', )(Res40534)
Mul3056 = keras.layers.Multiply(name = 'Mul3056', )([in0Mul3056,in1Mul3056])
Ave79592 = keras.layers.Average(name = 'Ave79592', )([Zer8172,Mul3056])
Res64713 = keras.layers.Reshape((2, 2), name = 'Res64713', )(Ave79592)
Sep33503 = keras.layers.SeparableConv1D(2, (1),strides=(1), padding='valid', name = 'Sep33503', )(in0Sep33503)
Zer32963 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer32963', )(Sep33503)
Max90839 = keras.layers.Maximum(name = 'Max90839', )([Res64713,Zer32963])
Ave83131 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='same', name = 'Ave83131', )(Max90839)
Ave44406 = keras.layers.AveragePooling1D(pool_size=(2), strides=(7), padding='same', name = 'Ave44406', )(Ave83131)
model = tf.keras.models.Model(inputs=[in0Max16208,in1Max16208,in0Mul3056,in1Mul3056,in0Sep33503], outputs=Ave44406)
w = model.get_layer('Sep33503').get_weights() 
w[0] = np.array([[[0.545], [0.0229]]])
w[1] = np.array([[[0.373, 0.8235], [0.9539, 0.6402]]])
w[2] = np.array([0, 0])
model.get_layer('Sep33503').set_weights(w) 
in0Max16208 = tf.constant([[[0.8844, 0.6703]]])
in1Max16208 = tf.constant([[[0.7096, 0.0854]]])
in0Mul3056 = tf.constant([[[[0.6781], [0.8838]], [[0.0406], [0.1068]]]])
in1Mul3056 = tf.constant([[[[0.6078], [0.051]], [[0.8594], [0.702]]]])
in0Sep33503 = tf.constant([[[0.1388, 0.5186]]])
print (np.array2string(model.predict([in0Max16208,in1Max16208,in0Mul3056,in1Mul3056,in0Sep33503],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave44406.png')

LMax16208 = maximum_layer([[[[0.8844, 0.6703]]], [[[0.7096, 0.0854]]]], Max16208), 
LRes40534 = reshape_layer(Max16208, [1, 2, 1], Res40534), 
LZer8172 = zero_padding2D_layer(Res40534, 1, 0, 0, 0, Zer8172), 
LMul3056 = multiply_layer([[[[[0.6781], [0.8838]], [[0.0406], [0.1068]]]], [[[[0.6078], [0.051]], [[0.8594], [0.702]]]]], Mul3056), 
LAve79592 = average_layer([Zer8172,Mul3056], Ave79592), 
LRes64713 = reshape_layer(Ave79592, [2, 2], Res64713), 
LSep33503 = separable_conv1D_layer([[[0.1388, 0.5186]]], 1,[[[[0.545], [0.0229]]],[[[0.373, 0.8235], [0.9539, 0.6402]]]],[0, 0], 1, false, Sep33503), 
LZer32963 = zero_padding1D_layer(Sep33503, 1, 0, Zer32963), 
LMax90839 = maximum_layer([Res64713,Zer32963], Max90839), 
LAve83131 = average_pooling1D_layer(Max90839, 1, 1, true, Ave83131), 
LAve44406 = average_pooling1D_layer(Ave83131, 2, 7, true, Ave44406), 
exec_layers([LMax16208,LRes40534,LZer8172,LMul3056,LAve79592,LRes64713,LSep33503,LZer32963,LMax90839,LAve83131,LAve44406],["Max16208","Res40534","Zer8172","Mul3056","Ave79592","Res64713","Sep33503","Zer32963","Max90839","Ave83131","Ave44406"],Ave44406,"Ave44406")

Actual (Unparsed): [[[0.3328602, 0.1975869]]]

Expected (Unparsed): [[[0.332860205,0.19758684999999998]]]

Actual:   [[[0.3329, 0.1976]]]

Expected: [[[0.3329, 0.1976]]]