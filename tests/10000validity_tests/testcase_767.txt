import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add27865 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Add27865 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Up_93752 = tf.keras.layers.Input(shape=([4, 3]))
in0Con64289 = tf.keras.layers.Input(shape=([1]))

Add27865 = keras.layers.Add(name = 'Add27865', )([in0Add27865,in1Add27865])
Res47744 = keras.layers.Reshape((1, 2), name = 'Res47744', )(Add27865)
Fla58965 = keras.layers.Flatten(name = 'Fla58965', )(Res47744)
Up_93752 = keras.layers.UpSampling1D(size=(2), name = 'Up_93752', )(in0Up_93752)
Per87790 = keras.layers.Permute((2,1), name = 'Per87790',)(Up_93752)
Res11977 = keras.layers.Reshape((3, 8, 1), name = 'Res11977', )(Per87790)
Res32899 = keras.layers.Reshape((3, 8, 1, 1), name = 'Res32899', )(Res11977)
Glo74704 = keras.layers.GlobalAveragePooling3D(name = 'Glo74704', )(Res32899)
Con64289 = keras.layers.Concatenate(axis=1, name = 'Con64289', )([Glo74704,in0Con64289])
Sub33723 = keras.layers.Subtract(name = 'Sub33723', )([Fla58965,Con64289])
Res22204 = keras.layers.Reshape((2, 1), name = 'Res22204', )(Sub33723)
Res41261 = keras.layers.Reshape((2, 1, 1), name = 'Res41261', )(Res22204)
Sep20541 = keras.layers.SeparableConv2D(2, (2, 1),strides=(2, 2), padding='same', name = 'Sep20541', )(Res41261)
Ave70448 = keras.layers.AveragePooling2D(pool_size=(1, 1), name = 'Ave70448', )(Sep20541)
model = tf.keras.models.Model(inputs=[in0Add27865,in1Add27865,in0Up_93752,in0Con64289], outputs=Ave70448)
w = model.get_layer('Sep20541').get_weights() 
w[0] = np.array([[[[0.7582]]], [[[0.5252]]]])
w[1] = np.array([[[[0.0814, 0.8655]]]])
w[2] = np.array([0, 0])
model.get_layer('Sep20541').set_weights(w) 
in0Add27865 = tf.constant([[[[0.2851], [0.521]]]])
in1Add27865 = tf.constant([[[[0.3315], [0.3131]]]])
in0Up_93752 = tf.constant([[[1.9128, 1.8879, 1.1974], [1.6636, 1.8378, 1.9026], [1.4367, 1.3828, 1.0886], [1.0165, 1.6415, 1.4832]]])
in0Con64289 = tf.constant([[0.5919]])
print (np.array2string(model.predict([in0Add27865,in1Add27865,in0Up_93752,in0Con64289],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave70448.png')

LAdd27865 = add_layer([[[[[0.2851], [0.521]]]], [[[[0.3315], [0.3131]]]]], Add27865), 
LRes47744 = reshape_layer(Add27865, [1, 2], Res47744), 
LFla58965 = flatten_layer(Res47744, Fla58965), 
LUp_93752 = up_sampling1D_layer([[[1.9128, 1.8879, 1.1974], [1.6636, 1.8378, 1.9026], [1.4367, 1.3828, 1.0886], [1.0165, 1.6415, 1.4832]]], 2, Up_93752), 
LPer87790 = permute_layer(Up_93752, 2,1, Per87790), 
LRes11977 = reshape_layer(Per87790, [3, 8, 1], Res11977), 
LRes32899 = reshape_layer(Res11977, [3, 8, 1, 1], Res32899), 
LGlo74704 = global_average_pooling3D_layer(Res32899, Glo74704), 
LCon64289 = concatenate_layer([Glo74704,[[0.5919]]], 1, Con64289), 
LSub33723 = subtract_layer(Fla58965,Con64289, Sub33723), 
LRes22204 = reshape_layer(Sub33723, [2, 1], Res22204), 
LRes41261 = reshape_layer(Res22204, [2, 1, 1], Res41261), 
LSep20541 = separable_conv2D_layer(Res41261, 2, 1,[[[[[0.7582]]], [[[0.5252]]]],[[[[0.0814, 0.8655]]]]],[0, 0], 2, 2, true, Sep20541), 
LAve70448 = average_pooling2D_layer(Sep20541, 1, 1, Ave70448), 
exec_layers([LAdd27865,LRes47744,LFla58965,LUp_93752,LPer87790,LRes11977,LRes32899,LGlo74704,LCon64289,LSub33723,LRes22204,LRes41261,LSep20541,LAve70448],["Add27865","Res47744","Fla58965","Up_93752","Per87790","Res11977","Res32899","Glo74704","Con64289","Sub33723","Res22204","Res41261","Sep20541","Ave70448"],Ave70448,"Ave70448")

Actual (Unparsed): [[[[-0.0464885, -0.4942969]]]]

Expected (Unparsed): [[[[-0.04648846768866666,-0.49429691381499996]]]]

Actual:   [[[[-0.0464, -0.4942]]]]

Expected: [[[[-0.0464, -0.4942]]]]