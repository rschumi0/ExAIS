import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max64844 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Max64844 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con7689 = tf.keras.layers.Input(shape=([2, 2, 3]))
in0Min68171 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Min68171 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Dot27508 = tf.keras.layers.Input(shape=([3]))
in1Dot27508 = tf.keras.layers.Input(shape=([3]))
in0Con34538 = tf.keras.layers.Input(shape=([15]))

Max64844 = keras.layers.Maximum(name = 'Max64844', )([in0Max64844,in1Max64844])
Zer66405 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer66405', )(Max64844)
Con7689 = keras.layers.Concatenate(axis=3, name = 'Con7689', )([Zer66405,in0Con7689])
Min68171 = keras.layers.Minimum(name = 'Min68171', )([in0Min68171,in1Min68171])
Loc7756 = keras.layers.LocallyConnected2D(4, (1, 1),strides=(1, 1), name = 'Loc7756', )(Min68171)
Add70328 = keras.layers.Add(name = 'Add70328', )([Con7689,Loc7756])
Res61815 = keras.layers.Reshape((2, 8), name = 'Res61815', )(Add70328)
Fla40256 = keras.layers.Flatten(name = 'Fla40256', )(Res61815)
Dot27508 = keras.layers.Dot(axes=(1, 1), name = 'Dot27508', )([in0Dot27508,in1Dot27508])
Con34538 = keras.layers.Concatenate(axis=1, name = 'Con34538', )([Dot27508,in0Con34538])
Min33848 = keras.layers.Minimum(name = 'Min33848', )([Fla40256,Con34538])
model = tf.keras.models.Model(inputs=[in0Max64844,in1Max64844,in0Con7689,in0Min68171,in1Min68171,in0Dot27508,in1Dot27508,in0Con34538], outputs=Min33848)
w = model.get_layer('Loc7756').get_weights() 
w[0] = np.array([[[0.754, 0.2914, 0.2407, 0.4146]], [[0.4852, 0.5433, 0.7213, 0.9497]], [[0.112, 0.357, 0.559, 0.0568]], [[0.8579, 0.3899, 0.4956, 0.8446]]])
w[1] = np.array([[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]]])
model.get_layer('Loc7756').set_weights(w) 
in0Max64844 = tf.constant([[[[0.5805]]]])
in1Max64844 = tf.constant([[[[0.0888]]]])
in0Con7689 = tf.constant([[[[0.9554, 0.2399, 0.1908], [0.0327, 0.9641, 0.6263]], [[0.8996, 0.7326, 0.2341], [0.2207, 0.6729, 0.3991]]]])
in0Min68171 = tf.constant([[[[0.1104], [0.0368]], [[0.4958], [0.1999]]]])
in1Min68171 = tf.constant([[[[0.0337], [0.7947]], [[0.5492], [0.402]]]])
in0Dot27508 = tf.constant([[0.5488, 0.5754, 0.6453]])
in1Dot27508 = tf.constant([[0.6942, 0.2658, 0.5978]])
in0Con34538 = tf.constant([[0.1756, 0.0328, 0.5318, 0.43, 0.4561, 0.5888, 0.223, 0.9398, 0.5173, 0.7207, 0.2398, 0.8941, 0.3056, 0.1302, 0.9694]])
print (np.array2string(model.predict([in0Max64844,in1Max64844,in0Con7689,in0Min68171,in1Min68171,in0Dot27508,in1Dot27508,in0Con34538],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min33848.png')

LMax64844 = maximum_layer([[[[[0.5805]]]], [[[[0.0888]]]]], Max64844), 
LZer66405 = zero_padding2D_layer(Max64844, 1, 0, 1, 0, Zer66405), 
LCon7689 = concatenate_layer([Zer66405,[[[[0.9554, 0.2399, 0.1908], [0.0327, 0.9641, 0.6263]], [[0.8996, 0.7326, 0.2341], [0.2207, 0.6729, 0.3991]]]]], 3, Con7689), 
LMin68171 = minimum_layer([[[[[0.1104], [0.0368]], [[0.4958], [0.1999]]]], [[[[0.0337], [0.7947]], [[0.5492], [0.402]]]]], Min68171), 
LLoc7756 = locally_connected2D_layer(Min68171, 1, 1,[[[0.754, 0.2914, 0.2407, 0.4146]], [[0.4852, 0.5433, 0.7213, 0.9497]], [[0.112, 0.357, 0.559, 0.0568]], [[0.8579, 0.3899, 0.4956, 0.8446]]],[[[0, 0, 0, 0], [0, 0, 0, 0]], [[0, 0, 0, 0], [0, 0, 0, 0]]], 1, 1, Loc7756), 
LAdd70328 = add_layer([Con7689,Loc7756], Add70328), 
LRes61815 = reshape_layer(Add70328, [2, 8], Res61815), 
LFla40256 = flatten_layer(Res61815, Fla40256), 
LDot27508 = dot_layer([[0.5488, 0.5754, 0.6453]], [[0.6942, 0.2658, 0.5978]], 1, 1, Dot27508), 
LCon34538 = concatenate_layer([Dot27508,[[0.1756, 0.0328, 0.5318, 0.43, 0.4561, 0.5888, 0.223, 0.9398, 0.5173, 0.7207, 0.2398, 0.8941, 0.3056, 0.1302, 0.9694]]], 1, Con34538), 
LMin33848 = minimum_layer([Fla40256,Con34538], Min33848), 
exec_layers([LMax64844,LZer66405,LCon7689,LMin68171,LLoc7756,LAdd70328,LRes61815,LFla40256,LDot27508,LCon34538,LMin33848],["Max64844","Zer66405","Con7689","Min68171","Loc7756","Add70328","Res61815","Fla40256","Dot27508","Con34538","Min33848"],Min33848,"Min33848")

Actual (Unparsed): [[0.0254098, 0.1756000, 0.0328000, 0.2047720, 0.0178554, 0.0526934, 0.5888000, 0.2230000, 0.0555296, 0.5173000, 0.7207000, 0.2398000, 0.7519942, 0.2986410, 0.1302000, 0.5679355]]

Expected (Unparsed): [[0.0254098,0.1756,0.0328,0.20477202,0.01785536,0.05269344,0.5888,0.223,0.055529600000000005,0.5173,0.7207,0.2398,0.75199421,0.29864101,0.1302,0.56793554]]

Actual:   [[0.0255, 0.1756, 0.0328, 0.2048, 0.0179, 0.0527, 0.5888, 0.223, 0.0556, 0.5173, 0.7207, 0.2398, 0.752, 0.2987, 0.1302, 0.568]]

Expected: [[0.0255, 0.1756, 0.0328, 0.2048, 0.0179, 0.0527, 0.5888, 0.223, 0.0556, 0.5173, 0.7207, 0.2398, 0.752, 0.2987, 0.1302, 0.568]]