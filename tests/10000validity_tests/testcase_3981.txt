import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Bat26641 = tf.keras.layers.Input(shape=([3, 3, 1]))

Bat26641 = keras.layers.BatchNormalization(axis=1, epsilon=0.2709775200951063,  name = 'Bat26641', )(in0Bat26641)
Res69932 = keras.layers.Reshape((3, 3, 1, 1), name = 'Res69932', )(Bat26641)
Con63473 = keras.layers.Conv3D(3, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con63473', )(Res69932)
Res97044 = keras.layers.Reshape((3, 3, 3), name = 'Res97044', )(Con63473)
Glo15550 = keras.layers.GlobalMaxPool2D(name = 'Glo15550', )(Res97044)
Res15810 = keras.layers.Reshape((3, 1), name = 'Res15810', )(Glo15550)
Res43885 = keras.layers.Reshape((3, 1, 1), name = 'Res43885', )(Res15810)
Res30385 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res30385', )(Res43885)
Glo17353 = keras.layers.GlobalMaxPool3D(name = 'Glo17353', )(Res30385)
model = tf.keras.models.Model(inputs=[in0Bat26641], outputs=Glo17353)
w = model.get_layer('Bat26641').get_weights() 
w[0] = np.array([0.8853, 0.4377, 0.9477])
w[1] = np.array([0.9009, 0.1443, 0.8828])
w[2] = np.array([0.3653, 0.236, 0.3523])
w[3] = np.array([0.9167, 0.3147, 0.1991])
model.get_layer('Bat26641').set_weights(w) 
w = model.get_layer('Con63473').get_weights() 
w[0] = np.array([[[[[0.0623, 0.334, 0.4269]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con63473').set_weights(w) 
in0Bat26641 = tf.constant([[[[1.1567], [1.6589], [1.6738]], [[1.532], [1.9382], [1.9274]], [[1.6842], [1.2367], [1.7497]]]])
print (np.array2string(model.predict([in0Bat26641],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Glo17353.png')

LBat26641 = batch_normalization_layer([[[[1.1567], [1.6589], [1.6738]], [[1.532], [1.9382], [1.9274]], [[1.6842], [1.2367], [1.7497]]]], 1, 0.2709775200951063, [0.8853, 0.4377, 0.9477], [0.9009, 0.1443, 0.8828], [0.3653, 0.236, 0.3523], [0.9167, 0.3147, 0.1991], Bat26641), 
LRes69932 = reshape_layer(Bat26641, [3, 3, 1, 1], Res69932), 
LCon63473 = conv3D_layer(Res69932, 1, 1, 1,[[[[[0.0623, 0.334, 0.4269]]]]],[0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con63473), 
LRes97044 = reshape_layer(Con63473, [3, 3, 3], Res97044), 
LGlo15550 = global_max_pool2D_layer(Res97044, Glo15550), 
LRes15810 = reshape_layer(Glo15550, [3, 1], Res15810), 
LRes43885 = reshape_layer(Res15810, [3, 1, 1], Res43885), 
LRes30385 = reshape_layer(Res43885, [3, 1, 1, 1], Res30385), 
LGlo17353 = global_max_pool3D_layer(Res30385, Glo17353), 
exec_layers([LBat26641,LRes69932,LCon63473,LRes97044,LGlo15550,LRes15810,LRes43885,LRes30385,LGlo17353],["Bat26641","Res69932","Con63473","Res97044","Glo15550","Res15810","Res43885","Res30385","Glo17353"],Glo17353,"Glo17353")

Actual (Unparsed): [[1.2014477]]

Expected (Unparsed): [[1.2014477680375724]]

Actual:   [[1.2015]]

Expected: [[1.2015]]