import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot35010 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot35010 = tf.keras.layers.Input(shape=([3, 3]))
in0Con66197 = tf.keras.layers.Input(shape=([4, 1]))
in0Con55179 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Mul2429 = tf.keras.layers.Input(shape=([1, 1]))
in1Mul2429 = tf.keras.layers.Input(shape=([1, 1]))
in0Con14923 = tf.keras.layers.Input(shape=([4, 3]))
in0Min82431 = tf.keras.layers.Input(shape=([2, 2]))
in1Min82431 = tf.keras.layers.Input(shape=([2, 2]))
in0Con5761 = tf.keras.layers.Input(shape=([4, 2]))
in0Max1192 = tf.keras.layers.Input(shape=([2, 2]))
in1Max1192 = tf.keras.layers.Input(shape=([2, 2]))
in0Con61160 = tf.keras.layers.Input(shape=([4, 2]))

Dot35010 = keras.layers.Dot(axes=(2, 2), name = 'Dot35010', )([in0Dot35010,in1Dot35010])
Zer49173 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer49173', )(Dot35010)
Con66197 = keras.layers.Concatenate(axis=2, name = 'Con66197', )([Zer49173,in0Con66197])
Con55179 = keras.layers.Conv2DTranspose(2, (1, 1),strides=(2, 1), padding='valid', name = 'Con55179', )(in0Con55179)
Thr56345 = keras.layers.ThresholdedReLU(theta=5.070624086927646, name = 'Thr56345', )(Con55179)
Res23774 = keras.layers.Reshape((4, 4), name = 'Res23774', )(Thr56345)
Mul2429 = keras.layers.Multiply(name = 'Mul2429', )([in0Mul2429,in1Mul2429])
Zer56987 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer56987', )(Mul2429)
Con14923 = keras.layers.Concatenate(axis=2, name = 'Con14923', )([Zer56987,in0Con14923])
Max15904 = keras.layers.Maximum(name = 'Max15904', )([Res23774,Con14923])
Min82431 = keras.layers.Minimum(name = 'Min82431', )([in0Min82431,in1Min82431])
Zer59902 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer59902', )(Min82431)
Con5761 = keras.layers.Concatenate(axis=2, name = 'Con5761', )([Zer59902,in0Con5761])
Max41231 = keras.layers.Maximum(name = 'Max41231', )([Max15904,Con5761])
Max1192 = keras.layers.Maximum(name = 'Max1192', )([in0Max1192,in1Max1192])
Zer71522 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer71522', )(Max1192)
Con61160 = keras.layers.Concatenate(axis=2, name = 'Con61160', )([Zer71522,in0Con61160])
Sub51685 = keras.layers.Subtract(name = 'Sub51685', )([Max41231,Con61160])
Min34846 = keras.layers.Minimum(name = 'Min34846', )([Con66197,Sub51685])
model = tf.keras.models.Model(inputs=[in0Dot35010,in1Dot35010,in0Con66197,in0Con55179,in0Mul2429,in1Mul2429,in0Con14923,in0Min82431,in1Min82431,in0Con5761,in0Max1192,in1Max1192,in0Con61160], outputs=Min34846)
w = model.get_layer('Con55179').get_weights() 
w[0] = np.array([[[[0.1199], [0.9514]]]])
w[1] = np.array([0, 0])
model.get_layer('Con55179').set_weights(w) 
in0Dot35010 = tf.constant([[[0.3822, 0.0006, 0.0217], [0.7645, 0.6391, 0.3038], [0.933, 0.4437, 0.6967]]])
in1Dot35010 = tf.constant([[[0.3371, 0.8496, 0.3605], [0.2455, 0.6084, 0.0579], [0.7686, 0.9735, 0.8565]]])
in0Con66197 = tf.constant([[[0.8165], [0.3232], [0.3764], [0.7647]]])
in0Con55179 = tf.constant([[[[0.0172], [0.8792]], [[0.1248], [0.5517]]]])
in0Mul2429 = tf.constant([[[0.2191]]])
in1Mul2429 = tf.constant([[[0.0263]]])
in0Con14923 = tf.constant([[[0.1654, 0.1612, 0.5873], [0.7568, 0.4276, 0.9627], [0.3081, 0.5632, 0.0028], [0.9118, 0.4793, 0.2376]]])
in0Min82431 = tf.constant([[[0.6012, 0.5697], [0.634, 0.8353]]])
in1Min82431 = tf.constant([[[0.549, 0.9677], [0.4917, 0.1156]]])
in0Con5761 = tf.constant([[[0.3718, 0.9798], [0.391, 0.4636], [0.1136, 0.6939], [0.1405, 0.9092]]])
in0Max1192 = tf.constant([[[0.7402, 0.9487], [0.1508, 0.6249]]])
in1Max1192 = tf.constant([[[0.9571, 0.0391], [0.853, 0.553]]])
in0Con61160 = tf.constant([[[0.7072, 0.0975], [0.5923, 0.2161], [0.6979, 0.2979], [0.1452, 0.3343]]])
print (np.array2string(model.predict([in0Dot35010,in1Dot35010,in0Con66197,in0Con55179,in0Mul2429,in1Mul2429,in0Con14923,in0Min82431,in1Min82431,in0Con5761,in0Max1192,in1Max1192,in0Con61160],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min34846.png')

LDot35010 = dot_layer([[[0.3822, 0.0006, 0.0217], [0.7645, 0.6391, 0.3038], [0.933, 0.4437, 0.6967]]], [[[0.3371, 0.8496, 0.3605], [0.2455, 0.6084, 0.0579], [0.7686, 0.9735, 0.8565]]], 2, 2, Dot35010), 
LZer49173 = zero_padding1D_layer(Dot35010, 1, 0, Zer49173), 
LCon66197 = concatenate_layer([Zer49173,[[[0.8165], [0.3232], [0.3764], [0.7647]]]], 2, Con66197), 
LCon55179 = conv2D_transpose_layer([[[[0.0172], [0.8792]], [[0.1248], [0.5517]]]], 1, 1,[[[[0.1199], [0.9514]]]],[0, 0], 2, 1, false, Con55179), 
LThr56345 = thresholded_relu_layer(Con55179, 5.070624086927646, Thr56345), 
LRes23774 = reshape_layer(Thr56345, [4, 4], Res23774), 
LMul2429 = multiply_layer([[[[0.2191]]], [[[0.0263]]]], Mul2429), 
LZer56987 = zero_padding1D_layer(Mul2429, 3, 0, Zer56987), 
LCon14923 = concatenate_layer([Zer56987,[[[0.1654, 0.1612, 0.5873], [0.7568, 0.4276, 0.9627], [0.3081, 0.5632, 0.0028], [0.9118, 0.4793, 0.2376]]]], 2, Con14923), 
LMax15904 = maximum_layer([Res23774,Con14923], Max15904), 
LMin82431 = minimum_layer([[[[0.6012, 0.5697], [0.634, 0.8353]]], [[[0.549, 0.9677], [0.4917, 0.1156]]]], Min82431), 
LZer59902 = zero_padding1D_layer(Min82431, 2, 0, Zer59902), 
LCon5761 = concatenate_layer([Zer59902,[[[0.3718, 0.9798], [0.391, 0.4636], [0.1136, 0.6939], [0.1405, 0.9092]]]], 2, Con5761), 
LMax41231 = maximum_layer([Max15904,Con5761], Max41231), 
LMax1192 = maximum_layer([[[[0.7402, 0.9487], [0.1508, 0.6249]]], [[[0.9571, 0.0391], [0.853, 0.553]]]], Max1192), 
LZer71522 = zero_padding1D_layer(Max1192, 2, 0, Zer71522), 
LCon61160 = concatenate_layer([Zer71522,[[[0.7072, 0.0975], [0.5923, 0.2161], [0.6979, 0.2979], [0.1452, 0.3343]]]], 2, Con61160), 
LSub51685 = subtract_layer(Max41231,Con61160, Sub51685), 
LMin34846 = minimum_layer([Con66197,Sub51685], Min34846), 
exec_layers([LDot35010,LZer49173,LCon66197,LCon55179,LThr56345,LRes23774,LMul2429,LZer56987,LCon14923,LMax15904,LMin82431,LZer59902,LCon5761,LMax41231,LMax1192,LZer71522,LCon61160,LSub51685,LMin34846],["Dot35010","Zer49173","Con66197","Con55179","Thr56345","Res23774","Mul2429","Zer56987","Con14923","Max15904","Min82431","Zer59902","Con5761","Max41231","Max1192","Zer71522","Con61160","Sub51685","Min34846"],Min34846,"Min34846")

Actual (Unparsed): [[[0.0000000, 0.0000000, -0.3354000, 0.8165000], [0.0000000, 0.0954516, -0.1647000, 0.3232000], [-0.4080999, -0.3790000, -0.1347000, 0.3764000], [-0.3613000, 0.2869000, 0.3341000, 0.5749000]]]

Expected (Unparsed): [[[0,0,-0.33540000000000003,0.8165],[0,0.09545157,-0.16470000000000007,0.3232],[-0.4080999999999999,-0.379,-0.13469999999999993,0.3764],[-0.36129999999999995,0.28690000000000004,0.3341,0.5749]]]

Actual:   [[[0, 0, -0.3354, 0.8165], [0, 0.0955, -0.1647, 0.3232], [-0.408, -0.379, -0.1347, 0.3764], [-0.3613, 0.2869, 0.3341, 0.5749]]]

Expected: [[[0, 0, -0.3354, 0.8165], [0, 0.0955, -0.1647, 0.3232], [-0.408, -0.379, -0.1346, 0.3764], [-0.3612, 0.287, 0.3341, 0.5749]]]