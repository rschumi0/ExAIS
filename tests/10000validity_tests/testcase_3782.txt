import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max77702 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Max77702 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con57164 = tf.keras.layers.Input(shape=([1, 1]))
in0Glo36030 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Dot66039 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot66039 = tf.keras.layers.Input(shape=([3, 3]))
in0Cro81781 = tf.keras.layers.Input(shape=([4, 3, 2, 3]))
in0Con89275 = tf.keras.layers.Input(shape=([6]))
in0Fla55188 = tf.keras.layers.Input(shape=([3, 4]))
in0Con46338 = tf.keras.layers.Input(shape=([8, 1]))

Max77702 = keras.layers.Maximum(name = 'Max77702', )([in0Max77702,in1Max77702])
Res43727 = keras.layers.Reshape((1, 4), name = 'Res43727', )(Max77702)
Con57164 = keras.layers.Concatenate(axis=2, name = 'Con57164', )([Res43727,in0Con57164])
Glo36030 = keras.layers.GlobalAveragePooling2D(name = 'Glo36030', )(in0Glo36030)
Lay59693 = keras.layers.LayerNormalization(axis=1, epsilon=1.884717683024244, name = 'Lay59693', )(Glo36030)
Res84128 = keras.layers.Reshape((1, 1), name = 'Res84128', )(Lay59693)
Zer87029 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer87029', )(Res84128)
Dot66039 = keras.layers.Dot(axes=(1, 2), name = 'Dot66039', )([in0Dot66039,in1Dot66039])
Dot23677 = keras.layers.Dot(axes=(1, 1), name = 'Dot23677', )([Zer87029,Dot66039])
Lay29781 = keras.layers.LayerNormalization(axis=1, epsilon=2.1855696852792486, name = 'Lay29781', )(Dot23677)
Dot94798 = keras.layers.Dot(axes=(1, 1), name = 'Dot94798', )([Con57164,Lay29781])
Zer48635 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer48635', )(Dot94798)
Cro81781 = keras.layers.Cropping3D(cropping=((1, 1), (2, 0), (0, 1)), name = 'Cro81781', )(in0Cro81781)
Res47292 = keras.layers.Reshape((2, 1, 3), name = 'Res47292', )(Cro81781)
Res23789 = keras.layers.Reshape((2, 3), name = 'Res23789', )(Res47292)
Fla66948 = keras.layers.Flatten(name = 'Fla66948', )(Res23789)
Con89275 = keras.layers.Concatenate(axis=1, name = 'Con89275', )([Fla66948,in0Con89275])
Fla55188 = keras.layers.Flatten(name = 'Fla55188', )(in0Fla55188)
Ave72574 = keras.layers.Average(name = 'Ave72574', )([Con89275,Fla55188])
Res80870 = keras.layers.Reshape((12, 1), name = 'Res80870', )(Ave72574)
Loc67771 = keras.layers.LocallyConnected1D(2, (5),strides=(1), name = 'Loc67771', )(Res80870)
Con46338 = keras.layers.Concatenate(axis=2, name = 'Con46338', )([Loc67771,in0Con46338])
Ave93514 = keras.layers.Average(name = 'Ave93514', )([Zer48635,Con46338])
model = tf.keras.models.Model(inputs=[in0Max77702,in1Max77702,in0Con57164,in0Glo36030,in0Dot66039,in1Dot66039,in0Cro81781,in0Con89275,in0Fla55188,in0Con46338], outputs=Ave93514)
w = model.get_layer('Loc67771').get_weights() 
w[0] = np.array([[[0.4578, 0.4156], [0.5056, 0.5993], [0.2656, 0.292], [0.598, 0.1682], [0.2433, 0.716]], [[0.6377, 0.9314], [0.2661, 0.5706], [0.5902, 0.1205], [0.9528, 0.2915], [0.5794, 0.5802]], [[0.6586, 0.2899], [0.239, 0.9661], [0.4048, 0.0273], [0.4356, 0.1117], [0.7466, 0.3757]], [[0.6962, 0.3671], [0.4421, 0.7375], [0.0521, 0.6868], [0.9259, 0.7659], [0.1656, 0.2526]], [[0.0124, 0.4251], [0.5461, 0.4589], [0.9621, 0.5623], [0.3803, 0.1582], [0.0244, 0.1229]], [[0.0046, 0.1678], [0.841, 0.6372], [0.3271, 0.1703], [0.6399, 0.6269], [0.5725, 0.3101]], [[0.9791, 0.1379], [0.5662, 0.9787], [0.9111, 0.6937], [0.4022, 0.5139], [0.8283, 0.5788]], [[0.7426, 0.7934], [0.9246, 0.5139], [0.1897, 0.9967], [0.161, 0.4638], [0.1382, 0.1265]]])
w[1] = np.array([[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]])
model.get_layer('Loc67771').set_weights(w) 
in0Max77702 = tf.constant([[[[0.5588, 0.6778], [0.4829, 0.8094]]]])
in1Max77702 = tf.constant([[[[0.4284, 0.4435], [0.6689, 0.8441]]]])
in0Con57164 = tf.constant([[[0.3804]]])
in0Glo36030 = tf.constant([[[[1.0935], [1.5809]], [[1.8438], [1.2686]]]])
in0Dot66039 = tf.constant([[[0.163, 0.8871, 0.4936], [0.6367, 0.0764, 0.2855], [0.205, 0.1031, 0.9927]]])
in1Dot66039 = tf.constant([[[0.4669, 0.9172, 0.2043], [0.4129, 0.4404, 0.5739], [0.822, 0.2808, 0.256]]])
in0Cro81781 = tf.constant([[[[[1.2448, 1.9365, 1.0246], [1.2361, 1.769, 1.742]], [[1.5029, 1.1531, 1.2414], [1.1851, 1.1033, 1.9248]], [[1.2096, 1.0169, 1.3012], [1.5656, 1.2777, 1.0001]]], [[[1.8347, 1.3248, 1.9264], [1.0035, 1.2766, 1.1739]], [[1.7455, 1.3304, 1.1894], [1.0627, 1.9534, 1.7812]], [[1.2413, 1.6524, 1.0278], [1.6277, 1.6288, 1.5574]]], [[[1.51, 1.8898, 1.9025], [1.4795, 1.5593, 1.0484]], [[1.8246, 1.9998, 1.6353], [1.6038, 1.2033, 1.2132]], [[1.7611, 1.6915, 1.7378], [1.8315, 1.1833, 1.3085]]], [[[1.7907, 1.8623, 1.8864], [1.5669, 1.6562, 1.4781]], [[1.3395, 1.7949, 1.3338], [1.2311, 1.0612, 1.2333]], [[1.0373, 1.3386, 1.0697], [1.5389, 1.6663, 1.3685]]]]])
in0Con89275 = tf.constant([[0.6741, 0.3317, 0.0212, 0.3065, 0.7902, 0.933]])
in0Fla55188 = tf.constant([[[1.0556, 1.2984, 1.2553, 1.2873], [1.16, 1.2825, 1.974, 1.4977], [1.5706, 1.2224, 1.5986, 1.1899]]])
in0Con46338 = tf.constant([[[0.9086], [0.2627], [0.8558], [0.3973], [0.8844], [0.2798], [0.6111], [0.0521]]])
print (np.array2string(model.predict([in0Max77702,in1Max77702,in0Con57164,in0Glo36030,in0Dot66039,in1Dot66039,in0Cro81781,in0Con89275,in0Fla55188,in0Con46338],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave93514.png')

LMax77702 = maximum_layer([[[[[0.5588, 0.6778], [0.4829, 0.8094]]]], [[[[0.4284, 0.4435], [0.6689, 0.8441]]]]], Max77702), 
LRes43727 = reshape_layer(Max77702, [1, 4], Res43727), 
LCon57164 = concatenate_layer([Res43727,[[[0.3804]]]], 2, Con57164), 
LGlo36030 = global_average_pooling2D_layer([[[[1.0935], [1.5809]], [[1.8438], [1.2686]]]], Glo36030), 
LLay59693 = layer_normalization_layer(Glo36030, 1, 1.884717683024244, Lay59693), 
LRes84128 = reshape_layer(Lay59693, [1, 1], Res84128), 
LZer87029 = zero_padding1D_layer(Res84128, 2, 0, Zer87029), 
LDot66039 = dot_layer([[[0.163, 0.8871, 0.4936], [0.6367, 0.0764, 0.2855], [0.205, 0.1031, 0.9927]]], [[[0.4669, 0.9172, 0.2043], [0.4129, 0.4404, 0.5739], [0.822, 0.2808, 0.256]]], 1, 2, Dot66039), 
LDot23677 = dot_layer(Zer87029,Dot66039, 1, 1, Dot23677), 
LLay29781 = layer_normalization_layer(Dot23677, 1, 2.1855696852792486, Lay29781), 
LDot94798 = dot_layer(Con57164,Lay29781, 1, 1, Dot94798), 
LZer48635 = zero_padding1D_layer(Dot94798, 3, 0, Zer48635), 
LCro81781 = cropping3D_layer([[[[[1.2448, 1.9365, 1.0246], [1.2361, 1.769, 1.742]], [[1.5029, 1.1531, 1.2414], [1.1851, 1.1033, 1.9248]], [[1.2096, 1.0169, 1.3012], [1.5656, 1.2777, 1.0001]]], [[[1.8347, 1.3248, 1.9264], [1.0035, 1.2766, 1.1739]], [[1.7455, 1.3304, 1.1894], [1.0627, 1.9534, 1.7812]], [[1.2413, 1.6524, 1.0278], [1.6277, 1.6288, 1.5574]]], [[[1.51, 1.8898, 1.9025], [1.4795, 1.5593, 1.0484]], [[1.8246, 1.9998, 1.6353], [1.6038, 1.2033, 1.2132]], [[1.7611, 1.6915, 1.7378], [1.8315, 1.1833, 1.3085]]], [[[1.7907, 1.8623, 1.8864], [1.5669, 1.6562, 1.4781]], [[1.3395, 1.7949, 1.3338], [1.2311, 1.0612, 1.2333]], [[1.0373, 1.3386, 1.0697], [1.5389, 1.6663, 1.3685]]]]], 1, 1, 2, 0, 0, 1, Cro81781), 
LRes47292 = reshape_layer(Cro81781, [2, 1, 3], Res47292), 
LRes23789 = reshape_layer(Res47292, [2, 3], Res23789), 
LFla66948 = flatten_layer(Res23789, Fla66948), 
LCon89275 = concatenate_layer([Fla66948,[[0.6741, 0.3317, 0.0212, 0.3065, 0.7902, 0.933]]], 1, Con89275), 
LFla55188 = flatten_layer([[[1.0556, 1.2984, 1.2553, 1.2873], [1.16, 1.2825, 1.974, 1.4977], [1.5706, 1.2224, 1.5986, 1.1899]]], Fla55188), 
LAve72574 = average_layer([Con89275,Fla55188], Ave72574), 
LRes80870 = reshape_layer(Ave72574, [12, 1], Res80870), 
LLoc67771 = locally_connected1D_layer(Res80870, 5,[[[0.4578, 0.4156], [0.5056, 0.5993], [0.2656, 0.292], [0.598, 0.1682], [0.2433, 0.716]], [[0.6377, 0.9314], [0.2661, 0.5706], [0.5902, 0.1205], [0.9528, 0.2915], [0.5794, 0.5802]], [[0.6586, 0.2899], [0.239, 0.9661], [0.4048, 0.0273], [0.4356, 0.1117], [0.7466, 0.3757]], [[0.6962, 0.3671], [0.4421, 0.7375], [0.0521, 0.6868], [0.9259, 0.7659], [0.1656, 0.2526]], [[0.0124, 0.4251], [0.5461, 0.4589], [0.9621, 0.5623], [0.3803, 0.1582], [0.0244, 0.1229]], [[0.0046, 0.1678], [0.841, 0.6372], [0.3271, 0.1703], [0.6399, 0.6269], [0.5725, 0.3101]], [[0.9791, 0.1379], [0.5662, 0.9787], [0.9111, 0.6937], [0.4022, 0.5139], [0.8283, 0.5788]], [[0.7426, 0.7934], [0.9246, 0.5139], [0.1897, 0.9967], [0.161, 0.4638], [0.1382, 0.1265]]],[[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], 1, Loc67771), 
LCon46338 = concatenate_layer([Loc67771,[[[0.9086], [0.2627], [0.8558], [0.3973], [0.8844], [0.2798], [0.6111], [0.0521]]]], 2, Con46338), 
LAve93514 = average_layer([Zer48635,Con46338], Ave93514), 
exec_layers([LMax77702,LRes43727,LCon57164,LGlo36030,LLay59693,LRes84128,LZer87029,LDot66039,LDot23677,LLay29781,LDot94798,LZer48635,LCro81781,LRes47292,LRes23789,LFla66948,LCon89275,LFla55188,LAve72574,LRes80870,LLoc67771,LCon46338,LAve93514],["Max77702","Res43727","Con57164","Glo36030","Lay59693","Res84128","Zer87029","Dot66039","Dot23677","Lay29781","Dot94798","Zer48635","Cro81781","Res47292","Res23789","Fla66948","Con89275","Fla55188","Ave72574","Res80870","Loc67771","Con46338","Ave93514"],Ave93514,"Ave93514")

Actual (Unparsed): [[[1.4166375, 1.4860215, 0.4543000], [2.1888237, 1.7505086, 0.1313500], [1.6698046, 1.2542586, 0.4279000], [1.5737816, 1.9466693, 0.1986500], [1.2417605, 1.1430646, 0.4422000], [1.1833076, 0.9944334, 0.1399000], [1.9181041, 1.3570444, 0.3055500], [0.9495762, 1.2924497, 0.0260500]]]

Expected (Unparsed): [[[1.4166374525,1.4860215399999999,0.4543],[2.1888236924999998,1.7505086225,0.13135],[1.6698046500000001,1.25425864,0.4279],[1.5737815725,1.9466692899999998,0.19865],[1.2417605449999998,1.1430645625,0.4422],[1.1833075725,0.9944334475000001,0.1399],[1.9181041475,1.357044395,0.30555],[0.9495761575,1.292449725,0.02605]]]

Actual:   [[[1.4167, 1.4861, 0.4543], [2.1889, 1.7506, 0.1314], [1.6699, 1.2543, 0.4279], [1.5738, 1.9467, 0.1987], [1.2418, 1.1431, 0.4422], [1.1834, 0.9945, 0.1399], [1.9182, 1.3571, 0.3056], [0.9496, 1.2925, 0.0261]]]

Expected: [[[1.4167, 1.4861, 0.4543], [2.1889, 1.7506, 0.1314], [1.6699, 1.2543, 0.4279], [1.5738, 1.9467, 0.1987], [1.2418, 1.1431, 0.4422], [1.1834, 0.9945, 0.1399], [1.9182, 1.3571, 0.3056], [0.9496, 1.2925, 0.0261]]]