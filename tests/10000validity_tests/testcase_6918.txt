import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Bat15630 = tf.keras.layers.Input(shape=([2]))
in0Con67373 = tf.keras.layers.Input(shape=([2, 1]))
in0Mul74480 = tf.keras.layers.Input(shape=([1, 2]))
in1Mul74480 = tf.keras.layers.Input(shape=([1, 2]))
in0Con17721 = tf.keras.layers.Input(shape=([2, 1]))
in0Max72538 = tf.keras.layers.Input(shape=([2, 2]))
in1Max72538 = tf.keras.layers.Input(shape=([2, 2]))

Bat15630 = keras.layers.BatchNormalization(axis=1, epsilon=0.8344294717338703,  name = 'Bat15630', )(in0Bat15630)
Res45936 = keras.layers.Reshape((2, 1), name = 'Res45936', )(Bat15630)
Con67373 = keras.layers.Concatenate(axis=2, name = 'Con67373', )([Res45936,in0Con67373])
Mul74480 = keras.layers.Multiply(name = 'Mul74480', )([in0Mul74480,in1Mul74480])
Bat7368 = keras.layers.BatchNormalization(axis=2, epsilon=0.25167644797584376,  name = 'Bat7368', )(Mul74480)
Dot33603 = keras.layers.Dot(axes=(1, 2), name = 'Dot33603', )([Con67373,Bat7368])
Con17721 = keras.layers.Concatenate(axis=2, name = 'Con17721', )([Dot33603,in0Con17721])
Max72538 = keras.layers.Maximum(name = 'Max72538', )([in0Max72538,in1Max72538])
Mul2528 = keras.layers.Multiply(name = 'Mul2528', )([Con17721,Max72538])
Glo6420 = keras.layers.GlobalMaxPool1D(name = 'Glo6420', )(Mul2528)
Res11775 = keras.layers.Reshape((2, 1), name = 'Res11775', )(Glo6420)
Res98511 = keras.layers.Reshape((2, 1, 1), name = 'Res98511', )(Res11775)
Con96789 = keras.layers.Conv2DTranspose(3, (1, 1),strides=(1, 1), padding='valid', name = 'Con96789', )(Res98511)
model = tf.keras.models.Model(inputs=[in0Bat15630,in0Con67373,in0Mul74480,in1Mul74480,in0Con17721,in0Max72538,in1Max72538], outputs=Con96789)
w = model.get_layer('Bat15630').get_weights() 
w[0] = np.array([0.2244, 0.4286])
w[1] = np.array([0.876, 0.4307])
w[2] = np.array([0.3927, 0.0763])
w[3] = np.array([0.2484, 0.3047])
model.get_layer('Bat15630').set_weights(w) 
w = model.get_layer('Bat7368').get_weights() 
w[0] = np.array([0.6815, 0.9985])
w[1] = np.array([0.6061, 0.8482])
w[2] = np.array([0.3142, 0.1409])
w[3] = np.array([0.9903, 0.0602])
model.get_layer('Bat7368').set_weights(w) 
w = model.get_layer('Con96789').get_weights() 
w[0] = np.array([[[[0.3296], [0.2378], [0.4669]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con96789').set_weights(w) 
in0Bat15630 = tf.constant([[1.1248, 1.7986]])
in0Con67373 = tf.constant([[[0.2933], [0.5616]]])
in0Mul74480 = tf.constant([[[0.3922, 0.4046]]])
in1Mul74480 = tf.constant([[[0.1752, 0.2545]]])
in0Con17721 = tf.constant([[[0.6184], [0.6432]]])
in0Max72538 = tf.constant([[[0.5442, 0.5759], [0.7477, 0.7574]]])
in1Max72538 = tf.constant([[[0.8149, 0.4218], [0.2188, 0.3891]]])
print (np.array2string(model.predict([in0Bat15630,in0Con67373,in0Mul74480,in1Mul74480,in0Con17721,in0Max72538,in1Max72538],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con96789.png')

LBat15630 = batch_normalization_layer([[1.1248, 1.7986]], 1, 0.8344294717338703, [0.2244, 0.4286], [0.876, 0.4307], [0.3927, 0.0763], [0.2484, 0.3047], Bat15630), 
LRes45936 = reshape_layer(Bat15630, [2, 1], Res45936), 
LCon67373 = concatenate_layer([Res45936,[[[0.2933], [0.5616]]]], 2, Con67373), 
LMul74480 = multiply_layer([[[[0.3922, 0.4046]]], [[[0.1752, 0.2545]]]], Mul74480), 
LBat7368 = batch_normalization_layer(Mul74480, 2, 0.25167644797584376, [0.6815, 0.9985], [0.6061, 0.8482], [0.3142, 0.1409], [0.9903, 0.0602], Bat7368), 
LDot33603 = dot_layer(Con67373,Bat7368, 1, 2, Dot33603), 
LCon17721 = concatenate_layer([Dot33603,[[[0.6184], [0.6432]]]], 2, Con17721), 
LMax72538 = maximum_layer([[[[0.5442, 0.5759], [0.7477, 0.7574]]], [[[0.8149, 0.4218], [0.2188, 0.3891]]]], Max72538), 
LMul2528 = multiply_layer([Con17721,Max72538], Mul2528), 
LGlo6420 = global_max_pool1D_layer(Mul2528, Glo6420), 
LRes11775 = reshape_layer(Glo6420, [2, 1], Res11775), 
LRes98511 = reshape_layer(Res11775, [2, 1, 1], Res98511), 
LCon96789 = conv2D_transpose_layer(Res98511, 1, 1,[[[[0.3296], [0.2378], [0.4669]]]],[0, 0, 0], 1, 1, false, Con96789), 
exec_layers([LBat15630,LRes45936,LCon67373,LMul74480,LBat7368,LDot33603,LCon17721,LMax72538,LMul2528,LGlo6420,LRes11775,LRes98511,LCon96789],["Bat15630","Res45936","Con67373","Mul74480","Bat7368","Dot33603","Con17721","Max72538","Mul2528","Glo6420","Res11775","Res98511","Con96789"],Con96789,"Con96789")

Actual (Unparsed): [[[[0.3618663, 0.2610795, 0.5126073]], [[0.1605678, 0.1158466, 0.2274548]]]]

Expected (Unparsed): [[[[0.36186629208678417,0.26107950321067136,0.5126073172794888]],[[0.160567830528,0.115846571904,0.227454854592]]]]

Actual:   [[[[0.3619, 0.2611, 0.5127]], [[0.1606, 0.1159, 0.2275]]]]

Expected: [[[[0.3619, 0.2611, 0.5127]], [[0.1606, 0.1159, 0.2275]]]]