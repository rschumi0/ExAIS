import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave88620 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Ave88620 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Dot51394 = tf.keras.layers.Input(shape=([2]))
in1Dot51394 = tf.keras.layers.Input(shape=([2]))
in0Con48764 = tf.keras.layers.Input(shape=([3]))

Ave88620 = keras.layers.Average(name = 'Ave88620', )([in0Ave88620,in1Ave88620])
Res22087 = keras.layers.Reshape((2, 1, 2), name = 'Res22087', )(Ave88620)
Res66493 = keras.layers.Reshape((2, 2), name = 'Res66493', )(Res22087)
Fla1181 = keras.layers.Flatten(name = 'Fla1181', )(Res66493)
Dot51394 = keras.layers.Dot(axes=(1, 1), name = 'Dot51394', )([in0Dot51394,in1Dot51394])
Con48764 = keras.layers.Concatenate(axis=1, name = 'Con48764', )([Dot51394,in0Con48764])
Min43586 = keras.layers.Minimum(name = 'Min43586', )([Fla1181,Con48764])
Res1753 = keras.layers.Reshape((4, 1), name = 'Res1753', )(Min43586)
Res71710 = keras.layers.Reshape((4, 1, 1), name = 'Res71710', )(Res1753)
Up_95990 = keras.layers.UpSampling2D(size=(2, 1), name = 'Up_95990', )(Res71710)
Res20304 = keras.layers.Reshape((8, 1), name = 'Res20304', )(Up_95990)
LST34463 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST34463', )(Res20304)
model = tf.keras.models.Model(inputs=[in0Ave88620,in1Ave88620,in0Dot51394,in1Dot51394,in0Con48764], outputs=LST34463)
w = model.get_layer('LST34463').get_weights() 
w[0] = np.array([[2, 3, 3, 4, 10, 4, 2, 8]])
w[1] = np.array([[8, 2, 3, 6, 6, 10, 1, 1], [8, 10, 8, 10, 2, 9, 5, 10]])
w[2] = np.array([8, 2, 10, 1, 1, 6, 7, 10])
model.get_layer('LST34463').set_weights(w) 
in0Ave88620 = tf.constant([[[[[0.4782, 0.0819]]], [[[0.1057, 0.6818]]]]])
in1Ave88620 = tf.constant([[[[[0.2493, 0.4443]]], [[[0.796, 0.6908]]]]])
in0Dot51394 = tf.constant([[0.3432, 0.9961]])
in1Dot51394 = tf.constant([[0.1369, 0.6393]])
in0Con48764 = tf.constant([[0.09, 0.6983, 0.9325]])
print (np.array2string(model.predict([in0Ave88620,in1Ave88620,in0Dot51394,in1Dot51394,in0Con48764],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST34463.png')

LAve88620 = average_layer([[[[[[0.4782, 0.0819]]], [[[0.1057, 0.6818]]]]], [[[[[0.2493, 0.4443]]], [[[0.796, 0.6908]]]]]], Ave88620), 
LRes22087 = reshape_layer(Ave88620, [2, 1, 2], Res22087), 
LRes66493 = reshape_layer(Res22087, [2, 2], Res66493), 
LFla1181 = flatten_layer(Res66493, Fla1181), 
LDot51394 = dot_layer([[0.3432, 0.9961]], [[0.1369, 0.6393]], 1, 1, Dot51394), 
LCon48764 = concatenate_layer([Dot51394,[[0.09, 0.6983, 0.9325]]], 1, Con48764), 
LMin43586 = minimum_layer([Fla1181,Con48764], Min43586), 
LRes1753 = reshape_layer(Min43586, [4, 1], Res1753), 
LRes71710 = reshape_layer(Res1753, [4, 1, 1], Res71710), 
LUp_95990 = up_sampling2D_layer(Res71710, 2, 1, Up_95990), 
LRes20304 = reshape_layer(Up_95990, [8, 1], Res20304), 
LLST34463 = lstm_layer(Res20304,[[2, 3, 3, 4, 10, 4, 2, 8]],[[8, 2, 3, 6, 6, 10, 1, 1], [8, 10, 8, 10, 2, 9, 5, 10]],[8, 2, 10, 1, 1, 6, 7, 10], LST34463), 
exec_layers([LAve88620,LRes22087,LRes66493,LFla1181,LDot51394,LCon48764,LMin43586,LRes1753,LRes71710,LUp_95990,LRes20304,LLST34463],["Ave88620","Res22087","Res66493","Fla1181","Dot51394","Con48764","Min43586","Res1753","Res71710","Up_95990","Res20304","LST34463"],LST34463,"LST34463")

Actual (Unparsed): [[0.9999992, 0.9999998]]

Expected (Unparsed): [[0.9999992018922542,0.9999997544785691]]

Actual:   [[1, 1]]

Expected: [[1, 1]]