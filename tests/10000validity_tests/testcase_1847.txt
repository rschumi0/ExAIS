import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0PRe13168 = tf.keras.layers.Input(shape=([1, 1]))
in0Con15130 = tf.keras.layers.Input(shape=([1, 2]))
in0Mul49667 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Mul49667 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Sub99363 = tf.keras.layers.Input(shape=([2, 2]))
in1Sub99363 = tf.keras.layers.Input(shape=([2, 2]))
in0Con7203 = tf.keras.layers.Input(shape=([2, 1]))

PRe13168 = keras.layers.PReLU(name = 'PRe13168', input_shape=(1, 1))(in0PRe13168)
Con15130 = keras.layers.Concatenate(axis=2, name = 'Con15130', )([PRe13168,in0Con15130])
Mul49667 = keras.layers.Multiply(name = 'Mul49667', )([in0Mul49667,in1Mul49667])
Res44434 = keras.layers.Reshape((1, 2), name = 'Res44434', )(Mul49667)
Con75915 = keras.layers.Conv1D(3, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con75915', )(Res44434)
Ave54272 = keras.layers.Average(name = 'Ave54272', )([Con15130,Con75915])
Zer99079 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer99079', )(Ave54272)
Sub99363 = keras.layers.Subtract(name = 'Sub99363', )([in0Sub99363,in1Sub99363])
Con7203 = keras.layers.Concatenate(axis=2, name = 'Con7203', )([Sub99363,in0Con7203])
Ave32051 = keras.layers.Average(name = 'Ave32051', )([Zer99079,Con7203])
Thr19839 = keras.layers.ThresholdedReLU(theta=9.860969666429767, name = 'Thr19839', )(Ave32051)
LST14517 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST14517', )(Thr19839)
model = tf.keras.models.Model(inputs=[in0PRe13168,in0Con15130,in0Mul49667,in1Mul49667,in0Sub99363,in1Sub99363,in0Con7203], outputs=LST14517)
w = model.get_layer('PRe13168').get_weights() 
w[0] = np.array([[0.849]])
model.get_layer('PRe13168').set_weights(w) 
w = model.get_layer('Con75915').get_weights() 
w[0] = np.array([[[0.1007, 0.601, 0.4019], [0.1177, 0.6373, 0.8744]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con75915').set_weights(w) 
w = model.get_layer('LST14517').get_weights() 
w[0] = np.array([[8, 6, 4, 10, 5, 8, 1, 2, 9, 2, 8, 3], [9, 2, 6, 10, 3, 10, 5, 5, 4, 2, 6, 8], [10, 7, 9, 2, 7, 1, 3, 2, 6, 8, 6, 10]])
w[1] = np.array([[9, 5, 5, 9, 4, 3, 5, 3, 5, 3, 9, 8], [6, 4, 9, 10, 2, 5, 9, 6, 1, 6, 5, 1], [6, 7, 4, 2, 9, 2, 6, 10, 9, 1, 10, 6]])
w[2] = np.array([8, 1, 10, 6, 3, 3, 2, 8, 2, 6, 2, 3])
model.get_layer('LST14517').set_weights(w) 
in0PRe13168 = tf.constant([[[0.6213]]])
in0Con15130 = tf.constant([[[0.6576, 0.2866]]])
in0Mul49667 = tf.constant([[[[0.3591], [0.0418]]]])
in1Mul49667 = tf.constant([[[[0.4864], [0.5138]]]])
in0Sub99363 = tf.constant([[[0.4453, 0.87], [0.6577, 0.8598]]])
in1Sub99363 = tf.constant([[[0.3359, 0.3223], [0.6587, 0.1324]]])
in0Con7203 = tf.constant([[[0.903], [0.9989]]])
print (np.array2string(model.predict([in0PRe13168,in0Con15130,in0Mul49667,in1Mul49667,in0Sub99363,in1Sub99363,in0Con7203],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST14517.png')

LPRe13168 = prelu_layer([[[0.6213]]], [[0.849]], PRe13168), 
LCon15130 = concatenate_layer([PRe13168,[[[0.6576, 0.2866]]]], 2, Con15130), 
LMul49667 = multiply_layer([[[[[0.3591], [0.0418]]]], [[[[0.4864], [0.5138]]]]], Mul49667), 
LRes44434 = reshape_layer(Mul49667, [1, 2], Res44434), 
LCon75915 = conv1D_layer(Res44434, 1,[[[0.1007, 0.601, 0.4019], [0.1177, 0.6373, 0.8744]]],[0, 0, 0], 1, false, 1, Con75915), 
LAve54272 = average_layer([Con15130,Con75915], Ave54272), 
LZer99079 = zero_padding1D_layer(Ave54272, 1, 0, Zer99079), 
LSub99363 = subtract_layer([[[0.4453, 0.87], [0.6577, 0.8598]]], [[[0.3359, 0.3223], [0.6587, 0.1324]]], Sub99363), 
LCon7203 = concatenate_layer([Sub99363,[[[0.903], [0.9989]]]], 2, Con7203), 
LAve32051 = average_layer([Zer99079,Con7203], Ave32051), 
LThr19839 = thresholded_relu_layer(Ave32051, 9.860969666429767, Thr19839), 
LLST14517 = lstm_layer(Thr19839,[[8, 6, 4, 10, 5, 8, 1, 2, 9, 2, 8, 3], [9, 2, 6, 10, 3, 10, 5, 5, 4, 2, 6, 8], [10, 7, 9, 2, 7, 1, 3, 2, 6, 8, 6, 10]],[[9, 5, 5, 9, 4, 3, 5, 3, 5, 3, 9, 8], [6, 4, 9, 10, 2, 5, 9, 6, 1, 6, 5, 1], [6, 7, 4, 2, 9, 2, 6, 10, 9, 1, 10, 6]],[8, 1, 10, 6, 3, 3, 2, 8, 2, 6, 2, 3], LST14517), 
exec_layers([LPRe13168,LCon15130,LMul49667,LRes44434,LCon75915,LAve54272,LZer99079,LSub99363,LCon7203,LAve32051,LThr19839,LLST14517],["PRe13168","Con15130","Mul49667","Res44434","Con75915","Ave54272","Zer99079","Sub99363","Con7203","Ave32051","Thr19839","LST14517"],LST14517,"LST14517")

Actual (Unparsed): [[0.9613668, 0.9391799, 0.9613856]]

Expected (Unparsed): [[0.9613668369385658,0.9391799494159235,0.9613856137466369]]

Actual:   [[0.9614, 0.9392, 0.9614]]

Expected: [[0.9614, 0.9392, 0.9614]]