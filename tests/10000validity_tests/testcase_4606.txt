import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub60359 = tf.keras.layers.Input(shape=([3, 3]))
in1Sub60359 = tf.keras.layers.Input(shape=([3, 3]))
in0Dot2397 = tf.keras.layers.Input(shape=([3, 3]))
in1Dot2397 = tf.keras.layers.Input(shape=([3, 3]))
in0Con5922 = tf.keras.layers.Input(shape=([9, 2]))
in0Con63372 = tf.keras.layers.Input(shape=([1, 2]))
in0Con28519 = tf.keras.layers.Input(shape=([9, 5]))

Sub60359 = keras.layers.Subtract(name = 'Sub60359', )([in0Sub60359,in1Sub60359])
Res55890 = keras.layers.Reshape((3, 3, 1), name = 'Res55890', )(Sub60359)
Up_38691 = keras.layers.UpSampling2D(size=(2, 2), name = 'Up_38691', )(Res55890)
Res60397 = keras.layers.Reshape((6, 6), name = 'Res60397', )(Up_38691)
Zer89153 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer89153', )(Res60397)
Dot2397 = keras.layers.Dot(axes=(2, 1), name = 'Dot2397', )([in0Dot2397,in1Dot2397])
Fla58135 = keras.layers.Flatten(name = 'Fla58135', )(Dot2397)
Res20503 = keras.layers.Reshape((9, 1), name = 'Res20503', )(Fla58135)
Con5922 = keras.layers.Concatenate(axis=2, name = 'Con5922', )([Res20503,in0Con5922])
Con63372 = keras.layers.Conv1D(3, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con63372', )(in0Con63372)
Dot78436 = keras.layers.Dot(axes=(2, 2), name = 'Dot78436', )([Con5922,Con63372])
Con28519 = keras.layers.Concatenate(axis=2, name = 'Con28519', )([Dot78436,in0Con28519])
Ave89262 = keras.layers.Average(name = 'Ave89262', )([Zer89153,Con28519])
model = tf.keras.models.Model(inputs=[in0Sub60359,in1Sub60359,in0Dot2397,in1Dot2397,in0Con5922,in0Con63372,in0Con28519], outputs=Ave89262)
w = model.get_layer('Con63372').get_weights() 
w[0] = np.array([[[0.0416, 0.4286, 0.5151], [0.9867, 0.0318, 0.6919]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con63372').set_weights(w) 
in0Sub60359 = tf.constant([[[0.1854, 0.3085, 0.9474], [0.1344, 0.9778, 0.941], [0.7809, 0.7353, 0.1666]]])
in1Sub60359 = tf.constant([[[0.979, 0.7098, 0.4342], [0.8218, 0.2625, 0.7661], [0.818, 0.2475, 0.9637]]])
in0Dot2397 = tf.constant([[[0.5562, 0.769, 0.4698], [0.2593, 0.992, 0.7072], [0.5153, 0.3355, 0.5736]]])
in1Dot2397 = tf.constant([[[0.3747, 0.132, 0.1326], [0.4413, 0.1358, 0.1552], [0.8555, 0.4166, 0.9663]]])
in0Con5922 = tf.constant([[[0.98, 0.8336], [0.3476, 0.3962], [0.7323, 0.7293], [0.7058, 0.4384], [0.0311, 0.7623], [0.4836, 0.6914], [0.1975, 0.2834], [0.2666, 0.8018], [0.3497, 0.7884]]])
in0Con63372 = tf.constant([[[0.414, 0.2915]]])
in0Con28519 = tf.constant([[[0.3173, 0.1307, 0.2412, 0.3946, 0.25], [0.6657, 0.1096, 0.9319, 0.6825, 0.6812], [0.0119, 0.6805, 0.8779, 0.8863, 0.4025], [0.6121, 0.7397, 0.3868, 0.1131, 0.7041], [0.838, 0.8816, 0.7704, 0.8419, 0.265], [0.8614, 0.0142, 0.3125, 0.52, 0.5076], [0.7634, 0.813, 0.348, 0.88, 0.8929], [0.8014, 0.2186, 0.1566, 0.3353, 0.7069], [0.9195, 0.1426, 0.8032, 0.9854, 0.5622]]])
print (np.array2string(model.predict([in0Sub60359,in1Sub60359,in0Dot2397,in1Dot2397,in0Con5922,in0Con63372,in0Con28519],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave89262.png')

LSub60359 = subtract_layer([[[0.1854, 0.3085, 0.9474], [0.1344, 0.9778, 0.941], [0.7809, 0.7353, 0.1666]]], [[[0.979, 0.7098, 0.4342], [0.8218, 0.2625, 0.7661], [0.818, 0.2475, 0.9637]]], Sub60359), 
LRes55890 = reshape_layer(Sub60359, [3, 3, 1], Res55890), 
LUp_38691 = up_sampling2D_layer(Res55890, 2, 2, Up_38691), 
LRes60397 = reshape_layer(Up_38691, [6, 6], Res60397), 
LZer89153 = zero_padding1D_layer(Res60397, 3, 0, Zer89153), 
LDot2397 = dot_layer([[[0.5562, 0.769, 0.4698], [0.2593, 0.992, 0.7072], [0.5153, 0.3355, 0.5736]]], [[[0.3747, 0.132, 0.1326], [0.4413, 0.1358, 0.1552], [0.8555, 0.4166, 0.9663]]], 2, 1, Dot2397), 
LFla58135 = flatten_layer(Dot2397, Fla58135), 
LRes20503 = reshape_layer(Fla58135, [9, 1], Res20503), 
LCon5922 = concatenate_layer([Res20503,[[[0.98, 0.8336], [0.3476, 0.3962], [0.7323, 0.7293], [0.7058, 0.4384], [0.0311, 0.7623], [0.4836, 0.6914], [0.1975, 0.2834], [0.2666, 0.8018], [0.3497, 0.7884]]]], 2, Con5922), 
LCon63372 = conv1D_layer([[[0.414, 0.2915]]], 1,[[[0.0416, 0.4286, 0.5151], [0.9867, 0.0318, 0.6919]]],[0, 0, 0], 1, true, 1, Con63372), 
LDot78436 = dot_layer(Con5922,Con63372, 2, 2, Dot78436), 
LCon28519 = concatenate_layer([Dot78436,[[[0.3173, 0.1307, 0.2412, 0.3946, 0.25], [0.6657, 0.1096, 0.9319, 0.6825, 0.6812], [0.0119, 0.6805, 0.8779, 0.8863, 0.4025], [0.6121, 0.7397, 0.3868, 0.1131, 0.7041], [0.838, 0.8816, 0.7704, 0.8419, 0.265], [0.8614, 0.0142, 0.3125, 0.52, 0.5076], [0.7634, 0.813, 0.348, 0.88, 0.8929], [0.8014, 0.2186, 0.1566, 0.3353, 0.7069], [0.9195, 0.1426, 0.8032, 0.9854, 0.5622]]]], 2, Con28519), 
LAve89262 = average_layer([Zer89153,Con28519], Ave89262), 
exec_layers([LSub60359,LRes55890,LUp_38691,LRes60397,LZer89153,LDot2397,LFla58135,LRes20503,LCon5922,LCon63372,LDot78436,LCon28519,LAve89262],["Sub60359","Res55890","Up_38691","Res60397","Zer89153","Dot2397","Fla58135","Res20503","Con5922","Con63372","Dot78436","Con28519","Ave89262"],Ave89262,"Ave89262")

Actual (Unparsed): [[[0.4091881, 0.1586500, 0.0653500, 0.1206000, 0.1973000, 0.1250000], [0.1715900, 0.3328500, 0.0548000, 0.4659500, 0.3412500, 0.3406000], [0.3182998, 0.0059500, 0.3402500, 0.4389500, 0.4431500, 0.2012500], [-0.0662025, -0.0907500, 0.1692000, -0.0072500, 0.3131500, 0.6086500], [-0.1650850, 0.0222000, 0.2401500, 0.1845500, 0.6775500, 0.3891000], [-0.0222404, 0.0870000, 0.3647500, 0.5139000, 0.3474500, 0.3412500], [-0.1396719, 0.0380000, 0.7641500, 0.5316500, 0.5274500, 0.5339000], [0.2264235, 0.3821500, 0.3532000, 0.3222000, -0.2309000, -0.0451000], [0.2805004, 0.4412000, 0.3152000, 0.6455000, 0.0941500, -0.1174500]]]

Expected (Unparsed): [[[0.4091881238935414,0.15865,0.06535,0.1206,0.1973,0.125],[0.17159002169343798,0.33285,0.0548,0.46595,0.34125,0.3406],[0.31829983369679843,0.00595,0.34025,0.43895,0.44315,0.20125],[-0.06620250791427024,-0.09075,0.16920000000000002,-0.0072500000000000064,0.31315000000000004,0.60865],[-0.165084993512138,0.022199999999999998,0.24015000000000003,0.18455,0.6775500000000001,0.38910000000000006],[-0.02224040135333849,0.08700000000000002,0.36475,0.5139,0.34745,0.34125],[-0.13967191205703156,0.03799999999999998,0.76415,0.53165,0.52745,0.5339],[0.22642345450185852,0.38215000000000005,0.35319999999999996,0.3222,-0.23090000000000002,-0.04510000000000003],[0.2805004517106635,0.44120000000000004,0.3152,0.6455,0.09415000000000001,-0.11745]]]

Actual:   [[[0.4092, 0.1587, 0.0654, 0.1206, 0.1973, 0.125], [0.1716, 0.3329, 0.0548, 0.466, 0.3413, 0.3406], [0.3183, 0.006, 0.3403, 0.439, 0.4432, 0.2013], [-0.0662, -0.0907, 0.1692, -0.0072, 0.3132, 0.6087], [-0.165, 0.0222, 0.2402, 0.1846, 0.6776, 0.3891], [-0.0222, 0.087, 0.3648, 0.5139, 0.3475, 0.3413], [-0.1396, 0.038, 0.7642, 0.5317, 0.5275, 0.5339], [0.2265, 0.3822, 0.3532, 0.3222, -0.2309, -0.0451], [0.2806, 0.4412, 0.3152, 0.6455, 0.0942, -0.1174]]]

Expected: [[[0.4092, 0.1587, 0.0654, 0.1206, 0.1973, 0.125], [0.1716, 0.3329, 0.0548, 0.466, 0.3413, 0.3406], [0.3183, 0.006, 0.3403, 0.439, 0.4432, 0.2013], [-0.0662, -0.0907, 0.1693, -0.0072, 0.3132, 0.6087], [-0.165, 0.0222, 0.2402, 0.1846, 0.6776, 0.3892], [-0.0222, 0.0871, 0.3648, 0.5139, 0.3475, 0.3413], [-0.1396, 0.038, 0.7642, 0.5317, 0.5275, 0.5339], [0.2265, 0.3822, 0.3532, 0.3222, -0.2309, -0.0451], [0.2806, 0.4413, 0.3152, 0.6455, 0.0942, -0.1174]]]