import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub26495 = tf.keras.layers.Input(shape=([2]))
in1Sub26495 = tf.keras.layers.Input(shape=([2]))

Sub26495 = keras.layers.Subtract(name = 'Sub26495', )([in0Sub26495,in1Sub26495])
Res13806 = keras.layers.Reshape((2, 1), name = 'Res13806', )(Sub26495)
Res76004 = keras.layers.Reshape((2, 1, 1), name = 'Res76004', )(Res13806)
Con3965 = keras.layers.Conv2D(4, (2, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con3965', )(Res76004)
model = tf.keras.models.Model(inputs=[in0Sub26495,in1Sub26495], outputs=Con3965)
w = model.get_layer('Con3965').get_weights() 
w[0] = np.array([[[[0.3896, 0.1045, 0.0215, 0.624]]], [[[0.8302, 0.4037, 0.4003, 0.0578]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con3965').set_weights(w) 
in0Sub26495 = tf.constant([[0.7132, 0.4778]])
in1Sub26495 = tf.constant([[0.6926, 0.687]])
print (np.array2string(model.predict([in0Sub26495,in1Sub26495],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con3965.png')

LSub26495 = subtract_layer([[0.7132, 0.4778]], [[0.6926, 0.687]], Sub26495), 
LRes13806 = reshape_layer(Sub26495, [2, 1], Res13806), 
LRes76004 = reshape_layer(Res13806, [2, 1, 1], Res76004), 
LCon3965 = conv2D_layer(Res76004, 2, 1,[[[[0.3896, 0.1045, 0.0215, 0.624]]], [[[0.8302, 0.4037, 0.4003, 0.0578]]]],[0, 0, 0, 0], 1, 1, true, 1, 1, Con3965), 
exec_layers([LSub26495,LRes13806,LRes76004,LCon3965],["Sub26495","Res13806","Res76004","Con3965"],Con3965,"Con3965")

Actual (Unparsed): [[[[-0.1656521, -0.0823013, -0.0832998, 0.0007626]], [[-0.0815043, -0.0218614, -0.0044978, -0.1305408]]]]

Expected (Unparsed): [[[[-0.16565208000000006,-0.08230134000000003,-0.08329986000000002,0.0007626399999999672]],[[-0.08150432000000002,-0.021861400000000003,-0.004497800000000001,-0.13054080000000004]]]]

Actual:   [[[[-0.1656, -0.0823, -0.0832, 0.0008]], [[-0.0815, -0.0218, -0.0044, -0.1305]]]]

Expected: [[[[-0.1656, -0.0823, -0.0832, 0.0008]], [[-0.0815, -0.0218, -0.0044, -0.1305]]]]