import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub10734 = tf.keras.layers.Input(shape=([3, 3, 2, 3]))
in1Sub10734 = tf.keras.layers.Input(shape=([3, 3, 2, 3]))
in0Mul50855 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Mul50855 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))

Sub10734 = keras.layers.Subtract(name = 'Sub10734', )([in0Sub10734,in1Sub10734])
Res93593 = keras.layers.Reshape((3, 3, 6), name = 'Res93593', )(Sub10734)
Res10819 = keras.layers.Reshape((3, 18), name = 'Res10819', )(Res93593)
GRU57050 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU57050', )(Res10819)
Res16108 = keras.layers.Reshape((3, 1), name = 'Res16108', )(GRU57050)
GRU65310 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU65310', )(Res16108)
Res92467 = keras.layers.Reshape((2, 1), name = 'Res92467', )(GRU65310)
Res66242 = keras.layers.Reshape((2, 1, 1), name = 'Res66242', )(Res92467)
Res59182 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res59182', )(Res66242)
Zer57827 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (2, 0)), name = 'Zer57827', )(Res59182)
Mul50855 = keras.layers.Multiply(name = 'Mul50855', )([in0Mul50855,in1Mul50855])
Zer73563 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (1, 0)), name = 'Zer73563', )(Mul50855)
Min61068 = keras.layers.Minimum(name = 'Min61068', )([Zer57827,Zer73563])
model = tf.keras.models.Model(inputs=[in0Sub10734,in1Sub10734,in0Mul50855,in1Mul50855], outputs=Min61068)
w = model.get_layer('GRU57050').get_weights() 
w[0] = np.array([[5, 3, 8, 7, 7, 6, 7, 8, 10], [4, 1, 8, 1, 1, 3, 5, 8, 1], [1, 9, 8, 2, 10, 9, 2, 5, 4], [5, 6, 6, 1, 3, 10, 5, 3, 2], [6, 3, 4, 7, 6, 5, 10, 2, 7], [5, 9, 8, 8, 1, 10, 8, 10, 4], [4, 1, 9, 10, 7, 8, 9, 6, 4], [6, 3, 3, 9, 1, 1, 4, 5, 8], [4, 10, 4, 10, 7, 5, 2, 7, 2], [9, 9, 4, 7, 7, 3, 10, 3, 6], [5, 8, 5, 4, 4, 6, 7, 4, 9], [6, 1, 1, 7, 3, 4, 6, 5, 6], [10, 6, 3, 1, 6, 2, 3, 4, 5], [4, 4, 10, 7, 2, 9, 9, 2, 5], [10, 3, 2, 10, 3, 6, 3, 8, 2], [5, 3, 7, 7, 4, 4, 10, 7, 4], [9, 1, 6, 4, 1, 2, 4, 10, 5], [7, 2, 10, 9, 9, 1, 5, 6, 2]])
w[1] = np.array([[6, 4, 2, 9, 8, 7, 10, 2, 7], [2, 4, 1, 7, 8, 7, 7, 2, 1], [1, 10, 5, 6, 3, 10, 5, 10, 9]])
w[2] = np.array([8, 5, 3, 5, 5, 1, 2, 5, 4])
model.get_layer('GRU57050').set_weights(w) 
w = model.get_layer('GRU65310').get_weights() 
w[0] = np.array([[8, 6, 2, 10, 9, 4]])
w[1] = np.array([[7, 5, 5, 3, 3, 3], [6, 4, 4, 4, 6, 1]])
w[2] = np.array([[1, 6, 8, 5, 9, 7], [1, 6, 2, 2, 2, 6]])
model.get_layer('GRU65310').set_weights(w) 
in0Sub10734 = tf.constant([[[[[0.2275, 0.1516, 0.0975], [0.2759, 0.475, 0.9004]], [[0.3373, 0.0798, 0.8222], [0.6807, 0.0969, 0.8773]], [[0.302, 0.5662, 0.8891], [0.7823, 0.446, 0.1472]]], [[[0.5785, 0.7521, 0.9088], [0.5018, 0.895, 0.5934]], [[0.2116, 0.4608, 0.3943], [0.6177, 0.4844, 0.5115]], [[0.4626, 0.8554, 0.3729], [0.2245, 0.5755, 0.7309]]], [[[0.4668, 0.7915, 0.043], [0.7582, 0.7068, 0.1166]], [[0.8982, 0.1238, 0.2317], [0.9162, 0.4218, 0.9894]], [[0.0369, 0.4539, 0.0316], [0.9713, 0.6359, 0.8583]]]]])
in1Sub10734 = tf.constant([[[[[0.9138, 0.5272, 0.6369], [0.4561, 0.8229, 0.9225]], [[0.7785, 0.1895, 0.9369], [0.0307, 0.5036, 0.9803]], [[0.5167, 0.4776, 0.594], [0.8545, 0.3908, 0.5362]]], [[[0.7354, 0.7463, 0.9621], [0.7426, 0.1394, 0.1642]], [[0.5171, 0.4162, 0.507], [0.3205, 0.1068, 0.1435]], [[0.6899, 0.9008, 0.1649], [0.8073, 0.3759, 0.3799]]], [[[0.3289, 0.9333, 0.0052], [0.6823, 0.6398, 0.965]], [[0.9125, 0.0239, 0.4087], [0.5714, 0.3804, 0.9775]], [[0.5603, 0.2525, 0.8881], [0.1551, 0.1894, 0.3098]]]]])
in0Mul50855 = tf.constant([[[[[0.3454], [0.4188]], [[0.3987], [0.7196]]]]])
in1Mul50855 = tf.constant([[[[[0.5125], [0.1967]], [[0.2287], [0.5673]]]]])
print (np.array2string(model.predict([in0Sub10734,in1Sub10734,in0Mul50855,in1Mul50855],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min61068.png')

LSub10734 = subtract_layer([[[[[0.2275, 0.1516, 0.0975], [0.2759, 0.475, 0.9004]], [[0.3373, 0.0798, 0.8222], [0.6807, 0.0969, 0.8773]], [[0.302, 0.5662, 0.8891], [0.7823, 0.446, 0.1472]]], [[[0.5785, 0.7521, 0.9088], [0.5018, 0.895, 0.5934]], [[0.2116, 0.4608, 0.3943], [0.6177, 0.4844, 0.5115]], [[0.4626, 0.8554, 0.3729], [0.2245, 0.5755, 0.7309]]], [[[0.4668, 0.7915, 0.043], [0.7582, 0.7068, 0.1166]], [[0.8982, 0.1238, 0.2317], [0.9162, 0.4218, 0.9894]], [[0.0369, 0.4539, 0.0316], [0.9713, 0.6359, 0.8583]]]]], [[[[[0.9138, 0.5272, 0.6369], [0.4561, 0.8229, 0.9225]], [[0.7785, 0.1895, 0.9369], [0.0307, 0.5036, 0.9803]], [[0.5167, 0.4776, 0.594], [0.8545, 0.3908, 0.5362]]], [[[0.7354, 0.7463, 0.9621], [0.7426, 0.1394, 0.1642]], [[0.5171, 0.4162, 0.507], [0.3205, 0.1068, 0.1435]], [[0.6899, 0.9008, 0.1649], [0.8073, 0.3759, 0.3799]]], [[[0.3289, 0.9333, 0.0052], [0.6823, 0.6398, 0.965]], [[0.9125, 0.0239, 0.4087], [0.5714, 0.3804, 0.9775]], [[0.5603, 0.2525, 0.8881], [0.1551, 0.1894, 0.3098]]]]], Sub10734), 
LRes93593 = reshape_layer(Sub10734, [3, 3, 6], Res93593), 
LRes10819 = reshape_layer(Res93593, [3, 18], Res10819), 
LGRU57050 = gru_layer(Res10819,[[5, 3, 8, 7, 7, 6, 7, 8, 10], [4, 1, 8, 1, 1, 3, 5, 8, 1], [1, 9, 8, 2, 10, 9, 2, 5, 4], [5, 6, 6, 1, 3, 10, 5, 3, 2], [6, 3, 4, 7, 6, 5, 10, 2, 7], [5, 9, 8, 8, 1, 10, 8, 10, 4], [4, 1, 9, 10, 7, 8, 9, 6, 4], [6, 3, 3, 9, 1, 1, 4, 5, 8], [4, 10, 4, 10, 7, 5, 2, 7, 2], [9, 9, 4, 7, 7, 3, 10, 3, 6], [5, 8, 5, 4, 4, 6, 7, 4, 9], [6, 1, 1, 7, 3, 4, 6, 5, 6], [10, 6, 3, 1, 6, 2, 3, 4, 5], [4, 4, 10, 7, 2, 9, 9, 2, 5], [10, 3, 2, 10, 3, 6, 3, 8, 2], [5, 3, 7, 7, 4, 4, 10, 7, 4], [9, 1, 6, 4, 1, 2, 4, 10, 5], [7, 2, 10, 9, 9, 1, 5, 6, 2]],[[6, 4, 2, 9, 8, 7, 10, 2, 7], [2, 4, 1, 7, 8, 7, 7, 2, 1], [1, 10, 5, 6, 3, 10, 5, 10, 9]],[8, 5, 3, 5, 5, 1, 2, 5, 4], false, GRU57050), 
LRes16108 = reshape_layer(GRU57050, [3, 1], Res16108), 
LGRU65310 = gru_layer(Res16108,[[8, 6, 2, 10, 9, 4]],[[7, 5, 5, 3, 3, 3], [6, 4, 4, 4, 6, 1]],[[1, 6, 8, 5, 9, 7], [1, 6, 2, 2, 2, 6]], true, GRU65310), 
LRes92467 = reshape_layer(GRU65310, [2, 1], Res92467), 
LRes66242 = reshape_layer(Res92467, [2, 1, 1], Res66242), 
LRes59182 = reshape_layer(Res66242, [2, 1, 1, 1], Res59182), 
LZer57827 = zero_padding3D_layer(Res59182, 0, 0, 2, 0, 2, 0, Zer57827), 
LMul50855 = multiply_layer([[[[[[0.3454], [0.4188]], [[0.3987], [0.7196]]]]], [[[[[0.5125], [0.1967]], [[0.2287], [0.5673]]]]]], Mul50855), 
LZer73563 = zero_padding3D_layer(Mul50855, 1, 0, 1, 0, 1, 0, Zer73563), 
LMin61068 = minimum_layer([Zer57827,Zer73563], Min61068), 
exec_layers([LSub10734,LRes93593,LRes10819,LGRU57050,LRes16108,LGRU65310,LRes92467,LRes66242,LRes59182,LZer57827,LMul50855,LZer73563,LMin61068],["Sub10734","Res93593","Res10819","GRU57050","Res16108","GRU65310","Res92467","Res66242","Res59182","Zer57827","Mul50855","Zer73563","Min61068"],Min61068,"Min61068")

Actual (Unparsed): [[[[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]]], [[[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0000000]], [[0.0000000], [0.0000000], [0.0008292]]]]]

Expected (Unparsed): [[[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0]]],[[[0],[0],[0]],[[0],[0],[0]],[[0],[0],[0.0008292645348921959]]]]]

Actual:   [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0.0009]]]]]

Expected: [[[[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0]]], [[[0], [0], [0]], [[0], [0], [0]], [[0], [0], [0.0009]]]]]