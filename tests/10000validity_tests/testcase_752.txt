import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con15510 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Add98658 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in1Add98658 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in0Con67467 = tf.keras.layers.Input(shape=([2, 2]))
in0Dot83745 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot83745 = tf.keras.layers.Input(shape=([2, 2]))
in0Ave85055 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave85055 = tf.keras.layers.Input(shape=([2, 1]))
in0Con24589 = tf.keras.layers.Input(shape=([4, 1]))

Con15510 = keras.layers.Conv2D(2, (2, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con15510', )(in0Con15510)
Res26676 = keras.layers.Reshape((2, 2), name = 'Res26676', )(Con15510)
Add98658 = keras.layers.Add(name = 'Add98658', )([in0Add98658,in1Add98658])
Res27858 = keras.layers.Reshape((2, 1, 4), name = 'Res27858', )(Add98658)
Res51595 = keras.layers.Reshape((2, 4), name = 'Res51595', )(Res27858)
Glo40688 = keras.layers.GlobalAveragePooling1D(name = 'Glo40688', )(Res51595)
Res1938 = keras.layers.Reshape((2, 2), name = 'Res1938', )(Glo40688)
Max45961 = keras.layers.Maximum(name = 'Max45961', )([Res26676,Res1938])
Con67467 = keras.layers.Conv1D(2, (2),strides=(1), padding='valid', dilation_rate=(1), name = 'Con67467', )(in0Con67467)
Zer91431 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer91431', )(Con67467)
Max15581 = keras.layers.Maximum(name = 'Max15581', )([Max45961,Zer91431])
Zer3251 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer3251', )(Max15581)
Dot83745 = keras.layers.Dot(axes=(2, 2), name = 'Dot83745', )([in0Dot83745,in1Dot83745])
Zer4198 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer4198', )(Dot83745)
Ave85055 = keras.layers.Average(name = 'Ave85055', )([in0Ave85055,in1Ave85055])
Zer15597 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer15597', )(Ave85055)
Con24589 = keras.layers.Concatenate(axis=2, name = 'Con24589', )([Zer15597,in0Con24589])
Ave72256 = keras.layers.Average(name = 'Ave72256', )([Zer4198,Con24589])
Sub27216 = keras.layers.Subtract(name = 'Sub27216', )([Zer3251,Ave72256])
model = tf.keras.models.Model(inputs=[in0Con15510,in0Add98658,in1Add98658,in0Con67467,in0Dot83745,in1Dot83745,in0Ave85055,in1Ave85055,in0Con24589], outputs=Sub27216)
w = model.get_layer('Con15510').get_weights() 
w[0] = np.array([[[[0.1102, 0.3835], [0.7976, 0.9868]]], [[[0.8475, 0.3451], [0.695, 0.6662]]]])
w[1] = np.array([0, 0])
model.get_layer('Con15510').set_weights(w) 
w = model.get_layer('Con67467').get_weights() 
w[0] = np.array([[[0.2084, 0.5074], [0.2947, 0.2359]], [[0.8087, 0.5384], [0.6688, 0.3843]]])
w[1] = np.array([0, 0])
model.get_layer('Con67467').set_weights(w) 
in0Con15510 = tf.constant([[[[0.6894, 0.9007]], [[0.6443, 0.8199]]]])
in0Add98658 = tf.constant([[[[[0.0462, 0.635], [0.1201, 0.0609]]], [[[0.663, 0.6041], [0.7093, 0.7557]]]]])
in1Add98658 = tf.constant([[[[[0.1302, 0.29], [0.5008, 0.6667]]], [[[0.9065, 0.165], [0.0966, 0.7964]]]]])
in0Con67467 = tf.constant([[[0.8511, 0.3149], [0.9606, 0.4568]]])
in0Dot83745 = tf.constant([[[0.4285, 0.4921], [0.5238, 0.9759]]])
in1Dot83745 = tf.constant([[[0.0295, 0.3749], [0.3533, 0.7658]]])
in0Ave85055 = tf.constant([[[0.2697], [0.7132]]])
in1Ave85055 = tf.constant([[[0.6258], [0.5174]]])
in0Con24589 = tf.constant([[[0.9972], [0.0593], [0.1074], [0.3955]]])
print (np.array2string(model.predict([in0Con15510,in0Add98658,in1Add98658,in0Con67467,in0Dot83745,in1Dot83745,in0Ave85055,in1Ave85055,in0Con24589],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub27216.png')

LCon15510 = conv2D_layer([[[[0.6894, 0.9007]], [[0.6443, 0.8199]]]], 2, 1,[[[[0.1102, 0.3835], [0.7976, 0.9868]]], [[[0.8475, 0.3451], [0.695, 0.6662]]]],[0, 0], 1, 1, true, 1, 1, Con15510), 
LRes26676 = reshape_layer(Con15510, [2, 2], Res26676), 
LAdd98658 = add_layer([[[[[[0.0462, 0.635], [0.1201, 0.0609]]], [[[0.663, 0.6041], [0.7093, 0.7557]]]]], [[[[[0.1302, 0.29], [0.5008, 0.6667]]], [[[0.9065, 0.165], [0.0966, 0.7964]]]]]], Add98658), 
LRes27858 = reshape_layer(Add98658, [2, 1, 4], Res27858), 
LRes51595 = reshape_layer(Res27858, [2, 4], Res51595), 
LGlo40688 = global_average_pooling1D_layer(Res51595, Glo40688), 
LRes1938 = reshape_layer(Glo40688, [2, 2], Res1938), 
LMax45961 = maximum_layer([Res26676,Res1938], Max45961), 
LCon67467 = conv1D_layer([[[0.8511, 0.3149], [0.9606, 0.4568]]], 2,[[[0.2084, 0.5074], [0.2947, 0.2359]], [[0.8087, 0.5384], [0.6688, 0.3843]]],[0, 0], 1, false, 1, Con67467), 
LZer91431 = zero_padding1D_layer(Con67467, 1, 0, Zer91431), 
LMax15581 = maximum_layer([Max45961,Zer91431], Max15581), 
LZer3251 = zero_padding1D_layer(Max15581, 2, 0, Zer3251), 
LDot83745 = dot_layer([[[0.4285, 0.4921], [0.5238, 0.9759]]], [[[0.0295, 0.3749], [0.3533, 0.7658]]], 2, 2, Dot83745), 
LZer4198 = zero_padding1D_layer(Dot83745, 2, 0, Zer4198), 
LAve85055 = average_layer([[[[0.2697], [0.7132]]], [[[0.6258], [0.5174]]]], Ave85055), 
LZer15597 = zero_padding1D_layer(Ave85055, 1, 1, Zer15597), 
LCon24589 = concatenate_layer([Zer15597,[[[0.9972], [0.0593], [0.1074], [0.3955]]]], 2, Con24589), 
LAve72256 = average_layer([Zer4198,Con24589], Ave72256), 
LSub27216 = subtract_layer(Zer3251,Ave72256, Sub27216), 
exec_layers([LCon15510,LRes26676,LAdd98658,LRes27858,LRes51595,LGlo40688,LRes1938,LMax45961,LCon67467,LZer91431,LMax15581,LZer3251,LDot83745,LZer4198,LAve85055,LZer15597,LCon24589,LAve72256,LSub27216],["Con15510","Res26676","Add98658","Res27858","Res51595","Glo40688","Res1938","Max45961","Con67467","Zer91431","Max15581","Zer3251","Dot83745","Zer4198","Ave85055","Zer15597","Con24589","Ave72256","Sub27216"],Sub27216,"Sub27216")

Actual (Unparsed): [[[0.0000000, -0.4986000], [-0.2238750, -0.0296500], [1.5040304, 1.6039413], [1.1618569, 0.5349170]]]

Expected (Unparsed): [[[0,-0.4986],[-0.223875,-0.02965],[1.5040304299999998,1.603941355],[1.1618568249999999,0.5349169499999998]]]

Actual:   [[[0, -0.4986], [-0.2238, -0.0296], [1.5041, 1.604], [1.1619, 0.535]]]

Expected: [[[0, -0.4986], [-0.2238, -0.0296], [1.5041, 1.604], [1.1619, 0.535]]]