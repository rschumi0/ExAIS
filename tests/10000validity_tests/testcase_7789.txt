import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST79774 = tf.keras.layers.Input(shape=([1, 1]))
in0Con68350 = tf.keras.layers.Input(shape=([5]))
in0Lay99692 = tf.keras.layers.Input(shape=([4, 1, 2]))
in0Glo95485 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Con92150 = tf.keras.layers.Input(shape=([7]))
in0Dep94108 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con28892 = tf.keras.layers.Input(shape=([5]))

LST79774 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST79774', )(in0LST79774)
Con68350 = keras.layers.Concatenate(axis=1, name = 'Con68350', )([LST79774,in0Con68350])
Lay99692 = keras.layers.LayerNormalization(axis=3, epsilon=2.5344312773362243, name = 'Lay99692', )(in0Lay99692)
Res39814 = keras.layers.Reshape((4, 2), name = 'Res39814', )(Lay99692)
Fla90455 = keras.layers.Flatten(name = 'Fla90455', )(Res39814)
Glo95485 = keras.layers.GlobalMaxPool3D(name = 'Glo95485', )(in0Glo95485)
Res28558 = keras.layers.Reshape((1, 1), name = 'Res28558', )(Glo95485)
Res48980 = keras.layers.Reshape((1, 1, 1), name = 'Res48980', )(Res28558)
Res90994 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res90994', )(Res48980)
Cro39166 = keras.layers.Cropping3D(cropping=((0, 0), (0, 0), (0, 0)), name = 'Cro39166', )(Res90994)
Res77485 = keras.layers.Reshape((1, 1, 1), name = 'Res77485', )(Cro39166)
Res32816 = keras.layers.Reshape((1, 1), name = 'Res32816', )(Res77485)
Glo52372 = keras.layers.GlobalAveragePooling1D(name = 'Glo52372', )(Res32816)
Con92150 = keras.layers.Concatenate(axis=1, name = 'Con92150', )([Glo52372,in0Con92150])
Max43631 = keras.layers.Maximum(name = 'Max43631', )([Fla90455,Con92150])
Min37308 = keras.layers.Minimum(name = 'Min37308', )([Con68350,Max43631])
Dep94108 = keras.layers.DepthwiseConv2D((2, 1),strides=(1, 1), padding='valid', name = 'Dep94108', )(in0Dep94108)
Fla35054 = keras.layers.Flatten(name = 'Fla35054', )(Dep94108)
Res70096 = keras.layers.Reshape((1, 1), name = 'Res70096', )(Fla35054)
GRU31601 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU31601', )(Res70096)
Con28892 = keras.layers.Concatenate(axis=1, name = 'Con28892', )([GRU31601,in0Con28892])
Min54679 = keras.layers.Minimum(name = 'Min54679', )([Min37308,Con28892])
model = tf.keras.models.Model(inputs=[in0LST79774,in0Con68350,in0Lay99692,in0Glo95485,in0Con92150,in0Dep94108,in0Con28892], outputs=Min54679)
w = model.get_layer('LST79774').get_weights() 
w[0] = np.array([[10, 9, 8, 7, 3, 4, 5, 7, 3, 9, 9, 5]])
w[1] = np.array([[10, 3, 10, 6, 5, 6, 1, 1, 4, 6, 6, 5], [1, 5, 7, 2, 6, 8, 10, 10, 2, 4, 9, 4], [3, 9, 6, 1, 4, 4, 6, 10, 7, 10, 8, 9]])
w[2] = np.array([5, 4, 8, 9, 2, 5, 2, 3, 9, 7, 9, 6])
model.get_layer('LST79774').set_weights(w) 
w = model.get_layer('Dep94108').get_weights() 
w[0] = np.array([[[[0.0979]]], [[[0.5737]]]])
w[1] = np.array([0])
model.get_layer('Dep94108').set_weights(w) 
w = model.get_layer('GRU31601').get_weights() 
w[0] = np.array([[8, 2, 1, 5, 2, 10, 9, 1, 8]])
w[1] = np.array([[4, 6, 1, 7, 4, 10, 9, 1, 9], [2, 9, 6, 1, 7, 2, 2, 7, 7], [6, 2, 4, 2, 7, 2, 5, 10, 6]])
w[2] = np.array([3, 5, 1, 10, 1, 1, 3, 2, 10])
model.get_layer('GRU31601').set_weights(w) 
in0LST79774 = tf.constant([[[7]]])
in0Con68350 = tf.constant([[0.2796, 0.3875, 0.7039, 0.6587, 0.6786]])
in0Lay99692 = tf.constant([[[[1.9982, 1.3837]], [[1.4157, 1.0451]], [[1.4758, 1.888]], [[1.7564, 1.7082]]]])
in0Glo95485 = tf.constant([[[[[1.4271], [1.7302]], [[1.8813], [1.7795]]]]])
in0Con92150 = tf.constant([[0.9762, 0.9172, 0.7879, 0.0824, 0.627, 0.1758, 0.928]])
in0Dep94108 = tf.constant([[[[0.4094]], [[0.0292]]]])
in0Con28892 = tf.constant([[0.6329, 0.6152, 0.8648, 0.2112, 0.7981]])
print (np.array2string(model.predict([in0LST79774,in0Con68350,in0Lay99692,in0Glo95485,in0Con92150,in0Dep94108,in0Con28892],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min54679.png')

LLST79774 = lstm_layer([[[7]]],[[10, 9, 8, 7, 3, 4, 5, 7, 3, 9, 9, 5]],[[10, 3, 10, 6, 5, 6, 1, 1, 4, 6, 6, 5], [1, 5, 7, 2, 6, 8, 10, 10, 2, 4, 9, 4], [3, 9, 6, 1, 4, 4, 6, 10, 7, 10, 8, 9]],[5, 4, 8, 9, 2, 5, 2, 3, 9, 7, 9, 6], LST79774), 
LCon68350 = concatenate_layer([LST79774,[[0.2796, 0.3875, 0.7039, 0.6587, 0.6786]]], 1, Con68350), 
LLay99692 = layer_normalization_layer([[[[1.9982, 1.3837]], [[1.4157, 1.0451]], [[1.4758, 1.888]], [[1.7564, 1.7082]]]], 3, 2.5344312773362243, Lay99692), 
LRes39814 = reshape_layer(Lay99692, [4, 2], Res39814), 
LFla90455 = flatten_layer(Res39814, Fla90455), 
LGlo95485 = global_max_pool3D_layer([[[[[1.4271], [1.7302]], [[1.8813], [1.7795]]]]], Glo95485), 
LRes28558 = reshape_layer(Glo95485, [1, 1], Res28558), 
LRes48980 = reshape_layer(Res28558, [1, 1, 1], Res48980), 
LRes90994 = reshape_layer(Res48980, [1, 1, 1, 1], Res90994), 
LCro39166 = cropping3D_layer(Res90994, 0, 0, 0, 0, 0, 0, Cro39166), 
LRes77485 = reshape_layer(Cro39166, [1, 1, 1], Res77485), 
LRes32816 = reshape_layer(Res77485, [1, 1], Res32816), 
LGlo52372 = global_average_pooling1D_layer(Res32816, Glo52372), 
LCon92150 = concatenate_layer([Glo52372,[[0.9762, 0.9172, 0.7879, 0.0824, 0.627, 0.1758, 0.928]]], 1, Con92150), 
LMax43631 = maximum_layer([Fla90455,Con92150], Max43631), 
LMin37308 = minimum_layer([Con68350,Max43631], Min37308), 
LDep94108 = depthwise_conv2D_layer([[[[0.4094]], [[0.0292]]]], 2, 1,[[[[0.0979]]], [[[0.5737]]]],[0], 1, 1, false, Dep94108), 
LFla35054 = flatten_layer(Dep94108, Fla35054), 
LRes70096 = reshape_layer(Fla35054, [1, 1], Res70096), 
LGRU31601 = gru_layer(Res70096,[[8, 2, 1, 5, 2, 10, 9, 1, 8]],[[4, 6, 1, 7, 4, 10, 9, 1, 9], [2, 9, 6, 1, 7, 2, 2, 7, 7], [6, 2, 4, 2, 7, 2, 5, 10, 6]],[3, 5, 1, 10, 1, 1, 3, 2, 10], false, GRU31601), 
LCon28892 = concatenate_layer([GRU31601,[[0.6329, 0.6152, 0.8648, 0.2112, 0.7981]]], 1, Con28892), 
LMin54679 = minimum_layer([Min37308,Con28892], Min54679), 
exec_layers([LLST79774,LCon68350,LLay99692,LRes39814,LFla90455,LGlo95485,LRes28558,LRes48980,LRes90994,LCro39166,LRes77485,LRes32816,LGlo52372,LCon92150,LMax43631,LMin37308,LDep94108,LFla35054,LRes70096,LGRU31601,LCon28892,LMin54679],["LST79774","Con68350","Lay99692","Res39814","Fla90455","Glo95485","Res28558","Res48980","Res90994","Cro39166","Res77485","Res32816","Glo52372","Con92150","Max43631","Min37308","Dep94108","Fla35054","Res70096","GRU31601","Con28892","Min54679"],Min54679,"Min54679")

Actual (Unparsed): [[0.0305757, 0.0057857, 0.2579153, 0.2796000, 0.0824000, 0.6270000, 0.1758000, 0.6786000]]

Expected (Unparsed): [[0.030575694609538236,0.005785739950848269,0.2579152710823175,0.2796,0.0824,0.627,0.1758,0.6786]]

Actual:   [[0.0306, 0.0058, 0.258, 0.2796, 0.0824, 0.627, 0.1758, 0.6786]]

Expected: [[0.0306, 0.0058, 0.258, 0.2796, 0.0824, 0.627, 0.1758, 0.6786]]