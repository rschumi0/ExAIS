import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dep71892 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con11570 = tf.keras.layers.Input(shape=([1]))
in0Glo25521 = tf.keras.layers.Input(shape=([1, 2]))

Dep71892 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='same', name = 'Dep71892', )(in0Dep71892)
Res51788 = keras.layers.Reshape((1, 1), name = 'Res51788', )(Dep71892)
Fla27543 = keras.layers.Flatten(name = 'Fla27543', )(Res51788)
Con11570 = keras.layers.Concatenate(axis=1, name = 'Con11570', )([Fla27543,in0Con11570])
Glo25521 = keras.layers.GlobalAveragePooling1D(name = 'Glo25521', )(in0Glo25521)
Mas14362 = keras.layers.Masking(mask_value=2, name = 'Mas14362', )(Glo25521)
Sub57005 = keras.layers.Subtract(name = 'Sub57005', )([Con11570,Mas14362])
Res44855 = keras.layers.Reshape((2, 1), name = 'Res44855', )(Sub57005)
Res81819 = keras.layers.Reshape((2, 1, 1), name = 'Res81819', )(Res44855)
Con76688 = keras.layers.Conv2DTranspose(4, (2, 1),strides=(1, 1), padding='valid', name = 'Con76688', )(Res81819)
model = tf.keras.models.Model(inputs=[in0Dep71892,in0Con11570,in0Glo25521], outputs=Con76688)
w = model.get_layer('Dep71892').get_weights() 
w[0] = np.array([[[[0.3788]]]])
w[1] = np.array([0])
model.get_layer('Dep71892').set_weights(w) 
w = model.get_layer('Con76688').get_weights() 
w[0] = np.array([[[[0.7324], [0.0451], [0.32], [0.384]]], [[[0.8892], [0.0979], [0.3386], [0.9585]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con76688').set_weights(w) 
in0Dep71892 = tf.constant([[[[0.5953]]]])
in0Con11570 = tf.constant([[0.4391]])
in0Glo25521 = tf.constant([[[1.489, 1.8042]]])
print (np.array2string(model.predict([in0Dep71892,in0Con11570,in0Glo25521],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con76688.png')

LDep71892 = depthwise_conv2D_layer([[[[0.5953]]]], 1, 1,[[[[0.3788]]]],[0], 1, 1, true, Dep71892), 
LRes51788 = reshape_layer(Dep71892, [1, 1], Res51788), 
LFla27543 = flatten_layer(Res51788, Fla27543), 
LCon11570 = concatenate_layer([Fla27543,[[0.4391]]], 1, Con11570), 
LGlo25521 = global_average_pooling1D_layer([[[1.489, 1.8042]]], Glo25521), 
LMas14362 = masking_layer(Glo25521, 2, Mas14362), 
LSub57005 = subtract_layer(Con11570,Mas14362, Sub57005), 
LRes44855 = reshape_layer(Sub57005, [2, 1], Res44855), 
LRes81819 = reshape_layer(Res44855, [2, 1, 1], Res81819), 
LCon76688 = conv2D_transpose_layer(Res81819, 2, 1,[[[[0.7324], [0.0451], [0.32], [0.384]]], [[[0.8892], [0.0979], [0.3386], [0.9585]]]],[0, 0, 0, 0], 1, 1, false, Con76688), 
exec_layers([LDep71892,LRes51788,LFla27543,LCon11570,LGlo25521,LMas14362,LSub57005,LRes44855,LRes81819,LCon76688],["Dep71892","Res51788","Fla27543","Con11570","Glo25521","Mas14362","Sub57005","Res44855","Res81819","Con76688"],Con76688,"Con76688")

Actual (Unparsed): [[[[-0.9253876, -0.0569839, -0.4043201, -0.4851841]], [[-2.1233038, -0.1852627, -0.8646532, -1.7352635]], [[-1.2138470, -0.1336433, -0.4622229, -1.3084484]]]]

Expected (Unparsed): [[[[-0.9253876636640002,-0.056983866236000005,-0.40432011520000005,-0.48518413824000006]],[[-2.123303760112,-0.18526269524400002,-0.864653221896,-1.73526349506]],[[-1.21384692,-0.13364329,-0.46222286,-1.30844835]]]]

Actual:   [[[[-0.9253, -0.0569, -0.4043, -0.4851]], [[-2.1233, -0.1852, -0.8646, -1.7352]], [[-1.2138, -0.1336, -0.4622, -1.3084]]]]

Expected: [[[[-0.9253, -0.0569, -0.4043, -0.4851]], [[-2.1233, -0.1852, -0.8646, -1.7352]], [[-1.2138, -0.1336, -0.4622, -1.3084]]]]