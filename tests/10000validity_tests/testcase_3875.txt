import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con71756 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Mul62635 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Mul62635 = tf.keras.layers.Input(shape=([1, 2, 1]))

Con71756 = keras.layers.Conv3DTranspose(4, (1, 2, 2),strides=(1, 1, 1), padding='valid', name = 'Con71756', )(in0Con71756)
Res88985 = keras.layers.Reshape((1, 3, 12), name = 'Res88985', )(Con71756)
Res80489 = keras.layers.Reshape((1, 36), name = 'Res80489', )(Res88985)
Mul62635 = keras.layers.Multiply(name = 'Mul62635', )([in0Mul62635,in1Mul62635])
Res78579 = keras.layers.Reshape((1, 2), name = 'Res78579', )(Mul62635)
Dot6260 = keras.layers.Dot(axes=(1, 1), name = 'Dot6260', )([Res80489,Res78579])
Res8828 = keras.layers.Reshape((36, 2, 1), name = 'Res8828', )(Dot6260)
Sep59714 = keras.layers.SeparableConv2D(3, (31, 2),strides=(4, 4), padding='valid', name = 'Sep59714', )(Res8828)
model = tf.keras.models.Model(inputs=[in0Con71756,in0Mul62635,in1Mul62635], outputs=Sep59714)
w = model.get_layer('Con71756').get_weights() 
w[0] = np.array([[[[[0.1597], [0.3142], [0.0755], [0.5067]], [[0.8393], [0.6713], [0.3898], [0.9356]]], [[[0.398], [0.9549], [0.1241], [0.4599]], [[0.6813], [0.2563], [0.6751], [0.7437]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con71756').set_weights(w) 
w = model.get_layer('Sep59714').get_weights() 
w[0] = np.array([[[[0.792]], [[0.2634]]], [[[0.3685]], [[0.0709]]], [[[0.9466]], [[0.7124]]], [[[0.861]], [[0.3338]]], [[[0.0804]], [[0.4828]]], [[[0.4383]], [[0.4958]]], [[[0.3283]], [[0.5006]]], [[[0.4851]], [[0.7403]]], [[[0.7509]], [[0.2905]]], [[[0.8322]], [[0.6549]]], [[[0.7127]], [[0.5002]]], [[[0.7891]], [[0.8019]]], [[[0.8226]], [[0.6272]]], [[[0.2976]], [[0.4666]]], [[[0.7875]], [[0.5583]]], [[[0.9462]], [[0.7162]]], [[[0.9733]], [[0.3002]]], [[[0.9901]], [[0.7481]]], [[[0.0797]], [[0.4585]]], [[[0.5786]], [[0.2625]]], [[[0.0944]], [[0.6048]]], [[[0.1111]], [[0.2557]]], [[[0.6116]], [[0.6603]]], [[[0.0101]], [[0.197]]], [[[0.6777]], [[0.8204]]], [[[0.234]], [[0.0263]]], [[[0.554]], [[0.3462]]], [[[0.53]], [[0.7888]]], [[[0.1783]], [[0.7575]]], [[[0.7758]], [[0.0105]]], [[[0.6477]], [[0.5754]]]])
w[1] = np.array([[[[0.2413, 0.1175, 0.3474]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep59714').set_weights(w) 
in0Con71756 = tf.constant([[[[[0.6063], [0.0115]], [[0.6699], [0.1846]]]]])
in0Mul62635 = tf.constant([[[[0.985], [0.1893]]]])
in1Mul62635 = tf.constant([[[[0.8483], [0.6061]]]])
print (np.array2string(model.predict([in0Con71756,in0Mul62635,in1Mul62635],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sep59714.png')

LCon71756 = conv3D_transpose_layer([[[[[0.6063], [0.0115]], [[0.6699], [0.1846]]]]], 1, 2, 2,[[[[[0.1597], [0.3142], [0.0755], [0.5067]], [[0.8393], [0.6713], [0.3898], [0.9356]]], [[[0.398], [0.9549], [0.1241], [0.4599]], [[0.6813], [0.2563], [0.6751], [0.7437]]]]],[0, 0, 0, 0], 1, 1, 1, false, Con71756), 
LRes88985 = reshape_layer(Con71756, [1, 3, 12], Res88985), 
LRes80489 = reshape_layer(Res88985, [1, 36], Res80489), 
LMul62635 = multiply_layer([[[[[0.985], [0.1893]]]], [[[[0.8483], [0.6061]]]]], Mul62635), 
LRes78579 = reshape_layer(Mul62635, [1, 2], Res78579), 
LDot6260 = dot_layer(Res80489,Res78579, 1, 1, Dot6260), 
LRes8828 = reshape_layer(Dot6260, [36, 2, 1], Res8828), 
LSep59714 = separable_conv2D_layer(Res8828, 31, 2,[[[[[0.792]], [[0.2634]]], [[[0.3685]], [[0.0709]]], [[[0.9466]], [[0.7124]]], [[[0.861]], [[0.3338]]], [[[0.0804]], [[0.4828]]], [[[0.4383]], [[0.4958]]], [[[0.3283]], [[0.5006]]], [[[0.4851]], [[0.7403]]], [[[0.7509]], [[0.2905]]], [[[0.8322]], [[0.6549]]], [[[0.7127]], [[0.5002]]], [[[0.7891]], [[0.8019]]], [[[0.8226]], [[0.6272]]], [[[0.2976]], [[0.4666]]], [[[0.7875]], [[0.5583]]], [[[0.9462]], [[0.7162]]], [[[0.9733]], [[0.3002]]], [[[0.9901]], [[0.7481]]], [[[0.0797]], [[0.4585]]], [[[0.5786]], [[0.2625]]], [[[0.0944]], [[0.6048]]], [[[0.1111]], [[0.2557]]], [[[0.6116]], [[0.6603]]], [[[0.0101]], [[0.197]]], [[[0.6777]], [[0.8204]]], [[[0.234]], [[0.0263]]], [[[0.554]], [[0.3462]]], [[[0.53]], [[0.7888]]], [[[0.1783]], [[0.7575]]], [[[0.7758]], [[0.0105]]], [[[0.6477]], [[0.5754]]]],[[[[0.2413, 0.1175, 0.3474]]]]],[0, 0, 0], 4, 4, false, Sep59714), 
exec_layers([LCon71756,LRes88985,LRes80489,LMul62635,LRes78579,LDot6260,LRes8828,LSep59714],["Con71756","Res88985","Res80489","Mul62635","Res78579","Dot6260","Res8828","Sep59714"],Sep59714,"Sep59714")

Actual (Unparsed): [[[[1.3393794, 0.6522050, 1.9283066]], [[1.6047120, 0.7814076, 2.3103065]]]]

Expected (Unparsed): [[[[1.3393793752366978,0.6522050418164611,1.9283066512939446]],[[1.604712035307387,0.7814076425553997,2.3103065108403897]]]]

Actual:   [[[[1.3394, 0.6523, 1.9284]], [[1.6048, 0.7815, 2.3104]]]]

Expected: [[[[1.3394, 0.6523, 1.9284]], [[1.6048, 0.7815, 2.3104]]]]