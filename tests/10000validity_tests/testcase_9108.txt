import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Zer58040 = tf.keras.layers.Input(shape=([1, 3, 4]))
in0Con84648 = tf.keras.layers.Input(shape=([3, 3, 1, 3]))
in0Sub8366 = tf.keras.layers.Input(shape=([3]))
in1Sub8366 = tf.keras.layers.Input(shape=([3]))

Zer58040 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer58040', )(in0Zer58040)
Res9701 = keras.layers.Reshape((3, 20), name = 'Res9701', )(Zer58040)
Sep35902 = keras.layers.SeparableConv1D(2, (2),strides=(3), padding='same', name = 'Sep35902', )(Res9701)
Res54789 = keras.layers.Reshape((1, 2, 1), name = 'Res54789', )(Sep35902)
Res79732 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res79732', )(Res54789)
Zer69939 = keras.layers.ZeroPadding3D(padding=((2, 0), (1, 0), (0, 0)), name = 'Zer69939', )(Res79732)
Con84648 = keras.layers.Concatenate(axis=4, name = 'Con84648', )([Zer69939,in0Con84648])
Sub8366 = keras.layers.Subtract(name = 'Sub8366', )([in0Sub8366,in1Sub8366])
Res89152 = keras.layers.Reshape((3, 1), name = 'Res89152', )(Sub8366)
PRe68710 = keras.layers.PReLU(name = 'PRe68710', )(Res89152)
Res67554 = keras.layers.Reshape((3, 1, 1), name = 'Res67554', )(PRe68710)
Res33757 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res33757', )(Res67554)
Con11950 = keras.layers.Conv3DTranspose(4, (3, 1, 1),strides=(1, 1, 1), padding='same', name = 'Con11950', )(Res33757)
Zer70492 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer70492', )(Con11950)
Min80575 = keras.layers.Minimum(name = 'Min80575', )([Con84648,Zer70492])
model = tf.keras.models.Model(inputs=[in0Zer58040,in0Con84648,in0Sub8366,in1Sub8366], outputs=Min80575)
w = model.get_layer('Sep35902').get_weights() 
w[0] = np.array([[[0.6896], [0.8339], [0.7807], [0.7166], [0.3569], [0.9877], [0.8783], [0.4474], [0.8959], [0.5858], [0.1055], [0.9923], [0.4321], [0.3168], [0.6036], [0.9097], [0.011], [0.0878], [0.7308], [0.0014]], [[0.7875], [0.4804], [0.062], [0.4301], [0.6077], [0.2792], [0.557], [0.3417], [0.723], [0.4801], [0.4878], [0.1156], [0.5896], [0.9383], [0.0733], [0.8837], [0.4503], [0.3476], [0.1493], [0.756]]])
w[1] = np.array([[[0.0601, 0.5707], [0.2862, 0.6161], [0.12, 0.2764], [0.8501, 0.8164], [0.6038, 0.7967], [0.6808, 0.5571], [0.4221, 0.7201], [0.8223, 0.4259], [0.9155, 0.2554], [0.7047, 0.8855], [0.1216, 0.8162], [0.889, 0.5985], [0.8006, 0.0202], [0.5611, 0.557], [0.0622, 0.973], [0.5608, 0.443], [0.3319, 0.6394], [0.7737, 0.3501], [0.8292, 0.831], [0.7826, 0.9829]]])
w[2] = np.array([0, 0])
model.get_layer('Sep35902').set_weights(w) 
w = model.get_layer('PRe68710').get_weights() 
w[0] = np.array([[0.0782], [0.4621], [0.8679]])
model.get_layer('PRe68710').set_weights(w) 
w = model.get_layer('Con11950').get_weights() 
w[0] = np.array([[[[[0.1974], [0.5261], [0.7035], [0.7321]]]], [[[[0.1508], [0.0629], [0.8894], [0.0008]]]], [[[[0.4537], [0.5609], [0.9681], [0.7644]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con11950').set_weights(w) 
in0Zer58040 = tf.constant([[[[1.1608, 1.9025, 1.0766, 1.0194], [1.4381, 1.2455, 1.0268, 1.3398], [1.9046, 1.8574, 1.5647, 1.3992]]]])
in0Con84648 = tf.constant([[[[[0.7296, 0.3373, 0.7326]], [[0.0902, 0.6302, 0.3722]], [[0.6209, 0.5383, 0.465]]], [[[0.1366, 0.3919, 0.2028]], [[0.9807, 0.206, 0.1587]], [[0.1687, 0.5923, 0.8526]]], [[[0.2584, 0.3823, 0.6188]], [[0.5849, 0.7533, 0.5222]], [[0.9365, 0.9054, 0.2963]]]]])
in0Sub8366 = tf.constant([[0.1611, 0.6361, 0.0597]])
in1Sub8366 = tf.constant([[0.4857, 0.4476, 0.2407]])
print (np.array2string(model.predict([in0Zer58040,in0Con84648,in0Sub8366,in1Sub8366],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min80575.png')

LZer58040 = zero_padding2D_layer([[[[1.1608, 1.9025, 1.0766, 1.0194], [1.4381, 1.2455, 1.0268, 1.3398], [1.9046, 1.8574, 1.5647, 1.3992]]]], 1, 1, 1, 1, Zer58040), 
LRes9701 = reshape_layer(Zer58040, [3, 20], Res9701), 
LSep35902 = separable_conv1D_layer(Res9701, 2,[[[[0.6896], [0.8339], [0.7807], [0.7166], [0.3569], [0.9877], [0.8783], [0.4474], [0.8959], [0.5858], [0.1055], [0.9923], [0.4321], [0.3168], [0.6036], [0.9097], [0.011], [0.0878], [0.7308], [0.0014]], [[0.7875], [0.4804], [0.062], [0.4301], [0.6077], [0.2792], [0.557], [0.3417], [0.723], [0.4801], [0.4878], [0.1156], [0.5896], [0.9383], [0.0733], [0.8837], [0.4503], [0.3476], [0.1493], [0.756]]],[[[0.0601, 0.5707], [0.2862, 0.6161], [0.12, 0.2764], [0.8501, 0.8164], [0.6038, 0.7967], [0.6808, 0.5571], [0.4221, 0.7201], [0.8223, 0.4259], [0.9155, 0.2554], [0.7047, 0.8855], [0.1216, 0.8162], [0.889, 0.5985], [0.8006, 0.0202], [0.5611, 0.557], [0.0622, 0.973], [0.5608, 0.443], [0.3319, 0.6394], [0.7737, 0.3501], [0.8292, 0.831], [0.7826, 0.9829]]]],[0, 0], 3, true, Sep35902), 
LRes54789 = reshape_layer(Sep35902, [1, 2, 1], Res54789), 
LRes79732 = reshape_layer(Res54789, [1, 2, 1, 1], Res79732), 
LZer69939 = zero_padding3D_layer(Res79732, 2, 0, 1, 0, 0, 0, Zer69939), 
LCon84648 = concatenate_layer([Zer69939,[[[[[0.7296, 0.3373, 0.7326]], [[0.0902, 0.6302, 0.3722]], [[0.6209, 0.5383, 0.465]]], [[[0.1366, 0.3919, 0.2028]], [[0.9807, 0.206, 0.1587]], [[0.1687, 0.5923, 0.8526]]], [[[0.2584, 0.3823, 0.6188]], [[0.5849, 0.7533, 0.5222]], [[0.9365, 0.9054, 0.2963]]]]]], 4, Con84648), 
LSub8366 = subtract_layer([[0.1611, 0.6361, 0.0597]], [[0.4857, 0.4476, 0.2407]], Sub8366), 
LRes89152 = reshape_layer(Sub8366, [3, 1], Res89152), 
LPRe68710 = prelu_layer(Res89152, [[0.0782], [0.4621], [0.8679]], PRe68710), 
LRes67554 = reshape_layer(PRe68710, [3, 1, 1], Res67554), 
LRes33757 = reshape_layer(Res67554, [3, 1, 1, 1], Res33757), 
LCon11950 = conv3D_transpose_layer(Res33757, 3, 1, 1,[[[[[0.1974], [0.5261], [0.7035], [0.7321]]]], [[[[0.1508], [0.0629], [0.8894], [0.0008]]]], [[[[0.4537], [0.5609], [0.9681], [0.7644]]]]],[0, 0, 0, 0], 1, 1, 1, true, Con11950), 
LZer70492 = zero_padding3D_layer(Con11950, 0, 0, 2, 0, 0, 0, Zer70492), 
LMin80575 = minimum_layer([Con84648,Zer70492], Min80575), 
exec_layers([LZer58040,LRes9701,LSep35902,LRes54789,LRes79732,LZer69939,LCon84648,LSub8366,LRes89152,LPRe68710,LRes67554,LRes33757,LCon11950,LZer70492,LMin80575],["Zer58040","Res9701","Sep35902","Res54789","Res79732","Zer69939","Con84648","Sub8366","Res89152","PRe68710","Res67554","Res33757","Con11950","Zer70492","Min80575"],Min80575,"Min80575")

Actual (Unparsed): [[[[[0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0975732, 0.1100335, 0.1379805]]], [[[0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[-0.0141003, -0.0850261, 0.0325652, -0.1342580]]], [[[0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000, 0.0000000]], [[0.0618333, 0.0958487, 0.0427711, 0.1439637]]]]]

Expected (Unparsed): [[[[[0,0,0,0]],[[0,0,0,0]],[[0,0.097573214012,0.110033469432,0.137980543024]]],[[[0,0,0,0]],[[0,0,0,0]],[[-0.014100340024000003,-0.085026074938,0.03256517601799998,-0.134258031358]]],[[[0,0,0,0]],[[0,0,0,0]],[[0.061833293080000004,0.09584869529,0.042771092940000005,0.14396372808000002]]]]]

Actual:   [[[[[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0, 0.0976, 0.1101, 0.138]]], [[[0, 0, 0, 0]], [[0, 0, 0, 0]], [[-0.0141, -0.085, 0.0326, -0.1342]]], [[[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0.0619, 0.0959, 0.0428, 0.144]]]]]

Expected: [[[[[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0, 0.0976, 0.1101, 0.138]]], [[[0, 0, 0, 0]], [[0, 0, 0, 0]], [[-0.0141, -0.085, 0.0326, -0.1342]]], [[[0, 0, 0, 0]], [[0, 0, 0, 0]], [[0.0619, 0.0959, 0.0428, 0.144]]]]]