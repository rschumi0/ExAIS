import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot11837 = tf.keras.layers.Input(shape=([2]))
in1Dot11837 = tf.keras.layers.Input(shape=([2]))
in0Add36659 = tf.keras.layers.Input(shape=([2, 1]))
in1Add36659 = tf.keras.layers.Input(shape=([2, 1]))
in0Con71898 = tf.keras.layers.Input(shape=([3, 2]))
in0Dot80459 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot80459 = tf.keras.layers.Input(shape=([2, 2]))
in0Sub99204 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub99204 = tf.keras.layers.Input(shape=([3, 2]))
in0Con42355 = tf.keras.layers.Input(shape=([3, 2]))
in0Add42489 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Add42489 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con98738 = tf.keras.layers.Input(shape=([3, 2]))
in0Per83638 = tf.keras.layers.Input(shape=([4, 3]))

Dot11837 = keras.layers.Dot(axes=(1, 1), name = 'Dot11837', )([in0Dot11837,in1Dot11837])
Res36870 = keras.layers.Reshape((1, 1), name = 'Res36870', )(Dot11837)
Zer91104 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer91104', )(Res36870)
Add36659 = keras.layers.Add(name = 'Add36659', )([in0Add36659,in1Add36659])
Ave60685 = keras.layers.Average(name = 'Ave60685', )([Zer91104,Add36659])
Res14855 = keras.layers.Reshape((2, 1, 1), name = 'Res14855', )(Ave60685)
Res61119 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res61119', )(Res14855)
Con59630 = keras.layers.Conv3D(2, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con59630', )(Res61119)
Res37223 = keras.layers.Reshape((2, 1, 2), name = 'Res37223', )(Con59630)
Res67472 = keras.layers.Reshape((2, 2), name = 'Res67472', )(Res37223)
Zer76998 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer76998', )(Res67472)
Con71898 = keras.layers.Concatenate(axis=2, name = 'Con71898', )([Zer76998,in0Con71898])
Dot80459 = keras.layers.Dot(axes=(2, 1), name = 'Dot80459', )([in0Dot80459,in1Dot80459])
Zer45314 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer45314', )(Dot80459)
Sub99204 = keras.layers.Subtract(name = 'Sub99204', )([in0Sub99204,in1Sub99204])
Sof92975 = keras.layers.Softmax(axis=1, name = 'Sof92975', )(Sub99204)
Max13760 = keras.layers.Maximum(name = 'Max13760', )([Zer45314,Sof92975])
Con42355 = keras.layers.Concatenate(axis=2, name = 'Con42355', )([Max13760,in0Con42355])
Add42489 = keras.layers.Add(name = 'Add42489', )([in0Add42489,in1Add42489])
Res22659 = keras.layers.Reshape((2, 2), name = 'Res22659', )(Add42489)
Zer98715 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer98715', )(Res22659)
Con98738 = keras.layers.Concatenate(axis=2, name = 'Con98738', )([Zer98715,in0Con98738])
Per83638 = keras.layers.Permute((2,1), name = 'Per83638',)(in0Per83638)
Mul39686 = keras.layers.Multiply(name = 'Mul39686', )([Con98738,Per83638])
Up_76140 = keras.layers.UpSampling1D(size=(1), name = 'Up_76140', )(Mul39686)
Min95681 = keras.layers.Minimum(name = 'Min95681', )([Con42355,Up_76140])
Sub58358 = keras.layers.Subtract(name = 'Sub58358', )([Con71898,Min95681])
model = tf.keras.models.Model(inputs=[in0Dot11837,in1Dot11837,in0Add36659,in1Add36659,in0Con71898,in0Dot80459,in1Dot80459,in0Sub99204,in1Sub99204,in0Con42355,in0Add42489,in1Add42489,in0Con98738,in0Per83638], outputs=Sub58358)
w = model.get_layer('Con59630').get_weights() 
w[0] = np.array([[[[[0.1109, 0.9839]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con59630').set_weights(w) 
in0Dot11837 = tf.constant([[0.3853, 0.5653]])
in1Dot11837 = tf.constant([[0.1543, 0.2095]])
in0Add36659 = tf.constant([[[0.5599], [0.0214]]])
in1Add36659 = tf.constant([[[0.2481], [0.0923]]])
in0Con71898 = tf.constant([[[0.5831, 0.9222], [0.2336, 0.8186], [0.5004, 0.8762]]])
in0Dot80459 = tf.constant([[[0.8946, 0.4934], [0.971, 0.2617]]])
in1Dot80459 = tf.constant([[[0.985, 0.2535], [0.5092, 0.1332]]])
in0Sub99204 = tf.constant([[[0.5042, 0.66], [0.1325, 0.3807], [0.3255, 0.949]]])
in1Sub99204 = tf.constant([[[0.737, 0.3218], [0.5422, 0.6949], [0.5327, 0.0116]]])
in0Con42355 = tf.constant([[[0.934, 0.2554], [0.2804, 0.4557], [0.7261, 0.2097]]])
in0Add42489 = tf.constant([[[[0.544, 0.3926]], [[0.9329, 0.7215]]]])
in1Add42489 = tf.constant([[[[0.299, 0.5754]], [[0.2025, 0.5863]]]])
in0Con98738 = tf.constant([[[0.8434, 0.6421], [0.3601, 0.9092], [0.4197, 0.0001]]])
in0Per83638 = tf.constant([[[1.2547, 1.3762, 1.7072], [1.3354, 1.8195, 1.4628], [1.6642, 1.1868, 1.2156], [1.8363, 1.1464, 1.1837]]])
print (np.array2string(model.predict([in0Dot11837,in1Dot11837,in0Add36659,in1Add36659,in0Con71898,in0Dot80459,in1Dot80459,in0Sub99204,in1Sub99204,in0Con42355,in0Add42489,in1Add42489,in0Con98738,in0Per83638],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub58358.png')

LDot11837 = dot_layer([[0.3853, 0.5653]], [[0.1543, 0.2095]], 1, 1, Dot11837), 
LRes36870 = reshape_layer(Dot11837, [1, 1], Res36870), 
LZer91104 = zero_padding1D_layer(Res36870, 1, 0, Zer91104), 
LAdd36659 = add_layer([[[[0.5599], [0.0214]]], [[[0.2481], [0.0923]]]], Add36659), 
LAve60685 = average_layer([Zer91104,Add36659], Ave60685), 
LRes14855 = reshape_layer(Ave60685, [2, 1, 1], Res14855), 
LRes61119 = reshape_layer(Res14855, [2, 1, 1, 1], Res61119), 
LCon59630 = conv3D_layer(Res61119, 1, 1, 1,[[[[[0.1109, 0.9839]]]]],[0, 0], 1, 1, 1, true, 1, 1, 1, Con59630), 
LRes37223 = reshape_layer(Con59630, [2, 1, 2], Res37223), 
LRes67472 = reshape_layer(Res37223, [2, 2], Res67472), 
LZer76998 = zero_padding1D_layer(Res67472, 1, 0, Zer76998), 
LCon71898 = concatenate_layer([Zer76998,[[[0.5831, 0.9222], [0.2336, 0.8186], [0.5004, 0.8762]]]], 2, Con71898), 
LDot80459 = dot_layer([[[0.8946, 0.4934], [0.971, 0.2617]]], [[[0.985, 0.2535], [0.5092, 0.1332]]], 2, 1, Dot80459), 
LZer45314 = zero_padding1D_layer(Dot80459, 1, 0, Zer45314), 
LSub99204 = subtract_layer([[[0.5042, 0.66], [0.1325, 0.3807], [0.3255, 0.949]]], [[[0.737, 0.3218], [0.5422, 0.6949], [0.5327, 0.0116]]], Sub99204), 
LSof92975 = softmax_layer(Sub99204, 1, Sof92975), 
LMax13760 = maximum_layer([Zer45314,Sof92975], Max13760), 
LCon42355 = concatenate_layer([Max13760,[[[0.934, 0.2554], [0.2804, 0.4557], [0.7261, 0.2097]]]], 2, Con42355), 
LAdd42489 = add_layer([[[[[0.544, 0.3926]], [[0.9329, 0.7215]]]], [[[[0.299, 0.5754]], [[0.2025, 0.5863]]]]], Add42489), 
LRes22659 = reshape_layer(Add42489, [2, 2], Res22659), 
LZer98715 = zero_padding1D_layer(Res22659, 1, 0, Zer98715), 
LCon98738 = concatenate_layer([Zer98715,[[[0.8434, 0.6421], [0.3601, 0.9092], [0.4197, 0.0001]]]], 2, Con98738), 
LPer83638 = permute_layer([[[1.2547, 1.3762, 1.7072], [1.3354, 1.8195, 1.4628], [1.6642, 1.1868, 1.2156], [1.8363, 1.1464, 1.1837]]], 2,1, Per83638), 
LMul39686 = multiply_layer([Con98738,Per83638], Mul39686), 
LUp_76140 = up_sampling1D_layer(Mul39686, 1, Up_76140), 
LMin95681 = minimum_layer([Con42355,Up_76140], Min95681), 
LSub58358 = subtract_layer(Con71898,Min95681, Sub58358), 
exec_layers([LDot11837,LRes36870,LZer91104,LAdd36659,LAve60685,LRes14855,LRes61119,LCon59630,LRes37223,LRes67472,LZer76998,LCon71898,LDot80459,LZer45314,LSub99204,LSof92975,LMax13760,LCon42355,LAdd42489,LRes22659,LZer98715,LCon98738,LPer83638,LMul39686,LUp_76140,LMin95681,LSub58358],["Dot11837","Res36870","Zer91104","Add36659","Ave60685","Res14855","Res61119","Con59630","Res37223","Res67472","Zer76998","Con71898","Dot80459","Zer45314","Sub99204","Sof92975","Max13760","Con42355","Add42489","Res22659","Zer98715","Con98738","Per83638","Mul39686","Up_76140","Min95681","Sub58358"],Sub58358,"Sub58358")

Actual (Unparsed): [[[0.0000000, 0.0000000, -0.3509000, 0.6668000], [-1.0876167, 0.1049936, -0.0468000, 0.3629000], [-1.0735244, -0.4014269, -0.0097873, 0.8760817]]]

Expected (Unparsed): [[[0.0,0.0,-0.3509000000000001,0.6668000000000001],[-1.08761668,0.10499361999999995,-0.04679999999999998,0.3629],[-1.073524410337,-0.4014269222581608,-0.009787320000000044,0.87608163]]]

Actual:   [[[0, 0, -0.3509, 0.6668], [-1.0876, 0.105, -0.0468, 0.3629], [-1.0735, -0.4014, -0.0097, 0.8761]]]

Expected: [[[0, 0, -0.3509, 0.6669], [-1.0876, 0.105, -0.0467, 0.3629], [-1.0735, -0.4014, -0.0097, 0.8761]]]