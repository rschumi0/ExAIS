import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave51260 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave51260 = tf.keras.layers.Input(shape=([1, 2]))
in0Fla53426 = tf.keras.layers.Input(shape=([1]))
in0Con16236 = tf.keras.layers.Input(shape=([1]))
in0Con67414 = tf.keras.layers.Input(shape=([2, 1]))
in0Mas15975 = tf.keras.layers.Input(shape=([2]))
in0Con50923 = tf.keras.layers.Input(shape=([2, 1]))
in0Con72725 = tf.keras.layers.Input(shape=([2, 1]))

Ave51260 = keras.layers.Average(name = 'Ave51260', )([in0Ave51260,in1Ave51260])
Fla7243 = keras.layers.Flatten(name = 'Fla7243', )(Ave51260)
Fla53426 = keras.layers.Flatten(name = 'Fla53426', )(in0Fla53426)
Con16236 = keras.layers.Concatenate(axis=1, name = 'Con16236', )([Fla53426,in0Con16236])
Mul42332 = keras.layers.Multiply(name = 'Mul42332', )([Fla7243,Con16236])
Res71861 = keras.layers.Reshape((2, 1), name = 'Res71861', )(Mul42332)
Con67414 = keras.layers.Concatenate(axis=2, name = 'Con67414', )([Res71861,in0Con67414])
Mas15975 = keras.layers.Masking(mask_value=2, name = 'Mas15975', )(in0Mas15975)
Res93126 = keras.layers.Reshape((2, 1), name = 'Res93126', )(Mas15975)
Con50923 = keras.layers.Concatenate(axis=2, name = 'Con50923', )([Res93126,in0Con50923])
Con72725 = keras.layers.Conv1D(2, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con72725', )(in0Con72725)
Min60349 = keras.layers.Minimum(name = 'Min60349', )([Con50923,Con72725])
Mul24540 = keras.layers.Multiply(name = 'Mul24540', )([Con67414,Min60349])
model = tf.keras.models.Model(inputs=[in0Ave51260,in1Ave51260,in0Fla53426,in0Con16236,in0Con67414,in0Mas15975,in0Con50923,in0Con72725], outputs=Mul24540)
w = model.get_layer('Con72725').get_weights() 
w[0] = np.array([[[0.8501, 0.7407]]])
w[1] = np.array([0, 0])
model.get_layer('Con72725').set_weights(w) 
in0Ave51260 = tf.constant([[[0.3833, 0.9968]]])
in1Ave51260 = tf.constant([[[0.3939, 0.1971]]])
in0Fla53426 = tf.constant([[1.9937]])
in0Con16236 = tf.constant([[0.3503]])
in0Con67414 = tf.constant([[[0.1488], [0.7126]]])
in0Mas15975 = tf.constant([[1.3273, 1.1369]])
in0Con50923 = tf.constant([[[0.1668], [0.0981]]])
in0Con72725 = tf.constant([[[0.5073], [0.8711]]])
print (np.array2string(model.predict([in0Ave51260,in1Ave51260,in0Fla53426,in0Con16236,in0Con67414,in0Mas15975,in0Con50923,in0Con72725],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul24540.png')

LAve51260 = average_layer([[[[0.3833, 0.9968]]], [[[0.3939, 0.1971]]]], Ave51260), 
LFla7243 = flatten_layer(Ave51260, Fla7243), 
LFla53426 = flatten_layer([[1.9937]], Fla53426), 
LCon16236 = concatenate_layer([Fla53426,[[0.3503]]], 1, Con16236), 
LMul42332 = multiply_layer([Fla7243,Con16236], Mul42332), 
LRes71861 = reshape_layer(Mul42332, [2, 1], Res71861), 
LCon67414 = concatenate_layer([Res71861,[[[0.1488], [0.7126]]]], 2, Con67414), 
LMas15975 = masking_layer([[1.3273, 1.1369]], 2, Mas15975), 
LRes93126 = reshape_layer(Mas15975, [2, 1], Res93126), 
LCon50923 = concatenate_layer([Res93126,[[[0.1668], [0.0981]]]], 2, Con50923), 
LCon72725 = conv1D_layer([[[0.5073], [0.8711]]], 1,[[[0.8501, 0.7407]]],[0, 0], 1, true, 1, Con72725), 
LMin60349 = minimum_layer([Con50923,Con72725], Min60349), 
LMul24540 = multiply_layer([Con67414,Min60349], Mul24540), 
exec_layers([LAve51260,LFla7243,LFla53426,LCon16236,LMul42332,LRes71861,LCon67414,LMas15975,LRes93126,LCon50923,LCon72725,LMin60349,LMul24540],["Ave51260","Fla7243","Fla53426","Con16236","Mul42332","Res71861","Con67414","Mas15975","Res93126","Con50923","Con72725","Min60349","Mul24540"],Mul24540,"Mul24540")

Actual (Unparsed): [[[0.3341162, 0.0248198], [0.1548518, 0.0699061]]]

Expected (Unparsed): [[[0.3341161617029285,0.02481984],[0.15485175214964433,0.06990606]]]

Actual:   [[[0.3342, 0.0249], [0.1549, 0.07]]]

Expected: [[[0.3342, 0.0249], [0.1549, 0.07]]]