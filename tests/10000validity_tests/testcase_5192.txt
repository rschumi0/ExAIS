import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dep87744 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con59671 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in0Max54094 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Max54094 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))

Dep87744 = keras.layers.DepthwiseConv2D((2, 1),strides=(2, 2), padding='same', name = 'Dep87744', )(in0Dep87744)
Res93109 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res93109', )(Dep87744)
Zer78537 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (1, 0)), name = 'Zer78537', )(Res93109)
Con59671 = keras.layers.Concatenate(axis=4, name = 'Con59671', )([Zer78537,in0Con59671])
Max54094 = keras.layers.Maximum(name = 'Max54094', )([in0Max54094,in1Max54094])
ReL52253 = keras.layers.ReLU(max_value=9.228569132189019, negative_slope=0.8979269986986377, threshold=8.099474584973635, name = 'ReL52253', )(Max54094)
Ave47101 = keras.layers.Average(name = 'Ave47101', )([Con59671,ReL52253])
Res31962 = keras.layers.Reshape((2, 2, 4), name = 'Res31962', )(Ave47101)
Res44833 = keras.layers.Reshape((2, 8), name = 'Res44833', )(Res31962)
Per51818 = keras.layers.Permute((1,2), name = 'Per51818',)(Res44833)
Fla1942 = keras.layers.Flatten(name = 'Fla1942', )(Per51818)
model = tf.keras.models.Model(inputs=[in0Dep87744,in0Con59671,in0Max54094,in1Max54094], outputs=Fla1942)
w = model.get_layer('Dep87744').get_weights() 
w[0] = np.array([[[[0.889]]], [[[0.7744]]]])
w[1] = np.array([0])
model.get_layer('Dep87744').set_weights(w) 
in0Dep87744 = tf.constant([[[[0.9298], [0.0459]], [[0.1635], [0.3264]]]])
in0Con59671 = tf.constant([[[[[0.0934], [0.4381]], [[0.0577], [0.6529]]], [[[0.4288], [0.1847]], [[0.3726], [0.4563]]]]])
in0Max54094 = tf.constant([[[[[0.0783, 0.5671], [0.3193, 0.1994]], [[0.8021, 0.7644], [0.1936, 0.4549]]], [[[0.2999, 0.6602], [0.9033, 0.8266]], [[0.2733, 0.7712], [0.861, 0.0203]]]]])
in1Max54094 = tf.constant([[[[[0.7276, 0.625], [0.6201, 0.0748]], [[0.4842, 0.5022], [0.6809, 0.9608]]], [[[0.4781, 0.5773], [0.1441, 0.2064]], [[0.4243, 0.5578], [0.499, 0.7769]]]]])
print (np.array2string(model.predict([in0Dep87744,in0Con59671,in0Max54094,in1Max54094],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Fla1942.png')

LDep87744 = depthwise_conv2D_layer([[[[0.9298], [0.0459]], [[0.1635], [0.3264]]]], 2, 1,[[[[0.889]]], [[[0.7744]]]],[0], 2, 2, true, Dep87744), 
LRes93109 = reshape_layer(Dep87744, [1, 1, 1, 1], Res93109), 
LZer78537 = zero_padding3D_layer(Res93109, 1, 0, 1, 0, 1, 0, Zer78537), 
LCon59671 = concatenate_layer([Zer78537,[[[[[0.0934], [0.4381]], [[0.0577], [0.6529]]], [[[0.4288], [0.1847]], [[0.3726], [0.4563]]]]]], 4, Con59671), 
LMax54094 = maximum_layer([[[[[[0.0783, 0.5671], [0.3193, 0.1994]], [[0.8021, 0.7644], [0.1936, 0.4549]]], [[[0.2999, 0.6602], [0.9033, 0.8266]], [[0.2733, 0.7712], [0.861, 0.0203]]]]], [[[[[0.7276, 0.625], [0.6201, 0.0748]], [[0.4842, 0.5022], [0.6809, 0.9608]]], [[[0.4781, 0.5773], [0.1441, 0.2064]], [[0.4243, 0.5578], [0.499, 0.7769]]]]]], Max54094), 
LReL52253 = relu_layer(Max54094, 9.228569132189019, 0.8979269986986377, 8.099474584973635, ReL52253), 
LAve47101 = average_layer([Con59671,ReL52253], Ave47101), 
LRes31962 = reshape_layer(Ave47101, [2, 2, 4], Res31962), 
LRes44833 = reshape_layer(Res31962, [2, 8], Res44833), 
LPer51818 = permute_layer(Res44833, 1,2, Per51818), 
LFla1942 = flatten_layer(Per51818, Fla1942), 
exec_layers([LDep87744,LRes93109,LZer78537,LCon59671,LMax54094,LReL52253,LAve47101,LRes31962,LRes44833,LPer51818,LFla1942],["Dep87744","Res93109","Zer78537","Con59671","Max54094","ReL52253","Ave47101","Res31962","Res44833","Per51818","Fla1942"],Fla1942,"Fla1942")

Actual (Unparsed): [[-3.3097026, -3.3090663, -3.3579662, -3.3277951, -3.2762548, -3.2643308, -3.3306692, -2.8785543, -3.4217190, -3.1255628, -3.2308197, -3.1729052, -3.4458732, -3.1038278, -2.7732076, -3.0594187]]

Expected (Unparsed): [[-3.3097026104340705,-3.3090662654673104,-3.357966186614122,-3.3277951307903804,-3.276254829732546,-3.2643307536580157,-3.3306692058536838,-2.8785543223858094,-3.4217190035217255,-3.125562750290215,-3.230819723598395,-3.172905223998488,-3.4458732397867187,-3.10382780186244,-2.7732075796208715,-3.059418709916149]]

Actual:   [[-3.3097, -3.309, -3.3579, -3.3277, -3.2762, -3.2643, -3.3306, -2.8785, -3.4217, -3.1255, -3.2308, -3.1729, -3.4458, -3.1038, -2.7732, -3.0594]]

Expected: [[-3.3097, -3.309, -3.3579, -3.3277, -3.2762, -3.2643, -3.3306, -2.8785, -3.4217, -3.1255, -3.2308, -3.1729, -3.4458, -3.1038, -2.7732, -3.0594]]