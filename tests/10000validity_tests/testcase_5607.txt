import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave71875 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Ave71875 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Cro71786 = tf.keras.layers.Input(shape=([4, 1, 3]))

Ave71875 = keras.layers.Average(name = 'Ave71875', )([in0Ave71875,in1Ave71875])
Glo21593 = keras.layers.GlobalMaxPool3D(name = 'Glo21593', )(Ave71875)
Res76065 = keras.layers.Reshape((2, 1), name = 'Res76065', )(Glo21593)
Res13895 = keras.layers.Reshape((2, 1, 1), name = 'Res13895', )(Res76065)
Up_7830 = keras.layers.UpSampling2D(size=(2, 1), name = 'Up_7830', )(Res13895)
Res82086 = keras.layers.Reshape((4, 1), name = 'Res82086', )(Up_7830)
Cro71786 = keras.layers.Cropping2D(cropping=((3, 0), (0, 0)), name = 'Cro71786', )(in0Cro71786)
Res44834 = keras.layers.Reshape((1, 3), name = 'Res44834', )(Cro71786)
Fla223 = keras.layers.Flatten(name = 'Fla223', )(Res44834)
Res87349 = keras.layers.Reshape((3, 1), name = 'Res87349', )(Fla223)
Per83243 = keras.layers.Permute((1,2), name = 'Per83243',)(Res87349)
Zer12430 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer12430', )(Per83243)
Sub86892 = keras.layers.Subtract(name = 'Sub86892', )([Res82086,Zer12430])
model = tf.keras.models.Model(inputs=[in0Ave71875,in1Ave71875,in0Cro71786], outputs=Sub86892)
in0Ave71875 = tf.constant([[[[[0.3942, 0.1314]], [[0.3523, 0.4993]]]]])
in1Ave71875 = tf.constant([[[[[0.6729, 0.6536]], [[0.8606, 0.9105]]]]])
in0Cro71786 = tf.constant([[[[1.1841, 1.4221, 1.367]], [[1.1595, 1.9774, 1.5743]], [[1.3729, 1.6629, 1.7655]], [[1.6974, 1.6827, 1.9408]]]])
print (np.array2string(model.predict([in0Ave71875,in1Ave71875,in0Cro71786],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub86892.png')

LAve71875 = average_layer([[[[[[0.3942, 0.1314]], [[0.3523, 0.4993]]]]], [[[[[0.6729, 0.6536]], [[0.8606, 0.9105]]]]]], Ave71875), 
LGlo21593 = global_max_pool3D_layer(Ave71875, Glo21593), 
LRes76065 = reshape_layer(Glo21593, [2, 1], Res76065), 
LRes13895 = reshape_layer(Res76065, [2, 1, 1], Res13895), 
LUp_7830 = up_sampling2D_layer(Res13895, 2, 1, Up_7830), 
LRes82086 = reshape_layer(Up_7830, [4, 1], Res82086), 
LCro71786 = cropping2D_layer([[[[1.1841, 1.4221, 1.367]], [[1.1595, 1.9774, 1.5743]], [[1.3729, 1.6629, 1.7655]], [[1.6974, 1.6827, 1.9408]]]], 3, 0, 0, 0, Cro71786), 
LRes44834 = reshape_layer(Cro71786, [1, 3], Res44834), 
LFla223 = flatten_layer(Res44834, Fla223), 
LRes87349 = reshape_layer(Fla223, [3, 1], Res87349), 
LPer83243 = permute_layer(Res87349, 1,2, Per83243), 
LZer12430 = zero_padding1D_layer(Per83243, 1, 0, Zer12430), 
LSub86892 = subtract_layer(Res82086,Zer12430, Sub86892), 
exec_layers([LAve71875,LGlo21593,LRes76065,LRes13895,LUp_7830,LRes82086,LCro71786,LRes44834,LFla223,LRes87349,LPer83243,LZer12430,LSub86892],["Ave71875","Glo21593","Res76065","Res13895","Up_7830","Res82086","Cro71786","Res44834","Fla223","Res87349","Per83243","Zer12430","Sub86892"],Sub86892,"Sub86892")

Actual (Unparsed): [[[0.6064500], [-1.0909500], [-0.9778000], [-1.2359000]]]

Expected (Unparsed): [[[0.60645],[-1.0909499999999999],[-0.9778000000000001],[-1.2359]]]

Actual:   [[[0.6065], [-1.0909], [-0.9778], [-1.2359]]]

Expected: [[[0.6065], [-1.0909], [-0.9778], [-1.2359]]]