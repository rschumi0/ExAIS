import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add72691 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Add72691 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Con96836 = tf.keras.layers.Input(shape=([2, 3]))
in0Max61569 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Max61569 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con31392 = tf.keras.layers.Input(shape=([2, 1]))
in0Con13238 = tf.keras.layers.Input(shape=([2, 2]))
in0GRU16474 = tf.keras.layers.Input(shape=([2, 1]))
in0Con89311 = tf.keras.layers.Input(shape=([6]))

Add72691 = keras.layers.Add(name = 'Add72691', )([in0Add72691,in1Add72691])
Res18343 = keras.layers.Reshape((2, 1, 1), name = 'Res18343', )(Add72691)
Res22538 = keras.layers.Reshape((2, 1), name = 'Res22538', )(Res18343)
Con96836 = keras.layers.Concatenate(axis=2, name = 'Con96836', )([Res22538,in0Con96836])
Max61569 = keras.layers.Maximum(name = 'Max61569', )([in0Max61569,in1Max61569])
Loc41287 = keras.layers.LocallyConnected2D(3, (1, 1),strides=(1, 12), name = 'Loc41287', )(Max61569)
Res96230 = keras.layers.Reshape((2, 3), name = 'Res96230', )(Loc41287)
Con31392 = keras.layers.Concatenate(axis=2, name = 'Con31392', )([Res96230,in0Con31392])
Con13238 = keras.layers.Conv1D(4, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con13238', )(in0Con13238)
Add29849 = keras.layers.Add(name = 'Add29849', )([Con31392,Con13238])
Add16212 = keras.layers.Add(name = 'Add16212', )([Con96836,Add29849])
Fla12618 = keras.layers.Flatten(name = 'Fla12618', )(Add16212)
GRU16474 = keras.layers.GRU(2,reset_after=True, recurrent_activation='sigmoid', name = 'GRU16474', )(in0GRU16474)
Con89311 = keras.layers.Concatenate(axis=1, name = 'Con89311', )([GRU16474,in0Con89311])
Mul9643 = keras.layers.Multiply(name = 'Mul9643', )([Fla12618,Con89311])
model = tf.keras.models.Model(inputs=[in0Add72691,in1Add72691,in0Con96836,in0Max61569,in1Max61569,in0Con31392,in0Con13238,in0GRU16474,in0Con89311], outputs=Mul9643)
w = model.get_layer('Loc41287').get_weights() 
w[0] = np.array([[[0.8544, 0.0415, 0.0199], [0.3888, 0.6758, 0.8109]], [[0.0581, 0.7516, 0.3937], [0.9268, 0.7516, 0.2285]]])
w[1] = np.array([[[0, 0, 0]], [[0, 0, 0]]])
model.get_layer('Loc41287').set_weights(w) 
w = model.get_layer('Con13238').get_weights() 
w[0] = np.array([[[0.047, 0.4415, 0.677, 0.5064], [0.4755, 0.4591, 0.3092, 0.5396]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con13238').set_weights(w) 
w = model.get_layer('GRU16474').get_weights() 
w[0] = np.array([[5, 5, 9, 7, 2, 7]])
w[1] = np.array([[6, 2, 4, 8, 9, 1], [3, 9, 1, 5, 1, 2]])
w[2] = np.array([[6, 1, 6, 10, 3, 8], [3, 5, 9, 2, 5, 6]])
model.get_layer('GRU16474').set_weights(w) 
in0Add72691 = tf.constant([[[[[0.9751]]], [[[0.1799]]]]])
in1Add72691 = tf.constant([[[[[0.3085]]], [[[0.6184]]]]])
in0Con96836 = tf.constant([[[0.7094, 0.4021, 0.7213], [0.5913, 0.079, 0.0181]]])
in0Max61569 = tf.constant([[[[0.5315, 0.694]], [[0.1697, 0.8224]]]])
in1Max61569 = tf.constant([[[[0.7846, 0.2835]], [[0.9565, 0.3959]]]])
in0Con31392 = tf.constant([[[0.0301], [0.9213]]])
in0Con13238 = tf.constant([[[0.5105, 0.3365], [0.4956, 0.0827]]])
in0GRU16474 = tf.constant([[[6], [5]]])
in0Con89311 = tf.constant([[0.8393, 0.2696, 0.7637, 0.4634, 0.9127, 0.6704]])
print (np.array2string(model.predict([in0Add72691,in1Add72691,in0Con96836,in0Max61569,in1Max61569,in0Con31392,in0Con13238,in0GRU16474,in0Con89311],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul9643.png')

LAdd72691 = add_layer([[[[[[0.9751]]], [[[0.1799]]]]], [[[[[0.3085]]], [[[0.6184]]]]]], Add72691), 
LRes18343 = reshape_layer(Add72691, [2, 1, 1], Res18343), 
LRes22538 = reshape_layer(Res18343, [2, 1], Res22538), 
LCon96836 = concatenate_layer([Res22538,[[[0.7094, 0.4021, 0.7213], [0.5913, 0.079, 0.0181]]]], 2, Con96836), 
LMax61569 = maximum_layer([[[[[0.5315, 0.694]], [[0.1697, 0.8224]]]], [[[[0.7846, 0.2835]], [[0.9565, 0.3959]]]]], Max61569), 
LLoc41287 = locally_connected2D_layer(Max61569, 1, 1,[[[0.8544, 0.0415, 0.0199], [0.3888, 0.6758, 0.8109]], [[0.0581, 0.7516, 0.3937], [0.9268, 0.7516, 0.2285]]],[[[0, 0, 0]], [[0, 0, 0]]], 1, 12, Loc41287), 
LRes96230 = reshape_layer(Loc41287, [2, 3], Res96230), 
LCon31392 = concatenate_layer([Res96230,[[[0.0301], [0.9213]]]], 2, Con31392), 
LCon13238 = conv1D_layer([[[0.5105, 0.3365], [0.4956, 0.0827]]], 1,[[[0.047, 0.4415, 0.677, 0.5064], [0.4755, 0.4591, 0.3092, 0.5396]]],[0, 0, 0, 0], 1, false, 1, Con13238), 
LAdd29849 = add_layer([Con31392,Con13238], Add29849), 
LAdd16212 = add_layer([Con96836,Add29849], Add16212), 
LFla12618 = flatten_layer(Add16212, Fla12618), 
LGRU16474 = gru_layer([[[6], [5]]],[[5, 5, 9, 7, 2, 7]],[[6, 2, 4, 8, 9, 1], [3, 9, 1, 5, 1, 2]],[[6, 1, 6, 10, 3, 8], [3, 5, 9, 2, 5, 6]], true, GRU16474), 
LCon89311 = concatenate_layer([GRU16474,[[0.8393, 0.2696, 0.7637, 0.4634, 0.9127, 0.6704]]], 1, Con89311), 
LMul9643 = multiply_layer([Fla12618,Con89311], Mul9643), 
exec_layers([LAdd72691,LRes18343,LRes22538,LCon96836,LMax61569,LLoc41287,LRes96230,LCon31392,LCon13238,LAdd29849,LAdd16212,LFla12618,LGRU16474,LCon89311,LMul9643],["Add72691","Res18343","Res22538","Con96836","Max61569","Loc41287","Res96230","Con31392","Con13238","Add29849","Add16212","Fla12618","GRU16474","Con89311","Mul9643"],Mul9643,"Mul9643")

Actual (Unparsed): [[0.0000000, 0.0000000, 1.2003101, 0.3212264, 1.2820155, 1.0125736, 0.9168842, 0.8279418]]

Expected (Unparsed): [[4.2770919073120676e-15,5.510500589167576e-14,1.200310156892,0.32122640496000004,1.282015568274,1.012573583714,0.916884264023,0.8279418279040001]]

Actual:   [[0, 0, 1.2004, 0.3213, 1.2821, 1.0126, 0.9169, 0.828]]

Expected: [[0, 0, 1.2004, 0.3213, 1.2821, 1.0126, 0.9169, 0.828]]