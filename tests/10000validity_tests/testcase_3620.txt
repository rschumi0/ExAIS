import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dep24992 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con42554 = tf.keras.layers.Input(shape=([1, 1]))
in0Ave90936 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave90936 = tf.keras.layers.Input(shape=([1, 2]))

Dep24992 = keras.layers.DepthwiseConv2D((1, 2),strides=(1, 1), padding='same', name = 'Dep24992', )(in0Dep24992)
Res79408 = keras.layers.Reshape((1, 4), name = 'Res79408', )(Dep24992)
LST50099 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST50099', )(Res79408)
Res12812 = keras.layers.Reshape((1, 1), name = 'Res12812', )(LST50099)
Con42554 = keras.layers.Concatenate(axis=2, name = 'Con42554', )([Res12812,in0Con42554])
Ave90936 = keras.layers.Average(name = 'Ave90936', )([in0Ave90936,in1Ave90936])
Ave63960 = keras.layers.Average(name = 'Ave63960', )([Con42554,Ave90936])
Den44343 = keras.layers.Dense(4,name = 'Den44343', )(Ave63960)
model = tf.keras.models.Model(inputs=[in0Dep24992,in0Con42554,in0Ave90936,in1Ave90936], outputs=Den44343)
w = model.get_layer('Dep24992').get_weights() 
w[0] = np.array([[[[0.633], [0.7058]], [[0.2359], [0.0871]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep24992').set_weights(w) 
w = model.get_layer('LST50099').get_weights() 
w[0] = np.array([[7, 8, 7, 5], [6, 4, 1, 8], [7, 7, 10, 3], [6, 8, 6, 2]])
w[1] = np.array([[3, 6, 8, 1]])
w[2] = np.array([6, 9, 8, 8])
model.get_layer('LST50099').set_weights(w) 
w = model.get_layer('Den44343').get_weights() 
w[0] = np.array([[0.2066, 0.8273, 0.7365, 0.2752], [0.2275, 0.7364, 0.9244, 0.2487]])
w[1] = np.array([0.8023, 0.9463, 0.0222, 0.1491])
model.get_layer('Den44343').set_weights(w) 
in0Dep24992 = tf.constant([[[[0.8129, 0.6479], [0.8472, 0.2648]]]])
in0Con42554 = tf.constant([[[0.9035]]])
in0Ave90936 = tf.constant([[[0.0209, 0.3401]]])
in1Ave90936 = tf.constant([[[0.4973, 0.5879]]])
print (np.array2string(model.predict([in0Dep24992,in0Con42554,in0Ave90936,in1Ave90936],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Den44343.png')

LDep24992 = depthwise_conv2D_layer([[[[0.8129, 0.6479], [0.8472, 0.2648]]]], 1, 2,[[[[0.633], [0.7058]], [[0.2359], [0.0871]]]],[0, 0], 1, 1, true, Dep24992), 
LRes79408 = reshape_layer(Dep24992, [1, 4], Res79408), 
LLST50099 = lstm_layer(Res79408,[[7, 8, 7, 5], [6, 4, 1, 8], [7, 7, 10, 3], [6, 8, 6, 2]],[[3, 6, 8, 1]],[6, 9, 8, 8], LST50099), 
LRes12812 = reshape_layer(LST50099, [1, 1], Res12812), 
LCon42554 = concatenate_layer([Res12812,[[[0.9035]]]], 2, Con42554), 
LAve90936 = average_layer([[[[0.0209, 0.3401]]], [[[0.4973, 0.5879]]]], Ave90936), 
LAve63960 = average_layer([Con42554,Ave90936], Ave63960), 
LDen44343 = dense_layer(Ave63960, [[0.2066, 0.8273, 0.7365, 0.2752], [0.2275, 0.7364, 0.9244, 0.2487]],[0.8023, 0.9463, 0.0222, 0.1491], Den44343), 
exec_layers([LDep24992,LRes79408,LLST50099,LRes12812,LCon42554,LAve90936,LAve63960,LDen44343],["Dep24992","Res79408","LST50099","Res12812","Con42554","Ave90936","Ave63960","Den44343"],Den44343,"Den44343")

Actual (Unparsed): [[[1.0632908, 1.8720236, 1.0301291, 0.4595961]]]

Expected (Unparsed): [[[1.0632908288121183,1.872023627607771,1.0301291140252913,0.45959613753192147]]]

Actual:   [[[1.0633, 1.8721, 1.0302, 0.4596]]]

Expected: [[[1.0633, 1.8721, 1.0302, 0.4596]]]