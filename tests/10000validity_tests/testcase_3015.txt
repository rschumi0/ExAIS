import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0GRU36899 = tf.keras.layers.Input(shape=([1, 3]))
in0ReL90278 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Ave47973 = tf.keras.layers.Input(shape=([2, 1]))
in0Con7218 = tf.keras.layers.Input(shape=([1, 3]))

GRU36899 = keras.layers.GRU(1,reset_after=True, recurrent_activation='sigmoid', name = 'GRU36899', )(in0GRU36899)
Res35866 = keras.layers.Reshape((1, 1), name = 'Res35866', )(GRU36899)
ReL90278 = keras.layers.ReLU(max_value=2.0414899255653824, negative_slope=0.3767841901324053, threshold=9.483297280724884, name = 'ReL90278', input_shape=(1, 2, 1, 2))(in0ReL90278)
Res53171 = keras.layers.Reshape((1, 2, 2), name = 'Res53171', )(ReL90278)
Res31057 = keras.layers.Reshape((1, 4), name = 'Res31057', )(Res53171)
Dot90534 = keras.layers.Dot(axes=(2, 1), name = 'Dot90534', )([Res35866,Res31057])
Ave47973 = keras.layers.AveragePooling1D(pool_size=(2), strides=(11), padding='valid', name = 'Ave47973', )(in0Ave47973)
ReL7821 = keras.layers.ReLU(max_value=8.491183806121741, negative_slope=0.1707146974848702, threshold=5.855698104086508, name = 'ReL7821', )(Ave47973)
Con7218 = keras.layers.Concatenate(axis=2, name = 'Con7218', )([ReL7821,in0Con7218])
Mul98121 = keras.layers.Multiply(name = 'Mul98121', )([Dot90534,Con7218])
Loc45253 = keras.layers.LocallyConnected1D(4, (1),strides=(2), name = 'Loc45253', )(Mul98121)
model = tf.keras.models.Model(inputs=[in0GRU36899,in0ReL90278,in0Ave47973,in0Con7218], outputs=Loc45253)
w = model.get_layer('GRU36899').get_weights() 
w[0] = np.array([[1, 6, 5], [9, 2, 7], [2, 2, 2]])
w[1] = np.array([[5, 8, 3]])
w[2] = np.array([[1, 3, 1], [4, 5, 4]])
model.get_layer('GRU36899').set_weights(w) 
w = model.get_layer('Loc45253').get_weights() 
w[0] = np.array([[[0.67, 0.6837, 0.521, 0.3577], [0.8478, 0.6364, 0.349, 0.842], [0.0883, 0.6875, 0.6363, 0.7204], [0.9208, 0.9593, 0.2569, 0.5343]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc45253').set_weights(w) 
in0GRU36899 = tf.constant([[[1, 9, 6]]])
in0ReL90278 = tf.constant([[[[[0.4494, 0.8125]], [[0.7374, 0.6802]]]]])
in0Ave47973 = tf.constant([[[1.8582], [1.332]]])
in0Con7218 = tf.constant([[[0.7601, 0.2788, 0.6166]]])
print (np.array2string(model.predict([in0GRU36899,in0ReL90278,in0Ave47973,in0Con7218],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc45253.png')

LGRU36899 = gru_layer([[[1, 9, 6]]],[[1, 6, 5], [9, 2, 7], [2, 2, 2]],[[5, 8, 3]],[[1, 3, 1], [4, 5, 4]], true, GRU36899), 
LRes35866 = reshape_layer(GRU36899, [1, 1], Res35866), 
LReL90278 = relu_layer([[[[[0.4494, 0.8125]], [[0.7374, 0.6802]]]]], 2.0414899255653824, 0.3767841901324053, 9.483297280724884, ReL90278), 
LRes53171 = reshape_layer(ReL90278, [1, 2, 2], Res53171), 
LRes31057 = reshape_layer(Res53171, [1, 4], Res31057), 
LDot90534 = dot_layer(Res35866,Res31057, 2, 1, Dot90534), 
LAve47973 = average_pooling1D_layer([[[1.8582], [1.332]]], 2, 11, false, Ave47973), 
LReL7821 = relu_layer(Ave47973, 8.491183806121741, 0.1707146974848702, 5.855698104086508, ReL7821), 
LCon7218 = concatenate_layer([ReL7821,[[[0.7601, 0.2788, 0.6166]]]], 2, Con7218), 
LMul98121 = multiply_layer([Dot90534,Con7218], Mul98121), 
LLoc45253 = locally_connected1D_layer(Mul98121, 1,[[[0.67, 0.6837, 0.521, 0.3577], [0.8478, 0.6364, 0.349, 0.842], [0.0883, 0.6875, 0.6363, 0.7204], [0.9208, 0.9593, 0.2569, 0.5343]]],[[0, 0, 0, 0]], 2, Loc45253), 
exec_layers([LGRU36899,LRes35866,LReL90278,LRes53171,LRes31057,LDot90534,LAve47973,LReL7821,LCon7218,LMul98121,LLoc45253],["GRU36899","Res35866","ReL90278","Res53171","Res31057","Dot90534","Ave47973","ReL7821","Con7218","Mul98121","Loc45253"],Loc45253,"Loc45253")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000]]]

Expected (Unparsed): [[[0.0,0.0,0.0,0.0]]]

Actual:   [[[0, 0, 0, 0]]]

Expected: [[[0, 0, 0, 0]]]