import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add34950 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Add34950 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Sub79818 = tf.keras.layers.Input(shape=([2, 3, 2, 3]))
in1Sub79818 = tf.keras.layers.Input(shape=([2, 3, 2, 3]))
in0Con54230 = tf.keras.layers.Input(shape=([6, 1]))
in0Dot2569 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot2569 = tf.keras.layers.Input(shape=([3, 2]))
in0Con37195 = tf.keras.layers.Input(shape=([6, 2]))

Add34950 = keras.layers.Add(name = 'Add34950', )([in0Add34950,in1Add34950])
Res23940 = keras.layers.Reshape((1, 4), name = 'Res23940', )(Add34950)
Zer20544 = keras.layers.ZeroPadding1D(padding=((5, 0)), name = 'Zer20544', )(Res23940)
Sub79818 = keras.layers.Subtract(name = 'Sub79818', )([in0Sub79818,in1Sub79818])
Res21951 = keras.layers.Reshape((2, 3, 6), name = 'Res21951', )(Sub79818)
Glo45880 = keras.layers.GlobalMaxPool2D(name = 'Glo45880', )(Res21951)
Res80599 = keras.layers.Reshape((6, 1), name = 'Res80599', )(Glo45880)
Con54230 = keras.layers.Concatenate(axis=2, name = 'Con54230', )([Res80599,in0Con54230])
Dot2569 = keras.layers.Dot(axes=(1, 1), name = 'Dot2569', )([in0Dot2569,in1Dot2569])
Zer55841 = keras.layers.ZeroPadding1D(padding=((4, 0)), name = 'Zer55841', )(Dot2569)
Mul30441 = keras.layers.Multiply(name = 'Mul30441', )([Con54230,Zer55841])
Con37195 = keras.layers.Concatenate(axis=2, name = 'Con37195', )([Mul30441,in0Con37195])
Sub29010 = keras.layers.Subtract(name = 'Sub29010', )([Zer20544,Con37195])
Res74927 = keras.layers.Reshape((6, 4, 1), name = 'Res74927', )(Sub29010)
Dep26348 = keras.layers.DepthwiseConv2D((6, 4),strides=(6, 6), padding='same', name = 'Dep26348', )(Res74927)
Res35741 = keras.layers.Reshape((1, 1), name = 'Res35741', )(Dep26348)
GRU95706 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU95706', )(Res35741)
model = tf.keras.models.Model(inputs=[in0Add34950,in1Add34950,in0Sub79818,in1Sub79818,in0Con54230,in0Dot2569,in1Dot2569,in0Con37195], outputs=GRU95706)
w = model.get_layer('Dep26348').get_weights() 
w[0] = np.array([[[[0.2399]], [[0.7238]], [[0.8738]], [[0.0261]]], [[[0.1024]], [[0.3773]], [[0.8167]], [[0.2163]]], [[[0.9761]], [[0.8542]], [[0.3102]], [[0.6157]]], [[[0.4484]], [[0.2187]], [[0.7756]], [[0.3261]]], [[[0.8446]], [[0.6192]], [[0.3827]], [[0.9508]]], [[[0.5582]], [[0.3119]], [[0.8724]], [[0.1735]]]])
w[1] = np.array([0])
model.get_layer('Dep26348').set_weights(w) 
w = model.get_layer('GRU95706').get_weights() 
w[0] = np.array([[6, 9, 1, 7, 7, 8, 8, 9, 8]])
w[1] = np.array([[4, 4, 3, 2, 3, 3, 2, 7, 2], [7, 1, 2, 10, 8, 9, 10, 5, 6], [5, 9, 2, 9, 6, 9, 3, 6, 5]])
w[2] = np.array([1, 6, 3, 9, 4, 9, 7, 10, 5])
model.get_layer('GRU95706').set_weights(w) 
in0Add34950 = tf.constant([[[[0.2334, 0.0842], [0.1142, 0.1291]]]])
in1Add34950 = tf.constant([[[[0.6613, 0.1677], [0.4909, 0.873]]]])
in0Sub79818 = tf.constant([[[[[0.2351, 0.618, 0.3748], [0.4589, 0.5649, 0.1818]], [[0.7525, 0.1149, 0.4631], [0.1112, 0.6019, 0.871]], [[0.2764, 0.334, 0.9719], [0.265, 0.8314, 0.0289]]], [[[0.4528, 0.3482, 0.1053], [0.0966, 0.3747, 0.7801]], [[0.2268, 0.7145, 0.2767], [0.3218, 0.5711, 0.7591]], [[0.5406, 0.9641, 0.517], [0.385, 0.5987, 0.2592]]]]])
in1Sub79818 = tf.constant([[[[[0.904, 0.4621, 0.794], [0.1661, 0.3466, 0.888]], [[0.7952, 0.8608, 0.3435], [0.0178, 0.4508, 0.5204]], [[0.5523, 0.5826, 0.1053], [0.0425, 0.6919, 0.5048]]], [[[0.6925, 0.0283, 0.2813], [0.9584, 0.3725, 0.1296]], [[0.8291, 0.8764, 0.0861], [0.0324, 0.1423, 0.8547]], [[0.1604, 0.9378, 0.1466], [0.0701, 0.0209, 0.3857]]]]])
in0Con54230 = tf.constant([[[0.2306], [0.2955], [0.8584], [0.6427], [0.7691], [0.4866]]])
in0Dot2569 = tf.constant([[[0.9736, 0.3941], [0.1394, 0.6666], [0.107, 0.3561]]])
in1Dot2569 = tf.constant([[[0.5792, 0.864], [0.0585, 0.9943], [0.8853, 0.7818]]])
in0Con37195 = tf.constant([[[0.5627, 0.7478], [0.1954, 0.7561], [0.2132, 0.3848], [0.7027, 0.8058], [0.36, 0.8765], [0.5809, 0.717]]])
print (np.array2string(model.predict([in0Add34950,in1Add34950,in0Sub79818,in1Sub79818,in0Con54230,in0Dot2569,in1Dot2569,in0Con37195],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='GRU95706.png')

LAdd34950 = add_layer([[[[[0.2334, 0.0842], [0.1142, 0.1291]]]], [[[[0.6613, 0.1677], [0.4909, 0.873]]]]], Add34950), 
LRes23940 = reshape_layer(Add34950, [1, 4], Res23940), 
LZer20544 = zero_padding1D_layer(Res23940, 5, 0, Zer20544), 
LSub79818 = subtract_layer([[[[[0.2351, 0.618, 0.3748], [0.4589, 0.5649, 0.1818]], [[0.7525, 0.1149, 0.4631], [0.1112, 0.6019, 0.871]], [[0.2764, 0.334, 0.9719], [0.265, 0.8314, 0.0289]]], [[[0.4528, 0.3482, 0.1053], [0.0966, 0.3747, 0.7801]], [[0.2268, 0.7145, 0.2767], [0.3218, 0.5711, 0.7591]], [[0.5406, 0.9641, 0.517], [0.385, 0.5987, 0.2592]]]]], [[[[[0.904, 0.4621, 0.794], [0.1661, 0.3466, 0.888]], [[0.7952, 0.8608, 0.3435], [0.0178, 0.4508, 0.5204]], [[0.5523, 0.5826, 0.1053], [0.0425, 0.6919, 0.5048]]], [[[0.6925, 0.0283, 0.2813], [0.9584, 0.3725, 0.1296]], [[0.8291, 0.8764, 0.0861], [0.0324, 0.1423, 0.8547]], [[0.1604, 0.9378, 0.1466], [0.0701, 0.0209, 0.3857]]]]], Sub79818), 
LRes21951 = reshape_layer(Sub79818, [2, 3, 6], Res21951), 
LGlo45880 = global_max_pool2D_layer(Res21951, Glo45880), 
LRes80599 = reshape_layer(Glo45880, [6, 1], Res80599), 
LCon54230 = concatenate_layer([Res80599,[[[0.2306], [0.2955], [0.8584], [0.6427], [0.7691], [0.4866]]]], 2, Con54230), 
LDot2569 = dot_layer([[[0.9736, 0.3941], [0.1394, 0.6666], [0.107, 0.3561]]], [[[0.5792, 0.864], [0.0585, 0.9943], [0.8853, 0.7818]]], 1, 1, Dot2569), 
LZer55841 = zero_padding1D_layer(Dot2569, 4, 0, Zer55841), 
LMul30441 = multiply_layer([Con54230,Zer55841], Mul30441), 
LCon37195 = concatenate_layer([Mul30441,[[[0.5627, 0.7478], [0.1954, 0.7561], [0.2132, 0.3848], [0.7027, 0.8058], [0.36, 0.8765], [0.5809, 0.717]]]], 2, Con37195), 
LSub29010 = subtract_layer(Zer20544,Con37195, Sub29010), 
LRes74927 = reshape_layer(Sub29010, [6, 4, 1], Res74927), 
LDep26348 = depthwise_conv2D_layer(Res74927, 6, 4,[[[[0.2399]], [[0.7238]], [[0.8738]], [[0.0261]]], [[[0.1024]], [[0.3773]], [[0.8167]], [[0.2163]]], [[[0.9761]], [[0.8542]], [[0.3102]], [[0.6157]]], [[[0.4484]], [[0.2187]], [[0.7756]], [[0.3261]]], [[[0.8446]], [[0.6192]], [[0.3827]], [[0.9508]]], [[[0.5582]], [[0.3119]], [[0.8724]], [[0.1735]]]],[0], 6, 6, true, Dep26348), 
LRes35741 = reshape_layer(Dep26348, [1, 1], Res35741), 
LGRU95706 = gru_layer(Res35741,[[6, 9, 1, 7, 7, 8, 8, 9, 8]],[[4, 4, 3, 2, 3, 3, 2, 7, 2], [7, 1, 2, 10, 8, 9, 10, 5, 6], [5, 9, 2, 9, 6, 9, 3, 6, 5]],[1, 6, 3, 9, 4, 9, 7, 10, 5], false, GRU95706), 
exec_layers([LAdd34950,LRes23940,LZer20544,LSub79818,LRes21951,LGlo45880,LRes80599,LCon54230,LDot2569,LZer55841,LMul30441,LCon37195,LSub29010,LRes74927,LDep26348,LRes35741,LGRU95706],["Add34950","Res23940","Zer20544","Sub79818","Res21951","Glo45880","Res80599","Con54230","Dot2569","Zer55841","Mul30441","Con37195","Sub29010","Res74927","Dep26348","Res35741","GRU95706"],GRU95706,"GRU95706")

Actual (Unparsed): [[-1.0000000, -1.0000000, -0.6237838]]

Expected (Unparsed): [[-0.9999999980074292,-0.9999999999919934,-0.6237838419008241]]

Actual:   [[-1, -1, -0.6237]]

Expected: [[-0.9999, -0.9999, -0.6237]]