import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo22328 = tf.keras.layers.Input(shape=([1, 2]))
in0ReL54538 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Mul35246 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Mul35246 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con45931 = tf.keras.layers.Input(shape=([2, 2, 2]))

Glo22328 = keras.layers.GlobalAveragePooling1D(name = 'Glo22328', )(in0Glo22328)
Res7248 = keras.layers.Reshape((2, 1), name = 'Res7248', )(Glo22328)
Res79372 = keras.layers.Reshape((2, 1, 1), name = 'Res79372', )(Res7248)
Res7747 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res7747', )(Res79372)
Con55792 = keras.layers.Conv3D(4, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con55792', )(Res7747)
Res27266 = keras.layers.Reshape((2, 1, 4), name = 'Res27266', )(Con55792)
PRe97274 = keras.layers.PReLU(name = 'PRe97274', )(Res27266)
Zer96099 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer96099', )(PRe97274)
ReL54538 = keras.layers.ReLU(max_value=3.0168158892681287, negative_slope=3.2233689592341492, threshold=4.034459518291966, name = 'ReL54538', input_shape=(1, 2, 2, 2))(in0ReL54538)
Res9112 = keras.layers.Reshape((1, 2, 4), name = 'Res9112', )(ReL54538)
Zer25434 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer25434', )(Res9112)
Mul35246 = keras.layers.Multiply(name = 'Mul35246', )([in0Mul35246,in1Mul35246])
Con45931 = keras.layers.Concatenate(axis=3, name = 'Con45931', )([Mul35246,in0Con45931])
Ave73166 = keras.layers.Average(name = 'Ave73166', )([Zer25434,Con45931])
Ave16688 = keras.layers.Average(name = 'Ave16688', )([Zer96099,Ave73166])
model = tf.keras.models.Model(inputs=[in0Glo22328,in0ReL54538,in0Mul35246,in1Mul35246,in0Con45931], outputs=Ave16688)
w = model.get_layer('Con55792').get_weights() 
w[0] = np.array([[[[[0.8731, 0.5855, 0.4784, 0.2793]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con55792').set_weights(w) 
w = model.get_layer('PRe97274').get_weights() 
w[0] = np.array([[[0.8346, 0.5122, 0.0992, 0.2268]], [[0.8237, 0.6325, 0.5089, 0.5912]]])
model.get_layer('PRe97274').set_weights(w) 
in0Glo22328 = tf.constant([[[1.5059, 1.7625]]])
in0ReL54538 = tf.constant([[[[[0.5164, 0.7312], [0.8236, 0.277]], [[0.1461, 0.2226], [0.299, 0.3851]]]]])
in0Mul35246 = tf.constant([[[[0.9028, 0.1901], [0.0825, 0.8663]], [[0.7086, 0.9975], [0.806, 0.6598]]]])
in1Mul35246 = tf.constant([[[[0.0554, 0.7674], [0.1094, 0.7123]], [[0.2992, 0.9508], [0.2739, 0.0098]]]])
in0Con45931 = tf.constant([[[[0.3618, 0.7333], [0.6228, 0.1527]], [[0.768, 0.2044], [0.7082, 0.3557]]]])
print (np.array2string(model.predict([in0Glo22328,in0ReL54538,in0Mul35246,in1Mul35246,in0Con45931],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave16688.png')

LGlo22328 = global_average_pooling1D_layer([[[1.5059, 1.7625]]], Glo22328), 
LRes7248 = reshape_layer(Glo22328, [2, 1], Res7248), 
LRes79372 = reshape_layer(Res7248, [2, 1, 1], Res79372), 
LRes7747 = reshape_layer(Res79372, [2, 1, 1, 1], Res7747), 
LCon55792 = conv3D_layer(Res7747, 1, 1, 1,[[[[[0.8731, 0.5855, 0.4784, 0.2793]]]]],[0, 0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con55792), 
LRes27266 = reshape_layer(Con55792, [2, 1, 4], Res27266), 
LPRe97274 = prelu_layer(Res27266, [[[0.8346, 0.5122, 0.0992, 0.2268]], [[0.8237, 0.6325, 0.5089, 0.5912]]], PRe97274), 
LZer96099 = zero_padding2D_layer(PRe97274, 0, 0, 1, 0, Zer96099), 
LReL54538 = relu_layer([[[[[0.5164, 0.7312], [0.8236, 0.277]], [[0.1461, 0.2226], [0.299, 0.3851]]]]], 3.0168158892681287, 3.2233689592341492, 4.034459518291966, ReL54538), 
LRes9112 = reshape_layer(ReL54538, [1, 2, 4], Res9112), 
LZer25434 = zero_padding2D_layer(Res9112, 1, 0, 0, 0, Zer25434), 
LMul35246 = multiply_layer([[[[[0.9028, 0.1901], [0.0825, 0.8663]], [[0.7086, 0.9975], [0.806, 0.6598]]]], [[[[0.0554, 0.7674], [0.1094, 0.7123]], [[0.2992, 0.9508], [0.2739, 0.0098]]]]], Mul35246), 
LCon45931 = concatenate_layer([Mul35246,[[[[0.3618, 0.7333], [0.6228, 0.1527]], [[0.768, 0.2044], [0.7082, 0.3557]]]]], 3, Con45931), 
LAve73166 = average_layer([Zer25434,Con45931], Ave73166), 
LAve16688 = average_layer([Zer96099,Ave73166], Ave16688), 
exec_layers([LGlo22328,LRes7248,LRes79372,LRes7747,LCon55792,LRes27266,LPRe97274,LZer96099,LReL54538,LRes9112,LZer25434,LMul35246,LCon45931,LAve73166,LAve16688],["Glo22328","Res7248","Res79372","Res7747","Con55792","Res27266","PRe97274","Zer96099","ReL54538","Res9112","Zer25434","Mul35246","Con45931","Ave73166","Ave16688"],Ave16688,"Ave16688")

Actual (Unparsed): [[[[0.0125038, 0.0364707, 0.0904500, 0.1833250], [0.6596570, 0.5951186, 0.5159113, 0.2484739]], [[-2.7819977, -2.4248003, -2.3954462, -2.9768196], [-2.3087941, -2.5541690, -2.4115511, -2.6057499]]]]

Expected (Unparsed): [[[[0.01250378,0.036470684999999996,0.09045,0.183325],[0.6596570199999999,0.5951185975000001,0.5159112800000001,0.24847393499999998]],[[-2.7819976820001417,-2.424800298889268,-2.395446225930959,-2.9768195942103057],[-2.3087941184012433,-2.5541690270558903,-2.4115510649345175,-2.6057499230870023]]]]

Actual:   [[[[0.0126, 0.0365, 0.0905, 0.1834], [0.6597, 0.5952, 0.516, 0.2485]], [[-2.7819, -2.4248, -2.3954, -2.9768], [-2.3087, -2.5541, -2.4115, -2.6057]]]]

Expected: [[[[0.0126, 0.0365, 0.0905, 0.1834], [0.6597, 0.5952, 0.516, 0.2485]], [[-2.7819, -2.4248, -2.3954, -2.9768], [-2.3087, -2.5541, -2.4115, -2.6057]]]]