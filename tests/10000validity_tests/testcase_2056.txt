import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add20539 = tf.keras.layers.Input(shape=([2, 1]))
in1Add20539 = tf.keras.layers.Input(shape=([2, 1]))
in0Con45020 = tf.keras.layers.Input(shape=([2, 2]))
in0Per56885 = tf.keras.layers.Input(shape=([2, 2]))
in0Mul46324 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Mul46324 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Add65832 = tf.keras.layers.Input(shape=([2, 1]))
in1Add65832 = tf.keras.layers.Input(shape=([2, 1]))
in0Con93189 = tf.keras.layers.Input(shape=([2, 1]))
in0Con12196 = tf.keras.layers.Input(shape=([2, 2]))

Add20539 = keras.layers.Add(name = 'Add20539', )([in0Add20539,in1Add20539])
Res88516 = keras.layers.Reshape((2, 1, 1), name = 'Res88516', )(Add20539)
Loc61708 = keras.layers.LocallyConnected2D(2, (2, 1),strides=(1, 1), name = 'Loc61708', )(Res88516)
Res27443 = keras.layers.Reshape((1, 2), name = 'Res27443', )(Loc61708)
Zer29644 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer29644', )(Res27443)
Con45020 = keras.layers.Concatenate(axis=2, name = 'Con45020', )([Zer29644,in0Con45020])
Per56885 = keras.layers.Permute((1,2), name = 'Per56885',)(in0Per56885)
Res93719 = keras.layers.Reshape((2, 2, 1), name = 'Res93719', )(Per56885)
Res86866 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res86866', )(Res93719)
Glo29919 = keras.layers.GlobalMaxPool3D(name = 'Glo29919', )(Res86866)
Res84132 = keras.layers.Reshape((1, 1), name = 'Res84132', )(Glo29919)
Res95296 = keras.layers.Reshape((1, 1, 1), name = 'Res95296', )(Res84132)
Res66202 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res66202', )(Res95296)
Up_40797 = keras.layers.UpSampling3D(size=(2, 2, 2), name = 'Up_40797', )(Res66202)
Res67230 = keras.layers.Reshape((2, 2, 2), name = 'Res67230', )(Up_40797)
Res77924 = keras.layers.Reshape((2, 4), name = 'Res77924', )(Res67230)
Mul46324 = keras.layers.Multiply(name = 'Mul46324', )([in0Mul46324,in1Mul46324])
Res20983 = keras.layers.Reshape((2, 2), name = 'Res20983', )(Mul46324)
Add65832 = keras.layers.Add(name = 'Add65832', )([in0Add65832,in1Add65832])
Con93189 = keras.layers.Concatenate(axis=2, name = 'Con93189', )([Add65832,in0Con93189])
Sub31079 = keras.layers.Subtract(name = 'Sub31079', )([Res20983,Con93189])
Con12196 = keras.layers.Concatenate(axis=2, name = 'Con12196', )([Sub31079,in0Con12196])
Add11810 = keras.layers.Add(name = 'Add11810', )([Res77924,Con12196])
Sub10978 = keras.layers.Subtract(name = 'Sub10978', )([Con45020,Add11810])
model = tf.keras.models.Model(inputs=[in0Add20539,in1Add20539,in0Con45020,in0Per56885,in0Mul46324,in1Mul46324,in0Add65832,in1Add65832,in0Con93189,in0Con12196], outputs=Sub10978)
w = model.get_layer('Loc61708').get_weights() 
w[0] = np.array([[[0.5917, 0.804], [0.6716, 0.5666]]])
w[1] = np.array([[[0, 0]]])
model.get_layer('Loc61708').set_weights(w) 
in0Add20539 = tf.constant([[[0.2979], [0.2706]]])
in1Add20539 = tf.constant([[[0.7387], [0.8335]]])
in0Con45020 = tf.constant([[[0.541, 0.8484], [0.7146, 0.6883]]])
in0Per56885 = tf.constant([[[1.9457, 1.9706], [1.8703, 1.2302]]])
in0Mul46324 = tf.constant([[[[0.0613, 0.4906]], [[0.2146, 0.2553]]]])
in1Mul46324 = tf.constant([[[[0.34, 0.4886]], [[0.4159, 0.4158]]]])
in0Add65832 = tf.constant([[[0.8901], [0.6779]]])
in1Add65832 = tf.constant([[[0.0582], [0.2662]]])
in0Con93189 = tf.constant([[[0.0871], [0.6009]]])
in0Con12196 = tf.constant([[[0.8905, 0.4274], [0.7745, 0.895]]])
print (np.array2string(model.predict([in0Add20539,in1Add20539,in0Con45020,in0Per56885,in0Mul46324,in1Mul46324,in0Add65832,in1Add65832,in0Con93189,in0Con12196],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub10978.png')

LAdd20539 = add_layer([[[[0.2979], [0.2706]]], [[[0.7387], [0.8335]]]], Add20539), 
LRes88516 = reshape_layer(Add20539, [2, 1, 1], Res88516), 
LLoc61708 = locally_connected2D_layer(Res88516, 2, 1,[[[0.5917, 0.804], [0.6716, 0.5666]]],[[[0, 0]]], 1, 1, Loc61708), 
LRes27443 = reshape_layer(Loc61708, [1, 2], Res27443), 
LZer29644 = zero_padding1D_layer(Res27443, 1, 0, Zer29644), 
LCon45020 = concatenate_layer([Zer29644,[[[0.541, 0.8484], [0.7146, 0.6883]]]], 2, Con45020), 
LPer56885 = permute_layer([[[1.9457, 1.9706], [1.8703, 1.2302]]], 1,2, Per56885), 
LRes93719 = reshape_layer(Per56885, [2, 2, 1], Res93719), 
LRes86866 = reshape_layer(Res93719, [2, 2, 1, 1], Res86866), 
LGlo29919 = global_max_pool3D_layer(Res86866, Glo29919), 
LRes84132 = reshape_layer(Glo29919, [1, 1], Res84132), 
LRes95296 = reshape_layer(Res84132, [1, 1, 1], Res95296), 
LRes66202 = reshape_layer(Res95296, [1, 1, 1, 1], Res66202), 
LUp_40797 = up_sampling3D_layer(Res66202, 2, 2, 2, Up_40797), 
LRes67230 = reshape_layer(Up_40797, [2, 2, 2], Res67230), 
LRes77924 = reshape_layer(Res67230, [2, 4], Res77924), 
LMul46324 = multiply_layer([[[[[0.0613, 0.4906]], [[0.2146, 0.2553]]]], [[[[0.34, 0.4886]], [[0.4159, 0.4158]]]]], Mul46324), 
LRes20983 = reshape_layer(Mul46324, [2, 2], Res20983), 
LAdd65832 = add_layer([[[[0.8901], [0.6779]]], [[[0.0582], [0.2662]]]], Add65832), 
LCon93189 = concatenate_layer([Add65832,[[[0.0871], [0.6009]]]], 2, Con93189), 
LSub31079 = subtract_layer(Res20983,Con93189, Sub31079), 
LCon12196 = concatenate_layer([Sub31079,[[[0.8905, 0.4274], [0.7745, 0.895]]]], 2, Con12196), 
LAdd11810 = add_layer([Res77924,Con12196], Add11810), 
LSub10978 = subtract_layer(Con45020,Add11810, Sub10978), 
exec_layers([LAdd20539,LRes88516,LLoc61708,LRes27443,LZer29644,LCon45020,LPer56885,LRes93719,LRes86866,LGlo29919,LRes84132,LRes95296,LRes66202,LUp_40797,LRes67230,LRes77924,LMul46324,LRes20983,LAdd65832,LCon93189,LSub31079,LCon12196,LAdd11810,LSub10978],["Add20539","Res88516","Loc61708","Res27443","Zer29644","Con45020","Per56885","Res93719","Res86866","Glo29919","Res84132","Res95296","Res66202","Up_40797","Res67230","Res77924","Mul46324","Res20983","Add65832","Con93189","Sub31079","Con12196","Add11810","Sub10978"],Sub10978,"Sub10978")

Actual (Unparsed): [[[-1.0431420, -2.1232072, -2.3201000, -1.5496000], [0.2391176, -0.0168443, -2.0305000, -2.1773000]]]

Expected (Unparsed): [[[-1.043142,-2.1232071599999998,-2.3201,-1.5495999999999996],[0.2391176399999999,-0.01684427999999971,-2.0305,-2.1773]]]

Actual:   [[[-1.0431, -2.1232, -2.3201, -1.5496], [0.2392, -0.0168, -2.0305, -2.1773]]]

Expected: [[[-1.0431, -2.1232, -2.3201, -1.5495], [0.2392, -0.0168, -2.0305, -2.1773]]]