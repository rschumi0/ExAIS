import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0GRU8633 = tf.keras.layers.Input(shape=([2, 3]))
in0Add70619 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Add70619 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con27226 = tf.keras.layers.Input(shape=([2, 3]))
in0Mul692 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Mul692 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))

GRU8633 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU8633', )(in0GRU8633)
Res63979 = keras.layers.Reshape((2, 1), name = 'Res63979', )(GRU8633)
Res1172 = keras.layers.Reshape((2, 1, 1), name = 'Res1172', )(Res63979)
Add70619 = keras.layers.Add(name = 'Add70619', )([in0Add70619,in1Add70619])
Zer45201 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer45201', )(Add70619)
Mul43339 = keras.layers.Multiply(name = 'Mul43339', )([Res1172,Zer45201])
Res7407 = keras.layers.Reshape((2, 1), name = 'Res7407', )(Mul43339)
Con27226 = keras.layers.Concatenate(axis=2, name = 'Con27226', )([Res7407,in0Con27226])
Mul692 = keras.layers.Multiply(name = 'Mul692', )([in0Mul692,in1Mul692])
Sof90733 = keras.layers.Softmax(axis=1, name = 'Sof90733', )(Mul692)
Res33774 = keras.layers.Reshape((1, 1, 4), name = 'Res33774', )(Sof90733)
Res81066 = keras.layers.Reshape((1, 4), name = 'Res81066', )(Res33774)
Dot86460 = keras.layers.Dot(axes=(2, 2), name = 'Dot86460', )([Con27226,Res81066])
model = tf.keras.models.Model(inputs=[in0GRU8633,in0Add70619,in1Add70619,in0Con27226,in0Mul692,in1Mul692], outputs=Dot86460)
w = model.get_layer('GRU8633').get_weights() 
w[0] = np.array([[10, 9, 2, 6, 4, 10], [2, 10, 4, 6, 5, 10], [10, 2, 7, 7, 7, 2]])
w[1] = np.array([[6, 2, 8, 6, 8, 5], [6, 10, 9, 10, 3, 8]])
w[2] = np.array([1, 9, 2, 7, 2, 3])
model.get_layer('GRU8633').set_weights(w) 
in0GRU8633 = tf.constant([[[2, 6, 2], [8, 7, 4]]])
in0Add70619 = tf.constant([[[[0.5068]]]])
in1Add70619 = tf.constant([[[[0.7513]]]])
in0Con27226 = tf.constant([[[0.0029, 0.5337, 0.0891], [0.751, 0.9013, 0.4042]]])
in0Mul692 = tf.constant([[[[[0.2663, 0.2381], [0.2277, 0.6118]]]]])
in1Mul692 = tf.constant([[[[[0.7619, 0.0803], [0.1234, 0.9947]]]]])
print (np.array2string(model.predict([in0GRU8633,in0Add70619,in1Add70619,in0Con27226,in0Mul692,in1Mul692],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot86460.png')

LGRU8633 = gru_layer([[[2, 6, 2], [8, 7, 4]]],[[10, 9, 2, 6, 4, 10], [2, 10, 4, 6, 5, 10], [10, 2, 7, 7, 7, 2]],[[6, 2, 8, 6, 8, 5], [6, 10, 9, 10, 3, 8]],[1, 9, 2, 7, 2, 3], false, GRU8633), 
LRes63979 = reshape_layer(GRU8633, [2, 1], Res63979), 
LRes1172 = reshape_layer(Res63979, [2, 1, 1], Res1172), 
LAdd70619 = add_layer([[[[[0.5068]]]], [[[[0.7513]]]]], Add70619), 
LZer45201 = zero_padding2D_layer(Add70619, 1, 0, 0, 0, Zer45201), 
LMul43339 = multiply_layer([Res1172,Zer45201], Mul43339), 
LRes7407 = reshape_layer(Mul43339, [2, 1], Res7407), 
LCon27226 = concatenate_layer([Res7407,[[[0.0029, 0.5337, 0.0891], [0.751, 0.9013, 0.4042]]]], 2, Con27226), 
LMul692 = multiply_layer([[[[[[0.2663, 0.2381], [0.2277, 0.6118]]]]], [[[[[0.7619, 0.0803], [0.1234, 0.9947]]]]]], Mul692), 
LSof90733 = softmax_layer(Mul692, 1, Sof90733), 
LRes33774 = reshape_layer(Sof90733, [1, 1, 4], Res33774), 
LRes81066 = reshape_layer(Res33774, [1, 4], Res81066), 
LDot86460 = dot_layer(Con27226,Res81066, 2, 2, Dot86460), 
exec_layers([LGRU8633,LRes63979,LRes1172,LAdd70619,LZer45201,LMul43339,LRes7407,LCon27226,LMul692,LSof90733,LRes33774,LRes81066,LDot86460],["GRU8633","Res63979","Res1172","Add70619","Zer45201","Mul43339","Res7407","Con27226","Mul692","Sof90733","Res33774","Res81066","Dot86460"],Dot86460,"Dot86460")

Actual (Unparsed): [[[0.6257000], [2.0565000]]]

Expected (Unparsed): [[[0.6256999999999999],[2.0564999999999998]]]

Actual:   [[[0.6257], [2.0565]]]

Expected: [[[0.6257], [2.0565]]]