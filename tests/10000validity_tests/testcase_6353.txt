import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub84373 = tf.keras.layers.Input(shape=([2]))
in1Sub84373 = tf.keras.layers.Input(shape=([2]))
in0Add85000 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Add85000 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Ave47085 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Ave47085 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Con16879 = tf.keras.layers.Input(shape=([2]))

Sub84373 = keras.layers.Subtract(name = 'Sub84373', )([in0Sub84373,in1Sub84373])
Res20284 = keras.layers.Reshape((2, 1), name = 'Res20284', )(Sub84373)
Sim97740 = keras.layers.SimpleRNN(2,name = 'Sim97740', )(Res20284)
Res71691 = keras.layers.Reshape((2, 1), name = 'Res71691', )(Sim97740)
Zer49009 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer49009', )(Res71691)
Add85000 = keras.layers.Add(name = 'Add85000', )([in0Add85000,in1Add85000])
Res71153 = keras.layers.Reshape((1, 1), name = 'Res71153', )(Add85000)
Dot86079 = keras.layers.Dot(axes=(2, 1), name = 'Dot86079', )([Zer49009,Res71153])
Fla52763 = keras.layers.Flatten(name = 'Fla52763', )(Dot86079)
Ave47085 = keras.layers.Average(name = 'Ave47085', )([in0Ave47085,in1Ave47085])
Res86260 = keras.layers.Reshape((2, 1), name = 'Res86260', )(Ave47085)
Glo57938 = keras.layers.GlobalAveragePooling1D(name = 'Glo57938', )(Res86260)
Res59849 = keras.layers.Reshape((1, 1), name = 'Res59849', )(Glo57938)
Zer88481 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer88481', )(Res59849)
Res81989 = keras.layers.Reshape((3, 1, 1), name = 'Res81989', )(Zer88481)
Res75547 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res75547', )(Res81989)
Glo54100 = keras.layers.GlobalAveragePooling3D(name = 'Glo54100', )(Res75547)
Con16879 = keras.layers.Concatenate(axis=1, name = 'Con16879', )([Glo54100,in0Con16879])
Max22149 = keras.layers.Maximum(name = 'Max22149', )([Fla52763,Con16879])
model = tf.keras.models.Model(inputs=[in0Sub84373,in1Sub84373,in0Add85000,in1Add85000,in0Ave47085,in1Ave47085,in0Con16879], outputs=Max22149)
w = model.get_layer('Sim97740').get_weights() 
w[0] = np.array([[6, 9]])
w[1] = np.array([[2, 8], [9, 10]])
w[2] = np.array([2, 4])
model.get_layer('Sim97740').set_weights(w) 
in0Sub84373 = tf.constant([[0.1774, 0.6068]])
in1Sub84373 = tf.constant([[0.4192, 0.9574]])
in0Add85000 = tf.constant([[[[0.3148]]]])
in1Add85000 = tf.constant([[[[0.7669]]]])
in0Ave47085 = tf.constant([[[[0.8914]], [[0.4389]]]])
in1Ave47085 = tf.constant([[[[0.9994]], [[0.1368]]]])
in0Con16879 = tf.constant([[0.8672, 0.1378]])
print (np.array2string(model.predict([in0Sub84373,in1Sub84373,in0Add85000,in1Add85000,in0Ave47085,in1Ave47085,in0Con16879],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max22149.png')

LSub84373 = subtract_layer([[0.1774, 0.6068]], [[0.4192, 0.9574]], Sub84373), 
LRes20284 = reshape_layer(Sub84373, [2, 1], Res20284), 
LSim97740 = simple_rnn_layer(Res20284,[[6, 9]],[[2, 8], [9, 10]],[2, 4], Sim97740), 
LRes71691 = reshape_layer(Sim97740, [2, 1], Res71691), 
LZer49009 = zero_padding1D_layer(Res71691, 1, 0, Zer49009), 
LAdd85000 = add_layer([[[[[0.3148]]]], [[[[0.7669]]]]], Add85000), 
LRes71153 = reshape_layer(Add85000, [1, 1], Res71153), 
LDot86079 = dot_layer(Zer49009,Res71153, 2, 1, Dot86079), 
LFla52763 = flatten_layer(Dot86079, Fla52763), 
LAve47085 = average_layer([[[[[0.8914]], [[0.4389]]]], [[[[0.9994]], [[0.1368]]]]], Ave47085), 
LRes86260 = reshape_layer(Ave47085, [2, 1], Res86260), 
LGlo57938 = global_average_pooling1D_layer(Res86260, Glo57938), 
LRes59849 = reshape_layer(Glo57938, [1, 1], Res59849), 
LZer88481 = zero_padding1D_layer(Res59849, 1, 1, Zer88481), 
LRes81989 = reshape_layer(Zer88481, [3, 1, 1], Res81989), 
LRes75547 = reshape_layer(Res81989, [3, 1, 1, 1], Res75547), 
LGlo54100 = global_average_pooling3D_layer(Res75547, Glo54100), 
LCon16879 = concatenate_layer([Glo54100,[[0.8672, 0.1378]]], 1, Con16879), 
LMax22149 = maximum_layer([Fla52763,Con16879], Max22149), 
exec_layers([LSub84373,LRes20284,LSim97740,LRes71691,LZer49009,LAdd85000,LRes71153,LDot86079,LFla52763,LAve47085,LRes86260,LGlo57938,LRes59849,LZer88481,LRes81989,LRes75547,LGlo54100,LCon16879,LMax22149],["Sub84373","Res20284","Sim97740","Res71691","Zer49009","Add85000","Res71153","Dot86079","Fla52763","Ave47085","Res86260","Glo57938","Res59849","Zer88481","Res81989","Res75547","Glo54100","Con16879","Max22149"],Max22149,"Max22149")

Actual (Unparsed): [[0.2055417, 1.0817000, 1.0817000]]

Expected (Unparsed): [[0.20554166666666665,1.0816999863111945,1.0816999999992365]]

Actual:   [[0.2056, 1.0817, 1.0817]]

Expected: [[0.2056, 1.0817, 1.0817]]