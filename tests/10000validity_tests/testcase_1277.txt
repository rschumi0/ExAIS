import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub20721 = tf.keras.layers.Input(shape=([2]))
in1Sub20721 = tf.keras.layers.Input(shape=([2]))
in0Con10355 = tf.keras.layers.Input(shape=([2, 2]))
in0Loc49124 = tf.keras.layers.Input(shape=([1, 2]))

Sub20721 = keras.layers.Subtract(name = 'Sub20721', )([in0Sub20721,in1Sub20721])
Res87370 = keras.layers.Reshape((2, 1), name = 'Res87370', )(Sub20721)
Res38264 = keras.layers.Reshape((2, 1, 1), name = 'Res38264', )(Res87370)
Con17987 = keras.layers.Conv2DTranspose(4, (1, 1),strides=(1, 1), padding='valid', name = 'Con17987', )(Res38264)
Thr29327 = keras.layers.ThresholdedReLU(theta=9.730901920937466, name = 'Thr29327', )(Con17987)
Res86107 = keras.layers.Reshape((2, 4), name = 'Res86107', )(Thr29327)
Con10355 = keras.layers.Concatenate(axis=2, name = 'Con10355', )([Res86107,in0Con10355])
Loc49124 = keras.layers.LocallyConnected1D(2, (1),strides=(1), name = 'Loc49124', )(in0Loc49124)
Res2677 = keras.layers.Reshape((1, 2, 1), name = 'Res2677', )(Loc49124)
Dep68525 = keras.layers.DepthwiseConv2D((1, 2),strides=(1, 1), padding='same', name = 'Dep68525', )(Res2677)
Res89942 = keras.layers.Reshape((1, 2), name = 'Res89942', )(Dep68525)
Zer24630 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer24630', )(Res89942)
Dot65418 = keras.layers.Dot(axes=(1, 1), name = 'Dot65418', )([Con10355,Zer24630])
model = tf.keras.models.Model(inputs=[in0Sub20721,in1Sub20721,in0Con10355,in0Loc49124], outputs=Dot65418)
w = model.get_layer('Con17987').get_weights() 
w[0] = np.array([[[[0.4928], [0.7158], [0.6961], [0.4354]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con17987').set_weights(w) 
w = model.get_layer('Loc49124').get_weights() 
w[0] = np.array([[[0.1446, 0.3175], [0.2145, 0.6713]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc49124').set_weights(w) 
w = model.get_layer('Dep68525').get_weights() 
w[0] = np.array([[[[0.052]], [[0.6587]]]])
w[1] = np.array([0])
model.get_layer('Dep68525').set_weights(w) 
in0Sub20721 = tf.constant([[0.5584, 0.9619]])
in1Sub20721 = tf.constant([[0.9105, 0.7471]])
in0Con10355 = tf.constant([[[0.6149, 0.5457], [0.7854, 0.443]]])
in0Loc49124 = tf.constant([[[0.2047, 0.6188]]])
print (np.array2string(model.predict([in0Sub20721,in1Sub20721,in0Con10355,in0Loc49124],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot65418.png')

LSub20721 = subtract_layer([[0.5584, 0.9619]], [[0.9105, 0.7471]], Sub20721), 
LRes87370 = reshape_layer(Sub20721, [2, 1], Res87370), 
LRes38264 = reshape_layer(Res87370, [2, 1, 1], Res38264), 
LCon17987 = conv2D_transpose_layer(Res38264, 1, 1,[[[[0.4928], [0.7158], [0.6961], [0.4354]]]],[0, 0, 0, 0], 1, 1, false, Con17987), 
LThr29327 = thresholded_relu_layer(Con17987, 9.730901920937466, Thr29327), 
LRes86107 = reshape_layer(Thr29327, [2, 4], Res86107), 
LCon10355 = concatenate_layer([Res86107,[[[0.6149, 0.5457], [0.7854, 0.443]]]], 2, Con10355), 
LLoc49124 = locally_connected1D_layer([[[0.2047, 0.6188]]], 1,[[[0.1446, 0.3175], [0.2145, 0.6713]]],[[0, 0]], 1, Loc49124), 
LRes2677 = reshape_layer(Loc49124, [1, 2, 1], Res2677), 
LDep68525 = depthwise_conv2D_layer(Res2677, 1, 2,[[[[0.052]], [[0.6587]]]],[0], 1, 1, true, Dep68525), 
LRes89942 = reshape_layer(Dep68525, [1, 2], Res89942), 
LZer24630 = zero_padding1D_layer(Res89942, 1, 0, Zer24630), 
LDot65418 = dot_layer(Con10355,Zer24630, 1, 1, Dot65418), 
exec_layers([LSub20721,LRes87370,LRes38264,LCon17987,LThr29327,LRes86107,LCon10355,LLoc49124,LRes2677,LDep68525,LRes89942,LZer24630,LDot65418],["Sub20721","Res87370","Res38264","Con17987","Thr29327","Res86107","Con10355","Loc49124","Res2677","Dep68525","Res89942","Zer24630","Dot65418"],Dot65418,"Dot65418")

Actual (Unparsed): [[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.2551575, 0.0196196], [0.1439200, 0.0110663]]]

Expected (Unparsed): [[[0.0,0.0],[0.0,0.0],[0.0,0.0],[0.0,0.0],[0.2551575635453922,0.019619621773752004],[0.14392004157194901,0.011066326006840002]]]

Actual:   [[[0, 0], [0, 0], [0, 0], [0, 0], [0.2552, 0.0197], [0.144, 0.0111]]]

Expected: [[[0, 0], [0, 0], [0, 0], [0, 0], [0.2552, 0.0197], [0.144, 0.0111]]]