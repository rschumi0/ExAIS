import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub50173 = tf.keras.layers.Input(shape=([2, 3, 3, 3]))
in1Sub50173 = tf.keras.layers.Input(shape=([2, 3, 3, 3]))

Sub50173 = keras.layers.Subtract(name = 'Sub50173', )([in0Sub50173,in1Sub50173])
Res13893 = keras.layers.Reshape((2, 3, 9), name = 'Res13893', )(Sub50173)
Res28308 = keras.layers.Reshape((2, 27), name = 'Res28308', )(Res13893)
Max37450 = keras.layers.MaxPool1D(pool_size=(2), strides=(2), padding='valid', name = 'Max37450', )(Res28308)
model = tf.keras.models.Model(inputs=[in0Sub50173,in1Sub50173], outputs=Max37450)
in0Sub50173 = tf.constant([[[[[0.2432, 0.466, 0.4148], [0.2981, 0.3728, 0.6409], [0.6293, 0.6241, 0.8587]], [[0.8412, 0.7843, 0.6807], [0.7135, 0.8098, 0.6841], [0.6463, 0.8214, 0.9829]], [[0.0203, 0.7757, 0.689], [0.5013, 0.9054, 0.7381], [0.7268, 0.5293, 0.4606]]], [[[0.2394, 0.7661, 0.5969], [0.4522, 0.2992, 0.6052], [0.3097, 0.2013, 0.9433]], [[0.9957, 0.1759, 0.2474], [0.7472, 0.6298, 0.4893], [0.5392, 0.6177, 0.3692]], [[0.1771, 0.2447, 0.4372], [0.1695, 0.2716, 0.6272], [0.711, 0.8963, 0.1976]]]]])
in1Sub50173 = tf.constant([[[[[0.8164, 0.1563, 0.5026], [0.3807, 0.72, 0.2486], [0.846, 0.7769, 0.7656]], [[0.1059, 0.757, 0.7974], [0.642, 0.7271, 0.8411], [0.765, 0.7176, 0.5294]], [[0.8949, 0.4701, 0.3523], [0.3289, 0.7484, 0.6203], [0.8924, 0.3972, 0.8064]]], [[[0.9745, 0.739, 0.9922], [0.5557, 0.7363, 0.5149], [0.8083, 0.83, 0.3444]], [[0.0204, 0.1221, 0.6773], [0.144, 0.3641, 0.019], [0.266, 0.5454, 0.3818]], [[0.977, 0.3788, 0.1885], [0.2174, 0.259, 0.6983], [0.3156, 0.7271, 0.0164]]]]])
print (np.array2string(model.predict([in0Sub50173,in1Sub50173],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max37450.png')

LSub50173 = subtract_layer([[[[[0.2432, 0.466, 0.4148], [0.2981, 0.3728, 0.6409], [0.6293, 0.6241, 0.8587]], [[0.8412, 0.7843, 0.6807], [0.7135, 0.8098, 0.6841], [0.6463, 0.8214, 0.9829]], [[0.0203, 0.7757, 0.689], [0.5013, 0.9054, 0.7381], [0.7268, 0.5293, 0.4606]]], [[[0.2394, 0.7661, 0.5969], [0.4522, 0.2992, 0.6052], [0.3097, 0.2013, 0.9433]], [[0.9957, 0.1759, 0.2474], [0.7472, 0.6298, 0.4893], [0.5392, 0.6177, 0.3692]], [[0.1771, 0.2447, 0.4372], [0.1695, 0.2716, 0.6272], [0.711, 0.8963, 0.1976]]]]], [[[[[0.8164, 0.1563, 0.5026], [0.3807, 0.72, 0.2486], [0.846, 0.7769, 0.7656]], [[0.1059, 0.757, 0.7974], [0.642, 0.7271, 0.8411], [0.765, 0.7176, 0.5294]], [[0.8949, 0.4701, 0.3523], [0.3289, 0.7484, 0.6203], [0.8924, 0.3972, 0.8064]]], [[[0.9745, 0.739, 0.9922], [0.5557, 0.7363, 0.5149], [0.8083, 0.83, 0.3444]], [[0.0204, 0.1221, 0.6773], [0.144, 0.3641, 0.019], [0.266, 0.5454, 0.3818]], [[0.977, 0.3788, 0.1885], [0.2174, 0.259, 0.6983], [0.3156, 0.7271, 0.0164]]]]], Sub50173), 
LRes13893 = reshape_layer(Sub50173, [2, 3, 9], Res13893), 
LRes28308 = reshape_layer(Res13893, [2, 27], Res28308), 
LMax37450 = max_pool1D_layer(Res28308, 2, 2, false, Max37450), 
exec_layers([LSub50173,LRes13893,LRes28308,LMax37450],["Sub50173","Res13893","Res28308","Max37450"],Max37450,"Max37450")

Actual (Unparsed): [[[-0.5732000, 0.3097000, -0.0878000, -0.0826000, -0.3472000, 0.3923000, -0.2167000, -0.1528000, 0.5989000, 0.9753000, 0.0538000, -0.1167000, 0.6032000, 0.2657000, 0.4703000, 0.2732000, 0.1038000, 0.4535000, -0.7999000, 0.3056000, 0.3367000, 0.1724000, 0.1570000, 0.1178000, 0.3954000, 0.1692000, 0.1812000]]]

Expected (Unparsed): [[[-0.5732,0.30970000000000003,-0.08780000000000004,-0.0826,-0.34719999999999995,0.39230000000000004,-0.2167,-0.15280000000000005,0.5989,0.9753000000000001,0.0538,-0.11670000000000003,0.6032,0.26570000000000005,0.4703,0.2732,0.1038,0.4535,-0.7998999999999999,0.3055999999999999,0.33669999999999994,0.17239999999999994,0.15700000000000003,0.11780000000000002,0.3954,0.16920000000000002,0.1812]]]

Actual:   [[[-0.5732, 0.3097, -0.0878, -0.0826, -0.3472, 0.3923, -0.2167, -0.1528, 0.5989, 0.9753, 0.0538, -0.1167, 0.6032, 0.2657, 0.4703, 0.2732, 0.1038, 0.4535, -0.7999, 0.3056, 0.3367, 0.1724, 0.157, 0.1178, 0.3954, 0.1692, 0.1812]]]

Expected: [[[-0.5732, 0.3098, -0.0878, -0.0826, -0.3471, 0.3924, -0.2167, -0.1528, 0.5989, 0.9754, 0.0538, -0.1167, 0.6032, 0.2658, 0.4703, 0.2732, 0.1038, 0.4535, -0.7998, 0.3056, 0.3367, 0.1724, 0.1571, 0.1179, 0.3954, 0.1693, 0.1812]]]