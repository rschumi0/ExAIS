import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave82613 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Ave82613 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Ave46885 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Sub6700 = tf.keras.layers.Input(shape=([2]))
in1Sub6700 = tf.keras.layers.Input(shape=([2]))
in0Per16071 = tf.keras.layers.Input(shape=([3, 1]))
in0Con20510 = tf.keras.layers.Input(shape=([3, 1]))
in0Con9621 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Lay48570 = tf.keras.layers.Input(shape=([3]))
in0Con62673 = tf.keras.layers.Input(shape=([3, 1]))

Ave82613 = keras.layers.Average(name = 'Ave82613', )([in0Ave82613,in1Ave82613])
Ave46885 = keras.layers.AveragePooling2D(pool_size=(1, 2), strides=(1, 1), padding='valid', name = 'Ave46885', )(in0Ave46885)
Zer32566 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer32566', )(Ave46885)
Ave53233 = keras.layers.Average(name = 'Ave53233', )([Ave82613,Zer32566])
Res13212 = keras.layers.Reshape((2, 2), name = 'Res13212', )(Ave53233)
Zer53662 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer53662', )(Res13212)
Sub6700 = keras.layers.Subtract(name = 'Sub6700', )([in0Sub6700,in1Sub6700])
Res14416 = keras.layers.Reshape((2, 1), name = 'Res14416', )(Sub6700)
Zer16273 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer16273', )(Res14416)
Per16071 = keras.layers.Permute((1,2), name = 'Per16071',)(in0Per16071)
Min58245 = keras.layers.Minimum(name = 'Min58245', )([Zer16273,Per16071])
Con20510 = keras.layers.Concatenate(axis=2, name = 'Con20510', )([Min58245,in0Con20510])
Ave6033 = keras.layers.Average(name = 'Ave6033', )([Zer53662,Con20510])
Con9621 = keras.layers.Conv2D(2, (1, 2),strides=(1, 1), padding='valid', dilation_rate=(1, 1), name = 'Con9621', )(in0Con9621)
Res37085 = keras.layers.Reshape((2, 2), name = 'Res37085', )(Con9621)
Zer67219 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer67219', )(Res37085)
Lay48570 = keras.layers.LayerNormalization(axis=1, epsilon=1.021257955413452, name = 'Lay48570', )(in0Lay48570)
Res20832 = keras.layers.Reshape((3, 1), name = 'Res20832', )(Lay48570)
Zer95322 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer95322', )(Res20832)
Dot55294 = keras.layers.Dot(axes=(1, 1), name = 'Dot55294', )([Zer67219,Zer95322])
Zer94783 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer94783', )(Dot55294)
Con62673 = keras.layers.Concatenate(axis=2, name = 'Con62673', )([Zer94783,in0Con62673])
Ave97772 = keras.layers.Average(name = 'Ave97772', )([Ave6033,Con62673])
model = tf.keras.models.Model(inputs=[in0Ave82613,in1Ave82613,in0Ave46885,in0Sub6700,in1Sub6700,in0Per16071,in0Con20510,in0Con9621,in0Lay48570,in0Con62673], outputs=Ave97772)
w = model.get_layer('Con9621').get_weights() 
w[0] = np.array([[[[0.6384, 0.2046], [0.9047, 0.6584]], [[0.2261, 0.1202], [0.7823, 0.5595]]]])
w[1] = np.array([0, 0])
model.get_layer('Con9621').set_weights(w) 
in0Ave82613 = tf.constant([[[[0.5558], [0.0786]], [[0.6845], [0.3475]]]])
in1Ave82613 = tf.constant([[[[0.8776], [0.8123]], [[0.2856], [0.2067]]]])
in0Ave46885 = tf.constant([[[[1.1303], [1.0168]]]])
in0Sub6700 = tf.constant([[0.9257, 0.7075]])
in1Sub6700 = tf.constant([[0.8661, 0.602]])
in0Per16071 = tf.constant([[[1.7483], [1.9953], [1.1917]]])
in0Con20510 = tf.constant([[[0.6114], [0.8484], [0.8783]]])
in0Con9621 = tf.constant([[[[0.6144, 0.9408], [0.0536, 0.7044]], [[0.5705, 0.323], [0.5008, 0.377]]]])
in0Lay48570 = tf.constant([[1.3227, 1.4477, 1.9742]])
in0Con62673 = tf.constant([[[0.2921], [0.1081], [0.3764]]])
print (np.array2string(model.predict([in0Ave82613,in1Ave82613,in0Ave46885,in0Sub6700,in1Sub6700,in0Per16071,in0Con20510,in0Con9621,in0Lay48570,in0Con62673],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave97772.png')

LAve82613 = average_layer([[[[[0.5558], [0.0786]], [[0.6845], [0.3475]]]], [[[[0.8776], [0.8123]], [[0.2856], [0.2067]]]]], Ave82613), 
LAve46885 = average_pooling2D_layer([[[[1.1303], [1.0168]]]], 1, 2, 1, 1, false, Ave46885), 
LZer32566 = zero_padding2D_layer(Ave46885, 1, 0, 1, 0, Zer32566), 
LAve53233 = average_layer([Ave82613,Zer32566], Ave53233), 
LRes13212 = reshape_layer(Ave53233, [2, 2], Res13212), 
LZer53662 = zero_padding1D_layer(Res13212, 1, 0, Zer53662), 
LSub6700 = subtract_layer([[0.9257, 0.7075]], [[0.8661, 0.602]], Sub6700), 
LRes14416 = reshape_layer(Sub6700, [2, 1], Res14416), 
LZer16273 = zero_padding1D_layer(Res14416, 1, 0, Zer16273), 
LPer16071 = permute_layer([[[1.7483], [1.9953], [1.1917]]], 1,2, Per16071), 
LMin58245 = minimum_layer([Zer16273,Per16071], Min58245), 
LCon20510 = concatenate_layer([Min58245,[[[0.6114], [0.8484], [0.8783]]]], 2, Con20510), 
LAve6033 = average_layer([Zer53662,Con20510], Ave6033), 
LCon9621 = conv2D_layer([[[[0.6144, 0.9408], [0.0536, 0.7044]], [[0.5705, 0.323], [0.5008, 0.377]]]], 1, 2,[[[[0.6384, 0.2046], [0.9047, 0.6584]], [[0.2261, 0.1202], [0.7823, 0.5595]]]],[0, 0], 1, 1, false, 1, 1, Con9621), 
LRes37085 = reshape_layer(Con9621, [2, 2], Res37085), 
LZer67219 = zero_padding1D_layer(Res37085, 3, 0, Zer67219), 
LLay48570 = layer_normalization_layer([[1.3227, 1.4477, 1.9742]], 1, 1.021257955413452, Lay48570), 
LRes20832 = reshape_layer(Lay48570, [3, 1], Res20832), 
LZer95322 = zero_padding1D_layer(Res20832, 1, 1, Zer95322), 
LDot55294 = dot_layer(Zer67219,Zer95322, 1, 1, Dot55294), 
LZer94783 = zero_padding1D_layer(Dot55294, 1, 0, Zer94783), 
LCon62673 = concatenate_layer([Zer94783,[[[0.2921], [0.1081], [0.3764]]]], 2, Con62673), 
LAve97772 = average_layer([Ave6033,Con62673], Ave97772), 
exec_layers([LAve82613,LAve46885,LZer32566,LAve53233,LRes13212,LZer53662,LSub6700,LRes14416,LZer16273,LPer16071,LMin58245,LCon20510,LAve6033,LCon9621,LRes37085,LZer67219,LLay48570,LRes20832,LZer95322,LDot55294,LZer94783,LCon62673,LAve97772],["Ave82613","Ave46885","Zer32566","Ave53233","Res13212","Zer53662","Sub6700","Res14416","Zer16273","Per16071","Min58245","Con20510","Ave6033","Con9621","Res37085","Zer67219","Lay48570","Res20832","Zer95322","Dot55294","Zer94783","Con62673","Ave97772"],Ave97772,"Ave97772")

Actual (Unparsed): [[[0.0000000, 0.2989000], [0.4425197, 0.3218312], [0.3013811, 0.5766063]]]

Expected (Unparsed): [[[0,0.29890000000000005],[0.4425197208593105,0.32183125],[0.3013810702487994,0.57660625]]]

Actual:   [[[0, 0.2989], [0.4426, 0.3219], [0.3014, 0.5767]]]

Expected: [[[0, 0.299], [0.4426, 0.3219], [0.3014, 0.5767]]]