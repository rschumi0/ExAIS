import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add37782 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Add37782 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con24269 = tf.keras.layers.Input(shape=([1, 3, 1, 3]))
in0Sep84495 = tf.keras.layers.Input(shape=([2, 1]))

Add37782 = keras.layers.Add(name = 'Add37782', )([in0Add37782,in1Add37782])
Res66297 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res66297', )(Add37782)
Zer67154 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer67154', )(Res66297)
Con24269 = keras.layers.Concatenate(axis=4, name = 'Con24269', )([Zer67154,in0Con24269])
Sep84495 = keras.layers.SeparableConv1D(2, (2),strides=(2), padding='valid', name = 'Sep84495', )(in0Sep84495)
Bat84385 = keras.layers.BatchNormalization(axis=1, epsilon=0.5069890072427123,  name = 'Bat84385', )(Sep84495)
Res53898 = keras.layers.Reshape((1, 2, 1), name = 'Res53898', )(Bat84385)
Res13858 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res13858', )(Res53898)
Con37473 = keras.layers.Conv3DTranspose(4, (1, 2, 1),strides=(1, 1, 1), padding='valid', name = 'Con37473', )(Res13858)
Sub52802 = keras.layers.Subtract(name = 'Sub52802', )([Con24269,Con37473])
model = tf.keras.models.Model(inputs=[in0Add37782,in1Add37782,in0Con24269,in0Sep84495], outputs=Sub52802)
w = model.get_layer('Sep84495').get_weights() 
w[0] = np.array([[[0.27]], [[0.5836]]])
w[1] = np.array([[[0.6129, 0.0569]]])
w[2] = np.array([0, 0])
model.get_layer('Sep84495').set_weights(w) 
w = model.get_layer('Bat84385').get_weights() 
w[0] = np.array([0.2849])
w[1] = np.array([0.773])
w[2] = np.array([0.1616])
w[3] = np.array([0.0051])
model.get_layer('Bat84385').set_weights(w) 
w = model.get_layer('Con37473').get_weights() 
w[0] = np.array([[[[[0.056], [0.085], [0.415], [0.7317]]], [[[0.2185], [0.0579], [0.4756], [0.0814]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con37473').set_weights(w) 
in0Add37782 = tf.constant([[[[0.6751]]]])
in1Add37782 = tf.constant([[[[0.8006]]]])
in0Con24269 = tf.constant([[[[[0.3206, 0.2668, 0.7669]], [[0.1955, 0.5442, 0.415]], [[0.3064, 0.9682, 0.603]]]]])
in0Sep84495 = tf.constant([[[0.194], [0.7472]]])
print (np.array2string(model.predict([in0Add37782,in1Add37782,in0Con24269,in0Sep84495],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub52802.png')

LAdd37782 = add_layer([[[[[0.6751]]]], [[[[0.8006]]]]], Add37782), 
LRes66297 = reshape_layer(Add37782, [1, 1, 1, 1], Res66297), 
LZer67154 = zero_padding3D_layer(Res66297, 0, 0, 2, 0, 0, 0, Zer67154), 
LCon24269 = concatenate_layer([Zer67154,[[[[[0.3206, 0.2668, 0.7669]], [[0.1955, 0.5442, 0.415]], [[0.3064, 0.9682, 0.603]]]]]], 4, Con24269), 
LSep84495 = separable_conv1D_layer([[[0.194], [0.7472]]], 2,[[[[0.27]], [[0.5836]]],[[[0.6129, 0.0569]]]],[0, 0], 2, false, Sep84495), 
LBat84385 = batch_normalization_layer(Sep84495, 1, 0.5069890072427123, [0.2849], [0.773], [0.1616], [0.0051], Bat84385), 
LRes53898 = reshape_layer(Bat84385, [1, 2, 1], Res53898), 
LRes13858 = reshape_layer(Res53898, [1, 2, 1, 1], Res13858), 
LCon37473 = conv3D_transpose_layer(Res13858, 1, 2, 1,[[[[[0.056], [0.085], [0.415], [0.7317]]], [[[0.2185], [0.0579], [0.4756], [0.0814]]]]],[0, 0, 0, 0], 1, 1, 1, false, Con37473), 
LSub52802 = subtract_layer(Con24269,Con37473, Sub52802), 
exec_layers([LAdd37782,LRes66297,LZer67154,LCon24269,LSep84495,LBat84385,LRes53898,LRes13858,LCon37473,LSub52802],["Add37782","Res66297","Zer67154","Con24269","Sep84495","Bat84385","Res53898","Res13858","Con37473","Sub52802"],Sub52802,"Sub52802")

Actual (Unparsed): [[[[[-0.0463596, 0.2502328, -0.0767574, 0.1611628]], [[-0.2211898, 0.0863907, -0.1482121, -0.1790118]], [[1.3184395, 0.2647278, 0.6258974, 0.5444141]]]]]

Expected (Unparsed): [[[[[-0.04635955073556153,0.2502328247763798,-0.07675738491532202,0.16116279869267203]],[[-0.22118979431719715,0.08639066574661138,-0.14821211370485754,-0.17901181153779838]],[[1.3184394572192724,0.26472775548281857,0.6258974180937569,0.5444141501951888]]]]]

Actual:   [[[[[-0.0463, 0.2503, -0.0767, 0.1612]], [[-0.2211, 0.0864, -0.1482, -0.179]], [[1.3185, 0.2648, 0.6259, 0.5445]]]]]

Expected: [[[[[-0.0463, 0.2503, -0.0767, 0.1612]], [[-0.2211, 0.0864, -0.1482, -0.179]], [[1.3185, 0.2648, 0.6259, 0.5445]]]]]