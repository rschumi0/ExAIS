import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con80851 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Sub74187 = tf.keras.layers.Input(shape=([2]))
in1Sub74187 = tf.keras.layers.Input(shape=([2]))
in0Con66180 = tf.keras.layers.Input(shape=([2]))
in0Con44136 = tf.keras.layers.Input(shape=([4, 1, 1]))
in0Max95779 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Ave78398 = tf.keras.layers.Input(shape=([2, 1]))
in0Min61708 = tf.keras.layers.Input(shape=([1, 1]))
in1Min61708 = tf.keras.layers.Input(shape=([1, 1]))
in0Lea82881 = tf.keras.layers.Input(shape=([1, 1]))
in0Con68756 = tf.keras.layers.Input(shape=([4, 1]))

Con80851 = keras.layers.Conv2D(2, (1, 1),strides=(1, 5), padding='same', dilation_rate=(1, 1), name = 'Con80851', )(in0Con80851)
Res51503 = keras.layers.Reshape((2, 2), name = 'Res51503', )(Con80851)
Fla97758 = keras.layers.Flatten(name = 'Fla97758', )(Res51503)
Sub74187 = keras.layers.Subtract(name = 'Sub74187', )([in0Sub74187,in1Sub74187])
Con66180 = keras.layers.Concatenate(axis=1, name = 'Con66180', )([Sub74187,in0Con66180])
Ave71295 = keras.layers.Average(name = 'Ave71295', )([Fla97758,Con66180])
Res4453 = keras.layers.Reshape((4, 1), name = 'Res4453', )(Ave71295)
Res16018 = keras.layers.Reshape((4, 1, 1), name = 'Res16018', )(Res4453)
Con44136 = keras.layers.Concatenate(axis=3, name = 'Con44136', )([Res16018,in0Con44136])
Max95779 = keras.layers.MaxPool2D(pool_size=(1, 1), name = 'Max95779', )(in0Max95779)
Zer76660 = keras.layers.ZeroPadding2D(padding=((3, 0), (0, 0)), name = 'Zer76660', )(Max95779)
Ave82219 = keras.layers.Average(name = 'Ave82219', )([Con44136,Zer76660])
Res15256 = keras.layers.Reshape((4, 2), name = 'Res15256', )(Ave82219)
Ave78398 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='valid', name = 'Ave78398', )(in0Ave78398)
Min61708 = keras.layers.Minimum(name = 'Min61708', )([in0Min61708,in1Min61708])
Zer39316 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer39316', )(Min61708)
Add60155 = keras.layers.Add(name = 'Add60155', )([Ave78398,Zer39316])
Lea82881 = keras.layers.LeakyReLU(alpha=8.953100778849903, name = 'Lea82881', input_shape=(1, 1))(in0Lea82881)
Dot51777 = keras.layers.Dot(axes=(2, 1), name = 'Dot51777', )([Add60155,Lea82881])
Zer87875 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer87875', )(Dot51777)
Con68756 = keras.layers.Concatenate(axis=2, name = 'Con68756', )([Zer87875,in0Con68756])
Min35888 = keras.layers.Minimum(name = 'Min35888', )([Res15256,Con68756])
model = tf.keras.models.Model(inputs=[in0Con80851,in0Sub74187,in1Sub74187,in0Con66180,in0Con44136,in0Max95779,in0Ave78398,in0Min61708,in1Min61708,in0Lea82881,in0Con68756], outputs=Min35888)
w = model.get_layer('Con80851').get_weights() 
w[0] = np.array([[[[0.2781, 0.7073], [0.0664, 0.2705]]]])
w[1] = np.array([0, 0])
model.get_layer('Con80851').set_weights(w) 
in0Con80851 = tf.constant([[[[0.8071, 0.4073], [0.4915, 0.2087]], [[0.4681, 0.6047], [0.0706, 0.188]]]])
in0Sub74187 = tf.constant([[0.9758, 0.8335]])
in1Sub74187 = tf.constant([[0.0944, 0.9805]])
in0Con66180 = tf.constant([[0.7336, 0.1549]])
in0Con44136 = tf.constant([[[[0.1791]], [[0.3396]], [[0.2426]], [[0.0502]]]])
in0Max95779 = tf.constant([[[[1.3077, 1.6735]]]])
in0Ave78398 = tf.constant([[[1.7762], [1.3513]]])
in0Min61708 = tf.constant([[[0.6928]]])
in1Min61708 = tf.constant([[[0.483]]])
in0Lea82881 = tf.constant([[[0.9614]]])
in0Con68756 = tf.constant([[[0.389], [0.5623], [0.2192], [0.6561]]])
print (np.array2string(model.predict([in0Con80851,in0Sub74187,in1Sub74187,in0Con66180,in0Con44136,in0Max95779,in0Ave78398,in0Min61708,in1Min61708,in0Lea82881,in0Con68756],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min35888.png')

LCon80851 = conv2D_layer([[[[0.8071, 0.4073], [0.4915, 0.2087]], [[0.4681, 0.6047], [0.0706, 0.188]]]], 1, 1,[[[[0.2781, 0.7073], [0.0664, 0.2705]]]],[0, 0], 1, 5, true, 1, 1, Con80851), 
LRes51503 = reshape_layer(Con80851, [2, 2], Res51503), 
LFla97758 = flatten_layer(Res51503, Fla97758), 
LSub74187 = subtract_layer([[0.9758, 0.8335]], [[0.0944, 0.9805]], Sub74187), 
LCon66180 = concatenate_layer([Sub74187,[[0.7336, 0.1549]]], 1, Con66180), 
LAve71295 = average_layer([Fla97758,Con66180], Ave71295), 
LRes4453 = reshape_layer(Ave71295, [4, 1], Res4453), 
LRes16018 = reshape_layer(Res4453, [4, 1, 1], Res16018), 
LCon44136 = concatenate_layer([Res16018,[[[[0.1791]], [[0.3396]], [[0.2426]], [[0.0502]]]]], 3, Con44136), 
LMax95779 = max_pool2D_layer([[[[1.3077, 1.6735]]]], 1, 1, Max95779), 
LZer76660 = zero_padding2D_layer(Max95779, 3, 0, 0, 0, Zer76660), 
LAve82219 = average_layer([Con44136,Zer76660], Ave82219), 
LRes15256 = reshape_layer(Ave82219, [4, 2], Res15256), 
LAve78398 = average_pooling1D_layer([[[1.7762], [1.3513]]], 1, 1, false, Ave78398), 
LMin61708 = minimum_layer([[[[0.6928]]], [[[0.483]]]], Min61708), 
LZer39316 = zero_padding1D_layer(Min61708, 1, 0, Zer39316), 
LAdd60155 = add_layer([Ave78398,Zer39316], Add60155), 
LLea82881 = leaky_relu_layer([[[0.9614]]], 8.953100778849903, Lea82881), 
LDot51777 = dot_layer(Add60155,Lea82881, 2, 1, Dot51777), 
LZer87875 = zero_padding1D_layer(Dot51777, 2, 0, Zer87875), 
LCon68756 = concatenate_layer([Zer87875,[[[0.389], [0.5623], [0.2192], [0.6561]]]], 2, Con68756), 
LMin35888 = minimum_layer([Res15256,Con68756], Min35888), 
exec_layers([LCon80851,LRes51503,LFla97758,LSub74187,LCon66180,LAve71295,LRes4453,LRes16018,LCon44136,LMax95779,LZer76660,LAve82219,LRes15256,LAve78398,LMin61708,LZer39316,LAdd60155,LLea82881,LDot51777,LZer87875,LCon68756,LMin35888],["Con80851","Res51503","Fla97758","Sub74187","Con66180","Ave71295","Res4453","Res16018","Con44136","Max95779","Zer76660","Ave82219","Res15256","Ave78398","Min61708","Zer39316","Add60155","Lea82881","Dot51777","Zer87875","Con68756","Min35888"],Min35888,"Min35888")

Actual (Unparsed): [[[0.0000000, 0.0895500], [0.0000000, 0.1698000], [0.2259827, 0.1213000], [0.8162396, 0.6561000]]]

Expected (Unparsed): [[[0,0.08955],[0,0.1698],[0.2259826725,0.1213],[0.81623962,0.6561]]]

Actual:   [[[0, 0.0896], [0, 0.1698], [0.226, 0.1213], [0.8163, 0.6561]]]

Expected: [[[0, 0.0896], [0, 0.1698], [0.226, 0.1213], [0.8163, 0.6561]]]