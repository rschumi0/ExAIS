import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min78607 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Min78607 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Glo26287 = tf.keras.layers.Input(shape=([2, 2]))

Min78607 = keras.layers.Minimum(name = 'Min78607', )([in0Min78607,in1Min78607])
Res72487 = keras.layers.Reshape((1, 1, 2), name = 'Res72487', )(Min78607)
Res27971 = keras.layers.Reshape((1, 2), name = 'Res27971', )(Res72487)
Fla11981 = keras.layers.Flatten(name = 'Fla11981', )(Res27971)
Glo26287 = keras.layers.GlobalAveragePooling1D(name = 'Glo26287', )(in0Glo26287)
Ave16840 = keras.layers.Average(name = 'Ave16840', )([Fla11981,Glo26287])
Lay51156 = keras.layers.LayerNormalization(axis=1, epsilon=2.054773220391722, name = 'Lay51156', )(Ave16840)
Res42265 = keras.layers.Reshape((2, 1), name = 'Res42265', )(Lay51156)
Sep21670 = keras.layers.SeparableConv1D(4, (2),strides=(1), padding='same', name = 'Sep21670', )(Res42265)
Con69233 = keras.layers.Conv1D(4, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con69233', )(Sep21670)
model = tf.keras.models.Model(inputs=[in0Min78607,in1Min78607,in0Glo26287], outputs=Con69233)
w = model.get_layer('Sep21670').get_weights() 
w[0] = np.array([[[0.6505]], [[0.1136]]])
w[1] = np.array([[[0.8231, 0.371, 0.5427, 0.2565]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep21670').set_weights(w) 
w = model.get_layer('Con69233').get_weights() 
w[0] = np.array([[[0.0915, 0.1427, 0.4813, 0.686], [0.5084, 0.1686, 0.3609, 0.5441], [0.0629, 0.2902, 0.4275, 0.9753], [0.0875, 0.875, 0.7339, 0.1189]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con69233').set_weights(w) 
in0Min78607 = tf.constant([[[[[0.67], [0.9167]]]]])
in1Min78607 = tf.constant([[[[[0.6481], [0.1466]]]]])
in0Glo26287 = tf.constant([[[1.4713, 1.7886], [1.7433, 1.8572]]])
print (np.array2string(model.predict([in0Min78607,in1Min78607,in0Glo26287],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con69233.png')

LMin78607 = minimum_layer([[[[[[0.67], [0.9167]]]]], [[[[[0.6481], [0.1466]]]]]], Min78607), 
LRes72487 = reshape_layer(Min78607, [1, 1, 2], Res72487), 
LRes27971 = reshape_layer(Res72487, [1, 2], Res27971), 
LFla11981 = flatten_layer(Res27971, Fla11981), 
LGlo26287 = global_average_pooling1D_layer([[[1.4713, 1.7886], [1.7433, 1.8572]]], Glo26287), 
LAve16840 = average_layer([Fla11981,Glo26287], Ave16840), 
LLay51156 = layer_normalization_layer(Ave16840, 1, 2.054773220391722, Lay51156), 
LRes42265 = reshape_layer(Lay51156, [2, 1], Res42265), 
LSep21670 = separable_conv1D_layer(Res42265, 2,[[[[0.6505]], [[0.1136]]],[[[0.8231, 0.371, 0.5427, 0.2565]]]],[0, 0, 0, 0], 1, true, Sep21670), 
LCon69233 = conv1D_layer(Sep21670, 1,[[[0.0915, 0.1427, 0.4813, 0.686], [0.5084, 0.1686, 0.3609, 0.5441], [0.0629, 0.2902, 0.4275, 0.9753], [0.0875, 0.875, 0.7339, 0.1189]]],[0, 0, 0, 0], 1, false, 1, Con69233), 
exec_layers([LMin78607,LRes72487,LRes27971,LFla11981,LGlo26287,LAve16840,LLay51156,LRes42265,LSep21670,LCon69233],["Min78607","Res72487","Res27971","Fla11981","Glo26287","Ave16840","Lay51156","Res42265","Sep21670","Con69233"],Con69233,"Con69233")

Actual (Unparsed): [[[0.0085697, 0.0150250, 0.0254090, 0.0354624], [-0.0103830, -0.0182040, -0.0307852, -0.0429657]]]

Expected (Unparsed): [[[0.00856973693255186,0.015024958153762284,0.025409015381851523,0.035462427333672615],[-0.010382964936906287,-0.01820401430251884,-0.030785182540313684,-0.042965745912747315]]]

Actual:   [[[0.0086, 0.0151, 0.0255, 0.0355], [-0.0103, -0.0182, -0.0307, -0.0429]]]

Expected: [[[0.0086, 0.0151, 0.0255, 0.0355], [-0.0103, -0.0182, -0.0307, -0.0429]]]