import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min7563 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Min7563 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Con18029 = tf.keras.layers.Input(shape=([2, 2, 3]))
in0Loc99425 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Ave48794 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con31064 = tf.keras.layers.Input(shape=([2, 4]))

Min7563 = keras.layers.Minimum(name = 'Min7563', )([in0Min7563,in1Min7563])
Res40256 = keras.layers.Reshape((2, 2, 1), name = 'Res40256', )(Min7563)
Con18029 = keras.layers.Concatenate(axis=3, name = 'Con18029', )([Res40256,in0Con18029])
Loc99425 = keras.layers.LocallyConnected2D(4, (1, 1),strides=(1, 1), name = 'Loc99425', )(in0Loc99425)
Zer25815 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer25815', )(Loc99425)
Min54535 = keras.layers.Minimum(name = 'Min54535', )([Con18029,Zer25815])
Res16182 = keras.layers.Reshape((2, 8), name = 'Res16182', )(Min54535)
Ave48794 = keras.layers.AveragePooling2D(pool_size=(2, 1), strides=(1, 1), padding='valid', name = 'Ave48794', )(in0Ave48794)
Res19261 = keras.layers.Reshape((1, 4), name = 'Res19261', )(Ave48794)
Cro1629 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro1629', )(Res19261)
Zer99822 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer99822', )(Cro1629)
Con31064 = keras.layers.Concatenate(axis=2, name = 'Con31064', )([Zer99822,in0Con31064])
Max24560 = keras.layers.Maximum(name = 'Max24560', )([Res16182,Con31064])
model = tf.keras.models.Model(inputs=[in0Min7563,in1Min7563,in0Con18029,in0Loc99425,in0Ave48794,in0Con31064], outputs=Max24560)
w = model.get_layer('Loc99425').get_weights() 
w[0] = np.array([[[0.2483, 0.0902, 0.9923, 0.0063], [0.048, 0.0866, 0.9567, 0.1555]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc99425').set_weights(w) 
in0Min7563 = tf.constant([[[[[0.5616]], [[0.7956]]], [[[0.4255]], [[0.1595]]]]])
in1Min7563 = tf.constant([[[[[0.9988]], [[0.5867]]], [[[0.261]], [[0.5928]]]]])
in0Con18029 = tf.constant([[[[0.4453, 0.448, 0.3304], [0.862, 0.6726, 0.5557]], [[0.3043, 0.4927, 0.5546], [0.5292, 0.8848, 0.0329]]]])
in0Loc99425 = tf.constant([[[[0.9208, 0.0329]]]])
in0Ave48794 = tf.constant([[[[1.0395, 1.2883], [1.4756, 1.7421]], [[1.4122, 1.7528], [1.1477, 1.8746]]]])
in0Con31064 = tf.constant([[[0.2915, 0.6909, 0.7011, 0.1957], [0.8813, 0.2901, 0.2546, 0.6004]]])
print (np.array2string(model.predict([in0Min7563,in1Min7563,in0Con18029,in0Loc99425,in0Ave48794,in0Con31064],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max24560.png')

LMin7563 = minimum_layer([[[[[[0.5616]], [[0.7956]]], [[[0.4255]], [[0.1595]]]]], [[[[[0.9988]], [[0.5867]]], [[[0.261]], [[0.5928]]]]]], Min7563), 
LRes40256 = reshape_layer(Min7563, [2, 2, 1], Res40256), 
LCon18029 = concatenate_layer([Res40256,[[[[0.4453, 0.448, 0.3304], [0.862, 0.6726, 0.5557]], [[0.3043, 0.4927, 0.5546], [0.5292, 0.8848, 0.0329]]]]], 3, Con18029), 
LLoc99425 = locally_connected2D_layer([[[[0.9208, 0.0329]]]], 1, 1,[[[0.2483, 0.0902, 0.9923, 0.0063], [0.048, 0.0866, 0.9567, 0.1555]]],[[[0, 0, 0, 0]]], 1, 1, Loc99425), 
LZer25815 = zero_padding2D_layer(Loc99425, 1, 0, 1, 0, Zer25815), 
LMin54535 = minimum_layer([Con18029,Zer25815], Min54535), 
LRes16182 = reshape_layer(Min54535, [2, 8], Res16182), 
LAve48794 = average_pooling2D_layer([[[[1.0395, 1.2883], [1.4756, 1.7421]], [[1.4122, 1.7528], [1.1477, 1.8746]]]], 2, 1, 1, 1, false, Ave48794), 
LRes19261 = reshape_layer(Ave48794, [1, 4], Res19261), 
LCro1629 = cropping1D_layer(Res19261, 0, 0, Cro1629), 
LZer99822 = zero_padding1D_layer(Cro1629, 1, 0, Zer99822), 
LCon31064 = concatenate_layer([Zer99822,[[[0.2915, 0.6909, 0.7011, 0.1957], [0.8813, 0.2901, 0.2546, 0.6004]]]], 2, Con31064), 
LMax24560 = maximum_layer([Res16182,Con31064], Max24560), 
exec_layers([LMin7563,LRes40256,LCon18029,LLoc99425,LZer25815,LMin54535,LRes16182,LAve48794,LRes19261,LCro1629,LZer99822,LCon31064,LMax24560],["Min7563","Res40256","Con18029","Loc99425","Zer25815","Min54535","Res16182","Ave48794","Res19261","Cro1629","Zer99822","Con31064","Max24560"],Max24560,"Max24560")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.2915000, 0.6909000, 0.7011000, 0.1957000], [1.2258500, 1.5205500, 1.3116500, 1.8083500, 0.8813000, 0.2901000, 0.8848000, 0.6004000]]]

Expected (Unparsed): [[[0,0,0,0,0.2915,0.6909,0.7011,0.1957],[1.2258499999999999,1.52055,1.31165,1.80835,0.8813,0.2901,0.8848,0.6004]]]

Actual:   [[[0, 0, 0, 0, 0.2915, 0.6909, 0.7011, 0.1957], [1.2259, 1.5206, 1.3117, 1.8084, 0.8813, 0.2901, 0.8848, 0.6004]]]

Expected: [[[0, 0, 0, 0, 0.2915, 0.6909, 0.7011, 0.1957], [1.2259, 1.5206, 1.3117, 1.8084, 0.8813, 0.2901, 0.8848, 0.6004]]]