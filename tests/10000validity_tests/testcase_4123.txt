import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul29143 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in1Mul29143 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Ave34554 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in1Ave34554 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))

Mul29143 = keras.layers.Multiply(name = 'Mul29143', )([in0Mul29143,in1Mul29143])
Res40305 = keras.layers.Reshape((1, 2, 2), name = 'Res40305', )(Mul29143)
Res12072 = keras.layers.Reshape((1, 4), name = 'Res12072', )(Res40305)
Max26862 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max26862', )(Res12072)
Ave34554 = keras.layers.Average(name = 'Ave34554', )([in0Ave34554,in1Ave34554])
Res18717 = keras.layers.Reshape((1, 1, 2), name = 'Res18717', )(Ave34554)
Res60231 = keras.layers.Reshape((1, 2), name = 'Res60231', )(Res18717)
Dot25790 = keras.layers.Dot(axes=(1, 1), name = 'Dot25790', )([Max26862,Res60231])
model = tf.keras.models.Model(inputs=[in0Mul29143,in1Mul29143,in0Ave34554,in1Ave34554], outputs=Dot25790)
in0Mul29143 = tf.constant([[[[[0.7084], [0.6586]], [[0.1357], [0.1298]]]]])
in1Mul29143 = tf.constant([[[[[0.9542], [0.408]], [[0.1519], [0.206]]]]])
in0Ave34554 = tf.constant([[[[[0.1993], [0.6848]]]]])
in1Ave34554 = tf.constant([[[[[0.8854], [0.5234]]]]])
print (np.array2string(model.predict([in0Mul29143,in1Mul29143,in0Ave34554,in1Ave34554],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot25790.png')

LMul29143 = multiply_layer([[[[[[0.7084], [0.6586]], [[0.1357], [0.1298]]]]], [[[[[0.9542], [0.408]], [[0.1519], [0.206]]]]]], Mul29143), 
LRes40305 = reshape_layer(Mul29143, [1, 2, 2], Res40305), 
LRes12072 = reshape_layer(Res40305, [1, 4], Res12072), 
LMax26862 = max_pool1D_layer(Res12072, 1, Max26862), 
LAve34554 = average_layer([[[[[[0.1993], [0.6848]]]]], [[[[[0.8854], [0.5234]]]]]], Ave34554), 
LRes18717 = reshape_layer(Ave34554, [1, 1, 2], Res18717), 
LRes60231 = reshape_layer(Res18717, [1, 2], Res60231), 
LDot25790 = dot_layer(Max26862,Res60231, 1, 1, Dot25790), 
exec_layers([LMul29143,LRes40305,LRes12072,LMax26862,LAve34554,LRes18717,LRes60231,LDot25790],["Mul29143","Res40305","Res12072","Max26862","Ave34554","Res18717","Res60231","Dot25790"],Dot25790,"Dot25790")

Actual (Unparsed): [[[0.3666044, 0.4083446], [0.1457342, 0.1623270], [0.0111794, 0.0124522], [0.0145018, 0.0161529]]]

Expected (Unparsed): [[[0.366604346108,0.408344584648],[0.14573421767999997,0.16232698607999999],[0.011179368350499999,0.012452210602999999],[0.014501788179999997,0.016152909079999996]]]

Actual:   [[[0.3667, 0.4084], [0.1458, 0.1624], [0.0112, 0.0125], [0.0146, 0.0162]]]

Expected: [[[0.3667, 0.4084], [0.1458, 0.1624], [0.0112, 0.0125], [0.0146, 0.0162]]]