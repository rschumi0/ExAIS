import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max92419 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Max92419 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Dep175 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Max18243 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Max18243 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con57237 = tf.keras.layers.Input(shape=([3]))

Max92419 = keras.layers.Maximum(name = 'Max92419', )([in0Max92419,in1Max92419])
Res31437 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res31437', )(Max92419)
Con64528 = keras.layers.Conv3D(4, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con64528', )(Res31437)
Res22623 = keras.layers.Reshape((1, 1, 4), name = 'Res22623', )(Con64528)
Dep175 = keras.layers.DepthwiseConv2D((2, 1),strides=(1, 1), padding='same', name = 'Dep175', )(in0Dep175)
Den25133 = keras.layers.Dense(2,name = 'Den25133', )(Dep175)
Res79618 = keras.layers.Reshape((2, 2), name = 'Res79618', )(Den25133)
Fla93244 = keras.layers.Flatten(name = 'Fla93244', )(Res79618)
Max18243 = keras.layers.Maximum(name = 'Max18243', )([in0Max18243,in1Max18243])
Res1257 = keras.layers.Reshape((1, 2), name = 'Res1257', )(Max18243)
Ave29960 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave29960', )(Res1257)
LST67722 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST67722', )(Ave29960)
Con57237 = keras.layers.Concatenate(axis=1, name = 'Con57237', )([LST67722,in0Con57237])
Max23291 = keras.layers.Maximum(name = 'Max23291', )([Fla93244,Con57237])
Res40953 = keras.layers.Reshape((1, 1, 4), name = 'Res40953', )(Max23291)
Ave93842 = keras.layers.Average(name = 'Ave93842', )([Res22623,Res40953])
model = tf.keras.models.Model(inputs=[in0Max92419,in1Max92419,in0Dep175,in0Max18243,in1Max18243,in0Con57237], outputs=Ave93842)
w = model.get_layer('Con64528').get_weights() 
w[0] = np.array([[[[[0.5568, 0.1217, 0.8977, 0.2428]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con64528').set_weights(w) 
w = model.get_layer('Dep175').get_weights() 
w[0] = np.array([[[[0.5607]]], [[[0.4498]]]])
w[1] = np.array([0])
model.get_layer('Dep175').set_weights(w) 
w = model.get_layer('Den25133').get_weights() 
w[0] = np.array([[0.1691, 0.9671]])
w[1] = np.array([0.8115, 0.4338])
model.get_layer('Den25133').set_weights(w) 
w = model.get_layer('LST67722').get_weights() 
w[0] = np.array([[10, 5, 5, 9], [3, 7, 3, 6]])
w[1] = np.array([[9, 1, 2, 5]])
w[2] = np.array([4, 8, 9, 9])
model.get_layer('LST67722').set_weights(w) 
in0Max92419 = tf.constant([[[[0.7462]]]])
in1Max92419 = tf.constant([[[[0.7543]]]])
in0Dep175 = tf.constant([[[[0.314]], [[0.8389]]]])
in0Max18243 = tf.constant([[[[0.3219, 0.4455]]]])
in1Max18243 = tf.constant([[[[0.7034, 0.6027]]]])
in0Con57237 = tf.constant([[0.9684, 0.1073, 0.2713]])
print (np.array2string(model.predict([in0Max92419,in1Max92419,in0Dep175,in0Max18243,in1Max18243,in0Con57237],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave93842.png')

LMax92419 = maximum_layer([[[[[0.7462]]]], [[[[0.7543]]]]], Max92419), 
LRes31437 = reshape_layer(Max92419, [1, 1, 1, 1], Res31437), 
LCon64528 = conv3D_layer(Res31437, 1, 1, 1,[[[[[0.5568, 0.1217, 0.8977, 0.2428]]]]],[0, 0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con64528), 
LRes22623 = reshape_layer(Con64528, [1, 1, 4], Res22623), 
LDep175 = depthwise_conv2D_layer([[[[0.314]], [[0.8389]]]], 2, 1,[[[[0.5607]]], [[[0.4498]]]],[0], 1, 1, true, Dep175), 
LDen25133 = dense_layer(Dep175, [[0.1691, 0.9671]],[0.8115, 0.4338], Den25133), 
LRes79618 = reshape_layer(Den25133, [2, 2], Res79618), 
LFla93244 = flatten_layer(Res79618, Fla93244), 
LMax18243 = maximum_layer([[[[[0.3219, 0.4455]]]], [[[[0.7034, 0.6027]]]]], Max18243), 
LRes1257 = reshape_layer(Max18243, [1, 2], Res1257), 
LAve29960 = average_pooling1D_layer(Res1257, 1, Ave29960), 
LLST67722 = lstm_layer(Ave29960,[[10, 5, 5, 9], [3, 7, 3, 6]],[[9, 1, 2, 5]],[4, 8, 9, 9], LST67722), 
LCon57237 = concatenate_layer([LST67722,[[0.9684, 0.1073, 0.2713]]], 1, Con57237), 
LMax23291 = maximum_layer([Fla93244,Con57237], Max23291), 
LRes40953 = reshape_layer(Max23291, [1, 1, 4], Res40953), 
LAve93842 = average_layer([Res22623,Res40953], Ave93842), 
exec_layers([LMax92419,LRes31437,LCon64528,LRes22623,LDep175,LDen25133,LRes79618,LFla93244,LMax18243,LRes1257,LAve29960,LLST67722,LCon57237,LMax23291,LRes40953,LAve93842],["Max92419","Res31437","Con64528","Res22623","Dep175","Den25133","Res79618","Fla93244","Max18243","Res1257","Ave29960","LST67722","Con57237","Max23291","Res40953","Ave93842"],Ave93842,"Ave93842")

Actual (Unparsed): [[[[0.6625368, 0.5303943, 0.7840874, 0.5359200]]]]

Expected (Unparsed): [[[[0.6625368380409999,0.530394284021,0.7840874424965001,0.5359200282665]]]]

Actual:   [[[[0.6626, 0.5304, 0.7841, 0.536]]]]

Expected: [[[[0.6626, 0.5304, 0.7841, 0.536]]]]