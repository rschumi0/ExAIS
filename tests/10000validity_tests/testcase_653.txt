import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave30266 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Ave30266 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0PRe39861 = tf.keras.layers.Input(shape=([1, 2]))
in0Con72833 = tf.keras.layers.Input(shape=([3, 1]))
in0Sub75588 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub75588 = tf.keras.layers.Input(shape=([3, 2]))

Ave30266 = keras.layers.Average(name = 'Ave30266', )([in0Ave30266,in1Ave30266])
Res15541 = keras.layers.Reshape((1, 1), name = 'Res15541', )(Ave30266)
PRe39861 = keras.layers.PReLU(name = 'PRe39861', input_shape=(1, 2))(in0PRe39861)
Dot9718 = keras.layers.Dot(axes=(2, 1), name = 'Dot9718', )([Res15541,PRe39861])
Cro9127 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro9127', )(Dot9718)
LST92013 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST92013', )(Cro9127)
Res79932 = keras.layers.Reshape((1, 1), name = 'Res79932', )(LST92013)
Zer44467 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer44467', )(Res79932)
Con72833 = keras.layers.Concatenate(axis=2, name = 'Con72833', )([Zer44467,in0Con72833])
Sub75588 = keras.layers.Subtract(name = 'Sub75588', )([in0Sub75588,in1Sub75588])
Max79792 = keras.layers.Maximum(name = 'Max79792', )([Con72833,Sub75588])
model = tf.keras.models.Model(inputs=[in0Ave30266,in1Ave30266,in0PRe39861,in0Con72833,in0Sub75588,in1Sub75588], outputs=Max79792)
w = model.get_layer('PRe39861').get_weights() 
w[0] = np.array([[0.0045, 0.3816]])
model.get_layer('PRe39861').set_weights(w) 
w = model.get_layer('LST92013').get_weights() 
w[0] = np.array([[8, 1, 5, 5], [7, 1, 8, 8]])
w[1] = np.array([[1, 5, 4, 7]])
w[2] = np.array([7, 6, 5, 7])
model.get_layer('LST92013').set_weights(w) 
in0Ave30266 = tf.constant([[[[0.6845]]]])
in1Ave30266 = tf.constant([[[[0.031]]]])
in0PRe39861 = tf.constant([[[0.2439, 0.0549]]])
in0Con72833 = tf.constant([[[0.8629], [0.2017], [0.8798]]])
in0Sub75588 = tf.constant([[[0.6976, 0.8865], [0.2443, 0.304], [0.6338, 0.5819]]])
in1Sub75588 = tf.constant([[[0.6374, 0.0869], [0.5774, 0.0133], [0.9397, 0.5563]]])
print (np.array2string(model.predict([in0Ave30266,in1Ave30266,in0PRe39861,in0Con72833,in0Sub75588,in1Sub75588],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max79792.png')

LAve30266 = average_layer([[[[[0.6845]]]], [[[[0.031]]]]], Ave30266), 
LRes15541 = reshape_layer(Ave30266, [1, 1], Res15541), 
LPRe39861 = prelu_layer([[[0.2439, 0.0549]]], [[0.0045, 0.3816]], PRe39861), 
LDot9718 = dot_layer(Res15541,PRe39861, 2, 1, Dot9718), 
LCro9127 = cropping1D_layer(Dot9718, 0, 0, Cro9127), 
LLST92013 = lstm_layer(Cro9127,[[8, 1, 5, 5], [7, 1, 8, 8]],[[1, 5, 4, 7]],[7, 6, 5, 7], LST92013), 
LRes79932 = reshape_layer(LST92013, [1, 1], Res79932), 
LZer44467 = zero_padding1D_layer(Res79932, 2, 0, Zer44467), 
LCon72833 = concatenate_layer([Zer44467,[[[0.8629], [0.2017], [0.8798]]]], 2, Con72833), 
LSub75588 = subtract_layer([[[0.6976, 0.8865], [0.2443, 0.304], [0.6338, 0.5819]]], [[[0.6374, 0.0869], [0.5774, 0.0133], [0.9397, 0.5563]]], Sub75588), 
LMax79792 = maximum_layer([Con72833,Sub75588], Max79792), 
exec_layers([LAve30266,LRes15541,LPRe39861,LDot9718,LCro9127,LLST92013,LRes79932,LZer44467,LCon72833,LSub75588,LMax79792],["Ave30266","Res15541","PRe39861","Dot9718","Cro9127","LST92013","Res79932","Zer44467","Con72833","Sub75588","Max79792"],Max79792,"Max79792")

Actual (Unparsed): [[[0.0602000, 0.8629000], [0.0000000, 0.2907000], [0.7610331, 0.8798000]]]

Expected (Unparsed): [[[0.06020000000000003,0.8629],[0,0.2907],[0.7610330763877643,0.8798]]]

Actual:   [[[0.0602, 0.8629], [0, 0.2907], [0.7611, 0.8798]]]

Expected: [[[0.0603, 0.8629], [0, 0.2907], [0.7611, 0.8798]]]