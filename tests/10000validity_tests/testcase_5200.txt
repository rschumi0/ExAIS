import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave68845 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Ave68845 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Dot20228 = tf.keras.layers.Input(shape=([2]))
in1Dot20228 = tf.keras.layers.Input(shape=([2]))

Ave68845 = keras.layers.Average(name = 'Ave68845', )([in0Ave68845,in1Ave68845])
Res89003 = keras.layers.Reshape((2, 1), name = 'Res89003', )(Ave68845)
Con22046 = keras.layers.Conv1D(3, (2),strides=(1), padding='same', dilation_rate=(1), name = 'Con22046', )(Res89003)
Res1580 = keras.layers.Reshape((2, 3, 1), name = 'Res1580', )(Con22046)
Dot20228 = keras.layers.Dot(axes=(1, 1), name = 'Dot20228', )([in0Dot20228,in1Dot20228])
Res33555 = keras.layers.Reshape((1, 1), name = 'Res33555', )(Dot20228)
Res20609 = keras.layers.Reshape((1, 1, 1), name = 'Res20609', )(Res33555)
Cro22377 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro22377', )(Res20609)
Mas54540 = keras.layers.Masking(mask_value=1, name = 'Mas54540', )(Cro22377)
Cro2114 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro2114', )(Mas54540)
Zer1219 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer1219', )(Cro2114)
Add29647 = keras.layers.Add(name = 'Add29647', )([Res1580,Zer1219])
ReL18638 = keras.layers.ReLU(max_value=7.664605628013242, negative_slope=8.609696391418892, threshold=0.5531277247457689, name = 'ReL18638', )(Add29647)
model = tf.keras.models.Model(inputs=[in0Ave68845,in1Ave68845,in0Dot20228,in1Dot20228], outputs=ReL18638)
w = model.get_layer('Con22046').get_weights() 
w[0] = np.array([[[0.095, 0.1126, 0.5303]], [[0.1984, 0.4311, 0.5746]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con22046').set_weights(w) 
in0Ave68845 = tf.constant([[[[0.483]], [[0.3111]]]])
in1Ave68845 = tf.constant([[[[0.0024]], [[0.356]]]])
in0Dot20228 = tf.constant([[0.7132, 0.0697]])
in1Dot20228 = tf.constant([[0.5188, 0.0561]])
print (np.array2string(model.predict([in0Ave68845,in1Ave68845,in0Dot20228,in1Dot20228],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='ReL18638.png')

LAve68845 = average_layer([[[[[0.483]], [[0.3111]]]], [[[[0.0024]], [[0.356]]]]], Ave68845), 
LRes89003 = reshape_layer(Ave68845, [2, 1], Res89003), 
LCon22046 = conv1D_layer(Res89003, 2,[[[0.095, 0.1126, 0.5303]], [[0.1984, 0.4311, 0.5746]]],[0, 0, 0], 1, true, 1, Con22046), 
LRes1580 = reshape_layer(Con22046, [2, 3, 1], Res1580), 
LDot20228 = dot_layer([[0.7132, 0.0697]], [[0.5188, 0.0561]], 1, 1, Dot20228), 
LRes33555 = reshape_layer(Dot20228, [1, 1], Res33555), 
LRes20609 = reshape_layer(Res33555, [1, 1, 1], Res20609), 
LCro22377 = cropping2D_layer(Res20609, 0, 0, 0, 0, Cro22377), 
LMas54540 = masking_layer(Cro22377, 1, Mas54540), 
LCro2114 = cropping2D_layer(Mas54540, 0, 0, 0, 0, Cro2114), 
LZer1219 = zero_padding2D_layer(Cro2114, 1, 0, 2, 0, Zer1219), 
LAdd29647 = add_layer([Res1580,Zer1219], Add29647), 
LReL18638 = relu_layer(Add29647, 7.664605628013242, 8.609696391418892, 0.5531277247457689, ReL18638), 
exec_layers([LAve68845,LRes89003,LCon22046,LRes1580,LDot20228,LRes33555,LRes20609,LCro22377,LMas54540,LCro2114,LZer1219,LAdd29647,LReL18638],["Ave68845","Res89003","Con22046","Res1580","Dot20228","Res33555","Res20609","Cro22377","Mas54540","Cro2114","Zer1219","Add29647","ReL18638"],ReL18638,"ReL18638")

Actual (Unparsed): [[[[-3.9939943], [-3.2889582], [-2.0040453]], [[-4.4894442], [-4.4389011], [-0.0200419]]]]

Expected (Unparsed): [[[[-3.9939942873872574],[-3.28895826042043],[-2.0040453198803507]],[[-4.4894441737584],[-4.438901123286503],[-0.020041907361984634]]]]

Actual:   [[[[-3.9939], [-3.2889], [-2.004]], [[-4.4894], [-4.4389], [-0.02]]]]

Expected: [[[[-3.9939], [-3.2889], [-2.004]], [[-4.4894], [-4.4389], [-0.02]]]]