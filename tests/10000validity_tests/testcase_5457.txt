import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot84164 = tf.keras.layers.Input(shape=([3]))
in1Dot84164 = tf.keras.layers.Input(shape=([3]))
in0Zer65643 = tf.keras.layers.Input(shape=([4, 4, 2, 1]))
in0Con43954 = tf.keras.layers.Input(shape=([6, 23]))
in0Ave3575 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave3575 = tf.keras.layers.Input(shape=([1, 2]))

Dot84164 = keras.layers.Dot(axes=(1, 1), name = 'Dot84164', )([in0Dot84164,in1Dot84164])
Res52000 = keras.layers.Reshape((1, 1), name = 'Res52000', )(Dot84164)
Res15706 = keras.layers.Reshape((1, 1, 1), name = 'Res15706', )(Res52000)
Res91568 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res91568', )(Res15706)
Zer44143 = keras.layers.ZeroPadding3D(padding=((5, 0), (5, 0), (3, 0)), name = 'Zer44143', )(Res91568)
Zer65643 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer65643', )(in0Zer65643)
Mul35205 = keras.layers.Multiply(name = 'Mul35205', )([Zer44143,Zer65643])
Res5509 = keras.layers.Reshape((6, 6, 4), name = 'Res5509', )(Mul35205)
Res85066 = keras.layers.Reshape((6, 24), name = 'Res85066', )(Res5509)
Con43954 = keras.layers.Concatenate(axis=2, name = 'Con43954', )([Res85066,in0Con43954])
Ave3575 = keras.layers.Average(name = 'Ave3575', )([in0Ave3575,in1Ave3575])
Res51777 = keras.layers.Reshape((1, 2, 1), name = 'Res51777', )(Ave3575)
Dep14993 = keras.layers.DepthwiseConv2D((1, 2),strides=(1, 1), padding='valid', name = 'Dep14993', )(Res51777)
Res94944 = keras.layers.Reshape((1, 1), name = 'Res94944', )(Dep14993)
Zer36871 = keras.layers.ZeroPadding1D(padding=((5, 0)), name = 'Zer36871', )(Res94944)
Dot97920 = keras.layers.Dot(axes=(1, 1), name = 'Dot97920', )([Con43954,Zer36871])
model = tf.keras.models.Model(inputs=[in0Dot84164,in1Dot84164,in0Zer65643,in0Con43954,in0Ave3575,in1Ave3575], outputs=Dot97920)
w = model.get_layer('Dep14993').get_weights() 
w[0] = np.array([[[[0.2369]], [[0.4149]]]])
w[1] = np.array([0])
model.get_layer('Dep14993').set_weights(w) 
in0Dot84164 = tf.constant([[0.4618, 0.4761, 0.9342]])
in1Dot84164 = tf.constant([[0.1709, 0.4722, 0.8135]])
in0Zer65643 = tf.constant([[[[[1.3396], [1.6861]], [[1.7845], [1.5917]], [[1.0352], [1.4415]], [[1.9188], [1.7314]]], [[[1.8969], [1.5347]], [[1.2606], [1.5104]], [[1.1556], [1.2159]], [[1.4925], [1.5425]]], [[[1.3656], [1.079]], [[1.6204], [1.4926]], [[1.6698], [1.8579]], [[1.6207], [1.1316]]], [[[1.5111], [1.4465]], [[1.7993], [1.498]], [[1.7679], [1.318]], [[1.7989], [1.1325]]]]])
in0Con43954 = tf.constant([[[0.5038, 0.4967, 0.6061, 0.124, 0.1602, 0.1367, 0.5382, 0.9675, 0.0241, 0.4516, 0.5716, 0.8755, 0.4383, 0.747, 0.8906, 0.7426, 0.3034, 0.5536, 0.3393, 0.9742, 0.6568, 0.2133, 0.4546], [0.8448, 0.5591, 0.2344, 0.1835, 0.4995, 0.6527, 0.7986, 0.5623, 0.8497, 0.0269, 0.2962, 0.9167, 0.7456, 0.5676, 0.7896, 0.2041, 0.9766, 0.8039, 0.861, 0.9666, 0.8447, 0.3685, 0.3882], [0.9867, 0.2831, 0.5864, 0.4084, 0.146, 0.7538, 0.3738, 0.3812, 0.1766, 0.4442, 0.5874, 0.8431, 0.9621, 0.6077, 0.1962, 0.6538, 0.8001, 0.2429, 0.1687, 0.7843, 0.5643, 0.6922, 0.7607], [0.8641, 0.0252, 0.1529, 0.9738, 0.5167, 0.6766, 0.5432, 0.3103, 0.8446, 0.295, 0.641, 0.5952, 0.2966, 0.1143, 0.9228, 0.5569, 0.5474, 0.938, 0.0694, 0.0625, 0.9525, 0.7299, 0.6789], [0.3902, 0.5992, 0.2255, 0.3254, 0.6861, 0.9736, 0.8886, 0.7407, 0.8024, 0.7823, 0.1012, 0.5581, 0.0412, 0.5259, 0.8193, 0.7539, 0.9405, 0.0091, 0.0532, 0.6518, 0.1283, 0.0878, 0.439], [0.1111, 0.4458, 0.6051, 0.8535, 0.3132, 0.9937, 0.6478, 0.4997, 0.379, 0.49, 0.9677, 0.1353, 0.9033, 0.3472, 0.6535, 0.1529, 0.3785, 0.1701, 0.9167, 0.0325, 0.3906, 0.9606, 0.1554]]])
in0Ave3575 = tf.constant([[[0.4019, 0.6059]]])
in1Ave3575 = tf.constant([[[0.8166, 0.575]]])
print (np.array2string(model.predict([in0Dot84164,in1Dot84164,in0Zer65643,in0Con43954,in0Ave3575,in1Ave3575],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot97920.png')

LDot84164 = dot_layer([[0.4618, 0.4761, 0.9342]], [[0.1709, 0.4722, 0.8135]], 1, 1, Dot84164), 
LRes52000 = reshape_layer(Dot84164, [1, 1], Res52000), 
LRes15706 = reshape_layer(Res52000, [1, 1, 1], Res15706), 
LRes91568 = reshape_layer(Res15706, [1, 1, 1, 1], Res91568), 
LZer44143 = zero_padding3D_layer(Res91568, 5, 0, 5, 0, 3, 0, Zer44143), 
LZer65643 = zero_padding3D_layer([[[[[1.3396], [1.6861]], [[1.7845], [1.5917]], [[1.0352], [1.4415]], [[1.9188], [1.7314]]], [[[1.8969], [1.5347]], [[1.2606], [1.5104]], [[1.1556], [1.2159]], [[1.4925], [1.5425]]], [[[1.3656], [1.079]], [[1.6204], [1.4926]], [[1.6698], [1.8579]], [[1.6207], [1.1316]]], [[[1.5111], [1.4465]], [[1.7993], [1.498]], [[1.7679], [1.318]], [[1.7989], [1.1325]]]]], 1, 1, 1, 1, 1, 1, Zer65643), 
LMul35205 = multiply_layer([Zer44143,Zer65643], Mul35205), 
LRes5509 = reshape_layer(Mul35205, [6, 6, 4], Res5509), 
LRes85066 = reshape_layer(Res5509, [6, 24], Res85066), 
LCon43954 = concatenate_layer([Res85066,[[[0.5038, 0.4967, 0.6061, 0.124, 0.1602, 0.1367, 0.5382, 0.9675, 0.0241, 0.4516, 0.5716, 0.8755, 0.4383, 0.747, 0.8906, 0.7426, 0.3034, 0.5536, 0.3393, 0.9742, 0.6568, 0.2133, 0.4546], [0.8448, 0.5591, 0.2344, 0.1835, 0.4995, 0.6527, 0.7986, 0.5623, 0.8497, 0.0269, 0.2962, 0.9167, 0.7456, 0.5676, 0.7896, 0.2041, 0.9766, 0.8039, 0.861, 0.9666, 0.8447, 0.3685, 0.3882], [0.9867, 0.2831, 0.5864, 0.4084, 0.146, 0.7538, 0.3738, 0.3812, 0.1766, 0.4442, 0.5874, 0.8431, 0.9621, 0.6077, 0.1962, 0.6538, 0.8001, 0.2429, 0.1687, 0.7843, 0.5643, 0.6922, 0.7607], [0.8641, 0.0252, 0.1529, 0.9738, 0.5167, 0.6766, 0.5432, 0.3103, 0.8446, 0.295, 0.641, 0.5952, 0.2966, 0.1143, 0.9228, 0.5569, 0.5474, 0.938, 0.0694, 0.0625, 0.9525, 0.7299, 0.6789], [0.3902, 0.5992, 0.2255, 0.3254, 0.6861, 0.9736, 0.8886, 0.7407, 0.8024, 0.7823, 0.1012, 0.5581, 0.0412, 0.5259, 0.8193, 0.7539, 0.9405, 0.0091, 0.0532, 0.6518, 0.1283, 0.0878, 0.439], [0.1111, 0.4458, 0.6051, 0.8535, 0.3132, 0.9937, 0.6478, 0.4997, 0.379, 0.49, 0.9677, 0.1353, 0.9033, 0.3472, 0.6535, 0.1529, 0.3785, 0.1701, 0.9167, 0.0325, 0.3906, 0.9606, 0.1554]]]], 2, Con43954), 
LAve3575 = average_layer([[[[0.4019, 0.6059]]], [[[0.8166, 0.575]]]], Ave3575), 
LRes51777 = reshape_layer(Ave3575, [1, 2, 1], Res51777), 
LDep14993 = depthwise_conv2D_layer(Res51777, 1, 2,[[[[0.2369]], [[0.4149]]]],[0], 1, 1, false, Dep14993), 
LRes94944 = reshape_layer(Dep14993, [1, 1], Res94944), 
LZer36871 = zero_padding1D_layer(Res94944, 5, 0, Zer36871), 
LDot97920 = dot_layer(Con43954,Zer36871, 1, 1, Dot97920), 
exec_layers([LDot84164,LRes52000,LRes15706,LRes91568,LZer44143,LZer65643,LMul35205,LRes5509,LRes85066,LCon43954,LAve3575,LRes51777,LDep14993,LRes94944,LZer36871,LDot97920],["Dot84164","Res52000","Res15706","Res91568","Zer44143","Zer65643","Mul35205","Res5509","Res85066","Con43954","Ave3575","Res51777","Dep14993","Res94944","Zer36871","Dot97920"],Dot97920,"Dot97920")

Actual (Unparsed): [[[0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0000000], [0.0432522], [0.1735540], [0.2355709], [0.3322753], [0.1219316], [0.3868564], [0.2521944], [0.1945377], [0.1475481], [0.1907614], [0.3767343], [0.0526735], [0.3516628], [0.1351681], [0.2544135], [0.0595253], [0.1473535], [0.0662215], [0.3568796], [0.0126525], [0.1520641], [0.3739703], [0.0604986]]]

Expected (Unparsed): [[[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.043252233232999995],[0.17355396557399996],[0.23557089405299997],[0.33227525710499994],[0.12193158819599997],[0.38685638311099996],[0.252194389634],[0.19453772229099997],[0.14754812236999998],[0.19076142469999996],[0.37673434833099995],[0.052673511758999994],[0.35166284679899995],[0.13516809521599998],[0.25441345110499997],[0.059525350686999996],[0.14735346785499998],[0.066221466003],[0.35687958780099993],[0.012652543474999998],[0.15206410711799997],[0.37397025421799995],[0.06049862326199999]]]

Actual:   [[[0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0.0433], [0.1736], [0.2356], [0.3323], [0.122], [0.3869], [0.2522], [0.1946], [0.1476], [0.1908], [0.3768], [0.0527], [0.3517], [0.1352], [0.2545], [0.0596], [0.1474], [0.0663], [0.3569], [0.0127], [0.1521], [0.374], [0.0605]]]

Expected: [[[0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0], [0.0433], [0.1736], [0.2356], [0.3323], [0.122], [0.3869], [0.2522], [0.1946], [0.1476], [0.1908], [0.3768], [0.0527], [0.3517], [0.1352], [0.2545], [0.0596], [0.1474], [0.0663], [0.3569], [0.0127], [0.1521], [0.374], [0.0605]]]