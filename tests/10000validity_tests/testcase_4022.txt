import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0PRe89171 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))

PRe89171 = keras.layers.PReLU(name = 'PRe89171', input_shape=(1, 1, 2, 2))(in0PRe89171)
Con59598 = keras.layers.Conv3D(3, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con59598', )(PRe89171)
Res93935 = keras.layers.Reshape((1, 1, 6), name = 'Res93935', )(Con59598)
Res81629 = keras.layers.Reshape((1, 6), name = 'Res81629', )(Res93935)
Per44824 = keras.layers.Permute((2,1), name = 'Per44824',)(Res81629)
Ave47727 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave47727', )(Per44824)
model = tf.keras.models.Model(inputs=[in0PRe89171], outputs=Ave47727)
w = model.get_layer('PRe89171').get_weights() 
w[0] = np.array([[[[0.4756, 0.5489], [0.7562, 0.9968]]]])
model.get_layer('PRe89171').set_weights(w) 
w = model.get_layer('Con59598').get_weights() 
w[0] = np.array([[[[[0.7809, 0.7048, 0.4012], [0.5438, 0.3289, 0.5359]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con59598').set_weights(w) 
in0PRe89171 = tf.constant([[[[[0.3657, 0.2965], [0.4503, 0.9571]]]]])
print (np.array2string(model.predict([in0PRe89171],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave47727.png')

LPRe89171 = prelu_layer([[[[[0.3657, 0.2965], [0.4503, 0.9571]]]]], [[[[0.4756, 0.5489], [0.7562, 0.9968]]]], PRe89171), 
LCon59598 = conv3D_layer(PRe89171, 1, 1, 1,[[[[[0.7809, 0.7048, 0.4012], [0.5438, 0.3289, 0.5359]]]]],[0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con59598), 
LRes93935 = reshape_layer(Con59598, [1, 1, 6], Res93935), 
LRes81629 = reshape_layer(Res93935, [1, 6], Res81629), 
LPer44824 = permute_layer(Res81629, 2,1, Per44824), 
LAve47727 = average_pooling1D_layer(Per44824, 1, Ave47727), 
exec_layers([LPRe89171,LCon59598,LRes93935,LRes81629,LPer44824,LAve47727],["PRe89171","Con59598","Res93935","Res81629","Per44824","Ave47727"],Ave47727,"Ave47727")

Actual (Unparsed): [[[0.4468118], [0.3552642], [0.3056132], [0.8721102], [0.6321616], [0.6935702]]]

Expected (Unparsed): [[[0.44681183],[0.35526421],[0.30561319000000003],[0.87211025],[0.6321616299999999],[0.6935702499999999]]]

Actual:   [[[0.4469], [0.3553], [0.3057], [0.8722], [0.6322], [0.6936]]]

Expected: [[[0.4469], [0.3553], [0.3057], [0.8722], [0.6322], [0.6936]]]