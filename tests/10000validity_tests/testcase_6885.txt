import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sep66028 = tf.keras.layers.Input(shape=([2, 1]))
in0Per28664 = tf.keras.layers.Input(shape=([3, 4]))

Sep66028 = keras.layers.SeparableConv1D(3, (1),strides=(1), padding='valid', name = 'Sep66028', )(in0Sep66028)
Per28664 = keras.layers.Permute((1,2), name = 'Per28664',)(in0Per28664)
Dot24000 = keras.layers.Dot(axes=(2, 1), name = 'Dot24000', )([Sep66028,Per28664])
Res22588 = keras.layers.Reshape((2, 4, 1), name = 'Res22588', )(Dot24000)
Res84240 = keras.layers.Reshape((2, 4, 1, 1), name = 'Res84240', )(Res22588)
Con26279 = keras.layers.Conv3D(4, (2, 4, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con26279', )(Res84240)
model = tf.keras.models.Model(inputs=[in0Sep66028,in0Per28664], outputs=Con26279)
w = model.get_layer('Sep66028').get_weights() 
w[0] = np.array([[[0.1771]]])
w[1] = np.array([[[0.911, 0.3546, 0.7427]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep66028').set_weights(w) 
w = model.get_layer('Con26279').get_weights() 
w[0] = np.array([[[[[0.78, 0.0516, 0.304, 0.8518]]], [[[0.2699, 0.0198, 0.5411, 0.0508]]], [[[0.3224, 0.7301, 0.8237, 0.4875]]], [[[0.6979, 0.6471, 0.4131, 0.4062]]]], [[[[0.2589, 0.5759, 0.0728, 0.9315]]], [[[0.293, 0.0101, 0.2262, 0.3447]]], [[[0.6287, 0.1465, 0.8905, 0.9835]]], [[[0.352, 0.919, 0.0208, 0.1741]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con26279').set_weights(w) 
in0Sep66028 = tf.constant([[[0.1221], [0.2652]]])
in0Per28664 = tf.constant([[[1.1819, 1.0631, 1.4282, 1.9691], [1.1886, 1.2839, 1.7084, 1.0318], [1.9535, 1.8863, 1.2991, 1.1851]]])
print (np.array2string(model.predict([in0Sep66028,in0Per28664],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con26279.png')

LSep66028 = separable_conv1D_layer([[[0.1221], [0.2652]]], 1,[[[[0.1771]]],[[[0.911, 0.3546, 0.7427]]]],[0, 0, 0], 1, false, Sep66028), 
LPer28664 = permute_layer([[[1.1819, 1.0631, 1.4282, 1.9691], [1.1886, 1.2839, 1.7084, 1.0318], [1.9535, 1.8863, 1.2991, 1.1851]]], 1,2, Per28664), 
LDot24000 = dot_layer(Sep66028,Per28664, 2, 1, Dot24000), 
LRes22588 = reshape_layer(Dot24000, [2, 4, 1], Res22588), 
LRes84240 = reshape_layer(Res22588, [2, 4, 1, 1], Res84240), 
LCon26279 = conv3D_layer(Res84240, 2, 4, 1,[[[[[0.78, 0.0516, 0.304, 0.8518]]], [[[0.2699, 0.0198, 0.5411, 0.0508]]], [[[0.3224, 0.7301, 0.8237, 0.4875]]], [[[0.6979, 0.6471, 0.4131, 0.4062]]]], [[[[0.2589, 0.5759, 0.0728, 0.9315]]], [[[0.293, 0.0101, 0.2262, 0.3447]]], [[[0.6287, 0.1465, 0.8905, 0.9835]]], [[[0.352, 0.919, 0.0208, 0.1741]]]]],[0, 0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con26279), 
exec_layers([LSep66028,LPer28664,LDot24000,LRes22588,LRes84240,LCon26279],["Sep66028","Per28664","Dot24000","Res22588","Res84240","Con26279"],Con26279,"Con26279")

Actual (Unparsed): [[[[[0.3419079, 0.3244506, 0.2939122, 0.4466551]]]]]

Expected (Unparsed): [[[[[0.34190788226423763,0.32445057515707276,0.2939122159224526,0.4466551518231794]]]]]

Actual:   [[[[[0.342, 0.3245, 0.294, 0.4467]]]]]

Expected: [[[[[0.342, 0.3245, 0.294, 0.4467]]]]]