import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST43681 = tf.keras.layers.Input(shape=([1, 3]))
in0Con59278 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Max71709 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Max71709 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Ave56981 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))
in1Ave56981 = tf.keras.layers.Input(shape=([1, 1, 1, 1]))

LST43681 = keras.layers.LSTM(2,recurrent_activation='sigmoid', name = 'LST43681', )(in0LST43681)
Res9695 = keras.layers.Reshape((2, 1), name = 'Res9695', )(LST43681)
Res50426 = keras.layers.Reshape((2, 1, 1), name = 'Res50426', )(Res9695)
Con59278 = keras.layers.Concatenate(axis=3, name = 'Con59278', )([Res50426,in0Con59278])
Max71709 = keras.layers.Maximum(name = 'Max71709', )([in0Max71709,in1Max71709])
Zer94604 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer94604', )(Max71709)
Add90827 = keras.layers.Add(name = 'Add90827', )([Con59278,Zer94604])
Res40280 = keras.layers.Reshape((2, 1, 2, 1), name = 'Res40280', )(Add90827)
Zer72014 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer72014', )(Res40280)
Ave56981 = keras.layers.Average(name = 'Ave56981', )([in0Ave56981,in1Ave56981])
Zer64464 = keras.layers.ZeroPadding3D(padding=((3, 0), (2, 0), (3, 0)), name = 'Zer64464', )(Ave56981)
Max61489 = keras.layers.Maximum(name = 'Max61489', )([Zer72014,Zer64464])
Res82903 = keras.layers.Reshape((4, 3, 4), name = 'Res82903', )(Max61489)
Res79818 = keras.layers.Reshape((4, 12), name = 'Res79818', )(Res82903)
LST72256 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST72256', )(Res79818)
model = tf.keras.models.Model(inputs=[in0LST43681,in0Con59278,in0Max71709,in1Max71709,in0Ave56981,in1Ave56981], outputs=LST72256)
w = model.get_layer('LST43681').get_weights() 
w[0] = np.array([[7, 5, 5, 4, 8, 8, 1, 8], [1, 3, 2, 2, 4, 9, 8, 2], [5, 3, 5, 1, 5, 6, 9, 4]])
w[1] = np.array([[8, 7, 4, 10, 1, 7, 2, 2], [2, 10, 9, 4, 3, 3, 10, 5]])
w[2] = np.array([9, 1, 6, 6, 7, 4, 4, 5])
model.get_layer('LST43681').set_weights(w) 
w = model.get_layer('LST72256').get_weights() 
w[0] = np.array([[9, 3, 4, 10], [8, 3, 7, 3], [7, 1, 5, 4], [9, 4, 4, 2], [1, 6, 4, 2], [7, 5, 2, 5], [6, 3, 4, 8], [3, 7, 10, 1], [10, 6, 6, 5], [10, 8, 3, 7], [10, 2, 10, 8], [7, 10, 5, 9]])
w[1] = np.array([[1, 5, 7, 4]])
w[2] = np.array([9, 3, 5, 5])
model.get_layer('LST72256').set_weights(w) 
in0LST43681 = tf.constant([[[4, 1, 6]]])
in0Con59278 = tf.constant([[[[0.1471]], [[0.6128]]]])
in0Max71709 = tf.constant([[[[0.5471, 0.3823]]]])
in1Max71709 = tf.constant([[[[0.9996, 0.2973]]]])
in0Ave56981 = tf.constant([[[[[0.8306]]]]])
in1Ave56981 = tf.constant([[[[[0.5892]]]]])
print (np.array2string(model.predict([in0LST43681,in0Con59278,in0Max71709,in1Max71709,in0Ave56981,in1Ave56981],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST72256.png')

LLST43681 = lstm_layer([[[4, 1, 6]]],[[7, 5, 5, 4, 8, 8, 1, 8], [1, 3, 2, 2, 4, 9, 8, 2], [5, 3, 5, 1, 5, 6, 9, 4]],[[8, 7, 4, 10, 1, 7, 2, 2], [2, 10, 9, 4, 3, 3, 10, 5]],[9, 1, 6, 6, 7, 4, 4, 5], LST43681), 
LRes9695 = reshape_layer(LST43681, [2, 1], Res9695), 
LRes50426 = reshape_layer(Res9695, [2, 1, 1], Res50426), 
LCon59278 = concatenate_layer([Res50426,[[[[0.1471]], [[0.6128]]]]], 3, Con59278), 
LMax71709 = maximum_layer([[[[[0.5471, 0.3823]]]], [[[[0.9996, 0.2973]]]]], Max71709), 
LZer94604 = zero_padding2D_layer(Max71709, 1, 0, 0, 0, Zer94604), 
LAdd90827 = add_layer([Con59278,Zer94604], Add90827), 
LRes40280 = reshape_layer(Add90827, [2, 1, 2, 1], Res40280), 
LZer72014 = zero_padding3D_layer(Res40280, 1, 1, 1, 1, 1, 1, Zer72014), 
LAve56981 = average_layer([[[[[[0.8306]]]]], [[[[[0.5892]]]]]], Ave56981), 
LZer64464 = zero_padding3D_layer(Ave56981, 3, 0, 2, 0, 3, 0, Zer64464), 
LMax61489 = maximum_layer([Zer72014,Zer64464], Max61489), 
LRes82903 = reshape_layer(Max61489, [4, 3, 4], Res82903), 
LRes79818 = reshape_layer(Res82903, [4, 12], Res79818), 
LLST72256 = lstm_layer(Res79818,[[9, 3, 4, 10], [8, 3, 7, 3], [7, 1, 5, 4], [9, 4, 4, 2], [1, 6, 4, 2], [7, 5, 2, 5], [6, 3, 4, 8], [3, 7, 10, 1], [10, 6, 6, 5], [10, 8, 3, 7], [10, 2, 10, 8], [7, 10, 5, 9]],[[1, 5, 7, 4]],[9, 3, 5, 5], LST72256), 
exec_layers([LLST43681,LRes9695,LRes50426,LCon59278,LMax71709,LZer94604,LAdd90827,LRes40280,LZer72014,LAve56981,LZer64464,LMax61489,LRes82903,LRes79818,LLST72256],["LST43681","Res9695","Res50426","Con59278","Max71709","Zer94604","Add90827","Res40280","Zer72014","Ave56981","Zer64464","Max61489","Res82903","Res79818","LST72256"],LST72256,"LST72256")

Actual (Unparsed): [[0.9993288]]

Expected (Unparsed): [[0.9993287777303266]]

Actual:   [[0.9994]]

Expected: [[0.9994]]