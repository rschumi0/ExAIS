import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max61076 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Max61076 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in0Zer26504 = tf.keras.layers.Input(shape=([3, 4, 1]))
in0Con19132 = tf.keras.layers.Input(shape=([6, 3]))

Max61076 = keras.layers.Maximum(name = 'Max61076', )([in0Max61076,in1Max61076])
Res27836 = keras.layers.Reshape((1, 1, 4), name = 'Res27836', )(Max61076)
Res92408 = keras.layers.Reshape((1, 4), name = 'Res92408', )(Res27836)
Zer2952 = keras.layers.ZeroPadding1D(padding=((5, 0)), name = 'Zer2952', )(Res92408)
Zer26504 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer26504', )(in0Zer26504)
Res7076 = keras.layers.Reshape((5, 6), name = 'Res7076', )(Zer26504)
Glo56300 = keras.layers.GlobalAveragePooling1D(name = 'Glo56300', )(Res7076)
Res79845 = keras.layers.Reshape((6, 1), name = 'Res79845', )(Glo56300)
PRe51716 = keras.layers.PReLU(name = 'PRe51716', )(Res79845)
Con19132 = keras.layers.Concatenate(axis=2, name = 'Con19132', )([PRe51716,in0Con19132])
Mul44768 = keras.layers.Multiply(name = 'Mul44768', )([Zer2952,Con19132])
Res15438 = keras.layers.Reshape((6, 4, 1), name = 'Res15438', )(Mul44768)
Loc10064 = keras.layers.LocallyConnected2D(3, (1, 3),strides=(1, 12), name = 'Loc10064', )(Res15438)
model = tf.keras.models.Model(inputs=[in0Max61076,in1Max61076,in0Zer26504,in0Con19132], outputs=Loc10064)
w = model.get_layer('PRe51716').get_weights() 
w[0] = np.array([[0.9321], [0.8013], [0.0741], [0.636], [0.7381], [0.9433]])
model.get_layer('PRe51716').set_weights(w) 
w = model.get_layer('Loc10064').get_weights() 
w[0] = np.array([[[0.2511, 0.5899, 0.0472], [0.9251, 0.7841, 0.2663], [0.6608, 0.4094, 0.9201]], [[0.8724, 0.2518, 0.4519], [0.762, 0.4972, 0.9669], [0.7676, 0.774, 0.9898]], [[0.1692, 0.5123, 0.4201], [0.565, 0.1311, 0.0275], [0.7935, 0.6145, 0.4557]], [[0.4963, 0.4228, 0.4323], [0.1472, 0.0385, 0.6079], [0.2126, 0.9435, 0.5647]], [[0.0989, 0.8566, 0.9883], [0.5286, 0.6619, 0.84], [0.1767, 0.5711, 0.0947]], [[0.6336, 0.5361, 0.9316], [0.5522, 0.9438, 0.8205], [0.4194, 0.6213, 0.348]]])
w[1] = np.array([[[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]]])
model.get_layer('Loc10064').set_weights(w) 
in0Max61076 = tf.constant([[[[[0.9775, 0.3141], [0.3847, 0.6508]]]]])
in1Max61076 = tf.constant([[[[[0.3267, 0.0815], [0.7329, 0.8727]]]]])
in0Zer26504 = tf.constant([[[[1.4205], [1.028], [1.812], [1.7403]], [[1.0686], [1.2527], [1.7304], [1.7635]], [[1.266], [1.7448], [1.24], [1.5506]]]])
in0Con19132 = tf.constant([[[0.8035, 0.0901, 0.6239], [0.5254, 0.9027, 0.1934], [0.6998, 0.5286, 0.8038], [0.643, 0.0898, 0.5756], [0.9704, 0.1865, 0.2784], [0.3388, 0.0035, 0.3762]]])
print (np.array2string(model.predict([in0Max61076,in1Max61076,in0Zer26504,in0Con19132],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc10064.png')

LMax61076 = maximum_layer([[[[[[0.9775, 0.3141], [0.3847, 0.6508]]]]], [[[[[0.3267, 0.0815], [0.7329, 0.8727]]]]]], Max61076), 
LRes27836 = reshape_layer(Max61076, [1, 1, 4], Res27836), 
LRes92408 = reshape_layer(Res27836, [1, 4], Res92408), 
LZer2952 = zero_padding1D_layer(Res92408, 5, 0, Zer2952), 
LZer26504 = zero_padding2D_layer([[[[1.4205], [1.028], [1.812], [1.7403]], [[1.0686], [1.2527], [1.7304], [1.7635]], [[1.266], [1.7448], [1.24], [1.5506]]]], 1, 1, 1, 1, Zer26504), 
LRes7076 = reshape_layer(Zer26504, [5, 6], Res7076), 
LGlo56300 = global_average_pooling1D_layer(Res7076, Glo56300), 
LRes79845 = reshape_layer(Glo56300, [6, 1], Res79845), 
LPRe51716 = prelu_layer(Res79845, [[0.9321], [0.8013], [0.0741], [0.636], [0.7381], [0.9433]], PRe51716), 
LCon19132 = concatenate_layer([PRe51716,[[[0.8035, 0.0901, 0.6239], [0.5254, 0.9027, 0.1934], [0.6998, 0.5286, 0.8038], [0.643, 0.0898, 0.5756], [0.9704, 0.1865, 0.2784], [0.3388, 0.0035, 0.3762]]]], 2, Con19132), 
LMul44768 = multiply_layer([Zer2952,Con19132], Mul44768), 
LRes15438 = reshape_layer(Mul44768, [6, 4, 1], Res15438), 
LLoc10064 = locally_connected2D_layer(Res15438, 1, 3,[[[0.2511, 0.5899, 0.0472], [0.9251, 0.7841, 0.2663], [0.6608, 0.4094, 0.9201]], [[0.8724, 0.2518, 0.4519], [0.762, 0.4972, 0.9669], [0.7676, 0.774, 0.9898]], [[0.1692, 0.5123, 0.4201], [0.565, 0.1311, 0.0275], [0.7935, 0.6145, 0.4557]], [[0.4963, 0.4228, 0.4323], [0.1472, 0.0385, 0.6079], [0.2126, 0.9435, 0.5647]], [[0.0989, 0.8566, 0.9883], [0.5286, 0.6619, 0.84], [0.1767, 0.5711, 0.0947]], [[0.6336, 0.5361, 0.9316], [0.5522, 0.9438, 0.8205], [0.4194, 0.6213, 0.348]]],[[[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]]], 1, 12, Loc10064), 
exec_layers([LMax61076,LRes27836,LRes92408,LZer2952,LZer26504,LRes7076,LGlo56300,LRes79845,LPRe51716,LCon19132,LMul44768,LRes15438,LLoc10064],["Max61076","Res27836","Res92408","Zer2952","Zer26504","Res7076","Glo56300","Res79845","PRe51716","Con19132","Mul44768","Res15438","Loc10064"],Loc10064,"Loc10064")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000]], [[0.0598393, 0.1020302, 0.0882079]]]]

Expected (Unparsed): [[[[0.0,0.0,0.0]],[[0.0,0.0,0.0]],[[0.0,0.0,0.0]],[[0.0,0.0,0.0]],[[0.0,0.0,0.0]],[[0.059839335486000005,0.102030167799,0.08820788634]]]]

Actual:   [[[[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]], [[0.0599, 0.1021, 0.0883]]]]

Expected: [[[[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]], [[0, 0, 0]], [[0.0599, 0.1021, 0.0883]]]]