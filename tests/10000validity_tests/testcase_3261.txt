import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc13062 = tf.keras.layers.Input(shape=([2, 2]))
in0Max92667 = tf.keras.layers.Input(shape=([1, 1]))
in1Max92667 = tf.keras.layers.Input(shape=([1, 1]))
in0Con17466 = tf.keras.layers.Input(shape=([2, 1]))
in0Min4292 = tf.keras.layers.Input(shape=([1, 2]))
in1Min4292 = tf.keras.layers.Input(shape=([1, 2]))
in0Con92425 = tf.keras.layers.Input(shape=([10]))
in0Fla13217 = tf.keras.layers.Input(shape=([3, 1, 4]))

Loc13062 = keras.layers.LocallyConnected1D(2, (1),strides=(1), name = 'Loc13062', )(in0Loc13062)
Max92667 = keras.layers.Maximum(name = 'Max92667', )([in0Max92667,in1Max92667])
Zer805 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer805', )(Max92667)
Con17466 = keras.layers.Concatenate(axis=2, name = 'Con17466', )([Zer805,in0Con17466])
Ave57732 = keras.layers.Average(name = 'Ave57732', )([Loc13062,Con17466])
Fla19537 = keras.layers.Flatten(name = 'Fla19537', )(Ave57732)
Sof96553 = keras.layers.Softmax(axis=1, name = 'Sof96553', )(Fla19537)
Res7047 = keras.layers.Reshape((4, 1), name = 'Res7047', )(Sof96553)
Zer43812 = keras.layers.ZeroPadding1D(padding=((8, 0)), name = 'Zer43812', )(Res7047)
Min4292 = keras.layers.Minimum(name = 'Min4292', )([in0Min4292,in1Min4292])
Fla12540 = keras.layers.Flatten(name = 'Fla12540', )(Min4292)
Con92425 = keras.layers.Concatenate(axis=1, name = 'Con92425', )([Fla12540,in0Con92425])
Fla13217 = keras.layers.Flatten(name = 'Fla13217', )(in0Fla13217)
Max78449 = keras.layers.Maximum(name = 'Max78449', )([Con92425,Fla13217])
Res66273 = keras.layers.Reshape((12, 1), name = 'Res66273', )(Max78449)
PRe65954 = keras.layers.PReLU(name = 'PRe65954', )(Res66273)
Ave67159 = keras.layers.Average(name = 'Ave67159', )([Zer43812,PRe65954])
model = tf.keras.models.Model(inputs=[in0Loc13062,in0Max92667,in1Max92667,in0Con17466,in0Min4292,in1Min4292,in0Con92425,in0Fla13217], outputs=Ave67159)
w = model.get_layer('Loc13062').get_weights() 
w[0] = np.array([[[0.5857, 0.9827], [0.3884, 0.2981]], [[0.2103, 0.5691], [0.3401, 0.4533]]])
w[1] = np.array([[0, 0], [0, 0]])
model.get_layer('Loc13062').set_weights(w) 
w = model.get_layer('PRe65954').get_weights() 
w[0] = np.array([[0.8257], [0.4591], [0.6264], [0.171], [0.1613], [0.1689], [0.6265], [0.9537], [0.7208], [0.9944], [0.7332], [0.7974]])
model.get_layer('PRe65954').set_weights(w) 
in0Loc13062 = tf.constant([[[0.919, 0.7299], [0.9614, 0.9281]]])
in0Max92667 = tf.constant([[[0.1384]]])
in1Max92667 = tf.constant([[[0.4115]]])
in0Con17466 = tf.constant([[[0.5955], [0.6189]]])
in0Min4292 = tf.constant([[[0.4514, 0.9636]]])
in1Min4292 = tf.constant([[[0.2902, 0.6114]]])
in0Con92425 = tf.constant([[0.2771, 0.4662, 0.6672, 0.9188, 0.6374, 0.5173, 0.114, 0.9338, 0.3174, 0.3456]])
in0Fla13217 = tf.constant([[[[1.9489, 1.057, 1.5634, 1.6819]], [[1.0951, 1.961, 1.4067, 1.594]], [[1.092, 1.1691, 1.1826, 1.6611]]]])
print (np.array2string(model.predict([in0Loc13062,in0Max92667,in1Max92667,in0Con17466,in0Min4292,in1Min4292,in0Con92425,in0Fla13217],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave67159.png')

LLoc13062 = locally_connected1D_layer([[[0.919, 0.7299], [0.9614, 0.9281]]], 1,[[[0.5857, 0.9827], [0.3884, 0.2981]], [[0.2103, 0.5691], [0.3401, 0.4533]]],[[0, 0], [0, 0]], 1, Loc13062), 
LMax92667 = maximum_layer([[[[0.1384]]], [[[0.4115]]]], Max92667), 
LZer805 = zero_padding1D_layer(Max92667, 1, 0, Zer805), 
LCon17466 = concatenate_layer([Zer805,[[[0.5955], [0.6189]]]], 2, Con17466), 
LAve57732 = average_layer([Loc13062,Con17466], Ave57732), 
LFla19537 = flatten_layer(Ave57732, Fla19537), 
LSof96553 = softmax_layer(Fla19537, 1, Sof96553), 
LRes7047 = reshape_layer(Sof96553, [4, 1], Res7047), 
LZer43812 = zero_padding1D_layer(Res7047, 8, 0, Zer43812), 
LMin4292 = minimum_layer([[[[0.4514, 0.9636]]], [[[0.2902, 0.6114]]]], Min4292), 
LFla12540 = flatten_layer(Min4292, Fla12540), 
LCon92425 = concatenate_layer([Fla12540,[[0.2771, 0.4662, 0.6672, 0.9188, 0.6374, 0.5173, 0.114, 0.9338, 0.3174, 0.3456]]], 1, Con92425), 
LFla13217 = flatten_layer([[[[1.9489, 1.057, 1.5634, 1.6819]], [[1.0951, 1.961, 1.4067, 1.594]], [[1.092, 1.1691, 1.1826, 1.6611]]]], Fla13217), 
LMax78449 = maximum_layer([Con92425,Fla13217], Max78449), 
LRes66273 = reshape_layer(Max78449, [12, 1], Res66273), 
LPRe65954 = prelu_layer(Res66273, [[0.8257], [0.4591], [0.6264], [0.171], [0.1613], [0.1689], [0.6265], [0.9537], [0.7208], [0.9944], [0.7332], [0.7974]], PRe65954), 
LAve67159 = average_layer([Zer43812,PRe65954], Ave67159), 
exec_layers([LLoc13062,LMax92667,LZer805,LCon17466,LAve57732,LFla19537,LSof96553,LRes7047,LZer43812,LMin4292,LFla12540,LCon92425,LFla13217,LMax78449,LRes66273,LPRe65954,LAve67159],["Loc13062","Max92667","Zer805","Con17466","Ave57732","Fla19537","Sof96553","Res7047","Zer43812","Min4292","Fla12540","Con92425","Fla13217","Max78449","Res66273","PRe65954","Ave67159"],Ave67159,"Ave67159")

Actual (Unparsed): [[[0.9744500], [0.5285000], [0.7817000], [0.8409500], [0.5475500], [0.9805000], [0.7033500], [0.7970000], [0.6443255], [0.7383265], [0.6950591], [0.9746890]]]

Expected (Unparsed): [[[0.97445],[0.5285],[0.7817],[0.84095],[0.54755],[0.9805],[0.70335],[0.797],[0.6443254874908031],[0.7383264295244031],[0.6950591306246615],[0.9746889523601324]]]

Actual:   [[[0.9745], [0.5285], [0.7817], [0.841], [0.5476], [0.9805], [0.7034], [0.797], [0.6444], [0.7384], [0.6951], [0.9747]]]

Expected: [[[0.9745], [0.5285], [0.7817], [0.841], [0.5476], [0.9805], [0.7034], [0.797], [0.6444], [0.7384], [0.6951], [0.9747]]]