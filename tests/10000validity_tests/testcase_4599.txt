import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave54610 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in1Ave54610 = tf.keras.layers.Input(shape=([2, 1, 1, 1]))
in0Dot16702 = tf.keras.layers.Input(shape=([2]))
in1Dot16702 = tf.keras.layers.Input(shape=([2]))

Ave54610 = keras.layers.Average(name = 'Ave54610', )([in0Ave54610,in1Ave54610])
Res40892 = keras.layers.Reshape((2, 1, 1), name = 'Res40892', )(Ave54610)
Res44902 = keras.layers.Reshape((2, 1), name = 'Res44902', )(Res40892)
Loc22259 = keras.layers.LocallyConnected1D(3, (1),strides=(1), name = 'Loc22259', )(Res44902)
ELU18922 = keras.layers.ELU(alpha=-3.8591213146009817, name = 'ELU18922', )(Loc22259)
Res13735 = keras.layers.Reshape((2, 3, 1), name = 'Res13735', )(ELU18922)
Res33867 = keras.layers.Reshape((2, 3, 1, 1), name = 'Res33867', )(Res13735)
Zer63030 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (2, 0)), name = 'Zer63030', )(Res33867)
Dot16702 = keras.layers.Dot(axes=(1, 1), name = 'Dot16702', )([in0Dot16702,in1Dot16702])
Res14309 = keras.layers.Reshape((1, 1), name = 'Res14309', )(Dot16702)
Res56615 = keras.layers.Reshape((1, 1, 1), name = 'Res56615', )(Res14309)
Res91179 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res91179', )(Res56615)
Zer29998 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer29998', )(Res91179)
Ave70616 = keras.layers.Average(name = 'Ave70616', )([Zer63030,Zer29998])
Res10480 = keras.layers.Reshape((3, 3, 3), name = 'Res10480', )(Ave70616)
Res6510 = keras.layers.Reshape((3, 9), name = 'Res6510', )(Res10480)
Max33839 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max33839', )(Res6510)
model = tf.keras.models.Model(inputs=[in0Ave54610,in1Ave54610,in0Dot16702,in1Dot16702], outputs=Max33839)
w = model.get_layer('Loc22259').get_weights() 
w[0] = np.array([[[0.406, 0.9568, 0.2942]], [[0.0209, 0.0586, 0.8236]]])
w[1] = np.array([[0, 0, 0], [0, 0, 0]])
model.get_layer('Loc22259').set_weights(w) 
in0Ave54610 = tf.constant([[[[[0.6078]]], [[[0.8326]]]]])
in1Ave54610 = tf.constant([[[[[0.8966]]], [[[0.211]]]]])
in0Dot16702 = tf.constant([[0.3847, 0.0642]])
in1Dot16702 = tf.constant([[0.5323, 0.6981]])
print (np.array2string(model.predict([in0Ave54610,in1Ave54610,in0Dot16702,in1Dot16702],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max33839.png')

LAve54610 = average_layer([[[[[[0.6078]]], [[[0.8326]]]]], [[[[[0.8966]]], [[[0.211]]]]]], Ave54610), 
LRes40892 = reshape_layer(Ave54610, [2, 1, 1], Res40892), 
LRes44902 = reshape_layer(Res40892, [2, 1], Res44902), 
LLoc22259 = locally_connected1D_layer(Res44902, 1,[[[0.406, 0.9568, 0.2942]], [[0.0209, 0.0586, 0.8236]]],[[0, 0, 0], [0, 0, 0]], 1, Loc22259), 
LELU18922 = elu_layer(Loc22259, -3.8591213146009817, ELU18922), 
LRes13735 = reshape_layer(ELU18922, [2, 3, 1], Res13735), 
LRes33867 = reshape_layer(Res13735, [2, 3, 1, 1], Res33867), 
LZer63030 = zero_padding3D_layer(Res33867, 1, 0, 0, 0, 2, 0, Zer63030), 
LDot16702 = dot_layer([[0.3847, 0.0642]], [[0.5323, 0.6981]], 1, 1, Dot16702), 
LRes14309 = reshape_layer(Dot16702, [1, 1], Res14309), 
LRes56615 = reshape_layer(Res14309, [1, 1, 1], Res56615), 
LRes91179 = reshape_layer(Res56615, [1, 1, 1, 1], Res91179), 
LZer29998 = zero_padding3D_layer(Res91179, 1, 1, 1, 1, 1, 1, Zer29998), 
LAve70616 = average_layer([Zer63030,Zer29998], Ave70616), 
LRes10480 = reshape_layer(Ave70616, [3, 3, 3], Res10480), 
LRes6510 = reshape_layer(Res10480, [3, 9], Res6510), 
LMax33839 = max_pool1D_layer(Res6510, 1, Max33839), 
exec_layers([LAve54610,LRes40892,LRes44902,LLoc22259,LELU18922,LRes13735,LRes33867,LZer63030,LDot16702,LRes14309,LRes56615,LRes91179,LZer29998,LAve70616,LRes10480,LRes6510,LMax33839],["Ave54610","Res40892","Res44902","Loc22259","ELU18922","Res13735","Res33867","Zer63030","Dot16702","Res14309","Res56615","Res91179","Zer29998","Ave70616","Res10480","Res6510","Max33839"],Max33839,"Max33839")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.1526966, 0.0000000, 0.1247969, 0.3598525, 0.0000000, 0.0000000, 0.1106486], [0.0000000, 0.0000000, 0.0054528, 0.0000000, 0.0000000, 0.0152887, 0.0000000, 0.0000000, 0.2148772]]]

Expected (Unparsed): [[[0,0,0,0,0,0,0,0,0],[0,0,0.15269660000000002,0,0.12479691500000001,0.35985248,0,0,0.11064862],[0,0,0.00545281,0,0,0.01528874,0,0,0.21487724000000002]]]

Actual:   [[[0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0.1527, 0, 0.1248, 0.3599, 0, 0, 0.1107], [0, 0, 0.0055, 0, 0, 0.0153, 0, 0, 0.2149]]]

Expected: [[[0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0.1527, 0, 0.1248, 0.3599, 0, 0, 0.1107], [0, 0, 0.0055, 0, 0, 0.0153, 0, 0, 0.2149]]]