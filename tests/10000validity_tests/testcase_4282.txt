import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Up_41458 = tf.keras.layers.Input(shape=([3, 4, 2, 1]))
in0Con31463 = tf.keras.layers.Input(shape=([3, 3]))
in0Sep57312 = tf.keras.layers.Input(shape=([2, 1]))
in0Con74395 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Sub83864 = tf.keras.layers.Input(shape=([2, 2, 2]))
in1Sub83864 = tf.keras.layers.Input(shape=([2, 2, 2]))

Up_41458 = keras.layers.UpSampling3D(size=(1, 2, 2), name = 'Up_41458', )(in0Up_41458)
Res29486 = keras.layers.Reshape((3, 8, 4), name = 'Res29486', )(Up_41458)
Res95240 = keras.layers.Reshape((3, 32), name = 'Res95240', )(Res29486)
Sim97466 = keras.layers.SimpleRNN(3,name = 'Sim97466', )(Res95240)
Res82188 = keras.layers.Reshape((3, 1), name = 'Res82188', )(Sim97466)
Con31463 = keras.layers.Concatenate(axis=2, name = 'Con31463', )([Res82188,in0Con31463])
Sep57312 = keras.layers.SeparableConv1D(3, (2),strides=(2), padding='valid', name = 'Sep57312', )(in0Sep57312)
Res60194 = keras.layers.Reshape((1, 3, 1), name = 'Res60194', )(Sep57312)
Res7978 = keras.layers.Reshape((1, 3, 1, 1), name = 'Res7978', )(Res60194)
Glo48013 = keras.layers.GlobalMaxPool3D(name = 'Glo48013', )(Res7978)
Res40102 = keras.layers.Reshape((1, 1), name = 'Res40102', )(Glo48013)
Res34645 = keras.layers.Reshape((1, 1, 1), name = 'Res34645', )(Res40102)
Zer25133 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer25133', )(Res34645)
Con74395 = keras.layers.Concatenate(axis=3, name = 'Con74395', )([Zer25133,in0Con74395])
Sub83864 = keras.layers.Subtract(name = 'Sub83864', )([in0Sub83864,in1Sub83864])
Ave34965 = keras.layers.Average(name = 'Ave34965', )([Con74395,Sub83864])
ReL70638 = keras.layers.ReLU(max_value=3.392588967763056, negative_slope=1.4853977685004685, threshold=7.383114958153497, name = 'ReL70638', )(Ave34965)
Res28899 = keras.layers.Reshape((2, 4), name = 'Res28899', )(ReL70638)
Dot72744 = keras.layers.Dot(axes=(2, 2), name = 'Dot72744', )([Con31463,Res28899])
model = tf.keras.models.Model(inputs=[in0Up_41458,in0Con31463,in0Sep57312,in0Con74395,in0Sub83864,in1Sub83864], outputs=Dot72744)
w = model.get_layer('Sim97466').get_weights() 
w[0] = np.array([[2, 9, 2], [10, 9, 3], [3, 10, 2], [5, 6, 2], [1, 7, 4], [1, 4, 6], [6, 5, 10], [4, 6, 6], [3, 6, 1], [9, 4, 7], [4, 8, 1], [3, 10, 2], [1, 8, 8], [9, 1, 6], [7, 8, 9], [3, 7, 4], [6, 8, 1], [2, 1, 4], [6, 2, 8], [6, 6, 5], [8, 8, 1], [1, 8, 8], [5, 3, 8], [2, 6, 1], [7, 2, 10], [9, 6, 8], [1, 5, 1], [2, 10, 5], [4, 1, 9], [3, 8, 10], [5, 10, 9], [10, 7, 3]])
w[1] = np.array([[9, 7, 10], [3, 3, 3], [4, 3, 10]])
w[2] = np.array([10, 9, 2])
model.get_layer('Sim97466').set_weights(w) 
w = model.get_layer('Sep57312').get_weights() 
w[0] = np.array([[[0.87]], [[0.0482]]])
w[1] = np.array([[[0.1456, 0.188, 0.9173]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep57312').set_weights(w) 
in0Up_41458 = tf.constant([[[[[1.5865], [1.232]], [[1.1863], [1.835]], [[1.3261], [1.029]], [[1.9152], [1.0515]]], [[[1.8095], [1.2437]], [[1.825], [1.6143]], [[1.7408], [1.9978]], [[1.3343], [1.9384]]], [[[1.9556], [1.8726]], [[1.3225], [1.8816]], [[1.3676], [1.1509]], [[1.4532], [1.3925]]]]])
in0Con31463 = tf.constant([[[0.6205, 0.1366, 0.9943], [0.9378, 0.1193, 0.2323], [0.818, 0.5421, 0.8894]]])
in0Sep57312 = tf.constant([[[0.7521], [0.4474]]])
in0Con74395 = tf.constant([[[[0.0516], [0.9787]], [[0.154], [0.0747]]]])
in0Sub83864 = tf.constant([[[[0.3428, 0.3179], [0.6544, 0.2331]], [[0.4907, 0.4151], [0.4507, 0.8799]]]])
in1Sub83864 = tf.constant([[[[0.2102, 0.4429], [0.7336, 0.6324]], [[0.0189, 0.1814], [0.7467, 0.3448]]]])
print (np.array2string(model.predict([in0Up_41458,in0Con31463,in0Sep57312,in0Con74395,in0Sub83864,in1Sub83864],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Dot72744.png')

LUp_41458 = up_sampling3D_layer([[[[[1.5865], [1.232]], [[1.1863], [1.835]], [[1.3261], [1.029]], [[1.9152], [1.0515]]], [[[1.8095], [1.2437]], [[1.825], [1.6143]], [[1.7408], [1.9978]], [[1.3343], [1.9384]]], [[[1.9556], [1.8726]], [[1.3225], [1.8816]], [[1.3676], [1.1509]], [[1.4532], [1.3925]]]]], 1, 2, 2, Up_41458), 
LRes29486 = reshape_layer(Up_41458, [3, 8, 4], Res29486), 
LRes95240 = reshape_layer(Res29486, [3, 32], Res95240), 
LSim97466 = simple_rnn_layer(Res95240,[[2, 9, 2], [10, 9, 3], [3, 10, 2], [5, 6, 2], [1, 7, 4], [1, 4, 6], [6, 5, 10], [4, 6, 6], [3, 6, 1], [9, 4, 7], [4, 8, 1], [3, 10, 2], [1, 8, 8], [9, 1, 6], [7, 8, 9], [3, 7, 4], [6, 8, 1], [2, 1, 4], [6, 2, 8], [6, 6, 5], [8, 8, 1], [1, 8, 8], [5, 3, 8], [2, 6, 1], [7, 2, 10], [9, 6, 8], [1, 5, 1], [2, 10, 5], [4, 1, 9], [3, 8, 10], [5, 10, 9], [10, 7, 3]],[[9, 7, 10], [3, 3, 3], [4, 3, 10]],[10, 9, 2], Sim97466), 
LRes82188 = reshape_layer(Sim97466, [3, 1], Res82188), 
LCon31463 = concatenate_layer([Res82188,[[[0.6205, 0.1366, 0.9943], [0.9378, 0.1193, 0.2323], [0.818, 0.5421, 0.8894]]]], 2, Con31463), 
LSep57312 = separable_conv1D_layer([[[0.7521], [0.4474]]], 2,[[[[0.87]], [[0.0482]]],[[[0.1456, 0.188, 0.9173]]]],[0, 0, 0], 2, false, Sep57312), 
LRes60194 = reshape_layer(Sep57312, [1, 3, 1], Res60194), 
LRes7978 = reshape_layer(Res60194, [1, 3, 1, 1], Res7978), 
LGlo48013 = global_max_pool3D_layer(Res7978, Glo48013), 
LRes40102 = reshape_layer(Glo48013, [1, 1], Res40102), 
LRes34645 = reshape_layer(Res40102, [1, 1, 1], Res34645), 
LZer25133 = zero_padding2D_layer(Res34645, 1, 0, 1, 0, Zer25133), 
LCon74395 = concatenate_layer([Zer25133,[[[[0.0516], [0.9787]], [[0.154], [0.0747]]]]], 3, Con74395), 
LSub83864 = subtract_layer([[[[0.3428, 0.3179], [0.6544, 0.2331]], [[0.4907, 0.4151], [0.4507, 0.8799]]]], [[[[0.2102, 0.4429], [0.7336, 0.6324]], [[0.0189, 0.1814], [0.7467, 0.3448]]]], Sub83864), 
LAve34965 = average_layer([Con74395,Sub83864], Ave34965), 
LReL70638 = relu_layer(Ave34965, 3.392588967763056, 1.4853977685004685, 7.383114958153497, ReL70638), 
LRes28899 = reshape_layer(ReL70638, [2, 4], Res28899), 
LDot72744 = dot_layer(Con31463,Res28899, 2, 2, Dot72744), 
exec_layers([LUp_41458,LRes29486,LRes95240,LSim97466,LRes82188,LCon31463,LSep57312,LRes60194,LRes7978,LGlo48013,LRes40102,LRes34645,LZer25133,LCon74395,LSub83864,LAve34965,LReL70638,LRes28899,LDot72744],["Up_41458","Res29486","Res95240","Sim97466","Res82188","Con31463","Sep57312","Res60194","Res7978","Glo48013","Res40102","Res34645","Zer25133","Con74395","Sub83864","Ave34965","ReL70638","Res28899","Dot72744"],Dot72744,"Dot72744")

Actual (Unparsed): [[[-29.6897381, -29.1619646], [-24.9672305, -24.3531799], [-35.2320916, -34.5176228]]]

Expected (Unparsed): [[[-29.689737702933297,-29.161964165770943],[-24.967230579570074,-24.353179979056975],[-35.232091200636944,-34.517622444336894]]]

Actual:   [[[-29.6897, -29.1619], [-24.9672, -24.3531], [-35.232, -34.5176]]]

Expected: [[[-29.6897, -29.1619], [-24.9672, -24.3531], [-35.232, -34.5176]]]