import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con89545 = tf.keras.layers.Input(shape=([1, 2]))
in0PRe98938 = tf.keras.layers.Input(shape=([2, 1]))
in0Lea1880 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con15502 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Add28999 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Add28999 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))

Con89545 = keras.layers.Conv1D(4, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con89545', )(in0Con89545)
Res48158 = keras.layers.Reshape((1, 4, 1), name = 'Res48158', )(Con89545)
PRe98938 = keras.layers.PReLU(name = 'PRe98938', input_shape=(2, 1))(in0PRe98938)
Res52262 = keras.layers.Reshape((2, 1, 1), name = 'Res52262', )(PRe98938)
Max88597 = keras.layers.MaxPool2D(pool_size=(2, 1), name = 'Max88597', )(Res52262)
Zer50983 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer50983', )(Max88597)
Lea1880 = keras.layers.LeakyReLU(alpha=9.308580979017437, name = 'Lea1880', input_shape=(1, 2, 1))(in0Lea1880)
Sub94614 = keras.layers.Subtract(name = 'Sub94614', )([Zer50983,Lea1880])
Res41838 = keras.layers.Reshape((1, 2, 1, 1), name = 'Res41838', )(Sub94614)
Con15502 = keras.layers.Concatenate(axis=4, name = 'Con15502', )([Res41838,in0Con15502])
Add28999 = keras.layers.Add(name = 'Add28999', )([in0Add28999,in1Add28999])
Max53173 = keras.layers.Maximum(name = 'Max53173', )([Con15502,Add28999])
Res91535 = keras.layers.Reshape((1, 4, 1), name = 'Res91535', )(Max53173)
Ave92730 = keras.layers.Average(name = 'Ave92730', )([Res48158,Res91535])
model = tf.keras.models.Model(inputs=[in0Con89545,in0PRe98938,in0Lea1880,in0Con15502,in0Add28999,in1Add28999], outputs=Ave92730)
w = model.get_layer('Con89545').get_weights() 
w[0] = np.array([[[0.5887, 0.8641, 0.7699, 0.9965], [0.2218, 0.139, 0.3536, 0.2831]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con89545').set_weights(w) 
w = model.get_layer('PRe98938').get_weights() 
w[0] = np.array([[0.2212], [0.0527]])
model.get_layer('PRe98938').set_weights(w) 
in0Con89545 = tf.constant([[[0.1257, 0.7843]]])
in0PRe98938 = tf.constant([[[0.9631], [0.0412]]])
in0Lea1880 = tf.constant([[[[0.0196], [0.745]]]])
in0Con15502 = tf.constant([[[[[0.6444]], [[0.3379]]]]])
in0Add28999 = tf.constant([[[[[0.798, 0.3961]], [[0.3915, 0.0302]]]]])
in1Add28999 = tf.constant([[[[[0.1888, 0.7877]], [[0.7773, 0.328]]]]])
print (np.array2string(model.predict([in0Con89545,in0PRe98938,in0Lea1880,in0Con15502,in0Add28999,in1Add28999],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave92730.png')

LCon89545 = conv1D_layer([[[0.1257, 0.7843]]], 1,[[[0.5887, 0.8641, 0.7699, 0.9965], [0.2218, 0.139, 0.3536, 0.2831]]],[0, 0, 0, 0], 1, true, 1, Con89545), 
LRes48158 = reshape_layer(Con89545, [1, 4, 1], Res48158), 
LPRe98938 = prelu_layer([[[0.9631], [0.0412]]], [[0.2212], [0.0527]], PRe98938), 
LRes52262 = reshape_layer(PRe98938, [2, 1, 1], Res52262), 
LMax88597 = max_pool2D_layer(Res52262, 2, 1, Max88597), 
LZer50983 = zero_padding2D_layer(Max88597, 0, 0, 1, 0, Zer50983), 
LLea1880 = leaky_relu_layer([[[[0.0196], [0.745]]]], 9.308580979017437, Lea1880), 
LSub94614 = subtract_layer(Zer50983,Lea1880, Sub94614), 
LRes41838 = reshape_layer(Sub94614, [1, 2, 1, 1], Res41838), 
LCon15502 = concatenate_layer([Res41838,[[[[[0.6444]], [[0.3379]]]]]], 4, Con15502), 
LAdd28999 = add_layer([[[[[[0.798, 0.3961]], [[0.3915, 0.0302]]]]], [[[[[0.1888, 0.7877]], [[0.7773, 0.328]]]]]], Add28999), 
LMax53173 = maximum_layer([Con15502,Add28999], Max53173), 
LRes91535 = reshape_layer(Max53173, [1, 4, 1], Res91535), 
LAve92730 = average_layer([Res48158,Res91535], Ave92730), 
exec_layers([LCon89545,LRes48158,LPRe98938,LRes52262,LMax88597,LZer50983,LLea1880,LSub94614,LRes41838,LCon15502,LAdd28999,LMax53173,LRes91535,LAve92730],["Con89545","Res48158","PRe98938","Res52262","Max88597","Zer50983","Lea1880","Sub94614","Res41838","Con15502","Add28999","Max53173","Res91535","Ave92730"],Ave92730,"Ave92730")

Actual (Unparsed): [[[[0.6173787], [0.7007175], [0.7714525], [0.3527477]]]]

Expected (Unparsed): [[[[0.617378665],[0.700717535],[0.771452455],[0.35274769000000006]]]]

Actual:   [[[[0.6174], [0.7008], [0.7715], [0.3528]]]]

Expected: [[[[0.6174], [0.7008], [0.7715], [0.3528]]]]