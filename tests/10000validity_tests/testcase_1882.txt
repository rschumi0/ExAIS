import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave15992 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Ave15992 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Con53218 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Loc92701 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Max82635 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Max82635 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Con65964 = tf.keras.layers.Input(shape=([1, 1]))

Ave15992 = keras.layers.Average(name = 'Ave15992', )([in0Ave15992,in1Ave15992])
Res24357 = keras.layers.Reshape((1, 2, 1), name = 'Res24357', )(Ave15992)
Con53218 = keras.layers.Concatenate(axis=3, name = 'Con53218', )([Res24357,in0Con53218])
Loc92701 = keras.layers.LocallyConnected2D(2, (2, 1),strides=(1, 1), name = 'Loc92701', )(in0Loc92701)
Max74916 = keras.layers.Maximum(name = 'Max74916', )([Con53218,Loc92701])
Res77351 = keras.layers.Reshape((1, 4), name = 'Res77351', )(Max74916)
Max82635 = keras.layers.Maximum(name = 'Max82635', )([in0Max82635,in1Max82635])
Res49151 = keras.layers.Reshape((2, 2, 4), name = 'Res49151', )(Max82635)
Res4877 = keras.layers.Reshape((2, 8), name = 'Res4877', )(Res49151)
Loc97673 = keras.layers.LocallyConnected1D(3, (2),strides=(1), name = 'Loc97673', )(Res4877)
Con65964 = keras.layers.Concatenate(axis=2, name = 'Con65964', )([Loc97673,in0Con65964])
Min16501 = keras.layers.Minimum(name = 'Min16501', )([Res77351,Con65964])
model = tf.keras.models.Model(inputs=[in0Ave15992,in1Ave15992,in0Con53218,in0Loc92701,in0Max82635,in1Max82635,in0Con65964], outputs=Min16501)
w = model.get_layer('Loc92701').get_weights() 
w[0] = np.array([[[0.3632, 0.6367], [0.664, 0.108]], [[0.7729, 0.2687], [0.9829, 0.527]]])
w[1] = np.array([[[0, 0], [0, 0]]])
model.get_layer('Loc92701').set_weights(w) 
w = model.get_layer('Loc97673').get_weights() 
w[0] = np.array([[[0.4236, 0.4148, 0.2162], [0.3008, 0.5479, 0.9461], [0.3399, 0.1346, 0.311], [0.7517, 0.4092, 0.8275], [0.545, 0.6627, 0.8366], [0.8428, 0.6814, 0.1301], [0.8818, 0.617, 0.7205], [0.3902, 0.212, 0.6616], [0.8499, 0.5213, 0.5926], [0.4371, 0.8394, 0.4302], [0.9637, 0.671, 0.0083], [0.5452, 0.2801, 0.1038], [0.3881, 0.1391, 0.2692], [0.8756, 0.6821, 0.756], [0.6976, 0.8925, 0.7645], [0.1752, 0.8273, 0.5486]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc97673').set_weights(w) 
in0Ave15992 = tf.constant([[[[[0.1321]], [[0.8041]]]]])
in1Ave15992 = tf.constant([[[[[0.5459]], [[0.1241]]]]])
in0Con53218 = tf.constant([[[[0.8817], [0.8618]]]])
in0Loc92701 = tf.constant([[[[0.207], [0.6442]], [[0.4305], [0.4198]]]])
in0Max82635 = tf.constant([[[[[0.7323, 0.2279], [0.5499, 0.6767]], [[0.8246, 0.3756], [0.7284, 0.4652]]], [[[0.5815, 0.5232], [0.4792, 0.4641]], [[0.7099, 0.3508], [0.9647, 0.3402]]]]])
in1Max82635 = tf.constant([[[[[0.0444, 0.3733], [0.0524, 0.7904]], [[0.3746, 0.1599], [0.434, 0.136]]], [[[0.7264, 0.7406], [0.8881, 0.7664]], [[0.0005, 0.9299], [0.4206, 0.4171]]]]])
in0Con65964 = tf.constant([[[0.1014]]])
print (np.array2string(model.predict([in0Ave15992,in1Ave15992,in0Con53218,in0Loc92701,in0Max82635,in1Max82635,in0Con65964],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min16501.png')

LAve15992 = average_layer([[[[[[0.1321]], [[0.8041]]]]], [[[[[0.5459]], [[0.1241]]]]]], Ave15992), 
LRes24357 = reshape_layer(Ave15992, [1, 2, 1], Res24357), 
LCon53218 = concatenate_layer([Res24357,[[[[0.8817], [0.8618]]]]], 3, Con53218), 
LLoc92701 = locally_connected2D_layer([[[[0.207], [0.6442]], [[0.4305], [0.4198]]]], 2, 1,[[[0.3632, 0.6367], [0.664, 0.108]], [[0.7729, 0.2687], [0.9829, 0.527]]],[[[0, 0], [0, 0]]], 1, 1, Loc92701), 
LMax74916 = maximum_layer([Con53218,Loc92701], Max74916), 
LRes77351 = reshape_layer(Max74916, [1, 4], Res77351), 
LMax82635 = maximum_layer([[[[[[0.7323, 0.2279], [0.5499, 0.6767]], [[0.8246, 0.3756], [0.7284, 0.4652]]], [[[0.5815, 0.5232], [0.4792, 0.4641]], [[0.7099, 0.3508], [0.9647, 0.3402]]]]], [[[[[0.0444, 0.3733], [0.0524, 0.7904]], [[0.3746, 0.1599], [0.434, 0.136]]], [[[0.7264, 0.7406], [0.8881, 0.7664]], [[0.0005, 0.9299], [0.4206, 0.4171]]]]]], Max82635), 
LRes49151 = reshape_layer(Max82635, [2, 2, 4], Res49151), 
LRes4877 = reshape_layer(Res49151, [2, 8], Res4877), 
LLoc97673 = locally_connected1D_layer(Res4877, 2,[[[0.4236, 0.4148, 0.2162], [0.3008, 0.5479, 0.9461], [0.3399, 0.1346, 0.311], [0.7517, 0.4092, 0.8275], [0.545, 0.6627, 0.8366], [0.8428, 0.6814, 0.1301], [0.8818, 0.617, 0.7205], [0.3902, 0.212, 0.6616], [0.8499, 0.5213, 0.5926], [0.4371, 0.8394, 0.4302], [0.9637, 0.671, 0.0083], [0.5452, 0.2801, 0.1038], [0.3881, 0.1391, 0.2692], [0.8756, 0.6821, 0.756], [0.6976, 0.8925, 0.7645], [0.1752, 0.8273, 0.5486]]],[[0, 0, 0]], 1, Loc97673), 
LCon65964 = concatenate_layer([Loc97673,[[[0.1014]]]], 2, Con65964), 
LMin16501 = minimum_layer([Res77351,Con65964], Min16501), 
exec_layers([LAve15992,LRes24357,LCon53218,LLoc92701,LMax74916,LRes77351,LMax82635,LRes49151,LRes4877,LLoc97673,LCon65964,LMin16501],["Ave15992","Res24357","Con53218","Loc92701","Max74916","Res77351","Max82635","Res49151","Res4877","Loc97673","Con65964","Min16501"],Min16501,"Min16501")

Actual (Unparsed): [[[0.3610344, 0.8817000, 0.9105236, 0.1014000]]]

Expected (Unparsed): [[[0.3610344,0.8817,0.9105236000000001,0.1014]]]

Actual:   [[[0.3611, 0.8817, 0.9106, 0.1014]]]

Expected: [[[0.3611, 0.8817, 0.9106, 0.1014]]]