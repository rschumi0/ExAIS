import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max25217 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Max25217 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Max78850 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Max78850 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0GRU27128 = tf.keras.layers.Input(shape=([3, 3]))
in0Con89033 = tf.keras.layers.Input(shape=([1]))

Max25217 = keras.layers.Maximum(name = 'Max25217', )([in0Max25217,in1Max25217])
Res29148 = keras.layers.Reshape((1, 2, 2), name = 'Res29148', )(Max25217)
Glo69230 = keras.layers.GlobalAveragePooling2D(name = 'Glo69230', )(Res29148)
Res82034 = keras.layers.Reshape((2, 1), name = 'Res82034', )(Glo69230)
Res78399 = keras.layers.Reshape((2, 1, 1), name = 'Res78399', )(Res82034)
Max78850 = keras.layers.Maximum(name = 'Max78850', )([in0Max78850,in1Max78850])
Res31394 = keras.layers.Reshape((1, 2, 2), name = 'Res31394', )(Max78850)
Res47144 = keras.layers.Reshape((1, 4), name = 'Res47144', )(Res31394)
Fla32425 = keras.layers.Flatten(name = 'Fla32425', )(Res47144)
GRU27128 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU27128', )(in0GRU27128)
Con89033 = keras.layers.Concatenate(axis=1, name = 'Con89033', )([GRU27128,in0Con89033])
Mul12866 = keras.layers.Multiply(name = 'Mul12866', )([Fla32425,Con89033])
Res11421 = keras.layers.Reshape((4, 1), name = 'Res11421', )(Mul12866)
Res33468 = keras.layers.Reshape((4, 1, 1), name = 'Res33468', )(Res11421)
Dep58023 = keras.layers.DepthwiseConv2D((1, 1),strides=(2, 2), padding='valid', name = 'Dep58023', )(Res33468)
Ave95414 = keras.layers.AveragePooling2D(pool_size=(1, 1), strides=(3, 1), padding='same', name = 'Ave95414', )(Dep58023)
Zer22530 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer22530', )(Ave95414)
Min21142 = keras.layers.Minimum(name = 'Min21142', )([Res78399,Zer22530])
model = tf.keras.models.Model(inputs=[in0Max25217,in1Max25217,in0Max78850,in1Max78850,in0GRU27128,in0Con89033], outputs=Min21142)
w = model.get_layer('GRU27128').get_weights() 
w[0] = np.array([[9, 4, 5, 1, 9, 8, 4, 9, 8], [6, 1, 9, 10, 2, 6, 9, 4, 2], [4, 7, 8, 4, 6, 7, 4, 9, 10]])
w[1] = np.array([[1, 6, 7, 10, 7, 6, 6, 3, 3], [2, 6, 4, 8, 8, 3, 3, 5, 5], [8, 3, 10, 4, 6, 3, 1, 6, 9]])
w[2] = np.array([[5, 3, 6, 8, 8, 7, 8, 8, 2], [7, 1, 6, 5, 4, 3, 8, 9, 6]])
model.get_layer('GRU27128').set_weights(w) 
w = model.get_layer('Dep58023').get_weights() 
w[0] = np.array([[[[0.212]]]])
w[1] = np.array([0])
model.get_layer('Dep58023').set_weights(w) 
in0Max25217 = tf.constant([[[[[0.9321, 0.6744]], [[0.2891, 0.9237]]]]])
in1Max25217 = tf.constant([[[[[0.5911, 0.1383]], [[0.2345, 0.3254]]]]])
in0Max78850 = tf.constant([[[[[0.2254, 0.0148]], [[0.999, 0.8724]]]]])
in1Max78850 = tf.constant([[[[[0.2914, 0.085]], [[0.6188, 0.1638]]]]])
in0GRU27128 = tf.constant([[[2, 4, 9], [7, 5, 8], [8, 1, 3]]])
in0Con89033 = tf.constant([[0.7894]])
print (np.array2string(model.predict([in0Max25217,in1Max25217,in0Max78850,in1Max78850,in0GRU27128,in0Con89033],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Min21142.png')

LMax25217 = maximum_layer([[[[[[0.9321, 0.6744]], [[0.2891, 0.9237]]]]], [[[[[0.5911, 0.1383]], [[0.2345, 0.3254]]]]]], Max25217), 
LRes29148 = reshape_layer(Max25217, [1, 2, 2], Res29148), 
LGlo69230 = global_average_pooling2D_layer(Res29148, Glo69230), 
LRes82034 = reshape_layer(Glo69230, [2, 1], Res82034), 
LRes78399 = reshape_layer(Res82034, [2, 1, 1], Res78399), 
LMax78850 = maximum_layer([[[[[[0.2254, 0.0148]], [[0.999, 0.8724]]]]], [[[[[0.2914, 0.085]], [[0.6188, 0.1638]]]]]], Max78850), 
LRes31394 = reshape_layer(Max78850, [1, 2, 2], Res31394), 
LRes47144 = reshape_layer(Res31394, [1, 4], Res47144), 
LFla32425 = flatten_layer(Res47144, Fla32425), 
LGRU27128 = gru_layer([[[2, 4, 9], [7, 5, 8], [8, 1, 3]]],[[9, 4, 5, 1, 9, 8, 4, 9, 8], [6, 1, 9, 10, 2, 6, 9, 4, 2], [4, 7, 8, 4, 6, 7, 4, 9, 10]],[[1, 6, 7, 10, 7, 6, 6, 3, 3], [2, 6, 4, 8, 8, 3, 3, 5, 5], [8, 3, 10, 4, 6, 3, 1, 6, 9]],[[5, 3, 6, 8, 8, 7, 8, 8, 2], [7, 1, 6, 5, 4, 3, 8, 9, 6]], true, GRU27128), 
LCon89033 = concatenate_layer([GRU27128,[[0.7894]]], 1, Con89033), 
LMul12866 = multiply_layer([Fla32425,Con89033], Mul12866), 
LRes11421 = reshape_layer(Mul12866, [4, 1], Res11421), 
LRes33468 = reshape_layer(Res11421, [4, 1, 1], Res33468), 
LDep58023 = depthwise_conv2D_layer(Res33468, 1, 1,[[[[0.212]]]],[0], 2, 2, false, Dep58023), 
LAve95414 = average_pooling2D_layer(Dep58023, 1, 1, 3, 1, true, Ave95414), 
LZer22530 = zero_padding2D_layer(Ave95414, 1, 0, 0, 0, Zer22530), 
LMin21142 = minimum_layer([Res78399,Zer22530], Min21142), 
exec_layers([LMax25217,LRes29148,LGlo69230,LRes82034,LRes78399,LMax78850,LRes31394,LRes47144,LFla32425,LGRU27128,LCon89033,LMul12866,LRes11421,LRes33468,LDep58023,LAve95414,LZer22530,LMin21142],["Max25217","Res29148","Glo69230","Res82034","Res78399","Max78850","Res31394","Res47144","Fla32425","GRU27128","Con89033","Mul12866","Res11421","Res33468","Dep58023","Ave95414","Zer22530","Min21142"],Min21142,"Min21142")

Actual (Unparsed): [[[[0.0000000]], [[0.0000000]]]]

Expected (Unparsed): [[[[0]],[[0.0]]]]

Actual:   [[[[0]], [[0]]]]

Expected: [[[[0]], [[0]]]]