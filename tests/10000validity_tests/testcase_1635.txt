import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub98610 = tf.keras.layers.Input(shape=([3, 3, 2, 2]))
in1Sub98610 = tf.keras.layers.Input(shape=([3, 3, 2, 2]))
in0Zer94163 = tf.keras.layers.Input(shape=([1, 3]))
in0Con33091 = tf.keras.layers.Input(shape=([3, 9]))

Sub98610 = keras.layers.Subtract(name = 'Sub98610', )([in0Sub98610,in1Sub98610])
Res54956 = keras.layers.Reshape((3, 3, 4), name = 'Res54956', )(Sub98610)
Res42932 = keras.layers.Reshape((3, 12), name = 'Res42932', )(Res54956)
Zer94163 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer94163', )(in0Zer94163)
Con33091 = keras.layers.Concatenate(axis=2, name = 'Con33091', )([Zer94163,in0Con33091])
Ave97742 = keras.layers.Average(name = 'Ave97742', )([Res42932,Con33091])
Res96588 = keras.layers.Reshape((3, 12, 1), name = 'Res96588', )(Ave97742)
Con89548 = keras.layers.Conv2DTranspose(3, (3, 4),strides=(1, 1), padding='same', name = 'Con89548', )(Res96588)
Den9821 = keras.layers.Dense(4,name = 'Den9821', )(Con89548)
model = tf.keras.models.Model(inputs=[in0Sub98610,in1Sub98610,in0Zer94163,in0Con33091], outputs=Den9821)
w = model.get_layer('Con89548').get_weights() 
w[0] = np.array([[[[0.0866], [0.8673], [0.0866]], [[0.8037], [0.0502], [0.5577]], [[0.4971], [0.5463], [0.278]], [[0.6384], [0.5406], [0.3202]]], [[[0.9988], [0.813], [0.1885]], [[0.6683], [0.5134], [0.4577]], [[0.629], [0.9417], [0.8797]], [[0.5535], [0.2057], [0.6953]]], [[[0.8562], [0.3915], [0.9174]], [[0.4514], [0.6772], [0.8017]], [[0.1299], [0.8769], [0.9882]], [[0.4129], [0.7338], [0.138]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con89548').set_weights(w) 
w = model.get_layer('Den9821').get_weights() 
w[0] = np.array([[0.9226, 0.2809, 0.4417, 0.3578], [0.6288, 0.4489, 0.3469, 0.926], [0.748, 0.3965, 0.9257, 0.1579]])
w[1] = np.array([0.5921, 0.9477, 0.2082, 0.452])
model.get_layer('Den9821').set_weights(w) 
in0Sub98610 = tf.constant([[[[[0.2077, 0.1783], [0.2623, 0.4867]], [[0.3726, 0.8565], [0.7664, 0.2548]], [[0.94, 0.9157], [0.1304, 0.8273]]], [[[0.435, 0.6907], [0.7807, 0.3431]], [[0.5991, 0.7203], [0.7989, 0.8724]], [[0.1771, 0.076], [0.0195, 0.533]]], [[[0.3377, 0.7757], [0.9945, 0.5812]], [[0.1906, 0.7113], [0.2251, 0.057]], [[0.691, 0.0805], [0.9123, 0.7607]]]]])
in1Sub98610 = tf.constant([[[[[0.3317, 0.394], [0.0979, 0.5664]], [[0.4168, 0.7529], [0.4789, 0.3337]], [[0.3815, 0.2371], [0.3647, 0.9729]]], [[[0.5784, 0.9271], [0.2176, 0.5366]], [[0.1848, 0.2938], [0.9657, 0.5659]], [[0.4039, 0.4342], [0.8138, 0.301]]], [[[0.9272, 0.9043], [0.5853, 0.7833]], [[0.7092, 0.7076], [0.7291, 0.3208]], [[0.4615, 0.3331], [0.9978, 0.2652]]]]])
in0Zer94163 = tf.constant([[[1.918, 1.6056, 1.4599]]])
in0Con33091 = tf.constant([[[0.5226, 0.0029, 0.9555, 0.1135, 0.1456, 0.8277, 0.0127, 0.6244, 0.7653], [0.459, 0.3721, 0.283, 0.9803, 0.8379, 0.5007, 0.4674, 0.3432, 0.5939], [0.1048, 0.7185, 0.3102, 0.2332, 0.0312, 0.0206, 0.0499, 0.1816, 0.9243]]])
print (np.array2string(model.predict([in0Sub98610,in1Sub98610,in0Zer94163,in0Con33091],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Den9821.png')

LSub98610 = subtract_layer([[[[[0.2077, 0.1783], [0.2623, 0.4867]], [[0.3726, 0.8565], [0.7664, 0.2548]], [[0.94, 0.9157], [0.1304, 0.8273]]], [[[0.435, 0.6907], [0.7807, 0.3431]], [[0.5991, 0.7203], [0.7989, 0.8724]], [[0.1771, 0.076], [0.0195, 0.533]]], [[[0.3377, 0.7757], [0.9945, 0.5812]], [[0.1906, 0.7113], [0.2251, 0.057]], [[0.691, 0.0805], [0.9123, 0.7607]]]]], [[[[[0.3317, 0.394], [0.0979, 0.5664]], [[0.4168, 0.7529], [0.4789, 0.3337]], [[0.3815, 0.2371], [0.3647, 0.9729]]], [[[0.5784, 0.9271], [0.2176, 0.5366]], [[0.1848, 0.2938], [0.9657, 0.5659]], [[0.4039, 0.4342], [0.8138, 0.301]]], [[[0.9272, 0.9043], [0.5853, 0.7833]], [[0.7092, 0.7076], [0.7291, 0.3208]], [[0.4615, 0.3331], [0.9978, 0.2652]]]]], Sub98610), 
LRes54956 = reshape_layer(Sub98610, [3, 3, 4], Res54956), 
LRes42932 = reshape_layer(Res54956, [3, 12], Res42932), 
LZer94163 = zero_padding1D_layer([[[1.918, 1.6056, 1.4599]]], 1, 1, Zer94163), 
LCon33091 = concatenate_layer([Zer94163,[[[0.5226, 0.0029, 0.9555, 0.1135, 0.1456, 0.8277, 0.0127, 0.6244, 0.7653], [0.459, 0.3721, 0.283, 0.9803, 0.8379, 0.5007, 0.4674, 0.3432, 0.5939], [0.1048, 0.7185, 0.3102, 0.2332, 0.0312, 0.0206, 0.0499, 0.1816, 0.9243]]]], 2, Con33091), 
LAve97742 = average_layer([Res42932,Con33091], Ave97742), 
LRes96588 = reshape_layer(Ave97742, [3, 12, 1], Res96588), 
LCon89548 = conv2D_transpose_layer(Res96588, 3, 4,[[[[0.0866], [0.8673], [0.0866]], [[0.8037], [0.0502], [0.5577]], [[0.4971], [0.5463], [0.278]], [[0.6384], [0.5406], [0.3202]]], [[[0.9988], [0.813], [0.1885]], [[0.6683], [0.5134], [0.4577]], [[0.629], [0.9417], [0.8797]], [[0.5535], [0.2057], [0.6953]]], [[[0.8562], [0.3915], [0.9174]], [[0.4514], [0.6772], [0.8017]], [[0.1299], [0.8769], [0.9882]], [[0.4129], [0.7338], [0.138]]]],[0, 0, 0], 1, 1, true, Con89548), 
LDen9821 = dense_layer(Con89548, [[0.9226, 0.2809, 0.4417, 0.3578], [0.6288, 0.4489, 0.3469, 0.926], [0.748, 0.3965, 0.9257, 0.1579]],[0.5921, 0.9477, 0.2082, 0.452], Den9821), 
exec_layers([LSub98610,LRes54956,LRes42932,LZer94163,LCon33091,LAve97742,LRes96588,LCon89548,LDen9821],["Sub98610","Res54956","Res42932","Zer94163","Con33091","Ave97742","Res96588","Con89548","Den9821"],Den9821,"Den9821")

Actual (Unparsed): [[[[1.8713841, 1.5560555, 1.1313305, 1.2352004], [2.8787688, 2.0972528, 1.7210915, 2.1763528], [3.8003712, 2.3820998, 2.3586069, 2.3342873], [3.1197229, 2.2021827, 1.8827223, 2.3096293], [3.9284396, 2.5342453, 2.4194902, 2.7059493], [3.0606593, 2.1223112, 1.8958749, 2.0662118], [3.5436564, 2.4220384, 2.2884746, 2.5134403], [4.3078093, 2.6603295, 2.7615743, 2.7102003], [3.5719850, 2.3442053, 2.2173428, 2.3700311], [3.3657340, 2.2766341, 2.1922162, 2.1971334], [2.9981406, 2.1597621, 1.9307268, 2.1326528], [2.0747440, 1.6115581, 1.3530021, 1.1618639]], [[2.1364238, 1.6751668, 1.1097917, 1.6071183], [4.3511149, 2.7760847, 2.7274895, 3.0775343], [4.4697999, 2.7587582, 3.1760912, 2.5494008], [4.4670611, 2.8792747, 3.1344275, 2.9366531], [4.7603073, 2.9205818, 3.3437986, 2.8397100], [3.9873270, 2.5781484, 2.6838558, 2.5480548], [4.2272565, 2.7639389, 2.9249392, 2.8254311], [4.7169616, 2.9766379, 3.2799615, 3.0661227], [4.0074137, 2.6222343, 2.9119824, 2.4282376], [2.9680142, 2.2167005, 2.2983674, 1.8970530], [3.7602676, 2.6108377, 2.4384565, 2.8966508], [2.5956621, 1.8765981, 1.7048912, 1.5558689]], [[2.5716609, 1.9229156, 1.8632154, 1.5159192], [4.2728824, 2.8078440, 3.2327924, 2.6201607], [3.8099108, 2.6873500, 2.7197771, 2.8127868], [3.9295685, 2.7307152, 2.8526903, 2.7973871], [3.4371625, 2.3677092, 2.2528195, 2.3933731], [2.5988983, 1.9860353, 1.8712261, 1.6876966], [3.0829449, 2.2229496, 2.2343091, 1.9882913], [2.5441426, 1.9687509, 1.7539444, 1.7628676], [1.7060970, 1.5873857, 1.1300179, 1.3192542], [1.0562705, 1.2428966, 0.4809269, 1.0148215], [2.3229172, 1.7237950, 1.3093786, 1.5373981], [1.8013658, 1.5169865, 1.0446588, 1.2148893]]]]

Expected (Unparsed): [[[[1.871384166426,1.5560554614045,1.1313305244704999,1.2352004187874999],[2.8787687474389996,2.09725283034,1.7210914788539997,2.1763527830614997],[3.8003711666859994,2.382099770613,2.3586068578289994,2.334287289752],[3.1197228846409994,2.202182714383,1.8827222823009997,2.3096292884859997],[3.928439552194,2.5342452995079996,2.419490198908,2.7059492174095006],[3.0606592370429997,2.12231117298,1.8958748496659998,2.066211739829],[3.5436563221609996,2.422038345701,2.2884746154349997,2.513440335054],[4.307809245776999,2.660329512188,2.761574308718,2.710200276564],[3.5719849569090005,2.3442053297865,2.2173428076105,2.3700311330345003],[3.3657339657030003,2.2766340510515,2.1922161612035005,2.1971333923965],[2.9981405006779998,2.159762100321,1.930726717881,2.132652727259],[2.07474396677,1.6115580388505,1.3530020810165,1.161863833233]],[[2.1364237920209996,1.6751667658374998,1.1097916906014997,1.6071183502945],[4.351114864083,2.7760846921045,2.7274895155165,3.0775343062525],[4.4697999435349995,2.7587582440354996,3.1760912166274995,2.5494007824374996],[4.467061032924999,2.8792746678829997,3.134427446333,2.9366531282385],[4.760307223617,2.9205818210339998,3.3437985711479996,2.8397099729689996],[3.987326906481999,2.578148325026,2.683855730474,2.5480547785485004],[4.227256528158001,2.763938884822,2.924939160274,2.8254310557550006],[4.716961578822,2.9766378836745,3.2799614934644996,3.0661227036170002],[4.007413646960001,2.6222342815735002,2.9119823861515,2.4282376017805003],[2.9680141427609996,2.2167004569665,2.2983674204824993,1.8970529771040001],[3.760267504793,2.610837612166,2.438456465044,2.8966507334875002],[2.595661986478,1.8765980910339999,1.704891137434,1.5558688253125]],[[2.5716609749429997,1.922915577439,1.863215463589,1.5159192262825],[4.2728824697259995,2.807844024383,3.2327924042269993,2.6201607302505],[3.8099108095349994,2.6873499618995,2.7197770802314998,2.8127868395879996],[3.929568547511,2.730715242805,2.8526903413869995,2.7973871019054997],[3.4371624844479998,2.3677091761440003,2.25281950818,2.3933730899195003],[2.598898196923,1.986035227126,1.871226017572,1.6876965497560001],[3.08294492085,2.2229495727560002,2.234309139644,1.9882912620255002],[2.544142540581,1.9687508470550001,1.7539444333489997,1.762867600542],[1.7060970192240001,1.5873856558335,1.1300179353555002,1.3192542146045],[1.056270512606,1.2428965691679998,0.480926876656,1.0148215348435001],[2.322917128355,1.723794979295,1.309378561769,1.537398091923],[1.8013657774719998,1.5169864803179998,1.044658796682,1.2148892675495]]]]

Actual:   [[[[1.8714, 1.5561, 1.1314, 1.2353], [2.8788, 2.0973, 1.7211, 2.1764], [3.8004, 2.3821, 2.3587, 2.3343], [3.1198, 2.2022, 1.8828, 2.3097], [3.9285, 2.5343, 2.4195, 2.706], [3.0607, 2.1224, 1.8959, 2.0663], [3.5437, 2.4221, 2.2885, 2.5135], [4.3079, 2.6604, 2.7616, 2.7103], [3.572, 2.3443, 2.2174, 2.3701], [3.3658, 2.2767, 2.1923, 2.1972], [2.9982, 2.1598, 1.9308, 2.1327], [2.0748, 1.6116, 1.3531, 1.1619]], [[2.1365, 1.6752, 1.1098, 1.6072], [4.3512, 2.7761, 2.7275, 3.0776], [4.4698, 2.7588, 3.1761, 2.5495], [4.4671, 2.8793, 3.1345, 2.9367], [4.7604, 2.9206, 3.3438, 2.8398], [3.9874, 2.5782, 2.6839, 2.5481], [4.2273, 2.764, 2.925, 2.8255], [4.717, 2.9767, 3.28, 3.0662], [4.0075, 2.6223, 2.912, 2.4283], [2.9681, 2.2168, 2.2984, 1.8971], [3.7603, 2.6109, 2.4385, 2.8967], [2.5957, 1.8766, 1.7049, 1.5559]], [[2.5717, 1.923, 1.8633, 1.516], [4.2729, 2.8079, 3.2328, 2.6202], [3.81, 2.6874, 2.7198, 2.8128], [3.9296, 2.7308, 2.8527, 2.7974], [3.4372, 2.3678, 2.2529, 2.3934], [2.5989, 1.9861, 1.8713, 1.6877], [3.083, 2.223, 2.2344, 1.9883], [2.5442, 1.9688, 1.754, 1.7629], [1.7061, 1.5874, 1.1301, 1.3193], [1.0563, 1.2429, 0.481, 1.0149], [2.323, 1.7238, 1.3094, 1.5374], [1.8014, 1.517, 1.0447, 1.2149]]]]

Expected: [[[[1.8714, 1.5561, 1.1314, 1.2353], [2.8788, 2.0973, 1.7211, 2.1764], [3.8004, 2.3821, 2.3587, 2.3343], [3.1198, 2.2022, 1.8828, 2.3097], [3.9285, 2.5343, 2.4195, 2.706], [3.0607, 2.1224, 1.8959, 2.0663], [3.5437, 2.4221, 2.2885, 2.5135], [4.3079, 2.6604, 2.7616, 2.7103], [3.572, 2.3443, 2.2174, 2.3701], [3.3658, 2.2767, 2.1923, 2.1972], [2.9982, 2.1598, 1.9308, 2.1327], [2.0748, 1.6116, 1.3531, 1.1619]], [[2.1365, 1.6752, 1.1098, 1.6072], [4.3512, 2.7761, 2.7275, 3.0776], [4.4698, 2.7588, 3.1761, 2.5495], [4.4671, 2.8793, 3.1345, 2.9367], [4.7604, 2.9206, 3.3438, 2.8398], [3.9874, 2.5782, 2.6839, 2.5481], [4.2273, 2.764, 2.925, 2.8255], [4.717, 2.9767, 3.28, 3.0662], [4.0075, 2.6223, 2.912, 2.4283], [2.9681, 2.2168, 2.2984, 1.8971], [3.7603, 2.6109, 2.4385, 2.8967], [2.5957, 1.8766, 1.7049, 1.5559]], [[2.5717, 1.923, 1.8633, 1.516], [4.2729, 2.8079, 3.2328, 2.6202], [3.81, 2.6874, 2.7198, 2.8128], [3.9296, 2.7308, 2.8527, 2.7974], [3.4372, 2.3678, 2.2529, 2.3934], [2.5989, 1.9861, 1.8713, 1.6877], [3.083, 2.223, 2.2344, 1.9883], [2.5442, 1.9688, 1.754, 1.7629], [1.7061, 1.5874, 1.1301, 1.3193], [1.0563, 1.2429, 0.481, 1.0149], [2.323, 1.7238, 1.3094, 1.5374], [1.8014, 1.517, 1.0447, 1.2149]]]]