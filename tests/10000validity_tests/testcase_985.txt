import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub55546 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub55546 = tf.keras.layers.Input(shape=([3, 2]))
in0Ave65757 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Ave65757 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Dot62451 = tf.keras.layers.Input(shape=([3]))
in1Dot62451 = tf.keras.layers.Input(shape=([3]))
in0Con2119 = tf.keras.layers.Input(shape=([1]))
in0Con27361 = tf.keras.layers.Input(shape=([4]))

Sub55546 = keras.layers.Subtract(name = 'Sub55546', )([in0Sub55546,in1Sub55546])
Fla27866 = keras.layers.Flatten(name = 'Fla27866', )(Sub55546)
Ave65757 = keras.layers.Average(name = 'Ave65757', )([in0Ave65757,in1Ave65757])
Res17534 = keras.layers.Reshape((2, 1), name = 'Res17534', )(Ave65757)
Fla12717 = keras.layers.Flatten(name = 'Fla12717', )(Res17534)
Dot62451 = keras.layers.Dot(axes=(1, 1), name = 'Dot62451', )([in0Dot62451,in1Dot62451])
Con2119 = keras.layers.Concatenate(axis=1, name = 'Con2119', )([Dot62451,in0Con2119])
Ave5721 = keras.layers.Average(name = 'Ave5721', )([Fla12717,Con2119])
Con27361 = keras.layers.Concatenate(axis=1, name = 'Con27361', )([Ave5721,in0Con27361])
Ave75118 = keras.layers.Average(name = 'Ave75118', )([Fla27866,Con27361])
model = tf.keras.models.Model(inputs=[in0Sub55546,in1Sub55546,in0Ave65757,in1Ave65757,in0Dot62451,in1Dot62451,in0Con2119,in0Con27361], outputs=Ave75118)
in0Sub55546 = tf.constant([[[0.1078, 0.8288], [0.2811, 0.5148], [0.368, 0.7259]]])
in1Sub55546 = tf.constant([[[0.8491, 0.8453], [0.0758, 0.7539], [0.5787, 0.0861]]])
in0Ave65757 = tf.constant([[[[0.3304]], [[0.4585]]]])
in1Ave65757 = tf.constant([[[[0.9764]], [[0.2399]]]])
in0Dot62451 = tf.constant([[0.57, 0.8026, 0.0554]])
in1Dot62451 = tf.constant([[0.512, 0.633, 0.3736]])
in0Con2119 = tf.constant([[0.5409]])
in0Con27361 = tf.constant([[0.7806, 0.4794, 0.8532, 0.5612]])
print (np.array2string(model.predict([in0Sub55546,in1Sub55546,in0Ave65757,in1Ave65757,in0Dot62451,in1Dot62451,in0Con2119,in0Con27361],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave75118.png')

LSub55546 = subtract_layer([[[0.1078, 0.8288], [0.2811, 0.5148], [0.368, 0.7259]]], [[[0.8491, 0.8453], [0.0758, 0.7539], [0.5787, 0.0861]]], Sub55546), 
LFla27866 = flatten_layer(Sub55546, Fla27866), 
LAve65757 = average_layer([[[[[0.3304]], [[0.4585]]]], [[[[0.9764]], [[0.2399]]]]], Ave65757), 
LRes17534 = reshape_layer(Ave65757, [2, 1], Res17534), 
LFla12717 = flatten_layer(Res17534, Fla12717), 
LDot62451 = dot_layer([[0.57, 0.8026, 0.0554]], [[0.512, 0.633, 0.3736]], 1, 1, Dot62451), 
LCon2119 = concatenate_layer([Dot62451,[[0.5409]]], 1, Con2119), 
LAve5721 = average_layer([Fla12717,Con2119], Ave5721), 
LCon27361 = concatenate_layer([Ave5721,[[0.7806, 0.4794, 0.8532, 0.5612]]], 1, Con27361), 
LAve75118 = average_layer([Fla27866,Con27361], Ave75118), 
exec_layers([LSub55546,LFla27866,LAve65757,LRes17534,LFla12717,LDot62451,LCon2119,LAve5721,LCon27361,LAve75118],["Sub55546","Fla27866","Ave65757","Res17534","Fla12717","Dot62451","Con2119","Ave5721","Con27361","Ave75118"],Ave75118,"Ave75118")

Actual (Unparsed): [[-0.0021542, 0.2142750, 0.4929500, 0.1201500, 0.3212500, 0.6005000]]

Expected (Unparsed): [[-0.0021541900000000003,0.214275,0.49295,0.12015,0.32125,0.6005]]

Actual:   [[-0.0021, 0.2143, 0.493, 0.1202, 0.3213, 0.6005]]

Expected: [[-0.0021, 0.2143, 0.493, 0.1202, 0.3213, 0.6005]]