import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave99862 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Ave99862 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in0Sub65681 = tf.keras.layers.Input(shape=([3]))
in1Sub65681 = tf.keras.layers.Input(shape=([3]))
in0Con38060 = tf.keras.layers.Input(shape=([1]))

Ave99862 = keras.layers.Average(name = 'Ave99862', )([in0Ave99862,in1Ave99862])
Res34387 = keras.layers.Reshape((1, 2, 2), name = 'Res34387', )(Ave99862)
Res64271 = keras.layers.Reshape((1, 4), name = 'Res64271', )(Res34387)
Fla85318 = keras.layers.Flatten(name = 'Fla85318', )(Res64271)
Sub65681 = keras.layers.Subtract(name = 'Sub65681', )([in0Sub65681,in1Sub65681])
Con38060 = keras.layers.Concatenate(axis=1, name = 'Con38060', )([Sub65681,in0Con38060])
Sub61241 = keras.layers.Subtract(name = 'Sub61241', )([Fla85318,Con38060])
Res43849 = keras.layers.Reshape((4, 1), name = 'Res43849', )(Sub61241)
Res4416 = keras.layers.Reshape((4, 1, 1), name = 'Res4416', )(Res43849)
Cro23526 = keras.layers.Cropping2D(cropping=((0, 3), (0, 0)), name = 'Cro23526', )(Res4416)
Res6688 = keras.layers.Reshape((1, 1), name = 'Res6688', )(Cro23526)
Sim45396 = keras.layers.SimpleRNN(1,name = 'Sim45396', )(Res6688)
model = tf.keras.models.Model(inputs=[in0Ave99862,in1Ave99862,in0Sub65681,in1Sub65681,in0Con38060], outputs=Sim45396)
w = model.get_layer('Sim45396').get_weights() 
w[0] = np.array([[5]])
w[1] = np.array([[9]])
w[2] = np.array([5])
model.get_layer('Sim45396').set_weights(w) 
in0Ave99862 = tf.constant([[[[[0.8011, 0.8817]], [[0.6718, 0.7001]]]]])
in1Ave99862 = tf.constant([[[[[0.45, 0.903]], [[0.8567, 0.2849]]]]])
in0Sub65681 = tf.constant([[0.2422, 0.3655, 0.3432]])
in1Sub65681 = tf.constant([[0.3988, 0.2382, 0.9997]])
in0Con38060 = tf.constant([[0.5546]])
print (np.array2string(model.predict([in0Ave99862,in1Ave99862,in0Sub65681,in1Sub65681,in0Con38060],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sim45396.png')

LAve99862 = average_layer([[[[[[0.8011, 0.8817]], [[0.6718, 0.7001]]]]], [[[[[0.45, 0.903]], [[0.8567, 0.2849]]]]]], Ave99862), 
LRes34387 = reshape_layer(Ave99862, [1, 2, 2], Res34387), 
LRes64271 = reshape_layer(Res34387, [1, 4], Res64271), 
LFla85318 = flatten_layer(Res64271, Fla85318), 
LSub65681 = subtract_layer([[0.2422, 0.3655, 0.3432]], [[0.3988, 0.2382, 0.9997]], Sub65681), 
LCon38060 = concatenate_layer([Sub65681,[[0.5546]]], 1, Con38060), 
LSub61241 = subtract_layer(Fla85318,Con38060, Sub61241), 
LRes43849 = reshape_layer(Sub61241, [4, 1], Res43849), 
LRes4416 = reshape_layer(Res43849, [4, 1, 1], Res4416), 
LCro23526 = cropping2D_layer(Res4416, 0, 3, 0, 0, Cro23526), 
LRes6688 = reshape_layer(Cro23526, [1, 1], Res6688), 
LSim45396 = simple_rnn_layer(Res6688,[[5]],[[9]],[5], Sim45396), 
exec_layers([LAve99862,LRes34387,LRes64271,LFla85318,LSub65681,LCon38060,LSub61241,LRes43849,LRes4416,LCro23526,LRes6688,LSim45396],["Ave99862","Res34387","Res64271","Fla85318","Sub65681","Con38060","Sub61241","Res43849","Res4416","Cro23526","Res6688","Sim45396"],Sim45396,"Sim45396")

Actual (Unparsed): [[1.0000000]]

Expected (Unparsed): [[0.999999963587468]]

Actual:   [[1]]

Expected: [[1]]