import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min84979 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in1Min84979 = tf.keras.layers.Input(shape=([1, 2, 2, 2]))
in0Con78069 = tf.keras.layers.Input(shape=([2, 3, 5, 1]))
in0Mul50329 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Mul50329 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Mul27152 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in1Mul27152 = tf.keras.layers.Input(shape=([1, 1, 2, 2]))
in0GRU77126 = tf.keras.layers.Input(shape=([1, 3]))
in0Ave55878 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Ave55878 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con14011 = tf.keras.layers.Input(shape=([3, 29]))

Min84979 = keras.layers.Minimum(name = 'Min84979', )([in0Min84979,in1Min84979])
Res43938 = keras.layers.Reshape((1, 2, 4), name = 'Res43938', )(Min84979)
Dep26524 = keras.layers.DepthwiseConv2D((1, 1),strides=(1, 1), padding='same', name = 'Dep26524', )(Res43938)
Res30948 = keras.layers.Reshape((1, 2, 4, 1), name = 'Res30948', )(Dep26524)
Zer67176 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (1, 0)), name = 'Zer67176', )(Res30948)
Con78069 = keras.layers.Concatenate(axis=4, name = 'Con78069', )([Zer67176,in0Con78069])
Mul50329 = keras.layers.Multiply(name = 'Mul50329', )([in0Mul50329,in1Mul50329])
Zer89862 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer89862', )(Mul50329)
Mul27152 = keras.layers.Multiply(name = 'Mul27152', )([in0Mul27152,in1Mul27152])
Zer45021 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (1, 0)), name = 'Zer45021', )(Mul27152)
Mul27973 = keras.layers.Multiply(name = 'Mul27973', )([Zer89862,Zer45021])
Zer61754 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (2, 0)), name = 'Zer61754', )(Mul27973)
Min24005 = keras.layers.Minimum(name = 'Min24005', )([Con78069,Zer61754])
Res9423 = keras.layers.Reshape((2, 3, 10), name = 'Res9423', )(Min24005)
Res72986 = keras.layers.Reshape((2, 30), name = 'Res72986', )(Res9423)
Zer81563 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer81563', )(Res72986)
GRU77126 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU77126', )(in0GRU77126)
Res66209 = keras.layers.Reshape((3, 1), name = 'Res66209', )(GRU77126)
Ave55878 = keras.layers.Average(name = 'Ave55878', )([in0Ave55878,in1Ave55878])
ELU15631 = keras.layers.ELU(alpha=1.1471152483808709, name = 'ELU15631', )(Ave55878)
Res37613 = keras.layers.Reshape((1, 1), name = 'Res37613', )(ELU15631)
Dot71232 = keras.layers.Dot(axes=(2, 2), name = 'Dot71232', )([Res66209,Res37613])
Con14011 = keras.layers.Concatenate(axis=2, name = 'Con14011', )([Dot71232,in0Con14011])
Ave95338 = keras.layers.Average(name = 'Ave95338', )([Zer81563,Con14011])
model = tf.keras.models.Model(inputs=[in0Min84979,in1Min84979,in0Con78069,in0Mul50329,in1Mul50329,in0Mul27152,in1Mul27152,in0GRU77126,in0Ave55878,in1Ave55878,in0Con14011], outputs=Ave95338)
w = model.get_layer('Dep26524').get_weights() 
w[0] = np.array([[[[0.1476], [0.8395], [0.2993], [0.3749]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Dep26524').set_weights(w) 
w = model.get_layer('GRU77126').get_weights() 
w[0] = np.array([[1, 1, 4, 8, 7, 3, 7, 4, 7], [7, 8, 8, 5, 3, 2, 10, 4, 2], [7, 1, 4, 8, 5, 5, 8, 5, 2]])
w[1] = np.array([[8, 4, 2, 9, 1, 1, 2, 6, 4], [6, 9, 4, 6, 2, 2, 2, 4, 6], [9, 7, 10, 7, 2, 2, 9, 5, 6]])
w[2] = np.array([[9, 7, 1, 10, 1, 1, 9, 7, 9], [9, 2, 2, 8, 10, 1, 8, 2, 10]])
model.get_layer('GRU77126').set_weights(w) 
in0Min84979 = tf.constant([[[[[0.5134, 0.3812], [0.2457, 0.365]], [[0.9302, 0.4081], [0.8634, 0.3571]]]]])
in1Min84979 = tf.constant([[[[[0.4952, 0.8021], [0.9831, 0.0861]], [[0.2631, 0.6539], [0.2654, 0.7406]]]]])
in0Con78069 = tf.constant([[[[[0.1804], [0.1759], [0.2347], [0.0049], [0.2392]], [[0.0701], [0.5375], [0.3154], [0.1371], [0.0144]], [[0.8374], [0.3007], [0.2611], [0.3983], [0.2509]]], [[[0.5636], [0.4699], [0.7846], [0.329], [0.4241]], [[0.0035], [0.4332], [0.7692], [0.3155], [0.9233]], [[0.4042], [0.4], [0.0775], [0.8695], [0.521]]]]])
in0Mul50329 = tf.constant([[[[[0.8069, 0.0496]]], [[[0.0617, 0.3352]]]]])
in1Mul50329 = tf.constant([[[[[0.5479, 0.334]]], [[[0.9346, 0.0614]]]]])
in0Mul27152 = tf.constant([[[[[0.1472, 0.3046], [0.6785, 0.004]]]]])
in1Mul27152 = tf.constant([[[[[0.4486, 0.841], [0.2452, 0.5995]]]]])
in0GRU77126 = tf.constant([[[10, 10, 4]]])
in0Ave55878 = tf.constant([[[[0.1518]]]])
in1Ave55878 = tf.constant([[[[0.6853]]]])
in0Con14011 = tf.constant([[[0.6703, 0.6607, 0.0817, 0.3756, 0.8486, 0.2689, 0.6212, 0.6024, 0.6129, 0.7944, 0.0311, 0.7915, 0.1381, 0.2146, 0.704, 0.6265, 0.1592, 0.5367, 0.9801, 0.0132, 0.3542, 0.3752, 0.8843, 0.1902, 0.5268, 0.2236, 0.4329, 0.5411, 0.2973], [0.3205, 0.9511, 0.208, 0.5775, 0.0819, 0.2382, 0.6419, 0.5797, 0.3062, 0.2189, 0.9041, 0.4874, 0.7421, 0.9278, 0.8769, 0.2054, 0.1582, 0.2864, 0.5382, 0.7954, 0.7482, 0.1568, 0.1072, 0.3038, 0.568, 0.577, 0.1795, 0.6939, 0.707], [0.9214, 0.9337, 0.5043, 0.0707, 0.9651, 0.1146, 0.6732, 0.9735, 0.4797, 0.7786, 0.6923, 0.2228, 0.0363, 0.7167, 0.8845, 0.0144, 0.1527, 0.0653, 0.1327, 0.7511, 0.7845, 0.862, 0.8345, 0.8474, 0.4296, 0.2031, 0.2006, 0.6918, 0.7949]]])
print (np.array2string(model.predict([in0Min84979,in1Min84979,in0Con78069,in0Mul50329,in1Mul50329,in0Mul27152,in1Mul27152,in0GRU77126,in0Ave55878,in1Ave55878,in0Con14011],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave95338.png')

LMin84979 = minimum_layer([[[[[[0.5134, 0.3812], [0.2457, 0.365]], [[0.9302, 0.4081], [0.8634, 0.3571]]]]], [[[[[0.4952, 0.8021], [0.9831, 0.0861]], [[0.2631, 0.6539], [0.2654, 0.7406]]]]]], Min84979), 
LRes43938 = reshape_layer(Min84979, [1, 2, 4], Res43938), 
LDep26524 = depthwise_conv2D_layer(Res43938, 1, 1,[[[[0.1476], [0.8395], [0.2993], [0.3749]]]],[0, 0, 0, 0], 1, 1, true, Dep26524), 
LRes30948 = reshape_layer(Dep26524, [1, 2, 4, 1], Res30948), 
LZer67176 = zero_padding3D_layer(Res30948, 1, 0, 1, 0, 1, 0, Zer67176), 
LCon78069 = concatenate_layer([Zer67176,[[[[[0.1804], [0.1759], [0.2347], [0.0049], [0.2392]], [[0.0701], [0.5375], [0.3154], [0.1371], [0.0144]], [[0.8374], [0.3007], [0.2611], [0.3983], [0.2509]]], [[[0.5636], [0.4699], [0.7846], [0.329], [0.4241]], [[0.0035], [0.4332], [0.7692], [0.3155], [0.9233]], [[0.4042], [0.4], [0.0775], [0.8695], [0.521]]]]]], 4, Con78069), 
LMul50329 = multiply_layer([[[[[[0.8069, 0.0496]]], [[[0.0617, 0.3352]]]]], [[[[[0.5479, 0.334]]], [[[0.9346, 0.0614]]]]]], Mul50329), 
LZer89862 = zero_padding3D_layer(Mul50329, 0, 0, 0, 0, 2, 0, Zer89862), 
LMul27152 = multiply_layer([[[[[[0.1472, 0.3046], [0.6785, 0.004]]]]], [[[[[0.4486, 0.841], [0.2452, 0.5995]]]]]], Mul27152), 
LZer45021 = zero_padding3D_layer(Mul27152, 1, 0, 0, 0, 1, 0, Zer45021), 
LMul27973 = multiply_layer([Zer89862,Zer45021], Mul27973), 
LZer61754 = zero_padding3D_layer(Mul27973, 0, 0, 2, 0, 2, 0, Zer61754), 
LMin24005 = minimum_layer([Con78069,Zer61754], Min24005), 
LRes9423 = reshape_layer(Min24005, [2, 3, 10], Res9423), 
LRes72986 = reshape_layer(Res9423, [2, 30], Res72986), 
LZer81563 = zero_padding1D_layer(Res72986, 1, 0, Zer81563), 
LGRU77126 = gru_layer([[[10, 10, 4]]],[[1, 1, 4, 8, 7, 3, 7, 4, 7], [7, 8, 8, 5, 3, 2, 10, 4, 2], [7, 1, 4, 8, 5, 5, 8, 5, 2]],[[8, 4, 2, 9, 1, 1, 2, 6, 4], [6, 9, 4, 6, 2, 2, 2, 4, 6], [9, 7, 10, 7, 2, 2, 9, 5, 6]],[[9, 7, 1, 10, 1, 1, 9, 7, 9], [9, 2, 2, 8, 10, 1, 8, 2, 10]], true, GRU77126), 
LRes66209 = reshape_layer(GRU77126, [3, 1], Res66209), 
LAve55878 = average_layer([[[[[0.1518]]]], [[[[0.6853]]]]], Ave55878), 
LELU15631 = elu_layer(Ave55878, 1.1471152483808709, ELU15631), 
LRes37613 = reshape_layer(ELU15631, [1, 1], Res37613), 
LDot71232 = dot_layer(Res66209,Res37613, 2, 2, Dot71232), 
LCon14011 = concatenate_layer([Dot71232,[[[0.6703, 0.6607, 0.0817, 0.3756, 0.8486, 0.2689, 0.6212, 0.6024, 0.6129, 0.7944, 0.0311, 0.7915, 0.1381, 0.2146, 0.704, 0.6265, 0.1592, 0.5367, 0.9801, 0.0132, 0.3542, 0.3752, 0.8843, 0.1902, 0.5268, 0.2236, 0.4329, 0.5411, 0.2973], [0.3205, 0.9511, 0.208, 0.5775, 0.0819, 0.2382, 0.6419, 0.5797, 0.3062, 0.2189, 0.9041, 0.4874, 0.7421, 0.9278, 0.8769, 0.2054, 0.1582, 0.2864, 0.5382, 0.7954, 0.7482, 0.1568, 0.1072, 0.3038, 0.568, 0.577, 0.1795, 0.6939, 0.707], [0.9214, 0.9337, 0.5043, 0.0707, 0.9651, 0.1146, 0.6732, 0.9735, 0.4797, 0.7786, 0.6923, 0.2228, 0.0363, 0.7167, 0.8845, 0.0144, 0.1527, 0.0653, 0.1327, 0.7511, 0.7845, 0.862, 0.8345, 0.8474, 0.4296, 0.2031, 0.2006, 0.6918, 0.7949]]]], 2, Con14011), 
LAve95338 = average_layer([Zer81563,Con14011], Ave95338), 
exec_layers([LMin84979,LRes43938,LDep26524,LRes30948,LZer67176,LCon78069,LMul50329,LZer89862,LMul27152,LZer45021,LMul27973,LZer61754,LMin24005,LRes9423,LRes72986,LZer81563,LGRU77126,LRes66209,LAve55878,LELU15631,LRes37613,LDot71232,LCon14011,LAve95338],["Min84979","Res43938","Dep26524","Res30948","Zer67176","Con78069","Mul50329","Zer89862","Mul27152","Zer45021","Mul27973","Zer61754","Min24005","Res9423","Res72986","Zer81563","GRU77126","Res66209","Ave55878","ELU15631","Res37613","Dot71232","Con14011","Ave95338"],Ave95338,"Ave95338")

Actual (Unparsed): [[[0.0000000, 0.3351500, 0.3303500, 0.0408500, 0.1878000, 0.4243000, 0.1344500, 0.3106000, 0.3012000, 0.3064500, 0.3972000, 0.0155500, 0.3957500, 0.0690500, 0.1073000, 0.3520000, 0.3132500, 0.0796000, 0.2683500, 0.4900500, 0.0066000, 0.1771000, 0.1876000, 0.4421500, 0.0951000, 0.2634000, 0.1118000, 0.2164500, 0.2705500, 0.1486500], [0.0000000, 0.1602500, 0.4755500, 0.1040000, 0.2887500, 0.0409500, 0.1191000, 0.3209500, 0.2898500, 0.1531000, 0.1094500, 0.4520500, 0.2437000, 0.3710500, 0.4639000, 0.4384500, 0.1027000, 0.0791000, 0.1432000, 0.2691000, 0.3977000, 0.3741000, 0.0784000, 0.0536000, 0.1519000, 0.2840000, 0.2885000, 0.0897500, 0.3469500, 0.3535000], [0.0000000, 0.4607000, 0.4668500, 0.2521500, 0.0353500, 0.4825500, 0.0573000, 0.3366000, 0.4867500, 0.2398500, 0.3893000, 0.3461500, 0.1114000, 0.0181500, 0.3583500, 0.4422500, 0.0072000, 0.0763500, 0.0326500, 0.0663500, 0.3755500, 0.3922500, 0.4310000, 0.4172500, 0.4237000, 0.2148000, 0.1015500, 0.1003000, 0.3506968, 0.3974747]]]

Expected (Unparsed): [[[0.0,0.33515,0.33035,0.04085,0.1878,0.4243,0.13445,0.3106,0.3012,0.30645,0.3972,0.01555,0.39575,0.06905,0.1073,0.352,0.31325,0.0796,0.26835,0.49005,0.0066,0.1771,0.1876,0.44215,0.0951,0.2634,0.1118,0.21645,0.27055,0.14865],[0.0,0.16025,0.47555,0.104,0.28875,0.04095,0.1191,0.32095,0.28985,0.1531,0.10945,0.45205,0.2437,0.37105,0.4639,0.43845,0.1027,0.0791,0.1432,0.2691,0.3977,0.3741,0.0784,0.0536,0.1519,0.284,0.2885,0.08975,0.34695,0.3535],[0.0,0.4607,0.46685,0.25215,0.03535,0.48255,0.0573,0.3366,0.48675,0.23985,0.3893,0.34615,0.1114,0.01815,0.35835,0.44225,0.0072,0.07635,0.03265,0.06635,0.37555,0.39225,0.431,0.41725,0.4237,0.2148,0.10155,0.1003,0.35069679615336197,0.39747467695472005]]]

Actual:   [[[0, 0.3352, 0.3304, 0.0409, 0.1878, 0.4243, 0.1345, 0.3106, 0.3012, 0.3065, 0.3972, 0.0156, 0.3958, 0.0691, 0.1073, 0.352, 0.3133, 0.0796, 0.2684, 0.4901, 0.0066, 0.1771, 0.1876, 0.4422, 0.0951, 0.2634, 0.1118, 0.2165, 0.2706, 0.1487], [0, 0.1603, 0.4756, 0.104, 0.2888, 0.041, 0.1191, 0.321, 0.2899, 0.1531, 0.1095, 0.4521, 0.2437, 0.3711, 0.4639, 0.4385, 0.1027, 0.0791, 0.1432, 0.2691, 0.3977, 0.3741, 0.0784, 0.0536, 0.1519, 0.284, 0.2885, 0.0898, 0.347, 0.3535], [0, 0.4607, 0.4669, 0.2522, 0.0354, 0.4826, 0.0573, 0.3366, 0.4868, 0.2399, 0.3893, 0.3462, 0.1114, 0.0182, 0.3584, 0.4423, 0.0072, 0.0764, 0.0327, 0.0664, 0.3756, 0.3923, 0.431, 0.4173, 0.4237, 0.2148, 0.1016, 0.1003, 0.3507, 0.3975]]]

Expected: [[[0, 0.3352, 0.3304, 0.0409, 0.1878, 0.4243, 0.1345, 0.3106, 0.3012, 0.3065, 0.3972, 0.0156, 0.3958, 0.0691, 0.1073, 0.352, 0.3133, 0.0796, 0.2684, 0.4901, 0.0066, 0.1771, 0.1876, 0.4422, 0.0951, 0.2634, 0.1118, 0.2165, 0.2706, 0.1487], [0, 0.1603, 0.4756, 0.104, 0.2888, 0.041, 0.1191, 0.321, 0.2899, 0.1531, 0.1095, 0.4521, 0.2437, 0.3711, 0.4639, 0.4385, 0.1027, 0.0791, 0.1432, 0.2691, 0.3977, 0.3741, 0.0784, 0.0536, 0.1519, 0.284, 0.2885, 0.0898, 0.347, 0.3535], [0, 0.4607, 0.4669, 0.2522, 0.0354, 0.4826, 0.0573, 0.3366, 0.4868, 0.2399, 0.3893, 0.3462, 0.1114, 0.0182, 0.3584, 0.4423, 0.0072, 0.0764, 0.0327, 0.0664, 0.3756, 0.3923, 0.431, 0.4173, 0.4237, 0.2148, 0.1016, 0.1003, 0.3507, 0.3975]]]