import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave81075 = tf.keras.layers.Input(shape=([1, 2]))
in1Ave81075 = tf.keras.layers.Input(shape=([1, 2]))
in0Con82269 = tf.keras.layers.Input(shape=([1, 4, 2]))
in0Cro71407 = tf.keras.layers.Input(shape=([1, 4]))
in0Add76335 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Add76335 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Con87063 = tf.keras.layers.Input(shape=([3, 8]))

Ave81075 = keras.layers.Average(name = 'Ave81075', )([in0Ave81075,in1Ave81075])
Res7345 = keras.layers.Reshape((1, 2, 1), name = 'Res7345', )(Ave81075)
Zer35760 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer35760', )(Res7345)
Con82269 = keras.layers.Concatenate(axis=3, name = 'Con82269', )([Zer35760,in0Con82269])
Cro71407 = keras.layers.Cropping1D(cropping=((0, 0)), name = 'Cro71407', )(in0Cro71407)
Res52824 = keras.layers.Reshape((1, 4, 1), name = 'Res52824', )(Cro71407)
Sep82547 = keras.layers.SeparableConv2D(3, (1, 1),strides=(1, 1), padding='same', name = 'Sep82547', )(Res52824)
Max41184 = keras.layers.Maximum(name = 'Max41184', )([Con82269,Sep82547])
Res68599 = keras.layers.Reshape((1, 12), name = 'Res68599', )(Max41184)
Zer65767 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer65767', )(Res68599)
Add76335 = keras.layers.Add(name = 'Add76335', )([in0Add76335,in1Add76335])
Res67456 = keras.layers.Reshape((1, 4), name = 'Res67456', )(Add76335)
Con87285 = keras.layers.Conv1D(4, (1),strides=(1), padding='valid', dilation_rate=(1), name = 'Con87285', )(Res67456)
Zer98622 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer98622', )(Con87285)
Con87063 = keras.layers.Concatenate(axis=2, name = 'Con87063', )([Zer98622,in0Con87063])
Ave83288 = keras.layers.Average(name = 'Ave83288', )([Zer65767,Con87063])
model = tf.keras.models.Model(inputs=[in0Ave81075,in1Ave81075,in0Con82269,in0Cro71407,in0Add76335,in1Add76335,in0Con87063], outputs=Ave83288)
w = model.get_layer('Sep82547').get_weights() 
w[0] = np.array([[[[0.1869]]]])
w[1] = np.array([[[[0.7854, 0.2732, 0.9491]]]])
w[2] = np.array([0, 0, 0])
model.get_layer('Sep82547').set_weights(w) 
w = model.get_layer('Con87285').get_weights() 
w[0] = np.array([[[0.0301, 0.9033, 0.2605, 0.3975], [0.6618, 0.9813, 0.6459, 0.8679], [0.4105, 0.8468, 0.0909, 0.6171], [0.9595, 0.852, 0.8698, 0.0939]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con87285').set_weights(w) 
in0Ave81075 = tf.constant([[[0.8307, 0.7428]]])
in1Ave81075 = tf.constant([[[0.1326, 0.2324]]])
in0Con82269 = tf.constant([[[[0.4212, 0.1131], [0.3209, 0.6949], [0.1461, 0.9588], [0.1653, 0.2841]]]])
in0Cro71407 = tf.constant([[[1.3689, 1.966, 1.4255, 1.4463]]])
in0Add76335 = tf.constant([[[[0.4847, 0.5265], [0.0676, 0.5079]]]])
in1Add76335 = tf.constant([[[[0.4869, 0.13], [0.3654, 0.734]]]])
in0Con87063 = tf.constant([[[0.7906, 0.1683, 0.9763, 0.7151, 0.4148, 0.0843, 0.1929, 0.0379], [0.638, 0.6535, 0.7076, 0.0082, 0.4031, 0.9719, 0.6973, 0.1743], [0.1776, 0.8472, 0.3748, 0.1339, 0.9891, 0.0919, 0.8109, 0.0607]]])
print (np.array2string(model.predict([in0Ave81075,in1Ave81075,in0Con82269,in0Cro71407,in0Add76335,in1Add76335,in0Con87063],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave83288.png')

LAve81075 = average_layer([[[[0.8307, 0.7428]]], [[[0.1326, 0.2324]]]], Ave81075), 
LRes7345 = reshape_layer(Ave81075, [1, 2, 1], Res7345), 
LZer35760 = zero_padding2D_layer(Res7345, 0, 0, 2, 0, Zer35760), 
LCon82269 = concatenate_layer([Zer35760,[[[[0.4212, 0.1131], [0.3209, 0.6949], [0.1461, 0.9588], [0.1653, 0.2841]]]]], 3, Con82269), 
LCro71407 = cropping1D_layer([[[1.3689, 1.966, 1.4255, 1.4463]]], 0, 0, Cro71407), 
LRes52824 = reshape_layer(Cro71407, [1, 4, 1], Res52824), 
LSep82547 = separable_conv2D_layer(Res52824, 1, 1,[[[[[0.1869]]]],[[[[0.7854, 0.2732, 0.9491]]]]],[0, 0, 0], 1, 1, true, Sep82547), 
LMax41184 = maximum_layer([Con82269,Sep82547], Max41184), 
LRes68599 = reshape_layer(Max41184, [1, 12], Res68599), 
LZer65767 = zero_padding1D_layer(Res68599, 2, 0, Zer65767), 
LAdd76335 = add_layer([[[[[0.4847, 0.5265], [0.0676, 0.5079]]]], [[[[0.4869, 0.13], [0.3654, 0.734]]]]], Add76335), 
LRes67456 = reshape_layer(Add76335, [1, 4], Res67456), 
LCon87285 = conv1D_layer(Res67456, 1,[[[0.0301, 0.9033, 0.2605, 0.3975], [0.6618, 0.9813, 0.6459, 0.8679], [0.4105, 0.8468, 0.0909, 0.6171], [0.9595, 0.852, 0.8698, 0.0939]]],[0, 0, 0, 0], 1, false, 1, Con87285), 
LZer98622 = zero_padding1D_layer(Con87285, 1, 1, Zer98622), 
LCon87063 = concatenate_layer([Zer98622,[[[0.7906, 0.1683, 0.9763, 0.7151, 0.4148, 0.0843, 0.1929, 0.0379], [0.638, 0.6535, 0.7076, 0.0082, 0.4031, 0.9719, 0.6973, 0.1743], [0.1776, 0.8472, 0.3748, 0.1339, 0.9891, 0.0919, 0.8109, 0.0607]]]], 2, Con87063), 
LAve83288 = average_layer([Zer65767,Con87063], Ave83288), 
exec_layers([LAve81075,LRes7345,LZer35760,LCon82269,LCro71407,LRes52824,LSep82547,LMax41184,LRes68599,LZer65767,LAdd76335,LRes67456,LCon87285,LZer98622,LCon87063,LAve83288],["Ave81075","Res7345","Zer35760","Con82269","Cro71407","Res52824","Sep82547","Max41184","Res68599","Zer65767","Add76335","Res67456","Con87285","Zer98622","Con87063","Ave83288"],Ave83288,"Ave83288")

Actual (Unparsed): [[[0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.3953000, 0.0841500, 0.4881500, 0.3575500, 0.2074000, 0.0421500, 0.0964500, 0.0189500], [0.9165332, 1.4733165, 0.8983497, 0.6699030, 0.3190000, 0.3267500, 0.3538000, 0.0041000, 0.2015500, 0.4859500, 0.3486500, 0.0871500], [0.1004713, 0.2106000, 0.1214124, 0.1442958, 0.2492500, 0.7710500, 0.4282250, 0.1400000, 0.9739500, 0.2897500, 0.4881000, 0.1724000]]]

Expected (Unparsed): [[[0,0,0,0,0.3953,0.08415,0.48815,0.35755,0.2074,0.04215,0.09645,0.01895],[0.9165332050000001,1.473316465,0.898349735,0.66990303,0.319,0.32675,0.3538,0.0041,0.20155,0.48595,0.34865,0.08715],[0.100471277907,0.2106,0.1214123884155,0.14429580858000002,0.24925000000000003,0.77105,0.428225,0.14,0.97395,0.28975,0.4881,0.1724]]]

Actual:   [[[0, 0, 0, 0, 0.3953, 0.0842, 0.4882, 0.3576, 0.2074, 0.0422, 0.0965, 0.019], [0.9166, 1.4734, 0.8984, 0.67, 0.319, 0.3268, 0.3538, 0.0041, 0.2016, 0.486, 0.3487, 0.0872], [0.1005, 0.2106, 0.1215, 0.1443, 0.2493, 0.7711, 0.4283, 0.14, 0.974, 0.2898, 0.4881, 0.1724]]]

Expected: [[[0, 0, 0, 0, 0.3953, 0.0842, 0.4882, 0.3576, 0.2074, 0.0422, 0.0965, 0.019], [0.9166, 1.4734, 0.8984, 0.67, 0.319, 0.3268, 0.3538, 0.0041, 0.2016, 0.486, 0.3487, 0.0872], [0.1005, 0.2106, 0.1215, 0.1443, 0.2493, 0.7711, 0.4283, 0.14, 0.974, 0.2898, 0.4881, 0.1724]]]