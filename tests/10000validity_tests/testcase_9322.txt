import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub19662 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub19662 = tf.keras.layers.Input(shape=([2, 3]))
in0Sof61175 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Mas74979 = tf.keras.layers.Input(shape=([1]))
in0Con8828 = tf.keras.layers.Input(shape=([3]))
in0Con21903 = tf.keras.layers.Input(shape=([2]))

Sub19662 = keras.layers.Subtract(name = 'Sub19662', )([in0Sub19662,in1Sub19662])
Res15699 = keras.layers.Reshape((2, 3, 1), name = 'Res15699', )(Sub19662)
Ave30259 = keras.layers.AveragePooling2D(pool_size=(2, 3), strides=(1, 1), padding='same', name = 'Ave30259', )(Res15699)
Res30525 = keras.layers.Reshape((2, 3), name = 'Res30525', )(Ave30259)
Fla64636 = keras.layers.Flatten(name = 'Fla64636', )(Res30525)
Sof61175 = keras.layers.Softmax(axis=1, name = 'Sof61175', input_shape=(2, 1, 2))(in0Sof61175)
Res83411 = keras.layers.Reshape((2, 2), name = 'Res83411', )(Sof61175)
Fla28313 = keras.layers.Flatten(name = 'Fla28313', )(Res83411)
Mas74979 = keras.layers.Masking(mask_value=2, name = 'Mas74979', )(in0Mas74979)
Con8828 = keras.layers.Concatenate(axis=1, name = 'Con8828', )([Mas74979,in0Con8828])
Max14563 = keras.layers.Maximum(name = 'Max14563', )([Fla28313,Con8828])
Con21903 = keras.layers.Concatenate(axis=1, name = 'Con21903', )([Max14563,in0Con21903])
Sub11303 = keras.layers.Subtract(name = 'Sub11303', )([Fla64636,Con21903])
Res71063 = keras.layers.Reshape((6, 1), name = 'Res71063', )(Sub11303)
Res59386 = keras.layers.Reshape((6, 1, 1), name = 'Res59386', )(Res71063)
Con9154 = keras.layers.Conv2DTranspose(2, (5, 1),strides=(1, 1), padding='same', name = 'Con9154', )(Res59386)
model = tf.keras.models.Model(inputs=[in0Sub19662,in1Sub19662,in0Sof61175,in0Mas74979,in0Con8828,in0Con21903], outputs=Con9154)
w = model.get_layer('Con9154').get_weights() 
w[0] = np.array([[[[0.2066], [0.0505]]], [[[0.4501], [0.352]]], [[[0.2955], [0.3883]]], [[[0.8767], [0.7944]]], [[[0.8216], [0.3209]]]])
w[1] = np.array([0, 0])
model.get_layer('Con9154').set_weights(w) 
in0Sub19662 = tf.constant([[[0.0439, 0.6201, 0.2819], [0.7433, 0.272, 0.746]]])
in1Sub19662 = tf.constant([[[0.8894, 0.9766, 0.0035], [0.2891, 0.9662, 0.607]]])
in0Sof61175 = tf.constant([[[[0.5891, 0.6246]], [[0.165, 0.7026]]]])
in0Mas74979 = tf.constant([[1.2768]])
in0Con8828 = tf.constant([[0.4646, 0.7647, 0.7096]])
in0Con21903 = tf.constant([[0.0489, 0.0938]])
print (np.array2string(model.predict([in0Sub19662,in1Sub19662,in0Sof61175,in0Mas74979,in0Con8828,in0Con21903],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con9154.png')

LSub19662 = subtract_layer([[[0.0439, 0.6201, 0.2819], [0.7433, 0.272, 0.746]]], [[[0.8894, 0.9766, 0.0035], [0.2891, 0.9662, 0.607]]], Sub19662), 
LRes15699 = reshape_layer(Sub19662, [2, 3, 1], Res15699), 
LAve30259 = average_pooling2D_layer(Res15699, 2, 3, 1, 1, true, Ave30259), 
LRes30525 = reshape_layer(Ave30259, [2, 3], Res30525), 
LFla64636 = flatten_layer(Res30525, Fla64636), 
LSof61175 = softmax_layer([[[[0.5891, 0.6246]], [[0.165, 0.7026]]]], 1, Sof61175), 
LRes83411 = reshape_layer(Sof61175, [2, 2], Res83411), 
LFla28313 = flatten_layer(Res83411, Fla28313), 
LMas74979 = masking_layer([[1.2768]], 2, Mas74979), 
LCon8828 = concatenate_layer([Mas74979,[[0.4646, 0.7647, 0.7096]]], 1, Con8828), 
LMax14563 = maximum_layer([Fla28313,Con8828], Max14563), 
LCon21903 = concatenate_layer([Max14563,[[0.0489, 0.0938]]], 1, Con21903), 
LSub11303 = subtract_layer(Fla64636,Con21903, Sub11303), 
LRes71063 = reshape_layer(Sub11303, [6, 1], Res71063), 
LRes59386 = reshape_layer(Res71063, [6, 1, 1], Res59386), 
LCon9154 = conv2D_transpose_layer(Res59386, 5, 1,[[[[0.2066], [0.0505]]], [[[0.4501], [0.352]]], [[[0.2955], [0.3883]]], [[[0.8767], [0.7944]]], [[[0.8216], [0.3209]]]],[0, 0], 1, 1, true, Con9154), 
exec_layers([LSub19662,LRes15699,LAve30259,LRes30525,LFla64636,LSof61175,LRes83411,LFla28313,LMas74979,LCon8828,LMax14563,LCon21903,LSub11303,LRes71063,LRes59386,LCon9154],["Sub19662","Res15699","Ave30259","Res30525","Fla64636","Sof61175","Res83411","Fla28313","Mas74979","Con8828","Max14563","Con21903","Sub11303","Res71063","Res59386","Con9154"],Con9154,"Con9154")

Actual (Unparsed): [[[[-0.9676587, -0.9116257]], [[-2.2147220, -1.9203614]], [[-2.5793949, -1.6973831]], [[-1.7033461, -1.3121985]], [[-1.6772332, -1.1180263]], [[-0.8637342, -0.4760242]]]]

Expected (Unparsed): [[[[-0.9676586888746549,-0.9116256970987081]],[[-2.2147220421844267,-1.92036140326045]],[[-2.579394949724491,-1.697383083226933]],[[-1.7033461253095603,-1.3121985506488412]],[[-1.67723325,-1.1180263991666668]],[[-0.8637342566666666,-0.47602421999999994]]]]

Actual:   [[[[-0.9676, -0.9116]], [[-2.2147, -1.9203]], [[-2.5793, -1.6973]], [[-1.7033, -1.3121]], [[-1.6772, -1.118]], [[-0.8637, -0.476]]]]

Expected: [[[[-0.9676, -0.9116]], [[-2.2147, -1.9203]], [[-2.5793, -1.6973]], [[-1.7033, -1.3121]], [[-1.6772, -1.118]], [[-0.8637, -0.476]]]]