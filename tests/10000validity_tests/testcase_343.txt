import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul76640 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Mul76640 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Ave98065 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave98065 = tf.keras.layers.Input(shape=([2, 2]))

Mul76640 = keras.layers.Multiply(name = 'Mul76640', )([in0Mul76640,in1Mul76640])
Res79179 = keras.layers.Reshape((2, 2), name = 'Res79179', )(Mul76640)
Ave98065 = keras.layers.Average(name = 'Ave98065', )([in0Ave98065,in1Ave98065])
Add45020 = keras.layers.Add(name = 'Add45020', )([Res79179,Ave98065])
Fla76344 = keras.layers.Flatten(name = 'Fla76344', )(Add45020)
Res43686 = keras.layers.Reshape((4, 1), name = 'Res43686', )(Fla76344)
Per22034 = keras.layers.Permute((1,2), name = 'Per22034',)(Res43686)
model = tf.keras.models.Model(inputs=[in0Mul76640,in1Mul76640,in0Ave98065,in1Ave98065], outputs=Per22034)
in0Mul76640 = tf.constant([[[[0.8623, 0.8979]], [[0.494, 0.8934]]]])
in1Mul76640 = tf.constant([[[[0.2666, 0.7437]], [[0.4086, 0.9667]]]])
in0Ave98065 = tf.constant([[[0.4766, 0.8163], [0.0081, 0.8982]]])
in1Ave98065 = tf.constant([[[0.5432, 0.2314], [0.1145, 0.685]]])
print (np.array2string(model.predict([in0Mul76640,in1Mul76640,in0Ave98065,in1Ave98065],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Per22034.png')

LMul76640 = multiply_layer([[[[[0.8623, 0.8979]], [[0.494, 0.8934]]]], [[[[0.2666, 0.7437]], [[0.4086, 0.9667]]]]], Mul76640), 
LRes79179 = reshape_layer(Mul76640, [2, 2], Res79179), 
LAve98065 = average_layer([[[[0.4766, 0.8163], [0.0081, 0.8982]]], [[[0.5432, 0.2314], [0.1145, 0.685]]]], Ave98065), 
LAdd45020 = add_layer([Res79179,Ave98065], Add45020), 
LFla76344 = flatten_layer(Add45020, Fla76344), 
LRes43686 = reshape_layer(Fla76344, [4, 1], Res43686), 
LPer22034 = permute_layer(Res43686, 1,2, Per22034), 
exec_layers([LMul76640,LRes79179,LAve98065,LAdd45020,LFla76344,LRes43686,LPer22034],["Mul76640","Res79179","Ave98065","Add45020","Fla76344","Res43686","Per22034"],Per22034,"Per22034")

Actual (Unparsed): [[[0.7397892], [1.1916182], [0.2631484], [1.6552498]]]

Expected (Unparsed): [[[0.73978918],[1.19161823],[0.2631484],[1.6552497800000001]]]

Actual:   [[[0.7398], [1.1917], [0.2632], [1.6553]]]

Expected: [[[0.7398], [1.1917], [0.2632], [1.6553]]]