import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave91727 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in1Ave91727 = tf.keras.layers.Input(shape=([1, 2, 1, 1]))
in0Con99000 = tf.keras.layers.Input(shape=([1, 16]))
in0Sub6037 = tf.keras.layers.Input(shape=([2, 2, 3, 3]))
in1Sub6037 = tf.keras.layers.Input(shape=([2, 2, 3, 3]))
in0Con29704 = tf.keras.layers.Input(shape=([1, 1]))
in0Glo74343 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))

Ave91727 = keras.layers.Average(name = 'Ave91727', )([in0Ave91727,in1Ave91727])
Res97390 = keras.layers.Reshape((1, 2, 1), name = 'Res97390', )(Ave91727)
Res73718 = keras.layers.Reshape((1, 2), name = 'Res73718', )(Res97390)
Con99000 = keras.layers.Concatenate(axis=2, name = 'Con99000', )([Res73718,in0Con99000])
Sub6037 = keras.layers.Subtract(name = 'Sub6037', )([in0Sub6037,in1Sub6037])
Res91548 = keras.layers.Reshape((2, 2, 9), name = 'Res91548', )(Sub6037)
Res43605 = keras.layers.Reshape((2, 18), name = 'Res43605', )(Res91548)
Dot18125 = keras.layers.Dot(axes=(2, 2), name = 'Dot18125', )([Con99000,Res43605])
Con29704 = keras.layers.Concatenate(axis=2, name = 'Con29704', )([Dot18125,in0Con29704])
Glo74343 = keras.layers.GlobalMaxPool3D(name = 'Glo74343', )(in0Glo74343)
Res31218 = keras.layers.Reshape((1, 1), name = 'Res31218', )(Glo74343)
Loc38312 = keras.layers.LocallyConnected1D(3, (1),strides=(1), name = 'Loc38312', )(Res31218)
Sub10701 = keras.layers.Subtract(name = 'Sub10701', )([Con29704,Loc38312])
model = tf.keras.models.Model(inputs=[in0Ave91727,in1Ave91727,in0Con99000,in0Sub6037,in1Sub6037,in0Con29704,in0Glo74343], outputs=Sub10701)
w = model.get_layer('Loc38312').get_weights() 
w[0] = np.array([[[0.6379, 0.0226, 0.7934]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc38312').set_weights(w) 
in0Ave91727 = tf.constant([[[[[0.7571]], [[0.4263]]]]])
in1Ave91727 = tf.constant([[[[[0.173]], [[0.1348]]]]])
in0Con99000 = tf.constant([[[0.3445, 0.1722, 0.4724, 0.4345, 0.0382, 0.7446, 0.6481, 0.705, 0.1024, 0.9442, 0.4651, 0.5444, 0.5526, 0.7585, 0.6808, 0.624]]])
in0Sub6037 = tf.constant([[[[[0.9624, 0.0677, 0.3351], [0.0555, 0.1928, 0.0076], [0.9946, 0.245, 0.3335]], [[0.1634, 0.2621, 0.6318], [0.2832, 0.4339, 0.7247], [0.3108, 0.4068, 0.599]]], [[[0.8289, 0.7799, 0.7989], [0.323, 0.5121, 0.2579], [0.606, 0.8313, 0.9513]], [[0.1703, 0.7151, 0.9993], [0.1253, 0.4476, 0.9647], [0.7843, 0.9984, 0.3667]]]]])
in1Sub6037 = tf.constant([[[[[0.6593, 0.1638, 0.5243], [0.2827, 0.5729, 0.9972], [0.3413, 0.7513, 0.8202]], [[0.5222, 0.9871, 0.2184], [0.9401, 0.5152, 0.6913], [0.6694, 0.2885, 0.5005]]], [[[0.3263, 0.37, 0.3703], [0.7745, 0.8904, 0.1095], [0.0528, 0.427, 0.9799]], [[0.1573, 0.6975, 0.9886], [0.0627, 0.4861, 0.1246], [0.8098, 0.0136, 0.679]]]]])
in0Con29704 = tf.constant([[[0.3112]]])
in0Glo74343 = tf.constant([[[[[1.9796]], [[1.7866]]], [[[1.2875]], [[1.3402]]]]])
print (np.array2string(model.predict([in0Ave91727,in1Ave91727,in0Con99000,in0Sub6037,in1Sub6037,in0Con29704,in0Glo74343],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub10701.png')

LAve91727 = average_layer([[[[[[0.7571]], [[0.4263]]]]], [[[[[0.173]], [[0.1348]]]]]], Ave91727), 
LRes97390 = reshape_layer(Ave91727, [1, 2, 1], Res97390), 
LRes73718 = reshape_layer(Res97390, [1, 2], Res73718), 
LCon99000 = concatenate_layer([Res73718,[[[0.3445, 0.1722, 0.4724, 0.4345, 0.0382, 0.7446, 0.6481, 0.705, 0.1024, 0.9442, 0.4651, 0.5444, 0.5526, 0.7585, 0.6808, 0.624]]]], 2, Con99000), 
LSub6037 = subtract_layer([[[[[0.9624, 0.0677, 0.3351], [0.0555, 0.1928, 0.0076], [0.9946, 0.245, 0.3335]], [[0.1634, 0.2621, 0.6318], [0.2832, 0.4339, 0.7247], [0.3108, 0.4068, 0.599]]], [[[0.8289, 0.7799, 0.7989], [0.323, 0.5121, 0.2579], [0.606, 0.8313, 0.9513]], [[0.1703, 0.7151, 0.9993], [0.1253, 0.4476, 0.9647], [0.7843, 0.9984, 0.3667]]]]], [[[[[0.6593, 0.1638, 0.5243], [0.2827, 0.5729, 0.9972], [0.3413, 0.7513, 0.8202]], [[0.5222, 0.9871, 0.2184], [0.9401, 0.5152, 0.6913], [0.6694, 0.2885, 0.5005]]], [[[0.3263, 0.37, 0.3703], [0.7745, 0.8904, 0.1095], [0.0528, 0.427, 0.9799]], [[0.1573, 0.6975, 0.9886], [0.0627, 0.4861, 0.1246], [0.8098, 0.0136, 0.679]]]]], Sub6037), 
LRes91548 = reshape_layer(Sub6037, [2, 2, 9], Res91548), 
LRes43605 = reshape_layer(Res91548, [2, 18], Res43605), 
LDot18125 = dot_layer(Con99000,Res43605, 2, 2, Dot18125), 
LCon29704 = concatenate_layer([Dot18125,[[[0.3112]]]], 2, Con29704), 
LGlo74343 = global_max_pool3D_layer([[[[[1.9796]], [[1.7866]]], [[[1.2875]], [[1.3402]]]]], Glo74343), 
LRes31218 = reshape_layer(Glo74343, [1, 1], Res31218), 
LLoc38312 = locally_connected1D_layer(Res31218, 1,[[[0.6379, 0.0226, 0.7934]]],[[0, 0, 0]], 1, Loc38312), 
LSub10701 = subtract_layer(Con29704,Loc38312, Sub10701), 
exec_layers([LAve91727,LRes97390,LRes73718,LCon99000,LSub6037,LRes91548,LRes43605,LDot18125,LCon29704,LGlo74343,LRes31218,LLoc38312,LSub10701],["Ave91727","Res97390","Res73718","Con99000","Sub6037","Res91548","Res43605","Dot18125","Con29704","Glo74343","Res31218","Loc38312","Sub10701"],Sub10701,"Sub10701")

Actual (Unparsed): [[[-2.9282842, 1.5130065, -1.2594146]]]

Expected (Unparsed): [[[-2.92828416,1.5130064450000003,-1.2594146400000001]]]

Actual:   [[[-2.9282, 1.5131, -1.2594]]]

Expected: [[[-2.9282, 1.5131, -1.2594]]]