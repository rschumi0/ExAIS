import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo21870 = tf.keras.layers.Input(shape=([1, 2]))
in0Con53931 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Dep96397 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Max68820 = tf.keras.layers.Input(shape=([1, 2, 2]))
in1Max68820 = tf.keras.layers.Input(shape=([1, 2, 2]))

Glo21870 = keras.layers.GlobalAveragePooling1D(name = 'Glo21870', )(in0Glo21870)
Res35904 = keras.layers.Reshape((2, 1), name = 'Res35904', )(Glo21870)
Res88511 = keras.layers.Reshape((2, 1, 1), name = 'Res88511', )(Res35904)
Con53931 = keras.layers.Concatenate(axis=3, name = 'Con53931', )([Res88511,in0Con53931])
Dep96397 = keras.layers.DepthwiseConv2D((1, 2),strides=(2, 2), padding='valid', name = 'Dep96397', )(in0Dep96397)
Zer11125 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer11125', )(Dep96397)
Ave88998 = keras.layers.Average(name = 'Ave88998', )([Con53931,Zer11125])
Sof73945 = keras.layers.Softmax(axis=1, name = 'Sof73945', )(Ave88998)
Zer86894 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer86894', )(Sof73945)
Max68820 = keras.layers.Maximum(name = 'Max68820', )([in0Max68820,in1Max68820])
Bat67361 = keras.layers.BatchNormalization(axis=1, epsilon=0.17585275027906772,  name = 'Bat67361', )(Max68820)
Lay21238 = keras.layers.LayerNormalization(axis=1, epsilon=2.09366695122173, name = 'Lay21238', )(Bat67361)
Zer85073 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer85073', )(Lay21238)
Sub15924 = keras.layers.Subtract(name = 'Sub15924', )([Zer86894,Zer85073])
model = tf.keras.models.Model(inputs=[in0Glo21870,in0Con53931,in0Dep96397,in0Max68820,in1Max68820], outputs=Sub15924)
w = model.get_layer('Dep96397').get_weights() 
w[0] = np.array([[[[0.3667], [0.7168]], [[0.6033], [0.3582]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep96397').set_weights(w) 
w = model.get_layer('Bat67361').get_weights() 
w[0] = np.array([0.0153])
w[1] = np.array([0.1514])
w[2] = np.array([0.0067])
w[3] = np.array([0.1744])
model.get_layer('Bat67361').set_weights(w) 
in0Glo21870 = tf.constant([[[1.469, 1.2609]]])
in0Con53931 = tf.constant([[[[0.0552]], [[0.3058]]]])
in0Dep96397 = tf.constant([[[[0.3783, 0.028], [0.1427, 0.4057]], [[0.4552, 0.5667], [0.8943, 0.0879]]]])
in0Max68820 = tf.constant([[[[0.7827, 0.7332], [0.865, 0.6664]]]])
in1Max68820 = tf.constant([[[[0.6775, 0.7594], [0.1967, 0.3268]]]])
print (np.array2string(model.predict([in0Glo21870,in0Con53931,in0Dep96397,in0Max68820,in1Max68820],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub15924.png')

LGlo21870 = global_average_pooling1D_layer([[[1.469, 1.2609]]], Glo21870), 
LRes35904 = reshape_layer(Glo21870, [2, 1], Res35904), 
LRes88511 = reshape_layer(Res35904, [2, 1, 1], Res88511), 
LCon53931 = concatenate_layer([Res88511,[[[[0.0552]], [[0.3058]]]]], 3, Con53931), 
LDep96397 = depthwise_conv2D_layer([[[[0.3783, 0.028], [0.1427, 0.4057]], [[0.4552, 0.5667], [0.8943, 0.0879]]]], 1, 2,[[[[0.3667], [0.7168]], [[0.6033], [0.3582]]]],[0, 0], 2, 2, false, Dep96397), 
LZer11125 = zero_padding2D_layer(Dep96397, 1, 0, 0, 0, Zer11125), 
LAve88998 = average_layer([Con53931,Zer11125], Ave88998), 
LSof73945 = softmax_layer(Ave88998, 1, Sof73945), 
LZer86894 = zero_padding2D_layer(Sof73945, 0, 0, 2, 0, Zer86894), 
LMax68820 = maximum_layer([[[[[0.7827, 0.7332], [0.865, 0.6664]]]], [[[[0.6775, 0.7594], [0.1967, 0.3268]]]]], Max68820), 
LBat67361 = batch_normalization_layer(Max68820, 1, 0.17585275027906772, [0.0153], [0.1514], [0.0067], [0.1744], Bat67361), 
LLay21238 = layer_normalization_layer(Bat67361, 1, 2.09366695122173, Lay21238), 
LZer85073 = zero_padding2D_layer(Lay21238, 1, 0, 1, 0, Zer85073), 
LSub15924 = subtract_layer(Zer86894,Zer85073, Sub15924), 
exec_layers([LGlo21870,LRes35904,LRes88511,LCon53931,LDep96397,LZer11125,LAve88998,LSof73945,LZer86894,LMax68820,LBat67361,LLay21238,LZer85073,LSub15924],["Glo21870","Res35904","Res88511","Con53931","Dep96397","Zer11125","Ave88998","Sof73945","Zer86894","Max68820","Bat67361","Lay21238","Zer85073","Sub15924"],Sub15924,"Sub15924")

Actual (Unparsed): [[[[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.4979108, 0.4481876]], [[0.0000000, 0.0000000], [0.0000000, 0.0000000], [0.5020892, 0.5518124]]]]

Expected (Unparsed): [[[[0,0],[0,0],[0.4979108221582067,0.44818764171646636]],[[0,0],[0.0,0.0],[0.5020891778417934,0.5518123582835335]]]]

Actual:   [[[[0, 0], [0, 0], [0.498, 0.4482]], [[0, 0], [0, 0], [0.5021, 0.5519]]]]

Expected: [[[[0, 0], [0, 0], [0.498, 0.4482]], [[0, 0], [0, 0], [0.5021, 0.5519]]]]