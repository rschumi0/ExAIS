import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Zer62616 = tf.keras.layers.Input(shape=([2, 4, 1]))
in0Per34732 = tf.keras.layers.Input(shape=([1, 2]))
in0Con36296 = tf.keras.layers.Input(shape=([2, 3]))

Zer62616 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer62616', )(in0Zer62616)
Loc66132 = keras.layers.LocallyConnected2D(4, (4, 3),strides=(3, 10), name = 'Loc66132', )(Zer62616)
Res13210 = keras.layers.Reshape((1, 4), name = 'Res13210', )(Loc66132)
Zer23140 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer23140', )(Res13210)
Per34732 = keras.layers.Permute((2,1), name = 'Per34732',)(in0Per34732)
Con36296 = keras.layers.Concatenate(axis=2, name = 'Con36296', )([Per34732,in0Con36296])
Add73083 = keras.layers.Add(name = 'Add73083', )([Zer23140,Con36296])
Res90225 = keras.layers.Reshape((2, 4, 1), name = 'Res90225', )(Add73083)
Con92166 = keras.layers.Conv2DTranspose(3, (2, 4),strides=(1, 1), padding='same', name = 'Con92166', )(Res90225)
Res98762 = keras.layers.Reshape((2, 12), name = 'Res98762', )(Con92166)
PRe39457 = keras.layers.PReLU(name = 'PRe39457', )(Res98762)
model = tf.keras.models.Model(inputs=[in0Zer62616,in0Per34732,in0Con36296], outputs=PRe39457)
w = model.get_layer('Loc66132').get_weights() 
w[0] = np.array([[[0.7235, 0.3313, 0.7389, 0.4622], [0.6764, 0.4998, 0.952, 0.0348], [0.5591, 0.3402, 0.0509, 0.252], [0.7305, 0.7982, 0.2747, 0.9646], [0.6214, 0.5219, 0.8055, 0.0956], [0.7406, 0.7562, 0.7906, 0.9699], [0.59, 0.1591, 0.5702, 0.8018], [0.2921, 0.607, 0.1174, 0.0376], [0.2712, 0.2613, 0.6261, 0.4707], [0.9028, 0.6507, 0.6469, 0.0444], [0.6462, 0.2952, 0.1607, 0.043], [0.8116, 0.4408, 0.5072, 0.9352]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc66132').set_weights(w) 
w = model.get_layer('Con92166').get_weights() 
w[0] = np.array([[[[0.599], [0.0695], [0.5305]], [[0.2928], [0.4935], [0.4191]], [[0.9888], [0.6634], [0.4378]], [[0.2537], [0.6226], [0.3748]]], [[[0.8362], [0.2166], [0.6862]], [[0.2963], [0.8036], [0.7513]], [[0.8064], [0.1146], [0.4102]], [[0.4496], [0.2814], [0.1353]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con92166').set_weights(w) 
w = model.get_layer('PRe39457').get_weights() 
w[0] = np.array([[0.5126, 0.5222, 0.5483, 0.9646, 0.5788, 0.7932, 0.6066, 0.0564, 0.6663, 0.5554, 0.6178, 0.8409], [0.4787, 0.3558, 0.5881, 0.49, 0.3386, 0.2187, 0.2755, 0.6644, 0.8665, 0.9109, 0.0407, 0.8973]])
model.get_layer('PRe39457').set_weights(w) 
in0Zer62616 = tf.constant([[[[1.1574], [1.0446], [1.8183], [1.9774]], [[1.2704], [1.9345], [1.561], [1.992]]]])
in0Per34732 = tf.constant([[[1.3146, 1.0586]]])
in0Con36296 = tf.constant([[[0.6575, 0.9143, 0.1594], [0.5882, 0.2171, 0.1804]]])
print (np.array2string(model.predict([in0Zer62616,in0Per34732,in0Con36296],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='PRe39457.png')

LZer62616 = zero_padding2D_layer([[[[1.1574], [1.0446], [1.8183], [1.9774]], [[1.2704], [1.9345], [1.561], [1.992]]]], 1, 1, 1, 1, Zer62616), 
LLoc66132 = locally_connected2D_layer(Zer62616, 4, 3,[[[0.7235, 0.3313, 0.7389, 0.4622], [0.6764, 0.4998, 0.952, 0.0348], [0.5591, 0.3402, 0.0509, 0.252], [0.7305, 0.7982, 0.2747, 0.9646], [0.6214, 0.5219, 0.8055, 0.0956], [0.7406, 0.7562, 0.7906, 0.9699], [0.59, 0.1591, 0.5702, 0.8018], [0.2921, 0.607, 0.1174, 0.0376], [0.2712, 0.2613, 0.6261, 0.4707], [0.9028, 0.6507, 0.6469, 0.0444], [0.6462, 0.2952, 0.1607, 0.043], [0.8116, 0.4408, 0.5072, 0.9352]]],[[[0, 0, 0, 0]]], 3, 10, Loc66132), 
LRes13210 = reshape_layer(Loc66132, [1, 4], Res13210), 
LZer23140 = zero_padding1D_layer(Res13210, 1, 0, Zer23140), 
LPer34732 = permute_layer([[[1.3146, 1.0586]]], 2,1, Per34732), 
LCon36296 = concatenate_layer([Per34732,[[[0.6575, 0.9143, 0.1594], [0.5882, 0.2171, 0.1804]]]], 2, Con36296), 
LAdd73083 = add_layer([Zer23140,Con36296], Add73083), 
LRes90225 = reshape_layer(Add73083, [2, 4, 1], Res90225), 
LCon92166 = conv2D_transpose_layer(Res90225, 2, 4,[[[[0.599], [0.0695], [0.5305]], [[0.2928], [0.4935], [0.4191]], [[0.9888], [0.6634], [0.4378]], [[0.2537], [0.6226], [0.3748]]], [[[0.8362], [0.2166], [0.6862]], [[0.2963], [0.8036], [0.7513]], [[0.8064], [0.1146], [0.4102]], [[0.4496], [0.2814], [0.1353]]]],[0, 0, 0], 1, 1, true, Con92166), 
LRes98762 = reshape_layer(Con92166, [2, 12], Res98762), 
LPRe39457 = prelu_layer(Res98762, [[0.5126, 0.5222, 0.5483, 0.9646, 0.5788, 0.7932, 0.6066, 0.0564, 0.6663, 0.5554, 0.6178, 0.8409], [0.4787, 0.3558, 0.5881, 0.49, 0.3386, 0.2187, 0.2755, 0.6644, 0.8665, 0.9109, 0.0407, 0.8973]], PRe39457), 
exec_layers([LZer62616,LLoc66132,LRes13210,LZer23140,LPer34732,LCon36296,LAdd73083,LRes90225,LCon92166,LRes98762,LPRe39457],["Zer62616","Loc66132","Res13210","Zer23140","Per34732","Con36296","Add73083","Res90225","Con92166","Res98762","PRe39457"],PRe39457,"PRe39457")

Actual (Unparsed): [[[0.7787574, 0.6944513, 0.8997526, 2.0400582, 1.2601257, 1.3361263, 1.3468377, 1.7169408, 1.2483104, 1.1175399, 1.0945701, 0.7135161], [3.9006617, 3.1264862, 4.6123287, 8.3801871, 5.0039395, 6.3050733, 7.9542072, 7.3259753, 6.5607804, 5.8675845, 5.7762056, 4.2137066]]]

Expected (Unparsed): [[[0.77875738,0.69445135,0.89975261,2.04005818,1.26012574,1.33612628,1.3468376599999998,1.71694081,1.24831041,1.11753991,1.09457002,0.7135160800000001],[3.9006616873780002,3.126486194645,4.6123287152909995,8.380187137442,5.003939471394,6.305073284336,7.9542071602219995,7.325975243678,6.5607803310240005,5.867584482683,5.776205619751,4.213706530036999]]]

Actual:   [[[0.7788, 0.6945, 0.8998, 2.0401, 1.2602, 1.3362, 1.3469, 1.717, 1.2484, 1.1176, 1.0946, 0.7136], [3.9007, 3.1265, 4.6124, 8.3802, 5.004, 6.3051, 7.9543, 7.326, 6.5608, 5.8676, 5.7763, 4.2138]]]

Expected: [[[0.7788, 0.6945, 0.8998, 2.0401, 1.2602, 1.3362, 1.3469, 1.717, 1.2484, 1.1176, 1.0946, 0.7136], [3.9007, 3.1265, 4.6124, 8.3802, 5.004, 6.3051, 7.9543, 7.326, 6.5608, 5.8676, 5.7763, 4.2138]]]