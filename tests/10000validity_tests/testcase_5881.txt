import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave58420 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave58420 = tf.keras.layers.Input(shape=([2, 1]))

Ave58420 = keras.layers.Average(name = 'Ave58420', )([in0Ave58420,in1Ave58420])
LST65362 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST65362', )(Ave58420)
Res73678 = keras.layers.Reshape((1, 1), name = 'Res73678', )(LST65362)
Res48929 = keras.layers.Reshape((1, 1, 1), name = 'Res48929', )(Res73678)
Max97625 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 1), padding='same', name = 'Max97625', )(Res48929)
model = tf.keras.models.Model(inputs=[in0Ave58420,in1Ave58420], outputs=Max97625)
w = model.get_layer('LST65362').get_weights() 
w[0] = np.array([[3, 2, 10, 7]])
w[1] = np.array([[6, 3, 9, 7]])
w[2] = np.array([4, 4, 4, 10])
model.get_layer('LST65362').set_weights(w) 
in0Ave58420 = tf.constant([[[0.9903], [0.1596]]])
in1Ave58420 = tf.constant([[[0.5565], [0.1677]]])
print (np.array2string(model.predict([in0Ave58420,in1Ave58420],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max97625.png')

LAve58420 = average_layer([[[[0.9903], [0.1596]]], [[[0.5565], [0.1677]]]], Ave58420), 
LLST65362 = lstm_layer(Ave58420,[[3, 2, 10, 7]],[[6, 3, 9, 7]],[4, 4, 4, 10], LST65362), 
LRes73678 = reshape_layer(LST65362, [1, 1], Res73678), 
LRes48929 = reshape_layer(Res73678, [1, 1, 1], Res48929), 
LMax97625 = max_pool2D_layer(Res48929, 1, 1, 1, 1, true, Max97625), 
exec_layers([LAve58420,LLST65362,LRes73678,LRes48929,LMax97625],["Ave58420","LST65362","Res73678","Res48929","Max97625"],Max97625,"Max97625")

Actual (Unparsed): [[[[0.9637968]]]]

Expected (Unparsed): [[[[0.9637967583026901]]]]

Actual:   [[[[0.9638]]]]

Expected: [[[[0.9638]]]]