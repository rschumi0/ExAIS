import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub89701 = tf.keras.layers.Input(shape=([3, 2, 2]))
in1Sub89701 = tf.keras.layers.Input(shape=([3, 2, 2]))
in0Dot94099 = tf.keras.layers.Input(shape=([2]))
in1Dot94099 = tf.keras.layers.Input(shape=([2]))
in0Con44671 = tf.keras.layers.Input(shape=([1, 1]))
in0Con94340 = tf.keras.layers.Input(shape=([1, 1]))
in0Con59272 = tf.keras.layers.Input(shape=([3, 2]))

Sub89701 = keras.layers.Subtract(name = 'Sub89701', )([in0Sub89701,in1Sub89701])
Bat77109 = keras.layers.BatchNormalization(axis=1, epsilon=0.6676724633817017,  name = 'Bat77109', )(Sub89701)
Res92902 = keras.layers.Reshape((3, 4), name = 'Res92902', )(Bat77109)
Dot94099 = keras.layers.Dot(axes=(1, 1), name = 'Dot94099', )([in0Dot94099,in1Dot94099])
Res32729 = keras.layers.Reshape((1, 1), name = 'Res32729', )(Dot94099)
Con44671 = keras.layers.Concatenate(axis=2, name = 'Con44671', )([Res32729,in0Con44671])
Con94340 = keras.layers.Conv1D(2, (1),strides=(5), padding='same', dilation_rate=(1), name = 'Con94340', )(in0Con94340)
Sof33210 = keras.layers.Softmax(axis=1, name = 'Sof33210', )(Con94340)
Mul51526 = keras.layers.Multiply(name = 'Mul51526', )([Con44671,Sof33210])
Zer2388 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer2388', )(Mul51526)
Con59272 = keras.layers.Concatenate(axis=2, name = 'Con59272', )([Zer2388,in0Con59272])
Max10705 = keras.layers.Maximum(name = 'Max10705', )([Res92902,Con59272])
model = tf.keras.models.Model(inputs=[in0Sub89701,in1Sub89701,in0Dot94099,in1Dot94099,in0Con44671,in0Con94340,in0Con59272], outputs=Max10705)
w = model.get_layer('Bat77109').get_weights() 
w[0] = np.array([0.161, 0.8896, 0.1021])
w[1] = np.array([0.4499, 0.2537, 0.9593])
w[2] = np.array([0.4536, 0.7417, 0.3701])
w[3] = np.array([0.5505, 0.0609, 0.8808])
model.get_layer('Bat77109').set_weights(w) 
w = model.get_layer('Con94340').get_weights() 
w[0] = np.array([[[0.6324, 0.6127]]])
w[1] = np.array([0, 0])
model.get_layer('Con94340').set_weights(w) 
in0Sub89701 = tf.constant([[[[0.5096, 0.5968], [0.8778, 0.2551]], [[0.2887, 0.6806], [0.4817, 0.1777]], [[0.9728, 0.5184], [0.9883, 0.9084]]]])
in1Sub89701 = tf.constant([[[[0.2261, 0.1446], [0.2916, 0.2258]], [[0.8122, 0.5175], [0.9809, 0.8577]], [[0.596, 0.2736], [0.9904, 0.3877]]]])
in0Dot94099 = tf.constant([[0.7059, 0.0886]])
in1Dot94099 = tf.constant([[0.4718, 0.6563]])
in0Con44671 = tf.constant([[[0.1687]]])
in0Con94340 = tf.constant([[[0.2769]]])
in0Con59272 = tf.constant([[[0.9054, 0.2602], [0.6717, 0.8409], [0.1167, 0.6132]]])
print (np.array2string(model.predict([in0Sub89701,in1Sub89701,in0Dot94099,in1Dot94099,in0Con44671,in0Con94340,in0Con59272],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max10705.png')

LSub89701 = subtract_layer([[[[0.5096, 0.5968], [0.8778, 0.2551]], [[0.2887, 0.6806], [0.4817, 0.1777]], [[0.9728, 0.5184], [0.9883, 0.9084]]]], [[[[0.2261, 0.1446], [0.2916, 0.2258]], [[0.8122, 0.5175], [0.9809, 0.8577]], [[0.596, 0.2736], [0.9904, 0.3877]]]], Sub89701), 
LBat77109 = batch_normalization_layer(Sub89701, 1, 0.6676724633817017, [0.161, 0.8896, 0.1021], [0.4499, 0.2537, 0.9593], [0.4536, 0.7417, 0.3701], [0.5505, 0.0609, 0.8808], Bat77109), 
LRes92902 = reshape_layer(Bat77109, [3, 4], Res92902), 
LDot94099 = dot_layer([[0.7059, 0.0886]], [[0.4718, 0.6563]], 1, 1, Dot94099), 
LRes32729 = reshape_layer(Dot94099, [1, 1], Res32729), 
LCon44671 = concatenate_layer([Res32729,[[[0.1687]]]], 2, Con44671), 
LCon94340 = conv1D_layer([[[0.2769]]], 1,[[[0.6324, 0.6127]]],[0, 0], 5, true, 1, Con94340), 
LSof33210 = softmax_layer(Con94340, 1, Sof33210), 
LMul51526 = multiply_layer([Con44671,Sof33210], Mul51526), 
LZer2388 = zero_padding1D_layer(Mul51526, 2, 0, Zer2388), 
LCon59272 = concatenate_layer([Zer2388,[[[0.9054, 0.2602], [0.6717, 0.8409], [0.1167, 0.6132]]]], 2, Con59272), 
LMax10705 = maximum_layer([Res92902,Con59272], Max10705), 
exec_layers([LSub89701,LBat77109,LRes92902,LDot94099,LRes32729,LCon44671,LCon94340,LSof33210,LMul51526,LZer2388,LCon59272,LMax10705],["Sub89701","Bat77109","Res92902","Dot94099","Res32729","Con44671","Con94340","Sof33210","Mul51526","Zer2388","Con59272","Max10705"],Max10705,"Max10705")

Actual (Unparsed): [[[0.4250872, 0.4496958, 0.9054000, 0.3880066], [0.0000000, 0.0000000, 0.6717000, 0.8409000], [0.9598497, 0.9490192, 0.9287613, 0.9716566]]]

Expected (Unparsed): [[[0.42508719853748433,0.44969577941183114,0.9054,0.38800657459996823],[0,0,0.6717,0.8409],[0.9598497291942149,0.9490192435768481,0.9287613125243644,0.971656599499814]]]

Actual:   [[[0.4251, 0.4497, 0.9054, 0.3881], [0, 0, 0.6717, 0.8409], [0.9599, 0.9491, 0.9288, 0.9717]]]

Expected: [[[0.4251, 0.4497, 0.9054, 0.3881], [0, 0, 0.6717, 0.8409], [0.9599, 0.9491, 0.9288, 0.9717]]]