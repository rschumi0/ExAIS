import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min97660 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in1Min97660 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in0Min88220 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Min88220 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Dot8749 = tf.keras.layers.Input(shape=([2]))
in1Dot8749 = tf.keras.layers.Input(shape=([2]))
in0Con82729 = tf.keras.layers.Input(shape=([1]))
in0Con96205 = tf.keras.layers.Input(shape=([6]))

Min97660 = keras.layers.Minimum(name = 'Min97660', )([in0Min97660,in1Min97660])
Res27423 = keras.layers.Reshape((2, 1, 4), name = 'Res27423', )(Min97660)
Res91545 = keras.layers.Reshape((2, 4), name = 'Res91545', )(Res27423)
Fla21820 = keras.layers.Flatten(name = 'Fla21820', )(Res91545)
Min88220 = keras.layers.Minimum(name = 'Min88220', )([in0Min88220,in1Min88220])
Res36926 = keras.layers.Reshape((2, 2), name = 'Res36926', )(Min88220)
GRU60007 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU60007', )(Res36926)
Dot8749 = keras.layers.Dot(axes=(1, 1), name = 'Dot8749', )([in0Dot8749,in1Dot8749])
Con82729 = keras.layers.Concatenate(axis=1, name = 'Con82729', )([Dot8749,in0Con82729])
Min66574 = keras.layers.Minimum(name = 'Min66574', )([GRU60007,Con82729])
Con96205 = keras.layers.Concatenate(axis=1, name = 'Con96205', )([Min66574,in0Con96205])
Ave40739 = keras.layers.Average(name = 'Ave40739', )([Fla21820,Con96205])
model = tf.keras.models.Model(inputs=[in0Min97660,in1Min97660,in0Min88220,in1Min88220,in0Dot8749,in1Dot8749,in0Con82729,in0Con96205], outputs=Ave40739)
w = model.get_layer('GRU60007').get_weights() 
w[0] = np.array([[6, 8, 4, 5, 2, 8], [1, 2, 7, 5, 5, 7]])
w[1] = np.array([[7, 7, 1, 1, 10, 3], [5, 8, 8, 10, 5, 10]])
w[2] = np.array([10, 9, 4, 10, 9, 9])
model.get_layer('GRU60007').set_weights(w) 
in0Min97660 = tf.constant([[[[[0.9467, 0.2395], [0.7144, 0.9225]]], [[[0.7271, 0.2114], [0.7385, 0.7754]]]]])
in1Min97660 = tf.constant([[[[[0.5398, 0.3004], [0.9294, 0.3366]]], [[[0.8253, 0.4245], [0.7729, 0.7669]]]]])
in0Min88220 = tf.constant([[[[0.496], [0.9125]], [[0.1572], [0.0696]]]])
in1Min88220 = tf.constant([[[[0.3187], [0.5169]], [[0.3451], [0.4444]]]])
in0Dot8749 = tf.constant([[0.982, 0.5786]])
in1Dot8749 = tf.constant([[0.8725, 0.3541]])
in0Con82729 = tf.constant([[0.7903]])
in0Con96205 = tf.constant([[0.2025, 0.3464, 0.0501, 0.2093, 0.8546, 0.5189]])
print (np.array2string(model.predict([in0Min97660,in1Min97660,in0Min88220,in1Min88220,in0Dot8749,in1Dot8749,in0Con82729,in0Con96205],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave40739.png')

LMin97660 = minimum_layer([[[[[[0.9467, 0.2395], [0.7144, 0.9225]]], [[[0.7271, 0.2114], [0.7385, 0.7754]]]]], [[[[[0.5398, 0.3004], [0.9294, 0.3366]]], [[[0.8253, 0.4245], [0.7729, 0.7669]]]]]], Min97660), 
LRes27423 = reshape_layer(Min97660, [2, 1, 4], Res27423), 
LRes91545 = reshape_layer(Res27423, [2, 4], Res91545), 
LFla21820 = flatten_layer(Res91545, Fla21820), 
LMin88220 = minimum_layer([[[[[0.496], [0.9125]], [[0.1572], [0.0696]]]], [[[[0.3187], [0.5169]], [[0.3451], [0.4444]]]]], Min88220), 
LRes36926 = reshape_layer(Min88220, [2, 2], Res36926), 
LGRU60007 = gru_layer(Res36926,[[6, 8, 4, 5, 2, 8], [1, 2, 7, 5, 5, 7]],[[7, 7, 1, 1, 10, 3], [5, 8, 8, 10, 5, 10]],[10, 9, 4, 10, 9, 9], false, GRU60007), 
LDot8749 = dot_layer([[0.982, 0.5786]], [[0.8725, 0.3541]], 1, 1, Dot8749), 
LCon82729 = concatenate_layer([Dot8749,[[0.7903]]], 1, Con82729), 
LMin66574 = minimum_layer([GRU60007,Con82729], Min66574), 
LCon96205 = concatenate_layer([Min66574,[[0.2025, 0.3464, 0.0501, 0.2093, 0.8546, 0.5189]]], 1, Con96205), 
LAve40739 = average_layer([Fla21820,Con96205], Ave40739), 
exec_layers([LMin97660,LRes27423,LRes91545,LFla21820,LMin88220,LRes36926,LGRU60007,LDot8749,LCon82729,LMin66574,LCon96205,LAve40739],["Min97660","Res27423","Res91545","Fla21820","Min88220","Res36926","GRU60007","Dot8749","Con82729","Min66574","Con96205","Ave40739"],Ave40739,"Ave40739")

Actual (Unparsed): [[0.2699102, 0.1197670, 0.4584500, 0.3415000, 0.3886000, 0.2103500, 0.7965500, 0.6429000]]

Expected (Unparsed): [[0.26991024432392774,0.11976697787007537,0.45845,0.3415,0.3886,0.21035,0.7965500000000001,0.6429]]

Actual:   [[0.27, 0.1198, 0.4585, 0.3415, 0.3886, 0.2104, 0.7966, 0.6429]]

Expected: [[0.27, 0.1198, 0.4585, 0.3415, 0.3886, 0.2104, 0.7966, 0.6429]]