import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max76986 = tf.keras.layers.Input(shape=([1, 2]))
in1Max76986 = tf.keras.layers.Input(shape=([1, 2]))
in0Con39979 = tf.keras.layers.Input(shape=([3, 2]))
in0Per30699 = tf.keras.layers.Input(shape=([4, 3]))
in0Max2549 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Max2549 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con31738 = tf.keras.layers.Input(shape=([1, 2]))
in0Mul66140 = tf.keras.layers.Input(shape=([2, 1]))
in1Mul66140 = tf.keras.layers.Input(shape=([2, 1]))
in0Con66365 = tf.keras.layers.Input(shape=([5, 3]))

Max76986 = keras.layers.Maximum(name = 'Max76986', )([in0Max76986,in1Max76986])
Zer5052 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer5052', )(Max76986)
Con39979 = keras.layers.Concatenate(axis=2, name = 'Con39979', )([Zer5052,in0Con39979])
Per30699 = keras.layers.Permute((2,1), name = 'Per30699',)(in0Per30699)
Min70416 = keras.layers.Minimum(name = 'Min70416', )([Con39979,Per30699])
Zer55392 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer55392', )(Min70416)
Max2549 = keras.layers.Maximum(name = 'Max2549', )([in0Max2549,in1Max2549])
Res61005 = keras.layers.Reshape((1, 2), name = 'Res61005', )(Max2549)
Loc90892 = keras.layers.LocallyConnected1D(3, (1),strides=(12), name = 'Loc90892', )(Res61005)
Con31738 = keras.layers.Concatenate(axis=2, name = 'Con31738', )([Loc90892,in0Con31738])
Mul66140 = keras.layers.Multiply(name = 'Mul66140', )([in0Mul66140,in1Mul66140])
Res48596 = keras.layers.Reshape((2, 1, 1), name = 'Res48596', )(Mul66140)
Dep13686 = keras.layers.DepthwiseConv2D((2, 1),strides=(1, 1), padding='valid', name = 'Dep13686', )(Res48596)
Res16120 = keras.layers.Reshape((1, 1), name = 'Res16120', )(Dep13686)
Dot48588 = keras.layers.Dot(axes=(1, 1), name = 'Dot48588', )([Con31738,Res16120])
Con66365 = keras.layers.Concatenate(axis=2, name = 'Con66365', )([Dot48588,in0Con66365])
Sub94560 = keras.layers.Subtract(name = 'Sub94560', )([Zer55392,Con66365])
model = tf.keras.models.Model(inputs=[in0Max76986,in1Max76986,in0Con39979,in0Per30699,in0Max2549,in1Max2549,in0Con31738,in0Mul66140,in1Mul66140,in0Con66365], outputs=Sub94560)
w = model.get_layer('Loc90892').get_weights() 
w[0] = np.array([[[0.481, 0.9752, 0.4916], [0.3086, 0.2795, 0.521]]])
w[1] = np.array([[0, 0, 0]])
model.get_layer('Loc90892').set_weights(w) 
w = model.get_layer('Dep13686').get_weights() 
w[0] = np.array([[[[0.1019]]], [[[0.1627]]]])
w[1] = np.array([0])
model.get_layer('Dep13686').set_weights(w) 
in0Max76986 = tf.constant([[[0.2425, 0.313]]])
in1Max76986 = tf.constant([[[0.4083, 0.656]]])
in0Con39979 = tf.constant([[[0.233, 0.4547], [0.602, 0.5857], [0.7264, 0.0144]]])
in0Per30699 = tf.constant([[[1.682, 1.6985, 1.892], [1.2215, 1.3246, 1.0717], [1.1062, 1.8574, 1.7241], [1.435, 1.4347, 1.875]]])
in0Max2549 = tf.constant([[[[0.996], [0.6112]]]])
in1Max2549 = tf.constant([[[[0.4922], [0.3466]]]])
in0Con31738 = tf.constant([[[0.635, 0.3176]]])
in0Mul66140 = tf.constant([[[0.634], [0.2325]]])
in1Mul66140 = tf.constant([[[0.1876], [0.4844]]])
in0Con66365 = tf.constant([[[0.472, 0.2029, 0.0316], [0.4651, 0.1348, 0.0806], [0.8636, 0.8886, 0.3205], [0.1877, 0.7934, 0.3432], [0.4499, 0.0558, 0.1417]]])
print (np.array2string(model.predict([in0Max76986,in1Max76986,in0Con39979,in0Per30699,in0Max2549,in1Max2549,in0Con31738,in0Mul66140,in1Mul66140,in0Con66365],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub94560.png')

LMax76986 = maximum_layer([[[[0.2425, 0.313]]], [[[0.4083, 0.656]]]], Max76986), 
LZer5052 = zero_padding1D_layer(Max76986, 2, 0, Zer5052), 
LCon39979 = concatenate_layer([Zer5052,[[[0.233, 0.4547], [0.602, 0.5857], [0.7264, 0.0144]]]], 2, Con39979), 
LPer30699 = permute_layer([[[1.682, 1.6985, 1.892], [1.2215, 1.3246, 1.0717], [1.1062, 1.8574, 1.7241], [1.435, 1.4347, 1.875]]], 2,1, Per30699), 
LMin70416 = minimum_layer([Con39979,Per30699], Min70416), 
LZer55392 = zero_padding1D_layer(Min70416, 2, 0, Zer55392), 
LMax2549 = maximum_layer([[[[[0.996], [0.6112]]]], [[[[0.4922], [0.3466]]]]], Max2549), 
LRes61005 = reshape_layer(Max2549, [1, 2], Res61005), 
LLoc90892 = locally_connected1D_layer(Res61005, 1,[[[0.481, 0.9752, 0.4916], [0.3086, 0.2795, 0.521]]],[[0, 0, 0]], 12, Loc90892), 
LCon31738 = concatenate_layer([Loc90892,[[[0.635, 0.3176]]]], 2, Con31738), 
LMul66140 = multiply_layer([[[[0.634], [0.2325]]], [[[0.1876], [0.4844]]]], Mul66140), 
LRes48596 = reshape_layer(Mul66140, [2, 1, 1], Res48596), 
LDep13686 = depthwise_conv2D_layer(Res48596, 2, 1,[[[[0.1019]]], [[[0.1627]]]],[0], 1, 1, false, Dep13686), 
LRes16120 = reshape_layer(Dep13686, [1, 1], Res16120), 
LDot48588 = dot_layer(Con31738,Res16120, 1, 1, Dot48588), 
LCon66365 = concatenate_layer([Dot48588,[[[0.472, 0.2029, 0.0316], [0.4651, 0.1348, 0.0806], [0.8636, 0.8886, 0.3205], [0.1877, 0.7934, 0.3432], [0.4499, 0.0558, 0.1417]]]], 2, Con66365), 
LSub94560 = subtract_layer(Zer55392,Con66365, Sub94560), 
exec_layers([LMax76986,LZer5052,LCon39979,LPer30699,LMin70416,LZer55392,LMax2549,LRes61005,LLoc90892,LCon31738,LMul66140,LRes48596,LDep13686,LRes16120,LDot48588,LCon66365,LSub94560],["Max76986","Zer5052","Con39979","Per30699","Min70416","Zer55392","Max2549","Res61005","Loc90892","Con31738","Mul66140","Res48596","Dep13686","Res16120","Dot48588","Con66365","Sub94560"],Sub94560,"Sub94560")

Actual (Unparsed): [[[-0.0203269, -0.4720000, -0.2029000, -0.0316000], [-0.0347705, -0.4651000, -0.1348000, -0.0806000], [-0.0246005, -0.8636000, -0.6556000, 0.1342000], [-0.0193317, -0.1877000, -0.1914000, 0.2425000], [0.3986311, 0.2061000, 0.6706000, -0.1273000]]]

Expected (Unparsed): [[[-0.02032694793782874,-0.472,-0.2029,-0.0316],[-0.034770519627143774,-0.4651,-0.1348,-0.0806],[-0.02460051124713213,-0.8636,-0.6556,0.13419999999999999],[-0.0193316765131,-0.1877,-0.19140000000000001,0.2425],[0.398631117384944,0.2061,0.6706000000000001,-0.1273]]]

Actual:   [[[-0.0203, -0.472, -0.2029, -0.0316], [-0.0347, -0.4651, -0.1348, -0.0806], [-0.0246, -0.8636, -0.6556, 0.1342], [-0.0193, -0.1877, -0.1914, 0.2425], [0.3987, 0.2061, 0.6706, -0.1273]]]

Expected: [[[-0.0203, -0.472, -0.2029, -0.0316], [-0.0347, -0.4651, -0.1348, -0.0806], [-0.0246, -0.8636, -0.6556, 0.1342], [-0.0193, -0.1877, -0.1914, 0.2425], [0.3987, 0.2061, 0.6707, -0.1273]]]