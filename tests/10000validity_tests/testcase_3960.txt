import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sof38022 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con5073 = tf.keras.layers.Input(shape=([2, 2, 3]))
in0Ave96644 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in1Ave96644 = tf.keras.layers.Input(shape=([1, 1, 1, 2]))
in0Add84548 = tf.keras.layers.Input(shape=([2, 1]))
in1Add84548 = tf.keras.layers.Input(shape=([2, 1]))
in0Con43714 = tf.keras.layers.Input(shape=([2, 7]))

Sof38022 = keras.layers.Softmax(axis=1, name = 'Sof38022', input_shape=(2, 2, 1))(in0Sof38022)
Con5073 = keras.layers.Concatenate(axis=3, name = 'Con5073', )([Sof38022,in0Con5073])
Ave96644 = keras.layers.Average(name = 'Ave96644', )([in0Ave96644,in1Ave96644])
Res32731 = keras.layers.Reshape((1, 1, 2), name = 'Res32731', )(Ave96644)
Con69559 = keras.layers.Conv2DTranspose(4, (1, 1),strides=(1, 1), padding='valid', name = 'Con69559', )(Res32731)
Zer40575 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer40575', )(Con69559)
Sub82875 = keras.layers.Subtract(name = 'Sub82875', )([Con5073,Zer40575])
Res19267 = keras.layers.Reshape((2, 8), name = 'Res19267', )(Sub82875)
Add84548 = keras.layers.Add(name = 'Add84548', )([in0Add84548,in1Add84548])
Con43714 = keras.layers.Concatenate(axis=2, name = 'Con43714', )([Add84548,in0Con43714])
Sub79478 = keras.layers.Subtract(name = 'Sub79478', )([Res19267,Con43714])
model = tf.keras.models.Model(inputs=[in0Sof38022,in0Con5073,in0Ave96644,in1Ave96644,in0Add84548,in1Add84548,in0Con43714], outputs=Sub79478)
w = model.get_layer('Con69559').get_weights() 
w[0] = np.array([[[[0.2488, 0.4988], [0.0721, 0.3664], [0.4379, 0.5377], [0.6612, 0.6197]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con69559').set_weights(w) 
in0Sof38022 = tf.constant([[[[0.7622], [0.3092]], [[1], [0.6615]]]])
in0Con5073 = tf.constant([[[[0.8442, 0.9414, 0.4078], [0.2834, 0.6299, 0.7412]], [[0.8151, 0.6144, 0.0922], [0.2479, 0.1016, 0.9247]]]])
in0Ave96644 = tf.constant([[[[[0.0785, 0.0957]]]]])
in1Ave96644 = tf.constant([[[[[0.894, 0.0572]]]]])
in0Add84548 = tf.constant([[[0.7409], [0.65]]])
in1Add84548 = tf.constant([[[0.2333], [0.5469]]])
in0Con43714 = tf.constant([[[0.5768, 0.1989, 0.7705, 0.9783, 0.2033, 0.8827, 0.2898], [0.1428, 0.7587, 0.8258, 0.0807, 0.0713, 0.5087, 0.2708]]])
print (np.array2string(model.predict([in0Sof38022,in0Con5073,in0Ave96644,in1Ave96644,in0Add84548,in1Add84548,in0Con43714],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub79478.png')

LSof38022 = softmax_layer([[[[0.7622], [0.3092]], [[1], [0.6615]]]], 1, Sof38022), 
LCon5073 = concatenate_layer([Sof38022,[[[[0.8442, 0.9414, 0.4078], [0.2834, 0.6299, 0.7412]], [[0.8151, 0.6144, 0.0922], [0.2479, 0.1016, 0.9247]]]]], 3, Con5073), 
LAve96644 = average_layer([[[[[[0.0785, 0.0957]]]]], [[[[[0.894, 0.0572]]]]]], Ave96644), 
LRes32731 = reshape_layer(Ave96644, [1, 1, 2], Res32731), 
LCon69559 = conv2D_transpose_layer(Res32731, 1, 1,[[[[0.2488, 0.4988], [0.0721, 0.3664], [0.4379, 0.5377], [0.6612, 0.6197]]]],[0, 0, 0, 0], 1, 1, false, Con69559), 
LZer40575 = zero_padding2D_layer(Con69559, 1, 0, 1, 0, Zer40575), 
LSub82875 = subtract_layer(Con5073,Zer40575, Sub82875), 
LRes19267 = reshape_layer(Sub82875, [2, 8], Res19267), 
LAdd84548 = add_layer([[[[0.7409], [0.65]]], [[[0.2333], [0.5469]]]], Add84548), 
LCon43714 = concatenate_layer([Add84548,[[[0.5768, 0.1989, 0.7705, 0.9783, 0.2033, 0.8827, 0.2898], [0.1428, 0.7587, 0.8258, 0.0807, 0.0713, 0.5087, 0.2708]]]], 2, Con43714), 
LSub79478 = subtract_layer(Res19267,Con43714, Sub79478), 
exec_layers([LSof38022,LCon5073,LAve96644,LRes32731,LCon69559,LZer40575,LSub82875,LRes19267,LAdd84548,LCon43714,LSub79478],["Sof38022","Con5073","Ave96644","Res32731","Con69559","Zer40575","Sub82875","Res19267","Add84548","Con43714","Sub79478"],Sub79478,"Sub79478")

Actual (Unparsed): [[[-0.5333714, 0.2674000, 0.7425000, -0.3627000, -0.5654752, 0.0801000, -0.2528000, 0.4514000], [-0.6377285, 0.6723000, -0.1443000, -0.7336000, 0.3473629, 0.1135301, -0.6611361, 0.2850155]]]

Expected (Unparsed): [[[-0.5333714228373888,0.26739999999999997,0.7425,-0.36269999999999997,-0.5654752115882373,0.08009999999999998,-0.2528,0.45139999999999997],[-0.6377285771626113,0.6723,-0.1443000000000001,-0.7336,0.3473629515882375,0.11353009500000003,-0.66113604,0.285015435]]]

Actual:   [[[-0.5333, 0.2674, 0.7425, -0.3627, -0.5654, 0.0801, -0.2528, 0.4514], [-0.6377, 0.6723, -0.1443, -0.7336, 0.3474, 0.1136, -0.6611, 0.2851]]]

Expected: [[[-0.5333, 0.2674, 0.7425, -0.3626, -0.5654, 0.0801, -0.2528, 0.4514], [-0.6377, 0.6723, -0.1443, -0.7336, 0.3474, 0.1136, -0.6611, 0.2851]]]