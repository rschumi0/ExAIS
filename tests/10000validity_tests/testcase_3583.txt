import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave24857 = tf.keras.layers.Input(shape=([1, 2]))
in0Con75780 = tf.keras.layers.Input(shape=([1]))
in0Dot27969 = tf.keras.layers.Input(shape=([2, 2]))
in1Dot27969 = tf.keras.layers.Input(shape=([2, 2]))
in0Con41063 = tf.keras.layers.Input(shape=([1]))
in0PRe83869 = tf.keras.layers.Input(shape=([1, 1]))
in0Ave99341 = tf.keras.layers.Input(shape=([1, 1]))
in0Con56110 = tf.keras.layers.Input(shape=([2, 1]))
in0Mul65850 = tf.keras.layers.Input(shape=([2, 2]))
in1Mul65850 = tf.keras.layers.Input(shape=([2, 2]))

Ave24857 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='same', name = 'Ave24857', )(in0Ave24857)
Bat59327 = keras.layers.BatchNormalization(axis=2, epsilon=0.801125830573133,  name = 'Bat59327', )(Ave24857)
Fla53186 = keras.layers.Flatten(name = 'Fla53186', )(Bat59327)
Con75780 = keras.layers.Concatenate(axis=1, name = 'Con75780', )([Fla53186,in0Con75780])
Dot27969 = keras.layers.Dot(axes=(2, 1), name = 'Dot27969', )([in0Dot27969,in1Dot27969])
Res83452 = keras.layers.Reshape((2, 2, 1), name = 'Res83452', )(Dot27969)
Res61071 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res61071', )(Res83452)
Cro81189 = keras.layers.Cropping3D(cropping=((1, 0), (0, 0), (0, 0)), name = 'Cro81189', )(Res61071)
Res76584 = keras.layers.Reshape((1, 2, 1), name = 'Res76584', )(Cro81189)
Res11886 = keras.layers.Reshape((1, 2), name = 'Res11886', )(Res76584)
Fla99430 = keras.layers.Flatten(name = 'Fla99430', )(Res11886)
Con41063 = keras.layers.Concatenate(axis=1, name = 'Con41063', )([Fla99430,in0Con41063])
PRe83869 = keras.layers.PReLU(name = 'PRe83869', input_shape=(1, 1))(in0PRe83869)
Ave99341 = keras.layers.AveragePooling1D(pool_size=(1), strides=(3), padding='valid', name = 'Ave99341', )(in0Ave99341)
Add71971 = keras.layers.Add(name = 'Add71971', )([PRe83869,Ave99341])
Zer90455 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer90455', )(Add71971)
Con56110 = keras.layers.Concatenate(axis=2, name = 'Con56110', )([Zer90455,in0Con56110])
Mul65850 = keras.layers.Multiply(name = 'Mul65850', )([in0Mul65850,in1Mul65850])
Mul86046 = keras.layers.Multiply(name = 'Mul86046', )([Con56110,Mul65850])
Sim26859 = keras.layers.SimpleRNN(3,name = 'Sim26859', )(Mul86046)
Mul33476 = keras.layers.Multiply(name = 'Mul33476', )([Con41063,Sim26859])
Mul51906 = keras.layers.Multiply(name = 'Mul51906', )([Con75780,Mul33476])
model = tf.keras.models.Model(inputs=[in0Ave24857,in0Con75780,in0Dot27969,in1Dot27969,in0Con41063,in0PRe83869,in0Ave99341,in0Con56110,in0Mul65850,in1Mul65850], outputs=Mul51906)
w = model.get_layer('Bat59327').get_weights() 
w[0] = np.array([0.4337, 0.6884])
w[1] = np.array([0.5093, 0.3572])
w[2] = np.array([0.4685, 0.7578])
w[3] = np.array([0.9117, 0.1799])
model.get_layer('Bat59327').set_weights(w) 
w = model.get_layer('PRe83869').get_weights() 
w[0] = np.array([[0.2892]])
model.get_layer('PRe83869').set_weights(w) 
w = model.get_layer('Sim26859').get_weights() 
w[0] = np.array([[4, 6, 3], [1, 4, 1]])
w[1] = np.array([[3, 10, 10], [2, 3, 6], [8, 10, 8]])
w[2] = np.array([5, 5, 7])
model.get_layer('Sim26859').set_weights(w) 
in0Ave24857 = tf.constant([[[1.8022, 1.8968]]])
in0Con75780 = tf.constant([[0.6987]])
in0Dot27969 = tf.constant([[[0.389, 0.0243], [0.7993, 0.1932]]])
in1Dot27969 = tf.constant([[[0.5468, 0.1834], [0.685, 0.2756]]])
in0Con41063 = tf.constant([[0.3698]])
in0PRe83869 = tf.constant([[[0.6033]]])
in0Ave99341 = tf.constant([[[1.892]]])
in0Con56110 = tf.constant([[[0.3075], [0.6592]]])
in0Mul65850 = tf.constant([[[0.6202, 0.8409], [0.3129, 0.0117]]])
in1Mul65850 = tf.constant([[[0.3155, 0.4087], [0.5901, 0.3282]]])
print (np.array2string(model.predict([in0Ave24857,in0Con75780,in0Dot27969,in1Dot27969,in0Con41063,in0PRe83869,in0Ave99341,in0Con56110,in0Mul65850,in1Mul65850],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul51906.png')

LAve24857 = average_pooling1D_layer([[[1.8022, 1.8968]]], 1, 1, true, Ave24857), 
LBat59327 = batch_normalization_layer(Ave24857, 2, 0.801125830573133, [0.4337, 0.6884], [0.5093, 0.3572], [0.4685, 0.7578], [0.9117, 0.1799], Bat59327), 
LFla53186 = flatten_layer(Bat59327, Fla53186), 
LCon75780 = concatenate_layer([Fla53186,[[0.6987]]], 1, Con75780), 
LDot27969 = dot_layer([[[0.389, 0.0243], [0.7993, 0.1932]]], [[[0.5468, 0.1834], [0.685, 0.2756]]], 2, 1, Dot27969), 
LRes83452 = reshape_layer(Dot27969, [2, 2, 1], Res83452), 
LRes61071 = reshape_layer(Res83452, [2, 2, 1, 1], Res61071), 
LCro81189 = cropping3D_layer(Res61071, 1, 0, 0, 0, 0, 0, Cro81189), 
LRes76584 = reshape_layer(Cro81189, [1, 2, 1], Res76584), 
LRes11886 = reshape_layer(Res76584, [1, 2], Res11886), 
LFla99430 = flatten_layer(Res11886, Fla99430), 
LCon41063 = concatenate_layer([Fla99430,[[0.3698]]], 1, Con41063), 
LPRe83869 = prelu_layer([[[0.6033]]], [[0.2892]], PRe83869), 
LAve99341 = average_pooling1D_layer([[[1.892]]], 1, 3, false, Ave99341), 
LAdd71971 = add_layer([PRe83869,Ave99341], Add71971), 
LZer90455 = zero_padding1D_layer(Add71971, 1, 0, Zer90455), 
LCon56110 = concatenate_layer([Zer90455,[[[0.3075], [0.6592]]]], 2, Con56110), 
LMul65850 = multiply_layer([[[[0.6202, 0.8409], [0.3129, 0.0117]]], [[[0.3155, 0.4087], [0.5901, 0.3282]]]], Mul65850), 
LMul86046 = multiply_layer([Con56110,Mul65850], Mul86046), 
LSim26859 = simple_rnn_layer(Mul86046,[[4, 6, 3], [1, 4, 1]],[[3, 10, 10], [2, 3, 6], [8, 10, 8]],[5, 5, 7], Sim26859), 
LMul33476 = multiply_layer([Con41063,Sim26859], Mul33476), 
LMul51906 = multiply_layer([Con75780,Mul33476], Mul51906), 
exec_layers([LAve24857,LBat59327,LFla53186,LCon75780,LDot27969,LRes83452,LRes61071,LCro81189,LRes76584,LRes11886,LFla99430,LCon41063,LPRe83869,LAve99341,LAdd71971,LZer90455,LCon56110,LMul65850,LMul86046,LSim26859,LMul33476,LMul51906],["Ave24857","Bat59327","Fla53186","Con75780","Dot27969","Res83452","Res61071","Cro81189","Res76584","Res11886","Fla99430","Con41063","PRe83869","Ave99341","Add71971","Zer90455","Con56110","Mul65850","Mul86046","Sim26859","Mul33476","Mul51906"],Mul51906,"Mul51906")

Actual (Unparsed): [[0.5416514, 0.2295801, 0.2583793]]

Expected (Unparsed): [[0.541651360460324,0.2295801334497207,0.25837926]]

Actual:   [[0.5417, 0.2296, 0.2584]]

Expected: [[0.5417, 0.2296, 0.2584]]