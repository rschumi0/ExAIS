import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Up_37135 = tf.keras.layers.Input(shape=([4, 2, 1, 4]))

Up_37135 = keras.layers.UpSampling3D(size=(2, 1, 2), name = 'Up_37135', )(in0Up_37135)
Res31613 = keras.layers.Reshape((8, 2, 8), name = 'Res31613', )(Up_37135)
Res7712 = keras.layers.Reshape((8, 16), name = 'Res7712', )(Res31613)
LST49036 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST49036', )(Res7712)
model = tf.keras.models.Model(inputs=[in0Up_37135], outputs=LST49036)
w = model.get_layer('LST49036').get_weights() 
w[0] = np.array([[8, 10, 9, 3], [1, 6, 7, 5], [6, 4, 2, 5], [5, 8, 8, 2], [7, 8, 10, 1], [5, 10, 6, 4], [9, 7, 10, 10], [4, 7, 5, 3], [7, 10, 8, 5], [2, 1, 5, 3], [7, 4, 3, 2], [2, 6, 10, 2], [1, 9, 2, 3], [5, 6, 9, 3], [8, 9, 4, 2], [4, 6, 5, 7]])
w[1] = np.array([[4, 3, 5, 2]])
w[2] = np.array([2, 4, 7, 2])
model.get_layer('LST49036').set_weights(w) 
in0Up_37135 = tf.constant([[[[[1.7101, 1.7606, 1.737, 1.8821]], [[1.553, 1.918, 1.7209, 1.94]]], [[[1.2781, 1.0427, 1.9093, 1.0673]], [[1.3002, 1.1464, 1.2365, 1.2341]]], [[[1.3086, 1.0848, 1.211, 1.3032]], [[1.6072, 1.5861, 1.5975, 1.9129]]], [[[1.6695, 1.5929, 1.008, 1.9571]], [[1.5405, 1.3745, 1.6376, 1.7881]]]]])
print (np.array2string(model.predict([in0Up_37135],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='LST49036.png')

LUp_37135 = up_sampling3D_layer([[[[[1.7101, 1.7606, 1.737, 1.8821]], [[1.553, 1.918, 1.7209, 1.94]]], [[[1.2781, 1.0427, 1.9093, 1.0673]], [[1.3002, 1.1464, 1.2365, 1.2341]]], [[[1.3086, 1.0848, 1.211, 1.3032]], [[1.6072, 1.5861, 1.5975, 1.9129]]], [[[1.6695, 1.5929, 1.008, 1.9571]], [[1.5405, 1.3745, 1.6376, 1.7881]]]]], 2, 1, 2, Up_37135), 
LRes31613 = reshape_layer(Up_37135, [8, 2, 8], Res31613), 
LRes7712 = reshape_layer(Res31613, [8, 16], Res7712), 
LLST49036 = lstm_layer(Res7712,[[8, 10, 9, 3], [1, 6, 7, 5], [6, 4, 2, 5], [5, 8, 8, 2], [7, 8, 10, 1], [5, 10, 6, 4], [9, 7, 10, 10], [4, 7, 5, 3], [7, 10, 8, 5], [2, 1, 5, 3], [7, 4, 3, 2], [2, 6, 10, 2], [1, 9, 2, 3], [5, 6, 9, 3], [8, 9, 4, 2], [4, 6, 5, 7]],[[4, 3, 5, 2]],[2, 4, 7, 2], LST49036), 
exec_layers([LUp_37135,LRes31613,LRes7712,LLST49036],["Up_37135","Res31613","Res7712","LST49036"],LST49036,"LST49036")

Actual (Unparsed): [[0.9999998]]

Expected (Unparsed): [[0.9999997749296758]]

Actual:   [[1]]

Expected: [[1]]