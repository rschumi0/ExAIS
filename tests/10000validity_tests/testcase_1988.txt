import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max12398 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Max12398 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in0Con54584 = tf.keras.layers.Input(shape=([3, 3, 1, 2]))
in0GRU94414 = tf.keras.layers.Input(shape=([1, 3]))
in0Con4955 = tf.keras.layers.Input(shape=([3, 3, 1, 3]))
in0Cro22220 = tf.keras.layers.Input(shape=([4, 4, 1, 4]))

Max12398 = keras.layers.Maximum(name = 'Max12398', )([in0Max12398,in1Max12398])
Zer20736 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (0, 0)), name = 'Zer20736', )(Max12398)
Con54584 = keras.layers.Concatenate(axis=4, name = 'Con54584', )([Zer20736,in0Con54584])
GRU94414 = keras.layers.GRU(3,reset_after=True, recurrent_activation='sigmoid', name = 'GRU94414', )(in0GRU94414)
Res37494 = keras.layers.Reshape((3, 1), name = 'Res37494', )(GRU94414)
Res58087 = keras.layers.Reshape((3, 1, 1), name = 'Res58087', )(Res37494)
Res69988 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res69988', )(Res58087)
Zer17525 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer17525', )(Res69988)
Con4955 = keras.layers.Concatenate(axis=4, name = 'Con4955', )([Zer17525,in0Con4955])
Cro22220 = keras.layers.Cropping3D(cropping=((3, 0), (2, 0), (0, 0)), name = 'Cro22220', )(in0Cro22220)
Lay79977 = keras.layers.LayerNormalization(axis=1, epsilon=1.4692968431545896, name = 'Lay79977', )(Cro22220)
Zer66819 = keras.layers.ZeroPadding3D(padding=((2, 0), (1, 0), (0, 0)), name = 'Zer66819', )(Lay79977)
Max68923 = keras.layers.Maximum(name = 'Max68923', )([Con4955,Zer66819])
Thr58597 = keras.layers.ThresholdedReLU(theta=7.1276660322737255, name = 'Thr58597', )(Max68923)
Max54341 = keras.layers.Maximum(name = 'Max54341', )([Con54584,Thr58597])
model = tf.keras.models.Model(inputs=[in0Max12398,in1Max12398,in0Con54584,in0GRU94414,in0Con4955,in0Cro22220], outputs=Max54341)
w = model.get_layer('GRU94414').get_weights() 
w[0] = np.array([[1, 1, 6, 5, 5, 9, 9, 9, 6], [10, 8, 1, 2, 9, 5, 6, 8, 9], [4, 3, 1, 4, 7, 8, 3, 6, 3]])
w[1] = np.array([[3, 5, 3, 1, 7, 4, 7, 8, 4], [3, 1, 10, 9, 10, 6, 2, 10, 7], [4, 8, 9, 6, 10, 2, 9, 5, 2]])
w[2] = np.array([[1, 7, 9, 7, 3, 9, 8, 4, 5], [4, 6, 3, 2, 7, 1, 8, 7, 8]])
model.get_layer('GRU94414').set_weights(w) 
in0Max12398 = tf.constant([[[[[0.0565, 0.7324]], [[0.9358, 0.8594]]], [[[0.8182, 0.7807]], [[0.1353, 0.0338]]]]])
in1Max12398 = tf.constant([[[[[0.3623, 0.971]], [[0.2483, 0.1639]]], [[[0.9519, 0.3863]], [[0.959, 0.3457]]]]])
in0Con54584 = tf.constant([[[[[0.0384, 0.352]], [[0.2435, 0.3738]], [[0.9002, 0.8661]]], [[[0.4578, 0.4664]], [[0.4524, 0.8554]], [[0.7751, 0.3429]]], [[[0.6485, 0.6873]], [[0.9375, 0.957]], [[0.3329, 0.9493]]]]])
in0GRU94414 = tf.constant([[[10, 9, 7]]])
in0Con4955 = tf.constant([[[[[0.5057, 0.3018, 0.8454]], [[0.0536, 0.3291, 0.5854]], [[0.7891, 0.704, 0.7975]]], [[[0.3075, 0.4931, 0.0287]], [[0.5286, 0.3817, 0.7933]], [[0.0581, 0.4774, 0.5825]]], [[[0.7704, 0.6142, 0.0215]], [[0.095, 0.7471, 0.3984]], [[0.2163, 0.9963, 0.9943]]]]])
in0Cro22220 = tf.constant([[[[[1.0108, 1.1536, 1.1655, 1.1839]], [[1.5625, 1.8653, 1.3644, 1.3143]], [[1.3681, 1.6816, 1.7837, 1.8233]], [[1.1448, 1.6472, 1.9388, 1.099]]], [[[1.6025, 1.2374, 1.9115, 1.3957]], [[1.6462, 1.8138, 1.9698, 1.3332]], [[1.7507, 1.2111, 1.2378, 1.9677]], [[1.0082, 1.52, 1.9881, 1.9786]]], [[[1.9671, 1.1252, 1.3201, 1.2112]], [[1.3981, 1.7145, 1.0873, 1.6782]], [[1.5546, 1.281, 1.9415, 1.1282]], [[1.3217, 1.1082, 1.2719, 1.4652]]], [[[1.8923, 1.3504, 1.6358, 1.6235]], [[1.2527, 1.0964, 1.9999, 1.9854]], [[1.81, 1.743, 1.7429, 1.069]], [[1.9542, 1.0916, 1.9043, 1.0023]]]]])
print (np.array2string(model.predict([in0Max12398,in1Max12398,in0Con54584,in0GRU94414,in0Con4955,in0Cro22220],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max54341.png')

LMax12398 = maximum_layer([[[[[[0.0565, 0.7324]], [[0.9358, 0.8594]]], [[[0.8182, 0.7807]], [[0.1353, 0.0338]]]]], [[[[[0.3623, 0.971]], [[0.2483, 0.1639]]], [[[0.9519, 0.3863]], [[0.959, 0.3457]]]]]], Max12398), 
LZer20736 = zero_padding3D_layer(Max12398, 1, 0, 1, 0, 0, 0, Zer20736), 
LCon54584 = concatenate_layer([Zer20736,[[[[[0.0384, 0.352]], [[0.2435, 0.3738]], [[0.9002, 0.8661]]], [[[0.4578, 0.4664]], [[0.4524, 0.8554]], [[0.7751, 0.3429]]], [[[0.6485, 0.6873]], [[0.9375, 0.957]], [[0.3329, 0.9493]]]]]], 4, Con54584), 
LGRU94414 = gru_layer([[[10, 9, 7]]],[[1, 1, 6, 5, 5, 9, 9, 9, 6], [10, 8, 1, 2, 9, 5, 6, 8, 9], [4, 3, 1, 4, 7, 8, 3, 6, 3]],[[3, 5, 3, 1, 7, 4, 7, 8, 4], [3, 1, 10, 9, 10, 6, 2, 10, 7], [4, 8, 9, 6, 10, 2, 9, 5, 2]],[[1, 7, 9, 7, 3, 9, 8, 4, 5], [4, 6, 3, 2, 7, 1, 8, 7, 8]], true, GRU94414), 
LRes37494 = reshape_layer(GRU94414, [3, 1], Res37494), 
LRes58087 = reshape_layer(Res37494, [3, 1, 1], Res58087), 
LRes69988 = reshape_layer(Res58087, [3, 1, 1, 1], Res69988), 
LZer17525 = zero_padding3D_layer(Res69988, 0, 0, 2, 0, 0, 0, Zer17525), 
LCon4955 = concatenate_layer([Zer17525,[[[[[0.5057, 0.3018, 0.8454]], [[0.0536, 0.3291, 0.5854]], [[0.7891, 0.704, 0.7975]]], [[[0.3075, 0.4931, 0.0287]], [[0.5286, 0.3817, 0.7933]], [[0.0581, 0.4774, 0.5825]]], [[[0.7704, 0.6142, 0.0215]], [[0.095, 0.7471, 0.3984]], [[0.2163, 0.9963, 0.9943]]]]]], 4, Con4955), 
LCro22220 = cropping3D_layer([[[[[1.0108, 1.1536, 1.1655, 1.1839]], [[1.5625, 1.8653, 1.3644, 1.3143]], [[1.3681, 1.6816, 1.7837, 1.8233]], [[1.1448, 1.6472, 1.9388, 1.099]]], [[[1.6025, 1.2374, 1.9115, 1.3957]], [[1.6462, 1.8138, 1.9698, 1.3332]], [[1.7507, 1.2111, 1.2378, 1.9677]], [[1.0082, 1.52, 1.9881, 1.9786]]], [[[1.9671, 1.1252, 1.3201, 1.2112]], [[1.3981, 1.7145, 1.0873, 1.6782]], [[1.5546, 1.281, 1.9415, 1.1282]], [[1.3217, 1.1082, 1.2719, 1.4652]]], [[[1.8923, 1.3504, 1.6358, 1.6235]], [[1.2527, 1.0964, 1.9999, 1.9854]], [[1.81, 1.743, 1.7429, 1.069]], [[1.9542, 1.0916, 1.9043, 1.0023]]]]], 3, 0, 2, 0, 0, 0, Cro22220), 
LLay79977 = layer_normalization_layer(Cro22220, 1, 1.4692968431545896, Lay79977), 
LZer66819 = zero_padding3D_layer(Lay79977, 2, 0, 1, 0, 0, 0, Zer66819), 
LMax68923 = maximum_layer([Con4955,Zer66819], Max68923), 
LThr58597 = thresholded_relu_layer(Max68923, 7.1276660322737255, Thr58597), 
LMax54341 = maximum_layer([Con54584,Thr58597], Max54341), 
exec_layers([LMax12398,LZer20736,LCon54584,LGRU94414,LRes37494,LRes58087,LRes69988,LZer17525,LCon4955,LCro22220,LLay79977,LZer66819,LMax68923,LThr58597,LMax54341],["Max12398","Zer20736","Con54584","GRU94414","Res37494","Res58087","Res69988","Zer17525","Con4955","Cro22220","Lay79977","Zer66819","Max68923","Thr58597","Max54341"],Max54341,"Max54341")

Actual (Unparsed): [[[[[0.0000000, 0.0000000, 0.0384000, 0.3520000]], [[0.0000000, 0.0000000, 0.2435000, 0.3738000]], [[0.0000000, 0.0000000, 0.9002000, 0.8661000]]], [[[0.0000000, 0.0000000, 0.4578000, 0.4664000]], [[0.3623000, 0.9710000, 0.4524000, 0.8554000]], [[0.9358000, 0.8594000, 0.7751000, 0.3429000]]], [[[0.0000000, 0.0000000, 0.6485000, 0.6873000]], [[0.9519000, 0.7807000, 0.9375000, 0.9570000]], [[0.9590000, 0.3457000, 0.3329000, 0.9493000]]]]]

Expected (Unparsed): [[[[[0,0,0.0384,0.352]],[[0,0,0.2435,0.3738]],[[0,0,0.9002,0.8661]]],[[[0,0,0.4578,0.4664]],[[0.3623,0.971,0.4524,0.8554]],[[0.9358,0.8594,0.7751,0.3429]]],[[[0,0,0.6485,0.6873]],[[0.9519,0.7807,0.9375,0.957]],[[0.959,0.3457,0.3329,0.9493]]]]]

Actual:   [[[[[0, 0, 0.0384, 0.352]], [[0, 0, 0.2435, 0.3738]], [[0, 0, 0.9002, 0.8661]]], [[[0, 0, 0.4578, 0.4664]], [[0.3623, 0.971, 0.4524, 0.8554]], [[0.9358, 0.8594, 0.7751, 0.3429]]], [[[0, 0, 0.6485, 0.6873]], [[0.9519, 0.7807, 0.9375, 0.957]], [[0.959, 0.3457, 0.3329, 0.9493]]]]]

Expected: [[[[[0, 0, 0.0384, 0.352]], [[0, 0, 0.2435, 0.3738]], [[0, 0, 0.9002, 0.8661]]], [[[0, 0, 0.4578, 0.4664]], [[0.3623, 0.971, 0.4524, 0.8554]], [[0.9358, 0.8594, 0.7751, 0.3429]]], [[[0, 0, 0.6485, 0.6873]], [[0.9519, 0.7807, 0.9375, 0.957]], [[0.959, 0.3457, 0.3329, 0.9493]]]]]