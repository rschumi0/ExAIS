import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0GRU46801 = tf.keras.layers.Input(shape=([1, 1]))
in0Con86735 = tf.keras.layers.Input(shape=([3, 3, 1, 1]))
in0Max12576 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in1Max12576 = tf.keras.layers.Input(shape=([2, 1, 1, 2]))
in0Add99928 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in1Add99928 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))
in0Con350 = tf.keras.layers.Input(shape=([2, 2, 1, 1]))

GRU46801 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU46801', )(in0GRU46801)
Res77895 = keras.layers.Reshape((3, 1), name = 'Res77895', )(GRU46801)
Res91525 = keras.layers.Reshape((3, 1, 1), name = 'Res91525', )(Res77895)
Res22232 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res22232', )(Res91525)
Zer17967 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer17967', )(Res22232)
Con86735 = keras.layers.Concatenate(axis=4, name = 'Con86735', )([Zer17967,in0Con86735])
Max12576 = keras.layers.Maximum(name = 'Max12576', )([in0Max12576,in1Max12576])
Zer28483 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (0, 0)), name = 'Zer28483', )(Max12576)
Add99928 = keras.layers.Add(name = 'Add99928', )([in0Add99928,in1Add99928])
Con350 = keras.layers.Concatenate(axis=4, name = 'Con350', )([Add99928,in0Con350])
Mul66928 = keras.layers.Multiply(name = 'Mul66928', )([Zer28483,Con350])
Zer55887 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (0, 0)), name = 'Zer55887', )(Mul66928)
Ave69576 = keras.layers.Average(name = 'Ave69576', )([Con86735,Zer55887])
Res95939 = keras.layers.Reshape((3, 3, 2), name = 'Res95939', )(Ave69576)
Res51227 = keras.layers.Reshape((3, 6), name = 'Res51227', )(Res95939)
Ave62267 = keras.layers.AveragePooling1D(pool_size=(2), name = 'Ave62267', )(Res51227)
model = tf.keras.models.Model(inputs=[in0GRU46801,in0Con86735,in0Max12576,in1Max12576,in0Add99928,in1Add99928,in0Con350], outputs=Ave62267)
w = model.get_layer('GRU46801').get_weights() 
w[0] = np.array([[10, 8, 4, 8, 6, 2, 7, 9, 9]])
w[1] = np.array([[9, 6, 7, 10, 3, 1, 4, 3, 1], [1, 1, 3, 9, 3, 6, 5, 10, 5], [6, 3, 1, 7, 4, 6, 7, 6, 8]])
w[2] = np.array([3, 5, 1, 4, 10, 5, 6, 9, 1])
model.get_layer('GRU46801').set_weights(w) 
in0GRU46801 = tf.constant([[[5]]])
in0Con86735 = tf.constant([[[[[0.3098]], [[0.8001]], [[0.0411]]], [[[0.7267]], [[0.619]], [[0.3906]]], [[[0.6909]], [[0.5185]], [[0.3536]]]]])
in0Max12576 = tf.constant([[[[[0.8827, 0.9842]]], [[[0.0272, 0.1694]]]]])
in1Max12576 = tf.constant([[[[[0.6897, 0.9883]]], [[[0.057, 0.3256]]]]])
in0Add99928 = tf.constant([[[[[0.8356]], [[0.4591]]], [[[0.0202]], [[0.2141]]]]])
in1Add99928 = tf.constant([[[[[0.6756]], [[0.5611]]], [[[0.6057]], [[0.5925]]]]])
in0Con350 = tf.constant([[[[[0.4953]], [[0.2976]]], [[[0.3903]], [[0.1682]]]]])
print (np.array2string(model.predict([in0GRU46801,in0Con86735,in0Max12576,in1Max12576,in0Add99928,in1Add99928,in0Con350],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave62267.png')

LGRU46801 = gru_layer([[[5]]],[[10, 8, 4, 8, 6, 2, 7, 9, 9]],[[9, 6, 7, 10, 3, 1, 4, 3, 1], [1, 1, 3, 9, 3, 6, 5, 10, 5], [6, 3, 1, 7, 4, 6, 7, 6, 8]],[3, 5, 1, 4, 10, 5, 6, 9, 1], false, GRU46801), 
LRes77895 = reshape_layer(GRU46801, [3, 1], Res77895), 
LRes91525 = reshape_layer(Res77895, [3, 1, 1], Res91525), 
LRes22232 = reshape_layer(Res91525, [3, 1, 1, 1], Res22232), 
LZer17967 = zero_padding3D_layer(Res22232, 0, 0, 2, 0, 0, 0, Zer17967), 
LCon86735 = concatenate_layer([Zer17967,[[[[[0.3098]], [[0.8001]], [[0.0411]]], [[[0.7267]], [[0.619]], [[0.3906]]], [[[0.6909]], [[0.5185]], [[0.3536]]]]]], 4, Con86735), 
LMax12576 = maximum_layer([[[[[[0.8827, 0.9842]]], [[[0.0272, 0.1694]]]]], [[[[[0.6897, 0.9883]]], [[[0.057, 0.3256]]]]]], Max12576), 
LZer28483 = zero_padding3D_layer(Max12576, 0, 0, 1, 0, 0, 0, Zer28483), 
LAdd99928 = add_layer([[[[[[0.8356]], [[0.4591]]], [[[0.0202]], [[0.2141]]]]], [[[[[0.6756]], [[0.5611]]], [[[0.6057]], [[0.5925]]]]]], Add99928), 
LCon350 = concatenate_layer([Add99928,[[[[[0.4953]], [[0.2976]]], [[[0.3903]], [[0.1682]]]]]], 4, Con350), 
LMul66928 = multiply_layer([Zer28483,Con350], Mul66928), 
LZer55887 = zero_padding3D_layer(Mul66928, 1, 0, 1, 0, 0, 0, Zer55887), 
LAve69576 = average_layer([Con86735,Zer55887], Ave69576), 
LRes95939 = reshape_layer(Ave69576, [3, 3, 2], Res95939), 
LRes51227 = reshape_layer(Res95939, [3, 6], Res51227), 
LAve62267 = average_pooling1D_layer(Res51227, 2, Ave62267), 
exec_layers([LGRU46801,LRes77895,LRes91525,LRes22232,LZer17967,LCon86735,LMax12576,LZer28483,LAdd99928,LCon350,LMul66928,LZer55887,LAve69576,LRes95939,LRes51227,LAve62267],["GRU46801","Res77895","Res91525","Res22232","Zer17967","Con86735","Max12576","Zer28483","Add99928","Con350","Mul66928","Zer55887","Ave69576","Res95939","Res51227","Ave62267"],Ave62267,"Ave62267")

Actual (Unparsed): [[[0.0000000, 0.2591250, 0.0000000, 0.3547750, 0.2251326, 0.1814545]]]

Expected (Unparsed): [[[0,0.259125,0.0,0.354775,0.225132635,0.18145451999999998]]]

Actual:   [[[0, 0.2592, 0, 0.3548, 0.2252, 0.1815]]]

Expected: [[[0, 0.2592, 0, 0.3548, 0.2252, 0.1815]]]