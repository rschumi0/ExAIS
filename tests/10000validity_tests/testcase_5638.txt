import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave69897 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Ave69897 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con43012 = tf.keras.layers.Input(shape=([2, 1, 3]))
in0Max47511 = tf.keras.layers.Input(shape=([1, 1]))
in1Max47511 = tf.keras.layers.Input(shape=([1, 1]))

Ave69897 = keras.layers.Average(name = 'Ave69897', )([in0Ave69897,in1Ave69897])
Zer11479 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer11479', )(Ave69897)
Glo40823 = keras.layers.GlobalMaxPool2D(name = 'Glo40823', )(Zer11479)
Res65195 = keras.layers.Reshape((2, 1), name = 'Res65195', )(Glo40823)
Res35462 = keras.layers.Reshape((2, 1, 1), name = 'Res35462', )(Res65195)
Con43012 = keras.layers.Concatenate(axis=3, name = 'Con43012', )([Res35462,in0Con43012])
Max47511 = keras.layers.Maximum(name = 'Max47511', )([in0Max47511,in1Max47511])
Res83570 = keras.layers.Reshape((1, 1, 1), name = 'Res83570', )(Max47511)
Con17058 = keras.layers.Conv2D(4, (1, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con17058', )(Res83570)
Cro26091 = keras.layers.Cropping2D(cropping=((0, 0), (0, 0)), name = 'Cro26091', )(Con17058)
Zer8775 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer8775', )(Cro26091)
Sub73770 = keras.layers.Subtract(name = 'Sub73770', )([Con43012,Zer8775])
model = tf.keras.models.Model(inputs=[in0Ave69897,in1Ave69897,in0Con43012,in0Max47511,in1Max47511], outputs=Sub73770)
w = model.get_layer('Con17058').get_weights() 
w[0] = np.array([[[[0.8332, 0.6631, 0.0186, 0.0438]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con17058').set_weights(w) 
in0Ave69897 = tf.constant([[[[0.2208, 0.8205]]]])
in1Ave69897 = tf.constant([[[[0.0458, 0.6089]]]])
in0Con43012 = tf.constant([[[[0.9712, 0.7953, 0.9617]], [[0.0358, 0.6621, 0.791]]]])
in0Max47511 = tf.constant([[[0.7011]]])
in1Max47511 = tf.constant([[[0.747]]])
print (np.array2string(model.predict([in0Ave69897,in1Ave69897,in0Con43012,in0Max47511,in1Max47511],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub73770.png')

LAve69897 = average_layer([[[[[0.2208, 0.8205]]]], [[[[0.0458, 0.6089]]]]], Ave69897), 
LZer11479 = zero_padding2D_layer(Ave69897, 1, 1, 1, 1, Zer11479), 
LGlo40823 = global_max_pool2D_layer(Zer11479, Glo40823), 
LRes65195 = reshape_layer(Glo40823, [2, 1], Res65195), 
LRes35462 = reshape_layer(Res65195, [2, 1, 1], Res35462), 
LCon43012 = concatenate_layer([Res35462,[[[[0.9712, 0.7953, 0.9617]], [[0.0358, 0.6621, 0.791]]]]], 3, Con43012), 
LMax47511 = maximum_layer([[[[0.7011]]], [[[0.747]]]], Max47511), 
LRes83570 = reshape_layer(Max47511, [1, 1, 1], Res83570), 
LCon17058 = conv2D_layer(Res83570, 1, 1,[[[[0.8332, 0.6631, 0.0186, 0.0438]]]],[0, 0, 0, 0], 1, 1, true, 1, 1, Con17058), 
LCro26091 = cropping2D_layer(Con17058, 0, 0, 0, 0, Cro26091), 
LZer8775 = zero_padding2D_layer(Cro26091, 1, 0, 0, 0, Zer8775), 
LSub73770 = subtract_layer(Con43012,Zer8775, Sub73770), 
exec_layers([LAve69897,LZer11479,LGlo40823,LRes65195,LRes35462,LCon43012,LMax47511,LRes83570,LCon17058,LCro26091,LZer8775,LSub73770],["Ave69897","Zer11479","Glo40823","Res65195","Res35462","Con43012","Max47511","Res83570","Con17058","Cro26091","Zer8775","Sub73770"],Sub73770,"Sub73770")

Actual (Unparsed): [[[[0.1333000, 0.9712000, 0.7953000, 0.9617000]], [[0.0922996, -0.4595357, 0.6482058, 0.7582814]]]]

Expected (Unparsed): [[[[0.1333,0.9712,0.7953,0.9617]],[[0.09229959999999993,-0.4595357,0.6482058,0.7582814]]]]

Actual:   [[[[0.1333, 0.9712, 0.7953, 0.9617]], [[0.0923, -0.4595, 0.6483, 0.7583]]]]

Expected: [[[[0.1333, 0.9712, 0.7953, 0.9617]], [[0.0923, -0.4595, 0.6483, 0.7583]]]]