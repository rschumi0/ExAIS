import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub15449 = tf.keras.layers.Input(shape=([2, 3, 3, 3]))
in1Sub15449 = tf.keras.layers.Input(shape=([2, 3, 3, 3]))
in0ELU21333 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con86944 = tf.keras.layers.Input(shape=([3, 1, 3, 1]))
in0Add31342 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in1Add31342 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in0Con72558 = tf.keras.layers.Input(shape=([52]))

Sub15449 = keras.layers.Subtract(name = 'Sub15449', )([in0Sub15449,in1Sub15449])
Res89378 = keras.layers.Reshape((2, 3, 9), name = 'Res89378', )(Sub15449)
Res39550 = keras.layers.Reshape((2, 27), name = 'Res39550', )(Res89378)
Fla28926 = keras.layers.Flatten(name = 'Fla28926', )(Res39550)
ELU21333 = keras.layers.ELU(alpha=-1.1133236655360292, name = 'ELU21333', input_shape=(1, 1, 1))(in0ELU21333)
Res17075 = keras.layers.Reshape((1, 1), name = 'Res17075', )(ELU21333)
Zer59613 = keras.layers.ZeroPadding1D(padding=((1, 1)), name = 'Zer59613', )(Res17075)
Res84289 = keras.layers.Reshape((3, 1, 1), name = 'Res84289', )(Zer59613)
Res37569 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res37569', )(Res84289)
Zer10748 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer10748', )(Res37569)
Con86944 = keras.layers.Concatenate(axis=4, name = 'Con86944', )([Zer10748,in0Con86944])
Add31342 = keras.layers.Add(name = 'Add31342', )([in0Add31342,in1Add31342])
Zer52874 = keras.layers.ZeroPadding3D(padding=((1, 0), (0, 0), (1, 0)), name = 'Zer52874', )(Add31342)
Sub26147 = keras.layers.Subtract(name = 'Sub26147', )([Con86944,Zer52874])
Res33221 = keras.layers.Reshape((3, 1, 6), name = 'Res33221', )(Sub26147)
Res50124 = keras.layers.Reshape((3, 6), name = 'Res50124', )(Res33221)
Sim14559 = keras.layers.SimpleRNN(2,name = 'Sim14559', )(Res50124)
Con72558 = keras.layers.Concatenate(axis=1, name = 'Con72558', )([Sim14559,in0Con72558])
Mul81230 = keras.layers.Multiply(name = 'Mul81230', )([Fla28926,Con72558])
model = tf.keras.models.Model(inputs=[in0Sub15449,in1Sub15449,in0ELU21333,in0Con86944,in0Add31342,in1Add31342,in0Con72558], outputs=Mul81230)
w = model.get_layer('Sim14559').get_weights() 
w[0] = np.array([[5, 9], [1, 3], [8, 9], [3, 1], [5, 2], [5, 8]])
w[1] = np.array([[3, 10], [2, 3]])
w[2] = np.array([7, 2])
model.get_layer('Sim14559').set_weights(w) 
in0Sub15449 = tf.constant([[[[[0.1574, 0.029, 0.1933], [0.1898, 0.1902, 0.8196], [0.5617, 0.3762, 0.671]], [[0.3995, 0.1791, 0.8514], [0.9262, 0.3324, 0.1013], [0.0423, 0.1609, 0.5336]], [[0.9675, 0.2804, 0.5648], [0.1059, 0.617, 0.0797], [0.869, 0.5369, 0.6552]]], [[[0.0205, 0.9668, 0.8058], [0.3986, 0.0176, 0.3254], [0.4449, 0.3227, 0.9499]], [[0.4334, 0.7552, 0.7356], [0.9836, 0.4606, 0.1816], [0.9027, 0.4368, 0.6351]], [[0.3245, 0.2623, 0.7011], [0.5834, 0.1813, 0.6857], [0.5587, 0.0264, 0.9934]]]]])
in1Sub15449 = tf.constant([[[[[0.9634, 0.2193, 0.7742], [0.5062, 0.8233, 0.5343], [0.9194, 0.5431, 0.8294]], [[0.1441, 0.4971, 0.5393], [0.4453, 0.7596, 0.6449], [0.085, 0.4009, 0.3911]], [[0.4782, 0.5883, 0.2523], [0.0945, 0.4746, 0.883], [0.6876, 0.729, 0.1537]]], [[[0.9784, 0.6972, 0.2928], [0.2322, 0.1769, 0.2034], [0.6335, 0.2369, 0.47]], [[0.12, 0.7224, 0.7666], [0.4636, 0.1037, 0.2208], [0.2055, 0.0806, 0.447]], [[0.7681, 0.716, 0.943], [0.6634, 0.2812, 0.76], [0.6437, 0.3204, 0.5618]]]]])
in0ELU21333 = tf.constant([[[[0.236]]]])
in0Con86944 = tf.constant([[[[[0.8237], [0.1969], [0.4193]]], [[[0.8238], [0.936], [0.0749]]], [[[0.345], [0.1749], [0.8564]]]]])
in0Add31342 = tf.constant([[[[[0.0857, 0.5853], [0.6812, 0.554]]], [[[0.6871, 0.7693], [0.9367, 0.6195]]]]])
in1Add31342 = tf.constant([[[[[0.5298, 0.8751], [0.6537, 0.7468]]], [[[0.4628, 0.7867], [0.747, 0.9822]]]]])
in0Con72558 = tf.constant([[0.5811, 0.1629, 0.5472, 0.7891, 0.0081, 0.8645, 0.2885, 0.653, 0.5211, 0.2243, 0.0797, 0.9131, 0.9658, 0.0746, 0.5797, 0.4804, 0.6556, 0.8854, 0.0471, 0.8824, 0.8682, 0.4911, 0.1054, 0.4768, 0.8634, 0.0318, 0.5354, 0.6843, 0.3408, 0.5268, 0.2674, 0.6232, 0.709, 0.6815, 0.2174, 0.3469, 0.2768, 0.2416, 0.8584, 0.741, 0.4886, 0.4484, 0.4565, 0.0177, 0.6286, 0.9264, 0.7081, 0.6631, 0.9948, 0.6387, 0.1141, 0.6356]])
print (np.array2string(model.predict([in0Sub15449,in1Sub15449,in0ELU21333,in0Con86944,in0Add31342,in1Add31342,in0Con72558],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul81230.png')

LSub15449 = subtract_layer([[[[[0.1574, 0.029, 0.1933], [0.1898, 0.1902, 0.8196], [0.5617, 0.3762, 0.671]], [[0.3995, 0.1791, 0.8514], [0.9262, 0.3324, 0.1013], [0.0423, 0.1609, 0.5336]], [[0.9675, 0.2804, 0.5648], [0.1059, 0.617, 0.0797], [0.869, 0.5369, 0.6552]]], [[[0.0205, 0.9668, 0.8058], [0.3986, 0.0176, 0.3254], [0.4449, 0.3227, 0.9499]], [[0.4334, 0.7552, 0.7356], [0.9836, 0.4606, 0.1816], [0.9027, 0.4368, 0.6351]], [[0.3245, 0.2623, 0.7011], [0.5834, 0.1813, 0.6857], [0.5587, 0.0264, 0.9934]]]]], [[[[[0.9634, 0.2193, 0.7742], [0.5062, 0.8233, 0.5343], [0.9194, 0.5431, 0.8294]], [[0.1441, 0.4971, 0.5393], [0.4453, 0.7596, 0.6449], [0.085, 0.4009, 0.3911]], [[0.4782, 0.5883, 0.2523], [0.0945, 0.4746, 0.883], [0.6876, 0.729, 0.1537]]], [[[0.9784, 0.6972, 0.2928], [0.2322, 0.1769, 0.2034], [0.6335, 0.2369, 0.47]], [[0.12, 0.7224, 0.7666], [0.4636, 0.1037, 0.2208], [0.2055, 0.0806, 0.447]], [[0.7681, 0.716, 0.943], [0.6634, 0.2812, 0.76], [0.6437, 0.3204, 0.5618]]]]], Sub15449), 
LRes89378 = reshape_layer(Sub15449, [2, 3, 9], Res89378), 
LRes39550 = reshape_layer(Res89378, [2, 27], Res39550), 
LFla28926 = flatten_layer(Res39550, Fla28926), 
LELU21333 = elu_layer([[[[0.236]]]], -1.1133236655360292, ELU21333), 
LRes17075 = reshape_layer(ELU21333, [1, 1], Res17075), 
LZer59613 = zero_padding1D_layer(Res17075, 1, 1, Zer59613), 
LRes84289 = reshape_layer(Zer59613, [3, 1, 1], Res84289), 
LRes37569 = reshape_layer(Res84289, [3, 1, 1, 1], Res37569), 
LZer10748 = zero_padding3D_layer(Res37569, 0, 0, 0, 0, 2, 0, Zer10748), 
LCon86944 = concatenate_layer([Zer10748,[[[[[0.8237], [0.1969], [0.4193]]], [[[0.8238], [0.936], [0.0749]]], [[[0.345], [0.1749], [0.8564]]]]]], 4, Con86944), 
LAdd31342 = add_layer([[[[[[0.0857, 0.5853], [0.6812, 0.554]]], [[[0.6871, 0.7693], [0.9367, 0.6195]]]]], [[[[[0.5298, 0.8751], [0.6537, 0.7468]]], [[[0.4628, 0.7867], [0.747, 0.9822]]]]]], Add31342), 
LZer52874 = zero_padding3D_layer(Add31342, 1, 0, 0, 0, 1, 0, Zer52874), 
LSub26147 = subtract_layer(Con86944,Zer52874, Sub26147), 
LRes33221 = reshape_layer(Sub26147, [3, 1, 6], Res33221), 
LRes50124 = reshape_layer(Res33221, [3, 6], Res50124), 
LSim14559 = simple_rnn_layer(Res50124,[[5, 9], [1, 3], [8, 9], [3, 1], [5, 2], [5, 8]],[[3, 10], [2, 3]],[7, 2], Sim14559), 
LCon72558 = concatenate_layer([Sim14559,[[0.5811, 0.1629, 0.5472, 0.7891, 0.0081, 0.8645, 0.2885, 0.653, 0.5211, 0.2243, 0.0797, 0.9131, 0.9658, 0.0746, 0.5797, 0.4804, 0.6556, 0.8854, 0.0471, 0.8824, 0.8682, 0.4911, 0.1054, 0.4768, 0.8634, 0.0318, 0.5354, 0.6843, 0.3408, 0.5268, 0.2674, 0.6232, 0.709, 0.6815, 0.2174, 0.3469, 0.2768, 0.2416, 0.8584, 0.741, 0.4886, 0.4484, 0.4565, 0.0177, 0.6286, 0.9264, 0.7081, 0.6631, 0.9948, 0.6387, 0.1141, 0.6356]]], 1, Con72558), 
LMul81230 = multiply_layer([Fla28926,Con72558], Mul81230), 
exec_layers([LSub15449,LRes89378,LRes39550,LFla28926,LELU21333,LRes17075,LZer59613,LRes84289,LRes37569,LZer10748,LCon86944,LAdd31342,LZer52874,LSub26147,LRes33221,LRes50124,LSim14559,LCon72558,LMul81230],["Sub15449","Res89378","Res39550","Fla28926","ELU21333","Res17075","Zer59613","Res84289","Res37569","Zer10748","Con86944","Add31342","Zer52874","Sub26147","Res33221","Res50124","Sim14559","Con72558","Mul81230"],Mul81230,"Mul81230")

Actual (Unparsed): [[0.8060000, 0.1903000, -0.3375610, -0.0515416, -0.3464323, 0.2251302, -0.0028974, -0.1442851, -0.0456984, 0.1667762, -0.1657098, 0.0700040, 0.0383277, -0.3900763, -0.5250089, -0.0031854, -0.1391280, 0.0684570, 0.3207851, -0.2726146, 0.0147188, 0.0100594, 0.1236317, -0.3945006, 0.0191196, -0.0915933, 0.4329951, -0.0304612, 0.1443438, 0.3510459, 0.0567091, -0.0839192, 0.0326228, -0.1175355, 0.0608322, 0.3270518, 0.0681332, 0.0113783, -0.0085808, 0.1256320, 0.3063629, -0.0290472, 0.3406519, 0.1597201, 0.0858677, -0.0078517, -0.2851958, -0.2240962, -0.0566480, -0.0662437, -0.0739136, -0.0542895, -0.0335454, 0.2743249]]

Expected (Unparsed): [[0.806,0.1903,-0.33756098999999995,-0.05154156,-0.34643232,0.22513023000000001,-0.00289737,-0.14428505000000005,-0.04569839999999999,0.1667762,-0.16570979999999996,0.07000403000000001,0.03832773,-0.3900763200000001,-0.5250088800000001,-0.0031854200000000004,-0.139128,0.06845699999999998,0.32078508,-0.27261466000000006,0.014718749999999997,0.010059359999999995,0.12363167999999997,-0.39450063,0.01911956,-0.09159327999999997,0.4329951,-0.030461220000000004,0.14434383999999997,0.35104589999999997,0.05670912000000001,-0.08391924,0.03262280000000001,-0.11753551999999995,0.06083219999999999,0.32705185,0.06813316000000001,0.011378319999999978,-0.008580799999999977,0.12563200000000002,0.30636296,-0.02904719999999999,0.34065191999999994,0.15972008000000001,0.08586765,-0.00785172,-0.28519582000000004,-0.22409616000000002,-0.05664799999999997,-0.06624369000000001,-0.07391364000000003,-0.05428950000000005,-0.0335454,0.27432496]]

Actual:   [[0.806, 0.1903, -0.3375, -0.0515, -0.3464, 0.2252, -0.0028, -0.1442, -0.0456, 0.1668, -0.1657, 0.0701, 0.0384, -0.39, -0.525, -0.0031, -0.1391, 0.0685, 0.3208, -0.2726, 0.0148, 0.0101, 0.1237, -0.3945, 0.0192, -0.0915, 0.433, -0.0304, 0.1444, 0.3511, 0.0568, -0.0839, 0.0327, -0.1175, 0.0609, 0.3271, 0.0682, 0.0114, -0.0085, 0.1257, 0.3064, -0.029, 0.3407, 0.1598, 0.0859, -0.0078, -0.2851, -0.224, -0.0566, -0.0662, -0.0739, -0.0542, -0.0335, 0.2744]]

Expected: [[0.806, 0.1903, -0.3375, -0.0515, -0.3464, 0.2252, -0.0028, -0.1442, -0.0456, 0.1668, -0.1657, 0.0701, 0.0384, -0.39, -0.525, -0.0031, -0.1391, 0.0685, 0.3208, -0.2726, 0.0148, 0.0101, 0.1237, -0.3945, 0.0192, -0.0915, 0.433, -0.0304, 0.1444, 0.3511, 0.0568, -0.0839, 0.0327, -0.1175, 0.0609, 0.3271, 0.0682, 0.0114, -0.0085, 0.1257, 0.3064, -0.029, 0.3407, 0.1598, 0.0859, -0.0078, -0.2851, -0.224, -0.0566, -0.0662, -0.0739, -0.0542, -0.0335, 0.2744]]