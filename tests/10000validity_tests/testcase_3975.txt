import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add74036 = tf.keras.layers.Input(shape=([2, 1]))
in1Add74036 = tf.keras.layers.Input(shape=([2, 1]))
in0Con45813 = tf.keras.layers.Input(shape=([2, 3, 2]))
in0Add24685 = tf.keras.layers.Input(shape=([1, 2]))
in1Add24685 = tf.keras.layers.Input(shape=([1, 2]))
in0Con5965 = tf.keras.layers.Input(shape=([1, 2, 2]))
in0Ave89656 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))
in1Ave89656 = tf.keras.layers.Input(shape=([2, 2, 2, 1]))

Add74036 = keras.layers.Add(name = 'Add74036', )([in0Add74036,in1Add74036])
Res91270 = keras.layers.Reshape((2, 1, 1), name = 'Res91270', )(Add74036)
Zer60645 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer60645', )(Res91270)
Con45813 = keras.layers.Concatenate(axis=3, name = 'Con45813', )([Zer60645,in0Con45813])
Add24685 = keras.layers.Add(name = 'Add24685', )([in0Add24685,in1Add24685])
Res75657 = keras.layers.Reshape((1, 2, 1), name = 'Res75657', )(Add24685)
Con5965 = keras.layers.Concatenate(axis=3, name = 'Con5965', )([Res75657,in0Con5965])
Ave89656 = keras.layers.Average(name = 'Ave89656', )([in0Ave89656,in1Ave89656])
Res39150 = keras.layers.Reshape((2, 2, 2), name = 'Res39150', )(Ave89656)
Loc57256 = keras.layers.LocallyConnected2D(3, (2, 2),strides=(1, 1), name = 'Loc57256', )(Res39150)
Zer96827 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer96827', )(Loc57256)
Max73809 = keras.layers.Maximum(name = 'Max73809', )([Con5965,Zer96827])
Zer78743 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer78743', )(Max73809)
Mul9090 = keras.layers.Multiply(name = 'Mul9090', )([Con45813,Zer78743])
model = tf.keras.models.Model(inputs=[in0Add74036,in1Add74036,in0Con45813,in0Add24685,in1Add24685,in0Con5965,in0Ave89656,in1Ave89656], outputs=Mul9090)
w = model.get_layer('Loc57256').get_weights() 
w[0] = np.array([[[0.9396, 0.8248, 0.7072], [0.3773, 0.0649, 0.0598], [0.7979, 0.6349, 0.5998], [0.1561, 0.0138, 0.3478], [0.4975, 0.4768, 0.2355], [0.6434, 0.3536, 0.9788], [0.7734, 0.2041, 0.2818], [0.6935, 0.4261, 0.2465]]])
w[1] = np.array([[[0, 0, 0]]])
model.get_layer('Loc57256').set_weights(w) 
in0Add74036 = tf.constant([[[0.9765], [0.3748]]])
in1Add74036 = tf.constant([[[0.8288], [0.0873]]])
in0Con45813 = tf.constant([[[[0.8604, 0.0221], [0.2721, 0.1786], [0.6448, 0.5286]], [[0.5763, 0.4274], [0.8706, 0.2086], [0.9183, 0.6866]]]])
in0Add24685 = tf.constant([[[0.9526, 0.8351]]])
in1Add24685 = tf.constant([[[0.4294, 0.7073]]])
in0Con5965 = tf.constant([[[[0.2814, 0.6696], [0.7478, 0.0943]]]])
in0Ave89656 = tf.constant([[[[[0.9085], [0.1649]], [[0.7524], [0.6604]]], [[[0.8595], [0.7902]], [[0.9436], [0.6271]]]]])
in1Ave89656 = tf.constant([[[[[0.5247], [0.1104]], [[0.2975], [0.9159]]], [[[0.3328], [0.8048]], [[0.7971], [0.0407]]]]])
print (np.array2string(model.predict([in0Add74036,in1Add74036,in0Con45813,in0Add24685,in1Add24685,in0Con5965,in0Ave89656,in1Ave89656],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul9090.png')

LAdd74036 = add_layer([[[[0.9765], [0.3748]]], [[[0.8288], [0.0873]]]], Add74036), 
LRes91270 = reshape_layer(Add74036, [2, 1, 1], Res91270), 
LZer60645 = zero_padding2D_layer(Res91270, 0, 0, 2, 0, Zer60645), 
LCon45813 = concatenate_layer([Zer60645,[[[[0.8604, 0.0221], [0.2721, 0.1786], [0.6448, 0.5286]], [[0.5763, 0.4274], [0.8706, 0.2086], [0.9183, 0.6866]]]]], 3, Con45813), 
LAdd24685 = add_layer([[[[0.9526, 0.8351]]], [[[0.4294, 0.7073]]]], Add24685), 
LRes75657 = reshape_layer(Add24685, [1, 2, 1], Res75657), 
LCon5965 = concatenate_layer([Res75657,[[[[0.2814, 0.6696], [0.7478, 0.0943]]]]], 3, Con5965), 
LAve89656 = average_layer([[[[[[0.9085], [0.1649]], [[0.7524], [0.6604]]], [[[0.8595], [0.7902]], [[0.9436], [0.6271]]]]], [[[[[0.5247], [0.1104]], [[0.2975], [0.9159]]], [[[0.3328], [0.8048]], [[0.7971], [0.0407]]]]]], Ave89656), 
LRes39150 = reshape_layer(Ave89656, [2, 2, 2], Res39150), 
LLoc57256 = locally_connected2D_layer(Res39150, 2, 2,[[[0.9396, 0.8248, 0.7072], [0.3773, 0.0649, 0.0598], [0.7979, 0.6349, 0.5998], [0.1561, 0.0138, 0.3478], [0.4975, 0.4768, 0.2355], [0.6434, 0.3536, 0.9788], [0.7734, 0.2041, 0.2818], [0.6935, 0.4261, 0.2465]]],[[[0, 0, 0]]], 1, 1, Loc57256), 
LZer96827 = zero_padding2D_layer(Loc57256, 0, 0, 1, 0, Zer96827), 
LMax73809 = maximum_layer([Con5965,Zer96827], Max73809), 
LZer78743 = zero_padding2D_layer(Max73809, 1, 0, 1, 0, Zer78743), 
LMul9090 = multiply_layer([Con45813,Zer78743], Mul9090), 
exec_layers([LAdd74036,LRes91270,LZer60645,LCon45813,LAdd24685,LRes75657,LCon5965,LAve89656,LRes39150,LLoc57256,LZer96827,LMax73809,LZer78743,LMul9090],["Add74036","Res91270","Zer60645","Con45813","Add24685","Res75657","Con5965","Ave89656","Res39150","Loc57256","Zer96827","Max73809","Zer78743","Mul9090"],Mul9090,"Mul9090")

Actual (Unparsed): [[[[0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.0000000, 0.0000000]], [[0.0000000, 0.0000000, 0.0000000], [0.0000000, 0.2449868, 0.1396786], [1.3777627, 1.6807699, 1.6152622]]]]

Expected (Unparsed): [[[[0,0.0,0.0],[0,0.0,0.0],[0.0,0.0,0.0]],[[0,0.0,0.0],[0.0,0.24498683999999998,0.13967856],[1.3777626978789999,1.6807699401105,1.615262117375]]]]

Actual:   [[[[0, 0, 0], [0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0.245, 0.1397], [1.3778, 1.6808, 1.6153]]]]

Expected: [[[[0, 0, 0], [0, 0, 0], [0, 0, 0]], [[0, 0, 0], [0, 0.245, 0.1397], [1.3778, 1.6808, 1.6153]]]]