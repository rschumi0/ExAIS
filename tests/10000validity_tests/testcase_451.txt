import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0LST3796 = tf.keras.layers.Input(shape=([3, 2]))
in0Cro53934 = tf.keras.layers.Input(shape=([4, 1, 3]))
in0Con72000 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Add92580 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Add92580 = tf.keras.layers.Input(shape=([1, 1, 2]))

LST3796 = keras.layers.LSTM(3,recurrent_activation='sigmoid', name = 'LST3796', )(in0LST3796)
Res24790 = keras.layers.Reshape((3, 1), name = 'Res24790', )(LST3796)
Cro53934 = keras.layers.Cropping2D(cropping=((3, 0), (0, 0)), name = 'Cro53934', )(in0Cro53934)
Res31059 = keras.layers.Reshape((3, 1), name = 'Res31059', )(Cro53934)
Ave52185 = keras.layers.Average(name = 'Ave52185', )([Res24790,Res31059])
Res30404 = keras.layers.Reshape((3, 1, 1), name = 'Res30404', )(Ave52185)
Dep15396 = keras.layers.DepthwiseConv2D((1, 1),strides=(2, 2), padding='same', name = 'Dep15396', )(Res30404)
ELU75350 = keras.layers.ELU(alpha=-0.934330915687152, name = 'ELU75350', )(Dep15396)
Con72000 = keras.layers.Concatenate(axis=3, name = 'Con72000', )([ELU75350,in0Con72000])
Add92580 = keras.layers.Add(name = 'Add92580', )([in0Add92580,in1Add92580])
Zer72076 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer72076', )(Add92580)
Sub83793 = keras.layers.Subtract(name = 'Sub83793', )([Con72000,Zer72076])
model = tf.keras.models.Model(inputs=[in0LST3796,in0Cro53934,in0Con72000,in0Add92580,in1Add92580], outputs=Sub83793)
w = model.get_layer('LST3796').get_weights() 
w[0] = np.array([[9, 3, 7, 9, 5, 7, 1, 7, 10, 1, 3, 7], [9, 10, 1, 8, 8, 9, 4, 9, 3, 3, 5, 7]])
w[1] = np.array([[2, 2, 2, 7, 5, 3, 4, 8, 9, 8, 2, 10], [9, 8, 4, 10, 5, 5, 3, 10, 8, 5, 2, 5], [8, 9, 9, 3, 8, 10, 5, 6, 8, 3, 10, 9]])
w[2] = np.array([2, 2, 9, 7, 5, 1, 4, 3, 7, 1, 1, 5])
model.get_layer('LST3796').set_weights(w) 
w = model.get_layer('Dep15396').get_weights() 
w[0] = np.array([[[[0.8852]]]])
w[1] = np.array([0])
model.get_layer('Dep15396').set_weights(w) 
in0LST3796 = tf.constant([[[7, 4], [10, 10], [4, 7]]])
in0Cro53934 = tf.constant([[[[1.5017, 1.9957, 1.2742]], [[1.175, 1.0732, 1.5662]], [[1.9392, 1.6006, 1.8581]], [[1.0598, 1.2767, 1.4098]]]])
in0Con72000 = tf.constant([[[[0.5851]], [[0.3607]]]])
in0Add92580 = tf.constant([[[[0.4331, 0.6141]]]])
in1Add92580 = tf.constant([[[[0.2867, 0.7379]]]])
print (np.array2string(model.predict([in0LST3796,in0Cro53934,in0Con72000,in0Add92580,in1Add92580],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub83793.png')

LLST3796 = lstm_layer([[[7, 4], [10, 10], [4, 7]]],[[9, 3, 7, 9, 5, 7, 1, 7, 10, 1, 3, 7], [9, 10, 1, 8, 8, 9, 4, 9, 3, 3, 5, 7]],[[2, 2, 2, 7, 5, 3, 4, 8, 9, 8, 2, 10], [9, 8, 4, 10, 5, 5, 3, 10, 8, 5, 2, 5], [8, 9, 9, 3, 8, 10, 5, 6, 8, 3, 10, 9]],[2, 2, 9, 7, 5, 1, 4, 3, 7, 1, 1, 5], LST3796), 
LRes24790 = reshape_layer(LST3796, [3, 1], Res24790), 
LCro53934 = cropping2D_layer([[[[1.5017, 1.9957, 1.2742]], [[1.175, 1.0732, 1.5662]], [[1.9392, 1.6006, 1.8581]], [[1.0598, 1.2767, 1.4098]]]], 3, 0, 0, 0, Cro53934), 
LRes31059 = reshape_layer(Cro53934, [3, 1], Res31059), 
LAve52185 = average_layer([Res24790,Res31059], Ave52185), 
LRes30404 = reshape_layer(Ave52185, [3, 1, 1], Res30404), 
LDep15396 = depthwise_conv2D_layer(Res30404, 1, 1,[[[[0.8852]]]],[0], 2, 2, true, Dep15396), 
LELU75350 = elu_layer(Dep15396, -0.934330915687152, ELU75350), 
LCon72000 = concatenate_layer([ELU75350,[[[[0.5851]], [[0.3607]]]]], 3, Con72000), 
LAdd92580 = add_layer([[[[[0.4331, 0.6141]]]], [[[[0.2867, 0.7379]]]]], Add92580), 
LZer72076 = zero_padding2D_layer(Add92580, 1, 0, 0, 0, Zer72076), 
LSub83793 = subtract_layer(Con72000,Zer72076, Sub83793), 
exec_layers([LLST3796,LRes24790,LCro53934,LRes31059,LAve52185,LRes30404,LDep15396,LELU75350,LCon72000,LAdd92580,LZer72076,LSub83793],["LST3796","Res24790","Cro53934","Res31059","Ave52185","Res30404","Dep15396","ELU75350","Con72000","Add92580","Zer72076","Sub83793"],Sub83793,"Sub83793")

Actual (Unparsed): [[[[0.9094787, 0.5851000]], [[0.3445887, -0.9913000]]]]

Expected (Unparsed): [[[[0.909478713981747,0.5851]],[[0.34458871398174673,-0.9912999999999998]]]]

Actual:   [[[[0.9095, 0.5851]], [[0.3446, -0.9913]]]]

Expected: [[[[0.9095, 0.5851]], [[0.3446, -0.9912]]]]