import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc41844 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Mul97982 = tf.keras.layers.Input(shape=([2, 2, 1]))
in1Mul97982 = tf.keras.layers.Input(shape=([2, 2, 1]))
in0Con16973 = tf.keras.layers.Input(shape=([2, 2, 3]))
in0Min69460 = tf.keras.layers.Input(shape=([2, 2]))
in1Min69460 = tf.keras.layers.Input(shape=([2, 2]))
in0Con27647 = tf.keras.layers.Input(shape=([3, 4, 1]))
in0Zer11331 = tf.keras.layers.Input(shape=([1, 2, 2]))

Loc41844 = keras.layers.LocallyConnected2D(4, (1, 1),strides=(12, 1), name = 'Loc41844', )(in0Loc41844)
Zer5859 = keras.layers.ZeroPadding2D(padding=((1, 0), (0, 0)), name = 'Zer5859', )(Loc41844)
Mul97982 = keras.layers.Multiply(name = 'Mul97982', )([in0Mul97982,in1Mul97982])
Con16973 = keras.layers.Concatenate(axis=3, name = 'Con16973', )([Mul97982,in0Con16973])
Max3787 = keras.layers.Maximum(name = 'Max3787', )([Zer5859,Con16973])
Res55598 = keras.layers.Reshape((2, 2, 4, 1), name = 'Res55598', )(Max3787)
Min69460 = keras.layers.Minimum(name = 'Min69460', )([in0Min69460,in1Min69460])
Res59679 = keras.layers.Reshape((2, 2, 1), name = 'Res59679', )(Min69460)
Zer21483 = keras.layers.ZeroPadding2D(padding=((1, 0), (2, 0)), name = 'Zer21483', )(Res59679)
Con27647 = keras.layers.Concatenate(axis=3, name = 'Con27647', )([Zer21483,in0Con27647])
Zer11331 = keras.layers.ZeroPadding2D(padding=((1, 1), (1, 1)), name = 'Zer11331', )(in0Zer11331)
Sub96334 = keras.layers.Subtract(name = 'Sub96334', )([Con27647,Zer11331])
Res64001 = keras.layers.Reshape((3, 4, 2, 1), name = 'Res64001', )(Sub96334)
Cro1242 = keras.layers.Cropping3D(cropping=((1, 0), (2, 1), (1, 0)), name = 'Cro1242', )(Res64001)
Zer40283 = keras.layers.ZeroPadding3D(padding=((0, 0), (1, 0), (3, 0)), name = 'Zer40283', )(Cro1242)
Ave71107 = keras.layers.Average(name = 'Ave71107', )([Res55598,Zer40283])
Res71528 = keras.layers.Reshape((2, 2, 4), name = 'Res71528', )(Ave71107)
Res77021 = keras.layers.Reshape((2, 8), name = 'Res77021', )(Res71528)
Loc93095 = keras.layers.LocallyConnected1D(3, (1),strides=(1), name = 'Loc93095', )(Res77021)
model = tf.keras.models.Model(inputs=[in0Loc41844,in0Mul97982,in1Mul97982,in0Con16973,in0Min69460,in1Min69460,in0Con27647,in0Zer11331], outputs=Loc93095)
w = model.get_layer('Loc41844').get_weights() 
w[0] = np.array([[[0.5847, 0.1264, 0.2293, 0.9632]], [[0.4852, 0.3661, 0.0906, 0.6719]]])
w[1] = np.array([[[0, 0, 0, 0], [0, 0, 0, 0]]])
model.get_layer('Loc41844').set_weights(w) 
w = model.get_layer('Loc93095').get_weights() 
w[0] = np.array([[[0.5084, 0.1696, 0.5794], [0.6496, 0.5137, 0.6], [0.2405, 0.1507, 0.1738], [0.5245, 0.3466, 0.8102], [0.5181, 0.4732, 0.9441], [0.4887, 0.1431, 0.2949], [0.7741, 0.763, 0.1889], [0.1122, 0.4209, 0.3088]], [[0.1329, 0.5471, 0.2236], [0.1065, 0.4965, 0.2997], [0.6453, 0.606, 0.2037], [0.0289, 0.4539, 0.4969], [0.2516, 0.8861, 0.5013], [0.2697, 0.5591, 0.9811], [0.114, 0.3268, 0.3431], [0.5233, 0.1053, 0.0011]]])
w[1] = np.array([[0, 0, 0], [0, 0, 0]])
model.get_layer('Loc93095').set_weights(w) 
in0Loc41844 = tf.constant([[[[0.8669], [0.8521]], [[0.4008], [0.3784]]]])
in0Mul97982 = tf.constant([[[[0.601], [0.6927]], [[0.4585], [0.626]]]])
in1Mul97982 = tf.constant([[[[0.1514], [0.1981]], [[0.7796], [0.983]]]])
in0Con16973 = tf.constant([[[[0.6131, 0.2595, 0.3116], [0.5125, 0.7913, 0.3166]], [[0.2597, 0.4135, 0.8163], [0.4106, 0.0933, 0.5516]]]])
in0Min69460 = tf.constant([[[0.6622, 0.2298], [0.0942, 0.4856]]])
in1Min69460 = tf.constant([[[0.4013, 0.6137], [0.1849, 0.9273]]])
in0Con27647 = tf.constant([[[[0.0376], [0.4648], [0.7276], [0.3181]], [[0.6042], [0.5513], [0.1492], [0.2771]], [[0.6804], [0.3003], [0.7518], [0.3989]]]])
in0Zer11331 = tf.constant([[[[1.3807, 1.3878], [1.8424, 1.3587]]]])
print (np.array2string(model.predict([in0Loc41844,in0Mul97982,in1Mul97982,in0Con16973,in0Min69460,in1Min69460,in0Con27647,in0Zer11331],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Loc93095.png')

LLoc41844 = locally_connected2D_layer([[[[0.8669], [0.8521]], [[0.4008], [0.3784]]]], 1, 1,[[[0.5847, 0.1264, 0.2293, 0.9632]], [[0.4852, 0.3661, 0.0906, 0.6719]]],[[[0, 0, 0, 0], [0, 0, 0, 0]]], 12, 1, Loc41844), 
LZer5859 = zero_padding2D_layer(Loc41844, 1, 0, 0, 0, Zer5859), 
LMul97982 = multiply_layer([[[[[0.601], [0.6927]], [[0.4585], [0.626]]]], [[[[0.1514], [0.1981]], [[0.7796], [0.983]]]]], Mul97982), 
LCon16973 = concatenate_layer([Mul97982,[[[[0.6131, 0.2595, 0.3116], [0.5125, 0.7913, 0.3166]], [[0.2597, 0.4135, 0.8163], [0.4106, 0.0933, 0.5516]]]]], 3, Con16973), 
LMax3787 = maximum_layer([Zer5859,Con16973], Max3787), 
LRes55598 = reshape_layer(Max3787, [2, 2, 4, 1], Res55598), 
LMin69460 = minimum_layer([[[[0.6622, 0.2298], [0.0942, 0.4856]]], [[[0.4013, 0.6137], [0.1849, 0.9273]]]], Min69460), 
LRes59679 = reshape_layer(Min69460, [2, 2, 1], Res59679), 
LZer21483 = zero_padding2D_layer(Res59679, 1, 0, 2, 0, Zer21483), 
LCon27647 = concatenate_layer([Zer21483,[[[[0.0376], [0.4648], [0.7276], [0.3181]], [[0.6042], [0.5513], [0.1492], [0.2771]], [[0.6804], [0.3003], [0.7518], [0.3989]]]]], 3, Con27647), 
LZer11331 = zero_padding2D_layer([[[[1.3807, 1.3878], [1.8424, 1.3587]]]], 1, 1, 1, 1, Zer11331), 
LSub96334 = subtract_layer(Con27647,Zer11331, Sub96334), 
LRes64001 = reshape_layer(Sub96334, [3, 4, 2, 1], Res64001), 
LCro1242 = cropping3D_layer(Res64001, 1, 0, 2, 1, 1, 0, Cro1242), 
LZer40283 = zero_padding3D_layer(Cro1242, 0, 0, 1, 0, 3, 0, Zer40283), 
LAve71107 = average_layer([Res55598,Zer40283], Ave71107), 
LRes71528 = reshape_layer(Ave71107, [2, 2, 4], Res71528), 
LRes77021 = reshape_layer(Res71528, [2, 8], Res77021), 
LLoc93095 = locally_connected1D_layer(Res77021, 1,[[[0.5084, 0.1696, 0.5794], [0.6496, 0.5137, 0.6], [0.2405, 0.1507, 0.1738], [0.5245, 0.3466, 0.8102], [0.5181, 0.4732, 0.9441], [0.4887, 0.1431, 0.2949], [0.7741, 0.763, 0.1889], [0.1122, 0.4209, 0.3088]], [[0.1329, 0.5471, 0.2236], [0.1065, 0.4965, 0.2997], [0.6453, 0.606, 0.2037], [0.0289, 0.4539, 0.4969], [0.2516, 0.8861, 0.5013], [0.2697, 0.5591, 0.9811], [0.114, 0.3268, 0.3431], [0.5233, 0.1053, 0.0011]]],[[0, 0, 0], [0, 0, 0]], 1, Loc93095), 
exec_layers([LLoc41844,LZer5859,LMul97982,LCon16973,LMax3787,LRes55598,LMin69460,LRes59679,LZer21483,LCon27647,LZer11331,LSub96334,LRes64001,LCro1242,LZer40283,LAve71107,LRes71528,LRes77021,LLoc93095],["Loc41844","Zer5859","Mul97982","Con16973","Max3787","Res55598","Min69460","Res59679","Zer21483","Con27647","Zer11331","Sub96334","Res64001","Cro1242","Zer40283","Ave71107","Res71528","Res77021","Loc93095"],Loc93095,"Loc93095")

Actual (Unparsed): [[[0.7521451, 0.4218511, 0.4362891], [0.6776019, 0.9903085, 0.7175484]]]

Expected (Unparsed): [[[0.7521450624034999,0.4218510983620001,0.4362890964135],[0.677601902713,0.9903084619559999,0.7175483848444999]]]

Actual:   [[[0.7522, 0.4219, 0.4363], [0.6777, 0.9904, 0.7176]]]

Expected: [[[0.7522, 0.4219, 0.4363], [0.6777, 0.9904, 0.7176]]]