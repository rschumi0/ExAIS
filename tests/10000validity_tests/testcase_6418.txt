import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Con69176 = tf.keras.layers.Input(shape=([2, 1, 2, 2]))
in0Sub89896 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in1Sub89896 = tf.keras.layers.Input(shape=([2, 2, 2, 2]))
in0Con15852 = tf.keras.layers.Input(shape=([1, 7]))

Con69176 = keras.layers.Conv3D(4, (1, 1, 2),strides=(3, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con69176', )(in0Con69176)
Res53667 = keras.layers.Reshape((1, 1, 8), name = 'Res53667', )(Con69176)
Res15291 = keras.layers.Reshape((1, 8), name = 'Res15291', )(Res53667)
Sub89896 = keras.layers.Subtract(name = 'Sub89896', )([in0Sub89896,in1Sub89896])
Res68116 = keras.layers.Reshape((2, 2, 4), name = 'Res68116', )(Sub89896)
Res75620 = keras.layers.Reshape((2, 8), name = 'Res75620', )(Res68116)
Sim8146 = keras.layers.SimpleRNN(3,name = 'Sim8146', )(Res75620)
Res89756 = keras.layers.Reshape((3, 1), name = 'Res89756', )(Sim8146)
Max25877 = keras.layers.MaxPool1D(pool_size=(2), name = 'Max25877', )(Res89756)
Con15852 = keras.layers.Concatenate(axis=2, name = 'Con15852', )([Max25877,in0Con15852])
Sub50587 = keras.layers.Subtract(name = 'Sub50587', )([Res15291,Con15852])
model = tf.keras.models.Model(inputs=[in0Con69176,in0Sub89896,in1Sub89896,in0Con15852], outputs=Sub50587)
w = model.get_layer('Con69176').get_weights() 
w[0] = np.array([[[[[0.098, 0.7154, 0.9459, 0.8654], [0.1968, 0.9323, 0.607, 0.5464]], [[0.4411, 0.2688, 0.6637, 0.1018], [0.5417, 0.9857, 0.822, 0.3484]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con69176').set_weights(w) 
w = model.get_layer('Sim8146').get_weights() 
w[0] = np.array([[3, 6, 7], [1, 7, 10], [9, 6, 1], [10, 5, 3], [4, 1, 1], [7, 6, 10], [1, 10, 5], [10, 10, 8]])
w[1] = np.array([[7, 10, 10], [1, 8, 7], [3, 5, 3]])
w[2] = np.array([1, 4, 5])
model.get_layer('Sim8146').set_weights(w) 
in0Con69176 = tf.constant([[[[[0.7152, 0.8089], [0.218, 0.3249]]], [[[0.8248, 0.1596], [0.0782, 0.3332]]]]])
in0Sub89896 = tf.constant([[[[[0.2218, 0.736], [0.6271, 0.8506]], [[0.1094, 0.9688], [0.4879, 0.6774]]], [[[0.0189, 0.4214], [0.5584, 0.1492]], [[0.7213, 0.1482], [0.2234, 0.7041]]]]])
in1Sub89896 = tf.constant([[[[[0.7937, 0.7043], [0.8866, 0.5446]], [[0.1945, 0.007], [0.0745, 0.2302]]], [[[0.2574, 0.5959], [0.0603, 0.6501]], [[0.0991, 0.9614], [0.6858, 0.715]]]]])
in0Con15852 = tf.constant([[[0.9818, 0.3112, 0.9406, 0.938, 0.8006, 0.7856, 0.6974]]])
print (np.array2string(model.predict([in0Con69176,in0Sub89896,in1Sub89896,in0Con15852],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub50587.png')

LCon69176 = conv3D_layer([[[[[0.7152, 0.8089], [0.218, 0.3249]]], [[[0.8248, 0.1596], [0.0782, 0.3332]]]]], 1, 1, 2,[[[[[0.098, 0.7154, 0.9459, 0.8654], [0.1968, 0.9323, 0.607, 0.5464]], [[0.4411, 0.2688, 0.6637, 0.1018], [0.5417, 0.9857, 0.822, 0.3484]]]]],[0, 0, 0, 0], 3, 1, 1, true, 1, 1, 1, Con69176), 
LRes53667 = reshape_layer(Con69176, [1, 1, 8], Res53667), 
LRes15291 = reshape_layer(Res53667, [1, 8], Res15291), 
LSub89896 = subtract_layer([[[[[0.2218, 0.736], [0.6271, 0.8506]], [[0.1094, 0.9688], [0.4879, 0.6774]]], [[[0.0189, 0.4214], [0.5584, 0.1492]], [[0.7213, 0.1482], [0.2234, 0.7041]]]]], [[[[[0.7937, 0.7043], [0.8866, 0.5446]], [[0.1945, 0.007], [0.0745, 0.2302]]], [[[0.2574, 0.5959], [0.0603, 0.6501]], [[0.0991, 0.9614], [0.6858, 0.715]]]]], Sub89896), 
LRes68116 = reshape_layer(Sub89896, [2, 2, 4], Res68116), 
LRes75620 = reshape_layer(Res68116, [2, 8], Res75620), 
LSim8146 = simple_rnn_layer(Res75620,[[3, 6, 7], [1, 7, 10], [9, 6, 1], [10, 5, 3], [4, 1, 1], [7, 6, 10], [1, 10, 5], [10, 10, 8]],[[7, 10, 10], [1, 8, 7], [3, 5, 3]],[1, 4, 5], Sim8146), 
LRes89756 = reshape_layer(Sim8146, [3, 1], Res89756), 
LMax25877 = max_pool1D_layer(Res89756, 2, Max25877), 
LCon15852 = concatenate_layer([Max25877,[[[0.9818, 0.3112, 0.9406, 0.938, 0.8006, 0.7856, 0.6974]]]], 2, Con15852), 
LSub50587 = subtract_layer(Res15291,Con15852, Sub50587), 
exec_layers([LCon69176,LRes53667,LRes15291,LSub89896,LRes68116,LRes75620,LSim8146,LRes89756,LMax25877,LCon15852,LSub50587],["Con69176","Res53667","Res15291","Sub89896","Res68116","Res75620","Sim8146","Res89756","Max25877","Con15852","Sub50587"],Sub50587,"Sub50587")

Actual (Unparsed): [[[-0.4985608, 0.6628439, 1.2680644, 0.2557046, -0.8526957, -0.3417385, -0.3821795, -0.3312174]]]

Expected (Unparsed): [[[-0.49856074999996525,0.66284388,1.26806438,0.25570459999999995,-0.85269568,-0.34173852999999993,-0.3821795,-0.33121744]]]

Actual:   [[[-0.4985, 0.6629, 1.2681, 0.2558, -0.8526, -0.3417, -0.3821, -0.3312]]]

Expected: [[[-0.4985, 0.6629, 1.2681, 0.2558, -0.8526, -0.3417, -0.3821, -0.3312]]]