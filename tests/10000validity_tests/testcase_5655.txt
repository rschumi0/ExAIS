import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min20474 = tf.keras.layers.Input(shape=([2, 2]))
in1Min20474 = tf.keras.layers.Input(shape=([2, 2]))
in0Max52419 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Max52419 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Max74253 = tf.keras.layers.Input(shape=([1, 2]))
in0Con10522 = tf.keras.layers.Input(shape=([2, 4]))

Min20474 = keras.layers.Minimum(name = 'Min20474', )([in0Min20474,in1Min20474])
Res93281 = keras.layers.Reshape((2, 2, 1), name = 'Res93281', )(Min20474)
Max52419 = keras.layers.Maximum(name = 'Max52419', )([in0Max52419,in1Max52419])
Zer87572 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer87572', )(Max52419)
Sub3134 = keras.layers.Subtract(name = 'Sub3134', )([Res93281,Zer87572])
Res93339 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res93339', )(Sub3134)
Con4569 = keras.layers.Conv3D(3, (2, 2, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con4569', )(Res93339)
Res49010 = keras.layers.Reshape((2, 2, 3), name = 'Res49010', )(Con4569)
Res6783 = keras.layers.Reshape((2, 6), name = 'Res6783', )(Res49010)
Max74253 = keras.layers.MaxPool1D(pool_size=(1), name = 'Max74253', )(in0Max74253)
Loc61729 = keras.layers.LocallyConnected1D(2, (1),strides=(4), name = 'Loc61729', )(Max74253)
Zer68409 = keras.layers.ZeroPadding1D(padding=((1, 0)), name = 'Zer68409', )(Loc61729)
Con10522 = keras.layers.Concatenate(axis=2, name = 'Con10522', )([Zer68409,in0Con10522])
Add73961 = keras.layers.Add(name = 'Add73961', )([Res6783,Con10522])
Res94971 = keras.layers.Reshape((2, 6, 1), name = 'Res94971', )(Add73961)
Max21123 = keras.layers.MaxPool2D(pool_size=(1, 1), strides=(1, 1), padding='same', name = 'Max21123', )(Res94971)
model = tf.keras.models.Model(inputs=[in0Min20474,in1Min20474,in0Max52419,in1Max52419,in0Max74253,in0Con10522], outputs=Max21123)
w = model.get_layer('Con4569').get_weights() 
w[0] = np.array([[[[[0.7846, 0.8161, 0.0058]]], [[[0.1111, 0.5771, 0.1461]]]], [[[[0.6996, 0.9376, 0.3136]]], [[[0.5035, 0.1182, 0.5956]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con4569').set_weights(w) 
w = model.get_layer('Loc61729').get_weights() 
w[0] = np.array([[[0.8688, 0.3984], [0.9748, 0.2852]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc61729').set_weights(w) 
in0Min20474 = tf.constant([[[0.2323, 0.4296], [0.4539, 0.0786]]])
in1Min20474 = tf.constant([[[0.8185, 0.3766], [0.5835, 0.5118]]])
in0Max52419 = tf.constant([[[[0.4275]], [[0.2941]]]])
in1Max52419 = tf.constant([[[[0.4569]], [[0.278]]]])
in0Max74253 = tf.constant([[[1.2024, 1.0875]]])
in0Con10522 = tf.constant([[[0.6158, 0.3296, 0.7582, 0.7904], [0.7944, 0.4124, 0.072, 0.2101]]])
print (np.array2string(model.predict([in0Min20474,in1Min20474,in0Max52419,in1Max52419,in0Max74253,in0Con10522],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Max21123.png')

LMin20474 = minimum_layer([[[[0.2323, 0.4296], [0.4539, 0.0786]]], [[[0.8185, 0.3766], [0.5835, 0.5118]]]], Min20474), 
LRes93281 = reshape_layer(Min20474, [2, 2, 1], Res93281), 
LMax52419 = maximum_layer([[[[[0.4275]], [[0.2941]]]], [[[[0.4569]], [[0.278]]]]], Max52419), 
LZer87572 = zero_padding2D_layer(Max52419, 0, 0, 1, 0, Zer87572), 
LSub3134 = subtract_layer(Res93281,Zer87572, Sub3134), 
LRes93339 = reshape_layer(Sub3134, [2, 2, 1, 1], Res93339), 
LCon4569 = conv3D_layer(Res93339, 2, 2, 1,[[[[[0.7846, 0.8161, 0.0058]]], [[[0.1111, 0.5771, 0.1461]]]], [[[[0.6996, 0.9376, 0.3136]]], [[[0.5035, 0.1182, 0.5956]]]]],[0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con4569), 
LRes49010 = reshape_layer(Con4569, [2, 2, 3], Res49010), 
LRes6783 = reshape_layer(Res49010, [2, 6], Res6783), 
LMax74253 = max_pool1D_layer([[[1.2024, 1.0875]]], 1, Max74253), 
LLoc61729 = locally_connected1D_layer(Max74253, 1,[[[0.8688, 0.3984], [0.9748, 0.2852]]],[[0, 0]], 4, Loc61729), 
LZer68409 = zero_padding1D_layer(Loc61729, 1, 0, Zer68409), 
LCon10522 = concatenate_layer([Zer68409,[[[0.6158, 0.3296, 0.7582, 0.7904], [0.7944, 0.4124, 0.072, 0.2101]]]], 2, Con10522), 
LAdd73961 = add_layer([Res6783,Con10522], Add73961), 
LRes94971 = reshape_layer(Add73961, [2, 6, 1], Res94971), 
LMax21123 = max_pool2D_layer(Res94971, 1, 1, 1, 1, true, Max21123), 
exec_layers([LMin20474,LRes93281,LMax52419,LZer87572,LSub3134,LRes93339,LCon4569,LRes49010,LRes6783,LMax74253,LLoc61729,LZer68409,LCon10522,LAdd73961,LRes94971,LMax21123],["Min20474","Res93281","Max52419","Zer87572","Sub3134","Res93339","Con4569","Res49010","Res6783","Max74253","Loc61729","Zer68409","Con10522","Add73961","Res94971","Max21123"],Max21123,"Max21123")

Actual (Unparsed): [[[[0.3823855], [0.5433434], [0.6194068], [0.1158328], [0.4906144], [0.7223535]], [[2.4369280], [1.0352539], [0.7655480], [0.2433187], [-0.1038695], [0.2088501]]]]

Expected (Unparsed): [[[[0.3823854400000001],[0.54334344],[0.61940675],[0.11583282000000006],[0.49061437],[0.72235346]],[[2.43692801],[1.0352538999999998],[0.76554807],[0.24331870000000003],[-0.10386954999999999],[0.2088501]]]]

Actual:   [[[[0.3824], [0.5434], [0.6195], [0.1159], [0.4907], [0.7224]], [[2.437], [1.0353], [0.7656], [0.2434], [-0.1038], [0.2089]]]]

Expected: [[[[0.3824], [0.5434], [0.6195], [0.1159], [0.4907], [0.7224]], [[2.437], [1.0353], [0.7656], [0.2434], [-0.1038], [0.2089]]]]