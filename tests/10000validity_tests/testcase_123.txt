import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Min97412 = tf.keras.layers.Input(shape=([1, 1, 2]))
in1Min97412 = tf.keras.layers.Input(shape=([1, 1, 2]))
in0Con87728 = tf.keras.layers.Input(shape=([1, 2, 1]))
in0Con70213 = tf.keras.layers.Input(shape=([1, 2, 2]))

Min97412 = keras.layers.Minimum(name = 'Min97412', )([in0Min97412,in1Min97412])
Zer21443 = keras.layers.ZeroPadding2D(padding=((0, 0), (1, 0)), name = 'Zer21443', )(Min97412)
Con87728 = keras.layers.Concatenate(axis=3, name = 'Con87728', )([Zer21443,in0Con87728])
Con70213 = keras.layers.Conv2D(3, (1, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con70213', )(in0Con70213)
Add65972 = keras.layers.Add(name = 'Add65972', )([Con87728,Con70213])
Con28832 = keras.layers.Conv2DTranspose(2, (1, 1),strides=(1, 1), padding='valid', name = 'Con28832', )(Add65972)
Res46301 = keras.layers.Reshape((1, 2, 2, 1), name = 'Res46301', )(Con28832)
Con11292 = keras.layers.Conv3DTranspose(4, (1, 1, 2),strides=(1, 1, 1), padding='same', name = 'Con11292', )(Res46301)
Res97044 = keras.layers.Reshape((1, 2, 8), name = 'Res97044', )(Con11292)
Con7399 = keras.layers.Conv2D(3, (1, 1),strides=(1, 1), padding='same', dilation_rate=(1, 1), name = 'Con7399', )(Res97044)
model = tf.keras.models.Model(inputs=[in0Min97412,in1Min97412,in0Con87728,in0Con70213], outputs=Con7399)
w = model.get_layer('Con70213').get_weights() 
w[0] = np.array([[[[0.0245, 0.2681, 0.0575], [0.409, 0.0534, 0.5427]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con70213').set_weights(w) 
w = model.get_layer('Con28832').get_weights() 
w[0] = np.array([[[[0.018, 0.4781, 0.2002], [0.4107, 0.9011, 0.1712]]]])
w[1] = np.array([0, 0])
model.get_layer('Con28832').set_weights(w) 
w = model.get_layer('Con11292').get_weights() 
w[0] = np.array([[[[[0.6046], [0.2435], [0.6066], [0.3948]], [[0.8379], [0.5477], [0.6585], [0.9011]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con11292').set_weights(w) 
w = model.get_layer('Con7399').get_weights() 
w[0] = np.array([[[[0.8993, 0.6323, 0.1404], [0.7769, 0.3852, 0.1225], [0.907, 0.7536, 0.88], [0.5683, 0.6713, 0.3138], [0.3176, 0.5364, 0.3995], [0.0997, 0.1715, 0.0758], [0.2222, 0.3381, 0.9949], [0.9157, 0.5586, 0.0964]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con7399').set_weights(w) 
in0Min97412 = tf.constant([[[[0.4349, 0.2264]]]])
in1Min97412 = tf.constant([[[[0.0106, 0.678]]]])
in0Con87728 = tf.constant([[[[0.9024], [0.4443]]]])
in0Con70213 = tf.constant([[[[0.9715, 0.5381], [0.8072, 0.2962]]]])
print (np.array2string(model.predict([in0Min97412,in1Min97412,in0Con87728,in0Con70213],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con7399.png')

LMin97412 = minimum_layer([[[[[0.4349, 0.2264]]]], [[[[0.0106, 0.678]]]]], Min97412), 
LZer21443 = zero_padding2D_layer(Min97412, 0, 0, 1, 0, Zer21443), 
LCon87728 = concatenate_layer([Zer21443,[[[[0.9024], [0.4443]]]]], 3, Con87728), 
LCon70213 = conv2D_layer([[[[0.9715, 0.5381], [0.8072, 0.2962]]]], 1, 1,[[[[0.0245, 0.2681, 0.0575], [0.409, 0.0534, 0.5427]]]],[0, 0, 0], 1, 1, true, 1, 1, Con70213), 
LAdd65972 = add_layer([Con87728,Con70213], Add65972), 
LCon28832 = conv2D_transpose_layer(Add65972, 1, 1,[[[[0.018, 0.4781, 0.2002], [0.4107, 0.9011, 0.1712]]]],[0, 0], 1, 1, false, Con28832), 
LRes46301 = reshape_layer(Con28832, [1, 2, 2, 1], Res46301), 
LCon11292 = conv3D_transpose_layer(Res46301, 1, 1, 2,[[[[[0.6046], [0.2435], [0.6066], [0.3948]], [[0.8379], [0.5477], [0.6585], [0.9011]]]]],[0, 0, 0, 0], 1, 1, 1, true, Con11292), 
LRes97044 = reshape_layer(Con11292, [1, 2, 8], Res97044), 
LCon7399 = conv2D_layer(Res97044, 1, 1,[[[[0.8993, 0.6323, 0.1404], [0.7769, 0.3852, 0.1225], [0.907, 0.7536, 0.88], [0.5683, 0.6713, 0.3138], [0.3176, 0.5364, 0.3995], [0.0997, 0.1715, 0.0758], [0.2222, 0.3381, 0.9949], [0.9157, 0.5586, 0.0964]]]],[0, 0, 0], 1, 1, true, 1, 1, Con7399), 
exec_layers([LMin97412,LZer21443,LCon87728,LCon70213,LAdd65972,LCon28832,LRes46301,LCon11292,LRes97044,LCon7399],["Min97412","Zer21443","Con87728","Con70213","Add65972","Con28832","Res46301","Con11292","Res97044","Con7399"],Con7399,"Con7399")

Actual (Unparsed): [[[[1.5097502, 1.4247492, 1.2611832], [1.4049610, 1.3343866, 1.1955538]]]]

Expected (Unparsed): [[[[1.509750214080356,1.4247492262002424,1.261183232159477],[1.4049610163649588,1.3343866083922808,1.1955537983681788]]]]

Actual:   [[[[1.5098, 1.4248, 1.2612], [1.405, 1.3344, 1.1956]]]]

Expected: [[[[1.5098, 1.4248, 1.2612], [1.405, 1.3344, 1.1956]]]]