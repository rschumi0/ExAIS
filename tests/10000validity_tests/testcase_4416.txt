import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub93526 = tf.keras.layers.Input(shape=([2, 3]))
in1Sub93526 = tf.keras.layers.Input(shape=([2, 3]))
in0Con68804 = tf.keras.layers.Input(shape=([2, 3, 1]))
in0Ave92728 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con86621 = tf.keras.layers.Input(shape=([2, 3, 2, 1]))
in0Glo3160 = tf.keras.layers.Input(shape=([2, 2, 1]))

Sub93526 = keras.layers.Subtract(name = 'Sub93526', )([in0Sub93526,in1Sub93526])
Res4449 = keras.layers.Reshape((2, 3, 1), name = 'Res4449', )(Sub93526)
Con68804 = keras.layers.Concatenate(axis=3, name = 'Con68804', )([Res4449,in0Con68804])
Ave92728 = keras.layers.AveragePooling2D(pool_size=(1, 2), strides=(2, 1), padding='same', name = 'Ave92728', )(in0Ave92728)
Zer4693 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer4693', )(Ave92728)
Add44362 = keras.layers.Add(name = 'Add44362', )([Con68804,Zer4693])
Res75574 = keras.layers.Reshape((2, 3, 2, 1), name = 'Res75574', )(Add44362)
Con86621 = keras.layers.Concatenate(axis=4, name = 'Con86621', )([Res75574,in0Con86621])
Glo3160 = keras.layers.GlobalMaxPool2D(name = 'Glo3160', )(in0Glo3160)
Thr23469 = keras.layers.ThresholdedReLU(theta=8.052337225204303, name = 'Thr23469', )(Glo3160)
Res2271 = keras.layers.Reshape((1, 1), name = 'Res2271', )(Thr23469)
Res39351 = keras.layers.Reshape((1, 1, 1), name = 'Res39351', )(Res2271)
Res50794 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res50794', )(Res39351)
Con62424 = keras.layers.Conv3D(2, (1, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con62424', )(Res50794)
Zer53346 = keras.layers.ZeroPadding3D(padding=((1, 0), (2, 0), (1, 0)), name = 'Zer53346', )(Con62424)
Ave6880 = keras.layers.Average(name = 'Ave6880', )([Con86621,Zer53346])
model = tf.keras.models.Model(inputs=[in0Sub93526,in1Sub93526,in0Con68804,in0Ave92728,in0Con86621,in0Glo3160], outputs=Ave6880)
w = model.get_layer('Con62424').get_weights() 
w[0] = np.array([[[[[0.6815, 0.2166]]]]])
w[1] = np.array([0, 0])
model.get_layer('Con62424').set_weights(w) 
in0Sub93526 = tf.constant([[[0.6784, 0.4331, 0.0013], [0.189, 0.1546, 0.2398]]])
in1Sub93526 = tf.constant([[[0.4524, 0.6299, 0.0798], [0.4789, 0.8472, 0.7956]]])
in0Con68804 = tf.constant([[[[0.333], [0.8609], [0.8655]], [[0.4047], [0.1061], [0.5074]]]])
in0Ave92728 = tf.constant([[[[1.7762, 1.6297], [1.6324, 1.6846]], [[1.7442, 1.1592], [1.4793, 1.3742]]]])
in0Con86621 = tf.constant([[[[[0.6301], [0.6743]], [[0.8015], [0.973]], [[0.3588], [0.3717]]], [[[0.6551], [0.1721]], [[0.9181], [0.3298]], [[0.7354], [0.8603]]]]])
in0Glo3160 = tf.constant([[[[1.8631], [1.9211]], [[1.0879], [1.8772]]]])
print (np.array2string(model.predict([in0Sub93526,in1Sub93526,in0Con68804,in0Ave92728,in0Con86621,in0Glo3160],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave6880.png')

LSub93526 = subtract_layer([[[0.6784, 0.4331, 0.0013], [0.189, 0.1546, 0.2398]]], [[[0.4524, 0.6299, 0.0798], [0.4789, 0.8472, 0.7956]]], Sub93526), 
LRes4449 = reshape_layer(Sub93526, [2, 3, 1], Res4449), 
LCon68804 = concatenate_layer([Res4449,[[[[0.333], [0.8609], [0.8655]], [[0.4047], [0.1061], [0.5074]]]]], 3, Con68804), 
LAve92728 = average_pooling2D_layer([[[[1.7762, 1.6297], [1.6324, 1.6846]], [[1.7442, 1.1592], [1.4793, 1.3742]]]], 1, 2, 2, 1, true, Ave92728), 
LZer4693 = zero_padding2D_layer(Ave92728, 1, 0, 1, 0, Zer4693), 
LAdd44362 = add_layer([Con68804,Zer4693], Add44362), 
LRes75574 = reshape_layer(Add44362, [2, 3, 2, 1], Res75574), 
LCon86621 = concatenate_layer([Res75574,[[[[[0.6301], [0.6743]], [[0.8015], [0.973]], [[0.3588], [0.3717]]], [[[0.6551], [0.1721]], [[0.9181], [0.3298]], [[0.7354], [0.8603]]]]]], 4, Con86621), 
LGlo3160 = global_max_pool2D_layer([[[[1.8631], [1.9211]], [[1.0879], [1.8772]]]], Glo3160), 
LThr23469 = thresholded_relu_layer(Glo3160, 8.052337225204303, Thr23469), 
LRes2271 = reshape_layer(Thr23469, [1, 1], Res2271), 
LRes39351 = reshape_layer(Res2271, [1, 1, 1], Res39351), 
LRes50794 = reshape_layer(Res39351, [1, 1, 1, 1], Res50794), 
LCon62424 = conv3D_layer(Res50794, 1, 1, 1,[[[[[0.6815, 0.2166]]]]],[0, 0], 1, 1, 1, true, 1, 1, 1, Con62424), 
LZer53346 = zero_padding3D_layer(Con62424, 1, 0, 2, 0, 1, 0, Zer53346), 
LAve6880 = average_layer([Con86621,Zer53346], Ave6880), 
exec_layers([LSub93526,LRes4449,LCon68804,LAve92728,LZer4693,LAdd44362,LRes75574,LCon86621,LGlo3160,LThr23469,LRes2271,LRes39351,LRes50794,LCon62424,LZer53346,LAve6880],["Sub93526","Res4449","Con68804","Ave92728","Zer4693","Add44362","Res75574","Con86621","Glo3160","Thr23469","Res2271","Res39351","Res50794","Con62424","Zer53346","Ave6880"],Ave6880,"Ave6880")

Actual (Unparsed): [[[[[0.1130000, 0.3150500], [0.1665000, 0.3371500]], [[-0.0984000, 0.4007500], [0.4304500, 0.4865000]], [[-0.0392500, 0.1794000], [0.4327500, 0.1858500]]], [[[-0.1449500, 0.3275500], [0.2023500, 0.0860500]], [[0.5058500, 0.4590500], [0.8816250, 0.1649000]], [[0.5383000, 0.3677000], [1.0960000, 0.4301500]]]]]

Expected (Unparsed): [[[[[0.11299999999999999,0.31505],[0.1665,0.33715]],[[-0.09840000000000002,0.40075],[0.43045,0.4865]],[[-0.03925,0.1794],[0.43275,0.18585]]],[[[-0.14495,0.32755],[0.20235,0.08605]],[[0.5058499999999999,0.45905],[0.8816250000000001,0.1649]],[[0.5383,0.3677],[1.096,0.43015]]]]]

Actual:   [[[[[0.113, 0.3151], [0.1665, 0.3372]], [[-0.0984, 0.4008], [0.4305, 0.4865]], [[-0.0392, 0.1794], [0.4328, 0.1859]]], [[[-0.1449, 0.3276], [0.2024, 0.0861]], [[0.5059, 0.4591], [0.8817, 0.1649]], [[0.5383, 0.3677], [1.096, 0.4302]]]]]

Expected: [[[[[0.113, 0.3151], [0.1665, 0.3372]], [[-0.0984, 0.4008], [0.4305, 0.4865]], [[-0.0392, 0.1794], [0.4328, 0.1859]]], [[[-0.1449, 0.3276], [0.2024, 0.0861]], [[0.5059, 0.4591], [0.8817, 0.1649]], [[0.5383, 0.3677], [1.096, 0.4302]]]]]