import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave72562 = tf.keras.layers.Input(shape=([2, 1, 1]))
in1Ave72562 = tf.keras.layers.Input(shape=([2, 1, 1]))
in0Dot83825 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot83825 = tf.keras.layers.Input(shape=([3, 2]))
in0Con51610 = tf.keras.layers.Input(shape=([5, 6]))

Ave72562 = keras.layers.Average(name = 'Ave72562', )([in0Ave72562,in1Ave72562])
Res95928 = keras.layers.Reshape((2, 1), name = 'Res95928', )(Ave72562)
Sim95084 = keras.layers.SimpleRNN(3,name = 'Sim95084', )(Res95928)
Res86311 = keras.layers.Reshape((3, 1), name = 'Res86311', )(Sim95084)
Res27055 = keras.layers.Reshape((3, 1, 1), name = 'Res27055', )(Res86311)
Res13255 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res13255', )(Res27055)
Zer20680 = keras.layers.ZeroPadding3D(padding=((1, 1), (1, 1), (1, 1)), name = 'Zer20680', )(Res13255)
Res50577 = keras.layers.Reshape((5, 3, 3), name = 'Res50577', )(Zer20680)
Res49775 = keras.layers.Reshape((5, 9), name = 'Res49775', )(Res50577)
Dot83825 = keras.layers.Dot(axes=(2, 2), name = 'Dot83825', )([in0Dot83825,in1Dot83825])
Zer86217 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer86217', )(Dot83825)
Con51610 = keras.layers.Concatenate(axis=2, name = 'Con51610', )([Zer86217,in0Con51610])
Max41365 = keras.layers.Maximum(name = 'Max41365', )([Res49775,Con51610])
Con72679 = keras.layers.Conv1D(2, (2),strides=(1), padding='valid', dilation_rate=(1), name = 'Con72679', )(Max41365)
model = tf.keras.models.Model(inputs=[in0Ave72562,in1Ave72562,in0Dot83825,in1Dot83825,in0Con51610], outputs=Con72679)
w = model.get_layer('Sim95084').get_weights() 
w[0] = np.array([[6, 9, 10]])
w[1] = np.array([[5, 4, 8], [4, 8, 2], [10, 5, 2]])
w[2] = np.array([4, 3, 5])
model.get_layer('Sim95084').set_weights(w) 
w = model.get_layer('Con72679').get_weights() 
w[0] = np.array([[[0.0904, 0.1286], [0.2539, 0.0436], [0.1261, 0.806], [0.3287, 0.4906], [0.1541, 0.2898], [0.6132, 0.7213], [0.1187, 0.5603], [0.0697, 0.8729], [0.4569, 0.7066]], [[0.2701, 0.8019], [0.8102, 0.9213], [0.0318, 0.1513], [0.2568, 0.5185], [0.2176, 0.9962], [0.5522, 0.0493], [0.9487, 0.2159], [0.9239, 0.3431], [0.2408, 0.3281]]])
w[1] = np.array([0, 0])
model.get_layer('Con72679').set_weights(w) 
in0Ave72562 = tf.constant([[[[0.6333]], [[0.3332]]]])
in1Ave72562 = tf.constant([[[[0.5501]], [[0.5645]]]])
in0Dot83825 = tf.constant([[[0.4529, 0.3306], [0.8179, 0.1156], [0.0927, 0.0833]]])
in1Dot83825 = tf.constant([[[0.12, 0.7697], [0.983, 0.1669], [0.7145, 0.5514]]])
in0Con51610 = tf.constant([[[0.0241, 0.5355, 0.5176, 0.347, 0.0847, 0.5365], [0.4483, 0.3962, 0.7417, 0.5107, 0.3264, 0.0304], [0.2238, 0.4127, 0.8302, 0.4061, 0.4908, 0.6197], [0.7243, 0.6574, 0.4124, 0.9078, 0.0155, 0.6114], [0.8677, 0.4896, 0.291, 0.7139, 0.7008, 0.3316]]])
print (np.array2string(model.predict([in0Ave72562,in1Ave72562,in0Dot83825,in1Dot83825,in0Con51610],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con72679.png')

LAve72562 = average_layer([[[[[0.6333]], [[0.3332]]]], [[[[0.5501]], [[0.5645]]]]], Ave72562), 
LRes95928 = reshape_layer(Ave72562, [2, 1], Res95928), 
LSim95084 = simple_rnn_layer(Res95928,[[6, 9, 10]],[[5, 4, 8], [4, 8, 2], [10, 5, 2]],[4, 3, 5], Sim95084), 
LRes86311 = reshape_layer(Sim95084, [3, 1], Res86311), 
LRes27055 = reshape_layer(Res86311, [3, 1, 1], Res27055), 
LRes13255 = reshape_layer(Res27055, [3, 1, 1, 1], Res13255), 
LZer20680 = zero_padding3D_layer(Res13255, 1, 1, 1, 1, 1, 1, Zer20680), 
LRes50577 = reshape_layer(Zer20680, [5, 3, 3], Res50577), 
LRes49775 = reshape_layer(Res50577, [5, 9], Res49775), 
LDot83825 = dot_layer([[[0.4529, 0.3306], [0.8179, 0.1156], [0.0927, 0.0833]]], [[[0.12, 0.7697], [0.983, 0.1669], [0.7145, 0.5514]]], 2, 2, Dot83825), 
LZer86217 = zero_padding1D_layer(Dot83825, 2, 0, Zer86217), 
LCon51610 = concatenate_layer([Zer86217,[[[0.0241, 0.5355, 0.5176, 0.347, 0.0847, 0.5365], [0.4483, 0.3962, 0.7417, 0.5107, 0.3264, 0.0304], [0.2238, 0.4127, 0.8302, 0.4061, 0.4908, 0.6197], [0.7243, 0.6574, 0.4124, 0.9078, 0.0155, 0.6114], [0.8677, 0.4896, 0.291, 0.7139, 0.7008, 0.3316]]]], 2, Con51610), 
LMax41365 = maximum_layer([Res49775,Con51610], Max41365), 
LCon72679 = conv1D_layer(Max41365, 2,[[[0.0904, 0.1286], [0.2539, 0.0436], [0.1261, 0.806], [0.3287, 0.4906], [0.1541, 0.2898], [0.6132, 0.7213], [0.1187, 0.5603], [0.0697, 0.8729], [0.4569, 0.7066]], [[0.2701, 0.8019], [0.8102, 0.9213], [0.0318, 0.1513], [0.2568, 0.5185], [0.2176, 0.9962], [0.5522, 0.0493], [0.9487, 0.2159], [0.9239, 0.3431], [0.2408, 0.3281]]],[0, 0], 1, false, 1, Con72679), 
exec_layers([LAve72562,LRes95928,LSim95084,LRes86311,LRes27055,LRes13255,LZer20680,LRes50577,LRes49775,LDot83825,LZer86217,LCon51610,LMax41365,LCon72679],["Ave72562","Res95928","Sim95084","Res86311","Res27055","Res13255","Zer20680","Res50577","Res49775","Dot83825","Zer86217","Con51610","Max41365","Con72679"],Con72679,"Con72679")

Actual (Unparsed): [[[2.2357264, 2.6852374], [3.0798790, 4.0350024], [3.7133357, 5.3621413], [3.3445545, 4.1085735]]]

Expected (Unparsed): [[[2.2357264299999997,2.68523744],[3.0798790369519993,4.035002440907],[3.7133357072349997,5.362141328972999],[3.3445544388940003,4.108573482067]]]

Actual:   [[[2.2358, 2.6853], [3.0799, 4.0351], [3.7134, 5.3622], [3.3446, 4.1086]]]

Expected: [[[2.2358, 2.6853], [3.0799, 4.0351], [3.7134, 5.3622], [3.3446, 4.1086]]]