import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Fla49990 = tf.keras.layers.Input(shape=([2, 4]))
in0Con55367 = tf.keras.layers.Input(shape=([2, 4, 1, 1]))
in0Sub83501 = tf.keras.layers.Input(shape=([3, 2]))
in1Sub83501 = tf.keras.layers.Input(shape=([3, 2]))
in0Con46623 = tf.keras.layers.Input(shape=([2, 4, 1, 1]))
in0Ave34268 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))
in1Ave34268 = tf.keras.layers.Input(shape=([1, 2, 1, 2]))

Fla49990 = keras.layers.Flatten(name = 'Fla49990', )(in0Fla49990)
Res29118 = keras.layers.Reshape((8, 1), name = 'Res29118', )(Fla49990)
Res11001 = keras.layers.Reshape((8, 1, 1), name = 'Res11001', )(Res29118)
Con770 = keras.layers.Conv2DTranspose(3, (8, 1),strides=(1, 1), padding='same', name = 'Con770', )(Res11001)
Res27983 = keras.layers.Reshape((8, 3), name = 'Res27983', )(Con770)
Sim54819 = keras.layers.SimpleRNN(2,name = 'Sim54819', )(Res27983)
Res82057 = keras.layers.Reshape((2, 1), name = 'Res82057', )(Sim54819)
Res14216 = keras.layers.Reshape((2, 1, 1), name = 'Res14216', )(Res82057)
Res78520 = keras.layers.Reshape((2, 1, 1, 1), name = 'Res78520', )(Res14216)
Zer33507 = keras.layers.ZeroPadding3D(padding=((0, 0), (3, 0), (0, 0)), name = 'Zer33507', )(Res78520)
Con55367 = keras.layers.Concatenate(axis=4, name = 'Con55367', )([Zer33507,in0Con55367])
Sub83501 = keras.layers.Subtract(name = 'Sub83501', )([in0Sub83501,in1Sub83501])
Lea35844 = keras.layers.LeakyReLU(alpha=6.390120464306829, name = 'Lea35844', )(Sub83501)
Sep43408 = keras.layers.SeparableConv1D(4, (2),strides=(2), padding='same', name = 'Sep43408', )(Lea35844)
Res20528 = keras.layers.Reshape((2, 4, 1), name = 'Res20528', )(Sep43408)
Res30700 = keras.layers.Reshape((2, 4, 1, 1), name = 'Res30700', )(Res20528)
Con46623 = keras.layers.Concatenate(axis=4, name = 'Con46623', )([Res30700,in0Con46623])
Ave34268 = keras.layers.Average(name = 'Ave34268', )([in0Ave34268,in1Ave34268])
Sof3577 = keras.layers.Softmax(axis=1, name = 'Sof3577', )(Ave34268)
PRe91401 = keras.layers.PReLU(name = 'PRe91401', )(Sof3577)
Zer18935 = keras.layers.ZeroPadding3D(padding=((1, 0), (2, 0), (0, 0)), name = 'Zer18935', )(PRe91401)
Min79722 = keras.layers.Minimum(name = 'Min79722', )([Con46623,Zer18935])
Mul64334 = keras.layers.Multiply(name = 'Mul64334', )([Con55367,Min79722])
model = tf.keras.models.Model(inputs=[in0Fla49990,in0Con55367,in0Sub83501,in1Sub83501,in0Con46623,in0Ave34268,in1Ave34268], outputs=Mul64334)
w = model.get_layer('Con770').get_weights() 
w[0] = np.array([[[[0.7418], [0.1798], [0.3735]]], [[[0.791], [0.3005], [0.6812]]], [[[0.7149], [0.9945], [0.3688]]], [[[0.0168], [0.2452], [0.367]]], [[[0.6573], [0.9692], [0.7171]]], [[[0.939], [0.9537], [0.1758]]], [[[0.2462], [0.1938], [0.8227]]], [[[0.2509], [0.6477], [0.593]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con770').set_weights(w) 
w = model.get_layer('Sim54819').get_weights() 
w[0] = np.array([[5, 4], [2, 6], [4, 9]])
w[1] = np.array([[10, 9], [3, 8]])
w[2] = np.array([8, 7])
model.get_layer('Sim54819').set_weights(w) 
w = model.get_layer('Sep43408').get_weights() 
w[0] = np.array([[[0.9433], [0.6306]], [[0.6842], [0.1861]]])
w[1] = np.array([[[0.0359, 0.3043, 0.1186, 0.1791], [0.0896, 0.9906, 0.1062, 0.5805]]])
w[2] = np.array([0, 0, 0, 0])
model.get_layer('Sep43408').set_weights(w) 
w = model.get_layer('PRe91401').get_weights() 
w[0] = np.array([[[[0.2556, 0.4041]], [[0.3466, 0.8602]]]])
model.get_layer('PRe91401').set_weights(w) 
in0Fla49990 = tf.constant([[[1.3991, 1.395, 1.9549, 1.4992], [1.2216, 1.0427, 1.107, 1.3925]]])
in0Con55367 = tf.constant([[[[[0.2338]], [[0.9029]], [[0.6135]], [[0.4775]]], [[[0.829]], [[0.3701]], [[0.5225]], [[0.5043]]]]])
in0Sub83501 = tf.constant([[[0.6426, 0.7247], [0.4027, 0.6747], [0.5501, 0.3696]]])
in1Sub83501 = tf.constant([[[0.6113, 0.8928], [0.6713, 0.3105], [0.1651, 0.9277]]])
in0Con46623 = tf.constant([[[[[0.4175]], [[0.4807]], [[0.3397]], [[0.4282]]], [[[0.3482]], [[0.5548]], [[0.8011]], [[0.4658]]]]])
in0Ave34268 = tf.constant([[[[[0.3502, 0.7786]], [[0.3318, 0.9014]]]]])
in1Ave34268 = tf.constant([[[[[0.851, 0.4354]], [[0.0628, 0.3344]]]]])
print (np.array2string(model.predict([in0Fla49990,in0Con55367,in0Sub83501,in1Sub83501,in0Con46623,in0Ave34268,in1Ave34268],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Mul64334.png')

LFla49990 = flatten_layer([[[1.3991, 1.395, 1.9549, 1.4992], [1.2216, 1.0427, 1.107, 1.3925]]], Fla49990), 
LRes29118 = reshape_layer(Fla49990, [8, 1], Res29118), 
LRes11001 = reshape_layer(Res29118, [8, 1, 1], Res11001), 
LCon770 = conv2D_transpose_layer(Res11001, 8, 1,[[[[0.7418], [0.1798], [0.3735]]], [[[0.791], [0.3005], [0.6812]]], [[[0.7149], [0.9945], [0.3688]]], [[[0.0168], [0.2452], [0.367]]], [[[0.6573], [0.9692], [0.7171]]], [[[0.939], [0.9537], [0.1758]]], [[[0.2462], [0.1938], [0.8227]]], [[[0.2509], [0.6477], [0.593]]]],[0, 0, 0], 1, 1, true, Con770), 
LRes27983 = reshape_layer(Con770, [8, 3], Res27983), 
LSim54819 = simple_rnn_layer(Res27983,[[5, 4], [2, 6], [4, 9]],[[10, 9], [3, 8]],[8, 7], Sim54819), 
LRes82057 = reshape_layer(Sim54819, [2, 1], Res82057), 
LRes14216 = reshape_layer(Res82057, [2, 1, 1], Res14216), 
LRes78520 = reshape_layer(Res14216, [2, 1, 1, 1], Res78520), 
LZer33507 = zero_padding3D_layer(Res78520, 0, 0, 3, 0, 0, 0, Zer33507), 
LCon55367 = concatenate_layer([Zer33507,[[[[[0.2338]], [[0.9029]], [[0.6135]], [[0.4775]]], [[[0.829]], [[0.3701]], [[0.5225]], [[0.5043]]]]]], 4, Con55367), 
LSub83501 = subtract_layer([[[0.6426, 0.7247], [0.4027, 0.6747], [0.5501, 0.3696]]], [[[0.6113, 0.8928], [0.6713, 0.3105], [0.1651, 0.9277]]], Sub83501), 
LLea35844 = leaky_relu_layer(Sub83501, 6.390120464306829, Lea35844), 
LSep43408 = separable_conv1D_layer(Lea35844, 2,[[[[0.9433], [0.6306]], [[0.6842], [0.1861]]],[[[0.0359, 0.3043, 0.1186, 0.1791], [0.0896, 0.9906, 0.1062, 0.5805]]]],[0, 0, 0, 0], 2, true, Sep43408), 
LRes20528 = reshape_layer(Sep43408, [2, 4, 1], Res20528), 
LRes30700 = reshape_layer(Res20528, [2, 4, 1, 1], Res30700), 
LCon46623 = concatenate_layer([Res30700,[[[[[0.4175]], [[0.4807]], [[0.3397]], [[0.4282]]], [[[0.3482]], [[0.5548]], [[0.8011]], [[0.4658]]]]]], 4, Con46623), 
LAve34268 = average_layer([[[[[[0.3502, 0.7786]], [[0.3318, 0.9014]]]]], [[[[[0.851, 0.4354]], [[0.0628, 0.3344]]]]]], Ave34268), 
LSof3577 = softmax_layer(Ave34268, 1, Sof3577), 
LPRe91401 = prelu_layer(Sof3577, [[[[0.2556, 0.4041]], [[0.3466, 0.8602]]]], PRe91401), 
LZer18935 = zero_padding3D_layer(PRe91401, 1, 0, 2, 0, 0, 0, Zer18935), 
LMin79722 = minimum_layer([Con46623,Zer18935], Min79722), 
LMul64334 = multiply_layer([Con55367,Min79722], Mul64334), 
exec_layers([LFla49990,LRes29118,LRes11001,LCon770,LRes27983,LSim54819,LRes82057,LRes14216,LRes78520,LZer33507,LCon55367,LSub83501,LLea35844,LSep43408,LRes20528,LRes30700,LCon46623,LAve34268,LSof3577,LPRe91401,LZer18935,LMin79722,LMul64334],["Fla49990","Res29118","Res11001","Con770","Res27983","Sim54819","Res82057","Res14216","Res78520","Zer33507","Con55367","Sub83501","Lea35844","Sep43408","Res20528","Res30700","Con46623","Ave34268","Sof3577","PRe91401","Zer18935","Min79722","Mul64334"],Mul64334,"Mul64334")

Actual (Unparsed): [[[[[-0.0000000, 0.0000000]], [[-0.0000000, 0.0000000]], [[-0.0000000, 0.0000000]], [[-0.5589111, 0.0000000]]], [[[-0.0000000, 0.0000000]], [[-0.0000000, 0.0000000]], [[-0.0000000, 0.4185747]], [[-1.2404573, 0.2349029]]]]]

Expected (Unparsed): [[[[[-0.0,0.0]],[[-0.0,0.0]],[[-0.0,0.0]],[[-0.5589110749724069,0.0]]],[[[-0.0,0.0]],[[-0.0,0.0]],[[-0.0,0.41857475]],[[-1.2404573124938794,0.23490293999999998]]]]]

Actual:   [[[[[-0, 0]], [[-0, 0]], [[-0, 0]], [[-0.5589, 0]]], [[[-0, 0]], [[-0, 0]], [[-0, 0.4186]], [[-1.2404, 0.235]]]]]

Expected: [[[[[-0, 0]], [[-0, 0]], [[-0, 0]], [[-0.5589, 0]]], [[[-0, 0]], [[-0, 0]], [[-0, 0.4186]], [[-1.2404, 0.235]]]]]