import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Sub79735 = tf.keras.layers.Input(shape=([3, 2, 2]))
in1Sub79735 = tf.keras.layers.Input(shape=([3, 2, 2]))
in0Loc18616 = tf.keras.layers.Input(shape=([1, 1]))
in0Con73463 = tf.keras.layers.Input(shape=([3, 2, 1]))

Sub79735 = keras.layers.Subtract(name = 'Sub79735', )([in0Sub79735,in1Sub79735])
Loc18616 = keras.layers.LocallyConnected1D(2, (1),strides=(1), name = 'Loc18616', )(in0Loc18616)
Ave39886 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave39886', )(Loc18616)
Fla29604 = keras.layers.Flatten(name = 'Fla29604', )(Ave39886)
Res50075 = keras.layers.Reshape((2, 1), name = 'Res50075', )(Fla29604)
Res4577 = keras.layers.Reshape((2, 1, 1), name = 'Res4577', )(Res50075)
Ave98285 = keras.layers.AveragePooling2D(pool_size=(1, 1), strides=(1, 12), padding='valid', name = 'Ave98285', )(Res4577)
Zer96747 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer96747', )(Ave98285)
Con73463 = keras.layers.Concatenate(axis=3, name = 'Con73463', )([Zer96747,in0Con73463])
Max10894 = keras.layers.Maximum(name = 'Max10894', )([Sub79735,Con73463])
Con92785 = keras.layers.Conv2DTranspose(2, (2, 2),strides=(1, 1), padding='same', name = 'Con92785', )(Max10894)
model = tf.keras.models.Model(inputs=[in0Sub79735,in1Sub79735,in0Loc18616,in0Con73463], outputs=Con92785)
w = model.get_layer('Loc18616').get_weights() 
w[0] = np.array([[[0.8888, 0.6748]]])
w[1] = np.array([[0, 0]])
model.get_layer('Loc18616').set_weights(w) 
w = model.get_layer('Con92785').get_weights() 
w[0] = np.array([[[[0.6173, 0.0272], [0.4716, 0.0247]], [[0.8079, 0.2526], [0.1071, 0.007]]], [[[0.8823, 0.8223], [0.5704, 0.1296]], [[0.2983, 0.2766], [0.2826, 0.9563]]]])
w[1] = np.array([0, 0])
model.get_layer('Con92785').set_weights(w) 
in0Sub79735 = tf.constant([[[[0.5597, 0.4406], [0.4076, 0.9567]], [[0.1198, 0.0325], [0.2935, 0.0962]], [[0.8353, 0.2259], [0.1885, 0.6495]]]])
in1Sub79735 = tf.constant([[[[0.8932, 0.2698], [0.0615, 0.1879]], [[0.7006, 0.8864], [0.1071, 0.1841]], [[0.4608, 0.0413], [0.3928, 0.0786]]]])
in0Loc18616 = tf.constant([[[0.5002]]])
in0Con73463 = tf.constant([[[[0.1021], [0.3152]], [[0.237], [0.1317]], [[0.8864], [0.7156]]]])
print (np.array2string(model.predict([in0Sub79735,in1Sub79735,in0Loc18616,in0Con73463],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Con92785.png')

LSub79735 = subtract_layer([[[[0.5597, 0.4406], [0.4076, 0.9567]], [[0.1198, 0.0325], [0.2935, 0.0962]], [[0.8353, 0.2259], [0.1885, 0.6495]]]], [[[[0.8932, 0.2698], [0.0615, 0.1879]], [[0.7006, 0.8864], [0.1071, 0.1841]], [[0.4608, 0.0413], [0.3928, 0.0786]]]], Sub79735), 
LLoc18616 = locally_connected1D_layer([[[0.5002]]], 1,[[[0.8888, 0.6748]]],[[0, 0]], 1, Loc18616), 
LAve39886 = average_pooling1D_layer(Loc18616, 1, Ave39886), 
LFla29604 = flatten_layer(Ave39886, Fla29604), 
LRes50075 = reshape_layer(Fla29604, [2, 1], Res50075), 
LRes4577 = reshape_layer(Res50075, [2, 1, 1], Res4577), 
LAve98285 = average_pooling2D_layer(Res4577, 1, 1, 1, 12, false, Ave98285), 
LZer96747 = zero_padding2D_layer(Ave98285, 1, 0, 1, 0, Zer96747), 
LCon73463 = concatenate_layer([Zer96747,[[[[0.1021], [0.3152]], [[0.237], [0.1317]], [[0.8864], [0.7156]]]]], 3, Con73463), 
LMax10894 = maximum_layer([Sub79735,Con73463], Max10894), 
LCon92785 = conv2D_transpose_layer(Max10894, 2, 2,[[[[0.6173, 0.0272], [0.4716, 0.0247]], [[0.8079, 0.2526], [0.1071, 0.007]]], [[[0.8823, 0.8223], [0.5704, 0.1296]], [[0.2983, 0.2766], [0.2826, 0.9563]]]],[0, 0], 1, 1, true, Con92785), 
exec_layers([LSub79735,LLoc18616,LAve39886,LFla29604,LRes50075,LRes4577,LAve98285,LZer96747,LCon73463,LMax10894,LCon92785],["Sub79735","Loc18616","Ave39886","Fla29604","Res50075","Res4577","Ave98285","Zer96747","Con73463","Max10894","Con92785"],Con92785,"Con92785")

Actual (Unparsed): [[[[0.0046458, 0.0042188], [0.2777030, 0.1834057]], [[0.1468952, 0.0279896], [1.3226778, 0.6749628]], [[0.4501741, 0.2292235], [1.3203899, 0.7204691]]]]

Expected (Unparsed): [[[[0.00464576,0.00421876],[0.27770297,0.18340572]],[[0.14689524,0.02798958],[1.3226778412479998,0.674962821616]],[[0.45017403,0.22922348000000003],[1.320389908456,0.7204691314400001]]]]

Actual:   [[[[0.0047, 0.0043], [0.2778, 0.1835]], [[0.1469, 0.028], [1.3227, 0.675]], [[0.4502, 0.2293], [1.3204, 0.7205]]]]

Expected: [[[[0.0047, 0.0043], [0.2778, 0.1835]], [[0.1469, 0.028], [1.3227, 0.675]], [[0.4502, 0.2293], [1.3204, 0.7205]]]]