import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Lay73113 = tf.keras.layers.Input(shape=([3, 1]))
in0Con22326 = tf.keras.layers.Input(shape=([3, 1, 3, 3]))
in0Up_34428 = tf.keras.layers.Input(shape=([1, 2]))

Lay73113 = keras.layers.LayerNormalization(axis=2, epsilon=2.5011670656975173, name = 'Lay73113', )(in0Lay73113)
Ave24839 = keras.layers.AveragePooling1D(pool_size=(1), name = 'Ave24839', )(Lay73113)
Lay93664 = keras.layers.LayerNormalization(axis=1, epsilon=1.4306867683037188, name = 'Lay93664', )(Ave24839)
Res55355 = keras.layers.Reshape((3, 1, 1), name = 'Res55355', )(Lay93664)
Res39444 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res39444', )(Res55355)
Zer79501 = keras.layers.ZeroPadding3D(padding=((0, 0), (0, 0), (2, 0)), name = 'Zer79501', )(Res39444)
Con22326 = keras.layers.Concatenate(axis=4, name = 'Con22326', )([Zer79501,in0Con22326])
Up_34428 = keras.layers.UpSampling1D(size=(2), name = 'Up_34428', )(in0Up_34428)
Res23047 = keras.layers.Reshape((2, 2, 1), name = 'Res23047', )(Up_34428)
Con70358 = keras.layers.Conv2DTranspose(3, (2, 2),strides=(2, 1), padding='valid', name = 'Con70358', )(Res23047)
Res83293 = keras.layers.Reshape((4, 3, 3, 1), name = 'Res83293', )(Con70358)
Cro51582 = keras.layers.Cropping3D(cropping=((1, 2), (0, 2), (1, 0)), name = 'Cro51582', )(Res83293)
Con6443 = keras.layers.Conv3D(4, (1, 1, 1),strides=(1, 1, 1), padding='valid', dilation_rate=(1, 1, 1), name = 'Con6443', )(Cro51582)
Zer81090 = keras.layers.ZeroPadding3D(padding=((2, 0), (0, 0), (1, 0)), name = 'Zer81090', )(Con6443)
Ave59439 = keras.layers.Average(name = 'Ave59439', )([Con22326,Zer81090])
model = tf.keras.models.Model(inputs=[in0Lay73113,in0Con22326,in0Up_34428], outputs=Ave59439)
w = model.get_layer('Con70358').get_weights() 
w[0] = np.array([[[[0.8128], [0.831], [0.5425]], [[0.3976], [0.1473], [0.1039]]], [[[0.1944], [0.4844], [0.8575]], [[0.7494], [0.6416], [0.9995]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con70358').set_weights(w) 
w = model.get_layer('Con6443').get_weights() 
w[0] = np.array([[[[[0.5046, 0.2453, 0.1083, 0.6646]]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con6443').set_weights(w) 
in0Lay73113 = tf.constant([[[1.4064], [1.6282], [1.1897]]])
in0Con22326 = tf.constant([[[[[0.7852, 0.4134, 0.6826], [0.9542, 0.1071, 0.0449], [0.8826, 0.9051, 0.22]]], [[[0.6704, 0.5703, 0.9693], [0.8816, 0.195, 0.4841], [0.1823, 0.9865, 0.0764]]], [[[0.0593, 0.8468, 0.0289], [0.3203, 0.2329, 0.2766], [0.9485, 0.1189, 0.0009]]]]])
in0Up_34428 = tf.constant([[[1.3658, 1.2911]]])
print (np.array2string(model.predict([in0Lay73113,in0Con22326,in0Up_34428],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave59439.png')

LLay73113 = layer_normalization_layer([[[1.4064], [1.6282], [1.1897]]], 2, 2.5011670656975173, Lay73113), 
LAve24839 = average_pooling1D_layer(Lay73113, 1, Ave24839), 
LLay93664 = layer_normalization_layer(Ave24839, 1, 1.4306867683037188, Lay93664), 
LRes55355 = reshape_layer(Lay93664, [3, 1, 1], Res55355), 
LRes39444 = reshape_layer(Res55355, [3, 1, 1, 1], Res39444), 
LZer79501 = zero_padding3D_layer(Res39444, 0, 0, 0, 0, 2, 0, Zer79501), 
LCon22326 = concatenate_layer([Zer79501,[[[[[0.7852, 0.4134, 0.6826], [0.9542, 0.1071, 0.0449], [0.8826, 0.9051, 0.22]]], [[[0.6704, 0.5703, 0.9693], [0.8816, 0.195, 0.4841], [0.1823, 0.9865, 0.0764]]], [[[0.0593, 0.8468, 0.0289], [0.3203, 0.2329, 0.2766], [0.9485, 0.1189, 0.0009]]]]]], 4, Con22326), 
LUp_34428 = up_sampling1D_layer([[[1.3658, 1.2911]]], 2, Up_34428), 
LRes23047 = reshape_layer(Up_34428, [2, 2, 1], Res23047), 
LCon70358 = conv2D_transpose_layer(Res23047, 2, 2,[[[[0.8128], [0.831], [0.5425]], [[0.3976], [0.1473], [0.1039]]], [[[0.1944], [0.4844], [0.8575]], [[0.7494], [0.6416], [0.9995]]]],[0, 0, 0], 2, 1, false, Con70358), 
LRes83293 = reshape_layer(Con70358, [4, 3, 3, 1], Res83293), 
LCro51582 = cropping3D_layer(Res83293, 1, 2, 0, 2, 1, 0, Cro51582), 
LCon6443 = conv3D_layer(Cro51582, 1, 1, 1,[[[[[0.5046, 0.2453, 0.1083, 0.6646]]]]],[0, 0, 0, 0], 1, 1, 1, false, 1, 1, 1, Con6443), 
LZer81090 = zero_padding3D_layer(Con6443, 2, 0, 0, 0, 1, 0, Zer81090), 
LAve59439 = average_layer([Con22326,Zer81090], Ave59439), 
exec_layers([LLay73113,LAve24839,LLay93664,LRes55355,LRes39444,LZer79501,LCon22326,LUp_34428,LRes23047,LCon70358,LRes83293,LCro51582,LCon6443,LZer81090,LAve59439],["Lay73113","Ave24839","Lay93664","Res55355","Res39444","Zer79501","Con22326","Up_34428","Res23047","Con70358","Res83293","Cro51582","Con6443","Zer81090","Ave59439"],Ave59439,"Ave59439")

Actual (Unparsed): [[[[[0.0000000, 0.3926000, 0.2067000, 0.3413000], [0.0000000, 0.4771000, 0.0535500, 0.0224500], [0.0000000, 0.4413000, 0.4525500, 0.1100000]]], [[[0.0000000, 0.3352000, 0.2851500, 0.4846500], [0.0000000, 0.4408000, 0.0975000, 0.2420500], [0.0000000, 0.0911500, 0.4932500, 0.0382000]]], [[[0.0000000, 0.0296500, 0.4234000, 0.0144500], [0.1669200, 0.2412945, 0.1522753, 0.3581475], [0.2954871, 0.6178944, 0.1228690, 0.3896310]]]]]

Expected (Unparsed): [[[[[0,0.3926,0.2067,0.3413],[0,0.4771,0.05355,0.02245],[0.0,0.4413,0.45255,0.11]]],[[[0,0.3352,0.28515,0.48465],[0,0.4408,0.0975,0.24205],[0.0,0.09115,0.49325,0.0382]]],[[[0,0.02965,0.4234,0.01445],[0.166920045096,0.24129444522799998,0.15227528910799998,0.358147526696],[0.29548707405,0.617894429775,0.122869045025,0.3896309540499999]]]]]

Actual:   [[[[[0, 0.3926, 0.2067, 0.3413], [0, 0.4771, 0.0536, 0.0225], [0, 0.4413, 0.4526, 0.11]]], [[[0, 0.3352, 0.2852, 0.4847], [0, 0.4408, 0.0975, 0.2421], [0, 0.0912, 0.4933, 0.0382]]], [[[0, 0.0297, 0.4234, 0.0145], [0.167, 0.2413, 0.1523, 0.3582], [0.2955, 0.6179, 0.1229, 0.3897]]]]]

Expected: [[[[[0, 0.3926, 0.2067, 0.3413], [0, 0.4771, 0.0536, 0.0225], [0, 0.4413, 0.4526, 0.11]]], [[[0, 0.3352, 0.2852, 0.4847], [0, 0.4408, 0.0975, 0.2421], [0, 0.0912, 0.4933, 0.0382]]], [[[0, 0.0297, 0.4234, 0.0145], [0.167, 0.2413, 0.1523, 0.3582], [0.2955, 0.6179, 0.1229, 0.3897]]]]]