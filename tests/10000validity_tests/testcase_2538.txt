import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Glo1108 = tf.keras.layers.Input(shape=([1, 2]))
in0Con76170 = tf.keras.layers.Input(shape=([1]))
in0Cro29404 = tf.keras.layers.Input(shape=([4, 3]))
in0Max65889 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Max65889 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con41812 = tf.keras.layers.Input(shape=([2]))
in0Con72827 = tf.keras.layers.Input(shape=([3, 3, 1, 1]))
in0Min17578 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Min17578 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

Glo1108 = keras.layers.GlobalMaxPool1D(name = 'Glo1108', )(in0Glo1108)
Con76170 = keras.layers.Concatenate(axis=1, name = 'Con76170', )([Glo1108,in0Con76170])
Cro29404 = keras.layers.Cropping1D(cropping=((3, 0)), name = 'Cro29404', )(in0Cro29404)
Fla77221 = keras.layers.Flatten(name = 'Fla77221', )(Cro29404)
Max65889 = keras.layers.Maximum(name = 'Max65889', )([in0Max65889,in1Max65889])
Res33921 = keras.layers.Reshape((2, 2), name = 'Res33921', )(Max65889)
GRU6085 = keras.layers.GRU(1,reset_after=False, recurrent_activation='sigmoid', name = 'GRU6085', )(Res33921)
Con41812 = keras.layers.Concatenate(axis=1, name = 'Con41812', )([GRU6085,in0Con41812])
Min67028 = keras.layers.Minimum(name = 'Min67028', )([Fla77221,Con41812])
Min21328 = keras.layers.Minimum(name = 'Min21328', )([Con76170,Min67028])
Res62277 = keras.layers.Reshape((3, 1), name = 'Res62277', )(Min21328)
Res27595 = keras.layers.Reshape((3, 1, 1), name = 'Res27595', )(Res62277)
Res24033 = keras.layers.Reshape((3, 1, 1, 1), name = 'Res24033', )(Res27595)
Zer69799 = keras.layers.ZeroPadding3D(padding=((0, 0), (2, 0), (0, 0)), name = 'Zer69799', )(Res24033)
Con72827 = keras.layers.Concatenate(axis=4, name = 'Con72827', )([Zer69799,in0Con72827])
Min17578 = keras.layers.Minimum(name = 'Min17578', )([in0Min17578,in1Min17578])
Zer36549 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (0, 0)), name = 'Zer36549', )(Min17578)
Ave53566 = keras.layers.Average(name = 'Ave53566', )([Con72827,Zer36549])
model = tf.keras.models.Model(inputs=[in0Glo1108,in0Con76170,in0Cro29404,in0Max65889,in1Max65889,in0Con41812,in0Con72827,in0Min17578,in1Min17578], outputs=Ave53566)
w = model.get_layer('GRU6085').get_weights() 
w[0] = np.array([[3, 4, 6], [9, 1, 2]])
w[1] = np.array([[7, 2, 9]])
w[2] = np.array([7, 1, 2])
model.get_layer('GRU6085').set_weights(w) 
in0Glo1108 = tf.constant([[[1.0114, 1.7059]]])
in0Con76170 = tf.constant([[0.459]])
in0Cro29404 = tf.constant([[[1.4886, 1.7718, 1.1838], [1.4149, 1.5681, 1.6302], [1.3893, 1.6384, 1.6275], [1.1264, 1.1256, 1.5863]]])
in0Max65889 = tf.constant([[[[0.1875, 0.8245]], [[0.9266, 0.0512]]]])
in1Max65889 = tf.constant([[[[0.9963, 0.8674]], [[0.56, 0.9463]]]])
in0Con41812 = tf.constant([[0.7019, 0.1467]])
in0Con72827 = tf.constant([[[[[0.1993]], [[0.3589]], [[0.125]]], [[[0.5465]], [[0.0598]], [[0.9375]]], [[[0.7576]], [[0.5062]], [[0.9599]]]]])
in0Min17578 = tf.constant([[[[[0.7796, 0.2185]], [[0.6407, 0.0991]]], [[[0.8239, 0.3463]], [[0.391, 0.8527]]]]])
in1Min17578 = tf.constant([[[[[0.9341, 0.3113]], [[0.249, 0.7582]]], [[[0.6051, 0.3999]], [[0.9076, 0.5274]]]]])
print (np.array2string(model.predict([in0Glo1108,in0Con76170,in0Cro29404,in0Max65889,in1Max65889,in0Con41812,in0Con72827,in0Min17578,in1Min17578],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Ave53566.png')

LGlo1108 = global_max_pool1D_layer([[[1.0114, 1.7059]]], Glo1108), 
LCon76170 = concatenate_layer([Glo1108,[[0.459]]], 1, Con76170), 
LCro29404 = cropping1D_layer([[[1.4886, 1.7718, 1.1838], [1.4149, 1.5681, 1.6302], [1.3893, 1.6384, 1.6275], [1.1264, 1.1256, 1.5863]]], 3, 0, Cro29404), 
LFla77221 = flatten_layer(Cro29404, Fla77221), 
LMax65889 = maximum_layer([[[[[0.1875, 0.8245]], [[0.9266, 0.0512]]]], [[[[0.9963, 0.8674]], [[0.56, 0.9463]]]]], Max65889), 
LRes33921 = reshape_layer(Max65889, [2, 2], Res33921), 
LGRU6085 = gru_layer(Res33921,[[3, 4, 6], [9, 1, 2]],[[7, 2, 9]],[7, 1, 2], false, GRU6085), 
LCon41812 = concatenate_layer([GRU6085,[[0.7019, 0.1467]]], 1, Con41812), 
LMin67028 = minimum_layer([Fla77221,Con41812], Min67028), 
LMin21328 = minimum_layer([Con76170,Min67028], Min21328), 
LRes62277 = reshape_layer(Min21328, [3, 1], Res62277), 
LRes27595 = reshape_layer(Res62277, [3, 1, 1], Res27595), 
LRes24033 = reshape_layer(Res27595, [3, 1, 1, 1], Res24033), 
LZer69799 = zero_padding3D_layer(Res24033, 0, 0, 2, 0, 0, 0, Zer69799), 
LCon72827 = concatenate_layer([Zer69799,[[[[[0.1993]], [[0.3589]], [[0.125]]], [[[0.5465]], [[0.0598]], [[0.9375]]], [[[0.7576]], [[0.5062]], [[0.9599]]]]]], 4, Con72827), 
LMin17578 = minimum_layer([[[[[[0.7796, 0.2185]], [[0.6407, 0.0991]]], [[[0.8239, 0.3463]], [[0.391, 0.8527]]]]], [[[[[0.9341, 0.3113]], [[0.249, 0.7582]]], [[[0.6051, 0.3999]], [[0.9076, 0.5274]]]]]], Min17578), 
LZer36549 = zero_padding3D_layer(Min17578, 1, 0, 1, 0, 0, 0, Zer36549), 
LAve53566 = average_layer([Con72827,Zer36549], Ave53566), 
exec_layers([LGlo1108,LCon76170,LCro29404,LFla77221,LMax65889,LRes33921,LGRU6085,LCon41812,LMin67028,LMin21328,LRes62277,LRes27595,LRes24033,LZer69799,LCon72827,LMin17578,LZer36549,LAve53566],["Glo1108","Con76170","Cro29404","Fla77221","Max65889","Res33921","GRU6085","Con41812","Min67028","Min21328","Res62277","Res27595","Res24033","Zer69799","Con72827","Min17578","Zer36549","Ave53566"],Ave53566,"Ave53566")

Actual (Unparsed): [[[[[0.0000000, 0.0996500]], [[0.0000000, 0.1794500]], [[0.0000000, 0.0625000]]], [[[0.0000000, 0.2732500]], [[0.3898000, 0.1391500]], [[0.4754500, 0.5183000]]], [[[0.0000000, 0.3788000]], [[0.3025500, 0.4262500]], [[0.2688500, 0.7436500]]]]]

Expected (Unparsed): [[[[[0,0.09965]],[[0,0.17945]],[[1.5004019560351886e-8,0.0625]]],[[[0,0.27325]],[[0.3898,0.13915]],[[0.47545,0.5183]]],[[[0,0.3788]],[[0.30255,0.42625]],[[0.26885000000000003,0.7436499999999999]]]]]

Actual:   [[[[[0, 0.0997]], [[0, 0.1795]], [[0, 0.0625]]], [[[0, 0.2733]], [[0.3898, 0.1392]], [[0.4755, 0.5183]]], [[[0, 0.3788]], [[0.3026, 0.4263]], [[0.2689, 0.7437]]]]]

Expected: [[[[[0, 0.0997]], [[0, 0.1795]], [[0, 0.0625]]], [[[0, 0.2733]], [[0.3898, 0.1392]], [[0.4755, 0.5183]]], [[[0, 0.3788]], [[0.3026, 0.4263]], [[0.2689, 0.7437]]]]]