import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Dot35887 = tf.keras.layers.Input(shape=([3, 2]))
in1Dot35887 = tf.keras.layers.Input(shape=([3, 2]))
in0Max63544 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Max63544 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con51521 = tf.keras.layers.Input(shape=([3, 3, 1, 1]))
in0Ave7541 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))
in1Ave7541 = tf.keras.layers.Input(shape=([2, 2, 1, 2]))

Dot35887 = keras.layers.Dot(axes=(2, 2), name = 'Dot35887', )([in0Dot35887,in1Dot35887])
Res61621 = keras.layers.Reshape((3, 3, 1), name = 'Res61621', )(Dot35887)
Max63544 = keras.layers.Maximum(name = 'Max63544', )([in0Max63544,in1Max63544])
Zer78992 = keras.layers.ZeroPadding2D(padding=((2, 0), (2, 0)), name = 'Zer78992', )(Max63544)
Max61312 = keras.layers.Maximum(name = 'Max61312', )([Res61621,Zer78992])
Res16907 = keras.layers.Reshape((3, 3, 1, 1), name = 'Res16907', )(Max61312)
Con51521 = keras.layers.Concatenate(axis=4, name = 'Con51521', )([Res16907,in0Con51521])
Ave7541 = keras.layers.Average(name = 'Ave7541', )([in0Ave7541,in1Ave7541])
Zer59377 = keras.layers.ZeroPadding3D(padding=((1, 0), (1, 0), (0, 0)), name = 'Zer59377', )(Ave7541)
Sub84495 = keras.layers.Subtract(name = 'Sub84495', )([Con51521,Zer59377])
model = tf.keras.models.Model(inputs=[in0Dot35887,in1Dot35887,in0Max63544,in1Max63544,in0Con51521,in0Ave7541,in1Ave7541], outputs=Sub84495)
in0Dot35887 = tf.constant([[[0.1557, 0.7006], [0.709, 0.9092], [0.9658, 0.0326]]])
in1Dot35887 = tf.constant([[[0.0788, 0.1649], [0.2066, 0.0333], [0.2358, 0.4409]]])
in0Max63544 = tf.constant([[[[0.9016]]]])
in1Max63544 = tf.constant([[[[0.2189]]]])
in0Con51521 = tf.constant([[[[[0.6611]], [[0.1979]], [[0.0791]]], [[[0.3198]], [[0.1535]], [[0.5682]]], [[[0.0173]], [[0.9823]], [[0.4637]]]]])
in0Ave7541 = tf.constant([[[[[0.627, 0.4982]], [[0.277, 0.2072]]], [[[0.2068, 0.6814]], [[0.2771, 0.2853]]]]])
in1Ave7541 = tf.constant([[[[[0.7208, 0.2236]], [[0.826, 0.7978]]], [[[0.8096, 0.3917]], [[0.1153, 0.3884]]]]])
print (np.array2string(model.predict([in0Dot35887,in1Dot35887,in0Max63544,in1Max63544,in0Con51521,in0Ave7541,in1Ave7541],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Sub84495.png')

LDot35887 = dot_layer([[[0.1557, 0.7006], [0.709, 0.9092], [0.9658, 0.0326]]], [[[0.0788, 0.1649], [0.2066, 0.0333], [0.2358, 0.4409]]], 2, 2, Dot35887), 
LRes61621 = reshape_layer(Dot35887, [3, 3, 1], Res61621), 
LMax63544 = maximum_layer([[[[[0.9016]]]], [[[[0.2189]]]]], Max63544), 
LZer78992 = zero_padding2D_layer(Max63544, 2, 0, 2, 0, Zer78992), 
LMax61312 = maximum_layer([Res61621,Zer78992], Max61312), 
LRes16907 = reshape_layer(Max61312, [3, 3, 1, 1], Res16907), 
LCon51521 = concatenate_layer([Res16907,[[[[[0.6611]], [[0.1979]], [[0.0791]]], [[[0.3198]], [[0.1535]], [[0.5682]]], [[[0.0173]], [[0.9823]], [[0.4637]]]]]], 4, Con51521), 
LAve7541 = average_layer([[[[[[0.627, 0.4982]], [[0.277, 0.2072]]], [[[0.2068, 0.6814]], [[0.2771, 0.2853]]]]], [[[[[0.7208, 0.2236]], [[0.826, 0.7978]]], [[[0.8096, 0.3917]], [[0.1153, 0.3884]]]]]], Ave7541), 
LZer59377 = zero_padding3D_layer(Ave7541, 1, 0, 1, 0, 0, 0, Zer59377), 
LSub84495 = subtract_layer(Con51521,Zer59377, Sub84495), 
exec_layers([LDot35887,LRes61621,LMax63544,LZer78992,LMax61312,LRes16907,LCon51521,LAve7541,LZer59377,LSub84495],["Dot35887","Res61621","Max63544","Zer78992","Max61312","Res16907","Con51521","Ave7541","Zer59377","Sub84495"],Sub84495,"Sub84495")

Actual (Unparsed): [[[[[0.1277981, 0.6611000]], [[0.0554976, 0.1979000]], [[0.3456086, 0.0791000]]], [[[0.2057963, 0.3198000]], [[-0.4971442, -0.2074000]], [[0.0165485, 0.0657000]]], [[[0.0814808, 0.0173000]], [[-0.3075801, 0.4457500]], [[0.7054000, 0.1268500]]]]]

Expected (Unparsed): [[[[[0.1277981,0.6611]],[[0.05549760000000001,0.1979]],[[0.3456086,0.0791]]],[[[0.20579628,0.3198]],[[-0.4971442399999999,-0.2074]],[[0.016548480000000088,0.06570000000000009]]],[[[0.08148078,0.0173]],[[-0.30758014,0.44575]],[[0.7053999999999999,0.12685000000000002]]]]]

Actual:   [[[[[0.1278, 0.6611]], [[0.0555, 0.1979]], [[0.3457, 0.0791]]], [[[0.2058, 0.3198]], [[-0.4971, -0.2074]], [[0.0166, 0.0657]]], [[[0.0815, 0.0173]], [[-0.3075, 0.4458]], [[0.7054, 0.1269]]]]]

Expected: [[[[[0.1278, 0.6611]], [[0.0555, 0.1979]], [[0.3457, 0.0791]]], [[[0.2058, 0.3198]], [[-0.4971, -0.2074]], [[0.0166, 0.0658]]], [[[0.0815, 0.0173]], [[-0.3075, 0.4458]], [[0.7054, 0.1269]]]]]