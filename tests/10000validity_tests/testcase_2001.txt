import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Ave98667 = tf.keras.layers.Input(shape=([2, 2]))
in1Ave98667 = tf.keras.layers.Input(shape=([2, 2]))
in0GRU41900 = tf.keras.layers.Input(shape=([1, 1]))
in0Con65639 = tf.keras.layers.Input(shape=([2]))
in0Add94185 = tf.keras.layers.Input(shape=([2, 1]))
in1Add94185 = tf.keras.layers.Input(shape=([2, 1]))
in0Glo63802 = tf.keras.layers.Input(shape=([1, 1, 2, 1]))
in0Dot15246 = tf.keras.layers.Input(shape=([3]))
in1Dot15246 = tf.keras.layers.Input(shape=([3]))

Ave98667 = keras.layers.Average(name = 'Ave98667', )([in0Ave98667,in1Ave98667])
Fla83334 = keras.layers.Flatten(name = 'Fla83334', )(Ave98667)
GRU41900 = keras.layers.GRU(2,reset_after=False, recurrent_activation='sigmoid', name = 'GRU41900', )(in0GRU41900)
Con65639 = keras.layers.Concatenate(axis=1, name = 'Con65639', )([GRU41900,in0Con65639])
Sub49498 = keras.layers.Subtract(name = 'Sub49498', )([Fla83334,Con65639])
Res39936 = keras.layers.Reshape((4, 1), name = 'Res39936', )(Sub49498)
Add94185 = keras.layers.Add(name = 'Add94185', )([in0Add94185,in1Add94185])
Zer59446 = keras.layers.ZeroPadding1D(padding=((2, 0)), name = 'Zer59446', )(Add94185)
Max27295 = keras.layers.Maximum(name = 'Max27295', )([Res39936,Zer59446])
Glo63802 = keras.layers.GlobalMaxPool3D(name = 'Glo63802', )(in0Glo63802)
Dot15246 = keras.layers.Dot(axes=(1, 1), name = 'Dot15246', )([in0Dot15246,in1Dot15246])
Ave42093 = keras.layers.Average(name = 'Ave42093', )([Glo63802,Dot15246])
Res54672 = keras.layers.Reshape((1, 1), name = 'Res54672', )(Ave42093)
Ave25251 = keras.layers.AveragePooling1D(pool_size=(1), strides=(1), padding='valid', name = 'Ave25251', )(Res54672)
Zer5 = keras.layers.ZeroPadding1D(padding=((3, 0)), name = 'Zer5', )(Ave25251)
Add25537 = keras.layers.Add(name = 'Add25537', )([Max27295,Zer5])
model = tf.keras.models.Model(inputs=[in0Ave98667,in1Ave98667,in0GRU41900,in0Con65639,in0Add94185,in1Add94185,in0Glo63802,in0Dot15246,in1Dot15246], outputs=Add25537)
w = model.get_layer('GRU41900').get_weights() 
w[0] = np.array([[1, 10, 3, 3, 8, 3]])
w[1] = np.array([[9, 10, 10, 7, 8, 10], [4, 2, 4, 3, 3, 8]])
w[2] = np.array([4, 3, 7, 7, 2, 1])
model.get_layer('GRU41900').set_weights(w) 
in0Ave98667 = tf.constant([[[0.3614, 0.3572], [0.2238, 0.6085]]])
in1Ave98667 = tf.constant([[[0.9388, 0.1929], [0.4914, 0.5655]]])
in0GRU41900 = tf.constant([[[4]]])
in0Con65639 = tf.constant([[0.9933, 0.3324]])
in0Add94185 = tf.constant([[[0.4608], [0.2553]]])
in1Add94185 = tf.constant([[[0.7857], [0.2803]]])
in0Glo63802 = tf.constant([[[[[1.8636], [1.4788]]]]])
in0Dot15246 = tf.constant([[0.6937, 0.63, 0.3527]])
in1Dot15246 = tf.constant([[0.6975, 0.7039, 0.7272]])
print (np.array2string(model.predict([in0Ave98667,in1Ave98667,in0GRU41900,in0Con65639,in0Add94185,in1Add94185,in0Glo63802,in0Dot15246,in1Dot15246],steps=1), separator=', '))
from tensorflow.keras.utils import plot_model
plot_model(model, to_file='Add25537.png')

LAve98667 = average_layer([[[[0.3614, 0.3572], [0.2238, 0.6085]]], [[[0.9388, 0.1929], [0.4914, 0.5655]]]], Ave98667), 
LFla83334 = flatten_layer(Ave98667, Fla83334), 
LGRU41900 = gru_layer([[[4]]],[[1, 10, 3, 3, 8, 3]],[[9, 10, 10, 7, 8, 10], [4, 2, 4, 3, 3, 8]],[4, 3, 7, 7, 2, 1], false, GRU41900), 
LCon65639 = concatenate_layer([GRU41900,[[0.9933, 0.3324]]], 1, Con65639), 
LSub49498 = subtract_layer(Fla83334,Con65639, Sub49498), 
LRes39936 = reshape_layer(Sub49498, [4, 1], Res39936), 
LAdd94185 = add_layer([[[[0.4608], [0.2553]]], [[[0.7857], [0.2803]]]], Add94185), 
LZer59446 = zero_padding1D_layer(Add94185, 2, 0, Zer59446), 
LMax27295 = maximum_layer([Res39936,Zer59446], Max27295), 
LGlo63802 = global_max_pool3D_layer([[[[[1.8636], [1.4788]]]]], Glo63802), 
LDot15246 = dot_layer([[0.6937, 0.63, 0.3527]], [[0.6975, 0.7039, 0.7272]], 1, 1, Dot15246), 
LAve42093 = average_layer([Glo63802,Dot15246], Ave42093), 
LRes54672 = reshape_layer(Ave42093, [1, 1], Res54672), 
LAve25251 = average_pooling1D_layer(Res54672, 1, 1, false, Ave25251), 
LZer5 = zero_padding1D_layer(Ave25251, 3, 0, Zer5), 
LAdd25537 = add_layer([Max27295,Zer5], Add25537), 
exec_layers([LAve98667,LFla83334,LGRU41900,LCon65639,LSub49498,LRes39936,LAdd94185,LZer59446,LMax27295,LGlo63802,LDot15246,LAve42093,LRes54672,LAve25251,LZer5,LAdd25537],["Ave98667","Fla83334","GRU41900","Con65639","Sub49498","Res39936","Add94185","Zer59446","Max27295","Glo63802","Dot15246","Ave42093","Res54672","Ave25251","Zer5","Add25537"],Add25537,"Add25537")

Actual (Unparsed): [[[0.6497646], [0.2750500], [1.2465000], [2.0592981]]]

Expected (Unparsed): [[[0.6497646498695336],[0.27505],[1.2465],[2.059298095]]]

Actual:   [[[0.6498], [0.2751], [1.2465], [2.0593]]]

Expected: [[[0.6498], [0.2751], [1.2465], [2.0593]]]