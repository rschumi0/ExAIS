import os
os.environ['TF_CPP_MIN_LOG_LEVEL'] = '2'
import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Add26088 = tf.keras.layers.Input(shape=([2, 1]))
in1Add26088 = tf.keras.layers.Input(shape=([2, 1]))
in0LST81606 = tf.keras.layers.Input(shape=([1, 2]))
in0Con76634 = tf.keras.layers.Input(shape=([2]))
in0Sim46959 = tf.keras.layers.Input(shape=([1, 2]))
in0Sub8131 = tf.keras.layers.Input(shape=([2, 3, 2]))
in1Sub8131 = tf.keras.layers.Input(shape=([2, 3, 2]))

Add26088 = keras.layers.Add(name = 'Add26088', )([in0Add26088,in1Add26088])
Con10028 = keras.layers.Conv1D(4, (1),strides=(1), padding='same', dilation_rate=(1), name = 'Con10028', )(Add26088)
Res45552 = keras.layers.Reshape((2, 4, 1), name = 'Res45552', )(Con10028)
Res19470 = keras.layers.Reshape((2, 4, 1, 1), name = 'Res19470', )(Res45552)
Zer82832 = keras.layers.ZeroPadding3D(padding=((2, 0), (1, 0), (1, 0)), name = 'Zer82832', )(Res19470)
LST81606 = keras.layers.LSTM(1,recurrent_activation='sigmoid', name = 'LST81606', )(in0LST81606)
Con76634 = keras.layers.Concatenate(axis=1, name = 'Con76634', )([LST81606,in0Con76634])
Sim46959 = keras.layers.SimpleRNN(3,name = 'Sim46959', )(in0Sim46959)
Min74152 = keras.layers.Minimum(name = 'Min74152', )([Con76634,Sim46959])
Res43570 = keras.layers.Reshape((3, 1), name = 'Res43570', )(Min74152)
Res11009 = keras.layers.Reshape((3, 1, 1), name = 'Res11009', )(Res43570)
Glo34820 = keras.layers.GlobalAveragePooling2D(name = 'Glo34820', )(Res11009)
Res64177 = keras.layers.Reshape((1, 1), name = 'Res64177', )(Glo34820)
Res48015 = keras.layers.Reshape((1, 1, 1), name = 'Res48015', )(Res64177)
Res61120 = keras.layers.Reshape((1, 1, 1, 1), name = 'Res61120', )(Res48015)
Zer75075 = keras.layers.ZeroPadding3D(padding=((3, 0), (2, 0), (1, 0)), name = 'Zer75075', )(Res61120)
Sub8131 = keras.layers.Subtract(name = 'Sub8131', )([in0Sub8131,in1Sub8131])
Res94283 = keras.layers.Reshape((2, 3, 2, 1), name = 'Res94283', )(Sub8131)
Up_40993 = keras.layers.UpSampling3D(size=(2, 1, 1), name = 'Up_40993', )(Res94283)
Min21480 = keras.layers.Minimum(name = 'Min21480', )([Zer75075,Up_40993])
Ave90177 = keras.layers.Average(name = 'Ave90177', )([Zer82832,Min21480])
model = tf.keras.models.Model(inputs=[in0Add26088,in1Add26088,in0LST81606,in0Con76634,in0Sim46959,in0Sub8131,in1Sub8131], outputs=Ave90177)
w = model.get_layer('Con10028').get_weights() 
w[0] = np.array([[[0.6706, 0.0735, 0.1191, 0.6192]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con10028').set_weights(w) 
w = model.get_layer('LST81606').get_weights() 
w[0] = np.array([[8, 1, 5, 1], [4, 9, 5, 7]])
w[1] = np.array([[2, 6, 1, 2]])
w[2] = np.array([4, 9, 3, 8])
model.get_layer('LST81606').set_weights(w) 
w = model.get_layer('Sim46959').get_weights() 
w[0] = np.array([[6, 10, 9], [2, 7, 1]])
w[1] = np.array([[6, 1, 8], [5, 10, 1], [5, 6, 5]])
w[2] = np.array([4, 10, 10])
model.get_layer('Sim46959').set_weights(w) 
in0Add26088 = tf.constant([[[0.4964], [0.7427]]])
in1Add26088 = tf.constant([[[0.1913], [0.8885]]])
in0LST81606 = tf.constant([[[1, 1]]])
in0Con76634 = tf.constant([[0.1327, 0.125]])
in0Sim46959 = tf.constant([[[8, 4]]])
in0Sub8131 = tf.constant([[[[0.789, 0.5481], [0.7768, 0.9693], [0.1601, 0.765]], [[0.8116, 0.8288], [0.2559, 0.6636], [0.6228, 0.3243]]]])
in1Sub8131 = tf.constant([[[[0.9724, 0.8185], [0.7408, 0.671], [0.4132, 0.2245]], [[0.4899, 0.7026], [0.0336, 0.3875], [0.2746, 0.9456]]]])
print (np.array2string(model.predict([in0Add26088,in1Add26088,in0LST81606,in0Con76634,in0Sim46959,in0Sub8131,in1Sub8131],steps=1), separator=', '))


LAdd26088 = add_layer([[[[0.4964], [0.7427]]], [[[0.1913], [0.8885]]]], Add26088), 
LCon10028 = conv1D_layer(Add26088, 1,[[[0.6706, 0.0735, 0.1191, 0.6192]]],[0, 0, 0, 0], 1, true, 1, Con10028), 
LRes45552 = reshape_layer(Con10028, [2, 4, 1], Res45552), 
LRes19470 = reshape_layer(Res45552, [2, 4, 1, 1], Res19470), 
LZer82832 = zero_padding3D_layer(Res19470, 2, 0, 1, 0, 1, 0, Zer82832), 
LLST81606 = lstm_layer([[[1, 1]]],[[8, 1, 5, 1], [4, 9, 5, 7]],[[2, 6, 1, 2]],[4, 9, 3, 8], LST81606), 
LCon76634 = concatenate_layer([LST81606,[[0.1327, 0.125]]], 1, Con76634), 
LSim46959 = simple_rnn_layer([[[8, 4]]],[[6, 10, 9], [2, 7, 1]],[[6, 1, 8], [5, 10, 1], [5, 6, 5]],[4, 10, 10], Sim46959), 
LMin74152 = minimum_layer([Con76634,Sim46959], Min74152), 
LRes43570 = reshape_layer(Min74152, [3, 1], Res43570), 
LRes11009 = reshape_layer(Res43570, [3, 1, 1], Res11009), 
LGlo34820 = global_average_pooling2D_layer(Res11009, Glo34820), 
LRes64177 = reshape_layer(Glo34820, [1, 1], Res64177), 
LRes48015 = reshape_layer(Res64177, [1, 1, 1], Res48015), 
LRes61120 = reshape_layer(Res48015, [1, 1, 1, 1], Res61120), 
LZer75075 = zero_padding3D_layer(Res61120, 3, 0, 2, 0, 1, 0, Zer75075), 
LSub8131 = subtract_layer([[[[0.789, 0.5481], [0.7768, 0.9693], [0.1601, 0.765]], [[0.8116, 0.8288], [0.2559, 0.6636], [0.6228, 0.3243]]]], [[[[0.9724, 0.8185], [0.7408, 0.671], [0.4132, 0.2245]], [[0.4899, 0.7026], [0.0336, 0.3875], [0.2746, 0.9456]]]], Sub8131), 
LRes94283 = reshape_layer(Sub8131, [2, 3, 2, 1], Res94283), 
LUp_40993 = up_sampling3D_layer(Res94283, 2, 1, 1, Up_40993), 
LMin21480 = minimum_layer([Zer75075,Up_40993], Min21480), 
LAve90177 = average_layer([Zer82832,Min21480], Ave90177), 
exec_layers([LAdd26088,LCon10028,LRes45552,LRes19470,LZer82832,LLST81606,LCon76634,LSim46959,LMin74152,LRes43570,LRes11009,LGlo34820,LRes64177,LRes48015,LRes61120,LZer75075,LSub8131,LRes94283,LUp_40993,LMin21480,LAve90177],["Add26088","Con10028","Res45552","Res19470","Zer82832","LST81606","Con76634","Sim46959","Min74152","Res43570","Res11009","Glo34820","Res64177","Res48015","Res61120","Zer75075","Sub8131","Res94283","Up_40993","Min21480","Ave90177"],Ave90177,"Ave90177")

Actual (Unparsed): 
 ValueError(ValueError: Operands could not be broadcast together with shapes (4, 5, 2, 1) (4, 3, 2, 1)

Expected (Unparsed): 
Ave90177: Inconsistent Input Shapes, Input Shape [1,4,5,2,1]

Actual:   

Expected: 