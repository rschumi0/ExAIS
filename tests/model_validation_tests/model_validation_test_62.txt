import os
os.environ['TF_CPP_MIN_LOG_LEVEL'] = '2'
import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Loc32303 = tf.keras.layers.Input(shape=([2, 2, 2]))
in0Con92676 = tf.keras.layers.Input(shape=([2, 1, 2]))

Loc32303 = keras.layers.LocallyConnected2D(2, (1, 1),strides=(1, 1), name = 'Loc32303', )(in0Loc32303)
Dep70168 = keras.layers.DepthwiseConv2D((1, 1),strides=(2, 2), padding='valid', name = 'Dep70168', )(Loc32303)
Res44895 = keras.layers.Reshape((1, 2), name = 'Res44895', )(Dep70168)
Fla54531 = keras.layers.Flatten(name = 'Fla54531', )(Res44895)
Con92676 = keras.layers.Conv2DTranspose(4, (2, 1),strides=(5, 1), padding='same', name = 'Con92676', )(in0Con92676)
Res58693 = keras.layers.Reshape((10, 4), name = 'Res58693', )(Con92676)
Glo67578 = keras.layers.GlobalMaxPool1D(name = 'Glo67578', )(Res58693)
Max37455 = keras.layers.Maximum(name = 'Max37455', )([Fla54531,Glo67578])
model = tf.keras.models.Model(inputs=[in0Loc32303,in0Con92676], outputs=Max37455)
w = model.get_layer('Loc32303').get_weights() 
w[0] = np.array([[[0.7649, 0.7547], [0.625, 0.9812]], [[0.7774, 0.8462], [0.5752, 0.446]], [[0.9259, 0.2514], [0.8985, 0.6481]], [[0.1274, 0.7483], [0.0542, 0.2854]]])
w[1] = np.array([[[0, 0], [0, 0]], [[0, 0], [0, 0]]])
model.get_layer('Loc32303').set_weights(w) 
w = model.get_layer('Dep70168').get_weights() 
w[0] = np.array([[[[0.1108], [0.4268]]]])
w[1] = np.array([0, 0])
model.get_layer('Dep70168').set_weights(w) 
w = model.get_layer('Con92676').get_weights() 
w[0] = np.array([[[[0.9197, 0.8749], [0.2944, 0.3126], [0.5248, 0.5248], [0.6243, 0.2496]]], [[[0.3698, 0.7342], [0.0822, 0.2024], [0.4043, 0.6975], [0.488, 0.1877]]]])
w[1] = np.array([0, 0, 0, 0])
model.get_layer('Con92676').set_weights(w) 
in0Loc32303 = tf.constant([[[[0.0266, 0.8712], [0.7495, 0.8066]], [[0.1361, 0.004], [0.4783, 0.8855]]]])
in0Con92676 = tf.constant([[[[0.9726, 0.4829]], [[0.1343, 0.2885]]]])
print (np.array2string(model.predict([in0Loc32303,in0Con92676],steps=1), separator=', '))


LLoc32303 = locally_connected2D_layer([[[[0.0266, 0.8712], [0.7495, 0.8066]], [[0.1361, 0.004], [0.4783, 0.8855]]]], 1, 1,[[[0.7649, 0.7547], [0.625, 0.9812]], [[0.7774, 0.8462], [0.5752, 0.446]], [[0.9259, 0.2514], [0.8985, 0.6481]], [[0.1274, 0.7483], [0.0542, 0.2854]]],[[[0, 0], [0, 0]], [[0, 0], [0, 0]]], 1, 1, Loc32303), 
LDep70168 = depthwise_conv2D_layer(Loc32303, 1, 1,[[[[0.1108], [0.4268]]]],[0, 0], 2, 2, false, Dep70168), 
LRes44895 = reshape_layer(Dep70168, [1, 2], Res44895), 
LFla54531 = flatten_layer(Res44895, Fla54531), 
LCon92676 = conv2D_transpose_layer([[[[0.9726, 0.4829]], [[0.1343, 0.2885]]]], 2, 1,[[[[0.9197, 0.8749], [0.2944, 0.3126], [0.5248, 0.5248], [0.6243, 0.2496]]], [[[0.3698, 0.7342], [0.0822, 0.2024], [0.4043, 0.6975], [0.488, 0.1877]]]],[0, 0, 0, 0], 5, 1, true, Con92676), 
LRes58693 = reshape_layer(Con92676, [10, 4], Res58693), 
LGlo67578 = global_max_pool1D_layer(Res58693, Glo67578), 
LMax37455 = maximum_layer([Fla54531,Glo67578], Max37455), 
exec_layers([LLoc32303,LDep70168,LRes44895,LFla54531,LCon92676,LRes58693,LGlo67578,LMax37455],["Loc32303","Dep70168","Res44895","Fla54531","Con92676","Res58693","Glo67578","Max37455"],Max37455,"Max37455")

Actual (Unparsed): 
 ValueError(ValueError: Operands could not be broadcast together with shapes (2,) (4,)

Expected (Unparsed): 
Max37455: Inconsistent Input Shapes, Input Shape [1,2]

Actual:   

Expected: 