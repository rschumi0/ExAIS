import os
os.environ['TF_CPP_MIN_LOG_LEVEL'] = '2'
import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max13735 = tf.keras.layers.Input(shape=([2, 2]))
in1Max13735 = tf.keras.layers.Input(shape=([2, 2]))
in0Mul86791 = tf.keras.layers.Input(shape=([1, 1, 1]))
in1Mul86791 = tf.keras.layers.Input(shape=([1, 1, 1]))
in0Con96259 = tf.keras.layers.Input(shape=([2, 2, 2]))

Max13735 = keras.layers.Maximum(name = 'Max13735', )([in0Max13735,in1Max13735])
Res34051 = keras.layers.Reshape((2, 2, 1), name = 'Res34051', )(Max13735)
Res25145 = keras.layers.Reshape((2, 2, 1, 1), name = 'Res25145', )(Res34051)
Con78454 = keras.layers.Conv3DTranspose(3, (2, 2, 1),strides=(1, 1, 1), padding='same', name = 'Con78454', )(Res25145)
Con9335 = keras.layers.Conv3D(3, (2, 1, 1),strides=(1, 1, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con9335', )(Con78454)
Res19206 = keras.layers.Reshape((2, 2, 3), name = 'Res19206', )(Con9335)
Mul86791 = keras.layers.Multiply(name = 'Mul86791', )([in0Mul86791,in1Mul86791])
Zer56548 = keras.layers.ZeroPadding2D(padding=((1, 0), (1, 0)), name = 'Zer56548', )(Mul86791)
Con96259 = keras.layers.Concatenate(axis=3, name = 'Con96259', )([Zer56548,in0Con96259])
Max61438 = keras.layers.Maximum(name = 'Max61438', )([Res19206,Con96259])
Sim36162 = keras.layers.SimpleRNN(1,name = 'Sim36162', )(Max61438)
model = tf.keras.models.Model(inputs=[in0Max13735,in1Max13735,in0Mul86791,in1Mul86791,in0Con96259], outputs=Sim36162)
w = model.get_layer('Con78454').get_weights() 
w[0] = np.array([[[[[0.3269], [0.0211], [0.0868]]], [[[0.8961], [0.0982], [0.9675]]]], [[[[0.611], [0.1344], [0.6341]]], [[[0.3771], [0.9652], [0.1587]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con78454').set_weights(w) 
w = model.get_layer('Con9335').get_weights() 
w[0] = np.array([[[[[0.5618, 0.5344, 0.8409], [0.233, 0.1734, 0.5324], [0.1633, 0.0169, 0.8727]]]], [[[[0.6738, 0.6241, 0.1928], [0.8176, 0.0337, 0.104], [0.2036, 0.06, 0.6797]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con9335').set_weights(w) 
w = model.get_layer('Sim36162').get_weights() 
w[0] = np.array([[10]])
w[1] = np.array([[6]])
w[2] = np.array([8])
model.get_layer('Sim36162').set_weights(w) 
in0Max13735 = tf.constant([[[0.9018, 0.0491], [0.7836, 0.5214]]])
in1Max13735 = tf.constant([[[0.19, 0.2269], [0.0927, 0.9383]]])
in0Mul86791 = tf.constant([[[[0.7105]]]])
in1Mul86791 = tf.constant([[[[0.765]]]])
in0Con96259 = tf.constant([[[[0.2143, 0.6719], [0.9701, 0.607]], [[0.5237, 0.6661], [0.3284, 0.4902]]]])
print (np.array2string(model.predict([in0Max13735,in1Max13735,in0Mul86791,in1Mul86791,in0Con96259],steps=1), separator=', '))


LMax13735 = maximum_layer([[[[0.9018, 0.0491], [0.7836, 0.5214]]], [[[0.19, 0.2269], [0.0927, 0.9383]]]], Max13735), 
LRes34051 = reshape_layer(Max13735, [2, 2, 1], Res34051), 
LRes25145 = reshape_layer(Res34051, [2, 2, 1, 1], Res25145), 
LCon78454 = conv3D_transpose_layer(Res25145, 2, 2, 1,[[[[[0.3269], [0.0211], [0.0868]]], [[[0.8961], [0.0982], [0.9675]]]], [[[[0.611], [0.1344], [0.6341]]], [[[0.3771], [0.9652], [0.1587]]]]],[0, 0, 0], 1, 1, 1, true, Con78454), 
LCon9335 = conv3D_layer(Con78454, 2, 1, 1,[[[[[0.5618, 0.5344, 0.8409], [0.233, 0.1734, 0.5324], [0.1633, 0.0169, 0.8727]]]], [[[[0.6738, 0.6241, 0.1928], [0.8176, 0.0337, 0.104], [0.2036, 0.06, 0.6797]]]]],[0, 0, 0], 1, 1, 1, true, 1, 1, 1, Con9335), 
LRes19206 = reshape_layer(Con9335, [2, 2, 3], Res19206), 
LMul86791 = multiply_layer([[[[[0.7105]]]], [[[[0.765]]]]], Mul86791), 
LZer56548 = zero_padding2D_layer(Mul86791, 1, 0, 1, 0, Zer56548), 
LCon96259 = concatenate_layer([Zer56548,[[[[0.2143, 0.6719], [0.9701, 0.607]], [[0.5237, 0.6661], [0.3284, 0.4902]]]]], 3, Con96259), 
LMax61438 = maximum_layer([Res19206,Con96259], Max61438), 
LSim36162 = simple_rnn_layer(Max61438,[[10]],[[6]],[8], Sim36162), 
exec_layers([LMax13735,LRes34051,LRes25145,LCon78454,LCon9335,LRes19206,LMul86791,LZer56548,LCon96259,LMax61438,LSim36162],["Max13735","Res34051","Res25145","Con78454","Con9335","Res19206","Mul86791","Zer56548","Con96259","Max61438","Sim36162"],Sim36162,"Sim36162")

Actual (Unparsed): 
 ValueError('Input ' + str(input_index) + ' of layer ' +ValueError: Input 0 of layer Sim36162 is incompatible with the layer: expected ndim=3, found ndim=4. Full shape received: (None, 2, 2, 3)

Expected (Unparsed): 
Sim36162: Dimension error, Input Shape [1,2,2,3]

Actual:   

Expected: 