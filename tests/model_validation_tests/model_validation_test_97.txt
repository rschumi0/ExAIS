import os
os.environ['TF_CPP_MIN_LOG_LEVEL'] = '2'
import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Mul70030 = tf.keras.layers.Input(shape=([2, 1, 2]))
in1Mul70030 = tf.keras.layers.Input(shape=([2, 1, 2]))
in0Con95879 = tf.keras.layers.Input(shape=([4]))
in0Ave64545 = tf.keras.layers.Input(shape=([2, 1]))
in1Ave64545 = tf.keras.layers.Input(shape=([2, 1]))
in0LST43994 = tf.keras.layers.Input(shape=([1, 2]))
in0Con20667 = tf.keras.layers.Input(shape=([7]))

Mul70030 = keras.layers.Multiply(name = 'Mul70030', )([in0Mul70030,in1Mul70030])
Res88917 = keras.layers.Reshape((2, 2), name = 'Res88917', )(Mul70030)
Fla23999 = keras.layers.Flatten(name = 'Fla23999', )(Res88917)
Con95879 = keras.layers.Concatenate(axis=1, name = 'Con95879', )([Fla23999,in0Con95879])
Ave64545 = keras.layers.Average(name = 'Ave64545', )([in0Ave64545,in1Ave64545])
Res12359 = keras.layers.Reshape((2, 1, 1), name = 'Res12359', )(Ave64545)
Up_31636 = keras.layers.UpSampling2D(size=(2, 2), name = 'Up_31636', )(Res12359)
Res7154 = keras.layers.Reshape((4, 2), name = 'Res7154', )(Up_31636)
Fla76287 = keras.layers.Flatten(name = 'Fla76287', )(Res7154)
LST43994 = keras.layers.RNN(keras.layers.LSTMCell(1,recurrent_activation='sigmoid', ), name = 'LST43994', input_shape=(1, 2))(in0LST43994)
Con20667 = keras.layers.Concatenate(axis=1, name = 'Con20667', )([LST43994,in0Con20667])
Add71397 = keras.layers.Add(name = 'Add71397', )([Fla76287,Con20667])
Mul63284 = keras.layers.Multiply(name = 'Mul63284', )([Con95879,Add71397])
Loc2492 = keras.layers.LocallyConnected1D(4, (1),strides=(1), name = 'Loc2492', )(Mul63284)
model = tf.keras.models.Model(inputs=[in0Mul70030,in1Mul70030,in0Con95879,in0Ave64545,in1Ave64545,in0LST43994,in0Con20667], outputs=Loc2492)
w = model.get_layer('LST43994').get_weights() 
w[0] = np.array([[4, 5, 2, 10], [9, 9, 8, 4]])
w[1] = np.array([[6, 6, 10, 9]])
w[2] = np.array([1, 8, 5, 8])
model.get_layer('LST43994').set_weights(w) 
w = model.get_layer('Loc2492').get_weights() 
w[0] = np.array([[[0.5034, 0.4595, 0.2785, 0.5218]]])
w[1] = np.array([[0, 0, 0, 0]])
model.get_layer('Loc2492').set_weights(w) 
in0Mul70030 = tf.constant([[[[0.9186, 0.6892]], [[0.3389, 0.9157]]]])
in1Mul70030 = tf.constant([[[[0.2356, 0.1268]], [[0.2059, 0.0714]]]])
in0Con95879 = tf.constant([[0.373, 0.0474, 0.2246, 0.9559]])
in0Ave64545 = tf.constant([[[0.7982], [0.6193]]])
in1Ave64545 = tf.constant([[[0.0856], [0.8176]]])
in0LST43994 = tf.constant([[[1, 6]]])
in0Con20667 = tf.constant([[0.4969, 0.0029, 0.5822, 0.9641, 0.2829, 0.9502, 0.5712]])
print (np.array2string(model.predict([in0Mul70030,in1Mul70030,in0Con95879,in0Ave64545,in1Ave64545,in0LST43994,in0Con20667],steps=1), separator=', '))


LMul70030 = multiply_layer([[[[[0.9186, 0.6892]], [[0.3389, 0.9157]]]], [[[[0.2356, 0.1268]], [[0.2059, 0.0714]]]]], Mul70030), 
LRes88917 = reshape_layer(Mul70030, [2, 2], Res88917), 
LFla23999 = flatten_layer(Res88917, Fla23999), 
LCon95879 = concatenate_layer([Fla23999,[[0.373, 0.0474, 0.2246, 0.9559]]], 1, Con95879), 
LAve64545 = average_layer([[[[0.7982], [0.6193]]], [[[0.0856], [0.8176]]]], Ave64545), 
LRes12359 = reshape_layer(Ave64545, [2, 1, 1], Res12359), 
LUp_31636 = up_sampling2D_layer(Res12359, 2, 2, Up_31636), 
LRes7154 = reshape_layer(Up_31636, [4, 2], Res7154), 
LFla76287 = flatten_layer(Res7154, Fla76287), 
LLST43994 = lstmcell_layer([[[1, 6]]],[[4, 5, 2, 10], [9, 9, 8, 4]],[[6, 6, 10, 9]],[1, 8, 5, 8], LST43994), 
LCon20667 = concatenate_layer([LST43994,[[0.4969, 0.0029, 0.5822, 0.9641, 0.2829, 0.9502, 0.5712]]], 1, Con20667), 
LAdd71397 = add_layer([Fla76287,Con20667], Add71397), 
LMul63284 = multiply_layer([Con95879,Add71397], Mul63284), 
LLoc2492 = locally_connected1D_layer(Mul63284, 1,[[[0.5034, 0.4595, 0.2785, 0.5218]]],[[0, 0, 0, 0]], 1, Loc2492), 
exec_layers([LMul70030,LRes88917,LFla23999,LCon95879,LAve64545,LRes12359,LUp_31636,LRes7154,LFla76287,LLST43994,LCon20667,LAdd71397,LMul63284,LLoc2492],["Mul70030","Res88917","Fla23999","Con95879","Ave64545","Res12359","Up_31636","Res7154","Fla76287","LST43994","Con20667","Add71397","Mul63284","Loc2492"],Loc2492,"Loc2492")

Actual (Unparsed): 
 ValueError('Input ' + str(input_index) + ' of layer ' +ValueError: Input 0 of layer Loc2492 is incompatible with the layer: expected ndim=3, found ndim=2. Full shape received: (None, 8)

Expected (Unparsed): 
Loc2492: Dimension error, Input Shape [1,8]

Actual:   

Expected: 