import os
os.environ['TF_CPP_MIN_LOG_LEVEL'] = '2'
import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Lay99860 = tf.keras.layers.Input(shape=([3, 3, 3]))
in0Glo56443 = tf.keras.layers.Input(shape=([1, 2, 2, 1]))
in0Add52239 = tf.keras.layers.Input(shape=([1, 2, 1]))
in1Add52239 = tf.keras.layers.Input(shape=([1, 2, 1]))

Lay99860 = keras.layers.LayerNormalization(axis=3, epsilon=1.6048417906847605, name = 'Lay99860',  input_shape=(3, 3, 3))(in0Lay99860)
Cro79529 = keras.layers.Cropping2D(cropping=((2, 0), (0, 1)), name = 'Cro79529', )(Lay99860)
Res2600 = keras.layers.Reshape((1, 2, 3, 1), name = 'Res2600', )(Cro79529)
Con66634 = keras.layers.Conv3D(3, (1, 2, 2),strides=(1, 4, 1), padding='same', dilation_rate=(1, 1, 1), name = 'Con66634', )(Res2600)
Res58090 = keras.layers.Reshape((1, 1, 9), name = 'Res58090', )(Con66634)
Res91777 = keras.layers.Reshape((1, 9), name = 'Res91777', )(Res58090)
Glo56443 = keras.layers.GlobalAveragePooling3D(name = 'Glo56443', )(in0Glo56443)
Thr62098 = keras.layers.ThresholdedReLU(theta=6.151852049368841, name = 'Thr62098', )(Glo56443)
Res23978 = keras.layers.Reshape((1, 1), name = 'Res23978', )(Thr62098)
Add52239 = keras.layers.Add(name = 'Add52239', )([in0Add52239,in1Add52239])
Res75301 = keras.layers.Reshape((1, 2), name = 'Res75301', )(Add52239)
Dot68846 = keras.layers.Dot(axes=(1, 1), name = 'Dot68846', )([Res23978,Res75301])
Ave18261 = keras.layers.Average(name = 'Ave18261', )([Res91777,Dot68846])
model = tf.keras.models.Model(inputs=[in0Lay99860,in0Glo56443,in0Add52239,in1Add52239], outputs=Ave18261)
w = model.get_layer('Con66634').get_weights() 
w[0] = np.array([[[[[0.9319, 0.3917, 0.3002]], [[0.6883, 0.9812, 0.9692]]], [[[0.3897, 0.1414, 0.2953]], [[0.4183, 0.0711, 0.379]]]]])
w[1] = np.array([0, 0, 0])
model.get_layer('Con66634').set_weights(w) 
in0Lay99860 = tf.constant([[[[1.7722, 1.5044, 1.7604], [1.2188, 1.4133, 1.6727], [1.0397, 1.328, 1.4995]], [[1.0616, 1.8655, 1.2511], [1.0558, 1.5562, 1.5712], [1.102, 1.8336, 1.5501]], [[1.3889, 1.2466, 1.5855], [1.1006, 1.8107, 1.91], [1.1737, 1.6261, 1.7348]]]])
in0Glo56443 = tf.constant([[[[[1.1669], [1.241]], [[1.2259], [1.4407]]]]])
in0Add52239 = tf.constant([[[[0.5104], [0.6868]]]])
in1Add52239 = tf.constant([[[[0.6284], [0.8376]]]])
print (np.array2string(model.predict([in0Lay99860,in0Glo56443,in0Add52239,in1Add52239],steps=1), separator=', '))


LLay99860 = layer_normalization_layer([[[[1.7722, 1.5044, 1.7604], [1.2188, 1.4133, 1.6727], [1.0397, 1.328, 1.4995]], [[1.0616, 1.8655, 1.2511], [1.0558, 1.5562, 1.5712], [1.102, 1.8336, 1.5501]], [[1.3889, 1.2466, 1.5855], [1.1006, 1.8107, 1.91], [1.1737, 1.6261, 1.7348]]]], 3, 1.6048417906847605, Lay99860), 
LCro79529 = cropping2D_layer(Lay99860, 2, 0, 0, 1, Cro79529), 
LRes2600 = reshape_layer(Cro79529, [1, 2, 3, 1], Res2600), 
LCon66634 = conv3D_layer(Res2600, 1, 2, 2,[[[[[0.9319, 0.3917, 0.3002]], [[0.6883, 0.9812, 0.9692]]], [[[0.3897, 0.1414, 0.2953]], [[0.4183, 0.0711, 0.379]]]]],[0, 0, 0], 1, 4, 1, true, 1, 1, 1, Con66634), 
LRes58090 = reshape_layer(Con66634, [1, 1, 9], Res58090), 
LRes91777 = reshape_layer(Res58090, [1, 9], Res91777), 
LGlo56443 = global_average_pooling3D_layer([[[[[1.1669], [1.241]], [[1.2259], [1.4407]]]]], Glo56443), 
LThr62098 = thresholded_relu_layer(Glo56443, 6.151852049368841, Thr62098), 
LRes23978 = reshape_layer(Thr62098, [1, 1], Res23978), 
LAdd52239 = add_layer([[[[[0.5104], [0.6868]]]], [[[[0.6284], [0.8376]]]]], Add52239), 
LRes75301 = reshape_layer(Add52239, [1, 2], Res75301), 
LDot68846 = dot_layer(Res23978,Res75301, 1, 1, Dot68846), 
LAve18261 = average_layer([Res91777,Dot68846], Ave18261), 
exec_layers([LLay99860,LCro79529,LRes2600,LCon66634,LRes58090,LRes91777,LGlo56443,LThr62098,LRes23978,LAdd52239,LRes75301,LDot68846,LAve18261],["Lay99860","Cro79529","Res2600","Con66634","Res58090","Res91777","Glo56443","Thr62098","Res23978","Add52239","Res75301","Dot68846","Ave18261"],Ave18261,"Ave18261")

Actual (Unparsed): 
 ValueError(ValueError: Operands could not be broadcast together with shapes (1, 9) (1, 2)

Expected (Unparsed): 
Ave18261: Inconsistent Input Shapes, Input Shape [1,1,9]

Actual:   

Expected: 