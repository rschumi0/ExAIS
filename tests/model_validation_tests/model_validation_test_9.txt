import os
os.environ['TF_CPP_MIN_LOG_LEVEL'] = '2'
import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers
import numpy as np
np.set_printoptions(suppress=True,threshold=np.inf,formatter={'float_kind':'{:16.7f}'.format})
tf.keras.backend.set_floatx('float64')
in0Max14729 = tf.keras.layers.Input(shape=([1, 2]))
in1Max14729 = tf.keras.layers.Input(shape=([1, 2]))
in0Con67223 = tf.keras.layers.Input(shape=([3, 3, 1]))
in0Sof97854 = tf.keras.layers.Input(shape=([1, 2, 2]))

Max14729 = keras.layers.Maximum(name = 'Max14729', )([in0Max14729,in1Max14729])
Res95954 = keras.layers.Reshape((1, 2, 1), name = 'Res95954', )(Max14729)
Loc65323 = keras.layers.LocallyConnected2D(4, (1, 2),strides=(1, 1), name = 'Loc65323', )(Res95954)
Res44620 = keras.layers.Reshape((1, 4), name = 'Res44620', )(Loc65323)
GRU39221 = keras.layers.GRU(3,reset_after=False, recurrent_activation='sigmoid', name = 'GRU39221', )(Res44620)
Res49212 = keras.layers.Reshape((3, 1), name = 'Res49212', )(GRU39221)
Res89576 = keras.layers.Reshape((3, 1, 1), name = 'Res89576', )(Res49212)
Zer62718 = keras.layers.ZeroPadding2D(padding=((0, 0), (2, 0)), name = 'Zer62718', )(Res89576)
Con67223 = keras.layers.Concatenate(axis=3, name = 'Con67223', )([Zer62718,in0Con67223])
Sof97854 = keras.layers.Softmax(axis=1, name = 'Sof97854', input_shape=(1, 2, 2))(in0Sof97854)
Zer15784 = keras.layers.ZeroPadding2D(padding=((2, 0), (1, 0)), name = 'Zer15784', )(Sof97854)
Ave84096 = keras.layers.Average(name = 'Ave84096', )([Con67223,Zer15784])
Per75532 = keras.layers.Permute((2,1), name = 'Per75532',)(Ave84096)
model = tf.keras.models.Model(inputs=[in0Max14729,in1Max14729,in0Con67223,in0Sof97854], outputs=Per75532)
w = model.get_layer('Loc65323').get_weights() 
w[0] = np.array([[[0.44, 0.3293, 0.383, 0.0472], [0.048, 0.8748, 0.032, 0.2098]]])
w[1] = np.array([[[0, 0, 0, 0]]])
model.get_layer('Loc65323').set_weights(w) 
w = model.get_layer('GRU39221').get_weights() 
w[0] = np.array([[9, 4, 9, 7, 2, 9, 1, 5, 8], [7, 6, 7, 3, 9, 7, 8, 2, 5], [9, 7, 9, 1, 8, 9, 3, 8, 1], [10, 7, 9, 8, 4, 7, 8, 9, 4]])
w[1] = np.array([[6, 1, 3, 9, 2, 2, 9, 5, 9], [3, 7, 7, 5, 7, 3, 10, 8, 4], [9, 9, 7, 8, 6, 9, 5, 9, 2]])
w[2] = np.array([5, 3, 9, 6, 5, 6, 10, 9, 5])
model.get_layer('GRU39221').set_weights(w) 
in0Max14729 = tf.constant([[[0.4084, 0.527]]])
in1Max14729 = tf.constant([[[0.2097, 0.5036]]])
in0Con67223 = tf.constant([[[[0.3045], [0.0188], [0.2995]], [[0.3897], [0.2393], [0.8666]], [[0.5933], [0.3303], [0.5398]]]])
in0Sof97854 = tf.constant([[[[0.9203, 0.8861], [0.5216, 0.7686]]]])
print (np.array2string(model.predict([in0Max14729,in1Max14729,in0Con67223,in0Sof97854],steps=1), separator=', '))


LMax14729 = maximum_layer([[[[0.4084, 0.527]]], [[[0.2097, 0.5036]]]], Max14729), 
LRes95954 = reshape_layer(Max14729, [1, 2, 1], Res95954), 
LLoc65323 = locally_connected2D_layer(Res95954, 1, 2,[[[0.44, 0.3293, 0.383, 0.0472], [0.048, 0.8748, 0.032, 0.2098]]],[[[0, 0, 0, 0]]], 1, 1, Loc65323), 
LRes44620 = reshape_layer(Loc65323, [1, 4], Res44620), 
LGRU39221 = gru_layer(Res44620,[[9, 4, 9, 7, 2, 9, 1, 5, 8], [7, 6, 7, 3, 9, 7, 8, 2, 5], [9, 7, 9, 1, 8, 9, 3, 8, 1], [10, 7, 9, 8, 4, 7, 8, 9, 4]],[[6, 1, 3, 9, 2, 2, 9, 5, 9], [3, 7, 7, 5, 7, 3, 10, 8, 4], [9, 9, 7, 8, 6, 9, 5, 9, 2]],[5, 3, 9, 6, 5, 6, 10, 9, 5], false, GRU39221), 
LRes49212 = reshape_layer(GRU39221, [3, 1], Res49212), 
LRes89576 = reshape_layer(Res49212, [3, 1, 1], Res89576), 
LZer62718 = zero_padding2D_layer(Res89576, 0, 0, 2, 0, Zer62718), 
LCon67223 = concatenate_layer([Zer62718,[[[[0.3045], [0.0188], [0.2995]], [[0.3897], [0.2393], [0.8666]], [[0.5933], [0.3303], [0.5398]]]]], 3, Con67223), 
LSof97854 = softmax_layer([[[[0.9203, 0.8861], [0.5216, 0.7686]]]], 1, Sof97854), 
LZer15784 = zero_padding2D_layer(Sof97854, 2, 0, 1, 0, Zer15784), 
LAve84096 = average_layer([Con67223,Zer15784], Ave84096), 
LPer75532 = permute_layer(Ave84096, 2,1, Per75532), 
exec_layers([LMax14729,LRes95954,LLoc65323,LRes44620,LGRU39221,LRes49212,LRes89576,LZer62718,LCon67223,LSof97854,LZer15784,LAve84096,LPer75532],["Max14729","Res95954","Loc65323","Res44620","GRU39221","Res49212","Res89576","Zer62718","Con67223","Sof97854","Zer15784","Ave84096","Per75532"],Per75532,"Per75532")

Actual (Unparsed): 
 ValueError('Input ' + str(input_index) + ' of layer ' +ValueError: Input 0 of layer Per75532 is incompatible with the layer: expected ndim=3, found ndim=4. Full shape received: (None, 3, 3, 2)

Expected (Unparsed): 
Per75532: Dimension error, Input Shape [1,3,3,2]

Actual:   

Expected: 